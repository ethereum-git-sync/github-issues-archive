{
  "url": "https://api.github.com/repos/eth-brownie/brownie/issues/1434",
  "repository_url": "https://api.github.com/repos/eth-brownie/brownie",
  "labels_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1434/labels{/name}",
  "comments_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1434/comments",
  "events_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1434/events",
  "html_url": "https://github.com/eth-brownie/brownie/issues/1434",
  "id": 1129651456,
  "node_id": "I_kwDOCUsNcc5DVR0A",
  "number": 1434,
  "title": "Contract.transfer method is raising unexpected AttributeError ",
  "user": {
    "login": "DJercic",
    "id": 6108414,
    "node_id": "MDQ6VXNlcjYxMDg0MTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6108414?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/DJercic",
    "html_url": "https://github.com/DJercic",
    "followers_url": "https://api.github.com/users/DJercic/followers",
    "following_url": "https://api.github.com/users/DJercic/following{/other_user}",
    "gists_url": "https://api.github.com/users/DJercic/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/DJercic/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/DJercic/subscriptions",
    "organizations_url": "https://api.github.com/users/DJercic/orgs",
    "repos_url": "https://api.github.com/users/DJercic/repos",
    "events_url": "https://api.github.com/users/DJercic/events{/privacy}",
    "received_events_url": "https://api.github.com/users/DJercic/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-02-10T08:46:34Z",
  "updated_at": "2022-02-18T18:21:00Z",
  "closed_at": "2022-02-18T18:20:46Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Environment information\r\n\r\n* `brownie` Version:  v1.17.2\r\n* `ganache-cli` Version: 7.0.2\r\n* `solc` Version: 0.8.0\r\n* Python Version: 3.9.10\r\n* OS: linux (wsl2)\r\n\r\n### What was wrong?\r\n\r\nI've used a brownie Token mix template and generated a basic RFC20 token. When I run the tests (without any prior modification of the code) I get the a couple of failed tests with the following exception:\r\n\r\n```python\r\n AttributeError: 'NoneType' object has no attribute '_with_attr'\r\n```\r\nI've tracked down the root of the issue and it lies in `brownie.network.account._PrivateKeyAccount.transfer`.\r\nProblem starts on line 644 when the function calls `self._make_transaction` and expects back a  `Tuple[TransactionReceipt, Optional[Exception]]` which is fine and in this case the exception that is returned is `None` a few lines later that exception is passed in the next method `receipt._raise_if_reverted(exc)` and the typings for that method suggest that None is not expected (although debatable because None can be considered Any?)\r\n\r\n\r\n\r\nfile: `brownie.network.transaction.TransactionReceipt`\r\n```python\r\n def _raise_if_reverted(self, exc: Any) -> None:\r\n    # and later on line 446 exc is accessed like it's always defined. \r\n```\r\n \r\nExample of the test file (this is taken directly from the generated token template) \r\n\r\n```python\r\nfrom typing import List\r\nimport brownie\r\n\r\nfrom brownie.network.contract import Contract\r\nfrom brownie.network.account import Account\r\n\r\ndef test_insufficient_balance(accounts: List[Account], token: Contract):\r\n    balance = token.balanceOf(accounts[0])\r\n    with brownie.reverts() as error:\r\n        token.transfer(accounts[1], balance + 1, {'from': accounts[0]})\r\n```\r\n\r\n\r\n### How can it be fixed?\r\n\r\nIt seems that the expected state of the TransactionReceipt is that it is revered when it hits the `_raise_if_reverted` method (nice naming btw) but inside the exception is None. The obvious fix would be either to pass the exception from TransactionReceipt , or based on the design to initiate a default exception when situation like this occurs? Also, I would add more strict typings to the `_raise_if_reverted` method:\r\n```python\r\n def _raise_if_reverted(self, exc: Exception) -> None:\r\n    # ....\r\n```\r\nor \r\n\r\n```python\r\n def _raise_if_reverted(self, exc: Optional[Exception]) -> None:\r\n    # ....\r\n```\r\n(depends on the solution that is chosen)\r\n\r\nIf you spare the time it would be nice to fix this so the test case does not have to catch AttributeError instead of actual brownie exceptions ðŸ˜„ \r\n\r\nAnyway, hope I helped at least in some way! ",
  "closed_by": {
    "login": "DJercic",
    "id": 6108414,
    "node_id": "MDQ6VXNlcjYxMDg0MTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6108414?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/DJercic",
    "html_url": "https://github.com/DJercic",
    "followers_url": "https://api.github.com/users/DJercic/followers",
    "following_url": "https://api.github.com/users/DJercic/following{/other_user}",
    "gists_url": "https://api.github.com/users/DJercic/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/DJercic/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/DJercic/subscriptions",
    "organizations_url": "https://api.github.com/users/DJercic/orgs",
    "repos_url": "https://api.github.com/users/DJercic/repos",
    "events_url": "https://api.github.com/users/DJercic/events{/privacy}",
    "received_events_url": "https://api.github.com/users/DJercic/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/1434/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1434/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/1034911102",
    "html_url": "https://github.com/eth-brownie/brownie/issues/1434#issuecomment-1034911102",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1434",
    "id": 1034911102,
    "node_id": "IC_kwDOCUsNcc49r31-",
    "user": {
      "login": "theref",
      "id": 4128101,
      "node_id": "MDQ6VXNlcjQxMjgxMDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4128101?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theref",
      "html_url": "https://github.com/theref",
      "followers_url": "https://api.github.com/users/theref/followers",
      "following_url": "https://api.github.com/users/theref/following{/other_user}",
      "gists_url": "https://api.github.com/users/theref/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theref/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theref/subscriptions",
      "organizations_url": "https://api.github.com/users/theref/orgs",
      "repos_url": "https://api.github.com/users/theref/repos",
      "events_url": "https://api.github.com/users/theref/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theref/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-10T13:16:35Z",
    "updated_at": "2022-02-10T13:16:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "I have also run into this issue, but only when running brownie within Docker",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/1034911102/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/1038124789",
    "html_url": "https://github.com/eth-brownie/brownie/issues/1434#issuecomment-1038124789",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1434",
    "id": 1038124789,
    "node_id": "IC_kwDOCUsNcc494Ib1",
    "user": {
      "login": "ahbanavi",
      "id": 39927312,
      "node_id": "MDQ6VXNlcjM5OTI3MzEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/39927312?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahbanavi",
      "html_url": "https://github.com/ahbanavi",
      "followers_url": "https://api.github.com/users/ahbanavi/followers",
      "following_url": "https://api.github.com/users/ahbanavi/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahbanavi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahbanavi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahbanavi/subscriptions",
      "organizations_url": "https://api.github.com/users/ahbanavi/orgs",
      "repos_url": "https://api.github.com/users/ahbanavi/repos",
      "events_url": "https://api.github.com/users/ahbanavi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahbanavi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-13T13:39:24Z",
    "updated_at": "2022-02-13T13:39:24Z",
    "author_association": "NONE",
    "body": "I have the same problem while running tests:\r\n\r\n```python\r\ndef test_set_price_reverts(contract):\r\n    with brownie.reverts():\r\n        contract.setPrice(0)\r\n```\r\n\r\nerrors:\r\n```\r\nFAILED tests/deploy_test.py::test_set_price_reverts - AttributeError: 'NoneType' object has no attribute '_with_attr'\r\n```\r\n![image](https://user-images.githubusercontent.com/39927312/153755706-9bd60a68-bade-4095-b831-215e3a442d60.png)\r\n\r\nPython 3.9.10\r\nBrownie v1.17.2 \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/1038124789/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/1044962178",
    "html_url": "https://github.com/eth-brownie/brownie/issues/1434#issuecomment-1044962178",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1434",
    "id": 1044962178,
    "node_id": "IC_kwDOCUsNcc4-SNuC",
    "user": {
      "login": "DJercic",
      "id": 6108414,
      "node_id": "MDQ6VXNlcjYxMDg0MTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6108414?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DJercic",
      "html_url": "https://github.com/DJercic",
      "followers_url": "https://api.github.com/users/DJercic/followers",
      "following_url": "https://api.github.com/users/DJercic/following{/other_user}",
      "gists_url": "https://api.github.com/users/DJercic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DJercic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DJercic/subscriptions",
      "organizations_url": "https://api.github.com/users/DJercic/orgs",
      "repos_url": "https://api.github.com/users/DJercic/repos",
      "events_url": "https://api.github.com/users/DJercic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DJercic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-18T18:21:00Z",
    "updated_at": "2022-02-18T18:21:00Z",
    "author_association": "NONE",
    "body": "fixed in brownie version 1.18.1",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/1044962178/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
