{
  "url": "https://api.github.com/repos/eth-brownie/brownie/issues/1231",
  "repository_url": "https://api.github.com/repos/eth-brownie/brownie",
  "labels_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1231/labels{/name}",
  "comments_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1231/comments",
  "events_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1231/events",
  "html_url": "https://github.com/eth-brownie/brownie/issues/1231",
  "id": 986919474,
  "node_id": "MDU6SXNzdWU5ODY5MTk0NzQ=",
  "number": 1231,
  "title": "Several major issues with changed sources detection",
  "user": {
    "login": "Sap333",
    "id": 6737351,
    "node_id": "MDQ6VXNlcjY3MzczNTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6737351?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Sap333",
    "html_url": "https://github.com/Sap333",
    "followers_url": "https://api.github.com/users/Sap333/followers",
    "following_url": "https://api.github.com/users/Sap333/following{/other_user}",
    "gists_url": "https://api.github.com/users/Sap333/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Sap333/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Sap333/subscriptions",
    "organizations_url": "https://api.github.com/users/Sap333/orgs",
    "repos_url": "https://api.github.com/users/Sap333/repos",
    "events_url": "https://api.github.com/users/Sap333/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Sap333/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-09-02T16:08:20Z",
  "updated_at": "2021-11-05T07:07:39Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Environment information\r\n\r\n* brownie Version: 1.15.6\r\n* Python Version: 3.9.6\r\n* OS: Linux\r\n\r\n### What was wrong?\r\n\r\nBrownie recompiles contracts/interfaces even if they didn't change. Actually it recompiles all contracts every time. The bug depends (but not only) on required/downloaded compiler version and compiler options.\r\n\r\n### How can it be fixed?\r\n\r\nThere are still several major issues with detecting of changed sources.\r\nThere is a mistake in _brownie/project/main.py_ line 264 in method _Project_.__get_changed_contracts_:\r\n`for name in [k for k, v in new_hashes.items() if compiled_hashes.get(k, None) != v]:`\r\nIt must be \"==\" there:\r\n`for name in [k for k, v in new_hashes.items() if compiled_hashes.get(k, None) == v]:`\r\n\r\nAnother  thing is that method _Project_.__get_changed_contracts()_ always says that compiler settings has been changed. Something is deeply wrong with saving/comparing of the compiler settings.\r\n\r\nAnd one more a mistake in line 276 in method _Project_.__get_changed_contracts_:\r\nIt says:\r\n`changed_set: Set = set(self._sources.get_source_path(i) for i in contracts)`\r\nwhich is obviously wrong because it returns the actual set of contracts, not the list of changed contracts/interfaces.\r\nIt seems like there must be something like:\r\n`changed_set: Set = set(self._sources.get_source_path(i) for i in self._build.items())`\r\n\r\nBut actually the whole  _Project_.__get_changed_contracts()_  is a mess and must be checked/rewritten.\r\n\r\n The issue is related with #956 and #1194.\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/1231/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1231/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/911888795",
    "html_url": "https://github.com/eth-brownie/brownie/issues/1231#issuecomment-911888795",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1231",
    "id": 911888795,
    "node_id": "IC_kwDOCUsNcc42WlGb",
    "user": {
      "login": "iamdefinitelyahuman",
      "id": 35276322,
      "node_id": "MDQ6VXNlcjM1Mjc2MzIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/35276322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iamdefinitelyahuman",
      "html_url": "https://github.com/iamdefinitelyahuman",
      "followers_url": "https://api.github.com/users/iamdefinitelyahuman/followers",
      "following_url": "https://api.github.com/users/iamdefinitelyahuman/following{/other_user}",
      "gists_url": "https://api.github.com/users/iamdefinitelyahuman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iamdefinitelyahuman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iamdefinitelyahuman/subscriptions",
      "organizations_url": "https://api.github.com/users/iamdefinitelyahuman/orgs",
      "repos_url": "https://api.github.com/users/iamdefinitelyahuman/repos",
      "events_url": "https://api.github.com/users/iamdefinitelyahuman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iamdefinitelyahuman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-02T17:06:49Z",
    "updated_at": "2021-09-02T17:06:49Z",
    "author_association": "MEMBER",
    "body": "Agreed, that section of the code could definitely use a refactor.  Will happily receive a pull request.",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/911888795/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/912546752",
    "html_url": "https://github.com/eth-brownie/brownie/issues/1231#issuecomment-912546752",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1231",
    "id": 912546752,
    "node_id": "IC_kwDOCUsNcc42ZFvA",
    "user": {
      "login": "maxsiz",
      "id": 17234183,
      "node_id": "MDQ6VXNlcjE3MjM0MTgz",
      "avatar_url": "https://avatars.githubusercontent.com/u/17234183?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maxsiz",
      "html_url": "https://github.com/maxsiz",
      "followers_url": "https://api.github.com/users/maxsiz/followers",
      "following_url": "https://api.github.com/users/maxsiz/following{/other_user}",
      "gists_url": "https://api.github.com/users/maxsiz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/maxsiz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/maxsiz/subscriptions",
      "organizations_url": "https://api.github.com/users/maxsiz/orgs",
      "repos_url": "https://api.github.com/users/maxsiz/repos",
      "events_url": "https://api.github.com/users/maxsiz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/maxsiz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-03T13:37:29Z",
    "updated_at": "2021-09-03T13:37:29Z",
    "author_association": "NONE",
    "body": "I think  this issue may relate to #1221 ",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/912546752/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/961670602",
    "html_url": "https://github.com/eth-brownie/brownie/issues/1231#issuecomment-961670602",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1231",
    "id": 961670602,
    "node_id": "IC_kwDOCUsNcc45Ue3K",
    "user": {
      "login": "princesscrypto1337",
      "id": 90205354,
      "node_id": "MDQ6VXNlcjkwMjA1MzU0",
      "avatar_url": "https://avatars.githubusercontent.com/u/90205354?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/princesscrypto1337",
      "html_url": "https://github.com/princesscrypto1337",
      "followers_url": "https://api.github.com/users/princesscrypto1337/followers",
      "following_url": "https://api.github.com/users/princesscrypto1337/following{/other_user}",
      "gists_url": "https://api.github.com/users/princesscrypto1337/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/princesscrypto1337/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/princesscrypto1337/subscriptions",
      "organizations_url": "https://api.github.com/users/princesscrypto1337/orgs",
      "repos_url": "https://api.github.com/users/princesscrypto1337/repos",
      "events_url": "https://api.github.com/users/princesscrypto1337/events{/privacy}",
      "received_events_url": "https://api.github.com/users/princesscrypto1337/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-05T07:07:39Z",
    "updated_at": "2021-11-05T07:07:39Z",
    "author_association": "NONE",
    "body": "I had been running into the same issue. After digging around the source code, I found the issue is caused by defining the same interface in different files. Brownie doesn't emit an error when this happens. During compilation, you end up comparing the source code of one occurrence of the interface against another in `_compare_build_json`, which then flags the interface for recompilation along with all contracts that depend on it. If I just make sure I only define my interface once in some file and import from it, then the compilation detection works fine. Alternatively, one could just rename the interface uniquely in different files.\r\n\r\nSo perhaps a good solution on Brownie's end is to just emit an error message when multiple occurrences of the same interface are found, like it does for contracts.",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/961670602/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
