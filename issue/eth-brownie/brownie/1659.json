{
  "url": "https://api.github.com/repos/eth-brownie/brownie/issues/1659",
  "repository_url": "https://api.github.com/repos/eth-brownie/brownie",
  "labels_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1659/labels{/name}",
  "comments_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1659/comments",
  "events_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1659/events",
  "html_url": "https://github.com/eth-brownie/brownie/issues/1659",
  "id": 1525670081,
  "node_id": "I_kwDOCUsNcc5a7-DB",
  "number": 1659,
  "title": "Possible memory leak",
  "user": {
    "login": "oswaldoleal",
    "id": 38363177,
    "node_id": "MDQ6VXNlcjM4MzYzMTc3",
    "avatar_url": "https://avatars.githubusercontent.com/u/38363177?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/oswaldoleal",
    "html_url": "https://github.com/oswaldoleal",
    "followers_url": "https://api.github.com/users/oswaldoleal/followers",
    "following_url": "https://api.github.com/users/oswaldoleal/following{/other_user}",
    "gists_url": "https://api.github.com/users/oswaldoleal/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/oswaldoleal/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/oswaldoleal/subscriptions",
    "organizations_url": "https://api.github.com/users/oswaldoleal/orgs",
    "repos_url": "https://api.github.com/users/oswaldoleal/repos",
    "events_url": "https://api.github.com/users/oswaldoleal/events{/privacy}",
    "received_events_url": "https://api.github.com/users/oswaldoleal/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-01-09T14:13:14Z",
  "updated_at": "2023-01-09T14:21:41Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Environment information\r\n\r\n* `brownie` Version: 1.19.1\r\n* `ganache` Version: 7.5.0\r\n* `ganache-cli` Version: 0.6.0\r\n* `ganache-cli` Version: 0.6.0\r\n* `solc` Version: 0.8.14+commit.80d49f37.Linux.g++\r\n* Python Version: 3.9.9\r\n* OS: linux (Ubuntu 22.04.1 LTS x86_64)\r\n\r\n\r\nFor a bit of context, I have a project with a pretty extensive tests and for a while now I have noted that the tests are taking way too long to complete and they use too much memory. It seems to me like the is no consistent behavior on how the code runs using the different available commands (`brownie console`, `brownie test`, `brownie run`).\r\n\r\nIn my specific situation this is how I noticed it\r\nI picked the biggest test I have and first ran it using `brownie test path/to/the/test.py`, using this command I saw that midway through the test the memory usage shoot up 11+ GB and it took around 5 mins to complete. The next thing I tried was to run the test function from inside the brownie console, doing it this way the same test took around 16 secs to complete and the peak memory usage was around 500 MB. Lastly I tried running the test file as a script using the `brownie run path/to/the/script.py,` the behavior that I saw running this command was similar to that of running the brownie test command, ~5 mins run time and incredibly high memory usage, but this time I noticed something else, since run command shows the submitted transactions and its state (and the test command doesn't) I was able to see that there a significant slow down when a transaction is reverted and it is accompanied by a huge increase in memory usage.\r\n\r\nThose reverting transactions are expected and the testing code looks like this:\r\n```\r\nwith pytest.raises(exceptions.VirtualMachineError):\r\n    contract.revertingTransaction({'from': '0x134656...'})\r\n```\r\n\r\nAs a final note I have to say that the running the test with any of the three ways noted above returns a successful tests, all assertions are met\r\n\r\nAnd now I ask, is this a problem you are aware of? if so, do you have possible solutions? if not, what else can I do to help diagnose the issue?",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/1659/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1659/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/1375697218",
    "html_url": "https://github.com/eth-brownie/brownie/issues/1659#issuecomment-1375697218",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1659",
    "id": 1375697218,
    "node_id": "IC_kwDOCUsNcc5R_3lC",
    "user": {
      "login": "oswaldoleal",
      "id": 38363177,
      "node_id": "MDQ6VXNlcjM4MzYzMTc3",
      "avatar_url": "https://avatars.githubusercontent.com/u/38363177?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/oswaldoleal",
      "html_url": "https://github.com/oswaldoleal",
      "followers_url": "https://api.github.com/users/oswaldoleal/followers",
      "following_url": "https://api.github.com/users/oswaldoleal/following{/other_user}",
      "gists_url": "https://api.github.com/users/oswaldoleal/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/oswaldoleal/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/oswaldoleal/subscriptions",
      "organizations_url": "https://api.github.com/users/oswaldoleal/orgs",
      "repos_url": "https://api.github.com/users/oswaldoleal/repos",
      "events_url": "https://api.github.com/users/oswaldoleal/events{/privacy}",
      "received_events_url": "https://api.github.com/users/oswaldoleal/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-09T14:21:41Z",
    "updated_at": "2023-01-09T14:21:41Z",
    "author_association": "NONE",
    "body": "Small addition, running the same test using `brownie test path/to/the/test.py` under the same environment but using an M1 MacBook with 8 GB of ram, the issue is less apparent but still there, it takes 2 mins 40 secs (about have of the linux machine that has a ryzen 5 5500U and 16 GB of ram) but it uses significantly less memory at 2.4 GB",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/1375697218/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
