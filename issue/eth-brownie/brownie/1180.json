{
  "url": "https://api.github.com/repos/eth-brownie/brownie/issues/1180",
  "repository_url": "https://api.github.com/repos/eth-brownie/brownie",
  "labels_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1180/labels{/name}",
  "comments_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1180/comments",
  "events_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1180/events",
  "html_url": "https://github.com/eth-brownie/brownie/issues/1180",
  "id": 962286424,
  "node_id": "MDU6SXNzdWU5NjIyODY0MjQ=",
  "number": 1180,
  "title": "BlockNotFound during new_blocks()",
  "user": {
    "login": "artdgn",
    "id": 29574203,
    "node_id": "MDQ6VXNlcjI5NTc0MjAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/29574203?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/artdgn",
    "html_url": "https://github.com/artdgn",
    "followers_url": "https://api.github.com/users/artdgn/followers",
    "following_url": "https://api.github.com/users/artdgn/following{/other_user}",
    "gists_url": "https://api.github.com/users/artdgn/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/artdgn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/artdgn/subscriptions",
    "organizations_url": "https://api.github.com/users/artdgn/orgs",
    "repos_url": "https://api.github.com/users/artdgn/repos",
    "events_url": "https://api.github.com/users/artdgn/events{/privacy}",
    "received_events_url": "https://api.github.com/users/artdgn/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-08-06T00:13:49Z",
  "updated_at": "2021-08-06T04:02:23Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Environment information\r\n\r\n* `brownie` Version: `1.15.2` installed via pip\r\n* Python Version: 3.8\r\n* OS: linux\r\n\r\n### What was wrong?\r\nAfter connecting to mainnet in an ad-hoc script, when enumerating new blocks in code such as this, a `BlockNotFound` is raised:\r\n\r\n```python\r\nimport os, brownie\r\n\r\n# setup\r\nos.environ['WEB3_INFURA_PROJECT_ID'] = '...'\r\nbrownie.network.main.connect('mainnet', launch_rpc=False)\r\n\r\n# new_blocks() enumeration\r\nts, gasma = 0, 0\r\nfor b in brownie.chain.new_blocks(): \r\n  print(\r\n     f'{b.number:10}\\t'\r\n     f'{len(b.transactions):5} tx\\t'\r\n     f'{len(b.transactions)/(b.timestamp-ts+1e-9):5.2f} tx/sec\\t'\r\n     f'{b.gasUsed / 1e6 // 1:5} Mgas\\t{b.baseFeePerGas / 1e9 // 1:5} gwei\\t'\r\n     f'{b.timestamp - ts:5} sec \\t'\r\n     f'{gasma/1e6:5.3f} Mgas'\r\n  )\r\n  ts = b.timestamp\r\n  gasma = 0.95*gasma + 0.05*b.gasUsed\r\n```\r\n\r\nOccassionally, but consistently, the enumeration raises an `BlockNotFound` such as here, in this case for block number `12968028`:\r\n\r\n```\r\n  12968021\t   77 tx\t 4.28 tx/sec\t  6.0 Mgas\t 35.0 gwei\t   18 sec \t12.787 Mgas\r\n  12968023\t  265 tx\t17.67 tx/sec\t 29.0 Mgas\t 31.0 gwei\t   15 sec \t12.493 Mgas\r\n  12968025\t   40 tx\t 5.00 tx/sec\t  3.0 Mgas\t 33.0 gwei\t    8 sec \t13.367 Mgas\r\n  12968026\t  124 tx\t41.33 tx/sec\t 15.0 Mgas\t 30.0 gwei\t    3 sec \t12.871 Mgas\r\n  12968027\t  178 tx\t35.60 tx/sec\t 19.0 Mgas\t 30.0 gwei\t    5 sec \t12.993 Mgas\r\nTraceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \".../.venv/lib/python3.8/site-packages/brownie/network/state.py\", line 260, in new_blocks\r\n    block = web3.eth.get_block(last_height - height_buffer)\r\n  File \".../.venv/lib/python3.8/site-packages/web3/eth.py\", line 460, in get_block\r\n    return self._get_block(block_identifier, full_transactions)\r\n  File \".../.venv/lib/python3.8/site-packages/web3/module.py\", line 57, in caller\r\n    result = w3.manager.request_blocking(method_str,\r\n  File \".../.venv/lib/python3.8/site-packages/web3/manager.py\", line 181, in request_blocking\r\n    return self.formatted_response(response,\r\n  File \".../.venv/lib/python3.8/site-packages/web3/manager.py\", line 166, in formatted_response\r\n    apply_null_result_formatters(null_result_formatters, response, params)\r\n  File \".../.venv/lib/python3.8/site-packages/web3/manager.py\", line 73, in apply_null_result_formatters\r\n    formatted_resp = pipe(params, null_result_formatters)\r\n  File \"cytoolz/functoolz.pyx\", line 667, in cytoolz.functoolz.pipe\r\n  File \"cytoolz/functoolz.pyx\", line 642, in cytoolz.functoolz.c_pipe\r\n  File \".../.venv/lib/python3.8/site-packages/web3/_utils/method_formatters.py\", line 604, in raise_block_not_found\r\n    raise BlockNotFound(message)\r\nweb3.exceptions.BlockNotFound: Block with id: '0xc5e05d' not found.\r\n```\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/1180/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1180/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/893929691",
    "html_url": "https://github.com/eth-brownie/brownie/issues/1180#issuecomment-893929691",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1180",
    "id": 893929691,
    "node_id": "IC_kwDOCUsNcc41SEjb",
    "user": {
      "login": "iamdefinitelyahuman",
      "id": 35276322,
      "node_id": "MDQ6VXNlcjM1Mjc2MzIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/35276322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iamdefinitelyahuman",
      "html_url": "https://github.com/iamdefinitelyahuman",
      "followers_url": "https://api.github.com/users/iamdefinitelyahuman/followers",
      "following_url": "https://api.github.com/users/iamdefinitelyahuman/following{/other_user}",
      "gists_url": "https://api.github.com/users/iamdefinitelyahuman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iamdefinitelyahuman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iamdefinitelyahuman/subscriptions",
      "organizations_url": "https://api.github.com/users/iamdefinitelyahuman/orgs",
      "repos_url": "https://api.github.com/users/iamdefinitelyahuman/repos",
      "events_url": "https://api.github.com/users/iamdefinitelyahuman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iamdefinitelyahuman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-06T01:12:31Z",
    "updated_at": "2021-08-06T01:12:31Z",
    "author_association": "MEMBER",
    "body": "What are you using for an RPC provider?  Guessing this is caused by uncles, or jitters in infura's load balancing.",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/893929691/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/893982969",
    "html_url": "https://github.com/eth-brownie/brownie/issues/1180#issuecomment-893982969",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1180",
    "id": 893982969,
    "node_id": "IC_kwDOCUsNcc41SRj5",
    "user": {
      "login": "artdgn",
      "id": 29574203,
      "node_id": "MDQ6VXNlcjI5NTc0MjAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/29574203?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/artdgn",
      "html_url": "https://github.com/artdgn",
      "followers_url": "https://api.github.com/users/artdgn/followers",
      "following_url": "https://api.github.com/users/artdgn/following{/other_user}",
      "gists_url": "https://api.github.com/users/artdgn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/artdgn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/artdgn/subscriptions",
      "organizations_url": "https://api.github.com/users/artdgn/orgs",
      "repos_url": "https://api.github.com/users/artdgn/repos",
      "events_url": "https://api.github.com/users/artdgn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/artdgn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-06T04:00:49Z",
    "updated_at": "2021-08-06T04:02:23Z",
    "author_association": "NONE",
    "body": "> What are you using for an RPC provider?\r\n\r\nEverything is default settings except what's in the code snippet above, first time using brownie, just installed it. I'm using infura.\r\n\r\n> Guessing this is caused by uncles, or jitters in infura's load balancing\r\n\r\nIn any case, from my limited user perspective it seems that this exception is probably not the intended or expected behaviour here.\r\n\r\nHope this helps and gives enough info to reproduce if indeed this is undesirable behavior.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/893982969/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
