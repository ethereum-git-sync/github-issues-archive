{
  "url": "https://api.github.com/repos/eth-brownie/brownie/issues/953",
  "repository_url": "https://api.github.com/repos/eth-brownie/brownie",
  "labels_url": "https://api.github.com/repos/eth-brownie/brownie/issues/953/labels{/name}",
  "comments_url": "https://api.github.com/repos/eth-brownie/brownie/issues/953/comments",
  "events_url": "https://api.github.com/repos/eth-brownie/brownie/issues/953/events",
  "html_url": "https://github.com/eth-brownie/brownie/issues/953",
  "id": 806913444,
  "node_id": "MDU6SXNzdWU4MDY5MTM0NDQ=",
  "number": 953,
  "title": "Add Support for EIP-712",
  "user": {
    "login": "fubuloubu",
    "id": 3859395,
    "node_id": "MDQ6VXNlcjM4NTkzOTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fubuloubu",
    "html_url": "https://github.com/fubuloubu",
    "followers_url": "https://api.github.com/users/fubuloubu/followers",
    "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
    "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
    "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
    "repos_url": "https://api.github.com/users/fubuloubu/repos",
    "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1114236590,
      "node_id": "MDU6TGFiZWwxMTE0MjM2NTkw",
      "url": "https://api.github.com/repos/eth-brownie/brownie/labels/enhancement",
      "name": "enhancement",
      "color": "a2eeef",
      "default": true,
      "description": "New feature or request"
    },
    {
      "id": 2834574020,
      "node_id": "MDU6TGFiZWwyODM0NTc0MDIw",
      "url": "https://api.github.com/repos/eth-brownie/brownie/labels/Help%20Wanted",
      "name": "Help Wanted",
      "color": "7702E2",
      "default": false,
      "description": "Pull requests to fix greatly appreciated!"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2021-02-12T03:20:49Z",
  "updated_at": "2022-05-08T11:49:03Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Overview\r\nIt is really difficult to work with EIP-712 message signing because Brownie does not make available the API from `eth_account.Account` available to work with it.\r\n\r\n### Specification\r\nA typical signed message looks something like the following:\r\n```python\r\ndata = {\r\n  \"types\": {\r\n    # Required to have this type:\r\n    \"EIP712Domain\": [\r\n      # At least one of the following 4 are required (must match below):\r\n      {\"name\": \"name\", \"type\": \"string\"},  # Optional per EIP-712\r\n      {\"name\": \"version\", \"type\": \"string\"},  # Optional per EIP-712\r\n      {\"name\": \"chainId\", \"type\": \"uint256\"},  # Optional per EIP-712\r\n      {\"name\": \"verifyingContract\", \"type\": \"address\"},  # Optional per EIP-712\r\n    ],\r\n    # 1 or more \"Data Types\" to sign (must match below)\r\n    \"Permit\": [\r\n      {\"name\": \"owner\", \"type\": \"address\"},\r\n      {\"name\": \"spender\", \"type\": \"address\"},\r\n      {\"name\": \"value\", \"type\": \"uint256\"},\r\n      {\"name\": \"nonce\", \"type\": \"uint256\"},\r\n      {\"name\": \"deadline\", \"type\": \"uint256\"},\r\n    ],\r\n  },\r\n  \"domain\": {\r\n    # At least one of the following 4 are required (must match above):\r\n    \"name\": name,  # Optional per EIP-712\r\n    \"version\": version,  # Optional per EIP-712\r\n    \"chainId\": chain_id,  # Optional per EIP-712\r\n    \"verifyingContract\": contract,  # Optional per EIP-712\r\n  },\r\n  # EIP-712 can define multiple \"Data Types\" but one must be primary\r\n  \"primaryType\": \"Permit\",\r\n  # The primary \"Data Type\" (and all subtypes) to sign (must match above in data type)\r\n  \"message\": {\r\n    \"owner\": owner,\r\n    \"spender\": spender,\r\n    \"value\": allowance,\r\n    \"nonce\": nonce,\r\n    \"deadline\": deadline,\r\n  },\r\n}\r\n```\r\n\r\nAnd then to sign it, you would do the following:\r\n```python\r\nfrom eth_account import Account\r\nfrom eth_account.messages import encode_structured_data\r\n\r\npermit_msg = encode_structured_data(data)\r\nsig_obj = owner.sign_message(permit_msg)\r\n```\r\n\r\nAs you can see, that's a lot of orchestration required to make this work. It really should be in the ABI to be honest, so these types are constructable from compiler outputs. But they are not, and it would at least be nice to implement the minmal possible functionality required to allow message signing to happen cleanly.\r\n\r\nAs a side note, `brownie.network.accounts.*` are not json-serializable, and thus fail when used directly in `encode_structured_data`.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/953/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/eth-brownie/brownie/issues/953/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/798906525",
    "html_url": "https://github.com/eth-brownie/brownie/issues/953#issuecomment-798906525",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/953",
    "id": 798906525,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5ODkwNjUyNQ==",
    "user": {
      "login": "banteg",
      "id": 4562643,
      "node_id": "MDQ6VXNlcjQ1NjI2NDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4562643?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/banteg",
      "html_url": "https://github.com/banteg",
      "followers_url": "https://api.github.com/users/banteg/followers",
      "following_url": "https://api.github.com/users/banteg/following{/other_user}",
      "gists_url": "https://api.github.com/users/banteg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/banteg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/banteg/subscriptions",
      "organizations_url": "https://api.github.com/users/banteg/orgs",
      "repos_url": "https://api.github.com/users/banteg/repos",
      "events_url": "https://api.github.com/users/banteg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/banteg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-14T13:26:09Z",
    "updated_at": "2021-03-14T13:26:09Z",
    "author_association": "COLLABORATOR",
    "body": "Domains fields are optional, but `eth_account` actually [enforces all four of them](https://github.com/ethereum/eth-account/blob/c4bc769039fdacb8eddf26c84640af84651a9da2/eth_account/_utils/structured_data/validation.py#L66-L80), which is incorrect.",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/798906525/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/798970148",
    "html_url": "https://github.com/eth-brownie/brownie/issues/953#issuecomment-798970148",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/953",
    "id": 798970148,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5ODk3MDE0OA==",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-14T20:01:56Z",
    "updated_at": "2021-03-14T20:01:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "> `eth_account` actually [enforces all four of them](https://github.com/ethereum/eth-account/blob/c4bc769039fdacb8eddf26c84640af84651a9da2/eth_account/_utils/structured_data/validation.py#L66-L80), which is incorrect.\r\n\r\nYeah, this is a bug with `eth-account`, see https://github.com/ethereum/eth-account/issues/72\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/798970148/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/802149094",
    "html_url": "https://github.com/eth-brownie/brownie/issues/953#issuecomment-802149094",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/953",
    "id": 802149094,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwMjE0OTA5NA==",
    "user": {
      "login": "iamdefinitelyahuman",
      "id": 35276322,
      "node_id": "MDQ6VXNlcjM1Mjc2MzIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/35276322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iamdefinitelyahuman",
      "html_url": "https://github.com/iamdefinitelyahuman",
      "followers_url": "https://api.github.com/users/iamdefinitelyahuman/followers",
      "following_url": "https://api.github.com/users/iamdefinitelyahuman/following{/other_user}",
      "gists_url": "https://api.github.com/users/iamdefinitelyahuman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iamdefinitelyahuman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iamdefinitelyahuman/subscriptions",
      "organizations_url": "https://api.github.com/users/iamdefinitelyahuman/orgs",
      "repos_url": "https://api.github.com/users/iamdefinitelyahuman/repos",
      "events_url": "https://api.github.com/users/iamdefinitelyahuman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iamdefinitelyahuman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-18T17:32:38Z",
    "updated_at": "2021-03-18T17:32:38Z",
    "author_association": "MEMBER",
    "body": "This would be super useful indeed.",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/802149094/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/802262801",
    "html_url": "https://github.com/eth-brownie/brownie/issues/953#issuecomment-802262801",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/953",
    "id": 802262801,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwMjI2MjgwMQ==",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-18T20:21:22Z",
    "updated_at": "2021-03-19T19:23:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "sketch of a design for this (`EIP712Message` must be implemented upstream in `eth_account`):\r\n```python\r\nfrom eth_abi import abi_types  # Not sure if this is made available\r\nfrom eth_account.messages import EIP712Message\r\n\r\n\r\n# EIP712Message is a dataclass subclass (using dataclassy)\r\nclass Permit(EIP712Message):\r\n    # One of the following must be used (default must be defined, except for `chainId`)\r\n    #_name_: abi_types.string = \"Custom Name\"\r\n    #_version_: abi_types.string = \"1.0.0\"\r\n    _chainId_: abi_types.uint256  # if no default, use web3.eth.chainId\r\n    _verifyingContract_: abi_types.address = \"0x1234...AbCd\"\r\n    \r\n    # These are the actual fields\r\n    owner: abi_types.address\r\n    spender: abi_types.address\r\n    value: abi_types.uint256\r\n    nonce: abi_types.uint256\r\n    deadline: abi_types.uint256 = 0  # can use a default arg, if it makes sense\r\n\r\n\r\npermit_msg = Permit(_chainId_=42, owner=owner, ..., nonce=nonce)\r\nsig_obj = owner.sign_message(permit_msg)\r\n...\r\n# only iterate over the message type, not it's domain header\r\ntx = token.permit(*permit_msg, sig_obj.signature)\r\n```\r\n\r\n---\r\n\r\nEdit: the types can potentially just use the `eth-abi` grammar directly:\r\n\r\n```python\r\nclass Permit(EIP712Message):\r\n    # One of the following must be used\r\n    #_name_: \"string\" = \"Custom Name\"\r\n    #_version_: \"string\" = \"1.0.0\"\r\n    _chainId_: \"uint256\" = 1\r\n    _verifyingContract_: \"address\" = \"0x1234...AbCd\"\r\n    \r\n    # These are the actual fields\r\n    owner: \"address\"\r\n    spender: \"address\"\r\n    value: \"uint256\"\r\n    nonce: \"uint256\"\r\n    deadline: \"uint256\"",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/802262801/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/803178360",
    "html_url": "https://github.com/eth-brownie/brownie/issues/953#issuecomment-803178360",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/953",
    "id": 803178360,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwMzE3ODM2MA==",
    "user": {
      "login": "fubuloubu",
      "id": 3859395,
      "node_id": "MDQ6VXNlcjM4NTkzOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3859395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fubuloubu",
      "html_url": "https://github.com/fubuloubu",
      "followers_url": "https://api.github.com/users/fubuloubu/followers",
      "following_url": "https://api.github.com/users/fubuloubu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fubuloubu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fubuloubu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fubuloubu/subscriptions",
      "organizations_url": "https://api.github.com/users/fubuloubu/orgs",
      "repos_url": "https://api.github.com/users/fubuloubu/repos",
      "events_url": "https://api.github.com/users/fubuloubu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fubuloubu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-19T22:54:18Z",
    "updated_at": "2021-03-19T22:54:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "Made an implementation of this here:\r\nhttps://github.com/ethereum/eth-account/pull/111",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/803178360/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/1119769081",
    "html_url": "https://github.com/eth-brownie/brownie/issues/953#issuecomment-1119769081",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/953",
    "id": 1119769081,
    "node_id": "IC_kwDOCUsNcc5CvlH5",
    "user": {
      "login": "RomanHiden",
      "id": 2690588,
      "node_id": "MDQ6VXNlcjI2OTA1ODg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2690588?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RomanHiden",
      "html_url": "https://github.com/RomanHiden",
      "followers_url": "https://api.github.com/users/RomanHiden/followers",
      "following_url": "https://api.github.com/users/RomanHiden/following{/other_user}",
      "gists_url": "https://api.github.com/users/RomanHiden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RomanHiden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RomanHiden/subscriptions",
      "organizations_url": "https://api.github.com/users/RomanHiden/orgs",
      "repos_url": "https://api.github.com/users/RomanHiden/repos",
      "events_url": "https://api.github.com/users/RomanHiden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RomanHiden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-06T16:00:44Z",
    "updated_at": "2022-05-06T16:00:44Z",
    "author_association": "NONE",
    "body": "that would  be super usefull",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/1119769081/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/1120403679",
    "html_url": "https://github.com/eth-brownie/brownie/issues/953#issuecomment-1120403679",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/953",
    "id": 1120403679,
    "node_id": "IC_kwDOCUsNcc5CyADf",
    "user": {
      "login": "RomanHiden",
      "id": 2690588,
      "node_id": "MDQ6VXNlcjI2OTA1ODg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2690588?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RomanHiden",
      "html_url": "https://github.com/RomanHiden",
      "followers_url": "https://api.github.com/users/RomanHiden/followers",
      "following_url": "https://api.github.com/users/RomanHiden/following{/other_user}",
      "gists_url": "https://api.github.com/users/RomanHiden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RomanHiden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RomanHiden/subscriptions",
      "organizations_url": "https://api.github.com/users/RomanHiden/orgs",
      "repos_url": "https://api.github.com/users/RomanHiden/repos",
      "events_url": "https://api.github.com/users/RomanHiden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RomanHiden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-08T11:49:03Z",
    "updated_at": "2022-05-08T11:49:03Z",
    "author_association": "NONE",
    "body": "`As a side note, brownie.network.accounts.* are not json-serializable, and thus fail when used directly in encode_structured_data.` @fubuloubu how do you solve that?",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/1120403679/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
