{
  "url": "https://api.github.com/repos/eth-brownie/brownie/issues/392",
  "repository_url": "https://api.github.com/repos/eth-brownie/brownie",
  "labels_url": "https://api.github.com/repos/eth-brownie/brownie/issues/392/labels{/name}",
  "comments_url": "https://api.github.com/repos/eth-brownie/brownie/issues/392/comments",
  "events_url": "https://api.github.com/repos/eth-brownie/brownie/issues/392/events",
  "html_url": "https://github.com/eth-brownie/brownie/issues/392",
  "id": 595743644,
  "node_id": "MDU6SXNzdWU1OTU3NDM2NDQ=",
  "number": 392,
  "title": "Exceeded max recursion depth when generating build data for 0x exchange contracts",
  "user": {
    "login": "jonathanmalo",
    "id": 7378938,
    "node_id": "MDQ6VXNlcjczNzg5Mzg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7378938?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jonathanmalo",
    "html_url": "https://github.com/jonathanmalo",
    "followers_url": "https://api.github.com/users/jonathanmalo/followers",
    "following_url": "https://api.github.com/users/jonathanmalo/following{/other_user}",
    "gists_url": "https://api.github.com/users/jonathanmalo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jonathanmalo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jonathanmalo/subscriptions",
    "organizations_url": "https://api.github.com/users/jonathanmalo/orgs",
    "repos_url": "https://api.github.com/users/jonathanmalo/repos",
    "events_url": "https://api.github.com/users/jonathanmalo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jonathanmalo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1114236588,
      "node_id": "MDU6TGFiZWwxMTE0MjM2NTg4",
      "url": "https://api.github.com/repos/eth-brownie/brownie/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-04-07T09:56:45Z",
  "updated_at": "2020-04-07T17:29:12Z",
  "closed_at": "2020-04-07T17:29:12Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Environment information\r\n\r\n* `brownie` Version: 1.6.9\r\n* `ganache-cli` Version: 6.9.1\r\n* `solc` Version: 0.5.17\r\n* Python Version: 3.7.6\r\n* OS: Fedora release 31 (Thirty One)\r\n\r\n### What was wrong?\r\nTried to compile 0x exchange contract as found on https://github.com/0xProject/0x-monorepo/tree/development/contracts using a bash script `refactor.sh`:\r\n```\r\n#!/bin/bash\r\n\r\nmkdir zx && cd zx\r\nbrownie init\r\ncd contracts\r\nZX=0x-monorepo/contracts\r\ngit clone git@github.com:0xProject/0x-monorepo.git\r\nmkdir exchange && cp -r $ZX/exchange/contracts/src/* exchange\r\ncp -r $ZX/asset-proxy   exchange/contracts-asset-proxy\r\ncp -r $ZX/erc20         exchange/contracts-erc20\r\ncp -r $ZX/exchange-libs exchange/contracts-exchange-libs\r\ncp -r $ZX/staking       exchange/contracts-staking\r\ncp -r $ZX/utils         exchange/contracts-utils\r\nrm -rf 0x-monorepo\r\ncd exchange\r\n\r\n# erase files not in dependency manifest\r\ncp ../../../MANIFEST .\r\n(find ./ -type f -printf \"%P\\n\"; cat MANIFEST MANIFEST; echo MANIFEST) |\r\n  sort | uniq -u | xargs -r rm\r\n\r\n# refactor solidity imports\r\negrep -lRZ '@0x' . | xargs -0 -l sed -i -e \"s+@0x+$PWD+\"\r\n\r\ncd ../../ && brownie compile\r\n\r\n```\r\nand this MANIFEST file in the same directory as refactor.sh:\r\n```\r\nMANIFEST\r\nExchange.sol\r\nMixinAssetProxyDispatcher.sol\r\nMixinExchangeCore.sol\r\nMixinMatchOrders.sol\r\nMixinProtocolFees.sol\r\nMixinSignatureValidator.sol\r\nMixinTransactions.sol\r\nMixinTransferSimulator.sol\r\nMixinWrapperFunctions.sol\r\ninterfaces/IAssetProxy.sol\r\ninterfaces/IAssetProxyDispatcher.sol\r\ninterfaces/IEIP1271Data.sol\r\ninterfaces/IEIP1271Wallet.sol\r\ninterfaces/IExchange.sol\r\ninterfaces/IExchangeCore.sol\r\ninterfaces/IMatchOrders.sol\r\ninterfaces/IProtocolFees.sol\r\ninterfaces/ISignatureValidator.sol\r\ninterfaces/ITransactions.sol\r\ninterfaces/ITransferSimulator.sol\r\ninterfaces/IWallet.sol\r\ninterfaces/IWrapperFunctions.sol\r\nlibs/LibExchangeRichErrorDecoder.sol\r\ncontracts-erc20/contracts/src/interfaces/IERC20Token.sol\r\ncontracts-erc20/contracts/src/interfaces/IEtherToken.sol\r\ncontracts-exchange-libs/contracts/src/LibEIP712ExchangeDomain.sol\r\ncontracts-exchange-libs/contracts/src/LibExchangeRichErrors.sol\r\ncontracts-exchange-libs/contracts/src/LibFillResults.sol\r\ncontracts-exchange-libs/contracts/src/LibMath.sol\r\ncontracts-exchange-libs/contracts/src/LibMathRichErrors.sol\r\ncontracts-exchange-libs/contracts/src/LibOrder.sol\r\ncontracts-exchange-libs/contracts/src/LibZeroExTransaction.sol\r\ncontracts-staking/contracts/src/interfaces/IStaking.sol\r\ncontracts-staking/contracts/src/interfaces/IStructs.sol\r\ncontracts-staking/contracts/src/interfaces/IZrxVault.sol\r\ncontracts-utils/contracts/src/LibBytes.sol\r\ncontracts-utils/contracts/src/LibBytesRichErrors.sol\r\ncontracts-utils/contracts/src/LibEIP1271.sol\r\ncontracts-utils/contracts/src/LibEIP712.sol\r\ncontracts-utils/contracts/src/LibOwnableRichErrors.sol\r\ncontracts-utils/contracts/src/LibReentrancyGuardRichErrors.sol\r\ncontracts-utils/contracts/src/LibRichErrors.sol\r\ncontracts-utils/contracts/src/LibSafeMath.sol\r\ncontracts-utils/contracts/src/LibSafeMathRichErrors.sol\r\ncontracts-utils/contracts/src/Ownable.sol\r\ncontracts-utils/contracts/src/ReentrancyGuard.sol\r\ncontracts-utils/contracts/src/Refundable.sol\r\ncontracts-utils/contracts/src/interfaces/IOwnable.sol\r\n```\r\nUsing this command to reproduce the error:\r\n```\r\n./refactor.sh\r\n```\r\nPython stack trace:\r\n```\r\nBrownie v1.6.9 - Python development framework for Ethereum\r\n\r\nCompiling contracts...\r\n  Solc version: 0.5.17+commit.d19bba13.Linux.gpp\r\n  Optimizer: Enabled  Runs: 200\r\n  EVM Version: Istanbul\r\nGenerating build data...\r\n  File \"brownie/_cli/__main__.py\", line 57, in main\r\n    importlib.import_module(f\"brownie._cli.{cmd}\").main()\r\n  File \"brownie/_cli/compile.py\", line 30, in main\r\n    project.load(project_path)\r\n  File \"brownie/project/main.py\", line 513, in load\r\n    return Project(name, project_path)\r\n  File \"brownie/project/main.py\", line 132, in __init__\r\n    self.load()\r\n  File \"brownie/project/main.py\", line 161, in load\r\n    self._compile(changed, self._compiler_config, False)\r\n  File \"brownie/project/main.py\", line 78, in _compile\r\n    interface_sources=self._sources.get_interface_sources(),\r\n  File \"brownie/project/compiler/__init__.py\", line 120, in compile_and_format\r\n    build_json.update(generate_build_json(input_json, output_json, compiler_data, silent))\r\n  File \"brownie/project/compiler/__init__.py\", line 227, in generate_build_json\r\n    source_nodes, statement_nodes, branch_nodes = solidity._get_nodes(output_json)\r\n  File \"brownie/project/compiler/solidity.py\", line 519, in _get_nodes\r\n    source_nodes = solcast.from_standard_output(output_json)\r\n  File \"solcast/main.py\", line 33, in from_standard_output\r\n    source_nodes = set_dependencies(source_nodes)\r\n  File \"solcast/dependencies.py\", line 42, in set_dependencies\r\n    _add_dependencies(contract)\r\n  File \"solcast/dependencies.py\", line 52, in _add_dependencies\r\n    contract.dependencies |= _add_dependencies(node)\r\n  File \"solcast/dependencies.py\", line 52, in _add_dependencies\r\n    contract.dependencies |= _add_dependencies(node)\r\n  File \"solcast/dependencies.py\", line 52, in _add_dependencies\r\n    contract.dependencies |= _add_dependencies(node)\r\n  File line, line 983, in times]\r\n  File \"solcast/dependencies.py\", line 51, in _add_dependencies\r\n    for node in contract.dependencies.copy():\r\nRecursionError: maximum recursion depth exceeded while calling a Python object\r\n```\r\n\r\nThis may be jumping the gun considering https://github.com/iamdefinitelyahuman/brownie/issues/368 has yet to be addressed. Thought I'd share this since there were no import errors from the compiler. Is it possible to replace recursion here?",
  "closed_by": {
    "login": "iamdefinitelyahuman",
    "id": 35276322,
    "node_id": "MDQ6VXNlcjM1Mjc2MzIy",
    "avatar_url": "https://avatars.githubusercontent.com/u/35276322?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/iamdefinitelyahuman",
    "html_url": "https://github.com/iamdefinitelyahuman",
    "followers_url": "https://api.github.com/users/iamdefinitelyahuman/followers",
    "following_url": "https://api.github.com/users/iamdefinitelyahuman/following{/other_user}",
    "gists_url": "https://api.github.com/users/iamdefinitelyahuman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/iamdefinitelyahuman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/iamdefinitelyahuman/subscriptions",
    "organizations_url": "https://api.github.com/users/iamdefinitelyahuman/orgs",
    "repos_url": "https://api.github.com/users/iamdefinitelyahuman/repos",
    "events_url": "https://api.github.com/users/iamdefinitelyahuman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/iamdefinitelyahuman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/392/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/eth-brownie/brownie/issues/392/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/610303428",
    "html_url": "https://github.com/eth-brownie/brownie/issues/392#issuecomment-610303428",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/392",
    "id": 610303428,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDMwMzQyOA==",
    "user": {
      "login": "iamdefinitelyahuman",
      "id": 35276322,
      "node_id": "MDQ6VXNlcjM1Mjc2MzIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/35276322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iamdefinitelyahuman",
      "html_url": "https://github.com/iamdefinitelyahuman",
      "followers_url": "https://api.github.com/users/iamdefinitelyahuman/followers",
      "following_url": "https://api.github.com/users/iamdefinitelyahuman/following{/other_user}",
      "gists_url": "https://api.github.com/users/iamdefinitelyahuman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iamdefinitelyahuman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iamdefinitelyahuman/subscriptions",
      "organizations_url": "https://api.github.com/users/iamdefinitelyahuman/orgs",
      "repos_url": "https://api.github.com/users/iamdefinitelyahuman/repos",
      "events_url": "https://api.github.com/users/iamdefinitelyahuman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iamdefinitelyahuman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-07T10:18:34Z",
    "updated_at": "2020-04-07T10:18:34Z",
    "author_association": "MEMBER",
    "body": "Thanks for such a detailed report!  I'll have a look at this right away.",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/610303428/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/610483028",
    "html_url": "https://github.com/eth-brownie/brownie/issues/392#issuecomment-610483028",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/392",
    "id": 610483028,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDQ4MzAyOA==",
    "user": {
      "login": "iamdefinitelyahuman",
      "id": 35276322,
      "node_id": "MDQ6VXNlcjM1Mjc2MzIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/35276322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iamdefinitelyahuman",
      "html_url": "https://github.com/iamdefinitelyahuman",
      "followers_url": "https://api.github.com/users/iamdefinitelyahuman/followers",
      "following_url": "https://api.github.com/users/iamdefinitelyahuman/following{/other_user}",
      "gists_url": "https://api.github.com/users/iamdefinitelyahuman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iamdefinitelyahuman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iamdefinitelyahuman/subscriptions",
      "organizations_url": "https://api.github.com/users/iamdefinitelyahuman/orgs",
      "repos_url": "https://api.github.com/users/iamdefinitelyahuman/repos",
      "events_url": "https://api.github.com/users/iamdefinitelyahuman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iamdefinitelyahuman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-07T16:18:07Z",
    "updated_at": "2020-04-07T16:18:07Z",
    "author_association": "MEMBER",
    "body": "Found the issue!  In `contracts-exchange-libs/contracts/src/LibOrder.sol`:\r\n\r\n```js\r\nlibrary LibOrder {\r\n\r\n    using LibOrder for Order;\r\n```\r\n\r\nThis caused `py-solc-ast` to break while trying to determine the deps-of-deps of `LibOrder`. I hadn't anticipated a contract depending on itself.\r\n\r\nI'll push a new patch version of `py-solc-ast` right away. With the patch I'm able to locally compile the repo built from your `refactor.sh` script. Also with the soon-to-merge work in #390 you can set the reampping in the config file and avoid the last `egrep` statement.",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/610483028/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
