{
  "url": "https://api.github.com/repos/eth-brownie/brownie/issues/1102",
  "repository_url": "https://api.github.com/repos/eth-brownie/brownie",
  "labels_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1102/labels{/name}",
  "comments_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1102/comments",
  "events_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1102/events",
  "html_url": "https://github.com/eth-brownie/brownie/issues/1102",
  "id": 909976097,
  "node_id": "MDU6SXNzdWU5MDk5NzYwOTc=",
  "number": 1102,
  "title": "Empty Bytes is Converted to Length of 1",
  "user": {
    "login": "PatrickAlphaC",
    "id": 54278053,
    "node_id": "MDQ6VXNlcjU0Mjc4MDUz",
    "avatar_url": "https://avatars.githubusercontent.com/u/54278053?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/PatrickAlphaC",
    "html_url": "https://github.com/PatrickAlphaC",
    "followers_url": "https://api.github.com/users/PatrickAlphaC/followers",
    "following_url": "https://api.github.com/users/PatrickAlphaC/following{/other_user}",
    "gists_url": "https://api.github.com/users/PatrickAlphaC/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/PatrickAlphaC/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/PatrickAlphaC/subscriptions",
    "organizations_url": "https://api.github.com/users/PatrickAlphaC/orgs",
    "repos_url": "https://api.github.com/users/PatrickAlphaC/repos",
    "events_url": "https://api.github.com/users/PatrickAlphaC/events{/privacy}",
    "received_events_url": "https://api.github.com/users/PatrickAlphaC/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1114236588,
      "node_id": "MDU6TGFiZWwxMTE0MjM2NTg4",
      "url": "https://api.github.com/repos/eth-brownie/brownie/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-06-03T00:10:49Z",
  "updated_at": "2022-12-11T10:19:06Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Environment information\r\n\r\n* `brownie` Version: 1.14.6\r\n* `ganache-cli` Version: Ganache CLI v6.12.2 (ganache-core: 2.13.2)\r\n* `solc` Version: 0.6.7+commit.b8d736ae.Darwin.clang\r\n* Python Version: 3.9.1\r\n* OS: osx\r\n\r\n### What was wrong?\r\n\r\nWhen I work with this exact contract:\r\n\r\n```javascript\r\n// SPDX-License-Identifier: MIT\r\n\r\npragma solidity ^0.8.0;\r\n\r\n\r\ncontract A {\r\n    uint256 public length;\r\n    bytes public data;\r\n    constructor(bytes memory _data) public{\r\n        data = _data;\r\n        length=_data.length;\r\n    }\r\n    \r\n    function store(bytes memory newValue) public {\r\n        data = newValue;\r\n        length = data.length;\r\n    }\r\n}\r\n```\r\nIn remix, and I start with \"0x\" as the constructor parameter, when I call `length` I get 0.\r\n\r\nHowever, when I deploy this in Brownie with the following:\r\n\r\n```python\r\nfrom brownie import A, accounts\r\n\r\ndef main():\r\n    account = accounts[0]\r\n    box = A.deploy(\"\", {\"from\": account})\r\n    print(box.length())\r\n\r\n```\r\nI get 1\r\n\r\nRunning the same deployment in hardhat, I get 0:\r\n```javascript\r\nconst { ContractFactory } = require('ethers')\r\n\r\nasync function main() {\r\n    let Box = await ethers.getContractFactory(\"Box\")\r\n    box = await Box.deploy(\"0x\")\r\n    value = await box.length()\r\n    console.log(value.toString())\r\n}\r\n\r\nmain()\r\n```\r\n\r\n### How can it be fixed?\r\n\r\nI'm not sure how this can be fixed yet... I'm still triaging. I'm looking for some way to have a size 0 bytes variable. I am able to do this in hardhat, truffle, and remix. \r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/1102/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1102/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/853481983",
    "html_url": "https://github.com/eth-brownie/brownie/issues/1102#issuecomment-853481983",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1102",
    "id": 853481983,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MzQ4MTk4Mw==",
    "user": {
      "login": "PatrickAlphaC",
      "id": 54278053,
      "node_id": "MDQ6VXNlcjU0Mjc4MDUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/54278053?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PatrickAlphaC",
      "html_url": "https://github.com/PatrickAlphaC",
      "followers_url": "https://api.github.com/users/PatrickAlphaC/followers",
      "following_url": "https://api.github.com/users/PatrickAlphaC/following{/other_user}",
      "gists_url": "https://api.github.com/users/PatrickAlphaC/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PatrickAlphaC/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PatrickAlphaC/subscriptions",
      "organizations_url": "https://api.github.com/users/PatrickAlphaC/orgs",
      "repos_url": "https://api.github.com/users/PatrickAlphaC/repos",
      "events_url": "https://api.github.com/users/PatrickAlphaC/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PatrickAlphaC/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-03T01:02:21Z",
    "updated_at": "2021-06-03T01:02:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "I found it:\r\n```\r\ndef _to_hex(value: Any) -> str:\r\n    \"\"\"Convert a value to a hexstring\"\"\"\r\n    if isinstance(value, bytes):\r\n        return HexBytes(value).hex()\r\n```\r\nThis is in `datatypes.py`. The `.hex()` call is defined as:\r\n```\r\ndef hex(self) -> str:\r\n        \"\"\"\r\n        Just like :meth:`bytes.hex`, but prepends \"0x\"\r\n        \"\"\"\r\n        return \"0x\" + super().hex()\r\n```\r\nSo it always appends `0x` to the start of the bytes. I think a simple \"if \"0x\" -> just return\" would fix this. ",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/853481983/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/853492253",
    "html_url": "https://github.com/eth-brownie/brownie/issues/1102#issuecomment-853492253",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1102",
    "id": 853492253,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MzQ5MjI1Mw==",
    "user": {
      "login": "PatrickAlphaC",
      "id": 54278053,
      "node_id": "MDQ6VXNlcjU0Mjc4MDUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/54278053?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PatrickAlphaC",
      "html_url": "https://github.com/PatrickAlphaC",
      "followers_url": "https://api.github.com/users/PatrickAlphaC/followers",
      "following_url": "https://api.github.com/users/PatrickAlphaC/following{/other_user}",
      "gists_url": "https://api.github.com/users/PatrickAlphaC/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PatrickAlphaC/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PatrickAlphaC/subscriptions",
      "organizations_url": "https://api.github.com/users/PatrickAlphaC/orgs",
      "repos_url": "https://api.github.com/users/PatrickAlphaC/repos",
      "events_url": "https://api.github.com/users/PatrickAlphaC/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PatrickAlphaC/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-03T01:31:08Z",
    "updated_at": "2021-06-03T01:31:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "Right now, my workaround is as follows:\r\n```\r\nbox = A.deploy(eth_utils.to_bytes(hexstr=\"0x\"), {\"from\": account})\r\n```\r\nIf I want to deploy something with an empty bytes string. But it seems very unintuitive. ",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/853492253/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/873687450",
    "html_url": "https://github.com/eth-brownie/brownie/issues/1102#issuecomment-873687450",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1102",
    "id": 873687450,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MzY4NzQ1MA==",
    "user": {
      "login": "iamdefinitelyahuman",
      "id": 35276322,
      "node_id": "MDQ6VXNlcjM1Mjc2MzIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/35276322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iamdefinitelyahuman",
      "html_url": "https://github.com/iamdefinitelyahuman",
      "followers_url": "https://api.github.com/users/iamdefinitelyahuman/followers",
      "following_url": "https://api.github.com/users/iamdefinitelyahuman/following{/other_user}",
      "gists_url": "https://api.github.com/users/iamdefinitelyahuman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iamdefinitelyahuman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iamdefinitelyahuman/subscriptions",
      "organizations_url": "https://api.github.com/users/iamdefinitelyahuman/orgs",
      "repos_url": "https://api.github.com/users/iamdefinitelyahuman/repos",
      "events_url": "https://api.github.com/users/iamdefinitelyahuman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iamdefinitelyahuman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-04T23:47:42Z",
    "updated_at": "2021-07-04T23:47:42Z",
    "author_association": "MEMBER",
    "body": "Ahh that is strange..  yeah we should fix this.",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/873687450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/1345513528",
    "html_url": "https://github.com/eth-brownie/brownie/issues/1102#issuecomment-1345513528",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1102",
    "id": 1345513528,
    "node_id": "IC_kwDOCUsNcc5QMug4",
    "user": {
      "login": "johnbchron",
      "id": 8174031,
      "node_id": "MDQ6VXNlcjgxNzQwMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8174031?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/johnbchron",
      "html_url": "https://github.com/johnbchron",
      "followers_url": "https://api.github.com/users/johnbchron/followers",
      "following_url": "https://api.github.com/users/johnbchron/following{/other_user}",
      "gists_url": "https://api.github.com/users/johnbchron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/johnbchron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/johnbchron/subscriptions",
      "organizations_url": "https://api.github.com/users/johnbchron/orgs",
      "repos_url": "https://api.github.com/users/johnbchron/repos",
      "events_url": "https://api.github.com/users/johnbchron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/johnbchron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-11T10:19:05Z",
    "updated_at": "2022-12-11T10:19:05Z",
    "author_association": "NONE",
    "body": "Dropping a comment to note that this is still an issue. Spent like 12 hours debugging a signature issue; found that it was a bytes field being given a length of 1.",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/1345513528/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
