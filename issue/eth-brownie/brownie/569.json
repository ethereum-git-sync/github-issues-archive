{
  "url": "https://api.github.com/repos/eth-brownie/brownie/issues/569",
  "repository_url": "https://api.github.com/repos/eth-brownie/brownie",
  "labels_url": "https://api.github.com/repos/eth-brownie/brownie/issues/569/labels{/name}",
  "comments_url": "https://api.github.com/repos/eth-brownie/brownie/issues/569/comments",
  "events_url": "https://api.github.com/repos/eth-brownie/brownie/issues/569/events",
  "html_url": "https://github.com/eth-brownie/brownie/issues/569",
  "id": 626905720,
  "node_id": "MDU6SXNzdWU2MjY5MDU3MjA=",
  "number": 569,
  "title": "gas profile missing calls",
  "user": {
    "login": "WyseNynja",
    "id": 624221,
    "node_id": "MDQ6VXNlcjYyNDIyMQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/624221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/WyseNynja",
    "html_url": "https://github.com/WyseNynja",
    "followers_url": "https://api.github.com/users/WyseNynja/followers",
    "following_url": "https://api.github.com/users/WyseNynja/following{/other_user}",
    "gists_url": "https://api.github.com/users/WyseNynja/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/WyseNynja/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/WyseNynja/subscriptions",
    "organizations_url": "https://api.github.com/users/WyseNynja/orgs",
    "repos_url": "https://api.github.com/users/WyseNynja/repos",
    "events_url": "https://api.github.com/users/WyseNynja/events{/privacy}",
    "received_events_url": "https://api.github.com/users/WyseNynja/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/eth-brownie/brownie/milestones/11",
    "html_url": "https://github.com/eth-brownie/brownie/milestone/11",
    "labels_url": "https://api.github.com/repos/eth-brownie/brownie/milestones/11/labels",
    "id": 5477365,
    "node_id": "MDk6TWlsZXN0b25lNTQ3NzM2NQ==",
    "number": 11,
    "title": "Gas profiling",
    "description": "Issues related to gas profile improvements",
    "creator": {
      "login": "iamdefinitelyahuman",
      "id": 35276322,
      "node_id": "MDQ6VXNlcjM1Mjc2MzIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/35276322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iamdefinitelyahuman",
      "html_url": "https://github.com/iamdefinitelyahuman",
      "followers_url": "https://api.github.com/users/iamdefinitelyahuman/followers",
      "following_url": "https://api.github.com/users/iamdefinitelyahuman/following{/other_user}",
      "gists_url": "https://api.github.com/users/iamdefinitelyahuman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iamdefinitelyahuman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iamdefinitelyahuman/subscriptions",
      "organizations_url": "https://api.github.com/users/iamdefinitelyahuman/orgs",
      "repos_url": "https://api.github.com/users/iamdefinitelyahuman/repos",
      "events_url": "https://api.github.com/users/iamdefinitelyahuman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iamdefinitelyahuman/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 2,
    "closed_issues": 2,
    "state": "open",
    "created_at": "2020-05-29T09:30:36Z",
    "updated_at": "2021-09-27T23:02:49Z",
    "due_on": null,
    "closed_at": null
  },
  "comments": 2,
  "created_at": "2020-05-29T00:02:29Z",
  "updated_at": "2021-09-27T23:02:49Z",
  "closed_at": "2021-09-27T23:02:49Z",
  "author_association": "COLLABORATOR",
  "active_lock_reason": null,
  "body": "### Environment information\r\n\r\n* `brownie` Version: 95cf14a4a24a3c2b079e06fec26d9b592164824c\r\n* `ganache-cli` Version: v6.10.0-beta.1\r\n* `solc` Version: 0.6.8\r\n* Python Version: 3.8.2\r\n* OS: Ubuntu 20.04\r\n\r\n### What was wrong?\r\n\r\nI'm getting to the point where [my project's](https://github.com/SatoshiAndKin/argobytes-contracts-brownie) contracts mostly work and now I'm optimizing for gas usage.\r\n\r\nSome of my tests don't report very much in their gas profiles. I think this is related to me doing a `contract_address.call(calldata)` rather than calling with `KyberAction.tradeEtherToToken`.\r\n\r\nIs it possible to categorize these calls and collect their gas usage?\r\n\r\n```\r\n$ ./scripts/test.sh tests/test_kyber_arbitrage.py -G\r\n+ [ -z /home/ski/code/argobytes-contracts-brownie/venv ]\r\n+ brownie test --network mainnet-fork tests/test_kyber_arbitrage.py -G\r\nBrownie v1.8.9 - Python development framework for Ethereum\r\n\r\n===================================================================================== test session starts =====================================================================================\r\nplatform linux -- Python 3.8.2, pytest-5.4.2, py-1.8.1, pluggy-0.13.1\r\nrootdir: /home/ski/code/argobytes-contracts-brownie\r\nplugins: eth-brownie-1.8.9, forked-1.1.3, web3-5.10.0, hypothesis-5.15.0, xdist-1.32.0\r\ncollecting ... Launching 'ganache-cli --accounts 10 --hardfork istanbul --fork ws://127.0.0.1:8546 --gasLimit 10000000 --mnemonic opinion adapt negative bone suit ill fossil alcohol razor script damp fold --port 8575'...\r\ncollected 1 item                                                                                                                                                                              \r\n\r\ntests/test_kyber_arbitrage.py .                                                                                                                                                         [100%]\r\n\r\nGas Profile:\r\nArgobytesOwnedVault <Contract>\r\n   ├─ deploy2         -  avg: 3241799  low: 3241799  high: 3241799\r\n   ├─ atomicArbitrage -  avg: 1395994  low: 1395994  high: 1395994\r\n   └─ mintGasToken    -  avg:  981681  low:  981681  high:  981681\r\nExampleAction <Contract>\r\n   └─ constructor     -  avg: 1510810  low: 1510810  high: 1510810\r\nKyberAction <Contract>\r\n   └─ constructor     -  avg: 3064255  low: 3064255  high: 3064255\r\n```\r\n\r\nMy tests that use the contract methods directly do collect the gas profiles like expected\r\n```\r\n$ ./scripts/test.sh tests/test_kyber_action.py -G\r\n\r\n...\r\n\r\ntests/test_kyber_action.py ..                                                                                                                                                           [100%]\r\n\r\nGas Profile:\r\nKyberAction <Contract>\r\n   ├─ constructor       -  avg: 3064255  low: 3064255  high: 3064255\r\n   ├─ tradeTokenToToken -  avg:  903952  low:  903952  high:  903952\r\n   ├─ tradeEtherToToken -  avg:  539910  low:  539910  high:  539910\r\n   └─ tradeTokenToEther -  avg:  414154  low:  414154  high:  414154\r\n\r\n```\r\n",
  "closed_by": {
    "login": "WyseNynja",
    "id": 624221,
    "node_id": "MDQ6VXNlcjYyNDIyMQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/624221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/WyseNynja",
    "html_url": "https://github.com/WyseNynja",
    "followers_url": "https://api.github.com/users/WyseNynja/followers",
    "following_url": "https://api.github.com/users/WyseNynja/following{/other_user}",
    "gists_url": "https://api.github.com/users/WyseNynja/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/WyseNynja/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/WyseNynja/subscriptions",
    "organizations_url": "https://api.github.com/users/WyseNynja/orgs",
    "repos_url": "https://api.github.com/users/WyseNynja/repos",
    "events_url": "https://api.github.com/users/WyseNynja/events{/privacy}",
    "received_events_url": "https://api.github.com/users/WyseNynja/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/569/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/eth-brownie/brownie/issues/569/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/635697510",
    "html_url": "https://github.com/eth-brownie/brownie/issues/569#issuecomment-635697510",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/569",
    "id": 635697510,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNTY5NzUxMA==",
    "user": {
      "login": "WyseNynja",
      "id": 624221,
      "node_id": "MDQ6VXNlcjYyNDIyMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/624221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/WyseNynja",
      "html_url": "https://github.com/WyseNynja",
      "followers_url": "https://api.github.com/users/WyseNynja/followers",
      "following_url": "https://api.github.com/users/WyseNynja/following{/other_user}",
      "gists_url": "https://api.github.com/users/WyseNynja/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/WyseNynja/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/WyseNynja/subscriptions",
      "organizations_url": "https://api.github.com/users/WyseNynja/orgs",
      "repos_url": "https://api.github.com/users/WyseNynja/repos",
      "events_url": "https://api.github.com/users/WyseNynja/events{/privacy}",
      "received_events_url": "https://api.github.com/users/WyseNynja/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-29T01:04:38Z",
    "updated_at": "2020-05-29T01:04:38Z",
    "author_association": "COLLABORATOR",
    "body": "I wonder if this related:\r\n\r\n```\r\n====================================================================================== warnings summary =======================================================================================\r\ntests/test_kyber_action.py::test_get_amounts\r\n  /home/ski/code/argobytes-contracts-brownie/venv/lib/python3.8/site-packages/brownie/network/contract.py:652: BrownieCompilerWarning: 0xC02aaA39b223FE8D0A0e5C4F27eAD9083C756Cc2: target compiler 'v0.4.19+commit.c4cbbb05' is unsupported by Brownie. Some functionality will not be available.\r\n    warnings.warn(\r\n\r\ntests/test_kyber_action.py::test_get_amounts\r\n  /home/ski/code/argobytes-contracts-brownie/venv/lib/python3.8/site-packages/brownie/network/contract.py:652: BrownieCompilerWarning: 0x0000000000b3F879cb30FE243b4Dfee438691c04: target compiler 'v0.4.16+commit.d7661dd9' is unsupported by Brownie. Some functionality will not be available.\r\n    warnings.warn(\r\n\r\n-- Docs: https://docs.pytest.org/en/latest/warnings.html\r\n```\r\n\r\nWhat exactly is the functionality that is not available? Maybe the warning could have a link to the docs with more information.",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/635697510/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/635879387",
    "html_url": "https://github.com/eth-brownie/brownie/issues/569#issuecomment-635879387",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/569",
    "id": 635879387,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNTg3OTM4Nw==",
    "user": {
      "login": "iamdefinitelyahuman",
      "id": 35276322,
      "node_id": "MDQ6VXNlcjM1Mjc2MzIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/35276322?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iamdefinitelyahuman",
      "html_url": "https://github.com/iamdefinitelyahuman",
      "followers_url": "https://api.github.com/users/iamdefinitelyahuman/followers",
      "following_url": "https://api.github.com/users/iamdefinitelyahuman/following{/other_user}",
      "gists_url": "https://api.github.com/users/iamdefinitelyahuman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iamdefinitelyahuman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iamdefinitelyahuman/subscriptions",
      "organizations_url": "https://api.github.com/users/iamdefinitelyahuman/orgs",
      "repos_url": "https://api.github.com/users/iamdefinitelyahuman/repos",
      "events_url": "https://api.github.com/users/iamdefinitelyahuman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iamdefinitelyahuman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-29T09:41:19Z",
    "updated_at": "2020-05-29T09:41:19Z",
    "author_association": "MEMBER",
    "body": "The current functionality of `--gas` is pretty limited - it's just showing you the total gas consumed based on the function that was initially called, there's no consideration for calls within the transaction.  So you aren't seeing a bug, just a lack of functionality :(\r\n\r\nThat said, @matnad is working on improving this.  #564 generates a detailed profile on a per-tx basis, and then the plan is to aggregate that data for a final report.",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/635879387/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
