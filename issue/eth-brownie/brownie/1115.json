{
  "url": "https://api.github.com/repos/eth-brownie/brownie/issues/1115",
  "repository_url": "https://api.github.com/repos/eth-brownie/brownie",
  "labels_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1115/labels{/name}",
  "comments_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1115/comments",
  "events_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1115/events",
  "html_url": "https://github.com/eth-brownie/brownie/issues/1115",
  "id": 922628726,
  "node_id": "MDU6SXNzdWU5MjI2Mjg3MjY=",
  "number": 1115,
  "title": "Stuck transactions - graceful handling?",
  "user": {
    "login": "skgbanga",
    "id": 8398696,
    "node_id": "MDQ6VXNlcjgzOTg2OTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8398696?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/skgbanga",
    "html_url": "https://github.com/skgbanga",
    "followers_url": "https://api.github.com/users/skgbanga/followers",
    "following_url": "https://api.github.com/users/skgbanga/following{/other_user}",
    "gists_url": "https://api.github.com/users/skgbanga/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/skgbanga/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/skgbanga/subscriptions",
    "organizations_url": "https://api.github.com/users/skgbanga/orgs",
    "repos_url": "https://api.github.com/users/skgbanga/repos",
    "events_url": "https://api.github.com/users/skgbanga/events{/privacy}",
    "received_events_url": "https://api.github.com/users/skgbanga/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-06-16T13:40:30Z",
  "updated_at": "2021-06-16T18:02:31Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hello,\r\n\r\nI noticed a weird thing in which sometimes (about ~1%) brownie says that it has sent a transaction, but then is just stuck. e.g.\r\n\r\n```\r\nTransaction sent: 0xtransaction_hash\r\n<waiting>\r\n```\r\n\r\nI looked into the code a little bit, and noticed this `while True` loop.\r\n\r\n```py\r\n    def _await_transaction(self, required_confs: int, is_blocking: bool) -> None:\r\n        # await tx showing in mempool\r\n        while True:\r\n            try:\r\n                tx: Dict = web3.eth.get_transaction(HexBytes(self.txid))\r\n                break\r\n            except (TransactionNotFound, ValueError):\r\n                if self.sender is None:\r\n                    # if sender was not explicitly set, this transaction was\r\n                    # not broadcasted locally and so likely doesn't exist\r\n                    raise\r\n                if self.nonce is not None:\r\n                    sender_nonce = web3.eth.get_transaction_count(str(self.sender))\r\n                    if sender_nonce > self.nonce:\r\n                        self.status = Status(-2)\r\n                        return\r\n                time.sleep(1)\r\n\r\n```\r\n\r\nAccording to the documentation here: \r\nhttps://web3py.readthedocs.io/en/stable/web3.eth.html#web3.eth.Eth.get_transaction\r\n\r\nit will throw `TransactionNotFound` if it hasn't been mined yet, and it seems we are handling few cases in the `except` clause.\r\n\r\nI was wondering if these are exhaustive enough. i.e. could it be that some case is missing, and we can end up in an infinite loop here? Also does it make sense to have an upper limit of waiting here and maybe send a `cancel` for that transaction after that. ",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/1115/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1115/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/862595006",
    "html_url": "https://github.com/eth-brownie/brownie/issues/1115#issuecomment-862595006",
    "issue_url": "https://api.github.com/repos/eth-brownie/brownie/issues/1115",
    "id": 862595006,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MjU5NTAwNg==",
    "user": {
      "login": "skgbanga",
      "id": 8398696,
      "node_id": "MDQ6VXNlcjgzOTg2OTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8398696?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/skgbanga",
      "html_url": "https://github.com/skgbanga",
      "followers_url": "https://api.github.com/users/skgbanga/followers",
      "following_url": "https://api.github.com/users/skgbanga/following{/other_user}",
      "gists_url": "https://api.github.com/users/skgbanga/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/skgbanga/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/skgbanga/subscriptions",
      "organizations_url": "https://api.github.com/users/skgbanga/orgs",
      "repos_url": "https://api.github.com/users/skgbanga/repos",
      "events_url": "https://api.github.com/users/skgbanga/events{/privacy}",
      "received_events_url": "https://api.github.com/users/skgbanga/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-16T18:02:31Z",
    "updated_at": "2021-06-16T18:02:31Z",
    "author_association": "NONE",
    "body": "I spent more time to figure out what is going on. (since I was being affected by this problem quite badly). \r\n\r\nWhen we do `contract.foo(...)`, essentially we call `web3.eth.send_transaction` and then in `TransactionReceipt` init function, we keep calling `web3.eth.get_transaction` (as shown above) in a tight loop. (I added print statements in the code to verify this).\r\n\r\nSo most likely this is outside the scope of brownie, and in the realm of web3.eth\r\n\r\nI am curious if there is anything we can do about this though. Any function we can call to figure out what is going on? (check for packet drop or something). Being stuck in a script is painful. ",
    "reactions": {
      "url": "https://api.github.com/repos/eth-brownie/brownie/issues/comments/862595006/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
