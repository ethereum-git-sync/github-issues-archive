{
  "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/4",
  "repository_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography",
  "labels_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/4/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/4/comments",
  "events_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/4/events",
  "html_url": "https://github.com/ethereum/js-ethereum-cryptography/issues/4",
  "id": 716643381,
  "node_id": "MDU6SXNzdWU3MTY2NDMzODE=",
  "number": 4,
  "title": "The keccak package sometimes causes segfaults on Node v14",
  "user": {
    "login": "davidmurdoch",
    "id": 187813,
    "node_id": "MDQ6VXNlcjE4NzgxMw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/187813?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/davidmurdoch",
    "html_url": "https://github.com/davidmurdoch",
    "followers_url": "https://api.github.com/users/davidmurdoch/followers",
    "following_url": "https://api.github.com/users/davidmurdoch/following{/other_user}",
    "gists_url": "https://api.github.com/users/davidmurdoch/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/davidmurdoch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/davidmurdoch/subscriptions",
    "organizations_url": "https://api.github.com/users/davidmurdoch/orgs",
    "repos_url": "https://api.github.com/users/davidmurdoch/repos",
    "events_url": "https://api.github.com/users/davidmurdoch/events{/privacy}",
    "received_events_url": "https://api.github.com/users/davidmurdoch/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3468165692,
      "node_id": "LA_kwDODJLAss7OuAI8",
      "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/labels/version:0.1.x",
      "name": "version:0.1.x",
      "color": "38DAC1",
      "default": false,
      "description": "This issue/PR is related to the v0.1.x branch"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2020-10-07T15:40:40Z",
  "updated_at": "2022-06-15T10:38:22Z",
  "closed_at": "2022-06-15T10:38:22Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I'm sorry my reproduction steps are so horrible... but I just haven't been able to figure out how to reliably trigger the error.\r\n\r\nTo reproduce:\r\n\r\n0. `git clone https://github.com/trufflesuite/ganache-core.git`\r\n1. `cd ganache-core`\r\n2. `git checkout 8a4fb09c970d2ded061c1b1e1fd912cd7ae0229a`\r\n3. `nvm use 14`\r\n4. `npm ci`\r\n5. `npm test` (you may have to run this many times until you trigger the segfault)\r\n\r\nYou should see something like:\r\n\r\n```bash\r\nSegmentation fault (core dumped)\r\nnpm ERR! code 139\r\nnpm ERR! path /home/david/work/ganache-core\r\nnpm ERR! command failed\r\nnpm ERR! command sh -c mocha --check-leaks --recursive \"./test/local\"\r\n\r\nnpm ERR! A complete log of this run can be found in:\r\nnpm ERR!     /home/david/.npm/_logs/2020-10-07T15_21_43_948Z-debug.log\r\n```\r\n\r\n(The debug log isn't helpful)\r\n\r\nI've somewhat \"fixed\" this in `ganache-core` by patching `keccak` so it never loads the native modules. \r\n\r\nTo reproduce my workaround:\r\n\r\n1. `git checkout c26ba24ebf24d1c09b328a76baf0cf43e82fba04`\r\n2. `npm ci` (if you are using npm 7.0.0-rc.0 you'll need to also run `npm run postinstall`)\r\n3. `npm test` (run it as many times as you'd like; it doesn't crash anymore... I ran the tests for over an hour via `while npm test; do :; done` without a crash)\r\n\r\nHere is the patch, if you're curious: https://github.com/trufflesuite/ganache-core/blob/c26ba24ebf24d1c09b328a76baf0cf43e82fba04/patches/keccak%2B3.0.1.patch#L1-L11\r\n\r\n\r\nThe biggest issue with my workaround is that `patch-package` isn't safe to use in published npm modules. :-(\r\n\r\nI've also [opened the issue in keccak](https://github.com/cryptocoinjs/keccak/issues/19), but I figured it might be faster/easier to update this package to do something like `const keccak = require(\"keccack/js\");` (untested) than it would be to get keccak to find and fix this in the native code.\r\n\r\nNote: removing `nyc` from the `test` command _reduces_ the likelihood of the crash, however, it does still occur when running with `mocha` only.",
  "closed_by": {
    "login": "paulmillr",
    "id": 574696,
    "node_id": "MDQ6VXNlcjU3NDY5Ng==",
    "avatar_url": "https://avatars.githubusercontent.com/u/574696?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulmillr",
    "html_url": "https://github.com/paulmillr",
    "followers_url": "https://api.github.com/users/paulmillr/followers",
    "following_url": "https://api.github.com/users/paulmillr/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulmillr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulmillr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulmillr/subscriptions",
    "organizations_url": "https://api.github.com/users/paulmillr/orgs",
    "repos_url": "https://api.github.com/users/paulmillr/repos",
    "events_url": "https://api.github.com/users/paulmillr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulmillr/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/4/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/4/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/705100417",
    "html_url": "https://github.com/ethereum/js-ethereum-cryptography/issues/4#issuecomment-705100417",
    "issue_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/4",
    "id": 705100417,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTEwMDQxNw==",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T17:58:55Z",
    "updated_at": "2020-10-07T17:58:55Z",
    "author_association": "MEMBER",
    "body": "Hey @davidmurdoch, which platform are you running this on? Linux?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/705100417/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/705107386",
    "html_url": "https://github.com/ethereum/js-ethereum-cryptography/issues/4#issuecomment-705107386",
    "issue_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/4",
    "id": 705107386,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTEwNzM4Ng==",
    "user": {
      "login": "davidmurdoch",
      "id": 187813,
      "node_id": "MDQ6VXNlcjE4NzgxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/187813?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davidmurdoch",
      "html_url": "https://github.com/davidmurdoch",
      "followers_url": "https://api.github.com/users/davidmurdoch/followers",
      "following_url": "https://api.github.com/users/davidmurdoch/following{/other_user}",
      "gists_url": "https://api.github.com/users/davidmurdoch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davidmurdoch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davidmurdoch/subscriptions",
      "organizations_url": "https://api.github.com/users/davidmurdoch/orgs",
      "repos_url": "https://api.github.com/users/davidmurdoch/repos",
      "events_url": "https://api.github.com/users/davidmurdoch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davidmurdoch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T18:12:03Z",
    "updated_at": "2020-10-07T18:12:03Z",
    "author_association": "NONE",
    "body": "Linux (Kubuntu 20.04), yes. But I've seen it fail in CI on Mac as well.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/705107386/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/705636341",
    "html_url": "https://github.com/ethereum/js-ethereum-cryptography/issues/4#issuecomment-705636341",
    "issue_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/4",
    "id": 705636341,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTYzNjM0MQ==",
    "user": {
      "login": "davidmurdoch",
      "id": 187813,
      "node_id": "MDQ6VXNlcjE4NzgxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/187813?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davidmurdoch",
      "html_url": "https://github.com/davidmurdoch",
      "followers_url": "https://api.github.com/users/davidmurdoch/followers",
      "following_url": "https://api.github.com/users/davidmurdoch/following{/other_user}",
      "gists_url": "https://api.github.com/users/davidmurdoch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davidmurdoch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davidmurdoch/subscriptions",
      "organizations_url": "https://api.github.com/users/davidmurdoch/orgs",
      "repos_url": "https://api.github.com/users/davidmurdoch/repos",
      "events_url": "https://api.github.com/users/davidmurdoch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davidmurdoch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-08T15:11:03Z",
    "updated_at": "2020-10-08T15:11:03Z",
    "author_association": "NONE",
    "body": "I've updated https://github.com/cryptocoinjs/keccak/issues/19 with some additional information.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/705636341/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/947128666",
    "html_url": "https://github.com/ethereum/js-ethereum-cryptography/issues/4#issuecomment-947128666",
    "issue_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/4",
    "id": 947128666,
    "node_id": "IC_kwDODJLAss44dAla",
    "user": {
      "login": "paulmillr",
      "id": 574696,
      "node_id": "MDQ6VXNlcjU3NDY5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/574696?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulmillr",
      "html_url": "https://github.com/paulmillr",
      "followers_url": "https://api.github.com/users/paulmillr/followers",
      "following_url": "https://api.github.com/users/paulmillr/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulmillr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulmillr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulmillr/subscriptions",
      "organizations_url": "https://api.github.com/users/paulmillr/orgs",
      "repos_url": "https://api.github.com/users/paulmillr/repos",
      "events_url": "https://api.github.com/users/paulmillr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulmillr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-19T21:43:03Z",
    "updated_at": "2021-10-19T21:43:03Z",
    "author_association": "COLLABORATOR",
    "body": "We're no longer using native code in v0.2, so the upgrade fixes it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/947128666/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/1023806986",
    "html_url": "https://github.com/ethereum/js-ethereum-cryptography/issues/4#issuecomment-1023806986",
    "issue_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/4",
    "id": 1023806986,
    "node_id": "IC_kwDODJLAss49Bg4K",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-28T01:45:23Z",
    "updated_at": "2022-01-28T01:45:23Z",
    "author_association": "MEMBER",
    "body": "Hey @davidmurdoch, \r\n\r\nI think you will find it useful that we released 1.0.0, which doesn't use any native module (no possible segfault), and has been audited by Cure53. \r\n\r\nI read on Twitter that Ganache migrated to native bigints, so you should be able to migrate to 1.0.0 ðŸš€",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/1023806986/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/1156306374",
    "html_url": "https://github.com/ethereum/js-ethereum-cryptography/issues/4#issuecomment-1156306374",
    "issue_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/4",
    "id": 1156306374,
    "node_id": "IC_kwDODJLAss5E69XG",
    "user": {
      "login": "paulmillr",
      "id": 574696,
      "node_id": "MDQ6VXNlcjU3NDY5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/574696?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulmillr",
      "html_url": "https://github.com/paulmillr",
      "followers_url": "https://api.github.com/users/paulmillr/followers",
      "following_url": "https://api.github.com/users/paulmillr/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulmillr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulmillr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulmillr/subscriptions",
      "organizations_url": "https://api.github.com/users/paulmillr/orgs",
      "repos_url": "https://api.github.com/users/paulmillr/repos",
      "events_url": "https://api.github.com/users/paulmillr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulmillr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-15T10:38:22Z",
    "updated_at": "2022-06-15T10:38:22Z",
    "author_association": "COLLABORATOR",
    "body": "Closing, since 1.x is the future.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/1156306374/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
