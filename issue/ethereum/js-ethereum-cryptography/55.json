{
  "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/55",
  "repository_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography",
  "labels_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/55/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/55/comments",
  "events_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/55/events",
  "html_url": "https://github.com/ethereum/js-ethereum-cryptography/issues/55",
  "id": 1395545219,
  "node_id": "I_kwDODJLAss5TLlSD",
  "number": 55,
  "title": "Missing crypto module when building the project using ncc and Webpack",
  "user": {
    "login": "cds95",
    "id": 24400947,
    "node_id": "MDQ6VXNlcjI0NDAwOTQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/24400947?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cds95",
    "html_url": "https://github.com/cds95",
    "followers_url": "https://api.github.com/users/cds95/followers",
    "following_url": "https://api.github.com/users/cds95/following{/other_user}",
    "gists_url": "https://api.github.com/users/cds95/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cds95/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cds95/subscriptions",
    "organizations_url": "https://api.github.com/users/cds95/orgs",
    "repos_url": "https://api.github.com/users/cds95/repos",
    "events_url": "https://api.github.com/users/cds95/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cds95/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-10-04T01:32:46Z",
  "updated_at": "2022-10-04T01:59:16Z",
  "closed_at": "2022-10-04T01:41:13Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi everyone, this may or may not be an issue with `js-ethereum-cryptography` itself but rather an issue with `@vercel/ncc` and `webpack` builds.  I'm posting it here anyways in case anyone has any ideas on what is going on.\r\n\r\n**Issue**\r\nI have a project that is using a dependency that is dependent on the `keccak` file from `ethereum-cryptography@1.0.3`.  I then bunde my project into a single JS file using the `ncc build` command from this [project](https://github.com/vercel/ncc), which  uses Webpack internally.\r\n\r\nNow the issue is that `ncc` transforms this [code](https://github.com/ethereum/js-ethereum-cryptography/blob/master/src/utils.ts#L49) to the code below as `ncc` can't find the `crypto` package for some reason:\r\n\r\n```\r\n/***/ 84310:\r\n/***/ ((module) => {\r\n\r\nfunction webpackEmptyContext(req) {\r\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\r\n\te.code = 'MODULE_NOT_FOUND';\r\n\tthrow e;\r\n}\r\nwebpackEmptyContext.keys = () => ([]);\r\nwebpackEmptyContext.resolve = webpackEmptyContext;\r\nwebpackEmptyContext.id = 84310;\r\nmodule.exports = webpackEmptyContext;\r\n/***/ }),\r\n```\r\n\r\nThis leads to my project crashing with this error when I try run it:\r\n\r\n```\r\nError: Cannot find module 'crypto'\r\n    at Object.webpackEmptyContext (/Users/christophersastropranoto/Documents/external-adapters-js/packages/sources/layer2-sequencer-health/bundle/index.js:183577:10)\r\n    at /Users/christophersastropranoto/Documents/external-adapters-js/packages/sources/layer2-sequencer-health/bundle/index.js:83270:43\r\n    at Object.78777 (/Users/christophersastropranoto/Documents/external-adapters-js/packages/sources/layer2-sequencer-health/bundle/index.js:83273:3)\r\n    at __nccwpck_require__ (/Users/christophersastropranoto/Documents/external-adapters-js/packages/sources/layer2-sequencer-health/bundle/index.js:183842:43)\r\n    at Object.35681 (/Users/christophersastropranoto/Documents/external-adapters-js/packages/sources/layer2-sequencer-health/bundle/index.js:83194:17)\r\n    at __nccwpck_require__ (/Users/christophersastropranoto/Documents/external-adapters-js/packages/sources/layer2-sequencer-health/bundle/index.js:183842:43)\r\n    at Object.30038 (/Users/christophersastropranoto/Documents/external-adapters-js/packages/sources/layer2-sequencer-health/bundle/index.js:169615:16)\r\n    at __nccwpck_require__ (/Users/christophersastropranoto/Documents/external-adapters-js/packages/sources/layer2-sequencer-health/bundle/index.js:183842:43)\r\n    at Object.55944 (/Users/christophersastropranoto/Documents/external-adapters-js/packages/sources/layer2-sequencer-health/bundle/index.js:168123:14)\r\n    at __nccwpck_require__ (/Users/christophersastropranoto/Documents/external-adapters-js/packages/sources/layer2-sequencer-health/bundle/index.js:183842:43) {\r\n  code: 'MODULE_NOT_FOUND'\r\n}\r\n```\r\n\r\nI've confirmed that this issue is also happening when I try to build the `ethereum-cryptography` package by itself.  \r\n\r\n**Steps to repro**\r\n\r\nRun from the root of the `ethereum-cryptography` repository.\r\n\r\n1. Add `@vercel/ncc` package `yarn add @vercel/ncc`\r\n2. Build the `keccak.ts` file.  `ncc build keccak.js -o bundle/index.js`\r\n3. This should have created a new directory named `bundle` in the root folder with an `index.js` file.  Inspect the generated `index.js` file and find the code below\r\n```\r\nexports.crypto = (() => {\r\n    const webCrypto = typeof self === \"object\" && \"crypto\" in self ? self.crypto : undefined;\r\n    const nodeRequire =  true &&\r\n        __nccwpck_require__(387).bind(module); ------>. The node ID might be different\r\n    return {\r\n        node: nodeRequire && !webCrypto ? nodeRequire(\"crypto\") : undefined,\r\n        web: webCrypto\r\n    };\r\n})();\r\n```\r\n4.  The module with ID 387 resolves to the code below\r\n```\r\n/***/ 387:\r\n/***/ ((module) => {\r\n\r\nfunction webpackEmptyContext(req) {\r\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\r\n\te.code = 'MODULE_NOT_FOUND';\r\n\tthrow e;\r\n}\r\nwebpackEmptyContext.keys = () => ([]);\r\nwebpackEmptyContext.resolve = webpackEmptyContext;\r\nwebpackEmptyContext.id = 387;\r\nmodule.exports = webpackEmptyContext;\r\n```\r\n\r\n**Expected Behavior**\r\n\r\nRunning `ncc build` does not generate a `webpackEmptyContext` function when looking for the `crypto` module.\r\n\r\n**Versions**\r\n\r\n`@vercel/ncc`: 0.34.0\r\n\r\nAny suggestions on what to check are appreciated!  Thanks in advance.",
  "closed_by": {
    "login": "paulmillr",
    "id": 574696,
    "node_id": "MDQ6VXNlcjU3NDY5Ng==",
    "avatar_url": "https://avatars.githubusercontent.com/u/574696?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulmillr",
    "html_url": "https://github.com/paulmillr",
    "followers_url": "https://api.github.com/users/paulmillr/followers",
    "following_url": "https://api.github.com/users/paulmillr/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulmillr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulmillr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulmillr/subscriptions",
    "organizations_url": "https://api.github.com/users/paulmillr/orgs",
    "repos_url": "https://api.github.com/users/paulmillr/repos",
    "events_url": "https://api.github.com/users/paulmillr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulmillr/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/55/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/55/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/1266290015",
    "html_url": "https://github.com/ethereum/js-ethereum-cryptography/issues/55#issuecomment-1266290015",
    "issue_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/55",
    "id": 1266290015,
    "node_id": "IC_kwDODJLAss5Leg1f",
    "user": {
      "login": "paulmillr",
      "id": 574696,
      "node_id": "MDQ6VXNlcjU3NDY5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/574696?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulmillr",
      "html_url": "https://github.com/paulmillr",
      "followers_url": "https://api.github.com/users/paulmillr/followers",
      "following_url": "https://api.github.com/users/paulmillr/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulmillr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulmillr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulmillr/subscriptions",
      "organizations_url": "https://api.github.com/users/paulmillr/orgs",
      "repos_url": "https://api.github.com/users/paulmillr/repos",
      "events_url": "https://api.github.com/users/paulmillr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulmillr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-04T01:41:13Z",
    "updated_at": "2022-10-04T01:41:13Z",
    "author_association": "COLLABORATOR",
    "body": "The code is tested with webpack and rollup, so the problem seems to be in your configuration. Report this to NCC.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/1266290015/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/1266292363",
    "html_url": "https://github.com/ethereum/js-ethereum-cryptography/issues/55#issuecomment-1266292363",
    "issue_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/55",
    "id": 1266292363,
    "node_id": "IC_kwDODJLAss5LehaL",
    "user": {
      "login": "cds95",
      "id": 24400947,
      "node_id": "MDQ6VXNlcjI0NDAwOTQ3",
      "avatar_url": "https://avatars.githubusercontent.com/u/24400947?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cds95",
      "html_url": "https://github.com/cds95",
      "followers_url": "https://api.github.com/users/cds95/followers",
      "following_url": "https://api.github.com/users/cds95/following{/other_user}",
      "gists_url": "https://api.github.com/users/cds95/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cds95/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cds95/subscriptions",
      "organizations_url": "https://api.github.com/users/cds95/orgs",
      "repos_url": "https://api.github.com/users/cds95/repos",
      "events_url": "https://api.github.com/users/cds95/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cds95/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-04T01:46:50Z",
    "updated_at": "2022-10-04T01:46:50Z",
    "author_association": "NONE",
    "body": "@paulmillr Hey thanks for responding.  I'll open an issue in NCC but I wanted to mention that I didn't configure anything when I built this project directly.  I just pulled this repo and ran these steps from the root of the `ethereum-cryptography` repository to check that NCC bundled the project correctly on it's own.\r\n\r\n1. Add @vercel/ncc package `yarn add @vercel/ncc`\r\n2. Build the keccak.ts file. `ncc build keccak.js -o bundle/index.js`\r\nThis should have created a new directory named bundle in the root folder with an index.js file. Inspect the generated index.js file and find the code below\r\n\r\n```\r\nexports.crypto = (() => {\r\n    const webCrypto = typeof self === \"object\" && \"crypto\" in self ? self.crypto : undefined;\r\n    const nodeRequire =  true &&\r\n        __nccwpck_require__(387).bind(module); ------>. The node ID might be different\r\n    return {\r\n        node: nodeRequire && !webCrypto ? nodeRequire(\"crypto\") : undefined,\r\n        web: webCrypto\r\n    };\r\n})();\r\n```\r\nThe module with ID 387 resolves to the code below\r\n```\r\n/***/ 387:\r\n/***/ ((module) => {\r\n\r\nfunction webpackEmptyContext(req) {\r\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\r\n\te.code = 'MODULE_NOT_FOUND';\r\n\tthrow e;\r\n}\r\nwebpackEmptyContext.keys = () => ([]);\r\nwebpackEmptyContext.resolve = webpackEmptyContext;\r\nwebpackEmptyContext.id = 387;\r\nmodule.exports = webpackEmptyContext;\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/1266292363/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/1266297325",
    "html_url": "https://github.com/ethereum/js-ethereum-cryptography/issues/55#issuecomment-1266297325",
    "issue_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/55",
    "id": 1266297325,
    "node_id": "IC_kwDODJLAss5Leint",
    "user": {
      "login": "paulmillr",
      "id": 574696,
      "node_id": "MDQ6VXNlcjU3NDY5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/574696?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulmillr",
      "html_url": "https://github.com/paulmillr",
      "followers_url": "https://api.github.com/users/paulmillr/followers",
      "following_url": "https://api.github.com/users/paulmillr/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulmillr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulmillr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulmillr/subscriptions",
      "organizations_url": "https://api.github.com/users/paulmillr/orgs",
      "repos_url": "https://api.github.com/users/paulmillr/repos",
      "events_url": "https://api.github.com/users/paulmillr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulmillr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-04T01:57:55Z",
    "updated_at": "2022-10-04T01:57:55Z",
    "author_association": "COLLABORATOR",
    "body": "@cds95 right -- even if you did not configure anything specifically, vercel/ncc executes some configuration on its own.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/1266297325/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/1266297940",
    "html_url": "https://github.com/ethereum/js-ethereum-cryptography/issues/55#issuecomment-1266297940",
    "issue_url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/55",
    "id": 1266297940,
    "node_id": "IC_kwDODJLAss5LeixU",
    "user": {
      "login": "cds95",
      "id": 24400947,
      "node_id": "MDQ6VXNlcjI0NDAwOTQ3",
      "avatar_url": "https://avatars.githubusercontent.com/u/24400947?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cds95",
      "html_url": "https://github.com/cds95",
      "followers_url": "https://api.github.com/users/cds95/followers",
      "following_url": "https://api.github.com/users/cds95/following{/other_user}",
      "gists_url": "https://api.github.com/users/cds95/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cds95/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cds95/subscriptions",
      "organizations_url": "https://api.github.com/users/cds95/orgs",
      "repos_url": "https://api.github.com/users/cds95/repos",
      "events_url": "https://api.github.com/users/cds95/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cds95/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-04T01:59:16Z",
    "updated_at": "2022-10-04T01:59:16Z",
    "author_association": "NONE",
    "body": "Gotcha ok.  I've gone ahead and opened an issue with NCC.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/js-ethereum-cryptography/issues/comments/1266297940/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
