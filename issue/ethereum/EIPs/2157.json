{
  "url": "https://api.github.com/repos/ethereum/EIPs/issues/2157",
  "repository_url": "https://api.github.com/repos/ethereum/EIPs",
  "labels_url": "https://api.github.com/repos/ethereum/EIPs/issues/2157/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/EIPs/issues/2157/comments",
  "events_url": "https://api.github.com/repos/ethereum/EIPs/issues/2157/events",
  "html_url": "https://github.com/ethereum/EIPs/issues/2157",
  "id": 462234173,
  "node_id": "MDU6SXNzdWU0NjIyMzQxNzM=",
  "number": 2157,
  "title": "ERC-2157: dType Storage Extension - Decentralized Type System for EVM",
  "user": {
    "login": "loredanacirstea",
    "id": 4785356,
    "node_id": "MDQ6VXNlcjQ3ODUzNTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4785356?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/loredanacirstea",
    "html_url": "https://github.com/loredanacirstea",
    "followers_url": "https://api.github.com/users/loredanacirstea/followers",
    "following_url": "https://api.github.com/users/loredanacirstea/following{/other_user}",
    "gists_url": "https://api.github.com/users/loredanacirstea/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/loredanacirstea/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/loredanacirstea/subscriptions",
    "organizations_url": "https://api.github.com/users/loredanacirstea/orgs",
    "repos_url": "https://api.github.com/users/loredanacirstea/repos",
    "events_url": "https://api.github.com/users/loredanacirstea/events{/privacy}",
    "received_events_url": "https://api.github.com/users/loredanacirstea/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2328627851,
      "node_id": "MDU6TGFiZWwyMzI4NjI3ODUx",
      "url": "https://api.github.com/repos/ethereum/EIPs/labels/stale",
      "name": "stale",
      "color": "000000",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2019-06-28T23:01:18Z",
  "updated_at": "2021-12-04T20:12:19Z",
  "closed_at": "2021-12-04T20:12:19Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Draft can be found at https://github.com/ethereum/EIPs/pull/2158\r\n\r\n```\r\neip: <to be assigned>\r\ntitle: dType Storage Extension - Decentralized Type System for EVM\r\nauthor: Loredana Cirstea (@loredanacirstea), Christian Tzurcanu (@ctzurcanu)\r\ndiscussions-to: https://github.com/ethereum/EIPs/issues/2157\r\nstatus: Draft\r\ntype: Standards Track\r\ncategory: ERC\r\ncreated: 2019-06-28\r\nrequires: 1900\r\n```\r\n\r\n## Simple Summary\r\n\r\nThis ERC is an extension of ERC-1900, proposing an optional storage extension for dType, a decentralized type system, specifying a general ABI for all storage contracts that contain type instances.\r\n\r\n## Abstract\r\n\r\nThe storage extension will enable easy navigation and retrieval of type data that is intended to be of public use. This is possible through standardizing the ABI of the dType storage contracts, with the effect of having a deterministic path to a type instance record. This standardization enables a more effective on-chain and off-chain use of data and opens up possibilities for decentralized applications, enabling developers to build on top of public global data.\r\n\r\n## Motivation\r\n\r\nCurrently, Ethereum does not have standardization of data addressability. This might not be needed for data that is meant to be quasi-private, however, it is needed for data that is meant for public consumption. ERC-1900 has started standardizing data types for increasing interoperability between projects, but this is not enough if we want to build a global ecosystem. Deterministic data addressability will enable anyone to build upon the same public data sets, off-chain or on-chain.\r\n\r\nIt is true that with ERC-1900, blockchain data analysis and type-specific data retrieval will be possible off-chain, but this implies relying on centralized data caches (blockchain explorers) or maintaining your own data cache. Moreover, this option does not allow on-chain standardization on data retrieval paths, therefore limiting the type of on-chain interoperable operations that can be done.\r\n\r\nHaving a clear way of retrieving data, instead of analyzing the blockchain for contracts that have a certain type in their ABI or bytecode, will make development easier and more decentralized for applications that target global data on specific types.\r\n\r\nFor example, a decentralized market place can be built on top of some marketplace-specific types, and by knowing exactly where the type data is stored, it is easy to create custom algorithms that provide the user with the product information they seek. Everyone has access to the data and the data path is standardized.\r\n\r\nMoreover, by standardizing storage contract interfaces, ABI inference is possible. The common interface, together with the dType registry will provide all the data needed to reconstruct the ABI.\r\n\r\nThis system can be extended with access and mutability control later on, in a future proposal. Access and mutability control will be necessary for public-use global systems. Moreover, we can have a homogenous application of permissions across system components. This is not detailed in the present proposal.\r\n\r\nAnother use case is data bridges between Ethereum shards or between Ethereum and other chains. Data syncing between shards/chains can be done programmatically, across data types (from various projects). Imagine a user having a public profile/identity contract on one chain, wishing to move that profile on Ethereum. By supporting the origin chain types and having a standardized storage mechanism, data moving processes will be the same.\r\n\r\nThis pattern of separating data type definitions and storage allows developers to create functional programming-like patterns on Ethereum, even though languages such as Solidity are not functional.\r\n\r\n## Specification\r\n\r\n### TypeRootContract\r\n\r\nERC-1900 defines a `contractAddress` field in the type metadata. For the limited purpose of ERC-1900, this field contains the value of the Ethereum type library in which the type definition exists. For the purpose of this ERC, the `contractAddress` will contain the Etherereum address of a `TypeRootContract`.\r\n\r\n```\r\ncontract TypeRootContract {\r\n  address public libraryAddress;\r\n  address public storageAddress;\r\n\r\n  constructor(address _library, address _storage) public {\r\n    libraryAddress = _library;\r\n    storageAddress = _storage;\r\n  }\r\n}\r\n```\r\n\r\n- `libraryAddress` - Ethereum address of the type definition library, from ERC-1900\r\n- `storageAddress` - Ethereum address of the type data storage contract\r\n\r\n\r\n### TypeStorageContract\r\n\r\nThis contract will use the type library to define the internal data stored in it. Each record will be a type instance, addressable by a primary identifier. The primary identifier is calculated by the type library's `getIdentifier` function, based on the type instance values.\r\n\r\nWe propose a Solidity CRUD pattern, as described in https://medium.com/robhitchens/solidity-crud-part-1-824ffa69509a, where records can also be retrieved using their index - a monotonically increasing counter.\r\n\r\nAn stub implementation for the TypeStorageContract would look like:\r\n\r\n```\r\nimport './TypeALib.sol';\r\n\r\ncontract TypeAStorage {\r\n    using TypeALib for TypeALib.TypeA;\r\n\r\n    bytes32[] public typeIndex;\r\n    mapping(bytes32 => Type) public typeStruct;\r\n\r\n    struct Type {\r\n        TypeALib.TypeA data;\r\n        uint256 index;\r\n    }\r\n\r\n    event LogNew(bytes32 indexed identifier, uint256 indexed index);\r\n    event LogUpdate(bytes32 indexed identifier, uint256 indexed index);\r\n    event LogRemove(bytes32 indexed identifier, uint256 indexed index);\r\n\r\n    function insert(TypeALib.TypeA memory data) public returns (bytes32 identifier);\r\n\r\n    function insertBytes(bytes memory data) public returns (bytes32 identifier);\r\n\r\n    function remove(bytes32 identifier) public returns(uint256 index);\r\n\r\n    function update(bytes32 identifier, TypeALib.TypeA memory data) public returns(bytes32 identifier)\r\n\r\n    function isStored(bytes32 identifier) public view returns(bool stored);\r\n\r\n    function getByHash(bytes32 identifier) public view returns(TypeALib.TypeA memory data);\r\n\r\n    function getByIndex(uint256 index) public view returns(TypeALib.TypeA memory data);\r\n\r\n    function count() public view returns(uint256 counter);\r\n}\r\n```\r\n\r\n## Rationale\r\n\r\nWe are now thinking about a building block as a smart contract with an encapsulated object that contains state changing functions that are only understood from within. This is more akin to Object-Oriented Programming and poses interoperability and scalability issues. Not necessarily for an individual project, but for a global Ethereum OS. This is why we are proposing to separate data from business logic and data structure definitions.\r\n\r\nWhen you have public aggregated data, categorized on each type, anyone can build tools on top of it. This is a radical change from the closed or dispersed data patterns that we find in web2.\r\n\r\nWe have chosen to define a `TypeRootContract` instead of extending the dType registry with fields for the TypeStorage contract, because this approach enables easier interface updates in the future. It is more extensible.\r\n\r\nThe storage pattern used for dType itself and all the Type Storage contracts can be the same. This lowers the cost of building, testing and auditing the code.\r\n\r\nThe `TypeStorageContract` pattern should ensure:\r\n- type instance addressability by the primary identifier\r\n- a way to retrieve all records from the contract\r\n- counting the number of records\r\n\r\n\r\n## Backwards Compatibility\r\n\r\nThis proposal does not affect extant Ethereum standards or implementations. It uses the present experimental version of ABIEncoderV2.\r\n\r\n## Test Cases\r\n\r\nWill be added.\r\n\r\n## Implementation\r\n\r\nAn in-work implementation can be found at https://github.com/pipeos-one/dType/tree/master/contracts/contracts.\r\nThis proposal will be updated with an appropriate implementation when consensus is reached on the specifications.\r\n\r\n\r\n## Copyright\r\nCopyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).\r\n",
  "closed_by": {
    "login": "github-actions[bot]",
    "id": 41898282,
    "node_id": "MDM6Qm90NDE4OTgyODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/github-actions%5Bbot%5D",
    "html_url": "https://github.com/apps/github-actions",
    "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/EIPs/issues/2157/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/EIPs/issues/2157/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/EIPs/issues/comments/974705383",
    "html_url": "https://github.com/ethereum/EIPs/issues/2157#issuecomment-974705383",
    "issue_url": "https://api.github.com/repos/ethereum/EIPs/issues/2157",
    "id": 974705383,
    "node_id": "IC_kwDOAq426M46GNLn",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2021-11-20T20:11:50Z",
    "updated_at": "2021-11-20T20:11:50Z",
    "author_association": "NONE",
    "body": "There has been no activity on this issue for two months. It will be closed in a week if no further activity occurs. If you would like to move this EIP forward, please respond to any outstanding feedback or add a comment indicating that you have addressed all required feedback and are ready for a review.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/EIPs/issues/comments/974705383/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/EIPs/issues/comments/986086330",
    "html_url": "https://github.com/ethereum/EIPs/issues/2157#issuecomment-986086330",
    "issue_url": "https://api.github.com/repos/ethereum/EIPs/issues/2157",
    "id": 986086330,
    "node_id": "IC_kwDOAq426M46xnu6",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2021-12-04T20:12:19Z",
    "updated_at": "2021-12-04T20:12:19Z",
    "author_association": "NONE",
    "body": "This issue was closed due to inactivity. If you are still pursuing it, feel free to reopen it and respond to any feedback or request a review in a comment.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/EIPs/issues/comments/986086330/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
