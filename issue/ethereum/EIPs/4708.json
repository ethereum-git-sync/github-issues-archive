{
  "url": "https://api.github.com/repos/ethereum/EIPs/issues/4708",
  "repository_url": "https://api.github.com/repos/ethereum/EIPs",
  "labels_url": "https://api.github.com/repos/ethereum/EIPs/issues/4708/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/EIPs/issues/4708/comments",
  "events_url": "https://api.github.com/repos/ethereum/EIPs/issues/4708/events",
  "html_url": "https://github.com/ethereum/EIPs/issues/4708",
  "id": 1109762576,
  "node_id": "I_kwDOAq426M5CJaIQ",
  "number": 4708,
  "title": "Using EIP-3009 with web3.js in a react-native app,",
  "user": {
    "login": "omidziaee",
    "id": 12073782,
    "node_id": "MDQ6VXNlcjEyMDczNzgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/12073782?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/omidziaee",
    "html_url": "https://github.com/omidziaee",
    "followers_url": "https://api.github.com/users/omidziaee/followers",
    "following_url": "https://api.github.com/users/omidziaee/following{/other_user}",
    "gists_url": "https://api.github.com/users/omidziaee/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/omidziaee/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/omidziaee/subscriptions",
    "organizations_url": "https://api.github.com/users/omidziaee/orgs",
    "repos_url": "https://api.github.com/users/omidziaee/repos",
    "events_url": "https://api.github.com/users/omidziaee/events{/privacy}",
    "received_events_url": "https://api.github.com/users/omidziaee/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-01-20T21:02:01Z",
  "updated_at": "2022-07-18T18:09:32Z",
  "closed_at": "2022-01-23T03:50:31Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "We are trying to use EIP-3009 in our application. First step we follow the web3 part in https://github.com/ethereum/EIPs/issues/3010\r\nFollowing is the selected part of our code:\r\n\r\n```\r\nconst nonce = web3.utils.randomHex(32);\r\n        const data = {\r\n            types: {\r\n              EIP712Domain: [\r\n                { name: \"name\", type: \"string\" },\r\n                { name: \"version\", type: \"string\" },\r\n                { name: \"chainId\", type: \"uint256\" },\r\n                { name: \"verifyingContract\", type: \"address\" },\r\n              ],\r\n              TransferWithAuthorization: [\r\n                { name: \"from\", type: \"address\" },\r\n                { name: \"to\", type: \"address\" },\r\n                { name: \"value\", type: \"uint256\" },\r\n                { name: \"validAfter\", type: \"uint256\" },\r\n                { name: \"validBefore\", type: \"uint256\" },\r\n                { name: \"nonce\", type: \"bytes32\" },\r\n              ],\r\n            },\r\n            domain: {\r\n              name: \"Coin Test\",\r\n              version: \"1\",\r\n              chainId: \"3\",\r\n              verifyingContract: \"0xd73ce105814e.......76\",\r\n            },const nonce = web3.utils.randomHex(32);\r\n        const data = {\r\n            types: {\r\n              EIP712Domain: [\r\n                { name: \"name\", type: \"string\" },\r\n                { name: \"version\", type: \"string\" },\r\n                { name: \"chainId\", type: \"uint256\" },\r\n                { name: \"verifyingContract\", type: \"address\" },\r\n              ],\r\n              TransferWithAuthorization: [\r\n                { name: \"from\", type: \"address\" },\r\n                { name: \"to\", type: \"address\" },\r\n                { name: \"value\", type: \"uint256\" },\r\n                { name: \"validAfter\", type: \"uint256\" },\r\n                { name: \"validBefore\", type: \"uint256\" },\r\n                { name: \"nonce\", type: \"bytes32\" },\r\n              ],\r\n            },\r\n            domain: {\r\n              name: \"Things Coin Test\",\r\n              version: \"1\",\r\n              chainId: \"3\",\r\n              verifyingContract: \"0xd73ce105.....Be76\",\r\n            },\r\n            primaryType: \"transferWithAuthorization\",\r\n            message: {\r\n              from: this.state.senderAddress,\r\n              to: this.state.receiverAddress,\r\n              value: 100,\r\n              validAfter: 0,\r\n              validBefore: Math.floor(Date.now() / 1000) + 3600, // Valid for an hour\r\n              nonce: nonce,\r\n            },\r\n          };\r\n          const signedMessage = web3.eth.accounts.sign(data, this.state.privateKey)\r\n            primaryType: \"transferWithAuthorization\",\r\n            message: {\r\n              from: this.state.senderAddress,\r\n              to: this.state.receiverAddress,\r\n              value: 100,\r\n              validAfter: 0,\r\n              validBefore: Math.floor(Date.now() / 1000) + 3600, // Valid for an hour\r\n              nonce: nonce,\r\n            },\r\n          };\r\n          const signedMessage = web3.eth.accounts.sign(data, this.state.privateKey)\r\n```\r\n\r\nFollowing that we use a transaction object and signed it to send to Infura. The walletAddress is the address of the third person who is paying the transaction fee in ether. senderAddress is the address of the person who is sending the erc20 but does not have any ether to pay the fee.\r\n\r\n```\r\nconst rawTransaction = ({\r\n            from: walletAddress,\r\n            to: contractAddress,\r\n            value: web3.utils.toHex('0'),\r\n            gasprice: web3.utils.toHex('1000'),\r\n            gas: web3.utils.toHex(\"100000\"),\r\n            data: TNGContract.methods.transferWithAuthorization(\r\n                this.state.senderAddress,\r\n                this.state.receiverAddress,\r\n                100,\r\n                0,\r\n                MAX_UINT256,\r\n                nonce,\r\n                signedMessage.v,\r\n                signedMessage.r,\r\n                signedMessage.s, \r\n              ).encodeABI(),\r\n        });\r\n        console.log('-----------rawTransaction: ' + JSON.stringify(rawTransaction))\r\n        web3.eth.accounts.signTransaction(rawTransaction, privateKey)\r\n            .then((signedTransaction) => {\r\n                console.log('.-----signedTransaction: ' + JSON.stringify(signedTransaction))\r\n                web3.eth.sendSignedTransaction(signedTransaction.rawTransaction).then((receipt)=>{\r\n                    console.log('.-----receipt: ' + JSON.stringify(receipt))\r\n                }).catch(err => {console.log(\"the error is----- \" + err)})\r\n            }).catch((e) => console.log(\"the error is: \" + e));\r\n```\r\n\r\nProblem is we are getting \"Fail with error 'EIP3009: invalid signature'\" each time we are sending the transaction. Any help is appricaited.",
  "closed_by": {
    "login": "MicahZoltu",
    "id": 886059,
    "node_id": "MDQ6VXNlcjg4NjA1OQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/886059?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MicahZoltu",
    "html_url": "https://github.com/MicahZoltu",
    "followers_url": "https://api.github.com/users/MicahZoltu/followers",
    "following_url": "https://api.github.com/users/MicahZoltu/following{/other_user}",
    "gists_url": "https://api.github.com/users/MicahZoltu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MicahZoltu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MicahZoltu/subscriptions",
    "organizations_url": "https://api.github.com/users/MicahZoltu/orgs",
    "repos_url": "https://api.github.com/users/MicahZoltu/repos",
    "events_url": "https://api.github.com/users/MicahZoltu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MicahZoltu/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/EIPs/issues/4708/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/EIPs/issues/4708/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/EIPs/issues/comments/1019408604",
    "html_url": "https://github.com/ethereum/EIPs/issues/4708#issuecomment-1019408604",
    "issue_url": "https://api.github.com/repos/ethereum/EIPs/issues/4708",
    "id": 1019408604,
    "node_id": "IC_kwDOAq426M48wvDc",
    "user": {
      "login": "MicahZoltu",
      "id": 886059,
      "node_id": "MDQ6VXNlcjg4NjA1OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886059?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MicahZoltu",
      "html_url": "https://github.com/MicahZoltu",
      "followers_url": "https://api.github.com/users/MicahZoltu/followers",
      "following_url": "https://api.github.com/users/MicahZoltu/following{/other_user}",
      "gists_url": "https://api.github.com/users/MicahZoltu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MicahZoltu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MicahZoltu/subscriptions",
      "organizations_url": "https://api.github.com/users/MicahZoltu/orgs",
      "repos_url": "https://api.github.com/users/MicahZoltu/repos",
      "events_url": "https://api.github.com/users/MicahZoltu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MicahZoltu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-23T03:50:31Z",
    "updated_at": "2022-01-23T03:50:31Z",
    "author_association": "MEMBER",
    "body": "[EIP-3009](https://eips.ethereum.org/EIPS/eip-3009) is not a final standard, it was a proposal for a standard that never was finished.  You are free to implement whatever you want, but at the moment there is no EIP-3009 standard.\r\n\r\nIf you want to discuss revitalizing it, please use the `discussions-to` link at the top of the EIP.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/EIPs/issues/comments/1019408604/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
