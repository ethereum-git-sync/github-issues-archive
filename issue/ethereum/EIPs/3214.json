{
  "url": "https://api.github.com/repos/ethereum/EIPs/issues/3214",
  "repository_url": "https://api.github.com/repos/ethereum/EIPs",
  "labels_url": "https://api.github.com/repos/ethereum/EIPs/issues/3214/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/EIPs/issues/3214/comments",
  "events_url": "https://api.github.com/repos/ethereum/EIPs/issues/3214/events",
  "html_url": "https://github.com/ethereum/EIPs/issues/3214",
  "id": 791698681,
  "node_id": "MDU6SXNzdWU3OTE2OTg2ODE=",
  "number": 3214,
  "title": "ERC20 Extending: token with fee on transfer",
  "user": {
    "login": "ducquangkstn",
    "id": 18111512,
    "node_id": "MDQ6VXNlcjE4MTExNTEy",
    "avatar_url": "https://avatars.githubusercontent.com/u/18111512?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ducquangkstn",
    "html_url": "https://github.com/ducquangkstn",
    "followers_url": "https://api.github.com/users/ducquangkstn/followers",
    "following_url": "https://api.github.com/users/ducquangkstn/following{/other_user}",
    "gists_url": "https://api.github.com/users/ducquangkstn/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ducquangkstn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ducquangkstn/subscriptions",
    "organizations_url": "https://api.github.com/users/ducquangkstn/orgs",
    "repos_url": "https://api.github.com/users/ducquangkstn/repos",
    "events_url": "https://api.github.com/users/ducquangkstn/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ducquangkstn/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2328627851,
      "node_id": "MDU6TGFiZWwyMzI4NjI3ODUx",
      "url": "https://api.github.com/repos/ethereum/EIPs/labels/stale",
      "name": "stale",
      "color": "000000",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-01-22T04:58:45Z",
  "updated_at": "2021-11-23T06:41:50Z",
  "closed_at": "2021-11-07T02:29:10Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "# Simple Summary\r\nExtending ERC20 interface for tokens with fee on transfer.\r\n# Abstract\r\nThis standard defines new interfaces a token with fee on transfer should implement, while remaining backwards compatible with `ERC20`. This standard adds 2 new transfer methods and 2 view methods. \r\n- Existing transfer methods let the sender specify the source amount being sent. The new transfer methods will allow you to define the amount that will be received by the receiver.\r\n- In addition to that, 2 new interfaces will allow you to check the expected received amount for a specific sent amount and required send amount for a specific receive amount. This will help dApps to return the exact exchange rate.\r\n- Existing tokens with fee demonstrate the need of whitelisting options. This standard should account that matter.\r\n- The standard will also discuss the behavior of `balanceOf` API for a token with fees.\r\n# Motivation\r\nSome tokens in the Ethereum ecosystem apply transfer fees, such as **DGX** and **CGT**. The **USDT** token also has the fee feature which is disabled at the time of writing.\r\nThese tokens implement the typical `ERC20` interface. However, when calling the `transfer` and `transferFrom` methods, the actual amount the receiver will get will be smaller than the sent amount.\r\n```\r\nfunction transfer(address _to, uint256 _value) external returns (bool success);\r\nfunction transferFrom(address _from, address _to, uint256 _value) external returns (bool success);\r\n```\r\n- This leads to incompatibility with many DeFi services that expect the received amount to be equal to the sent amount. \r\n- Some DeFi projects have adapted by calculating the amount difference after the transfer, but this comes at the expense of higher gas usage and the returned rate is not accurate.\r\n- In most cases, the balance of receiver will increase smaller than `_value` params (fee is included in the _value). The other type, the balance of sender will reduce bigger than `_value` params (fee is excluded in the _value). This also make harder for developer to handle all the cases.\r\n\r\nThis standard aims to create a more uniform and elegant way to handle tokens with fees.\r\n\r\n# Specification\r\n```solidity\r\ninterface IERCxxx is IERC20 {\r\nfunction transferExactDest(address _to, uint _value) external returns (bool success);\r\nfunction transferExactDestFrom(address _from, address _to, uint _value) external returns (bool success);\r\nfunction getReceivedAmount(address _from, address _to, uint _sentAmount) external view returns (uint receivedAmount, uint feeAmount);\r\nfunction getSendAmount(address _from, address _to, uint _receivedAmount) external view returns (uint sendAmount, uint feeAmount);\r\n}\r\n```\r\n### transferExactDest\r\nTransfers `_value` amount of token to address `_to` and **MUST** emit the `Transfer` event. The balance of `msg.sender` will be deducted by `_value + _fee`. Add `_value` amount to the balance of the receiver. \r\nIf zero fees should be applied due to whitelisting, assume the above `_fee` to be zero. \r\n```solidity\r\nfunction transferExactDest(address _to, uint _value) external returns (bool success);\r\n```\r\n### transferFromExactDest\r\nTransfers `_value` amount of token to address `_to` and **MUST** fire the `Transfer` event. The balance of `_from` will be deducted by `_value + _fee`. If zero fees should be applied due to whitelisting, assume the above `_fee` value to be zero.\r\n```solidity\r\nfunction transferExactDestFrom(address _from, address _to, uint _value) external returns (bool success);\r\n```\r\n### getReceivedAmount\r\nA query function that returns the amount of tokens a receiver will get if a sender sends  `_sentAmount` tokens. Note the `_to` and `_from` addresses are present, the implementation should use those values to check for any white listing.\r\n```solidity\r\nfunction getReceivedAmount(address _from, address _to, uint _sendAmount) external view returns (uint receivedAmount, uint feeAmount);\r\n```\r\n### getSendAmount\r\nReturns the amount of tokens the sender has to send if he wants the receiver to receive exactly `_receivedAmount` tokens. \r\nNote the `_to` and `_from` addresses are present, the implementation should use those values to check for any white listing.\r\n```solidity\r\nfunction getSendAmount(address _from, address _to, uint _receivedAmount) external view returns (uint sendAmount, uint feeAmount);\r\n```\r\n# Behaviour of existing ERC20 transfer functions\r\nThe signature and behavior of `transfer` and `transferFrom` functions will remain the same. `_value` parameter in those functions will reflect the `_sentAmount` of the token.\r\n### transfer\r\nTransfers `_value` amount of token from msg.sender and **MUST** emit the Transfer event. Will add `_value` to the balance of `_to`, after deducting fee.\r\n```solidity\r\nfunction transfer(address _to, uint256 _value) external returns (bool success);\r\n```\r\n### transferFrom\r\nTransfers `_value` amount of token from `_from` and **MUST** fire the `Transfer` event. Will add `_value` to the balance of `_to`, after deducting fee.\r\n```solidity\r\nfunction transferFrom(address _from, address _to, uint256 _value) external returns (bool success);\r\n```\r\n### balanceOf\r\n\r\nReturns the exact token balance of the account, without fee considerations.\r\n```solidity\r\nfunction balanceOf(address account) external view returns (uint256)\r\n```\r\n### Query user balance after deducting fee\r\nAnother type of problem was encountered with the`balanceOf` function. For **CGT** token, `balanceOf` returns the balance for a user after fee deduction. They try to return a balance after deducting fee for the next transfer.\r\n\r\nThe point is `balanceOfWithFee` actually can be different depending on the transaction sizes. \r\nExample: transfer fee is 1%, max fee is 1 token, user has 10K tokens. If he sends all tokens at once, the actual fee would be 1 token. If he sends tokens in 10 transactions, the actual fee will be 10 tokens. \r\nDue to these reasons, we choose not to add additional any API to return `balanceOfWithFee`.\r\n\r\n# Usage:\r\n- When a user wants to send the exact destination amount to another person, he calls `transferExactDestAmount`.\r\n- When a user wants to deposit a token to a contract or create a swap transaction: the contract calls `transferFromExactDestAmount` to get the exact amount from the user.\r\n- When a DEX returns the exchange rate of a token, contract calls `getReceivedAmount` to get the received amount to contract, then calculate the amountOut.\r\n# Test Cases\r\nThis [repository](https://github.com/ducquangkstn/fee-on-transfer-erc20) contains all the tests.\r\n# Implementations\r\nT.B.D\r\n# Copyright\r\nCopyright and related rights waived via CC0.",
  "closed_by": {
    "login": "github-actions[bot]",
    "id": 41898282,
    "node_id": "MDM6Qm90NDE4OTgyODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/github-actions%5Bbot%5D",
    "html_url": "https://github.com/apps/github-actions",
    "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/EIPs/issues/3214/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/EIPs/issues/3214/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/EIPs/issues/comments/765124380",
    "html_url": "https://github.com/ethereum/EIPs/issues/3214#issuecomment-765124380",
    "issue_url": "https://api.github.com/repos/ethereum/EIPs/issues/3214",
    "id": 765124380,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2NTEyNDM4MA==",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2021-01-22T04:59:22Z",
    "updated_at": "2021-01-22T04:59:22Z",
    "author_association": "NONE",
    "body": "Since this is your first issue, we kindly remind you to check out [EIP-1](https://eips.ethereum.org/EIPS/eip-1) for guidance.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/EIPs/issues/comments/765124380/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/EIPs/issues/comments/950248956",
    "html_url": "https://github.com/ethereum/EIPs/issues/3214#issuecomment-950248956",
    "issue_url": "https://api.github.com/repos/ethereum/EIPs/issues/3214",
    "id": 950248956,
    "node_id": "IC_kwDOAq426M44o6X8",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2021-10-24T02:27:23Z",
    "updated_at": "2021-10-24T02:27:23Z",
    "author_association": "NONE",
    "body": "There has been no activity on this issue for two months. It will be closed in a week if no further activity occurs. If you would like to move this EIP forward, please respond to any outstanding feedback or add a comment indicating that you have addressed all required feedback and are ready for a review.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/EIPs/issues/comments/950248956/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/EIPs/issues/comments/962541428",
    "html_url": "https://github.com/ethereum/EIPs/issues/3214#issuecomment-962541428",
    "issue_url": "https://api.github.com/repos/ethereum/EIPs/issues/3214",
    "id": 962541428,
    "node_id": "IC_kwDOAq426M45Xzd0",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2021-11-07T02:29:10Z",
    "updated_at": "2021-11-07T02:29:10Z",
    "author_association": "NONE",
    "body": "This issue was closed due to inactivity. If you are still pursuing it, feel free to reopen it and respond to any feedback or request a review in a comment.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/EIPs/issues/comments/962541428/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/EIPs/issues/comments/976202561",
    "html_url": "https://github.com/ethereum/EIPs/issues/3214#issuecomment-976202561",
    "issue_url": "https://api.github.com/repos/ethereum/EIPs/issues/3214",
    "id": 976202561,
    "node_id": "IC_kwDOAq426M46L6tB",
    "user": {
      "login": "VyomeshDua",
      "id": 31861510,
      "node_id": "MDQ6VXNlcjMxODYxNTEw",
      "avatar_url": "https://avatars.githubusercontent.com/u/31861510?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/VyomeshDua",
      "html_url": "https://github.com/VyomeshDua",
      "followers_url": "https://api.github.com/users/VyomeshDua/followers",
      "following_url": "https://api.github.com/users/VyomeshDua/following{/other_user}",
      "gists_url": "https://api.github.com/users/VyomeshDua/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/VyomeshDua/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/VyomeshDua/subscriptions",
      "organizations_url": "https://api.github.com/users/VyomeshDua/orgs",
      "repos_url": "https://api.github.com/users/VyomeshDua/repos",
      "events_url": "https://api.github.com/users/VyomeshDua/events{/privacy}",
      "received_events_url": "https://api.github.com/users/VyomeshDua/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-23T06:41:39Z",
    "updated_at": "2021-11-23T06:41:50Z",
    "author_association": "NONE",
    "body": "Great suggestion, but any adoptions for this yet?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/EIPs/issues/comments/976202561/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
