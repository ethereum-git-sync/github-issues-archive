{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/6946",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/6946/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/6946/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/6946/events",
  "html_url": "https://github.com/ethereum/solidity/issues/6946",
  "id": 456632584,
  "node_id": "MDU6SXNzdWU0NTY2MzI1ODQ=",
  "number": 6946,
  "title": "Failed semantic tests have strange \"expected result v.s obtained result\" formatting",
  "user": {
    "login": "sifmelcara",
    "id": 10496191,
    "node_id": "MDQ6VXNlcjEwNDk2MTkx",
    "avatar_url": "https://avatars.githubusercontent.com/u/10496191?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sifmelcara",
    "html_url": "https://github.com/sifmelcara",
    "followers_url": "https://api.github.com/users/sifmelcara/followers",
    "following_url": "https://api.github.com/users/sifmelcara/following{/other_user}",
    "gists_url": "https://api.github.com/users/sifmelcara/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sifmelcara/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sifmelcara/subscriptions",
    "organizations_url": "https://api.github.com/users/sifmelcara/orgs",
    "repos_url": "https://api.github.com/users/sifmelcara/repos",
    "events_url": "https://api.github.com/users/sifmelcara/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sifmelcara/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2019-06-16T11:46:22Z",
  "updated_at": "2019-08-05T14:45:07Z",
  "closed_at": "2019-08-05T14:45:07Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "To reproduce this issue, first intentionally modify a semantic test test case's expected output, for example\r\n```\r\n--- a/test/libsolidity/semanticTests/abiEncoderV2/calldata_array_dynamic_index_access.sol\r\n+++ b/test/libsolidity/semanticTests/abiEncoderV2/calldata_array_dynamic_index_access.sol\r\n@@ -23,7 +23,7 @@ contract C {\r\n // ====\r\n // EVMVersion: >homestead\r\n // ----\r\n-// f(uint256[]): 32, 3, 42, 23, 87 -> 32, 160, 32, 3, 42, 23, 87\r\n+// f(uint256[]): 32, 3, 42, 23, 87 -> 32, 160, 32, 3, 42, 23, 88\r\n // g(uint256[][2],uint256): 0x40, 0, 0x40, 0xC0, 3, 42, 23, 87, 4, 11, 13, 17 -> 32, 160, 32, 3, 42, 23, 87\r\n // g(uint256[][2],uint256): 0x40, 1, 0x40, 0xC0, 3, 42, 23, 87, 4, 11, 13, 17, 27 -> 32, 192, 32, 4, 11, 13, 17, 27\r\n // h(uint8[]): 32, 3, 42, 23, 87 -> 32, 160, 32, 3, 42, 23, 87\r\n```\r\n\r\nThen run the tests:\r\n```\r\n./build/test/soltest -p -- --ipcpath /tmp/testeth/geth.ipc --evm-version byzantium --no-smt --testpath ./test\r\n```\r\n\r\nit outputs\r\n```\r\nerror: in \"semanticTests/abiEncoderV2/calldata_array_dynamic_index_access\": Test expectation mismatch.\r\nExpected result:\r\n// f(uint256[]): 32, 3, 42, 23, 87 -> 32, 160, 32, 3, 42, 23, 88\r\n// g(uint256[][2],uint256): 0x40, 0, 0x40, 0xC0, 3, 42, 23, 87, 4, 11, 13, 17 -> 32, 160, 32, 3, 42, 23, 87\r\n// g(uint256[][2],uint256): 0x40, 1, 0x40, 0xC0, 3, 42, 23, 87, 4, 11, 13, 17, 27 -> 32, 192, 32, 4, 11, 13, 17, 27\r\n// h(uint8[]): 32, 3, 42, 23, 87 -> 32, 160, 32, 3, 42, 23, 87\r\n// i(uint8[][2],uint256): 0x40, 0, 0x40, 0xC0, 3, 42, 23, 87, 4, 11, 13, 17 -> 32, 160, 32, 3, 42, 23, 87\r\n// i(uint8[][2],uint256): 0x40, 1, 0x40, 0xC0, 3, 42, 23, 87, 4, 11, 13, 17, 27 -> 32, 192, 32, 4, 11, 13, 17, 27\r\n// j(bytes): 32, 3, hex\"AB11FF\" -> 32, 96, 32, 3, left(0xAB11FF)\r\n// k(bytes[2],uint256): 0x40, 0, 0x40, 0x63, 3, hex\"AB11FF\", 4, hex\"FF791432\" -> 32, 96, 32, 3, left(0xAB11FF)\r\n// k(bytes[2],uint256): 0x40, 1, 0x40, 0x63, 3, hex\"AB11FF\", 4, hex\"FF791432\" -> 32, 96, 32, 4, left(0xFF791432)\r\n\r\nObtained result:\r\n// f(uint256[]): 32, 3, 42, 23, 87 -> 32, 160, hex\"0000000000000000000000000000000000000000000000000000000000000020\"\r\nWarning: Encoding does not match byte range. The call returned 224 bytes, but 224 bytes were expected.\r\n// g(uint256[][2],uint256): 0x40, 0, 0x40, 0xC0, 3, 42, 23, 87, 4, 11, 13, 17 -> 32, 160, 32, 3, 42, 23, 87\r\n// g(uint256[][2],uint256): 0x40, 1, 0x40, 0xC0, 3, 42, 23, 87, 4, 11, 13, 17, 27 -> 32, 192, 32, 4, 11, 13, 17, 27\r\n// h(uint8[]): 32, 3, 42, 23, 87 -> 32, 160, 32, 3, 42, 23, 87\r\n// i(uint8[][2],uint256): 0x40, 0, 0x40, 0xC0, 3, 42, 23, 87, 4, 11, 13, 17 -> 32, 160, 32, 3, 42, 23, 87\r\n// i(uint8[][2],uint256): 0x40, 1, 0x40, 0xC0, 3, 42, 23, 87, 4, 11, 13, 17, 27 -> 32, 192, 32, 4, 11, 13, 17, 27\r\n// j(bytes): 32, 3, hex\"AB11FF\" -> 32, 96, 32, 3, left(0xAB11FF)\r\n// k(bytes[2],uint256): 0x40, 0, 0x40, 0x63, 3, hex\"AB11FF\", 4, hex\"FF791432\" -> 32, 96, 32, 3, left(0xAB11FF)\r\n// k(bytes[2],uint256): 0x40, 1, 0x40, 0x63, 3, hex\"AB11FF\", 4, hex\"FF791432\" -> 32, 96, 32, 4, left(0xFF791432)\r\n\r\nAttention: Updates on the test will apply the detected format displayed.\r\n\r\n```\r\nI think it does not properly print the actual obtained result?\r\n\r\n\r\nI guess something went wrong in the following function\r\nhttps://github.com/ethereum/solidity/blob/a6cc296cd9b9221df9a203cc9e85cb45f0086756/test/libsolidity/util/TestFunctionCall.h#L143-L154\r\n\r\ncc author of the file @erak , thanks!",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/6946/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/6946/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/508092041",
    "html_url": "https://github.com/ethereum/solidity/issues/6946#issuecomment-508092041",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6946",
    "id": 508092041,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODA5MjA0MQ==",
    "user": {
      "login": "erak",
      "id": 20012009,
      "node_id": "MDQ6VXNlcjIwMDEyMDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/20012009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erak",
      "html_url": "https://github.com/erak",
      "followers_url": "https://api.github.com/users/erak/followers",
      "following_url": "https://api.github.com/users/erak/following{/other_user}",
      "gists_url": "https://api.github.com/users/erak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erak/subscriptions",
      "organizations_url": "https://api.github.com/users/erak/orgs",
      "repos_url": "https://api.github.com/users/erak/repos",
      "events_url": "https://api.github.com/users/erak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-03T13:26:04Z",
    "updated_at": "2019-07-03T13:26:04Z",
    "author_association": "COLLABORATOR",
    "body": "Thanks for the report. I can reproduce this issue and it seems to be related to a feature that was not fully implemented yet: When there's a mismatch in the expected and the actual result, the contract ABI is consulted in order to retrieve the correct type for that particular return value. This mechanism is not handling all types at the moment, which results in this issue. \r\n\r\nWe're working on it and we'll also write up a proper documentation after.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/508092041/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/508123917",
    "html_url": "https://github.com/ethereum/solidity/issues/6946#issuecomment-508123917",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6946",
    "id": 508123917,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODEyMzkxNw==",
    "user": {
      "login": "sifmelcara",
      "id": 10496191,
      "node_id": "MDQ6VXNlcjEwNDk2MTkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/10496191?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sifmelcara",
      "html_url": "https://github.com/sifmelcara",
      "followers_url": "https://api.github.com/users/sifmelcara/followers",
      "following_url": "https://api.github.com/users/sifmelcara/following{/other_user}",
      "gists_url": "https://api.github.com/users/sifmelcara/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sifmelcara/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sifmelcara/subscriptions",
      "organizations_url": "https://api.github.com/users/sifmelcara/orgs",
      "repos_url": "https://api.github.com/users/sifmelcara/repos",
      "events_url": "https://api.github.com/users/sifmelcara/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sifmelcara/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-03T14:43:48Z",
    "updated_at": "2019-07-03T14:43:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "> the contract ABI is consulted in order to retrieve the correct type for that particular return value\r\n\r\nCould you elaborate the reason why test suite need to know the type of encoded data? Is this for pretty-print purpose?\r\n\r\nThanks!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/508123917/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/508139201",
    "html_url": "https://github.com/ethereum/solidity/issues/6946#issuecomment-508139201",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6946",
    "id": 508139201,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODEzOTIwMQ==",
    "user": {
      "login": "erak",
      "id": 20012009,
      "node_id": "MDQ6VXNlcjIwMDEyMDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/20012009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erak",
      "html_url": "https://github.com/erak",
      "followers_url": "https://api.github.com/users/erak/followers",
      "following_url": "https://api.github.com/users/erak/following{/other_user}",
      "gists_url": "https://api.github.com/users/erak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erak/subscriptions",
      "organizations_url": "https://api.github.com/users/erak/orgs",
      "repos_url": "https://api.github.com/users/erak/repos",
      "events_url": "https://api.github.com/users/erak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-03T15:20:39Z",
    "updated_at": "2019-07-03T15:20:39Z",
    "author_association": "COLLABORATOR",
    "body": "Sure! The purpose is to help developers to interactively update their semantic tests during development using one of our tools called `isoltest`. It provides an auto-update routine which can correct the expectations (e.g. in the case you've mentioned). And in order to provide \"human-readable\" formats of values passed to or returned by a call to the contract, the ABI is consulted to provide the type information needed to do this formatting.\r\n\r\nThis is very helpful if a change in the compiler needs a lot of semantic tests to be updated manually, or if you're developing a feature in test-driven manner or simply to correct typos you made. Does this answer your question? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/508139201/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/508146282",
    "html_url": "https://github.com/ethereum/solidity/issues/6946#issuecomment-508146282",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6946",
    "id": 508146282,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODE0NjI4Mg==",
    "user": {
      "login": "sifmelcara",
      "id": 10496191,
      "node_id": "MDQ6VXNlcjEwNDk2MTkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/10496191?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sifmelcara",
      "html_url": "https://github.com/sifmelcara",
      "followers_url": "https://api.github.com/users/sifmelcara/followers",
      "following_url": "https://api.github.com/users/sifmelcara/following{/other_user}",
      "gists_url": "https://api.github.com/users/sifmelcara/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sifmelcara/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sifmelcara/subscriptions",
      "organizations_url": "https://api.github.com/users/sifmelcara/orgs",
      "repos_url": "https://api.github.com/users/sifmelcara/repos",
      "events_url": "https://api.github.com/users/sifmelcara/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sifmelcara/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-03T15:38:37Z",
    "updated_at": "2019-07-03T15:38:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yes, thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/508146282/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
