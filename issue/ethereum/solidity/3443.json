{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/3443",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/3443/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/3443/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/3443/events",
  "html_url": "https://github.com/ethereum/solidity/issues/3443",
  "id": 292221956,
  "node_id": "MDU6SXNzdWUyOTIyMjE5NTY=",
  "number": 3443,
  "title": "Add 'deprecated' keyword for preserving storage layout",
  "user": {
    "login": "mossid",
    "id": 18329646,
    "node_id": "MDQ6VXNlcjE4MzI5NjQ2",
    "avatar_url": "https://avatars.githubusercontent.com/u/18329646?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mossid",
    "html_url": "https://github.com/mossid",
    "followers_url": "https://api.github.com/users/mossid/followers",
    "following_url": "https://api.github.com/users/mossid/following{/other_user}",
    "gists_url": "https://api.github.com/users/mossid/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mossid/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mossid/subscriptions",
    "organizations_url": "https://api.github.com/users/mossid/orgs",
    "repos_url": "https://api.github.com/users/mossid/repos",
    "events_url": "https://api.github.com/users/mossid/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mossid/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2018-01-28T17:27:25Z",
  "updated_at": "2018-03-12T10:36:46Z",
  "closed_at": "2018-03-12T10:36:46Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "While upgrading contract is available now using proxy contracts, removing storage variable makes the storage layout different from before the upgrade. \r\n\r\n```\r\ncontract C {\r\n  uint version;\r\n  uint maximumIndex;\r\n  uint currentIndex;\r\n}\r\n```\r\nThe position of `currentIndex` is at `keccak256(uint256(2))`;\r\n\r\nAfter we upgrade it to the following:\r\n\r\n```\r\ncontract C {\r\n  uint version;\r\n  // variable `maximumIndex` is removed for some reason\r\n  uint currentIndex;\r\n  bool isAppendable;\r\n}\r\n```\r\nThe position of `currentIndex` is now at `keccak256(uint256(1))`, which leads us to referring wrong position (which used by `maximumIndex`).\r\n\r\nTo preserve memory index, we can add `deprecated` keyword.\r\n\r\n```\r\ncontract C {\r\n  uint version;\r\n  uint deprecated maximumIndex;\r\n  uint currentIndex;\r\n  bool isAppendable;\r\n}\r\n```\r\n\r\nThe compiler will show an error if any deprecated variables are used in the code but on an actual compilation, the compiler will allocate space for them just like as normal, making it backward-compatible.",
  "closed_by": {
    "login": "mossid",
    "id": 18329646,
    "node_id": "MDQ6VXNlcjE4MzI5NjQ2",
    "avatar_url": "https://avatars.githubusercontent.com/u/18329646?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mossid",
    "html_url": "https://github.com/mossid",
    "followers_url": "https://api.github.com/users/mossid/followers",
    "following_url": "https://api.github.com/users/mossid/following{/other_user}",
    "gists_url": "https://api.github.com/users/mossid/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mossid/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mossid/subscriptions",
    "organizations_url": "https://api.github.com/users/mossid/orgs",
    "repos_url": "https://api.github.com/users/mossid/repos",
    "events_url": "https://api.github.com/users/mossid/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mossid/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/3443/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/3443/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/361233041",
    "html_url": "https://github.com/ethereum/solidity/issues/3443#issuecomment-361233041",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3443",
    "id": 361233041,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MTIzMzA0MQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-29T12:39:12Z",
    "updated_at": "2018-01-29T12:39:12Z",
    "author_association": "MEMBER",
    "body": "I would say this way of doing it is extremely dangerous. There is no protection that you did not do any other changes. It would probably be better to somehow directly refer to an old version of the contract.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/361233041/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/362107901",
    "html_url": "https://github.com/ethereum/solidity/issues/3443#issuecomment-362107901",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3443",
    "id": 362107901,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MjEwNzkwMQ==",
    "user": {
      "login": "veox",
      "id": 3036030,
      "node_id": "MDQ6VXNlcjMwMzYwMzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3036030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/veox",
      "html_url": "https://github.com/veox",
      "followers_url": "https://api.github.com/users/veox/followers",
      "following_url": "https://api.github.com/users/veox/following{/other_user}",
      "gists_url": "https://api.github.com/users/veox/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/veox/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/veox/subscriptions",
      "organizations_url": "https://api.github.com/users/veox/orgs",
      "repos_url": "https://api.github.com/users/veox/repos",
      "events_url": "https://api.github.com/users/veox/events{/privacy}",
      "received_events_url": "https://api.github.com/users/veox/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-31T23:38:17Z",
    "updated_at": "2018-01-31T23:47:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "One of Solidity's advantages is abstracting away storage layout management. You don't have to worry what goes where, as long as it's confined to the storage of the same contract.\r\n\r\nI think `solc`'s been designed with that assumption (@chriseth - please correct me if needed). EDIT: The assumption being - that the compiler's scope is a single program/contract; and that if interactions with a different contract are to be made, then they will be through a web3-compatible ABI.\r\n\r\nTrying to \"fix\" it like this is asking for trouble... @mossid, may I interest you in LLL instead? :D\r\n\r\nIf not, perhaps you'd want to look at existing approaches to persistent storage for upgradable contracts (aka \"eternal storage\"):\r\n\r\n* [`RocketStorage` by RocketPool](https://medium.com/rocket-pool/upgradable-solidity-contract-design-54789205276d);\r\n* [`UpgradeableTokenStorage` by Zeppelin](https://blog.zeppelinos.org/smart-contract-upgradeability-using-eternal-storage/).\r\n\r\nThis is not exactly about what you're proposing, but I think it's close to what you aim to achieve, and to what in turn led you to opening this issue.\r\n\r\n-----\r\n\r\nEDITs: clarification, typos (many)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/362107901/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
