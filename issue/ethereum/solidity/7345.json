{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/7345",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/7345/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/7345/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/7345/events",
  "html_url": "https://github.com/ethereum/solidity/issues/7345",
  "id": 489129164,
  "node_id": "MDU6SXNzdWU0ODkxMjkxNjQ=",
  "number": 7345,
  "title": "[YulOpt] Loop-invariant code motion",
  "user": {
    "login": "sifmelcara",
    "id": 10496191,
    "node_id": "MDQ6VXNlcjEwNDk2MTkx",
    "avatar_url": "https://avatars.githubusercontent.com/u/10496191?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sifmelcara",
    "html_url": "https://github.com/sifmelcara",
    "followers_url": "https://api.github.com/users/sifmelcara/followers",
    "following_url": "https://api.github.com/users/sifmelcara/following{/other_user}",
    "gists_url": "https://api.github.com/users/sifmelcara/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sifmelcara/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sifmelcara/subscriptions",
    "organizations_url": "https://api.github.com/users/sifmelcara/orgs",
    "repos_url": "https://api.github.com/users/sifmelcara/repos",
    "events_url": "https://api.github.com/users/sifmelcara/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sifmelcara/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 12,
  "created_at": "2019-09-04T12:27:57Z",
  "updated_at": "2019-11-28T11:00:20Z",
  "closed_at": "2019-11-28T11:00:20Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Some expressions in loop's body/post block can be moved outside the loop.\r\n\r\nPrerequisites could be Disambiguator, ForLoopConditionIntoBody, ForLoopInitRewriter, and ExpressionSplitter\r\n\r\nThen for each time we encounter a loop in current scope, we check all `VariableDeclaration` inside the loop's body and post block, if the `VariableDeclaration` satisfies the following properties, we can move (hoist) that declaration to current scope (outside the loop).\r\n\r\n1. its `value` is `movable`\r\n2. all identifiers in its `value` have its reaching definition outside the loop.\r\n\r\nIdeally we want to move all movable declarations in a single application of this optimization pass.",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/7345/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/7345/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/527919769",
    "html_url": "https://github.com/ethereum/solidity/issues/7345#issuecomment-527919769",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7345",
    "id": 527919769,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNzkxOTc2OQ==",
    "user": {
      "login": "sifmelcara",
      "id": 10496191,
      "node_id": "MDQ6VXNlcjEwNDk2MTkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/10496191?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sifmelcara",
      "html_url": "https://github.com/sifmelcara",
      "followers_url": "https://api.github.com/users/sifmelcara/followers",
      "following_url": "https://api.github.com/users/sifmelcara/following{/other_user}",
      "gists_url": "https://api.github.com/users/sifmelcara/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sifmelcara/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sifmelcara/subscriptions",
      "organizations_url": "https://api.github.com/users/sifmelcara/orgs",
      "repos_url": "https://api.github.com/users/sifmelcara/repos",
      "events_url": "https://api.github.com/users/sifmelcara/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sifmelcara/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-04T14:13:50Z",
    "updated_at": "2019-09-04T14:13:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "@chriseth  Not sure if existing tools can figure out the locations where a variable are assigned?\r\n\r\nLet's use the following two pieces of code as example\r\n```\r\n{\r\n  let a := calldataload(0)\r\n  let b := calldataload(0x20)\r\n  if gt(a, 0) { b := mul(b, 2) }\r\n  for {let i := 0} 1 { i := add(i, 1) } {\r\n    if gt(add(i, or(b, 64)), 12345) { break }\r\n    mstore(i, 1)\r\n  }\r\n}\r\n```\r\n\r\n```\r\n{\r\n  let a := calldataload(0)\r\n  let b := calldataload(0x20)\r\n  for {let i := 0} 1 { i := add(i, 1) } {\r\n    if gt(add(i, or(b, 64)), 12345) { break }\r\n    mstore(i, 1)\r\n    if gt(a, 0) { b := mul(b, 2) }\r\n  }\r\n}\r\n```\r\n\r\nAfter applying for loop init rewriter and expression splitter, we can start checking which declarations can be moved outside the loop.\r\n\r\nIn the first piece of code, we will find that we can move `let _9 := or(b, 64)` outside the loop, but we cannot do the same in the second piece of code, because `b` could be reassigned in the loop (i.e `let _9 := or(b, 64)` has a reaching definition that is not outside the loop).\r\n\r\nSo what I want is a tool that when I traverse to `let _9 := or(b, 64)`, at least I can know if `b` is always not reassigned in the loop.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/527919769/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/527940367",
    "html_url": "https://github.com/ethereum/solidity/issues/7345#issuecomment-527940367",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7345",
    "id": 527940367,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNzk0MDM2Nw==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-04T14:59:03Z",
    "updated_at": "2019-09-04T14:59:10Z",
    "author_association": "MEMBER",
    "body": "I believe that applying SSA transform and only moving ssa-variables (i.e. variables that are never assigned to - those can be found using the SSAValueTracker) already leads to effective loop-invariant code motion.\r\n\r\nIf you apply SSA to the second code, it will still have `let _6 := or(b, _5)` in the loop body, i.e. it references the non-ssa variable and thus cannot be moved.\r\n\r\nNow take a look at the following code, which is the second code with the conditional assignment to `b` moved to after the loop:\r\n```\r\n{\r\n  let a := calldataload(0)\r\n  let b := calldataload(0x20)\r\n  for {let i := 0} 1 { i := add(i, 1) } {\r\n    if gt(add(i, or(b, 64)), 12345) { break }\r\n    mstore(i, 1)\r\n  }\r\n  if gt(a, 0) { b := mul(b, 2) }\r\n}\r\n```\r\nIf you turn this into SSA, you will see that you get `let _6 := or(b_13, _5)`, where `b_13` is an SSA variable, and thus the statement can be move to before the loop.\r\n\r\nSo I actually think for such simple loop-invariant code motion, our current framework is sufficient.\r\n\r\nIt gets more complicated when it comes to moving more intricate statements like `sload(x)` - which also might have a much bigger benefit. There, you need to check whether the statement is \"movable relative to\" the rest of the loop body. But maybe better to start small :)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/527940367/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/528010286",
    "html_url": "https://github.com/ethereum/solidity/issues/7345#issuecomment-528010286",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7345",
    "id": 528010286,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyODAxMDI4Ng==",
    "user": {
      "login": "sifmelcara",
      "id": 10496191,
      "node_id": "MDQ6VXNlcjEwNDk2MTkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/10496191?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sifmelcara",
      "html_url": "https://github.com/sifmelcara",
      "followers_url": "https://api.github.com/users/sifmelcara/followers",
      "following_url": "https://api.github.com/users/sifmelcara/following{/other_user}",
      "gists_url": "https://api.github.com/users/sifmelcara/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sifmelcara/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sifmelcara/subscriptions",
      "organizations_url": "https://api.github.com/users/sifmelcara/orgs",
      "repos_url": "https://api.github.com/users/sifmelcara/repos",
      "events_url": "https://api.github.com/users/sifmelcara/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sifmelcara/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-04T17:48:02Z",
    "updated_at": "2019-09-04T17:48:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hmm.. maybe I missed something, do you mean that we move the variable declaration whenever its RHS only contains variables that are assigned once?\r\n\r\nIf yes, won't it miss the opportunity to optimize my first piece of code?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/528010286/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/528012798",
    "html_url": "https://github.com/ethereum/solidity/issues/7345#issuecomment-528012798",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7345",
    "id": 528012798,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyODAxMjc5OA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-04T17:54:25Z",
    "updated_at": "2019-09-04T17:54:25Z",
    "author_association": "MEMBER",
    "body": "Why do you think it will not be able to optimize your first piece of code? It is fine to require certain other components of the optimizer to have run, like the SSA transform - that's what they are for.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/528012798/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/528016279",
    "html_url": "https://github.com/ethereum/solidity/issues/7345#issuecomment-528016279",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7345",
    "id": 528016279,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyODAxNjI3OQ==",
    "user": {
      "login": "sifmelcara",
      "id": 10496191,
      "node_id": "MDQ6VXNlcjEwNDk2MTkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/10496191?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sifmelcara",
      "html_url": "https://github.com/sifmelcara",
      "followers_url": "https://api.github.com/users/sifmelcara/followers",
      "following_url": "https://api.github.com/users/sifmelcara/following{/other_user}",
      "gists_url": "https://api.github.com/users/sifmelcara/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sifmelcara/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sifmelcara/subscriptions",
      "organizations_url": "https://api.github.com/users/sifmelcara/orgs",
      "repos_url": "https://api.github.com/users/sifmelcara/repos",
      "events_url": "https://api.github.com/users/sifmelcara/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sifmelcara/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-04T18:02:31Z",
    "updated_at": "2019-09-04T18:02:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "Because if I load the first piece of code into yulopti and apply `xplit` and `ssa transform` I get the following:\r\n\r\n<details>\r\n  <summary>Click to expand</summary>\r\n\r\n```\r\n{\r\n    let _1 := 0\r\n    let a := calldataload(_1)\r\n    let _2 := 0x20\r\n    let b_13 := calldataload(_2)\r\n    let b := b_13\r\n    let _3 := 0\r\n    let _4 := gt(a, _3)\r\n    if _4\r\n    {\r\n        let _5 := 2\r\n        let b_14 := mul(b_13, _5)\r\n        b := b_14\r\n    }\r\n    for {\r\n        let i_15 := 0\r\n        let i := i_15\r\n    }\r\n    1\r\n    {\r\n        let _6 := 1\r\n        let i_16 := add(i, _6)\r\n        i := i_16\r\n    }\r\n    {\r\n        let _7 := 12345\r\n        let _8 := 64\r\n        let _9 := or(b, _8)\r\n        let _10 := add(i, _9)\r\n        let _11 := gt(_10, _7)\r\n        if _11 { break }\r\n        let _12 := 1\r\n        mstore(i, _12)\r\n    }\r\n}\r\n```\r\n\r\n</details>\r\n\r\nI cannot move `let _9 := or(b, _8)` outside the loop because `b` is not a SSA variable",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/528016279/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/528021818",
    "html_url": "https://github.com/ethereum/solidity/issues/7345#issuecomment-528021818",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7345",
    "id": 528021818,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyODAyMTgxOA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-04T18:16:04Z",
    "updated_at": "2019-09-04T18:16:04Z",
    "author_association": "MEMBER",
    "body": "Ah sorry, I thought the first one was not a problem. I think we can solve it by extending the SSA transform: After each joining control flow, statements like `let b_15 := b` are inserted. When this is done, the loop will use `b_15` instead of `b`.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/528021818/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/529330844",
    "html_url": "https://github.com/ethereum/solidity/issues/7345#issuecomment-529330844",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7345",
    "id": 529330844,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTMzMDg0NA==",
    "user": {
      "login": "sifmelcara",
      "id": 10496191,
      "node_id": "MDQ6VXNlcjEwNDk2MTkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/10496191?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sifmelcara",
      "html_url": "https://github.com/sifmelcara",
      "followers_url": "https://api.github.com/users/sifmelcara/followers",
      "following_url": "https://api.github.com/users/sifmelcara/following{/other_user}",
      "gists_url": "https://api.github.com/users/sifmelcara/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sifmelcara/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sifmelcara/subscriptions",
      "organizations_url": "https://api.github.com/users/sifmelcara/orgs",
      "repos_url": "https://api.github.com/users/sifmelcara/repos",
      "events_url": "https://api.github.com/users/sifmelcara/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sifmelcara/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-09T07:13:42Z",
    "updated_at": "2019-09-09T07:13:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "I wonder if we want move `comp()` out of the loop in the following cases?\r\n1.\r\n```\r\n{\r\n  for { let i := 0 } 1 {}\r\n  {\r\n    if cond(i)\r\n    {\r\n      mstore(i, comp())\r\n    }\r\n    i := add(i, 1)\r\n  }\r\n}\r\n```\r\n2. Similar to `1.`, but it is `switch` inside the loop, instead of `if`\r\n\r\nSometimes a branch inside a loop would never be executed, make me wonder if we should only promote computations in the immediate scope of loop body/post block?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/529330844/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/529365051",
    "html_url": "https://github.com/ethereum/solidity/issues/7345#issuecomment-529365051",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7345",
    "id": 529365051,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTM2NTA1MQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-09T08:50:28Z",
    "updated_at": "2019-09-09T08:50:28Z",
    "author_association": "MEMBER",
    "body": "I think we should be rather conservative here and only move statements at the top level in the loop body. Already moving stuff out of loops might \"pessimize\" the code because it could be that the loop is run zero times.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/529365051/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/532695030",
    "html_url": "https://github.com/ethereum/solidity/issues/7345#issuecomment-532695030",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7345",
    "id": 532695030,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMjY5NTAzMA==",
    "user": {
      "login": "sifmelcara",
      "id": 10496191,
      "node_id": "MDQ6VXNlcjEwNDk2MTkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/10496191?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sifmelcara",
      "html_url": "https://github.com/sifmelcara",
      "followers_url": "https://api.github.com/users/sifmelcara/followers",
      "following_url": "https://api.github.com/users/sifmelcara/following{/other_user}",
      "gists_url": "https://api.github.com/users/sifmelcara/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sifmelcara/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sifmelcara/subscriptions",
      "organizations_url": "https://api.github.com/users/sifmelcara/orgs",
      "repos_url": "https://api.github.com/users/sifmelcara/repos",
      "events_url": "https://api.github.com/users/sifmelcara/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sifmelcara/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-18T13:54:00Z",
    "updated_at": "2019-09-18T13:54:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "So I finished the implementation and was writing test cases, and I found that current Rematerializer implementation will move expressions back into the loop which negates the effect of LICM. Maybe Rematerializer should add a rule to not rematerialize value into loop? What do you think?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/532695030/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/532698812",
    "html_url": "https://github.com/ethereum/solidity/issues/7345#issuecomment-532698812",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7345",
    "id": 532698812,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMjY5ODgxMg==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-18T14:02:34Z",
    "updated_at": "2019-09-18T14:02:34Z",
    "author_association": "MEMBER",
    "body": "Can you provide some examples?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/532698812/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/532704126",
    "html_url": "https://github.com/ethereum/solidity/issues/7345#issuecomment-532704126",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7345",
    "id": 532704126,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMjcwNDEyNg==",
    "user": {
      "login": "sifmelcara",
      "id": 10496191,
      "node_id": "MDQ6VXNlcjEwNDk2MTkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/10496191?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sifmelcara",
      "html_url": "https://github.com/sifmelcara",
      "followers_url": "https://api.github.com/users/sifmelcara/followers",
      "following_url": "https://api.github.com/users/sifmelcara/following{/other_user}",
      "gists_url": "https://api.github.com/users/sifmelcara/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sifmelcara/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sifmelcara/subscriptions",
      "organizations_url": "https://api.github.com/users/sifmelcara/orgs",
      "repos_url": "https://api.github.com/users/sifmelcara/repos",
      "events_url": "https://api.github.com/users/sifmelcara/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sifmelcara/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-18T14:14:31Z",
    "updated_at": "2019-09-18T14:14:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "```\r\n{\r\n  let b := calldataload(0x20)\r\n  for { } 1 { } {\r\n    if gt(b, 123) { break }\r\n  }\r\n}\r\n```\r\n-> loop init rewriter, expression splitter, ssa transformer ->\r\n```\r\n{\r\n    let _1 := 0x20\r\n    let b := calldataload(_1)\r\n    for { } 1 { }\r\n    {\r\n        let _2 := 123\r\n        let _3 := gt(b, _2)\r\n        if _3 { break }\r\n    }\r\n}\r\n```\r\n-> loop invariant code motion ->\r\n```\r\n{\r\n    let _1 := 0x20\r\n    let b := calldataload(_1)\r\n    let _2 := 123\r\n    let _3 := gt(b, _2)\r\n    for { } 1 { }\r\n    { if _3 { break } }\r\n}\r\n```\r\n-> expression joiner ->\r\n```\r\n{\r\n    let b := calldataload(0x20)\r\n    let _3 := gt(b, 123)\r\n    for { } 1 { }\r\n    { if _3 { break } }\r\n}\r\n```\r\n(current state is good, as we successfully moved the expansive computation (`gt`) out of the loop)\r\n-> rematerializer ->\r\n```\r\n{\r\n    let b := calldataload(0x20)\r\n    let _3 := gt(calldataload(0x20), 123)\r\n    for { } 1 { }\r\n    {\r\n        if gt(calldataload(0x20), 123) { break }\r\n    }\r\n}\r\n```\r\n(`gt` moved back into the loop by rematerializer, which is not desired)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/532704126/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/532761144",
    "html_url": "https://github.com/ethereum/solidity/issues/7345#issuecomment-532761144",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7345",
    "id": 532761144,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMjc2MTE0NA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-18T16:24:51Z",
    "updated_at": "2019-09-18T16:24:51Z",
    "author_association": "MEMBER",
    "body": "Ah, right, I did not remember the full rules of the rematerializer. We could tune it such that when inside a loop, the `refs <= 1` alternative is not valid, i.e.:\r\n\r\n```\r\nif ((refs <= 1 && !m_insideLoop) || cost == 0 || (refs <= 5 && cost <= 1) || m_varsToAlwaysRematerialize.count(name))\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/532761144/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
