{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/11068",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/11068/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/11068/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/11068/events",
  "html_url": "https://github.com/ethereum/solidity/issues/11068",
  "id": 825308611,
  "node_id": "MDU6SXNzdWU4MjUzMDg2MTE=",
  "number": 11068,
  "title": "Error in Yul source map (missing values in first instruction)",
  "user": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2021-03-09T04:40:04Z",
  "updated_at": "2021-07-06T16:05:55Z",
  "closed_at": "2021-07-06T16:05:55Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nI've found a problem where I get an incorrect constructor source map when compiling Yul.  I haven't really tried different things here to determine what conditions cause this; I'm just going to report this as I found it.  The contract I tried compiling can be found below in the reproduction steps.\r\n\r\nOn compiling it I got the following constructor source map: `:::-:0;136:4:0;;110:1;101:40;156:4;153:1;146:15;59:106`.  This is mostly correct, but the beginning has a problem.  The very first instruction is `:::-:0`.  This has no start, no length, and no file index.  Now we can interpret these missing values as zero, but the result is still wrong.  The actual first instruction of the constructor bytecode is a `PUSH1 0x0a`, which corresponds to the `datasize(\"runtime\")` call in `let size := datasize(\"runtime\")`.  The source map ought to have that call as the first instruction.  Instead it has... nothing?\r\n\r\nThe deployed source map by contrast seems fine.\r\n\r\nAnyway, sorry for not doing more testing to try to figure out what conditions cause this, but I don't really have the time at the moment, so I figured I'd just report this as it is.  This should be easily reproducible so hopefully it's not too hard to figure out what's going on here.\r\n\r\n(Remark: If there were an AST, which of course there isn't at the moment (#11043), this error in the source map would keep Truffle Debugger from being able to inspect the `size` variable.  Of course as it is it can't do that anyway because there's no AST.)\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.8.2\r\n- Target EVM version (as per compiler settings): default\r\n\r\n## Steps to Reproduce\r\n\r\nCompile as Yul:\r\n\r\n```yul\r\n//SPDX-License-Identifier: MIT\r\n\r\nobject \"YulTest2\" {\r\n  code {\r\n    let size := datasize(\"runtime\")\r\n    datacopy(0, dataoffset(\"runtime\"), size)\r\n    return(0, size)\r\n  }\r\n  object \"runtime\" {\r\n    code {\r\n      mstore(0, 1)\r\n      return(0, 0x20)\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nObserve the source map for the constructor bytecode.",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/11068/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/11068/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
