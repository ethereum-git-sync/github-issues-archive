{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/14472",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/14472/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/14472/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/14472/events",
  "html_url": "https://github.com/ethereum/solidity/issues/14472",
  "id": 1838219470,
  "node_id": "I_kwDOAm_5kc5tkQDO",
  "number": 14472,
  "title": "Optimizer failed to remove statement always true",
  "user": {
    "login": "hpumengzhao",
    "id": 36286293,
    "node_id": "MDQ6VXNlcjM2Mjg2Mjkz",
    "avatar_url": "https://avatars.githubusercontent.com/u/36286293?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hpumengzhao",
    "html_url": "https://github.com/hpumengzhao",
    "followers_url": "https://api.github.com/users/hpumengzhao/followers",
    "following_url": "https://api.github.com/users/hpumengzhao/following{/other_user}",
    "gists_url": "https://api.github.com/users/hpumengzhao/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hpumengzhao/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hpumengzhao/subscriptions",
    "organizations_url": "https://api.github.com/users/hpumengzhao/orgs",
    "repos_url": "https://api.github.com/users/hpumengzhao/repos",
    "events_url": "https://api.github.com/users/hpumengzhao/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hpumengzhao/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-08-06T13:57:07Z",
  "updated_at": "2023-08-08T05:53:47Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "\r\n## Description\r\n\r\nFor the following contract\r\n```solidity\r\npragma solidity ^0.8.0;\r\n\r\ncontract ComplexProgram {\r\n    uint256 public globalVariable;\r\n    struct MyStruct {\r\n        uint256 value;\r\n        bool flag;\r\n    }\r\n    function complexFunction() public view{\r\n            MyStruct memory myStruct;\r\n            myStruct.flag = true;\r\n            uint256 x = 1;\r\n            require(globalVariable != 0, \"Global variable cannot be zero\");\r\n            assert(myStruct.flag == true);//failed to optimize\r\n            assert(x == 1);\r\n    }\r\n}\r\n```\r\nThe IR optimizer failed to remove ``assert(myStruct.flag == true);``.\r\nBut if i move the statement to the before of ``require(globalVariable != 0, \"Global variable cannot be zero\");``. \r\nIt can be optimized.\r\n```solidity\r\npragma solidity ^0.8.0;\r\n\r\ncontract ComplexProgram {\r\n    uint256 public globalVariable;\r\n    struct MyStruct {\r\n        uint256 value;\r\n        bool flag;\r\n    }\r\n    function complexFunction() public view{\r\n            MyStruct memory myStruct;\r\n            myStruct.flag = true;\r\n            uint256 x = 1;\r\n            assert(myStruct.flag == true);//can be optimized\r\n            require(globalVariable != 0, \"Global variable cannot be zero\");\r\n            assert(x == 1);\r\n    }\r\n}\r\n```\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.8.19\r\n- Framework/IDE (e.g. Truffle or Remix): Remix\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/14472/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/14472/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1666965558",
    "html_url": "https://github.com/ethereum/solidity/issues/14472#issuecomment-1666965558",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14472",
    "id": 1666965558,
    "node_id": "IC_kwDOAm_5kc5jW-A2",
    "user": {
      "login": "gkirat",
      "id": 103166972,
      "node_id": "U_kgDOBiYz_A",
      "avatar_url": "https://avatars.githubusercontent.com/u/103166972?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gkirat",
      "html_url": "https://github.com/gkirat",
      "followers_url": "https://api.github.com/users/gkirat/followers",
      "following_url": "https://api.github.com/users/gkirat/following{/other_user}",
      "gists_url": "https://api.github.com/users/gkirat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gkirat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gkirat/subscriptions",
      "organizations_url": "https://api.github.com/users/gkirat/orgs",
      "repos_url": "https://api.github.com/users/gkirat/repos",
      "events_url": "https://api.github.com/users/gkirat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gkirat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-06T20:54:02Z",
    "updated_at": "2023-08-08T05:53:47Z",
    "author_association": "NONE",
    "body": "The reason why you aren't able to go ahead with code is because of the require statement, You see that in your require statement it is necessary to assign global variable a non zero number because initially in solidity the default value of uint  data type is \"0\".\r\n\r\nSo this can be solved by 4 ways \r\n\r\n### 1. Assign value to globalVariable inside function before the require statement so when the function runs it assigns the value to state variable \"globalVariable\" and then read require statement \r\n\r\n\r\n\r\n```solidity\r\n\r\n/ / SPDX-License-Identifier: MIT\r\n pragma solidity ^0.8.0;\r\n\r\ncontract ComplexProgram {\r\n    uint256 public globalVariable;\r\n    struct MyStruct {\r\n        uint256 value;\r\n        bool flag;\r\n    }\r\n\r\n    function complexFunction1() public {\r\n        MyStruct memory myStruct;\r\n        myStruct.flag = true;\r\n        uint256 x = 1;\r\n\r\n        // Set globalVariable to a non-zero value before the require statement\r\n        globalVariable = 1; // Or any other non-zero number\r\n\r\n        // Perform assertions\r\n        assert(myStruct.flag == true);\r\n        require(globalVariable != 0, \"Global variable cannot be zero\");\r\n        assert(x == 1);\r\n    }\r\n}\r\n\r\n\r\n\r\n\r\n```\r\n\r\n### 2.Assign the value of globalVariable by passing the value in the argument of the function \r\n\r\n```solidity\r\n// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.0;\r\n\r\ncontract ComplexProgram {\r\n\r\n    uint256 public globalVariable;\r\n    struct MyStruct {\r\n        uint256 value;\r\n        bool flag;\r\n    }\r\n\r\n    function complexFunction2(uint number) public {\r\n        MyStruct memory myStruct;\r\n        myStruct.flag = true;\r\n        uint256 x = 1;\r\n\r\n        // Set globalVariable to the value passed as an argument\r\n        globalVariable = number;\r\n\r\n        // Perform assertions\r\n        assert(myStruct.flag == true);\r\n        require(globalVariable != 0, \"Global variable cannot be zero\");\r\n        assert(x == 1);\r\n    }\r\n}\r\n```\r\n\r\n### 3.By initially assigning the value to the globalVariable \r\n\r\n```solidity\r\n// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.0;\r\n\r\ncontract ComplexProgram {\r\n    uint256 public globalVariable = 1; // Or any other non-zero number\r\n    struct MyStruct {\r\n        uint256 value;\r\n        bool flag;\r\n    }\r\n\r\n    function complexFunction3() public view {\r\n        MyStruct memory myStruct;\r\n        myStruct.flag = true;\r\n        uint256 x = 1;\r\n\r\n        // Perform assertions\r\n        assert(myStruct.flag == true);\r\n        require(globalVariable != 0, \"Global variable cannot be zero\");\r\n        assert(x == 1);\r\n    }\r\n}\r\n```\r\n\r\n### 4. Or just by removing the require statement from the code \r\n\r\n```solidity\r\n// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.0;\r\n\r\ncontract ComplexProgram {\r\n    uint256 public globalVariable;\r\n    struct MyStruct {\r\n        uint256 value;\r\n        bool flag;\r\n    }\r\n\r\n    function complexFunction4() public pure {\r\n        MyStruct memory myStruct;\r\n        myStruct.flag = true;\r\n        uint256 x = 1;\r\n\r\n        // Perform assertions without the require statement\r\n        assert(myStruct.flag == true);\r\n        assert(x == 1);\r\n    }\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1666965558/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
