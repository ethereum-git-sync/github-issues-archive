{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/13179",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/13179/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/13179/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/13179/events",
  "html_url": "https://github.com/ethereum/solidity/issues/13179",
  "id": 1277993140,
  "node_id": "I_kwDOAm_5kc5MLKC0",
  "number": 13179,
  "title": "solc: Stack overflow importing large AST from json file",
  "user": {
    "login": "jaa2",
    "id": 43010335,
    "node_id": "MDQ6VXNlcjQzMDEwMzM1",
    "avatar_url": "https://avatars.githubusercontent.com/u/43010335?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jaa2",
    "html_url": "https://github.com/jaa2",
    "followers_url": "https://api.github.com/users/jaa2/followers",
    "following_url": "https://api.github.com/users/jaa2/following{/other_user}",
    "gists_url": "https://api.github.com/users/jaa2/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jaa2/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jaa2/subscriptions",
    "organizations_url": "https://api.github.com/users/jaa2/orgs",
    "repos_url": "https://api.github.com/users/jaa2/repos",
    "events_url": "https://api.github.com/users/jaa2/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jaa2/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    },
    {
      "id": 717596767,
      "node_id": "MDU6TGFiZWw3MTc1OTY3Njc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "006b75",
      "default": true,
      "description": ""
    },
    {
      "id": 1012613901,
      "node_id": "MDU6TGFiZWwxMDEyNjEzOTAx",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/easy%20difficulty",
      "name": "easy difficulty",
      "color": "0b3f89",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "matheusaaguiar",
    "id": 95899911,
    "node_id": "U_kgDOBbdRBw",
    "avatar_url": "https://avatars.githubusercontent.com/u/95899911?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/matheusaaguiar",
    "html_url": "https://github.com/matheusaaguiar",
    "followers_url": "https://api.github.com/users/matheusaaguiar/followers",
    "following_url": "https://api.github.com/users/matheusaaguiar/following{/other_user}",
    "gists_url": "https://api.github.com/users/matheusaaguiar/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/matheusaaguiar/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/matheusaaguiar/subscriptions",
    "organizations_url": "https://api.github.com/users/matheusaaguiar/orgs",
    "repos_url": "https://api.github.com/users/matheusaaguiar/repos",
    "events_url": "https://api.github.com/users/matheusaaguiar/events{/privacy}",
    "received_events_url": "https://api.github.com/users/matheusaaguiar/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "matheusaaguiar",
      "id": 95899911,
      "node_id": "U_kgDOBbdRBw",
      "avatar_url": "https://avatars.githubusercontent.com/u/95899911?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matheusaaguiar",
      "html_url": "https://github.com/matheusaaguiar",
      "followers_url": "https://api.github.com/users/matheusaaguiar/followers",
      "following_url": "https://api.github.com/users/matheusaaguiar/following{/other_user}",
      "gists_url": "https://api.github.com/users/matheusaaguiar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matheusaaguiar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matheusaaguiar/subscriptions",
      "organizations_url": "https://api.github.com/users/matheusaaguiar/orgs",
      "repos_url": "https://api.github.com/users/matheusaaguiar/repos",
      "events_url": "https://api.github.com/users/matheusaaguiar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matheusaaguiar/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2022-06-21T07:11:51Z",
  "updated_at": "2022-09-13T15:00:41Z",
  "closed_at": "2022-07-05T16:56:39Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Description\r\nImporting an AST with `--import-ast` using a large JSON file results in a stack overflow and segmentation fault with certain output options.\r\n\r\nA quick run with memcheck shows that it stems from a regex match.\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.8.16-develop.2022.6.21+commit.c3ea8661.mod.Linux.g++\r\n- Target EVM version (as per compiler settings): london\r\n- Operating system: Linux\r\n\r\n## Steps to Reproduce\r\n\r\nCreate a large AST as JSON. Here is Uniswap V3 as an example (20.2 MB) from the external tests: [uniswap_ast.zip](https://github.com/ethereum/solidity/files/8946583/uniswap_ast.zip)\r\n\r\nTry generating IR output - currently segfaults:\r\n```\r\nsolc --import-ast ./164dbdb3af44e9eea766cd449cf8864c.json --ir\r\n```\r\n\r\nTry generating assembly from IR - currently segfaults:\r\n```\r\nsolc --import-ast ./164dbdb3af44e9eea766cd449cf8864c.json --via-ir --asm\r\n```\r\n\r\nRegular assembly with the `--asm` flag only works as expected for this file.",
  "closed_by": {
    "login": "Marenz",
    "id": 424752,
    "node_id": "MDQ6VXNlcjQyNDc1Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Marenz",
    "html_url": "https://github.com/Marenz",
    "followers_url": "https://api.github.com/users/Marenz/followers",
    "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
    "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
    "organizations_url": "https://api.github.com/users/Marenz/orgs",
    "repos_url": "https://api.github.com/users/Marenz/repos",
    "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Marenz/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/13179/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/13179/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1161939174",
    "html_url": "https://github.com/ethereum/solidity/issues/13179#issuecomment-1161939174",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13179",
    "id": 1161939174,
    "node_id": "IC_kwDOAm_5kc5FQcjm",
    "user": {
      "login": "Marenz",
      "id": 424752,
      "node_id": "MDQ6VXNlcjQyNDc1Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Marenz",
      "html_url": "https://github.com/Marenz",
      "followers_url": "https://api.github.com/users/Marenz/followers",
      "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
      "organizations_url": "https://api.github.com/users/Marenz/orgs",
      "repos_url": "https://api.github.com/users/Marenz/repos",
      "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Marenz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-21T15:48:02Z",
    "updated_at": "2022-06-21T15:48:02Z",
    "author_association": "MEMBER",
    "body": "I believe this won't be too difficult to solve, so marking this as easy/good first issue, but in case I am wrong, feel free to comment/correct here",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1161939174/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1163537599",
    "html_url": "https://github.com/ethereum/solidity/issues/13179#issuecomment-1163537599",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13179",
    "id": 1163537599,
    "node_id": "IC_kwDOAm_5kc5FWiy_",
    "user": {
      "login": "matheusaaguiar",
      "id": 95899911,
      "node_id": "U_kgDOBbdRBw",
      "avatar_url": "https://avatars.githubusercontent.com/u/95899911?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matheusaaguiar",
      "html_url": "https://github.com/matheusaaguiar",
      "followers_url": "https://api.github.com/users/matheusaaguiar/followers",
      "following_url": "https://api.github.com/users/matheusaaguiar/following{/other_user}",
      "gists_url": "https://api.github.com/users/matheusaaguiar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matheusaaguiar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matheusaaguiar/subscriptions",
      "organizations_url": "https://api.github.com/users/matheusaaguiar/orgs",
      "repos_url": "https://api.github.com/users/matheusaaguiar/repos",
      "events_url": "https://api.github.com/users/matheusaaguiar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matheusaaguiar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-22T19:50:43Z",
    "updated_at": "2022-06-23T12:02:34Z",
    "author_association": "MEMBER",
    "body": "I have tracked down the stack overflow to a `regex_search` [call](https://github.com/ethereum/solidity/blob/develop/libyul/AsmParser.cpp#L200).\r\nApparently when the size of the `string_view` is sufficiently large (`39547` in the example of this issue), the `regex_search` produces the stack overflow. It seems to be a known problem, since I have found some bug reports about similar situations with `regex_search`.\r\nNot sure how it could be fixed. I guess we can't split the string_view being searched. I thought of merging two or more `match_results` returned from successive \"range-restricted\" regex searches (search first `n` positions, then next `n` or less until the end), but it is not possible.  ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1163537599/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1164829369",
    "html_url": "https://github.com/ethereum/solidity/issues/13179#issuecomment-1164829369",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13179",
    "id": 1164829369,
    "node_id": "IC_kwDOAm_5kc5FbeK5",
    "user": {
      "login": "matheusaaguiar",
      "id": 95899911,
      "node_id": "U_kgDOBbdRBw",
      "avatar_url": "https://avatars.githubusercontent.com/u/95899911?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matheusaaguiar",
      "html_url": "https://github.com/matheusaaguiar",
      "followers_url": "https://api.github.com/users/matheusaaguiar/followers",
      "following_url": "https://api.github.com/users/matheusaaguiar/following{/other_user}",
      "gists_url": "https://api.github.com/users/matheusaaguiar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matheusaaguiar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matheusaaguiar/subscriptions",
      "organizations_url": "https://api.github.com/users/matheusaaguiar/orgs",
      "repos_url": "https://api.github.com/users/matheusaaguiar/repos",
      "events_url": "https://api.github.com/users/matheusaaguiar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matheusaaguiar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-23T20:19:16Z",
    "updated_at": "2022-06-23T20:30:30Z",
    "author_association": "MEMBER",
    "body": "So far here is the situation: IR is generated with comments next to instructions indicating the source location. \r\n```\r\n /// @src 19:243:377  \",\\\"src\\\":\\\"45:22:19\\\"},{\\\"abstract\\\":false,\\\"baseContracts\\\":[],\\\"canonicalName\\\":\\\"FixedPoint96\\\",\\\"contractDependencies\\\":[],\\\"contractKind\\\":\\\"libra\"\r\n```\r\nThe comments may contain some \"garbage\" which come from debug info (as reported in [issue #12168](https://github.com/ethereum/solidity/issues/12168)). The debug info comes from method [dispenseLocationComment](https://github.com/ethereum/solidity/blob/develop/libsolidity/codegen/ir/Common.cpp#L142).\r\nLooking at method [parseSrcComment](https://github.com/ethereum/solidity/blob/develop/libyul/AsmParser.cpp#L193), the \"garbage\" which comes after the source location is not used and does not seem to affect the return value. Maybe, we could just filter out the debug info which in some cases is large enough to cause segfault. I tested that approach and then there is a stack too deep exception:\r\n```\r\nUncaught exception:\r\n/solidity/libyul/backends/evm/EVMObjectCompiler.cpp(115): Throw in function void solidity::yul::EVMObjectCompiler::run(solidity::yul::Object&, bool)\r\nDynamic exception type: boost::wrapexcept<solidity::yul::StackTooDeepError>\r\nstd::exception::what: Variable ret_0 is 1 slot(s) too deep inside the stack.\r\n[solidity::util::tag_comment*] = Variable ret_0 is 1 slot(s) too deep inside the stack.\r\n```\r\n\r\nI guess that is another problem with too long sequences of chars. I will continue to investigate from this point now, until we can decided the best solution. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1164829369/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1165008151",
    "html_url": "https://github.com/ethereum/solidity/issues/13179#issuecomment-1165008151",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13179",
    "id": 1165008151,
    "node_id": "IC_kwDOAm_5kc5FcJ0X",
    "user": {
      "login": "jaa2",
      "id": 43010335,
      "node_id": "MDQ6VXNlcjQzMDEwMzM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/43010335?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jaa2",
      "html_url": "https://github.com/jaa2",
      "followers_url": "https://api.github.com/users/jaa2/followers",
      "following_url": "https://api.github.com/users/jaa2/following{/other_user}",
      "gists_url": "https://api.github.com/users/jaa2/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jaa2/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jaa2/subscriptions",
      "organizations_url": "https://api.github.com/users/jaa2/orgs",
      "repos_url": "https://api.github.com/users/jaa2/repos",
      "events_url": "https://api.github.com/users/jaa2/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jaa2/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-23T23:27:38Z",
    "updated_at": "2022-06-23T23:27:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "> stack too deep exception\r\n\r\nThis is actually the expected output without `--optimize`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1165008151/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1165558826",
    "html_url": "https://github.com/ethereum/solidity/issues/13179#issuecomment-1165558826",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13179",
    "id": 1165558826,
    "node_id": "IC_kwDOAm_5kc5FeQQq",
    "user": {
      "login": "matheusaaguiar",
      "id": 95899911,
      "node_id": "U_kgDOBbdRBw",
      "avatar_url": "https://avatars.githubusercontent.com/u/95899911?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matheusaaguiar",
      "html_url": "https://github.com/matheusaaguiar",
      "followers_url": "https://api.github.com/users/matheusaaguiar/followers",
      "following_url": "https://api.github.com/users/matheusaaguiar/following{/other_user}",
      "gists_url": "https://api.github.com/users/matheusaaguiar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matheusaaguiar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matheusaaguiar/subscriptions",
      "organizations_url": "https://api.github.com/users/matheusaaguiar/orgs",
      "repos_url": "https://api.github.com/users/matheusaaguiar/repos",
      "events_url": "https://api.github.com/users/matheusaaguiar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matheusaaguiar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-24T13:08:55Z",
    "updated_at": "2022-06-24T13:09:09Z",
    "author_association": "MEMBER",
    "body": "Yes, just checked it and with `--optimize` there is no error.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1165558826/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1245543109",
    "html_url": "https://github.com/ethereum/solidity/issues/13179#issuecomment-1245543109",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13179",
    "id": 1245543109,
    "node_id": "IC_kwDOAm_5kc5KPXrF",
    "user": {
      "login": "Marenz",
      "id": 424752,
      "node_id": "MDQ6VXNlcjQyNDc1Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Marenz",
      "html_url": "https://github.com/Marenz",
      "followers_url": "https://api.github.com/users/Marenz/followers",
      "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
      "organizations_url": "https://api.github.com/users/Marenz/orgs",
      "repos_url": "https://api.github.com/users/Marenz/repos",
      "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Marenz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-13T15:00:41Z",
    "updated_at": "2022-09-13T15:00:41Z",
    "author_association": "MEMBER",
    "body": "Probably related: https://github.com/ethereum/solidity/issues/13496",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1245543109/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
