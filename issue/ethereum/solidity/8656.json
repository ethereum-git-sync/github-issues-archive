{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/8656",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/8656/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/8656/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/8656/events",
  "html_url": "https://github.com/ethereum/solidity/issues/8656",
  "id": 598134432,
  "node_id": "MDU6SXNzdWU1OTgxMzQ0MzI=",
  "number": 8656,
  "title": "Unexplained \"Assembly exception for bytecode\"",
  "user": {
    "login": "mrice32",
    "id": 11791551,
    "node_id": "MDQ6VXNlcjExNzkxNTUx",
    "avatar_url": "https://avatars.githubusercontent.com/u/11791551?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mrice32",
    "html_url": "https://github.com/mrice32",
    "followers_url": "https://api.github.com/users/mrice32/followers",
    "following_url": "https://api.github.com/users/mrice32/following{/other_user}",
    "gists_url": "https://api.github.com/users/mrice32/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mrice32/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mrice32/subscriptions",
    "organizations_url": "https://api.github.com/users/mrice32/orgs",
    "repos_url": "https://api.github.com/users/mrice32/repos",
    "events_url": "https://api.github.com/users/mrice32/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mrice32/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "Marenz",
    "id": 424752,
    "node_id": "MDQ6VXNlcjQyNDc1Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Marenz",
    "html_url": "https://github.com/Marenz",
    "followers_url": "https://api.github.com/users/Marenz/followers",
    "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
    "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
    "organizations_url": "https://api.github.com/users/Marenz/orgs",
    "repos_url": "https://api.github.com/users/Marenz/repos",
    "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Marenz/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "Marenz",
      "id": 424752,
      "node_id": "MDQ6VXNlcjQyNDc1Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Marenz",
      "html_url": "https://github.com/Marenz",
      "followers_url": "https://api.github.com/users/Marenz/followers",
      "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
      "organizations_url": "https://api.github.com/users/Marenz/orgs",
      "repos_url": "https://api.github.com/users/Marenz/repos",
      "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Marenz/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-04-10T23:09:47Z",
  "updated_at": "2020-05-07T15:37:01Z",
  "closed_at": "2020-05-07T15:37:01Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nWe made a small change to our code and noticed that the non-optimized compilation began failing. In particular, a `require()` (with message) statement seemed to be triggering the new failure. Our codebase is fairly large, but [here](https://github.com/UMAprotocol/protocol/tree/solidity_compilation_example) is a branch where the issue is present. In particular, [this new line](https://github.com/UMAprotocol/protocol/blob/e527ca542479e79a593cc249da6eac5c8b1c86d5/core/contracts/oracle/implementation/VoteTiming.sol#L21) seemed to cause the problem. Even more surprising, the compilation begins to succeed again when we removed the require message. I've reproduced this error in a much more minimal example below.\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.6.6\r\n- Target EVM version (as per compiler settings): default for compiler\r\n- Framework/IDE (e.g. Truffle or Remix): Truffle, but we were able to reproduce the example below in remix as well.\r\n- EVM execution environment / backend / blockchain client: N/A -- this is a compilation failure\r\n- Operating system: Mac OS X 10.15.3\r\n\r\n## Steps to Reproduce\r\n\r\nCompile the below example with optimization off.\r\n\r\n```solidity\r\npragma solidity ^0.6.0;\r\n\r\npragma experimental ABIEncoderV2;\r\n\r\n\r\ncontract Ownable {\r\n    address private _owner;\r\n\r\n    modifier onlyOwner() {\r\n        require(msg.sender == _owner, \"Ownable: caller is not the owner\");\r\n        _;\r\n    }\r\n\r\n    function renounceOwnership() public onlyOwner {\r\n        _owner = address(0);\r\n    }\r\n}\r\n\r\n\r\nlibrary VoteTiming {\r\n    function init(uint phaseLength) internal pure {\r\n        require(phaseLength > 0, \"Phase length can not be zero\");\r\n    }\r\n}\r\n\r\n\r\ncontract Voting is Ownable {\r\n    constructor(uint _phaseLength) public {\r\n        VoteTiming.init(_phaseLength);\r\n    }\r\n}\r\n```\r\n\r\nPlease note that the code above is somewhat nonsensical. It has the ABIEncoderV2 pragma despite not needing it (the code that originally had the error *did* need/use ABIEncoderV2). It includes a fairly random assortment of functions that don't really have anything to do with one another. These are just artifacts of stripping out the pieces not necessary to reproduce the error.\r\n\r\nIf you change almost anything about the example, the compilation begins to succeed:\r\n- Removing either `require` message.\r\n- Removing `ABIEncoderV2`.\r\n- Removing the `onlyOwner` modifier from the `renounceOwnership()` method.\r\n\r\nPlease let me know if there's any other information you need!",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/8656/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/8656/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/623550204",
    "html_url": "https://github.com/ethereum/solidity/issues/8656#issuecomment-623550204",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8656",
    "id": 623550204,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzU1MDIwNA==",
    "user": {
      "login": "Marenz",
      "id": 424752,
      "node_id": "MDQ6VXNlcjQyNDc1Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Marenz",
      "html_url": "https://github.com/Marenz",
      "followers_url": "https://api.github.com/users/Marenz/followers",
      "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
      "organizations_url": "https://api.github.com/users/Marenz/orgs",
      "repos_url": "https://api.github.com/users/Marenz/repos",
      "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Marenz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-04T15:57:56Z",
    "updated_at": "2020-05-04T15:57:56Z",
    "author_association": "MEMBER",
    "body": "The exact exception here is \r\n```\r\nassertThrow(m_tagPositionsInBytecode[size_t(i.data())] == size_t(-1), AssemblyException, \"Duplicate tag position.\");\r\n```\r\n\r\nIn libevmasm/Assembly.cpp:688\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/623550204/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/623970213",
    "html_url": "https://github.com/ethereum/solidity/issues/8656#issuecomment-623970213",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8656",
    "id": 623970213,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzk3MDIxMw==",
    "user": {
      "login": "Marenz",
      "id": 424752,
      "node_id": "MDQ6VXNlcjQyNDc1Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Marenz",
      "html_url": "https://github.com/Marenz",
      "followers_url": "https://api.github.com/users/Marenz/followers",
      "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
      "organizations_url": "https://api.github.com/users/Marenz/orgs",
      "repos_url": "https://api.github.com/users/Marenz/repos",
      "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Marenz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-05T10:14:30Z",
    "updated_at": "2020-05-05T10:14:30Z",
    "author_association": "MEMBER",
    "body": "The problem seems to be that we're adding the function `array_storeLengthForEncoding_t_string_memory_ptr_fromStack` twice thus triggering the assert that checks for duplicate tags.\r\n\r\nThe addition is triggered from two positions in the code:\r\n* libsolidity/codegen/Compiler.cpp:49\r\n* libsolidity/codegen/Compiler.cpp:39",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/623970213/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
