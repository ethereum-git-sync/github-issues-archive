{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/4524",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/4524/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/4524/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/4524/events",
  "html_url": "https://github.com/ethereum/solidity/issues/4524",
  "id": 342356508,
  "node_id": "MDU6SXNzdWUzNDIzNTY1MDg=",
  "number": 4524,
  "title": "Verifying Ethereum signature by Solidity: “VM Exception while processing transaction: revert”",
  "user": {
    "login": "s1241",
    "id": 37220425,
    "node_id": "MDQ6VXNlcjM3MjIwNDI1",
    "avatar_url": "https://avatars.githubusercontent.com/u/37220425?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/s1241",
    "html_url": "https://github.com/s1241",
    "followers_url": "https://api.github.com/users/s1241/followers",
    "following_url": "https://api.github.com/users/s1241/following{/other_user}",
    "gists_url": "https://api.github.com/users/s1241/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/s1241/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/s1241/subscriptions",
    "organizations_url": "https://api.github.com/users/s1241/orgs",
    "repos_url": "https://api.github.com/users/s1241/repos",
    "events_url": "https://api.github.com/users/s1241/events{/privacy}",
    "received_events_url": "https://api.github.com/users/s1241/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 455256446,
      "node_id": "MDU6TGFiZWw0NTUyNTY0NDY=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/waiting%20for%20more%20input",
      "name": "waiting for more input",
      "color": "fef2c0",
      "default": false,
      "description": "Issues waiting for more input by the reporter"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2018-07-18T14:35:44Z",
  "updated_at": "2018-09-04T11:23:15Z",
  "closed_at": "2018-09-04T11:23:15Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Issue\r\n\r\nWhen I want to verify the `Ethereum ECDSA` signature by `Solidity` contract that has been generated using `ethereumjs` I receive : “VM Exception while processing transaction: revert”. Whereas I can verify this signature by JavaScript code and `ethereumjs` successfully.  \r\n\r\n**The entire code is presented** [HERE](https://programtheblockchain.com/posts/2018/02/23/writing-a-simple-payment-channel/)\r\n\r\n## Steps to Reproduce\r\n\r\nI tested signature verification of the code presented [HERE](https://programtheblockchain.com/posts/2018/02/23/writing-a-simple-payment-channel/) as follows:\r\n\r\nrunning `testRPC` :\r\n\r\n  \r\n```\r\nroot@ubuntu:/home/s# testrpc\r\n    EthereumJS TestRPC v6.0.3 (ganache-core: 2.0.2)\r\n    \r\n    Available Accounts\r\n    ==================\r\n    (0) 0xa1fe30d3b82fd7c563b6fc9c44f3990bfcef3ed4\r\n    (1) 0xfadc848eea30a47a19ec8a62a42471de3e073b89\r\n    (2) 0x162e8acc48158f4e8961865f09f8d029d625161f\r\n    (3) 0x8f132b6c06b8a93ebc8689371c44fc8271ac9d73\r\n    (4) 0x4741548cb9a157522b353e94b9393ec537b1e352\r\n    (5) 0x6f786e92be3b0da9142f657a391bf7f91ae81910\r\n    (6) 0x3e90f71ea98ea71957f0cc9a1a5c4e0ad530a381\r\n    (7) 0xb3032b6bad1406fd6041839c4c9a0e544d3bd9a5\r\n    (8) 0x10f4925ac27d37df3ca1e8a4df37d3a94645a1a3\r\n    (9) 0x63021d2642b7f7581b963408436f69a6329195a8\r\n    \r\n    Private Keys\r\n    ==================\r\n    (0) f9059a43ab6d30687a95a5dcd2551b02f98a6abc557cacf17fb5a7586c30fc9e\r\n    (1) b74d7dad53e04db199f06f57f4e53e4bb0914d9d5118d367b6f7a39998bb45b7\r\n    (2) 837d2cb30033f7c218d6cd6fd4f7703f950495dae89c797e7dd01c6a469ed64c\r\n    (3) f7c1d7df52b765609315127f664363fea5df108bf414788e6eb4905005638b5e\r\n    (4) ec4b55a3ae654a5c2aeeeeb068c47c84808065a4a466148844763e0bdf7e87cf\r\n    (5) d7e75efcb275f2496790c86b9a5951ab86a9361d0e55604f9409cd9a6844b595\r\n    (6) adee6af8313963b68ce440d4ade36e7e1163d2bb9dd351152d73c6aee1b5ae95\r\n    (7) 6f3b9662e341aaae1131522c691834e0eb4a8a7987b8c39f412334ea4fc8050d\r\n    (8) d48189838281fd47802fe755767531433af116428379fdabadcf92779a6e157c\r\n    (9) acde15308f46d5f96ad229eef0a8b6b20e864e05cbf7063e83249cd1b6080425\r\n    \r\n    HD Wallet\r\n    ==================\r\n    Mnemonic:      other shell crater issue merit system age kitchen south mother lecture embrace\r\n    Base HD Path:  m/44'/60'/0'/0/{account_index}\r\n    \r\n    Listening on localhost:8545\r\n```\r\n     \r\nAnd I chose the following addresses as `signer / sender` and `recipient` :\r\n\r\n    ```\r\n```\r\nsender address = 0xa1fe30d3b82fd7c563b6fc9c44f3990bfcef3ed4\r\n    recipient address = 0xfadc848eea30a47a19ec8a62a42471de3e073b89\r\n```\r\n\r\n```\r\n\r\nDeploying contract:\r\n\r\n    ```\r\n> const thisContract = new web3.eth.Contract(abi);\r\n    undefined\r\n    > \r\n    > thisContract.deploy({  \r\n    ... \r\n    ...         data: bytecode,\r\n    ... \r\n    ...         arguments: [ \"0xfadc848eea30a47a19ec8a62a42471de3e073b89\", 2592000]\r\n    ... \r\n    ...     }).send({\r\n    ... \r\n    ...        from: \"0xa1fe30d3b82fd7c563b6fc9c44f3990bfcef3ed4\",\r\n    ... \r\n    ...        gas: 5000000 ,\r\n    ... \r\n    ...        gasPrice: '3000000000',\r\n    ... \r\n    ...        value: 5000 \r\n    ... \r\n    ...     },\r\n    ... \r\n    ... \tfunction(error, transactionHash) {\r\n    ... \r\n    ...         console.log(error);\r\n    ... \r\n    ...         console.log(transactionHash);\r\n    ... \r\n    ...         console.log('function exec');\r\n    ... \r\n    ...     }).then(function(newContractInstance) {\r\n    ... \r\n    ...     console.log('Contract Instance:' + newContractInstance.options.address);\r\n    ... \r\n    ... });\r\n    Promise {\r\n      <pending>,\r\n      domain: \r\n       Domain {\r\n         domain: null,\r\n         _events: \r\n          { removeListener: [Function: updateExceptionCapture],\r\n            newListener: [Function: updateExceptionCapture],\r\n            error: [Function: debugDomainError] },\r\n         _eventsCount: 3,\r\n         _maxListeners: undefined,\r\n         members: [] } }\r\n    > null\r\n    0xee77c9011a4fb4d18cdf6804007ddc6b2b05828c7b8cac28f784f7b26c0021ef\r\n    function exec\r\n    Contract Instance:0xa6D8893aAF5121AEfb496aB305e0DA42F71aAaa5\r\n```\r\n\r\nGetting `contract balance` :\r\n\r\n    > web3.eth.getBalance('0xa6D8893aAF5121AEfb496aB305e0DA42F71aAaa5').then(console.log) // contract\r\n    Promise {\r\n      <pending>,\r\n      domain: \r\n       Domain {\r\n         domain: null,\r\n         _events: \r\n          { removeListener: [Function: updateExceptionCapture],\r\n            newListener: [Function: updateExceptionCapture],\r\n            error: [Function: debugDomainError] },\r\n         _eventsCount: 3,\r\n         _maxListeners: undefined,\r\n         members: [] } }\r\n    > 5000\r\n\r\nSigning :\r\n\r\n    ```\r\nsignPayment('0xa6D8893aAF5121AEfb496aB305e0DA42F71aAaa5', 50, function(err, something) {}); \r\n        //signature= 0xb6dec803b061504e22bccccffdfe26980ddaa33d650268361bec5ef4bd4a863f6ff2ee7d524f63cd82ef5634a063cd5e21f164c2ab1a6c952131308d6f46fb1200\r\n\r\nVerifying :\r\n\r\n    ```\r\nresult = isValidSignature('0xa6D8893aAF5121AEfb496aB305e0DA42F71aAaa5', 50,  \"0xb6dec803b061504e22bccccffdfe26980ddaa33d650268361bec5ef4bd4a863f6ff2ee7d524f63cd82ef5634a063cd5e21f164c2ab1a6c952131308d6f46fb1200\", \"0xa1fe30d3b82fd7c563b6fc9c44f3990bfcef3ed4\");\r\n    console.log(\"Signature Verification Result= \", result);\r\n    //result = true\r\n```\r\n## Expected Behavior\r\n\r\nAfter calling `function close` `recipient` address should receive `ether` and the contract should be destroyed. However, transaction does not become complete.\r\n\r\n## Actual Results\r\n\r\nCall `function close` to transfer `ether` and destroy `contract`\r\n\r\n    ```\r\n> var contractInstance = new web3.eth.Contract(abi, '0xa6D8893aAF5121AEfb496aB305e0DA42F71aAaa5');\r\n    undefined\r\n    > \r\n    > contractInstance.options.address;\r\n    '0xa6D8893aAF5121AEfb496aB305e0DA42F71aAaa5'\r\n    > \r\n    > \r\n    > contractInstance.methods.close(50, \"0xb6dec803b061504e22bccccffdfe26980ddaa33d650268361bec5ef4bd4a863f6ff2ee7d524f63cd82ef5634a063cd5e21f164c2ab1a6c952131308d6f46fb1200\").send({ from: '0xfadc848eea30a47a19ec8a62a42471de3e073b89' }, function(error, result) {\r\n    ... \r\n    ...     console.log(error);\r\n    ... \r\n    ...     console.log(result)\r\n    ... \r\n    ... });\r\n    Promise {\r\n      <pending>,\r\n      domain: \r\n       Domain {\r\n         domain: null,\r\n         _events: \r\n          { removeListener: [Function: updateExceptionCapture],\r\n            newListener: [Function: updateExceptionCapture],\r\n            error: [Function: debugDomainError] },\r\n         _eventsCount: 3,\r\n         _maxListeners: undefined,\r\n         members: [] },\r\n      _events: undefined,\r\n      emit: [Function: emit],\r\n      on: [Function: on],\r\n      once: [Function: once],\r\n      off: [Function: removeListener],\r\n      listeners: [Function: listeners],\r\n      addListener: [Function: on],\r\n      removeListener: [Function: removeListener],\r\n      removeAllListeners: [Function: removeAllListeners] }\r\n    > Error: Returned error: VM Exception while processing transaction: revert\r\n        at Object.ErrorResponse (/home/s/node_modules/web3-core-helpers/src/errors.js:29:16)\r\n        at /home/s/node_modules/web3-core-requestmanager/src/index.js:140:36\r\n        at XMLHttpRequest.request.onreadystatechange (/home/s/node_modules/web3-providers-http/src/index.js:77:13)\r\n        at XMLHttpRequestEventTarget.dispatchEvent (/home/s/node_modules/xhr2/lib/xhr2.js:64:18)\r\n        at XMLHttpRequest._setReadyState (/home/s/node_modules/xhr2/lib/xhr2.js:354:12)\r\n        at XMLHttpRequest._onHttpResponseEnd (/home/s/node_modules/xhr2/lib/xhr2.js:509:12)\r\n        at IncomingMessage.<anonymous> (/home/s/node_modules/xhr2/lib/xhr2.js:469:24)\r\n        at IncomingMessage.emit (events.js:185:15)\r\n        at IncomingMessage.emit (domain.js:440:23)\r\n        at endReadableNT (_stream_readable.js:1106:12)\r\n        at process._tickCallback (internal/process/next_tick.js:178:19)\r\n    undefined\r\n\r\n```\r\n**Error:**\r\n\r\n> **### error: VM Exception while processing transaction: revert**\r\n\r\n\r\nAnd here is `testrpc` message :\r\n\r\n    ```\r\neth_sendTransaction\r\n    \r\n      Transaction: 0x2dbc6d601e48f6cab5327f162ff415d4e0b11264685a7ceed90de8d77adc2d8a\r\n      Gas usage: 31867\r\n      Block Number: 12\r\n      Block Time: Tue Jul 17 2018 13:56:35 GMT+0200 (CEST)\r\n      Runtime Error: revert\r\n\r\n```\r\nAnd when I get `contract balance` it's still `5000` :\r\n\r\n    ```\r\n> web3.eth.getBalance('0xa6D8893aAF5121AEfb496aB305e0DA42F71aAaa5').then(console.log) // contract \r\n    Promise {\r\n      <pending>,\r\n      domain: \r\n       Domain {\r\n         domain: null,\r\n         _events: \r\n          { removeListener: [Function: updateExceptionCapture],\r\n            newListener: [Function: updateExceptionCapture],\r\n            error: [Function: debugDomainError] },\r\n         _eventsCount: 3,\r\n         _maxListeners: undefined,\r\n         members: [] } }\r\n    > 5000\r\n```\r\n\r\n**Note 1:**\r\n**When I remove `signature` from `function close` as follows, transferring `ether` is done, since when I get `contract balance` it becomes `zero`. However, with signature I receive the above error message.**\r\n\r\n   ```\r\n function close(uint256 amount) public {\r\n    \r\n            recipient.transfer(amount);\r\n            selfdestruct(sender);\r\n        }\r\n```\r\n\r\n**Note 2:**\r\n\r\nMeanwhile I added a new function as follow to get value of `message` in :\r\n\r\n    `bytes32 message = prefixed(keccak256(abi.encodePacked(this, amount)));`\r\n\r\nby which I can get value of `recoverSigner(message, signature)` :\r\n\r\nSo I defined following function and deployed contract again :\r\n\r\n    ```\r\nfunction returnMsg(uint256 amount) public\r\n        \r\n        returns (bytes32)\r\n        \r\n        {\r\n            bytes32 message = prefixed(keccak256(abi.encodePacked(this, amount)));\r\n            return message;\r\n        }\r\n```\r\n\r\nHowever, I could not get value of `message` and I only received transaction receipt as follows:\r\n\r\n       ```\r\n > contractInstance.methods.returnMsg(50).send({ from: '0x39969849de82f978e9f356ffa5516f8d25f44ddc' }, function(error, result) {\r\n        ... \r\n        ...     console.log(error);\r\n        ... \r\n        ...     console.log(result)\r\n        ... \r\n        ... });\r\n        Promise {\r\n          <pending>,\r\n          domain: \r\n           Domain {\r\n             domain: null,\r\n             _events: \r\n              { removeListener: [Function: updateExceptionCapture],\r\n                newListener: [Function: updateExceptionCapture],\r\n                error: [Function: debugDomainError] },\r\n             _eventsCount: 3,\r\n             _maxListeners: undefined,\r\n             members: [] },\r\n          _events: undefined,\r\n          emit: [Function: emit],\r\n          on: [Function: on],\r\n          once: [Function: once],\r\n          off: [Function: removeListener],\r\n          listeners: [Function: listeners],\r\n          addListener: [Function: on],\r\n          removeListener: [Function: removeListener],\r\n          removeAllListeners: [Function: removeAllListeners] }\r\n        > null\r\n        0xb6dc221924f4ce6fffe184297b68649cf5ec2ab64c8413a20c9f0d1d8233f04c\r\n```\r\n        \r\n **And when I get transaction status \"contract address is \"null\" : \"**\r\n        \r\n        ```\r\n```\r\n> var receipt = web3.eth.getTransactionReceipt('0xb6dc221924f4ce6fffe184297b68649cf5ec2ab64c8413a20c9f0d1d8233f04c').then(console.log);\r\n    undefined\r\n    > { transactionHash: '0xb6dc221924f4ce6fffe184297b68649cf5ec2ab64c8413a20c9f0d1d8233f04c',\r\n      transactionIndex: 0,\r\n      blockHash: '0xf65f637eba42b5fb29dfa051ea8d3c1bc876395210fe635b3dd7333a8a7f7307',\r\n      blockNumber: 2,\r\n      gasUsed: 22861,\r\n      cumulativeGasUsed: 22861,\r\n      contractAddress: null,\r\n      logs: [],\r\n      status: true }\r\n```\r\n\r\n```\r\n**Important Note:** _Please note that verifying signature using `JavaScript` is verified however apparently by `Solidity` code it is not verified and I think because of this transaction is reverted, Since as I mentioned in my question, without signature verification `ether` is transferred and contract is destroyed._\r\n\r\n## Environment\r\n\r\n* Operating System: Ubuntu (using VM Ware)\r\n* Ethereum client: EthereumJS TestRPC v6.0.3 (ganache-core: 2.0.2)\r\n* Truffle version (`truffle version`): I do not use truffle\r\n* node version (`node --version`):  v9.11.1\r\n* npm version (`npm --version`):  6.0.0\r\n",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/4524/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/4524/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/405957030",
    "html_url": "https://github.com/ethereum/solidity/issues/4524#issuecomment-405957030",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4524",
    "id": 405957030,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNTk1NzAzMA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-18T14:45:52Z",
    "updated_at": "2018-07-18T14:45:52Z",
    "author_association": "MEMBER",
    "body": "Such problems are usually caused by not setting the EVM version of the runtime to the latest version (byzantium) - especially if it works in some environments but not in all. Could you please check that? Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/405957030/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/418331097",
    "html_url": "https://github.com/ethereum/solidity/issues/4524#issuecomment-418331097",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4524",
    "id": 418331097,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODMzMTA5Nw==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T11:23:15Z",
    "updated_at": "2018-09-04T11:23:15Z",
    "author_association": "MEMBER",
    "body": "Closed due to inactivity. Please reopen if the issue persists of if you have more questions.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/418331097/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
