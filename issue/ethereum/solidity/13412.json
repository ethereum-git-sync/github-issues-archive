{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/13412",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/13412/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/13412/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/13412/events",
  "html_url": "https://github.com/ethereum/solidity/issues/13412",
  "id": 1343069439,
  "node_id": "I_kwDOAm_5kc5QDZz_",
  "number": 13412,
  "title": "Impossibility of getting current function selector in nested calls via `msg.sig`",
  "user": {
    "login": "mojtaba-eshghie",
    "id": 37236297,
    "node_id": "MDQ6VXNlcjM3MjM2Mjk3",
    "avatar_url": "https://avatars.githubusercontent.com/u/37236297?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mojtaba-eshghie",
    "html_url": "https://github.com/mojtaba-eshghie",
    "followers_url": "https://api.github.com/users/mojtaba-eshghie/followers",
    "following_url": "https://api.github.com/users/mojtaba-eshghie/following{/other_user}",
    "gists_url": "https://api.github.com/users/mojtaba-eshghie/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mojtaba-eshghie/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mojtaba-eshghie/subscriptions",
    "organizations_url": "https://api.github.com/users/mojtaba-eshghie/orgs",
    "repos_url": "https://api.github.com/users/mojtaba-eshghie/repos",
    "events_url": "https://api.github.com/users/mojtaba-eshghie/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mojtaba-eshghie/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-08-18T13:01:19Z",
  "updated_at": "2022-08-18T15:13:43Z",
  "closed_at": "2022-08-18T15:13:12Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "\r\n## Description\r\n\r\nI am working on a project where I need the current function signature in a sequence of function calls. The functions are marked as public but they are called within the contract by each other. In the following `steps to reproduce` section function if we send a transaction to function `one`, it will call `two`, however, if we look at `msg.data` or `msg.sig` it will return the signature of the original transaction for function `one`. This makes it impossible to distinguish between different functions in solidity code in nested calls as calldata returns only the first function signature in the chain. Is there a way to get around this? \r\n\r\n## Environment\r\n\r\n- Compiler version: 0.8.15\r\n- Target EVM version (as per compiler settings): default for Remix\r\n- Framework/IDE (e.g. Truffle or Remix): Remix\r\n- EVM execution environment / backend / blockchain client: Remix vm\r\n- Operating system: -\r\n\r\n## Steps to Reproduce\r\n\r\n```\r\ncontract MsgDataTester {\r\n    event MsgDataLogger(bytes4 data);\r\n\r\n    function one(uint256 a) public {\r\n        emit MsgDataLogger(msg.sig);\r\n        two(2);\r\n    }\r\n\r\n    function two(uint256 b) public {\r\n        emit MsgDataLogger(msg.sig);\r\n        \r\n    }\r\n}\r\n```\r\n-->\r\n",
  "closed_by": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/13412/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/13412/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1219615977",
    "html_url": "https://github.com/ethereum/solidity/issues/13412#issuecomment-1219615977",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13412",
    "id": 1219615977,
    "node_id": "IC_kwDOAm_5kc5Isdzp",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-18T15:13:12Z",
    "updated_at": "2022-08-18T15:13:12Z",
    "author_association": "MEMBER",
    "body": "`msg` is a global object specifically meant to represent the transaction input. The fact that the value is the same in nested calls is the expected behavior.\r\n\r\nIf you're interested in the selector of the current function instead, you should use the `.selector` member on that function:\r\n\r\n```solidity\r\ncontract MsgDataTester {\r\n    event MsgDataLogger(bytes4 data);\r\n\r\n    function one(uint256 a) public {\r\n        emit MsgDataLogger(this.one.selector);\r\n        two(2);\r\n    }\r\n\r\n    function two(uint256 b) public {\r\n        emit MsgDataLogger(this.two.selector);\r\n    }\r\n}\r\n```\r\n\r\n> This makes it impossible to distinguish between different functions in solidity code in nested calls as calldata returns only the first function signature in the chain. Is there a way to get around this?\r\n\r\n`two(2)` in your code is an internal call so you can't really \"distinguish\" it in the sense that it's running in the same context. It has the access to the same stack, memory, etc. If you made it an external call (`this.two(2)`), `msg.sig` would have a different value just as you expect it. But I'm not sure if this is really what you're after. External calls to your own contract are not a common thing and I suspect that's not what you need.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1219615977/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
