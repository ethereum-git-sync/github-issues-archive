{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12860",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12860/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12860/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12860/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12860",
  "id": 1181036685,
  "node_id": "I_kwDOAm_5kc5GZTCN",
  "number": 12860,
  "title": "RETURNDATACOPY opcode is not disallowed in pure functions",
  "user": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    },
    {
      "id": 2376132438,
      "node_id": "MDU6TGFiZWwyMzc2MTMyNDM4",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/codegen%20error",
      "name": "codegen error",
      "color": "000000",
      "default": false,
      "description": "Compiler generates invalid code. Critical."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-03-25T17:09:53Z",
  "updated_at": "2022-04-28T11:15:05Z",
  "closed_at": "2022-04-28T11:15:05Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "The main feature of a pure function is that it cannot read blockchain state, which includes not only reading storage but also things like accessing external contract code, checking balance, checking remaining gas, etc. There are also cases where this is not so clear cut, e.g. CODECOPY (#12260, #8153) but we tend towards disallowing that as well. Another such case is RETURNDATACOPY. It was recently pointed out that it should not be accessible in pure functions.\r\n\r\nThe fact that it's allowed should probably be considered a bug. Otherwise it's a breaking change.\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.8.13\r\n\r\n## Steps to reproduce\r\nThis code compiles just fine:\r\n```solidity\r\nfunction foo() pure {\r\n    assembly {\r\n        returndatacopy(0, 32, 64)\r\n    }\r\n}\r\n```\r\n\r\nWhile the same would not work with e.g. EXTCODECOPY:\r\n```solidity\r\nfunction foo() pure {\r\n    assembly {\r\n        extcodecopy(0, 0, 32, 64)\r\n    }\r\n}\r\n```\r\n```\r\nError: Function declared as pure, but this expression (potentially) reads from the environment or state and thus requires \"view\".\r\n --> test.sol:3:13:\r\n  |\r\n3 |             extcodecopy(0, 0, 32, 64)\r\n  |             ^^^^^^^^^^^^^^^^^^^^^^^^^\r\n```\r\n\r\n## Extra information\r\nHere's the full list of instructions currently disallowed in `pure` functions\r\nhttps://github.com/ethereum/solidity/blob/c4909e99c1015233d6937d229058cde52615f246/libevmasm/SemanticInformation.cpp#L465-L520",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12860/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12860/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1079239112",
    "html_url": "https://github.com/ethereum/solidity/issues/12860#issuecomment-1079239112",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12860",
    "id": 1079239112,
    "node_id": "IC_kwDOAm_5kc5AU-HI",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-25T17:20:34Z",
    "updated_at": "2022-03-25T17:20:34Z",
    "author_association": "MEMBER",
    "body": "@chriseth \r\n- RETURNDATASIZE should also be disallowed, correct? Anything else to disallow?\r\n- Do we actually consider it a bug fix or should it be a breaking change like for CODECOPY?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1079239112/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1087315918",
    "html_url": "https://github.com/ethereum/solidity/issues/12860#issuecomment-1087315918",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12860",
    "id": 1087315918,
    "node_id": "IC_kwDOAm_5kc5Azx_O",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-04T09:19:20Z",
    "updated_at": "2022-04-04T09:19:20Z",
    "author_association": "MEMBER",
    "body": "This is a bit tricky...\r\n```\r\ncontract C {\r\n        function g() public pure returns (bytes memory) {\r\n                return new bytes(32);\r\n        }\r\n        function f(C c) public pure returns (uint256) {\r\n                bytes memory x = c.g();\r\n                return uint256(bytes32(x[0]));\r\n        }\r\n}\r\n```\r\nThis also works just fine right now... which is arguably fine (passing something as ``c`` that has a non-pure ``g()`` is possible and will allow for calling ``f`` \"impure\"ly, but maybe that's fine)...\r\n\r\nAnd if that's fine, one could argue that ``returndatacopy`` and ``returndatasize`` are also just fine in pure functions...\r\nWhat's really a problem is an external *call* to something, since that may not in fact be pure - but if everything that's called *is* pure, then using the returndata is a non-issue, is it?\r\n\r\nAll of that assuming the weaker notion of ``pure``, i.e. \"externally pure\", resp. \"does not read state\", rather than the stronger \"can be compile-time evaluated\" notion of pure...",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1087315918/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1087318141",
    "html_url": "https://github.com/ethereum/solidity/issues/12860#issuecomment-1087318141",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12860",
    "id": 1087318141,
    "node_id": "IC_kwDOAm_5kc5Azyh9",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-04T09:21:31Z",
    "updated_at": "2022-04-04T09:21:31Z",
    "author_association": "MEMBER",
    "body": "Ah, well... actually further, it should probably only be allowed to use ``returndatacopy`` and ``returndatasize`` in a pure function *after* that very same pure function has made an external call... before an external call, it's quite non-pure...\r\nGiven that, it's probably true that we should disallow it entirely (even though it's implicitly possible using high-level mechanisms)...",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1087318141/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
