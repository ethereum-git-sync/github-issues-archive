{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/13700",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/13700/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/13700/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/13700/events",
  "html_url": "https://github.com/ethereum/solidity/issues/13700",
  "id": 1442394512,
  "node_id": "I_kwDOAm_5kc5V-TGQ",
  "number": 13700,
  "title": "Replace KnowledgeBase and DataFlowAnalyzer to be more efficient",
  "user": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 682993385,
      "node_id": "MDU6TGFiZWw2ODI5OTMzODU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/performance%20:racehorse:",
      "name": "performance :racehorse:",
      "color": "c5def5",
      "default": false,
      "description": ""
    },
    {
      "id": 1282209978,
      "node_id": "MDU6TGFiZWwxMjgyMjA5OTc4",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/optimizer",
      "name": "optimizer",
      "color": "d4c5f9",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2022-11-09T16:28:20Z",
  "updated_at": "2022-11-09T16:29:15Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "KnowledgeBase currently uses the rule list to simplify expressions and thus deduce if\r\n- a variable is a (known) constant\r\n- two variables have a (known) constant difference\r\n\r\nIt does one full run of simplification through the rule list to achieve this. The problem is that the DataFlowAnalyzer uses the KnowledgeBase to delete memory (and storage) knowledge on a write to position `p` by iterating through all variables to check if they have a known difference of at least 32 to `p`.\r\nIt is much more efficient to already group variables into sets that have a constant difference to each other, since this is the only information we care about.\r\nThis optimization could be dragged into the DataFlowAnalyzer by storing knowledge about storage and memory not by variables but in two layers, first by groups of variables with known constant difference and then by difference.\r\n\r\nSome sketches follow.\r\n\r\n-----\r\n\r\nInterface:\r\n\r\n- variable got assigned new value (or got declared)\r\n- do two variables have a constant difference?\r\n- does one variable have a constant value?\r\n\r\nData:\r\n\r\nVariables:\r\n - Mapping from variable to \"representative\" plus offset.\r\n - Mapping from representative to all members in the group.\r\n - Maybe special case for a single representative that holds a constant value.\r\n\r\nMemory:\r\n - currently: Variable to variable\r\n - could change this to map that goes to representative so that we can easily clear affected memory, but could also try without first\r\n\r\n\r\nWhat happens?\r\n - Variable assignment:\r\n   Potentially remove it from its group.\r\n   Walk the tree of its value (maybe only one step?) and store in group.\r\n   If `x = add(a, b)`, and `a,b` are from different groups, then we have to create a new group.\r\n   If `x = add(a, b)` and one of `a`, `b` are in the constant group, add `x` to the other group.\r\n   If a variable changes, do we need to update dependent variables? I think we only need to do something for the representative - choose a new representative.\r\n\r\nWhat happens in branch joins?",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/13700/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/13700/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
