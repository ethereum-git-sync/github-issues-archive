{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/14331",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/14331/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/14331/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/14331/events",
  "html_url": "https://github.com/ethereum/solidity/issues/14331",
  "id": 1760128453,
  "node_id": "I_kwDOAm_5kc5o6W3F",
  "number": 14331,
  "title": "A change of comment causes more diff than cbor metadata",
  "user": {
    "login": "zhiqiangxu",
    "id": 1265027,
    "node_id": "MDQ6VXNlcjEyNjUwMjc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1265027?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zhiqiangxu",
    "html_url": "https://github.com/zhiqiangxu",
    "followers_url": "https://api.github.com/users/zhiqiangxu/followers",
    "following_url": "https://api.github.com/users/zhiqiangxu/following{/other_user}",
    "gists_url": "https://api.github.com/users/zhiqiangxu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zhiqiangxu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zhiqiangxu/subscriptions",
    "organizations_url": "https://api.github.com/users/zhiqiangxu/orgs",
    "repos_url": "https://api.github.com/users/zhiqiangxu/repos",
    "events_url": "https://api.github.com/users/zhiqiangxu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zhiqiangxu/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-06-16T07:54:35Z",
  "updated_at": "2024-01-10T09:27:51Z",
  "closed_at": "2024-01-10T09:27:51Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nTheoretically, a change of comment should only change the cbor metadata at the end of bytecode; This holds normally but I found an exception for the following `ThemisFactory` contract.\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.5.16\r\n- Operating system: mac osx\r\n\r\n## Steps to Reproduce\r\n\r\n[This](https://gist.github.com/zhiqiangxu/85b4df89f7cb74802d81288b6297fdd8) is the solidity file for reproducing.\r\n\r\nThis is the command to compile: `solc --bin ThemisFactory-new.sol --optimize --optimize-runs 200`\r\n\r\nNotice the `//xx` at the end of the solidity file? If I change the comment a bit, it will cause more diff than the `cbor metadata` at the end, which can be easily verified at [sourcify](https://playground.sourcify.dev/). \r\n\r\n(For my experiment the bytecode for `ThemisFactory` is [this](https://gist.github.com/zhiqiangxu/52835cd23a262ead5f98c07a04c29da7) vs [this](https://gist.github.com/zhiqiangxu/b213c8ed7a988664a12ce44d642e726e) after a change of comment at the end of file)\r\n\r\n\r\nThis is abnormal so I suspect it's either a compiler bug or some hidden feature to clarify?\r\n\r\n**UPDATE**\r\n\r\nI guess that there're two metadata is because the `ThemisFactory` actually contains two contract, so the real question should be: is there some reliable way to identify all metadatas from only the bytecode?",
  "closed_by": {
    "login": "nikola-matic",
    "id": 4415530,
    "node_id": "MDQ6VXNlcjQ0MTU1MzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4415530?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nikola-matic",
    "html_url": "https://github.com/nikola-matic",
    "followers_url": "https://api.github.com/users/nikola-matic/followers",
    "following_url": "https://api.github.com/users/nikola-matic/following{/other_user}",
    "gists_url": "https://api.github.com/users/nikola-matic/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nikola-matic/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nikola-matic/subscriptions",
    "organizations_url": "https://api.github.com/users/nikola-matic/orgs",
    "repos_url": "https://api.github.com/users/nikola-matic/repos",
    "events_url": "https://api.github.com/users/nikola-matic/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nikola-matic/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/14331/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/14331/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1674211362",
    "html_url": "https://github.com/ethereum/solidity/issues/14331#issuecomment-1674211362",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14331",
    "id": 1674211362,
    "node_id": "IC_kwDOAm_5kc5jynAi",
    "user": {
      "login": "kuzdogan",
      "id": 13069972,
      "node_id": "MDQ6VXNlcjEzMDY5OTcy",
      "avatar_url": "https://avatars.githubusercontent.com/u/13069972?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kuzdogan",
      "html_url": "https://github.com/kuzdogan",
      "followers_url": "https://api.github.com/users/kuzdogan/followers",
      "following_url": "https://api.github.com/users/kuzdogan/following{/other_user}",
      "gists_url": "https://api.github.com/users/kuzdogan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kuzdogan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kuzdogan/subscriptions",
      "organizations_url": "https://api.github.com/users/kuzdogan/orgs",
      "repos_url": "https://api.github.com/users/kuzdogan/repos",
      "events_url": "https://api.github.com/users/kuzdogan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kuzdogan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-11T04:55:36Z",
    "updated_at": "2023-08-11T04:55:36Z",
    "author_association": "MEMBER",
    "body": "Hi, just came across this. \r\n\r\nCorrect that if you have factories you might have nested CBOR metadata hashes in the bytecode. There is not foolproof way to know where exactly the nested CBOR part will be. This might change with EOF. For now, a good workaround is to add a small comment in the nested contract (factory) and compare the first bytecode against the one with the comments. The differences should be in the factory contract's metadata hash and the main contract's.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1674211362/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1884480657",
    "html_url": "https://github.com/ethereum/solidity/issues/14331#issuecomment-1884480657",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14331",
    "id": 1884480657,
    "node_id": "IC_kwDOAm_5kc5wUuSR",
    "user": {
      "login": "nikola-matic",
      "id": 4415530,
      "node_id": "MDQ6VXNlcjQ0MTU1MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4415530?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikola-matic",
      "html_url": "https://github.com/nikola-matic",
      "followers_url": "https://api.github.com/users/nikola-matic/followers",
      "following_url": "https://api.github.com/users/nikola-matic/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikola-matic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikola-matic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikola-matic/subscriptions",
      "organizations_url": "https://api.github.com/users/nikola-matic/orgs",
      "repos_url": "https://api.github.com/users/nikola-matic/repos",
      "events_url": "https://api.github.com/users/nikola-matic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikola-matic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-10T09:27:51Z",
    "updated_at": "2024-01-10T09:27:51Z",
    "author_association": "MEMBER",
    "body": "Closing as not a bug; thanks to @kuzdogan who elaborated above.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1884480657/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
