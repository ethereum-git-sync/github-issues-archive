{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/11916",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/11916/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/11916/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/11916/events",
  "html_url": "https://github.com/ethereum/solidity/issues/11916",
  "id": 992145696,
  "node_id": "MDU6SXNzdWU5OTIxNDU2OTY=",
  "number": 11916,
  "title": "[isoltest] Command-line options are not validated",
  "user": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    },
    {
      "id": 1012613901,
      "node_id": "MDU6TGFiZWwxMDEyNjEzOTAx",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/easy%20difficulty",
      "name": "easy difficulty",
      "color": "0b3f89",
      "default": false,
      "description": ""
    },
    {
      "id": 1018738457,
      "node_id": "MDU6TGFiZWwxMDE4NzM4NDU3",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/testing%20:hammer:",
      "name": "testing :hammer:",
      "color": "ffc6db",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "hawkess",
    "id": 50639790,
    "node_id": "MDQ6VXNlcjUwNjM5Nzkw",
    "avatar_url": "https://avatars.githubusercontent.com/u/50639790?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hawkess",
    "html_url": "https://github.com/hawkess",
    "followers_url": "https://api.github.com/users/hawkess/followers",
    "following_url": "https://api.github.com/users/hawkess/following{/other_user}",
    "gists_url": "https://api.github.com/users/hawkess/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hawkess/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hawkess/subscriptions",
    "organizations_url": "https://api.github.com/users/hawkess/orgs",
    "repos_url": "https://api.github.com/users/hawkess/repos",
    "events_url": "https://api.github.com/users/hawkess/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hawkess/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "hawkess",
      "id": 50639790,
      "node_id": "MDQ6VXNlcjUwNjM5Nzkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/50639790?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hawkess",
      "html_url": "https://github.com/hawkess",
      "followers_url": "https://api.github.com/users/hawkess/followers",
      "following_url": "https://api.github.com/users/hawkess/following{/other_user}",
      "gists_url": "https://api.github.com/users/hawkess/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hawkess/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hawkess/subscriptions",
      "organizations_url": "https://api.github.com/users/hawkess/orgs",
      "repos_url": "https://api.github.com/users/hawkess/repos",
      "events_url": "https://api.github.com/users/hawkess/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hawkess/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-09-09T12:05:59Z",
  "updated_at": "2021-09-22T15:43:45Z",
  "closed_at": "2021-09-22T15:43:45Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n[CommonOptions::validate()](https://github.com/ethereum/solidity/blob/v0.8.7/test/Common.cpp#L112-L137) is responsible for validating command-line options passed to `soltest` and `isoltest`. It only runs in `soltest` though. In `isoltest` command-line parameters are not validated.\r\n\r\n## Environment\r\n- Compiler version: `0.8.8-develop.2021.9.9+commit.f6eecb8c.mod.Linux.g++`\r\n- Operating system: Arch Linux\r\n\r\n## Steps to Reproduce\r\n\r\nIn `soltest` it works as expected:\r\n```bash\r\nsoltest -- --enforce-gas-cost --evm-version spuriousDragon\r\n```\r\n```\r\nTest setup error: /solidity/test/Common.cpp(127): Throw in function virtual void solidity::test::CommonOptions::validate() const\r\nDynamic exception type: boost::wrapexcept<solidity::test::ConfigException>\r\nstd::exception::what: Gas costs can only be enforced on latest evm version.\r\n[solidity::util::tag_comment*] = Gas costs can only be enforced on latest evm version.\r\n```\r\nBut for some reason it is not executed in `isoltest`:\r\n```bash\r\nisoltest --enforce-gas-cost --evm-version spuriousDragon\r\n```\r\n```\r\nRunning tests...\r\n```",
  "closed_by": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/11916/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/11916/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/921814914",
    "html_url": "https://github.com/ethereum/solidity/issues/11916#issuecomment-921814914",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11916",
    "id": 921814914,
    "node_id": "IC_kwDOAm_5kc428ceC",
    "user": {
      "login": "hawkess",
      "id": 50639790,
      "node_id": "MDQ6VXNlcjUwNjM5Nzkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/50639790?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hawkess",
      "html_url": "https://github.com/hawkess",
      "followers_url": "https://api.github.com/users/hawkess/followers",
      "following_url": "https://api.github.com/users/hawkess/following{/other_user}",
      "gists_url": "https://api.github.com/users/hawkess/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hawkess/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hawkess/subscriptions",
      "organizations_url": "https://api.github.com/users/hawkess/orgs",
      "repos_url": "https://api.github.com/users/hawkess/repos",
      "events_url": "https://api.github.com/users/hawkess/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hawkess/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-17T13:53:09Z",
    "updated_at": "2021-09-17T14:22:36Z",
    "author_association": "NONE",
    "body": "I'd like to handle this issue, but I have some questions about intended behavior. \r\n\r\nCurrently, there are flags that are [hardcoded](https://github.com/ethereum/solidity/blob/20ca5c13617b923e559044213c49445d365511d4/test/tools/IsolTestOptions.cpp#L79-L81) to always default to a certain value in the IsolTestOptions class regardless of command line arguments. Is this intended behavior that should be preserved? \r\n\r\nIf so, that introduces another bug as the parse function would always overwrite the enforceGasTest boolean such that the CommonOptions validation would never print a message even if there were an evm version mismatch because the command line flag would just be toggled off and the test would run anyway. So should that behavior be changed while leaving the other two defaults intact, or should all values be set based solely on the command line flags to allow for full validation and customization at the expense of current default behavior?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/921814914/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/921882657",
    "html_url": "https://github.com/ethereum/solidity/issues/11916#issuecomment-921882657",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11916",
    "id": 921882657,
    "node_id": "IC_kwDOAm_5kc428tAh",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-17T15:21:46Z",
    "updated_at": "2021-09-17T15:21:46Z",
    "author_association": "MEMBER",
    "body": "@hawkess Good observation. This is not how these options were meant to work :) We should remove these hard-coded values and just set them as defaults. All values should come from command-line flags. I don't think people expect the current behavior. I surely didn't :)\r\n\r\nI think it was done this way because option definitions are in `CommonOptions` and that's where you would need to add defaults. So we should either find a way to change them after the fact (not sure if `program_options` allows that) or just pass the defaults we want as arguments to `CommonOptions` constructor.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/921882657/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/922031345",
    "html_url": "https://github.com/ethereum/solidity/issues/11916#issuecomment-922031345",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11916",
    "id": 922031345,
    "node_id": "IC_kwDOAm_5kc429RTx",
    "user": {
      "login": "hawkess",
      "id": 50639790,
      "node_id": "MDQ6VXNlcjUwNjM5Nzkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/50639790?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hawkess",
      "html_url": "https://github.com/hawkess",
      "followers_url": "https://api.github.com/users/hawkess/followers",
      "following_url": "https://api.github.com/users/hawkess/following{/other_user}",
      "gists_url": "https://api.github.com/users/hawkess/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hawkess/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hawkess/subscriptions",
      "organizations_url": "https://api.github.com/users/hawkess/orgs",
      "repos_url": "https://api.github.com/users/hawkess/repos",
      "events_url": "https://api.github.com/users/hawkess/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hawkess/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-17T19:29:32Z",
    "updated_at": "2021-09-18T08:54:37Z",
    "author_association": "NONE",
    "body": "After tackling this for a while, it seems that the command line options interface in its current form cannot support `true` defaults for a boolean option without rendering the option obsolete. For `bool_switch`es (which all options currently use), the created value_semantic won't accept any explicit value. If the option is present on the command line, the value will be `true` and you can't supply `false`, meaning a `bool_swtich()->default_value(true)` is always on, in which case moving the defaults as an argument to the `CommonOptions` constructor does little to solve the problem. \r\n\r\nA small hack using `enforceGasTest = enforceGasTest || (evmVersion() == langutil::EVMVersion{});` will produce the expected errors for validation and retain current default behavior, but for the long-term a change to the `CommonOptions` such that each option is a `value<bool>` so they accept explicit boolean values appears to be the most rational approach. However that modifies the user-facing cli and seems out of scope for this issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/922031345/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/922949018",
    "html_url": "https://github.com/ethereum/solidity/issues/11916#issuecomment-922949018",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11916",
    "id": 922949018,
    "node_id": "IC_kwDOAm_5kc43AxWa",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-20T13:53:46Z",
    "updated_at": "2021-09-20T13:53:46Z",
    "author_association": "MEMBER",
    "body": "> but for the long-term a change to the `CommonOptions` such that each option is a `value<bool>` so they accept explicit boolean values appears to be the most rational approach. However that modifies the user-facing cli and seems out of scope for this issue.\r\n\r\nYou mean something like `isoltest --enforce-gas-cost true`/`isoltest --enforce-gas-cost false`? That would be inconsistent with how `solc` does it. I think it's more typical for CLI programs to have a `--no-XXX` version of the flag as I suggested in https://github.com/ethereum/solidity/pull/11996#discussion_r712128764.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/922949018/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/922991391",
    "html_url": "https://github.com/ethereum/solidity/issues/11916#issuecomment-922991391",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11916",
    "id": 922991391,
    "node_id": "IC_kwDOAm_5kc43A7sf",
    "user": {
      "login": "hawkess",
      "id": 50639790,
      "node_id": "MDQ6VXNlcjUwNjM5Nzkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/50639790?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hawkess",
      "html_url": "https://github.com/hawkess",
      "followers_url": "https://api.github.com/users/hawkess/followers",
      "following_url": "https://api.github.com/users/hawkess/following{/other_user}",
      "gists_url": "https://api.github.com/users/hawkess/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hawkess/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hawkess/subscriptions",
      "organizations_url": "https://api.github.com/users/hawkess/orgs",
      "repos_url": "https://api.github.com/users/hawkess/repos",
      "events_url": "https://api.github.com/users/hawkess/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hawkess/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-20T14:41:00Z",
    "updated_at": "2021-09-20T14:41:49Z",
    "author_association": "NONE",
    "body": "There is a `program_options` method for setting implciit values, so you could still use `--enforce-gas-cost` with no argument or `--enforce-gas-cost=false`, but it does alter the auto-generated help signature to show `--enforce-gas-cost arg` which might not be desirable since the arg is actually optional.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/922991391/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/923109772",
    "html_url": "https://github.com/ethereum/solidity/issues/11916#issuecomment-923109772",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11916",
    "id": 923109772,
    "node_id": "IC_kwDOAm_5kc43BYmM",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-20T17:02:21Z",
    "updated_at": "2021-09-20T17:02:21Z",
    "author_association": "MEMBER",
    "body": "I think we could live with these booleans being listed on the help screen. That's actually a nice idea. Less hassle than having to define the `--no-` variants separately. I'm not sure if we'd go for that in `solc` but `soltest` is an internal tool so I would not be against changing it here.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/923109772/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
