{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12718",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12718/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12718/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12718/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12718",
  "id": 1151877259,
  "node_id": "I_kwDOAm_5kc5EqECL",
  "number": 12718,
  "title": "`abi.encodeCall` does not properly convert the function type to an externally-called function",
  "user": {
    "login": "zemse",
    "id": 22412996,
    "node_id": "MDQ6VXNlcjIyNDEyOTk2",
    "avatar_url": "https://avatars.githubusercontent.com/u/22412996?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zemse",
    "html_url": "https://github.com/zemse",
    "followers_url": "https://api.github.com/users/zemse/followers",
    "following_url": "https://api.github.com/users/zemse/following{/other_user}",
    "gists_url": "https://api.github.com/users/zemse/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zemse/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zemse/subscriptions",
    "organizations_url": "https://api.github.com/users/zemse/orgs",
    "repos_url": "https://api.github.com/users/zemse/repos",
    "events_url": "https://api.github.com/users/zemse/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zemse/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    },
    {
      "id": 2376134343,
      "node_id": "MDU6TGFiZWwyMzc2MTM0MzQz",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/should%20compile%20without%20error",
      "name": "should compile without error",
      "color": "c48f13",
      "default": false,
      "description": "Error is reported even though it shouldn't. Source is fine."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2022-02-26T15:25:08Z",
  "updated_at": "2022-03-24T14:16:56Z",
  "closed_at": "2022-03-24T14:16:56Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Abstract\r\n\r\n<!--Please describe by example what problem you see in the current Solidity language and reason about it.-->\r\n\r\nThe following gives an error:\r\n\r\n```solidity\r\npragma solidity 0.8.12;\r\n\r\ncontract Sender {\r\n    function main(string memory helloworld) external {\r\n        // TypeError: Cannot implicitly convert component at position 0 from \"string\" to \"string\".\r\n        abi.encodeCall(IReceiver.methodName, (helloworld));\r\n    }\r\n}\r\n\r\ninterface IReceiver {\r\n    function methodName(string calldata) external;\r\n}\r\n```\r\n\r\n## Motivation\r\n\r\nWhen encoding data for a call, it shouldn't really matter if it's calldata or memory. If the interface has calldata, but if the value that we want to pass is in memory, it triggers the typecheck error abi.encodeCall. \r\n\r\n## Specification\r\n\r\n<!--The technical specification should describe the syntax and semantics of any new feature. The specification should be detailed enough to allow any developer to implement the functionality.-->\r\n\r\nabi.encodeCall should not typecheck data location.\r\n\r\n## Backwards Compatibility\r\n\r\n<!--\r\nAll language changes that introduce backwards incompatibilities must include a section describing these incompatibilities and their severity.\r\n\r\nPlease describe how you propose to deal with these incompatibilities.\r\n-->\r\n\r\nThis should not have any breakings.",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12718/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12718/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1054135845",
    "html_url": "https://github.com/ethereum/solidity/issues/12718#issuecomment-1054135845",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12718",
    "id": 1054135845,
    "node_id": "IC_kwDOAm_5kc4-1NYl",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-28T11:00:21Z",
    "updated_at": "2022-02-28T11:00:21Z",
    "author_association": "MEMBER",
    "body": "My first guess is that the function we encode to has not been properly converted to an external view, i.e. we have to convert the type to the same we convert when we perform an external call.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1054135845/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1059246913",
    "html_url": "https://github.com/ethereum/solidity/issues/12718#issuecomment-1059246913",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12718",
    "id": 1059246913,
    "node_id": "IC_kwDOAm_5kc4_ItNB",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-04T15:11:22Z",
    "updated_at": "2022-03-04T15:11:22Z",
    "author_association": "MEMBER",
    "body": "To be more precise: ``TypeChecker::typeCheckABIEncodeCallFunction`` should probably type-check the arguments on ``functionPointerType->asExternallyCallableFunction`` instead of the plain function type.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1059246913/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1064293732",
    "html_url": "https://github.com/ethereum/solidity/issues/12718#issuecomment-1064293732",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12718",
    "id": 1064293732,
    "node_id": "IC_kwDOAm_5kc4_b9Vk",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-10T17:05:11Z",
    "updated_at": "2022-03-10T17:05:55Z",
    "author_association": "MEMBER",
    "body": "Just for reference since this is not included in the description. The error on 0.8.12 is:\r\n```\r\nError: Cannot implicitly convert component at position 0 from \"string\" to \"string\".\r\n --> test.sol:6:46:\r\n  |\r\n6 |         abi.encodeCall(IReceiver.methodName, (helloworld));\r\n  |                                              ^^^^^^^^^^^^\r\n```\r\n\r\n**EDIT**: Oh, just noticed that it's there but as a comment.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1064293732/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1064322093",
    "html_url": "https://github.com/ethereum/solidity/issues/12718#issuecomment-1064322093",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12718",
    "id": 1064322093,
    "node_id": "IC_kwDOAm_5kc4_cEQt",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-10T17:36:02Z",
    "updated_at": "2022-03-10T18:47:14Z",
    "author_association": "MEMBER",
    "body": "Similar failing cases:\r\n### `storage` vs `calldata`\r\n```solidity\r\ninterface I {\r\n    function f(string calldata) external;\r\n}\r\n\r\ncontract C {\r\n    string s;\r\n    function main() external view {\r\n        abi.encodeCall(I.f, (s));\r\n    }\r\n}\r\n```\r\n```\r\nError: Cannot implicitly convert component at position 0 from \"string\" to \"string\".\r\n --> test.sol:8:29:\r\n  |\r\n8 |         abi.encodeCall(I.f, (s));\r\n  |                             ^^^\r\n```\r\nInterestingly it does not fail if you change `calldata` to `memory` even though in that case types are still different.\r\n\r\n### Function pointer\r\n``` solidity\r\ninterface I {\r\n    function f(function (string calldata) external) external;\r\n}\r\n\r\ncontract C {\r\n    function g(string calldata) external {}\r\n\r\n    function main() external view {\r\n        abi.encodeCall(I.f, (this.g));\r\n    }\r\n}\r\n```\r\n```\r\nError: Cannot implicitly convert component at position 0 from \"function\" to \"function\".\r\n --> test.sol:9:29:\r\n  |\r\n9 |         abi.encodeCall(I.f, (this.g));\r\n  |                             ^^^^^^^^\r\n```\r\nThis does not happen if you replace `calldata` with `memory`.\r\n\r\n### ~`address payable`~\r\n**EDIT**: This is one is also not implicitly convertible. It should be the other way around (`address` in the function and `payable` as argument) and in that case it compiles without errors. But again, the types listed in the error message should be more detailed because now it looks like they're identical.\r\n```solidity\r\ninterface I {\r\n    function f(address payable) external;\r\n}\r\n\r\ncontract C {\r\n    function main() external view {\r\n        abi.encodeCall(I.f, (address(0)));\r\n    }\r\n}\r\n```\r\n```\r\nError: Cannot implicitly convert component at position 0 from \"address\" to \"address\".\r\n --> test.sol:7:29:\r\n  |\r\n7 |         abi.encodeCall(I.f, (address(0)));\r\n  |                             ^^^^^^^^^^^^\r\n```\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1064322093/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1064378079",
    "html_url": "https://github.com/ethereum/solidity/issues/12718#issuecomment-1064378079",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12718",
    "id": 1064378079,
    "node_id": "IC_kwDOAm_5kc4_cR7f",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-10T18:44:06Z",
    "updated_at": "2022-03-10T18:44:06Z",
    "author_association": "MEMBER",
    "body": "I created a new issue to improve the types in the error message: #12776. They're not detailed enough which makes it harder to see what's wrong.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1064378079/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1064480686",
    "html_url": "https://github.com/ethereum/solidity/issues/12718#issuecomment-1064480686",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12718",
    "id": 1064480686,
    "node_id": "IC_kwDOAm_5kc4_cq-u",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-10T20:36:30Z",
    "updated_at": "2022-03-10T20:36:30Z",
    "author_association": "MEMBER",
    "body": "@ekpyron pointed out that the function call is a more general problem (not limited only to `abi.encodeCall()` so I reported it as a separate issue: #12778.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1064480686/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
