{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/6147",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/6147/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/6147/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/6147/events",
  "html_url": "https://github.com/ethereum/solidity/issues/6147",
  "id": 415916919,
  "node_id": "MDU6SXNzdWU0MTU5MTY5MTk=",
  "number": 6147,
  "title": "Different JSON ABI output between storage & memory struct function parameters",
  "user": {
    "login": "e-r-w",
    "id": 6636911,
    "node_id": "MDQ6VXNlcjY2MzY5MTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6636911?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/e-r-w",
    "html_url": "https://github.com/e-r-w",
    "followers_url": "https://api.github.com/users/e-r-w/followers",
    "following_url": "https://api.github.com/users/e-r-w/following{/other_user}",
    "gists_url": "https://api.github.com/users/e-r-w/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/e-r-w/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/e-r-w/subscriptions",
    "organizations_url": "https://api.github.com/users/e-r-w/orgs",
    "repos_url": "https://api.github.com/users/e-r-w/repos",
    "events_url": "https://api.github.com/users/e-r-w/events{/privacy}",
    "received_events_url": "https://api.github.com/users/e-r-w/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2019-03-01T02:51:26Z",
  "updated_at": "2019-03-13T14:34:47Z",
  "closed_at": "2019-03-13T14:34:47Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!--## Prerequisites\r\n\r\n- First, many thanks for taking part in the community. We really appreciate that.\r\n- We realize there is a lot of information requested here. We ask only that you do your best to provide as much information as possible so we can better help you.\r\n- Support questions are better asked in one of the following locations:\r\n\t- [Solidity chat](https://gitter.im/ethereum/solidity)\r\n\t- [Stack Overflow](https://ethereum.stackexchange.com/)\r\n- Ensure the issue isn't already reported.\r\n- The issue should be reproducible with the latest solidity version; however, this isn't a hard requirement and being reproducible with an older version is sufficient.\r\n-->\r\n\r\n## Description\r\n\r\nSolidity ABI output produces different results for structs that have `memory` and `storage` location. This causes problems in code libraries interpreting the ABI (namely ethers-js). Structs specified in `memory` appear to have their type encoded as `tuple`s as expected, but if specified as storage, the type is changed  to the name of the struct (see example below)\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.5.0\r\n- Target EVM version (as per compiler settings): 0.5.0\r\n- Framework/IDE (e.g. Truffle or Remix): n/a\r\n- EVM execution environment / backend / blockchain client: n/a\r\n- Operating system: macOS 10.13.6\r\n\r\n## Steps to Reproduce\r\n\r\nGiven a library contract:\r\n\r\n```\r\npragma solidity 0.5.0;\r\npragma experimental ABIEncoderV2;\r\n\r\nlibrary Foo {\r\n    struct Bar {\r\n        string baz;\r\n    }\r\n\r\n    function getBaz(Bar memory bar) public view returns (string memory) {\r\n        return bar.baz;\r\n    }\r\n}\r\n```\r\n\r\n`solc --abi Foo.sol` produces:\r\n\r\n```json\r\n[\r\n  {\r\n    \"constant\": true,\r\n    \"inputs\": [\r\n      {\r\n        \"components\": [{ \"name\": \"baz\", \"type\": \"string\" }],\r\n        \"name\": \"bar\",\r\n        \"type\": \"tuple\"\r\n      }\r\n    ],\r\n    \"name\": \"getBaz\",\r\n    \"outputs\": [{ \"name\": \"\", \"type\": \"string\" }],\r\n    \"payable\": false,\r\n    \"stateMutability\": \"view\",\r\n    \"type\": \"function\"\r\n  }\r\n]\r\n```\r\n\r\nHowever when we change `getBaz(Bar memory bar)` to `getBaz(Bar storage bar)`, the output changes to:\r\n\r\n```json\r\n[\r\n  {\r\n    \"constant\": true,\r\n    \"inputs\": [{ \"name\": \"bar\", \"type\": \"Foo.Bar storage\" }],\r\n    \"name\": \"getBaz\",\r\n    \"outputs\": [{ \"name\": \"\", \"type\": \"string\" }],\r\n    \"payable\": false,\r\n    \"stateMutability\": \"view\",\r\n    \"type\": \"function\"\r\n  }\r\n]\r\n```\r\n\r\nWhere the function parameter type is no longer described as a `tuple` but rather a `Foo.Bar storage`. I'm not entirely sure but this doesn't seem like the intended behaviour?\r\n\r\nThanks!",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/6147/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/6147/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/468629635",
    "html_url": "https://github.com/ethereum/solidity/issues/6147#issuecomment-468629635",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6147",
    "id": 468629635,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2ODYyOTYzNQ==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-01T11:05:41Z",
    "updated_at": "2019-03-01T11:05:41Z",
    "author_association": "MEMBER",
    "body": "I think `getBaz(Bar storage bar)` shouldn't be allowed in contracts, only in libraries. This is the real bug here.\r\n\r\nThe point of this feature is to avoid copying to memory, but allowing helpers in libraries to be written over storage references. It is not possible to ABI decode this through external interaction with the contract.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/468629635/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/469080742",
    "html_url": "https://github.com/ethereum/solidity/issues/6147#issuecomment-469080742",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6147",
    "id": 469080742,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2OTA4MDc0Mg==",
    "user": {
      "login": "e-r-w",
      "id": 6636911,
      "node_id": "MDQ6VXNlcjY2MzY5MTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6636911?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/e-r-w",
      "html_url": "https://github.com/e-r-w",
      "followers_url": "https://api.github.com/users/e-r-w/followers",
      "following_url": "https://api.github.com/users/e-r-w/following{/other_user}",
      "gists_url": "https://api.github.com/users/e-r-w/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/e-r-w/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/e-r-w/subscriptions",
      "organizations_url": "https://api.github.com/users/e-r-w/orgs",
      "repos_url": "https://api.github.com/users/e-r-w/repos",
      "events_url": "https://api.github.com/users/e-r-w/events{/privacy}",
      "received_events_url": "https://api.github.com/users/e-r-w/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-04T00:09:38Z",
    "updated_at": "2019-03-04T00:09:38Z",
    "author_association": "NONE",
    "body": "> I think getBaz(Bar storage bar) shouldn't be allowed in contracts, only in libraries. This is the real bug here.\r\n\r\nWhile I can agree that storage arguments shouldn't be allowed in contracts, this behaviour will still cause bugs in client libraries interpreting the ABI of solidity libraries, for example:\r\n\r\n```js\r\n// inside of some javascript library that deals with solidity contracts\r\nfunction parseAbi(abiJson) {\r\n  // ...\r\n  let type = '';\r\n  switch(input.type) { // where input.type = 'Foo.Bar storage'\r\n\tcase 'string':\r\n\t  type = Enum.StringType;\r\n    case 'uint':\r\n      type = Enum.UnsignedInt;\r\n    // ... other known solidity types/tuples ...\r\n    default:\r\n      throw new Error('Do not understand this type:' + input.type);\r\n    /* an error is thrown here because the client library obviously \r\n     doesn't know anything about our solidity library Foo types */\r\n  }\r\n}\r\n\r\n```\r\n\r\nIf that behaviour is intended, then I'd file a bug with the client library to perhaps handle storage arguments being output like it currently does. Otherwise it sounds like the solidity compiler should output `tuple` types for storage arguments, although I've no idea what sort of knock-on effects that would have to the broader ecosystem?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/469080742/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/469201524",
    "html_url": "https://github.com/ethereum/solidity/issues/6147#issuecomment-469201524",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6147",
    "id": 469201524,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2OTIwMTUyNA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-04T10:29:09Z",
    "updated_at": "2019-03-04T10:29:09Z",
    "author_association": "MEMBER",
    "body": "I think this is a duplicate of https://github.com/ethereum/solidity/issues/3409",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/469201524/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/472447717",
    "html_url": "https://github.com/ethereum/solidity/issues/6147#issuecomment-472447717",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6147",
    "id": 472447717,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MjQ0NzcxNw==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-13T14:34:47Z",
    "updated_at": "2019-03-13T14:34:47Z",
    "author_association": "MEMBER",
    "body": "Closing as the duplicate is fixed now.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/472447717/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
