{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12346",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12346/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12346/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12346/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12346",
  "id": 1066586014,
  "node_id": "I_kwDOAm_5kc4_ks-e",
  "number": 12346,
  "title": "Stop-after: full AST is available",
  "user": {
    "login": "frangio",
    "id": 481465,
    "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/frangio",
    "html_url": "https://github.com/frangio",
    "followers_url": "https://api.github.com/users/frangio/followers",
    "following_url": "https://api.github.com/users/frangio/following{/other_user}",
    "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
    "organizations_url": "https://api.github.com/users/frangio/orgs",
    "repos_url": "https://api.github.com/users/frangio/repos",
    "events_url": "https://api.github.com/users/frangio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/frangio/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-11-29T22:57:36Z",
  "updated_at": "2021-11-30T13:10:21Z",
  "closed_at": "2021-11-30T12:37:24Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "The information contained in the AST is really useful. I think it's one of the best things about the compiler. In particular, I really appreciate stuff like `linearizedBaseContracts`, `referencedDeclaration`, `typeDescriptions`, `baseFunctions`, etc.\r\n\r\nIf I want all this information, as far as I know I currently need to run the full compiler pipeline. I assume (let me know if this is false) a significant speedup would be gained if it was possible to only request the full AST. I am wondering if it's possible to add an option to the `stopAfter` setting to do this.\r\n\r\nOne use case I have in mind is my [hardhat-exposed](https://github.com/frangio/hardhat-exposed) plugin where I generate Solidity contracts that automatically expose internal functions for testing. For this plugin I need to use most of the AST data I listed above. In my experience, any program that works with the AST eventually needs to know at least `referencedDeclaration`.",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12346/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12346/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/982566236",
    "html_url": "https://github.com/ethereum/solidity/issues/12346#issuecomment-982566236",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12346",
    "id": 982566236,
    "node_id": "IC_kwDOAm_5kc46kMVc",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-30T11:55:17Z",
    "updated_at": "2021-11-30T11:55:17Z",
    "author_association": "MEMBER",
    "body": "We have this stage internally, but do not expose it. Depending on the interface, just not requesting any output that requires the bytecode should have the same effect. How do you interface to the compiler again?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/982566236/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/982567291",
    "html_url": "https://github.com/ethereum/solidity/issues/12346#issuecomment-982567291",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12346",
    "id": 982567291,
    "node_id": "IC_kwDOAm_5kc46kMl7",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-30T11:56:52Z",
    "updated_at": "2021-11-30T11:56:52Z",
    "author_association": "MEMBER",
    "body": "Looks doable and pretty easy but I can't say exactly if savings would be worth it. `referencedDeclaration` is filled out by `TypeChecker` which runs somewhere in the middle of [analysis](https://github.com/ethereum/solidity/blob/2f95f3c6c6a2b68c58925fbc1f7f2f165e279602/libsolidity/interface/CompilerStack.cpp#L428-L580).\r\n\r\nFrom a technical perspective it's no problem to add another value to `stopAfter` and slap an `if` to short-circuit it just after type checker (or any other part of the analysis for that matter), it's mostly a question of which stopping points make sense from the perspective of compiler's interface.\r\n\r\nAlso there are some implicit dependencies between analysis phases and such a partially filled AST output gets much less testing than a full run.\r\n\r\nBut overall looks like mostly a matter of making a design decision.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/982567291/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/982583793",
    "html_url": "https://github.com/ethereum/solidity/issues/12346#issuecomment-982583793",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12346",
    "id": 982583793,
    "node_id": "IC_kwDOAm_5kc46kQnx",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-30T12:19:59Z",
    "updated_at": "2021-11-30T12:19:59Z",
    "author_association": "MEMBER",
    "body": "> We have this stage internally, but do not expose it. Depending on the interface, just not requesting any output that requires the bytecode should have the same effect.\r\n\r\nThat's a good point. I assumed it would not be enough because you can already do that by not requesting bytecode. But maybe that's actually enough for this use case? I have never tried to profile how much analysis takes relative to codegen - is the codegen that much heavier?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/982583793/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/982586002",
    "html_url": "https://github.com/ethereum/solidity/issues/12346#issuecomment-982586002",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12346",
    "id": 982586002,
    "node_id": "IC_kwDOAm_5kc46kRKS",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-30T12:22:48Z",
    "updated_at": "2021-11-30T12:22:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "If you can confirm that not requesting bytecode should have the same effect I think we can close this issue. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/982586002/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/982621770",
    "html_url": "https://github.com/ethereum/solidity/issues/12346#issuecomment-982621770",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12346",
    "id": 982621770,
    "node_id": "IC_kwDOAm_5kc46kZ5K",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-30T13:10:20Z",
    "updated_at": "2021-11-30T13:10:20Z",
    "author_association": "MEMBER",
    "body": "Yeah. The compiler internally only generates artifacts on demand.\r\n\r\nJust with one caveat (that only applies if you're **not** using Standard JSON): on the CLI this behavior has been introduced very recently (in 0.8.8, #11895). Before that the output for `--bin` would always be generated, even if not requested. Standard JSON had this behavior all along.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/982621770/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
