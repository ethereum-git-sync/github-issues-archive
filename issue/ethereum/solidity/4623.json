{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/4623",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/4623/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/4623/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/4623/events",
  "html_url": "https://github.com/ethereum/solidity/issues/4623",
  "id": 345798466,
  "node_id": "MDU6SXNzdWUzNDU3OTg0NjY=",
  "number": 4623,
  "title": "`--allow-paths` does not resolve relative paths correctly",
  "user": {
    "login": "lorenzb",
    "id": 1148586,
    "node_id": "MDQ6VXNlcjExNDg1ODY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1148586?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lorenzb",
    "html_url": "https://github.com/lorenzb",
    "followers_url": "https://api.github.com/users/lorenzb/followers",
    "following_url": "https://api.github.com/users/lorenzb/following{/other_user}",
    "gists_url": "https://api.github.com/users/lorenzb/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lorenzb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lorenzb/subscriptions",
    "organizations_url": "https://api.github.com/users/lorenzb/orgs",
    "repos_url": "https://api.github.com/users/lorenzb/repos",
    "events_url": "https://api.github.com/users/lorenzb/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lorenzb/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    },
    {
      "id": 2376134343,
      "node_id": "MDU6TGFiZWwyMzc2MTM0MzQz",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/should%20compile%20without%20error",
      "name": "should compile without error",
      "color": "c48f13",
      "default": false,
      "description": "Error is reported even though it shouldn't. Source is fine."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2018-07-30T15:05:46Z",
  "updated_at": "2021-09-27T13:39:15Z",
  "closed_at": "2021-09-27T13:39:15Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I ran into some ergonomics issues related to `--allow-paths` and symlinks.\r\n\r\n## Problem description\r\n\r\nSay I have two contracts `Foo` (in `foo.sol`) and `Bar` (in `bar/bar.sol`) and assume that `foo.sol` imports `bar/bar.sol`.\r\n\r\nThis obviously works:\r\n```\r\n$ tree -l\r\n.\r\n├── bar\r\n│   └── bar.sol\r\n└── foo.sol\r\n\r\n$ solc foo.sol --metadata\r\n[...]\r\n```\r\n\r\nIf we move `bar.sol` behind a symlink, everything still works:\r\n```\r\n$ tree -l\r\n.\r\n├── bar -> bar2\r\n│   └── bar.sol\r\n├── bar2\r\n│   └── bar.sol\r\n└── foo.sol\r\n\r\n$ solc foo.sol --metadata\r\n[...]\r\n```\r\n\r\n... or not, depending on where the symlink points to:\r\n```\r\n$ tree -l\r\n.\r\n├── bar -> ../bar2/\r\n│   └── bar.sol\r\n└── foo.sol\r\n\r\n$ solc foo.sol --metadata\r\nfoo.sol:1:1: Error: Source \"bar/bar.sol\" not found: File outside of allowed directories.\r\n```\r\n\r\nWeird, maybe I just need to add `bar` as an allowed directory?\r\n```\r\n$ solc foo.sol --metadata --allow-paths bar\r\nfoo.sol:1:1: Error: Source \"bar/bar.sol\" not found: File outside of allowed directories.\r\n```\r\n\r\nNope, not working. Maybe I should try resolving the symlink?\r\n```\r\n$ solc foo.sol --metadata --allow-paths ../bar2\r\nfoo.sol:1:1: Error: Source \"bar/bar.sol\" not found: File outside of allowed directories.\r\n```\r\n\r\nHmm, that doesn't work. (See also [this issue](https://github.com/ethereum/solidity/issues/2928).)\r\nBut this does:\r\n```\r\n$ solc foo.sol --metadata --allow-paths /absolute/path/to/bar2\r\n[...]\r\n```\r\n\r\nNote that `solc` generates identical metadata in all three cases that compile:\r\n```\r\n======= bar/bar.sol:Bar =======\r\nMetadata: \r\n{\"compiler\":{\"version\":\"0.4.24+commit.e67f0147\"},\"language\":\"Solidity\",\"output\":{\"abi\":[],\"devdoc\":{\"methods\":{}},\"userdoc\":{\"methods\":{}}},\"settings\":{\"compilationTarget\":{\"bar/bar.sol\":\"Bar\"},\"evmVersion\":\"byzantium\",\"libraries\":{},\"optimizer\":{\"enabled\":false,\"runs\":200},\"remappings\":[]},\"sources\":{\"bar/bar.sol\":{\"keccak256\":\"0x126b05c69a314dd4dc83ce9e9ffcb9832a1cb228f8d594b35ee9845d6cfa9a44\",\"urls\":[\"bzzr://09984546db62920903b6d6f760674a79af34d16306b6a963e19ad4ae35151d75\"]}},\"version\":1}\r\n\r\n======= foo.sol:Foo =======\r\nMetadata: \r\n{\"compiler\":{\"version\":\"0.4.24+commit.e67f0147\"},\"language\":\"Solidity\",\"output\":{\"abi\":[],\"devdoc\":{\"methods\":{}},\"userdoc\":{\"methods\":{}}},\"settings\":{\"compilationTarget\":{\"foo.sol\":\"Foo\"},\"evmVersion\":\"byzantium\",\"libraries\":{},\"optimizer\":{\"enabled\":false,\"runs\":200},\"remappings\":[]},\"sources\":{\"bar/bar.sol\":{\"keccak256\":\"0x126b05c69a314dd4dc83ce9e9ffcb9832a1cb228f8d594b35ee9845d6cfa9a44\",\"urls\":[\"bzzr://09984546db62920903b6d6f760674a79af34d16306b6a963e19ad4ae35151d75\"]},\"foo.sol\":{\"keccak256\":\"0x32ef0f192269bf14bcb7466f6f069813a9dc371eb9dca5d87426e8554bed0433\",\"urls\":[\"bzzr://ae450631ec9fe187bdfcbf2f01266637fddbe2b2ade5060ea50810e47a7f6703\"]}},\"version\":1}\r\n```\r\n\r\n## Suggestions\r\n*Can we improve this situation to make it more developer friendly?*\r\n\r\nHere are a few suggestions for resolving this issue:\r\n1. Follow symlinks (from what I gather, symlinks are currently not supported for security reasons. I must confess that I don't understand those reasons. Either you can trust your FS or you can't.)\r\n2. Allow --allow-paths to:\r\n2.1 resolve symlinks\r\n2.2 resolve relative paths\r\n3. If (1) and (2) are too controversial, at least:\r\n3.1 document the behavior \r\n3.2 detect that compilation failed due to a symlink/relative path, warn the user, and point them to the docs",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/4623/reactions",
    "total_count": 6,
    "+1": 4,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 2,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/4623/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/408896785",
    "html_url": "https://github.com/ethereum/solidity/issues/4623#issuecomment-408896785",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4623",
    "id": 408896785,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwODg5Njc4NQ==",
    "user": {
      "login": "relyt29",
      "id": 4326714,
      "node_id": "MDQ6VXNlcjQzMjY3MTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4326714?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/relyt29",
      "html_url": "https://github.com/relyt29",
      "followers_url": "https://api.github.com/users/relyt29/followers",
      "following_url": "https://api.github.com/users/relyt29/following{/other_user}",
      "gists_url": "https://api.github.com/users/relyt29/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/relyt29/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/relyt29/subscriptions",
      "organizations_url": "https://api.github.com/users/relyt29/orgs",
      "repos_url": "https://api.github.com/users/relyt29/repos",
      "events_url": "https://api.github.com/users/relyt29/events{/privacy}",
      "received_events_url": "https://api.github.com/users/relyt29/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-30T15:07:20Z",
    "updated_at": "2018-07-30T15:08:11Z",
    "author_association": "NONE",
    "body": "4. Add a \"force-follow-symlinks-unsafe-who-needs-security-anyways\" option\r\n\r\n(Edit: note I don't think this option is the best idea, just wanted to make it known that it is also an approach)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/408896785/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/410354669",
    "html_url": "https://github.com/ethereum/solidity/issues/4623#issuecomment-410354669",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4623",
    "id": 410354669,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMDM1NDY2OQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-03T19:34:34Z",
    "updated_at": "2018-08-03T19:34:34Z",
    "author_association": "MEMBER",
    "body": "Note that the metadata is identical because the physical paths on the machine you compile from are irrelevant for the metadata, only the virtual directory structure (with `foo.sol` at the root and `bar/bar.sol` inside that) is visible.\r\n\r\nAs far as I understand the problem, this just looks like relative paths are not properly taken into account for `--allowed-paths`, so basically my proposal would be to fix it according to (2).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/410354669/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/789961170",
    "html_url": "https://github.com/ethereum/solidity/issues/4623#issuecomment-789961170",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4623",
    "id": 789961170,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4OTk2MTE3MA==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-03T18:32:23Z",
    "updated_at": "2021-03-03T18:32:23Z",
    "author_association": "MEMBER",
    "body": "The reason symlinks are not followed is simply that it would make the whole feature pointless. You use it to whitelist specific directories and be sure that nothing outside them cannot be included in the contract. If the compiler followed symlinks, this could be trivially by passed by placing a symlink to any file on your filesystem inside one of the whitelisted directories.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/789961170/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/853225296",
    "html_url": "https://github.com/ethereum/solidity/issues/4623#issuecomment-853225296",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4623",
    "id": 853225296,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MzIyNTI5Ng==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-02T17:04:21Z",
    "updated_at": "2021-06-02T17:04:21Z",
    "author_association": "MEMBER",
    "body": "Just to clarify this issue: it's not really a problem with symlinks, relative paths without symlinks do not work properly either:\r\n```\r\n$ tree -l\r\n.\r\n├── bar2\r\n│   └── bar.sol\r\n└── foo.sol\r\n\r\n$ solc foo.sol --metadata --allow-paths ../bar2\r\n[...]\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/853225296/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
