{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12535",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12535/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12535/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12535/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12535",
  "id": 1103628292,
  "node_id": "I_kwDOAm_5kc5ByAgE",
  "number": 12535,
  "title": "[Logging] Indexed log topic differs between legacy and IR if explicitly downcast",
  "user": {
    "login": "bshastry",
    "id": 2388185,
    "node_id": "MDQ6VXNlcjIzODgxODU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bshastry",
    "html_url": "https://github.com/bshastry",
    "followers_url": "https://api.github.com/users/bshastry/followers",
    "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
    "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
    "organizations_url": "https://api.github.com/users/bshastry/orgs",
    "repos_url": "https://api.github.com/users/bshastry/repos",
    "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bshastry/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    },
    {
      "id": 2376132438,
      "node_id": "MDU6TGFiZWwyMzc2MTMyNDM4",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/codegen%20error",
      "name": "codegen error",
      "color": "000000",
      "default": false,
      "description": "Compiler generates invalid code. Critical."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "nishant-sachdeva",
    "id": 32475507,
    "node_id": "MDQ6VXNlcjMyNDc1NTA3",
    "avatar_url": "https://avatars.githubusercontent.com/u/32475507?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nishant-sachdeva",
    "html_url": "https://github.com/nishant-sachdeva",
    "followers_url": "https://api.github.com/users/nishant-sachdeva/followers",
    "following_url": "https://api.github.com/users/nishant-sachdeva/following{/other_user}",
    "gists_url": "https://api.github.com/users/nishant-sachdeva/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nishant-sachdeva/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nishant-sachdeva/subscriptions",
    "organizations_url": "https://api.github.com/users/nishant-sachdeva/orgs",
    "repos_url": "https://api.github.com/users/nishant-sachdeva/repos",
    "events_url": "https://api.github.com/users/nishant-sachdeva/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nishant-sachdeva/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "nishant-sachdeva",
      "id": 32475507,
      "node_id": "MDQ6VXNlcjMyNDc1NTA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/32475507?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nishant-sachdeva",
      "html_url": "https://github.com/nishant-sachdeva",
      "followers_url": "https://api.github.com/users/nishant-sachdeva/followers",
      "following_url": "https://api.github.com/users/nishant-sachdeva/following{/other_user}",
      "gists_url": "https://api.github.com/users/nishant-sachdeva/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nishant-sachdeva/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nishant-sachdeva/subscriptions",
      "organizations_url": "https://api.github.com/users/nishant-sachdeva/orgs",
      "repos_url": "https://api.github.com/users/nishant-sachdeva/repos",
      "events_url": "https://api.github.com/users/nishant-sachdeva/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nishant-sachdeva/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-01-14T13:18:17Z",
  "updated_at": "2022-01-31T14:25:58Z",
  "closed_at": "2022-01-28T17:52:17Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "```\r\ncontract C {\r\n  event ev0(bytes1 indexed);\r\n  constructor() {\r\n    emit ev0(bytes1(bytes16(0x31313131313131313131313131313131)));\r\n  }\r\n}\r\n// ====\r\n// compileViaYul: also\r\n// ----\r\n// constructor() ->\r\n// ~ emit ev0(bytes1): #\"1\"\r\n```\r\n\r\nLegacy truncates indexed log topic, while IR leaves it untruncated. This would lead to a divergence of blockchain state depending on which backend is used.\r\n\r\nTo reproduce\r\n\r\n```\r\n$ cp test.sol test/libsolidity/semanticTests\r\n$ isoltest -t semanticTests/test\r\n  Running via Yul:\r\n  Expected result:\r\n  // constructor() ->\r\n  // ~ emit ev0(bytes1): #\"1\"\r\n\r\n  Obtained result:\r\n  // constructor() ->\r\n  // ~ emit ev0(bytes1): #\"1111111111111111\"\r\n  \r\n  Attention: Updates on the test will apply the detected format displayed.\r\n  \r\n  Note that the test passed without Yul. \r\n```\r\n\r\nNote that the divergence is maintained with/without optimizer so I would guess this may be a bug related to truncation (or lack thereof) in Sol->Yul.",
  "closed_by": {
    "login": "nishant-sachdeva",
    "id": 32475507,
    "node_id": "MDQ6VXNlcjMyNDc1NTA3",
    "avatar_url": "https://avatars.githubusercontent.com/u/32475507?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nishant-sachdeva",
    "html_url": "https://github.com/nishant-sachdeva",
    "followers_url": "https://api.github.com/users/nishant-sachdeva/followers",
    "following_url": "https://api.github.com/users/nishant-sachdeva/following{/other_user}",
    "gists_url": "https://api.github.com/users/nishant-sachdeva/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nishant-sachdeva/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nishant-sachdeva/subscriptions",
    "organizations_url": "https://api.github.com/users/nishant-sachdeva/orgs",
    "repos_url": "https://api.github.com/users/nishant-sachdeva/repos",
    "events_url": "https://api.github.com/users/nishant-sachdeva/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nishant-sachdeva/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12535/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12535/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1020114954",
    "html_url": "https://github.com/ethereum/solidity/issues/12535#issuecomment-1020114954",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12535",
    "id": 1020114954,
    "node_id": "IC_kwDOAm_5kc48zbgK",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-24T13:43:25Z",
    "updated_at": "2022-01-24T13:44:18Z",
    "author_association": "MEMBER",
    "body": "@nishant-sachdeva \r\n> In case of discrepancies, Which version do we prefer? the output produced by the Old Code Generator or the one produced by the New Code generator ?\r\n\r\nThe one that matches the spec :) Value-type parameters are not hashed and the value passed to the event is just one byte (`0x31`, i.e. `\"1\"` in ASCII) so that's what should be stored.\r\n\r\nIR behavior is weird here though. The value is not a hash but the original `bytes16` value so somehow it does not generate code for the `bytes1` conversion. Or maybe the lower bytes just aren't cleaned? Alternatively, could be a bug with how isoltest displays it. We added support for events only quite recently (#11050).\r\n\r\nBy the way, I think we should update the docs for indexed parameters as a part of this issue. [Encoding of Indexed Event Parameters](https://docs.soliditylang.org/en/latest/abi-spec.html#encoding-of-indexed-event-parameters) actually does not say anything about the encoding indexed parameters of value types. It only mentions non-values types.\r\n\r\nIn [Contracts > Events](https://docs.soliditylang.org/en/latest/contracts.html#events) it's also not stated outright, only implied:\r\n> You can add the attribute `indexed` to up to three parameters which adds them to a special data structure known as [“topics”](https://docs.soliditylang.org/en/latest/abi-spec.html#abi-events) instead of the data part of the log. A topic can only hold a single word (32 bytes) so if you use a [reference type](https://docs.soliditylang.org/en/latest/types.html#reference-types) for an indexed argument, the Keccak-256 hash of the value is stored as a topic instead.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1020114954/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
