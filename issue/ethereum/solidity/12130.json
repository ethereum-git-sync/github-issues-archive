{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12130",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12130/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12130/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12130/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12130",
  "id": 1025244557,
  "node_id": "I_kwDOAm_5kc49G_2N",
  "number": 12130,
  "title": "[Documentation] Document the semantics of an inline assembly return in the context of a constructor",
  "user": {
    "login": "bshastry",
    "id": 2388185,
    "node_id": "MDQ6VXNlcjIzODgxODU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bshastry",
    "html_url": "https://github.com/bshastry",
    "followers_url": "https://api.github.com/users/bshastry/followers",
    "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
    "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
    "organizations_url": "https://api.github.com/users/bshastry/orgs",
    "repos_url": "https://api.github.com/users/bshastry/repos",
    "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bshastry/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-10-13T13:20:48Z",
  "updated_at": "2022-11-30T14:25:46Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "The following contract does not initialize storage variable `s` as intended i.e., to 42. Strangely, the function call `g()` does not return anything, not even `0`.\r\n\r\n```\r\nfunction f() returns (bytes memory) { assembly { return(0,0) } }\r\ncontract C3 {\r\n  uint public s;\r\n  constructor() {\r\n    s = 42;\r\n    bytes memory ununsedVar = f();\r\n  }\r\n  function g() external returns (uint) {\r\n    return s;\r\n  }\r\n}\r\n// ====\r\n// compileViaYul: also\r\n// ----\r\n// constructor() ->\r\n// gas legacyOptimized: 93975\r\n// g() ->\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12130/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12130/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/943111778",
    "html_url": "https://github.com/ethereum/solidity/issues/12130#issuecomment-943111778",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12130",
    "id": 943111778,
    "node_id": "IC_kwDOAm_5kc44Nr5i",
    "user": {
      "login": "hrkrshnn",
      "id": 13174375,
      "node_id": "MDQ6VXNlcjEzMTc0Mzc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13174375?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hrkrshnn",
      "html_url": "https://github.com/hrkrshnn",
      "followers_url": "https://api.github.com/users/hrkrshnn/followers",
      "following_url": "https://api.github.com/users/hrkrshnn/following{/other_user}",
      "gists_url": "https://api.github.com/users/hrkrshnn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hrkrshnn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hrkrshnn/subscriptions",
      "organizations_url": "https://api.github.com/users/hrkrshnn/orgs",
      "repos_url": "https://api.github.com/users/hrkrshnn/repos",
      "events_url": "https://api.github.com/users/hrkrshnn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hrkrshnn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-14T08:02:26Z",
    "updated_at": "2021-10-14T08:02:26Z",
    "author_association": "MEMBER",
    "body": "> The following contract does not initialize storage variable s as intended\r\n\r\nI think it does. The `sstore` is still there, but the getters would not work. You can verify this by deploying the contract and then using a [`getStorageAt`](https://infura.io/docs/ethereum/json-rpc/eth-getStorageAt) call.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/943111778/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/943167776",
    "html_url": "https://github.com/ethereum/solidity/issues/12130#issuecomment-943167776",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12130",
    "id": 943167776,
    "node_id": "IC_kwDOAm_5kc44N5kg",
    "user": {
      "login": "bshastry",
      "id": 2388185,
      "node_id": "MDQ6VXNlcjIzODgxODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bshastry",
      "html_url": "https://github.com/bshastry",
      "followers_url": "https://api.github.com/users/bshastry/followers",
      "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
      "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
      "organizations_url": "https://api.github.com/users/bshastry/orgs",
      "repos_url": "https://api.github.com/users/bshastry/repos",
      "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bshastry/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-14T09:12:31Z",
    "updated_at": "2021-10-14T09:12:31Z",
    "author_association": "MEMBER",
    "body": "> I think it does. The `sstore` is still there, but the getters would not work.\r\n\r\nThe sstore is there in legacy optimized code but not in IR optimized, sorry for not mentioning that detail earlier. It would be great if you could confirm this. I have a feeling this is because of a missed optimization opportunity (see https://github.com/ethereum/solidity/issues/12088).\r\n\r\n> You can verify this by deploying the contract and then using a getStorageAt call.\r\n\r\nAh nice! Is it easy to onboard to infura for deploying/running compared to Remix? The reason I ask is that I've not used Infura and find Remix easy as a noob. But ofcourse if it's worth the effort, I wouldn't mind spending time on other platforms :-)\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/943167776/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/943355577",
    "html_url": "https://github.com/ethereum/solidity/issues/12130#issuecomment-943355577",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12130",
    "id": 943355577,
    "node_id": "IC_kwDOAm_5kc44Ona5",
    "user": {
      "login": "hrkrshnn",
      "id": 13174375,
      "node_id": "MDQ6VXNlcjEzMTc0Mzc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13174375?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hrkrshnn",
      "html_url": "https://github.com/hrkrshnn",
      "followers_url": "https://api.github.com/users/hrkrshnn/followers",
      "following_url": "https://api.github.com/users/hrkrshnn/following{/other_user}",
      "gists_url": "https://api.github.com/users/hrkrshnn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hrkrshnn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hrkrshnn/subscriptions",
      "organizations_url": "https://api.github.com/users/hrkrshnn/orgs",
      "repos_url": "https://api.github.com/users/hrkrshnn/repos",
      "events_url": "https://api.github.com/users/hrkrshnn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hrkrshnn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-14T13:25:05Z",
    "updated_at": "2021-10-14T13:25:37Z",
    "author_association": "MEMBER",
    "body": " It doesn't really have to be infura, any eth node would work. You can, for example, deploy it locally in hardhat, and do something like (see https://hardhat.org/hardhat-network/reference/)\r\n```js\r\nawait hre.network.provider.send(\"eth_getStorageAt\", [\r\n  \"0x123...\",\r\n  \"0x0\"\r\n]);\r\n```\r\n\r\n---\r\n\r\nI see the `sstore` in both legacy and ir optimized.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/943355577/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/943358886",
    "html_url": "https://github.com/ethereum/solidity/issues/12130#issuecomment-943358886",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12130",
    "id": 943358886,
    "node_id": "IC_kwDOAm_5kc44OoOm",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-14T13:28:49Z",
    "updated_at": "2021-10-14T13:30:08Z",
    "author_association": "MEMBER",
    "body": "I cannot confirm that `sstore` is removed via ir:\r\n```\r\n    code {\r\n        {\r\n            mstore(64, 128)\r\n            if callvalue() { revert(0, 0) }\r\n            sstore(0x00, 0x2a)\r\n            return(0x00, 0x00)\r\n        }\r\n    }\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/943358886/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/943473750",
    "html_url": "https://github.com/ethereum/solidity/issues/12130#issuecomment-943473750",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12130",
    "id": 943473750,
    "node_id": "IC_kwDOAm_5kc44PERW",
    "user": {
      "login": "bshastry",
      "id": 2388185,
      "node_id": "MDQ6VXNlcjIzODgxODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bshastry",
      "html_url": "https://github.com/bshastry",
      "followers_url": "https://api.github.com/users/bshastry/followers",
      "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
      "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
      "organizations_url": "https://api.github.com/users/bshastry/orgs",
      "repos_url": "https://api.github.com/users/bshastry/repos",
      "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bshastry/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-14T15:33:49Z",
    "updated_at": "2021-10-14T15:33:49Z",
    "author_association": "MEMBER",
    "body": "> I cannot confirm that `sstore` is removed via ir:\r\n> \r\n> ```\r\n>     code {\r\n>         {\r\n>             mstore(64, 128)\r\n>             if callvalue() { revert(0, 0) }\r\n>             sstore(0x00, 0x2a)\r\n>             return(0x00, 0x00)\r\n>         }\r\n>     }\r\n> ```\r\n\r\nSorry, I mixed up test cases in the process of reducing them.\r\n\r\nHere's the test case with one fewer sstore in IR but that's probably because of the order in which state variables in legacy and IR are initialized (inline and then constructor vs constructor and then inline assignment in IR)\r\n\r\n```\r\nfunction f() {\r\n  assembly {\r\n    return(0,0)\r\n  }\r\n}\r\ncontract C {\r\n  uint public s = 1337; // Only legacy contains this sstore\r\n  constructor() { s = 1; f(); } // IR and legacy contain this sstore\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/943473750/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/943479978",
    "html_url": "https://github.com/ethereum/solidity/issues/12130#issuecomment-943479978",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12130",
    "id": 943479978,
    "node_id": "IC_kwDOAm_5kc44PFyq",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-14T15:41:11Z",
    "updated_at": "2021-10-14T15:41:11Z",
    "author_association": "MEMBER",
    "body": "Ok, right, I can confirm. The yul optimizer cannot remove the sstore (yet) but the opcode-based optimizer afterwards can. I believe this is because the callvalue check (the constructor is not payable) happens at different times.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/943479978/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
