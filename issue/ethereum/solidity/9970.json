{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/9970",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/9970/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/9970/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/9970/events",
  "html_url": "https://github.com/ethereum/solidity/issues/9970",
  "id": 715959942,
  "node_id": "MDU6SXNzdWU3MTU5NTk5NDI=",
  "number": 9970,
  "title": "UnimplementedFeatureError in ABIEncoderV1 file when inheriting from ABIEncoderV2 contract",
  "user": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    },
    {
      "id": 2376134343,
      "node_id": "MDU6TGFiZWwyMzc2MTM0MzQz",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/should%20compile%20without%20error",
      "name": "should compile without error",
      "color": "c48f13",
      "default": false,
      "description": "Error is reported even though it shouldn't. Source is fine."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2020-10-06T19:22:10Z",
  "updated_at": "2020-10-12T13:40:44Z",
  "closed_at": "2020-10-12T13:40:44Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Extracted from https://github.com/ethereum/solidity/issues/8379#issuecomment-704342651\r\n\r\n## Steps to Reproduce\r\n`a.sol`:\r\n```solidity\r\npragma experimental ABIEncoderV2;\r\n\r\ncontract C {\r\n    struct Item {\r\n        uint x;\r\n    }\r\n\r\n    function get() external view returns(Item memory) {}\r\n}\r\n```\r\n`b.sol`:\r\n```solidity\r\nimport \"./a.sol\";\r\n\r\ncontract D is C {}\r\n```\r\nRun it with:\r\n```bash\r\nsolc b.sol\r\n```\r\nOutput:\r\n```\r\nUnimplemented feature:\r\n/solidity/libsolidity/codegen/CompilerUtils.cpp(420): Throw in function void solidity::frontend::CompilerUtils::encodeToMemory(const TypePointers&, const TypePointers&, bool, bool, bool)\r\nDynamic exception type: boost::wrapexcept<solidity::langutil::UnimplementedFeatureError>\r\nstd::exception::what: Encoding type \"struct C.Item memory\" not yet implemented.\r\n[solidity::util::tag_comment*] = Encoding type \"struct C.Item memory\" not yet implemented.\r\n```\r\n\r\n`a.sol` compiles just fine on its own so the feature is not really unimplemented.\r\n\r\n## Environment\r\n- Compiler version: 0.7.2+commit.51b20bc0.Linux.g++",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/9970/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/9970/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704787870",
    "html_url": "https://github.com/ethereum/solidity/issues/9970#issuecomment-704787870",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9970",
    "id": 704787870,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDc4Nzg3MA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T08:43:34Z",
    "updated_at": "2020-10-07T08:43:34Z",
    "author_association": "MEMBER",
    "body": "My first guess would be that `b.sol`still needs ABIEncoderV2 to be activated.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704787870/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704803597",
    "html_url": "https://github.com/ethereum/solidity/issues/9970#issuecomment-704803597",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9970",
    "id": 704803597,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDgwMzU5Nw==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T09:12:12Z",
    "updated_at": "2020-10-07T09:12:12Z",
    "author_association": "MEMBER",
    "body": "But why? `get()` is completely defined in `a.sol` so it should have the encoder enabled, shouldn't it?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704803597/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704824606",
    "html_url": "https://github.com/ethereum/solidity/issues/9970#issuecomment-704824606",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9970",
    "id": 704824606,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDgyNDYwNg==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T09:49:42Z",
    "updated_at": "2020-10-07T09:49:42Z",
    "author_association": "MEMBER",
    "body": "I would say let's do whatever is easier in terms of the implementation.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704824606/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704956078",
    "html_url": "https://github.com/ethereum/solidity/issues/9970#issuecomment-704956078",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9970",
    "id": 704956078,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDk1NjA3OA==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T14:00:00Z",
    "updated_at": "2020-10-07T14:01:58Z",
    "author_association": "MEMBER",
    "body": "Another one similar to this. This time it's inheriting from a contract that only calls an ABIEncoderV2 function:\r\n\r\n`a.sol`:\r\n```solidity\r\npragma experimental ABIEncoderV2;\r\n\r\nstruct Data {\r\n    bool flag;\r\n}\r\n\r\ncontract A {\r\n    function get() public view returns (Data memory) {}\r\n}\r\n\r\ncontract B {\r\n    function foo() public {\r\n        A(0x00).get();\r\n    }\r\n}\r\n```\r\n\r\n`b.sol`:\r\n```solidity\r\nimport \"./a.sol\";\r\n\r\ncontract C is B {}\r\n```\r\n\r\n```\r\nInternal compiler error during compilation:\r\n/solidity/libsolidity/codegen/CompilerUtils.cpp(1440): Throw in function unsigned int solidity::frontend::CompilerUtils::loadFromMemoryHelper(const solidity::frontend::Type&, bool, bool)\r\nDynamic exception type: boost::wrapexcept<solidity::langutil::InternalCompilerError>\r\nstd::exception::what:\r\n[solidity::util::tag_comment*] =\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704956078/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704977264",
    "html_url": "https://github.com/ethereum/solidity/issues/9970#issuecomment-704977264",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9970",
    "id": 704977264,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDk3NzI2NA==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T14:32:01Z",
    "updated_at": "2020-10-07T14:43:49Z",
    "author_association": "MEMBER",
    "body": "And another. V1 contract overriding a modifier inherited from a V2 contract:\r\n\r\n**EDIT: Actually, this is just a variation of the case above - just with constrctor rather than a public function - and has nothing to do with the modifiers.**\r\n\r\n`a.sol`:\r\n```solidity\r\npragma experimental ABIEncoderV2;\r\n\r\nstruct Data {\r\n    bool flag;\r\n}\r\n\r\ncontract A {\r\n    function get() public view returns (Data memory) {}\r\n}\r\n\r\ncontract B {\r\n    constructor() validate {\r\n        A(0x00).get();\r\n    }\r\n\r\n    modifier validate() virtual {\r\n        _;\r\n    }\r\n}\r\n```\r\n\r\n`b.sol`:\r\n```solidity\r\nimport \"./a.sol\";\r\n\r\ncontract C is B {\r\n    modifier validate() override {\r\n        _;\r\n    }\r\n}\r\n```\r\n\r\n```\r\nInternal compiler error during compilation:\r\n/solidity/libsolidity/codegen/CompilerUtils.cpp(1440): Throw in function unsigned int solidity::frontend::CompilerUtils::loadFromMemoryHelper(const solidity::frontend::Type&, bool, bool)\r\nDynamic exception type: boost::wrapexcept<solidity::langutil::InternalCompilerError>\r\nstd::exception::what:\r\n[solidity::util::tag_comment*] =\r\n```\r\n\r\nAlso, if I change `B` to inherit from `A`, I hit the `UnimplementedFeatureError` instead:\r\n```\r\nUnimplemented feature:\r\n/solidity/libsolidity/codegen/CompilerUtils.cpp(420): Throw in function void solidity::frontend::CompilerUtils::encodeToMemory(const TypePointers&, const TypePointers&, bool, bool, bool)\r\nDynamic exception type: boost::wrapexcept<solidity::langutil::UnimplementedFeatureError>\r\nstd::exception::what: Encoding type \"struct Data memory\" not yet implemented.\r\n[solidity::util::tag_comment*] = Encoding type \"struct Data memory\" not yet implemented.\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704977264/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/706328091",
    "html_url": "https://github.com/ethereum/solidity/issues/9970#issuecomment-706328091",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9970",
    "id": 706328091,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNjMyODA5MQ==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-09T18:07:45Z",
    "updated_at": "2020-10-09T18:07:45Z",
    "author_association": "MEMBER",
    "body": "The two test cases in comment above are actually a different thing, more related to #9969 so I'm fixing them there.\r\n\r\n@chriseth \r\n> I would say let's do whatever is easier in terms of the implementation.\r\n\r\nTurns out that we already had a check against this case in `ContractLevelChecker` but it was buggy. It was checking the parameters second time instead of going over the return parameters. There is even a test case for that check but it uses ABIEncoderV2 types both for the parameters and for the return value so even without checking the return value the error was still there and the test did not fail.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/706328091/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
