{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/11054",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/11054/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/11054/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/11054/events",
  "html_url": "https://github.com/ethereum/solidity/issues/11054",
  "id": 822301586,
  "node_id": "MDU6SXNzdWU4MjIzMDE1ODY=",
  "number": 11054,
  "title": "RFC: export EIP-712 signature definitions in the ABI",
  "user": {
    "login": "MrChico",
    "id": 8930559,
    "node_id": "MDQ6VXNlcjg5MzA1NTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8930559?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MrChico",
    "html_url": "https://github.com/MrChico",
    "followers_url": "https://api.github.com/users/MrChico/followers",
    "following_url": "https://api.github.com/users/MrChico/following{/other_user}",
    "gists_url": "https://api.github.com/users/MrChico/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MrChico/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MrChico/subscriptions",
    "organizations_url": "https://api.github.com/users/MrChico/orgs",
    "repos_url": "https://api.github.com/users/MrChico/repos",
    "events_url": "https://api.github.com/users/MrChico/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MrChico/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-03-04T16:37:59Z",
  "updated_at": "2021-03-05T23:51:47Z",
  "closed_at": "2021-03-04T19:35:13Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "EIP-712 defines a typed signature scheme in which a `messageStruct` and a `domainStruct` are defined, and a hashing scheme that combines the names, types, and values of these into a bytestring that is then sent to the wallet to be signed.\r\n\r\nThis is becoming an increasingly common way to interact with contracts, with two prominent examples being `permit` (EIP-2612) and Gnosis Safe.\r\n\r\nWhile generating EIP-712 signatures is straight forward enough given a particular pair of message and domainstruct, it is harder to generate for arbitrary contracts, as the structures are not exposed in the ABI. This means that 712-style signatures need to special cased for each contract, and cannot be discovered or interacted with via generalized uis that interface directly with the contract ABI, such as remix or etherscan.\r\n\r\nI'm wondering if it might be a good idea to let 712 structures be exposed in the ABI, maybe through a special keyword on structs. For example, here I am decorating the two structs required to form a `Mail` example from the 712 spec with the `eip712` keyword.\r\n\r\n```solidity\r\nstruct EIP712Domain eip712 {\r\n    string name;\r\n    string version;\r\n    uint256 chainId;\r\n    address verifyingContract;\r\n}\r\n\r\nstruct Mail eip712 {\r\n    address from;\r\n    address to;\r\n    string contents;\r\n}\r\n```\r\n\r\nThis would expose the following json for the Mail struct to the ABI:\r\n```\r\n  eip712Types: {\r\n      EIP712Domain: [\r\n          { name: 'name', type: 'string' },\r\n          { name: 'version', type: 'string' },\r\n          { name: 'chainId', type: 'uint256' },\r\n          { name: 'verifyingContract', type: 'address' },\r\n      ],\r\n    Mail: [\r\n          { name: 'from', type: 'address' }, \r\n          { name: 'to' type: 'address' },\r\n          { name: 'contents', type: 'string' }\r\n      ],\r\n  }\r\n```\r\n\r\nWhich, given values for `name`, `version`, `chainId`, `verifyingContract`, `from`, `to` and `contents` can easily be used for generating a EIP-712 style signature.",
  "closed_by": {
    "login": "MrChico",
    "id": 8930559,
    "node_id": "MDQ6VXNlcjg5MzA1NTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8930559?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MrChico",
    "html_url": "https://github.com/MrChico",
    "followers_url": "https://api.github.com/users/MrChico/followers",
    "following_url": "https://api.github.com/users/MrChico/following{/other_user}",
    "gists_url": "https://api.github.com/users/MrChico/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MrChico/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MrChico/subscriptions",
    "organizations_url": "https://api.github.com/users/MrChico/orgs",
    "repos_url": "https://api.github.com/users/MrChico/repos",
    "events_url": "https://api.github.com/users/MrChico/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MrChico/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/11054/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/11054/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/790833009",
    "html_url": "https://github.com/ethereum/solidity/issues/11054#issuecomment-790833009",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11054",
    "id": 790833009,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MDgzMzAwOQ==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-04T18:31:06Z",
    "updated_at": "2021-03-04T18:31:06Z",
    "author_association": "MEMBER",
    "body": "Can this be solved with a widely approved naming scheme for these structs, such as `EIP712_Mail`, and then just having a mechanism to export the name of structs in the ABI? I think we may already do that too.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/790833009/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/790838899",
    "html_url": "https://github.com/ethereum/solidity/issues/11054#issuecomment-790838899",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11054",
    "id": 790838899,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MDgzODg5OQ==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-04T18:38:21Z",
    "updated_at": "2021-03-04T18:38:21Z",
    "author_association": "MEMBER",
    "body": "```solidity\r\nstruct EIP712_Mail {\r\n    address from;\r\n    address to;\r\n    string contents;\r\n}\r\n\r\ncontract C {\r\n    function validate(EIP712_Mail calldata mail) external {\r\n    }\r\n}\r\n```\r\n\r\nProduces:\r\n```json\r\n[\r\n  {\r\n    \"inputs\": [\r\n      {\r\n        \"components\": [\r\n          {\r\n            \"internalType\": \"address\",\r\n            \"name\": \"from\",\r\n            \"type\": \"address\"\r\n          },\r\n          {\r\n            \"internalType\": \"address\",\r\n            \"name\": \"to\",\r\n            \"type\": \"address\"\r\n          },\r\n          {\r\n            \"internalType\": \"string\",\r\n            \"name\": \"contents\",\r\n            \"type\": \"string\"\r\n          }\r\n        ],\r\n        \"internalType\": \"struct EIP712_Mail\",\r\n        \"name\": \"mail\",\r\n        \"type\": \"tuple\"\r\n      }\r\n    ],\r\n    \"name\": \"validate\",\r\n    \"outputs\": [],\r\n    \"stateMutability\": \"nonpayable\",\r\n    \"type\": \"function\"\r\n  }\r\n]\r\n```\r\n\r\nSee the `internalType` part.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/790838899/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/790875217",
    "html_url": "https://github.com/ethereum/solidity/issues/11054#issuecomment-790875217",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11054",
    "id": 790875217,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MDg3NTIxNw==",
    "user": {
      "login": "MrChico",
      "id": 8930559,
      "node_id": "MDQ6VXNlcjg5MzA1NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8930559?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MrChico",
      "html_url": "https://github.com/MrChico",
      "followers_url": "https://api.github.com/users/MrChico/followers",
      "following_url": "https://api.github.com/users/MrChico/following{/other_user}",
      "gists_url": "https://api.github.com/users/MrChico/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MrChico/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MrChico/subscriptions",
      "organizations_url": "https://api.github.com/users/MrChico/orgs",
      "repos_url": "https://api.github.com/users/MrChico/repos",
      "events_url": "https://api.github.com/users/MrChico/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MrChico/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-04T19:35:10Z",
    "updated_at": "2021-03-04T19:35:10Z",
    "author_association": "MEMBER",
    "body": "That is a good point. It seems like what is mainly missing is the convention, more so than a lack of ABI.\r\nClosing this.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/790875217/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/791797324",
    "html_url": "https://github.com/ethereum/solidity/issues/11054#issuecomment-791797324",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11054",
    "id": 791797324,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MTc5NzMyNA==",
    "user": {
      "login": "recmo",
      "id": 4532328,
      "node_id": "MDQ6VXNlcjQ1MzIzMjg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4532328?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/recmo",
      "html_url": "https://github.com/recmo",
      "followers_url": "https://api.github.com/users/recmo/followers",
      "following_url": "https://api.github.com/users/recmo/following{/other_user}",
      "gists_url": "https://api.github.com/users/recmo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/recmo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/recmo/subscriptions",
      "organizations_url": "https://api.github.com/users/recmo/orgs",
      "repos_url": "https://api.github.com/users/recmo/repos",
      "events_url": "https://api.github.com/users/recmo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/recmo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-05T23:51:47Z",
    "updated_at": "2021-03-05T23:51:47Z",
    "author_association": "NONE",
    "body": "AFAIK, the encoding used by ABI can not support recursive data structures, whereas the one in the EIP712 spec can. So you'd loose some functionality.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/791797324/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
