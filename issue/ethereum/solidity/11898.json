{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/11898",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/11898/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/11898/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/11898/events",
  "html_url": "https://github.com/ethereum/solidity/issues/11898",
  "id": 988554690,
  "node_id": "MDU6SXNzdWU5ODg1NTQ2OTA=",
  "number": 11898,
  "title": "Non-deterministic source maps for the same contract when other contract imports it",
  "user": {
    "login": "PaulRBerg",
    "id": 8782666,
    "node_id": "MDQ6VXNlcjg3ODI2NjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8782666?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/PaulRBerg",
    "html_url": "https://github.com/PaulRBerg",
    "followers_url": "https://api.github.com/users/PaulRBerg/followers",
    "following_url": "https://api.github.com/users/PaulRBerg/following{/other_user}",
    "gists_url": "https://api.github.com/users/PaulRBerg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/PaulRBerg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/PaulRBerg/subscriptions",
    "organizations_url": "https://api.github.com/users/PaulRBerg/orgs",
    "repos_url": "https://api.github.com/users/PaulRBerg/repos",
    "events_url": "https://api.github.com/users/PaulRBerg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/PaulRBerg/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 12,
  "created_at": "2021-09-05T17:07:31Z",
  "updated_at": "2021-09-07T15:37:55Z",
  "closed_at": "2021-09-07T15:37:55Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nSolidity generates slightly different source maps when:\r\n\r\n1. The contract is not imported by any other contract in the code base.\r\n2. The exact same contract is imported by other contract in the code base, which is compiled as well.\r\n\r\nIn the second case, there is an extra semicolon in the source maps. As per the [docs](https://docs.soliditylang.org/en/v0.8.7/internals/source_mappings.html), this *should* refer to an additional assembly instruction in the contract. But there is no such instruction, thus this may be a bug. I expected the source maps to be identical between the two circumstances, given that all else is equal (compiler settings, source code, whitespaces, etc).\r\n\r\nHere are two GitHub Gists with the different source maps:\r\n\r\n- [1st case](https://gist.github.com/paulrberg/b250fbb6d5aa92ae27381071aa1a8e61)\r\n- [2nd case](https://gist.github.com/paulrberg/7f70bf4415d7ffd51645507fbba63e93)\r\n\r\nIf you run these on [text-compare.com](https://text-compare.com), you will notice that there are more diffs than just an extra semicolon. But you can ignore all of them, except the semicolon, because they refer to the different file ids that get assigned to `PRBProxy` and `#utility.yul` by Solidity. Check out characters 317-320th; in the 1st case, you find `4;;;2`, and in the 2nd case `8;;;;`.\r\n\r\n## Environment\r\n\r\n- Compiler version: solc-macosx-amd64-v0.8.7+commit.e28d00a7\r\n- Target EVM version (as per compiler settings): Compiler default (London)\r\n- Framework/IDE (e.g. Truffle or Remix): Hardhat\r\n- EVM execution environment / backend / blockchain client: Hardhat Network (hardhat@2.6.2)\r\n- Operating system: macOS@11.5.2\r\n\r\n## Steps to Reproduce\r\n\r\n1. Git clone [prb-proxy](https://github.com/paulrberg/prb-proxy/commit/93d337b3fa66fe03ccf3e355b5da490bf5bba273) at commit `93d337b` \r\n2. Install dependencies with `yarn install`\r\n3. Fill a `.env` file as shown by the `.env.example` file\r\n4. Generate the TypeChain bindings with `yarn typechain`\r\n5. Run the tests with `yarn test --verbose`\r\n\r\nYou should get the following error:\r\n\r\n```\r\n  hardhat:core:hardhat-network:node Could not generate stack trace. Please report this to help us improve Hardhat.\r\n  hardhat:core:hardhat-network:node  Error: This shouldn't happen: a call trace has no functionJumpdest but has already jumped into a function\r\n    at ErrorInferrer._getEntryBeforeFailureInModifier (/Users/paulrberg/workspace/pad/prb-proxy-clone/node_modules/hardhat/src/internal/hardhat-network/stack-traces/error-inferrer.ts:1476:13)\r\n    at ErrorInferrer._checkRevertOrInvalidOpcode (/Users/paulrberg/workspace/pad/prb-proxy-clone/node_modules/hardhat/src/internal/hardhat-network/stack-traces/error-inferrer.ts:370:16)\r\n    at ErrorInferrer._checkLastInstruction (/Users/paulrberg/workspace/pad/prb-proxy-clone/node_modules/hardhat/src/internal/hardhat-network/stack-traces/error-inferrer.ts:554:44)\r\n    at ErrorInferrer.inferAfterTracing (/Users/paulrberg/workspace/pad/prb-proxy-clone/node_modules/hardhat/src/internal/hardhat-network/stack-traces/error-inferrer.ts:162:12)\r\n    at SolidityTracer._rawTraceEvmExecution (/Users/paulrberg/workspace/pad/prb-proxy-clone/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:211:61)\r\n    at SolidityTracer._traceEvmExecution (/Users/paulrberg/workspace/pad/prb-proxy-clone/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:149:29)\r\n    at SolidityTracer._getCallMessageStackTrace (/Users/paulrberg/workspace/pad/prb-proxy-clone/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:72:17)\r\n    at SolidityTracer.getStackTrace (/Users/paulrberg/workspace/pad/prb-proxy-clone/node_modules/hardhat/src/internal/hardhat-network/stack-traces/solidityTracer.ts:56:19)\r\n    at HardhatNode._manageErrors (/Users/paulrberg/workspace/pad/prb-proxy-clone/node_modules/hardhat/src/internal/hardhat-network/provider/node.ts:1705:41)\r\n    at HardhatNode.estimateGas (/Users/paulrberg/workspace/pad/prb-proxy-clone/node_modules/hardhat/src/internal/hardhat-network/provider/node.ts:661:27)\r\n```\r\n\r\n## Implications\r\n\r\nThis is likely what causes https://github.com/nomiclabs/hardhat/issues/1185. The error above is the same as the one reported by everyone else there.\r\n\r\n## More Details\r\n\r\nI spent three days debugging this. What I know thus far:\r\n\r\n- The issue goes away when I manually remove the extra semicolon the source maps\r\n- The issue goes away when I delete the `PRBProxyFactory.sol` and `PRBProxyRegistry.sol` contracts and compile just `PRBProxy.sol` and its dependencies\r\n- The issue goes away when I rename the `execute` function to something else, such as `fooBarBaz`\r\n- The issue goes away when I turn off the compiler optimizer\r\n- Seems this has something to do with the modifier (`onlyOwnable`) and the `JUMPTDEST` opcode",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/11898/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/11898/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913192941",
    "html_url": "https://github.com/ethereum/solidity/issues/11898#issuecomment-913192941",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11898",
    "id": 913192941,
    "node_id": "IC_kwDOAm_5kc42bjft",
    "user": {
      "login": "PaulRBerg",
      "id": 8782666,
      "node_id": "MDQ6VXNlcjg3ODI2NjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8782666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PaulRBerg",
      "html_url": "https://github.com/PaulRBerg",
      "followers_url": "https://api.github.com/users/PaulRBerg/followers",
      "following_url": "https://api.github.com/users/PaulRBerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulRBerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PaulRBerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulRBerg/subscriptions",
      "organizations_url": "https://api.github.com/users/PaulRBerg/orgs",
      "repos_url": "https://api.github.com/users/PaulRBerg/repos",
      "events_url": "https://api.github.com/users/PaulRBerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PaulRBerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-05T17:14:52Z",
    "updated_at": "2021-09-05T17:14:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "Cc-ing @alcuadrado and @fvictorio, they might be able to help. I tracked the error in the Hardhat source code. This is what I found:\r\n\r\n1. [Line 1477](https://github.com/nomiclabs/hardhat/blob/deaa288a44f133204392464c7a9257b56c99f4df/packages/hardhat-core/src/internal/hardhat-network/stack-traces/error-inferrer.ts#L1477) in `stack-traces.ts` gets executed because `functionJumpdests` is empty.\r\n2. `functionJumpdests` is empty because [line 191](https://github.com/nomiclabs/hardhat/blob/deaa288a44f133204392464c7a9257b56c99f4df/packages/hardhat-core/src/internal/hardhat-network/stack-traces/solidityTracer.ts#L191) gets executed in `solidityTracer.ts`. I suspect that this is correct, the issue being the flawed source maps.\r\n\r\nI also looked at [source-maps.ts](https://github.com/nomiclabs/hardhat/blob/deaa288a44f133204392464c7a9257b56c99f4df/packages/hardhat-core/src/internal/hardhat-network/stack-traces/source-maps.ts) but nothing caught my attention, except for https://github.com/nomiclabs/hardhat/pull/1857. But even after fixing the `hasPart3` line, the tests kept failing. Thus I conjectured that this may be a bug in Solidity .. and I went down the rabbit hole and ended up opening this issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913192941/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913692711",
    "html_url": "https://github.com/ethereum/solidity/issues/11898#issuecomment-913692711",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11898",
    "id": 913692711,
    "node_id": "IC_kwDOAm_5kc42ddgn",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-06T14:29:36Z",
    "updated_at": "2021-09-06T14:29:36Z",
    "author_association": "MEMBER",
    "body": "The fact that the source maps have different lengths sounds like the bytecode is also different, which would be far more alarming. Can you please provide the assembly and the bytecode output of both ways to compile the contract?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913692711/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913703029",
    "html_url": "https://github.com/ethereum/solidity/issues/11898#issuecomment-913703029",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11898",
    "id": 913703029,
    "node_id": "IC_kwDOAm_5kc42dgB1",
    "user": {
      "login": "PaulRBerg",
      "id": 8782666,
      "node_id": "MDQ6VXNlcjg3ODI2NjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8782666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PaulRBerg",
      "html_url": "https://github.com/PaulRBerg",
      "followers_url": "https://api.github.com/users/PaulRBerg/followers",
      "following_url": "https://api.github.com/users/PaulRBerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulRBerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PaulRBerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulRBerg/subscriptions",
      "organizations_url": "https://api.github.com/users/PaulRBerg/orgs",
      "repos_url": "https://api.github.com/users/PaulRBerg/repos",
      "events_url": "https://api.github.com/users/PaulRBerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PaulRBerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-06T14:47:10Z",
    "updated_at": "2021-09-06T14:47:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "The bytecodes and the opcodes were the same. I triple checked this while debugging.\n\nI am on my phone now but I will follow up later with the exact bytecodes/ opcodes I got.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913703029/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913733583",
    "html_url": "https://github.com/ethereum/solidity/issues/11898#issuecomment-913733583",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11898",
    "id": 913733583,
    "node_id": "IC_kwDOAm_5kc42dnfP",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-06T15:37:44Z",
    "updated_at": "2021-09-06T15:37:44Z",
    "author_association": "MEMBER",
    "body": "Thanks! And could you please also provide the sources and the metadata file, so I can try to reproduce it locally?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913733583/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913789871",
    "html_url": "https://github.com/ethereum/solidity/issues/11898#issuecomment-913789871",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11898",
    "id": 913789871,
    "node_id": "IC_kwDOAm_5kc42d1Ov",
    "user": {
      "login": "PaulRBerg",
      "id": 8782666,
      "node_id": "MDQ6VXNlcjg3ODI2NjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8782666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PaulRBerg",
      "html_url": "https://github.com/PaulRBerg",
      "followers_url": "https://api.github.com/users/PaulRBerg/followers",
      "following_url": "https://api.github.com/users/PaulRBerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulRBerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PaulRBerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulRBerg/subscriptions",
      "organizations_url": "https://api.github.com/users/PaulRBerg/orgs",
      "repos_url": "https://api.github.com/users/PaulRBerg/repos",
      "events_url": "https://api.github.com/users/PaulRBerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PaulRBerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-06T17:47:34Z",
    "updated_at": "2021-09-06T17:51:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Can you please provide the assembly and the bytecode output of both ways to compile the contract?\r\n\r\nI updated the GitHub Gists I shared in the first post:\r\n\r\n1. [src-maps-bug-1st-case.json ](https://gist.github.com/paulrberg/b250fbb6d5aa92ae27381071aa1a8e61)\r\n2. [src-maps-bug-2nd-case.json](https://gist.github.com/paulrberg/7f70bf4415d7ffd51645507fbba63e93)\r\n\r\nThey are JSONs which with `deployedBytecode`, `opcodes` and `sourceMaps` entries.\r\n\r\n> And could you please also provide the sources and the metadata file, so I can try to reproduce it locally?\r\n\r\nThe sources are in the [prb-proxy](https://github.com/paulrberg/prb-proxy) repository, at commit [93d337b](https://github.com/paulrberg/prb-proxy/commit/93d337b3fa66fe03ccf3e355b5da490bf5bba273). To reproduce the 1st case results, run Hardhat over the repo as is. You have instructions in the first post; the specific command is `yarn compile`. To reproduce the 2nd case results, delete the `PRBProxyFactory.sol`, `IPRBProxyFactory.sol`, `PRBProxyRegistry.sol` and `IPRBProxyRegistry.sol` files, and run Hardhat again.\r\n\r\nIn the 1st case, the name of the file under `artifacts/build-info` should be `313bad6d3bea2ff85dd80179204ba658.json`. In the 2nd, it should be `e0c925ee78a287a14868de7d4f5c3c00.json`.\r\n\r\nRegarding the \"metadata file\", I have no such thing. All the compiler settings are defined in [hardhat.config.ts](https://github.com/paulrberg/prb-proxy/blob/93d337b3fa66fe03ccf3e355b5da490bf5bba273/hardhat.config.ts). For what it's worth, I [disabled](https://github.com/paulrberg/prb-proxy/blob/93d337b3fa66fe03ccf3e355b5da490bf5bba273/hardhat.config.ts#L75) the metadata hash.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913789871/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913790740",
    "html_url": "https://github.com/ethereum/solidity/issues/11898#issuecomment-913790740",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11898",
    "id": 913790740,
    "node_id": "IC_kwDOAm_5kc42d1cU",
    "user": {
      "login": "PaulRBerg",
      "id": 8782666,
      "node_id": "MDQ6VXNlcjg3ODI2NjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8782666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PaulRBerg",
      "html_url": "https://github.com/PaulRBerg",
      "followers_url": "https://api.github.com/users/PaulRBerg/followers",
      "following_url": "https://api.github.com/users/PaulRBerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulRBerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PaulRBerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulRBerg/subscriptions",
      "organizations_url": "https://api.github.com/users/PaulRBerg/orgs",
      "repos_url": "https://api.github.com/users/PaulRBerg/repos",
      "events_url": "https://api.github.com/users/PaulRBerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PaulRBerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-06T17:50:39Z",
    "updated_at": "2021-09-06T17:51:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "More data points:\r\n\r\n- I tried switching Hardhat versions, same result. I tried v2.5.0, 2.6.0, v2.6.1 and v2.6.2.\r\n- I tried switching Solidity versions, same result. I tried all v0.8.x releases.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913790740/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913821887",
    "html_url": "https://github.com/ethereum/solidity/issues/11898#issuecomment-913821887",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11898",
    "id": 913821887,
    "node_id": "IC_kwDOAm_5kc42d9C_",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-06T19:23:16Z",
    "updated_at": "2021-09-06T19:24:37Z",
    "author_association": "MEMBER",
    "body": "It's really a pity that hardhat makes it so complicated to get the metadata file - it is the one thing that abstracts the framework away from compiler invocation. I'll try to reproduce nevertheless.\r\n\r\n~~One thing that strikes me: The source maps contain 1030 / 1031 entries while the deployed bytecode is 1578 bytes long.~~\r\nEdit: This not remarkable since the source maps are opcode- and not byte-based ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913821887/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913832376",
    "html_url": "https://github.com/ethereum/solidity/issues/11898#issuecomment-913832376",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11898",
    "id": 913832376,
    "node_id": "IC_kwDOAm_5kc42d_m4",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-06T20:01:11Z",
    "updated_at": "2021-09-06T20:01:11Z",
    "author_association": "MEMBER",
    "body": "Ok, got it reproduced. Just some bits of documentation:\r\n```\r\ngit clone https://github.com/paulrberg/prb-proxy\r\ngit checkout 93d337b\r\nnpm install # or maybe \"npx yarn install\"?\r\nmv node_modules/@paulrberg .\r\n# first version:\r\nsolc  contracts/* --optimize --allow-paths . --combined-json bin,srcmap,srcmap-runtime | jq '.contracts[\"contracts/PRBProxy.sol:PRBProxy\"][\"srcmap-runtime\"]'\r\n# second version:\r\nsolc  contracts/*Proxy.sol --optimize --allow-paths . --combined-json bin,srcmap,srcmap-runtime | jq '.contracts[\"contracts/PRBProxy.sol:PRBProxy\"][\"srcmap-runtime\"]'\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913832376/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913833907",
    "html_url": "https://github.com/ethereum/solidity/issues/11898#issuecomment-913833907",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11898",
    "id": 913833907,
    "node_id": "IC_kwDOAm_5kc42d_-z",
    "user": {
      "login": "PaulRBerg",
      "id": 8782666,
      "node_id": "MDQ6VXNlcjg3ODI2NjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8782666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PaulRBerg",
      "html_url": "https://github.com/PaulRBerg",
      "followers_url": "https://api.github.com/users/PaulRBerg/followers",
      "following_url": "https://api.github.com/users/PaulRBerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulRBerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PaulRBerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulRBerg/subscriptions",
      "organizations_url": "https://api.github.com/users/PaulRBerg/orgs",
      "repos_url": "https://api.github.com/users/PaulRBerg/repos",
      "events_url": "https://api.github.com/users/PaulRBerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PaulRBerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-06T20:04:50Z",
    "updated_at": "2021-09-06T20:09:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "> npm install # or maybe \"npx yarn install\"?\r\n\r\nIt should be `npx yarn install` because there is a `yarn.lock` file committed in version control.\r\n\r\n---\r\n\r\n~~Re your other commands - they look good. I compiled the same sets of contracts but via Hardhat directly.~~\r\n\r\n**Update**: the optimizer should be run 800 times, and the metadata hash should be disabled. I don't see these in your commands, though if you reproduced the issue it should be ok.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913833907/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913836902",
    "html_url": "https://github.com/ethereum/solidity/issues/11898#issuecomment-913836902",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11898",
    "id": 913836902,
    "node_id": "IC_kwDOAm_5kc42eAtm",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-06T20:11:38Z",
    "updated_at": "2021-09-06T20:11:48Z",
    "author_association": "MEMBER",
    "body": "What is weird is that if I request the assembly output, I get different assemblies (some redundant swaps and dups that do not matter because `and` is commutative), but the bytecode is actually the same.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/913836902/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/914288597",
    "html_url": "https://github.com/ethereum/solidity/issues/11898#issuecomment-914288597",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11898",
    "id": 914288597,
    "node_id": "IC_kwDOAm_5kc42fu_V",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-07T13:03:39Z",
    "updated_at": "2021-09-07T13:03:39Z",
    "author_association": "MEMBER",
    "body": "Ok, this was a tough one: The reason is that the factory contains the proxy as a sub-object and somehow, the optimizer is run again on the proxy resulting in slightly different bytecode than on the first run - usually the optimizer runs as long as there are changes, so it should not be a problem to run it a second time. The actual bytecode is the same, because it has been stored already before the second run of the optimizer.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/914288597/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/914364021",
    "html_url": "https://github.com/ethereum/solidity/issues/11898#issuecomment-914364021",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11898",
    "id": 914364021,
    "node_id": "IC_kwDOAm_5kc42gBZ1",
    "user": {
      "login": "PaulRBerg",
      "id": 8782666,
      "node_id": "MDQ6VXNlcjg3ODI2NjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8782666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PaulRBerg",
      "html_url": "https://github.com/PaulRBerg",
      "followers_url": "https://api.github.com/users/PaulRBerg/followers",
      "following_url": "https://api.github.com/users/PaulRBerg/following{/other_user}",
      "gists_url": "https://api.github.com/users/PaulRBerg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PaulRBerg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PaulRBerg/subscriptions",
      "organizations_url": "https://api.github.com/users/PaulRBerg/orgs",
      "repos_url": "https://api.github.com/users/PaulRBerg/repos",
      "events_url": "https://api.github.com/users/PaulRBerg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PaulRBerg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-07T14:41:45Z",
    "updated_at": "2021-09-07T14:42:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thank you for the quick turnaround, ser!\r\n\r\nI look forward to v0.8.8 so I can remove the \".skip\" flags in my tests :D",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/914364021/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
