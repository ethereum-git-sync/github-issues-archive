{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/10900",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/10900/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/10900/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/10900/events",
  "html_url": "https://github.com/ethereum/solidity/issues/10900",
  "id": 801843392,
  "node_id": "MDU6SXNzdWU4MDE4NDMzOTI=",
  "number": 10900,
  "title": "Mismatching data locations are allowed in overrides",
  "user": {
    "login": "nventuro",
    "id": 2530770,
    "node_id": "MDQ6VXNlcjI1MzA3NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2530770?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nventuro",
    "html_url": "https://github.com/nventuro",
    "followers_url": "https://api.github.com/users/nventuro/followers",
    "following_url": "https://api.github.com/users/nventuro/following{/other_user}",
    "gists_url": "https://api.github.com/users/nventuro/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nventuro/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nventuro/subscriptions",
    "organizations_url": "https://api.github.com/users/nventuro/orgs",
    "repos_url": "https://api.github.com/users/nventuro/repos",
    "events_url": "https://api.github.com/users/nventuro/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nventuro/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    },
    {
      "id": 2376132438,
      "node_id": "MDU6TGFiZWwyMzc2MTMyNDM4",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/codegen%20error",
      "name": "codegen error",
      "color": "000000",
      "default": false,
      "description": "Compiler generates invalid code. Critical."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-02-05T04:55:12Z",
  "updated_at": "2022-05-17T11:48:56Z",
  "closed_at": "2022-05-17T11:48:56Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "It is possible to override functions that expect `memory` arguments with implementations that expect them in `calldata`. Offending code compiles with no warnings, but causes runtime errors.\r\n\r\nI've observed this behavior in both 0.7 and 0.8 versions, but haven't tested how far back it goes.\r\n\r\nSample contract:\r\n```solidity\r\n// SPDX-License-Identifier: MIT\r\n\r\npragma solidity ^0.8.0;\r\n\r\npragma experimental ABIEncoderV2;\r\n\r\nabstract contract Base {\r\n    struct Foo {\r\n        uint256 foo;\r\n    }\r\n    \r\n    function bar(Foo memory f) public pure returns (uint256) {\r\n        return baz(f);\r\n    }\r\n    \r\n    function baz(Foo memory f) internal virtual pure returns (uint256);\r\n}\r\n\r\ncontract FaultyDerived is Base {\r\n    function baz(Foo calldata f) internal override pure returns (uint256) {\r\n        return f.foo;       \r\n    }\r\n}\r\n\r\ncontract CorrectDerived is Base {\r\n    function baz(Foo memory f) internal override pure returns (uint256) {\r\n        return f.foo;       \r\n    }\r\n}\r\n```\r\n\r\nI haven't tested too much the runtime issues, but I have seen some inconsistent behavior. When trying the example above on Remix, CorrectDerived works correctly as expected, but FaultyDerived returns 0 always. This is also true if `foo` is an address instead of a uint. \r\n\r\nHowever, on my local Hardhat environment in the project where I found this, I get reverts when attempting to access fields in the offending struct. I imagine this is related to either the fact that my structs are more complex, or that my project has already performed a few memory allocations at the moment the issue is triggered.",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/10900/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/10900/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/774368527",
    "html_url": "https://github.com/ethereum/solidity/issues/10900#issuecomment-774368527",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10900",
    "id": 774368527,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDM2ODUyNw==",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-06T01:12:06Z",
    "updated_at": "2021-02-06T01:12:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "I haven't been able to debug this on Remix because it hangs, but I imagine this is reinterpreting a memory pointer as a calldata pointer, or vice versa.\r\n\r\nThis looks like a pretty serious bug that could be used to write underhanded code.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/774368527/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/774542980",
    "html_url": "https://github.com/ethereum/solidity/issues/10900#issuecomment-774542980",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10900",
    "id": 774542980,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDU0Mjk4MA==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-06T21:02:48Z",
    "updated_at": "2021-02-06T21:02:48Z",
    "author_association": "MEMBER",
    "body": "The ability to use a different data location in the overriding function seems intentional (we even have syntax tests covering it: [`calldata_memory_interface_struct.sol`](https://github.com/ethereum/solidity/blob/v0.8.1/test/libsolidity/syntaxTests/inheritance/override/calldata_memory_interface_struct.sol), [`calldata_memory.sol`](https://github.com/ethereum/solidity/blob/v0.8.1/test/libsolidity/syntaxTests/inheritance/override/calldata_memory.sol), [`calldata_memory_interface_struct.sol`](https://github.com/ethereum/solidity/blob/v0.8.1/test/libsolidity/syntaxTests/inheritance/override/calldata_memory_interface_struct.sol)). This is not mentioned in [Contracts > Function Overriding](https://docs.soliditylang.org/en/latest/contracts.html#function-overriding) though and I think it should be. The example you gave compiles as far back as 0.6.9 which I think is the version that introduced `calldata` parameters. \r\n\r\nThe fact that it reverts or returns zero does look like a bug though. We should investigate and also add a semantic test for that.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/774542980/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/775110435",
    "html_url": "https://github.com/ethereum/solidity/issues/10900#issuecomment-775110435",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10900",
    "id": 775110435,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NTExMDQzNQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-08T12:25:46Z",
    "updated_at": "2021-02-08T12:25:46Z",
    "author_association": "MEMBER",
    "body": "This was neccessary when external functions were still restricted to calldata and public to memory. Otherwise it was impossible to override an external function with a public one. What should not be allowed is to override memory with calldata. If you do this, calling the function locally can lead to problems. In both cases, we should check that the parameter type is properly determined.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/775110435/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1073562377",
    "html_url": "https://github.com/ethereum/solidity/issues/10900#issuecomment-1073562377",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10900",
    "id": 1073562377,
    "node_id": "IC_kwDOAm_5kc4__UMJ",
    "user": {
      "login": "azige",
      "id": 1646859,
      "node_id": "MDQ6VXNlcjE2NDY4NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1646859?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/azige",
      "html_url": "https://github.com/azige",
      "followers_url": "https://api.github.com/users/azige/followers",
      "following_url": "https://api.github.com/users/azige/following{/other_user}",
      "gists_url": "https://api.github.com/users/azige/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/azige/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/azige/subscriptions",
      "organizations_url": "https://api.github.com/users/azige/orgs",
      "repos_url": "https://api.github.com/users/azige/repos",
      "events_url": "https://api.github.com/users/azige/events{/privacy}",
      "received_events_url": "https://api.github.com/users/azige/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-21T07:44:23Z",
    "updated_at": "2022-03-21T07:44:23Z",
    "author_association": "NONE",
    "body": "The worst thing is such codes can be compiled by solc `0.8.12+commit.f00d7308.Emscripten.clang` *without any warnings and errors*. I was trapped once by this. I think the compiler should raise a warning until a proper solution for this issue is made.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1073562377/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
