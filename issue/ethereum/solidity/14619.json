{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/14619",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/14619/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/14619/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/14619/events",
  "html_url": "https://github.com/ethereum/solidity/issues/14619",
  "id": 1944603197,
  "node_id": "I_kwDOAm_5kc5z6Eo9",
  "number": 14619,
  "title": "solc/yul disable all optimisations flag",
  "user": {
    "login": "winsvega",
    "id": 4492341,
    "node_id": "MDQ6VXNlcjQ0OTIzNDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4492341?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/winsvega",
    "html_url": "https://github.com/winsvega",
    "followers_url": "https://api.github.com/users/winsvega/followers",
    "following_url": "https://api.github.com/users/winsvega/following{/other_user}",
    "gists_url": "https://api.github.com/users/winsvega/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/winsvega/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/winsvega/subscriptions",
    "organizations_url": "https://api.github.com/users/winsvega/orgs",
    "repos_url": "https://api.github.com/users/winsvega/repos",
    "events_url": "https://api.github.com/users/winsvega/events{/privacy}",
    "received_events_url": "https://api.github.com/users/winsvega/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4726043980,
      "node_id": "LA_kwDOAm_5kc8AAAABGbG1TA",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/feature",
      "name": "feature",
      "color": "fbca02",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2023-10-16T07:54:17Z",
  "updated_at": "2023-10-17T14:46:04Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Currently there is no way to completely disable optimisations from cmd when using solc. \r\nThe only way to do it is this:\r\n\r\n\r\n> Create x.yul with this content:\r\n\r\n```\r\n{\r\n   pop(mload(0x20))\r\n}\r\n```\r\n\r\nWhen you compile it normally:\r\n\r\n```\r\nqbzzt1@tests:~/yul$ ./solc --yul x.yul\r\n\r\n======= x.yul (EVM) =======\r\n\r\nPretty printed source:\r\nobject \"object\" {\r\n    code { { } }\r\n}\r\n\r\n\r\nBinary representation:\r\n00\r\n\r\nText representation:\r\n    /* \"x.yul\":0:23   */\r\n  stop\r\n```\r\n\r\nBut if you create this inp.json file:\r\n\r\n\r\n```\r\nqbzzt1@tests:~/yul$ cat inp.json \r\n{\r\n  \"language\": \"Yul\",\r\n  \"sources\":\r\n  {\r\n     \"x.yul\":\r\n     {\r\n        \"urls\": [\"./x.yul\"]\r\n     }\r\n  },\r\n  \"settings\": {\r\n    \"outputSelection\": {\r\n      \"*\": {\r\n        \"*\": [ \"evm.bytecode\" ]\r\n      }\r\n    },\r\n    \"optimizer\": {\r\n      \"details\": {\r\n         \"yul\": true,\r\n         \"yulDetails\": {\r\n         }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nAnd run \r\n\r\n```\r\n./solc --standard-json inp.json | jq .contracts[].object.evm.bytecode.object\r\n```\r\n\r\nYou get the result we actually want.\r\n\r\n```\r\nqbzzt1@tests:~/yul$ ./solc --standard-json inp.json | jq .contracts[].object.evm.bytecode.object\r\n\"60205100\"\r\n```\r\n\r\nthe default cmd flag `--no-optimize-yul` does not do that. optimisations still executed. am I missing smth? \r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/14619/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/14619/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1764165634",
    "html_url": "https://github.com/ethereum/solidity/issues/14619#issuecomment-1764165634",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14619",
    "id": 1764165634,
    "node_id": "IC_kwDOAm_5kc5pJwgC",
    "user": {
      "login": "r0qs",
      "id": 457348,
      "node_id": "MDQ6VXNlcjQ1NzM0OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/457348?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/r0qs",
      "html_url": "https://github.com/r0qs",
      "followers_url": "https://api.github.com/users/r0qs/followers",
      "following_url": "https://api.github.com/users/r0qs/following{/other_user}",
      "gists_url": "https://api.github.com/users/r0qs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/r0qs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/r0qs/subscriptions",
      "organizations_url": "https://api.github.com/users/r0qs/orgs",
      "repos_url": "https://api.github.com/users/r0qs/repos",
      "events_url": "https://api.github.com/users/r0qs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/r0qs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-16T10:20:54Z",
    "updated_at": "2023-10-16T13:58:49Z",
    "author_association": "MEMBER",
    "body": "Hi @winsvega, I'm assuming you are using Solidity version `0.8.21`. And since that version there are a minimal set of optimizations that are now enable by default. See this [changelog](https://github.com/ethereum/solidity/releases/tag/v0.8.21) entry:\r\n```\r\nYul Optimizer: Stack-to-memory mover is now enabled by default whenever possible for via IR code generation\r\nand pure Yul compilation.\r\n```\r\n\r\nMay I ask for what reason would you like to disable optimizations? Is that causing any problems for you? If so, could you please share what kind of problems is it causing?\r\n\r\nI believe these discussions here https://github.com/ethereum/solidity/pull/14149#discussion_r1174026509 and here: https://github.com/ethereum/solidity/issues/14470#issuecomment-1706467804 are also relevant for you.\r\n\r\nHowever, using the compiler settings that you provided does not yield the same bytecode as in your example when compiling via standard JSON, i.e.:\r\n\r\nUsing the following settings with solidity `0.8.21`:\r\n```json\r\n    \"optimizer\": {\r\n      \"details\": {\r\n         \"yul\": true,\r\n         \"yulDetails\": {\r\n         }\r\n      }\r\n    }\r\n```\r\n\r\nResults in the following:\r\n```json\r\n{\r\n  \"contracts\": {\r\n    \"x.yul\": {\r\n      \"object\": {\r\n        \"evm\": {\r\n          \"bytecode\": {\r\n            \"functionDebugData\": {},\r\n            \"generatedSources\": [],\r\n            \"linkReferences\": {},\r\n            \"object\": \"00\",\r\n            \"opcodes\": \"STOP \",\r\n            \"sourceMap\": \"0:23:0:-:0\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"errors\": []\r\n}\r\n```\r\n\r\nThis is now the same as when using `\"yul\": false` since solidity version `0.8.21`, because [UnusedPruner](https://docs.soliditylang.org/en/latest/internals/optimizer.html#unused-pruner) is now enabled by default. Which will produces the same bytecode when using the CLI:\r\n```\r\nBinary representation:\r\n00\r\n```\r\n\r\nIf you really need to disable optimizations, you can use the following settings as mentioned [here](https://github.com/ethereum/solidity/pull/14149#discussion_r1174026509), although it is counter intuitive:\r\n```json\r\n\"optimizer\": {\r\n      \"details\": {\r\n         \"yul\": true,\r\n         \"yulDetails\": {\r\n\t      \"optimizerSteps\": \":\"\r\n         }\r\n      }\r\n    }\r\n```\r\n\r\nThis will result in the bytecode you are expecting:\r\n```json\r\n{\r\n  \"contracts\": {\r\n    \"x.yul\": {\r\n      \"object\": {\r\n        \"evm\": {\r\n          \"bytecode\": {\r\n            \"functionDebugData\": {},\r\n            \"generatedSources\": [],\r\n            \"linkReferences\": {},\r\n            \"object\": \"60205100\",\r\n            \"opcodes\": \"PUSH1 0x20 MLOAD STOP \",\r\n            \"sourceMap\": \"15:4:0:-:0;9:11;5:16\"\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n  \"errors\": []\r\n}\r\n```\r\n\r\nOr you can use solidity `<= 0.8.20`:\r\n```\r\n> solc-v0.8.20 --yul x.yul\r\n...\r\nBinary representation:\r\n60205150\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1764165634/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1764304886",
    "html_url": "https://github.com/ethereum/solidity/issues/14619#issuecomment-1764304886",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14619",
    "id": 1764304886,
    "node_id": "IC_kwDOAm_5kc5pKSf2",
    "user": {
      "login": "winsvega",
      "id": 4492341,
      "node_id": "MDQ6VXNlcjQ0OTIzNDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4492341?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/winsvega",
      "html_url": "https://github.com/winsvega",
      "followers_url": "https://api.github.com/users/winsvega/followers",
      "following_url": "https://api.github.com/users/winsvega/following{/other_user}",
      "gists_url": "https://api.github.com/users/winsvega/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/winsvega/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/winsvega/subscriptions",
      "organizations_url": "https://api.github.com/users/winsvega/orgs",
      "repos_url": "https://api.github.com/users/winsvega/repos",
      "events_url": "https://api.github.com/users/winsvega/events{/privacy}",
      "received_events_url": "https://api.github.com/users/winsvega/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-16T11:52:48Z",
    "updated_at": "2023-10-16T13:07:54Z",
    "author_association": "MEMBER",
    "body": "We are using solc yul to compile bytecode for tests. and it really breaks some of the tests since we need a strict bytecode sometimes. \r\nthe everchanging optimisations result in a different bytecode compiled by different versions of solc, which leads to different gas metrics, different code hashes and CREATE2 opcode destination changes. \r\nSo we have to update the tests each time with solc update. an we want to be update with the most recent solc version for test generation. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1764304886/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1764543721",
    "html_url": "https://github.com/ethereum/solidity/issues/14619#issuecomment-1764543721",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14619",
    "id": 1764543721,
    "node_id": "IC_kwDOAm_5kc5pLMzp",
    "user": {
      "login": "r0qs",
      "id": 457348,
      "node_id": "MDQ6VXNlcjQ1NzM0OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/457348?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/r0qs",
      "html_url": "https://github.com/r0qs",
      "followers_url": "https://api.github.com/users/r0qs/followers",
      "following_url": "https://api.github.com/users/r0qs/following{/other_user}",
      "gists_url": "https://api.github.com/users/r0qs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/r0qs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/r0qs/subscriptions",
      "organizations_url": "https://api.github.com/users/r0qs/orgs",
      "repos_url": "https://api.github.com/users/r0qs/repos",
      "events_url": "https://api.github.com/users/r0qs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/r0qs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-16T13:58:31Z",
    "updated_at": "2023-10-16T13:59:10Z",
    "author_association": "MEMBER",
    "body": "Hi @winsvega, does the option that I suggested to disable optimizations work for you? You can use it via command-line as well by doing: `solc --strict-assembly --optimize --yul-optimizations=\":\" x.yul`\r\n\r\nPlease, note that unfortunately, you will need to use the `optimize` flag but pass the empty optimization sequence (i.e. `\":\"`). \r\n\r\nFYI, we discussed this issue today in our weekly meeting and we will add a proper CLI flag to disable optimizations in the same way that the combination that I mentioned above works.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1764543721/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1764581200",
    "html_url": "https://github.com/ethereum/solidity/issues/14619#issuecomment-1764581200",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14619",
    "id": 1764581200,
    "node_id": "IC_kwDOAm_5kc5pLV9Q",
    "user": {
      "login": "winsvega",
      "id": 4492341,
      "node_id": "MDQ6VXNlcjQ0OTIzNDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4492341?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/winsvega",
      "html_url": "https://github.com/winsvega",
      "followers_url": "https://api.github.com/users/winsvega/followers",
      "following_url": "https://api.github.com/users/winsvega/following{/other_user}",
      "gists_url": "https://api.github.com/users/winsvega/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/winsvega/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/winsvega/subscriptions",
      "organizations_url": "https://api.github.com/users/winsvega/orgs",
      "repos_url": "https://api.github.com/users/winsvega/repos",
      "events_url": "https://api.github.com/users/winsvega/events{/privacy}",
      "received_events_url": "https://api.github.com/users/winsvega/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-16T14:16:57Z",
    "updated_at": "2023-10-16T14:16:57Z",
    "author_association": "MEMBER",
    "body": "Let me check ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1764581200/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1766517924",
    "html_url": "https://github.com/ethereum/solidity/issues/14619#issuecomment-1766517924",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14619",
    "id": 1766517924,
    "node_id": "IC_kwDOAm_5kc5pSuyk",
    "user": {
      "login": "qbzzt",
      "id": 12722969,
      "node_id": "MDQ6VXNlcjEyNzIyOTY5",
      "avatar_url": "https://avatars.githubusercontent.com/u/12722969?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/qbzzt",
      "html_url": "https://github.com/qbzzt",
      "followers_url": "https://api.github.com/users/qbzzt/followers",
      "following_url": "https://api.github.com/users/qbzzt/following{/other_user}",
      "gists_url": "https://api.github.com/users/qbzzt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/qbzzt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/qbzzt/subscriptions",
      "organizations_url": "https://api.github.com/users/qbzzt/orgs",
      "repos_url": "https://api.github.com/users/qbzzt/repos",
      "events_url": "https://api.github.com/users/qbzzt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/qbzzt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T14:19:02Z",
    "updated_at": "2023-10-17T14:19:02Z",
    "author_association": "MEMBER",
    "body": "> Hi @winsvega, does the option that I suggested to disable optimizations work for you? You can use it via command-line as well by doing: `solc --strict-assembly --optimize --yul-optimizations=\":\" x.yul`\r\n> \r\n> Please, note that unfortunately, you will need to use the `optimize` flag but pass the empty optimization sequence (i.e. `\":\"`).\r\n> \r\n> FYI, we discussed this issue today in our weekly meeting and we will add a proper CLI flag to disable optimizations in the same way that the combination that I mentioned above works.\r\n\r\nSorry, but it doesn't work. I tried with solc 0.8.21 on Linux.\r\n\r\n```\r\nqbzzt1@tests:~/yul$ ./solc --strict-assembly --optimize  optimizations=\":\" x.yul \r\n\r\n======= x.yul (EVM) =======\r\n\r\nPretty printed source:\r\nobject \"object\" {\r\n    code { { } }\r\n}\r\n\r\n\r\nBinary representation:\r\n00\r\n\r\nText representation:\r\n    /* \"x.yul\":0:23   */\r\n  stop\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1766517924/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1766537260",
    "html_url": "https://github.com/ethereum/solidity/issues/14619#issuecomment-1766537260",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14619",
    "id": 1766537260,
    "node_id": "IC_kwDOAm_5kc5pSzgs",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T14:28:58Z",
    "updated_at": "2023-10-17T14:28:58Z",
    "author_association": "MEMBER",
    "body": "Please try this:\r\n\r\n```bash\r\n./solc --strict-assembly --optimize --yul-optimizations=\":\" x.yul\r\n```\r\n\r\nYou're missing the `--` part before the option. The only reason you're not getting an error is that the `=` makes it look like a [remapping](https://docs.soliditylang.org/en/latest/path-resolution.html#import-remapping) to the compiler. I think it would be a good idea to disallow specifying remappings in situations where they are ignored, but that's a separate issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1766537260/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1766561044",
    "html_url": "https://github.com/ethereum/solidity/issues/14619#issuecomment-1766561044",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14619",
    "id": 1766561044,
    "node_id": "IC_kwDOAm_5kc5pS5UU",
    "user": {
      "login": "qbzzt",
      "id": 12722969,
      "node_id": "MDQ6VXNlcjEyNzIyOTY5",
      "avatar_url": "https://avatars.githubusercontent.com/u/12722969?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/qbzzt",
      "html_url": "https://github.com/qbzzt",
      "followers_url": "https://api.github.com/users/qbzzt/followers",
      "following_url": "https://api.github.com/users/qbzzt/following{/other_user}",
      "gists_url": "https://api.github.com/users/qbzzt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/qbzzt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/qbzzt/subscriptions",
      "organizations_url": "https://api.github.com/users/qbzzt/orgs",
      "repos_url": "https://api.github.com/users/qbzzt/repos",
      "events_url": "https://api.github.com/users/qbzzt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/qbzzt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T14:41:07Z",
    "updated_at": "2023-10-17T14:46:04Z",
    "author_association": "MEMBER",
    "body": "Thank you, it works!!! And sorry for wasting everybody's time - I really should get more sleep.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1766561044/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
