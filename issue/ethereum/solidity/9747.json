{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/9747",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/9747/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/9747/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/9747/events",
  "html_url": "https://github.com/ethereum/solidity/issues/9747",
  "id": 694237957,
  "node_id": "MDU6SXNzdWU2OTQyMzc5NTc=",
  "number": 9747,
  "title": "abi.decode with pragma experimental ABIEncoderV2 reverts with 2-dimensional array",
  "user": {
    "login": "schoeler",
    "id": 2332452,
    "node_id": "MDQ6VXNlcjIzMzI0NTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2332452?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/schoeler",
    "html_url": "https://github.com/schoeler",
    "followers_url": "https://api.github.com/users/schoeler/followers",
    "following_url": "https://api.github.com/users/schoeler/following{/other_user}",
    "gists_url": "https://api.github.com/users/schoeler/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/schoeler/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/schoeler/subscriptions",
    "organizations_url": "https://api.github.com/users/schoeler/orgs",
    "repos_url": "https://api.github.com/users/schoeler/repos",
    "events_url": "https://api.github.com/users/schoeler/events{/privacy}",
    "received_events_url": "https://api.github.com/users/schoeler/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-09-06T03:34:08Z",
  "updated_at": "2020-09-06T16:26:29Z",
  "closed_at": "2020-09-06T16:26:29Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Compiler: 0.5.7\r\nTest set up: Remix on ropsten\r\n\r\nI have a function with a parameter of bytes calldata that needs to be decoded to a struct, but the call reverts in assembly. I believe the issue has something to do with the nested array. I have used a similar technique with only a 1-dimensional array in the struct and it seems to work OK.\r\n\r\n```\r\nstruct InputParams {\r\n    address[] exchangeAddresses;\r\n    address[][] exchangePoolOrPaths;\r\n    address[] tokenAddresses;\r\n    uint256 tokenStartAmount;\r\n    uint256[] tokenAmountsExpected;\r\n}\r\n\r\nfunction execute(uint blockNumber, bytes calldata data, bool admin) external \r\n{\r\n    InputParams memory params = abi.decode(data, (InputParams));  // this reverts in assembly\r\n}\r\n```\r\n\r\nInspecting the raw input to transacting with this function does not provide much info. I parsed out below the separate parameters and they seem to be encoded OK:\r\n\r\n```\r\n     0xb83775a0  // function signature\r\n        0000000000000000000000000000000000000000000000000000000000000000  // parameter \"blockNumber\" == 0\r\n        0000000000000000000000000000000000000000000000000000000000000060  // parameter bytes calldata \"data\" offset value\r\n        0000000000000000000000000000000000000000000000000000000000000001  // parameter \"admin\" == 1\r\n        00000000000000000000000000000000000000000000000000000000000002c0  // struct InputParams length \r\n        00000000000000000000000000000000000000000000000000000000000000a0  // offset of exchangeAddresses[]\r\n        0000000000000000000000000000000000000000000000000000000000000100  // offset of exchangePoolOrPaths[][]\r\n        00000000000000000000000000000000000000000000000000000000000001e0  // offset of tokenAddresses[]\r\n        0000000000000000000000000000000000000000000000004563918244f40000  // value of tokenStartAmount\r\n        0000000000000000000000000000000000000000000000000000000000000260  // offset of tokenAmountsExpected[]\r\n        0000000000000000000000000000000000000000000000000000000000000002  // number of items in exchangeAddresses[]\r\n        0000000000000000000000001cb3aca0179bc96cd9612d6c27285b0458a2500f  // value of exchangeAddresses[0]\r\n        00000000000000000000000080d73310b92da08b230adf441a6352e8f9631a77  // value of exchangeAddresses[1]\r\n        0000000000000000000000000000000000000000000000000000000000000002  // number of items in exchangePoolOrPaths[*][]\r\n        0000000000000000000000000000000000000000000000000000000000000040  // offset of array at exchangePoolOrPaths[0]\r\n        0000000000000000000000000000000000000000000000000000000000000080  // offset of array at exchangePoolOrPaths[1]\r\n        0000000000000000000000000000000000000000000000000000000000000001  // number of items in array at exchangePoolOrPaths[0]\r\n        000000000000000000000000b5ffd0a221fc94de9255382e70ce1aec76b68c89  // value of exchangePoolOrPaths[0][0]\r\n        0000000000000000000000000000000000000000000000000000000000000001  // number of items in array at exchangePoolOrPaths[1]\r\n        0000000000000000000000003b3d4eefdc603b232907a7f3d0ed1eea5c62b5f7  // value of exchangePoolOrPaths[1][0]\r\n        0000000000000000000000000000000000000000000000000000000000000003  // number of items in tokenAddresses[]\r\n        000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2  // value of tokenAddresses[0]\r\n        0000000000000000000000000ae055097c6d159879521c384f1d2123d1f195e6  // value of tokenAddresses[1]\r\n        000000000000000000000000c02aaa39b223fe8d0a0e5c4f27ead9083c756cc2  // value of tokenAddresses[2]\r\n        0000000000000000000000000000000000000000000000000000000000000002  // number of items in tokenAmountsExpected[]\r\n        0000000000000000000000000000000000000000000000039fe550f187a54000  // value of tokenAmountsExpected[0]\r\n        0000000000000000000000000000000000000000000000004563918244f40000  // value of tokenAmountsExpected[1]\r\n```\r\nDoes anyone have any idea what the problem could be here, or is this a bug?",
  "closed_by": {
    "login": "schoeler",
    "id": 2332452,
    "node_id": "MDQ6VXNlcjIzMzI0NTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2332452?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/schoeler",
    "html_url": "https://github.com/schoeler",
    "followers_url": "https://api.github.com/users/schoeler/followers",
    "following_url": "https://api.github.com/users/schoeler/following{/other_user}",
    "gists_url": "https://api.github.com/users/schoeler/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/schoeler/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/schoeler/subscriptions",
    "organizations_url": "https://api.github.com/users/schoeler/orgs",
    "repos_url": "https://api.github.com/users/schoeler/repos",
    "events_url": "https://api.github.com/users/schoeler/events{/privacy}",
    "received_events_url": "https://api.github.com/users/schoeler/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/9747/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/9747/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/687805257",
    "html_url": "https://github.com/ethereum/solidity/issues/9747#issuecomment-687805257",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9747",
    "id": 687805257,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NzgwNTI1Nw==",
    "user": {
      "login": "schoeler",
      "id": 2332452,
      "node_id": "MDQ6VXNlcjIzMzI0NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2332452?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/schoeler",
      "html_url": "https://github.com/schoeler",
      "followers_url": "https://api.github.com/users/schoeler/followers",
      "following_url": "https://api.github.com/users/schoeler/following{/other_user}",
      "gists_url": "https://api.github.com/users/schoeler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/schoeler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/schoeler/subscriptions",
      "organizations_url": "https://api.github.com/users/schoeler/orgs",
      "repos_url": "https://api.github.com/users/schoeler/repos",
      "events_url": "https://api.github.com/users/schoeler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/schoeler/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-06T14:31:31Z",
    "updated_at": "2020-09-06T14:31:31Z",
    "author_association": "NONE",
    "body": "Hi All,  \r\nI think I simplified the problem case.  I think there's an issue with decode and dynamic arrays inside structs.\r\n\r\nWhat works:\r\n```\r\n    struct InputParams\r\n    {\r\n        address[2] exchangeAddresses;\r\n    }\r\n\r\n    function execute(uint blockNumber, bytes calldata data, bool admin) external\r\n    {\r\n        InputParams memory params = abi.decode(data, (InputParams));\r\n    }\r\n\r\nwith calldata:\r\n\r\n0xb83775a0\r\n0000000000000000000000000000000000000000000000000000000000000000\r\n0000000000000000000000000000000000000000000000000000000000000060\r\n0000000000000000000000000000000000000000000000000000000000000001\r\n0000000000000000000000000000000000000000000000000000000000000040\r\n000000000000000000000000b5ffd0a221fc94de9255382e70ce1aec76b68c89\r\n0000000000000000000000003b3d4eefdc603b232907a7f3d0ed1eea5c62b5f7\r\n```\r\n\r\nWhat does not work (reverts during decode):\r\n\r\n\r\n```\r\n    struct InputParams\r\n    {\r\n        address[] exchangeAddresses;\r\n    }\r\n\r\n    function execute(uint blockNumber, bytes calldata data, bool admin) external\r\n    {\r\n        InputParams memory params = abi.decode(data, (InputParams));\r\n    }\r\n\r\nwith calldata:\r\n\r\n0xb83775a0\r\n0000000000000000000000000000000000000000000000000000000000000000\r\n0000000000000000000000000000000000000000000000000000000000000060\r\n0000000000000000000000000000000000000000000000000000000000000001\r\n0000000000000000000000000000000000000000000000000000000000000080\r\n0000000000000000000000000000000000000000000000000000000000000020\r\n0000000000000000000000000000000000000000000000000000000000000002\r\n000000000000000000000000b5ffd0a221fc94de9255382e70ce1aec76b68c89\r\n0000000000000000000000003b3d4eefdc603b232907a7f3d0ed1eea5c62b5f7\r\n```\r\n\r\nLet me know if I can provide more info and if I am actually just passing incorrect calldata...",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/687805257/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/687833241",
    "html_url": "https://github.com/ethereum/solidity/issues/9747#issuecomment-687833241",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9747",
    "id": 687833241,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NzgzMzI0MQ==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-06T16:24:00Z",
    "updated_at": "2020-09-06T16:24:00Z",
    "author_association": "MEMBER",
    "body": "The content of `data` is not encoded correctly for `abi.decode()`. That builtin expects a tuple, even if the tuple contains just a single value. In your case it must be a single-element tuple containing the `InputParams` struct but you're giving it that struct directly, not wrapped in anything.\r\n\r\nThe working example above works because `address[2]` is a static type and a single-element tuple containing such a type looks exactly like that type when encoded (it does not have a separate header containing offsets).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/687833241/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/687833870",
    "html_url": "https://github.com/ethereum/solidity/issues/9747#issuecomment-687833870",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9747",
    "id": 687833870,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NzgzMzg3MA==",
    "user": {
      "login": "schoeler",
      "id": 2332452,
      "node_id": "MDQ6VXNlcjIzMzI0NTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2332452?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/schoeler",
      "html_url": "https://github.com/schoeler",
      "followers_url": "https://api.github.com/users/schoeler/followers",
      "following_url": "https://api.github.com/users/schoeler/following{/other_user}",
      "gists_url": "https://api.github.com/users/schoeler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/schoeler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/schoeler/subscriptions",
      "organizations_url": "https://api.github.com/users/schoeler/orgs",
      "repos_url": "https://api.github.com/users/schoeler/repos",
      "events_url": "https://api.github.com/users/schoeler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/schoeler/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-06T16:26:27Z",
    "updated_at": "2020-09-06T16:26:27Z",
    "author_association": "NONE",
    "body": "Awesome, thanks for the insight!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/687833870/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
