{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/9952",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/9952/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/9952/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/9952/events",
  "html_url": "https://github.com/ethereum/solidity/issues/9952",
  "id": 714333936,
  "node_id": "MDU6SXNzdWU3MTQzMzM5MzY=",
  "number": 9952,
  "title": "BadSetOnceAccess on invalid double assignment involving `new`",
  "user": {
    "login": "agroce",
    "id": 967816,
    "node_id": "MDQ6VXNlcjk2NzgxNg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/967816?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/agroce",
    "html_url": "https://github.com/agroce",
    "followers_url": "https://api.github.com/users/agroce/followers",
    "following_url": "https://api.github.com/users/agroce/following{/other_user}",
    "gists_url": "https://api.github.com/users/agroce/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/agroce/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/agroce/subscriptions",
    "organizations_url": "https://api.github.com/users/agroce/orgs",
    "repos_url": "https://api.github.com/users/agroce/repos",
    "events_url": "https://api.github.com/users/agroce/events{/privacy}",
    "received_events_url": "https://api.github.com/users/agroce/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    },
    {
      "id": 1333817191,
      "node_id": "MDU6TGFiZWwxMzMzODE3MTkx",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/fuzz-blocker",
      "name": "fuzz-blocker",
      "color": "e56129",
      "default": false,
      "description": "High priority bug. Blocks further fuzzing until fixed."
    },
    {
      "id": 2376148917,
      "node_id": "MDU6TGFiZWwyMzc2MTQ4OTE3",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/should%20report%20better%20error",
      "name": "should report better error",
      "color": "53e0b5",
      "default": false,
      "description": "Error is just badly reported. Should be a proper type error - source is not fine."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "Marenz",
    "id": 424752,
    "node_id": "MDQ6VXNlcjQyNDc1Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Marenz",
    "html_url": "https://github.com/Marenz",
    "followers_url": "https://api.github.com/users/Marenz/followers",
    "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
    "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
    "organizations_url": "https://api.github.com/users/Marenz/orgs",
    "repos_url": "https://api.github.com/users/Marenz/repos",
    "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Marenz/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "Marenz",
      "id": 424752,
      "node_id": "MDQ6VXNlcjQyNDc1Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Marenz",
      "html_url": "https://github.com/Marenz",
      "followers_url": "https://api.github.com/users/Marenz/followers",
      "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
      "organizations_url": "https://api.github.com/users/Marenz/orgs",
      "repos_url": "https://api.github.com/users/Marenz/repos",
      "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Marenz/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2020-10-04T15:08:03Z",
  "updated_at": "2020-10-07T13:03:54Z",
  "closed_at": "2020-10-07T13:03:54Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nThis contract:\r\n```solidity\r\nlibrary Pairing {\r\n    struct G1Point {}\r\n    struct G2Point {}\r\n    function pairingProd4(\r\n\tG1Point memory a1,\r\n\tG2Point memory d2\r\n    )\r\n    {\r\n\tG2Point[] memory p2 = new G2Point[]= a1;\r\n    }\r\n}\r\n```\r\n\r\nproduces:\r\n\r\n```\r\nException during compilation: /home/user/solidity/libsolutil/SetOnce.h(73): Throw in function const T &solidity::util::SetOnce<bool>::operator*() const [T = bool]\r\nDynamic exception type: boost::exception_detail::clone_impl<solidity::util::BadSetOnceAccess>\r\nstd::exception::what: BadSetOnceAccess\r\n[solidity::util::tag_comment*] = Attempt to access the value of a SetOnce that does not have a value.\r\n```\r\n\r\nwhen compiled with solc.\r\n\r\nProbably related to https://github.com/ethereum/solidity/issues/9890 -- or at least the same symptom.\r\n\r\nOn master, using AFL fuzzing.  Another discovery using https://github.com/agroce/afl-compiler-fuzzer.\r\n\r\n## Environment\r\n\r\n- Compiler version:  0.7.3-develop.2020.10.2+commit.756e21a8.Linux.clang\r\n- Target EVM version (as per compiler settings): N/A\r\n- Framework/IDE (e.g. Truffle or Remix): N/A\r\n- EVM execution environment / backend / blockchain client: N/A\r\n- Operating system: Ubuntu 18.04 in docker\r\n\r\n## Steps to Reproduce\r\n\r\nAbove shows pretty clearly, I think.\r\n",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/9952/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/9952/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/703272102",
    "html_url": "https://github.com/ethereum/solidity/issues/9952#issuecomment-703272102",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9952",
    "id": 703272102,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMzI3MjEwMg==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-04T15:29:53Z",
    "updated_at": "2020-10-04T15:30:35Z",
    "author_association": "MEMBER",
    "body": "Thanks for the report. Your fuzzing seems pretty effective :)\r\n\r\nYeah, it does look like another corner case from #9839 where a `SetOnce` value gets assigned twice (pinging @Marenz again). The control flow in that PR was pretty hard to analyze (lots of branches in many functions calling each other) so this might not be the last one. It started producing an ICE on 0.7.2 where that PR was merged.\r\n\r\n### Simplified sample\r\nThe key elements here seem to be the double assignments and the use of `new`:\r\n\r\n```solidity\r\ncontract C {\r\n    function foo(uint x)\r\n    {\r\n        uint p = new uint[] = x;\r\n    }\r\n}\r\n```\r\n\r\n### Errors on 0.7.1 for the simplified sample\r\n```\r\nError: No visibility specified. Did you intend to add \"public\"?\r\n --> /tmp/test.sol:2:5:\r\n  |\r\n2 |     function foo(uint x)\r\n  |     ^ (Relevant source part starts here and spans across multiple lines).\r\n\r\nError: Expression has to be an lvalue.\r\n --> /tmp/test.sol:4:18:\r\n  |\r\n4 |         uint p = new uint[] = x;\r\n  |                  ^^^^^^^^^^\r\n\r\nError: Type uint256 is not implicitly convertible to expected type function (uint256) pure returns (uint256[] memory).\r\n --> /tmp/test.sol:4:31:\r\n  |\r\n4 |         uint p = new uint[] = x;\r\n  |                               ^\r\n\r\nError: Type function (uint256) pure returns (uint256[] memory) is not implicitly convertible to expected type uint256.\r\n --> /tmp/test.sol:4:9:\r\n  |\r\n4 |         uint p = new uint[] = x;\r\n  |         ^^^^^^^^^^^^^^^^^^^^^^^\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/703272102/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704802281",
    "html_url": "https://github.com/ethereum/solidity/issues/9952#issuecomment-704802281",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9952",
    "id": 704802281,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDgwMjI4MQ==",
    "user": {
      "login": "bshastry",
      "id": 2388185,
      "node_id": "MDQ6VXNlcjIzODgxODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bshastry",
      "html_url": "https://github.com/bshastry",
      "followers_url": "https://api.github.com/users/bshastry/followers",
      "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
      "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
      "organizations_url": "https://api.github.com/users/bshastry/orgs",
      "repos_url": "https://api.github.com/users/bshastry/repos",
      "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bshastry/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T09:09:56Z",
    "updated_at": "2020-10-07T10:13:03Z",
    "author_association": "MEMBER",
    "body": "~~A smaller repro~~ Some more repros. This crash occurs within seconds and very frequently in our fuzzing rigs.\r\n\r\n```\r\ncontract A{}contract B{A a=new B=a;}\r\n```\r\n\r\n```\r\nenum X{A}function t(){X.A=X;}\r\n```\r\n\r\n```\r\ncontract A{}contract B{A a=new B=();}\r\n```\r\n\r\n```\r\ncontract C{function f(){new int[]=6;}}\r\n```\r\n\r\n```\r\ncontract C{function f(){new int[]=int;}}\r\n```\r\n\r\n```\r\ncontract C{\r\n  enum A {X}\r\n  function f() {(delete A.X,[]);}\r\n}\r\n```\r\n\r\n```\r\ncontract D{function foo(){this.foo{g:5}=();}}\r\n```\r\n\r\n```\r\ncontract C{struct T{ }enum A{X}function f() {byte.e(delete A.X);}}\r\n```\r\n\r\n```\r\ncontract D{constructor(){new D=D;}}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704802281/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704863766",
    "html_url": "https://github.com/ethereum/solidity/issues/9952#issuecomment-704863766",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9952",
    "id": 704863766,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDg2Mzc2Ng==",
    "user": {
      "login": "Marenz",
      "id": 424752,
      "node_id": "MDQ6VXNlcjQyNDc1Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Marenz",
      "html_url": "https://github.com/Marenz",
      "followers_url": "https://api.github.com/users/Marenz/followers",
      "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
      "organizations_url": "https://api.github.com/users/Marenz/orgs",
      "repos_url": "https://api.github.com/users/Marenz/repos",
      "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Marenz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T11:09:34Z",
    "updated_at": "2020-10-07T11:09:34Z",
    "author_association": "MEMBER",
    "body": "At least the first two are kind of fixed by #9953 however, another assert is triggered. I am currently looking into this",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704863766/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704870290",
    "html_url": "https://github.com/ethereum/solidity/issues/9952#issuecomment-704870290",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9952",
    "id": 704870290,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDg3MDI5MA==",
    "user": {
      "login": "Marenz",
      "id": 424752,
      "node_id": "MDQ6VXNlcjQyNDc1Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Marenz",
      "html_url": "https://github.com/Marenz",
      "followers_url": "https://api.github.com/users/Marenz/followers",
      "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
      "organizations_url": "https://api.github.com/users/Marenz/orgs",
      "repos_url": "https://api.github.com/users/Marenz/repos",
      "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Marenz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T11:23:43Z",
    "updated_at": "2020-10-07T11:23:43Z",
    "author_association": "MEMBER",
    "body": "Okay, you actually removed the earlier one again. All that you listed here are fixed by #9953",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704870290/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704875921",
    "html_url": "https://github.com/ethereum/solidity/issues/9952#issuecomment-704875921",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9952",
    "id": 704875921,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDg3NTkyMQ==",
    "user": {
      "login": "bshastry",
      "id": 2388185,
      "node_id": "MDQ6VXNlcjIzODgxODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bshastry",
      "html_url": "https://github.com/bshastry",
      "followers_url": "https://api.github.com/users/bshastry/followers",
      "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
      "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
      "organizations_url": "https://api.github.com/users/bshastry/orgs",
      "repos_url": "https://api.github.com/users/bshastry/repos",
      "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bshastry/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T11:36:13Z",
    "updated_at": "2020-10-07T11:36:13Z",
    "author_association": "MEMBER",
    "body": "Sorry, mixed up and edited in place. Should you strike through the next time so the edit is seen.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704875921/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
