{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/4037",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/4037/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/4037/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/4037/events",
  "html_url": "https://github.com/ethereum/solidity/issues/4037",
  "id": 319095034,
  "node_id": "MDU6SXNzdWUzMTkwOTUwMzQ=",
  "number": 4037,
  "title": "struct constants",
  "user": {
    "login": "wadealexc",
    "id": 18387287,
    "node_id": "MDQ6VXNlcjE4Mzg3Mjg3",
    "avatar_url": "https://avatars.githubusercontent.com/u/18387287?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wadealexc",
    "html_url": "https://github.com/wadealexc",
    "followers_url": "https://api.github.com/users/wadealexc/followers",
    "following_url": "https://api.github.com/users/wadealexc/following{/other_user}",
    "gists_url": "https://api.github.com/users/wadealexc/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wadealexc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wadealexc/subscriptions",
    "organizations_url": "https://api.github.com/users/wadealexc/orgs",
    "repos_url": "https://api.github.com/users/wadealexc/repos",
    "events_url": "https://api.github.com/users/wadealexc/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wadealexc/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 785717317,
      "node_id": "MDU6TGFiZWw3ODU3MTczMTc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/language%20design%20:rage4:",
      "name": "language design :rage4:",
      "color": "9d76d3",
      "default": false,
      "description": "Any changes to the language, e.g. new features"
    },
    {
      "id": 4699444681,
      "node_id": "LA_kwDOAm_5kc8AAAABGBvVyQ",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/stale",
      "name": "stale",
      "color": "BF4801",
      "default": false,
      "description": "The issue/PR was marked as stale because it has been open for too long."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2018-05-01T02:05:47Z",
  "updated_at": "2023-02-19T21:17:14Z",
  "closed_at": "2023-02-19T21:16:09Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "It would be very helpful to allow `constant` structs. Currently, the workaround is to define internal functions that return structs.\r\n\r\nExample:\r\n```Solidity\r\npragma solidity ^0.5.0\r\n\r\ncontract ConstStructs {\r\n\r\n    struct SomeStruct {\r\n        uint val1;\r\n        bytes32 val2;\r\n    }\r\n\r\n    SomeStruct public constant CONST_STRUCT = SomeStruct({\r\n       val1: 5,\r\n       val2: bytes32(123)\r\n    });\r\n}\r\n```\r\n\r\nForgot to post the workaround -\r\n\r\n```Solidity\r\npragma solidity ^0.4.23;\r\n\r\ncontract ConstStructs {\r\n\r\n    struct SomeStruct {\r\n        uint val1;\r\n        bytes32 val2;\r\n    }\r\n    \r\n    function getSomeStruct() internal pure returns (SomeStruct memory) {\r\n        return SomeStruct({\r\n           val1: 5,\r\n           val2: bytes32(123)\r\n        });\r\n    }\r\n\r\n    uint public constant SOMESTRUCT_CONST_UINT = getSomeStruct().val1;\r\n    bytes32 public constant SOMESTRUCT_CONST_BYTES32 = getSomeStruct().val2;\r\n}\r\n```",
  "closed_by": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/4037/reactions",
    "total_count": 4,
    "+1": 3,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 1,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/4037/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/386013425",
    "html_url": "https://github.com/ethereum/solidity/issues/4037#issuecomment-386013425",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4037",
    "id": 386013425,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NjAxMzQyNQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-02T15:14:00Z",
    "updated_at": "2018-05-02T15:14:00Z",
    "author_association": "MEMBER",
    "body": "This also requires \"immutability checks\" to be implemented, because you obviously do not want `CONST_STRUCT.val1 = 7` to work.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/386013425/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/395174544",
    "html_url": "https://github.com/ethereum/solidity/issues/4037#issuecomment-395174544",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4037",
    "id": 395174544,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NTE3NDU0NA==",
    "user": {
      "login": "androlo",
      "id": 2809499,
      "node_id": "MDQ6VXNlcjI4MDk0OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2809499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/androlo",
      "html_url": "https://github.com/androlo",
      "followers_url": "https://api.github.com/users/androlo/followers",
      "following_url": "https://api.github.com/users/androlo/following{/other_user}",
      "gists_url": "https://api.github.com/users/androlo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/androlo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/androlo/subscriptions",
      "organizations_url": "https://api.github.com/users/androlo/orgs",
      "repos_url": "https://api.github.com/users/androlo/repos",
      "events_url": "https://api.github.com/users/androlo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/androlo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-06T18:48:51Z",
    "updated_at": "2018-06-06T18:48:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "Awesome. Guess this would allow structs as arguments to external functions as well.\r\n\r\nSeems like a big update, since it would require constant declaration (and behavior) to work for all possible reference types. Only arrays would be a great start imo. Maybe only constant size arrays at first, if that is simpler. Seems like that change would be easier to do, since immutability checks are already in place (for calldata arrays in external functions). Guess the only thing that would be needed is to make sure that constant arrays are only accessed by constant/literal numbers.\r\n\r\nOn a related note, a thing I would like to be able to do is to declare a constant array, but assign a non constant variable to it and load it into memory that way. It would be much cleaner then having to create a function, or to do it \"on the spot\". Not sure if any of this is a good idea for Solidity though, or worth the trouble.\r\n\r\n```\r\ncontract C {\r\n    uint[4] constant nums = [uint(1), 2, 3, 4];\r\n    \r\n    function something() public {\r\n        uint[4] memory x = nums; // copies nums to memory\r\n        uint varN = 2;\r\n\r\n        x[2]; // allowed\r\n        x[varN]; // allowed.\r\n        x[2] = 5; // allowed, does not change 'nums'\r\n\r\n        nums[2]; // allowed\r\n        nums[varN]; // not allowed.\r\n        nums[2] == 5; // not allowed\r\n// ...\r\n    }\r\n}\r\n```\r\n\r\nMaybe constant types should be possible to declare inside of functions too, and behave the same way as regular constants.\r\n\r\n```\r\ncontract C {\r\n    uint[4] constant nums = [uint(1), 2, 3, 4];\r\n    \r\n    function something() public {\r\n        uint[4] constant x = nums; // does not copy\r\n        uint varN = 2;\r\n        uint constant constN = 2; // would also be possible\r\n\r\n        x[constN]; // allowed\r\n        x[2]; // allowed\r\n        x[varN]; // not allowed.\r\n        x[2] = 5; // not allowed\r\n        // ...\r\n    }\r\n}\r\n```\r\n\r\nSorry for sperging, but I have had some thoughts around this.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/395174544/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/534866477",
    "html_url": "https://github.com/ethereum/solidity/issues/4037#issuecomment-534866477",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4037",
    "id": 534866477,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzNDg2NjQ3Nw==",
    "user": {
      "login": "Pr0methean",
      "id": 4961925,
      "node_id": "MDQ6VXNlcjQ5NjE5MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4961925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Pr0methean",
      "html_url": "https://github.com/Pr0methean",
      "followers_url": "https://api.github.com/users/Pr0methean/followers",
      "following_url": "https://api.github.com/users/Pr0methean/following{/other_user}",
      "gists_url": "https://api.github.com/users/Pr0methean/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Pr0methean/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Pr0methean/subscriptions",
      "organizations_url": "https://api.github.com/users/Pr0methean/orgs",
      "repos_url": "https://api.github.com/users/Pr0methean/repos",
      "events_url": "https://api.github.com/users/Pr0methean/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Pr0methean/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-25T05:58:36Z",
    "updated_at": "2019-09-25T05:58:36Z",
    "author_association": "NONE",
    "body": "The `pure` modifier isn't very useful without this feature: I've had to use `view` instead, just to avoid re-instantiating a zero BigNumber every time I use one.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/534866477/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1432985761",
    "html_url": "https://github.com/ethereum/solidity/issues/4037#issuecomment-1432985761",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4037",
    "id": 1432985761,
    "node_id": "IC_kwDOAm_5kc5VaaCh",
    "user": {
      "login": "github-actions[bot]",
      "id": 41898282,
      "node_id": "MDM6Qm90NDE4OTgyODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/15368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/github-actions%5Bbot%5D",
      "html_url": "https://github.com/apps/github-actions",
      "followers_url": "https://api.github.com/users/github-actions%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/github-actions%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/github-actions%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/github-actions%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/github-actions%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2023-02-16T12:05:02Z",
    "updated_at": "2023-02-16T12:05:02Z",
    "author_association": "NONE",
    "body": "This issue has been marked as stale due to inactivity for the last 90 days.\nIt will be automatically closed in 7 days.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1432985761/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1436095901",
    "html_url": "https://github.com/ethereum/solidity/issues/4037#issuecomment-1436095901",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4037",
    "id": 1436095901,
    "node_id": "IC_kwDOAm_5kc5VmRWd",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-19T21:16:09Z",
    "updated_at": "2023-02-19T21:17:14Z",
    "author_association": "MEMBER",
    "body": "I think that having some form of constant structs is a very good idea, but I doubt we'll be able to implement them the way presented here.\r\n\r\nThe problem is that currently structs are passed around pretty much only by reference so such a constant would have to be stored in memory and nothing in memory is truly constant. In the worst case you can always modify it with inline assembly. This means that the compiler would not be able to really treat it as a compile-time constant.\r\n\r\nIf, on the other hand, we were to make struct constants work like the current value type constants (and avoid memory), their uses would be very limited. You'd only be able to pass them in to external functions or `abi.encode()`, where the function does not really need a reference to the original struct. Such constants could potentially become more usable in the future when we redo reference semantics in a way that would allow passing structs around by value, but that's uncertain and too vague to consider now.\r\n\r\nThere's good news though. There *is* a good way to add structs that are constant for most practical purposes - `immutable`. We already have plans to implement immutable reference types in the near future: #13323. This way the struct would be embedded in the bytecode and (after construction) truly immutable. Due to this I'm closing this particular proposal.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1436095901/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
