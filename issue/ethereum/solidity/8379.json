{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/8379",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/8379/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/8379/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/8379/events",
  "html_url": "https://github.com/ethereum/solidity/issues/8379",
  "id": 570062740,
  "node_id": "MDU6SXNzdWU1NzAwNjI3NDA=",
  "number": 8379,
  "title": "Multi-file projects that do not all use ABIEncoderV2",
  "user": {
    "login": "safakoks",
    "id": 17928869,
    "node_id": "MDQ6VXNlcjE3OTI4ODY5",
    "avatar_url": "https://avatars.githubusercontent.com/u/17928869?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/safakoks",
    "html_url": "https://github.com/safakoks",
    "followers_url": "https://api.github.com/users/safakoks/followers",
    "following_url": "https://api.github.com/users/safakoks/following{/other_user}",
    "gists_url": "https://api.github.com/users/safakoks/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/safakoks/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/safakoks/subscriptions",
    "organizations_url": "https://api.github.com/users/safakoks/orgs",
    "repos_url": "https://api.github.com/users/safakoks/repos",
    "events_url": "https://api.github.com/users/safakoks/events{/privacy}",
    "received_events_url": "https://api.github.com/users/safakoks/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    },
    {
      "id": 2376148917,
      "node_id": "MDU6TGFiZWwyMzc2MTQ4OTE3",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/should%20report%20better%20error",
      "name": "should report better error",
      "color": "53e0b5",
      "default": false,
      "description": "Error is just badly reported. Should be a proper type error - source is not fine."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 12,
  "created_at": "2020-02-24T18:59:35Z",
  "updated_at": "2020-10-07T08:46:13Z",
  "closed_at": "2020-10-07T08:46:13Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "\r\n## Description\r\n\r\nI tried ``truffle test``, it returns pointless error. Then, I used remix to compile test contract, it returns : ``` InternalCompilerError: Unknown dynamically sized type: struct Stack.Item memory```. After that, I added  ``pragma experimental ABIEncoderV2;`` into test contract. It compiled on remix perfectly but ``truffle test`` still does not work \r\n\r\n## Environment\r\n\r\n- Compiler version: 0.6.0\r\n- Target EVM version (as per compiler settings): byzantium\r\n- Framework/IDE (e.g. Truffle or Remix): Truffle\r\n- EVM execution environment / backend / blockchain client: GETH/Quorum\r\n- Operating system: Ubuntu 16.04 LTS\r\n\r\n## Steps to Reproduce\r\nMy main contract : \r\n```\r\npragma solidity ^0.6.0;\r\npragma experimental ABIEncoderV2;\r\n\r\n\r\ncontract Stack{\r\n    \r\n    struct Item{\r\n         string  name;\r\n         uint256 quantity;\r\n         bool isSolid;\r\n    }\r\n    \r\n    mapping(address => Item[]) userItemsMap;\r\n    \r\n    \r\n    function addItem(string memory _name, uint256 _quantity, bool _isSolid) public {\r\n        userItemsMap[msg.sender].push(Item({\r\n        name:_name,\r\n        quantity:_quantity,\r\n        isSolid :_isSolid\r\n            }));\r\n    }\r\n    \r\n    function getItems() public view returns(Item[] memory){\r\n        return userItemsMap[msg.sender];\r\n    }\r\n    \r\n    function getLastItem() public view returns(Item memory){\r\n        Item[] memory userItems = userItemsMap[msg.sender];\r\n        require(userItems.length>0);\r\n        return userItems[userItems.length - 1];\r\n    }\r\n    \r\n    \r\n    \r\n}\r\n```\r\nAnd my test contract, \r\n\r\n```\r\npragma solidity ^0.6.0;\r\npragma experimental ABIEncoderV2;\r\n\r\nimport \"truffle/Assert.sol\";\r\nimport \"truffle/DeployedAddresses.sol\";\r\nimport \"../contracts/Stack.sol\";\r\n\r\ncontract  TestStackContract{\r\n\r\n    function testAddingItem() public {\r\n\r\n        Stack stackInstance =  Stack(DeployedAddresses.Stack());\r\n\r\n        stackInstance.addItem(\"Apple\",125,true);\r\n\r\n        Stack.Item memory lastItem = stackInstance.getLastItem();\r\n\r\n        Assert.equal(lastItem.name, \"Apple\", \"Name should be Apple\");\r\n\r\n    }\r\n\r\n}\r\n```\r\n\r\nWhen I run ```truffle test```  it returns this : \r\n```\r\nCompiling your contracts...\r\n===========================\r\n> Compiling ./contracts/Stack.sol\r\n> Compiling ./test/TestBiddingContract.sol\r\n> Compiling ./test/TestStack.sol\r\n\r\nInternalCompilerError:\r\n\r\nCompilation failed. See above.\r\nTruffle v5.1.13 (core: 5.1.13)\r\nNode v8.17.0\r\n\r\n```\r\n\r\nit is another [issue](https://github.com/trufflesuite/truffle/issues/2849) on Truffle that I already asked. Message of its error on remix is that :  ``` InternalCompilerError: Unknown dynamically sized type: struct Stack.Item memory```\r\n\r\n",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/8379/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/8379/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/590753258",
    "html_url": "https://github.com/ethereum/solidity/issues/8379#issuecomment-590753258",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8379",
    "id": 590753258,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MDc1MzI1OA==",
    "user": {
      "login": "elenadimitrova",
      "id": 703848,
      "node_id": "MDQ6VXNlcjcwMzg0OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/703848?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/elenadimitrova",
      "html_url": "https://github.com/elenadimitrova",
      "followers_url": "https://api.github.com/users/elenadimitrova/followers",
      "following_url": "https://api.github.com/users/elenadimitrova/following{/other_user}",
      "gists_url": "https://api.github.com/users/elenadimitrova/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/elenadimitrova/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/elenadimitrova/subscriptions",
      "organizations_url": "https://api.github.com/users/elenadimitrova/orgs",
      "repos_url": "https://api.github.com/users/elenadimitrova/repos",
      "events_url": "https://api.github.com/users/elenadimitrova/events{/privacy}",
      "received_events_url": "https://api.github.com/users/elenadimitrova/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-25T08:51:10Z",
    "updated_at": "2020-02-25T08:51:40Z",
    "author_association": "COLLABORATOR",
    "body": "The above code compiles and works in Remix. Leaving for the truffle team to look into. Reopen if confirmed issue in Solidity compiler.\r\n![Screenshot 2020-02-25 at 10 50 53](https://user-images.githubusercontent.com/703848/75230681-c8a5d200-57bc-11ea-9649-d6e40f4b21f0.png)\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/590753258/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/590788608",
    "html_url": "https://github.com/ethereum/solidity/issues/8379#issuecomment-590788608",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8379",
    "id": 590788608,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MDc4ODYwOA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-25T10:11:25Z",
    "updated_at": "2020-02-25T10:12:13Z",
    "author_association": "MEMBER",
    "body": "I suspect this actually is a bug in the compiler. Note that the old abi encoder is used in one file while the new abi encoder is used in the other file. The one that has the old encoder is using a new-encoder-feature during decoding. So to reproduce it, you need to use at least two source files.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/590788608/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/625483419",
    "html_url": "https://github.com/ethereum/solidity/issues/8379#issuecomment-625483419",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8379",
    "id": 625483419,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNTQ4MzQxOQ==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-07T20:35:37Z",
    "updated_at": "2020-05-07T20:35:37Z",
    "author_association": "MEMBER",
    "body": "Without truffle and removing the `Assert` line it is not reproducible. Maybe it was fixed?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/625483419/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/625527314",
    "html_url": "https://github.com/ethereum/solidity/issues/8379#issuecomment-625527314",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8379",
    "id": 625527314,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNTUyNzMxNA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-07T22:24:03Z",
    "updated_at": "2020-05-07T22:24:03Z",
    "author_association": "MEMBER",
    "body": "Can still reproduce it:\r\n\r\n1_Storage.sol:\r\n```\r\npragma solidity ^0.6.0;\r\npragma experimental ABIEncoderV2;\r\ncontract Stack{\r\n    struct Item{ uint x; }\r\n    function getLastItem() public view returns(Item memory){\r\n    }\r\n}\r\n```\r\n\r\n2_owner.sol:\r\n```\r\npragma solidity ^0.6.0;\r\nimport \"./1_Storage.sol\";\r\ncontract  TestStackContract{\r\n    function testAddingItem() public {\r\n        Stack(0x00).getLastItem();\r\n    }\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/625527314/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/625527977",
    "html_url": "https://github.com/ethereum/solidity/issues/8379#issuecomment-625527977",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8379",
    "id": 625527977,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNTUyNzk3Nw==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-07T22:26:00Z",
    "updated_at": "2020-05-07T22:26:00Z",
    "author_association": "MEMBER",
    "body": "It was not reproducible for me, maybe because I placed them into a single file? (Didn't use two files.)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/625527977/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/625528585",
    "html_url": "https://github.com/ethereum/solidity/issues/8379#issuecomment-625528585",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8379",
    "id": 625528585,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNTUyODU4NQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-07T22:27:44Z",
    "updated_at": "2020-05-07T22:27:44Z",
    "author_association": "MEMBER",
    "body": "Yes, I think the bug is that you are using a contract that uses ABIEncoderV2 from a file that does not have it activated.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/625528585/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/625530739",
    "html_url": "https://github.com/ethereum/solidity/issues/8379#issuecomment-625530739",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8379",
    "id": 625530739,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNTUzMDczOQ==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-07T22:33:59Z",
    "updated_at": "2020-05-07T22:33:59Z",
    "author_association": "MEMBER",
    "body": "Oh you've commented that earlier too.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/625530739/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/700835551",
    "html_url": "https://github.com/ethereum/solidity/issues/8379#issuecomment-700835551",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8379",
    "id": 700835551,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMDgzNTU1MQ==",
    "user": {
      "login": "alcuadrado",
      "id": 176499,
      "node_id": "MDQ6VXNlcjE3NjQ5OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/176499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alcuadrado",
      "html_url": "https://github.com/alcuadrado",
      "followers_url": "https://api.github.com/users/alcuadrado/followers",
      "following_url": "https://api.github.com/users/alcuadrado/following{/other_user}",
      "gists_url": "https://api.github.com/users/alcuadrado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alcuadrado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alcuadrado/subscriptions",
      "organizations_url": "https://api.github.com/users/alcuadrado/orgs",
      "repos_url": "https://api.github.com/users/alcuadrado/repos",
      "events_url": "https://api.github.com/users/alcuadrado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alcuadrado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-29T16:38:36Z",
    "updated_at": "2020-09-29T16:38:36Z",
    "author_association": "MEMBER",
    "body": "> Yes, I think the bug is that you are using a contract that uses ABIEncoderV2 from a file that does not have it activated.\r\n\r\nI got to this issue helping one or our users debug an ICE, and that was the reason. I think this is pretty common, and really really hard to debug.\r\n\r\nA compilation error explaining that importing a file that uses ABIEncoderV2 from one that doesn't is forbidden would be ideal.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/700835551/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/700897685",
    "html_url": "https://github.com/ethereum/solidity/issues/8379#issuecomment-700897685",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8379",
    "id": 700897685,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMDg5NzY4NQ==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-29T18:25:49Z",
    "updated_at": "2020-09-29T18:25:49Z",
    "author_association": "MEMBER",
    "body": "@alcuadrado I completely agree. #9835 does exactly what you suggest. The fix itself is simple but there's a small complication that needs to be resolved first. There's one case that did compile fine before (even though it shouldn't have) and now results in a compilation error. It happens when you have a modifier defined in an ABIv1 context but only ever use it in context where ABIEncoderV2 is enabled. Seems far fetched but turns out that the Colony contract (which is one of the contracts we're using in CI to make sure we don't break external projects) does just that and now won't compile. I need to report it to them and also probably patch it in our clone of their repo (unless they fix it right away).\r\n\r\nI've been busy working on the binaries and did not have time to deal with this so my fix unfortunately did not make it into 0.7.2 (released yesterday) but you can expect it in 0.7.3.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/700897685/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/700899618",
    "html_url": "https://github.com/ethereum/solidity/issues/8379#issuecomment-700899618",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8379",
    "id": 700899618,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMDg5OTYxOA==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-29T18:29:17Z",
    "updated_at": "2020-09-29T18:33:36Z",
    "author_association": "MEMBER",
    "body": "For reference, here's an ABI encoder sandwich, based on Colony code, that reproduces the problem with the modifier:\r\n\r\n`IColonyNetwork.sol`\r\n```solidity\r\npragma experimental ABIEncoderV2;\r\n\r\ncontract ColonyNetworkDataTypes {\r\n    struct Skill {\r\n        bool globalSkill;\r\n    }\r\n}\r\n\r\ncontract IColonyNetwork is ColonyNetworkDataTypes {\r\n    function getSkill() public view returns (Skill memory skill) {}\r\n}\r\n```\r\n\r\n`ColonyStorage.sol`\r\n```solidity\r\nimport \"./IColonyNetwork.sol\";\r\n\r\ncontract ColonyStorage is ColonyNetworkDataTypes {\r\n    modifier validGlobalSkill() {\r\n        IColonyNetwork(0x00).getSkill();\r\n        _;\r\n    }\r\n}\r\n```\r\n\r\n`Colony.sol`\r\n```solidity\r\npragma experimental ABIEncoderV2;\r\n\r\nimport \"./ColonyStorage.sol\";\r\n\r\ncontract Colony is ColonyStorage {\r\n    function emitSkillReputationPenalty(uint256 _skillId, address _user, int256 _amount)\r\n        public\r\n        validGlobalSkill()\r\n    {}\r\n}\r\n```\r\n\r\nIf you compile it, it does not fail with Internal Compiler Error.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/700899618/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704342651",
    "html_url": "https://github.com/ethereum/solidity/issues/8379#issuecomment-704342651",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8379",
    "id": 704342651,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDM0MjY1MQ==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-06T15:16:24Z",
    "updated_at": "2020-10-06T15:16:24Z",
    "author_association": "MEMBER",
    "body": "Turns out this is not just a matter of ICE covering a compiler error. There are multiple cases where code that should compile doesn't and I keep finding new ones.\r\n\r\n### Using a modifier that calls a V2 function\r\n`a.sol`:\r\n```solidity\r\npragma experimental ABIEncoderV2;\r\n\r\nstruct Data {\r\n    bool flag;\r\n}\r\n\r\ncontract A {\r\n    function get() public view returns (Data memory) {}\r\n}\r\n```\r\n`b.sol`:\r\n```solidity\r\npragma experimental ABIEncoderV2;\r\n\r\nimport \"./a.sol\";\r\n\r\ncontract B {\r\n    modifier validate() {\r\n        A(0x00).get();\r\n        _;\r\n    }\r\n}\r\n```\r\n`c.sol`:\r\n```solidity\r\nimport \"./b.sol\";\r\n\r\ncontract C is B {\r\n    function foo()\r\n        public\r\n        validate()\r\n    {}\r\n}\r\n```\r\n\r\n```\r\nInternal compiler error during compilation:\r\n/solidity/libsolidity/codegen/CompilerUtils.cpp(1440): Throw in function unsigned int solidity::frontend::CompilerUtils::loadFromMemoryHelper(const solidity::frontend::Type&, bool, bool)\r\nDynamic exception type: boost::wrapexcept<solidity::langutil::InternalCompilerError>\r\nstd::exception::what:\r\n[solidity::util::tag_comment*] =\r\n```\r\n\r\n### Simply inheriting from a V2 contract\r\n`a.sol`:\r\n```solidity\r\npragma experimental ABIEncoderV2;\r\n\r\ncontract C {\r\n    struct Item {\r\n        uint x;\r\n    }\r\n\r\n    function get() external view returns(Item memory) {}\r\n}\r\n```\r\n`b.sol`:\r\n```solidity\r\nimport \"./a.sol\";\r\n\r\ncontract D is C {}\r\n```\r\n```\r\nUnimplemented feature:\r\n/solidity/libsolidity/codegen/CompilerUtils.cpp(420): Throw in function void solidity::frontend::CompilerUtils::encodeToMemory(const TypePointers&, const TypePointers&, bool, bool, bool)\r\nDynamic exception type: boost::wrapexcept<solidity::langutil::UnimplementedFeatureError>\r\nstd::exception::what: Encoding type \"struct C.Item memory\" not yet implemented.\r\n[solidity::util::tag_comment*] = Encoding type \"struct C.Item memory\" not yet implemented.\r\n```\r\n\r\n`a.sol` compiles just fine on its own.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704342651/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704503887",
    "html_url": "https://github.com/ethereum/solidity/issues/8379#issuecomment-704503887",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8379",
    "id": 704503887,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDUwMzg4Nw==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-06T19:27:19Z",
    "updated_at": "2020-10-06T19:27:19Z",
    "author_association": "MEMBER",
    "body": "In order to get my fix into the upcoming 0.7.3 I've split off the two cases above into separate issues: #9969, #9970. I wanted to fix them in #9835 but they have different underlying causes so there's no point in holding one back because of the other.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/704503887/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
