{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/13787",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/13787/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/13787/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/13787/events",
  "html_url": "https://github.com/ethereum/solidity/issues/13787",
  "id": 1481868137,
  "node_id": "I_kwDOAm_5kc5YU4Np",
  "number": 13787,
  "title": "Inlining heuristics for `FunctionSpecializer`",
  "user": {
    "login": "hrkrshnn",
    "id": 13174375,
    "node_id": "MDQ6VXNlcjEzMTc0Mzc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/13174375?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hrkrshnn",
    "html_url": "https://github.com/hrkrshnn",
    "followers_url": "https://api.github.com/users/hrkrshnn/followers",
    "following_url": "https://api.github.com/users/hrkrshnn/following{/other_user}",
    "gists_url": "https://api.github.com/users/hrkrshnn/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hrkrshnn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hrkrshnn/subscriptions",
    "organizations_url": "https://api.github.com/users/hrkrshnn/orgs",
    "repos_url": "https://api.github.com/users/hrkrshnn/repos",
    "events_url": "https://api.github.com/users/hrkrshnn/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hrkrshnn/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 838064207,
      "node_id": "MDU6TGFiZWw4MzgwNjQyMDc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/annoys%20users%20:cry:",
      "name": "annoys users :cry:",
      "color": "ea2cab",
      "default": false,
      "description": ""
    },
    {
      "id": 1282209978,
      "node_id": "MDU6TGFiZWwxMjgyMjA5OTc4",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/optimizer",
      "name": "optimizer",
      "color": "d4c5f9",
      "default": false,
      "description": ""
    },
    {
      "id": 4438153180,
      "node_id": "LA_kwDOAm_5kc8AAAABCIjX3A",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/high%20impact",
      "name": "high impact",
      "color": "001dff",
      "default": false,
      "description": "Changes are very prominent and affect users or the project in a major way."
    },
    {
      "id": 4438488423,
      "node_id": "LA_kwDOAm_5kc8AAAABCI31Zw",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/must%20have",
      "name": "must have",
      "color": "ffa12a",
      "default": false,
      "description": "Something we consider an essential part of Solidity 1.0."
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-12-07T12:59:35Z",
  "updated_at": "2023-02-13T22:06:02Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Abstract  and Motivation\r\n\r\nThis mainly came up in https://twitter.com/d1ll0nk/status/1600472867661295616. In short, for code where function pointers are used as arguments, `FunctionSpecializer` would end up specializing the function (because the function pointers would be constants). This may lead to code that's not ideal.\r\n\r\n\r\n## Specification\r\n\r\nUse a similar heuristic to the `FullInliner` in the `FunctionSpecializer`. The original context for `FunctionSpecializer` was to handle cases that the `FullInliner` couldn't do. So we have to rethink and benchmark this again, especially since the inline heuristics were changed after the new Yul code transform. \r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/13787/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/13787/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1340956606",
    "html_url": "https://github.com/ethereum/solidity/issues/13787#issuecomment-1340956606",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13787",
    "id": 1340956606,
    "node_id": "IC_kwDOAm_5kc5P7V--",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-07T13:18:13Z",
    "updated_at": "2022-12-07T13:18:13Z",
    "author_association": "MEMBER",
    "body": "For the record, I've seen the ``FunctionSpecializer`` be quite detrimental in cases without function pointers as well.\r\nIdeally, we'd have backtracking, i.e. we could tell if specializing the function allows simplifying it and only then specialize, but that's highly non-trivial, of course...",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1340956606/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1340956821",
    "html_url": "https://github.com/ethereum/solidity/issues/13787#issuecomment-1340956821",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13787",
    "id": 1340956821,
    "node_id": "IC_kwDOAm_5kc5P7WCV",
    "user": {
      "login": "d1ll0n",
      "id": 39827493,
      "node_id": "MDQ6VXNlcjM5ODI3NDkz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39827493?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/d1ll0n",
      "html_url": "https://github.com/d1ll0n",
      "followers_url": "https://api.github.com/users/d1ll0n/followers",
      "following_url": "https://api.github.com/users/d1ll0n/following{/other_user}",
      "gists_url": "https://api.github.com/users/d1ll0n/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/d1ll0n/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/d1ll0n/subscriptions",
      "organizations_url": "https://api.github.com/users/d1ll0n/orgs",
      "repos_url": "https://api.github.com/users/d1ll0n/repos",
      "events_url": "https://api.github.com/users/d1ll0n/events{/privacy}",
      "received_events_url": "https://api.github.com/users/d1ll0n/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-07T13:18:23Z",
    "updated_at": "2022-12-07T13:18:59Z",
    "author_association": "NONE",
    "body": "For reference, here's the full code of the specialized functions from the example in the tweet:\r\n\r\n![image](https://user-images.githubusercontent.com/39827493/206188812-4a493896-15aa-46ee-85aa-48b7dc911c03.png)\r\n\r\n![image](https://user-images.githubusercontent.com/39827493/206188268-e479ad14-a277-4bec-b9d9-43344c1c155e.png)\r\n\r\nThe specialized bits are just\r\n```solidity\r\n  if iszero(lt(var_componentIndex,  mload(var_offer_mpos))) {\r\n    mstore( 0,  1619580894)\r\n    revert(28, 4)\r\n}\r\n```\r\nand\r\n```solidity\r\nlet var_errorHandler_functionIdentifier :=  3\r\nif iszero(lt(var_componentIndex,  mload( var_offer_mpos)))\r\n{\r\n  var_errorHandler_functionIdentifier :=  var_errorHandler_functionIdentifier\r\n  mstore( 0,  3216242894)\r\n  revert(28, 4)\r\n}\r\n```\r\n\r\nso this added ~100 bytes to save a couple of stack manipulation ops.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1340956821/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1428755645",
    "html_url": "https://github.com/ethereum/solidity/issues/13787#issuecomment-1428755645",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13787",
    "id": 1428755645,
    "node_id": "IC_kwDOAm_5kc5VKRS9",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-13T22:06:02Z",
    "updated_at": "2023-02-13T22:06:02Z",
    "author_association": "MEMBER",
    "body": "We may want to document that in cases that are affected this, it's an option to use a custom optimizer sequence without the function specializer (see https://github.com/ethereum/solidity/issues/13858#issuecomment-1428754261) - since it may take a bit to come up with a proper solution here. A more aggressive measure would be to remove it from the default sequence until this is fixed.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1428755645/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
