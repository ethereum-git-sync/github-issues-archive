{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/8441",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/8441/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/8441/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/8441/events",
  "html_url": "https://github.com/ethereum/solidity/issues/8441",
  "id": 577135999,
  "node_id": "MDU6SXNzdWU1NzcxMzU5OTk=",
  "number": 8441,
  "title": "abi.encodePacked for tightly-packed arrays",
  "user": {
    "login": "mudgen",
    "id": 49092,
    "node_id": "MDQ6VXNlcjQ5MDky",
    "avatar_url": "https://avatars.githubusercontent.com/u/49092?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mudgen",
    "html_url": "https://github.com/mudgen",
    "followers_url": "https://api.github.com/users/mudgen/followers",
    "following_url": "https://api.github.com/users/mudgen/following{/other_user}",
    "gists_url": "https://api.github.com/users/mudgen/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mudgen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mudgen/subscriptions",
    "organizations_url": "https://api.github.com/users/mudgen/orgs",
    "repos_url": "https://api.github.com/users/mudgen/repos",
    "events_url": "https://api.github.com/users/mudgen/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mudgen/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 785717317,
      "node_id": "MDU6TGFiZWw3ODU3MTczMTc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/language%20design%20:rage4:",
      "name": "language design :rage4:",
      "color": "9d76d3",
      "default": false,
      "description": "Any changes to the language, e.g. new features"
    },
    {
      "id": 4438006499,
      "node_id": "LA_kwDOAm_5kc8AAAABCIaa4w",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/low%20effort",
      "name": "low effort",
      "color": "ffb1fa",
      "default": false,
      "description": "There is not much implementation work to be done. The task is very easy or tiny."
    },
    {
      "id": 4438157609,
      "node_id": "LA_kwDOAm_5kc8AAAABCIjpKQ",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/low%20impact",
      "name": "low impact",
      "color": "5d71ff",
      "default": false,
      "description": "Changes are not very noticeable or potential benefits are limited."
    },
    {
      "id": 4438492402,
      "node_id": "LA_kwDOAm_5kc8AAAABCI4E8g",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/nice%20to%20have",
      "name": "nice to have",
      "color": "ffdeb3",
      "default": false,
      "description": "We don’t see a good reason not to have it but won’t go out of our way to implement it."
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2020-03-06T19:38:30Z",
  "updated_at": "2023-02-28T11:24:20Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!--## Prerequisites\r\n\r\n- First, many thanks for taking part in the community. We really appreciate that.\r\n- We realize there is a lot of data requested here. We ask only that you do your best to provide as much information as possible so we can better help you.\r\n- Support questions are better asked in one of the following locations:\r\n\t- [Solidity chat](https://gitter.im/ethereum/solidity)\r\n\t- [Stack Overflow](https://ethereum.stackexchange.com/)\r\n- Ensure the issue isn't already reported (check `feature` and `language design` labels).\r\n\r\n*Delete the above section and the instructions in the sections below before submitting*\r\n\r\n-->\r\n\r\n## Abstract\r\nCurrently `abi.encodePacked` adds padding to arrays.  `abi.encode` can be used for that.\r\n\r\nPlease change `abi.encodePacked` so that it returns bytes of arrays without padding. I ran into a situation where `abi.encodePacked` would have been really useful if it did not pad arrays with zeros.\r\n\r\nIt would be great if the following was true:\r\n```Solidity\r\nuint8 value1 = 1;\r\nuint8 value2 = 2;\r\nuint8 value3 = 3;\r\nuint8[] memory threeValuesArray = new uint8[](3);\r\nthreeValuesArray[0] = value1;\r\nthreeValuesArray[1] = value2;\r\nthreeValuesArray[2] = value3;\r\n\r\nabi.encodePacked(value1, value2, value3) == abi.encodePacked(threeValuesArray)\r\n``` \r\n\r\n<!--\r\nPlease describe by example what problem you see in the current Solidity language\r\nand reason about it.\r\n-->\r\n\r\n\r\n\r\n<!--\r\nIn this section you describe how you propose to address the problem you described earlier,\r\nincluding by giving one or more exemplary source code snippets for demonstration.\r\n-->\r\n\r\n\r\n\r\n<!--\r\nThe technical specification should describe the syntax and semantics of any new feature. The\r\nspecification should be detailed enough to allow any developer to implement the functionality.\r\n-->\r\n\r\n\r\n\r\n<!--\r\nAll language changes that introduce backwards incompatibilities must include a section describing\r\nthese incompatibilities and their severity.\r\n\r\nPlease describe how you propose to deal with these incompatibilities.\r\n-->",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/8441/reactions",
    "total_count": 5,
    "+1": 5,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/8441/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/602551077",
    "html_url": "https://github.com/ethereum/solidity/issues/8441#issuecomment-602551077",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8441",
    "id": 602551077,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMjU1MTA3Nw==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-23T12:04:48Z",
    "updated_at": "2020-03-23T12:04:48Z",
    "author_association": "MEMBER",
    "body": "The functio `abi.encodePacked` was implemented to mimik the behaviour of several implicit operations in old Solidity versions. We actually planned to not touch it anymore. Since I somehow see the need, we could introduce `abi.encodeTightlyPacked`, though.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/602551077/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/602667204",
    "html_url": "https://github.com/ethereum/solidity/issues/8441#issuecomment-602667204",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8441",
    "id": 602667204,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMjY2NzIwNA==",
    "user": {
      "login": "mudgen",
      "id": 49092,
      "node_id": "MDQ6VXNlcjQ5MDky",
      "avatar_url": "https://avatars.githubusercontent.com/u/49092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mudgen",
      "html_url": "https://github.com/mudgen",
      "followers_url": "https://api.github.com/users/mudgen/followers",
      "following_url": "https://api.github.com/users/mudgen/following{/other_user}",
      "gists_url": "https://api.github.com/users/mudgen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mudgen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mudgen/subscriptions",
      "organizations_url": "https://api.github.com/users/mudgen/orgs",
      "repos_url": "https://api.github.com/users/mudgen/repos",
      "events_url": "https://api.github.com/users/mudgen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mudgen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-23T15:17:53Z",
    "updated_at": "2020-03-23T15:17:53Z",
    "author_association": "NONE",
    "body": "@chriseth That would be awesome, thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/602667204/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1040478746",
    "html_url": "https://github.com/ethereum/solidity/issues/8441#issuecomment-1040478746",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8441",
    "id": 1040478746,
    "node_id": "IC_kwDOAm_5kc4-BHIa",
    "user": {
      "login": "tarik0",
      "id": 22205836,
      "node_id": "MDQ6VXNlcjIyMjA1ODM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/22205836?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tarik0",
      "html_url": "https://github.com/tarik0",
      "followers_url": "https://api.github.com/users/tarik0/followers",
      "following_url": "https://api.github.com/users/tarik0/following{/other_user}",
      "gists_url": "https://api.github.com/users/tarik0/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tarik0/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tarik0/subscriptions",
      "organizations_url": "https://api.github.com/users/tarik0/orgs",
      "repos_url": "https://api.github.com/users/tarik0/repos",
      "events_url": "https://api.github.com/users/tarik0/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tarik0/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-15T16:20:51Z",
    "updated_at": "2022-02-15T16:21:28Z",
    "author_association": "NONE",
    "body": "I've found a workaround for this but It requires the [BytesLib.sol](https://github.com/GNSPS/solidity-bytes-utils/blob/master/contracts/BytesLib.sol). Since `encodePacked` does not use any padding you can just append to each other. (There might be a better approach for this and I don't know If it's gas efficient or not.)\r\n\r\n```solidity\r\npragma solidity ^0.8.0;\r\n\r\nimport \"https://github.com/GNSPS/solidity-bytes-utils/blob/master/contracts/BytesLib.sol\";\r\n\r\ncontract Test {\r\n    using BytesLib for bytes;\r\n\r\n    /**\r\n     * Workaround for the `https://github.com/ethereum/solidity/issues/8441`.\r\n     * @notice Requires `BytesLib.sol` at `https://github.com/GNSPS/solidity-bytes-utils/blob/master/contracts/BytesLib.sol`\r\n     */ \r\n    function encodeTightlyPacked(address[] memory path) internal pure returns(bytes memory encoded) {\r\n        for (uint i = 0; i < path.length; i++) {\r\n            encoded = encoded.concat(\r\n                abi.encodePacked(path[i])\r\n            );\r\n        }\r\n    }\r\n\r\n    function test() public view returns (bytes memory t1, bytes memory t2) {\r\n        address[] memory path = new address[](3);\r\n        path[0] = 0x7a250d5630B4cF539739dF2C5dAcb4c659F2488D;\r\n        path[1] = 0xE592427A0AEce92De3Edee1F18E0157C05861564;\r\n        path[2] = 0xaD6D458402F60fD3Bd25163575031ACDce07538D;\r\n\r\n        t1 = abi.encodePacked(path[0], path[1], path[2]);\r\n        t2 = encodeTightlyPacked(path);\r\n    }\r\n}\r\n```\r\n\r\nThe result;\r\n\r\n```\r\nt1 = 0x7a250d5630b4cf539739df2c5dacb4c659f2488de592427a0aece92de3edee1f18e0157c05861564ad6d458402f60fd3bd25163575031acdce07538d\r\nt2 = 0x7a250d5630b4cf539739df2c5dacb4c659f2488de592427a0aece92de3edee1f18e0157c05861564ad6d458402f60fd3bd25163575031acdce07538d\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1040478746/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1042788212",
    "html_url": "https://github.com/ethereum/solidity/issues/8441#issuecomment-1042788212",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8441",
    "id": 1042788212,
    "node_id": "IC_kwDOAm_5kc4-J690",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-17T10:17:33Z",
    "updated_at": "2022-02-17T10:17:33Z",
    "author_association": "MEMBER",
    "body": "@tarik0 the language supports `bytes.concat()` since a while, which I believe would allow you to write:\r\n```solidity\r\n        uint len = arr.length;\r\n        for (uint i = 0; i < len; i++) {\r\n            encoded = bytes.concat(\r\n                encoded,\r\n                abi.encodePacked(path[i])\r\n            );\r\n        }\r\n```\r\n\r\nIt is not super optimal as it will waste memory quite a bit.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1042788212/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1448012287",
    "html_url": "https://github.com/ethereum/solidity/issues/8441#issuecomment-1448012287",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8441",
    "id": 1448012287,
    "node_id": "IC_kwDOAm_5kc5WTun_",
    "user": {
      "login": "dk1a",
      "id": 62725447,
      "node_id": "MDQ6VXNlcjYyNzI1NDQ3",
      "avatar_url": "https://avatars.githubusercontent.com/u/62725447?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dk1a",
      "html_url": "https://github.com/dk1a",
      "followers_url": "https://api.github.com/users/dk1a/followers",
      "following_url": "https://api.github.com/users/dk1a/following{/other_user}",
      "gists_url": "https://api.github.com/users/dk1a/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dk1a/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dk1a/subscriptions",
      "organizations_url": "https://api.github.com/users/dk1a/orgs",
      "repos_url": "https://api.github.com/users/dk1a/repos",
      "events_url": "https://api.github.com/users/dk1a/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dk1a/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-28T11:24:20Z",
    "updated_at": "2023-02-28T11:24:20Z",
    "author_association": "NONE",
    "body": "My current workaround (very verbose, but generic and decently gas-efficient):\r\nhttps://github.com/latticexyz/mud/blob/cb731e0937e614bb316e6bc824813799559956c8/packages/store/src/tightcoder/EncodeArray.sol\r\n\r\nOn a similar note, an `abi.decodeTightlyPacked` coupled with memory slices would be useful as well to replace this:\r\nhttps://github.com/latticexyz/mud/blob/cb731e0937e614bb316e6bc824813799559956c8/packages/store/src/tightcoder/DecodeSlice.sol",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1448012287/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
