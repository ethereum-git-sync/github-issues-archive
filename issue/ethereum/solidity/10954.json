{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/10954",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/10954/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/10954/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/10954/events",
  "html_url": "https://github.com/ethereum/solidity/issues/10954",
  "id": 807213524,
  "node_id": "MDU6SXNzdWU4MDcyMTM1MjQ=",
  "number": 10954,
  "title": "[yul] Long run time of reasoning based simplifier against tests with nested expressions",
  "user": {
    "login": "bshastry",
    "id": 2388185,
    "node_id": "MDQ6VXNlcjIzODgxODU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bshastry",
    "html_url": "https://github.com/bshastry",
    "followers_url": "https://api.github.com/users/bshastry/followers",
    "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
    "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
    "organizations_url": "https://api.github.com/users/bshastry/orgs",
    "repos_url": "https://api.github.com/users/bshastry/repos",
    "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bshastry/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 682993385,
      "node_id": "MDU6TGFiZWw2ODI5OTMzODU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/performance%20:racehorse:",
      "name": "performance :racehorse:",
      "color": "c5def5",
      "default": false,
      "description": ""
    },
    {
      "id": 1282209978,
      "node_id": "MDU6TGFiZWwxMjgyMjA5OTc4",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/optimizer",
      "name": "optimizer",
      "color": "d4c5f9",
      "default": false,
      "description": ""
    },
    {
      "id": 1333817191,
      "node_id": "MDU6TGFiZWwxMzMzODE3MTkx",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/fuzz-blocker",
      "name": "fuzz-blocker",
      "color": "e56129",
      "default": false,
      "description": "High priority bug. Blocks further fuzzing until fixed."
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-02-12T12:55:50Z",
  "updated_at": "2021-02-17T22:27:51Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "<!--## Prerequisites\r\n\r\n- First, many thanks for taking part in the community. We really appreciate that.\r\n- We realize there is a lot of information requested here. We ask only that you do your best to provide as much information as possible so we can better help you.\r\n- Support questions are better asked in one of the following locations:\r\n\t- [Solidity chat](https://gitter.im/ethereum/solidity)\r\n\t- [Stack Overflow](https://ethereum.stackexchange.com/)\r\n- Ensure the issue isn't already reported.\r\n- The issue should be reproducible with the latest solidity version; however, this isn't a hard requirement and being reproducible with an older version is sufficient.\r\n-->\r\n\r\n## Description\r\n\r\nThe following test case hogs memory and does not complete for over several minutes. Tagged as fuzz blocker because this test input exhausts memory allocated to fuzzing process, crashing it in the process and/or takes too long to complete.\r\n\r\n```\r\n{\r\n        let x_0 := sdiv(\r\n                0x800000000000000000000000000000000000000,\r\n                sdiv(\r\n                        sdiv(\r\n                                0x8000000000000000000000000000000000000000,\r\n                                0x80000000000000000000000000000000000000000\r\n                        ),\r\n                        sdiv(\r\n                                0x800000000000000000000000000000000000000000,\r\n                                sdiv(\r\n                                        sdiv(\r\n                                                0x8000000000000000000000000000000000000000000,\r\n                                                0x80000000000000000000000000000000000000000000\r\n                                        ),\r\n                                        0x800000000000000000000000000000000000000000000\r\n                                 )\r\n                          )\r\n                )\r\n        )\r\n}\r\n// ====\r\n// EVMVersion: >=constantinople\r\n// ----\r\n// step: reasoningBasedSimplifier\r\n```\r\n\r\n## Environment\r\n\r\n- Compiler version: latest develop\r\n- Operating system: Ubuntu x86_64 focal, \r\n\r\n## Steps to Reproduce\r\n\r\n```\r\n// Copy test case to a file called test/libyul/yulOptimizerTests/reasoningBasedSimplifier/test.yul\r\n$ isoltest -t yulOptimizerTests/reasoningBasedSimplifier/test\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/10954/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/10954/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/778187640",
    "html_url": "https://github.com/ethereum/solidity/issues/10954#issuecomment-778187640",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10954",
    "id": 778187640,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3ODE4NzY0MA==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-12T13:13:32Z",
    "updated_at": "2021-02-12T13:13:32Z",
    "author_association": "MEMBER",
    "body": "I have also noticed that `ReasoningBasedSimplifier` is orders of magnitude slower than any other step while running yul-phaser. Especially on longer input like `test/libyul/yulOptimizerTests/fullSuite/aztec.yul` it takes minutes per round compared to less than a second when this step is disabled (see https://github.com/ethereum/solidity/pull/10080#discussion_r571105586).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/778187640/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/778286814",
    "html_url": "https://github.com/ethereum/solidity/issues/10954#issuecomment-778286814",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10954",
    "id": 778286814,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3ODI4NjgxNA==",
    "user": {
      "login": "hrkrshnn",
      "id": 13174375,
      "node_id": "MDQ6VXNlcjEzMTc0Mzc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13174375?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hrkrshnn",
      "html_url": "https://github.com/hrkrshnn",
      "followers_url": "https://api.github.com/users/hrkrshnn/followers",
      "following_url": "https://api.github.com/users/hrkrshnn/following{/other_user}",
      "gists_url": "https://api.github.com/users/hrkrshnn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hrkrshnn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hrkrshnn/subscriptions",
      "organizations_url": "https://api.github.com/users/hrkrshnn/orgs",
      "repos_url": "https://api.github.com/users/hrkrshnn/repos",
      "events_url": "https://api.github.com/users/hrkrshnn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hrkrshnn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-12T16:10:06Z",
    "updated_at": "2021-02-12T16:10:06Z",
    "author_association": "MEMBER",
    "body": "This is not that surprising.\r\n\r\n`sdiv` is encoded as\r\n\r\n```\r\nsmtutil::Expression::ite(\r\n\t\t\targuments.at(1) == constantValue(0),\r\n\t\t\tconstantValue(0),\r\n\t\t\t// No `wrap()` needed here, because -2**255 / -1 results\r\n\t\t\t// in 2**255 which is \"converted\" to its two's complement\r\n\t\t\t// representation 2**255 in `signedToUnsigned`\r\n\t\t\tsignedToUnsigned(smtutil::signedDivisionEVM(\r\n\t\t\t\tunsignedToSigned(arguments.at(0)),\r\n\t\t\t\tunsignedToSigned(arguments.at(1))\r\n\t\t\t))\r\n```\r\n\r\n`unsignedToSigned` and `signedToUnsigned` is encoded as another `ite` (if then else) statement. `signedDivisionEVM` is encoded by `ite(..., ite(...), ite(...))`. \r\n\r\n\r\n\r\nEach `ite` would introduce two branches. In the end, there is just too much branching even just for one `smod`.\r\n\r\nMaybe the model checker settings for z3 should also apply for the optimizer and then we could set a timeout for z3.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/778286814/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/779713961",
    "html_url": "https://github.com/ethereum/solidity/issues/10954#issuecomment-779713961",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10954",
    "id": 779713961,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3OTcxMzk2MQ==",
    "user": {
      "login": "hrkrshnn",
      "id": 13174375,
      "node_id": "MDQ6VXNlcjEzMTc0Mzc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13174375?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hrkrshnn",
      "html_url": "https://github.com/hrkrshnn",
      "followers_url": "https://api.github.com/users/hrkrshnn/followers",
      "following_url": "https://api.github.com/users/hrkrshnn/following{/other_user}",
      "gists_url": "https://api.github.com/users/hrkrshnn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hrkrshnn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hrkrshnn/subscriptions",
      "organizations_url": "https://api.github.com/users/hrkrshnn/orgs",
      "repos_url": "https://api.github.com/users/hrkrshnn/repos",
      "events_url": "https://api.github.com/users/hrkrshnn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hrkrshnn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-16T09:43:58Z",
    "updated_at": "2021-02-16T09:43:58Z",
    "author_association": "MEMBER",
    "body": "On second thought, the expression can be evaluated right away. So not sure if it really needs so much branching. It turns out that we don't even call the `Z3Interface::check(..)` function which would be the most expensive, solving part. Not sure what's really happening here.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/779713961/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/779815640",
    "html_url": "https://github.com/ethereum/solidity/issues/10954#issuecomment-779815640",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10954",
    "id": 779815640,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3OTgxNTY0MA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-16T12:49:11Z",
    "updated_at": "2021-02-16T12:49:11Z",
    "author_association": "MEMBER",
    "body": "The component is deactivated for a reason, but we should indeed investigate what takes that much time.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/779815640/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/780896276",
    "html_url": "https://github.com/ethereum/solidity/issues/10954#issuecomment-780896276",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10954",
    "id": 780896276,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MDg5NjI3Ng==",
    "user": {
      "login": "bshastry",
      "id": 2388185,
      "node_id": "MDQ6VXNlcjIzODgxODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bshastry",
      "html_url": "https://github.com/bshastry",
      "followers_url": "https://api.github.com/users/bshastry/followers",
      "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
      "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
      "organizations_url": "https://api.github.com/users/bshastry/orgs",
      "repos_url": "https://api.github.com/users/bshastry/repos",
      "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bshastry/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-17T22:27:50Z",
    "updated_at": "2021-02-17T22:27:50Z",
    "author_association": "MEMBER",
    "body": "Another test case that drains memory\r\n\r\n```\r\nobject \"object0\" {\r\ncode {\r\n{\r\nlet x_0 := 0x100001\r\nlet x_2 := shl(x_0,sdiv(0x1001,shr(sdiv(x_0,smod(sdiv(x_0,datasize(\"object0\")),0x101)),x_0)))\r\nlet x_5 := datasize(\"object0\")\r\n}\r\n}\r\ndata \"datablock\" hex\"1f\"\r\n}\r\n// ----\r\n// step: reasoningBasedSimplifier\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/780896276/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
