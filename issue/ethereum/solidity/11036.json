{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/11036",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/11036/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/11036/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/11036/events",
  "html_url": "https://github.com/ethereum/solidity/issues/11036",
  "id": 821073271,
  "node_id": "MDU6SXNzdWU4MjEwNzMyNzE=",
  "number": 11036,
  "title": "Buggy import path resolution in corner cases with remappings and base path",
  "user": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-03-03T12:39:39Z",
  "updated_at": "2021-06-02T22:28:31Z",
  "closed_at": "2021-06-02T22:28:30Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Inspired by https://github.com/ethereum/solidity/pull/9353.\r\n\r\nThe way the compiler resolves imports into actual filesystem paths is intuitive in simple cases but gets convoluted quickly when you take into account all the factors that can affect it: remappings, base path, various flavors of relative paths, special file names, etc. I checked how it works in corner cases and in a lot of them the beahavior is either buggy or at least does not work the way I would expect it to.\r\n\r\n## Issues\r\nThis section lists problems I have identified. See the reference at the end of the post for detailed examples.\r\n\r\n1. Base path is sometimes prepended to absolute paths.\r\n    - Base path is prepended to source directory path in imports starting with `.` or `..`.\r\n    - Base path is prepended to remapped absolute imports.\r\n2. Imports starting with `.` or `..` are not always relative to the source directory\r\n    - Absolute imports can be remapped into imports starting with `.` or `..` but they then become relative to the current working directory.\r\n    - Base path replaces source directory in absolute imports remapped to relative imports starting with `.` or `..`.\r\n        - It should behave the same way as relative imports starting with `..` or `..`.\r\n    - Paths that become relative after stripping of `file://` are always relative to the current working directory.\r\n        - This does not happen when base paths is used.\r\n3. Using a relative path to the source file on the command line sometimes makes relative imports resolve to different paths than when using an absolute path.\r\n    - Remapping of `.` and `..` works differently when the path to the source file given to the compiler is relative.\r\n    - Remappings ignore any number of leading `.` and `..` segments when the path to the source file given to the compiler is relative.\r\n4. Relative paths with `..` segments that go beyond filesystem root are silently replaced with valid ones.\r\n    - Remappings ignore any number of leading `.` and `..` segments in imports going beyond the root directory.\r\n    - Remappings ignore any number of leading `.` and `..` segments when the path to the source file given to the compiler is relative.\r\n    - Relative imports going beyond root directory ignore `..` and are relative to the current working directory (or to the base directory when base path is used).\r\n5. It's possible to remap some of the paths added implicitly to relative imports.\r\n    - Parts of the path that `.` and `..` get resolved into can get remapped.\r\n    - Source directory path can be remapped.\r\n6. Not all prefixes can be remapped.\r\n    - Leading `.` and `..` in imports cannot be remapped.\r\n    - `file://` prefix as a whole cannot be remapped but its fragments can.\r\n7. Special behavior of `<stdin>`.\r\n    - A file called `<stdin>` from current working directory can only be imported if use of the standard input is not requested.\r\n        - If a file called `<stdin>` exists and standard input was requested, importing it should be an error.\r\n    - Behavior of `<stdin>` in general might be unintended though there's probably no harm in allowing it to be remapped.\r\n8. Trailing slashes in imports are replaced with `/.` (unless they start with `.` or `..`).\r\n    - They should either be stripped or replaced with a single slash.\r\n9. Multiple remappings of the same prefix are ignored and the last one takes effect.\r\n\r\n## Current path resolution behavior\r\nThis section is meant mostly as a reference. There's no need to read it all to understand the issue. Skimming the headers should give you a good picture of what is happening.\r\n\r\nUse it to see examples of the problems I listed above or just the current behavior in specific cases.\r\n\r\n### Common setup for all examples below\r\n- File containing the imports: `/project/contract.sol`.\r\n- Working directory: `/home/user/work/`.\r\n\r\n### Simple imports\r\n#### Absolute\r\n```solidity\r\nimport \"/tmp/code/token.sol\";         // -> /tmp/code/token.sol\r\nimport \"/tmp/code/../code/token.sol\"; // -> /tmp/code/token.sol\r\n```\r\n\r\n#### Relative imports are relative to current working directory\r\n```solidity\r\nimport \"token/token.sol\";     // -> /home/user/work/token/token.sol\r\nimport \".../token/token.sol\"; // -> /home/user/work/.../token/token.sol\r\n```\r\n\r\n#### Relative imports starting with `.` or `..` are relative to the source directory\r\n```solidity\r\nimport \"./token/token.sol\";          // -> /project/token/token.sol\r\nimport \"../project/token/token.sol\"; // -> /project/token/token.sol\r\n```\r\n\r\n#### Relative imports going beyond root directory ignore `..` and are relative to the current working directory\r\n```solidity\r\nimport \"token/token.sol\";                  // -> /home/user/work/token/token.sol\r\nimport \"../token/token.sol\";               // -> /home/user/token/token.sol\r\nimport \"../../token/token.sol\";            // -> /home/token/token.sol\r\nimport \"../../../token/token.sol\";         // -> /token/token.sol\r\nimport \"../../../../token/token.sol\";      // -> /home/user/work/token/token.sol\r\nimport \"../../../../../token/token.sol\";   // -> /home/user/work/token/token.sol\r\nimport \"../../.././../../token/token.sol\"; // -> /home/user/work/token/token.sol\r\n```\r\n\r\n### Path Remapping\r\n\r\n#### Absolute imports can be remapped\r\n```solidity\r\n// Remappings: /tmp/code=/usr/lib\r\nimport \"/tmp/code/token.sol\"; // -> /usr/lib/token.sol\r\n```\r\n\r\n#### Relative imports can be remapped\r\n```solidity\r\n// Remappings: token=contract\r\nimport \"token/token.sol\"; // -> /home/user/work/contract/token.sol\r\n```\r\n\r\n#### Relative imports can be remapped into absolute imports\r\n```solidity\r\n// Remappings: token=/usr/lib\r\nimport \"token/token.sol\"; // -> /usr/lib/token.sol\r\n```\r\n\r\n#### Absolute imports can be remapped into imports relative to the current working directory\r\n```solidity\r\n// Remappings: /usr/lib=contract\r\nimport \"/usr/lib/token.sol\"; // -> /home/user/work/contract/token.sol\r\n```\r\n\r\n#### Absolute imports can be remapped into imports starting with `.` or `..` but they are also relative to the current working directory\r\nNormally imports starting with `.` or `..` are relative to the source directory.\r\n```solidity\r\n// Remappings: /usr/lib=./contract\r\nimport \"/usr/lib/token.sol\"; // -> /home/user/work/contract/token.sol\r\n```\r\n\r\n```solidity\r\n// Remappings: /usr/lib=../contract\r\nimport \"/usr/lib/token.sol\"; // -> /home/user/contract/token.sol\r\n```\r\n\r\n#### Only prefix can be remapped\r\n```solidity\r\n// Remappings: /usr=/tmp /lib=/bin contracts=token token.sol=contract.sol\r\nimport \"/usr/usr/lib/token.sol\";                // -> /tmp/usr/lib/token.sol\r\nimport \"contracts/contracts/usr/lib/token.sol\"; // -> /home/user/work/token/contracts/usr/lib/token.sol\r\nimport \"token.sol\";                             // -> /home/user/work/contract.sol\r\n```\r\n\r\n#### The remapping with the longest matching prefix is used\r\n```solidity\r\n// Remappings: /usr=/project/dex /usr/lib=/project/token contracts=tokens contracts/token.sol=dex.sol\r\nimport \"/usr/lib/contracts/token.sol\"; // -> /project/token/contracts/token.sol\r\nimport \"contracts/token.sol\";          // -> /home/user/work/dex.sol\r\n```\r\n\r\n#### Remapping is not recursive\r\n```solidity\r\n// Remappings: /a=/b /b=/c /c=/a\r\nimport \"/a/token.sol\"; // -> /b/token.sol\r\n```\r\n\r\n#### The last remapping takes precedence\r\n```solidity\r\n// Remappings: /a=/b /a=/c /a=/d\r\nimport \"/a/token.sol\"; // -> /d/token.sol\r\n```\r\n\r\n#### Remappings do not have to match whole path segments\r\n```solidity\r\n// Remappings: /c=/k c=k\r\nimport \"/contracts/contract.sol\"; // -> /kontracts/contract.sol\r\nimport \"contracts/contract.sol\";  // -> /home/user/work/kontracts/contract.sol\r\n```\r\n\r\n#### Leading `.` and `..` in imports cannot be remapped\r\n```solidity\r\n// Remappings: .=/tmp\r\nimport \"./token/token.sol\";   // -> /project/token/token.sol\r\nimport \"../token/token.sol\";  // -> /project/token.sol\r\nimport \".../token/token.sol\"; // -> /tmp../token/token.sol\r\n```\r\n\r\n```solidity\r\n// Remappings: ./token=contract ../token=contract .../token=contract\r\nimport \"./token/token.sol\";   // -> /project/token/token.sol\r\nimport \"../token/token.sol\";  // -> /project/token.sol\r\nimport \".../token/token.sol\"; // -> /home/user/work/contract/token.sol\r\n```\r\n\r\n#### Parts of the path that `.` and `..` get resolved into can get remapped\r\n```solidity\r\n// Remappings: /project=/tmp /token=/tmp /project/token.sol=/tmp/dex.sol\r\nimport \"./token/token.sol\";   // -> /tmp/token/token.sol\r\nimport \"../token/token.sol\";  // -> /tmp/token.sol\r\nimport \"./token.sol\";         // -> /tmp/dex.sol\r\n```\r\n\r\n#### Remapping of `.` and `..` works differently when the path to the source file given to the compiler is relative\r\nThis is one of the cases where the path to the **file containing imports** (specified on the compiler's command line) affects how the imports are resolved.\r\n\r\nThe effect is different depending on the locations of the source directory and the current working directory relative to each other.\r\n\r\n##### Example: Current working directory is a prefix of the source directory\r\n- Source file passed to the compiler: `../contract.sol`.\r\n- Working directory: `/project/subdir/`.\r\n\r\n```solidity\r\n// Remappings: ./token=contract ../token=contract\r\nimport \"./token/token.sol\";   // -> /home/user/work/contract/token.sol\r\nimport \"../token/token.sol\";  // -> /home/user/work/token.sol\r\n```\r\n\r\n#### Paths are not canonicalized before remapping\r\n```solidity\r\n// Remappings: /tmp/code=/usr/lib token=contract\r\nimport \"/tmp/../tmp/code/token.sol\"; // -> /tmp/code/token.sol\r\nimport \"code/../token/token.sol\";    // -> /home/user/work/token/token.sol\r\n```\r\n\r\n#### Remappings ignore any number of leading `.` and `..` segments in imports going beyond the root directory\r\n```solidity\r\n// Remappings: token=contract\r\nimport \"token/token.sol\";                  // -> /home/user/work/contract/token.sol\r\nimport \"../token/token.sol\";               // -> /home/user/token/token.sol\r\nimport \"../../token/token.sol\";            // -> /home/token/token.sol\r\nimport \"../../../token/token.sol\";         // -> /token/token.sol\r\nimport \"../../../../token/token.sol\";      // -> /home/user/work/contract/token.sol\r\nimport \"../../../../../token/token.sol\";   // -> /home/user/work/contract/token.sol\r\nimport \"../../.././../../token/token.sol\"; // -> /home/user/work/contract/token.sol\r\n```\r\n\r\n#### Remappings ignore any number of leading `.` and `..` segments when the path to the source file given to the compiler is relative\r\nThe effect is different depending on the locations of the source directory and the current working directory relative to each other.\r\n\r\n##### Example: Current working directory is a prefix of the source directory\r\n- Source file passed to the compiler: `../contract.sol`.\r\n- Working directory: `/project/subdir/`.\r\n\r\n```solidity\r\n// Remappings: token=contract\r\nimport \"token/token.sol\";                  // -> /home/user/work/contract/token.sol\r\nimport \"../token/token.sol\";               // -> /home/user/work/contract/token.sol\r\nimport \"../../token/token.sol\";            // -> /home/user/work/contract/token.sol\r\nimport \"../../../token/token.sol\";         // -> /home/user/work/contract/token.sol\r\nimport \"../../../../token/token.sol\";      // -> /home/user/work/contract/token.sol\r\nimport \"../../../../../token/token.sol\";   // -> /home/user/work/contract/token.sol\r\nimport \"../../.././../../token/token.sol\"; // -> /home/user/work/contract/token.sol\r\n```\r\n\r\n#### Current working directory path cannot be remapped\r\n```solidity\r\n// Remappings: /home/user/work=/workdir\r\nimport \"token/token.sol\"; // -> /home/user/work/token/token.sol\r\n```\r\n\r\n#### Source directory path can be remapped\r\n```solidity\r\n// Remappings: /project=/tmp\r\nimport \"./token/token.sol\";          // -> /tmp/token/token.sol\r\nimport \"../project/token/token.sol\"; // -> /tmp/token/token.sol\r\n```\r\n\r\n### Base Path\r\n\r\n#### Base path does not affect absolute imports\r\n```solidity\r\n// Base path: /base\r\nimport \"/tmp/code/token.sol\";         // -> /tmp/code/token.sol\r\nimport \"/tmp/code/../code/token.sol\"; // -> /tmp/code/token.sol\r\n```\r\n\r\n#### Base path replaces current working directory in relative imports\r\n```solidity\r\n// Base path: /base\r\nimport \"token/token.sol\"; // -> /base/token/token.sol\r\n```\r\n\r\n#### Base path is prepended to source directory path in imports starting with `.` or `..`\r\n```solidity\r\n// Base path: /base\r\nimport \"./token/token.sol\";  // -> /base/project/token/token.sol\r\nimport \"../token/token.sol\"; // -> /base/token/token.sol\r\n```\r\n\r\n#### Relative imports going beyond root directory ignore `..` and are relative to the base directory\r\n```solidity\r\n// Base path: /base\r\nimport \"token/token.sol\";                  // -> /base/token/token.sol\r\nimport \"../token/token.sol\";               // -> /base/token/token.sol\r\nimport \"../../token/token.sol\";            // -> /base/token/token.sol\r\nimport \"../../../token/token.sol\";         // -> /base/token/token.sol\r\nimport \"../../../../token/token.sol\";      // -> /base/token/token.sol\r\nimport \"../../../../../token/token.sol\";   // -> /base/token/token.sol\r\nimport \"../../.././../../token/token.sol\"; // -> /base/token/token.sol\r\n```\r\n\r\n#### Base path is prepended to remapped absolute imports\r\n```solidity\r\n// Base path: /base\r\n// Remappings: /tmp/code=/usr/lib\r\nimport \"/tmp/code/token.sol\"; // -> /base/usr/lib/token.sol\r\n```\r\n\r\n#### Base path replaces current working directory in remapped relative imports\r\n```solidity\r\n// Base path: /base\r\n// Remappings: token=contract\r\nimport \"token/token.sol\"; // -> /base/contract/token.sol\r\n```\r\n\r\n#### Base path is prepended to relative imports remapped into absolute imports\r\n```solidity\r\n// Base path: /base\r\n// Remappings: token=/usr/lib\r\nimport \"token/token.sol\"; // -> /base/usr/lib/token.sol\r\n```\r\n\r\n#### Base path replaces current working directory in absolute imports remapped to relative imports\r\n```solidity\r\n// Base path: /base\r\n// Remappings: /usr/lib=contract\r\nimport \"/usr/lib/token.sol\"; // -> /base/contract/token.sol\r\n```\r\n\r\n#### Base path replaces source directory in absolute imports remapped to relative imports starting with `.` or `..`\r\nWithout remapping such imports are relative to the source directory, not the current working directory.\r\n```solidity\r\n// Base path: /base\r\n// Remappings: /usr/lib=./contract\r\nimport \"/usr/lib/token.sol\"; // -> /base/contract/token.sol\r\n```\r\n\r\n```solidity\r\n// Base path: /base\r\n// Remappings: /usr/lib=../contract\r\nimport \"/usr/lib/token.sol\"; // -> /contract/token.sol\r\n```\r\n\r\n#### Parts of the path that `.` and `..` get resolved into can get remapped when base path is used and such remappings don't override the base path\r\n```solidity\r\n// Base path: /base\r\n// Remappings: /project=/tmp /token=/tmp /project/token.sol=/tmp/dex.sol\r\nimport \"./token/token.sol\";   // -> /base/tmp/token/token.sol\r\nimport \"../token/token.sol\";  // -> /base/tmp/token.sol\r\nimport \"./token.sol\";         // -> /base/tmp/dex.sol\r\n```\r\n\r\n#### Base path cannot be remapped\r\n```solidity\r\n// Base path: /base\r\n// Remappings: /base=/tmp\r\nimport \"token/token.sol\"; // -> /base/token/token.sol\r\n```\r\n\r\n#### Source directory path can be remapped even when base path is used\r\n```solidity\r\n// Base path: /base\r\n// Remappings: /project=/tmp /base=/usr/lib\r\nimport \"./token/token.sol\";          // -> /base/tmp/token/token.sol\r\nimport \"../project/token/token.sol\"; // -> /base/tmp/token/token.sol\r\n```\r\n\r\n#### Relative base path is relative to the current working directory\r\n```solidity\r\n// Base path: base\r\nimport \"token/token.sol\";    // -> /home/user/work/base/token/token.sol\r\nimport \"./token/token.sol\";  // -> /home/user/work/base/project/token/token.sol\r\nimport \"../token/token.sol\"; // -> /home/user/work/base/token/token.sol\r\n```\r\n\r\n```solidity\r\n// Base path: .\r\nimport \"token/token.sol\";    // -> /home/user/work/token/token.sol\r\nimport \"./token/token.sol\";  // -> /home/user/work/project/token/token.sol\r\nimport \"../token/token.sol\"; // -> /home/user/work/token/token.sol\r\n```\r\n\r\n```solidity\r\n// Base path: ..\r\nimport \"token/token.sol\";    // -> /home/user/token/token.sol\r\nimport \"./token/token.sol\";  // -> /home/user/project/token/token.sol\r\nimport \"../token/token.sol\"; // -> /home/user/token/token.sol\r\n```\r\n\r\n### Standard input\r\n\r\n#### Standard input can be used as if it was an actual file called `<stdin>` if requested\r\n```solidity\r\n// Command line: contains `-`\r\nimport \"<stdin>\"; // -> stdin\r\n```\r\n\r\nIf there is an actual file called <stdin> in the current directory, it's ignored.\r\n\r\n#### A file called `<stdin>` from current working directory can only be imported if use of the standard input is not requested.\r\n```solidity\r\n// Command line: does not contain `-`\r\nimport \"<stdin>\"; // -> /home/user/work/<stdin>\r\n```\r\n\r\n#### `<stdin>` can be remapped to a path when it represents standard input\r\n```solidity\r\n// Command line: contains `-`\r\n// Remappings: <stdin>=/tmp/code/token.sol\r\nimport \"<stdin>\"; // -> /tmp/code/token.sol\r\n```\r\n\r\n#### `<stdin>` can be remapped to a path when it represents a file\r\n```solidity\r\n// Command line: does not contain `-`\r\n// Remappings: <stdin>=/tmp/code/token.sol\r\nimport \"<stdin>\"; // -> /tmp/code/token.sol\r\n```\r\n\r\n#### Paths can be remapped to `<stdin>` when it represents standard input\r\n```solidity\r\n// Command line: contains `-`\r\n// Remappings: /tmp/code/token.sol=<stdin>\r\nimport \"/tmp/code/token.sol\"; // -> stdin\r\n```\r\n\r\n#### Paths can be remapped to `<stdin>` when it represents a file\r\n```solidity\r\n// Command line: does not contain `-`\r\n// Remappings: /tmp/code/token.sol=<stdin>\r\nimport \"/tmp/code/token.sol\"; // -> /home/user/work/<stdin>\r\n```\r\n\r\n#### Base path does not affect `<stdin>` when it represents standard input\r\n```solidity\r\n// Command line: contains `-`\r\n// Base path: /base\r\nimport \"<stdin>\"; // -> stdin\r\n```\r\n\r\n#### Base path affects `<stdin>` when it does not represent standard input\r\n```solidity\r\n// Command line: does not contain `-`\r\n// Base path: /base\r\nimport \"<stdin>\"; // -> /base/<stdin>\r\n```\r\n\r\n### Extra Slashes\r\n\r\n#### Multiple slashes between path segments in imports are squashed into one\r\n```solidity\r\nimport \"/tmp//code/token.sol\";   // -> /tmp/code/token.sol\r\nimport \"/tmp////code/token.sol\"; // -> /tmp/code/token.sol\r\n```\r\n\r\n#### Trailing slashes in imports are replaced with `/.`\r\n```solidity\r\nimport \"/tmp/code/token.sol/\";    // -> /tmp/code/token.sol/.\r\nimport \"/tmp/code/token.sol//\";   // -> /tmp/code/token.sol/.\r\nimport \"/tmp/code/token.sol////\"; // -> /tmp/code/token.sol/.\r\n```\r\n\r\n#### Trailing slashes in relative imports that start with `.` or `..` imports are stripped\r\n```solidity\r\nimport \"./token/token.sol/\";     // -> /project/token/token.sol\r\nimport \"./token/token.sol//\";    // -> /project/token/token.sol\r\nimport \"./token/token.sol////\";  // -> /project/token/token.sol\r\nimport \"../token/token.sol/\";    // -> /project/token.sol\r\nimport \"../token/token.sol//\";   // -> /project/token.sol\r\nimport \"../token/token.sol////\"; // -> /project/token.sol\r\n```\r\n\r\n#### Two Leading slashes in imports are preserved\r\n```solidity\r\nimport \"//tmp/code/token.sol\";    // -> //tmp/code/token.sol\r\n```\r\n\r\n#### More than two Leading slashes in imports are squashed into one\r\n```solidity\r\nimport \"///tmp/code/token.sol\";    // -> /tmp/code/token.sol\r\nimport \"////tmp/code/token.sol\";   // -> /tmp/code/token.sol\r\nimport \"/////tmp/code/token.sol\";  // -> /tmp/code/token.sol\r\n```\r\n\r\n#### Slashes after the leading `.` or `..` in relative imports are squashed into one\r\n```solidity\r\nimport \"./token/token.sol\";      // -> /project/token/token.sol\r\nimport \".//token/token.sol\";     // -> /project/token/token.sol\r\nimport \".///token/token.sol\";    // -> /project/token/token.sol\r\nimport \".////token/token.sol\";   // -> /project/token/token.sol\r\nimport \"..//token/token.sol\";    // -> /token/token.sol\r\nimport \"..///token/token.sol\";   // -> /token/token.sol\r\nimport \"..////token/token.sol\";  // -> /token/token.sol\r\nimport \"../////token/token.sol\"; // -> /token/token.sol\r\n```\r\n\r\n#### Slashes in base path follow the same rules as slashes in imports\r\n```solidity\r\n// Base path: ////base1////base2/////base3////\r\nimport \"token/token.sol\"; // -> /base1/base2/base3/token/token.sol\r\n```\r\n\r\n#### Slashes in remappings must match exactly\r\n```solidity\r\n// Remappings: /tmp/code=/usr/lib\r\nimport \"/tmp//code/token.sol\";    // -> /tmp/code/token.sol\r\nimport \"/tmp/code/token.sol/\";    // -> /usr/lib/token.sol/\r\nimport \"/tmp/code/token.sol//\";   // -> /usr/lib/token.sol/\r\nimport \"//tmp/code/token.sol\";    // -> //tmp/code/token.sol\r\nimport \"///tmp/code/token.sol\";   // -> /tmp/code/token.sol\r\n```\r\n\r\n```solidity\r\n// Remappings: /tmp/code/token.sol//=/usr/lib/token.sol\r\nimport \"/tmp/code/token.sol\";    // -> /usr/lib/token.sol\r\nimport \"/tmp/code/token.sol/\";   // -> /usr/lib/token.sol/.\r\nimport \"/tmp/code/token.sol//\";  // -> /usr/lib/token.sol\r\nimport \"/tmp/code/token.sol///\"; // -> /usr/lib/token.sol/.\r\n```\r\n\r\n#### Multiple trailing slashes in remapping targets are squashed into one\r\n```solidity\r\n// Remappings: /tmp/code=////usr////lib////\r\nimport \"/tmp/code/token.sol\"; // -> /usr/lib/token.sol\r\n```\r\n\r\n### URLs\r\n\r\n#### `file://` prefix is stripped from paths\r\n```solidity\r\nimport \"file:///tmp/code/token.sol\"; // -> /tmp/code/token.sol\r\nimport \"/tmp/code/file://token.sol\"; // -> /tmp/code/file:/token.sol\r\n```\r\n\r\n#### Other protocol prefixes are not stripped\r\n```solidity\r\nimport \"http:///tmp/code/token.sol\";  // -> /home/user/work/http:/tmp/code/token.sol\r\nimport \"https:///tmp/code/token.sol\"; // -> /home/user/work/https:/tmp/code/token.sol\r\nimport \"ftp:///tmp/code/token.sol\";   // -> /home/user/work/ftp:/tmp/code/token.sol\r\n```\r\n\r\n#### Paths that become relative after stripping of `file://` are always relative to the current working directory\r\n```solidity\r\nimport \"file://token.sol\";    // -> /home/user/work/token.sol\r\nimport \"file://./token.sol\";  // -> /home/user/work/token.sol\r\nimport \"file://../token.sol\"; // -> /home/user/token.sol\r\n```\r\n\r\n#### Base path is prepended to paths that become relative after stripping of `file://`\r\n```solidity\r\n// Base path: /base\r\nimport \"file://token.sol\";    // -> /base/home/user/work/token.sol\r\n```\r\n\r\n#### Prepending base path to paths that start with `.` or `..` after stripping of `file://` makes them relative to the source directory\r\n```solidity\r\n// Base path: /base\r\nimport \"file://./token.sol\";  // -> /base/project/token.sol\r\nimport \"file://../token.sol\"; // -> /base/token.sol\r\n```\r\n\r\n#### `file://` prefix as a whole cannot be remapped\r\n```solidity\r\n// Remappings: file://=/usr/lib\r\nimport \"file:///tmp/code/token.sol\"; // -> /tmp/code/token.sol\r\n```\r\n\r\n```solidity\r\n// Remappings: file:/=/usr/lib\r\nimport \"file:///tmp/code/token.sol\"; // -> /tmp/code/token.sol\r\n```\r\n\r\n#### Fragments of the `file://` prefix can be remapped\r\n```solidity\r\n// Remappings: file=/usr/lib\r\nimport \"file:///tmp/code/token.sol\"; // -> /usr/lib:/tmp/code/token.sol\r\n```\r\n\r\n```solidity\r\n// Remappings: f=/usr/lib\r\nimport \"file:///tmp/code/token.sol\"; // -> /usr/libile:/tmp/code/token.sol\r\n```",
  "closed_by": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/11036/reactions",
    "total_count": 2,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 2
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/11036/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/789968492",
    "html_url": "https://github.com/ethereum/solidity/issues/11036#issuecomment-789968492",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11036",
    "id": 789968492,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4OTk2ODQ5Mg==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-03T18:44:08Z",
    "updated_at": "2021-03-03T18:44:08Z",
    "author_association": "MEMBER",
    "body": "Update: \"Trailing slashes in relative imports that start with `.` or `..` imports are stripped\".",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/789968492/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/853424118",
    "html_url": "https://github.com/ethereum/solidity/issues/11036#issuecomment-853424118",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11036",
    "id": 853424118,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MzQyNDExOA==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-02T22:28:30Z",
    "updated_at": "2021-06-02T22:28:30Z",
    "author_association": "MEMBER",
    "body": "Now that I have spent quite a bit of time working on path resolution, I see that most of the issues I listed are just unintuitive consequences of filesystem abstraction the compiler rather than actual bugs. It's now all covered by other issues so I'm going to close this monolithic one.\r\n\r\nFor anyone coming here in the future, I recommend taking a look at the docs in #11442 first.\r\n\r\n> 1. Base path is sometimes prepended to absolute paths.\r\n\r\nIt's by design but the design is flawed. #11409 adds a mechanism that removes the need to use absolute paths.\r\n\r\n> 2. Imports starting with `.` or `..` are not always relative to the source directory\r\n\r\nThey actually are relative to the source directory but only as long as we're in compiler's VFS. Once the path gets to the callback, it gets resolved in the actual filesystem. This will not change.\r\n\r\n> 3. Using a relative path to the source file on the command line sometimes makes relative imports resolve to different paths than when using an absolute path.\r\n\r\nThis is the consequence of #4702. When using imports starting with `./` or `../` the path is relative to the source unit name in the VFS, not path on disk. The problem is that paths specified on CLI become source unit names as is, without normalization. #11408 will solve this.\r\n\r\n> 4. Relative paths with `..` segments that go beyond filesystem root are silently replaced with valid ones.\r\n\r\nThis is by design (surprisingly, that's how paths in UNIX actually work; `/../../../` is equivalent to just `/`) but I'd like to change this anyway so that it produces an error instead.\r\n\r\n> 5. It's possible to remap some of the paths added implicitly to relative imports.\r\n>     (...)\r\n> 6. Not all prefixes can be remapped.\r\n>     - Leading `.` and `..` in imports cannot be remapped.\r\n\r\nAlso by design. Remapping works on source unit names in the VFS rather than on the exact import path you can see in the import statement.\r\n\r\n> - `file://` prefix as a whole cannot be remapped but its fragments can.\r\n\r\nThat's because the remapping happens in VFS but `file://` prefix is stripped by import callback.\r\n\r\n> 7. Special behavior of `<stdin>`.\r\n\r\nBehavior of `<stdin>` is perhaps not obvious but it's consistent with the VFS so I'm going to leave it as is.\r\n\r\n> 8. Trailing slashes in imports are replaced with `/.` (unless they start with `.` or `..`).\r\n>     - They should either be stripped or replaced with a single slash.\r\n\r\nThis is mostly a quirk of `boost::filesystem` and I'm going to treat it as a bug.\r\n\r\n> 9. Multiple remappings of the same prefix are ignored and the last one takes effect.\r\n\r\nThat's also maybe not the best design but remappings are going to become much less needed after #11409 so I think changing how they work now would only add to the confusion about paths.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/853424118/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
