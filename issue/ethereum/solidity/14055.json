{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/14055",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/14055/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/14055/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/14055/events",
  "html_url": "https://github.com/ethereum/solidity/issues/14055",
  "id": 1629603824,
  "node_id": "I_kwDOAm_5kc5hIcfw",
  "number": 14055,
  "title": "Internal libraries in contracts does not internal into code if viaIR-mode is enabled and solidity-coverage is running",
  "user": {
    "login": "SevenSwen",
    "id": 22360160,
    "node_id": "MDQ6VXNlcjIyMzYwMTYw",
    "avatar_url": "https://avatars.githubusercontent.com/u/22360160?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/SevenSwen",
    "html_url": "https://github.com/SevenSwen",
    "followers_url": "https://api.github.com/users/SevenSwen/followers",
    "following_url": "https://api.github.com/users/SevenSwen/following{/other_user}",
    "gists_url": "https://api.github.com/users/SevenSwen/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/SevenSwen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/SevenSwen/subscriptions",
    "organizations_url": "https://api.github.com/users/SevenSwen/orgs",
    "repos_url": "https://api.github.com/users/SevenSwen/repos",
    "events_url": "https://api.github.com/users/SevenSwen/events{/privacy}",
    "received_events_url": "https://api.github.com/users/SevenSwen/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-03-17T16:30:52Z",
  "updated_at": "2023-04-11T12:20:30Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Solidity-coverage has broken inliner optimization.\r\nWhen I run coverage with optimizerSteps:\r\n```\r\n\"dhfoDgvlfnTUtnIf\" +\r\n\"[\" +\r\n    \"xa[r]EscLM\" +\r\n    \"cCTUtTOntnfDIl\" +\r\n    \"Lcl\" +\r\n    \"Vcl [j]\" +\r\n    \"Tpel\" +\r\n    \"xa[rl]\" +\r\n    \"xa[r]cL\" +\r\n    \"gvif\" +\r\n    \"CTUca[r]LSsTFOtfDnca[r]Ilc\"\r\n\"]\" +\r\n  \"jml[jl] VcTOcl jml\",\r\n```\r\n(default settings without `u` instrumentation in all steps) than all tests will be finished success. But If I remove `\"gvif\"` step then I will have error:\r\n`NomicLabsHardhatPluginError: The contract <contract_name> is missing links for the following libraries: @openzeppelin/contracts/utils/math/Math.sol:Math`\r\nRepo/branch:\r\nhttps://github.com/1inch/farming/tree/feature/enable_viaIR\r\n\r\nMaybe problem into solidity-coverage code, but probably they do not make any injections into the optimization steps, and any of their actions should not affect the success of the code compilation.\r\n\r\nI also added a comment to the solidity-coverage repo [issue](https://github.com/sc-forks/solidity-coverage/issues/760#issuecomment-1473830415)",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/14055/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/14055/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1474232908",
    "html_url": "https://github.com/ethereum/solidity/issues/14055#issuecomment-1474232908",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14055",
    "id": 1474232908,
    "node_id": "IC_kwDOAm_5kc5X3wJM",
    "user": {
      "login": "r0qs",
      "id": 457348,
      "node_id": "MDQ6VXNlcjQ1NzM0OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/457348?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/r0qs",
      "html_url": "https://github.com/r0qs",
      "followers_url": "https://api.github.com/users/r0qs/followers",
      "following_url": "https://api.github.com/users/r0qs/following{/other_user}",
      "gists_url": "https://api.github.com/users/r0qs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/r0qs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/r0qs/subscriptions",
      "organizations_url": "https://api.github.com/users/r0qs/orgs",
      "repos_url": "https://api.github.com/users/r0qs/repos",
      "events_url": "https://api.github.com/users/r0qs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/r0qs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-17T18:20:08Z",
    "updated_at": "2023-03-20T20:15:01Z",
    "author_association": "MEMBER",
    "body": "Hi @SevenSwen thanks for the issue, but I suspect this is because Hardhat currently does not fully support via-ir. See: https://hardhat.org/hardhat-runner/docs/reference/solidity-support#support-for-ir-based-codegen\r\n\r\nFor reference:\r\n```\r\nAt the moment, this option only works well when the optimizer is enabled.\r\nSince Hardhat works much better when the optimizer is disabled, we don't completely support the viaIR option yet.\r\nYou can still enable it to compile your contracts and run your tests, but things like stack traces might not work correctly.\r\n\r\nIf you use the viaIR option, we recommend you set the optimization step sequence to \"u\", to make Hardhat work as well as possible\r\n```\r\n\r\nCould you please try using the following compiler setting:\r\n```\r\nsettings: {\r\n    viaIR: true,\r\n    optimizer: {\r\n      enabled: true,\r\n      details: {\r\n        yulDetails: {\r\n          optimizerSteps: \"u\",\r\n        },\r\n      },\r\n    },\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1474232908/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
