{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/13895",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/13895/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/13895/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/13895/events",
  "html_url": "https://github.com/ethereum/solidity/issues/13895",
  "id": 1558188349,
  "node_id": "I_kwDOAm_5kc5c4BE9",
  "number": 13895,
  "title": "Bug: type string memory is not implicitly convertible to type string storage pointer",
  "user": {
    "login": "Amxx",
    "id": 2432299,
    "node_id": "MDQ6VXNlcjI0MzIyOTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2432299?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Amxx",
    "html_url": "https://github.com/Amxx",
    "followers_url": "https://api.github.com/users/Amxx/followers",
    "following_url": "https://api.github.com/users/Amxx/following{/other_user}",
    "gists_url": "https://api.github.com/users/Amxx/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Amxx/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Amxx/subscriptions",
    "organizations_url": "https://api.github.com/users/Amxx/orgs",
    "repos_url": "https://api.github.com/users/Amxx/repos",
    "events_url": "https://api.github.com/users/Amxx/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Amxx/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-01-26T14:03:16Z",
  "updated_at": "2023-01-27T15:58:17Z",
  "closed_at": "2023-01-26T15:17:03Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nConsider the following code\r\n\r\n```solidity\r\n    function setWithFallback(string memory value, string storage store) internal returns (ShortString) {\r\n        if (bytes(value).length < 32) {\r\n            return toShortString(value);\r\n        } else {\r\n            store = value; // ISSUE IS HERE\r\n            return toShortString(\"\");\r\n        }\r\n    }\r\n\r\n    function getWithFallback(ShortString value, string storage store) internal returns (string memory) {\r\n        if (length(value) > 0) {\r\n            return toString(value);\r\n        } else {\r\n            return store;\r\n        }\r\n    }\r\n```\r\n\r\n`store = value;` refused to compile with error\r\n\r\n```\r\nTypeError: Type string memory is not implicitly convertible to expected type string storage pointer.\r\n```\r\n\r\nI would expect that to be valid, and to write the string in `value` to the storage slot corresponding to `store`\r\n\r\n## Environment\r\n\r\n- Remix\r\n- 0.8.17\r\n- default config\r\n\r\n## Steps to Reproduce\r\n\r\nTry to compile\r\n\r\n```solidity\r\nlibrary Test  {\r\n    function writeToStorage(string memory value, string storage store) internal {\r\n        store = value;\r\n    }\r\n}\r\n```\r\n",
  "closed_by": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/13895/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/13895/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1405164795",
    "html_url": "https://github.com/ethereum/solidity/issues/13895#issuecomment-1405164795",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13895",
    "id": 1405164795,
    "node_id": "IC_kwDOAm_5kc5TwRz7",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-26T15:17:03Z",
    "updated_at": "2023-01-26T15:21:31Z",
    "author_association": "MEMBER",
    "body": "It's more of a design choice than a bug, though whether it's a good one is up for discussion.\r\n\r\nIt works this way because both `string storage store` and `string memory value` are references and the assignment copies the reference, not the content. If we changed it, then it would be inconsistent with what happens when you assign between two `string storage` variables (it does not copy the content either, though in this case there is no error). The only case where an actual copy happens is when the target of the assignment is not a reference.\r\n\r\nThis is to some extent documented in [Data location and assignment behaviour](https://docs.soliditylang.org/en/latest/types.html#data-location-and-assignment-behaviour) but it does not actually mention this case specifically. I also think the docs would be clearer if they properly distinguished between storage variables and references/pointers to them. The fact that they avoid making that distinction muddles the matter.\r\n\r\nIn any case, I don't think simply changing this behavior to make it copy is the solution here. We do have a solution to the general problem in mind, but that will require changes in the current copy/reference semantics. That's tracked in #2435 so I'm closing this issue. We'll likely end up introducing something like a `copyof` operator to make copies explicit.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1405164795/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1406693698",
    "html_url": "https://github.com/ethereum/solidity/issues/13895#issuecomment-1406693698",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13895",
    "id": 1406693698,
    "node_id": "IC_kwDOAm_5kc5T2HFC",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-27T15:58:16Z",
    "updated_at": "2023-01-27T15:58:16Z",
    "author_association": "MEMBER",
    "body": "By the way, I see something similar already reported in the distant past: #2458.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1406693698/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
