{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/8330",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/8330/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/8330/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/8330/events",
  "html_url": "https://github.com/ethereum/solidity/issues/8330",
  "id": 566311165,
  "node_id": "MDU6SXNzdWU1NjYzMTExNjU=",
  "number": 8330,
  "title": "[SMTChecker] Support function type",
  "user": {
    "login": "leonardoalt",
    "id": 504195,
    "node_id": "MDQ6VXNlcjUwNDE5NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/504195?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/leonardoalt",
    "html_url": "https://github.com/leonardoalt",
    "followers_url": "https://api.github.com/users/leonardoalt/followers",
    "following_url": "https://api.github.com/users/leonardoalt/following{/other_user}",
    "gists_url": "https://api.github.com/users/leonardoalt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/leonardoalt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leonardoalt/subscriptions",
    "organizations_url": "https://api.github.com/users/leonardoalt/orgs",
    "repos_url": "https://api.github.com/users/leonardoalt/repos",
    "events_url": "https://api.github.com/users/leonardoalt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/leonardoalt/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4810143649,
      "node_id": "LA_kwDOAm_5kc8AAAABHrT3oQ",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/SMT",
      "name": "SMT",
      "color": "1d76db",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-02-17T13:48:37Z",
  "updated_at": "2022-11-17T10:23:08Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": null,
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/8330/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/8330/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/588228220",
    "html_url": "https://github.com/ethereum/solidity/issues/8330#issuecomment-588228220",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8330",
    "id": 588228220,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4ODIyODIyMA==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-19T13:26:10Z",
    "updated_at": "2020-02-19T13:26:10Z",
    "author_association": "MEMBER",
    "body": "So basically the idea is to model an internal dispatch function for each function signature. So given this situation:\r\n```\r\ncontract C {\r\n  function f(uint256 a) internal { ... }\r\n  function g(uint256 a) internal { ... }\r\n  function h(uint256 a, uint256 b) internal returns (uint256) { ... }\r\n  function i(uint256 a, uint256 b) internal returns (uint256) { ... }\r\n\r\n  function t(bool c1, bool c2) public returns {\r\n    function(uint256) internal p1 = c1 ? f : g;\r\n    function(uint256, uint256) internal returns(uint256) p2 = c2 ? h : i;\r\n    p1(p2(23, 42));\r\n  }\r\n}\r\n```\r\n\r\nwhat the encoding can do is to introduce two artificial internal dispatch functions for the two signatures of internal functions that are used as function pointers. So internally the contract would be encoded as if it was the following:\r\n\r\n```\r\ncontract C {\r\n  function f(uint256 a) internal {}\r\n  function g(uint256 a) internal {}\r\n\r\n  function dispatch1(uint256 functionId, uint256 a) internal {\r\n    if (functionId == 0) f(a);\r\n    else if (functionId == 1) g(a);\r\n    else revert();\r\n  }\r\n\r\n  function h(uint256 a, uint256 b) internal returns (uint256) {}\r\n  function i(uint256 a, uint256 b) internal returns (uint256) {}\r\n\r\n  function dispatch2(uint256 functionId, uint256 a, uint256 b) internal {\r\n    if (functionId == 2) return h(a, b); // could also start again at zero\r\n    else if (functionId == 3) return i(a, b);\r\n    else revert();\r\n  }\r\n\r\n  function t(bool c1, bool c2) public returns {\r\n    /* function(uint256) internal */ uint256 p1 = c1 ? /* f */ 0 : /* g */ 1;\r\n    /* function(uint256, uint256) internal returns(uint256) */ uint256 p2 = c2 ? /* h */ 2 : /* i */ 3;\r\n   dispatch1(p1, dispatch2(p2, 23, 42)); // p1(p2(23, 42));\r\n  }\r\n}\r\n```\r\n\r\nSomething similar can be done for external calls by artifically introducing external dispatch functions like\r\n```\r\n        function externalDispatch(bytes4 selector, ...arguments...) {\r\n             if (selector == f.selector) f(...arguments...);\r\n             else if (selector == g.selector) g(...arguments...);\r\n             else revert();\r\n         }\r\n```\r\n\r\nSince the set of internal or external functions that can be assigned to function type variables is finite and known in advance this should work.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/588228220/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
