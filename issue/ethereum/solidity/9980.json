{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/9980",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/9980/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/9980/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/9980/events",
  "html_url": "https://github.com/ethereum/solidity/issues/9980",
  "id": 716612925,
  "node_id": "MDU6SXNzdWU3MTY2MTI5MjU=",
  "number": 9980,
  "title": "Truffle fails while processing JSON output because of the missing `deployedGeneratedSources.ast.nodes` key",
  "user": {
    "login": "dddejan",
    "id": 1482564,
    "node_id": "MDQ6VXNlcjE0ODI1NjQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1482564?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dddejan",
    "html_url": "https://github.com/dddejan",
    "followers_url": "https://api.github.com/users/dddejan/followers",
    "following_url": "https://api.github.com/users/dddejan/following{/other_user}",
    "gists_url": "https://api.github.com/users/dddejan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dddejan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dddejan/subscriptions",
    "organizations_url": "https://api.github.com/users/dddejan/orgs",
    "repos_url": "https://api.github.com/users/dddejan/repos",
    "events_url": "https://api.github.com/users/dddejan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dddejan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    },
    {
      "id": 2376134343,
      "node_id": "MDU6TGFiZWwyMzc2MTM0MzQz",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/should%20compile%20without%20error",
      "name": "should compile without error",
      "color": "c48f13",
      "default": false,
      "description": "Error is reported even though it shouldn't. Source is fine."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2020-10-07T15:03:19Z",
  "updated_at": "2020-10-08T17:00:25Z",
  "closed_at": "2020-10-08T17:00:24Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nI am running truffle test on some contracts and the truffle tests are failing with 0.7.2+ but pass with 0.7.1. \r\n\r\nThe example I am using is the same as the one from #9974.\r\n\r\nRunning truffle with 0.7.1 succeeds with  \r\n\r\n```console\r\n$ truffle test\r\n\r\nCompiling your contracts...\r\n===========================\r\n> Compiling ./contracts/Migrations.sol\r\n> Compiling ./contracts/Test.sol\r\n> Artifacts written to /var/folders/3h/8n83hkk15kn72vl2_8bsw18c0000gp/T/test--53322-2ngFO246D7yd\r\n> Compiled successfully using:\r\n   - solc: 0.7.1+commit.f4a555be.Emscripten.clang\r\n\r\n\r\n\r\n  Contract: All\r\n    âœ“ Test (44ms)\r\n\r\n\r\n  1 passing (64ms)\r\n``` \r\n\r\nWhile running with 0.7.2+ fails with \r\n\r\n```console\r\n$ truffle test\r\n\r\nCompiling your contracts...\r\n===========================\r\n> Compiling ./contracts/Migrations.sol\r\n> Compiling ./contracts/Test.sol\r\n> Compilation warnings encountered:\r\n\r\n    Warning: This is a pre-release compiler version, please do not use it in production.\r\n\r\n> Artifacts written to /var/folders/3h/8n83hkk15kn72vl2_8bsw18c0000gp/T/test--53352-tjf1g2K6ZZ8d\r\n> Compiled successfully using:\r\n   - solc: 0.7.3-develop.2020.10.7+commit.9bfce1f6.Darwin.appleclang\r\n\r\n\r\n\r\n  Contract: All\r\n    1) \"before all\" hook: prepare suite for \"Test\"\r\n\r\n\r\n  0 passing (11ms)\r\n  1 failing\r\n\r\n  1) Contract: All\r\n       \"before all\" hook: prepare suite for \"Test\":\r\n     TypeError: ast.nodes is not iterable\r\n      at WireDecoder.collectUserDefinedTypes (/Users/dejan/.nvm/versions/node/v12.18.4/lib/node_modules/truffle/build/webpack:/packages/decoder/dist/decoders.js:130:1)\r\n      at new WireDecoder (/Users/dejan/.nvm/versions/node/v12.18.4/lib/node_modules/truffle/build/webpack:/packages/decoder/dist/decoders.js:101:10)\r\n      at Object.<anonymous> (/Users/dejan/.nvm/versions/node/v12.18.4/lib/node_modules/truffle/build/webpack:/packages/decoder/dist/index.js:187:1)\r\n      at Generator.next (<anonymous>)\r\n      at /Users/dejan/.nvm/versions/node/v12.18.4/lib/node_modules/truffle/build/webpack:/packages/decoder/dist/index.js:145:1\r\n      at new Promise (<anonymous>)\r\n      at __awaiter (/Users/dejan/.nvm/versions/node/v12.18.4/lib/node_modules/truffle/build/webpack:/packages/decoder/dist/index.js:141:1)\r\n      at Object.forProject (/Users/dejan/.nvm/versions/node/v12.18.4/lib/node_modules/truffle/build/webpack:/packages/decoder/dist/index.js:185:1)\r\n      at TestRunner.initialize (/Users/dejan/.nvm/versions/node/v12.18.4/lib/node_modules/truffle/build/webpack:/packages/core/lib/testing/TestRunner.js:67:1)\r\n      at processTicksAndRejections (internal/process/task_queues.js:97:5)\r\n      at Context.<anonymous> (/Users/dejan/.nvm/versions/node/v12.18.4/lib/node_modules/truffle/build/webpack:/packages/core/lib/test.js:336:1)\r\n```\r\n\r\nI really don't know how to debug this further (not a JS expert).\r\n\r\n## Environment\r\n\r\n```truffle version\r\n$ truffle version\r\nTruffle v5.1.47 (core: 5.1.47)\r\nSolidity - native (solc-js)\r\nNode v12.18.4\r\nWeb3.js v1.2.1\r\n```\r\n\r\nsolidity versions: 0.7.3, 0.7.2, 0.7.1\r\n\r\n## Steps to Reproduce\r\n\r\nDownload a small truffle project from [here](http://csl.sri.com/~dejan/bug.tar.gz), then\r\n\r\n1. Edit `truffle-config.js` and set `version: \"0.7.1\"`. Run `truffle test`, this one should pass.\r\n2. Edit `truffle-config.js` and set `version: \"0.7.2\"`. This `truffle test`, this one should fail.\r\n3. Edit `truffle-config.js` and set `version: \"native\"`. This one uses a compiled 0.7.3 binary in the path, and should also fail.",
  "closed_by": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/9980/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/9980/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/705088335",
    "html_url": "https://github.com/ethereum/solidity/issues/9980#issuecomment-705088335",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9980",
    "id": 705088335,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTA4ODMzNQ==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T17:36:16Z",
    "updated_at": "2020-10-07T17:36:16Z",
    "author_association": "MEMBER",
    "body": "I tracked it down. The issue is that Truffle expects to find a `nodes` key inside `deployedGeneratedSources.ast`. If it's not there or is not iterable, it fails.\r\n\r\n`deployedGeneratedSources` is a new feature added in 0.7.2 (see #8807/#9053). Now, I don't know enough about the feature to tell if that key should be there or if Trufle should just not expect it and assume `[]` if it's not there.\r\n@chriseth, @haltman-at?\r\n\r\n### Details\r\n#### Minimal repro\r\nAssumes that Truffle is installed and uses solc 0.7.3 that it downloads from solc-bin:\r\n\r\n```bash\r\ntruffle init\r\n\r\ncat << EOF > test/All.js\r\ncontract('All', function(accounts) {\r\n  it('Test');\r\n});\r\nEOF\r\n\r\ncat << EOF > contracts/Test.sol\r\npragma experimental ABIEncoderV2;\r\n\r\ncontract Test {\r\n    function foo(uint[1] memory) public {}\r\n}\r\nEOF\r\n\r\ncat << EOF > truffle-config.js\r\nmodule.exports = {\r\n  compilers: {\r\n    solc: {\r\n      version: \"0.7.3\"\r\n    }\r\n  }\r\n}\r\nEOF\r\n\r\ntruffle test\r\n```\r\n\r\n#### Adding empty `nodes`\r\nJust adding an empty `nodes` array to the json files stored by Truffle as compilation output silences the error:\r\n```bash\r\ntruffle compile\r\nmv build/contracts/Test.json Test-no-ast-nodes.json\r\ncat Test-no-ast-nodes.json | jq '.deployedGeneratedSources[0].ast.nodes = []' > build/contracts/Test.json Test-no-ast-nodes.json\r\ntruffle test\r\n```\r\n\r\n```\r\nUsing network 'test'.\r\n\r\n\r\nCompiling your contracts...\r\n===========================\r\n> Everything is up to date, there is nothing to compile.\r\n\r\n\r\n\r\n  Contract: All\r\n    - Test\r\n\r\n\r\n  0 passing (19ms)\r\n  1 pending\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/705088335/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/705110326",
    "html_url": "https://github.com/ethereum/solidity/issues/9980#issuecomment-705110326",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9980",
    "id": 705110326,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTExMDMyNg==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T18:17:30Z",
    "updated_at": "2020-10-07T18:17:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi, this would definitely seem to be a Truffle issue.  Would you mind opening an issue [over on Truffle](https://github.com/trufflesuite/truffle/issues) and I'll take a look at it there?  Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/705110326/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/705121971",
    "html_url": "https://github.com/ethereum/solidity/issues/9980#issuecomment-705121971",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9980",
    "id": 705121971,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTEyMTk3MQ==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T18:39:19Z",
    "updated_at": "2020-10-07T18:39:19Z",
    "author_association": "MEMBER",
    "body": "@haltman-at Done: https://github.com/trufflesuite/truffle/issues/3419",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/705121971/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/705700469",
    "html_url": "https://github.com/ethereum/solidity/issues/9980#issuecomment-705700469",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9980",
    "id": 705700469,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTcwMDQ2OQ==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-08T17:00:24Z",
    "updated_at": "2020-10-08T17:00:24Z",
    "author_association": "MEMBER",
    "body": "@dddejan The bug has been fixed in Truffle (https://github.com/trufflesuite/truffle/issues/3419). I have tested a new version from `develop` with your snippet and it works for me so I'm closing the issue. Please check it with your contract and feel free to reopen either this issue or the one in Truffle if you find there are still some problems with Solidity or Truffle respectively. Or start a new one if it's something unrelated.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/705700469/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
