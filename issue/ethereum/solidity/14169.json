{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/14169",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/14169/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/14169/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/14169/events",
  "html_url": "https://github.com/ethereum/solidity/issues/14169",
  "id": 1688643456,
  "node_id": "I_kwDOAm_5kc5kpqeA",
  "number": 14169,
  "title": "[SMTChecker] Underflow detected for msg.value - 0",
  "user": {
    "login": "GollyTicker",
    "id": 4527862,
    "node_id": "MDQ6VXNlcjQ1Mjc4NjI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4527862?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/GollyTicker",
    "html_url": "https://github.com/GollyTicker",
    "followers_url": "https://api.github.com/users/GollyTicker/followers",
    "following_url": "https://api.github.com/users/GollyTicker/following{/other_user}",
    "gists_url": "https://api.github.com/users/GollyTicker/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/GollyTicker/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/GollyTicker/subscriptions",
    "organizations_url": "https://api.github.com/users/GollyTicker/orgs",
    "repos_url": "https://api.github.com/users/GollyTicker/repos",
    "events_url": "https://api.github.com/users/GollyTicker/events{/privacy}",
    "received_events_url": "https://api.github.com/users/GollyTicker/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-04-28T14:18:14Z",
  "updated_at": "2023-04-28T15:12:44Z",
  "closed_at": "2023-04-28T15:11:35Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nI have a relatively simple and small smart contract where soldity smtchecker CHC reports an underflow for an expression `msg.value - 0` - which is obviously never true. I have tried many variations and couldn't really understand and debug why this error occurs. I've minimised the entire setup into this [repository branch](https://github.com/GollyTicker/ethereum-bridge-when-cheap/tree/smtchecker-problem) where one can run a few small commands to reproduce the error. I reproduced it on two different computers running Ubuntu and latest Solidity.\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.8.19\r\n- Target EVM version (as per compiler settings): latest (?)\r\n- Framework/IDE (e.g. Truffle or Remix): npm solc\r\n- EVM execution environment / backend / blockchain client: not executed, just SMTChecker during compilation\r\n- Operating system: Ubuntu LTS 22.4\r\n\r\n## Steps to Reproduce\r\n\r\nSimply follow these steps in the [README](https://github.com/GollyTicker/ethereum-bridge-when-cheap/tree/smtchecker-problem).\r\n\r\nIt will lead to the following error:\r\n```\r\nWarning: CHC: Underflow (resulting value less than 0) might happen here.\r\n  --> Reproducer.sol:20:26:\r\n   |\r\n20 |             sentAmount = msg.value - 0;\r\n   |                          ^^^^^^^^^^^^^\r\n```\r\n\r\nObviously, there is something wrong with that.\r\n\r\nAnd even more interestingly, when I change some *unrelated lines*, the warning sometimes goes away! It doesn't make any sense to me!\r\n\r\nI couldn't figure out how to get more detailed debugging information (intermediate steps etc.) - so I'm reporting this here.\r\n\r\nMaybe this is a configuration error on my side? But maybe it's a bug in Solidity SMTChecker.\r\n\r\nWhat do you think?",
  "closed_by": {
    "login": "GollyTicker",
    "id": 4527862,
    "node_id": "MDQ6VXNlcjQ1Mjc4NjI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4527862?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/GollyTicker",
    "html_url": "https://github.com/GollyTicker",
    "followers_url": "https://api.github.com/users/GollyTicker/followers",
    "following_url": "https://api.github.com/users/GollyTicker/following{/other_user}",
    "gists_url": "https://api.github.com/users/GollyTicker/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/GollyTicker/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/GollyTicker/subscriptions",
    "organizations_url": "https://api.github.com/users/GollyTicker/orgs",
    "repos_url": "https://api.github.com/users/GollyTicker/repos",
    "events_url": "https://api.github.com/users/GollyTicker/events{/privacy}",
    "received_events_url": "https://api.github.com/users/GollyTicker/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/14169/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/14169/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1527665493",
    "html_url": "https://github.com/ethereum/solidity/issues/14169#issuecomment-1527665493",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14169",
    "id": 1527665493,
    "node_id": "IC_kwDOAm_5kc5bDlNV",
    "user": {
      "login": "leonardoalt",
      "id": 504195,
      "node_id": "MDQ6VXNlcjUwNDE5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/504195?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/leonardoalt",
      "html_url": "https://github.com/leonardoalt",
      "followers_url": "https://api.github.com/users/leonardoalt/followers",
      "following_url": "https://api.github.com/users/leonardoalt/following{/other_user}",
      "gists_url": "https://api.github.com/users/leonardoalt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/leonardoalt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leonardoalt/subscriptions",
      "organizations_url": "https://api.github.com/users/leonardoalt/orgs",
      "repos_url": "https://api.github.com/users/leonardoalt/repos",
      "events_url": "https://api.github.com/users/leonardoalt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/leonardoalt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-28T14:35:52Z",
    "updated_at": "2023-04-28T14:35:52Z",
    "author_association": "MEMBER",
    "body": "When it says \"might happen here\" it may be a false positive, it's not stating that it has detected an underflow. This happens when the underlying solver isn't able to prove the SMT/Horn query. A detected underflow would be reported as \"happens here\".\r\n\r\nIt looks silly for this expression, but it happens sometimes for CHC because CHC doesn't only look at that expressions but needs to compute inductive invariants for the whole contract, considering an unbounded number of transactions. That's also why changing seemingly unrelated things have an effect on a certain query. If you increase the timeout the false positive may vanish.  Also if you use the BMC engine it might be able to prove it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1527665493/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1527686236",
    "html_url": "https://github.com/ethereum/solidity/issues/14169#issuecomment-1527686236",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14169",
    "id": 1527686236,
    "node_id": "IC_kwDOAm_5kc5bDqRc",
    "user": {
      "login": "GollyTicker",
      "id": 4527862,
      "node_id": "MDQ6VXNlcjQ1Mjc4NjI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4527862?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/GollyTicker",
      "html_url": "https://github.com/GollyTicker",
      "followers_url": "https://api.github.com/users/GollyTicker/followers",
      "following_url": "https://api.github.com/users/GollyTicker/following{/other_user}",
      "gists_url": "https://api.github.com/users/GollyTicker/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/GollyTicker/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/GollyTicker/subscriptions",
      "organizations_url": "https://api.github.com/users/GollyTicker/orgs",
      "repos_url": "https://api.github.com/users/GollyTicker/repos",
      "events_url": "https://api.github.com/users/GollyTicker/events{/privacy}",
      "received_events_url": "https://api.github.com/users/GollyTicker/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-28T14:51:09Z",
    "updated_at": "2023-04-28T14:51:54Z",
    "author_association": "NONE",
    "body": "Ah, thanks for the quick response and the suggestions.\r\n\r\nFunny. I interpreted the `might happen` in the way of `there exists some txs and variable assignments so that this case happens`. It seems, that the intended interpretation is `we couldn't prove safety here within the given time constraints.`\r\n\r\nCould we perhaps change/improve the wording in the output/[documentation](https://docs.soliditylang.org/en/v0.8.19/smtchecker.html)? I have the impression, that many people will fall into the same misinterpretation. I knew, that false positives existed, but I didn't know, that this formulation of words might be a false positive. The difference in the wording is realy sublte and for non-experts it's not intuitive to know, that that's whats meant.\r\n\r\n> It looks silly for this expression, but it happens sometimes for CHC because CHC doesn't only look at that expressions but needs to compute inductive invariants for the whole contract, considering an unbounded number of transactions. That's also why changing seemingly unrelated things have an effect on a certain query. If you increase the timeout the false positive may vanish. Also if you use the BMC engine it might be able to prove it.\r\n\r\nThanks for the explanations! I actually want to prove the stuff with the transactions and their interactions - which is why  I'm using CHC.\r\n\r\nI tried now to use timeouts (which are in milliseconds according to the docs). However, using any of these values `5, 1000, 10000, 100000` leads to the following error which I can't find a way to debug:\r\n```\r\nUnknown exception during compilation: Dynamic exception type: std::__2::system_error\r\nstd::exception::what: thread constructor failed: Resource temporarily unavailable\r\n```\r\n\r\nI didn't find anything related to this. Do you know something about it?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1527686236/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1527703761",
    "html_url": "https://github.com/ethereum/solidity/issues/14169#issuecomment-1527703761",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14169",
    "id": 1527703761,
    "node_id": "IC_kwDOAm_5kc5bDujR",
    "user": {
      "login": "leonardoalt",
      "id": 504195,
      "node_id": "MDQ6VXNlcjUwNDE5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/504195?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/leonardoalt",
      "html_url": "https://github.com/leonardoalt",
      "followers_url": "https://api.github.com/users/leonardoalt/followers",
      "following_url": "https://api.github.com/users/leonardoalt/following{/other_user}",
      "gists_url": "https://api.github.com/users/leonardoalt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/leonardoalt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leonardoalt/subscriptions",
      "organizations_url": "https://api.github.com/users/leonardoalt/orgs",
      "repos_url": "https://api.github.com/users/leonardoalt/repos",
      "events_url": "https://api.github.com/users/leonardoalt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/leonardoalt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-28T15:03:01Z",
    "updated_at": "2023-04-28T15:03:01Z",
    "author_association": "MEMBER",
    "body": "> Funny. I interpreted the might happen in the way of `there exists some txs and variable assignments so that this case happens`. It seems, that the intended interpretation is `we couldn't prove safety here within the given time constraints`.\r\n\r\nExactly! I've been meaning to change that since this is often misinterpreted, that's a nice way to put it.\r\n\r\n> Could we perhaps change/improve the wording in the output\r\n\r\nWill do, thanks for the feedback.\r\n\r\n> leads to the following error which I can't find a way to debug:\r\n\r\nThat's unfortunately a bug in our WebAssembly binary when compiled with z3 that we only found out a couple weeks ago too. Unfortunately the only fix for now is using either a Linux or OSX binary (directly or with foundry/hardhat).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1527703761/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1527715508",
    "html_url": "https://github.com/ethereum/solidity/issues/14169#issuecomment-1527715508",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14169",
    "id": 1527715508,
    "node_id": "IC_kwDOAm_5kc5bDxa0",
    "user": {
      "login": "GollyTicker",
      "id": 4527862,
      "node_id": "MDQ6VXNlcjQ1Mjc4NjI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4527862?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/GollyTicker",
      "html_url": "https://github.com/GollyTicker",
      "followers_url": "https://api.github.com/users/GollyTicker/followers",
      "following_url": "https://api.github.com/users/GollyTicker/following{/other_user}",
      "gists_url": "https://api.github.com/users/GollyTicker/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/GollyTicker/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/GollyTicker/subscriptions",
      "organizations_url": "https://api.github.com/users/GollyTicker/orgs",
      "repos_url": "https://api.github.com/users/GollyTicker/repos",
      "events_url": "https://api.github.com/users/GollyTicker/events{/privacy}",
      "received_events_url": "https://api.github.com/users/GollyTicker/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-28T15:11:34Z",
    "updated_at": "2023-04-28T15:11:34Z",
    "author_association": "NONE",
    "body": "> Exactly! I've been meaning to change that since this is often misinterpreted, that's a nice way to put it.\r\n\r\nGreat!\r\n\r\n> That's unfortunately a bug in our WebAssembly binary when compiled with z3 that we only found out a couple weeks ago too. Unfortunately the only fix for now is using either a Linux or OSX binary (directly or with foundry/hardhat).\r\n\r\nThanks for the explanation! I tried it with the Linux package and it works seamlessly! And the timeout of 10 seconds works wel lto fix the above issue! :partying_face: ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1527715508/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1527717044",
    "html_url": "https://github.com/ethereum/solidity/issues/14169#issuecomment-1527717044",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14169",
    "id": 1527717044,
    "node_id": "IC_kwDOAm_5kc5bDxy0",
    "user": {
      "login": "leonardoalt",
      "id": 504195,
      "node_id": "MDQ6VXNlcjUwNDE5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/504195?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/leonardoalt",
      "html_url": "https://github.com/leonardoalt",
      "followers_url": "https://api.github.com/users/leonardoalt/followers",
      "following_url": "https://api.github.com/users/leonardoalt/following{/other_user}",
      "gists_url": "https://api.github.com/users/leonardoalt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/leonardoalt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leonardoalt/subscriptions",
      "organizations_url": "https://api.github.com/users/leonardoalt/orgs",
      "repos_url": "https://api.github.com/users/leonardoalt/repos",
      "events_url": "https://api.github.com/users/leonardoalt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/leonardoalt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-28T15:12:43Z",
    "updated_at": "2023-04-28T15:12:43Z",
    "author_association": "MEMBER",
    "body": "Great to hear!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1527717044/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
