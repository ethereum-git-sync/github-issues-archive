{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/8394",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/8394/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/8394/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/8394/events",
  "html_url": "https://github.com/ethereum/solidity/issues/8394",
  "id": 571779161,
  "node_id": "MDU6SXNzdWU1NzE3NzkxNjE=",
  "number": 8394,
  "title": "Getters for enum-indexed mappings don't check their arguments",
  "user": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-02-27T02:27:26Z",
  "updated_at": "2020-03-23T14:23:42Z",
  "closed_at": "2020-03-23T14:23:42Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nWhile normally Solidity prevents out-of-range enums from existing, it's still possible to create them by manually passing them in from outside, as functions don't in general check the validity of enums and booleans passed in from outside.  That's not the problem; I'm assuming that's intentional and not going to be changed anytime soon.\r\n\r\nThe problem is that getters for public enum-keyed mappings don't do this; these functions should check their arguments and revert if the argument is out of range.  Why do I say this?  Because:\r\n\r\n1. Enum-keyed mappings *do* check their argument when accessed inside another function (whether for reading or writing).  But if it's via a getter, then you can read outside the range.  (You can't *set* outside the range, due to the mappings normally checking their arguments, so you'll always get 0, but still.)\r\n2. With bool-keyed mappings (`bool` being the one other type that can be used as a mapping key and which can have out-of-range values passed in from outside), out-of-range values are normalized to `true` when used as a mapping key, and this applies both when the mapping is accessed within another function *and* when it's accessed via a getter.\r\n\r\nSo, for consistency, accessing an enum-keyed mapping via a getter should work the same as accessing it normally (much as is true for `bool`-keyed mappings, the one other type for which the question is relevant), meaning, it should revert if the key is out of range for enum.\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.6.3\r\n- Target EVM version (as per compiler settings): whatever the default is\r\n- Framework/IDE (e.g. Truffle or Remix): Truffle\r\n- EVM execution environment / backend / blockchain client: Ganache CLI v6.8.2 (ganache-core: 2.9.2)\r\n\r\n## Steps to Reproduce\r\n\r\n```\r\npragma solidity ^0.6.3;\r\n\r\ncontract EnumKeysTest {\r\n  enum Ternary { Yes, No, MaybeSo }\r\n\r\n  mapping(Ternary => string) public enumMap;\r\n\r\n  function readFrom(Ternary out) public view returns (string memory) {\r\n    return enumMap[out];\r\n  }\r\n}\r\n```\r\n\r\nCalling `readFrom(3)` causes a revert, but calling `enumMap(3)` just returns `''`.",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/8394/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/8394/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/591943254",
    "html_url": "https://github.com/ethereum/solidity/issues/8394#issuecomment-591943254",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8394",
    "id": 591943254,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MTk0MzI1NA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-27T12:23:27Z",
    "updated_at": "2020-02-27T12:23:27Z",
    "author_association": "MEMBER",
    "body": "ABIEncoderV2 enabled strict parameter checking, and if you activate it, the code reverts for both functions.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/591943254/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/592037502",
    "html_url": "https://github.com/ethereum/solidity/issues/8394#issuecomment-592037502",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8394",
    "id": 592037502,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5MjAzNzUwMg==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-27T16:03:14Z",
    "updated_at": "2020-02-27T16:03:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "Oh, I totally didn't realize!  Thanks!  I do think that getters should still always check parameters for consistency, but it's still really nice that ABIEncoderV2 turns on strict parameter checking generally.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/592037502/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/598185700",
    "html_url": "https://github.com/ethereum/solidity/issues/8394#issuecomment-598185700",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8394",
    "id": 598185700,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5ODE4NTcwMA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-12T13:28:26Z",
    "updated_at": "2020-03-12T13:28:26Z",
    "author_association": "MEMBER",
    "body": "So do you think this can be closed?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/598185700/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
