{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/14686",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/14686/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/14686/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/14686/events",
  "html_url": "https://github.com/ethereum/solidity/issues/14686",
  "id": 2000362637,
  "node_id": "I_kwDOAm_5kc53OxyN",
  "number": 14686,
  "title": "Compilation Error with `--combined-json` and `--via-ir` Options ",
  "user": {
    "login": "desp4c1to",
    "id": 151051838,
    "node_id": "U_kgDOCQDePg",
    "avatar_url": "https://avatars.githubusercontent.com/u/151051838?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/desp4c1to",
    "html_url": "https://github.com/desp4c1to",
    "followers_url": "https://api.github.com/users/desp4c1to/followers",
    "following_url": "https://api.github.com/users/desp4c1to/following{/other_user}",
    "gists_url": "https://api.github.com/users/desp4c1to/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/desp4c1to/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/desp4c1to/subscriptions",
    "organizations_url": "https://api.github.com/users/desp4c1to/orgs",
    "repos_url": "https://api.github.com/users/desp4c1to/repos",
    "events_url": "https://api.github.com/users/desp4c1to/events{/privacy}",
    "received_events_url": "https://api.github.com/users/desp4c1to/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-11-16T15:27:09Z",
  "updated_at": "2023-12-12T09:13:22Z",
  "closed_at": "2023-12-12T09:13:21Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### Issue Description:\r\n\r\nI'm developing a builder to compile multiple smart contracts. During this process, I've encountered a specific issue with the Solidity compiler (`solc`) when using certain command-line options.\r\n\r\n#### Environment:\r\n- Compiler: Solidity (`solc`)\r\n- Command used: `solc xxx --optimize-runs=1 --combined-json abi,ast,bin,bin-runtime,srcmap,srcmap-runtime,userdoc,devdoc,hashes`\r\n\r\n#### Steps to Reproduce:\r\n1. Compile smart contracts using `solc` without any additional options. This step works without any issues.\r\n2. Add the `--combined-json abi,ast,bin,bin-runtime,srcmap,srcmap-runtime,userdoc,devdoc,hashes` option to the `solc` command. This results in a `Stack too deep` error.\r\n3. Follow the error suggestion and add the `--via-ir` option. However, this doesn't resolve the issue, and the compilation still fails.\r\n\r\n#### Expected Behavior:\r\nThe compiler should successfully compile the smart contracts with the specified options without returning a stack error.\r\n\r\n#### Actual Behavior:\r\nWhen the `--combined-json` option is included, the compiler returns an error:\r\n```\r\nError: Stack too deep. Try compiling with `--via-ir`...\r\n```\r\n\r\nAdding `--via-ir` as suggested results in the following error:\r\n```\r\nUncaught exception:\r\n[solidity::util::tag_comment*] = Variable var_amount_3216 is 1 slot(s) too deep inside the stack. Stack too deep. Try compiling with `--via-ir`...\r\n```\r\n\r\nStill results in the following error\r\n```\r\nUncaught exception:\r\n/Users/distiller/project/libyul/backends/evm/EVMObjectCompiler.cpp(126): Throw in function run\r\nDynamic exception type: boost::wrapexcept<solidity::yul::StackTooDeepError>\r\nstd::exception::what: Variable var_amount_3216 is 1 slot(s) too deep inside the stack. Stack too deep. Try compiling with `--via-ir` (cli) or the equivalent `viaIR: true` (standard JSON) while enabling the optimizer. Otherwise, try removing local variables.\r\n[solidity::util::tag_comment*] = Variable var_amount_3216 is 1 slot(s) too deep inside the stack. Stack too deep. Try compiling with `--via-ir` (cli) or the equivalent `viaIR: true` (standard JSON) while enabling the optimizer. Otherwise, try removing local variables.\r\n```\r\n\r\n#### Additional Context:\r\n- The issue seems to be specifically related to the combination of `--combined-json` and `--via-ir` options.\r\n- I am compiling the contract from [this address](https://etherscan.io/address/0x9ab6b21cdf116f611110b048987e58894786c244#code) \r\n\r\nAny insights or suggestions on how to resolve this issue would be greatly appreciated.\r\n\r\n\r\n\r\n",
  "closed_by": {
    "login": "nikola-matic",
    "id": 4415530,
    "node_id": "MDQ6VXNlcjQ0MTU1MzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4415530?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nikola-matic",
    "html_url": "https://github.com/nikola-matic",
    "followers_url": "https://api.github.com/users/nikola-matic/followers",
    "following_url": "https://api.github.com/users/nikola-matic/following{/other_user}",
    "gists_url": "https://api.github.com/users/nikola-matic/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nikola-matic/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nikola-matic/subscriptions",
    "organizations_url": "https://api.github.com/users/nikola-matic/orgs",
    "repos_url": "https://api.github.com/users/nikola-matic/repos",
    "events_url": "https://api.github.com/users/nikola-matic/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nikola-matic/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/14686/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/14686/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1817803737",
    "html_url": "https://github.com/ethereum/solidity/issues/14686#issuecomment-1817803737",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14686",
    "id": 1817803737,
    "node_id": "IC_kwDOAm_5kc5sWXvZ",
    "user": {
      "login": "r0qs",
      "id": 457348,
      "node_id": "MDQ6VXNlcjQ1NzM0OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/457348?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/r0qs",
      "html_url": "https://github.com/r0qs",
      "followers_url": "https://api.github.com/users/r0qs/followers",
      "following_url": "https://api.github.com/users/r0qs/following{/other_user}",
      "gists_url": "https://api.github.com/users/r0qs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/r0qs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/r0qs/subscriptions",
      "organizations_url": "https://api.github.com/users/r0qs/orgs",
      "repos_url": "https://api.github.com/users/r0qs/repos",
      "events_url": "https://api.github.com/users/r0qs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/r0qs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-19T09:48:20Z",
    "updated_at": "2023-11-19T10:07:09Z",
    "author_association": "MEMBER",
    "body": "I could compile just fine your example using the via IR pipeline and the latest solc version on the `develop` branch (`0.8.24+commit.58811f13`), i.e. `solc --via-ir --optimize-runs=1 --combined-json abi,ast,bin,bin-runtime,srcmap,srcmap-runtime,userdoc,devdoc,hashes c.sol`\r\n\r\nWhat version of `solc` are you using?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1817803737/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1819263816",
    "html_url": "https://github.com/ethereum/solidity/issues/14686#issuecomment-1819263816",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14686",
    "id": 1819263816,
    "node_id": "IC_kwDOAm_5kc5sb8NI",
    "user": {
      "login": "desp4c1to",
      "id": 151051838,
      "node_id": "U_kgDOCQDePg",
      "avatar_url": "https://avatars.githubusercontent.com/u/151051838?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/desp4c1to",
      "html_url": "https://github.com/desp4c1to",
      "followers_url": "https://api.github.com/users/desp4c1to/followers",
      "following_url": "https://api.github.com/users/desp4c1to/following{/other_user}",
      "gists_url": "https://api.github.com/users/desp4c1to/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/desp4c1to/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/desp4c1to/subscriptions",
      "organizations_url": "https://api.github.com/users/desp4c1to/orgs",
      "repos_url": "https://api.github.com/users/desp4c1to/repos",
      "events_url": "https://api.github.com/users/desp4c1to/events{/privacy}",
      "received_events_url": "https://api.github.com/users/desp4c1to/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-20T15:17:54Z",
    "updated_at": "2023-11-20T15:17:54Z",
    "author_association": "NONE",
    "body": "I am using v0.8.19, the same as illustrate in the etherscan\r\n```\r\nsolc, the solidity compiler commandline interface\r\nVersion: 0.8.19+commit.7dd6d404.Darwin.appleclang\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1819263816/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1819275882",
    "html_url": "https://github.com/ethereum/solidity/issues/14686#issuecomment-1819275882",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14686",
    "id": 1819275882,
    "node_id": "IC_kwDOAm_5kc5sb_Jq",
    "user": {
      "login": "desp4c1to",
      "id": 151051838,
      "node_id": "U_kgDOCQDePg",
      "avatar_url": "https://avatars.githubusercontent.com/u/151051838?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/desp4c1to",
      "html_url": "https://github.com/desp4c1to",
      "followers_url": "https://api.github.com/users/desp4c1to/followers",
      "following_url": "https://api.github.com/users/desp4c1to/following{/other_user}",
      "gists_url": "https://api.github.com/users/desp4c1to/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/desp4c1to/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/desp4c1to/subscriptions",
      "organizations_url": "https://api.github.com/users/desp4c1to/orgs",
      "repos_url": "https://api.github.com/users/desp4c1to/repos",
      "events_url": "https://api.github.com/users/desp4c1to/events{/privacy}",
      "received_events_url": "https://api.github.com/users/desp4c1to/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-20T15:23:19Z",
    "updated_at": "2023-11-20T15:23:19Z",
    "author_association": "NONE",
    "body": "I can compile with 0.8.23\r\n```\r\nsolc, the solidity compiler commandline interface\r\nVersion: 0.8.23+commit.f704f362.Darwin.appleclang\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1819275882/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1851590299",
    "html_url": "https://github.com/ethereum/solidity/issues/14686#issuecomment-1851590299",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14686",
    "id": 1851590299,
    "node_id": "IC_kwDOAm_5kc5uXQab",
    "user": {
      "login": "nikola-matic",
      "id": 4415530,
      "node_id": "MDQ6VXNlcjQ0MTU1MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4415530?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nikola-matic",
      "html_url": "https://github.com/nikola-matic",
      "followers_url": "https://api.github.com/users/nikola-matic/followers",
      "following_url": "https://api.github.com/users/nikola-matic/following{/other_user}",
      "gists_url": "https://api.github.com/users/nikola-matic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nikola-matic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nikola-matic/subscriptions",
      "organizations_url": "https://api.github.com/users/nikola-matic/orgs",
      "repos_url": "https://api.github.com/users/nikola-matic/repos",
      "events_url": "https://api.github.com/users/nikola-matic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nikola-matic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-12T09:13:21Z",
    "updated_at": "2023-12-12T09:13:21Z",
    "author_association": "MEMBER",
    "body": "> I can compile with 0.8.23\r\n> \r\n> ```\r\n> solc, the solidity compiler commandline interface\r\n> Version: 0.8.23+commit.f704f362.Darwin.appleclang\r\n> ```\r\n\r\nThis was most likely fixed in [0.8.21](https://github.com/ethereum/solidity/blob/develop/Changelog.md?plain=1#L72) by the default minimal yul optimizations (stack to memory mover), and since it can't be reproduced in 0.8.23, I'll be closing the issue as fixed.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1851590299/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
