{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/3469",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/3469/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/3469/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/3469/events",
  "html_url": "https://github.com/ethereum/solidity/issues/3469",
  "id": 295521420,
  "node_id": "MDU6SXNzdWUyOTU1MjE0MjA=",
  "number": 3469,
  "title": "Struct overwriting storage",
  "user": {
    "login": "Arctek",
    "id": 6056989,
    "node_id": "MDQ6VXNlcjYwNTY5ODk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6056989?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Arctek",
    "html_url": "https://github.com/Arctek",
    "followers_url": "https://api.github.com/users/Arctek/followers",
    "following_url": "https://api.github.com/users/Arctek/following{/other_user}",
    "gists_url": "https://api.github.com/users/Arctek/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Arctek/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Arctek/subscriptions",
    "organizations_url": "https://api.github.com/users/Arctek/orgs",
    "repos_url": "https://api.github.com/users/Arctek/repos",
    "events_url": "https://api.github.com/users/Arctek/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Arctek/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2018-02-08T13:58:08Z",
  "updated_at": "2018-02-08T14:20:49Z",
  "closed_at": "2018-02-08T14:20:28Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi,\r\n\r\nWhile checking new verified contracts my friend discovered the following one (meant to scam people):\r\n\r\n    pragma solidity 0.4.19;\r\n\r\n    contract test{\r\n        struct SeedComponents{\r\n            uint component1;\r\n            uint component2;\r\n            uint component3;\r\n            uint component4;\r\n        }\r\n        \r\n        address owner;\r\n        uint public secretSeed;\r\n        uint public lastReseed;\r\n        \r\n        uint public winnerLuckyNumber = 7;\r\n            \r\n        mapping (address => bool) participated;\r\n\r\n        event showme(uint luckyNumberOfAddress, uint winnerLuckyNumber, uint n);\r\n\r\n        \r\n        function showNumber() constant returns (uint winnerLuckyNumber){}\r\n        \r\n        function test() {\r\n            owner = msg.sender;\r\n            reseed(SeedComponents(12345678, 0x12345678, 0xabbaeddaacdc, 0x22222222));\r\n        }\r\n        \r\n        modifier onlyOwner() {\r\n            require(msg.sender == owner);\r\n            _;\r\n        }\r\n      \r\n        modifier onlyHuman() {\r\n            require(msg.sender == tx.origin);\r\n            _;\r\n        }\r\n        \r\n        function participate() payable onlyHuman { \r\n            require(msg.value == 0.1 ether);\r\n            \r\n            // every address can only win once, obviously\r\n           require(!participated[msg.sender]);\r\n             showme(luckyNumberOfAddress(msg.sender), winnerLuckyNumber, _myLuckyNumber());\r\n            if ( luckyNumberOfAddress(msg.sender) == winnerLuckyNumber)\r\n            {\r\n                participated[msg.sender] = true;\r\n                require(msg.sender.call.value(this.balance)());\r\n            }\r\n        }\r\n        \r\n        function luckyNumberOfAddress(address addr) constant returns(uint n){\r\n            // 1 in 8 chance\r\n            n = uint(keccak256(uint(addr), secretSeed)[0]) % 8;\r\n           \r\n        }\r\n        \r\n        function reseed(SeedComponents components) internal {\r\n            secretSeed = uint256(keccak256(\r\n                components.component1,\r\n                components.component2,\r\n                components.component3,\r\n                components.component4\r\n            ));\r\n            lastReseed = block.number;\r\n        }\r\n        \r\n        function kill() onlyOwner {\r\n            suicide(owner);\r\n        }\r\n        \r\n        function forceReseed() onlyOwner{\r\n            SeedComponents s;\r\n            s.component1 = uint(msg.sender);\r\n            s.component2 = uint256(block.blockhash(block.number - 1));\r\n            s.component3 = block.number * 1337;\r\n            s.component4 = tx.gasprice * 7;\r\n            reseed(s);\r\n        }\r\n        \r\n        function () payable {}\r\n        \r\n        // DEBUG, DELETE BEFORE DEPLOYMENT!!\r\n        function _myLuckyNumber() constant returns(uint n){\r\n            n = luckyNumberOfAddress(msg.sender);\r\n        }\r\n    }\r\n\r\nWhen `forceReseed()` is called `winnerLuckyNumber` is overwritten.\r\nDeclaring `SeedComponents s` as `memory` solves this issue.\r\nIs this intended behaviour?\r\n\r\nI have deployed both of these versions to rinkeby:\r\nhttps://rinkeby.etherscan.io/address/0x50776f731602549acf57ba7f9ea8fae5f8b15581#readContract\r\nhttps://rinkeby.etherscan.io/address/0xdb1975e10575d9ee05344ca84eeccb5fd4fdbe5f#readContract\r\n",
  "closed_by": {
    "login": "Arctek",
    "id": 6056989,
    "node_id": "MDQ6VXNlcjYwNTY5ODk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6056989?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Arctek",
    "html_url": "https://github.com/Arctek",
    "followers_url": "https://api.github.com/users/Arctek/followers",
    "following_url": "https://api.github.com/users/Arctek/following{/other_user}",
    "gists_url": "https://api.github.com/users/Arctek/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Arctek/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Arctek/subscriptions",
    "organizations_url": "https://api.github.com/users/Arctek/orgs",
    "repos_url": "https://api.github.com/users/Arctek/repos",
    "events_url": "https://api.github.com/users/Arctek/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Arctek/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/3469/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/3469/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/364123998",
    "html_url": "https://github.com/ethereum/solidity/issues/3469#issuecomment-364123998",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3469",
    "id": 364123998,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDEyMzk5OA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-08T14:15:46Z",
    "updated_at": "2018-02-08T14:15:46Z",
    "author_association": "MEMBER",
    "body": "The compiler should warn you about the storage pointer `SeedComponents s;` being uninitialized. Please take warnings seriously!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/364123998/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/364125549",
    "html_url": "https://github.com/ethereum/solidity/issues/3469#issuecomment-364125549",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3469",
    "id": 364125549,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDEyNTU0OQ==",
    "user": {
      "login": "Arctek",
      "id": 6056989,
      "node_id": "MDQ6VXNlcjYwNTY5ODk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6056989?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Arctek",
      "html_url": "https://github.com/Arctek",
      "followers_url": "https://api.github.com/users/Arctek/followers",
      "following_url": "https://api.github.com/users/Arctek/following{/other_user}",
      "gists_url": "https://api.github.com/users/Arctek/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Arctek/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Arctek/subscriptions",
      "organizations_url": "https://api.github.com/users/Arctek/orgs",
      "repos_url": "https://api.github.com/users/Arctek/repos",
      "events_url": "https://api.github.com/users/Arctek/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Arctek/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-08T14:20:49Z",
    "updated_at": "2018-02-08T14:20:49Z",
    "author_association": "NONE",
    "body": "Thanks, I can see that.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/364125549/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
