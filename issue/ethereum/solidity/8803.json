{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/8803",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/8803/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/8803/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/8803/events",
  "html_url": "https://github.com/ethereum/solidity/issues/8803",
  "id": 609233341,
  "node_id": "MDU6SXNzdWU2MDkyMzMzNDE=",
  "number": 8803,
  "title": "Compiler should export constructor code",
  "user": {
    "login": "rmeissner",
    "id": 2896048,
    "node_id": "MDQ6VXNlcjI4OTYwNDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2896048?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rmeissner",
    "html_url": "https://github.com/rmeissner",
    "followers_url": "https://api.github.com/users/rmeissner/followers",
    "following_url": "https://api.github.com/users/rmeissner/following{/other_user}",
    "gists_url": "https://api.github.com/users/rmeissner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rmeissner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rmeissner/subscriptions",
    "organizations_url": "https://api.github.com/users/rmeissner/orgs",
    "repos_url": "https://api.github.com/users/rmeissner/repos",
    "events_url": "https://api.github.com/users/rmeissner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rmeissner/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 9,
  "created_at": "2020-04-29T17:35:03Z",
  "updated_at": "2020-07-28T14:25:26Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Result from the open discussion about upgradable contracts at the Solidity Summit\r\n\r\nSee https://hackmd.io/zjYDbVL5TEqgpOgMXXNT1g?both\r\n\r\nAs proxies cannot make use of the constructor code if the \"master copy\" it is very common to use some initializer code. This can cause issues and often requires overhead (e.g. adding a `init` function to the master copy)\r\n\r\nCurrently it's not possible to grab the constructor bytecode from the deployBytecode since the constructor argument positions are hardcoded, so a different-length runtime code would yield differ.\r\n\r\nTherefore it would be very valuable to expose the constructor in a way that it can be reused. ",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/8803/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/8803/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/621365300",
    "html_url": "https://github.com/ethereum/solidity/issues/8803#issuecomment-621365300",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8803",
    "id": 621365300,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMTM2NTMwMA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-29T17:50:28Z",
    "updated_at": "2020-04-29T17:50:28Z",
    "author_association": "MEMBER",
    "body": "The problem with the constructor argument offset is that we do not know how many bytes it would need. Can you please elaborate on what you would do with the constructor code? Would it work to have a constructor routine that abi-decodes the parameters from calldata?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/621365300/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/621406141",
    "html_url": "https://github.com/ethereum/solidity/issues/8803#issuecomment-621406141",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8803",
    "id": 621406141,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMTQwNjE0MQ==",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-29T19:09:20Z",
    "updated_at": "2020-04-29T19:10:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "Different people may have different uses for it. One option is to deploy a contract whose runtime code is the constructor code. A proxy contract could then be created like this:\r\n\r\n```solidity\r\ncontract Proxy {\r\n  constructor(address ctor, address runtime, bytes args) {\r\n    ctor.delegatecall(args); // require success\r\n    _setImplementation(runtime); // sets the delegatecall target in the fallback\r\n  }\r\n  ...\r\n}\r\n```\r\n\r\nKeep in mind that there is an expectation that code on chain be verified by Etherscan or similar services, and the way they currently work they are not able to verify runtime code in isolation, or constructor code in isolation, so there would need to be a standard way to deploy these things that source code verification services can correctly detect. It's not clear whether defining this should be in the scope of the compiler, but I think it should be a consideration.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/621406141/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/621773127",
    "html_url": "https://github.com/ethereum/solidity/issues/8803#issuecomment-621773127",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8803",
    "id": 621773127,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMTc3MzEyNw==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-30T11:23:49Z",
    "updated_at": "2020-04-30T11:23:49Z",
    "author_association": "MEMBER",
    "body": "Disregarding the problem with the argument offset, something like `type(contract).initCode` should include\r\n - the callvalue check?\r\n - everything up to but excluding the actual deploy code?\r\n - what about immutables? I guess immutables are incompatible with upgradable contracts",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/621773127/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/622130759",
    "html_url": "https://github.com/ethereum/solidity/issues/8803#issuecomment-622130759",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8803",
    "id": 622130759,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMjEzMDc1OQ==",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-30T21:42:53Z",
    "updated_at": "2020-04-30T21:42:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yes immutables seem incompatible. Maybe it would be an error to access or output the `initCode` of a contract with immutable state variables.\r\n\r\nThe other two things you mention should be included yes. This includes for example setting the initial values of state variables.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/622130759/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/631489432",
    "html_url": "https://github.com/ethereum/solidity/issues/8803#issuecomment-631489432",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8803",
    "id": 631489432,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzMTQ4OTQzMg==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-20T13:55:56Z",
    "updated_at": "2020-05-20T13:55:56Z",
    "author_association": "MEMBER",
    "body": "We just discussed that in the meeting and found that this is a rather complicated feature that is easy to get wrong both on the user and on the compiler side. If someone can come up with a cleaner specification, we are happy to implement it, but at the current time this does not seem like a good idea.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/631489432/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/631724420",
    "html_url": "https://github.com/ethereum/solidity/issues/8803#issuecomment-631724420",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8803",
    "id": 631724420,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzMTcyNDQyMA==",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-20T21:01:00Z",
    "updated_at": "2020-05-20T21:01:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "@chriseth Thanks for the update. Can you share some detail on the different ways you see this could go wrong? I'd like to understand what kind of problems we're talking about.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/631724420/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/631809243",
    "html_url": "https://github.com/ethereum/solidity/issues/8803#issuecomment-631809243",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8803",
    "id": 631809243,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzMTgwOTI0Mw==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-21T00:33:37Z",
    "updated_at": "2020-05-21T00:33:37Z",
    "author_association": "MEMBER",
    "body": "We also discussed that #2296 seems to be a safer way, in our opinion.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/631809243/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/647566870",
    "html_url": "https://github.com/ethereum/solidity/issues/8803#issuecomment-647566870",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8803",
    "id": 647566870,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NzU2Njg3MA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-22T14:49:34Z",
    "updated_at": "2020-06-22T14:49:34Z",
    "author_association": "MEMBER",
    "body": "@frangio the problem is that the constructor code is deeply coupled with the code deposit routine. Maybe you could try if you can easily extract the required code from `--ir`?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/647566870/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/665072238",
    "html_url": "https://github.com/ethereum/solidity/issues/8803#issuecomment-665072238",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8803",
    "id": 665072238,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NTA3MjIzOA==",
    "user": {
      "login": "rmeissner",
      "id": 2896048,
      "node_id": "MDQ6VXNlcjI4OTYwNDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2896048?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rmeissner",
      "html_url": "https://github.com/rmeissner",
      "followers_url": "https://api.github.com/users/rmeissner/followers",
      "following_url": "https://api.github.com/users/rmeissner/following{/other_user}",
      "gists_url": "https://api.github.com/users/rmeissner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rmeissner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rmeissner/subscriptions",
      "organizations_url": "https://api.github.com/users/rmeissner/orgs",
      "repos_url": "https://api.github.com/users/rmeissner/repos",
      "events_url": "https://api.github.com/users/rmeissner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rmeissner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-28T14:25:26Z",
    "updated_at": "2020-07-28T14:25:26Z",
    "author_association": "NONE",
    "body": "While #2296 is nice it requires that the \"Proxy\" code is agreed on, right? (e.g. https://eips.ethereum.org/EIPS/eip-1167)\r\n\r\nJust as a reference how it looks like currently if you want to do this in solidity at runtime: https://gist.github.com/cag/41c68a6402fc7c80b03f72cbf42f27f6#file-erc1155toerc20adapter-sol-L113\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/665072238/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
