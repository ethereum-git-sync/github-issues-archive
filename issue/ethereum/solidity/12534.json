{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12534",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12534/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12534/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12534/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12534",
  "id": 1103092306,
  "node_id": "I_kwDOAm_5kc5Bv9pS",
  "number": 12534,
  "title": "Migrating project from solidity 0.6.6 to 0.8.6 raises Stack too deep when compiling inline assembly",
  "user": {
    "login": "dsapaev",
    "id": 2101364,
    "node_id": "MDQ6VXNlcjIxMDEzNjQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2101364?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dsapaev",
    "html_url": "https://github.com/dsapaev",
    "followers_url": "https://api.github.com/users/dsapaev/followers",
    "following_url": "https://api.github.com/users/dsapaev/following{/other_user}",
    "gists_url": "https://api.github.com/users/dsapaev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dsapaev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dsapaev/subscriptions",
    "organizations_url": "https://api.github.com/users/dsapaev/orgs",
    "repos_url": "https://api.github.com/users/dsapaev/repos",
    "events_url": "https://api.github.com/users/dsapaev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dsapaev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-01-14T06:19:08Z",
  "updated_at": "2022-01-14T12:29:40Z",
  "closed_at": "2022-01-14T12:29:40Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi everybody!\r\nWe have a contract, that works fine with Solidity 0.6.6. I try to migrate our contract to 0.8.6, but compiler raises Stack too deep, when i using structs. Here the small example:\r\n```\r\npragma solidity ^0.8.6;\r\ninterface ICompileError {\r\n\r\n    struct A{\r\n        bool arg1;\r\n        InnerA arg2;\r\n    }\r\n\r\n    struct InnerA{\r\n        address[] arg1;\r\n        bool arg2;\r\n    }\r\n\r\n    struct B{\r\n        uint arg1;\r\n        InnerB[] arg2;\r\n    }\r\n\r\n    struct InnerB{\r\n        uint[] arg1;\r\n        bool arg2;\r\n    }\r\n\r\n    function stackToDeep(A calldata arg1, B calldata arg2) external returns(B memory, address[][] memory);\r\n}\r\n```\r\n\r\nAnd implementation:\r\n```\r\npragma solidity ^0.8.6;\r\nimport \"./ICompileError.sol\";\r\n\r\ncontract CompileError is ICompileError{\r\n    function stackToDeep(A memory arg1, B memory arg2) public override returns(B memory, address[][] memory result){\r\n        (arg2, result) = ICompileError(address(0x0)).stackToDeep(arg1, arg2);\r\n        return (arg2, result);\r\n    }\r\n}\r\n```\r\n\r\nWhat can i do to fix it? I can not turn off optimization, because our contract is very large ",
  "closed_by": {
    "login": "ekpyron",
    "id": 1347491,
    "node_id": "MDQ6VXNlcjEzNDc0OTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ekpyron",
    "html_url": "https://github.com/ekpyron",
    "followers_url": "https://api.github.com/users/ekpyron/followers",
    "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
    "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
    "organizations_url": "https://api.github.com/users/ekpyron/orgs",
    "repos_url": "https://api.github.com/users/ekpyron/repos",
    "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ekpyron/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12534/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12534/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1013051162",
    "html_url": "https://github.com/ethereum/solidity/issues/12534#issuecomment-1013051162",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12534",
    "id": 1013051162,
    "node_id": "IC_kwDOAm_5kc48Ye8a",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-14T11:47:47Z",
    "updated_at": "2022-01-14T11:50:09Z",
    "author_association": "MEMBER",
    "body": "This is a ``stack too deep`` error in the ABI decoding functions. It's a known issue and not easy to circumvent.\r\nWe are working on improving the situation in the new code generation pipeline via Yul.\r\n\r\nWith the most recent compiler version 0.8.11, your example compiles for me without error using ``--experimental-via-ir --optimize``. Is that an option for you? Code generation via Yul IR can be considered stable at this point, we will stop calling it \"experimental\" in one of the upcoming releases. (It would probably be wise to double-check if any of the slight behaviour changes listed in https://docs.soliditylang.org/en/latest/ir-breaking-changes.html affect you, though).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1013051162/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1013063300",
    "html_url": "https://github.com/ethereum/solidity/issues/12534#issuecomment-1013063300",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12534",
    "id": 1013063300,
    "node_id": "IC_kwDOAm_5kc48Yh6E",
    "user": {
      "login": "dsapaev",
      "id": 2101364,
      "node_id": "MDQ6VXNlcjIxMDEzNjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2101364?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dsapaev",
      "html_url": "https://github.com/dsapaev",
      "followers_url": "https://api.github.com/users/dsapaev/followers",
      "following_url": "https://api.github.com/users/dsapaev/following{/other_user}",
      "gists_url": "https://api.github.com/users/dsapaev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dsapaev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dsapaev/subscriptions",
      "organizations_url": "https://api.github.com/users/dsapaev/orgs",
      "repos_url": "https://api.github.com/users/dsapaev/repos",
      "events_url": "https://api.github.com/users/dsapaev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dsapaev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-14T12:06:48Z",
    "updated_at": "2022-01-14T12:06:48Z",
    "author_association": "NONE",
    "body": "Thanks, we decided to refactor our contract and use old optimizer while YUL is experimental",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1013063300/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1013077709",
    "html_url": "https://github.com/ethereum/solidity/issues/12534#issuecomment-1013077709",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12534",
    "id": 1013077709,
    "node_id": "IC_kwDOAm_5kc48YlbN",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-14T12:29:35Z",
    "updated_at": "2022-01-14T12:29:35Z",
    "author_association": "MEMBER",
    "body": "Ok, I'll close this issue then, feel free to reopen if you need anything else.\r\nAs for compilation via Yul: you can expect it to be officially marked stable in Q1 2022 - my current guess would be 0.8.13.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1013077709/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
