{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/13494",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/13494/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/13494/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/13494/events",
  "html_url": "https://github.com/ethereum/solidity/issues/13494",
  "id": 1364348993,
  "node_id": "I_kwDOAm_5kc5RUlBB",
  "number": 13494,
  "title": "Assembly clearing local variable",
  "user": {
    "login": "wighawag",
    "id": 790580,
    "node_id": "MDQ6VXNlcjc5MDU4MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/790580?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wighawag",
    "html_url": "https://github.com/wighawag",
    "followers_url": "https://api.github.com/users/wighawag/followers",
    "following_url": "https://api.github.com/users/wighawag/following{/other_user}",
    "gists_url": "https://api.github.com/users/wighawag/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wighawag/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wighawag/subscriptions",
    "organizations_url": "https://api.github.com/users/wighawag/orgs",
    "repos_url": "https://api.github.com/users/wighawag/repos",
    "events_url": "https://api.github.com/users/wighawag/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wighawag/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4438781793,
      "node_id": "LA_kwDOAm_5kc8AAAABCJJvYQ",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/research",
      "name": "research",
      "color": "CBDDCE",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 12,
  "created_at": "2022-09-07T09:12:51Z",
  "updated_at": "2022-09-19T11:34:44Z",
  "closed_at": "2022-09-19T11:34:43Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nIt seems in some conditions, assembly code is messing up with local variable even when it should not\r\n\r\nWhat is even weirder, is that adding some extra code remove the issue.\r\n\r\nReproduction repo here :\r\nhttps://github.com/bug-reproduction/solidity-assembly-variable-reset\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.8.16 (tested also on 0.8.13)\r\n- Target EVM version (as per compiler settings): default settings with optimizer (runs: 2000)\r\n- Framework/IDE (e.g. Truffle or Remix): hardhat\r\n- EVM execution environment / backend / blockchain client: geth \r\n- Operating system: linux\r\n\r\n## Steps to Reproduce\r\n\r\n```solidity\r\n// SPDX-License-Identifier: AGPL-1.0\r\npragma solidity 0.8.16;\r\n\r\ncontract Test {\r\n\tevent Debug(address deployedContract);\r\n\r\n\tfunction deployData(bytes calldata) external {\r\n\t\taddress newContract;\r\n\t\tassembly {\r\n\t\t\tlet len := calldataload(36)\r\n\t\t\tlet p := mload(0x40)\r\n\t\t\tmstore(p, 0x61FFFF600E60003961FFFF6000F3000000000000000000000000000000000000)\r\n\t\t\tlet lenByte1 := shr(8, len)\r\n\t\t\tlet lenByte2 := and(len, 0xFF)\r\n\t\t\tmstore8(add(p, 1), lenByte1)\r\n\t\t\tmstore8(add(p, 2), lenByte2)\r\n\t\t\tmstore8(add(p, 9), lenByte1)\r\n\t\t\tmstore8(add(p, 10), lenByte2)\r\n\t\t\tcalldatacopy(add(p, 14), 68, len)\r\n\r\n\t\t\tnewContract := create(0, p, add(len, 14))\r\n\t\t\t// log1(p, add(len, 14), newContract) // need this line, no idea why, looks like some memory management issues\r\n\t\t}\r\n\t\temit Debug(newContract);\r\n\t}\r\n\r\n\tfunction deployDataWithLog1(bytes calldata) external {\r\n\t\taddress newContract;\r\n\t\tassembly {\r\n\t\t\tlet len := calldataload(36)\r\n\t\t\tlet p := mload(0x40)\r\n\t\t\tmstore(p, 0x61FFFF600E60003961FFFF6000F3000000000000000000000000000000000000)\r\n\t\t\tlet lenByte1 := shr(8, len)\r\n\t\t\tlet lenByte2 := and(len, 0xFF)\r\n\t\t\tmstore8(add(p, 1), lenByte1)\r\n\t\t\tmstore8(add(p, 2), lenByte2)\r\n\t\t\tmstore8(add(p, 9), lenByte1)\r\n\t\t\tmstore8(add(p, 10), lenByte2)\r\n\t\t\tcalldatacopy(add(p, 14), 68, len)\r\n\r\n\t\t\tnewContract := create(0, p, add(len, 14))\r\n\t\t\tlog1(p, add(len, 14), newContract) // need this line, no idea why, looks like some memory management issues\r\n\t\t}\r\n\t\temit Debug(newContract);\r\n\t}\r\n\r\n\tfunction deployData2(bytes calldata data) external {\r\n\t\tbytes memory deployCode = bytes.concat(hex\"61FFFF600E60003961FFFF6000F3\", data);\r\n\t\tbytes1 lenByte1 = bytes1(uint8(data.length >> 8));\r\n\t\tbytes1 lenByte2 = bytes1(uint8(data.length & 0xFF));\r\n\t\tdeployCode[1] = lenByte1;\r\n\t\tdeployCode[9] = lenByte1;\r\n\t\tdeployCode[2] = lenByte2;\r\n\t\tdeployCode[10] = lenByte2;\r\n\r\n\t\taddress newContract;\r\n\t\tassembly {\r\n\t\t\tnewContract := create(0, add(deployCode, 32), mload(deployCode))\r\n\t\t\t// log1(add(deployCode, 32), mload(deployCode), newContract) // need this line, no idea why, looks like some memory management issues\r\n\t\t}\r\n\t\temit Debug(newContract);\r\n\t}\r\n\r\n\tfunction deployData2WithLog1(bytes calldata data) external {\r\n\t\tbytes memory deployCode = bytes.concat(hex\"61FFFF600E60003961FFFF6000F3\", data);\r\n\t\tbytes1 lenByte1 = bytes1(uint8(data.length >> 8));\r\n\t\tbytes1 lenByte2 = bytes1(uint8(data.length & 0xFF));\r\n\t\tdeployCode[1] = lenByte1;\r\n\t\tdeployCode[9] = lenByte1;\r\n\t\tdeployCode[2] = lenByte2;\r\n\t\tdeployCode[10] = lenByte2;\r\n\r\n\t\taddress newContract;\r\n\t\tassembly {\r\n\t\t\tnewContract := create(0, add(deployCode, 32), mload(deployCode))\r\n\t\t\tlog1(add(deployCode, 32), mload(deployCode), newContract) // need this line, no idea why, looks like some memory management issues\r\n\t\t}\r\n\t\temit Debug(newContract);\r\n\t}\r\n}\r\n```\r\n\r\nThe issue only arise when the input `data` is big enough, tested with 24000 bytes\r\n\r\nsee repo for  reproducing the bug : https://github.com/bug-reproduction/solidity-assembly-variable-reset\r\n",
  "closed_by": {
    "login": "r0qs",
    "id": 457348,
    "node_id": "MDQ6VXNlcjQ1NzM0OA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/457348?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/r0qs",
    "html_url": "https://github.com/r0qs",
    "followers_url": "https://api.github.com/users/r0qs/followers",
    "following_url": "https://api.github.com/users/r0qs/following{/other_user}",
    "gists_url": "https://api.github.com/users/r0qs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/r0qs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/r0qs/subscriptions",
    "organizations_url": "https://api.github.com/users/r0qs/orgs",
    "repos_url": "https://api.github.com/users/r0qs/repos",
    "events_url": "https://api.github.com/users/r0qs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/r0qs/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/13494/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/13494/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239286201",
    "html_url": "https://github.com/ethereum/solidity/issues/13494#issuecomment-1239286201",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13494",
    "id": 1239286201,
    "node_id": "IC_kwDOAm_5kc5J3gG5",
    "user": {
      "login": "hrkrshnn",
      "id": 13174375,
      "node_id": "MDQ6VXNlcjEzMTc0Mzc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13174375?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hrkrshnn",
      "html_url": "https://github.com/hrkrshnn",
      "followers_url": "https://api.github.com/users/hrkrshnn/followers",
      "following_url": "https://api.github.com/users/hrkrshnn/following{/other_user}",
      "gists_url": "https://api.github.com/users/hrkrshnn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hrkrshnn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hrkrshnn/subscriptions",
      "organizations_url": "https://api.github.com/users/hrkrshnn/orgs",
      "repos_url": "https://api.github.com/users/hrkrshnn/repos",
      "events_url": "https://api.github.com/users/hrkrshnn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hrkrshnn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-07T11:48:36Z",
    "updated_at": "2022-09-07T11:48:36Z",
    "author_association": "MEMBER",
    "body": "> It seems in some conditions, assembly code is messing up with local variable even when it should not\n\nWhat do you mean by this? @wighawag ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239286201/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239342927",
    "html_url": "https://github.com/ethereum/solidity/issues/13494#issuecomment-1239342927",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13494",
    "id": 1239342927,
    "node_id": "IC_kwDOAm_5kc5J3t9P",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-07T12:45:24Z",
    "updated_at": "2022-09-07T12:45:24Z",
    "author_association": "MEMBER",
    "body": "Hm... first I thought, I can't reproduce it, but the following ``isoltest`` test actually fails in an unoptimized via-IR run on the second event emission...\r\n\r\n```\r\npragma solidity ^0.8.0;\r\n\r\ncontract Test {\r\n\tevent Debug(address deployedContract);\r\n\r\n\tfunction deployData(bytes calldata) external {\r\n\t\taddress newContract;\r\n\t\tassembly {\r\n\t\t\tlet len := calldataload(36)\r\n\t\t\tlet p := mload(0x40)\r\n\t\t\tmstore(p, 0x61FFFF600E60003961FFFF6000F3000000000000000000000000000000000000)\r\n\t\t\tlet lenByte1 := shr(8, len)\r\n\t\t\tlet lenByte2 := and(len, 0xFF)\r\n\t\t\tmstore8(add(p, 1), lenByte1)\r\n\t\t\tmstore8(add(p, 2), lenByte2)\r\n\t\t\tmstore8(add(p, 9), lenByte1)\r\n\t\t\tmstore8(add(p, 10), lenByte2)\r\n\t\t\tcalldatacopy(add(p, 14), 68, len)\r\n\r\n\t\t\tnewContract := create(0, p, add(len, 14))\r\n\t\t\t// log1(p, add(len, 14), newContract) // need this line, no idea why, looks like some memory management issues\r\n\t\t}\r\n\t\temit Debug(newContract);\r\n\t}\r\n\r\n\tfunction deployData2(bytes calldata data) external {\r\n\t\tbytes memory deployCode = bytes.concat(hex\"61FFFF600E60003961FFFF6000F3\", data);\r\n\t\tbytes1 lenByte1 = bytes1(uint8(data.length >> 8));\r\n\t\tbytes1 lenByte2 = bytes1(uint8(data.length & 0xFF));\r\n\t\tdeployCode[1] = lenByte1;\r\n\t\tdeployCode[9] = lenByte1;\r\n\t\tdeployCode[2] = lenByte2;\r\n\t\tdeployCode[10] = lenByte2;\r\n\r\n\t\taddress newContract;\r\n\t\tassembly {\r\n\t\t\tnewContract := create(0, add(deployCode, 32), mload(deployCode))\r\n\t\t\t// log1(add(deployCode, 32), mload(deployCode), newContract) // need this line, no idea why, looks like some memory management issues\r\n\t\t}\r\n\t\temit Debug(newContract);\r\n\t}\r\n\tfunction test() external {\r\n        bytes memory x = new bytes(1024*32);\r\n        x[0] = 0x23;\r\n        for (uint i = 1; i < x.length; ++i) {\r\n            x[i] = bytes1(uint8((uint(uint8(x[i-1])) * 17) % 7));\r\n        }\r\n        this.deployData(x);\r\n        this.deployData2(x);\r\n    }\r\n}\r\n// ----\r\n// test() ->\r\n// ~ emit Debug(address): 0xf01f7809444bd9a93a854361c6fae3f23d9e23db\r\n// ~ emit Debug(address): 0x7963f166e7cf4cb8af121bbabfefb078e9e5ddb8\r\n// gas irOptimized: 26055073\r\n// gas legacy: 44269004\r\n// gas legacyOptimized: 22321659\r\n```\r\n\r\ni.e. the second event emission emits a zero address in the unoptimized via-IR run.\r\n\r\nInterestingly, though, the same happens when exchanging ``this.deployData`` with ``this.deployData2``, i.e. it's still the second emission affected only...\r\n\r\nThe legacy runs and optimized runs also seem fine... and the IR code looks rather innocent at least at a quick glance, though, so I'm expecting this to be some kind of false positive but it's suspicious that something similar seems to happen in our testing framework and with hardhat, so there's definitely cause to investigate this...\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239342927/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239380265",
    "html_url": "https://github.com/ethereum/solidity/issues/13494#issuecomment-1239380265",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13494",
    "id": 1239380265,
    "node_id": "IC_kwDOAm_5kc5J33Ep",
    "user": {
      "login": "wighawag",
      "id": 790580,
      "node_id": "MDQ6VXNlcjc5MDU4MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/790580?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wighawag",
      "html_url": "https://github.com/wighawag",
      "followers_url": "https://api.github.com/users/wighawag/followers",
      "following_url": "https://api.github.com/users/wighawag/following{/other_user}",
      "gists_url": "https://api.github.com/users/wighawag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wighawag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wighawag/subscriptions",
      "organizations_url": "https://api.github.com/users/wighawag/orgs",
      "repos_url": "https://api.github.com/users/wighawag/repos",
      "events_url": "https://api.github.com/users/wighawag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wighawag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-07T13:19:17Z",
    "updated_at": "2022-09-07T13:19:38Z",
    "author_association": "NONE",
    "body": "@hrkrshnn \r\n> What do you mean by this? @wighawag\r\n\r\n`address newContract;` should be non-zero after `newContract := create(0, p, add(len, 14))`\r\nbut it is zero when calling `emit Debug(newContract);`\r\n\r\nif you uncomment the `log1` line it becomes correct\r\n\r\nso not sure of the issue is that newContract got affected or as @ekpyron mention something else is happening, but there something going wrong here.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239380265/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239511515",
    "html_url": "https://github.com/ethereum/solidity/issues/13494#issuecomment-1239511515",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13494",
    "id": 1239511515,
    "node_id": "IC_kwDOAm_5kc5J4XHb",
    "user": {
      "login": "r0qs",
      "id": 457348,
      "node_id": "MDQ6VXNlcjQ1NzM0OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/457348?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/r0qs",
      "html_url": "https://github.com/r0qs",
      "followers_url": "https://api.github.com/users/r0qs/followers",
      "following_url": "https://api.github.com/users/r0qs/following{/other_user}",
      "gists_url": "https://api.github.com/users/r0qs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/r0qs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/r0qs/subscriptions",
      "organizations_url": "https://api.github.com/users/r0qs/orgs",
      "repos_url": "https://api.github.com/users/r0qs/repos",
      "events_url": "https://api.github.com/users/r0qs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/r0qs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-07T15:03:37Z",
    "updated_at": "2022-09-07T15:03:37Z",
    "author_association": "MEMBER",
    "body": "Hi @wighawag, the test fails with `out-of-gas` when running the repo that you mentioned in the issue. It is a bit strange that the `log1` would prevent that.\r\n\r\nRunning your code on foundry though seems to work fine, with or without the `log1`:\r\n```\r\nRunning 1 test for test/Test.sol:Test\r\n[PASS] test() (gas: 9273752)\r\nTraces:\r\n  [9273752] Test::test() \r\n    ├─ [4757006] Test::deployData(0x615870600e6000396158706000f3504852706447786c50...\r\n    │   ├─ emit Debug(deployedContract: 0xce71065d4017f316ec606fe4422e11eb2c47c246)\r\n    ├─ [4575427] Test::deployData2(0x615870600e6000396158706000f3504852706447786c50...\r\n    │   ├─ emit Debug(deployedContract: 0x185a4dc360ce69bdccee33b3784b0282f7961aea)\r\n```\r\nI also tested using the [example](https://github.com/bug-reproduction/solidity-assembly-variable-reset/blob/main/test/data/index.ts#L1) payload that you are using in your tests. Could you please provide some more information about the bug?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239511515/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239518237",
    "html_url": "https://github.com/ethereum/solidity/issues/13494#issuecomment-1239518237",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13494",
    "id": 1239518237,
    "node_id": "IC_kwDOAm_5kc5J4Ywd",
    "user": {
      "login": "wighawag",
      "id": 790580,
      "node_id": "MDQ6VXNlcjc5MDU4MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/790580?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wighawag",
      "html_url": "https://github.com/wighawag",
      "followers_url": "https://api.github.com/users/wighawag/followers",
      "following_url": "https://api.github.com/users/wighawag/following{/other_user}",
      "gists_url": "https://api.github.com/users/wighawag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wighawag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wighawag/subscriptions",
      "organizations_url": "https://api.github.com/users/wighawag/orgs",
      "repos_url": "https://api.github.com/users/wighawag/repos",
      "events_url": "https://api.github.com/users/wighawag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wighawag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-07T15:09:01Z",
    "updated_at": "2022-09-07T15:10:20Z",
    "author_association": "NONE",
    "body": "@r0qs are you using the geth node provided  in the repo via docker-compose ?\r\n\r\nthe run out of gas issue happen on hardhat, running against geth expose the issue and where if you uncomment the log1 it passes",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239518237/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239528940",
    "html_url": "https://github.com/ethereum/solidity/issues/13494#issuecomment-1239528940",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13494",
    "id": 1239528940,
    "node_id": "IC_kwDOAm_5kc5J4bXs",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-07T15:17:48Z",
    "updated_at": "2022-09-07T15:17:48Z",
    "author_association": "MEMBER",
    "body": "FYI the second creation failing with out-of-gas, resulting in ``create`` returning zero, fully explains what I saw in https://github.com/ethereum/solidity/issues/13494#issuecomment-1239342927 - but I hadn't looked into the logging part and let @r0qs take over the investigation for now. But yeah, sounds weird that adding the logging should prevent out-of-gas somehow...",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239528940/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239556747",
    "html_url": "https://github.com/ethereum/solidity/issues/13494#issuecomment-1239556747",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13494",
    "id": 1239556747,
    "node_id": "IC_kwDOAm_5kc5J4iKL",
    "user": {
      "login": "wighawag",
      "id": 790580,
      "node_id": "MDQ6VXNlcjc5MDU4MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/790580?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wighawag",
      "html_url": "https://github.com/wighawag",
      "followers_url": "https://api.github.com/users/wighawag/followers",
      "following_url": "https://api.github.com/users/wighawag/following{/other_user}",
      "gists_url": "https://api.github.com/users/wighawag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wighawag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wighawag/subscriptions",
      "organizations_url": "https://api.github.com/users/wighawag/orgs",
      "repos_url": "https://api.github.com/users/wighawag/repos",
      "events_url": "https://api.github.com/users/wighawag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wighawag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-07T15:37:45Z",
    "updated_at": "2022-09-07T15:37:45Z",
    "author_association": "NONE",
    "body": "@r0qs you might have forgotten that step if you used geth : `pnpm execute localhost scripts/fundingFromCoinbase.ts`\r\n\r\nI know this sounds crazy and you made me tripple check what I saw, but it really is happening, see CI action : https://github.com/bug-reproduction/solidity-assembly-variable-reset/runs/8231871860?check_suite_focus=true\r\n\r\nI add the example with the extra log1 and it passes",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239556747/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239588058",
    "html_url": "https://github.com/ethereum/solidity/issues/13494#issuecomment-1239588058",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13494",
    "id": 1239588058,
    "node_id": "IC_kwDOAm_5kc5J4pza",
    "user": {
      "login": "r0qs",
      "id": 457348,
      "node_id": "MDQ6VXNlcjQ1NzM0OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/457348?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/r0qs",
      "html_url": "https://github.com/r0qs",
      "followers_url": "https://api.github.com/users/r0qs/followers",
      "following_url": "https://api.github.com/users/r0qs/following{/other_user}",
      "gists_url": "https://api.github.com/users/r0qs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/r0qs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/r0qs/subscriptions",
      "organizations_url": "https://api.github.com/users/r0qs/orgs",
      "repos_url": "https://api.github.com/users/r0qs/repos",
      "events_url": "https://api.github.com/users/r0qs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/r0qs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-07T16:00:58Z",
    "updated_at": "2022-09-07T17:42:56Z",
    "author_association": "MEMBER",
    "body": "@ekpyron compiling the code with solc and `--via-ir` gives segmentation fault in `solidity::yul::Parser::parseSrcComment`\r\n```\r\n#80515 0x0000555555c546ee in bool std::__detail::__regex_algo_impl<char const*, std::allocator<std::__cxx11::sub_match<char const*> >, char, std::__cxx11::regex_traits<char> >(char const*, char const*, std::__cxx11::match_results<char const*, std::allocator<std::__cxx11::sub_match<char const*> > >&, std::__cxx11::basic_regex<char, std::__cxx11::regex_traits<char> > const&, std::regex_constants::match_flag_type, std::__detail::_RegexExecutorPolicy, bool) ()\r\n#80516 0x0000555555c4c3f4 in solidity::yul::Parser::parseSrcComment(std::basic_string_view<char, std::char_traits<char> >, solidity::langutil::SourceLocation const&) ()\r\n#80517 0x0000555555c4d63a in solidity::yul::Parser::fetchDebugDataFromComment() ()\r\n#80518 0x0000555555c4d91c in solidity::yul::Parser::advance() ()\r\n#80519 0x0000555555c50e09 in solidity::yul::Parser::parseBlock() ()\r\n#80520 0x0000555555c516e8 in solidity::yul::Parser::parseFunctionDefinition() ()\r\n#80521 0x0000555555c4ff88 in solidity::yul::Parser::parseStatement() ()\r\n#80522 0x0000555555c50e66 in solidity::yul::Parser::parseBlock() ()\r\n#80523 0x0000555555c51a83 in solidity::yul::Parser::parseInline(std::shared_ptr<solidity::langutil::Scanner> const&) ()\r\n#80524 0x0000555555c6e801 in solidity::yul::ObjectParser::parseBlock(std::optional<std::map<unsigned int, std::shared_ptr<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const>, std::less<unsigned int>, std::allocator<std::pair<unsigned int const, std::shared_ptr<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const> > > > >) ()\r\n#80525 0x0000555555c6ecaf in solidity::yul::ObjectParser::parseCode(std::optional<std::map<unsigned int, std::shared_ptr<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const>, std::less<unsigned int>, std::allocator<std::pair<unsigned int const, std::shared_ptr<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const> > > > >) ()\r\n#80526 0x0000555555c715e1 in solidity::yul::ObjectParser::parseObject(solidity::yul::Object*) ()\r\n#80527 0x0000555555c71985 in solidity::yul::ObjectParser::parseObject(solidity::yul::Object*) ()\r\n#80528 0x0000555555c71ba9 in solidity::yul::ObjectParser::parse(std::shared_ptr<solidity::langutil::Scanner> const&, bool) ()\r\n#80529 0x0000555555c5ec20 in solidity::yul::YulStack::parseAndAnalyze(std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&, std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > const&) ()\r\n#80530 0x0000555555aa0e24 in solidity::frontend::IRGenerator::run[abi:cxx11](solidity::frontend::ContractDefinition const&, std::vector<unsigned char, std::allocator<unsigned char> > const&, std::map<solidity::frontend::ContractDefinition const*, std::basic_string_view<char, std::char_traits<char> > const, std::less<solidity::frontend::ContractDefinition const*>, std::allocator<std::pair<solidity::frontend::ContractDefinition const* const, std::basic_string_view<char, std::char_traits<char> > const> > > const&) ()\r\n#80531 0x00005555558048d1 in solidity::frontend::CompilerStack::generateIR(solidity::frontend::ContractDefinition const&) ()\r\n#80532 0x000055555580929b in solidity::frontend::CompilerStack::compile(solidity::frontend::CompilerStack::State) ()\r\n#80533 0x0000555555735c26 in solidity::frontend::CommandLineInterface::compile() ()\r\n#80534 0x000055555573b015 in solidity::frontend::CommandLineInterface::processInput() ()\r\n#80535 0x000055555573b40c in solidity::frontend::CommandLineInterface::run(int, char const* const*) ()\r\n#80536 0x0000555555706e6c in main ()\r\n```\r\n\r\nMaybe something related with this regex and comments inside an assembly block: https://github.com/ethereum/solidity/blob/develop/libyul/AsmParser.cpp#L194\r\n\r\nsolc version: `Version: 0.8.17-develop.2022.9.5+commit.51929652.Linux.g++`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239588058/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239600579",
    "html_url": "https://github.com/ethereum/solidity/issues/13494#issuecomment-1239600579",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13494",
    "id": 1239600579,
    "node_id": "IC_kwDOAm_5kc5J4s3D",
    "user": {
      "login": "r0qs",
      "id": 457348,
      "node_id": "MDQ6VXNlcjQ1NzM0OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/457348?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/r0qs",
      "html_url": "https://github.com/r0qs",
      "followers_url": "https://api.github.com/users/r0qs/followers",
      "following_url": "https://api.github.com/users/r0qs/following{/other_user}",
      "gists_url": "https://api.github.com/users/r0qs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/r0qs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/r0qs/subscriptions",
      "organizations_url": "https://api.github.com/users/r0qs/orgs",
      "repos_url": "https://api.github.com/users/r0qs/repos",
      "events_url": "https://api.github.com/users/r0qs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/r0qs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-07T16:11:19Z",
    "updated_at": "2022-09-07T16:58:03Z",
    "author_association": "MEMBER",
    "body": "\r\n\r\n> @r0qs you might have forgotten that step if you used geth : `pnpm execute localhost scripts/fundingFromCoinbase.ts`\r\n> \r\n> I know this sounds crazy and you made me tripple check what I saw, but it really is happening, see CI action : https://github.com/bug-reproduction/solidity-assembly-variable-reset/runs/8231871860?check_suite_focus=true\r\n> \r\n> I add the example with the extra log1 and it passes\r\n\r\nI didn't use the docker-compose. I'll take a look at it as well, thanks. I was trying to first investigate the contract.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1239600579/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1241787832",
    "html_url": "https://github.com/ethereum/solidity/issues/13494#issuecomment-1241787832",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13494",
    "id": 1241787832,
    "node_id": "IC_kwDOAm_5kc5KBC24",
    "user": {
      "login": "wighawag",
      "id": 790580,
      "node_id": "MDQ6VXNlcjc5MDU4MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/790580?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wighawag",
      "html_url": "https://github.com/wighawag",
      "followers_url": "https://api.github.com/users/wighawag/followers",
      "following_url": "https://api.github.com/users/wighawag/following{/other_user}",
      "gists_url": "https://api.github.com/users/wighawag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wighawag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wighawag/subscriptions",
      "organizations_url": "https://api.github.com/users/wighawag/orgs",
      "repos_url": "https://api.github.com/users/wighawag/repos",
      "events_url": "https://api.github.com/users/wighawag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wighawag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-09T10:20:39Z",
    "updated_at": "2022-09-09T10:20:39Z",
    "author_association": "NONE",
    "body": "I updated the repo (https://github.com/bug-reproduction/solidity-assembly-variable-reset) to have hardhat test works too (works in the sense that the weird behavior is also shown)\r\n\r\n```\r\npnpm i\r\npnpm hardhat test\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1241787832/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1249382882",
    "html_url": "https://github.com/ethereum/solidity/issues/13494#issuecomment-1249382882",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13494",
    "id": 1249382882,
    "node_id": "IC_kwDOAm_5kc5KeBHi",
    "user": {
      "login": "wighawag",
      "id": 790580,
      "node_id": "MDQ6VXNlcjc5MDU4MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/790580?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wighawag",
      "html_url": "https://github.com/wighawag",
      "followers_url": "https://api.github.com/users/wighawag/followers",
      "following_url": "https://api.github.com/users/wighawag/following{/other_user}",
      "gists_url": "https://api.github.com/users/wighawag/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wighawag/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wighawag/subscriptions",
      "organizations_url": "https://api.github.com/users/wighawag/orgs",
      "repos_url": "https://api.github.com/users/wighawag/repos",
      "events_url": "https://api.github.com/users/wighawag/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wighawag/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-16T13:43:18Z",
    "updated_at": "2022-09-16T13:43:18Z",
    "author_association": "NONE",
    "body": "I updated the test and now specify specific gas limit and it passes\r\n\r\nProbably the estimate_gas do not calculate enough for some reason. and when the log1 is added the estimate is correct for some reason\r\n\r\nShould have thought about that, I guess we can close the issue unless you want to keep for the segmentation fault you find\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1249382882/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1250901344",
    "html_url": "https://github.com/ethereum/solidity/issues/13494#issuecomment-1250901344",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13494",
    "id": 1250901344,
    "node_id": "IC_kwDOAm_5kc5Kjz1g",
    "user": {
      "login": "r0qs",
      "id": 457348,
      "node_id": "MDQ6VXNlcjQ1NzM0OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/457348?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/r0qs",
      "html_url": "https://github.com/r0qs",
      "followers_url": "https://api.github.com/users/r0qs/followers",
      "following_url": "https://api.github.com/users/r0qs/following{/other_user}",
      "gists_url": "https://api.github.com/users/r0qs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/r0qs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/r0qs/subscriptions",
      "organizations_url": "https://api.github.com/users/r0qs/orgs",
      "repos_url": "https://api.github.com/users/r0qs/repos",
      "events_url": "https://api.github.com/users/r0qs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/r0qs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-19T11:34:43Z",
    "updated_at": "2022-09-19T11:34:43Z",
    "author_association": "MEMBER",
    "body": "Hi @wighawag thank you very much for confirming the gas issue.\r\n\r\nI will be closing the issue for now since your problem was solved, and it is unlikely that the compiler caused it. Still, I will further investigate your suspicion of the miscalculation of the gas estimation and the use of log1.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1250901344/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
