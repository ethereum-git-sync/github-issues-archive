{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/1740",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/1740/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/1740/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/1740/events",
  "html_url": "https://github.com/ethereum/solidity/issues/1740",
  "id": 211951618,
  "node_id": "MDU6SXNzdWUyMTE5NTE2MTg=",
  "number": 1740,
  "title": "[WARNING] EVM does not handle deploying contracts which call a library in their constructor, it can lead to value loss on deployment!!",
  "user": {
    "login": "Bunjin",
    "id": 11554098,
    "node_id": "MDQ6VXNlcjExNTU0MDk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/11554098?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Bunjin",
    "html_url": "https://github.com/Bunjin",
    "followers_url": "https://api.github.com/users/Bunjin/followers",
    "following_url": "https://api.github.com/users/Bunjin/following{/other_user}",
    "gists_url": "https://api.github.com/users/Bunjin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Bunjin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Bunjin/subscriptions",
    "organizations_url": "https://api.github.com/users/Bunjin/orgs",
    "repos_url": "https://api.github.com/users/Bunjin/repos",
    "events_url": "https://api.github.com/users/Bunjin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Bunjin/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 455256446,
      "node_id": "MDU6TGFiZWw0NTUyNTY0NDY=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/waiting%20for%20more%20input",
      "name": "waiting for more input",
      "color": "fef2c0",
      "default": false,
      "description": "Issues waiting for more input by the reporter"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2017-03-05T13:10:16Z",
  "updated_at": "2017-07-03T11:36:25Z",
  "closed_at": "2017-07-03T11:36:25Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**The following problem is quite serious because it is not caught by testrpc, will allow you to deploy a contract with potentially value on it, the tx will not throw, but the data deployed will be corrupted**\r\n\r\nTake the following simple example:\r\n\r\n````\r\npragma solidity ^0.4.8;\r\n\r\nlibrary Lib {\r\n  \r\n  function foo(){\r\n    uint a = 1;\r\n  }\r\n\r\n}\r\n````\r\n\r\n````\r\npragma solidity ^0.4.8;\r\n\r\nimport \"./Lib.sol\";\r\n\r\ncontract Contract {\r\n\r\n  function(){\r\n\r\n  }\r\n\r\n  function Contract()\r\n  {\t\r\n    Lib.foo();\r\n  }\r\n\r\n}\r\n````\r\nGives me the following binary code \r\n(before linking)\r\n`0x6060604052346000575b73__Lib___________________________________63c29855786040518163ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180905060006040518083038186803b1560005760325a03f4156000575050505b5b603d80607f6000396000f30060606040525b34600057600f5b5b565b0000a165627a7a7230582024d73e63c95973053e854463fe1dc26432f496eff7b8b18bca5ef8f5422042bb0029`\r\n(after linking with lib at 0x19bf3ef7305e0674c844960cd9091f4e27eda21b)\r\n`0x6060604052346000575b7319bf3ef7305e0674c844960cd9091f4e27eda21b63c29855786040518163ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180905060006040518083038186803b1560005760325a03f4156000575050505b5b603d80607f6000396000f30060606040525b34600057600f5b5b565b0000a165627a7a7230582024d73e63c95973053e854463fe1dc26432f496eff7b8b18bca5ef8f5422042bb0029`\r\n\r\nYet when trying to create this contract (with truffle deployer also I get the same behavior), it does not deploy the full byte code:\r\n```\r\n> web3.eth.sendTransaction({from:web3.eth.accounts[0], to:null, gas:4000000, data: \"0x6060604052346000575b7319bf3ef7305e0674c844960cd9091f4e27eda21b63c29855786040518163ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180905060006040518083038186803b1560005760325a03f4156000575050505b5b603d80607f6000396000f30060606040525b34600057600f5b5b565b0000a165627a7a7230582024d73e63c95973053e854463fe1dc26432f496eff7b8b18bca5ef8f5422042bb0029\"})\r\n\"0xce9da3a5b40ab67e216759b0599c717e96e76070f0222f10e5b03f94e210b683\"\r\n\r\n> web3.eth.getTransaction(\"0xce9da3a5b40ab67e216759b0599c717e96e76070f0222f10e5b03f94e210b683\")\r\n\r\n{\r\n  blockHash: \"0x88516101482214cf6dfc32939d97251a48ae88c164513ce994f603fc3557356b\",\r\n  blockNumber: 1190,\r\n  from: \"0x33494899299738554a15c79dd9b24221355d67bf\",\r\n  gas: 4000000,\r\n  gasPrice: 20000000000,\r\n  hash: \"0xce9da3a5b40ab67e216759b0599c717e96e76070f0222f10e5b03f94e210b683\",\r\n  input: \"0x6060604052346000575b7319bf3ef7305e0674c844960cd9091f4e27eda21b63c29855786040518163ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180905060006040518083038186803b1560005760325a03f4156000575050505b5b603d80607f6000396000f30060606040525b34600057600f5b5b565b0000a165627a7a7230582024d73e63c95973053e854463fe1dc26432f496eff7b8b18bca5ef8f5422042bb0029\",\r\n  nonce: 45,\r\n  r: \"0x78908ff3660f8c2f28bd7479451b6f915daba37717c4c95fe8e8715a55becbfd\",\r\n  s: \"0x239ec7b04d263e0f839dd3ac4e1070c6a4a877aa65349e6ac729e18fd77d820\",\r\n  to: null,\r\n  transactionIndex: 0,\r\n  v: \"0x1b\",\r\n  value: 0\r\n}\r\n\r\n\r\n> web3.eth.getTransactionReceipt(\"0xce9da3a5b40ab67e216759b0599c717e96e76070f0222f10e5b03f94e210b683\")\r\n\r\n\r\n\r\n{\r\n  blockHash: \"0x88516101482214cf6dfc32939d97251a48ae88c164513ce994f603fc3557356b\",\r\n  blockNumber: 1190,\r\n  contractAddress: \"0x70cf2ece1a0505b98de28d8b68583fa4a8f58fcd\",\r\n  cumulativeGasUsed: 75847,\r\n  from: \"0x33494899299738554a15c79dd9b24221355d67bf\",\r\n  gasUsed: 75847,\r\n  logs: [],\r\n  logsBloom: \"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\",\r\n  root: \"0x9823280599011f707b9dbf522aafded9d060c8f84586b6a03ee50b657e1c78a8\",\r\n  to: null,\r\n  transactionHash: \"0xce9da3a5b40ab67e216759b0599c717e96e76070f0222f10e5b03f94e210b683\",\r\n  transactionIndex: 0\r\n}\r\n\r\n> web3.eth.getCode(\"0x70cf2ece1a0505b98de28d8b68583fa4a8f58fcd\")\r\n\"0x60606040525b34600057600f5b5b565b0000a165627a7a7230582024d73e63c95973053e854463fe1dc26432f496eff7b8b18bca5ef8f5422042bb0029\"\r\n```\r\n\r\n*only the end of the input binary code gets deployed!*\r\n\r\nI'm unsure if it's a solidity, a geth or an evm problem,\r\nthe problem is not reproduced when using ethereumjs-testrpc\r\n\r\n\r\nMoving the library function call out of the constructor (to the fallback for instance) solves the issue\r\n\r\n\r\nupdate: this is related to geth on a private testnet (even when homestead block is properly set). It deploys correctly on the public testnet.",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/1740/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/1740/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/284244277",
    "html_url": "https://github.com/ethereum/solidity/issues/1740#issuecomment-284244277",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1740",
    "id": 284244277,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NDI0NDI3Nw==",
    "user": {
      "login": "Bunjin",
      "id": 11554098,
      "node_id": "MDQ6VXNlcjExNTU0MDk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/11554098?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Bunjin",
      "html_url": "https://github.com/Bunjin",
      "followers_url": "https://api.github.com/users/Bunjin/followers",
      "following_url": "https://api.github.com/users/Bunjin/following{/other_user}",
      "gists_url": "https://api.github.com/users/Bunjin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Bunjin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Bunjin/subscriptions",
      "organizations_url": "https://api.github.com/users/Bunjin/orgs",
      "repos_url": "https://api.github.com/users/Bunjin/repos",
      "events_url": "https://api.github.com/users/Bunjin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Bunjin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-05T17:14:14Z",
    "updated_at": "2017-03-05T17:14:14Z",
    "author_association": "NONE",
    "body": "I tried the same deployment on parity 1.6 with the new instantSeal engine and the bug was reproduced althought it also generated another weird behavior, probably related to parity engine, the method of deployment impacts the result:\r\n\r\n```\r\n\r\ntruffle(local)> web3.eth.sendTransaction({from:web3.eth.accounts[0], to:null, data:0x6060604052346000575b73f55f1186faecf4b1cd3a7dfe5d55a7e2bf73338f63c29855786040518163ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180905060006040518083038186803b1560005760325a03f4156000575050505b5b603d80607f6000396000f30060606040525b34600057600f5b5b565b0000a165627a7a7230582075ea0c8daf070288625613525060c80b93487ca811e7cec5fe3045d20310329b0029, gas:4700000})\r\n\r\n'0x2fd0e046693ce5f56c74d56ce2e38c3b8094f45f71f6ec496d9a10b00e5d8af7'\r\n\r\ntruffle(local)> web3.eth.getTransactionReceipt(\"0x2fd0e046693ce5f56c74d56ce2e38c3b8094f45f71f6ec496d9a10b00e5d8af7\")\r\n\r\n{ blockHash: '0xb035212b165e6aa17cd68c56a6b03217ed105a5de822cd3d495f7cad7d501a62',\r\n\r\n  blockNumber: 3,\r\n\r\n  contractAddress: '0xd4a002fc5b0550fc867d3bc45704a5a6529741c3',\r\n\r\n  cumulativeGasUsed: 53000,\r\n\r\n  gasUsed: 53000,\r\n\r\n  logs: [],\r\n\r\n  logsBloom: '0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',\r\n\r\n  root: null,\r\n\r\n  transactionHash: '0x2fd0e046693ce5f56c74d56ce2e38c3b8094f45f71f6ec496d9a10b00e5d8af7',\r\n\r\n  transactionIndex: 0 }\r\n\r\ntruffle(local)> web3.eth.getCode(\"0xd4a002fc5b0550fc867d3bc45704a5a6529741c3\")\r\n\r\n'0x'\r\n\r\n```\r\n\r\nthat's when deploying manually\r\n\r\nand when deploying with truffle migrate:\r\n\r\n```\r\n\r\ntruffle(local)> web3.eth.getTransaction(\"0xffd730f3f2767b6f6bd0084b1f1ab204d2d87ea630472d4598352e4cc5132069\")\r\n\r\n{ blockHash: '0xfd45a05dba683880d6c6561b4db368dd7a52976692b54dff988071a23adaeb0e',\r\n\r\n  blockNumber: 2,\r\n\r\n  condition: null,\r\n\r\n  creates: '0x857d6456ca763c36b4bad7d27a7f5f72507617ca',\r\n\r\n  from: '0x0017fc495d78a74e4821699d6c66f3fcd1771a53',\r\n\r\n  gas: 4000000,\r\n\r\n  gasPrice: { [String: '100000000000'] s: 1, e: 11, c: [ 100000000000 ] },\r\n\r\n  hash: '0xffd730f3f2767b6f6bd0084b1f1ab204d2d87ea630472d4598352e4cc5132069',\r\n\r\n  input: '0x6060604052346000575b73f55f1186faecf4b1cd3a7dfe5d55a7e2bf73338f63c29855786040518163ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040180905060006040518083038186803b1560005760325a03f4156000575050505b5b603d80607f6000396000f30060606040525b34600057600f5b5b565b0000a165627a7a7230582075ea0c8daf070288625613525060c80b93487ca811e7cec5fe3045d20310329b0029',\r\n\r\n  networkId: null,\r\n\r\n  nonce: 1,\r\n\r\n  publicKey: '0x26c93e05c470e180e9f775c564b9750a2f186258e0e733c4e222e3267919dd4c44640176330bb850f55f005c6fd857338f1bc0069e9639bfceccd60ebb45be69',\r\n\r\n  r: '0xb4edb2ba46b322fd318717bdf320b23a5c91fb0a233eca7d0efe0694656df0f2',\r\n\r\n  raw: '0xf9010e0\r\n\r\ntruffle(local)> web3.eth.getTransactionReceipt(\"0xffd730f3f2767b6f6bd0084b1f1ab204d2d87ea630472d4598352e4cc5132069\")\r\n\r\n{ blockHash: '0xfd45a05dba683880d6c6561b4db368dd7a52976692b54dff988071a23adaeb0e',\r\n\r\n  blockNumber: 2,\r\n\r\n  contractAddress: '0x857d6456ca763c36b4bad7d27a7f5f72507617ca',\r\n\r\n  cumulativeGasUsed: 77227,\r\n\r\n  gasUsed: 77227,\r\n\r\n  logs: [],\r\n\r\n  logsBloom: '0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',\r\n\r\n  root: null,\r\n\r\n  transactionHash: '0xffd730f3f2767b6f6bd0084b1f1ab204d2d87ea630472d4598352e4cc5132069',\r\n\r\n  transactionIndex: 0 }\r\n\r\ntruffle(local)> web3.eth.getCode(\"0x857d6456ca763c36b4bad7d27a7f5f72507617ca\")\r\n\r\n'0x60606040525b34600057600f5b5b565b0000a165627a7a7230582075ea0c8daf070288625613525060c80b93487ca811e7cec5fe3045d20310329b0029'\r\n\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/284244277/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/286909715",
    "html_url": "https://github.com/ethereum/solidity/issues/1740#issuecomment-286909715",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1740",
    "id": 286909715,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NjkwOTcxNQ==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-15T23:17:57Z",
    "updated_at": "2017-03-15T23:18:26Z",
    "author_association": "MEMBER",
    "body": "The creation and the deployed bytecode differs, because the constructor will not be part of the deployed code (also constructor parameters at the end of the bytecode will not be deployed). Hence by using `getCode()` the bytecode cannot be compared.\r\n\r\nThe compiler is able to output the deployed (aka runtime) bytecode too:\r\n```\r\n  --bin                Binary of the contracts in hex.\r\n  --bin-runtime        Binary of the runtime part of the contracts in hex.\r\n```\r\n\r\nAre you sure the data is corrupted and not seeing the above?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/286909715/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/312622998",
    "html_url": "https://github.com/ethereum/solidity/issues/1740#issuecomment-312622998",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1740",
    "id": 312622998,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxMjYyMjk5OA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-03T11:36:25Z",
    "updated_at": "2017-07-03T11:36:25Z",
    "author_association": "MEMBER",
    "body": "Closing due to inactivity.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/312622998/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
