{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/8773",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/8773/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/8773/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/8773/events",
  "html_url": "https://github.com/ethereum/solidity/issues/8773",
  "id": 606840672,
  "node_id": "MDU6SXNzdWU2MDY4NDA2NzI=",
  "number": 8773,
  "title": "In-language testing syntax / support",
  "user": {
    "login": "axic",
    "id": 20340,
    "node_id": "MDQ6VXNlcjIwMzQw",
    "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/axic",
    "html_url": "https://github.com/axic",
    "followers_url": "https://api.github.com/users/axic/followers",
    "following_url": "https://api.github.com/users/axic/following{/other_user}",
    "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
    "organizations_url": "https://api.github.com/users/axic/orgs",
    "repos_url": "https://api.github.com/users/axic/repos",
    "events_url": "https://api.github.com/users/axic/events{/privacy}",
    "received_events_url": "https://api.github.com/users/axic/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 785717317,
      "node_id": "MDU6TGFiZWw3ODU3MTczMTc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/language%20design%20:rage4:",
      "name": "language design :rage4:",
      "color": "9d76d3",
      "default": false,
      "description": "Any changes to the language, e.g. new features"
    },
    {
      "id": 4437999539,
      "node_id": "LA_kwDOAm_5kc8AAAABCIZ_sw",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/high%20effort",
      "name": "high effort",
      "color": "ff54f4",
      "default": false,
      "description": "A lot to implement but still doable by a single person. The task is large or difficult."
    },
    {
      "id": 4438153180,
      "node_id": "LA_kwDOAm_5kc8AAAABCIjX3A",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/high%20impact",
      "name": "high impact",
      "color": "001dff",
      "default": false,
      "description": "Changes are very prominent and affect users or the project in a major way."
    },
    {
      "id": 4525128519,
      "node_id": "LA_kwDOAm_5kc8AAAABDbf7Rw",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/needs%20design",
      "name": "needs design",
      "color": "18F737",
      "default": false,
      "description": "The proposal is too vague to be implemented right away"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-04-25T19:38:04Z",
  "updated_at": "2022-09-26T20:10:00Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "I thought we had a tracking issue for this already. Last we've discussed I believe was in September 2017.\r\n\r\nSome languages have built-in support for unit testing, such as [C#](https://docs.microsoft.com/en-us/visualstudio/test/walkthrough-creating-and-running-unit-tests-for-managed-code?view=vs-2019), [Rust](https://doc.rust-lang.org/rust-by-example/testing/unit_testing.html) and [Python](https://docs.python.org/3/library/unittest.html). Many other languages don't have it, but delegate it numerous external libraries, such as Javascript and C/C++.\r\n\r\nIn Solidity currently there is no language level support and different external projects approach the question differently:\r\n- Embark only support [tests written in Javascript](https://framework.embarklabs.io/docs/contracts_testing.html)\r\n- Truffle supports both [Javascript](https://www.trufflesuite.com/docs/truffle/testing/writing-tests-in-javascript) and [Solidity tests](https://www.trufflesuite.com/docs/truffle/testing/writing-tests-in-solidity)\r\n- Remix supports a testing framework [written in Solidity](https://github.com/ethereum/remix/tree/master/remix-tests)\r\n- Dapphub's ds-test is also [written in Solidity](https://github.com/dapphub/ds-test)\r\n- *not sure about others*\r\n\r\nI think it would be nice to explore whether language support could be beneficial here.\r\n\r\n#### Current tests written in Solidity\r\n\r\nTruffle's [AssertBool.sol](https://github.com/trufflesuite/truffle/blob/4bcb4691d58e92f89ee5b94cce273d0db5f51544/packages/core/lib/testing/AssertBool.sol), Remix's [test.sol](https://github.com/ethereum/remix/blob/master/remix-tests/sol/tests.sol.js) and ds-test's [test.sol](https://github.com/dapphub/ds-test/blob/master/src/test.sol) all define a helper assertion library, which under the hood emits an event. The runner can catch this event and display the results.\r\n\r\n#### What is the benefit of having language-level support?\r\n\r\nThe main benefit is that tests would be more closely coupled with sources. Potentially (some) tests could be framework agnostic, facilitating cross-platform support (e.g. running something in Remix, then transitioning to Embark/Truffle)\r\n\r\nA secondary benefit is having access to `internal`/`private` members when the test is closely coupled. Currently contracts have to avoid using internal/private members or introduce (derived contracts and) helpers exposing those.\r\n\r\n#### Some initial proposal\r\n\r\nAn important question to address: do a) we want tests to be executed by the compiler; or b) only exposed them in some standard way (through \"standard json\")?\r\n\r\nIn any of the cases it would be beneficial to separate the syntactically tests. I really like the approach of Rust and C# where tests are decorated (with `#[test]` and `[TestClass]`, respectively). Furthermore Rust has a syntax for configuration options further separating tests (`#[cfg(test)]` -- a somewhat relevant attempt was discussed in #1650).\r\n\r\nIn Solidity we could introduce a new top level keyword to group tests:\r\n`test {}`\r\n\r\nAny function inside could be its own test case, however supporting \"before\"/\"after\" handlers would also be useful.\r\n\r\nQ1: Is this a useful/needed feature?\r\nQ2: Should the compiler perform these unit tests?\r\nQ3: Should these test contracts be exposed with some special marking in the standard json output (so that frameworks can run the tests)?\r\nQ4: Is there a need for init / beforeEach / afterEach / beforeAll /  afterAll?\r\nQ5: Should these tests support more complex features (such as changing \"chain\" properties, including time)?\r\nQ6: Should it amend calls with \"sender\" or introduce another interface (such as `msg.sender = 0x1234`)\r\n\r\n---\r\n\r\nHere is a longer example:\r\n```\r\n// Based off https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/test/token/ERC20/ERC20.test.js\r\n\r\ncontract ERC20 { \r\n    // Assume the ERC20 token is here.\r\n}\r\n\r\ntest {\r\n    address token;\r\n\r\n    address initialHolder = 0x123;\r\n    string name = \"My Token\";\r\n    string symbol = \"MTKN\";\r\n    uint initialSupply = 100;\r\n\r\n    modifier beforeEach() {\r\n        token = new ERC20(name, symbol, initialHolder, initialSupply);\r\n\r\n        _;\r\n    }\r\n\r\n    case(\"has a name\") beforeEach {\r\n        expect.isEqual(token.name, name);\r\n    }\r\n\r\n    case(\"has a symbol\") {\r\n        expect.isEqual(token.name, name);\r\n    }\r\n\r\n    case(\"transfer without balance\") beforeEach {\r\n        try {\r\n            token.transfer{sender=0x555}(0x333, 12 eth);\r\n            expect.failure();\r\n        } catch (bytes memory) {\r\n            expect.success();\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nSome alternate syntax options:\r\n```\r\n    test \"has a name\" { }\r\n    test(\"has a name\") {}\r\n    case \"has a name\" {}\r\n    case(\"has a name\") {}\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/8773/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/8773/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/621930826",
    "html_url": "https://github.com/ethereum/solidity/issues/8773#issuecomment-621930826",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8773",
    "id": 621930826,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMTkzMDgyNg==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-30T15:35:26Z",
    "updated_at": "2020-04-30T15:35:26Z",
    "author_association": "MEMBER",
    "body": "Discussed this during the Solidity Summit and on the gitter channel.\r\n\r\nThere seemed to be an interest to at least define conventions which can be shared with all the different frameworks. An easy option is to define an interface for the \"assertion library\" so that tests all can use the same functions, but allow the frameworks to implement their own methods (the specific events those assertions output).\r\n\r\nAdditionally would need to agree on conventions for beforeAll/afterAll/beforeEach/afterAll.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/621930826/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/621965376",
    "html_url": "https://github.com/ethereum/solidity/issues/8773#issuecomment-621965376",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8773",
    "id": 621965376,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMTk2NTM3Ng==",
    "user": {
      "login": "GNSPS",
      "id": 4008213,
      "node_id": "MDQ6VXNlcjQwMDgyMTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4008213?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/GNSPS",
      "html_url": "https://github.com/GNSPS",
      "followers_url": "https://api.github.com/users/GNSPS/followers",
      "following_url": "https://api.github.com/users/GNSPS/following{/other_user}",
      "gists_url": "https://api.github.com/users/GNSPS/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/GNSPS/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/GNSPS/subscriptions",
      "organizations_url": "https://api.github.com/users/GNSPS/orgs",
      "repos_url": "https://api.github.com/users/GNSPS/repos",
      "events_url": "https://api.github.com/users/GNSPS/events{/privacy}",
      "received_events_url": "https://api.github.com/users/GNSPS/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-30T16:35:25Z",
    "updated_at": "2020-04-30T16:35:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "_Pasting formatted comments and images from the Gitter chat in case it is helpful for future reference:_\r\n\r\nDominic Letz @dominicletz 16:20\r\ni'm definitely pro having \"native\" syntax to enable testing switches\r\nhaving testing support outside the compiler e.g. in some preprocessor means we're losing type support , and in the worst case could lead to the C/C++ precompiler macro mess\r\n\r\nchriseth @chriseth 16:21\r\n@dominicletz what do you mean by \"testing switches\"?\r\n\r\nAlex Beregszaszi @axic 16:22\r\nDamn deleted by editing :(\r\nSlides are here: https://axic.github.io/notes/summit/testing_syntax/\r\n\r\nSome features proposed: https://axic.github.io/notes/summit/testing_syntax/#/8\r\n\r\nAn example: https://axic.github.io/notes/summit/testing_syntax/#/9 (need to scroll within the highlighting)\r\n\r\nIt uses `token.transfer{sender=0x555}(0x333, 12 eth);` to change sender.\r\n\r\nFeist Josselin @montyly 16:23\r\nI would advocate to do a review of the features of the different unit tests framework that exist, and evaluate which ones you want/can have\r\n\r\nI like the idea, but my concern is that due to the limitations we discussed, the developers will either need to use two different framework for testing (the \"solidity unit tests\", and an additional one), or will just not use the solidity unit tests\r\n\r\nDominic Letz @dominicletz 16:23\r\n@chriseth e.g. switching private members public, or changing variables during test runs, or changing imports during test runs\r\n\r\nAlex Beregszaszi @axic 16:25\r\n@montyly @MrChico @alcuadrado would you guys prefer to agree on a “testing syntax” using regular Solidity contracts, e.g. a standard “assert” library? Or would you prefer having some special syntax/annotations? Or both?\r\n\r\nchriseth @chriseth 16:25\r\nthanks, @dominicletz ! maybe something that could be useful short-term would be some kind of mock support, basically transparently exchanging contract names.\r\non the other hand, that could probably also be done using remappings\r\n\r\nFeist Josselin @montyly 16:28\r\n@axic I am not sure. I could be interesting when designing the unit test syntax to take into account the discussion on the pre/post conditions annotations\r\n\r\nDominic Letz @dominicletz 16:31\r\n@chriseth would be awesome, I've got this pile of ugly source code, that we've annotated with comments and that our CI is sending through sed to generate and execute tests\r\n\r\n![image](https://user-images.githubusercontent.com/4008213/80735395-883e3980-8b08-11ea-87f1-0aaf2819df3c.png)\r\n![image](https://user-images.githubusercontent.com/4008213/80735409-8d9b8400-8b08-11ea-92de-98f73f3cfd52.png)\r\n\r\nwould love to get rid of that stuff\r\n\r\nAlex Beregszaszi @axic 16:32\r\n@montyly yep, all of these are quite related :)\r\n\r\nMrChico @MrChico 16:32\r\n@axic I think it could be a good idea to come to an agree on annotations for tests. `dapp` deals with `setUp()` (a.k.a. beforeEach) and simply marks test functions to be run by having `test` or `testFail` as part of their name. The convention is `.t.sol` for tests.\r\nconforming on these annotations sounds like a good idea\r\n\r\nAlex Beregszaszi @axic 16:33\r\n:thumbsup:\r\n\r\nFeist Josselin @montyly 16:33\r\n+1 with @MrChico\r\n\r\nGonçalo Sá @GNSPS 16:34\r\n> @montyly @MrChico @alcuadrado would you guys prefer to agree on a “testing syntax” using regular Solidity contracts, e.g. a standard “assert” library? Or would you prefer having some special syntax/annotations? Or both?\r\n\r\nI think the library approach is fine and definitely keeps a separation of concerns.\r\n\r\nI do remember that Truffle was a little bit buggy and strict when it came to running tests with assertion libraries I wrote to extend their own. (https://github.com/GNSPS/solidity-bytes-utils/blob/master/test/TestBytesLib1.sol#L42-L44)\r\n\r\nProbably a standard is in order? To at least have the frameworks agree on the events being fired?\r\n\r\n> @axic I think it could be a good idea to come to an agree on annotations for tests. `dapp` deals with `setUp()` (a.k.a. beforeEach) and simply marks test functions to be run by having `test` or `testFail` as part of their name. The convention is `.t.sol` for tests.\r\n> conforming on these annotations sounds like a good idea\r\n\r\nA cross-framework standard for function names, file names and event names.\r\n\r\nAlex Beregszaszi @axic 16:36\r\nWould you want to enforce the implementation of the assertion library (e.g. the events it generates) or just the interface?\r\n\r\nMrChico @MrChico 16:37\r\nan advantage of using functions over case(\"test\") syntax is that it can take arguments which is great for more advanced testing\r\nJust the interface I think is sufficient\r\n\r\nGonçalo Sá @GNSPS 16:38\r\nI think the interface is sufficient, too\r\n\r\nAlex Beregszaszi @axic 16:38\r\nThere also the option of `case “test” (arg1, arg2, …) {}`\r\n\r\n\r\nMrChico @MrChico 16:40\r\nhaha okay\r\n\r\n > There also the option of `case “test” (arg1, arg2, …) {}`\r\n\r\nwould this generate the same code as `function testCase(arg1, arg2, ...) {}`?\r\n\r\nAlex Beregszaszi @axic 16:40\r\nWith the added functionality that the test case can have spaces, etc. I think today that is hidden in assertions.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/621965376/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/932049423",
    "html_url": "https://github.com/ethereum/solidity/issues/8773#issuecomment-932049423",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8773",
    "id": 932049423,
    "node_id": "IC_kwDOAm_5kc43jfIP",
    "user": {
      "login": "montyly",
      "id": 13798342,
      "node_id": "MDQ6VXNlcjEzNzk4MzQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/13798342?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/montyly",
      "html_url": "https://github.com/montyly",
      "followers_url": "https://api.github.com/users/montyly/followers",
      "following_url": "https://api.github.com/users/montyly/following{/other_user}",
      "gists_url": "https://api.github.com/users/montyly/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/montyly/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/montyly/subscriptions",
      "organizations_url": "https://api.github.com/users/montyly/orgs",
      "repos_url": "https://api.github.com/users/montyly/repos",
      "events_url": "https://api.github.com/users/montyly/events{/privacy}",
      "received_events_url": "https://api.github.com/users/montyly/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-01T08:58:49Z",
    "updated_at": "2021-10-01T08:58:49Z",
    "author_association": "NONE",
    "body": "Hi,\r\n\r\nIs there any news on this topic? Imho having unit-tests support within Solidity would ease a lot the testing, and remove the burden from all the developers working on different compilation frameworks. \r\n\r\nAs we discussed back in 2020, it could also allow having pre/post invariants written directly in Solidity, and makes the property-based testing/verification a lot simpler.\r\n\r\nIn the long term, I think it would be awesome to see less fragmentation in the Solidity compilations ecosystem, and a unified cargo-style approach for solc, like:\r\n```\r\n$ solc new project_name\r\n$ solc compile\r\n$ solc test\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/932049423/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
