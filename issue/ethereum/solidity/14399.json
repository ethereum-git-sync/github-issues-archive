{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/14399",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/14399/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/14399/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/14399/events",
  "html_url": "https://github.com/ethereum/solidity/issues/14399",
  "id": 1797028013,
  "node_id": "I_kwDOAm_5kc5rHHit",
  "number": 14399,
  "title": "FullInliner evaluates inlined function arguments in the wrong order",
  "user": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    },
    {
      "id": 1282209978,
      "node_id": "MDU6TGFiZWwxMjgyMjA5OTc4",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/optimizer",
      "name": "optimizer",
      "color": "d4c5f9",
      "default": false,
      "description": ""
    },
    {
      "id": 2376132438,
      "node_id": "MDU6TGFiZWwyMzc2MTMyNDM4",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/codegen%20error",
      "name": "codegen error",
      "color": "000000",
      "default": false,
      "description": "Compiler generates invalid code. Critical."
    },
    {
      "id": 4438006499,
      "node_id": "LA_kwDOAm_5kc8AAAABCIaa4w",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/low%20effort",
      "name": "low effort",
      "color": "ffb1fa",
      "default": false,
      "description": "There is not much implementation work to be done. The task is very easy or tiny."
    },
    {
      "id": 4438153180,
      "node_id": "LA_kwDOAm_5kc8AAAABCIjX3A",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/high%20impact",
      "name": "high impact",
      "color": "001dff",
      "default": false,
      "description": "Changes are very prominent and affect users or the project in a major way."
    },
    {
      "id": 4828600698,
      "node_id": "LA_kwDOAm_5kc8AAAABH86Zeg",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/viair",
      "name": "viair",
      "color": "5999F7",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-07-10T15:33:04Z",
  "updated_at": "2023-07-10T15:33:22Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "*Originally reported by a user*.\r\n\r\nIn Yul the function arguments are evaluated right to left. Unfortunately, the code generated by the `FullInliner` optimizer step (`i`) does not preserve that property.\r\n\r\n### Repro\r\n`test.sol`:\r\n```solidity\r\ncontract C {\r\n    function f() public {\r\n        assembly (\"memory-safe\") {\r\n            function fun_revert() -> ret { revert(0, 0) }\r\n            function fun_return() -> ret { return(0, 0) }\r\n            function empty(a, b) {}\r\n\r\n            empty(fun_return(), fun_revert())\r\n        }\r\n    }\r\n}\r\n```\r\n```bash\r\nsolc test.sol --debug-info none --optimize --yul-optimizations \"i\" --ir-optimized\r\n```\r\n\r\nWithout the inliner, the `empty(fun_return(), fun_revert())` call is not inlined and the evaluation order stays the same. This way `fun_revert()` will run first and a call to `f()` will revert.\r\n\r\nThe inliner, however, works as if `fun_return()` were to be evaluated first, which results in code that `return`s instead:\r\n\r\n```yul\r\nif eq(0x26121ff0, newValue)\r\n{\r\n    if callvalue() { revert(0, 0) }\r\n    let headStart := 4\r\n    let dataEnd := calldatasize()\r\n    if slt(sub(dataEnd, headStart), 0) { revert(0, 0) }\r\n    let usr$ret := 0\r\n    return(usr$ret, usr$ret)\r\n}\r\n```\r\n\r\n## Environment\r\n\r\n- Compiler version: affects at least 0.8.13 and 0.8.20.\r\n\r\n### Fix\r\n> That's an actual issue in the inliner: it shouldn't be inlining `empty`, since its arguments are complex expressions and not mere variables... the code comment of the inliner actually spells that out and claims that the inliner won't inline that function, but apparently it does nonetheless... the good thing is that we usually run the inliner only in ssa form with split expressions, so in the default optimizer sequence, this will not become an issue (we should double-check that, but it should be fine). In a custom sequence, this can actually go wrong, though.\r\n\r\n> we change the order of visitation, **and** prevent it from inlining when it's anything other than identifiers **and** document the dependency.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/14399/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/14399/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
