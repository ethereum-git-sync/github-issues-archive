{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12337",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12337/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12337/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12337/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12337",
  "id": 1065099245,
  "node_id": "I_kwDOAm_5kc4_fB_t",
  "number": 12337,
  "title": "[Bug] Includes aren't relative to the include's current directory",
  "user": {
    "login": "Nielsbishere",
    "id": 28758736,
    "node_id": "MDQ6VXNlcjI4NzU4NzM2",
    "avatar_url": "https://avatars.githubusercontent.com/u/28758736?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Nielsbishere",
    "html_url": "https://github.com/Nielsbishere",
    "followers_url": "https://api.github.com/users/Nielsbishere/followers",
    "following_url": "https://api.github.com/users/Nielsbishere/following{/other_user}",
    "gists_url": "https://api.github.com/users/Nielsbishere/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Nielsbishere/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Nielsbishere/subscriptions",
    "organizations_url": "https://api.github.com/users/Nielsbishere/orgs",
    "repos_url": "https://api.github.com/users/Nielsbishere/repos",
    "events_url": "https://api.github.com/users/Nielsbishere/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Nielsbishere/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-11-27T18:04:51Z",
  "updated_at": "2021-12-10T23:03:50Z",
  "closed_at": "2021-12-10T23:03:50Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nIt seems when the following folder structure is used, solc doesn't know it should find files relative to the current directory of the file that is being included.\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.8.10\r\n- Target EVM version (as per compiler settings): ^\r\n- Framework/IDE (e.g. Truffle or Remix): Remix\r\n- EVM execution environment / backend / blockchain client: ^\r\n- Operating system: N/A\r\n\r\n## Steps to Reproduce\r\n\r\n\r\nFile structure:\r\n```\r\nMainContract.sol\r\ninc/MyInclude.sol\r\nmyDependency/MainContract.sol\r\nmyDependency/inc/MyInclude1.sol\r\n```\r\n\r\n./MainContract:\r\n```\r\n// SPDX-License-Identifier: GPL-3.0\r\n\r\npragma solidity >=0.8.9;\r\n\r\nimport \"./inc/MyInclude.sol\";\r\nimport \"./myDependency/MainContract.sol\";\r\n\r\ncontract Test {\r\n\r\n    function test() external {\r\n\r\n    }\r\n}\r\n```\r\n\r\nMyInclude and MyInclude1 in both myDependency/inc and inc/ respectively (Empty for testing purposes)\r\n```\r\n// SPDX-License-Identifier: GPL-3.0\r\n\r\npragma solidity >=0.8.9;\r\n```\r\nmyDependency/MainContract.sol:\r\n```\r\n// SPDX-License-Identifier: GPL-3.0\r\n\r\npragma solidity >=0.8.9;\r\n\r\nimport \"./inc/MyInclude1.sol\";\r\n```\r\n\r\nTo demonstrate this takes the root directory, MyInclude1 can be changed to MyInclude and it will include ./inc/MyInclude instead of ./myDependency/inc/MyInclude1.sol. This works in remix with solc 0.8.10",
  "closed_by": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12337/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12337/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/980923183",
    "html_url": "https://github.com/ethereum/solidity/issues/12337#issuecomment-980923183",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12337",
    "id": 980923183,
    "node_id": "IC_kwDOAm_5kc46d7Mv",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-28T07:45:09Z",
    "updated_at": "2021-11-28T07:47:58Z",
    "author_association": "MEMBER",
    "body": "I cannot reproduce this. This compiles just fine on 0.8.10 for me:\r\n```bash\r\nmkdir -p inc/ myDependency/inc/\r\n\r\necho \"contract A {}\" > inc/MyInclude.sol\r\necho \"contract B {}\" > myDependency/inc/MyInclude1.sol\r\n\r\ncat <<EOF > MainContract.sol\r\nimport \"./inc/MyInclude.sol\";\r\nimport \"./myDependency/MainContract.sol\";\r\ncontract C is A {}\r\nEOF\r\n\r\ncat <<EOF > myDependency/MainContract.sol\r\nimport \"./inc/MyInclude1.sol\";\r\ncontract D is B {}\r\nEOF\r\n\r\nsolc MainContract.sol\r\n```\r\n\r\nNo errors. If you check metadata, it shows that the files get the right names in the internal VFS and have the right content:\r\n```bash\r\nsolc MainContract.sol --metadata --metadata-literal | sed -e 's/^Metadata:$//' | sed -e 's/^=======.*=======$//' | jq\r\n```\r\n```json\r\n  \"sources\": {\r\n    \"MainContract.sol\": {\r\n      \"content\": \"import \\\"./inc/MyInclude.sol\\\";\\nimport \\\"./myDependency/MainContract.sol\\\";\\ncontract C is A {}\\n\",\r\n      \"keccak256\": \"0x72d4b71e81255655a2e2773fa2c383c945ffab621f0a5580b98e441ab8027329\"\r\n    },\r\n    \"inc/MyInclude.sol\": {\r\n      \"content\": \"contract A {}\\n\",\r\n      \"keccak256\": \"0x883c1af8f1ad6d7cdfb8aaed151eebcdd940c8dae0a659cb38054c7ec32ce890\"\r\n    },\r\n    \"myDependency/MainContract.sol\": {\r\n      \"content\": \"import \\\"./inc/MyInclude1.sol\\\";\\ncontract D is B {}\\n\",\r\n      \"keccak256\": \"0x6de7bce3e4feb9bda5ae841c12db677055d8a248862254aca7a54ced63734266\"\r\n    },\r\n    \"myDependency/inc/MyInclude1.sol\": {\r\n      \"content\": \"contract B {}\\n\",\r\n      \"keccak256\": \"0xdeedc4bc3a740226a6e739585f4032a88e95bfab8f96cbf3632299f597143a9d\"\r\n    }\r\n  },\r\n```\r\nIf I change `import \"./inc/MyInclude1.sol\";` to `import \"./inc/MyInclude.sol\";` in `myDependency/MainContract.sol` the compiler does not use `inc/MyInclude.sol`. Instead I get an error:\r\n```\r\nError: Source \"myDependency/inc/MyInclude.sol\" not found: File not found.\r\n --> myDependency/MainContract.sol:1:1:\r\n  |\r\n1 | import \"./inc/MyInclude.sol\";\r\n  | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/980923183/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/981065354",
    "html_url": "https://github.com/ethereum/solidity/issues/12337#issuecomment-981065354",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12337",
    "id": 981065354,
    "node_id": "IC_kwDOAm_5kc46ed6K",
    "user": {
      "login": "Nielsbishere",
      "id": 28758736,
      "node_id": "MDQ6VXNlcjI4NzU4NzM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/28758736?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nielsbishere",
      "html_url": "https://github.com/Nielsbishere",
      "followers_url": "https://api.github.com/users/Nielsbishere/followers",
      "following_url": "https://api.github.com/users/Nielsbishere/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nielsbishere/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nielsbishere/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nielsbishere/subscriptions",
      "organizations_url": "https://api.github.com/users/Nielsbishere/orgs",
      "repos_url": "https://api.github.com/users/Nielsbishere/repos",
      "events_url": "https://api.github.com/users/Nielsbishere/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nielsbishere/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-28T11:06:51Z",
    "updated_at": "2021-11-28T11:06:51Z",
    "author_association": "NONE",
    "body": "You're right I seem unable to reproduce it in that way too now. However if I remove the ./ before the include path it doesn't take a relative path it seems like. My project used that so that's why it didn't compile, now it works fine. Though this might still be an issue",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/981065354/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/981087383",
    "html_url": "https://github.com/ethereum/solidity/issues/12337#issuecomment-981087383",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12337",
    "id": 981087383,
    "node_id": "IC_kwDOAm_5kc46ejSX",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-28T13:39:17Z",
    "updated_at": "2021-11-28T13:41:22Z",
    "author_association": "MEMBER",
    "body": "It's not a bug, it's by design. `import \"a.sol\"` is not just a shorter version of `import \"./a.sol\"`. Imports starting with `./` or `../` (relative imports) are relative to the path of the importing file while others (direct imports) are taken as is. It's explained in detail in [Import Path Resolution > Imports](https://docs.soliditylang.org/en/latest/path-resolution.html#imports).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/981087383/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/981090625",
    "html_url": "https://github.com/ethereum/solidity/issues/12337#issuecomment-981090625",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12337",
    "id": 981090625,
    "node_id": "IC_kwDOAm_5kc46ekFB",
    "user": {
      "login": "Nielsbishere",
      "id": 28758736,
      "node_id": "MDQ6VXNlcjI4NzU4NzM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/28758736?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nielsbishere",
      "html_url": "https://github.com/Nielsbishere",
      "followers_url": "https://api.github.com/users/Nielsbishere/followers",
      "following_url": "https://api.github.com/users/Nielsbishere/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nielsbishere/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nielsbishere/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nielsbishere/subscriptions",
      "organizations_url": "https://api.github.com/users/Nielsbishere/orgs",
      "repos_url": "https://api.github.com/users/Nielsbishere/repos",
      "events_url": "https://api.github.com/users/Nielsbishere/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nielsbishere/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-28T14:01:16Z",
    "updated_at": "2021-11-28T14:01:16Z",
    "author_association": "NONE",
    "body": "Hmm that's a bit confusing though, as other languages like C/C++ do allow this syntax. What's the reason for having absolute paths? I understand the use of @<myLib> but don't really understand the use of the other.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/981090625/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/981113128",
    "html_url": "https://github.com/ethereum/solidity/issues/12337#issuecomment-981113128",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12337",
    "id": 981113128,
    "node_id": "IC_kwDOAm_5kc46epko",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-28T16:25:22Z",
    "updated_at": "2021-11-28T16:25:22Z",
    "author_association": "MEMBER",
    "body": "C++ actually has the same exact mechanism, just with a different syntax - `#include \"...\"` is relative to the header path and `#include <...>` is resolved with respect to a predefined directory path, just like `--base-path` in Solidity.\r\n\r\nDirect imports are not absolute the way you might be thinking about them. They're absolute in compiler's VFS but the VFS does not work with paths. They're just arbitrary IDs (source unit names). You specify them freely in Standard JSON - for example `/`,  `\"` or `http://` are all valid names even though you might not be able to create files on disk under these names on some platforms.\r\n\r\nThe thing is that when you do not provide the content for these IDs explicitly via Standard JSON and the compiler has to load it from disk, it has to interpret the IDs. This is the job of an import callback. The native binaries have a callback that loads stuff from the filesystem so it interprets them as paths - **relative paths**. They're always relative to either the base directory or one of the include paths. So if base path is `/project/` and you do `import \"a/b/c.sol\"`, the compiler will load `/project/a/b/c.sol`. Note that if your import contains an ID that looks like an absolute path (e.g. `import \"/a/b/c.sol\"`) it's still relative to base path so you'll get `/project/a/b/c.sol` as well. The only way to have `import \"/a/b/c.sol\"` actually load `/a/b/c.sol` is to set the base path to an empty value. This happens to be the default value of base path for convenience but keep in mind that it's just a single corner case. Using absolute paths this way is not recommended.\r\n\r\n`@` has no special meaning to the compiler. It's just that many projects adopted it as a naming convention and chose to name their directories in npm packages that way. E.g. if OpenZeppelin named their package `openzeppelin`, you could import stuff from it as `import \"openzeppelin/contracts/...\"` and the compiler would not care that there's no `@` in it..\r\n\r\nWhat do you think about the docs page I linked? Have you read it? If something's not clear please submit a documentation issue and we'll clarify.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/981113128/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/981118925",
    "html_url": "https://github.com/ethereum/solidity/issues/12337#issuecomment-981118925",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12337",
    "id": 981118925,
    "node_id": "IC_kwDOAm_5kc46eq_N",
    "user": {
      "login": "Nielsbishere",
      "id": 28758736,
      "node_id": "MDQ6VXNlcjI4NzU4NzM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/28758736?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nielsbishere",
      "html_url": "https://github.com/Nielsbishere",
      "followers_url": "https://api.github.com/users/Nielsbishere/followers",
      "following_url": "https://api.github.com/users/Nielsbishere/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nielsbishere/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nielsbishere/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nielsbishere/subscriptions",
      "organizations_url": "https://api.github.com/users/Nielsbishere/orgs",
      "repos_url": "https://api.github.com/users/Nielsbishere/repos",
      "events_url": "https://api.github.com/users/Nielsbishere/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nielsbishere/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-28T17:06:44Z",
    "updated_at": "2021-11-28T17:06:44Z",
    "author_association": "NONE",
    "body": "Ah that makes sense now, it's just a bit confusing that import \"./x\" and import \"x\" are basically two different expressions in what they do. `#include <x>` clarifies that it's not relative. I have read it but it seemed confusing that virtual and local files are mixed in this way, but seems useful nonetheless",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/981118925/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
