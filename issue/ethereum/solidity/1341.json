{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/1341",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/1341/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/1341/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/1341/events",
  "html_url": "https://github.com/ethereum/solidity/issues/1341",
  "id": 188126352,
  "node_id": "MDU6SXNzdWUxODgxMjYzNTI=",
  "number": 1341,
  "title": "Investigate emscripten build to reduce size / increase speed",
  "user": {
    "login": "axic",
    "id": 20340,
    "node_id": "MDQ6VXNlcjIwMzQw",
    "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/axic",
    "html_url": "https://github.com/axic",
    "followers_url": "https://api.github.com/users/axic/followers",
    "following_url": "https://api.github.com/users/axic/following{/other_user}",
    "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
    "organizations_url": "https://api.github.com/users/axic/orgs",
    "repos_url": "https://api.github.com/users/axic/repos",
    "events_url": "https://api.github.com/users/axic/events{/privacy}",
    "received_events_url": "https://api.github.com/users/axic/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2016-11-08T22:53:06Z",
  "updated_at": "2017-02-02T10:09:51Z",
  "closed_at": "2017-02-02T10:09:51Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Currently loading the emscripten output can take a while. In the commandline (`solcjs`) it can easily take 5 seconds, while in browsers it can be faster due to caching in the VM.\r\n\r\nWe should investigate the build script to see if optimising for different requirements (`-Os` vs. `-O3`, size vs. speed) might produce asm.js outputs with different loading speed.\r\n\r\nAlso we should double check if dead code is eliminated.\r\n",
  "closed_by": {
    "login": "axic",
    "id": 20340,
    "node_id": "MDQ6VXNlcjIwMzQw",
    "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/axic",
    "html_url": "https://github.com/axic",
    "followers_url": "https://api.github.com/users/axic/followers",
    "following_url": "https://api.github.com/users/axic/following{/other_user}",
    "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
    "organizations_url": "https://api.github.com/users/axic/orgs",
    "repos_url": "https://api.github.com/users/axic/repos",
    "events_url": "https://api.github.com/users/axic/events{/privacy}",
    "received_events_url": "https://api.github.com/users/axic/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/1341/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/1341/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/259285344",
    "html_url": "https://github.com/ethereum/solidity/issues/1341#issuecomment-259285344",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1341",
    "id": 259285344,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1OTI4NTM0NA==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-08T22:54:06Z",
    "updated_at": "2016-11-08T22:54:06Z",
    "author_association": "MEMBER",
    "body": "In https://github.com/ethereum/solidity/blob/develop/scripts/travis-emscripten/build_emscripten.sh we link against many boost libraries, some of htem seem unrelated to the jsonCompiler:\n\n```\n  -DBoost_CHRONO_LIBRARY=\"$WORKSPACE\"/boost_1_57_0/libboost_chrono.a \\\n  -DBoost_CHRONO_LIBRARIES=\"$WORKSPACE\"/boost_1_57_0/libboost_chrono.a \\\n  -DBoost_DATE_TIME_LIBRARY=\"$WORKSPACE\"/boost_1_57_0/libboost_date_time.a \\\n  -DBoost_DATE_TIME_LIBRARIES=\"$WORKSPACE\"/boost_1_57_0/libboost_date_time.a \\\n  -DBoost_FILESYSTEM_LIBRARY=\"$WORKSPACE\"/boost_1_57_0/libboost_filesystem.a \\\n  -DBoost_FILESYSTEM_LIBRARIES=\"$WORKSPACE\"/boost_1_57_0/libboost_filesystem.a \\\n  -DBoost_PROGRAM_OPTIONS_LIBRARY=\"$WORKSPACE\"/boost_1_57_0/libboost_program_options.a \\\n  -DBoost_PROGRAM_OPTIONS_LIBRARIES=\"$WORKSPACE\"/boost_1_57_0/libboost_program_options.a \\\n  -DBoost_RANDOM_LIBRARY=\"$WORKSPACE\"/boost_1_57_0/libboost_random.a \\\n  -DBoost_RANDOM_LIBRARIES=\"$WORKSPACE\"/boost_1_57_0/libboost_random.a \\\n  -DBoost_REGEX_LIBRARY=\"$WORKSPACE\"/boost_1_57_0/libboost_regex.a \\\n  -DBoost_REGEX_LIBRARIES=\"$WORKSPACE\"/boost_1_57_0/libboost_regex.a \\\n  -DBoost_SYSTEM_LIBRARY=\"$WORKSPACE\"/boost_1_57_0/libboost_system.a \\\n  -DBoost_SYSTEM_LIBRARIES=\"$WORKSPACE\"/boost_1_57_0/libboost_system.a \\\n  -DBoost_THREAD_LIBRARY=\"$WORKSPACE\"/boost_1_57_0/libboost_thread.a \\\n  -DBoost_THREAD_LIBRARIES=\"$WORKSPACE\"/boost_1_57_0/libboost_thread.a \\\n  -DBoost_UNIT_TEST_FRAMEWORK_LIBRARY=\"$WORKSPACE\"/boost_1_57_0/libboost_unit_test_framework.a \\\n  -DBoost_UNIT_TEST_FRAMEWORK_LIBRARIES=\"$WORKSPACE\"/boost_1_57_0/libboost_unit_test_framework.a \\\n```\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/259285344/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/259285946",
    "html_url": "https://github.com/ethereum/solidity/issues/1341#issuecomment-259285946",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1341",
    "id": 259285946,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1OTI4NTk0Ng==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-08T22:56:53Z",
    "updated_at": "2016-11-08T22:56:53Z",
    "author_association": "MEMBER",
    "body": "@chriseth today's build after merging the removal of cryptopp actually resulted in a bigger binary:\n\n```\n7742759  soljson-v0.4.5-nightly.2016.11.4+commit.d97d267a.js\n7744320  soljson-v0.4.5-nightly.2016.11.8+commit.7a30e8cf.js\n```\n\nThis suggest dead code is not eliminated.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/259285946/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/259290223",
    "html_url": "https://github.com/ethereum/solidity/issues/1341#issuecomment-259290223",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1341",
    "id": 259290223,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1OTI5MDIyMw==",
    "user": {
      "login": "chfast",
      "id": 573380,
      "node_id": "MDQ6VXNlcjU3MzM4MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/573380?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chfast",
      "html_url": "https://github.com/chfast",
      "followers_url": "https://api.github.com/users/chfast/followers",
      "following_url": "https://api.github.com/users/chfast/following{/other_user}",
      "gists_url": "https://api.github.com/users/chfast/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chfast/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chfast/subscriptions",
      "organizations_url": "https://api.github.com/users/chfast/orgs",
      "repos_url": "https://api.github.com/users/chfast/repos",
      "events_url": "https://api.github.com/users/chfast/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chfast/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-08T23:17:04Z",
    "updated_at": "2016-11-08T23:17:04Z",
    "author_association": "MEMBER",
    "body": "This suggested actually the opposite, at least for simple linker case. We were linking with unnecessary cryptopp library and that did not produce bigger \"binary\" (I checked that when I was removing it, the size was the same).\n\nThe best solution for shared library is to limit the visibility of symbols, otherwise all non-internal functions are exported. This reduced the size of evmjit shared library a lot (might be 4x or more). https://github.com/ethereum/evmjit/blob/develop/libevmjit/CMakeLists.txt#L28.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/259290223/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/259292589",
    "html_url": "https://github.com/ethereum/solidity/issues/1341#issuecomment-259292589",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1341",
    "id": 259292589,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1OTI5MjU4OQ==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-08T23:28:38Z",
    "updated_at": "2016-11-08T23:28:38Z",
    "author_association": "MEMBER",
    "body": "You're right, it is too later here to be productive 😉 \n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/259292589/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/259293449",
    "html_url": "https://github.com/ethereum/solidity/issues/1341#issuecomment-259293449",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1341",
    "id": 259293449,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1OTI5MzQ0OQ==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-08T23:33:27Z",
    "updated_at": "2016-11-08T23:33:27Z",
    "author_association": "MEMBER",
    "body": "It also seems like `soljson` is an executable (and not library) target (but also exports methods?): https://github.com/ethereum/solidity/blob/develop/solc/CMakeLists.txt#L21\n\nIt must be some weird way Emscripten uses.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/259293449/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/259297610",
    "html_url": "https://github.com/ethereum/solidity/issues/1341#issuecomment-259297610",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1341",
    "id": 259297610,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI1OTI5NzYxMA==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-08T23:56:25Z",
    "updated_at": "2016-11-09T00:19:27Z",
    "author_association": "MEMBER",
    "body": "This suggests a some ideas https://kripken.github.io/emscripten-site/docs/optimizing/Optimizing-Code.html:\n1. outlining (can help or make it worse)\n2. limit inlining (reduces size, may result in worse speed)\n3. memory file (this would result in two files and may be painful with async loading it, but definitely improves speed)\n4. LLVM optims:\n\n```\n--llvm-lto <level>\n    Enables LLVM link-time optimizations (LTO).\n```\n1. use closure:\n\n```\nRun closure compiler. This greatly reduces code size and may in some cases increase runtime speed (although the opposite can also occur). Note that it takes time to run, and may require some changes to the code.\n```\n1. `ELIMINATE_DUPLICATE_FUNCTIONS` (not supported by our Emscripten version)\n\n@chfast `-fdata-sections -ffunction-sections -Wl,--gc-sections` didn't make a change, so I guess it did eliminate sections. `-fvisibility=hidden` didn't make a difference either.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/259297610/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/276916996",
    "html_url": "https://github.com/ethereum/solidity/issues/1341#issuecomment-276916996",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1341",
    "id": 276916996,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI3NjkxNjk5Ng==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-02-02T10:09:51Z",
    "updated_at": "2017-02-02T10:09:51Z",
    "author_association": "MEMBER",
    "body": "Changed by #1342, though not much reduction was achieved.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/276916996/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
