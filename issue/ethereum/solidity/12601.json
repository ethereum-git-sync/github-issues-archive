{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12601",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12601/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12601/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12601/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12601",
  "id": 1119560433,
  "node_id": "I_kwDOAm_5kc5CuyLx",
  "number": 12601,
  "title": "LSP test framework improvements",
  "user": {
    "login": "christianparpart",
    "id": 56763,
    "node_id": "MDQ6VXNlcjU2NzYz",
    "avatar_url": "https://avatars.githubusercontent.com/u/56763?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/christianparpart",
    "html_url": "https://github.com/christianparpart",
    "followers_url": "https://api.github.com/users/christianparpart/followers",
    "following_url": "https://api.github.com/users/christianparpart/following{/other_user}",
    "gists_url": "https://api.github.com/users/christianparpart/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/christianparpart/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/christianparpart/subscriptions",
    "organizations_url": "https://api.github.com/users/christianparpart/orgs",
    "repos_url": "https://api.github.com/users/christianparpart/repos",
    "events_url": "https://api.github.com/users/christianparpart/events{/privacy}",
    "received_events_url": "https://api.github.com/users/christianparpart/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3784569283,
      "node_id": "LA_kwDOAm_5kc7hk_HD",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/language%20server",
      "name": "language server",
      "color": "FEF2C0",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "Marenz",
    "id": 424752,
    "node_id": "MDQ6VXNlcjQyNDc1Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Marenz",
    "html_url": "https://github.com/Marenz",
    "followers_url": "https://api.github.com/users/Marenz/followers",
    "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
    "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
    "organizations_url": "https://api.github.com/users/Marenz/orgs",
    "repos_url": "https://api.github.com/users/Marenz/repos",
    "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Marenz/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "Marenz",
      "id": 424752,
      "node_id": "MDQ6VXNlcjQyNDc1Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Marenz",
      "html_url": "https://github.com/Marenz",
      "followers_url": "https://api.github.com/users/Marenz/followers",
      "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
      "organizations_url": "https://api.github.com/users/Marenz/orgs",
      "repos_url": "https://api.github.com/users/Marenz/repos",
      "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Marenz/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2022-01-31T15:13:09Z",
  "updated_at": "2022-05-09T14:23:10Z",
  "closed_at": "2022-05-09T14:22:57Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "After some discussions with @Marenz and now @chriseth, I'm writing down what we agreed on:\r\n\r\nIn order to avoid messing with file offsets, the idea is to reference cursor locations and source location ranges via Solidity comments.\r\nUsing one or more `^` below a line to mark the line above at these columns as a source location.\r\n\r\nIf it's a single `^`, then that location can be used as \"position\" (e.g. for client's text cursor), and a sequence of one or more `^` can be used to express a source location range.\r\n\r\nRight next to the sequence of  `^`('s) will be the ID, starting with an `@` and followed by an identifier. \r\n\r\nMultiline source locations will have a single `^( @Identifier` marking the first line and a `^) @Identifier` marking the last line.\r\n\r\nThe new test framework should be similar to `isoltest`, having .sol files for each small test case. Multiple files are split by `// ==== ileA.sol` lines, if needed.\r\n\r\nThe format for the request(s) and expectation(s) can be similar to the following example:\r\n\r\n```solidity\r\ncontract C {\r\n    function f(uint256 var1) public pure returns { return 2 * var1; }\r\n                   //  ^^^^ @var1-def                         ^ @use-of-var1\r\n}\r\n// ----\r\n// send: textDocument/definition\r\n// params: { @use-of-var1 }\r\n// reply.result.0: { @var1-def }\r\n```\r\n\r\nOn failure, an editor could be popped up (like isoltest) to interactively fix the mismatch, or maybe provide an auto-fix iff(!) the actual location is visualized.\r\n",
  "closed_by": {
    "login": "christianparpart",
    "id": 56763,
    "node_id": "MDQ6VXNlcjU2NzYz",
    "avatar_url": "https://avatars.githubusercontent.com/u/56763?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/christianparpart",
    "html_url": "https://github.com/christianparpart",
    "followers_url": "https://api.github.com/users/christianparpart/followers",
    "following_url": "https://api.github.com/users/christianparpart/following{/other_user}",
    "gists_url": "https://api.github.com/users/christianparpart/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/christianparpart/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/christianparpart/subscriptions",
    "organizations_url": "https://api.github.com/users/christianparpart/orgs",
    "repos_url": "https://api.github.com/users/christianparpart/repos",
    "events_url": "https://api.github.com/users/christianparpart/events{/privacy}",
    "received_events_url": "https://api.github.com/users/christianparpart/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12601/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12601/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1025917716",
    "html_url": "https://github.com/ethereum/solidity/issues/12601#issuecomment-1025917716",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12601",
    "id": 1025917716,
    "node_id": "IC_kwDOAm_5kc49JkMU",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-31T15:42:40Z",
    "updated_at": "2022-01-31T15:42:40Z",
    "author_association": "MEMBER",
    "body": "In addition to that, we should check if it is possible to make the expectations even more condensed:\r\n```\r\n// ----\r\n// textDocument/definition @use-of-n\r\n// -> @n-def\r\n```\r\nor something like that",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1025917716/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1025920186",
    "html_url": "https://github.com/ethereum/solidity/issues/12601#issuecomment-1025920186",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12601",
    "id": 1025920186,
    "node_id": "IC_kwDOAm_5kc49Jky6",
    "user": {
      "login": "christianparpart",
      "id": 56763,
      "node_id": "MDQ6VXNlcjU2NzYz",
      "avatar_url": "https://avatars.githubusercontent.com/u/56763?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/christianparpart",
      "html_url": "https://github.com/christianparpart",
      "followers_url": "https://api.github.com/users/christianparpart/followers",
      "following_url": "https://api.github.com/users/christianparpart/following{/other_user}",
      "gists_url": "https://api.github.com/users/christianparpart/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/christianparpart/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/christianparpart/subscriptions",
      "organizations_url": "https://api.github.com/users/christianparpart/orgs",
      "repos_url": "https://api.github.com/users/christianparpart/repos",
      "events_url": "https://api.github.com/users/christianparpart/events{/privacy}",
      "received_events_url": "https://api.github.com/users/christianparpart/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-31T15:45:08Z",
    "updated_at": "2022-01-31T15:45:08Z",
    "author_association": "MEMBER",
    "body": "this might work but not for all request/response cases. however, responses holding an array of locations could be expressed easily dense, too:\r\n```\r\n// -> (@n-def, @p-def, @q-def)\r\n```\r\n\r\n(or something like that)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1025920186/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1064097522",
    "html_url": "https://github.com/ethereum/solidity/issues/12601#issuecomment-1064097522",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12601",
    "id": 1064097522,
    "node_id": "IC_kwDOAm_5kc4_bNby",
    "user": {
      "login": "Marenz",
      "id": 424752,
      "node_id": "MDQ6VXNlcjQyNDc1Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Marenz",
      "html_url": "https://github.com/Marenz",
      "followers_url": "https://api.github.com/users/Marenz/followers",
      "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
      "organizations_url": "https://api.github.com/users/Marenz/orgs",
      "repos_url": "https://api.github.com/users/Marenz/repos",
      "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Marenz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-10T14:03:52Z",
    "updated_at": "2022-03-10T14:06:28Z",
    "author_association": "MEMBER",
    "body": "Looking at the test, I can see that we assert the diagnostics right after opening a file, I figured we should have that capability in this syntax too. \r\nThis is what I currently came up with:\r\n\r\n```\r\n// SPDX-License-Identifier: UNLICENSED\r\npragma solidity >=0.8.0;\r\n\r\ncontract MyContract\r\n{\r\n    constructor()\r\n    {\r\n        uint unused; // [Warning 2072] Unused local variable.\r\n   //   ^^^^^^^^^^^ @unusedVariable\r\n    }\r\n}\r\n\r\ncontract D\r\n{\r\n    function main() public payable returns (uint)\r\n                                       //   ^^^^ @unusedReturnVariable\r\n    {\r\n        MyContract c = new MyContract();\r\n   //   ^^^^^^^^^^^^ @unusedContractVariable\r\n    }\r\n}\r\n// ----\r\n// diagnostics:\r\n//  - 6321 @unusedReturnVariable\r\n//  - 2072 @unusedVariable\r\n//  - 2072 @unusedContractVariable\r\n// textDocument/didChange @unusedVariable+ \"\"\r\n// diagnostics:\r\n//  - 6321 @unusedReturnVariable\r\n//  - 2072 @unusedContractVariable\r\n\r\n```\r\nthe little `+` there means \"the location of that variable `+1` because we want to replace the variable + one more (the `;`) with the string following. We have that situation also quiet a bit in the current cases. Could be extended to `+<number>` to be more generic, though I don't want to have too many raw numbers in there again.\r\n\r\nThe number in the diagnostic list is simply the reported error code.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1064097522/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1064225935",
    "html_url": "https://github.com/ethereum/solidity/issues/12601#issuecomment-1064225935",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12601",
    "id": 1064225935,
    "node_id": "IC_kwDOAm_5kc4_bsyP",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-10T16:07:47Z",
    "updated_at": "2022-03-10T16:07:47Z",
    "author_association": "MEMBER",
    "body": "Is this feature relevant for anything except the didChange handler? Adding state and actions (that are not just queries) to the systems seem like a rather complex change that we maybe don't even need - and it's also difficult to understand what happens in the tests.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1064225935/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1064289454",
    "html_url": "https://github.com/ethereum/solidity/issues/12601#issuecomment-1064289454",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12601",
    "id": 1064289454,
    "node_id": "IC_kwDOAm_5kc4_b8Su",
    "user": {
      "login": "Marenz",
      "id": 424752,
      "node_id": "MDQ6VXNlcjQyNDc1Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Marenz",
      "html_url": "https://github.com/Marenz",
      "followers_url": "https://api.github.com/users/Marenz/followers",
      "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
      "organizations_url": "https://api.github.com/users/Marenz/orgs",
      "repos_url": "https://api.github.com/users/Marenz/repos",
      "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Marenz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-10T17:01:00Z",
    "updated_at": "2022-03-10T17:01:00Z",
    "author_association": "MEMBER",
    "body": "Well, every time a change is done or a file opened we get the reported diagnostics through the LSP server and in every test every diagnostic is currently exactly checked & validated to be what we expect it to be, e.g. \"unused variable\" for a certain location/range. I saw it as part of the tests really.\r\nThe particular test shown here removes the unused variable and checks the new diagnostics after the change, expecting it to be gone. \r\nSo it's like an before/after here. Though there could be more calls and state changes added of course.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1064289454/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1121170736",
    "html_url": "https://github.com/ethereum/solidity/issues/12601#issuecomment-1121170736",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12601",
    "id": 1121170736,
    "node_id": "IC_kwDOAm_5kc5C07Uw",
    "user": {
      "login": "Marenz",
      "id": 424752,
      "node_id": "MDQ6VXNlcjQyNDc1Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Marenz",
      "html_url": "https://github.com/Marenz",
      "followers_url": "https://api.github.com/users/Marenz/followers",
      "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
      "organizations_url": "https://api.github.com/users/Marenz/orgs",
      "repos_url": "https://api.github.com/users/Marenz/repos",
      "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Marenz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-09T14:23:10Z",
    "updated_at": "2022-05-09T14:23:10Z",
    "author_association": "MEMBER",
    "body": "This has been resolved by #12724",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1121170736/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
