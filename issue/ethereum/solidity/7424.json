{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/7424",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/7424/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/7424/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/7424/events",
  "html_url": "https://github.com/ethereum/solidity/issues/7424",
  "id": 493390791,
  "node_id": "MDU6SXNzdWU0OTMzOTA3OTE=",
  "number": 7424,
  "title": "[yul] optimizer can now increase execution step count of a program by 2x",
  "user": {
    "login": "bshastry",
    "id": 2388185,
    "node_id": "MDQ6VXNlcjIzODgxODU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bshastry",
    "html_url": "https://github.com/bshastry",
    "followers_url": "https://api.github.com/users/bshastry/followers",
    "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
    "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
    "organizations_url": "https://api.github.com/users/bshastry/orgs",
    "repos_url": "https://api.github.com/users/bshastry/repos",
    "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bshastry/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2019-09-13T15:34:42Z",
  "updated_at": "2019-09-17T10:58:57Z",
  "closed_at": "2019-09-17T10:58:57Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nWe had decided on an upper bound of `N * 1.5` number of execution steps for optimized code (see https://github.com/ethereum/solidity/issues/6476#issuecomment-480237241) that is now exceeded most likely because of #7407 \r\n\r\n> Does it make sense to set the bound to some value N when executing the non-optimized version and setting it to N * 1.5 when executing the optimized version? This should make the assumption you name true again in most cases, and the cases where it fails should be inspected manually anyway, because it sounds like the optimizer did a bad job for those.\r\n\r\nOpened this issue to discuss this change. My intuition is that break for-loop-condition into `if (iszero(condition)) break` adds an additional step for each loop iteration, so in total optimized code may lead to twice the number of steps.\r\n\r\nExample unoptimized code\r\n\r\n```\r\n{                   \r\n    for { let i_0 } lt(i_0, 0x60) { i_0 := add(i_0, 0x20) }\r\n    {              \r\n        for { let i_1 } lt(i_1, 0x60) { i_1 := add(i_1, 0x20) }\r\n        {\r\n            for { let i_2 } lt(i_2, 0x60) { i_2 := add(i_2, 0x2\r\n\r\n            {\r\n                for { } msize() { }\r\n                { }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nExample optimized code (2x \"slower\")\r\n\r\n```\r\n{\r\n    let i := 0\r\n\r\n    for { } 1 { i := add(i, 0x20) }\r\n    {                \r\n        if iszero(lt(i, 0x60)) { break }\r\n        let i_1 := 0 \r\n        for { } 1 { i_1 := add(i_1, 0x20) }\r\n        {            \r\n            if iszero(lt(i_1, 0x60)) { break }\r\n            let i_2 := 0\r\n            for { } 1 { i_2 := add(i_2, 0x20) }\r\n            {\r\n                if iszero(lt(i_2, 0x60)) { break }\r\n                for { } 1 { }\r\n                { if iszero(msize()) { break } }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nOne solution is to change these two\r\n\r\nhttps://github.com/ethereum/solidity/blob/34ba617ea6eec0bd4e2e9fd94dcbbb964626955e/test/tools/ossfuzz/yulProto_diff_ossfuzz.cpp#L121\r\n\r\nhttps://github.com/ethereum/solidity/blob/34ba617ea6eec0bd4e2e9fd94dcbbb964626955e/test/tools/ossfuzz/strictasm_diff_ossfuzz.cpp#L104\r\n\r\nto\r\n\r\n```\r\n(yul::test::yul_fuzzer::yulFuzzerUtil::maxSteps * 2)\r\n```",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/7424/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/7424/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/531290863",
    "html_url": "https://github.com/ethereum/solidity/issues/7424#issuecomment-531290863",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7424",
    "id": 531290863,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMTI5MDg2Mw==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-13T15:49:30Z",
    "updated_at": "2019-09-13T15:49:30Z",
    "author_association": "MEMBER",
    "body": "Will be solved by #7409",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/531290863/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
