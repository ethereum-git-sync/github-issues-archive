{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/6921",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/6921/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/6921/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/6921/events",
  "html_url": "https://github.com/ethereum/solidity/issues/6921",
  "id": 454219736,
  "node_id": "MDU6SXNzdWU0NTQyMTk3MzY=",
  "number": 6921,
  "title": "value unchanged when external calldata function call internal memory function",
  "user": {
    "login": "aihuawu",
    "id": 40734222,
    "node_id": "MDQ6VXNlcjQwNzM0MjIy",
    "avatar_url": "https://avatars.githubusercontent.com/u/40734222?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/aihuawu",
    "html_url": "https://github.com/aihuawu",
    "followers_url": "https://api.github.com/users/aihuawu/followers",
    "following_url": "https://api.github.com/users/aihuawu/following{/other_user}",
    "gists_url": "https://api.github.com/users/aihuawu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/aihuawu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/aihuawu/subscriptions",
    "organizations_url": "https://api.github.com/users/aihuawu/orgs",
    "repos_url": "https://api.github.com/users/aihuawu/repos",
    "events_url": "https://api.github.com/users/aihuawu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/aihuawu/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2019-06-10T15:10:11Z",
  "updated_at": "2019-06-11T10:32:20Z",
  "closed_at": "2019-06-11T10:32:20Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "struct A {\r\n     uint val;\r\n}\r\nlibrary lib {\r\n function f(A calldata a) external{\r\n   g(a);\r\n   // here I expect a.val == 1;\r\n   // but it is still a.val == 0;\r\n   // is this a bug???\r\n }\r\n function g(A memory a) internal{\r\n   a.val=1;\r\n }\r\n}",
  "closed_by": {
    "login": "aihuawu",
    "id": 40734222,
    "node_id": "MDQ6VXNlcjQwNzM0MjIy",
    "avatar_url": "https://avatars.githubusercontent.com/u/40734222?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/aihuawu",
    "html_url": "https://github.com/aihuawu",
    "followers_url": "https://api.github.com/users/aihuawu/followers",
    "following_url": "https://api.github.com/users/aihuawu/following{/other_user}",
    "gists_url": "https://api.github.com/users/aihuawu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/aihuawu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/aihuawu/subscriptions",
    "organizations_url": "https://api.github.com/users/aihuawu/orgs",
    "repos_url": "https://api.github.com/users/aihuawu/repos",
    "events_url": "https://api.github.com/users/aihuawu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/aihuawu/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/6921/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/6921/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/500729455",
    "html_url": "https://github.com/ethereum/solidity/issues/6921#issuecomment-500729455",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6921",
    "id": 500729455,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMDcyOTQ1NQ==",
    "user": {
      "login": "aihuawu",
      "id": 40734222,
      "node_id": "MDQ6VXNlcjQwNzM0MjIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/40734222?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aihuawu",
      "html_url": "https://github.com/aihuawu",
      "followers_url": "https://api.github.com/users/aihuawu/followers",
      "following_url": "https://api.github.com/users/aihuawu/following{/other_user}",
      "gists_url": "https://api.github.com/users/aihuawu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aihuawu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aihuawu/subscriptions",
      "organizations_url": "https://api.github.com/users/aihuawu/orgs",
      "repos_url": "https://api.github.com/users/aihuawu/repos",
      "events_url": "https://api.github.com/users/aihuawu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aihuawu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-11T07:52:39Z",
    "updated_at": "2019-06-11T07:52:39Z",
    "author_association": "NONE",
    "body": "It seems the it copy the memory value and so the value is unchanged.\r\n\r\nActually I want to use a deployed library to modify a memory location of the calling routine.\r\nThe following library code does not compile.\r\nHow can I modify a memory location through a deployed library?\r\n\r\nlibrary lib {\r\n\r\nstruct A {\r\nuint val;\r\n}\r\nfunction f(A calldata a) external{\r\na.val=1; // Error: Expression has to be an lvalue.\r\n}\r\n}\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/500729455/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/500776483",
    "html_url": "https://github.com/ethereum/solidity/issues/6921#issuecomment-500776483",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6921",
    "id": 500776483,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMDc3NjQ4Mw==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-11T10:07:01Z",
    "updated_at": "2019-06-11T10:07:01Z",
    "author_association": "MEMBER",
    "body": "It's not possible to write to calldata (calldata is read-only), so I don't think what you want is possible *without* copying to memory. So\r\n```\r\nfunction f(A memory a) public {\r\n  g(a);\r\n  assert(a.val == 1);\r\n}\r\nfunction g(A memory a) internal {\r\n  a.val = 1;\r\n}\r\n```\r\nshould work (but involves a ``calldata`` -> ``memory`` copy for every call to ``f``) - but you won't be able to modify an argument in ``calldata`` itself.\r\n\r\nSo I don't think this is in fact a bug - if you agree, please close the issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/500776483/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/500780778",
    "html_url": "https://github.com/ethereum/solidity/issues/6921#issuecomment-500780778",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6921",
    "id": 500780778,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMDc4MDc3OA==",
    "user": {
      "login": "aihuawu",
      "id": 40734222,
      "node_id": "MDQ6VXNlcjQwNzM0MjIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/40734222?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aihuawu",
      "html_url": "https://github.com/aihuawu",
      "followers_url": "https://api.github.com/users/aihuawu/followers",
      "following_url": "https://api.github.com/users/aihuawu/following{/other_user}",
      "gists_url": "https://api.github.com/users/aihuawu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aihuawu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aihuawu/subscriptions",
      "organizations_url": "https://api.github.com/users/aihuawu/orgs",
      "repos_url": "https://api.github.com/users/aihuawu/repos",
      "events_url": "https://api.github.com/users/aihuawu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aihuawu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-11T10:20:26Z",
    "updated_at": "2019-06-11T10:20:26Z",
    "author_association": "NONE",
    "body": "@ekpyron \r\nThanks.\r\nCan you also answer my second question above?\r\n\r\nI have a utility library deployed.  The methods are public or external.\r\nI can't use internal since the master contract size can't go above 6.7M gas.\r\n\r\nThe utility library is separate and \r\nit is supposed to be able to modify a storage and memory of the calling contract.\r\nFor storage, it is reference, so no problem.\r\nBut for memory, it is copied and I am unable to modify it in the utility library.\r\nI need some way to modify the memory of the calling routine in the utility library.\r\nIs it possible?\r\n\r\ngeorge wu\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/500780778/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/500783379",
    "html_url": "https://github.com/ethereum/solidity/issues/6921#issuecomment-500783379",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6921",
    "id": 500783379,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMDc4MzM3OQ==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-11T10:29:22Z",
    "updated_at": "2019-06-11T10:29:22Z",
    "author_association": "MEMBER",
    "body": "External library functions will be called using ``DELEGATECALL``, which will retain the calling contract's storage, but it's still a proper call, so the library will get it's own memory (and not retain the memory of the caller), so it's not possible to pass a memory reference, resp. modify memory across external library calls. You could e.g. pass it as argument to the library function and return it, but that will, of course, involve copies, but there's no way around that.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/500783379/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/500784303",
    "html_url": "https://github.com/ethereum/solidity/issues/6921#issuecomment-500784303",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6921",
    "id": 500784303,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMDc4NDMwMw==",
    "user": {
      "login": "aihuawu",
      "id": 40734222,
      "node_id": "MDQ6VXNlcjQwNzM0MjIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/40734222?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aihuawu",
      "html_url": "https://github.com/aihuawu",
      "followers_url": "https://api.github.com/users/aihuawu/followers",
      "following_url": "https://api.github.com/users/aihuawu/following{/other_user}",
      "gists_url": "https://api.github.com/users/aihuawu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aihuawu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aihuawu/subscriptions",
      "organizations_url": "https://api.github.com/users/aihuawu/orgs",
      "repos_url": "https://api.github.com/users/aihuawu/repos",
      "events_url": "https://api.github.com/users/aihuawu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aihuawu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-11T10:32:20Z",
    "updated_at": "2019-06-11T10:32:20Z",
    "author_association": "NONE",
    "body": "Thank you.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/500784303/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
