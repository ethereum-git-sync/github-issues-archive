{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/6870",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/6870/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/6870/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/6870/events",
  "html_url": "https://github.com/ethereum/solidity/issues/6870",
  "id": 449857457,
  "node_id": "MDU6SXNzdWU0NDk4NTc0NTc=",
  "number": 6870,
  "title": "[ossfuzz] reproducing use-after-free bug reported by ossfuzz CI on 28.05.19",
  "user": {
    "login": "bshastry",
    "id": 2388185,
    "node_id": "MDQ6VXNlcjIzODgxODU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bshastry",
    "html_url": "https://github.com/bshastry",
    "followers_url": "https://api.github.com/users/bshastry/followers",
    "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
    "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
    "organizations_url": "https://api.github.com/users/bshastry/orgs",
    "repos_url": "https://api.github.com/users/bshastry/repos",
    "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bshastry/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2019-05-29T14:54:31Z",
  "updated_at": "2019-05-31T06:11:37Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nThe ossfuzz nightly CI reported two bugs from it's last run\r\n\r\nhttps://circleci.com/gh/ethereum/solidity/131898\r\n\r\nOne of them has been filed here https://github.com/ethereum/solidity/issues/6864\r\n\r\nSince the other one was hard to triage, I created a dockerfile for easier replication.\r\n\r\nHere's the full report as a gist: https://gist.github.com/bshastry/d58ffdd29f3317c83f3db483ac84b407\r\n\r\nDockerfile to use\r\n```\r\nFROM ubuntu:disco\r\n\r\nRUN apt update\r\nRUN apt -y install subversion git wget clang-8 cmake libboost-regex-dev libboost-filesystem-dev libboost-test-dev libboost-system-dev libboost-program-options-dev libcvc4-dev libbz2-dev ninja-build zlib1g-dev vim libjsoncpp-dev=1.7.4-\\*\r\nRUN git clone https://github.com/ethereum/solidity.git\r\nRUN git clone https://github.com/ethereum/solidity-fuzzing-corpus.git\r\nRUN cd solidity && CC=clang-8 CXX=clang++-8 ./scripts/install_lpm.sh && CC=clang-8 CXX=clang++-8 ./scripts/install_libfuzzer.sh\r\nRUN /src/LPM/external.protobuf/bin/protoc --proto_path=solidity/test/tools/ossfuzz yulProto.proto --cpp_out=solidity/test/tools/ossfuzz\r\nRUN mkdir solidity/build\r\nRUN cd solidity/build && cmake -DOSSFUZZ=1 -DCMAKE_TOOLCHAIN_FILE=cmake/toolchains/libfuzzer.cmake -DCMAKE_CXX_COMPILER=clang++-8 -DCMAKE_C_COMPILER=clang-8 .. && make ossfuzz -j2\r\nRUN wget https://gist.githubusercontent.com/bshastry/409de43438f9ed38d34fc54d89e18474/raw/eaf7ee72c2d8094726180e85a53b55c9f4f8f5cb/list_of_failing_inputs.txt\r\n```\r\n\r\nSteps to reproduce use-after-free bug:\r\n\r\n```\r\n$ cd <path_to_dockerfile>\r\n$ docker build . -t ossfuzz\r\n$ docker image ls\r\n$ docker run -it -exec=/bin/bash ossfuzz\r\n$ cat list_of_failing_inputs.txt | xargs ./solidity/build/test/tools/ossfuzz/strictasm_diff_ossfuzz &>> log\r\n$ cat log\r\n```\r\n\r\nThe details of the use-after-free reported by ASan will be logged to the file in `log` in the root filesystem of the docker container. It can be viewed with a text editor like vim.\r\n\r\n## Environment\r\n\r\n- Compiler version: latest develop",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/6870/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/6870/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/496994269",
    "html_url": "https://github.com/ethereum/solidity/issues/6870#issuecomment-496994269",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6870",
    "id": 496994269,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5Njk5NDI2OQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-29T15:46:55Z",
    "updated_at": "2019-05-29T15:46:55Z",
    "author_association": "MEMBER",
    "body": "So this is not even related to the optimizer?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/496994269/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/497009395",
    "html_url": "https://github.com/ethereum/solidity/issues/6870#issuecomment-497009395",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6870",
    "id": 497009395,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NzAwOTM5NQ==",
    "user": {
      "login": "bshastry",
      "id": 2388185,
      "node_id": "MDQ6VXNlcjIzODgxODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bshastry",
      "html_url": "https://github.com/bshastry",
      "followers_url": "https://api.github.com/users/bshastry/followers",
      "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
      "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
      "organizations_url": "https://api.github.com/users/bshastry/orgs",
      "repos_url": "https://api.github.com/users/bshastry/repos",
      "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bshastry/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-29T16:24:45Z",
    "updated_at": "2019-05-29T16:24:45Z",
    "author_association": "MEMBER",
    "body": "It doesn't look like. Looks like a new bug during the destruction of the Assembly stack object.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/497009395/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/497033640",
    "html_url": "https://github.com/ethereum/solidity/issues/6870#issuecomment-497033640",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6870",
    "id": 497033640,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NzAzMzY0MA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-29T17:29:56Z",
    "updated_at": "2019-05-29T17:29:56Z",
    "author_association": "MEMBER",
    "body": "Can you say in which way it is new?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/497033640/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/497189217",
    "html_url": "https://github.com/ethereum/solidity/issues/6870#issuecomment-497189217",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6870",
    "id": 497189217,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NzE4OTIxNw==",
    "user": {
      "login": "bshastry",
      "id": 2388185,
      "node_id": "MDQ6VXNlcjIzODgxODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bshastry",
      "html_url": "https://github.com/bshastry",
      "followers_url": "https://api.github.com/users/bshastry/followers",
      "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
      "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
      "organizations_url": "https://api.github.com/users/bshastry/orgs",
      "repos_url": "https://api.github.com/users/bshastry/repos",
      "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bshastry/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-30T03:32:25Z",
    "updated_at": "2019-05-30T03:32:25Z",
    "author_association": "MEMBER",
    "body": "Oh I just meant that I've never seen a use after free bug report from the fuzzer for Solidity before this.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/497189217/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/497337326",
    "html_url": "https://github.com/ethereum/solidity/issues/6870#issuecomment-497337326",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6870",
    "id": 497337326,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NzMzNzMyNg==",
    "user": {
      "login": "bshastry",
      "id": 2388185,
      "node_id": "MDQ6VXNlcjIzODgxODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bshastry",
      "html_url": "https://github.com/bshastry",
      "followers_url": "https://api.github.com/users/bshastry/followers",
      "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
      "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
      "organizations_url": "https://api.github.com/users/bshastry/orgs",
      "repos_url": "https://api.github.com/users/bshastry/repos",
      "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bshastry/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-30T13:53:28Z",
    "updated_at": "2019-05-31T06:11:37Z",
    "author_association": "MEMBER",
    "body": "I can confirm that the use-after-free does not reproduce on a bionic build.\r\n\r\nDistro | Library | version |\r\n--------|-----------|-----------\r\nbionic | libstdc++ | 6.0.25\r\ndisco | libstdc++ | 6.0.26\r\nbionic | libboost-dev-all | 1.65.1\r\ndisco | libboost-dev-all | 1.67.0.1\r\n\r\nMy hunch is that the bug has more to do with the newer version of boost than libstdc++ because the use after free involves a boost variant",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/497337326/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
