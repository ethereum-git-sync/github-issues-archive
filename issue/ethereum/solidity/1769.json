{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/1769",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/1769/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/1769/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/1769/events",
  "html_url": "https://github.com/ethereum/solidity/issues/1769",
  "id": 213419093,
  "node_id": "MDU6SXNzdWUyMTM0MTkwOTM=",
  "number": 1769,
  "title": "Problem with internal passing of structs",
  "user": {
    "login": "VoR0220",
    "id": 7756785,
    "node_id": "MDQ6VXNlcjc3NTY3ODU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7756785?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/VoR0220",
    "html_url": "https://github.com/VoR0220",
    "followers_url": "https://api.github.com/users/VoR0220/followers",
    "following_url": "https://api.github.com/users/VoR0220/following{/other_user}",
    "gists_url": "https://api.github.com/users/VoR0220/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/VoR0220/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/VoR0220/subscriptions",
    "organizations_url": "https://api.github.com/users/VoR0220/orgs",
    "repos_url": "https://api.github.com/users/VoR0220/repos",
    "events_url": "https://api.github.com/users/VoR0220/events{/privacy}",
    "received_events_url": "https://api.github.com/users/VoR0220/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "axic",
    "id": 20340,
    "node_id": "MDQ6VXNlcjIwMzQw",
    "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/axic",
    "html_url": "https://github.com/axic",
    "followers_url": "https://api.github.com/users/axic/followers",
    "following_url": "https://api.github.com/users/axic/following{/other_user}",
    "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
    "organizations_url": "https://api.github.com/users/axic/orgs",
    "repos_url": "https://api.github.com/users/axic/repos",
    "events_url": "https://api.github.com/users/axic/events{/privacy}",
    "received_events_url": "https://api.github.com/users/axic/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2017-03-10T18:39:39Z",
  "updated_at": "2017-08-08T13:53:49Z",
  "closed_at": "2017-08-08T13:53:45Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "I managed to create minimum reproducible build of this error involving internal passing of structs. \r\n\r\nNote the below code:\r\n\r\n```\r\npragma solidity >=0.0.0;\r\n\r\nlibrary Model {\r\n\r\n    struct DataMap {\r\n        mapping(bytes32 => DataElement) rows;\r\n        bytes32[] keys;\r\n        uint size;\r\n    }\r\n\r\n    struct DataElement {\r\n        bool exists;\r\n        uint keyIdx;\r\n        Data data;\r\n    }\r\n\r\n    struct Data {\r\n        bytes32 id;\r\n        uint uintValue;\r\n        bytes32 bytes32Value;\r\n        address addressValue;\r\n        bool boolValue;\r\n    }\r\n}\r\n\r\nlibrary Api {\r\n   function get(Model.DataMap storage _map, bytes32 _id) internal returns (Model.Data);\r\n}\r\n\r\ncontract Process {\r\n\r\n    using Api for Model.DataMap;\r\n\r\n    Model.DataMap processData;\r\n\r\n    function getDataAsAddress(bytes32 _id) constant returns (address) {\r\n        Model.Data memory data = processData.get(_id);\r\n        return data.addressValue;\r\n    }\r\n\r\n}\r\n```\r\n\r\nThis does not compile currently although it probably should based on our current documentation (unless I'm missing something). This produces the following error:\r\n\r\n```\r\nInternal compiler error during compilation:\r\n/Users/vor0220/solidity/libsolidity/codegen/ContractCompiler.cpp(843): Throw in function void dev::solidity::ContractCompiler::appendModifierOrFunctionCode()\r\nDynamic exception type: boost::exception_detail::clone_impl<dev::solidity::InternalCompilerError>\r\nstd::exception::what: std::exception\r\n[dev::tag_comment*] =\r\n```\r\n\r\nThe error can be turned off at the cost of not being able to publicly retrieve the variable in getDataAsAddress by making the return an internal return. How might one go about alleviating this? Either way we need to come up with a better error if indeed this is intended functionality. ",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/1769/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/1769/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/285751878",
    "html_url": "https://github.com/ethereum/solidity/issues/1769#issuecomment-285751878",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1769",
    "id": 285751878,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NTc1MTg3OA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-10T18:47:48Z",
    "updated_at": "2017-03-10T18:47:48Z",
    "author_association": "MEMBER",
    "body": "You can fix it easily by adding an implementation for `Api.get`.\r\nWhether or not libraries that do not implement all functions should be allowed or not is a decision we have to make, I think.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/285751878/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/285756310",
    "html_url": "https://github.com/ethereum/solidity/issues/1769#issuecomment-285756310",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1769",
    "id": 285756310,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NTc1NjMxMA==",
    "user": {
      "login": "VoR0220",
      "id": 7756785,
      "node_id": "MDQ6VXNlcjc3NTY3ODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7756785?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/VoR0220",
      "html_url": "https://github.com/VoR0220",
      "followers_url": "https://api.github.com/users/VoR0220/followers",
      "following_url": "https://api.github.com/users/VoR0220/following{/other_user}",
      "gists_url": "https://api.github.com/users/VoR0220/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/VoR0220/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/VoR0220/subscriptions",
      "organizations_url": "https://api.github.com/users/VoR0220/orgs",
      "repos_url": "https://api.github.com/users/VoR0220/repos",
      "events_url": "https://api.github.com/users/VoR0220/events{/privacy}",
      "received_events_url": "https://api.github.com/users/VoR0220/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-10T19:05:18Z",
    "updated_at": "2017-03-10T19:05:18Z",
    "author_association": "MEMBER",
    "body": "One reason why this decision was made was to create a potential to create proprietary smart contracts and obfuscate binaries in general, only exposing an API. I would recommend that if the decision is made to get rid of libraries that do not implement all functions, that it come with something akin to @axic 's proposal of an interface type of some kind that can communicate with the libraries via an API format. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/285756310/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/285757815",
    "html_url": "https://github.com/ethereum/solidity/issues/1769#issuecomment-285757815",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1769",
    "id": 285757815,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NTc1NzgxNQ==",
    "user": {
      "login": "j-h-scheufen",
      "id": 1975494,
      "node_id": "MDQ6VXNlcjE5NzU0OTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1975494?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/j-h-scheufen",
      "html_url": "https://github.com/j-h-scheufen",
      "followers_url": "https://api.github.com/users/j-h-scheufen/followers",
      "following_url": "https://api.github.com/users/j-h-scheufen/following{/other_user}",
      "gists_url": "https://api.github.com/users/j-h-scheufen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/j-h-scheufen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/j-h-scheufen/subscriptions",
      "organizations_url": "https://api.github.com/users/j-h-scheufen/orgs",
      "repos_url": "https://api.github.com/users/j-h-scheufen/repos",
      "events_url": "https://api.github.com/users/j-h-scheufen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/j-h-scheufen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-10T19:11:44Z",
    "updated_at": "2017-03-10T19:11:44Z",
    "author_association": "NONE",
    "body": "Interesting, thanks for the super fast comment, @chriseth! You're saying if we convert the API library to have functions with an (empty) implementation instead of abstract functions, the error would be avoided?\r\nCan you confirm if this problem is connected to the passing of structs? Because the same setup using only primitives as function parameters / return values seems to work fine.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/285757815/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/285758553",
    "html_url": "https://github.com/ethereum/solidity/issues/1769#issuecomment-285758553",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1769",
    "id": 285758553,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NTc1ODU1Mw==",
    "user": {
      "login": "VoR0220",
      "id": 7756785,
      "node_id": "MDQ6VXNlcjc3NTY3ODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7756785?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/VoR0220",
      "html_url": "https://github.com/VoR0220",
      "followers_url": "https://api.github.com/users/VoR0220/followers",
      "following_url": "https://api.github.com/users/VoR0220/following{/other_user}",
      "gists_url": "https://api.github.com/users/VoR0220/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/VoR0220/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/VoR0220/subscriptions",
      "organizations_url": "https://api.github.com/users/VoR0220/orgs",
      "repos_url": "https://api.github.com/users/VoR0220/repos",
      "events_url": "https://api.github.com/users/VoR0220/events{/privacy}",
      "received_events_url": "https://api.github.com/users/VoR0220/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-10T19:14:31Z",
    "updated_at": "2017-03-10T19:14:31Z",
    "author_association": "MEMBER",
    "body": "@j-h-scheufen no he's saying that we need to implement the function (aka, it cannot be abstracted). That gets it running. Might not be aware of the latter though and that might churn some discussion. Perhaps we should provide an example? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/285758553/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/287400088",
    "html_url": "https://github.com/ethereum/solidity/issues/1769#issuecomment-287400088",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1769",
    "id": 287400088,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NzQwMDA4OA==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-17T16:17:24Z",
    "updated_at": "2017-03-17T16:18:19Z",
    "author_association": "MEMBER",
    "body": "Right now, the proposed `Interface` keyword (#1688) aims to map the *external interface* of a deployed contract, which is what the ABI defines.\r\n\r\nOnce structs become part of the ABI, we could consider supporting them in interfaces. In that case, this could work:\r\n\r\n```\r\ninterface Model {\r\n  ...\r\n}\r\n\r\nlibrary Api is Model {\r\n   function get(Model.DataMap storage _map, bytes32 _id) internal returns (Model.Data);\r\n}\r\n```\r\n\r\nAlthough I think `Model` looks cleaner being part of a library.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/287400088/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/318327232",
    "html_url": "https://github.com/ethereum/solidity/issues/1769#issuecomment-318327232",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1769",
    "id": 318327232,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxODMyNzIzMg==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-27T10:46:12Z",
    "updated_at": "2017-07-27T10:46:12Z",
    "author_association": "MEMBER",
    "body": "I think in order to close this off we should just emit the correct error and not let it reach an ICE.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/318327232/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/320233478",
    "html_url": "https://github.com/ethereum/solidity/issues/1769#issuecomment-320233478",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1769",
    "id": 320233478,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMyMDIzMzQ3OA==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-08-04T12:13:01Z",
    "updated_at": "2017-08-04T12:13:01Z",
    "author_association": "MEMBER",
    "body": "Shortest example to trigger the problem:\r\n```\r\nlibrary L {\r\n  function f() internal;\r\n}\r\n\r\ncontract C {\r\n  function g() { L.f(); }\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/320233478/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
