{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/11709",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/11709/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/11709/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/11709/events",
  "html_url": "https://github.com/ethereum/solidity/issues/11709",
  "id": 954210031,
  "node_id": "MDU6SXNzdWU5NTQyMTAwMzE=",
  "number": 11709,
  "title": "[Codegen] Legacy codegen does not check for freememptr overflow (beyond UINT64_MAX), Sol->Yul does",
  "user": {
    "login": "bshastry",
    "id": 2388185,
    "node_id": "MDQ6VXNlcjIzODgxODU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bshastry",
    "html_url": "https://github.com/bshastry",
    "followers_url": "https://api.github.com/users/bshastry/followers",
    "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
    "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
    "organizations_url": "https://api.github.com/users/bshastry/orgs",
    "repos_url": "https://api.github.com/users/bshastry/repos",
    "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bshastry/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-07-27T19:43:08Z",
  "updated_at": "2021-07-29T08:07:06Z",
  "closed_at": "2021-07-29T08:07:06Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "```\r\npragma abicoder v2;\r\ncontract C {\r\nfunction f() public {\r\n    uint[][] memory arr = new uint[][](1);\r\n    // This allocation overflows the freememptr\r\n    // which makes Sol->Yul panic with code 0x41.\r\n    arr[0] = new uint[](18446744073709551612);\r\n}\r\n}\r\n// ====\r\n// compileViaYul: also\r\n// ----\r\n// f() -> FAILURE\r\n```\r\n\r\nLegacy failure is due to out-of-gas, Sol->Yul is a revert with a modest amount of gas consumed ~21k.",
  "closed_by": {
    "login": "hrkrshnn",
    "id": 13174375,
    "node_id": "MDQ6VXNlcjEzMTc0Mzc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/13174375?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hrkrshnn",
    "html_url": "https://github.com/hrkrshnn",
    "followers_url": "https://api.github.com/users/hrkrshnn/followers",
    "following_url": "https://api.github.com/users/hrkrshnn/following{/other_user}",
    "gists_url": "https://api.github.com/users/hrkrshnn/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hrkrshnn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hrkrshnn/subscriptions",
    "organizations_url": "https://api.github.com/users/hrkrshnn/orgs",
    "repos_url": "https://api.github.com/users/hrkrshnn/repos",
    "events_url": "https://api.github.com/users/hrkrshnn/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hrkrshnn/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/11709/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/11709/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/887795572",
    "html_url": "https://github.com/ethereum/solidity/issues/11709#issuecomment-887795572",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11709",
    "id": 887795572,
    "node_id": "IC_kwDOAm_5kc406q90",
    "user": {
      "login": "bshastry",
      "id": 2388185,
      "node_id": "MDQ6VXNlcjIzODgxODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bshastry",
      "html_url": "https://github.com/bshastry",
      "followers_url": "https://api.github.com/users/bshastry/followers",
      "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
      "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
      "organizations_url": "https://api.github.com/users/bshastry/orgs",
      "repos_url": "https://api.github.com/users/bshastry/repos",
      "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bshastry/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-27T20:00:58Z",
    "updated_at": "2021-07-27T20:00:58Z",
    "author_association": "MEMBER",
    "body": "Clubbing a somewhat similar report\r\n\r\n```\r\nfunction exp(uint base, uint exponent) pure returns (uint power) {\r\nif (exponent == 0)\r\n    return 1;\r\npower = exp(base, exponent / 2);\r\npower *= power;\r\nif (exponent & 1 == 1)\r\n    power *= base;\r\n}\r\n\r\ncontract C {\r\n  function g(uint base, uint exponent) public pure returns (uint) {\r\n  return exp(base, exponent);\r\n  }\r\n}\r\n// ====\r\n// compileViaYul: also\r\n// ----\r\n// g(uint256, uint256): 55558612478609019528521988286241949159871555179327291270583879839857001820084,15045494086288292508913825510347384281681719338099058151627027489948519117802 -> FAILURE\r\n```\r\n\r\npasses but with different EVMC status codes\r\n\r\nLegacy: Stack underflow\r\nSol->Yul: Revert",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/887795572/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/887817986",
    "html_url": "https://github.com/ethereum/solidity/issues/11709#issuecomment-887817986",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11709",
    "id": 887817986,
    "node_id": "IC_kwDOAm_5kc406wcC",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-27T20:37:30Z",
    "updated_at": "2021-07-27T20:38:24Z",
    "author_association": "MEMBER",
    "body": "> passes but with different EVMC status codes\r\n>\r\n> Legacy: Stack underflow\r\n> Sol->Yul: Revert\r\n\r\nHm perhaps it would be a good reason for us to extend isoltest to output `FAILURE (<evmc code>)`.  While the \"evmc code\" does not matter for mainnet, it is a useful tool to show if the two codegen implementations differ. In some cases we want them to differ, but in others we may not anticipate it.\r\n\r\nIn this particular case, the \"stack underflow\" error in the legacy is a bit worrying.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/887817986/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/888116874",
    "html_url": "https://github.com/ethereum/solidity/issues/11709#issuecomment-888116874",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11709",
    "id": 888116874,
    "node_id": "IC_kwDOAm_5kc4075aK",
    "user": {
      "login": "bshastry",
      "id": 2388185,
      "node_id": "MDQ6VXNlcjIzODgxODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bshastry",
      "html_url": "https://github.com/bshastry",
      "followers_url": "https://api.github.com/users/bshastry/followers",
      "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
      "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
      "organizations_url": "https://api.github.com/users/bshastry/orgs",
      "repos_url": "https://api.github.com/users/bshastry/repos",
      "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bshastry/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-28T08:24:36Z",
    "updated_at": "2021-07-28T08:24:36Z",
    "author_association": "MEMBER",
    "body": "I think the first test case in this thread (out-of-gas vs revert) is due to Sol->Yul inserting a `panic(0x41)` for freememptr overflow that happens due to a very large memory allocation. This panic is part of `finalize_allocation` Yul function. I assume that the legacy code gen does not factor freememptr overflow into account in this scenario.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/888116874/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/888253206",
    "html_url": "https://github.com/ethereum/solidity/issues/11709#issuecomment-888253206",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/11709",
    "id": 888253206,
    "node_id": "IC_kwDOAm_5kc408asW",
    "user": {
      "login": "bshastry",
      "id": 2388185,
      "node_id": "MDQ6VXNlcjIzODgxODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bshastry",
      "html_url": "https://github.com/bshastry",
      "followers_url": "https://api.github.com/users/bshastry/followers",
      "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
      "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
      "organizations_url": "https://api.github.com/users/bshastry/orgs",
      "repos_url": "https://api.github.com/users/bshastry/repos",
      "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bshastry/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-28T12:03:05Z",
    "updated_at": "2021-07-28T12:03:05Z",
    "author_association": "MEMBER",
    "body": "> Clubbing a somewhat similar report\r\n> \r\n> ```\r\n> function exp(uint base, uint exponent) pure returns (uint power) {\r\n> if (exponent == 0)\r\n>     return 1;\r\n> power = exp(base, exponent / 2);\r\n> power *= power;\r\n> if (exponent & 1 == 1)\r\n>     power *= base;\r\n> }\r\n> \r\n> contract C {\r\n>   function g(uint base, uint exponent) public pure returns (uint) {\r\n>   return exp(base, exponent);\r\n>   }\r\n> }\r\n> // ====\r\n> // compileViaYul: also\r\n> // ----\r\n> // g(uint256, uint256): 55558612478609019528521988286241949159871555179327291270583879839857001820084,15045494086288292508913825510347384281681719338099058151627027489948519117802 -> FAILURE\r\n> ```\r\n> \r\n> passes but with different EVMC status codes\r\n> \r\n> Legacy: Stack underflow\r\n> Sol->Yul: Revert\r\n\r\nCreated a new issue for this (see https://github.com/ethereum/solidity/issues/11715) since it is most likely unrelated to free memory pointer overflow that this issue tracks (to be fixed by the linked PR).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/888253206/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
