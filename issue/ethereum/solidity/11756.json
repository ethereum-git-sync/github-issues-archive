{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/11756",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/11756/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/11756/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/11756/events",
  "html_url": "https://github.com/ethereum/solidity/issues/11756",
  "id": 963081278,
  "node_id": "MDU6SXNzdWU5NjMwODEyNzg=",
  "number": 11756,
  "title": "`absolutePath` should be available for imports in the AST when using `stopAfter: parsing`",
  "user": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 838064207,
      "node_id": "MDU6TGFiZWw4MzgwNjQyMDc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/annoys%20users%20:cry:",
      "name": "annoys users :cry:",
      "color": "ea2cab",
      "default": false,
      "description": ""
    },
    {
      "id": 1017612679,
      "node_id": "MDU6TGFiZWwxMDE3NjEyNjc5",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/protocol%20design%20:crystal_ball:",
      "name": "protocol design :crystal_ball:",
      "color": "8af77e",
      "default": false,
      "description": "Potential changes to ABI, meta data, standard JSON"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "Marenz",
    "id": 424752,
    "node_id": "MDQ6VXNlcjQyNDc1Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Marenz",
    "html_url": "https://github.com/Marenz",
    "followers_url": "https://api.github.com/users/Marenz/followers",
    "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
    "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
    "organizations_url": "https://api.github.com/users/Marenz/orgs",
    "repos_url": "https://api.github.com/users/Marenz/repos",
    "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Marenz/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "Marenz",
      "id": 424752,
      "node_id": "MDQ6VXNlcjQyNDc1Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/424752?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Marenz",
      "html_url": "https://github.com/Marenz",
      "followers_url": "https://api.github.com/users/Marenz/followers",
      "following_url": "https://api.github.com/users/Marenz/following{/other_user}",
      "gists_url": "https://api.github.com/users/Marenz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Marenz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Marenz/subscriptions",
      "organizations_url": "https://api.github.com/users/Marenz/orgs",
      "repos_url": "https://api.github.com/users/Marenz/repos",
      "events_url": "https://api.github.com/users/Marenz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Marenz/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2021-08-06T22:27:08Z",
  "updated_at": "2021-11-08T16:06:21Z",
  "closed_at": "2021-11-08T16:06:21Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Abstract\r\nTools should be using `absolutePath` from `ImportDirective` AST node for more reliable import resolution but it's not available when `stopAfter: parsing` option is used - even though that's when they need it the most.\r\n\r\n## Motivation\r\nOne of the uses case for `stopAfter: parsing` is to make it possible for tools to easily scan source files for imports. The raw path used in the import statement however is of limited utility - many tools are actually interested in a resolved path that can be used as a key in `sources` in Standard JSON. This resolution must account for [relative imports](https://docs.soliditylang.org/en/latest/path-resolution.html#relative-imports) and [remappings](https://docs.soliditylang.org/en/latest/path-resolution.html#import-remapping) and current compiler logic for doing that is full of unintuitive corner cases so it's easy to get it wrong. Doing it wrong, however, results in the compiler not being able to find the file matching the import where it expects it to be.\r\n\r\nThe compiler does make the resolved path available in the AST but it's not there yet when `stopAfter: parsing` setting is used.\r\n\r\n## Specification\r\nEither perform import resolution earlier so that `absolutePath` is already in the AST when `stopAfter: parsing` is used or introduce a new value for `stopAfter` (`parsingAndImportResolution`?) that still stops before analysis but after import resolution.\r\n\r\n## Backwards Compatibility\r\nMaking a previously unavailable AST key available is fully backwards-compatible.\r\n\r\n## Example showing the current output\r\n### With `stopAfter: parsing`\r\n#### Input\r\n```json\r\n{\r\n    \"language\": \"Solidity\",\r\n    \"sources\": {\r\n        \"/project/../C.sol\": {\"content\": \"import \\\"../L.sol\\\";\"}\r\n    },\r\n    \"settings\": {\r\n        \"stopAfter\": \"parsing\",\r\n        \"remappings\": [\":/project/=/lib/\"],\r\n        \"outputSelection\": {\"*\": {\"\": [\"ast\"]}}\r\n    }\r\n}\r\n```\r\n#### AST from the output\r\n```json\r\n{\r\n    \"sources\": {\r\n        \"/project/../C.sol\": {\r\n            \"ast\": {\r\n                \"absolutePath\": \"/project/../C.sol\",\r\n                \"id\": 2,\r\n                \"nodeType\": \"SourceUnit\",\r\n                \"nodes\": [\r\n                    {\r\n                        \"file\": \"../L.sol\",\r\n                        \"id\": 1,\r\n                        \"nameLocation\": \"-1:-1:-1\",\r\n                        \"nodeType\": \"ImportDirective\",\r\n                        \"src\": \"0:18:0\",\r\n                        \"symbolAliases\": [],\r\n                        \"unitAlias\": \"\"\r\n                    }\r\n                ],\r\n                \"src\": \"0:18:0\"\r\n            },\r\n            \"id\": 0\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n### Without `stopAfter: parsing`\r\n#### Input\r\n```json\r\n{\r\n    \"language\": \"Solidity\",\r\n    \"sources\": {\r\n        \"/project/../C.sol\": {\"content\": \"import \\\"../L.sol\\\";\"},\r\n        \"/lib/L.sol\": {\"content\": \"\"}\r\n    },\r\n    \"settings\": {\r\n        \"remappings\": [\":/project/=/lib/\"],\r\n        \"outputSelection\": {\"*\": {\"\": [\"ast\"]}}\r\n    }\r\n}\r\n```\r\n#### AST from the output\r\n```json\r\n{\r\n    \"sources\": {\r\n        \"/lib/L.sol\": {\r\n            \"ast\": {\r\n                \"absolutePath\": \"/lib/L.sol\",\r\n                \"exportedSymbols\": {},\r\n                \"id\": 1,\r\n                \"nodeType\": \"SourceUnit\",\r\n                \"nodes\": [],\r\n                \"src\": \"0:0:0\"\r\n            },\r\n            \"id\": 0\r\n        },\r\n        \"/project/../C.sol\": {\r\n            \"ast\": {\r\n                \"absolutePath\": \"/project/../C.sol\",\r\n                \"exportedSymbols\": {},\r\n                \"id\": 3,\r\n                \"nodeType\": \"SourceUnit\",\r\n                \"nodes\": [\r\n                    {\r\n                        \"absolutePath\": \"/lib/L.sol\",\r\n                        \"file\": \"../L.sol\",\r\n                        \"id\": 2,\r\n                        \"nameLocation\": \"-1:-1:-1\",\r\n                        \"nodeType\": \"ImportDirective\",\r\n                        \"scope\": 3,\r\n                        \"sourceUnit\": 1,\r\n                        \"src\": \"0:18:1\",\r\n                        \"symbolAliases\": [],\r\n                        \"unitAlias\": \"\"\r\n                    }\r\n                ],\r\n                \"src\": \"0:18:1\"\r\n            },\r\n            \"id\": 1\r\n        }\r\n    }\r\n}\r\n```",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/11756/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/11756/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
