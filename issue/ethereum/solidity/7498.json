{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/7498",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/7498/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/7498/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/7498/events",
  "html_url": "https://github.com/ethereum/solidity/issues/7498",
  "id": 500972966,
  "node_id": "MDU6SXNzdWU1MDA5NzI5NjY=",
  "number": 7498,
  "title": "Type checker: do not use ``validForCalldata`` for memory arrays or rename it.",
  "user": {
    "login": "ekpyron",
    "id": 1347491,
    "node_id": "MDQ6VXNlcjEzNDc0OTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ekpyron",
    "html_url": "https://github.com/ekpyron",
    "followers_url": "https://api.github.com/users/ekpyron/followers",
    "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
    "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
    "organizations_url": "https://api.github.com/users/ekpyron/orgs",
    "repos_url": "https://api.github.com/users/ekpyron/repos",
    "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ekpyron/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 717596767,
      "node_id": "MDU6TGFiZWw3MTc1OTY3Njc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "006b75",
      "default": true,
      "description": ""
    },
    {
      "id": 1012614086,
      "node_id": "MDU6TGFiZWwxMDEyNjE0MDg2",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/medium%20difficulty",
      "name": "medium difficulty",
      "color": "7dcddb",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2019-10-01T15:26:28Z",
  "updated_at": "2020-05-07T18:59:22Z",
  "closed_at": "2020-05-07T18:59:21Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Came up in https://github.com/ethereum/solidity/pull/7496.\r\nThe fix in https://github.com/ethereum/solidity/pull/7496 allows to use ``isDynamicallyEncoded`` for types without interface types (i.e. recursive structs), which is somewhat counter-intuitive.\r\nThe reason why that's necessary is that the type checker uses ``validForCalldata`` for memory arrays. We should investigate which part of ``validForCalldata`` applies to memory arrays and adjust the check accordingly.\r\nEDIT: the main reason to call the function is to prevent extremely large memory arrays - if we want to exclude them we should do that by ways of ``memoryStride()``, etc., instead of reusing the calldata code, though.",
  "closed_by": {
    "login": "ekpyron",
    "id": 1347491,
    "node_id": "MDQ6VXNlcjEzNDc0OTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ekpyron",
    "html_url": "https://github.com/ekpyron",
    "followers_url": "https://api.github.com/users/ekpyron/followers",
    "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
    "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
    "organizations_url": "https://api.github.com/users/ekpyron/orgs",
    "repos_url": "https://api.github.com/users/ekpyron/repos",
    "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ekpyron/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/7498/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/7498/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/537095316",
    "html_url": "https://github.com/ethereum/solidity/issues/7498#issuecomment-537095316",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7498",
    "id": 537095316,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzNzA5NTMxNg==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-01T15:36:48Z",
    "updated_at": "2019-10-01T15:36:48Z",
    "author_association": "MEMBER",
    "body": "Potential simple solution: rename ``validForCalldata`` to something like ``hasSufficientlySmallStaticSize`` (name to be improved upon ;-)) and use ``unlimitedStaticSize`` (to be implemented) which uses ``memoryStride`` instead of ``calldataStride`` for memory arrays.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/537095316/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/537096071",
    "html_url": "https://github.com/ethereum/solidity/issues/7498#issuecomment-537096071",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7498",
    "id": 537096071,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzNzA5NjA3MQ==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-01T15:38:26Z",
    "updated_at": "2019-10-01T15:38:26Z",
    "author_association": "MEMBER",
    "body": "Once this is done: investigate whether we can remove ``if (recursive()) return true;`` from ``StructType::isDynamicallyEncoded`` again.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/537096071/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/537178764",
    "html_url": "https://github.com/ethereum/solidity/issues/7498#issuecomment-537178764",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7498",
    "id": 537178764,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzNzE3ODc2NA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-01T18:53:50Z",
    "updated_at": "2019-10-01T18:53:50Z",
    "author_association": "MEMBER",
    "body": "I don't think we can, since the fact that some part anywhere inside the directed graph has a too large static size is already a problem. We particularly do not want that in storage. Thinking of it: The fix we implemented might not have fixed the underlying problem...",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/537178764/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/537435067",
    "html_url": "https://github.com/ethereum/solidity/issues/7498#issuecomment-537435067",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7498",
    "id": 537435067,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzNzQzNTA2Nw==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-02T10:34:47Z",
    "updated_at": "2019-10-02T10:34:57Z",
    "author_association": "MEMBER",
    "body": "> We particularly do not want that in storage.\r\n\r\nThe particular check, i.e. ``validForCalldata()`` is only used for memory and calldata, not for storage it seems (TypeChecker.cpp:L502-507)... not sure what and where we do this for storage.\r\n\r\n> Thinking of it: The fix we implemented might not have fixed the underlying problem...\r\n\r\nThat's true and why I created this issue.\r\nBut I think we should be fine, if we reimplement ``validForCalldata`` as ``validForMemory`` (or with one shared implementation) and just use the ``memory*Size`` functions instead of the calldata ones for the static size calculation...",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/537435067/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/537436627",
    "html_url": "https://github.com/ethereum/solidity/issues/7498#issuecomment-537436627",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7498",
    "id": 537436627,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzNzQzNjYyNw==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-02T10:40:12Z",
    "updated_at": "2019-10-02T10:40:47Z",
    "author_association": "MEMBER",
    "body": "The underlying issue of the particular issue as far as I understand it is just that we use the calldata size functions to enforce an upper limit on memory size and the calldata size functions asserted interface types, which are not present in some types which are still viable for memory, in particular recursive structs...\r\n\r\nThere may be a separate issue that checking for size bounds \"locally\" once in every \"level\" of the array is insufficient and that we have to consider full paths instead, but I'm not sure - I think it might actually be fine, since the size functions should be correct for every statically sized type and for dynamically encoded ones only the pointer size is relevant anyways...",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/537436627/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/625438058",
    "html_url": "https://github.com/ethereum/solidity/issues/7498#issuecomment-625438058",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7498",
    "id": 625438058,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNTQzODA1OA==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-07T18:59:21Z",
    "updated_at": "2020-05-07T18:59:21Z",
    "author_association": "MEMBER",
    "body": "Done in https://github.com/ethereum/solidity/pull/8665",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/625438058/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
