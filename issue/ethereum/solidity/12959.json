{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12959",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12959/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12959/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12959/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12959",
  "id": 1214514990,
  "node_id": "I_kwDOAm_5kc5IZAcu",
  "number": 12959,
  "title": "SMTChecker: doesn't recognize \"OR\" as arithmetic.",
  "user": {
    "login": "drortirosh",
    "id": 40341007,
    "node_id": "MDQ6VXNlcjQwMzQxMDA3",
    "avatar_url": "https://avatars.githubusercontent.com/u/40341007?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/drortirosh",
    "html_url": "https://github.com/drortirosh",
    "followers_url": "https://api.github.com/users/drortirosh/followers",
    "following_url": "https://api.github.com/users/drortirosh/following{/other_user}",
    "gists_url": "https://api.github.com/users/drortirosh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/drortirosh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/drortirosh/subscriptions",
    "organizations_url": "https://api.github.com/users/drortirosh/orgs",
    "repos_url": "https://api.github.com/users/drortirosh/repos",
    "events_url": "https://api.github.com/users/drortirosh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/drortirosh/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4810143649,
      "node_id": "LA_kwDOAm_5kc8AAAABHrT3oQ",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/smt",
      "name": "smt",
      "color": "1d76db",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-04-25T13:29:40Z",
  "updated_at": "2023-02-03T19:42:22Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "The following sample is based on the standard \"overflow\" sample of the SMTChecker.\r\nThere is an added \"require\" which makes sure the addition can never overflow - but the SMTChecker doesn't recognize it.\r\n\r\nrunning the normal\r\n`solc overflow.sol --model-checker-targets \"underflow,overflow\" --model-checker-engine all --model-checker-show-unproved`\r\nFails and claims that \"Overflow can happen here\"\r\nwith parameter \r\n`_y = 2**256 - 1`\r\n\r\nThe SMT failed to see that  checking an \"OR'ed\" value is equivalent to checking them separately\r\n(actually, I compare them to type(uint128).max, which mean I can even multiply them without overflow..\r\n\r\n```js\r\n// SPDX-License-Identifier: GPL-3.0\r\npragma solidity >=0.8.0;\r\n\r\ncontract Overflow {\r\n    uint immutable x;\r\n    uint immutable y;\r\n\r\n    function add(uint _x, uint _y) internal pure returns (uint) {\r\n        return _x + _y;\r\n    }\r\n\r\n    constructor(uint _x, uint _y) {\r\n        // added \"require\": this makes sure that both values are small enough, and are allowed to be added with no overflow\r\n\trequire(  (_x | _y) < type(uint128).max );\r\n        (x, y) = (_x, _y);\r\n    }\r\n\r\n    function stateAdd() public view returns (uint) {\r\n        return add(x, y);\r\n    }\r\n}\r\n```\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12959/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12959/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1108645013",
    "html_url": "https://github.com/ethereum/solidity/issues/12959#issuecomment-1108645013",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12959",
    "id": 1108645013,
    "node_id": "IC_kwDOAm_5kc5CFJSV",
    "user": {
      "login": "leonardoalt",
      "id": 504195,
      "node_id": "MDQ6VXNlcjUwNDE5NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/504195?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/leonardoalt",
      "html_url": "https://github.com/leonardoalt",
      "followers_url": "https://api.github.com/users/leonardoalt/followers",
      "following_url": "https://api.github.com/users/leonardoalt/following{/other_user}",
      "gists_url": "https://api.github.com/users/leonardoalt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/leonardoalt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leonardoalt/subscriptions",
      "organizations_url": "https://api.github.com/users/leonardoalt/orgs",
      "repos_url": "https://api.github.com/users/leonardoalt/repos",
      "events_url": "https://api.github.com/users/leonardoalt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/leonardoalt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-25T14:23:34Z",
    "updated_at": "2022-04-25T14:23:34Z",
    "author_association": "MEMBER",
    "body": "Hi @drortirosh , thanks for the issue!\r\n\r\nThe tool does in fact recognize the extra require, but:\r\n\r\n- The BMC engine only looks at each function separately, regardless of the previous states. So it doesn't really know of any constraints that were added in previous transactions, in this case the said require.\r\n- The CHC engine says \"might happen here\", which means that the underlying solver could not prove nor disprove the property. This property is hard because it mixes integer and bitvector (because of the bitwise operation) reasoning, where the constructor constraint you mentioned does influence the correctness of the property. So this would force the underlying Horn solver to find an inductive invariant over the state of the contract mixing integer and bitvector reasoning, which is pretty hard.\r\n\r\nIt is unfortunate that such a small property becomes a complicated problem behind the scenes. If you switch the require to an arithmetic instead of a bitwise operation you might have better luck.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1108645013/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
