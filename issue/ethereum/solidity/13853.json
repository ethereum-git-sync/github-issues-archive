{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/13853",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/13853/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/13853/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/13853/events",
  "html_url": "https://github.com/ethereum/solidity/issues/13853",
  "id": 1524527547,
  "node_id": "I_kwDOAm_5kc5a3nG7",
  "number": 13853,
  "title": "Potential Casting Discrepancy (Yul)",
  "user": {
    "login": "alex-ppg",
    "id": 31933616,
    "node_id": "MDQ6VXNlcjMxOTMzNjE2",
    "avatar_url": "https://avatars.githubusercontent.com/u/31933616?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alex-ppg",
    "html_url": "https://github.com/alex-ppg",
    "followers_url": "https://api.github.com/users/alex-ppg/followers",
    "following_url": "https://api.github.com/users/alex-ppg/following{/other_user}",
    "gists_url": "https://api.github.com/users/alex-ppg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alex-ppg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alex-ppg/subscriptions",
    "organizations_url": "https://api.github.com/users/alex-ppg/orgs",
    "repos_url": "https://api.github.com/users/alex-ppg/repos",
    "events_url": "https://api.github.com/users/alex-ppg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alex-ppg/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 275027668,
      "node_id": "MDU6TGFiZWwyNzUwMjc2Njg=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/documentation%20:book:",
      "name": "documentation :book:",
      "color": "006b75",
      "default": false,
      "description": ""
    },
    {
      "id": 4438006499,
      "node_id": "LA_kwDOAm_5kc8AAAABCIaa4w",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/low%20effort",
      "name": "low effort",
      "color": "ffb1fa",
      "default": false,
      "description": "There is not much implementation work to be done. The task is very easy or tiny."
    },
    {
      "id": 4438157609,
      "node_id": "LA_kwDOAm_5kc8AAAABCIjpKQ",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/low%20impact",
      "name": "low impact",
      "color": "5d71ff",
      "default": false,
      "description": "Changes are not very noticeable or potential benefits are limited."
    },
    {
      "id": 4438490842,
      "node_id": "LA_kwDOAm_5kc8AAAABCI3-2g",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/should%20have",
      "name": "should have",
      "color": "ffbe6c",
      "default": false,
      "description": "We like the idea but itâ€™s not important enough to be a part of the roadmap."
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-01-08T14:17:05Z",
  "updated_at": "2023-02-07T11:55:36Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nThe documentation of Solidity does not strictly define what happens when a sub-32 byte negative integer is upcast to a `bytes32` variable in an `assembly` / Yul context where it is permitted. Currently, it appears to misbehave as it will pre-fill the byte representation with `ff` to indicate it is a negative number rather than only writing the bytes that the sub-32 byte integer held and leaving the remaining zero.\r\n\r\n## Environment\r\n\r\nThe compiler utilized where the behaviour is present is `0.8.7`, however, some example compiler versions where this is applicable are: `0.8.0`, `0.7.0`, `0.6.0`, `0.5.0`, and `0.4.0`\r\n\r\n## Steps to Reproduce\r\n\r\nBelow is a minimal example of how this discrepancy manifests:\r\n\r\n```solidity\r\nfunction retrieve() public view returns (bytes32 b) {\r\n    int64 a = -5;\r\n    assembly { b := a }\r\n}\r\n```\r\n\r\nThe above example will yield `0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffb` instead of `0x000000000000000000000000000000000000000000000000fffffffffffffffb`, as if we performed an upcast of `int64` to `int256` prior to assignment.\r\n\r\nI believe this is not a deliberate action by the compiler and is a side-effect of how sub-32 byte variables are \"artificial\" and not natively supported by the EVM. I advise its behaviour to be explicitly documented as it can affect encoding mechanisms significantly.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/13853/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/13853/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1375633574",
    "html_url": "https://github.com/ethereum/solidity/issues/13853#issuecomment-1375633574",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13853",
    "id": 1375633574,
    "node_id": "IC_kwDOAm_5kc5R_oCm",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-09T13:33:23Z",
    "updated_at": "2023-01-09T13:33:23Z",
    "author_association": "MEMBER",
    "body": "This is deliberate - inline assembly is not typed, so any referenced variable is treated as a \"raw\" 256-bit word. So ``a`` in the assembly block refers to the 256-bit word representation of the 64-bit integer ``-5``, which indeed is ``0xff..ffb``.\r\n\r\nIn general, a lot of care has to be taken when dealing with sub-32-byte variables in inline assembly and the behaviour here is intentionally not well documented, since we reserve the right to change behaviour, resp. in these circumstances using inline assembly follows a \"you need to know what you're doing\" policy. However, we may want to consider specifying the behaviour more strictly and then adhere to that specification, since issues like this have been the source of some confusion and bugs in the past.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1375633574/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1377024030",
    "html_url": "https://github.com/ethereum/solidity/issues/13853#issuecomment-1377024030",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13853",
    "id": 1377024030,
    "node_id": "IC_kwDOAm_5kc5SE7ge",
    "user": {
      "login": "alex-ppg",
      "id": 31933616,
      "node_id": "MDQ6VXNlcjMxOTMzNjE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/31933616?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alex-ppg",
      "html_url": "https://github.com/alex-ppg",
      "followers_url": "https://api.github.com/users/alex-ppg/followers",
      "following_url": "https://api.github.com/users/alex-ppg/following{/other_user}",
      "gists_url": "https://api.github.com/users/alex-ppg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alex-ppg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alex-ppg/subscriptions",
      "organizations_url": "https://api.github.com/users/alex-ppg/orgs",
      "repos_url": "https://api.github.com/users/alex-ppg/repos",
      "events_url": "https://api.github.com/users/alex-ppg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alex-ppg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-10T10:15:02Z",
    "updated_at": "2023-01-10T10:15:02Z",
    "author_association": "NONE",
    "body": "Understood, I believe expanding the documentation is something that should be done in this case. The problem I see with the above snippet is that an in-memory assignment manipulates bit space differently than what the same in-storage assignment would do. Considering the following:\r\n\r\n```solidity\r\ncontract Test {\r\n    int64 internal a = -5;\r\n\r\n    function retrieve() public view returns (bytes32 c, bytes32 d) {\r\n        int64 b = -5;\r\n        assembly { \r\n            c := sload(a.slot)\r\n            d := b\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nThe variables `c` and `d` would hold different bitwise representations even though `a == b` would yield `true`. Such issues will become especially prevalent with signed integers rather than unsigned (as `uint64` / positive values would yield the same bitwise outputs). \r\n\r\nThis behaviour needs to be explicitly documented (with appropriate warnings that specify it can change) as currently, developers are \"in the dark\" as to how their `assembly` code should behave.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1377024030/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
