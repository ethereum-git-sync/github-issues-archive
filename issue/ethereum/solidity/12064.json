{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12064",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12064/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12064/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12064/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12064",
  "id": 1011931059,
  "node_id": "I_kwDOAm_5kc48UNez",
  "number": 12064,
  "title": "[Legacy codegen] Error code missing on revert",
  "user": {
    "login": "bshastry",
    "id": 2388185,
    "node_id": "MDQ6VXNlcjIzODgxODU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bshastry",
    "html_url": "https://github.com/bshastry",
    "followers_url": "https://api.github.com/users/bshastry/followers",
    "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
    "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
    "organizations_url": "https://api.github.com/users/bshastry/orgs",
    "repos_url": "https://api.github.com/users/bshastry/repos",
    "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bshastry/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 9,
  "created_at": "2021-09-30T09:17:28Z",
  "updated_at": "2021-10-06T18:57:14Z",
  "closed_at": "2021-10-06T18:57:14Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "The following contract reverts via both legacy and IR but only IR reports an overflow via a designated panic code, legacy does not.\r\n\r\nIt looks like there's something more than evaluation order at play here because legacy (due to left-to-right evaluation order) should panic on an overflow on evaluating the left-hand-expression (multiplication of the two max integer literals). But because legacy reverts without a panic, it must be doing so for a reason other than an arithmetic overflow. Out of gas is ruled out because that is a different EVMC status code (3).\r\n\r\n```\r\ncontract C {\r\n   function f() external returns (uint64) {\r\n     (type(uint32).max * type(uint16).max) & this.f();\r\n   }\r\n}\r\n// ====\r\n// compileViaYul: also\r\n// ----\r\n// f() -> FAILURE, hex\"4e487b71\", 0x11\r\n// gas legacy: 261895\r\n// gas legacyOptimized: 267328\r\n```",
  "closed_by": {
    "login": "bshastry",
    "id": 2388185,
    "node_id": "MDQ6VXNlcjIzODgxODU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bshastry",
    "html_url": "https://github.com/bshastry",
    "followers_url": "https://api.github.com/users/bshastry/followers",
    "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
    "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
    "organizations_url": "https://api.github.com/users/bshastry/orgs",
    "repos_url": "https://api.github.com/users/bshastry/repos",
    "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bshastry/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12064/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12064/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/931191786",
    "html_url": "https://github.com/ethereum/solidity/issues/12064#issuecomment-931191786",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12064",
    "id": 931191786,
    "node_id": "IC_kwDOAm_5kc43gNvq",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-30T10:21:15Z",
    "updated_at": "2021-09-30T10:21:15Z",
    "author_association": "MEMBER",
    "body": "I'm pretty sure this is only evaluation order: If you evaluate `this.f()` first, you will end up with out of gas eventually, but that will be propagated up the stack as \"external call failed\", which is a regular revert without error code.\r\n\r\nIf you evaluate the multiplication first, you will get a revert with \"overflow\" error code.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/931191786/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/931192275",
    "html_url": "https://github.com/ethereum/solidity/issues/12064#issuecomment-931192275",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12064",
    "id": 931192275,
    "node_id": "IC_kwDOAm_5kc43gN3T",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-30T10:22:00Z",
    "updated_at": "2021-09-30T10:22:00Z",
    "author_association": "MEMBER",
    "body": "Do you think it makes sense to create a branch that  changes the evaluation order? Or we could add a 'pragma' to switch old codegen to new codegen behaviour (at least as much as possible).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/931192275/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/931194213",
    "html_url": "https://github.com/ethereum/solidity/issues/12064#issuecomment-931194213",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12064",
    "id": 931194213,
    "node_id": "IC_kwDOAm_5kc43gOVl",
    "user": {
      "login": "bshastry",
      "id": 2388185,
      "node_id": "MDQ6VXNlcjIzODgxODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bshastry",
      "html_url": "https://github.com/bshastry",
      "followers_url": "https://api.github.com/users/bshastry/followers",
      "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
      "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
      "organizations_url": "https://api.github.com/users/bshastry/orgs",
      "repos_url": "https://api.github.com/users/bshastry/repos",
      "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bshastry/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-30T10:24:38Z",
    "updated_at": "2021-09-30T10:24:38Z",
    "author_association": "MEMBER",
    "body": "> I'm pretty sure this is only evaluation order: If you evaluate `this.f()` first, you will end up with out of gas eventually, but that will be propagated up the stack as \"external call failed\", which is a regular revert without error code.\r\n> \r\n> If you evaluate the multiplication first, you will get a revert with \"overflow\" error code.\r\n\r\nThat's the thing, one would expect an \"overflow\" error code for legacy (because left-to-right evaluation) and external call failed for IR, but it is actually the other way round which is what confused me.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/931194213/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/931322406",
    "html_url": "https://github.com/ethereum/solidity/issues/12064#issuecomment-931322406",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12064",
    "id": 931322406,
    "node_id": "IC_kwDOAm_5kc43gtom",
    "user": {
      "login": "hrkrshnn",
      "id": 13174375,
      "node_id": "MDQ6VXNlcjEzMTc0Mzc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13174375?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hrkrshnn",
      "html_url": "https://github.com/hrkrshnn",
      "followers_url": "https://api.github.com/users/hrkrshnn/followers",
      "following_url": "https://api.github.com/users/hrkrshnn/following{/other_user}",
      "gists_url": "https://api.github.com/users/hrkrshnn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hrkrshnn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hrkrshnn/subscriptions",
      "organizations_url": "https://api.github.com/users/hrkrshnn/orgs",
      "repos_url": "https://api.github.com/users/hrkrshnn/repos",
      "events_url": "https://api.github.com/users/hrkrshnn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hrkrshnn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-30T13:27:25Z",
    "updated_at": "2021-09-30T13:27:48Z",
    "author_association": "MEMBER",
    "body": "I looked at the assembly. The optimized-yul code completely removes the function call. The IR does the operation before the call. The asm does the recursive call before the operations. \r\n\r\nBut not sure if the order is valid behaviour. But just leaving the observation here.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/931322406/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/931327117",
    "html_url": "https://github.com/ethereum/solidity/issues/12064#issuecomment-931327117",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12064",
    "id": 931327117,
    "node_id": "IC_kwDOAm_5kc43guyN",
    "user": {
      "login": "hrkrshnn",
      "id": 13174375,
      "node_id": "MDQ6VXNlcjEzMTc0Mzc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13174375?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hrkrshnn",
      "html_url": "https://github.com/hrkrshnn",
      "followers_url": "https://api.github.com/users/hrkrshnn/followers",
      "following_url": "https://api.github.com/users/hrkrshnn/following{/other_user}",
      "gists_url": "https://api.github.com/users/hrkrshnn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hrkrshnn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hrkrshnn/subscriptions",
      "organizations_url": "https://api.github.com/users/hrkrshnn/orgs",
      "repos_url": "https://api.github.com/users/hrkrshnn/repos",
      "events_url": "https://api.github.com/users/hrkrshnn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hrkrshnn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-30T13:33:02Z",
    "updated_at": "2021-09-30T13:33:13Z",
    "author_association": "MEMBER",
    "body": "For the legacy, the recursive call will eventually run out of gas because of the 63/64 rule. But there won't be any returndata in the last `call` that fails. Since `returndata` will be cascaded back, the result would be equivalent to `revert(0, 0)`.\r\n\r\nThat is, `f()` is same as:\r\n```\r\nfunction f() {\r\n    revert(0, 0)\r\n}\r\n```\r\n\r\nI think that explains the behaviour.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/931327117/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/933296151",
    "html_url": "https://github.com/ethereum/solidity/issues/12064#issuecomment-933296151",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12064",
    "id": 933296151,
    "node_id": "IC_kwDOAm_5kc43oPgX",
    "user": {
      "login": "bshastry",
      "id": 2388185,
      "node_id": "MDQ6VXNlcjIzODgxODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bshastry",
      "html_url": "https://github.com/bshastry",
      "followers_url": "https://api.github.com/users/bshastry/followers",
      "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
      "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
      "organizations_url": "https://api.github.com/users/bshastry/orgs",
      "repos_url": "https://api.github.com/users/bshastry/repos",
      "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bshastry/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-04T09:13:01Z",
    "updated_at": "2021-10-04T09:13:01Z",
    "author_association": "MEMBER",
    "body": "This issue is a false positive that was wrongly filed by me because I mistook the legacy expression evaluation order to be left to right and not the other way round.\r\n\r\n> Do you think it makes sense to create a branch that changes the evaluation order? Or we could add a 'pragma' to switch old codegen to new codegen behaviour (at least as much as possible).\r\n\r\nThis would be great! :-) Right now, I manually examine test cases to filter out false positives but errors happen (like this one).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/933296151/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/933350077",
    "html_url": "https://github.com/ethereum/solidity/issues/12064#issuecomment-933350077",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12064",
    "id": 933350077,
    "node_id": "IC_kwDOAm_5kc43ocq9",
    "user": {
      "login": "hrkrshnn",
      "id": 13174375,
      "node_id": "MDQ6VXNlcjEzMTc0Mzc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13174375?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hrkrshnn",
      "html_url": "https://github.com/hrkrshnn",
      "followers_url": "https://api.github.com/users/hrkrshnn/followers",
      "following_url": "https://api.github.com/users/hrkrshnn/following{/other_user}",
      "gists_url": "https://api.github.com/users/hrkrshnn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hrkrshnn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hrkrshnn/subscriptions",
      "organizations_url": "https://api.github.com/users/hrkrshnn/orgs",
      "repos_url": "https://api.github.com/users/hrkrshnn/repos",
      "events_url": "https://api.github.com/users/hrkrshnn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hrkrshnn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-04T10:26:37Z",
    "updated_at": "2021-10-04T10:26:37Z",
    "author_association": "MEMBER",
    "body": "@bshastry I think such a branch should already exist. @ekpyron had a PR that switched it. Let me find it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/933350077/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/933350730",
    "html_url": "https://github.com/ethereum/solidity/issues/12064#issuecomment-933350730",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12064",
    "id": 933350730,
    "node_id": "IC_kwDOAm_5kc43oc1K",
    "user": {
      "login": "hrkrshnn",
      "id": 13174375,
      "node_id": "MDQ6VXNlcjEzMTc0Mzc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13174375?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hrkrshnn",
      "html_url": "https://github.com/hrkrshnn",
      "followers_url": "https://api.github.com/users/hrkrshnn/followers",
      "following_url": "https://api.github.com/users/hrkrshnn/following{/other_user}",
      "gists_url": "https://api.github.com/users/hrkrshnn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hrkrshnn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hrkrshnn/subscriptions",
      "organizations_url": "https://api.github.com/users/hrkrshnn/orgs",
      "repos_url": "https://api.github.com/users/hrkrshnn/repos",
      "events_url": "https://api.github.com/users/hrkrshnn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hrkrshnn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-04T10:27:32Z",
    "updated_at": "2021-10-04T10:27:44Z",
    "author_association": "MEMBER",
    "body": "Ah, https://github.com/ethereum/solidity/pull/11537 is the one I was referring to. You do already use this, don't you?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/933350730/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/936908108",
    "html_url": "https://github.com/ethereum/solidity/issues/12064#issuecomment-936908108",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12064",
    "id": 936908108,
    "node_id": "IC_kwDOAm_5kc432BVM",
    "user": {
      "login": "bshastry",
      "id": 2388185,
      "node_id": "MDQ6VXNlcjIzODgxODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2388185?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bshastry",
      "html_url": "https://github.com/bshastry",
      "followers_url": "https://api.github.com/users/bshastry/followers",
      "following_url": "https://api.github.com/users/bshastry/following{/other_user}",
      "gists_url": "https://api.github.com/users/bshastry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bshastry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bshastry/subscriptions",
      "organizations_url": "https://api.github.com/users/bshastry/orgs",
      "repos_url": "https://api.github.com/users/bshastry/repos",
      "events_url": "https://api.github.com/users/bshastry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bshastry/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-06T18:57:10Z",
    "updated_at": "2021-10-06T18:57:10Z",
    "author_association": "MEMBER",
    "body": "Closing because false positive",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/936908108/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
