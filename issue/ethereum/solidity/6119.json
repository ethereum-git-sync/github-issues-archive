{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/6119",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/6119/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/6119/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/6119/events",
  "html_url": "https://github.com/ethereum/solidity/issues/6119",
  "id": 414771893,
  "node_id": "MDU6SXNzdWU0MTQ3NzE4OTM=",
  "number": 6119,
  "title": "Solc src mappings problems",
  "user": {
    "login": "norhh",
    "id": 15844703,
    "node_id": "MDQ6VXNlcjE1ODQ0NzAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/15844703?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/norhh",
    "html_url": "https://github.com/norhh",
    "followers_url": "https://api.github.com/users/norhh/followers",
    "following_url": "https://api.github.com/users/norhh/following{/other_user}",
    "gists_url": "https://api.github.com/users/norhh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/norhh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/norhh/subscriptions",
    "organizations_url": "https://api.github.com/users/norhh/orgs",
    "repos_url": "https://api.github.com/users/norhh/repos",
    "events_url": "https://api.github.com/users/norhh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/norhh/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2019-02-26T19:11:43Z",
  "updated_at": "2019-03-13T11:27:10Z",
  "closed_at": "2019-03-13T11:27:09Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\nThe src-map doesn't seem to be that accurate, In some cases the srcmap points towards comments.\r\n## Environment\r\n\r\n- Compiler version: 0.5.0\r\n- Target EVM version (as per compiler settings): byzantium\r\n- Framework/IDE (e.g. Truffle or Remix): None\r\n- EVM execution environment / backend / blockchain client: None\r\n- Operating system: Ubuntu\r\n\r\n## Steps to Reproduce\r\nBelow is the line_mapping code which prints out the PC and it's corresponding line number\r\n```\r\nimport json\r\nfrom subprocess import PIPE, Popen\r\n\r\n\r\ndef _get_solc_mappings(srcmap, solidity_files):\r\n    \"\"\"The line mappings function\"\"\"\r\n    prev_item = []\r\n    PC = 1\r\n    for item in srcmap:\r\n        mapping = item.split(\":\")\r\n        mapping += prev_item[len(mapping):]   # if the length is less then previous mapping length then take the previous mapping values of the rest\r\n        for index in range(len(mapping)):\r\n            if mapping[index] == \"\":          # Fill up all empty values with it's previous values\r\n                mapping[index] = int(prev_item[index])\r\n\r\n        offset, length, idx, _ = mapping      # offset:length:file_no:jump format\r\n        offset = int(offset)\r\n        idx = int(idx)\r\n        lineno = (\r\n             solidity_files[idx].encode(\"utf-8\")[0:offset].count(\"\\n\".encode(\"utf-8\")) + 1\r\n        )\r\n        prev_item = mapping\r\n        print(\"PC: {}, line_no: {}\".format(PC, lineno))\r\n        PC += 1\r\n\r\n\r\ndef main():\r\n    cmd = [\"solc\", \"--combined-json\", \"srcmap-runtime\", \"./BECToken.sol\"]\r\n    p = Popen(cmd, stdout=PIPE, stderr=PIPE)\r\n\r\n    stdout, stderr = p.communicate()\r\n    ret = p.returncode\r\n\r\n    out = stdout.decode(\"UTF-8\")\r\n    json_data = json.loads(out)\r\n    solidity_files = []\r\n    for filename in json_data[\"sourceList\"]:\r\n        with open(filename, \"r\", encoding=\"utf-8\") as file:\r\n            code = file.read()\r\n            solidity_files.append(code)\r\n\r\n    srcmap = json_data[\"contracts\"]['./BECToken.sol:PausableToken'][\"srcmap-runtime\"].split(\";\")\r\n    _get_solc_mappings(srcmap, solidity_files)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    main()\r\n\r\n```\r\nthe contract on which it is run is BECToken.sol which can be found here https://raw.githubusercontent.com/ConsenSys/mythril-classic/develop/solidity_examples/BECToken.sol ,\r\nAfter executing, It can be clearly seen in the output that at some addresses the src is pointed to line numbers 3-4 which are comments. Am I making any mistake here?",
  "closed_by": {
    "login": "norhh",
    "id": 15844703,
    "node_id": "MDQ6VXNlcjE1ODQ0NzAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/15844703?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/norhh",
    "html_url": "https://github.com/norhh",
    "followers_url": "https://api.github.com/users/norhh/followers",
    "following_url": "https://api.github.com/users/norhh/following{/other_user}",
    "gists_url": "https://api.github.com/users/norhh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/norhh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/norhh/subscriptions",
    "organizations_url": "https://api.github.com/users/norhh/orgs",
    "repos_url": "https://api.github.com/users/norhh/repos",
    "events_url": "https://api.github.com/users/norhh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/norhh/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/6119/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/6119/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/467797635",
    "html_url": "https://github.com/ethereum/solidity/issues/6119#issuecomment-467797635",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6119",
    "id": 467797635,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2Nzc5NzYzNQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-27T09:52:57Z",
    "updated_at": "2019-02-27T09:52:57Z",
    "author_association": "MEMBER",
    "body": "The compiler sometimes provides source links to source files internal to the compiler. In that case, the source index is `-1`. Can you check if that is the case? I think `solidity_files[-1]` in python does not generate an error, does it?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/467797635/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/467855669",
    "html_url": "https://github.com/ethereum/solidity/issues/6119#issuecomment-467855669",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6119",
    "id": 467855669,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2Nzg1NTY2OQ==",
    "user": {
      "login": "norhh",
      "id": 15844703,
      "node_id": "MDQ6VXNlcjE1ODQ0NzAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/15844703?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/norhh",
      "html_url": "https://github.com/norhh",
      "followers_url": "https://api.github.com/users/norhh/followers",
      "following_url": "https://api.github.com/users/norhh/following{/other_user}",
      "gists_url": "https://api.github.com/users/norhh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/norhh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/norhh/subscriptions",
      "organizations_url": "https://api.github.com/users/norhh/orgs",
      "repos_url": "https://api.github.com/users/norhh/repos",
      "events_url": "https://api.github.com/users/norhh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/norhh/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-27T13:09:47Z",
    "updated_at": "2019-02-27T13:09:47Z",
    "author_association": "NONE",
    "body": "@chriseth , thanks for the reply, that seems to be the case, Can you mention where that internal file exists in the solidity build? that might be quite helpful",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/467855669/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/472373471",
    "html_url": "https://github.com/ethereum/solidity/issues/6119#issuecomment-472373471",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6119",
    "id": 472373471,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MjM3MzQ3MQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-13T10:51:55Z",
    "updated_at": "2019-03-13T10:51:55Z",
    "author_association": "MEMBER",
    "body": "They are not really files, they are just generated source code snippets. So it might be better to just remove these annotations.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/472373471/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/472384143",
    "html_url": "https://github.com/ethereum/solidity/issues/6119#issuecomment-472384143",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6119",
    "id": 472384143,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MjM4NDE0Mw==",
    "user": {
      "login": "norhh",
      "id": 15844703,
      "node_id": "MDQ6VXNlcjE1ODQ0NzAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/15844703?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/norhh",
      "html_url": "https://github.com/norhh",
      "followers_url": "https://api.github.com/users/norhh/followers",
      "following_url": "https://api.github.com/users/norhh/following{/other_user}",
      "gists_url": "https://api.github.com/users/norhh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/norhh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/norhh/subscriptions",
      "organizations_url": "https://api.github.com/users/norhh/orgs",
      "repos_url": "https://api.github.com/users/norhh/repos",
      "events_url": "https://api.github.com/users/norhh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/norhh/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-13T11:27:09Z",
    "updated_at": "2019-03-13T11:27:09Z",
    "author_association": "NONE",
    "body": "Cool, thanks :+1: ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/472384143/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
