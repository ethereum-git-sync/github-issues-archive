{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/8838",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/8838/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/8838/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/8838/events",
  "html_url": "https://github.com/ethereum/solidity/issues/8838",
  "id": 612214182,
  "node_id": "MDU6SXNzdWU2MTIyMTQxODI=",
  "number": 8838,
  "title": "Yul sourcemaps skip let statements with no initializer",
  "user": {
    "login": "haltman-at",
    "id": 35589221,
    "node_id": "MDQ6VXNlcjM1NTg5MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/haltman-at",
    "html_url": "https://github.com/haltman-at",
    "followers_url": "https://api.github.com/users/haltman-at/followers",
    "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
    "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
    "organizations_url": "https://api.github.com/users/haltman-at/orgs",
    "repos_url": "https://api.github.com/users/haltman-at/repos",
    "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
    "received_events_url": "https://api.github.com/users/haltman-at/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-05-04T22:39:47Z",
  "updated_at": "2020-05-12T15:45:37Z",
  "closed_at": "2020-05-12T15:45:37Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nNot sure if this is a *bug* as such, but Yul sourcemaps skip over any `let` statement that has no initializer.\r\n\r\nFor instance, if you do `let x := 1`, then the resulting `PUSH1 0x01` will sourcemap to the `1`.  Pretty sensible.  But if you do `let x`, without specifying an initial value, the resulting `PUSH1 0x00` will sourcemap to the previous statement, and not to, say, the `let x` as one might expect.\r\n\r\nThis poses a problem for, say, Truffle Debugger, which relies on the sourcemap as part of how it locates variables on the stack.  (The interface skips over variable declarations when stepping, but internally we very much rely on hitting them!  Or things related to them, at least, like in the `let x := 1` case above.)  Now presently Truffle Debugger doesn't support assembly variables, of course, but [I wrote a PR to make it do so](https://github.com/trufflesuite/truffle/pull/3018), and this is one point where it falls down -- if the variable is declared with no initializer, the debugger won't see it (with one exception, see below).\r\n\r\nNote: This doesn't mean things are *impossible* to handle as they are, but presently I haven't come up with a good way.  Regardless, obviously any such way would necessarily be a hack.\r\n\r\nIn one case I do handle it because I have to -- if such variables are declared at the beginning of a Yul function, the fact that they're not sourcemapped actually messes with our ability to locate on the stack the parameters to and return values from said function.  Fortunately, I've accounted for this, but it would be more convenient if I didn't have to.\r\n\r\nBe aware though that changing this would arguably be breaking.  Like, if you did change this, I'd have to turn *off* the above hack I mention for versions of Solidity where this was fixed.\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.6.6\r\n- Target EVM version (as per compiler settings): default\r\n- Framework/IDE (e.g. Truffle or Remix): Truffle\r\n\r\n## Steps to Reproduce\r\n\r\n```solidity\r\npragma solidity ^0.6.6;\r\n\r\ncontract AssemblyTest {\r\n  function run() public {\r\n    assembly {\r\n      let x := 1 // 1 is hit\r\n      let v //skipped entirely\r\n      function discard(a) {\r\n        let z //skipped, causing difficulty locating a\r\n        pop(a)\r\n      }\r\n    }\r\n  }\r\n}\r\n```",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/8838/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/8838/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/623755699",
    "html_url": "https://github.com/ethereum/solidity/issues/8838#issuecomment-623755699",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8838",
    "id": 623755699,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzc1NTY5OQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-04T23:12:01Z",
    "updated_at": "2020-05-04T23:12:01Z",
    "author_association": "MEMBER",
    "body": "Thanks for reporting! Please check if #8840 fixes it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/623755699/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/624968778",
    "html_url": "https://github.com/ethereum/solidity/issues/8838#issuecomment-624968778",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/8838",
    "id": 624968778,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDk2ODc3OA==",
    "user": {
      "login": "haltman-at",
      "id": 35589221,
      "node_id": "MDQ6VXNlcjM1NTg5MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35589221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/haltman-at",
      "html_url": "https://github.com/haltman-at",
      "followers_url": "https://api.github.com/users/haltman-at/followers",
      "following_url": "https://api.github.com/users/haltman-at/following{/other_user}",
      "gists_url": "https://api.github.com/users/haltman-at/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/haltman-at/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/haltman-at/subscriptions",
      "organizations_url": "https://api.github.com/users/haltman-at/orgs",
      "repos_url": "https://api.github.com/users/haltman-at/repos",
      "events_url": "https://api.github.com/users/haltman-at/events{/privacy}",
      "received_events_url": "https://api.github.com/users/haltman-at/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-07T01:00:18Z",
    "updated_at": "2020-05-07T01:00:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yup, just tried it out, it works great!  Thanks a bunch!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/624968778/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
