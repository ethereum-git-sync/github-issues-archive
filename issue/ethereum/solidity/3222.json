{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/3222",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/3222/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/3222/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/3222/events",
  "html_url": "https://github.com/ethereum/solidity/issues/3222",
  "id": 275866384,
  "node_id": "MDU6SXNzdWUyNzU4NjYzODQ=",
  "number": 3222,
  "title": "Feature request: mechanism for removing variables from the stack",
  "user": {
    "login": "tinybike",
    "id": 2637020,
    "node_id": "MDQ6VXNlcjI2MzcwMjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2637020?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tinybike",
    "html_url": "https://github.com/tinybike",
    "followers_url": "https://api.github.com/users/tinybike/followers",
    "following_url": "https://api.github.com/users/tinybike/following{/other_user}",
    "gists_url": "https://api.github.com/users/tinybike/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tinybike/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tinybike/subscriptions",
    "organizations_url": "https://api.github.com/users/tinybike/orgs",
    "repos_url": "https://api.github.com/users/tinybike/repos",
    "events_url": "https://api.github.com/users/tinybike/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tinybike/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2017-11-21T21:31:17Z",
  "updated_at": "2018-07-28T12:38:12Z",
  "closed_at": "2018-07-28T12:38:12Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "I'd like to propose adding a mechanism to Solidity that allows removing variables from the stack.  I'm not familiar with Solidity's internals, so I do not have an opinion about how to implement this feature.  However, I assume it is _possible_ to implement because Serpent had this feature.  For reference, Serpent's `with` keyword was used for this:\r\n```\r\n# nothing on the stack\r\nwith x = 1:\r\n    # x is on the stack\r\n# nothing on the stack\r\n```\r\n\r\n**Motivation:** Augur recently completed its migration to Solidity from Serpent.  One pain point for us was that Solidity lacks a way of removing variables from the stack.  Because of this, the stack depth limit drove a number of architectural decisions (about e.g. how/whether to split up functions) that we would have preferred to make independently of language-level constraints.\r\n\r\n(This is related to https://github.com/ethereum/solidity/issues/2693, but I thought it was worthwhile to make a separate issue for manual stack management.)",
  "closed_by": {
    "login": "axic",
    "id": 20340,
    "node_id": "MDQ6VXNlcjIwMzQw",
    "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/axic",
    "html_url": "https://github.com/axic",
    "followers_url": "https://api.github.com/users/axic/followers",
    "following_url": "https://api.github.com/users/axic/following{/other_user}",
    "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
    "organizations_url": "https://api.github.com/users/axic/orgs",
    "repos_url": "https://api.github.com/users/axic/repos",
    "events_url": "https://api.github.com/users/axic/events{/privacy}",
    "received_events_url": "https://api.github.com/users/axic/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/3222/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/3222/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/346219796",
    "html_url": "https://github.com/ethereum/solidity/issues/3222#issuecomment-346219796",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3222",
    "id": 346219796,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjIxOTc5Ng==",
    "user": {
      "login": "federicobond",
      "id": 138426,
      "node_id": "MDQ6VXNlcjEzODQyNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/138426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/federicobond",
      "html_url": "https://github.com/federicobond",
      "followers_url": "https://api.github.com/users/federicobond/followers",
      "following_url": "https://api.github.com/users/federicobond/following{/other_user}",
      "gists_url": "https://api.github.com/users/federicobond/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/federicobond/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/federicobond/subscriptions",
      "organizations_url": "https://api.github.com/users/federicobond/orgs",
      "repos_url": "https://api.github.com/users/federicobond/repos",
      "events_url": "https://api.github.com/users/federicobond/events{/privacy}",
      "received_events_url": "https://api.github.com/users/federicobond/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-22T01:58:06Z",
    "updated_at": "2017-11-22T01:58:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "@tinybike can you point me to an example of a contract that had to deal with this constraint?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/346219796/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/346252250",
    "html_url": "https://github.com/ethereum/solidity/issues/3222#issuecomment-346252250",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3222",
    "id": 346252250,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjI1MjI1MA==",
    "user": {
      "login": "tinybike",
      "id": 2637020,
      "node_id": "MDQ6VXNlcjI2MzcwMjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2637020?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tinybike",
      "html_url": "https://github.com/tinybike",
      "followers_url": "https://api.github.com/users/tinybike/followers",
      "following_url": "https://api.github.com/users/tinybike/following{/other_user}",
      "gists_url": "https://api.github.com/users/tinybike/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tinybike/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tinybike/subscriptions",
      "organizations_url": "https://api.github.com/users/tinybike/orgs",
      "repos_url": "https://api.github.com/users/tinybike/repos",
      "events_url": "https://api.github.com/users/tinybike/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tinybike/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-22T06:03:12Z",
    "updated_at": "2017-11-22T06:03:12Z",
    "author_association": "MEMBER",
    "body": "Sure, one contract that required quite a bit of refactoring due to this constraint was https://github.com/AugurProject/augur-core/blob/master/source/contracts/trading/FillOrder.sol.  Our market creation functions are another good example.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/346252250/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/346695266",
    "html_url": "https://github.com/ethereum/solidity/issues/3222#issuecomment-346695266",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3222",
    "id": 346695266,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjY5NTI2Ng==",
    "user": {
      "login": "federicobond",
      "id": 138426,
      "node_id": "MDQ6VXNlcjEzODQyNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/138426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/federicobond",
      "html_url": "https://github.com/federicobond",
      "followers_url": "https://api.github.com/users/federicobond/followers",
      "following_url": "https://api.github.com/users/federicobond/following{/other_user}",
      "gists_url": "https://api.github.com/users/federicobond/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/federicobond/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/federicobond/subscriptions",
      "organizations_url": "https://api.github.com/users/federicobond/orgs",
      "repos_url": "https://api.github.com/users/federicobond/repos",
      "events_url": "https://api.github.com/users/federicobond/events{/privacy}",
      "received_events_url": "https://api.github.com/users/federicobond/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-23T20:45:04Z",
    "updated_at": "2017-11-23T20:45:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks, those contracts are more complex than the average Solidity contract I have seen in the wild, and I see why the standard solution of splitting your functions may be inconvenient.\r\n\r\nThere have been some proposals to change variable scoping. This is a good argument in favor of introducing block scoping. It lets us do this, like in C/C++:\r\n\r\n```javascript\r\nfunction foo() {\r\n   uint a = 3;\r\n   {\r\n      uint b = 5;\r\n      doSomething(b);\r\n   }\r\n   // b is no longer in scope\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/346695266/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/346703577",
    "html_url": "https://github.com/ethereum/solidity/issues/3222#issuecomment-346703577",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3222",
    "id": 346703577,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NjcwMzU3Nw==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-23T22:13:07Z",
    "updated_at": "2017-11-23T22:13:07Z",
    "author_association": "MEMBER",
    "body": "@tinybike you can move variables from the stack into memory by packing them into structs. Did you consider this when refactoring the function? Do you still have the old version of the file for comparison?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/346703577/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/347031982",
    "html_url": "https://github.com/ethereum/solidity/issues/3222#issuecomment-347031982",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3222",
    "id": 347031982,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NzAzMTk4Mg==",
    "user": {
      "login": "tinybike",
      "id": 2637020,
      "node_id": "MDQ6VXNlcjI2MzcwMjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2637020?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tinybike",
      "html_url": "https://github.com/tinybike",
      "followers_url": "https://api.github.com/users/tinybike/followers",
      "following_url": "https://api.github.com/users/tinybike/following{/other_user}",
      "gists_url": "https://api.github.com/users/tinybike/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tinybike/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tinybike/subscriptions",
      "organizations_url": "https://api.github.com/users/tinybike/orgs",
      "repos_url": "https://api.github.com/users/tinybike/repos",
      "events_url": "https://api.github.com/users/tinybike/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tinybike/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-26T19:27:38Z",
    "updated_at": "2017-11-26T19:27:38Z",
    "author_association": "MEMBER",
    "body": "@chriseth Yes, we ended up packing our variables into structs -- the `FilledOrder` and `Participant` structs on the FillOrder.sol contract linked above are examples of this.  Packing into structs (and splitting apart functions) allowed us to get things up and running, so this definitely isn't a show-stopper.  It just feels a bit \"icky\" to me to have a strong language-level coupling between a variable's type and where it is stored, if that makes sense.\r\n\r\nThe old version was in Serpent.  In the old version, takeAskOrder and takeBidOrder were in separate files, but the basic code paths were the same: https://github.com/AugurProject/augur-core/blob/684c8065e723fe7003b1bb2fbfb7516656ddc447/src/trading/takeAskOrder.se https://github.com/AugurProject/augur-core/blob/684c8065e723fe7003b1bb2fbfb7516656ddc447/src/trading/takeBidOrder.se",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/347031982/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/408605311",
    "html_url": "https://github.com/ethereum/solidity/issues/3222#issuecomment-408605311",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3222",
    "id": 408605311,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwODYwNTMxMQ==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-28T12:37:19Z",
    "updated_at": "2018-07-28T12:37:19Z",
    "author_association": "MEMBER",
    "body": "This is now supported by having C++ scoping.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/408605311/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
