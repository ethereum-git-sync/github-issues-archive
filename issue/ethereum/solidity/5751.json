{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/5751",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/5751/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/5751/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/5751/events",
  "html_url": "https://github.com/ethereum/solidity/issues/5751",
  "id": 396529903,
  "node_id": "MDU6SXNzdWUzOTY1Mjk5MDM=",
  "number": 5751,
  "title": "Stack too deep with external + callcode, compiles fine with public and memory",
  "user": {
    "login": "androolloyd",
    "id": 1237259,
    "node_id": "MDQ6VXNlcjEyMzcyNTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1237259?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/androolloyd",
    "html_url": "https://github.com/androolloyd",
    "followers_url": "https://api.github.com/users/androolloyd/followers",
    "following_url": "https://api.github.com/users/androolloyd/following{/other_user}",
    "gists_url": "https://api.github.com/users/androolloyd/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/androolloyd/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/androolloyd/subscriptions",
    "organizations_url": "https://api.github.com/users/androolloyd/orgs",
    "repos_url": "https://api.github.com/users/androolloyd/repos",
    "events_url": "https://api.github.com/users/androolloyd/events{/privacy}",
    "received_events_url": "https://api.github.com/users/androolloyd/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2019-01-07T15:25:15Z",
  "updated_at": "2019-02-26T12:31:28Z",
  "closed_at": "2019-02-26T12:31:28Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!--## Prerequisites\r\n\r\n- First, many thanks for taking part in the community. We really appreciate that.\r\n- We realize there is a lot of information requested here. We ask only that you do your best to provide as much information as possible so we can better help you.\r\n- Support questions are better asked in one of the following locations:\r\n\t- [Solidity chat](https://gitter.im/ethereum/solidity)\r\n\t- [Stack Overflow](https://ethereum.stackexchange.com/)\r\n- Ensure the issue isn't already reported.\r\n- The issue should be reproducible with the latest solidity version; however, this isn't a hard requirement and being reproducible with an older version is sufficient.\r\n-->\r\n\r\n## Description\r\n\r\nWhile porting our contracts from solidity 0.4.x -> 0.5.x we ran into a stack too deep issue around external functions\r\n\r\nExternal functions give access to the callcode data directly\r\n\r\nPublic functions copy variables into memory and then execute them there\r\n\r\nIt appears that the external functions have less stack space than a regular public function\r\n\r\n## Environment\r\n\r\n- Truffle: v5.0.1 (core: 5.0.1)\r\n- Solidity: v0.5.0 (solc-js)\r\n- Node: v11.0.0\r\n- EVM execution environment / backend / blockchain client: ganache\r\n- Operating system: OSX\r\n\r\n## Steps to Reproduce\r\n\r\nBelow the code will build correctly, uncomment the notWorking function and compile to see it fail.\r\n\r\n```pragma solidity ^0.5.0;\r\n\r\ncontract Enum {\r\n    enum Operation {\r\n        ONE,\r\n        TWO,\r\n        THREE\r\n    }\r\n}\r\n\r\ncontract Debug {\r\n\r\n    bytes32 public constant CONTRACT_CONST_ONE = 0x180e6fe977456676413d21594ff72b84df056409812ba2e51d28187117f143c2;\r\n    bytes32 public domainSeparator;\r\n\r\n    function encodeData(\r\n        address one,\r\n        uint256 two,\r\n        bytes memory three,\r\n        Enum.Operation four,\r\n        uint256 five,\r\n        uint256 six,\r\n        uint256 seven,\r\n        address eight,\r\n        address nine,\r\n        bytes memory ten\r\n    )\r\n        public\r\n        view\r\n        returns (bytes memory)\r\n    {\r\n        bytes32 eleven = keccak256(\r\n            abi.encode(CONTRACT_CONST_ONE, one, two, keccak256(three), four, five, six, seven, eight, nine, keccak256(ten))\r\n        );\r\n        return abi.encodePacked(byte(0x19), byte(0x01), domainSeparator, eleven);\r\n    }\r\n\r\n    function working(\r\n        address one,\r\n        uint256 two,\r\n        bytes memory three,\r\n        Enum.Operation four,\r\n        uint256 five,\r\n        uint256 six,\r\n        uint256 seven,\r\n        address eight,\r\n        address payable nine,\r\n        bytes memory ten,\r\n        bytes memory eleven\r\n    )\r\n        public\r\n        returns (bool fourteen)\r\n    {\r\n        uint256 twelve = gasleft();\r\n\r\n        bytes memory thirteen = encodeData(\r\n            one, two, three, four,\r\n            five, six, seven, eight, nine,\r\n            ten\r\n        );\r\n    }\r\n\r\n//    function notWorking(\r\n//        address one,\r\n//        uint256 two,\r\n//        bytes calldata three,\r\n//        Enum.Operation four,\r\n//        uint256 five,\r\n//        uint256 six,\r\n//        uint256 seven,\r\n//        address eight,\r\n//        address payable nine,\r\n//        bytes calldata ten,\r\n//        bytes calldata eleven\r\n//    )\r\n//        external\r\n//        returns (bool fourteen)\r\n//    {\r\n//        uint256 twelve = gasleft();\r\n//\r\n//        bytes memory thirteen = encodeData(\r\n//            one, two, three, four,\r\n//            five, six, seven, eight, nine,\r\n//            ten\r\n//        );\r\n//    }\r\n\r\n}",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/5751/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/5751/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/451972436",
    "html_url": "https://github.com/ethereum/solidity/issues/5751#issuecomment-451972436",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/5751",
    "id": 451972436,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MTk3MjQzNg==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-07T15:29:56Z",
    "updated_at": "2019-01-07T15:29:56Z",
    "author_association": "MEMBER",
    "body": "This is indeed the case. `bytes` types in calldata need two stack slots, while they only need a single stack slot in memory. The main reason for that is that `msg.data` is of type `bytes calldata` and it needs an explicit length on stack, even though this might not be needed for other `bytes calldata` types.\r\n\r\nCould you clarify the scope of this issue (are you reporting a bug, requesting a feature, ...)?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/451972436/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/451972758",
    "html_url": "https://github.com/ethereum/solidity/issues/5751#issuecomment-451972758",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/5751",
    "id": 451972758,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MTk3Mjc1OA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-07T15:30:47Z",
    "updated_at": "2019-01-07T15:30:47Z",
    "author_association": "MEMBER",
    "body": "Since you mention porting from 0.4.0 to 0.5.0: There is absolutely no need to mark the function external just because of 0.5.0. Interface functions have to be external, but implementing functions can be public.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/451972758/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/451973798",
    "html_url": "https://github.com/ethereum/solidity/issues/5751#issuecomment-451973798",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/5751",
    "id": 451973798,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MTk3Mzc5OA==",
    "user": {
      "login": "androolloyd",
      "id": 1237259,
      "node_id": "MDQ6VXNlcjEyMzcyNTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1237259?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/androolloyd",
      "html_url": "https://github.com/androolloyd",
      "followers_url": "https://api.github.com/users/androolloyd/followers",
      "following_url": "https://api.github.com/users/androolloyd/following{/other_user}",
      "gists_url": "https://api.github.com/users/androolloyd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/androolloyd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/androolloyd/subscriptions",
      "organizations_url": "https://api.github.com/users/androolloyd/orgs",
      "repos_url": "https://api.github.com/users/androolloyd/repos",
      "events_url": "https://api.github.com/users/androolloyd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/androolloyd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-07T15:33:51Z",
    "updated_at": "2019-01-07T15:47:14Z",
    "author_association": "NONE",
    "body": "Hi Chris the intention was to report a bug, but if this is indeed working as intended, some accompanying documentation around this would be great, most of the peers I checked with led me to believe everything should work exactly as before. \r\n\r\nWas hoping to take advantage of the gas reduction provided with external functions. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/451973798/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/451977950",
    "html_url": "https://github.com/ethereum/solidity/issues/5751#issuecomment-451977950",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/5751",
    "id": 451977950,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MTk3Nzk1MA==",
    "user": {
      "login": "PhABC",
      "id": 9306422,
      "node_id": "MDQ6VXNlcjkzMDY0MjI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9306422?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PhABC",
      "html_url": "https://github.com/PhABC",
      "followers_url": "https://api.github.com/users/PhABC/followers",
      "following_url": "https://api.github.com/users/PhABC/following{/other_user}",
      "gists_url": "https://api.github.com/users/PhABC/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PhABC/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PhABC/subscriptions",
      "organizations_url": "https://api.github.com/users/PhABC/orgs",
      "repos_url": "https://api.github.com/users/PhABC/repos",
      "events_url": "https://api.github.com/users/PhABC/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PhABC/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-07T15:45:33Z",
    "updated_at": "2019-01-07T15:45:33Z",
    "author_association": "NONE",
    "body": "I encountered this issue as well, where the following function needs to be set to `public` in 0.5 instead of `external` in 0.4 : https://github.com/horizon-games/multi-token-standard/blob/f5100ef10ff58837f23721a18582f6233d1cfaed/contracts/token/ERC1155.sol#L98\r\n\r\nWould there be anyway to distinguish `msg.data` from other types of `bytes` array? I can imagine other people would prefer setting their functions to `external` instead of `public` without having to refactor them.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/451977950/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/451982971",
    "html_url": "https://github.com/ethereum/solidity/issues/5751#issuecomment-451982971",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/5751",
    "id": 451982971,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MTk4Mjk3MQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-07T15:59:51Z",
    "updated_at": "2019-01-07T15:59:51Z",
    "author_association": "MEMBER",
    "body": "calldata arrays have never been fully implemented, but we might change that soon. With the completion of that feature, we might also split the type into two, but that could be quite difficult.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/451982971/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/467420426",
    "html_url": "https://github.com/ethereum/solidity/issues/5751#issuecomment-467420426",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/5751",
    "id": 467420426,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzQyMDQyNg==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-26T12:31:28Z",
    "updated_at": "2019-02-26T12:31:28Z",
    "author_association": "MEMBER",
    "body": "Closing this.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/467420426/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
