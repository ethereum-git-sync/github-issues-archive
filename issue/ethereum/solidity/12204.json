{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12204",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12204/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12204/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12204/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12204",
  "id": 1037475424,
  "node_id": "I_kwDOAm_5kc491p5g",
  "number": 12204,
  "title": "Remove the extcodesize check for external calls that expect returndata",
  "user": {
    "login": "hrkrshnn",
    "id": 13174375,
    "node_id": "MDQ6VXNlcjEzMTc0Mzc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/13174375?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hrkrshnn",
    "html_url": "https://github.com/hrkrshnn",
    "followers_url": "https://api.github.com/users/hrkrshnn/followers",
    "following_url": "https://api.github.com/users/hrkrshnn/following{/other_user}",
    "gists_url": "https://api.github.com/users/hrkrshnn/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hrkrshnn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hrkrshnn/subscriptions",
    "organizations_url": "https://api.github.com/users/hrkrshnn/orgs",
    "repos_url": "https://api.github.com/users/hrkrshnn/repos",
    "events_url": "https://api.github.com/users/hrkrshnn/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hrkrshnn/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 785717317,
      "node_id": "MDU6TGFiZWw3ODU3MTczMTc=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/language%20design%20:rage4:",
      "name": "language design :rage4:",
      "color": "9d76d3",
      "default": false,
      "description": "Any changes to the language, e.g. new features"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-10-27T14:12:13Z",
  "updated_at": "2021-11-08T15:05:04Z",
  "closed_at": "2021-11-08T15:05:04Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Currently, a high-level call `C.f(...)` does an `extcodesize` check before the `call`  and reverts if the address has empty code. However, this check can be avoided for function calls that are expected to return data. Because such calls are followed up by abi decoding the return data, which has a check for `returndatasize` is being at least a non-zero number. So for empty contracts, they would always revert in the end.\r\n\r\n**Proposal**: remove the `extcodesize` check for high-level calls, if such functions have return variables.\r\n\r\nNote: because of EIP-2929, this saves 100 gas.\r\n\r\nExample\r\n\r\n```solidity\r\ninterface I {\r\n    function f() external;\r\n    function g() external returns (bool);\r\n}\r\ncontract C {\r\n    I immutable i = I(address(0x1234));\r\n    function test() external {\r\n        // Skip extcodesize check in this case.\r\n        // Becuase when ABI decoding the return data of the call\r\n        // it checks if the return data is at least 32 (?) bytes.\r\n        // Note: it does not matter if `i.g()` is assigned to a value\r\n        // the return data is always checked.\r\n        bool b = i.g();\r\n        // Do not skip extcodesize check in this case.\r\n        i.f();\r\n    }\r\n}\r\n```",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12204/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12204/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/952977504",
    "html_url": "https://github.com/ethereum/solidity/issues/12204#issuecomment-952977504",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12204",
    "id": 952977504,
    "node_id": "IC_kwDOAm_5kc44zUhg",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-27T14:17:42Z",
    "updated_at": "2021-10-27T14:17:42Z",
    "author_association": "MEMBER",
    "body": "Both abi decoders use\r\n```\r\n\tsize_t encodedSize = 0;\r\n\tfor (auto const& t: _typeParameters)\r\n\t\tencodedSize += t->decodingType()->calldataHeadSize();\r\n```\r\nand then check that the return size is at least encoded size. This means we can remove the extcodesize check if `encodedSize` is nonzero (we should not rely on the number of return parameters).\r\nAlso, we can only do this if\r\n - we have an evm version that supports returndatasize and\r\n - revert strings are disabled (the extcodesize check has a different message)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/952977504/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
