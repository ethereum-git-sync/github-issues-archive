{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/14069",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/14069/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/14069/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/14069/events",
  "html_url": "https://github.com/ethereum/solidity/issues/14069",
  "id": 1638517599,
  "node_id": "I_kwDOAm_5kc5hqctf",
  "number": 14069,
  "title": "Optimizer low runs value doubles gas cost of function",
  "user": {
    "login": "vimwitch",
    "id": 631020,
    "node_id": "MDQ6VXNlcjYzMTAyMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/631020?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vimwitch",
    "html_url": "https://github.com/vimwitch",
    "followers_url": "https://api.github.com/users/vimwitch/followers",
    "following_url": "https://api.github.com/users/vimwitch/following{/other_user}",
    "gists_url": "https://api.github.com/users/vimwitch/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vimwitch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vimwitch/subscriptions",
    "organizations_url": "https://api.github.com/users/vimwitch/orgs",
    "repos_url": "https://api.github.com/users/vimwitch/repos",
    "events_url": "https://api.github.com/users/vimwitch/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vimwitch/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "matheusaaguiar",
    "id": 95899911,
    "node_id": "U_kgDOBbdRBw",
    "avatar_url": "https://avatars.githubusercontent.com/u/95899911?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/matheusaaguiar",
    "html_url": "https://github.com/matheusaaguiar",
    "followers_url": "https://api.github.com/users/matheusaaguiar/followers",
    "following_url": "https://api.github.com/users/matheusaaguiar/following{/other_user}",
    "gists_url": "https://api.github.com/users/matheusaaguiar/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/matheusaaguiar/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/matheusaaguiar/subscriptions",
    "organizations_url": "https://api.github.com/users/matheusaaguiar/orgs",
    "repos_url": "https://api.github.com/users/matheusaaguiar/repos",
    "events_url": "https://api.github.com/users/matheusaaguiar/events{/privacy}",
    "received_events_url": "https://api.github.com/users/matheusaaguiar/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "matheusaaguiar",
      "id": 95899911,
      "node_id": "U_kgDOBbdRBw",
      "avatar_url": "https://avatars.githubusercontent.com/u/95899911?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matheusaaguiar",
      "html_url": "https://github.com/matheusaaguiar",
      "followers_url": "https://api.github.com/users/matheusaaguiar/followers",
      "following_url": "https://api.github.com/users/matheusaaguiar/following{/other_user}",
      "gists_url": "https://api.github.com/users/matheusaaguiar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matheusaaguiar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matheusaaguiar/subscriptions",
      "organizations_url": "https://api.github.com/users/matheusaaguiar/orgs",
      "repos_url": "https://api.github.com/users/matheusaaguiar/repos",
      "events_url": "https://api.github.com/users/matheusaaguiar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matheusaaguiar/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-03-24T00:12:27Z",
  "updated_at": "2023-04-03T18:53:06Z",
  "closed_at": "2023-04-03T18:45:35Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nI'm not sure if this is a bug, or extreme edge behavior of the optimizer so I'm seeking advice here. I have a hash function implemented [here](https://github.com/vimwitch/hhbug/blob/main/contracts/PoseidonT3.sol#L37). With low runs the cost of executing is roughly doubled. For example, the cost of an `addmod` operation goes from 22 gas to 52 gas (including assigment to stack).\r\n\r\nI understand that low runs indicates to optimize for deployment cost instead of call cost, but is increasing the call cost this much expected behavior? It's not a huge problem because the library will deployed at a global location with the runs value set to 2**32-1, but it may confuse developers that consume the hash function as a package in a development environment.\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.7.4, 0.8.4, 0.8.17\r\n- Target EVM version (as per compiler settings): Merge\r\n- Framework/IDE (e.g. Truffle or Remix): Remix, Hardhat\r\n- EVM execution environment / backend / blockchain client: hardhat/remix vm\r\n- Operating system: OSX\r\n\r\n## Steps to Reproduce\r\n\r\nI have a repository [here](https://github.com/vimwitch/hhbug) reproducing the behavior. Specifically disabling the optimizer cuts the cost of executing the function by 2x (same with increasing runs to 2**32-1).\r\n\r\nIf you clone this repo run\r\n\r\n```\r\nnpm i\r\nnpm t\r\n```\r\n\r\nand it will print info about costs. Change the `hardhat.config.js` file to disable the optimizer and run again and you'll see a different output.\r\n\r\nThanks",
  "closed_by": {
    "login": "matheusaaguiar",
    "id": 95899911,
    "node_id": "U_kgDOBbdRBw",
    "avatar_url": "https://avatars.githubusercontent.com/u/95899911?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/matheusaaguiar",
    "html_url": "https://github.com/matheusaaguiar",
    "followers_url": "https://api.github.com/users/matheusaaguiar/followers",
    "following_url": "https://api.github.com/users/matheusaaguiar/following{/other_user}",
    "gists_url": "https://api.github.com/users/matheusaaguiar/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/matheusaaguiar/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/matheusaaguiar/subscriptions",
    "organizations_url": "https://api.github.com/users/matheusaaguiar/orgs",
    "repos_url": "https://api.github.com/users/matheusaaguiar/repos",
    "events_url": "https://api.github.com/users/matheusaaguiar/events{/privacy}",
    "received_events_url": "https://api.github.com/users/matheusaaguiar/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/14069/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/14069/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1494805329",
    "html_url": "https://github.com/ethereum/solidity/issues/14069#issuecomment-1494805329",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14069",
    "id": 1494805329,
    "node_id": "IC_kwDOAm_5kc5ZGOtR",
    "user": {
      "login": "matheusaaguiar",
      "id": 95899911,
      "node_id": "U_kgDOBbdRBw",
      "avatar_url": "https://avatars.githubusercontent.com/u/95899911?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matheusaaguiar",
      "html_url": "https://github.com/matheusaaguiar",
      "followers_url": "https://api.github.com/users/matheusaaguiar/followers",
      "following_url": "https://api.github.com/users/matheusaaguiar/following{/other_user}",
      "gists_url": "https://api.github.com/users/matheusaaguiar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matheusaaguiar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matheusaaguiar/subscriptions",
      "organizations_url": "https://api.github.com/users/matheusaaguiar/orgs",
      "repos_url": "https://api.github.com/users/matheusaaguiar/repos",
      "events_url": "https://api.github.com/users/matheusaaguiar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matheusaaguiar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-03T18:45:35Z",
    "updated_at": "2023-04-03T18:53:06Z",
    "author_association": "MEMBER",
    "body": "@vimwitch I think this is more of a question/discussion for the language [forum](https://forum.soliditylang.org/). As you noted\r\n> [...] low runs indicates to optimize for deployment cost instead of call cost [...]\r\n\r\nYour repo uses `200` for the `runs` parameter, which is **very** low and thus, in my opinion, would justify the optimizer not caring about the `addmod` cost. \r\nFor example, if you use a value of `2**13` for the `runs` parameter, then the cost goes to `22`.\r\nI am closing this for now, but, please feel free to reply if you think this really is an issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1494805329/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
