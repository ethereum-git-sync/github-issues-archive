{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12911",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12911/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12911/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12911/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12911",
  "id": 1196854942,
  "node_id": "I_kwDOAm_5kc5HVo6e",
  "number": 12911,
  "title": "Possible legacy assembly stack inconsistency on handling the CREATE result",
  "user": {
    "login": "hedgar2017",
    "id": 31586236,
    "node_id": "MDQ6VXNlcjMxNTg2MjM2",
    "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hedgar2017",
    "html_url": "https://github.com/hedgar2017",
    "followers_url": "https://api.github.com/users/hedgar2017/followers",
    "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}",
    "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions",
    "organizations_url": "https://api.github.com/users/hedgar2017/orgs",
    "repos_url": "https://api.github.com/users/hedgar2017/repos",
    "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hedgar2017/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 12,
  "created_at": "2022-04-08T05:44:08Z",
  "updated_at": "2022-04-11T19:22:18Z",
  "closed_at": "2022-04-11T19:22:18Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nI am working on a compiler from *EVM legacy assembly* to *LLVM IR for zkEVM*. To achieve this goal, I perform the on-the-fly static stack analysis and track two types of elements:\r\n- unknown runtime value\r\n- known compile-time tag constant\r\nWe have thousands of tests and this algorithm has never failed, except for one single case with handling the status of CREATE.\r\n\r\nI think this issue is too specific to give all the details, and too big and complicate to limit myself to a mere question in the support channels.\r\nI will provide all the information as soon as you need it.\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.8.13\r\n- Target: legacy assembly\r\n- Operating system: Linux x64 (Manjaro)\r\n\r\n## Steps to Reproduce\r\n\r\n1. Compile the [attached Solidity files](https://github.com/ethereum/solidity/files/8448880/stack_issue.tar.gz) to EVM legacy assembly.\r\n2. Find the following piece of assembly of the file `main.sol`:\r\n```\r\n\r\nBlock 17\r\n    JUMPDEST                                                                                [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ]\r\n    SWAP1                                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ]\r\n    DUP2                                                                                    [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ] + [ VALUE ]\r\n    MSTORE                                                                                  [ VALUE | TAG_5 | VALUE | 0 | VALUE ] - [ VALUE | VALUE ]\r\n    PUSH            20                                                                      [ VALUE | TAG_5 | VALUE | 0 | VALUE ] + [ 20 ]\r\n    ADD                                                                                     [ VALUE | TAG_5 | VALUE | 0 ] - [ VALUE | 20 ] + [ VALUE ]\r\n    PUSH            40                                                                      [ VALUE | TAG_5 | VALUE | 0 | VALUE ] + [ 40 ]\r\n    MLOAD                                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE ] - [ 40 ] + [ VALUE ]\r\n    DUP1                                                                                    [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ] + [ VALUE ]\r\n    SWAP2                                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE | VALUE ]\r\n    SUB                                                                                     [ VALUE | TAG_5 | VALUE | 0 | VALUE ] - [ VALUE | VALUE ] + [ VALUE ]\r\n    SWAP1                                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ]\r\n    PUSH            0                                                                       [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ] + [ 0 ]\r\n    CREATE                                                                                  [ VALUE | TAG_5 | VALUE | 0 ] - [ VALUE | VALUE | 0 ] + [ VALUE ]\r\n    DUP1                                                                                    [ VALUE | TAG_5 | VALUE | 0 | VALUE ] + [ VALUE ]\r\n    ISZERO                                                                                  [ VALUE | TAG_5 | VALUE | 0 | VALUE ] - [ VALUE ] + [ VALUE ]\r\n    PUSH [tag]      21                                                                      [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ] + [ TAG_21 ]\r\n    JUMPI                                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE ] - [ VALUE | TAG_21 ]\r\n    PUSH            1                                                                       [ VALUE | TAG_5 | VALUE | 0 | VALUE ] + [ 1 ]\r\n    Tag 21                                                                                  [ VALUE | TAG_5 | VALUE | 0 | VALUE | 1 ]\r\nBlock 21\r\n    JUMPDEST                                                                                [ VALUE | TAG_5 | VALUE | 0 | VALUE ]\r\n    PUSH [tag]      22                                                                      [ VALUE | TAG_5 | VALUE | 0 | VALUE ] + [ TAG_22 ]\r\n    JUMPI                                                                                   [ VALUE | TAG_5 | VALUE | 0 ] - [ VALUE | TAG_22 ]\r\n    POP                                                                                     [ VALUE | TAG_5 | VALUE ] - [ 0 ]\r\n    PUSH            0                                                                       [ VALUE | TAG_5 | VALUE ] + [ 0 ]\r\n    SWAP2                                                                                   [ VALUE | 0 | VALUE | TAG_5 ]\r\n    SWAP1                                                                                   [ VALUE | 0 | TAG_5 | VALUE ]\r\n    POP                                                                                     [ VALUE | 0 | TAG_5 ] - [ VALUE ]\r\n    JUMP            [out]                                                                   [ VALUE | 0 ] - [ TAG_5 ]\r\nBlock 22\r\n    JUMPDEST                                                                                [ VALUE | TAG_5 | VALUE | 0 ]\r\n    POP                                                                                     [ VALUE | TAG_5 | VALUE ] - [ 0 ]\r\n    PUSH            1                                                                       [ VALUE | TAG_5 | VALUE ] + [ 1 ]\r\n    SWAP3                                                                                   [ 1 | TAG_5 | VALUE | VALUE ]\r\n    SWAP2                                                                                   [ 1 | VALUE | VALUE | TAG_5 ]\r\n    POP                                                                                     [ 1 | VALUE | VALUE ] - [ TAG_5 ]\r\n    POP                                                                                     [ 1 | VALUE ] - [ VALUE ]\r\n    JUMP            [out]\r\n```\r\n3. Check if the state of the stack is correct throught these blocks.\r\n",
  "closed_by": {
    "login": "hedgar2017",
    "id": 31586236,
    "node_id": "MDQ6VXNlcjMxNTg2MjM2",
    "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hedgar2017",
    "html_url": "https://github.com/hedgar2017",
    "followers_url": "https://api.github.com/users/hedgar2017/followers",
    "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}",
    "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions",
    "organizations_url": "https://api.github.com/users/hedgar2017/orgs",
    "repos_url": "https://api.github.com/users/hedgar2017/repos",
    "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hedgar2017/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12911/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12911/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1092464626",
    "html_url": "https://github.com/ethereum/solidity/issues/12911#issuecomment-1092464626",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12911",
    "id": 1092464626,
    "node_id": "IC_kwDOAm_5kc5BHa_y",
    "user": {
      "login": "hedgar2017",
      "id": 31586236,
      "node_id": "MDQ6VXNlcjMxNTg2MjM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hedgar2017",
      "html_url": "https://github.com/hedgar2017",
      "followers_url": "https://api.github.com/users/hedgar2017/followers",
      "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}",
      "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions",
      "organizations_url": "https://api.github.com/users/hedgar2017/orgs",
      "repos_url": "https://api.github.com/users/hedgar2017/repos",
      "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hedgar2017/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-08T05:49:15Z",
    "updated_at": "2022-04-08T05:49:15Z",
    "author_association": "NONE",
    "body": "We process the blocks in a FIFO queue. We collect all the jumps from each block, and move to the destinations with the stack state of the callee.\r\nFor some reason the situation around the block 21 is very suspicious. It is very weird, since we have compiled the entire UniswapV2 and thousands of other tests, but there is not a single issue!\r\nHowever, I don't know how to resolve this stack inconsistency issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1092464626/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1092472422",
    "html_url": "https://github.com/ethereum/solidity/issues/12911#issuecomment-1092472422",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12911",
    "id": 1092472422,
    "node_id": "IC_kwDOAm_5kc5BHc5m",
    "user": {
      "login": "hedgar2017",
      "id": 31586236,
      "node_id": "MDQ6VXNlcjMxNTg2MjM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hedgar2017",
      "html_url": "https://github.com/hedgar2017",
      "followers_url": "https://api.github.com/users/hedgar2017/followers",
      "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}",
      "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions",
      "organizations_url": "https://api.github.com/users/hedgar2017/orgs",
      "repos_url": "https://api.github.com/users/hedgar2017/repos",
      "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hedgar2017/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-08T06:05:27Z",
    "updated_at": "2022-04-08T06:05:27Z",
    "author_association": "NONE",
    "body": "The full trace may help as well:\r\n```\r\nBlock 0\r\n    PUSH            80                                                                      [  ] + [ 80 ]\r\n    PUSH            40                                                                      [ 80 ] + [ 40 ]\r\n    MSTORE                                                                                  [  ] - [ 80 | 40 ]\r\n    CALLVALUE                                                                               [  ] + [ VALUE ]\r\n    DUP1                                                                                    [ VALUE ] + [ VALUE ]\r\n    ISZERO                                                                                  [ VALUE ] - [ VALUE ] + [ VALUE ]\r\n    PUSH [tag]      1                                                                       [ VALUE | VALUE ] + [ TAG_1 ]\r\n    JUMPI                                                                                   [ VALUE ] - [ VALUE | TAG_1 ]\r\n    PUSH            0                                                                       [ VALUE ] + [ 0 ]\r\n    DUP1                                                                                    [ VALUE | 0 ] + [ 0 ]\r\n    REVERT                                                                                  [ VALUE ] - [ 0 | 0 ]\r\nBlock 1\r\n    JUMPDEST                                                                                [ VALUE ]\r\n    POP                                                                                     [  ] - [ VALUE ]\r\n    PUSH            4                                                                       [  ] + [ 4 ]\r\n    CALLDATASIZE                                                                            [ 4 ] + [ VALUE ]\r\n    LT                                                                                      [  ] - [ 4 | VALUE ] + [ VALUE ]\r\n    PUSH [tag]      2                                                                       [ VALUE ] + [ TAG_2 ]\r\n    JUMPI                                                                                   [  ] - [ VALUE | TAG_2 ]\r\n    PUSH            0                                                                       [  ] + [ 0 ]\r\n    CALLDATALOAD                                                                            [  ] - [ 0 ] + [ VALUE ]\r\n    PUSH            E0                                                                      [ VALUE ] + [ E0 ]\r\n    SHR                                                                                     [  ] - [ VALUE | E0 ] + [ VALUE ]\r\n    DUP1                                                                                    [ VALUE ] + [ VALUE ]\r\n    PUSH            D9761F3F                                                                [ VALUE | VALUE ] + [ D9761F3F ]\r\n    EQ                                                                                      [ VALUE ] - [ VALUE | D9761F3F ] + [ VALUE ]\r\n    PUSH [tag]      3                                                                       [ VALUE | VALUE ] + [ TAG_3 ]\r\n    JUMPI                                                                                   [ VALUE ] - [ VALUE | TAG_3 ]\r\n    DUP1                                                                                    [ VALUE ] + [ VALUE ]\r\n    PUSH            E7519E4D                                                                [ VALUE | VALUE ] + [ E7519E4D ]\r\n    EQ                                                                                      [ VALUE ] - [ VALUE | E7519E4D ] + [ VALUE ]\r\n    PUSH [tag]      4                                                                       [ VALUE | VALUE ] + [ TAG_4 ]\r\n    JUMPI                                                                                   [ VALUE ] - [ VALUE | TAG_4 ]\r\n    Tag 2                                                                                   [ VALUE ]\r\nBlock 2\r\n    JUMPDEST                                                                                [  ]\r\n    PUSH            0                                                                       [  ] + [ 0 ]\r\n    DUP1                                                                                    [ 0 ] + [ 0 ]\r\n    REVERT                                                                                  [  ] - [ 0 | 0 ]\r\nBlock 3\r\n    JUMPDEST                                                                                [ VALUE ]\r\n    PUSH [tag]      5                                                                       [ VALUE ] + [ TAG_5 ]\r\n    PUSH [tag]      6                                                                       [ VALUE | TAG_5 ] + [ TAG_6 ]\r\n    CALLDATASIZE                                                                            [ VALUE | TAG_5 | TAG_6 ] + [ VALUE ]\r\n    PUSH            4                                                                       [ VALUE | TAG_5 | TAG_6 | VALUE ] + [ 4 ]\r\n    PUSH [tag]      7                                                                       [ VALUE | TAG_5 | TAG_6 | VALUE | 4 ] + [ TAG_7 ]\r\n    JUMP            [in]                                                                    [ VALUE | TAG_5 | TAG_6 | VALUE | 4 ] - [ TAG_7 ]\r\nBlock 7\r\n    JUMPDEST                                                                                [ VALUE | TAG_5 | TAG_6 | VALUE | 4 ]\r\n    PUSH            0                                                                       [ VALUE | TAG_5 | TAG_6 | VALUE | 4 ] + [ 0 ]\r\n    PUSH            20                                                                      [ VALUE | TAG_5 | TAG_6 | VALUE | 4 | 0 ] + [ 20 ]\r\n    DUP3                                                                                    [ VALUE | TAG_5 | TAG_6 | VALUE | 4 | 0 | 20 ] + [ 4 ]\r\n    DUP5                                                                                    [ VALUE | TAG_5 | TAG_6 | VALUE | 4 | 0 | 20 | 4 ] + [ VALUE ]\r\n    SUB                                                                                     [ VALUE | TAG_5 | TAG_6 | VALUE | 4 | 0 | 20 ] - [ 4 | VALUE ] + [ VALUE ]\r\n    SLT                                                                                     [ VALUE | TAG_5 | TAG_6 | VALUE | 4 | 0 ] - [ 20 | VALUE ] + [ VALUE ]\r\n    ISZERO                                                                                  [ VALUE | TAG_5 | TAG_6 | VALUE | 4 | 0 ] - [ VALUE ] + [ VALUE ]\r\n    PUSH [tag]      40                                                                      [ VALUE | TAG_5 | TAG_6 | VALUE | 4 | 0 | VALUE ] + [ TAG_40 ]\r\n    JUMPI                                                                                   [ VALUE | TAG_5 | TAG_6 | VALUE | 4 | 0 ] - [ VALUE | TAG_40 ]\r\n    PUSH            0                                                                       [ VALUE | TAG_5 | TAG_6 | VALUE | 4 | 0 ] + [ 0 ]\r\n    DUP1                                                                                    [ VALUE | TAG_5 | TAG_6 | VALUE | 4 | 0 | 0 ] + [ 0 ]\r\n    REVERT                                                                                  [ VALUE | TAG_5 | TAG_6 | VALUE | 4 | 0 ] - [ 0 | 0 ]\r\nBlock 40\r\n    JUMPDEST                                                                                [ VALUE | TAG_5 | TAG_6 | VALUE | 4 | 0 ]\r\n    POP                                                                                     [ VALUE | TAG_5 | TAG_6 | VALUE | 4 ] - [ 0 ]\r\n    CALLDATALOAD                                                                            [ VALUE | TAG_5 | TAG_6 | VALUE ] - [ 4 ] + [ VALUE ]\r\n    SWAP2                                                                                   [ VALUE | TAG_5 | VALUE | VALUE | TAG_6 ]\r\n    SWAP1                                                                                   [ VALUE | TAG_5 | VALUE | TAG_6 | VALUE ]\r\n    POP                                                                                     [ VALUE | TAG_5 | VALUE | TAG_6 ] - [ VALUE ]\r\n    JUMP            [out]                                                                   [ VALUE | TAG_5 | VALUE ] - [ TAG_6 ]\r\nBlock 6\r\n    JUMPDEST                                                                                [ VALUE | TAG_5 | VALUE ]\r\n    PUSH [tag]      8                                                                       [ VALUE | TAG_5 | VALUE ] + [ TAG_8 ]\r\n    JUMP            [in]                                                                    [ VALUE | TAG_5 | VALUE ] - [ TAG_8 ]\r\nBlock 8\r\n    JUMPDEST                                                                                [ VALUE | TAG_5 | VALUE ]\r\n    PUSH            0                                                                       [ VALUE | TAG_5 | VALUE ] + [ 0 ]\r\n    DUP2                                                                                    [ VALUE | TAG_5 | VALUE | 0 ] + [ VALUE ]\r\n    PUSH            40                                                                      [ VALUE | TAG_5 | VALUE | 0 | VALUE ] + [ 40 ]\r\n    MLOAD                                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE ] - [ 40 ] + [ VALUE ]\r\n    PUSH [tag]      17                                                                      [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ] + [ TAG_17 ]\r\n    SWAP1                                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE | TAG_17 | VALUE ]\r\n    PUSH [tag]      18                                                                      [ VALUE | TAG_5 | VALUE | 0 | VALUE | TAG_17 | VALUE ] + [ TAG_18 ]\r\n    JUMP            [in]                                                                    [ VALUE | TAG_5 | VALUE | 0 | VALUE | TAG_17 | VALUE ] - [ TAG_18 ]\r\nBlock 18\r\n    JUMPDEST                                                                                [ VALUE | TAG_5 | VALUE | 0 | VALUE | TAG_17 | VALUE ]\r\n    PUSH #[$]       callable.sol:Callable                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE | TAG_17 | VALUE ] + [ callable.sol:Callable ]\r\n    DUP1                                                                                    [ VALUE | TAG_5 | VALUE | 0 | VALUE | TAG_17 | VALUE | callable.sol:Callable ] + [ callable.sol:Callable ]\r\n    PUSH [$]        callable.sol:Callable                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE | TAG_17 | VALUE | callable.sol:Callable | callable.sol:Callable ] + [ callable.sol:Callable ]\r\n    DUP4                                                                                    [ VALUE | TAG_5 | VALUE | 0 | VALUE | TAG_17 | VALUE | callable.sol:Callable | callable.sol:Callable | callable.sol:Callable ] + [ VALUE ]\r\n    CODECOPY                                                                                [ VALUE | TAG_5 | VALUE | 0 | VALUE | TAG_17 | VALUE | callable.sol:Callable ] - [ callable.sol:Callable | callable.sol:Callable | VALUE ]\r\n    ADD                                                                                     [ VALUE | TAG_5 | VALUE | 0 | VALUE | TAG_17 ] - [ VALUE | callable.sol:Callable ] + [ VALUE ]\r\n    SWAP1                                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE | TAG_17 ]\r\n    JUMP            [out]                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ] - [ TAG_17 ]\r\nBlock 17\r\n    JUMPDEST                                                                                [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ]\r\n    SWAP1                                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ]\r\n    DUP2                                                                                    [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ] + [ VALUE ]\r\n    MSTORE                                                                                  [ VALUE | TAG_5 | VALUE | 0 | VALUE ] - [ VALUE | VALUE ]\r\n    PUSH            20                                                                      [ VALUE | TAG_5 | VALUE | 0 | VALUE ] + [ 20 ]\r\n    ADD                                                                                     [ VALUE | TAG_5 | VALUE | 0 ] - [ VALUE | 20 ] + [ VALUE ]\r\n    PUSH            40                                                                      [ VALUE | TAG_5 | VALUE | 0 | VALUE ] + [ 40 ]\r\n    MLOAD                                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE ] - [ 40 ] + [ VALUE ]\r\n    DUP1                                                                                    [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ] + [ VALUE ]\r\n    SWAP2                                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE | VALUE ]\r\n    SUB                                                                                     [ VALUE | TAG_5 | VALUE | 0 | VALUE ] - [ VALUE | VALUE ] + [ VALUE ]\r\n    SWAP1                                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ]\r\n    PUSH            0                                                                       [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ] + [ 0 ]\r\n    CREATE                                                                                  [ VALUE | TAG_5 | VALUE | 0 ] - [ VALUE | VALUE | 0 ] + [ VALUE ]\r\n    DUP1                                                                                    [ VALUE | TAG_5 | VALUE | 0 | VALUE ] + [ VALUE ]\r\n    ISZERO                                                                                  [ VALUE | TAG_5 | VALUE | 0 | VALUE ] - [ VALUE ] + [ VALUE ]\r\n    PUSH [tag]      21                                                                      [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ] + [ TAG_21 ]\r\n    JUMPI                                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE ] - [ VALUE | TAG_21 ]\r\n    PUSH            1                                                                       [ VALUE | TAG_5 | VALUE | 0 | VALUE ] + [ 1 ]\r\n    Tag 21                                                                                  [ VALUE | TAG_5 | VALUE | 0 | VALUE | 1 ]\r\nBlock 21\r\n    JUMPDEST                                                                                [ VALUE | TAG_5 | VALUE | 0 | VALUE ]\r\n    PUSH [tag]      22                                                                      [ VALUE | TAG_5 | VALUE | 0 | VALUE ] + [ TAG_22 ]\r\n    JUMPI                                                                                   [ VALUE | TAG_5 | VALUE | 0 ] - [ VALUE | TAG_22 ]\r\n    POP                                                                                     [ VALUE | TAG_5 | VALUE ] - [ 0 ]\r\n    PUSH            0                                                                       [ VALUE | TAG_5 | VALUE ] + [ 0 ]\r\n    SWAP2                                                                                   [ VALUE | 0 | VALUE | TAG_5 ]\r\n    SWAP1                                                                                   [ VALUE | 0 | TAG_5 | VALUE ]\r\n    POP                                                                                     [ VALUE | 0 | TAG_5 ] - [ VALUE ]\r\n    JUMP            [out]                                                                   [ VALUE | 0 ] - [ TAG_5 ]\r\nBlock 22\r\n    JUMPDEST                                                                                [ VALUE | TAG_5 | VALUE | 0 ]\r\n    POP                                                                                     [ VALUE | TAG_5 | VALUE ] - [ 0 ]\r\n    PUSH            1                                                                       [ VALUE | TAG_5 | VALUE ] + [ 1 ]\r\n    SWAP3                                                                                   [ 1 | TAG_5 | VALUE | VALUE ]\r\n    SWAP2                                                                                   [ 1 | VALUE | VALUE | TAG_5 ]\r\n    POP                                                                                     [ 1 | VALUE | VALUE ] - [ TAG_5 ]\r\n    POP                                                                                     [ 1 | VALUE ] - [ VALUE ]\r\n    JUMP            [out]\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1092472422/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1092745240",
    "html_url": "https://github.com/ethereum/solidity/issues/12911#issuecomment-1092745240",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12911",
    "id": 1092745240,
    "node_id": "IC_kwDOAm_5kc5BIfgY",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-08T11:05:00Z",
    "updated_at": "2022-04-08T11:14:55Z",
    "author_association": "MEMBER",
    "body": "I was just looking into it and almost got a heart-attack, because you're right, this *does* look very suspicious at a first glance :-) - but by now I actually think this is not a bug and the stacks are fine here, even though it is challenging for static analysis.\r\n\r\nI reckon the reason why you say this is suspicious is that there are two jumps to block 21 and one of them has an additional value on stack?\r\n\r\nThat's indeed the case - the thing to realize, though, is that the top-most value on stack when entering block 21 is a boolean (i.e. zero or one), which is 1 exactly in the case that the stack is one slot larger and 0 exactly for the smaller stack.\r\nSo if Block 21 is entered with the larger stack it *always* jumps to Block 22 - and if it's entered with the smaller stack it never jumps there.\r\nTherefore after the JUMPI to Block 22 the stack is consistent again.\r\n\r\n[or maybe the cases are the other way round, I'd need to double-check]",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1092745240/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1092746670",
    "html_url": "https://github.com/ethereum/solidity/issues/12911#issuecomment-1092746670",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12911",
    "id": 1092746670,
    "node_id": "IC_kwDOAm_5kc5BIf2u",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-08T11:06:55Z",
    "updated_at": "2022-04-08T11:06:55Z",
    "author_association": "MEMBER",
    "body": "So for static analysis this is unfortunate:\r\nMost tags we generate have the property that they are only jumped-to with the same stack height - but for try-catch statements this may in fact be violated. So the only way to statically analyze this is to case-distinguish between that boolean value being 0 or 1 and analyzing the block in each case separately.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1092746670/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1092746916",
    "html_url": "https://github.com/ethereum/solidity/issues/12911#issuecomment-1092746916",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12911",
    "id": 1092746916,
    "node_id": "IC_kwDOAm_5kc5BIf6k",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-08T11:07:12Z",
    "updated_at": "2022-04-08T11:07:12Z",
    "author_association": "MEMBER",
    "body": "Does that make sense :-)? I need to double-check myself, but I think this is what's happening here.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1092746916/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1092748437",
    "html_url": "https://github.com/ethereum/solidity/issues/12911#issuecomment-1092748437",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12911",
    "id": 1092748437,
    "node_id": "IC_kwDOAm_5kc5BIgSV",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-08T11:09:09Z",
    "updated_at": "2022-04-08T11:09:09Z",
    "author_association": "MEMBER",
    "body": "Once we're clear on whether what I say is accurate and this is the issue, we can think about how we can make life easier for static analysis in these cases.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1092748437/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1092758687",
    "html_url": "https://github.com/ethereum/solidity/issues/12911#issuecomment-1092758687",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12911",
    "id": 1092758687,
    "node_id": "IC_kwDOAm_5kc5BIiyf",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-08T11:21:42Z",
    "updated_at": "2022-04-08T11:51:27Z",
    "author_association": "MEMBER",
    "body": "So if I haven't made a mistake right now (which I may very well have), then this is how you can analyze the situation:\r\n\r\n```\r\nBlock 17\r\n    JUMPDEST                                                                                [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ]\r\n    SWAP1                                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ]\r\n    DUP2                                                                                    [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ] + [ VALUE ]\r\n    MSTORE                                                                                  [ VALUE | TAG_5 | VALUE | 0 | VALUE ] - [ VALUE | VALUE ]\r\n    PUSH            20                                                                      [ VALUE | TAG_5 | VALUE | 0 | VALUE ] + [ 20 ]\r\n    ADD                                                                                     [ VALUE | TAG_5 | VALUE | 0 ] - [ VALUE | 20 ] + [ VALUE ]\r\n    PUSH            40                                                                      [ VALUE | TAG_5 | VALUE | 0 | VALUE ] + [ 40 ]\r\n    MLOAD                                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE ] - [ 40 ] + [ VALUE ]\r\n    DUP1                                                                                    [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ] + [ VALUE ]\r\n    SWAP2                                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE | VALUE ]\r\n    SUB                                                                                     [ VALUE | TAG_5 | VALUE | 0 | VALUE ] - [ VALUE | VALUE ] + [ VALUE ]\r\n    SWAP1                                                                                   [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ]\r\n    PUSH            0                                                                       [ VALUE | TAG_5 | VALUE | 0 | VALUE | VALUE ] + [ 0 ]\r\n    CREATE                                                                                  [ VALUE | TAG_5 | VALUE | 0 ] - [ VALUE | VALUE | 0 ] + [ SUCCES_CODE ]\r\n    DUP1                                                                                    [ VALUE | TAG_5 | VALUE | 0 | SUCCES_CODE ] + [ SUCCES_CODE ]\r\n    ISZERO                                                                                  [ VALUE | TAG_5 | VALUE | 0 | SUCCES_CODE ] - [ SUCCES_CODE ] + [ !SUCCES_CODE ]\r\n    PUSH [tag]      21                                                                      [ VALUE | TAG_5 | VALUE | 0 | SUCCES_CODE | !SUCCES_CODE ] + [ TAG_21 ]\r\n    JUMPI                                                                                   [ VALUE | TAG_5 | VALUE | 0 | SUCCES_CODE ] - [ !SUCCES_CODE | TAG_21 ] => only jumps if SUCCES_CODE is 0 - and if it doesn't jump SUCCESS_CODE has to be 1\r\n    PUSH            1                                                                       [ VALUE | TAG_5 | VALUE | 0 | SUCCESS_CODE==1 ] + [ 1 ]\r\n    Tag 21                                                                                  [ VALUE | TAG_5 | VALUE | 0 | 1 | 1 ]\r\nBlock 21 [IN CASE SUCCESS_CODE was 1]\r\n    JUMPDEST                                                                                [ VALUE | TAG_5 | VALUE | 0 | SUCCESS_CODE==1 | 1 ]\r\n    PUSH [tag]      22                                                                      [ VALUE | TAG_5 | VALUE | 0 | 1 | 1 ] + [ TAG_22 ]\r\n    JUMPI                                                                                   [ VALUE | TAG_5 | VALUE | 0 | 1 ] - [ 1 | TAG_22 ] => always jumps!\r\n    ...the rest of the block is unreachable in this case...\r\nBlock 21 [IN CASE SUCCESS_CODE was 0]\r\n    JUMPDEST                                                                                [ VALUE | TAG_5 | VALUE | 0 | SUCCESS_CODE==0 ]\r\n    PUSH [tag]      22                                                                      [ VALUE | TAG_5 | VALUE | 0 | 0 ] + [ TAG_22 ]\r\n    JUMPI                                                                                   [ VALUE | TAG_5 | VALUE | 0 ] - [ 0 | TAG_22 ] => never jumps!\r\n    POP                                                                                     [ VALUE | TAG_5 | VALUE ] - [ 0 ]\r\n    PUSH            0                                                                       [ VALUE | TAG_5 | VALUE ] + [ 0 ]\r\n    SWAP2                                                                                   [ VALUE | 0 | VALUE | TAG_5 ]\r\n    SWAP1                                                                                   [ VALUE | 0 | TAG_5 | VALUE ]\r\n    POP                                                                                     [ VALUE | 0 | TAG_5 ] - [ VALUE ]\r\n    JUMP            [out]                                                                   [ VALUE | 0 ] - [ TAG_5 ]\r\nBlock 22\r\n    JUMPDEST                                                                                [ VALUE | TAG_5 | VALUE | 0 | 1 ]\r\n    POP                                                                                     [ VALUE | TAG_5 | VALUE | 0 ] - [ 1 ]\r\n    PUSH            1                                                                       [ VALUE | TAG_5 | VALUE | 0 ] + [ 1 ]\r\n    SWAP3                                                                                   [ VALUE | 1 | VALUE | 0 | TAG_5 ]\r\n    SWAP2                                                                                   [ VALUE | 1 | TAG_5 | 0 | VALUE ]\r\n    POP                                                                                     [ VALUE | 1 | TAG_5 | 0 ] - [ VALUE ]\r\n    POP                                                                                     [ VALUE | 1 | TAG_5 ] - [ 0 ]\r\n    JUMP            [out]\t\t\t\t\t\t\t\t[ VALUE | 1 ] - [ TAG_5 ]\r\n```\r\n\r\nedited: now I think it's correct at least more or less - at least correct enough to understand the gist of things I hope.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1092758687/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1092783024",
    "html_url": "https://github.com/ethereum/solidity/issues/12911#issuecomment-1092783024",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12911",
    "id": 1092783024,
    "node_id": "IC_kwDOAm_5kc5BIouw",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-08T11:55:23Z",
    "updated_at": "2022-04-08T11:55:23Z",
    "author_association": "MEMBER",
    "body": "One more note on this: I haven't double-checked, but I think the new via-IR compilation pipeline will not generate cases like this - so you may find the result of compiling ẁith ``viaIR: true``, resp. with ``--experimental-via-ir`` (or alternatively ``--via-ir`` starting from 0.8.13) easier to analyze (you will need to enable the optimizer for that, though, since via-IR codegen without optimizer will generally quickly suffer from stack-too-deep issues)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1092783024/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1093304877",
    "html_url": "https://github.com/ethereum/solidity/issues/12911#issuecomment-1093304877",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12911",
    "id": 1093304877,
    "node_id": "IC_kwDOAm_5kc5BKoIt",
    "user": {
      "login": "hedgar2017",
      "id": 31586236,
      "node_id": "MDQ6VXNlcjMxNTg2MjM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hedgar2017",
      "html_url": "https://github.com/hedgar2017",
      "followers_url": "https://api.github.com/users/hedgar2017/followers",
      "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}",
      "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions",
      "organizations_url": "https://api.github.com/users/hedgar2017/orgs",
      "repos_url": "https://api.github.com/users/hedgar2017/repos",
      "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hedgar2017/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-08T19:57:45Z",
    "updated_at": "2022-04-08T19:57:45Z",
    "author_association": "NONE",
    "body": "@ekpyron thanks a lot! I got your point.\r\n\r\nWe are using Yul for Solidity >=0.8, but we need to support all the existing contracts starting from 0.4, that's what we need the legacy assembly for. Just in case [you are interested :)](https://github.com/matter-labs/compiler-solidity)\r\n\r\nWell, I understand what is going on, and I need to think a little to devise a solution.\r\n\r\nCould you tell me of other places where such specific workarounds may be needed?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1093304877/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1093581434",
    "html_url": "https://github.com/ethereum/solidity/issues/12911#issuecomment-1093581434",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12911",
    "id": 1093581434,
    "node_id": "IC_kwDOAm_5kc5BLrp6",
    "user": {
      "login": "hedgar2017",
      "id": 31586236,
      "node_id": "MDQ6VXNlcjMxNTg2MjM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hedgar2017",
      "html_url": "https://github.com/hedgar2017",
      "followers_url": "https://api.github.com/users/hedgar2017/followers",
      "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}",
      "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions",
      "organizations_url": "https://api.github.com/users/hedgar2017/orgs",
      "repos_url": "https://api.github.com/users/hedgar2017/repos",
      "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hedgar2017/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-09T01:59:06Z",
    "updated_at": "2022-04-09T02:01:32Z",
    "author_association": "NONE",
    "body": "@ekpyron perhaps, you can help me with these other two small related questions:\r\n1. What is the purpose of bitwise operations on tags?\r\n2. What is supposed to happen here?:\r\n```\r\n297 Tag 50                                                              \r\n298     JUMPDEST                                                                        \r\n299     DUP1                                                                            \r\n300     PUSH            51                                                              \r\n301     SUB                                                                             \r\n302     PUSH [tag]      12                                                              \r\n303     JUMPI                                                                           \r\n304     PUSH [tag]      57                                                              \r\n305     PUSH            20                                                              \r\n306     SHL                                                                             \r\n307     PUSH [tag]      18446744073709551618                                            \r\n308     OR                                                                              \r\n309     PUSH [tag]      58                                                              \r\n310     DUP2                                                                            \r\n311     PUSH            20                                                              \r\n312     SHR                                                                             \r\n313     JUMP            [in]   \r\n```\r\nFor now I have voided all such operations where I could find them. But we still have a lot of tests to run (from your repository, lol!), so I'm afraid we'll encounter this problem sooner or later.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1093581434/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1094747593",
    "html_url": "https://github.com/ethereum/solidity/issues/12911#issuecomment-1094747593",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12911",
    "id": 1094747593,
    "node_id": "IC_kwDOAm_5kc5BQIXJ",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-11T08:56:25Z",
    "updated_at": "2022-04-11T08:59:39Z",
    "author_association": "MEMBER",
    "body": "> Could you tell me of other places where such specific workarounds may be needed?\r\n\r\nIt may be that legacy code generation for ``try..catch`` is actually the only situation in which this particular situation occurs - but I'm not entirely sure - before looking into it for this issue, I didn't have in mind that it happens even there, so I may be unaware of other cases.\r\n\r\n> @ekpyron perhaps, you can help me with these other two small related questions:\r\n> \r\n>     1. What is the purpose of bitwise operations on tags?\r\n>     2. What is supposed to happen here?:\r\n> \r\n\r\nIt's a bit hard to tell without the sources leading to the snippet - but at least one case, in which you will get \"weird\" tag values and bitwise operations on tags is (in legacy code generation) internal function pointers referenced from constructors.\r\n\r\nThe reason for this is that an internal function may be located at a different offset in creation code compared to runtime code.\r\n\r\n```\r\ncontract C {\r\n  function() internal funPtr;\r\n  function fun1() internal { /* ... */ }\r\n  function fun2() internal { /* ... */ }\r\n  constructor(bool b) {\r\n    funPtr = b ? fun1 : fun2;\r\n    funPtr(); // call to an offset in creation bytecode\r\n  }\r\n  function g() external {\r\n     funPtr(); // call to an offset in runtime bytecode\r\n  }\r\n}\r\n```\r\nIn this snippet, ``funPtr`` has to store a value that works both from creation and from runtime context. So the offset for creation bytecode is stored in the higher bits and the offset for runtime bytecode is stored in the lower bits. A call to the internal function from creation will then right-shift and a call from runtime context mask.\r\nStrictly speaking, this is only necessary if a function pointer will be carried over from creation to runtime context, but since it's near impossible to tell in which cases exactly this would be the case, internal functions in creation context are *generally* encoded with both creation and runtime offsets. So you will see some shifting for calling *any* internal function pointer during construction.\r\n\r\nI'm not sure how often you'll encounter internal function pointers during contract creation in real-world contracts outside our test, though.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1094747593/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1095466582",
    "html_url": "https://github.com/ethereum/solidity/issues/12911#issuecomment-1095466582",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12911",
    "id": 1095466582,
    "node_id": "IC_kwDOAm_5kc5BS35W",
    "user": {
      "login": "hedgar2017",
      "id": 31586236,
      "node_id": "MDQ6VXNlcjMxNTg2MjM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hedgar2017",
      "html_url": "https://github.com/hedgar2017",
      "followers_url": "https://api.github.com/users/hedgar2017/followers",
      "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}",
      "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions",
      "organizations_url": "https://api.github.com/users/hedgar2017/orgs",
      "repos_url": "https://api.github.com/users/hedgar2017/repos",
      "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hedgar2017/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-11T19:22:18Z",
    "updated_at": "2022-04-11T19:22:18Z",
    "author_association": "NONE",
    "body": "@ekpyron oh, thanks for the snippet. We'll turn it into an integration test. I think I have an understanding and I'll check how such cases actually behave.\r\n\r\nConcerning the main subject of this issue, I decided to terminate all such unreachable blocks with `INVALID` in the very place where the `JUMP` wanted to pop its destination tag. Works for now, but we'll see :)\r\n\r\nThanks a lot for the answers!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1095466582/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
