{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/6724",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/6724/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/6724/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/6724/events",
  "html_url": "https://github.com/ethereum/solidity/issues/6724",
  "id": 442843652,
  "node_id": "MDU6SXNzdWU0NDI4NDM2NTI=",
  "number": 6724,
  "title": "Deployment gas estimation is incorrect.",
  "user": {
    "login": "MicahZoltu",
    "id": 886059,
    "node_id": "MDQ6VXNlcjg4NjA1OQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/886059?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MicahZoltu",
    "html_url": "https://github.com/MicahZoltu",
    "followers_url": "https://api.github.com/users/MicahZoltu/followers",
    "following_url": "https://api.github.com/users/MicahZoltu/following{/other_user}",
    "gists_url": "https://api.github.com/users/MicahZoltu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MicahZoltu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MicahZoltu/subscriptions",
    "organizations_url": "https://api.github.com/users/MicahZoltu/orgs",
    "repos_url": "https://api.github.com/users/MicahZoltu/repos",
    "events_url": "https://api.github.com/users/MicahZoltu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MicahZoltu/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2019-05-10T18:30:41Z",
  "updated_at": "2020-05-12T19:24:49Z",
  "closed_at": "2020-05-12T19:24:49Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\nI have a contract that I compiled with `evm.gasEstimates` outputSelection`.  When I try to deploy that transaction, it fails due to out of gas.  If I ask the attached node to estimate gas for the deployment instead, I get a _much_ higher estimate.  The deployment in question does not have any init code, so the deployment should be a fixed cost (not dependent on blockchain state or inputs).\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.5.8\r\n- Target EVM version (as per compiler settings): default\r\n- Framework/IDE (e.g. Truffle or Remix): Remix/custom\r\n- EVM execution environment / backend / blockchain client: go-ethereum\r\n- Operating system: Windows 10\r\n\r\n## Steps to Reproduce\r\nWith `optimizer: { enabled: true }`, the `evm.gasEstimates.creation.totalCost` is `29881`.  However, actually deploying costs `94541`.\r\n\r\n```solidity\r\npragma solidity 0.5.8;\r\n\r\ncontract Apple {\r\n\tfunction exists() external pure returns (bytes32) {\r\n\t\treturn 0x0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef;\r\n\t}\r\n}\r\n```",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/6724/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/6724/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/492235719",
    "html_url": "https://github.com/ethereum/solidity/issues/6724#issuecomment-492235719",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6724",
    "id": 492235719,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MjIzNTcxOQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-14T13:24:10Z",
    "updated_at": "2019-05-14T13:24:10Z",
    "author_association": "MEMBER",
    "body": "It might be that the gas estimator does not include the data bytes.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/492235719/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/625532913",
    "html_url": "https://github.com/ethereum/solidity/issues/6724#issuecomment-625532913",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6724",
    "id": 625532913,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNTUzMjkxMw==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-07T22:40:46Z",
    "updated_at": "2020-05-07T22:40:46Z",
    "author_association": "MEMBER",
    "body": "I'm not sure if this is solved, but we get the following estimates now:\r\n\r\nWith optimizer:\r\n```\r\n======= 6724.sol:Apple =======\r\nGas estimation:\r\nconstruction:\r\n   93 + 39000 = 39093\r\nexternal:\r\n   exists():    176\r\n```\r\n\r\nWithout optimizer:\r\n```\r\n======= 6724.sol:Apple =======\r\nGas estimation:\r\nconstruction:\r\n   93 + 41200 = 41293\r\nexternal:\r\n   exists():    197\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/625532913/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/625590221",
    "html_url": "https://github.com/ethereum/solidity/issues/6724#issuecomment-625590221",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6724",
    "id": 625590221,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNTU5MDIyMQ==",
    "user": {
      "login": "MicahZoltu",
      "id": 886059,
      "node_id": "MDQ6VXNlcjg4NjA1OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886059?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MicahZoltu",
      "html_url": "https://github.com/MicahZoltu",
      "followers_url": "https://api.github.com/users/MicahZoltu/followers",
      "following_url": "https://api.github.com/users/MicahZoltu/following{/other_user}",
      "gists_url": "https://api.github.com/users/MicahZoltu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MicahZoltu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MicahZoltu/subscriptions",
      "organizations_url": "https://api.github.com/users/MicahZoltu/orgs",
      "repos_url": "https://api.github.com/users/MicahZoltu/repos",
      "events_url": "https://api.github.com/users/MicahZoltu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MicahZoltu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-08T02:13:13Z",
    "updated_at": "2020-05-08T02:13:13Z",
    "author_association": "MEMBER",
    "body": "I just tested in Remix with Solidity version 0.6.7 and it appears to estimate correctly, though I think for most users they will lead to confusion\r\n\r\nSolidity estimate (optimized):\r\n```json\r\n{\r\n\t\"Creation\": {\r\n\t\t\"codeDepositCost\": \"31800\",\r\n\t\t\"executionCost\": \"81\",\r\n\t\t\"totalCost\": \"31881\"\r\n\t},\r\n\t\"External\": {\r\n\t\t\"exists()\": \"176\"\r\n\t}\r\n}\r\n```\r\nJavaScript EVM:\r\n-- | --\r\ntransaction cost | 97157 gas\r\n-- | --\r\nexecution cost | 31881 gas\r\n\r\nI just did a refresher from https://ethereum.stackexchange.com/a/29560/704 and I'm not sure that it is reasonable for me (as a user) to convert from `execution cost` to `transaction cost` since it requires summing up the calldata bytes I believe.  Can we make the Solidity estimator estimate *transaction cost* as well as *execution cost*?  In almost all cases, transaction cost is what people will care about, since that is what needs to be under the block gas limit and it is what they will have to pay to deploy the contract.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/625590221/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/627542993",
    "html_url": "https://github.com/ethereum/solidity/issues/6724#issuecomment-627542993",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6724",
    "id": 627542993,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzU0Mjk5Mw==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-12T19:22:52Z",
    "updated_at": "2020-05-12T19:22:52Z",
    "author_association": "MEMBER",
    "body": "The reason we are not reporting the transaction cost is not just about the calldata cost but also about the fact that the function might be called from another contract. Oh and the transaction cost actually depends on the data sent to the contract because of the zeros :)\r\n\r\nWe can add transaction cost, though. Especially for the constructor this seems very useful.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/627542993/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/627543916",
    "html_url": "https://github.com/ethereum/solidity/issues/6724#issuecomment-627543916",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/6724",
    "id": 627543916,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzU0MzkxNg==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-12T19:24:49Z",
    "updated_at": "2020-05-12T19:24:49Z",
    "author_association": "MEMBER",
    "body": "Created an issue for that: https://github.com/ethereum/solidity/issues/8920",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/627543916/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
