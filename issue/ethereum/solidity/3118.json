{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/3118",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/3118/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/3118/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/3118/events",
  "html_url": "https://github.com/ethereum/solidity/issues/3118",
  "id": 267165454,
  "node_id": "MDU6SXNzdWUyNjcxNjU0NTQ=",
  "number": 3118,
  "title": "Introduce storage cache",
  "user": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2017-10-20T12:51:01Z",
  "updated_at": "2019-01-07T12:59:37Z",
  "closed_at": "2019-01-07T12:59:37Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Suggested by @puellavulnerata - it might be a good idea to cache storage access in memory.\r\n\r\nA simple cache based on a conflict free hash table in memory could already provide a gigantic benefit. Storage read has been changed from 50 to 200 gas since Solidity was designed (actually memory costs were assumed to be much higher at that point, too), so this might be feasile.\r\n\r\nStorage reads could be replaced by the following code:\r\n\r\n```\r\nfunction sloadCached(key) -> value\r\n{\r\n  // Cache consists of a sequence of 256 key-value pairs,\r\n  // where least significant byte determines position in cache.\r\n  let cachePos := add(0x100, mul(and(key, 0xff), 0x40))\r\n  if eq(mload(cachePos), key) {\r\n    value := mload(add(cachePos, 0x20))\r\n  } else {\r\n    value := sload(key)\r\n    mstore(cachePos, key)\r\n    mstore(add(cachePos, 0x20), value)\r\n  }\r\n}\r\n```\r\n\r\nStorage writes have to invalidate the cache. Furthermore, external function calls have to clear the full cache.",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/3118/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/3118/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/338201717",
    "html_url": "https://github.com/ethereum/solidity/issues/3118#issuecomment-338201717",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3118",
    "id": 338201717,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzODIwMTcxNw==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-20T13:10:16Z",
    "updated_at": "2017-10-20T13:11:26Z",
    "author_association": "MEMBER",
    "body": "Preliminary analysis shows that a cache hit costs 130 gas, while a cache miss is 355 gas (including the 200 gas to read from storage).\r\n\r\nAlso the implementation above has to consider the special case of \"unset\" cache entries.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/338201717/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/338464069",
    "html_url": "https://github.com/ethereum/solidity/issues/3118#issuecomment-338464069",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3118",
    "id": 338464069,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzODQ2NDA2OQ==",
    "user": {
      "login": "androlo",
      "id": 2809499,
      "node_id": "MDQ6VXNlcjI4MDk0OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2809499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/androlo",
      "html_url": "https://github.com/androlo",
      "followers_url": "https://api.github.com/users/androlo/followers",
      "following_url": "https://api.github.com/users/androlo/following{/other_user}",
      "gists_url": "https://api.github.com/users/androlo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/androlo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/androlo/subscriptions",
      "organizations_url": "https://api.github.com/users/androlo/orgs",
      "repos_url": "https://api.github.com/users/androlo/repos",
      "events_url": "https://api.github.com/users/androlo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/androlo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-22T09:32:50Z",
    "updated_at": "2017-10-22T19:59:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "On a related note, there is an idea from @Arachnid about netting gas costs, which would mean lower cost for storage access when an address is zero by the time a transaction is done. Found it in this thread: https://github.com/ethereum/EIPs/pull/718#issuecomment-331615418. Not sure if it has gotten any traction but seems related.\r\n\r\nAlso linking a related issue about costly writes: https://github.com/ethereum/solidity/issues/2908",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/338464069/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/451927063",
    "html_url": "https://github.com/ethereum/solidity/issues/3118#issuecomment-451927063",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/3118",
    "id": 451927063,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MTkyNzA2Mw==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-07T12:59:37Z",
    "updated_at": "2019-01-07T12:59:37Z",
    "author_association": "MEMBER",
    "body": "This has been implemented on EVM level now.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/451927063/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
