{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12990",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12990/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12990/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12990/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12990",
  "id": 1227927704,
  "node_id": "I_kwDOAm_5kc5JMLCY",
  "number": 12990,
  "title": "The legacy assembly blocks cross-tagging between deploy and runtime code",
  "user": {
    "login": "hedgar2017",
    "id": 31586236,
    "node_id": "MDQ6VXNlcjMxNTg2MjM2",
    "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hedgar2017",
    "html_url": "https://github.com/hedgar2017",
    "followers_url": "https://api.github.com/users/hedgar2017/followers",
    "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}",
    "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions",
    "organizations_url": "https://api.github.com/users/hedgar2017/orgs",
    "repos_url": "https://api.github.com/users/hedgar2017/repos",
    "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hedgar2017/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 16,
  "created_at": "2022-05-06T14:17:55Z",
  "updated_at": "2022-05-11T20:09:13Z",
  "closed_at": "2022-05-11T20:09:13Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Since the legacy assembly is not documented, I create this issue in this section.\r\n\r\nCould anyone help me with EVM legacy assembly? I'm trying to figure out the following pattern:\r\n\r\n```\r\n031 Tag 5                                                               \r\n032     JUMPDEST                                                                        \r\n033     PUSH            0                                                               \r\n034     PUSH [tag]      8                                                               \r\n035     PUSH [tag]      9                                                               \r\n036     PUSH            20                                                              \r\n037     SHL                                                                             \r\n038     PUSH [tag]      18446744073709551625                                            \r\n039     OR                                                                              \r\n040     PUSH            20                                                              \r\n041     SHR                                                                             \r\n042     JUMP            [in]\r\n```\r\n\r\nWhat should be the result of such operation?\r\nIf I just execute the binary operations on the tags as on decimal numbers, the result does not add up to a tag of an existing block. Neither in the deploy nor in the runtime code.",
  "closed_by": {
    "login": "hedgar2017",
    "id": 31586236,
    "node_id": "MDQ6VXNlcjMxNTg2MjM2",
    "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hedgar2017",
    "html_url": "https://github.com/hedgar2017",
    "followers_url": "https://api.github.com/users/hedgar2017/followers",
    "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}",
    "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions",
    "organizations_url": "https://api.github.com/users/hedgar2017/orgs",
    "repos_url": "https://api.github.com/users/hedgar2017/repos",
    "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hedgar2017/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12990/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12990/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1120189468",
    "html_url": "https://github.com/ethereum/solidity/issues/12990#issuecomment-1120189468",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12990",
    "id": 1120189468,
    "node_id": "IC_kwDOAm_5kc5CxLwc",
    "user": {
      "login": "hedgar2017",
      "id": 31586236,
      "node_id": "MDQ6VXNlcjMxNTg2MjM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hedgar2017",
      "html_url": "https://github.com/hedgar2017",
      "followers_url": "https://api.github.com/users/hedgar2017/followers",
      "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}",
      "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions",
      "organizations_url": "https://api.github.com/users/hedgar2017/orgs",
      "repos_url": "https://api.github.com/users/hedgar2017/repos",
      "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hedgar2017/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-07T11:11:36Z",
    "updated_at": "2022-05-07T11:11:36Z",
    "author_association": "NONE",
    "body": "@ekpyron you gave me some useful information lately, though I didn't clarify this particular aspect back then.\r\nCould you please elaborate the behavior above?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1120189468/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1120890917",
    "html_url": "https://github.com/ethereum/solidity/issues/12990#issuecomment-1120890917",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12990",
    "id": 1120890917,
    "node_id": "IC_kwDOAm_5kc5Cz3Al",
    "user": {
      "login": "hrkrshnn",
      "id": 13174375,
      "node_id": "MDQ6VXNlcjEzMTc0Mzc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13174375?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hrkrshnn",
      "html_url": "https://github.com/hrkrshnn",
      "followers_url": "https://api.github.com/users/hrkrshnn/followers",
      "following_url": "https://api.github.com/users/hrkrshnn/following{/other_user}",
      "gists_url": "https://api.github.com/users/hrkrshnn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hrkrshnn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hrkrshnn/subscriptions",
      "organizations_url": "https://api.github.com/users/hrkrshnn/orgs",
      "repos_url": "https://api.github.com/users/hrkrshnn/repos",
      "events_url": "https://api.github.com/users/hrkrshnn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hrkrshnn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-09T09:53:36Z",
    "updated_at": "2022-05-09T09:53:36Z",
    "author_association": "MEMBER",
    "body": "@hedgar2017 What generated this assembly code?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1120890917/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1120908150",
    "html_url": "https://github.com/ethereum/solidity/issues/12990#issuecomment-1120908150",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12990",
    "id": 1120908150,
    "node_id": "IC_kwDOAm_5kc5Cz7N2",
    "user": {
      "login": "hedgar2017",
      "id": 31586236,
      "node_id": "MDQ6VXNlcjMxNTg2MjM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hedgar2017",
      "html_url": "https://github.com/hedgar2017",
      "followers_url": "https://api.github.com/users/hedgar2017/followers",
      "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}",
      "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions",
      "organizations_url": "https://api.github.com/users/hedgar2017/orgs",
      "repos_url": "https://api.github.com/users/hedgar2017/repos",
      "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hedgar2017/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-09T10:12:18Z",
    "updated_at": "2022-05-09T10:12:18Z",
    "author_association": "NONE",
    "body": "@hrkrshnn this test for example:\r\n```\r\ncontract A {\r\n    function f() public virtual returns (uint256 r) {\r\n        return 1;\r\n    }\r\n}\r\n\r\n\r\ncontract B is A {\r\n    function f() public virtual override returns (uint256 r) {\r\n        return super.f() | 2;\r\n    }\r\n}\r\n\r\n\r\ncontract C is A {\r\n    function f() public virtual override returns (uint256 r) {\r\n        return super.f() | 4;\r\n    }\r\n}\r\n\r\n\r\ncontract D is B, C {\r\n    uint256 data;\r\n\r\n    constructor() {\r\n        data = super.f() | 8;\r\n    }\r\n\r\n    function f() public override (B, C) returns (uint256 r) {\r\n        return data;\r\n    }\r\n}\r\n// ====\r\n// compileToEwasm: also\r\n// compileViaYul: also\r\n// ----\r\n// f() -> 15\r\n```\r\n\r\nOr any other where internal functions are called from the constructor.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1120908150/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1120914717",
    "html_url": "https://github.com/ethereum/solidity/issues/12990#issuecomment-1120914717",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12990",
    "id": 1120914717,
    "node_id": "IC_kwDOAm_5kc5Cz80d",
    "user": {
      "login": "hedgar2017",
      "id": 31586236,
      "node_id": "MDQ6VXNlcjMxNTg2MjM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hedgar2017",
      "html_url": "https://github.com/hedgar2017",
      "followers_url": "https://api.github.com/users/hedgar2017/followers",
      "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}",
      "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions",
      "organizations_url": "https://api.github.com/users/hedgar2017/orgs",
      "repos_url": "https://api.github.com/users/hedgar2017/repos",
      "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hedgar2017/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-09T10:18:42Z",
    "updated_at": "2022-05-09T10:18:42Z",
    "author_association": "NONE",
    "body": "@hrkrshnn the question is basically what is the expected behavior of the following operations: `SHL`, `SHR`, `OR`, `XOR`, `AND`, if 1 or 2 of their operands are **tags**.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1120914717/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1120918246",
    "html_url": "https://github.com/ethereum/solidity/issues/12990#issuecomment-1120918246",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12990",
    "id": 1120918246,
    "node_id": "IC_kwDOAm_5kc5Cz9rm",
    "user": {
      "login": "hrkrshnn",
      "id": 13174375,
      "node_id": "MDQ6VXNlcjEzMTc0Mzc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/13174375?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hrkrshnn",
      "html_url": "https://github.com/hrkrshnn",
      "followers_url": "https://api.github.com/users/hrkrshnn/followers",
      "following_url": "https://api.github.com/users/hrkrshnn/following{/other_user}",
      "gists_url": "https://api.github.com/users/hrkrshnn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hrkrshnn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hrkrshnn/subscriptions",
      "organizations_url": "https://api.github.com/users/hrkrshnn/orgs",
      "repos_url": "https://api.github.com/users/hrkrshnn/repos",
      "events_url": "https://api.github.com/users/hrkrshnn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hrkrshnn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-09T10:22:07Z",
    "updated_at": "2022-05-09T10:22:25Z",
    "author_association": "MEMBER",
    "body": "Tags just represent offsets in code. It can be treated as `push num`. Maybe a nice illustration of this can be\r\n```solidity\r\ncontract C {\r\n   function f() internal { ... }\r\n   function g() internal { ... }\r\n   function test(bool b) external {\r\n       function() x = b ? f : g;\r\n       x();\r\n   }\r\n}\r\n```\r\nIn the legacy compilation pipeline, you will see operations on tags here.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1120918246/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1120947955",
    "html_url": "https://github.com/ethereum/solidity/issues/12990#issuecomment-1120947955",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12990",
    "id": 1120947955,
    "node_id": "IC_kwDOAm_5kc5C0E7z",
    "user": {
      "login": "hedgar2017",
      "id": 31586236,
      "node_id": "MDQ6VXNlcjMxNTg2MjM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hedgar2017",
      "html_url": "https://github.com/hedgar2017",
      "followers_url": "https://api.github.com/users/hedgar2017/followers",
      "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}",
      "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions",
      "organizations_url": "https://api.github.com/users/hedgar2017/orgs",
      "repos_url": "https://api.github.com/users/hedgar2017/repos",
      "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hedgar2017/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-09T10:54:01Z",
    "updated_at": "2022-05-09T10:54:01Z",
    "author_association": "NONE",
    "body": "@hrkrshnn I know what they represent.\r\nThe question is above: what is the expected behavior of the following operations: SHL, SHR, OR, XOR, AND, if 1 or 2 of their operands are tags.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1120947955/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1123917620",
    "html_url": "https://github.com/ethereum/solidity/issues/12990#issuecomment-1123917620",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12990",
    "id": 1123917620,
    "node_id": "IC_kwDOAm_5kc5C_Z80",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-11T15:18:01Z",
    "updated_at": "2022-05-11T15:27:06Z",
    "author_association": "MEMBER",
    "body": "> ```\r\n> 031 Tag 5                                                               \r\n> 032     JUMPDEST                                                                        \r\n> 033     PUSH            0                                                               \r\n> 034     PUSH [tag]      8                                                               \r\n> 035     PUSH [tag]      9                                                               \r\n> 036     PUSH            20                                                              \r\n> 037     SHL                                                                             \r\n> 038     PUSH [tag]      18446744073709551625                                            \r\n> 039     OR                                                                              \r\n> 040     PUSH            20                                                              \r\n> 041     SHR                                                                             \r\n> 042     JUMP            [in]\r\n> ```\r\n\r\n``18446744073709551625`` in hexadecimal is ``0x010000000000000009``...\r\nthat's the internal tag ID of a tag that refers to something in \"subassembly\" 1, i.e. it's how construction code refers to the runtime tag 9... might be nice to make the evmasm output nicer for such cases...\r\n\r\nIn the translation from evmasm to an actual opcode sequence, this would resolve to the offset of tag 9 in the runtime code (which is known to fit into 32 bytes!).\r\n\r\nSo the sequence\r\n> 035     PUSH [tag]      9                                                               \r\n> 036     PUSH            20                                                              \r\n> 037     SHL                                                                             \r\n> 038     PUSH [tag]      18446744073709551625                                            \r\n> 039     OR                                                                              \r\n\r\nconstructs a shared runtime *and* creation time tag offset to tag_9 in creation and tag_9 in runtime code (it's just a coincidence that it's tag_9 in both cases).\r\n\r\nWe need such combined offsets, since you can *store* such a tag value in storage - and we don't know if it is used only from runtime code, only form creation code or from both.\r\n\r\nThen *calling* such a thing from creation code uses the higher-order bits of this combined offset, whereas calling it from runtime context uses the lower-order bits.\r\n\r\nSo the next part of the sequence\r\n\r\n> 040     PUSH            20                                                              \r\n> 041     SHR                                                                             \r\n\r\nextracts the offset of the respective function in creation code - and then jumps into that.\r\n\r\n\r\nDid that make sense :-)? So\r\n> 038     PUSH [tag]      18446744073709551625\r\n\r\nwill in the end really push an offset into *runtime* code during creation.\r\nAnd the tag IDs don't have any numeric relation to the actual offsets - they're just symbolic IDs and will be resolved in the translation from evmasm to opcodes.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1123917620/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124092079",
    "html_url": "https://github.com/ethereum/solidity/issues/12990#issuecomment-1124092079",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12990",
    "id": 1124092079,
    "node_id": "IC_kwDOAm_5kc5DAEiv",
    "user": {
      "login": "hedgar2017",
      "id": 31586236,
      "node_id": "MDQ6VXNlcjMxNTg2MjM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hedgar2017",
      "html_url": "https://github.com/hedgar2017",
      "followers_url": "https://api.github.com/users/hedgar2017/followers",
      "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}",
      "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions",
      "organizations_url": "https://api.github.com/users/hedgar2017/orgs",
      "repos_url": "https://api.github.com/users/hedgar2017/repos",
      "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hedgar2017/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-11T17:57:57Z",
    "updated_at": "2022-05-11T17:58:55Z",
    "author_association": "NONE",
    "body": "@ekpyron thanks a lot! That had been my working version I was going to try today!\r\n\r\nBut still, the behavior of the `OR` opcode on tags remains a little obscured and I would like to clarify it completely.\r\n\r\nI understand that before `SHR 32` there must be the needed tag in the bits `32..64` of the tag operand. Therefore, the `OR` instruction must shift either the higher or lower bits there, depending on whether we are in the creation or runtime code at the moment. Am I right?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124092079/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124167507",
    "html_url": "https://github.com/ethereum/solidity/issues/12990#issuecomment-1124167507",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12990",
    "id": 1124167507,
    "node_id": "IC_kwDOAm_5kc5DAW9T",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-11T18:42:12Z",
    "updated_at": "2022-05-11T18:42:12Z",
    "author_association": "MEMBER",
    "body": "The ``OR`` just combines the deploy-time offset with the creation-time offset... it could just as well be ``ADD``, in case that helps :-)?\r\nNote that while the tag ID in ``PUSH [tag] 18446744073709551625`` appears to be large, this is just a symbolic ID - the actual offset later on will be something small, like ``0x42`` or so...\r\n\r\nSo\r\n> 035 PUSH [tag] 9\r\n> 036     PUSH            20                                                              \r\n> 037     SHL                                                                             \r\n> 038     PUSH [tag]      18446744073709551625                                            \r\n> 039     OR                                                                              \r\n\r\nIs ``or(shl(32, <creation-offset>), <runtime-offset>)`` - the ``or`` just merges the left-shifted runtime offset and the creation offset together... so after the ``or`` you have the creation offset in the higher bits, the runtime offset in the lower bits.\r\nThen shifting to the right, will give you back the creation-time-offset (which is the right one, since you're directly jumping to it and this snippet is taken from creation code).\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124167507/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124169362",
    "html_url": "https://github.com/ethereum/solidity/issues/12990#issuecomment-1124169362",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12990",
    "id": 1124169362,
    "node_id": "IC_kwDOAm_5kc5DAXaS",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-11T18:44:18Z",
    "updated_at": "2022-05-11T18:44:18Z",
    "author_association": "MEMBER",
    "body": "So as actual opcodes you will in the end see that\r\n\r\n> 035 PUSH [tag] 9\r\n> 036 PUSH 20\r\n> 037 SHL\r\n> 038 PUSH [tag] 18446744073709551625\r\n> 039 OR\r\n\r\nwill be translated to something like\r\n\r\n> 035 PUSH 0xAA\r\n> 036 PUSH 20\r\n> 037 SHL\r\n> 038 PUSH 0xBB\r\n> 039 OR\r\n\r\nJust instead of ``0xAA`` whatever the creation-time-offset of tag 9 is and ``0xBB`` the offset of whatever the corresponding tag in runtime code is.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124169362/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124226966",
    "html_url": "https://github.com/ethereum/solidity/issues/12990#issuecomment-1124226966",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12990",
    "id": 1124226966,
    "node_id": "IC_kwDOAm_5kc5DAleW",
    "user": {
      "login": "hedgar2017",
      "id": 31586236,
      "node_id": "MDQ6VXNlcjMxNTg2MjM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hedgar2017",
      "html_url": "https://github.com/hedgar2017",
      "followers_url": "https://api.github.com/users/hedgar2017/followers",
      "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}",
      "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions",
      "organizations_url": "https://api.github.com/users/hedgar2017/orgs",
      "repos_url": "https://api.github.com/users/hedgar2017/repos",
      "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hedgar2017/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-11T19:52:20Z",
    "updated_at": "2022-05-11T19:54:09Z",
    "author_association": "NONE",
    "body": "Ok, we have clarified that the behavior of the bitwise operations is not different than with ordinary operands.\r\n\r\nHere is the example:\r\n```\r\n011 Tag 1                                                               \r\n012     JUMPDEST                                                                        \r\n013     POP                                                                             \r\n014     PUSH [tag]      4                                                               \r\n015     PUSH [tag]      5                                                               \r\n016     PUSH            20                                                              \r\n017     SHL                                                             // 500000000\r\n018     PUSH [tag]      18446744073709551624                            // 10000000000000008                         \r\n019     OR                                                              // 10000000500000008\r\n020     PUSH            20                                                              \r\n021     SHR                                                             // 100000005\r\n022     JUMP            [in]    \r\n```\r\n\r\nThus, the behavior of the `JUMP` is different. This jump has an intention to jump to the block 5 of the **creation** code (the block 5 does not exist in the **runtime** code). Why that 1 is needed in the 5-th byte, and what is the exact behavior of `JUMP` in such cases?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124226966/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124234765",
    "html_url": "https://github.com/ethereum/solidity/issues/12990#issuecomment-1124234765",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12990",
    "id": 1124234765,
    "node_id": "IC_kwDOAm_5kc5DAnYN",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-11T20:01:11Z",
    "updated_at": "2022-05-11T20:01:11Z",
    "author_association": "MEMBER",
    "body": "Let me repeat :-): ``PUSH [tag]      18446744073709551624`` does ***not*** push ``10000000000000008``. There is no 1 in the 5-th byte of whatever this tag will ultimately resolve to.\r\nJust like ``PUSH [tag] 4`` will **not** push the value ``4``, but the offset of the tag labeled 4 in the ultimate bytecode.\r\nThose are symbolic tag IDs, not literal offsets.\r\n\r\nThe higher order bit 1 you see in ``18446744073709551624``, resp. ``0x10000000000000008`` is just an internal marker that distinguishes tags referring to different sub-assemblies from normal tags. But this will still just resolve to a small offset into the runtime bytecode, once you continue compilation to pure opcodes instead of evmasm (evmasm is *not* opcodes precisely since it retains named tags instead of resolving down to concrete bytecode offsets).\r\n\r\nSo the value pushed by ``PUSH [tag]      18446744073709551624`` will **always** be smaller than ``2^32 - 1``, so after the right shift you will ultimately **always** just get the value of tag 5. This is not the literal value ``0x05`` either, but the *offset into the creation code at which the tag labeled tag_5 is located*.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124234765/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124237779",
    "html_url": "https://github.com/ethereum/solidity/issues/12990#issuecomment-1124237779",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12990",
    "id": 1124237779,
    "node_id": "IC_kwDOAm_5kc5DAoHT",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-11T20:04:49Z",
    "updated_at": "2022-05-11T20:06:02Z",
    "author_association": "MEMBER",
    "body": "You can have a look at what you get if you compile to actual opcodes either by using ``solc --opcodes`` or disassembling the binary - you will no longer see the tag IDs in there, but they will be resolved to actual bytecode offsets. Those tag IDs will only be present as long as you stay in evmasm - and then they don't refer to literal values, but it's just IDs of tags that will ultimately resolve to whatever offset in the bytecode will actually be the position of the symbolic tag.\r\n\r\nAnd a tag like ``0x10000000000000008`` just refers to the offset of the 8th tag in the ``1``st nested evmasm sub-assembly - that's what that 1 means, nothing else :-).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124237779/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124239234",
    "html_url": "https://github.com/ethereum/solidity/issues/12990#issuecomment-1124239234",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12990",
    "id": 1124239234,
    "node_id": "IC_kwDOAm_5kc5DAoeC",
    "user": {
      "login": "hedgar2017",
      "id": 31586236,
      "node_id": "MDQ6VXNlcjMxNTg2MjM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hedgar2017",
      "html_url": "https://github.com/hedgar2017",
      "followers_url": "https://api.github.com/users/hedgar2017/followers",
      "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}",
      "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions",
      "organizations_url": "https://api.github.com/users/hedgar2017/orgs",
      "repos_url": "https://api.github.com/users/hedgar2017/repos",
      "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hedgar2017/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-11T20:06:31Z",
    "updated_at": "2022-05-11T20:07:25Z",
    "author_association": "NONE",
    "body": "@ekpyron this is that particular detail I needed to hear :-) Sorry for my nuisance.\r\n\r\nI am writing a EVM-to-LLVM compiler, and in my case those tags are indeed meaningful values and they are rendered into LLVM block identifiers. So if there was anything possibly hidden under the good, I needed to know it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124239234/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124240232",
    "html_url": "https://github.com/ethereum/solidity/issues/12990#issuecomment-1124240232",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12990",
    "id": 1124240232,
    "node_id": "IC_kwDOAm_5kc5DAoto",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-11T20:07:43Z",
    "updated_at": "2022-05-11T20:07:56Z",
    "author_association": "MEMBER",
    "body": "Sure no worries - I already realized after my first post that probably that first post didn't clarify that part sufficiently well :-).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124240232/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124241481",
    "html_url": "https://github.com/ethereum/solidity/issues/12990#issuecomment-1124241481",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12990",
    "id": 1124241481,
    "node_id": "IC_kwDOAm_5kc5DApBJ",
    "user": {
      "login": "hedgar2017",
      "id": 31586236,
      "node_id": "MDQ6VXNlcjMxNTg2MjM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/31586236?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hedgar2017",
      "html_url": "https://github.com/hedgar2017",
      "followers_url": "https://api.github.com/users/hedgar2017/followers",
      "following_url": "https://api.github.com/users/hedgar2017/following{/other_user}",
      "gists_url": "https://api.github.com/users/hedgar2017/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hedgar2017/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hedgar2017/subscriptions",
      "organizations_url": "https://api.github.com/users/hedgar2017/orgs",
      "repos_url": "https://api.github.com/users/hedgar2017/repos",
      "events_url": "https://api.github.com/users/hedgar2017/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hedgar2017/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-11T20:09:13Z",
    "updated_at": "2022-05-11T20:09:13Z",
    "author_association": "NONE",
    "body": "In fact, I also use these tags to reconstruct the control flow tree, so I push the tags on the stack as ordinary integers indeed :-)\r\n\r\nThanks a lot for the detailed explanation!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1124241481/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
