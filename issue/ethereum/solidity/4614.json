{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/4614",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/4614/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/4614/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/4614/events",
  "html_url": "https://github.com/ethereum/solidity/issues/4614",
  "id": 345601696,
  "node_id": "MDU6SXNzdWUzNDU2MDE2OTY=",
  "number": 4614,
  "title": "solc compiler bug related to character encoding of the source",
  "user": {
    "login": "pieterhartel",
    "id": 22255740,
    "node_id": "MDQ6VXNlcjIyMjU1NzQw",
    "avatar_url": "https://avatars.githubusercontent.com/u/22255740?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pieterhartel",
    "html_url": "https://github.com/pieterhartel",
    "followers_url": "https://api.github.com/users/pieterhartel/followers",
    "following_url": "https://api.github.com/users/pieterhartel/following{/other_user}",
    "gists_url": "https://api.github.com/users/pieterhartel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pieterhartel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pieterhartel/subscriptions",
    "organizations_url": "https://api.github.com/users/pieterhartel/orgs",
    "repos_url": "https://api.github.com/users/pieterhartel/repos",
    "events_url": "https://api.github.com/users/pieterhartel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pieterhartel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2018-07-30T03:49:15Z",
  "updated_at": "2020-06-11T14:25:51Z",
  "closed_at": "2020-06-11T14:25:51Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I have written a 4-line contract called foo.sol (below), which confuses the compiler. The first problem is that the error message points at the wrong text because the compiler does not know how many bytes a special character (the copyright symbol) needs. There are five occurrences of the copyright symbol and the arrow to the offending text is five positions off. The second problem is, that this bug also causes the AST generated by the compiler to be incorrect. This will impact tooling that builds on the AST.\r\n\r\n--pieter\r\n\r\n```\r\n$ cat foo.sol \r\npragma solidity ^0.4.18 ;\r\ncontract Foo {\r\n/* ⒸⒸⒸⒸⒸ2017 */ constructor () public { true ; }\r\n}\r\n$ od -c foo.sol \r\n0000000    p   r   a   g   m   a       s   o   l   i   d   i   t   y    \r\n0000020    ^   0   .   4   .   1   8       ;  \\n   c   o   n   t   r   a\r\n0000040    c   t       F   o   o       {  \\n   /   *       Ⓒ  **  **   Ⓒ\r\n0000060   **  **   Ⓒ  **  **   Ⓒ  **  **   Ⓒ  **  **   2   0   1   7    \r\n0000100    *   /       c   o   n   s   t   r   u   c   t   o   r       (\r\n0000120    )       p   u   b   l   i   c       {       t   r   u   e    \r\n0000140    ;       }  \\n   }  \\n                                        \r\n0000146\r\n$ solc foo.sol \r\nfoo.sol:3:51: Warning: Statement has no effect.\r\n/* ⒸⒸⒸⒸⒸ2017 */ constructor () public { true ; }\r\n                                                  ^--^\r\n$ solc --version\r\nsolc, the solidity compiler commandline interface\r\nVersion: 0.4.24+commit.e67f0147.Darwin.appleclang\r\n$ \r\n```",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/4614/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/4614/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/410313430",
    "html_url": "https://github.com/ethereum/solidity/issues/4614#issuecomment-410313430",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4614",
    "id": 410313430,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMDMxMzQzMA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-03T16:54:25Z",
    "updated_at": "2018-08-03T16:54:25Z",
    "author_association": "MEMBER",
    "body": "Can you please be more specific about the impact on the AST?\r\n\r\nSince the encoding of the input file is not specified ,this is hard to do, but I guess we could just always assume utf8.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/410313430/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/410318534",
    "html_url": "https://github.com/ethereum/solidity/issues/4614#issuecomment-410318534",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4614",
    "id": 410318534,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMDMxODUzNA==",
    "user": {
      "login": "randomnetcat",
      "id": 1988485,
      "node_id": "MDQ6VXNlcjE5ODg0ODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1988485?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/randomnetcat",
      "html_url": "https://github.com/randomnetcat",
      "followers_url": "https://api.github.com/users/randomnetcat/followers",
      "following_url": "https://api.github.com/users/randomnetcat/following{/other_user}",
      "gists_url": "https://api.github.com/users/randomnetcat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/randomnetcat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/randomnetcat/subscriptions",
      "organizations_url": "https://api.github.com/users/randomnetcat/orgs",
      "repos_url": "https://api.github.com/users/randomnetcat/repos",
      "events_url": "https://api.github.com/users/randomnetcat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/randomnetcat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-03T17:13:17Z",
    "updated_at": "2018-08-03T17:13:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "AST as generated by `0.4.25-develop.2018.8.3+commit.2c2d4c47.Linux.g++`:\r\n```\r\n======= <stdin> =======\r\nPragmaDirective\r\n   Gas costs: 0\r\n   Source: \"pragma solidity ^0.4.18 ;\"\r\nContractDefinition \"Foo\"\r\n   Source: \"contract Foo {\\n/* \\u24b8\\u24b8\\u24b8\\u24b8\\u24b82017 */ constructor () public { true ; }\\n}\"\r\n  FunctionDefinition \"\" - public\r\n     Source: \"constructor () public { true ; }\"\r\n    ParameterList\r\n       Gas costs: 0\r\n       Source: \"()\"\r\n    ParameterList\r\n       Gas costs: 0\r\n       Source: \"\"\r\n    Block\r\n       Source: \"{ true ; }\"\r\n      ExpressionStatement\r\n         Gas costs: 0\r\n         Source: \"true\"\r\n        Literal, token: true value: true\r\n           Type: bool\r\n           Source: \"true\"\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/410318534/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/410423417",
    "html_url": "https://github.com/ethereum/solidity/issues/4614#issuecomment-410423417",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4614",
    "id": 410423417,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMDQyMzQxNw==",
    "user": {
      "login": "pieterhartel",
      "id": 22255740,
      "node_id": "MDQ6VXNlcjIyMjU1NzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22255740?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pieterhartel",
      "html_url": "https://github.com/pieterhartel",
      "followers_url": "https://api.github.com/users/pieterhartel/followers",
      "following_url": "https://api.github.com/users/pieterhartel/following{/other_user}",
      "gists_url": "https://api.github.com/users/pieterhartel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pieterhartel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pieterhartel/subscriptions",
      "organizations_url": "https://api.github.com/users/pieterhartel/orgs",
      "repos_url": "https://api.github.com/users/pieterhartel/repos",
      "events_url": "https://api.github.com/users/pieterhartel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pieterhartel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-04T04:48:51Z",
    "updated_at": "2018-08-04T04:48:51Z",
    "author_association": "NONE",
    "body": "The JSON style AST contains the position in the source text of the lexical items. These positions are also off because of the UTF-8 issue. (See example AST node below).\r\n\r\nI am using the JSON style AST for program transformations on solidity contracts. This works fine if the source is in ASCII. If it is not, I have to convert it as a work around first (with iconv) loosing the special symbols. Since these usually occur in the comments, this does not appear to be a big problem (yet).\r\n\r\nIn any case a fix would be much appreciated.\r\n\r\n--pieter\r\n\r\n{                                                                               \r\n        \"attributes\" :                                                                  \r\n        {                                                                               \r\n                \"argumentTypes\" : null,                                                         \r\n                \"hexvalue\" : \"74727565\",                                                        \r\n                \"isConstant\" : false,                                                           \r\n                \"isLValue\" : false,                                                             \r\n                \"isPure\" : true,                                                                \r\n                \"lValueRequested\" : false,                                                      \r\n                \"subdenomination\" : null,                                                       \r\n                \"token\" : \"bool\",                                                               \r\n                \"type\" : \"bool\",                                                                \r\n                \"value\" : \"true\"                                                                \r\n        },                                                                              \r\n        \"id\" : 4,                                                                       \r\n        \"name\" : \"Literal\",                                                             \r\n        \"src\" : \"91:4:0\"                                                                \r\n}       \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/410423417/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/410521472",
    "html_url": "https://github.com/ethereum/solidity/issues/4614#issuecomment-410521472",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4614",
    "id": 410521472,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMDUyMTQ3Mg==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-05T13:49:33Z",
    "updated_at": "2018-08-05T13:49:33Z",
    "author_association": "MEMBER",
    "body": "> Since the encoding of the input file is not specified ,this is hard to do, but I guess we could just always assume utf8.\r\n\r\nWe do require UTF-8 at least in string literals.\r\n\r\nI guess what could be improved is offering two source locations:\r\n- actual byte offset\r\n- character offset (parsed as UTF-8)\r\n\r\nFor the second, we would need to parse everything, including comments, as UTF-8 however I believe comments are not properly parsed at the moment.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/410521472/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/410754384",
    "html_url": "https://github.com/ethereum/solidity/issues/4614#issuecomment-410754384",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4614",
    "id": 410754384,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMDc1NDM4NA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-06T15:47:01Z",
    "updated_at": "2018-08-06T15:47:01Z",
    "author_association": "MEMBER",
    "body": "I think it is fine to only work with byte offsets. What we could improve is the calculation of the `^--^` output - and note that tabs are a similar complication we should take into account, but perhaps first check what other compilers do.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/410754384/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/633567507",
    "html_url": "https://github.com/ethereum/solidity/issues/4614#issuecomment-633567507",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/4614",
    "id": 633567507,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzMzU2NzUwNw==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-25T13:16:15Z",
    "updated_at": "2020-05-25T13:16:15Z",
    "author_association": "MEMBER",
    "body": "Fixed (well enough) by #9012",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/633567507/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
