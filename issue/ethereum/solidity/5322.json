{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/5322",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/5322/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/5322/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/5322/events",
  "html_url": "https://github.com/ethereum/solidity/issues/5322",
  "id": 374737104,
  "node_id": "MDU6SXNzdWUzNzQ3MzcxMDQ=",
  "number": 5322,
  "title": "Erasing array elements on explicit length change",
  "user": {
    "login": "k06a",
    "id": 702124,
    "node_id": "MDQ6VXNlcjcwMjEyNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/702124?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/k06a",
    "html_url": "https://github.com/k06a",
    "followers_url": "https://api.github.com/users/k06a/followers",
    "following_url": "https://api.github.com/users/k06a/following{/other_user}",
    "gists_url": "https://api.github.com/users/k06a/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/k06a/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k06a/subscriptions",
    "organizations_url": "https://api.github.com/users/k06a/orgs",
    "repos_url": "https://api.github.com/users/k06a/repos",
    "events_url": "https://api.github.com/users/k06a/events{/privacy}",
    "received_events_url": "https://api.github.com/users/k06a/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2018-10-28T10:03:37Z",
  "updated_at": "2018-11-07T22:35:06Z",
  "closed_at": "2018-11-07T22:35:06Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Today discovered that shrinking array length erases latest elements in loop. This default behavior can lead to many bugs, because many developers consider `length` change as `O(1)` complexity action. So erasing large array can waste a lot of gas also not fit into the Ethereum block.\r\n\r\nI think if someone shrinks array, this array very likely could be enlarged in future. Let's not erase latest elements on array length decrease.\r\n\r\nMade methods for `O(1)` length change and dirty elements erasement. For example second method could be exposed as smart contract public method for anyone who want to refund some gas.\r\n```Solidity\r\nlibrary DirtyArray {\r\n    function setLength(uint[] storage arr, uint length) internal {\r\n        assembly {\r\n            sstore(arr_slot, length)\r\n        }\r\n    }\r\n    \r\n    function eraseDirty(uint[] storage arr, uint start, uint length) internal {\r\n        for (uint i = start; i < start + length; i++) {\r\n            if (i >= arr.length) {\r\n                uint ptr;\r\n                assembly {\r\n                    ptr := add(keccak256(arr_slot, 0x20), i)\r\n                    if gt(sload(ptr), 0) {\r\n                        sstore(ptr, 0)\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nOr at least add this API for `O(1)` length change:\r\n```Solidity\r\narr._length = newLength;\r\n```",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/5322/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/5322/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/433697491",
    "html_url": "https://github.com/ethereum/solidity/issues/5322#issuecomment-433697491",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/5322",
    "id": 433697491,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzMzY5NzQ5MQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-28T11:41:38Z",
    "updated_at": "2018-10-28T11:41:38Z",
    "author_association": "MEMBER",
    "body": "I don't think it is a good idea to keep storage dirty - there would be no way to clear it without the use of inline assembly. We decided for a different way to solve the underlying issue, though: https://github.com/ethereum/solidity/issues/3515",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/433697491/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/433731253",
    "html_url": "https://github.com/ethereum/solidity/issues/5322#issuecomment-433731253",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/5322",
    "id": 433731253,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzMzczMTI1Mw==",
    "user": {
      "login": "k06a",
      "id": 702124,
      "node_id": "MDQ6VXNlcjcwMjEyNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/702124?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/k06a",
      "html_url": "https://github.com/k06a",
      "followers_url": "https://api.github.com/users/k06a/followers",
      "following_url": "https://api.github.com/users/k06a/following{/other_user}",
      "gists_url": "https://api.github.com/users/k06a/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/k06a/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/k06a/subscriptions",
      "organizations_url": "https://api.github.com/users/k06a/orgs",
      "repos_url": "https://api.github.com/users/k06a/repos",
      "events_url": "https://api.github.com/users/k06a/events{/privacy}",
      "received_events_url": "https://api.github.com/users/k06a/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-28T18:51:09Z",
    "updated_at": "2018-10-28T18:51:09Z",
    "author_association": "NONE",
    "body": "@chriseth I think if someone shrinks array, this array very likely will be enlarged in future. Also, I see the only way for cheap cleanup arrays or mappings to use subcontract.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/433731253/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/436802998",
    "html_url": "https://github.com/ethereum/solidity/issues/5322#issuecomment-436802998",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/5322",
    "id": 436802998,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNjgwMjk5OA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-07T22:35:06Z",
    "updated_at": "2018-11-07T22:35:06Z",
    "author_association": "MEMBER",
    "body": "If you don't mind, I will be closing this. We do not have any plans to keep storage dirty for now for various reasons.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/436802998/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
