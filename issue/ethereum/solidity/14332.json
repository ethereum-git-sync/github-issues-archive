{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/14332",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/14332/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/14332/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/14332/events",
  "html_url": "https://github.com/ethereum/solidity/issues/14332",
  "id": 1761882139,
  "node_id": "I_kwDOAm_5kc5pBDAb",
  "number": 14332,
  "title": "Stack too deep after importing interface",
  "user": {
    "login": "migoldfinger",
    "id": 106750422,
    "node_id": "U_kgDOBlzh1g",
    "avatar_url": "https://avatars.githubusercontent.com/u/106750422?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/migoldfinger",
    "html_url": "https://github.com/migoldfinger",
    "followers_url": "https://api.github.com/users/migoldfinger/followers",
    "following_url": "https://api.github.com/users/migoldfinger/following{/other_user}",
    "gists_url": "https://api.github.com/users/migoldfinger/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/migoldfinger/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/migoldfinger/subscriptions",
    "organizations_url": "https://api.github.com/users/migoldfinger/orgs",
    "repos_url": "https://api.github.com/users/migoldfinger/repos",
    "events_url": "https://api.github.com/users/migoldfinger/events{/privacy}",
    "received_events_url": "https://api.github.com/users/migoldfinger/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-06-17T14:45:54Z",
  "updated_at": "2023-06-29T08:38:09Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I got some unexpected behavior during compilation with solc 0.8.20. I can not tell if older versions had that problem too.\r\nTimelock.sol contains the interface and 2 contracts if that is of any relevance...even if it should not.\r\n\r\nWorking code\r\n```\r\n// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.20;\r\n\r\n// Generates a stack to deep error\r\n// import { ITimelock } from \"../peripherals/Timelock.sol\";\r\n\r\nimport { IVault } from \"./Vault.sol\";\r\nimport { IRouter } from \"./Router.sol\";\r\nimport { IShortsTracker } from \"./ShortsTracker.sol\";\r\n\r\ninterface ITimelock {\r\n    function marginFeeBasisPoints() external returns (uint256);\r\n    function setAdmin(address _admin) external;\r\n    function enableLeverage(address _vault) external;\r\n    function disableLeverage(address _vault) external;\r\n    function setIsLeverageEnabled(address _vault, bool _isLeverageEnabled) external;\r\n    function signalSetGov(address _target, address _gov) external;\r\n}\r\n\r\nlibrary PositionUtils {\r\n...\r\n}\r\n```\r\nCode that throws Stack too deep error\r\n```\r\n// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.20;\r\n\r\n// Generates a stack to deep error\r\nimport { ITimelock } from \"../peripherals/Timelock.sol\";\r\n\r\nimport { IVault } from \"./Vault.sol\";\r\nimport { IRouter } from \"./Router.sol\";\r\nimport { IShortsTracker } from \"./ShortsTracker.sol\";\r\n\r\n// interface ITimelock {\r\n//     function marginFeeBasisPoints() external returns (uint256);\r\n//     function setAdmin(address _admin) external;\r\n//     function enableLeverage(address _vault) external;\r\n//     function disableLeverage(address _vault) external;\r\n//     function setIsLeverageEnabled(address _vault, bool _isLeverageEnabled) external;\r\n//     function signalSetGov(address _target, address _gov) external;\r\n// }\r\n\r\nlibrary PositionUtils {\r\n...\r\n}\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/14332/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/14332/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1607194576",
    "html_url": "https://github.com/ethereum/solidity/issues/14332#issuecomment-1607194576",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14332",
    "id": 1607194576,
    "node_id": "IC_kwDOAm_5kc5fy9fQ",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-26T10:44:10Z",
    "updated_at": "2023-06-26T10:44:10Z",
    "author_association": "MEMBER",
    "body": "This indeed looks like it should not happen, but we'd need a full reproduction to investigate the cause, can you provide a complete example case?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1607194576/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1612637250",
    "html_url": "https://github.com/ethereum/solidity/issues/14332#issuecomment-1612637250",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/14332",
    "id": 1612637250,
    "node_id": "IC_kwDOAm_5kc5gHuRC",
    "user": {
      "login": "migoldfinger",
      "id": 106750422,
      "node_id": "U_kgDOBlzh1g",
      "avatar_url": "https://avatars.githubusercontent.com/u/106750422?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/migoldfinger",
      "html_url": "https://github.com/migoldfinger",
      "followers_url": "https://api.github.com/users/migoldfinger/followers",
      "following_url": "https://api.github.com/users/migoldfinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/migoldfinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/migoldfinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/migoldfinger/subscriptions",
      "organizations_url": "https://api.github.com/users/migoldfinger/orgs",
      "repos_url": "https://api.github.com/users/migoldfinger/repos",
      "events_url": "https://api.github.com/users/migoldfinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/migoldfinger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-29T08:38:09Z",
    "updated_at": "2023-06-29T08:38:09Z",
    "author_association": "NONE",
    "body": "Not anymore since I fixed the underlying problem but I can now exactly tell whats happening.\r\n\r\nFirst of all the error is correct, it's just really unhelpful that even in verbose mode there is absolutely no hint where the error is (file, contract, line).\r\n\r\nWhat you need to reproduce is.\r\nFileA.sol containing InterfaceA and ContractA deriving from InterfaceA.\r\nFileB.sol containing InterfaceB and ContractB deriving form InterfaceB.\r\n\r\nAdditional Nodes: In my case I updated ContractB from and old version to the current version of solidity. The reason for the error to appear was the use of abi-encoding v2 which is the current default. After setting back to v1 the Stack to deep error is gone, but that is not the focus of that ticket just a little side information.\r\n\r\nConditions: InterfaceB and ContractB needs to be in the same .sol-File. ContractB needs to raise an Stack to deep error.\r\nLets say ContractB is an externel contract and only included for reference, in this speacial case not even the contract but only the interface is required. So there is no need to use the bytecode of the contract.\r\n\r\nSteps to reproduce\r\nimport only the InterfaceB into FileA.sol. Reference InterfaceB in your contract just as you need.\r\n\r\nIf you compile this setup a Stack too deep exception without any other additional information like code line, contract or even file was raised.\r\nThe reason is (as far as I learned through an other issue I filed at the hardhat repo) that even if you only use the InterfaceB and any errors in the Contract implementation would not affect your code in any way ContractB is compiled during the process even if the bytecode is never used later.\r\n\r\nWith that knowledge I am unsure if this a hardhat problem with compiling contracts that are not needed or an solidity problem that raises up with the relative new feature of being able to import single interfaces/contracts from a .sol file containing multiple ones. At least the solidity compiler should be intelligent enough to skip bytecode genereration contracts from imported .sol-files that are not used.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1612637250/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
