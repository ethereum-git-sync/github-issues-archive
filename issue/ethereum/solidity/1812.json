{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/1812",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/1812/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/1812/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/1812/events",
  "html_url": "https://github.com/ethereum/solidity/issues/1812",
  "id": 215949246,
  "node_id": "MDU6SXNzdWUyMTU5NDkyNDY=",
  "number": 1812,
  "title": "Inconsistent behaviour between references to members of string arrays vs. other",
  "user": {
    "login": "maurelian",
    "id": 23033765,
    "node_id": "MDQ6VXNlcjIzMDMzNzY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/23033765?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/maurelian",
    "html_url": "https://github.com/maurelian",
    "followers_url": "https://api.github.com/users/maurelian/followers",
    "following_url": "https://api.github.com/users/maurelian/following{/other_user}",
    "gists_url": "https://api.github.com/users/maurelian/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/maurelian/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/maurelian/subscriptions",
    "organizations_url": "https://api.github.com/users/maurelian/orgs",
    "repos_url": "https://api.github.com/users/maurelian/repos",
    "events_url": "https://api.github.com/users/maurelian/events{/privacy}",
    "received_events_url": "https://api.github.com/users/maurelian/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2017-03-22T04:24:22Z",
  "updated_at": "2017-03-25T23:34:15Z",
  "closed_at": "2017-03-25T23:29:59Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "I am getting very different behaviour with string values depending on whether or not I name the `returns` value in the function declaration. \r\n\r\n    contract PopArray {\r\n        string[] public string_arr;\r\n        \r\n        function PopArray() {\r\n            // fill the array with some data\r\n            string_arr = ['zero', 'one', 'two', 'three', 'four'];\r\n        }\r\n    \r\n        // Calling this once returns 'four', calling it a second time returns 'three', etc. \r\n        function pop_string () returns (string member) {\r\n            member = string_arr[string_arr.length-1]; //get the last value\r\n            string_arr.length = string_arr.length-1;  // reduce the length of the array\r\n            return member;\r\n        } \r\n    \r\n        // Calling this returns nothing, but does reduce the length of the array.\r\n        function broken_pop_string () returns (string) {\r\n            string member = string_arr[string_arr.length-1];\r\n            string_arr.length = string_arr.length-1;\r\n            return member;\r\n        }\r\n    }\r\n    \r\n\r\nHere is how the results look in remix when I call one function, then the other : [![remix results][1]][1]. \r\n\r\nBy adding event logs, I can see that the reference is deleted by this line: `string_arr.length = string_arr.length-1;`. I also was able to address the issue by using `string memory member = ...` when the variable is not named in the declaration.\r\n\r\nThat seems like reasonable behaviour, however when I tried this out with other array types, a value is returned regardless of whether or not the return value is named in the function declaration, or the `memory` keyword is used. \r\n\r\n[Here is some code][2] testing it out with `uint` and `bytes32` values.\r\n\r\nIs there a subtlety regarding strings that I'm missing here? I could not find documentation describing it. \r\n\r\n  [1]: https://i.stack.imgur.com/qvvBT.png\r\n  [2]: https://gist.github.com/maurelian/2a8ff9b1f7e3d8c69374f751af960633\r\n",
  "closed_by": {
    "login": "maurelian",
    "id": 23033765,
    "node_id": "MDQ6VXNlcjIzMDMzNzY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/23033765?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/maurelian",
    "html_url": "https://github.com/maurelian",
    "followers_url": "https://api.github.com/users/maurelian/followers",
    "following_url": "https://api.github.com/users/maurelian/following{/other_user}",
    "gists_url": "https://api.github.com/users/maurelian/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/maurelian/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/maurelian/subscriptions",
    "organizations_url": "https://api.github.com/users/maurelian/orgs",
    "repos_url": "https://api.github.com/users/maurelian/repos",
    "events_url": "https://api.github.com/users/maurelian/events{/privacy}",
    "received_events_url": "https://api.github.com/users/maurelian/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/1812/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/1812/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/288352222",
    "html_url": "https://github.com/ethereum/solidity/issues/1812#issuecomment-288352222",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1812",
    "id": 288352222,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4ODM1MjIyMg==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-22T10:06:36Z",
    "updated_at": "2017-03-22T10:06:36Z",
    "author_association": "MEMBER",
    "body": "This indeed is subtle behaviour and has its roots in the way Solidity was created in increments.\r\n\r\nLocal variables of reference types are storage references by default. If you use `string member` you are declaring a storage reference instead of a memory variable. This means `member = string_arr[string_arr.length-1];` assigns a reference to the last element of the array in storage. If you then reduce the length of the array, this element is deleted and you return the empty string.\r\n\r\nFunction arguments and return values, in contrast, are memory references by default, so by `member = string_arr[string_arr.length-1];` in `pop_string` you are requesting a copy from storage to memory.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/288352222/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/288505487",
    "html_url": "https://github.com/ethereum/solidity/issues/1812#issuecomment-288505487",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1812",
    "id": 288505487,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4ODUwNTQ4Nw==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-22T19:02:29Z",
    "updated_at": "2017-03-22T19:02:29Z",
    "author_association": "MEMBER",
    "body": "Just created this issue to at least slightly improve the situation: https://github.com/ethereum/solidity/issues/1815",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/288505487/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/288534370",
    "html_url": "https://github.com/ethereum/solidity/issues/1812#issuecomment-288534370",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1812",
    "id": 288534370,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4ODUzNDM3MA==",
    "user": {
      "login": "maurelian",
      "id": 23033765,
      "node_id": "MDQ6VXNlcjIzMDMzNzY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23033765?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maurelian",
      "html_url": "https://github.com/maurelian",
      "followers_url": "https://api.github.com/users/maurelian/followers",
      "following_url": "https://api.github.com/users/maurelian/following{/other_user}",
      "gists_url": "https://api.github.com/users/maurelian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/maurelian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/maurelian/subscriptions",
      "organizations_url": "https://api.github.com/users/maurelian/orgs",
      "repos_url": "https://api.github.com/users/maurelian/repos",
      "events_url": "https://api.github.com/users/maurelian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/maurelian/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-22T20:48:25Z",
    "updated_at": "2017-03-22T20:49:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for your response @chriseth. Your explanation is enlightening, it makes sense that a storage reference would be returned empty if what it references is deleted. \r\n\r\nHowever its still unclear to me, or even moreso now, why the behaviour isn't similar with other types. This [example code](https://ethereum.github.io/browser-solidity/#version=soljson-v0.4.10+commit.f0d539ae.js&gist=16bdce8dae1743e96879c544dd3ee7f8) implements exactly the same `broken_pop_string` function, two more times but with `uint` and `bytes32`. As far as I can tell they are identical, including the declaration of `member` in the body of the function. However, when the array item they reference is deleted, the variable still holds the original value. \r\n\r\nWhat is different about a local variable that references an item in a `string[]` array? I can't find anything about it in the docs.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/288534370/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/289074028",
    "html_url": "https://github.com/ethereum/solidity/issues/1812#issuecomment-289074028",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1812",
    "id": 289074028,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4OTA3NDAyOA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-24T16:34:16Z",
    "updated_at": "2017-03-24T16:34:16Z",
    "author_association": "MEMBER",
    "body": "@maurelian `string` is a reference type (mainly because it has variable length) while `uint` and `bytes32` are value types (they fit inside 256 bits). Value types are always copied and never referenced while reference types are always referenced and only copied if an assignment changes the data location (i.e. from storage to memory or memory to storage).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/289074028/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/289247031",
    "html_url": "https://github.com/ethereum/solidity/issues/1812#issuecomment-289247031",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1812",
    "id": 289247031,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4OTI0NzAzMQ==",
    "user": {
      "login": "maurelian",
      "id": 23033765,
      "node_id": "MDQ6VXNlcjIzMDMzNzY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23033765?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maurelian",
      "html_url": "https://github.com/maurelian",
      "followers_url": "https://api.github.com/users/maurelian/followers",
      "following_url": "https://api.github.com/users/maurelian/following{/other_user}",
      "gists_url": "https://api.github.com/users/maurelian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/maurelian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/maurelian/subscriptions",
      "organizations_url": "https://api.github.com/users/maurelian/orgs",
      "repos_url": "https://api.github.com/users/maurelian/repos",
      "events_url": "https://api.github.com/users/maurelian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/maurelian/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-25T23:34:15Z",
    "updated_at": "2017-03-25T23:34:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for clarifying @chriseth. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/289247031/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
