{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/12649",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/12649/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/12649/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/12649/events",
  "html_url": "https://github.com/ethereum/solidity/issues/12649",
  "id": 1127368087,
  "node_id": "I_kwDOAm_5kc5DMkWX",
  "number": 12649,
  "title": "LSP Code Folding - Improper folding",
  "user": {
    "login": "stevennevins",
    "id": 12021290,
    "node_id": "MDQ6VXNlcjEyMDIxMjkw",
    "avatar_url": "https://avatars.githubusercontent.com/u/12021290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stevennevins",
    "html_url": "https://github.com/stevennevins",
    "followers_url": "https://api.github.com/users/stevennevins/followers",
    "following_url": "https://api.github.com/users/stevennevins/following{/other_user}",
    "gists_url": "https://api.github.com/users/stevennevins/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stevennevins/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stevennevins/subscriptions",
    "organizations_url": "https://api.github.com/users/stevennevins/orgs",
    "repos_url": "https://api.github.com/users/stevennevins/repos",
    "events_url": "https://api.github.com/users/stevennevins/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stevennevins/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3784569283,
      "node_id": "LA_kwDOAm_5kc7hk_HD",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/language%20server",
      "name": "language server",
      "color": "FEF2C0",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-02-08T14:58:01Z",
  "updated_at": "2022-09-02T20:07:02Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nLSP improper detection of code folding\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.8.11\r\n- Framework/IDE (e.g. Truffle or Remix): Vim\r\n- Operating system: MacOS\r\n\r\n## Steps to Reproduce\r\n\r\n<!--\r\n\r\nConfigure lsp server following instructions in the release announcement\r\nhttps://blog.soliditylang.org/2021/12/20/solidity-0.8.11-release-announcement/\r\n\r\n-->\r\n\r\n## Example\r\n\r\nsetup function folds improperly\r\n\r\n```solidity\r\n\r\n// SPDX-License-Identifier: Unlicense\r\npragma solidity ^0.8.0;\r\nimport \"ds-test/test.sol\";\r\n\r\nimport \"../../Greeter.sol\";\r\nimport \"forge-std/Vm.sol\";\r\n\r\ncontract User {\r\n    Greeter internal greeter;\r\n\r\n    constructor(address _greeter) {\r\n        greeter = Greeter(_greeter);\r\n    }\r\n\r\n    function greet(string memory greeting) public {\r\n        greeter.greet(greeting);\r\n    }\r\n\r\n    function gm() public {\r\n        greeter.gm();\r\n    }\r\n}\r\n\r\nabstract contract Fixture1 is DSTest {\r\n    Vm internal constant hevm = Vm(HEVM_ADDRESS);\r\n\r\n    // contracts\r\n    Greeter internal greeter;\r\n\r\n    // users\r\n    User internal alice;\r\n    User internal bob;\r\n\r\n    function setUp(\r\n        address here,\r\n        uint256 amount,\r\n        address who,\r\n        uint256 wad,\r\n        uint256 test\r\n    ) public virtual {\r\n        greeter = new Greeter();\r\n        alice = new User(address(greeter));\r\n        bob = new User(address(greeter));\r\n        greeter.transferOwnership(address(alice));\r\n    }\r\n}\r\n\r\n```\r\n\r\n<img width=\"317\" alt=\"Screen Shot 2022-02-08 at 9 40 27 AM\" src=\"https://user-images.githubusercontent.com/12021290/153012756-15845adc-80ef-4e00-9e41-de1ceeabe1ad.png\">",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/12649/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/12649/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1032704015",
    "html_url": "https://github.com/ethereum/solidity/issues/12649#issuecomment-1032704015",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12649",
    "id": 1032704015,
    "node_id": "IC_kwDOAm_5kc49jdAP",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-08T15:00:55Z",
    "updated_at": "2022-02-08T15:00:55Z",
    "author_association": "MEMBER",
    "body": "Code folding is not implemented in the solidity lsp. Could this maybe come from a different plugin?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1032704015/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1032706278",
    "html_url": "https://github.com/ethereum/solidity/issues/12649#issuecomment-1032706278",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12649",
    "id": 1032706278,
    "node_id": "IC_kwDOAm_5kc49jdjm",
    "user": {
      "login": "stevennevins",
      "id": 12021290,
      "node_id": "MDQ6VXNlcjEyMDIxMjkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/12021290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevennevins",
      "html_url": "https://github.com/stevennevins",
      "followers_url": "https://api.github.com/users/stevennevins/followers",
      "following_url": "https://api.github.com/users/stevennevins/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevennevins/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevennevins/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevennevins/subscriptions",
      "organizations_url": "https://api.github.com/users/stevennevins/orgs",
      "repos_url": "https://api.github.com/users/stevennevins/repos",
      "events_url": "https://api.github.com/users/stevennevins/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevennevins/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-08T15:03:04Z",
    "updated_at": "2022-02-08T15:03:04Z",
    "author_association": "NONE",
    "body": "I think i read in the coc plugin docs that it consults the lsp to fold based on syntax.  I'll do a bit more research and report back",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1032706278/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1032720417",
    "html_url": "https://github.com/ethereum/solidity/issues/12649#issuecomment-1032720417",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12649",
    "id": 1032720417,
    "node_id": "IC_kwDOAm_5kc49jhAh",
    "user": {
      "login": "stevennevins",
      "id": 12021290,
      "node_id": "MDQ6VXNlcjEyMDIxMjkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/12021290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stevennevins",
      "html_url": "https://github.com/stevennevins",
      "followers_url": "https://api.github.com/users/stevennevins/followers",
      "following_url": "https://api.github.com/users/stevennevins/following{/other_user}",
      "gists_url": "https://api.github.com/users/stevennevins/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stevennevins/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stevennevins/subscriptions",
      "organizations_url": "https://api.github.com/users/stevennevins/orgs",
      "repos_url": "https://api.github.com/users/stevennevins/repos",
      "events_url": "https://api.github.com/users/stevennevins/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stevennevins/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-08T15:16:09Z",
    "updated_at": "2022-02-08T15:16:09Z",
    "author_association": "NONE",
    "body": "I think this behavior is caused coc trying to handle the code folding itself and this is just coc doing it's best to infer folding ranges without knowing solidity syntax since it's not handled by the lsp.  Might be more appropriate to close this issue and add this to the list prioritizing features to support",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1032720417/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1235858050",
    "html_url": "https://github.com/ethereum/solidity/issues/12649#issuecomment-1235858050",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/12649",
    "id": 1235858050,
    "node_id": "IC_kwDOAm_5kc5JqbKC",
    "user": {
      "login": "christianparpart",
      "id": 56763,
      "node_id": "MDQ6VXNlcjU2NzYz",
      "avatar_url": "https://avatars.githubusercontent.com/u/56763?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/christianparpart",
      "html_url": "https://github.com/christianparpart",
      "followers_url": "https://api.github.com/users/christianparpart/followers",
      "following_url": "https://api.github.com/users/christianparpart/following{/other_user}",
      "gists_url": "https://api.github.com/users/christianparpart/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/christianparpart/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/christianparpart/subscriptions",
      "organizations_url": "https://api.github.com/users/christianparpart/orgs",
      "repos_url": "https://api.github.com/users/christianparpart/repos",
      "events_url": "https://api.github.com/users/christianparpart/events{/privacy}",
      "received_events_url": "https://api.github.com/users/christianparpart/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-02T20:07:02Z",
    "updated_at": "2022-09-02T20:07:02Z",
    "author_association": "MEMBER",
    "body": "I actually had a look at how LSP can guide folding and it's actually not that complex: => https://microsoft.github.io/language-server-protocol/specifications/lsp/3.17/specification/#textDocument_foldingRange\r\n\r\nAlso, coc.nvim [does support](https://github.com/neoclide/coc.nvim/pull/3819) that, so it should be fairly trivial to ensure functionality with some working clients.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1235858050/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
