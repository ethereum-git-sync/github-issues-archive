{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/7530",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/7530/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/7530/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/7530/events",
  "html_url": "https://github.com/ethereum/solidity/issues/7530",
  "id": 505428686,
  "node_id": "MDU6SXNzdWU1MDU0Mjg2ODY=",
  "number": 7530,
  "title": "ABI does not contain sufficient information to compute the correct function selector",
  "user": {
    "login": "gsalzer",
    "id": 13353518,
    "node_id": "MDQ6VXNlcjEzMzUzNTE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/13353518?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gsalzer",
    "html_url": "https://github.com/gsalzer",
    "followers_url": "https://api.github.com/users/gsalzer/followers",
    "following_url": "https://api.github.com/users/gsalzer/following{/other_user}",
    "gists_url": "https://api.github.com/users/gsalzer/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gsalzer/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gsalzer/subscriptions",
    "organizations_url": "https://api.github.com/users/gsalzer/orgs",
    "repos_url": "https://api.github.com/users/gsalzer/repos",
    "events_url": "https://api.github.com/users/gsalzer/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gsalzer/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    },
    {
      "id": 1017612679,
      "node_id": "MDU6TGFiZWwxMDE3NjEyNjc5",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/protocol%20design%20:crystal_ball:",
      "name": "protocol design :crystal_ball:",
      "color": "8af77e",
      "default": false,
      "description": "Potential changes to ABI, meta data, standard JSON"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2019-10-10T18:10:55Z",
  "updated_at": "2020-09-26T21:59:57Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "\r\n## Description\r\n\r\nThe ABI does not contain sufficient information to compute the correct function selector for accessing the contract. More specifically, a `library` and a `contract` with the same entry points may have different 4 byte selectors, but nothing in the ABI allows to decide whether we are dealing with a contract or a libary.\r\n\r\nA similar issue is raised in #7102, but there the conclusion is to put the information into the metadata, which does not the issue here. Possible solutions:\r\n\r\n- Put a flag like `contractKind: contract` or `contractKind: library` into the ABI.\r\n- For each function (and event?), add a field with the string that has to be hashed for the selector.\r\n- Less preferably: for each function (and event?), add a field with the 4/32-byte selector.\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.5.12\r\n- Target EVM version (as per compiler settings): default\r\n- Framework/IDE (e.g. Truffle or Remix): command line\r\n- EVM execution environment / backend / blockchain client:\r\n- Operating system: Linux\r\n\r\n## Steps to Reproduce\r\n\r\nThe ABIs of the following two contracts are identical, but the selectors are different.\r\n```\r\n$ cat l.sol\r\npragma solidity ^0.5.0;\r\npragma experimental ABIEncoderV2;\r\nlibrary C {\r\n  struct S {address a;}\r\n  function F(S calldata) external pure returns (uint256) {return 0;}\r\n}\r\n\r\n$ solc --hashes --abi l.sol\r\n[...]\r\nFunction signatures: \r\n9b21e02d: F(C.S)\r\nContract JSON ABI \r\n[{\"constant\":true,\"inputs\":[{\"components\":[{\"internalType\":\"address\",\"name\":\"a\",\"type\":\"address\"}],\"internalType\":\"struct C.S\",\"name\":\"\",\"type\":\"tuple\"}],\"name\":\"F\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"pure\",\"type\":\"function\"}]\r\n```\r\n```\r\n$ cat c.sol\r\npragma solidity ^0.5.0;\r\npragma experimental ABIEncoderV2;\r\ncontract C {\r\n  struct S {address a;}\r\n  function F(S calldata) external pure returns (uint256) {return 0;}\r\n}\r\n\r\n$ solc --hashes --abi c.sol\r\n[...]\r\nFunction signatures: \r\na0b61132: F((address))\r\nContract JSON ABI \r\n[{\"constant\":true,\"inputs\":[{\"components\":[{\"internalType\":\"address\",\"name\":\"a\",\"type\":\"address\"}],\"internalType\":\"struct C.S\",\"name\":\"\",\"type\":\"tuple\"}],\"name\":\"F\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"stateMutability\":\"pure\",\"type\":\"function\"}]\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/7530/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/7530/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/542228290",
    "html_url": "https://github.com/ethereum/solidity/issues/7530#issuecomment-542228290",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7530",
    "id": 542228290,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjIyODI5MA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-15T14:03:07Z",
    "updated_at": "2019-10-15T14:03:07Z",
    "author_association": "MEMBER",
    "body": "This is a bug in the compiler, the function should not be part of the library's ABI, because its hash is computed differently. Usually, library functions are not supposed to be called directly (i.e. not from a contract), but since people are doing it, we allowed it for some functions.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/542228290/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/543217176",
    "html_url": "https://github.com/ethereum/solidity/issues/7530#issuecomment-543217176",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7530",
    "id": 543217176,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MzIxNzE3Ng==",
    "user": {
      "login": "gsalzer",
      "id": 13353518,
      "node_id": "MDQ6VXNlcjEzMzUzNTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/13353518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalzer",
      "html_url": "https://github.com/gsalzer",
      "followers_url": "https://api.github.com/users/gsalzer/followers",
      "following_url": "https://api.github.com/users/gsalzer/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalzer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalzer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalzer/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalzer/orgs",
      "repos_url": "https://api.github.com/users/gsalzer/repos",
      "events_url": "https://api.github.com/users/gsalzer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalzer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-17T15:01:47Z",
    "updated_at": "2019-10-17T15:01:47Z",
    "author_association": "NONE",
    "body": "My impression was that `external`/`public` functions of libraries should be callable by  contracts via `delegatecall`. Moreover, shouldn't libraries be usable from contracts that have been compiled by other tools than Solidity (e.g., by contracts in other languages)? In this case the ABI should contain all external functions, sufficient information for computing the correct selector, and information on the admissible types of calls.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/543217176/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/543224020",
    "html_url": "https://github.com/ethereum/solidity/issues/7530#issuecomment-543224020",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7530",
    "id": 543224020,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MzIyNDAyMA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-17T15:16:19Z",
    "updated_at": "2019-10-17T15:16:19Z",
    "author_association": "MEMBER",
    "body": "Indeed, but libraries are considered to be solidity-internal. They have always used features that were not part of the generic ABI (storage pointers, for instance).\r\n\r\nHaving said that, I think there is also another issue planned for 0.6.0 that should solve this problem.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/543224020/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/543666988",
    "html_url": "https://github.com/ethereum/solidity/issues/7530#issuecomment-543666988",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7530",
    "id": 543666988,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MzY2Njk4OA==",
    "user": {
      "login": "erak",
      "id": 20012009,
      "node_id": "MDQ6VXNlcjIwMDEyMDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/20012009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/erak",
      "html_url": "https://github.com/erak",
      "followers_url": "https://api.github.com/users/erak/followers",
      "following_url": "https://api.github.com/users/erak/following{/other_user}",
      "gists_url": "https://api.github.com/users/erak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/erak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/erak/subscriptions",
      "organizations_url": "https://api.github.com/users/erak/orgs",
      "repos_url": "https://api.github.com/users/erak/repos",
      "events_url": "https://api.github.com/users/erak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/erak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-18T10:44:19Z",
    "updated_at": "2019-10-18T10:44:19Z",
    "author_association": "COLLABORATOR",
    "body": "I think this is related to https://github.com/ethereum/solidity/issues/6420.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/543666988/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/556160018",
    "html_url": "https://github.com/ethereum/solidity/issues/7530#issuecomment-556160018",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7530",
    "id": 556160018,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NjE2MDAxOA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-20T17:44:12Z",
    "updated_at": "2019-11-20T17:44:12Z",
    "author_association": "MEMBER",
    "body": "Partly solved by #7719 ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/556160018/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/655688864",
    "html_url": "https://github.com/ethereum/solidity/issues/7530#issuecomment-655688864",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/7530",
    "id": 655688864,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1NTY4ODg2NA==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-08T18:40:00Z",
    "updated_at": "2020-07-08T18:40:14Z",
    "author_association": "MEMBER",
    "body": "What is the status here? Do we want to start omitting such library functions from the ABI in 0.7.0?\r\n\r\ncc @chriseth @ekpyron ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/655688864/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
