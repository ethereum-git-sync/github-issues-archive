{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/10001",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/10001/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/10001/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/10001/events",
  "html_url": "https://github.com/ethereum/solidity/issues/10001",
  "id": 717863519,
  "node_id": "MDU6SXNzdWU3MTc4NjM1MTk=",
  "number": 10001,
  "title": "abi.decode does not seem to be having correctly with memory",
  "user": {
    "login": "deluca-mike",
    "id": 35537333,
    "node_id": "MDQ6VXNlcjM1NTM3MzMz",
    "avatar_url": "https://avatars.githubusercontent.com/u/35537333?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/deluca-mike",
    "html_url": "https://github.com/deluca-mike",
    "followers_url": "https://api.github.com/users/deluca-mike/followers",
    "following_url": "https://api.github.com/users/deluca-mike/following{/other_user}",
    "gists_url": "https://api.github.com/users/deluca-mike/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/deluca-mike/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/deluca-mike/subscriptions",
    "organizations_url": "https://api.github.com/users/deluca-mike/orgs",
    "repos_url": "https://api.github.com/users/deluca-mike/repos",
    "events_url": "https://api.github.com/users/deluca-mike/events{/privacy}",
    "received_events_url": "https://api.github.com/users/deluca-mike/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-10-09T05:29:41Z",
  "updated_at": "2020-10-09T10:37:52Z",
  "closed_at": "2020-10-09T10:30:47Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\n`abi.decode` is (seemingly) not decoding correctly, at least for a `bytes`, in memory, of length 68 (i.e. byte4, bytes32, bytes32)\r\n\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.6.12 and 0.7.3\r\n- Target EVM version (as per compiler settings): petersburg\r\n- Framework/IDE (e.g. Truffle or Remix): Truffle\r\n- EVM execution environment / backend / blockchain client: Ganache\r\n- Operating system: OSX Catalina 10.15.7 (19H2)\r\n\r\n## Steps to Reproduce\r\n\r\nWhen I call `myFunc` below in this way:\r\n\r\n```\r\nconst dataHex = '0x052f1ef000000000000000000000000000000000000000000000000000000000000000002c91ae39b411ab15cfdcf148a174f4aa7e922c8f9c050daa346a72c933a1a731';\r\nconst { receipt, logs } = await contractInstance.myFunc(callDataHex);\r\n```\r\n<br>\r\n<br>\r\n\r\nI get the following results:\r\n\r\n```\r\n// Try to decode first 4 bytes from left (works)\r\n\r\nevent Debug(bytes4);\r\nfunction myFunc(bytes memory data) public {\r\n    (bytes4 sig) = abi.decode(data, (bytes4));\r\n    emit Debug(sig);\r\n}\r\n```\r\n`logs[0].args[0]` is `0x052f1ef0`\r\n<br>\r\n<br>\r\n\r\n```\r\n// Try to decode first 4 bytes and second 32 bytes from left (fails, gets first 4 bytes from left, then 32 bytes 4 away from the right)\r\n\r\nevent Debug(bytes4, byte32);\r\nfunction myFunc(bytes memory data) public {\r\n    (bytes4 sig, bytes32 thing_1) = abi.decode(data, (bytes4, bytes32));\r\n    emit Debug(sig, thing_1);\r\n}\r\n```\r\n`logs[0].args[0]` is `0x052f1ef0`\r\n`logs[0].args[1]` is `0x000000002c91ae39b411ab15cfdcf148a174f4aa7e922c8f9c050daa346a72c9`\r\n<br>\r\n<br>\r\n\r\n```\r\n// Try to decode first 32 bytes and second 32 bytes from left (works)\r\n\r\nevent Debug(bytes32, byte32);\r\nfunction myFunc(bytes memory data) public {\r\n    (bytes32 thing_1, bytes32 thing_2) = abi.decode(data, (bytes32, bytes32));\r\n    emit Debug(thing_1, thing_2);\r\n}\r\n```\r\n`logs[0].args[0]` is `0x052f1ef000000000000000000000000000000000000000000000000000000000`\r\n`logs[0].args[1]` is `0x000000002c91ae39b411ab15cfdcf148a174f4aa7e922c8f9c050daa346a72c9`\r\n<br>\r\n<br>\r\n\r\n```\r\n// Try to decode first 4 bytes, second 32 bytes, and third 32 bytes, from left (reverts)\r\n\r\nevent Debug(bytes4, byte32, bytes32);\r\nfunction myFunc(bytes memory data) public {\r\n    (bytes4 sig, bytes32 thing_1, bytes32 thing_2) = abi.decode(data, (bytes4, bytes32, bytes32));\r\n    emit Debug(sig, thing_1, thing_2);\r\n}\r\n```\r\n`Error: Returned error: VM Exception while processing transaction: revert`\r\n<br>\r\n<br>\r\n\r\n```\r\n// And just to make sure data is what I think it is:\r\n\r\nevent Debug(bytes);\r\nfunction myFunc(bytes memory data) public {\r\n    (bytes4 sig, bytes32 thing_1) = abi.decode(data, (bytes4));\r\n    emit Debug(data);\r\n}\r\n```\r\n`logs[0].args[0]` is `0x052f1ef000000000000000000000000000000000000000000000000000000000000000002c91ae39b411ab15cfdcf148a174f4aa7e922c8f9c050daa346a72c933a1a731`\r\n<br>\r\n<br>\r\n\r\n```\r\n// Try to decode first 32 bytes, second 4 bytes, from left (reverts)\r\n\r\nevent Debug(byte32, bytes4);\r\nfunction myFunc(bytes memory data) public {\r\n    (bytes32 thing_1, bytes4 thing_2) = abi.decode(data, (bytes32, bytes4));\r\n    emit Debug(thing_1, thing_2);\r\n}\r\n```\r\n`Error: Returned error: VM Exception while processing transaction: revert`\r\n<br>\r\n<br>\r\n\r\nHowever, this all works correct if `data` uses `calldata` as storage, instead of `memory`, in the function signature.",
  "closed_by": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/10001/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/10001/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/705979121",
    "html_url": "https://github.com/ethereum/solidity/issues/10001#issuecomment-705979121",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10001",
    "id": 705979121,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTk3OTEyMQ==",
    "user": {
      "login": "3esmit",
      "id": 224810,
      "node_id": "MDQ6VXNlcjIyNDgxMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/224810?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/3esmit",
      "html_url": "https://github.com/3esmit",
      "followers_url": "https://api.github.com/users/3esmit/followers",
      "following_url": "https://api.github.com/users/3esmit/following{/other_user}",
      "gists_url": "https://api.github.com/users/3esmit/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/3esmit/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/3esmit/subscriptions",
      "organizations_url": "https://api.github.com/users/3esmit/orgs",
      "repos_url": "https://api.github.com/users/3esmit/repos",
      "events_url": "https://api.github.com/users/3esmit/events{/privacy}",
      "received_events_url": "https://api.github.com/users/3esmit/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-09T05:39:19Z",
    "updated_at": "2020-10-09T05:39:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "See https://github.com/ethereum/solidity/issues/9439",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/705979121/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/706103721",
    "html_url": "https://github.com/ethereum/solidity/issues/10001#issuecomment-706103721",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10001",
    "id": 706103721,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNjEwMzcyMQ==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-09T10:30:47Z",
    "updated_at": "2020-10-09T10:37:52Z",
    "author_association": "MEMBER",
    "body": "@deluca-mike From #9439:\r\n> `abi.decode` is the converse of `abi.encode`. From the fact that you are using `bytes4 sig` I assume that you are trying to do abi decoding and function selector decoding at the same time. This won't work because the abi encoding pads all types to 32 bytes, while the function selector is not padded.\r\n>\r\n> If you change `_data` to `bytes calldata`, then you can use the following to decode: `abi.decode(_data[4:], (bytes32, address, bytes32, bytes32));`\r\n\r\nSo what you're seeing is how it's supposed to work currently, though we're considering adding `abi.decodeWithSignature()` to the language to better support your use case.\r\n\r\nI'm going to close this as a duplicate not to split the discussion. Please feel free to post your comments in #9439 if you have something to add to the discussion.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/706103721/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
