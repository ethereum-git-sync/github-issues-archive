{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/10165",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/10165/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/10165/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/10165/events",
  "html_url": "https://github.com/ethereum/solidity/issues/10165",
  "id": 733501742,
  "node_id": "MDU6SXNzdWU3MzM1MDE3NDI=",
  "number": 10165,
  "title": "Clean up the bytecode comparison scripts",
  "user": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 437863668,
      "node_id": "MDU6TGFiZWw0Mzc4NjM2Njg=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/build%20system%20:building_construction:",
      "name": "build system :building_construction:",
      "color": "1d76db",
      "default": false,
      "description": ""
    },
    {
      "id": 1018738457,
      "node_id": "MDU6TGFiZWwxMDE4NzM4NDU3",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/testing%20:hammer:",
      "name": "testing :hammer:",
      "color": "ffc6db",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "cameel",
    "id": 137030,
    "node_id": "MDQ6VXNlcjEzNzAzMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cameel",
    "html_url": "https://github.com/cameel",
    "followers_url": "https://api.github.com/users/cameel/followers",
    "following_url": "https://api.github.com/users/cameel/following{/other_user}",
    "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
    "organizations_url": "https://api.github.com/users/cameel/orgs",
    "repos_url": "https://api.github.com/users/cameel/repos",
    "events_url": "https://api.github.com/users/cameel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cameel/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2020-10-30T20:37:01Z",
  "updated_at": "2021-01-11T17:57:48Z",
  "closed_at": "2021-01-11T17:57:48Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Extracted from https://github.com/ethereum/solidity/issues/4698#issuecomment-719770498. Related to #9931.\r\n\r\n@ekpyron\r\n> That being said, I did only do the minimal amount of work to get it running again in #10039 - it would be nice to clean up the mechanism a bit. I.e. ``scripts/bytecodecompare/storebytecode.sh`` for the emscripten case is rather horrible - we could actually just run the ``solcjs`` wrapper script from the solc-js repo as ``solc`` to run it with the ``scripts/bytecodecompare/prepare_report.py`` script instead of using this horrible on-the-fly temporary javascript file produced by the script, etc...",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/10165/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/10165/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/719792651",
    "html_url": "https://github.com/ethereum/solidity/issues/10165#issuecomment-719792651",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10165",
    "id": 719792651,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxOTc5MjY1MQ==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-30T20:50:07Z",
    "updated_at": "2020-10-30T20:50:34Z",
    "author_association": "MEMBER",
    "body": "Another small improvement to do here would be replacing the manual stripping of SMTChecker pragmas in https://github.com/ethereum/solidity/blob/v0.7.4/scripts/bytecodecompare/prepare_report.py#L17 with the JSON equivalent of the recently introduced (#10036) `--model-checker-engine none` option.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/719792651/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/744521194",
    "html_url": "https://github.com/ethereum/solidity/issues/10165#issuecomment-744521194",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10165",
    "id": 744521194,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NDUyMTE5NA==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-14T15:36:17Z",
    "updated_at": "2020-12-14T15:37:01Z",
    "author_association": "MEMBER",
    "body": "@ekpyron As I said on the call today, removing the JS snippet from `storebytecode.sh` and running `solcjs` from `prepare_report.py` works but is sloooooooooooooooooooooooooow. It starts a new node.js process and loads the compiler from scratch for every compiler call.\r\n\r\nFor this reason I don't think we can get rid of it completely, but we could trim it a bit and convert it into a wrapper for batch compilation that accepts a series of JSON files as input and produces corresponding output JSON files - without making assumptions about what's in it. Writing the input/output out to disk would be less optimal but I think the difference in performance would be negligible and it would allow us to keep the input/output processing logic unified in `prepare_report.py`.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/744521194/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/744522654",
    "html_url": "https://github.com/ethereum/solidity/issues/10165#issuecomment-744522654",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10165",
    "id": 744522654,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NDUyMjY1NA==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-14T15:38:40Z",
    "updated_at": "2020-12-14T15:38:40Z",
    "author_association": "MEMBER",
    "body": "It's fine not to replace the snippet - but did you check exactly what happens? My guess would be that it's not the loading of the compiler, but the issue of node not exiting properly, a.k.a https://github.com/ethereum/solidity/issues/9297... If you're up for it you can check that and add ``process.exit(0);`` unconditionally to the very end of https://github.com/ethereum/solc-js/blob/master/solcjs ...",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/744522654/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/744524254",
    "html_url": "https://github.com/ethereum/solidity/issues/10165#issuecomment-744524254",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10165",
    "id": 744524254,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NDUyNDI1NA==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-14T15:41:02Z",
    "updated_at": "2020-12-14T15:41:14Z",
    "author_association": "MEMBER",
    "body": "That being said it is a lot of contracts, so keeping one instance of node and the compiler for all of them may still help independently of #9297, so as I said: fine not to change anything about it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/744524254/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/744538956",
    "html_url": "https://github.com/ethereum/solidity/issues/10165#issuecomment-744538956",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/10165",
    "id": 744538956,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NDUzODk1Ng==",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-14T16:03:38Z",
    "updated_at": "2020-12-14T16:03:38Z",
    "author_association": "MEMBER",
    "body": "I think that's not it. I'm running node.js 14 and the delay I saw was more like ~1 second per call than the 7 seconds we're seeing there (I made it print a pair of messages around every compiler call). It still adds up over several thousand compilations.\r\n\r\nActually I do see a ~5 second delay when I run this snippet manually on the command line:\r\n``` bash\r\nnode -e \"console.log('begin'); console.log(require('./index.js').version()); console.log('end')\"\r\n```\r\nand this is weird because I'm not on node.js 10 and delay is much smaller when I run `solcjs` from `prepare_report.py`. But even then I can see that loading the compiler is not instant. It takes it that ~1 second to print the version so it would be that slow even if we fixed #9297.\r\n\r\n> so as I said: fine not to change anything about it.\r\n\r\nI'd prefer to change it actually. The main reason I'm touching it now is that I need to add a bit more functionality there to be able to run solc via CLI too and parse the output. I **could** limit my changes only to `prepare_bytecode.py` (because AFAIK there's no way to run CLI via `solc-js` anyway; `solcjs` just simulates it using standard JSON internally) but it's bugging me that we have a part of this logic duplicated in the JS snippet. That will lead to them getting out of sync down the line.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/744538956/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
