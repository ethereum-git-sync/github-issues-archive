{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/1753",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/1753/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/1753/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/1753/events",
  "html_url": "https://github.com/ethereum/solidity/issues/1753",
  "id": 212508936,
  "node_id": "MDU6SXNzdWUyMTI1MDg5MzY=",
  "number": 1753,
  "title": "Endless delegation loop in Ballot example contract",
  "user": {
    "login": "fuerstr",
    "id": 10598439,
    "node_id": "MDQ6VXNlcjEwNTk4NDM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/10598439?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fuerstr",
    "html_url": "https://github.com/fuerstr",
    "followers_url": "https://api.github.com/users/fuerstr/followers",
    "following_url": "https://api.github.com/users/fuerstr/following{/other_user}",
    "gists_url": "https://api.github.com/users/fuerstr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fuerstr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fuerstr/subscriptions",
    "organizations_url": "https://api.github.com/users/fuerstr/orgs",
    "repos_url": "https://api.github.com/users/fuerstr/repos",
    "events_url": "https://api.github.com/users/fuerstr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fuerstr/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2017-03-07T17:50:13Z",
  "updated_at": "2017-03-09T11:39:25Z",
  "closed_at": "2017-03-09T11:39:25Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "The function delegate() in the [Ballot example contract](https://github.com/ethereum/solidity/blob/develop/docs/solidity-by-example.rst) does not behave as expected. It is possible to create an endless delegation loop.\r\n\r\nAn \"->\" means \"delegates to\"\r\n\r\nInitial state:\r\n- voter1 -> voter2\r\n- voter2 -> voter3\r\n\r\nFor adding another delegation from voter3 to voter1, a throw is expected, because of a delegation loop. However, this does not work as expected.\r\n\r\nThe while-loop stops as soon as voters[to].delegate is equal to msg.sender. At this time the variable \"to\" points still to voter2.\r\n\r\n```\r\nwhile (\r\n    voters[to].delegate != address(0) &&\r\n    voters[to].delegate != msg.sender    // <----- stops here, at the second time\r\n) {\r\n    to = voters[to].delegate;\r\n}\r\n\r\nif (to == msg.sender) {\r\n    throw;\r\n}\r\n```\r\nSince the sender is voter3 and \"to\" is still voter2, the if statement that checks for delegation loops is therefore false and no throw occurs.\r\n\r\nInstead of a throw, a delegation to voter2 is created:\r\n- voter3 -> voter2\r\n\r\nNow we have the following delegations with a loop between voter2 and voter3:\r\n- voter1 -> voter2\r\n- voter2 -> voter3\r\n- voter3 -> voter2\r\n\r\nWhen we now add an additional delegation from a voter4 to one of this three voters, we stuck in an endless while loop.",
  "closed_by": {
    "login": "chriseth",
    "id": 9073706,
    "node_id": "MDQ6VXNlcjkwNzM3MDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chriseth",
    "html_url": "https://github.com/chriseth",
    "followers_url": "https://api.github.com/users/chriseth/followers",
    "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
    "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
    "organizations_url": "https://api.github.com/users/chriseth/orgs",
    "repos_url": "https://api.github.com/users/chriseth/repos",
    "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chriseth/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/1753/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/1753/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/284819474",
    "html_url": "https://github.com/ethereum/solidity/issues/1753#issuecomment-284819474",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1753",
    "id": 284819474,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NDgxOTQ3NA==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-07T18:53:19Z",
    "updated_at": "2017-03-07T18:53:19Z",
    "author_association": "MEMBER",
    "body": "Nice find! Do you want to create a pull request to fix it? The code can be found at https://github.com/ethereum/browser-solidity/blob/master/src/app/example-contracts.js",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/284819474/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/284839875",
    "html_url": "https://github.com/ethereum/solidity/issues/1753#issuecomment-284839875",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1753",
    "id": 284839875,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NDgzOTg3NQ==",
    "user": {
      "login": "fuerstr",
      "id": 10598439,
      "node_id": "MDQ6VXNlcjEwNTk4NDM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/10598439?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fuerstr",
      "html_url": "https://github.com/fuerstr",
      "followers_url": "https://api.github.com/users/fuerstr/followers",
      "following_url": "https://api.github.com/users/fuerstr/following{/other_user}",
      "gists_url": "https://api.github.com/users/fuerstr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fuerstr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fuerstr/subscriptions",
      "organizations_url": "https://api.github.com/users/fuerstr/orgs",
      "repos_url": "https://api.github.com/users/fuerstr/repos",
      "events_url": "https://api.github.com/users/fuerstr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fuerstr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-07T19:55:19Z",
    "updated_at": "2017-03-07T19:55:19Z",
    "author_association": "NONE",
    "body": "Actually, I meant the code here in the documentation: https://github.com/ethereum/solidity/blob/develop/docs/solidity-by-example.rst\r\n\r\nThe code here is not exactly the same, but obviously it has the same issue:\r\nhttps://github.com/ethereum/browser-solidity/blob/master/src/app/example-contracts.js\r\n\r\nI think it would be useful if the code is the same in both places, and we fix it once. Which one should we use? The code in the documentation is better commented and easier to read. Are there any objections to use this code everywhere?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/284839875/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/284993656",
    "html_url": "https://github.com/ethereum/solidity/issues/1753#issuecomment-284993656",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/1753",
    "id": 284993656,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4NDk5MzY1Ng==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-08T09:38:46Z",
    "updated_at": "2017-03-08T09:38:46Z",
    "author_association": "MEMBER",
    "body": "Yes, good idea! Let's us the better documented code in both places.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/284993656/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
