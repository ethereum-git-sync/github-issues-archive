{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/13969",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/13969/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/13969/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/13969/events",
  "html_url": "https://github.com/ethereum/solidity/issues/13969",
  "id": 1582796737,
  "node_id": "I_kwDOAm_5kc5eV4_B",
  "number": 13969,
  "title": "The old optimizer breaks public function equality",
  "user": {
    "login": "chatziko",
    "id": 362089,
    "node_id": "MDQ6VXNlcjM2MjA4OQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/362089?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chatziko",
    "html_url": "https://github.com/chatziko",
    "followers_url": "https://api.github.com/users/chatziko/followers",
    "following_url": "https://api.github.com/users/chatziko/following{/other_user}",
    "gists_url": "https://api.github.com/users/chatziko/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chatziko/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chatziko/subscriptions",
    "organizations_url": "https://api.github.com/users/chatziko/orgs",
    "repos_url": "https://api.github.com/users/chatziko/repos",
    "events_url": "https://api.github.com/users/chatziko/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chatziko/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 249074435,
      "node_id": "MDU6TGFiZWwyNDkwNzQ0MzU=",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/bug%20:bug:",
      "name": "bug :bug:",
      "color": "fc1313",
      "default": false,
      "description": ""
    },
    {
      "id": 4438006499,
      "node_id": "LA_kwDOAm_5kc8AAAABCIaa4w",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/low%20effort",
      "name": "low effort",
      "color": "ffb1fa",
      "default": false,
      "description": "There is not much implementation work to be done. The task is very easy or tiny."
    },
    {
      "id": 4438155599,
      "node_id": "LA_kwDOAm_5kc8AAAABCIjhTw",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/medium%20impact",
      "name": "medium impact",
      "color": "314aff",
      "default": false,
      "description": "Default level of impact"
    },
    {
      "id": 4438481746,
      "node_id": "LA_kwDOAm_5kc8AAAABCI3bUg",
      "url": "https://api.github.com/repos/ethereum/solidity/labels/must%20have%20eventually",
      "name": "must have eventually",
      "color": "ffb04d",
      "default": false,
      "description": "Something we consider essential but not enough to prevent us from releasing Solidity 1.0 without it."
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/ethereum/solidity/milestones/57",
    "html_url": "https://github.com/ethereum/solidity/milestone/57",
    "labels_url": "https://api.github.com/repos/ethereum/solidity/milestones/57/labels",
    "id": 9494042,
    "node_id": "MI_kwDOAm_5kc4AkN4a",
    "number": 57,
    "title": "0.8.22",
    "description": null,
    "creator": {
      "login": "NunoFilipeSantos",
      "id": 2582498,
      "node_id": "MDQ6VXNlcjI1ODI0OTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2582498?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NunoFilipeSantos",
      "html_url": "https://github.com/NunoFilipeSantos",
      "followers_url": "https://api.github.com/users/NunoFilipeSantos/followers",
      "following_url": "https://api.github.com/users/NunoFilipeSantos/following{/other_user}",
      "gists_url": "https://api.github.com/users/NunoFilipeSantos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NunoFilipeSantos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NunoFilipeSantos/subscriptions",
      "organizations_url": "https://api.github.com/users/NunoFilipeSantos/orgs",
      "repos_url": "https://api.github.com/users/NunoFilipeSantos/repos",
      "events_url": "https://api.github.com/users/NunoFilipeSantos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NunoFilipeSantos/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 10,
    "closed_issues": 0,
    "state": "open",
    "created_at": "2023-06-05T13:39:54Z",
    "updated_at": "2023-07-17T13:15:17Z",
    "due_on": null,
    "closed_at": null
  },
  "comments": 7,
  "created_at": "2023-02-13T17:49:42Z",
  "updated_at": "2023-07-17T15:36:27Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nWe (@chatziko, @MichaelXanth) ran into an optimizer issue that can be reproduced in the following minimal contract: \r\n```solidity\r\npragma solidity ^0.8.18;\r\n\r\ncontract Test {\r\n    function v1() public {}\r\n    function v2() public {}\r\n\r\n    function equalityTest() external returns(bool) {\r\n        return v1 == v2;\r\n    }\r\n}\r\n```\r\n\r\n`equalityTest()` returns`false` when the optimizer is disabled. However, with the old optimizer enabled, the equivalent functions `v1` and `v2` are merged into one, causing `v1 == v2` to be `true`. I am not sure whether there is a clear specification of function type comparison, but the two functions have distinct selectors so it makes sense to consider them as non-equal. In any case, the optimizer should not alter the contract's semantics.\r\n\r\nThis behaviour does not appear in the Yul optimizer.\r\n\r\n## Environment\r\n\r\n- Compiler version: 0.8.18\r\n  - Also with the unreleased 0.8.19\r\n- Target EVM version (as per compiler settings): istanbul\r\n- Framework/IDE (e.g. Truffle or Remix): hardhat\r\n\r\n## Steps to Reproduce\r\n\r\nCompile the above contract with and without the optimizer.\r\n\r\nThe produced bytecode can be compared below:\r\n\r\nhttps://library.dedaub.com/decompile\r\n\r\nNon-Optimized MD5: e1a4db0287ad6624f24ab4adbc61475b\r\nOptimized MD5: 531e2a5364fdbc3e00c9733a4372d948\r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/13969/reactions",
    "total_count": 3,
    "+1": 3,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/13969/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1428692870",
    "html_url": "https://github.com/ethereum/solidity/issues/13969#issuecomment-1428692870",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13969",
    "id": 1428692870,
    "node_id": "IC_kwDOAm_5kc5VKB-G",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-13T21:13:51Z",
    "updated_at": "2023-02-13T21:13:51Z",
    "author_association": "MEMBER",
    "body": "Just to be clear here: I take it that ``this.v1 == this.v2`` will actually *not* be affected by this?\r\n\r\nFor context: `v1` and `v2` are *internal* function pointers - you can also only assign them to internal function pointers and only call them internally. If the optimizer collapses identical internal functions, the described behaviour is at least in some sense consistent.\r\n\r\nOn the other hand, ``this.v1`` and ``this.v2`` are *external* function pointers, which actually involve encoding the address of ``this`` and the selector together. For those, the optimizer changing the behaviour of an equality comparison would definitely be a serious bug.\r\n\r\nJust to make this distinction clear here - all that being said, it still seems a bit weird and misleading that this happens - out of my head I'm not quite sure what to do about this. An option would be to disallow comparisons of internal function types altogether - although there might be uses for that.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1428692870/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1429273832",
    "html_url": "https://github.com/ethereum/solidity/issues/13969#issuecomment-1429273832",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13969",
    "id": 1429273832,
    "node_id": "IC_kwDOAm_5kc5VMPzo",
    "user": {
      "login": "chatziko",
      "id": 362089,
      "node_id": "MDQ6VXNlcjM2MjA4OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/362089?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chatziko",
      "html_url": "https://github.com/chatziko",
      "followers_url": "https://api.github.com/users/chatziko/followers",
      "following_url": "https://api.github.com/users/chatziko/following{/other_user}",
      "gists_url": "https://api.github.com/users/chatziko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chatziko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chatziko/subscriptions",
      "organizations_url": "https://api.github.com/users/chatziko/orgs",
      "repos_url": "https://api.github.com/users/chatziko/repos",
      "events_url": "https://api.github.com/users/chatziko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chatziko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-14T07:45:33Z",
    "updated_at": "2023-02-14T07:45:33Z",
    "author_association": "NONE",
    "body": "Indeed `this.v1 == this.v2` is __not__ affect, the issue concerns internal function pointers.\r\n\r\nMaybe a function should not be candidate for collapsing if it's used as a function pointer anywhere in the code?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1429273832/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1429697963",
    "html_url": "https://github.com/ethereum/solidity/issues/13969#issuecomment-1429697963",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13969",
    "id": 1429697963,
    "node_id": "IC_kwDOAm_5kc5VN3Wr",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-14T12:51:02Z",
    "updated_at": "2023-02-14T12:51:02Z",
    "author_association": "MEMBER",
    "body": "I'd rather consider disallowing comparisons on internal functions - did you actually intend to compare internal functions here? What was your use case for that?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1429697963/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1429725899",
    "html_url": "https://github.com/ethereum/solidity/issues/13969#issuecomment-1429725899",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13969",
    "id": 1429725899,
    "node_id": "IC_kwDOAm_5kc5VN-LL",
    "user": {
      "login": "chatziko",
      "id": 362089,
      "node_id": "MDQ6VXNlcjM2MjA4OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/362089?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chatziko",
      "html_url": "https://github.com/chatziko",
      "followers_url": "https://api.github.com/users/chatziko/followers",
      "following_url": "https://api.github.com/users/chatziko/following{/other_user}",
      "gists_url": "https://api.github.com/users/chatziko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chatziko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chatziko/subscriptions",
      "organizations_url": "https://api.github.com/users/chatziko/orgs",
      "repos_url": "https://api.github.com/users/chatziko/repos",
      "events_url": "https://api.github.com/users/chatziko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chatziko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-14T13:10:44Z",
    "updated_at": "2023-02-14T13:10:44Z",
    "author_association": "NONE",
    "body": "No, not really, we accidentally ran into this, we don't need it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1429725899/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1431440212",
    "html_url": "https://github.com/ethereum/solidity/issues/13969#issuecomment-1431440212",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13969",
    "id": 1431440212,
    "node_id": "IC_kwDOAm_5kc5VUgtU",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-15T14:16:31Z",
    "updated_at": "2023-02-15T14:16:31Z",
    "author_association": "MEMBER",
    "body": "Decision from the call: we'll add a warning about comparing internal functions and in 0.9.0 we'll make it an error.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1431440212/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1455987158",
    "html_url": "https://github.com/ethereum/solidity/issues/13969#issuecomment-1455987158",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13969",
    "id": 1455987158,
    "node_id": "IC_kwDOAm_5kc5WyJnW",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-06T11:46:33Z",
    "updated_at": "2023-03-06T11:46:33Z",
    "author_association": "MEMBER",
    "body": "Changing the milestone for the warning part to 0.8.20. We can then flip to 0.9.0 for making it an error.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1455987158/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1638391917",
    "html_url": "https://github.com/ethereum/solidity/issues/13969#issuecomment-1638391917",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/13969",
    "id": 1638391917,
    "node_id": "IC_kwDOAm_5kc5hp-Bt",
    "user": {
      "login": "cameel",
      "id": 137030,
      "node_id": "MDQ6VXNlcjEzNzAzMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/137030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cameel",
      "html_url": "https://github.com/cameel",
      "followers_url": "https://api.github.com/users/cameel/followers",
      "following_url": "https://api.github.com/users/cameel/following{/other_user}",
      "gists_url": "https://api.github.com/users/cameel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cameel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cameel/subscriptions",
      "organizations_url": "https://api.github.com/users/cameel/orgs",
      "repos_url": "https://api.github.com/users/cameel/repos",
      "events_url": "https://api.github.com/users/cameel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cameel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-17T15:36:27Z",
    "updated_at": "2023-07-17T15:36:27Z",
    "author_association": "MEMBER",
    "body": "Adding a test case from https://github.com/ethereum/solidity/pull/14367#discussion_r1261431279\r\n\r\n```solidity\r\ncontract C {\r\n    function f() internal {}\r\n    function g() internal {}\r\n\r\n    function test() public returns (bool) {\r\n        function () internal ptr = C.f;\r\n        return ptr == C.g;\r\n    }\r\n}\r\n```\r\n\r\nThis is most likely an instance of the same issue, but we should double check when we have a fix.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/1638391917/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
