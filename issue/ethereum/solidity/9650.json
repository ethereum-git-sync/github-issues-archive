{
  "url": "https://api.github.com/repos/ethereum/solidity/issues/9650",
  "repository_url": "https://api.github.com/repos/ethereum/solidity",
  "labels_url": "https://api.github.com/repos/ethereum/solidity/issues/9650/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/solidity/issues/9650/comments",
  "events_url": "https://api.github.com/repos/ethereum/solidity/issues/9650/events",
  "html_url": "https://github.com/ethereum/solidity/issues/9650",
  "id": 683240974,
  "node_id": "MDU6SXNzdWU2ODMyNDA5NzQ=",
  "number": 9650,
  "title": "Support easy multifile verification on block explorers",
  "user": {
    "login": "abcoathup",
    "id": 28278242,
    "node_id": "MDQ6VXNlcjI4Mjc4MjQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/28278242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/abcoathup",
    "html_url": "https://github.com/abcoathup",
    "followers_url": "https://api.github.com/users/abcoathup/followers",
    "following_url": "https://api.github.com/users/abcoathup/following{/other_user}",
    "gists_url": "https://api.github.com/users/abcoathup/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/abcoathup/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/abcoathup/subscriptions",
    "organizations_url": "https://api.github.com/users/abcoathup/orgs",
    "repos_url": "https://api.github.com/users/abcoathup/repos",
    "events_url": "https://api.github.com/users/abcoathup/events{/privacy}",
    "received_events_url": "https://api.github.com/users/abcoathup/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-08-21T03:55:40Z",
  "updated_at": "2020-08-28T07:45:21Z",
  "closed_at": "2020-08-28T07:45:20Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Abstract\r\nSupport easy multifile verification on block explorers, as many developers flatten contracts to verify.\r\nWhilst not a compiler issue per-se, we need the ecosystem to support.\r\n\r\nPreviously discussed indirectly: https://github.com/ethereum/solidity/issues/8989\r\n\r\n## Motivation\r\nThere is a community expectation that code controlling any value will be verified on block explorers.\r\n\r\nEtherscan verify API only supports flattened files\r\n>from: https://etherscan.io/apis#contracts\r\n>Contracts that use \"imports\" will need to have the code concatenated into one file as we do not support \"imports\" in separate files. You can try using the Blockcat solidity-flattener or SolidityFlattery\r\n\r\nThis means that many developers flatten their contracts to verify.\r\n\r\nFlattening with SPDX License Identifiers is now a problem as developers either need to ensure that they use a single compatible license otherwise they could be changing/removing the license of third party code that they are importing.\r\nhttps://forum.openzeppelin.com/t/solidity-0-6-8-introduces-spdx-license-identifiers/2859\r\n\r\nEtherscan web interface supports multiple files but the files have to be in a single directory and the imports changed so that the imports use a single directory.\r\n\r\nCreating this issue here to raise awareness of the problem so that we can solve for the ecosystem.\r\nhttps://twitter.com/ethchris/status/1296430655979618309?s=20\r\n\r\nIf we could make multifile verification easy for all developers then there would no longer be a need to flatten.\r\n\r\n## Example\r\n\r\nThe following simple ERC20 token inheriting from the OpenZeppelin Contracts ERC20 implementation was deployed to Rinkeby using Truffle.\r\n\r\n### SimpleToken.sol\r\n```solidity\r\n// SPDX-License-Identifier: MIT\r\npragma solidity ^0.6.0;\r\n\r\nimport \"@openzeppelin/contracts/token/ERC20/ERC20.sol\";\r\n\r\n/**\r\n * @title SimpleToken\r\n * @dev Very simple ERC20 Token example, where all tokens are pre-assigned to the creator.\r\n * Note they can later distribute these tokens as they wish using `transfer` and other\r\n * `ERC20` functions.\r\n */\r\ncontract SimpleToken is ERC20 {\r\n\r\n    /**\r\n     * @dev Constructor that gives msg.sender all of existing tokens.\r\n     */\r\n    constructor () public ERC20(\"Simple Token\", \"SIM\") {\r\n        _mint(msg.sender, 1000000 * (10 ** uint256(decimals())));\r\n    }\r\n}\r\n```\r\n\r\nTo verify as multifile, the SimpleToken.sol contract along with the five imported contracts had to be placed in a single directory, copying the required contracts from `node_modules/@openzeppelin/contracts` and then modifying any imports whether relative or from `@openzeppelin/contracts` to be relative to a single directory.\r\n\r\nThe contract could then be verified uploading the files from the one directory:\r\n\r\n```\r\n1)  Address.sol |   | (6078 Bytes)\r\n2)  Context.sol |   | (933 Bytes)\r\n3)  ERC20.sol |   | (10765 Bytes)\r\n4)  IERC20.sol |   | (2696 Bytes)\r\n5)  SafeMath.sol |   | (5201 Bytes)\r\n6)  SimpleToken.sol |   | (559 Bytes)\r\n```\r\n\r\nThe end result is the six contracts being verified, but the contracts still had to have their imports modified, so they are not the exact same text as what was used to compile/deploy.\r\n\r\nhttps://rinkeby.etherscan.io/address/0xd43C0a135F36A8D8a3961d3d56BdCccD47CBD319#code\r\n\r\n----\r\n\r\nCompare with the process of flattening (or even using a tool that connects to the API)  - except for the issue of multiple SPDX License identifiers since Solidity 0.6.8\r\n\r\n```\r\n$ npx truffle-flattener ./contracts/SimpleToken.sol > ./FlatSimpleToken.sol\r\nnpx: installed 64 in 13.339s\r\n```",
  "closed_by": {
    "login": "abcoathup",
    "id": 28278242,
    "node_id": "MDQ6VXNlcjI4Mjc4MjQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/28278242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/abcoathup",
    "html_url": "https://github.com/abcoathup",
    "followers_url": "https://api.github.com/users/abcoathup/followers",
    "following_url": "https://api.github.com/users/abcoathup/following{/other_user}",
    "gists_url": "https://api.github.com/users/abcoathup/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/abcoathup/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/abcoathup/subscriptions",
    "organizations_url": "https://api.github.com/users/abcoathup/orgs",
    "repos_url": "https://api.github.com/users/abcoathup/repos",
    "events_url": "https://api.github.com/users/abcoathup/events{/privacy}",
    "received_events_url": "https://api.github.com/users/abcoathup/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/9650/reactions",
    "total_count": 3,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 3,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/solidity/issues/9650/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/678139986",
    "html_url": "https://github.com/ethereum/solidity/issues/9650#issuecomment-678139986",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9650",
    "id": 678139986,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3ODEzOTk4Ng==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-21T09:26:56Z",
    "updated_at": "2020-08-21T09:26:56Z",
    "author_association": "MEMBER",
    "body": "Thanks for opening this issue! We will try to tackle a specific verification failure like https://github.com/ethereum/solidity/issues/9573 but I fear that a generic issue like this is not really helpful:\r\n\r\nThe compiler has been generating metadata files that are meant to make verification a breeze for years. So apart from fixing bugs, I don't think the compiler (this repository) can really improve the situation. Still, flattening is preferred over these metadata files, even though they contain more information like optimizer settings and so on which you usually have to manually enter after flattening.\r\n\r\nThe [sourcify project](https://sourcify.dev/) tries to solve the user-interface part of verification and one goal is indeed to provide easy to use npm packages like you describe at the end of the issue description.\r\n\r\nWe could discuss here how to improve etherscan's multi-file verification here, but I don't think this is helpful.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/678139986/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/678937053",
    "html_url": "https://github.com/ethereum/solidity/issues/9650#issuecomment-678937053",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9650",
    "id": 678937053,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3ODkzNzA1Mw==",
    "user": {
      "login": "abcoathup",
      "id": 28278242,
      "node_id": "MDQ6VXNlcjI4Mjc4MjQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/28278242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/abcoathup",
      "html_url": "https://github.com/abcoathup",
      "followers_url": "https://api.github.com/users/abcoathup/followers",
      "following_url": "https://api.github.com/users/abcoathup/following{/other_user}",
      "gists_url": "https://api.github.com/users/abcoathup/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/abcoathup/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/abcoathup/subscriptions",
      "organizations_url": "https://api.github.com/users/abcoathup/orgs",
      "repos_url": "https://api.github.com/users/abcoathup/repos",
      "events_url": "https://api.github.com/users/abcoathup/events{/privacy}",
      "received_events_url": "https://api.github.com/users/abcoathup/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-24T06:42:16Z",
    "updated_at": "2020-08-24T06:42:16Z",
    "author_association": "NONE",
    "body": "Hi @chriseth,\r\n\r\nI created the issue here to raise awareness with the team of this pain point in the community.  \r\nFeel free to close.\r\nI have posted a version of this on the OpenZeppelin Community Forum: https://forum.openzeppelin.com/t/easy-multifile-verification-on-block-explorers/3621  \r\n\r\nA short term workaround could be a tool that copies a contract and it's dependencies to a single directory and updates the imports to be local to the directory.  This would enable use of Etherscans web based verification.\r\n\r\nThough long term we need deploy tools to verify to block explorers and/or sourcify via APIs automagically.\r\n\r\nUnfortunately the community will still flatten contracts until we have easy multifile verification.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/678937053/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/682381153",
    "html_url": "https://github.com/ethereum/solidity/issues/9650#issuecomment-682381153",
    "issue_url": "https://api.github.com/repos/ethereum/solidity/issues/9650",
    "id": 682381153,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MjM4MTE1Mw==",
    "user": {
      "login": "abcoathup",
      "id": 28278242,
      "node_id": "MDQ6VXNlcjI4Mjc4MjQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/28278242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/abcoathup",
      "html_url": "https://github.com/abcoathup",
      "followers_url": "https://api.github.com/users/abcoathup/followers",
      "following_url": "https://api.github.com/users/abcoathup/following{/other_user}",
      "gists_url": "https://api.github.com/users/abcoathup/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/abcoathup/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/abcoathup/subscriptions",
      "organizations_url": "https://api.github.com/users/abcoathup/orgs",
      "repos_url": "https://api.github.com/users/abcoathup/repos",
      "events_url": "https://api.github.com/users/abcoathup/events{/privacy}",
      "received_events_url": "https://api.github.com/users/abcoathup/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-28T07:45:20Z",
    "updated_at": "2020-08-28T07:45:20Z",
    "author_association": "NONE",
    "body": "Using Buidler and NomicLabs we can say goodbye to flattening. \r\n\r\nhttps://github.com/nomiclabs/buidler/tree/development/packages/buidler-etherscan\r\n\r\nVerified on Etherscan looks as follows:\r\nhttps://rinkeby.etherscan.io/address/0x2E1DCeFc2a998118354d90172737A91097431C20#code\r\n\r\nClosing this issue as resolved.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/solidity/issues/comments/682381153/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
