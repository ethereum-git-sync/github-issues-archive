{
  "url": "https://api.github.com/repos/ethereum/py-evm/issues/776",
  "repository_url": "https://api.github.com/repos/ethereum/py-evm",
  "labels_url": "https://api.github.com/repos/ethereum/py-evm/issues/776/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/py-evm/issues/776/comments",
  "events_url": "https://api.github.com/repos/ethereum/py-evm/issues/776/events",
  "html_url": "https://github.com/ethereum/py-evm/issues/776",
  "id": 326311104,
  "node_id": "MDU6SXNzdWUzMjYzMTExMDQ=",
  "number": 776,
  "title": "Trinity `Auth ack msg too short`",
  "user": {
    "login": "pipermerriam",
    "id": 824194,
    "node_id": "MDQ6VXNlcjgyNDE5NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pipermerriam",
    "html_url": "https://github.com/pipermerriam",
    "followers_url": "https://api.github.com/users/pipermerriam/followers",
    "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
    "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
    "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
    "repos_url": "https://api.github.com/users/pipermerriam/repos",
    "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 631592722,
      "node_id": "MDU6TGFiZWw2MzE1OTI3MjI=",
      "url": "https://api.github.com/repos/ethereum/py-evm/labels/Good%20First%20Issue",
      "name": "Good First Issue",
      "color": "0e8a16",
      "default": false,
      "description": null
    },
    {
      "id": 815420353,
      "node_id": "MDU6TGFiZWw4MTU0MjAzNTM=",
      "url": "https://api.github.com/repos/ethereum/py-evm/labels/comp:%20trinity",
      "name": "comp: trinity",
      "color": "bfd4f2",
      "default": false,
      "description": ""
    },
    {
      "id": 889922027,
      "node_id": "MDU6TGFiZWw4ODk5MjIwMjc=",
      "url": "https://api.github.com/repos/ethereum/py-evm/labels/comp:%20p2p",
      "name": "comp: p2p",
      "color": "bfd4f2",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2018-05-24T21:57:41Z",
  "updated_at": "2018-05-29T15:15:45Z",
  "closed_at": "2018-05-29T15:15:45Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "### What is wrong?\r\n\r\n```\r\n   ERROR  05-24 15:52:55        peer  Unexpected error during auth/p2p handshake with <Node(0x4382@104.149.231.208)>\r\nTraceback (most recent call last):\r\n  File \"/Users/piper/sites/py-evm/p2p/peer.py\", line 739, in connect\r\n    self.cancel_token)\r\n  File \"/Users/piper/sites/py-evm/p2p/peer.py\", line 136, in handshake\r\n    ) = await auth.handshake(remote, privkey, token)\r\n  File \"/Users/piper/sites/py-evm/p2p/auth.py\", line 55, in handshake\r\n    initiator, reader, writer, token)\r\n  File \"/Users/piper/sites/py-evm/p2p/auth.py\", line 77, in _handshake\r\n    ephemeral_pubkey, responder_nonce = initiator.decode_auth_ack_message(auth_ack)\r\n  File \"/Users/piper/sites/py-evm/p2p/auth.py\", line 179, in decode_auth_ack_message\r\n    raise ValueError(\"Auth ack msg too short: {}\".format(len(ciphertext)))\r\nValueError: Auth ack msg too short: 0\r\n```\r\n\r\nThis error occurs semi regularly during fast sync (and in general during running the trinity node.)\r\n\r\n\r\n### How can it be fixed\r\n\r\nExplicit error handling.\r\n",
  "closed_by": {
    "login": "pipermerriam",
    "id": 824194,
    "node_id": "MDQ6VXNlcjgyNDE5NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pipermerriam",
    "html_url": "https://github.com/pipermerriam",
    "followers_url": "https://api.github.com/users/pipermerriam/followers",
    "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
    "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
    "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
    "repos_url": "https://api.github.com/users/pipermerriam/repos",
    "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/776/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/py-evm/issues/776/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/392098177",
    "html_url": "https://github.com/ethereum/py-evm/issues/776#issuecomment-392098177",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/776",
    "id": 392098177,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MjA5ODE3Nw==",
    "user": {
      "login": "glaksmono",
      "id": 286254,
      "node_id": "MDQ6VXNlcjI4NjI1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/286254?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glaksmono",
      "html_url": "https://github.com/glaksmono",
      "followers_url": "https://api.github.com/users/glaksmono/followers",
      "following_url": "https://api.github.com/users/glaksmono/following{/other_user}",
      "gists_url": "https://api.github.com/users/glaksmono/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glaksmono/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glaksmono/subscriptions",
      "organizations_url": "https://api.github.com/users/glaksmono/orgs",
      "repos_url": "https://api.github.com/users/glaksmono/repos",
      "events_url": "https://api.github.com/users/glaksmono/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glaksmono/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-25T15:40:41Z",
    "updated_at": "2018-05-25T15:40:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "@pipermerriam just want to be clear on the terminology, when you said \"fast sync\", you are referring to `trinity --light` mode correct?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/392098177/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/392100912",
    "html_url": "https://github.com/ethereum/py-evm/issues/776#issuecomment-392100912",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/776",
    "id": 392100912,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MjEwMDkxMg==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-25T15:49:43Z",
    "updated_at": "2018-05-25T15:49:43Z",
    "author_association": "MEMBER",
    "body": "No, I'm referring to the sync mode that trinity uses by default when you just run `trinity` but I actually think that's irrelevant to this issue.\r\n\r\nI think we just need one more `except` block in the `try/except` within the `Peer.connect` method.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/392100912/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/392254327",
    "html_url": "https://github.com/ethereum/py-evm/issues/776#issuecomment-392254327",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/776",
    "id": 392254327,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MjI1NDMyNw==",
    "user": {
      "login": "glaksmono",
      "id": 286254,
      "node_id": "MDQ6VXNlcjI4NjI1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/286254?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/glaksmono",
      "html_url": "https://github.com/glaksmono",
      "followers_url": "https://api.github.com/users/glaksmono/followers",
      "following_url": "https://api.github.com/users/glaksmono/following{/other_user}",
      "gists_url": "https://api.github.com/users/glaksmono/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/glaksmono/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/glaksmono/subscriptions",
      "organizations_url": "https://api.github.com/users/glaksmono/orgs",
      "repos_url": "https://api.github.com/users/glaksmono/repos",
      "events_url": "https://api.github.com/users/glaksmono/events{/privacy}",
      "received_events_url": "https://api.github.com/users/glaksmono/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-26T11:10:08Z",
    "updated_at": "2018-05-26T11:39:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "@pipermerriam I'm thinking about adding more log message to understand the root cause. Thoughts?\r\n\r\nI found that this error is pretty consistently showing up. Here's the longer version of the log messages:\r\n\r\n```\r\n    INFO  05-26 18:12:23       chain  Imported chain segment, new head: #4799 (c855)\r\n    INFO  05-26 18:12:24       chain  Imported chain segment, new head: #4991 (5b6d)\r\n    INFO  05-26 18:12:26       chain  Imported chain segment, new head: #5183 (0b57)\r\n    INFO  05-26 18:12:27       chain  Imported chain segment, new head: #5375 (6869)\r\n    INFO  05-26 18:12:28       chain  Imported chain segment, new head: #5567 (e7a6)\r\n    INFO  05-26 18:12:28       chain  ETHPeer <Node(0xae6f@54.211.251.136)> disconnected, aborting sync\r\n   ERROR  05-26 18:12:37        peer  Unexpected error during auth/p2p handshake with <Node(0x5c7d@98.185.210.222)>\r\nTraceback (most recent call last):\r\n  File \"/Users/glaksmono/Documents/py-evm/p2p/peer.py\", line 738, in connect\r\n    self.cancel_token)\r\n  File \"/Users/glaksmono/Documents/py-evm/p2p/peer.py\", line 137, in handshake\r\n    ) = await auth.handshake(remote, privkey, token)\r\n  File \"/Users/glaksmono/Documents/py-evm/p2p/auth.py\", line 55, in handshake\r\n    initiator, reader, writer, token)\r\n  File \"/Users/glaksmono/Documents/py-evm/p2p/auth.py\", line 77, in _handshake\r\n    ephemeral_pubkey, responder_nonce = initiator.decode_auth_ack_message(auth_ack)\r\n  File \"/Users/glaksmono/Documents/py-evm/p2p/auth.py\", line 179, in decode_auth_ack_message\r\n    if len(ciphertext) < ENCRYPTED_AUTH_ACK_LEN:\r\nValueError: Auth ack msg too short: 0\r\n   ERROR  05-26 18:13:39  base_events  Exception in callback _SelectorDatagramTransport._read_ready()\r\nhandle: <Handle _SelectorDatagramTransport._read_ready()>\r\nTraceback (most recent call last):\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/asyncio/events.py\", line 145, in _run\r\n    self._callback(*self._args)\r\n  File \"/Library/Frameworks/Python.framework/Versions/3.6/lib/python3.6/asyncio/selector_events.py\", line 1077, in _read_ready\r\n    self._protocol.datagram_received(data, addr)\r\n  File \"/Users/glaksmono/Documents/py-evm/p2p/discovery.py\", line 142, in datagram_received\r\n    self.receive(kademlia.Address(ip_address, udp_port), data)  # type: ignore\r\n  File \"/Users/glaksmono/Documents/py-evm/p2p/discovery.py\", line 179, in receive\r\n    handler(node, payload, message_hash)\r\n  File \"/Users/glaksmono/Documents/py-evm/p2p/discovery.py\", line 192, in recv_ping\r\n    self.kademlia.recv_ping(node, message_hash)\r\n  File \"/Users/glaksmono/Documents/py-evm/p2p/kademlia.py\", line 429, in recv_ping\r\n    self.update_routing_table(remote)\r\n  File \"/Users/glaksmono/Documents/py-evm/p2p/kademlia.py\", line 454, in update_routing_table\r\n    eviction_candidate = self.routing.add_node(node)\r\n  File \"/Users/glaksmono/Documents/py-evm/p2p/kademlia.py\", line 270, in add_node\r\n    raise ValueError(\"Cannot add this_node to routing table\")\r\nValueError: Cannot add this_node to routing table\r\n    INFO  05-26 18:18:04        peer  Successfully connected to ETHPeer <Node(0x8cb7@47.252.2.104)>\r\n    INFO  05-26 18:18:04       chain  Starting sync with ETHPeer <Node(0x8cb7@47.252.2.104)>\r\n    INFO  05-26 18:18:07       chain  Imported chain segment, new head: #5567 (e7a6)\r\n    INFO  05-26 18:18:07       chain  Imported chain segment, new head: #5759 (1487)\r\n    INFO  05-26 18:18:09       chain  Imported chain segment, new head: #5951 (b5ec)\r\n    INFO  05-26 18:18:09       chain  Imported chain segment, new head: #6143 (0f41)\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/392254327/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/392261125",
    "html_url": "https://github.com/ethereum/py-evm/issues/776#issuecomment-392261125",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/776",
    "id": 392261125,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MjI2MTEyNQ==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-26T13:21:55Z",
    "updated_at": "2018-05-26T13:21:55Z",
    "author_association": "MEMBER",
    "body": "I actually ended up fixing this here: https://github.com/ethereum/py-evm/pull/790\r\n\r\nFix was pretty simple since we were already handling `HandshakeFailure` in `Peer.connect`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/392261125/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
