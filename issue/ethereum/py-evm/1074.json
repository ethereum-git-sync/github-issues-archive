{
  "url": "https://api.github.com/repos/ethereum/py-evm/issues/1074",
  "repository_url": "https://api.github.com/repos/ethereum/py-evm",
  "labels_url": "https://api.github.com/repos/ethereum/py-evm/issues/1074/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/py-evm/issues/1074/comments",
  "events_url": "https://api.github.com/repos/ethereum/py-evm/issues/1074/events",
  "html_url": "https://github.com/ethereum/py-evm/issues/1074",
  "id": 343870943,
  "node_id": "MDU6SXNzdWUzNDM4NzA5NDM=",
  "number": 1074,
  "title": "Trinity times out peer connections during state sync",
  "user": {
    "login": "pipermerriam",
    "id": 824194,
    "node_id": "MDQ6VXNlcjgyNDE5NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pipermerriam",
    "html_url": "https://github.com/pipermerriam",
    "followers_url": "https://api.github.com/users/pipermerriam/followers",
    "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
    "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
    "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
    "repos_url": "https://api.github.com/users/pipermerriam/repos",
    "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 630871939,
      "node_id": "MDU6TGFiZWw2MzA4NzE5Mzk=",
      "url": "https://api.github.com/repos/ethereum/py-evm/labels/type:%20bug",
      "name": "type: bug",
      "color": "eeeeee",
      "default": false,
      "description": ""
    },
    {
      "id": 815420353,
      "node_id": "MDU6TGFiZWw4MTU0MjAzNTM=",
      "url": "https://api.github.com/repos/ethereum/py-evm/labels/comp:%20trinity",
      "name": "comp: trinity",
      "color": "bfd4f2",
      "default": false,
      "description": ""
    },
    {
      "id": 983615043,
      "node_id": "MDU6TGFiZWw5ODM2MTUwNDM=",
      "url": "https://api.github.com/repos/ethereum/py-evm/labels/type:%20performance",
      "name": "type: performance",
      "color": "eeeeee",
      "default": false,
      "description": ""
    },
    {
      "id": 983628230,
      "node_id": "MDU6TGFiZWw5ODM2MjgyMzA=",
      "url": "https://api.github.com/repos/ethereum/py-evm/labels/prio:%20P3%20important",
      "name": "prio: P3 important",
      "color": "fad8c7",
      "default": false,
      "description": ""
    },
    {
      "id": 983629570,
      "node_id": "MDU6TGFiZWw5ODM2Mjk1NzA=",
      "url": "https://api.github.com/repos/ethereum/py-evm/labels/effort:%20E1%20hours",
      "name": "effort: E1 hours",
      "color": "bfe5bf",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "gsalgado",
    "id": 412274,
    "node_id": "MDQ6VXNlcjQxMjI3NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gsalgado",
    "html_url": "https://github.com/gsalgado",
    "followers_url": "https://api.github.com/users/gsalgado/followers",
    "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
    "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
    "organizations_url": "https://api.github.com/users/gsalgado/orgs",
    "repos_url": "https://api.github.com/users/gsalgado/repos",
    "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gsalgado/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/ethereum/py-evm/milestones/4",
    "html_url": "https://github.com/ethereum/py-evm/milestone/4",
    "labels_url": "https://api.github.com/repos/ethereum/py-evm/milestones/4/labels",
    "id": 3512809,
    "node_id": "MDk6TWlsZXN0b25lMzUxMjgwOQ==",
    "number": 4,
    "title": "Margaret Hamilton (Trinity Release)",
    "description": "https://github.com/ethereum/py-evm/milestone/4",
    "creator": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 20,
    "state": "closed",
    "created_at": "2018-07-20T20:00:14Z",
    "updated_at": "2018-08-20T02:56:05Z",
    "due_on": "2018-08-14T07:00:00Z",
    "closed_at": "2018-08-20T02:56:05Z"
  },
  "comments": 6,
  "created_at": "2018-07-24T03:28:15Z",
  "updated_at": "2018-08-07T16:59:55Z",
  "closed_at": "2018-08-07T16:59:55Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "### What is wrong?\r\n\r\nWhile resuming state sync my node stalled while processing *something*.\r\n\r\nHere are the logs:  https://gist.githubusercontent.com/pipermerriam/f33802d8d8890af3c6c7a128e2745e75/raw/d83f3abefabeb3dcef5e6d12518db1755f66b666/trinity-state-sync-stalled.log\r\n\r\nEvent occured between timestamps `07-23 21:20:34` and `07-23 21:21:28` (approximately a full minute of *dead* time.\r\n\r\n### How can it be fixed\r\n\r\nSee what blocked the process for so long and figure out how to move it into a process pool executor or something.\r\n",
  "closed_by": {
    "login": "gsalgado",
    "id": 412274,
    "node_id": "MDQ6VXNlcjQxMjI3NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gsalgado",
    "html_url": "https://github.com/gsalgado",
    "followers_url": "https://api.github.com/users/gsalgado/followers",
    "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
    "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
    "organizations_url": "https://api.github.com/users/gsalgado/orgs",
    "repos_url": "https://api.github.com/users/gsalgado/repos",
    "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gsalgado/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/1074/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/py-evm/issues/1074/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/407279924",
    "html_url": "https://github.com/ethereum/py-evm/issues/1074#issuecomment-407279924",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1074",
    "id": 407279924,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNzI3OTkyNA==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-24T04:47:25Z",
    "updated_at": "2018-07-24T04:48:47Z",
    "author_association": "MEMBER",
    "body": "It looks like the code location of this may be here:\r\n\r\nhttps://github.com/ethereum/py-evm/blob/master/p2p/state.py#L130\r\n\r\nThe call out to `StateSyncer.process`.  I believe that we need to do something like push this out to a process pool of workers.  First instinct is to batch it and do updates to `self._pending_nodes` at the completion of each batch.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/407279924/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/407331115",
    "html_url": "https://github.com/ethereum/py-evm/issues/1074#issuecomment-407331115",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1074",
    "id": 407331115,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNzMzMTExNQ==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-24T08:49:18Z",
    "updated_at": "2018-07-24T08:49:18Z",
    "author_association": "MEMBER",
    "body": "Good catch! I'd seen this kind of behaviour in the past and wrongly thought it was because some of our requests were timing out (like, in your logs, peer `0x0282` never seem to reply to us[1]), but as you point out the main thread is blocked in the calls to `StateSyncer.process()` so even when the peers actually reply the event loop will not be able to consume them in time since it is blocked. That can even lead us to drop peers as the connection will be idle for too long.\r\n\r\nNotice that `StateSyncer` cannot be pickled as it holds a reference to a `LevelDB` instance so we cannot run `.process()` in our `ProcessPoolExecutor`. Also, batching won't help because `StateSyncer.process` processes each item individually.\r\n\r\nGiven that, I think our best bet for now is to change the loop calling `.process()` to yield control after every N items\r\n\r\n[1]\r\n\r\n```\r\n   DEBUG  07-23 21:20:42       state  Requesting 384 trie nodes to ETHPeer <Node(0x0282@219.150.218.187)>\r\n   DEBUG  07-23 21:20:42       state  Requesting 384 trie nodes to ETHPeer <Node(0x9a1c@40.118.145.245)>\r\n   DEBUG  07-23 21:20:42       state  Requesting 384 trie nodes to ETHPeer <Node(0x5669@127.0.0.1)>\r\n   DEBUG  07-23 21:20:42       state  Got 0 NodeData entries from ETHPeer <Node(0x9a1c@40.118.145.245)>\r\n   DEBUG  07-23 21:20:42       state  Requesting 384 trie nodes to ETHPeer <Node(0x9a1c@40.118.145.245)>\r\n   DEBUG  07-23 21:20:42       state  Got 384 NodeData entries from ETHPeer <Node(0x5669@127.0.0.1)>\r\n   DEBUG  07-23 21:20:42       state  Requesting 384 trie nodes to ETHPeer <Node(0x5669@127.0.0.1)>\r\n   DEBUG  07-23 21:20:42       state  Got 384 NodeData entries from ETHPeer <Node(0x5669@127.0.0.1)>\r\n   DEBUG  07-23 21:20:42       state  Requesting 384 trie nodes to ETHPeer <Node(0x5669@127.0.0.1)>\r\n   DEBUG  07-23 21:20:42       state  Got 384 NodeData entries from ETHPeer <Node(0x5669@127.0.0.1)>\r\n...\r\n   DEBUG  07-23 21:21:28       state  Re-requesting 1152 trie nodes\r\n```\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/407331115/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/407353568",
    "html_url": "https://github.com/ethereum/py-evm/issues/1074#issuecomment-407353568",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1074",
    "id": 407353568,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNzM1MzU2OA==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-24T10:07:09Z",
    "updated_at": "2018-07-24T10:07:09Z",
    "author_association": "MEMBER",
    "body": "So, here's some profiling stats (only for the loop that calls `scheduler.process()`) I gathered by running a state sync on ropsten with a nearly full state DB (by way of doing a complete sync a few days ago).\r\n\r\nHere I ran it via trinity (which means the DB runs in a separate process). As we can see, most of the time is spent checking whether or not a given key already exists in the DB. 97538 calls to `DBProxy.__contains__` took 136 seconds. \r\n\r\n```\r\n   INFO  07-24 10:40:28       state  ====== State sync progress ========                                                                                                       \r\n    INFO  07-24 10:40:28       state  Nodes processed: 18309                                                                                                                    \r\n    INFO  07-24 10:40:28       state  Nodes processed per second (average): 99                                                                                                  \r\n    INFO  07-24 10:40:28       state  Nodes committed to DB: 15697                                                                                                              \r\n    INFO  07-24 10:40:28       state  Nodes requested but not received yet: 384                                                                                                 \r\n    INFO  07-24 10:40:28       state  Nodes scheduled but not requested yet: 13225                                                                                              \r\n    INFO  07-24 10:40:28       state  Total nodes timed out: 0                   \r\n\r\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)                                                                                                         \r\n    18309    0.340    0.000  161.925    0.009 /home/salgado/virtualenvs/pyevm/lib/python3.6/site-packages/trie/sync.py:162(process)                                             \r\n    99451    1.442    0.000  155.656    0.002 /home/salgado/virtualenvs/pyevm/lib/python3.6/site-packages/trie/sync.py:124(schedule)                                            \r\n   113235    0.744    0.000  139.826    0.001 /usr/lib/python3.6/multiprocessing/managers.py:744(_callmethod)                                                                   \r\n    97538    0.243    0.000  136.858    0.001 /home/salgado/src/py-evm/trinity/db/base.py:41(__contains__)                                                                      \r\n   113235    0.575    0.000  123.697    0.001 /usr/lib/python3.6/multiprocessing/connection.py:246(recv)                                                                        \r\n   113235    0.624    0.000  122.253    0.001 /usr/lib/python3.6/multiprocessing/connection.py:406(_recv_bytes)                                                                 \r\n   226470    1.248    0.000  121.348    0.001 /usr/lib/python3.6/multiprocessing/connection.py:374(_recv)                                                                       \r\n   226470  119.833    0.001  119.833    0.001 {built-in method posix.read}                                                                                                      \r\n   113235    0.639    0.000   15.386    0.000 /usr/lib/python3.6/multiprocessing/connection.py:202(send)                                                                        \r\n    99451    0.377    0.000   14.242    0.000 /usr/lib/python3.6/logging/__init__.py:1284(debug)             \r\n```\r\n\r\nFor comparison, here's when I ran directly via `python -m p2p.state` (iow, with an in-process DB). As we can see, 97380 calls to `BaseDB.__contains__` took 86 seconds\r\n\r\n```\r\n2018-07-24 10:44:33,836 INFO: ====== State sync progress ========\r\n2018-07-24 10:44:33,837 INFO: Nodes processed: 26748\r\n2018-07-24 10:44:33,837 INFO: Nodes processed per second (average): 175\r\n2018-07-24 10:44:33,837 INFO: Nodes committed to DB: 22402\r\n2018-07-24 10:44:33,837 INFO: Nodes requested but not received yet: 4608\r\n2018-07-24 10:44:33,837 INFO: Nodes scheduled but not requested yet: 23460\r\n2018-07-24 10:44:33,838 INFO: Total nodes timed out: 3841\r\n         6217681 function calls (5871232 primitive calls) in 93.986 seconds\r\n\r\n   Ordered by: cumulative time\r\n   List reduced from 108 to 10 due to restriction <10>\r\n\r\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\r\n    26748    0.261    0.000   93.957    0.004 /home/salgado/virtualenvs/pyevm/lib/python3.6/site-packages/trie/sync.py:162(process)\r\n    98137    1.480    0.000   90.966    0.001 /home/salgado/virtualenvs/pyevm/lib/python3.6/site-packages/trie/sync.py:124(schedule)\r\n    97380    0.196    0.000   86.317    0.001 /home/salgado/src/py-evm/eth/db/backends/base.py:38(__contains__)\r\n    97380    0.205    0.000   86.063    0.001 /home/salgado/src/py-evm/eth/db/backends/level.py:31(_exists)\r\n    97380   85.858    0.001   85.858    0.001 {method 'get' of 'plyvel._plyvel.DB' objects}\r\n    26583    0.053    0.000    2.052    0.000 /home/salgado/virtualenvs/pyevm/lib/python3.6/site-packages/trie/sync.py:153(get_children)\r\n    98132    0.327    0.000    1.895    0.000 /home/salgado/virtualenvs/pyevm/lib/python3.6/site-packages/eth_utils/hexadecimal.py:19(encode_hex)\r\n     1571    0.009    0.000    1.204    0.001 /home/salgado/src/py-evm/p2p/state.py:273(leaf_callback)\r\n123717/26583    0.399    0.000    1.067    0.000 /home/salgado/virtualenvs/pyevm/lib/python3.6/site-packages/trie/sync.py:53(_get_children)\r\n    28154    0.047    0.000    1.041    0.000 /home/salgado/virtualenvs/pyevm/lib/python3.6/site-packages/rlp/codec.py:194(decode)\r\n```\r\n\r\nIt looks like the overhead incurred by the multiprocessing proxy is hurting us pretty badly during a state sync, given the amount of DB accesses we make. That's something to keep in mind, but as this seems to be the main bottleneck, we could probably solve the issue here by having an async version of `StateSync.process()` that uses a `DBProxy` async API, thus not blocking the main thread while doing DB access. That would mean the asyncio event loop would be doing a ton of extra context switches, though, and it will be interesting to see how it handles that",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/407353568/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/407883805",
    "html_url": "https://github.com/ethereum/py-evm/issues/1074#issuecomment-407883805",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1074",
    "id": 407883805,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNzg4MzgwNQ==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-25T20:25:41Z",
    "updated_at": "2018-07-25T20:26:34Z",
    "author_association": "MEMBER",
    "body": "After running some experiments with adding an `await asyncio.sleep(0)` to the loop that processes nodes this seems viable.  I'm currently maintaining at least one external peer connections and have seen my client get up to 3-4 peer connections.  Not seeing anything that directly suggests that I'm getting disconnected due to timing out from peers.\r\n\r\nLongest uptime on the remote peer is currently 37 minutes.\r\n\r\nThe speed of sync appears un-affected (still processing about 400 trie nodes per second)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/407883805/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/409321215",
    "html_url": "https://github.com/ethereum/py-evm/issues/1074#issuecomment-409321215",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1074",
    "id": 409321215,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwOTMyMTIxNQ==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-31T18:26:40Z",
    "updated_at": "2018-07-31T18:26:40Z",
    "author_association": "MEMBER",
    "body": "@gsalgado do you want to keep this open?  I think I'd prefer a new issue more specific to what you are working on in #1124 ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/409321215/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/409452103",
    "html_url": "https://github.com/ethereum/py-evm/issues/1074#issuecomment-409452103",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1074",
    "id": 409452103,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwOTQ1MjEwMw==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-01T05:16:02Z",
    "updated_at": "2018-08-01T05:16:02Z",
    "author_association": "MEMBER",
    "body": "I think this has a good description of the issue itself (i.e. the observed behaviour we want to change), and in the PR we can discuss how we'll fix it",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/409452103/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
