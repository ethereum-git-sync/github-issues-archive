{
  "url": "https://api.github.com/repos/ethereum/py-evm/issues/654",
  "repository_url": "https://api.github.com/repos/ethereum/py-evm",
  "labels_url": "https://api.github.com/repos/ethereum/py-evm/issues/654/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/py-evm/issues/654/comments",
  "events_url": "https://api.github.com/repos/ethereum/py-evm/issues/654/events",
  "html_url": "https://github.com/ethereum/py-evm/issues/654",
  "id": 320854687,
  "node_id": "MDU6SXNzdWUzMjA4NTQ2ODc=",
  "number": 654,
  "title": "Decide when FullNodeSyncer should run a fast-sync",
  "user": {
    "login": "gsalgado",
    "id": 412274,
    "node_id": "MDQ6VXNlcjQxMjI3NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gsalgado",
    "html_url": "https://github.com/gsalgado",
    "followers_url": "https://api.github.com/users/gsalgado/followers",
    "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
    "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
    "organizations_url": "https://api.github.com/users/gsalgado/orgs",
    "repos_url": "https://api.github.com/users/gsalgado/repos",
    "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gsalgado/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2018-05-07T15:44:48Z",
  "updated_at": "2018-05-09T16:41:39Z",
  "closed_at": "2018-05-09T16:41:39Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "The ETH fast-sync protocol (which is currently the first step performed by `FullNodeSyncer`) was developed because when doing the initial sync of a relatively old chain (e.g. ropsten/mainnet), the regular (block-processing) sync could take forever to complete. The idea is that once the initial fast-sync is completed, the client would switch to regular-sync mode and never go back to fast sync.\r\n\r\nThat is what I originally [intended to do as well](https://github.com/ethereum/py-evm/issues/330), but currently things are a bit more complicated than that as our performance is significantly worse than other clients and if we run `FullNodeSyncer` with a local DB that is only a few days behind, it may take several days for us to catch up. To give an idea, it currently takes between 5-8 seconds to process a block with ~150 transactions, and on mainnet blocks had [(for example, on May 6th) on average ~130 transactions](https://etherscan.io/chart/tx). With one new block every 15 seconds and a local DB 3 days behind it could take us up to 2 days to catch up (assuming a 5 second processing time for a 130tx-heavy block).\r\n\r\nGiven that, I think it'd make sense for us to have `FullNodeSyncer` run a fast-sync before switching to regular-sync [1] if the local chain is N blocks (or a certain difficulty delta) behind. The choice of N is somewhat tricky though, because running a fast-sync when the local chain is not too far behind may be slower than running a regular-sync since the state-download step has to (potentially) traverse the whole trie and make lots of requests just to get to the few missing nodes [2].\r\n\r\n[1] We currently do that always, but that was meant to be temporary\r\n[2] This is a very time-consuming thing to test, so I don't have actual numbers for it",
  "closed_by": {
    "login": "gsalgado",
    "id": 412274,
    "node_id": "MDQ6VXNlcjQxMjI3NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gsalgado",
    "html_url": "https://github.com/gsalgado",
    "followers_url": "https://api.github.com/users/gsalgado/followers",
    "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
    "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
    "organizations_url": "https://api.github.com/users/gsalgado/orgs",
    "repos_url": "https://api.github.com/users/gsalgado/repos",
    "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gsalgado/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/654/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/py-evm/issues/654/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/387110491",
    "html_url": "https://github.com/ethereum/py-evm/issues/654#issuecomment-387110491",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/654",
    "id": 387110491,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NzExMDQ5MQ==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-07T15:51:49Z",
    "updated_at": "2018-05-07T15:51:49Z",
    "author_association": "MEMBER",
    "body": "I think that we can just set this number at an arbitrary value (2 days?) and work from there.  I'm confident there are still lots of performance improvements we can do to hopefully cut that time down a lot more which will make this way less of a problem.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/387110491/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
