{
  "url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
  "repository_url": "https://api.github.com/repos/ethereum/py-evm",
  "labels_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234/comments",
  "events_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234/events",
  "html_url": "https://github.com/ethereum/py-evm/issues/1234",
  "id": 356163120,
  "node_id": "MDU6SXNzdWUzNTYxNjMxMjA=",
  "number": 1234,
  "title": "Trinity crash",
  "user": {
    "login": "pipermerriam",
    "id": 824194,
    "node_id": "MDQ6VXNlcjgyNDE5NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pipermerriam",
    "html_url": "https://github.com/pipermerriam",
    "followers_url": "https://api.github.com/users/pipermerriam/followers",
    "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
    "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
    "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
    "repos_url": "https://api.github.com/users/pipermerriam/repos",
    "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 630871939,
      "node_id": "MDU6TGFiZWw2MzA4NzE5Mzk=",
      "url": "https://api.github.com/repos/ethereum/py-evm/labels/type:%20bug",
      "name": "type: bug",
      "color": "eeeeee",
      "default": false,
      "description": ""
    },
    {
      "id": 815420353,
      "node_id": "MDU6TGFiZWw4MTU0MjAzNTM=",
      "url": "https://api.github.com/repos/ethereum/py-evm/labels/comp:%20trinity",
      "name": "comp: trinity",
      "color": "bfd4f2",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 31,
  "created_at": "2018-09-01T02:14:46Z",
  "updated_at": "2018-09-10T15:21:48Z",
  "closed_at": "2018-09-10T15:21:48Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "### What is wrong?\r\n\r\nTrinity crashed, logs are unclear as to why it shutdown.\r\n\r\nhttps://gist.githubusercontent.com/pipermerriam/f33802d8d8890af3c6c7a128e2745e75/raw/a272bab381ed7b2c8dc68573cc3ac53058ca4c8b/trinity-strange-crash.log\r\n\r\n### How can it be fixed\r\n\r\nStill need to try and diagnose...\r\n",
  "closed_by": {
    "login": "pipermerriam",
    "id": 824194,
    "node_id": "MDQ6VXNlcjgyNDE5NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pipermerriam",
    "html_url": "https://github.com/pipermerriam",
    "followers_url": "https://api.github.com/users/pipermerriam/followers",
    "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
    "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
    "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
    "repos_url": "https://api.github.com/users/pipermerriam/repos",
    "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/1234/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418191597",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418191597",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418191597,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODE5MTU5Nw==",
    "user": {
      "login": "carver",
      "id": 205327,
      "node_id": "MDQ6VXNlcjIwNTMyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/205327?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/carver",
      "html_url": "https://github.com/carver",
      "followers_url": "https://api.github.com/users/carver/followers",
      "following_url": "https://api.github.com/users/carver/following{/other_user}",
      "gists_url": "https://api.github.com/users/carver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/carver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/carver/subscriptions",
      "organizations_url": "https://api.github.com/users/carver/orgs",
      "repos_url": "https://api.github.com/users/carver/repos",
      "events_url": "https://api.github.com/users/carver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/carver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-03T20:54:13Z",
    "updated_at": "2018-09-03T20:54:19Z",
    "author_association": "MEMBER",
    "body": "I don't have the answer, but this seems like the critical bit:\r\n\r\n```\r\n   DEBUG  08-31 17:48:55        peer  Malformed message from peer ETHPeer <Node(0xcd7c@167.114.230.91)>: CMD:BlockHeaders Error: MalformedMessage('Malformed %s message: %r',)\r\n   DEBUG  08-31 17:48:55        peer  Disconnecting from remote peer; reason: bad_protocol\r\n   DEBUG  08-31 17:48:55     service  Cancelling ETHPeer <Node(0xcd7c@167.114.230.91)>\r\n   DEBUG  08-31 17:48:55     service  <ResponseCandidateStream(ETHPeer <Node(0xcd7c@167.114.230.91)>, <class 'trinity.protocol.eth.commands.BlockHeaders'>)> finished: Cancellation requested by ETHPeer:PeerPool:Server:MainnetFullNode token\r\n```\r\n\r\nThat first debug log happens right before re-raising the exception. So I guess the exception is somehow bubbling all the way up to somewhere it shouldn't, and causing a shutdown. If we find where that catch-all exception is, we should log at the `exception` level to get the full stack trace.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418191597/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418191660",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418191660",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418191660,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODE5MTY2MA==",
    "user": {
      "login": "carver",
      "id": 205327,
      "node_id": "MDQ6VXNlcjIwNTMyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/205327?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/carver",
      "html_url": "https://github.com/carver",
      "followers_url": "https://api.github.com/users/carver/followers",
      "following_url": "https://api.github.com/users/carver/following{/other_user}",
      "gists_url": "https://api.github.com/users/carver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/carver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/carver/subscriptions",
      "organizations_url": "https://api.github.com/users/carver/orgs",
      "repos_url": "https://api.github.com/users/carver/repos",
      "events_url": "https://api.github.com/users/carver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/carver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-03T20:54:43Z",
    "updated_at": "2018-09-03T20:55:05Z",
    "author_association": "MEMBER",
    "body": "BTW, I see the `Malformed %s message: %r` message is not formatted correctly, I'll fix that in the next PR I'm working on.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418191660/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418193499",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418193499",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418193499,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODE5MzQ5OQ==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-03T21:12:21Z",
    "updated_at": "2018-09-03T21:12:21Z",
    "author_association": "MEMBER",
    "body": "This caught my attention\r\n```\r\n   DEBUG  08-31 17:48:55     service  Cancelling ETHPeer <Node(0xcd7c@167.114.230.91)>\r\n   DEBUG  08-31 17:48:55     service  <ResponseCandidateStream(ETHPeer <Node(0xcd7c@167.114.230.91)>, <class 'trinity.protocol.eth.commands.BlockHeaders'>)> finished: Cancellation requested by ETHPeer:PeerPool:Server:MainnetFullNode token\r\n    INFO  08-31 17:48:55   discovery  stopping discovery\r\n   DEBUG  08-31 17:48:55     service  ETHPeer <Node(0x473b@167.99.45.137)> finished: Cancellation requested by Server:MainnetFullNode token\r\n```\r\n\r\nIt's curious that the `Server` token gets triggered immediately after that peer's `.cancel()` method is called (which calls `peer.cancel_token.trigger()`). It suggests a bug in the cancelling of chained tokens, or maybe something is keeping a reference to the server's cancel_token instead of chaining it to create their own",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418193499/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418193912",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418193912",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418193912,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODE5MzkxMg==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-03T21:16:40Z",
    "updated_at": "2018-09-03T21:16:40Z",
    "author_association": "MEMBER",
    "body": "@carver These two line indicate the exception has been caught in Peer._run(), which then calls `.disconnect()` and `.cancel()`\r\n\r\n>    DEBUG  08-31 17:48:55        peer  Malformed message from peer ETHPeer <Node(0xcd7c@167.114.230.91)>: CMD:BlockHeaders Error: MalformedMessage('Malformed %s message: %r',)\r\n   DEBUG  08-31 17:48:55        peer  Disconnecting from remote peer; reason: bad_protocol\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418193912/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418220374",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418220374",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418220374,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODIyMDM3NA==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T02:09:28Z",
    "updated_at": "2018-09-04T02:09:28Z",
    "author_association": "MEMBER",
    "body": "More logs: https://gist.githubusercontent.com/pipermerriam/f33802d8d8890af3c6c7a128e2745e75/raw/1a9019afccd98647c32bbe3f31e4599e69f8a6d3/trinity-discovery-crash.log\r\n\r\nThis validates @gsalgado thoughts here https://github.com/ethereum/py-evm/issues/1234#issuecomment-418193499\r\n\r\nSpecifically this section which indicates that the `ResponseCandidateStream` is part of the cancellation chain that causes the DiscoveryService to halt.\r\n\r\n```\r\n 83    DEBUG  09-03 15:45:26     service  <ResponseCandidateStream(ETHPeer <Node(0x97b6@185.64.116.14)>, <class 'trinity.protocol.eth.commands\r\n    .BlockHeaders'>)> finished: Cancellation requested by ETHPeer:PeerPool:Server:MainnetFullNode token\r\n 84    DEBUG  09-03 15:45:26     service  <p2p.discovery.DiscoveryService object at 0x7f1a719e6da0> finished: Cancellation requested by Respon\r\n    seCandidateStream:ETHPeer:PeerPool:Server:MainnetFullNode token\r\n 85     INFO  09-03 15:45:26   discovery  stopping discovery\r\n```\r\n\r\nThe chain of tokens that caused the discover cancellation has the ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418220374/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418223040",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418223040",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418223040,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODIyMzA0MA==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T02:29:49Z",
    "updated_at": "2018-09-04T02:29:49Z",
    "author_association": "MEMBER",
    "body": "Also, this might indicate that we need to do something to fix the cancel token chaining API because honestly, I've had trouble sometimes figuring out what the right order should be.  Maybe we need something like  `token.create_child_token()` rather than actually combining two tokens and thus, having to figure out the right ordering.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418223040/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418229586",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418229586",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418229586,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODIyOTU4Ng==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T03:19:21Z",
    "updated_at": "2018-09-04T03:19:21Z",
    "author_association": "MEMBER",
    "body": "Found part of it: https://github.com/ethereum/py-evm/blob/master/trinity/protocol/common/managers.py#L209\r\n\r\nThe `ResponseCandidateStream` is being run using `run_daemon` which isn't exactly wrong since we do need this process to keep running.  When this crashes (which is I haven't dug into why that is happening) the peer cancels itself.  Still looking for the link for why this is cascading up to the `PeerPool`.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418229586/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418232791",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418232791",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418232791,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODIzMjc5MQ==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T03:45:33Z",
    "updated_at": "2018-09-04T03:45:33Z",
    "author_association": "MEMBER",
    "body": "Not yet confirmed but this *may* have been a local error on my machine.  I had a version of `asyncio-cancel-token` installed from source locally which I'd been mucking around with a few weeks ago.  Running experiment now to see if it is fixed.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418232791/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418283290",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418283290",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418283290,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODI4MzI5MA==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T08:23:35Z",
    "updated_at": "2018-09-04T08:55:47Z",
    "author_association": "MEMBER",
    "body": "I think it makes sense that `ResponseCandidateStream` is executed with `run_daemon()` as we probably want the `Peer` to stop if it terminates unexpectedly, right?  One thing that is not right is for ~`ResponseCandidateStream`~`ExchangeManager` to keep a direct reference to the cancel token passed onto it (https://github.com/ethereum/py-evm/blob/master/trinity/protocol/common/managers.py#L200), as that means it will always cancel its parent when terminating but that is a decision that belongs to the parent. This still does not explain how a peer terminating would trigger the server's token, though",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418283290/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418297257",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418297257",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418297257,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODI5NzI1Nw==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T09:12:20Z",
    "updated_at": "2018-09-04T09:12:20Z",
    "author_association": "MEMBER",
    "body": "The log lines from https://github.com/ethereum/py-evm/issues/1234#issuecomment-418220374 indicate that the token was correctly chained by `ResponseCandidateStream`, but when it was triggered it ended up cancelling one of the parent tokens in the chain, which doesn't seem to happen (https://github.com/ethereum/asyncio-cancel-token/pull/9), so it's very possible this was all caused by your locally modified version of asyncio-cancel-token",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418297257/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418436866",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418436866",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418436866,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODQzNjg2Ng==",
    "user": {
      "login": "carver",
      "id": 205327,
      "node_id": "MDQ6VXNlcjIwNTMyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/205327?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/carver",
      "html_url": "https://github.com/carver",
      "followers_url": "https://api.github.com/users/carver/followers",
      "following_url": "https://api.github.com/users/carver/following{/other_user}",
      "gists_url": "https://api.github.com/users/carver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/carver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/carver/subscriptions",
      "organizations_url": "https://api.github.com/users/carver/orgs",
      "repos_url": "https://api.github.com/users/carver/repos",
      "events_url": "https://api.github.com/users/carver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/carver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T16:41:01Z",
    "updated_at": "2018-09-04T16:41:01Z",
    "author_association": "MEMBER",
    "body": "> One thing that is not right is for ResponseCandidateStreamExchangeManager to keep a direct reference to the cancel token passed onto it (https://github.com/ethereum/py-evm/blob/master/trinity/protocol/common/managers.py#L200), as that means it will always cancel its parent when terminating but that is a decision that belongs to the parent. \r\n\r\n`ExchangeManager` isn't a service, it keeps the cancel token so that it can hand the token to the `ResponseCandidateStream` on init. It doesn't otherwise use `_cancel_token`.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418436866/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418447959",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418447959",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418447959,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODQ0Nzk1OQ==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T17:15:58Z",
    "updated_at": "2018-09-04T17:15:58Z",
    "author_association": "MEMBER",
    "body": "Closing until I can reproduce with a fresh virtual environment.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418447959/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418484713",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418484713",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418484713,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODQ4NDcxMw==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T19:13:08Z",
    "updated_at": "2018-09-04T19:13:08Z",
    "author_association": "MEMBER",
    "body": "I am pretty sure that I'm now seeing this in the `v0.1.0-alpha.15` release running on one of our VPS instances.  Should know for sure pretty soon.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418484713/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418486798",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418486798",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418486798,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODQ4Njc5OA==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T19:20:17Z",
    "updated_at": "2018-09-04T19:20:17Z",
    "author_association": "MEMBER",
    "body": "I've confirmed this bug is not isolated to my machine.  Encountered during light sync in a VPS node, I expect I'll see it in full sync too.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418486798/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418490182",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418490182",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418490182,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODQ5MDE4Mg==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T19:31:57Z",
    "updated_at": "2018-09-04T19:31:57Z",
    "author_association": "MEMBER",
    "body": "More info:\r\n\r\nLooks like `DiscoveryProtocol` retains a direct link to the `Server` cancel token\r\n\r\nhttps://github.com/ethereum/py-evm/blob/v0.2.0-alpha.32/trinity/server.py#L150-L151\r\n\r\nhttps://github.com/ethereum/py-evm/blob/v0.2.0-alpha.32/p2p/discovery.py#L145\r\n\r\nWhich is then triggered when the `DiscoveryService` cleans up, calling `proto.stop()` which triggers the token\r\n\r\nhttps://github.com/ethereum/py-evm/blob/v0.2.0-alpha.32/p2p/discovery.py#L819-L820\r\n\r\nhttps://github.com/ethereum/py-evm/blob/v0.2.0-alpha.32/p2p/discovery.py#L397-L399",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418490182/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418529574",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418529574",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418529574,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODUyOTU3NA==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T21:49:53Z",
    "updated_at": "2018-09-04T21:49:53Z",
    "author_association": "MEMBER",
    "body": "I can reproduce it when running in light mode.\r\n\r\nAs for the fact that DiscoveryProtocol retains a direct link to the Server cancel token, it is indeed something that ought to be fixed, but that token is only triggered when `DiscoveryProtocol.stop()` is called, and we still don't know why `DiscoveryService` is terminating",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418529574/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418530288",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418530288",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418530288,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODUzMDI4OA==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T21:52:43Z",
    "updated_at": "2018-09-04T21:52:43Z",
    "author_association": "MEMBER",
    "body": "check out my branch `piper/weird-crash-thing` for some additional logging output that I've injected to try and diagnose this.  I still haven't been able to see the crash with that logging enabled.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418530288/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418554902",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418554902",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418554902,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODU1NDkwMg==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T23:57:18Z",
    "updated_at": "2018-09-04T23:57:18Z",
    "author_association": "MEMBER",
    "body": "For anyone trying to reproduce it does appear that running in light mode is more likely to trigger this.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418554902/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418555869",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418555869",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418555869,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODU1NTg2OQ==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-05T00:02:49Z",
    "updated_at": "2018-09-05T00:02:49Z",
    "author_association": "MEMBER",
    "body": "GOT IT!!!!!\r\n\r\n```\r\n   DEBUG  09-04 18:00:00     service  STACKTRACE:\r\nTraceback (most recent call last):\r\n  File \"/home/piper/projects/py-evm/p2p/service.py\", line 126, in run\r\n    await self._run()\r\n  File \"/home/piper/projects/py-evm/p2p/discovery.py\", line 780, in _run\r\n    await self.maybe_connect_to_more_peers()\r\n  File \"/home/piper/projects/py-evm/p2p/discovery.py\", line 800, in maybe_connect_to_more_peers\r\n    self.proto.get_nodes_to_connect(self.peer_pool.max_peers))\r\n  File \"/home/piper/projects/py-evm/p2p/peer.py\", line 838, in connect_to_nodes\r\n    await self.start_peer(peer)\r\n  File \"/home/piper/projects/py-evm/p2p/peer.py\", line 742, in start_peer\r\n    await self.ensure_same_side_on_dao_fork(peer)\r\n  File \"/home/piper/projects/py-evm/p2p/peer.py\", line 864, in ensure_same_side_on_dao_fork\r\n    timeout=CHAIN_SPLIT_CHECK_TIMEOUT,\r\n  File \"/home/piper/projects/py-evm/trinity/protocol/les/exchanges.py\", line 62, in __call__\r\n    timeout,\r\n  File \"/home/piper/projects/py-evm/trinity/protocol/common/exchanges.py\", line 83, in get_result\r\n    timeout,\r\n  File \"/home/piper/projects/py-evm/trinity/protocol/common/managers.py\", line 233, in get_result\r\n    async for payload in stream.payload_candidates(request, tracker, timeout=timeout):\r\n  File \"/home/piper/projects/py-evm/trinity/protocol/common/managers.py\", line 104, in payload_candidates\r\n    yield await self._get_payload(timeout_remaining)\r\n  File \"/home/piper/projects/py-evm/trinity/protocol/common/managers.py\", line 151, in _get_payload\r\n    payload = await self.wait(future, timeout=timeout)\r\n  File \"/home/piper/projects/py-evm/p2p/cancellable.py\", line 19, in wait\r\n    return await self.wait_first(awaitable, token=token, timeout=timeout)\r\n  File \"/home/piper/projects/py-evm/p2p/cancellable.py\", line 41, in wait_first\r\n    return await token_chain.cancellable_wait(*awaitables, timeout=timeout)\r\n  File \"/home/piper/python-environments/evm/lib/python3.6/site-packages/cancel_token/token.py\", line 150, in cancellable_wait\r\n    \"Cancellation requested by {} token\".format(self.triggered_token)\r\ncancel_token.exceptions.OperationCancelled: Cancellation requested by ResponseCandidateStream:LESPeer:PeerPool:LightServer:MainnetLightNode token\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418555869/reactions",
      "total_count": 4,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 4,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418556096",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418556096",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418556096,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODU1NjA5Ng==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-05T00:04:14Z",
    "updated_at": "2018-09-05T00:04:14Z",
    "author_association": "MEMBER",
    "body": "`OperationCancelled` escaping during the Dao fork check which the discovery service interpreted as an upstream cancellation.\r\n\r\nI think we need some sort of *guard* that ensures that we only silence that exception if the triggering token is in the inheritance chain of the service's local cancel token.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418556096/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418556526",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418556526",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418556526,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODU1NjUyNg==",
    "user": {
      "login": "carver",
      "id": 205327,
      "node_id": "MDQ6VXNlcjIwNTMyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/205327?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/carver",
      "html_url": "https://github.com/carver",
      "followers_url": "https://api.github.com/users/carver/followers",
      "following_url": "https://api.github.com/users/carver/following{/other_user}",
      "gists_url": "https://api.github.com/users/carver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/carver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/carver/subscriptions",
      "organizations_url": "https://api.github.com/users/carver/orgs",
      "repos_url": "https://api.github.com/users/carver/repos",
      "events_url": "https://api.github.com/users/carver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/carver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-05T00:07:03Z",
    "updated_at": "2018-09-05T00:07:03Z",
    "author_association": "MEMBER",
    "body": "Seems very reasonable for `OperationCancelled` to contain a reference to the token that triggered it, and then:\r\n\r\n```py\r\nexcept OperationCancelled as exc:\r\n  if self.cancel_token.is_child_of(exc.token):\r\n    pass\r\n  else:\r\n    raise\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418556526/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418556789",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418556789",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418556789,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODU1Njc4OQ==",
    "user": {
      "login": "carver",
      "id": 205327,
      "node_id": "MDQ6VXNlcjIwNTMyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/205327?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/carver",
      "html_url": "https://github.com/carver",
      "followers_url": "https://api.github.com/users/carver/followers",
      "following_url": "https://api.github.com/users/carver/following{/other_user}",
      "gists_url": "https://api.github.com/users/carver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/carver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/carver/subscriptions",
      "organizations_url": "https://api.github.com/users/carver/orgs",
      "repos_url": "https://api.github.com/users/carver/repos",
      "events_url": "https://api.github.com/users/carver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/carver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-05T00:08:27Z",
    "updated_at": "2018-09-05T00:08:27Z",
    "author_association": "MEMBER",
    "body": "Also, I guess even swallowed `OperationCancelled` exceptions could log at the `trace` level, which I'm assuming you had turned on.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418556789/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418557471",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418557471",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418557471,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODU1NzQ3MQ==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-05T00:12:39Z",
    "updated_at": "2018-09-05T00:12:39Z",
    "author_association": "MEMBER",
    "body": "We should be sure to do a thorough audit of everywhere that we catch `OperationCancelled` while fixing this.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418557471/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418643439",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418643439",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418643439,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODY0MzQzOQ==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-05T08:23:34Z",
    "updated_at": "2018-09-05T08:45:39Z",
    "author_association": "MEMBER",
    "body": "Since `OperationCancelled` is caught in `BaseService.run()`, `.run_task()` & co, ideally we shouldn't need to catch it anywhere else. I think we should try and come up with guards (and maybe coding policies) to ensure that is the case as it will make our lives easier in the long run.\r\n\r\nThe problem is that `PeerPool.ensure_same_side_on_dao_fork()` calls `await peer.requests.get_block_headers()`, and an `OperationCancelled` raised inside that `Peer` method ends up causing the `PeerPool` to think it's been cancelled. Ideally we should never have to do something like `await other_service.method()` as that could potentially raise `OperationCancelled` and cause what we're seeing here. If we could find a way to run `ensure_same_side_on_dao_fork()` inside `Peer._run()`, this problem will go away[1]. That way we'd be centralising the handling of `OperationCancelled` in `BaseService`, so with the check that @carver suggested in https://github.com/ethereum/py-evm/issues/1234#issuecomment-418556526 we'd be able to more easily detect mistakes like this in the future.\r\n\r\nIf we can't have `ensure_same_side_on_dao_fork()` run inside `Peer._run()`, we could make it the one exception to the rule, and handle `OperationCancelled` there as well, but I strongly believe we need to centralise the handling of that exception and avoid the `await other_service.method()` pattern\r\n\r\n[1] Here's the reason why `ensure_same_side_on_dao_fork()` was moved to `PeerPool`: https://github.com/ethereum/py-evm/issues/1025#issuecomment-405929893, which may make it hard to move it back to `Peer._run()`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418643439/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418775145",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418775145",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418775145,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODc3NTE0NQ==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-05T15:32:05Z",
    "updated_at": "2018-09-05T15:32:05Z",
    "author_association": "MEMBER",
    "body": "@gsalgado good thoughts and I believe I agree with that approach.  Unfortunately, it may be closer to the end of this week before I can really spend much time on this.  I'm closing #1255.  If anyone else wants to take a stab at this :+1: ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418775145/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418778866",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418778866",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418778866,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODc3ODg2Ng==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-05T15:42:06Z",
    "updated_at": "2018-09-05T15:42:06Z",
    "author_association": "MEMBER",
    "body": "I'm thinking that we should do something like this:\r\n\r\n```python\r\nclass Peer:\r\n    ready = asynio.Event()  # but not as a class variabe :)\r\n    def _run(self):\r\n        # do dao check\r\n        self.ensure_same_side_of_dao()\r\n        self.ready.set()\r\n\r\nclass PeerPool:\r\n    def stat_peer(self, peer):\r\n        self.run_child_service(peer)\r\n        await peer.ready.wait()\r\n        # do the rest of adding peer to pool\r\n        # also: handle failure case however that works.\r\n```\r\n\r\nThis *should* properly start the peer, do the dao check, and keep the `peer` away from the subscriber API until the dao check has been fully completed.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418778866/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418798308",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418798308",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418798308,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODc5ODMwOA==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-05T16:39:50Z",
    "updated_at": "2018-09-05T16:39:50Z",
    "author_association": "MEMBER",
    "body": "I'll have a go at this, but I'm not sure what you suggest above is the best alternative, for a few reasons:\r\n\r\n1. It feels wrong to run the `Peer` service and after that wait for it to be _ready_, but maybe that's just a naming issue\r\n2. We're waiting on a `Peer` attribute, which happens to be just an `asyncio.Event` now, but if it's changed into something that can raise `OperationCancelled`, we'll have the same problem as we have now\r\n3. It doesn't consider the fact that the messages received during the DAO fork check need to be collected, but maybe you meant to keep the `with peer.collect_sub_proto_messages() as buffer:` there?\r\n\r\nAnyway, I'll have to think about this a bit more, just thought it was worth mentioning those points",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418798308/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418803912",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418803912",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418803912,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODgwMzkxMg==",
    "user": {
      "login": "carver",
      "id": 205327,
      "node_id": "MDQ6VXNlcjIwNTMyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/205327?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/carver",
      "html_url": "https://github.com/carver",
      "followers_url": "https://api.github.com/users/carver/followers",
      "following_url": "https://api.github.com/users/carver/following{/other_user}",
      "gists_url": "https://api.github.com/users/carver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/carver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/carver/subscriptions",
      "organizations_url": "https://api.github.com/users/carver/orgs",
      "repos_url": "https://api.github.com/users/carver/repos",
      "events_url": "https://api.github.com/users/carver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/carver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-05T16:57:07Z",
    "updated_at": "2018-09-05T23:31:07Z",
    "author_association": "MEMBER",
    "body": ">  Ideally we should never have to do something like `await other_service.method()`\r\n\r\nIt makes sense how that would solve the problem.\r\n\r\nOff-hand, it seems like a pretty tight constraint, and probably a surprising one for some. It sounds like a beast of a task to go through the whole code base and check if we're doing that anywhere else.\r\n\r\nIf you squint, I think the constraint implies that a `BaseService` subclass should never have any async functions that are public (ie~ not prefixed with `_`). Maybe that's slightly easier to check for.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418803912/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418848825",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-418848825",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 418848825,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODg0ODgyNQ==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-05T19:14:46Z",
    "updated_at": "2018-09-05T19:14:46Z",
    "author_association": "MEMBER",
    "body": "@gsalgado my suggestion was merely dumping my thoughts.  Take this whatever direction you think is right :+1: \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/418848825/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/419054834",
    "html_url": "https://github.com/ethereum/py-evm/issues/1234#issuecomment-419054834",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1234",
    "id": 419054834,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxOTA1NDgzNA==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-06T11:06:00Z",
    "updated_at": "2018-09-06T11:06:00Z",
    "author_association": "MEMBER",
    "body": "> If you squint, I think the constraint implies that a BaseService subclass should never have any async functions that are public (ie~ not prefixed with _). Maybe that's slightly easier to check for.\r\n\r\nIndeed it would, but it just occurred to me that the `await other_service.method()` pattern is actually not a problem in itself if it runs in the background (e.g. via `BaseService.run_task()` & co). It's only code that runs inside a `BaseService._run()` that has to avoid that pattern.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/419054834/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
