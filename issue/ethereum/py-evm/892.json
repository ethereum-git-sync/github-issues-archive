{
  "url": "https://api.github.com/repos/ethereum/py-evm/issues/892",
  "repository_url": "https://api.github.com/repos/ethereum/py-evm",
  "labels_url": "https://api.github.com/repos/ethereum/py-evm/issues/892/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/py-evm/issues/892/comments",
  "events_url": "https://api.github.com/repos/ethereum/py-evm/issues/892/events",
  "html_url": "https://github.com/ethereum/py-evm/issues/892",
  "id": 331295592,
  "node_id": "MDU6SXNzdWUzMzEyOTU1OTI=",
  "number": 892,
  "title": "Validate genesis header",
  "user": {
    "login": "carver",
    "id": 205327,
    "node_id": "MDQ6VXNlcjIwNTMyNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/205327?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/carver",
    "html_url": "https://github.com/carver",
    "followers_url": "https://api.github.com/users/carver/followers",
    "following_url": "https://api.github.com/users/carver/following{/other_user}",
    "gists_url": "https://api.github.com/users/carver/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/carver/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/carver/subscriptions",
    "organizations_url": "https://api.github.com/users/carver/orgs",
    "repos_url": "https://api.github.com/users/carver/repos",
    "events_url": "https://api.github.com/users/carver/events{/privacy}",
    "received_events_url": "https://api.github.com/users/carver/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2018-06-11T18:16:20Z",
  "updated_at": "2018-06-12T21:45:10Z",
  "closed_at": "2018-06-12T21:45:10Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "### What is wrong?\r\n\r\nRight now, we aren't doing anything to validate that the genesis header we download is compatible with the genesis setup used in `trinity`. (not that we support arbitrary genesis settings now, but we will at some point)\r\n\r\n### How can it be fixed\r\n\r\nSee some discussion at: https://github.com/ethereum/py-evm/pull/883#discussion_r194305867\r\n\r\nEvaluate the genesis file setup we'll use (I think an EIP is in draft or merged on this). Does it fully specify the header? If so, force header creation before launching p2p. If not, save the genesis fields for later validation.",
  "closed_by": {
    "login": "carver",
    "id": 205327,
    "node_id": "MDQ6VXNlcjIwNTMyNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/205327?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/carver",
    "html_url": "https://github.com/carver",
    "followers_url": "https://api.github.com/users/carver/followers",
    "following_url": "https://api.github.com/users/carver/following{/other_user}",
    "gists_url": "https://api.github.com/users/carver/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/carver/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/carver/subscriptions",
    "organizations_url": "https://api.github.com/users/carver/orgs",
    "repos_url": "https://api.github.com/users/carver/repos",
    "events_url": "https://api.github.com/users/carver/events{/privacy}",
    "received_events_url": "https://api.github.com/users/carver/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/892/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/py-evm/issues/892/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/396337447",
    "html_url": "https://github.com/ethereum/py-evm/issues/892#issuecomment-396337447",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/892",
    "id": 396337447,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NjMzNzQ0Nw==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-11T18:19:00Z",
    "updated_at": "2018-06-11T18:19:00Z",
    "author_association": "MEMBER",
    "body": "Wait, do we actually download the genesis header? When I said compare the hash there, I meant comparing the `genesis_hash` that is included in the sub-proto handshake",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/396337447/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/396379217",
    "html_url": "https://github.com/ethereum/py-evm/issues/892#issuecomment-396379217",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/892",
    "id": 396379217,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NjM3OTIxNw==",
    "user": {
      "login": "carver",
      "id": 205327,
      "node_id": "MDQ6VXNlcjIwNTMyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/205327?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/carver",
      "html_url": "https://github.com/carver",
      "followers_url": "https://api.github.com/users/carver/followers",
      "following_url": "https://api.github.com/users/carver/following{/other_user}",
      "gists_url": "https://api.github.com/users/carver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/carver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/carver/subscriptions",
      "organizations_url": "https://api.github.com/users/carver/orgs",
      "repos_url": "https://api.github.com/users/carver/repos",
      "events_url": "https://api.github.com/users/carver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/carver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-11T20:38:46Z",
    "updated_at": "2018-06-11T20:39:34Z",
    "author_association": "MEMBER",
    "body": "> Wait, do we actually download the genesis header?\r\n\r\nYes, if I remove the special handling of the genesis header and run trinity in light mode, I get:\r\n\r\n```\r\nWARNING  06-11 13:25:11  lightchain  LESAnnouncementProcessingError('Peer LESPeer <Node(0x053d@79.98.29.154)> sent invalid header <BlockHeader #0 41941023>\r\n```\r\n\r\n> When I said compare the hash there, I meant comparing the genesis_hash that is included in the sub-proto handshake\r\n\r\nSorry, I don't follow. Are you [talking about this](https://github.com/ethereum/py-evm/blob/5591e6e40a14661cf883c603ba2296b7a7483e57/p2p/p2p_proto.py#L92)? I'm not sure how to tie that in -- still learning how it all fits together.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/396379217/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/396387941",
    "html_url": "https://github.com/ethereum/py-evm/issues/892#issuecomment-396387941",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/892",
    "id": 396387941,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NjM4Nzk0MQ==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-11T21:08:37Z",
    "updated_at": "2018-06-11T21:08:37Z",
    "author_association": "MEMBER",
    "body": "That's the base protocol (P2P) handshake. The sub-protocol (LES, ETH, etc) handshake must include the genesis hash, which is used (together with the network ID) to decide if we want to connect to a peer or not. Also, I believe other peers won't connect to us if we send a blank genesis hash in the handshake.\r\n\r\nI guess my point is we must assume the genesis header for our chain is present in the DB when we start, and should never try to download it. It looks like currently that check is not explicit, but I believe it should be",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/396387941/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
