{
  "url": "https://api.github.com/repos/ethereum/py-evm/issues/262",
  "repository_url": "https://api.github.com/repos/ethereum/py-evm",
  "labels_url": "https://api.github.com/repos/ethereum/py-evm/issues/262/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/py-evm/issues/262/comments",
  "events_url": "https://api.github.com/repos/ethereum/py-evm/issues/262/events",
  "html_url": "https://github.com/ethereum/py-evm/issues/262",
  "id": 287858813,
  "node_id": "MDU6SXNzdWUyODc4NTg4MTM=",
  "number": 262,
  "title": "Deduplication of `Message.gas_price` and `Message.origin`",
  "user": {
    "login": "pipermerriam",
    "id": 824194,
    "node_id": "MDQ6VXNlcjgyNDE5NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pipermerriam",
    "html_url": "https://github.com/pipermerriam",
    "followers_url": "https://api.github.com/users/pipermerriam/followers",
    "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
    "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
    "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
    "repos_url": "https://api.github.com/users/pipermerriam/repos",
    "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 630871768,
      "node_id": "MDU6TGFiZWw2MzA4NzE3Njg=",
      "url": "https://api.github.com/repos/ethereum/py-evm/labels/PR%20state:%20WIP",
      "name": "PR state: WIP",
      "color": "fbca04",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "lrettig",
    "id": 3316532,
    "node_id": "MDQ6VXNlcjMzMTY1MzI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3316532?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lrettig",
    "html_url": "https://github.com/lrettig",
    "followers_url": "https://api.github.com/users/lrettig/followers",
    "following_url": "https://api.github.com/users/lrettig/following{/other_user}",
    "gists_url": "https://api.github.com/users/lrettig/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lrettig/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lrettig/subscriptions",
    "organizations_url": "https://api.github.com/users/lrettig/orgs",
    "repos_url": "https://api.github.com/users/lrettig/repos",
    "events_url": "https://api.github.com/users/lrettig/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lrettig/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "lrettig",
      "id": 3316532,
      "node_id": "MDQ6VXNlcjMzMTY1MzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3316532?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lrettig",
      "html_url": "https://github.com/lrettig",
      "followers_url": "https://api.github.com/users/lrettig/followers",
      "following_url": "https://api.github.com/users/lrettig/following{/other_user}",
      "gists_url": "https://api.github.com/users/lrettig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lrettig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lrettig/subscriptions",
      "organizations_url": "https://api.github.com/users/lrettig/orgs",
      "repos_url": "https://api.github.com/users/lrettig/repos",
      "events_url": "https://api.github.com/users/lrettig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lrettig/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2018-01-11T17:16:13Z",
  "updated_at": "2018-03-27T21:59:38Z",
  "closed_at": "2018-03-27T21:59:38Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "### What is wrong?\r\n\r\nThe `Message.gas_price` and `Message.origin` are copied for every level of computation during VM execution, despite them remaining *constant* for the entire context of the VM execution.\r\n\r\nIt would be nice to remove this duplication in favor of having these values stored in *one* location.\r\n\r\nAlso see: `sighash` from https://github.com/ethereum/py-evm/pull/259/files\r\n\r\n\r\n### How can it be fixed\r\n\r\nImplement a `TransactionContext` object, similar to the `ExecutionContext` object introduced in #273 \r\n\r\nThis would be an object that we treat as immutable which houses information like `gas_price`, and `sighash` for the in-progress sharding work.\r\n\r\nSince the info for this object will change over time with changes to the VM rules we should use the following API to allow for changing out the class which contains this data.\r\n\r\n```\r\n# vm_state.py\r\n\r\nclass VMState:\r\n    transaction_context_class = None  # must be set in individual VMState classes\r\n\r\n    @classmethod\r\n    def get_transaction_context_class(cls):\r\n        # error check to be sure it's set\r\n        return self.transaction_context_class\r\n```\r\n\r\nThen, within the `VMState.execute_transaction` implementation, after the `message` instance is created, we should also generate the transaction context instance.\r\n\r\nThen, we modify `vm_state.get_computation` to take both `message` and `transaction_context` as arguments.   The `transaction_context` should be stored on the `Computation` object.  When child computations are spawned, this object should be passed into those instances.\r\n\r\nAny opcodes which previously accessed values from the `Message` which now reside on the `TransactionContext` object will need to be updated.\r\n",
  "closed_by": {
    "login": "pipermerriam",
    "id": 824194,
    "node_id": "MDQ6VXNlcjgyNDE5NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pipermerriam",
    "html_url": "https://github.com/pipermerriam",
    "followers_url": "https://api.github.com/users/pipermerriam/followers",
    "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
    "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
    "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
    "repos_url": "https://api.github.com/users/pipermerriam/repos",
    "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/262/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/py-evm/issues/262/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/356997356",
    "html_url": "https://github.com/ethereum/py-evm/issues/262#issuecomment-356997356",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/262",
    "id": 356997356,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1Njk5NzM1Ng==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-11T17:16:34Z",
    "updated_at": "2018-01-11T17:16:34Z",
    "author_association": "MEMBER",
    "body": "@gsalgado got any ideas on this one?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/356997356/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/357574959",
    "html_url": "https://github.com/ethereum/py-evm/issues/262#issuecomment-357574959",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/262",
    "id": 357574959,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NzU3NDk1OQ==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-15T03:33:14Z",
    "updated_at": "2018-01-15T03:33:14Z",
    "author_association": "MEMBER",
    "body": "I've had a look at that code and couldn't think of anything other than what you suggest, but I'm not very familiar with that area of the code. I'll sleep on it and maybe I'll come up with something...",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/357574959/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/357815458",
    "html_url": "https://github.com/ethereum/py-evm/issues/262#issuecomment-357815458",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/262",
    "id": 357815458,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NzgxNTQ1OA==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-15T23:58:10Z",
    "updated_at": "2018-01-15T23:58:10Z",
    "author_association": "MEMBER",
    "body": "With respect to #273 \r\n\r\nThe `BlockInfo` object there holds *constants* that are true for the entire execution context of a block.  We could follow the same pattern and introduce a `TransactionInfo` object that mirrors this for data that is constant through the execution of a transaction.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/357815458/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/360849660",
    "html_url": "https://github.com/ethereum/py-evm/issues/262#issuecomment-360849660",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/262",
    "id": 360849660,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MDg0OTY2MA==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-26T17:27:48Z",
    "updated_at": "2018-01-26T17:27:48Z",
    "author_association": "MEMBER",
    "body": "@lrettig this would be a good issue for you to look into.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/360849660/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/361419350",
    "html_url": "https://github.com/ethereum/py-evm/issues/262#issuecomment-361419350",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/262",
    "id": 361419350,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MTQxOTM1MA==",
    "user": {
      "login": "lrettig",
      "id": 3316532,
      "node_id": "MDQ6VXNlcjMzMTY1MzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3316532?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lrettig",
      "html_url": "https://github.com/lrettig",
      "followers_url": "https://api.github.com/users/lrettig/followers",
      "following_url": "https://api.github.com/users/lrettig/following{/other_user}",
      "gists_url": "https://api.github.com/users/lrettig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lrettig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lrettig/subscriptions",
      "organizations_url": "https://api.github.com/users/lrettig/orgs",
      "repos_url": "https://api.github.com/users/lrettig/repos",
      "events_url": "https://api.github.com/users/lrettig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lrettig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-29T23:11:50Z",
    "updated_at": "2018-02-10T06:58:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "Do we want to include `message.is_static` here as well? Per https://github.com/ethereum/EIPs/blob/master/EIPS/eip-214.md, this appears to be static in sub-calls.\r\n\r\nUpdate: @pipermerriam says: \"Should not be included. It's included in sub calls only once set so while it can't toggle back and forth, it can change from one computation to the next. Check out the static call opcode.\"",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/361419350/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
