{
  "url": "https://api.github.com/repos/ethereum/py-evm/issues/523",
  "repository_url": "https://api.github.com/repos/ethereum/py-evm",
  "labels_url": "https://api.github.com/repos/ethereum/py-evm/issues/523/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/py-evm/issues/523/comments",
  "events_url": "https://api.github.com/repos/ethereum/py-evm/issues/523/events",
  "html_url": "https://github.com/ethereum/py-evm/issues/523",
  "id": 310265729,
  "node_id": "MDU6SXNzdWUzMTAyNjU3Mjk=",
  "number": 523,
  "title": "Look into ways to reduce our DB size",
  "user": {
    "login": "gsalgado",
    "id": 412274,
    "node_id": "MDQ6VXNlcjQxMjI3NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gsalgado",
    "html_url": "https://github.com/gsalgado",
    "followers_url": "https://api.github.com/users/gsalgado/followers",
    "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
    "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
    "organizations_url": "https://api.github.com/users/gsalgado/orgs",
    "repos_url": "https://api.github.com/users/gsalgado/repos",
    "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gsalgado/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 13,
  "created_at": "2018-03-31T19:30:41Z",
  "updated_at": "2018-04-20T15:24:36Z",
  "closed_at": "2018-04-20T15:24:36Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "I've just completed a fast sync of blocks/receipts (no state) on ropsten and after that our DB has 28GB, whereas geth's (including state) is at 14GB. We need to find why we're using so much more and fix it. One thing to look into would be changing the lookup keys (e.g 'transaction-hash-to-block') to something shorter\r\n\r\nApart from the (probably unnecessary) extra disk space usage, this causes DB operations to be significantly slower, which is specially problematic during a fast sync since that makes tons of reads/writes from/to the DB",
  "closed_by": {
    "login": "pipermerriam",
    "id": 824194,
    "node_id": "MDQ6VXNlcjgyNDE5NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pipermerriam",
    "html_url": "https://github.com/pipermerriam",
    "followers_url": "https://api.github.com/users/pipermerriam/followers",
    "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
    "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
    "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
    "repos_url": "https://api.github.com/users/pipermerriam/repos",
    "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/523/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/py-evm/issues/523/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/377791333",
    "html_url": "https://github.com/ethereum/py-evm/issues/523#issuecomment-377791333",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/523",
    "id": 377791333,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3Nzc5MTMzMw==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-01T14:40:14Z",
    "updated_at": "2018-04-02T17:54:48Z",
    "author_association": "MEMBER",
    "body": "I've been interested in exploring using a relational db (like sqlite) for some of this structured metadata:\r\n\r\n- txn hash -> block hash, txn_index\r\n- canonical block number -> block hash\r\n- canonical chain head\r\n- block_hash -> total difficulty\r\n- canonical header chain with just a limited subset of the header data: (hash, number, ??) \r\n\r\nThis seems like it could have the side effect of reducing the database size while having some other benefits.\r\n\r\n- looking up the last N previous hashes for a block **should** be a single query.\r\n- db enforces basic schema and relationships.\r\n\r\nSimple intermediate solution should be simple as changing some of the keys like you mentioned to shorter keys (`transaction-hash-to-block` -> `tx2blk`).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/377791333/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/378008591",
    "html_url": "https://github.com/ethereum/py-evm/issues/523#issuecomment-378008591",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/523",
    "id": 378008591,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODAwODU5MQ==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-02T18:49:18Z",
    "updated_at": "2018-04-02T18:49:18Z",
    "author_association": "MEMBER",
    "body": "The 28GB DB I was looking at had no `transaction-hash-to-data:` or `transaction-hash-to-block:` entries as those are only created when you call `persist_block()` and the chain syncer currently persists the block parts separately. Can anybody think of other reasons that could be causing our DB to be more than twice as big as geth's?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/378008591/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/378010222",
    "html_url": "https://github.com/ethereum/py-evm/issues/523#issuecomment-378010222",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/523",
    "id": 378010222,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODAxMDIyMg==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-02T18:55:05Z",
    "updated_at": "2018-04-02T18:55:05Z",
    "author_association": "MEMBER",
    "body": "It looks like leveldb will use snappy compression when available.  Do you have snappy installed on your machine?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/378010222/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/378013768",
    "html_url": "https://github.com/ethereum/py-evm/issues/523#issuecomment-378013768",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/523",
    "id": 378013768,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODAxMzc2OA==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-02T19:08:50Z",
    "updated_at": "2018-04-02T19:08:50Z",
    "author_association": "MEMBER",
    "body": "I have libsnappy1v5, but after removing it I could still access the DB using `leveldb.LevelDB`, so I guess it's not compressed?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/378013768/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/378017835",
    "html_url": "https://github.com/ethereum/py-evm/issues/523#issuecomment-378017835",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/523",
    "id": 378017835,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODAxNzgzNQ==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-02T19:25:00Z",
    "updated_at": "2018-04-02T19:25:00Z",
    "author_association": "MEMBER",
    "body": "Duplicate from gitter chat:\r\n\r\nMaybe we should first look into switching to a different python leveldb library which is actively maintained.\r\n\r\nhttps://github.com/wbolster/plyvel looks like a solid candidate.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/378017835/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/378213064",
    "html_url": "https://github.com/ethereum/py-evm/issues/523#issuecomment-378213064",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/523",
    "id": 378213064,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODIxMzA2NA==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-03T11:09:23Z",
    "updated_at": "2018-04-03T11:09:23Z",
    "author_association": "MEMBER",
    "body": "plyvel doesn't seem to offer any performance improvements, but it probably makes sense to switch as it's actively maintained and documented: #527",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/378213064/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/378301289",
    "html_url": "https://github.com/ethereum/py-evm/issues/523#issuecomment-378301289",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/523",
    "id": 378301289,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODMwMTI4OQ==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-03T15:57:00Z",
    "updated_at": "2018-04-03T15:57:00Z",
    "author_association": "MEMBER",
    "body": "When you say performance are you referring to db size or speed?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/378301289/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/378304767",
    "html_url": "https://github.com/ethereum/py-evm/issues/523#issuecomment-378304767",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/523",
    "id": 378304767,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODMwNDc2Nw==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-03T16:07:39Z",
    "updated_at": "2018-04-03T16:07:39Z",
    "author_association": "MEMBER",
    "body": "Speed; I only profiled it for speed using the existing chaindb I had. I'll now run a fast-sync from scratch and compare DB sizes",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/378304767/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/378310990",
    "html_url": "https://github.com/ethereum/py-evm/issues/523#issuecomment-378310990",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/523",
    "id": 378310990,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODMxMDk5MA==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-03T16:26:49Z",
    "updated_at": "2018-04-03T16:26:49Z",
    "author_association": "MEMBER",
    "body": "Just ran a quick test fast-syncing the first 100k blocks and the DBs created by plyvel/leveldb are roughly the same size",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/378310990/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/381995944",
    "html_url": "https://github.com/ethereum/py-evm/issues/523#issuecomment-381995944",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/523",
    "id": 381995944,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MTk5NTk0NA==",
    "user": {
      "login": "hwwhww",
      "id": 9263930,
      "node_id": "MDQ6VXNlcjkyNjM5MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9263930?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hwwhww",
      "html_url": "https://github.com/hwwhww",
      "followers_url": "https://api.github.com/users/hwwhww/followers",
      "following_url": "https://api.github.com/users/hwwhww/following{/other_user}",
      "gists_url": "https://api.github.com/users/hwwhww/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hwwhww/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hwwhww/subscriptions",
      "organizations_url": "https://api.github.com/users/hwwhww/orgs",
      "repos_url": "https://api.github.com/users/hwwhww/repos",
      "events_url": "https://api.github.com/users/hwwhww/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hwwhww/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-17T13:39:52Z",
    "updated_at": "2018-04-18T04:30:04Z",
    "author_association": "MEMBER",
    "body": "> I've been interested in exploring using a relational db (like sqlite) for some of this structured metadata:\r\n> - txn hash -> block hash, txn_index\r\n> - canonical block number -> block hash\r\n> - canonical chain head\r\n> - block_hash -> total difficulty\r\n> - canonical header chain with just a limited subset of the header data: (hash, number, ??)\r\n\r\n \r\n It looks like geth is using leveldb to build the relationship:\r\n\r\n#### 1. Store blockReceipts in one entry:\r\nIn py-evm, storing receipt:\r\nhttps://github.com/ethereum/py-evm/blob/5525c12fd1e1860fe5e885d68b9eb4d38009a833/evm/db/chain.py#L598-L601\r\n\r\nIn geth, storing the entire `BlockReceipt` into a single entry with prefix (`blockReceiptsPrefix`) instead of separate receipts key/value:\r\nhttps://github.com/ethereum/go-ethereum/blob/7605e63cb9dda7fc5bb619abf1eb1f74ac3f6cc1/core/database_util.go#L464-L480\r\n\r\n#### 2. Store block body in one key-value store includes both transactions and uncles\r\nWhen they want to access a transaction, they have to look up `blockHash, blockNumber, txIndex` via transaction hash, get the block body, and then get the specific transaction:\r\nhttps://github.com/ethereum/go-ethereum/blob/7605e63cb9dda7fc5bb619abf1eb1f74ac3f6cc1/core/database_util.go#L284-L295\r\n\r\n#### 3. Rough comparision\r\nSomething geth doesn‚Äôt store, but py-evm does:\r\n1. The way store receipts: in trie db, each receipt takes one key-value store.\r\n2. The way store body:\r\n\t1. Uncle: in trie db, each uncle takes one key-value store\r\n\t2. Tx: in trie db, each tx takes one key-value store\r\n\r\nSomething py-evm doesn‚Äôt store, but geth does:\r\n1. Meta data\r\n\t1. block_hash -> total difficulty\r\n\t2. block_hash -> block_number \r\n\t3. block_number + block_hash -> block receipts\r\n\t4. receipt_hash -> transaction/receipt lookup metadata (block_hash, block_number, transaction_index)   # py-evm only has txHash -> blockHash\r\n\t5. bloom bits\r\n2. The way store receipts: one key-value store per block\r\n3. The way store body: one key-value store per block\r\n\r\n---\r\nIt‚Äôs still unclear for me to compare the trade-off between more key-value stores for the actual data and more lookups, but the way we get a specific block may be inefficient when other nodes want to download data from Trinity. It seems Trinity has to query and decode the block body from every transactions and uncles to rebuild the block body:\r\nhttps://github.com/ethereum/py-evm/blob/f7bc89f7c05bcc2e721cacf56408f1bf821ad887/evm/vm/forks/frontier/blocks.py#L88-L104\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/381995944/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/382655108",
    "html_url": "https://github.com/ethereum/py-evm/issues/523#issuecomment-382655108",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/523",
    "id": 382655108,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MjY1NTEwOA==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-19T08:33:30Z",
    "updated_at": "2018-04-19T09:32:34Z",
    "author_association": "MEMBER",
    "body": "FWIW, #565 is ~~likely to significantly reduce our DB footprint~~. EDIT: It won't because during a fast-sync we don't store every partial tx/receipt tries like we used to do when actually importing blocks\r\n\r\nhttps://github.com/ethereum/py-trie/pull/49 should definitely reduce our DB footprint, though",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/382655108/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/383112992",
    "html_url": "https://github.com/ethereum/py-evm/issues/523#issuecomment-383112992",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/523",
    "id": 383112992,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MzExMjk5Mg==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-20T14:25:06Z",
    "updated_at": "2018-04-20T14:25:06Z",
    "author_association": "MEMBER",
    "body": "So, using https://github.com/ethereum/py-trie/pull/49 in `make_trie_root_and_nodes()` a fresh fast-synced DB is almost a third the size of the one that didn't use that, so we should probably close this and move the discussion about structured metadata to a separate issue?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/383112992/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/383131902",
    "html_url": "https://github.com/ethereum/py-evm/issues/523#issuecomment-383131902",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/523",
    "id": 383131902,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MzEzMTkwMg==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-20T15:24:36Z",
    "updated_at": "2018-04-20T15:24:36Z",
    "author_association": "MEMBER",
    "body": "üëç ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/383131902/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
