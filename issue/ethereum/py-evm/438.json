{
  "url": "https://api.github.com/repos/ethereum/py-evm/issues/438",
  "repository_url": "https://api.github.com/repos/ethereum/py-evm",
  "labels_url": "https://api.github.com/repos/ethereum/py-evm/issues/438/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/py-evm/issues/438/comments",
  "events_url": "https://api.github.com/repos/ethereum/py-evm/issues/438/events",
  "html_url": "https://github.com/ethereum/py-evm/issues/438",
  "id": 302276265,
  "node_id": "MDU6SXNzdWUzMDIyNzYyNjU=",
  "number": 438,
  "title": "Pong msg received from some bootstrap nodes has wrong content ",
  "user": {
    "login": "gsalgado",
    "id": 412274,
    "node_id": "MDQ6VXNlcjQxMjI3NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gsalgado",
    "html_url": "https://github.com/gsalgado",
    "followers_url": "https://api.github.com/users/gsalgado/followers",
    "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
    "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
    "organizations_url": "https://api.github.com/users/gsalgado/orgs",
    "repos_url": "https://api.github.com/users/gsalgado/repos",
    "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gsalgado/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 889922027,
      "node_id": "MDU6TGFiZWw4ODk5MjIwMjc=",
      "url": "https://api.github.com/repos/ethereum/py-evm/labels/comp:%20p2p",
      "name": "comp: p2p",
      "color": "bfd4f2",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2018-03-05T12:09:40Z",
  "updated_at": "2018-07-13T11:37:57Z",
  "closed_at": "2018-07-13T11:37:57Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Before we begin the node discovery process, we must ping a remote node and receive back a pong containing the hash of the original ping msg. That works with some of the bootnodes, but some of them reply with a pong containing a hash that does not seem to match the original ping msg. Need to figure out if that's a bug on our side, or something else\r\n\r\nThe logs below (from running `python -m p2p.discovery` with both ROPSTEN and MAINNET bootnodes) show for which nodes it does/doesn't work:\r\n\r\n##  Ropsten bootnodes (pong from 1 out of 4 nodes match what we expect)\r\n```\r\nDEBUG: boostrapping with [<Node(0x30b7@52.176.7.10)>, <Node(0x865a@52.176.100.77)>, <Node(0x6332@52.232.243.152)>, <Node(0x94c1@192.81.208.223)>]\r\nDEBUG: >>> ping <Node(0x6332@52.232.243.152)> (token == 0x8bce894daf3072b862ae7cfd2de5db942a861d6fe4fad417568d3c44574a16b8)\r\nDEBUG: >>> ping <Node(0x30b7@52.176.7.10)> (token == 0x65936c3caba700e4ad91051f4bf92b1fb31604857ced0a7a3e0acc6c038c7039)\r\nDEBUG: >>> ping <Node(0x865a@52.176.100.77)> (token == 0xdb0003ca9ecf80663f87fbe7485d3c86a33e9f31e36dd43be2f853c4bdd8b1c4)\r\nDEBUG: >>> ping <Node(0x94c1@192.81.208.223)> (token == 0xb285420cc803802e5cb0aa3bc07a3f35cd3921c83aea028652f7d5d5649a57dc)\r\nDEBUG: <<< pong from <Node(0x865a@52.176.100.77)> (token == 0x1f79cc29edafd593ac4f8566d7766bd625823df6e5f90c3d225c6087d423d859)\r\nDEBUG: unexpected pong from <Node(0x865a@52.176.100.77)> (token == 0x1f79cc29edafd593ac4f8566d7766bd625823df6e5f90c3d225c6087d423d859)\r\nDEBUG: <<< pong from <Node(0x30b7@52.176.7.10)> (token == 0x65936c3caba700e4ad91051f4bf92b1fb31604857ced0a7a3e0acc6c038c7039)\r\nDEBUG: got expected pong with token 0x65936c3caba700e4ad91051f4bf92b1fb31604857ced0a7a3e0acc6c038c7039\r\nDEBUG: <<< pong from <Node(0x6332@52.232.243.152)> (token == 0xa48788faf6f47d5653c09c46d29457e55d01352ac168ae064c1e32ae84c8ed5d)\r\nDEBUG: unexpected pong from <Node(0x6332@52.232.243.152)> (token == 0xa48788faf6f47d5653c09c46d29457e55d01352ac168ae064c1e32ae84c8ed5d)\r\nDEBUG: <<< pong from <Node(0x94c1@192.81.208.223)> (token == 0xba8d1f07a2df3640d85c958c6c83bfb1360e6175d45fc5ce80396a164c6e2092)\r\nDEBUG: unexpected pong from <Node(0x94c1@192.81.208.223)> (token == 0xba8d1f07a2df3640d85c958c6c83bfb1360e6175d45fc5ce80396a164c6e2092)\r\n```\r\n\r\n## Mainnet bootnodes (pong from 3 out of 5 nodes match what we expect)\r\n```\r\nDEBUG: boostrapping with [<Node(0xa979@52.16.188.185)>, <Node(0x3f1d@13.93.211.84)>, <Node(0x78de@191.235.84.50)>, <Node(0x158f@13.75.154.138)>, <Node(0x1118@52.74.57.123)>]\r\nDEBUG: >>> ping <Node(0xa979@52.16.188.185)> (token == 0x6a048b4c3793ecbf4bb53e07783e12fb5b3cb1237b44446ecb89fa0700cd46b7)\r\nDEBUG: >>> ping <Node(0x3f1d@13.93.211.84)> (token == 0x92783414de7c61035a5d25b56e4273585cbb38a26c195778540d40e020d99fdf)\r\nDEBUG: >>> ping <Node(0x78de@191.235.84.50)> (token == 0x00f13479326fd522dc44920870930155bd8d8fcbb2d32dcad762d8d331161bef)\r\nDEBUG: >>> ping <Node(0x158f@13.75.154.138)> (token == 0x04551cf531c322c400f794cd048ec88003cf6b4447f4246e1fba8f09f58d4488)\r\nDEBUG: >>> ping <Node(0x1118@52.74.57.123)> (token == 0xa23366c64aa2d0dbbff3c22232ee4afe233165b3be08268cd7b91d41b920c5ed)\r\nDEBUG: <<< pong from <Node(0xaa36@13.93.211.84)> (token == 0x92783414de7c61035a5d25b56e4273585cbb38a26c195778540d40e020d99fdf)\r\nDEBUG: unexpected pong from <Node(0xaa36@13.93.211.84)> (token == 0x92783414de7c61035a5d25b56e4273585cbb38a26c195778540d40e020d99fdf)\r\nDEBUG: <<< ping from <Node(0xaa36@13.93.211.84)>\r\nDEBUG: >>> pong <Node(0xaa36@13.93.211.84)>\r\nDEBUG: <<< pong from <Node(0x78de@191.235.84.50)> (token == 0x00f13479326fd522dc44920870930155bd8d8fcbb2d32dcad762d8d331161bef)\r\nDEBUG: <<< ping from <Node(0x78de@191.235.84.50)>\r\nDEBUG: >>> pong <Node(0x78de@191.235.84.50)>\r\nDEBUG: got expected pong with token 0x00f13479326fd522dc44920870930155bd8d8fcbb2d32dcad762d8d331161bef\r\nDEBUG: <<< pong from <Node(0x1118@52.74.57.123)> (token == 0xa23366c64aa2d0dbbff3c22232ee4afe233165b3be08268cd7b91d41b920c5ed)\r\nDEBUG: <<< ping from <Node(0x1118@52.74.57.123)>\r\nDEBUG: >>> pong <Node(0x1118@52.74.57.123)>\r\nDEBUG: <<< pong from <Node(0x158f@13.75.154.138)> (token == 0x04551cf531c322c400f794cd048ec88003cf6b4447f4246e1fba8f09f58d4488)\r\nDEBUG: got expected pong with token 0xa23366c64aa2d0dbbff3c22232ee4afe233165b3be08268cd7b91d41b920c5ed\r\nDEBUG: got expected pong with token 0x04551cf531c322c400f794cd048ec88003cf6b4447f4246e1fba8f09f58d4488\r\n\r\n```",
  "closed_by": {
    "login": "gsalgado",
    "id": 412274,
    "node_id": "MDQ6VXNlcjQxMjI3NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gsalgado",
    "html_url": "https://github.com/gsalgado",
    "followers_url": "https://api.github.com/users/gsalgado/followers",
    "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
    "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
    "organizations_url": "https://api.github.com/users/gsalgado/orgs",
    "repos_url": "https://api.github.com/users/gsalgado/repos",
    "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gsalgado/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/438/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/py-evm/issues/438/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/370459956",
    "html_url": "https://github.com/ethereum/py-evm/issues/438#issuecomment-370459956",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/438",
    "id": 370459956,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MDQ1OTk1Ng==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-05T15:40:28Z",
    "updated_at": "2018-03-05T15:40:28Z",
    "author_association": "MEMBER",
    "body": "I've tested against a local geth (v1.7.3 and v1.8.1) and in both cases got the correct hash in the pong msg, so it could either be that those bootnodes are running very old geth versions or parity/cpp-ethereum",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/370459956/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/370547583",
    "html_url": "https://github.com/ethereum/py-evm/issues/438#issuecomment-370547583",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/438",
    "id": 370547583,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MDU0NzU4Mw==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-05T20:08:46Z",
    "updated_at": "2018-03-05T20:08:46Z",
    "author_association": "MEMBER",
    "body": "Ok, so for the mainnet bootnodes it turns out that we had the wrong pubkey for one of them (0x3f1d1) and the other just doesn't reply. The one for which we had the wrong pubkey [seems to be a parity node](https://github.com/paritytech/parity/pull/7476/files#diff-09e1141f3610b5496b23dd6fa862d325L186), but after updating the our enode URI to use the correct pubkey, we get the expected pong from it, so I'm tempted to just assume the unexpected pongs we're getting from ropsten bootnodes are caused by old/broken implementations",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/370547583/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/404808298",
    "html_url": "https://github.com/ethereum/py-evm/issues/438#issuecomment-404808298",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/438",
    "id": 404808298,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNDgwODI5OA==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-13T11:37:56Z",
    "updated_at": "2018-07-13T11:37:56Z",
    "author_association": "MEMBER",
    "body": "Damn! spent a couple hours debugging this just to find out it was actually a bug in parity: https://github.com/paritytech/parity/issues/8038",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/404808298/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
