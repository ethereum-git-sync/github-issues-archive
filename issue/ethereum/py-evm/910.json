{
  "url": "https://api.github.com/repos/ethereum/py-evm/issues/910",
  "repository_url": "https://api.github.com/repos/ethereum/py-evm",
  "labels_url": "https://api.github.com/repos/ethereum/py-evm/issues/910/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/py-evm/issues/910/comments",
  "events_url": "https://api.github.com/repos/ethereum/py-evm/issues/910/events",
  "html_url": "https://github.com/ethereum/py-evm/issues/910",
  "id": 332000020,
  "node_id": "MDU6SXNzdWUzMzIwMDAwMjA=",
  "number": 910,
  "title": "Profile and optimize new VM.validate_header()",
  "user": {
    "login": "gsalgado",
    "id": 412274,
    "node_id": "MDQ6VXNlcjQxMjI3NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gsalgado",
    "html_url": "https://github.com/gsalgado",
    "followers_url": "https://api.github.com/users/gsalgado/followers",
    "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
    "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
    "organizations_url": "https://api.github.com/users/gsalgado/orgs",
    "repos_url": "https://api.github.com/users/gsalgado/repos",
    "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gsalgado/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/ethereum/py-evm/milestones/3",
    "html_url": "https://github.com/ethereum/py-evm/milestone/3",
    "labels_url": "https://api.github.com/repos/ethereum/py-evm/milestones/3/labels",
    "id": 3420500,
    "node_id": "MDk6TWlsZXN0b25lMzQyMDUwMA==",
    "number": 3,
    "title": "Grace Hopper (Trinity Release)",
    "description": "Next publicised alpha release of Trinity",
    "creator": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 19,
    "state": "closed",
    "created_at": "2018-06-13T01:18:30Z",
    "updated_at": "2018-07-24T16:15:07Z",
    "due_on": "2018-06-14T07:00:00Z",
    "closed_at": "2018-07-24T16:15:07Z"
  },
  "comments": 8,
  "created_at": "2018-06-13T13:41:02Z",
  "updated_at": "2018-07-13T20:29:25Z",
  "closed_at": "2018-07-13T20:29:25Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "That method takes 1.4s to complete when I call it passing the DAO fork header (1920000). If it takes as long to validate any header, that will be a huge problem for the light client and fast-sync\r\n\r\nNeed to profile it and optimize. Unless, of course, it's only when validating the DAO fork header that it takes that long\r\n",
  "closed_by": {
    "login": "carver",
    "id": 205327,
    "node_id": "MDQ6VXNlcjIwNTMyNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/205327?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/carver",
    "html_url": "https://github.com/carver",
    "followers_url": "https://api.github.com/users/carver/followers",
    "following_url": "https://api.github.com/users/carver/following{/other_user}",
    "gists_url": "https://api.github.com/users/carver/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/carver/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/carver/subscriptions",
    "organizations_url": "https://api.github.com/users/carver/orgs",
    "repos_url": "https://api.github.com/users/carver/repos",
    "events_url": "https://api.github.com/users/carver/events{/privacy}",
    "received_events_url": "https://api.github.com/users/carver/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/910/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/py-evm/issues/910/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/397000974",
    "html_url": "https://github.com/ethereum/py-evm/issues/910#issuecomment-397000974",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/910",
    "id": 397000974,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NzAwMDk3NA==",
    "user": {
      "login": "carver",
      "id": 205327,
      "node_id": "MDQ6VXNlcjIwNTMyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/205327?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/carver",
      "html_url": "https://github.com/carver",
      "followers_url": "https://api.github.com/users/carver/followers",
      "following_url": "https://api.github.com/users/carver/following{/other_user}",
      "gists_url": "https://api.github.com/users/carver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/carver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/carver/subscriptions",
      "organizations_url": "https://api.github.com/users/carver/orgs",
      "repos_url": "https://api.github.com/users/carver/repos",
      "events_url": "https://api.github.com/users/carver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/carver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-13T16:26:02Z",
    "updated_at": "2018-06-13T16:26:02Z",
    "author_association": "MEMBER",
    "body": "If 1.4s is the time to run only one test, it might be the cache generation for the PoW check. I would want to see the average time over a bunch of runs.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/397000974/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/397355901",
    "html_url": "https://github.com/ethereum/py-evm/issues/910#issuecomment-397355901",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/910",
    "id": 397355901,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NzM1NTkwMQ==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-14T16:25:22Z",
    "updated_at": "2018-06-14T16:25:22Z",
    "author_association": "MEMBER",
    "body": "This is some profiling data I gathered from importing ropsten blocks around 107178. Header validation (mainly pow checking) consumes a significant amount of time, but doesn't seem to be a huge deal on that range of blocks. It'd be interesting to do the same on recent blocks, with higher TD. If anybody has a fully synced light DB, this is the code I used to profile just the header importing: https://gist.github.com/gsalgado/e8e6d3e28ad7fa3db84040be551b6bce\r\n\r\n```\r\n   ncalls  tottime  percall  cumtime  percall filename:lineno(function)\r\n   398513    5.311    0.000  243.677    0.001 base_events.py:1336(_run_once)\r\n   782090    2.972    0.000  148.824    0.000 events.py:143(_run)\r\n    49536    0.049    0.000  119.393    0.002 lightchain.py:159(_process_announcements)\r\n    49536    0.041    0.000  119.343    0.002 lightchain.py:230(process_announcement)\r\n    49536    0.649    0.000  119.303    0.002 lightchain.py:246(_import_headers_from_peer)\r\n    49536    0.327    0.000  114.036    0.002 lightchain.py:275(_validate_header)\r\n    24768    0.268    0.000  110.345    0.004 base.py:676(validate_header)\r\n    24768    0.194    0.000  109.906    0.004 base.py:703(validate_seal)\r\n    24768    0.586    0.000  102.144    0.004 pow.py:55(check_pow)\r\n    24768   98.904    0.004   98.904    0.004 {built-in method pyethash.hashimoto_light}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/397355901/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/398211103",
    "html_url": "https://github.com/ethereum/py-evm/issues/910#issuecomment-398211103",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/910",
    "id": 398211103,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5ODIxMTEwMw==",
    "user": {
      "login": "carver",
      "id": 205327,
      "node_id": "MDQ6VXNlcjIwNTMyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/205327?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/carver",
      "html_url": "https://github.com/carver",
      "followers_url": "https://api.github.com/users/carver/followers",
      "following_url": "https://api.github.com/users/carver/following{/other_user}",
      "gists_url": "https://api.github.com/users/carver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/carver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/carver/subscriptions",
      "organizations_url": "https://api.github.com/users/carver/orgs",
      "repos_url": "https://api.github.com/users/carver/repos",
      "events_url": "https://api.github.com/users/carver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/carver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-18T22:08:05Z",
    "updated_at": "2018-06-18T22:08:05Z",
    "author_association": "MEMBER",
    "body": "I heard a rumor that geth doesn't check the PoW on every header. Would be worth checking out how they do that safely.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/398211103/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/398659384",
    "html_url": "https://github.com/ethereum/py-evm/issues/910#issuecomment-398659384",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/910",
    "id": 398659384,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5ODY1OTM4NA==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-20T07:57:31Z",
    "updated_at": "2018-06-20T08:02:03Z",
    "author_association": "MEMBER",
    "body": "Indeed it doesn't; I describe their approach in https://github.com/ethereum/py-evm/issues/330#issue-292753647. Filed #932 for it",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/398659384/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/400240319",
    "html_url": "https://github.com/ethereum/py-evm/issues/910#issuecomment-400240319",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/910",
    "id": 400240319,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMDI0MDMxOQ==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-26T09:18:21Z",
    "updated_at": "2018-06-26T09:18:21Z",
    "author_association": "MEMBER",
    "body": "So, as shown by the profiling data above, doing PoW validation makes light sync much slower, but it's mainly because of pyethash.hashimoto_light, which I imagine won't be easy to optimize, so I think our best bet is #932",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/400240319/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/403991996",
    "html_url": "https://github.com/ethereum/py-evm/issues/910#issuecomment-403991996",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/910",
    "id": 403991996,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMzk5MTk5Ng==",
    "user": {
      "login": "carver",
      "id": 205327,
      "node_id": "MDQ6VXNlcjIwNTMyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/205327?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/carver",
      "html_url": "https://github.com/carver",
      "followers_url": "https://api.github.com/users/carver/followers",
      "following_url": "https://api.github.com/users/carver/following{/other_user}",
      "gists_url": "https://api.github.com/users/carver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/carver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/carver/subscriptions",
      "organizations_url": "https://api.github.com/users/carver/orgs",
      "repos_url": "https://api.github.com/users/carver/repos",
      "events_url": "https://api.github.com/users/carver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/carver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-10T22:58:11Z",
    "updated_at": "2018-07-10T22:58:21Z",
    "author_association": "MEMBER",
    "body": "Should we:\r\n\r\n1. move this issue to the following milestone, or\r\n2. add kth header validation to Grace Hopper\r\n\r\nI'm currently pro 1",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/403991996/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/404470452",
    "html_url": "https://github.com/ethereum/py-evm/issues/910#issuecomment-404470452",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/910",
    "id": 404470452,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNDQ3MDQ1Mg==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-12T10:43:28Z",
    "updated_at": "2018-07-12T10:43:28Z",
    "author_association": "MEMBER",
    "body": "I guess we could do both. 2 is already on its way (#1010)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/404470452/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/404945153",
    "html_url": "https://github.com/ethereum/py-evm/issues/910#issuecomment-404945153",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/910",
    "id": 404945153,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNDk0NTE1Mw==",
    "user": {
      "login": "carver",
      "id": 205327,
      "node_id": "MDQ6VXNlcjIwNTMyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/205327?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/carver",
      "html_url": "https://github.com/carver",
      "followers_url": "https://api.github.com/users/carver/followers",
      "following_url": "https://api.github.com/users/carver/following{/other_user}",
      "gists_url": "https://api.github.com/users/carver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/carver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/carver/subscriptions",
      "organizations_url": "https://api.github.com/users/carver/orgs",
      "repos_url": "https://api.github.com/users/carver/repos",
      "events_url": "https://api.github.com/users/carver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/carver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-13T20:29:25Z",
    "updated_at": "2018-07-13T20:29:25Z",
    "author_association": "MEMBER",
    "body": "With #1010 merged, this issue seems done enough to close.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/404945153/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
