{
  "url": "https://api.github.com/repos/ethereum/py-evm/issues/294",
  "repository_url": "https://api.github.com/repos/ethereum/py-evm",
  "labels_url": "https://api.github.com/repos/ethereum/py-evm/issues/294/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/py-evm/issues/294/comments",
  "events_url": "https://api.github.com/repos/ethereum/py-evm/issues/294/events",
  "html_url": "https://github.com/ethereum/py-evm/issues/294",
  "id": 290682116,
  "node_id": "MDU6SXNzdWUyOTA2ODIxMTY=",
  "number": 294,
  "title": "Compatibility / Functioning of py-evm chain/storage",
  "user": {
    "login": "step21",
    "id": 46968,
    "node_id": "MDQ6VXNlcjQ2OTY4",
    "avatar_url": "https://avatars.githubusercontent.com/u/46968?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/step21",
    "html_url": "https://github.com/step21",
    "followers_url": "https://api.github.com/users/step21/followers",
    "following_url": "https://api.github.com/users/step21/following{/other_user}",
    "gists_url": "https://api.github.com/users/step21/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/step21/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/step21/subscriptions",
    "organizations_url": "https://api.github.com/users/step21/orgs",
    "repos_url": "https://api.github.com/users/step21/repos",
    "events_url": "https://api.github.com/users/step21/events{/privacy}",
    "received_events_url": "https://api.github.com/users/step21/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2018-01-23T01:58:38Z",
  "updated_at": "2018-01-23T04:30:19Z",
  "closed_at": "2018-01-23T02:49:53Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "* py-evm Version: 0.6.0\r\n* OS: Linux Ubuntu 16.04.3\r\n* Python Version (python --version):\r\n2.7.12 and 3.5\r\n* Environment (output of `pip freeze`):\r\naiohttp==2.3.1\r\napipkg==1.4\r\nasn1crypto==0.24.0\r\nasync-generator==1.9\r\nasync-lru==0.1.0\r\nasync-timeout==2.0.0\r\nattrs==17.4.0\r\nbumpversion==0.5.3\r\ncffi==1.11.4\r\nchardet==3.0.4\r\ncoverage==4.4.2\r\ncryptography==2.1.4\r\ncytoolz==0.9.0\r\neth-bloom==0.5.2\r\neth-keys==0.1.0b3\r\neth-utils==0.7.4\r\nexecnet==1.5.0\r\nflake8==3.5.0\r\nhypothesis==3.30.0\r\nidna==2.6\r\nleveldb==0.194\r\nmccabe==0.6.1\r\nmultidict==4.0.0\r\npluggy==0.6.0\r\npy==1.5.2\r\npy-ecc==1.4.2\r\n-e git+git@github.com:pipermerriam/py-evm.git@8bc9a42943730fd09e29695dab0c2a1e869e913f#egg=py_evm\r\npycodestyle==2.3.1\r\npycparser==2.18\r\npyethash==0.1.27\r\npyflakes==1.6.0\r\npysha3==1.0.2\r\npytest==3.1.2\r\npytest-asyncio==0.8.0\r\npytest-cov==2.5.1\r\npytest-logging==2015.11.4\r\npytest-xdist==1.18.1\r\nrlp==0.4.7\r\nsix==1.11.0\r\ntoolz==0.9.0\r\ntox==2.7.0\r\ntrie==1.1.0\r\ntyping==3.6.2\r\nvirtualenv==15.1.0\r\nyarl==1.1.0\r\n\r\n### What is wrong?\r\nWhen trying to read an existing chain (made with go-ethereum) based on the examples (http://py-evm.readthedocs.io/en/latest/quickstart.html#accessing-an-existing-chain-database) I get `evm.exceptions.CanonicalHeadNotFound: No canonical head set for this chain` - ideally, this should still work as far as I understand. Though it is a bit hard to verify when comparing the codebases, whether these should be compatible or not (apparently not). While it is my understanding that things like rlp and trie should be implemented in a compatible way, I found it kind of hard to check that and even more so how this then gets saved on disk.\r\nGetting back to the issue at hand, so it seems that py-evm sets `b'v1:canonical_head_hash'`as default and on lookups sets this properly. At least this `b'v1:canonical_head_hash'` or similar I couldn't find anywhere else in other implementations. (confirmed by checking almost empty leveldbs manually)\r\nSo the main issue/question is - is there a way around this, so as to use for example py-evm's chain/state/etc logic and maybe also leveldb/db parts but use it to access geth chains or others? Could this maybe even be a configuration option? (ofc geth also must somehow keep track of the head, but def doesn't have a special, unencoded db key for it as far as I can tell)\r\n\r\nComplete output:\r\n```chain = MainnetChain(chaindb)Traceback (most recent call last):\r\n  File \"<stdin>\", line 1, in <module>\r\n  File \"/home/user/py-evm/evm/chains/chain.py\", line 68, in __init__\r\n    self.header = self.create_header_from_parent(self.get_canonical_head())\r\n  File \"/home/user/py-evm/evm/chains/chain.py\", line 160, in get_canonical_head\r\n    return self.chaindb.get_canonical_head()\r\n  File \"/home/user/py-evm/evm/db/chain.py\", line 58, in get_canonical_head\r\n    raise CanonicalHeadNotFound(\"No canonical head set for this chain\")\r\nevm.exceptions.CanonicalHeadNotFound: No canonical head set for this chain\r\n```\r\n\r\n",
  "closed_by": {
    "login": "pipermerriam",
    "id": 824194,
    "node_id": "MDQ6VXNlcjgyNDE5NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pipermerriam",
    "html_url": "https://github.com/pipermerriam",
    "followers_url": "https://api.github.com/users/pipermerriam/followers",
    "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
    "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
    "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
    "repos_url": "https://api.github.com/users/pipermerriam/repos",
    "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/294/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/py-evm/issues/294/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/359653460",
    "html_url": "https://github.com/ethereum/py-evm/issues/294#issuecomment-359653460",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/294",
    "id": 359653460,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1OTY1MzQ2MA==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-23T02:31:13Z",
    "updated_at": "2018-01-23T02:31:13Z",
    "author_association": "MEMBER",
    "body": "The chaindb format used by geth is not compatible with ours, so this is indeed not expected to work. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/359653460/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/359656818",
    "html_url": "https://github.com/ethereum/py-evm/issues/294#issuecomment-359656818",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/294",
    "id": 359656818,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1OTY1NjgxOA==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-23T02:50:34Z",
    "updated_at": "2018-01-23T02:50:34Z",
    "author_association": "MEMBER",
    "body": "It would be possible for someone to write a DB  backend that used the geth database schema but that's outside of the scope of this project.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/359656818/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/359673258",
    "html_url": "https://github.com/ethereum/py-evm/issues/294#issuecomment-359673258",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/294",
    "id": 359673258,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1OTY3MzI1OA==",
    "user": {
      "login": "step21",
      "id": 46968,
      "node_id": "MDQ6VXNlcjQ2OTY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/46968?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/step21",
      "html_url": "https://github.com/step21",
      "followers_url": "https://api.github.com/users/step21/followers",
      "following_url": "https://api.github.com/users/step21/following{/other_user}",
      "gists_url": "https://api.github.com/users/step21/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/step21/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/step21/subscriptions",
      "organizations_url": "https://api.github.com/users/step21/orgs",
      "repos_url": "https://api.github.com/users/step21/repos",
      "events_url": "https://api.github.com/users/step21/events{/privacy}",
      "received_events_url": "https://api.github.com/users/step21/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-23T04:30:19Z",
    "updated_at": "2018-01-23T04:30:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok thanks for clarifying",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/359673258/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
