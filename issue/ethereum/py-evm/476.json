{
  "url": "https://api.github.com/repos/ethereum/py-evm/issues/476",
  "repository_url": "https://api.github.com/repos/ethereum/py-evm",
  "labels_url": "https://api.github.com/repos/ethereum/py-evm/issues/476/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/py-evm/issues/476/comments",
  "events_url": "https://api.github.com/repos/ethereum/py-evm/issues/476/events",
  "html_url": "https://github.com/ethereum/py-evm/issues/476",
  "id": 306179635,
  "node_id": "MDU6SXNzdWUzMDYxNzk2MzU=",
  "number": 476,
  "title": "Look into using black for automated code formatting",
  "user": {
    "login": "pipermerriam",
    "id": 824194,
    "node_id": "MDQ6VXNlcjgyNDE5NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pipermerriam",
    "html_url": "https://github.com/pipermerriam",
    "followers_url": "https://api.github.com/users/pipermerriam/followers",
    "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
    "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
    "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
    "repos_url": "https://api.github.com/users/pipermerriam/repos",
    "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2018-03-17T18:34:50Z",
  "updated_at": "2018-03-27T22:01:15Z",
  "closed_at": "2018-03-27T22:01:15Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "### What is wrong?\r\n\r\nEnforcing code style is tedious.\r\n\r\n### How can it be fixed\r\n\r\nLook into using https://github.com/ambv/black/",
  "closed_by": {
    "login": "pipermerriam",
    "id": 824194,
    "node_id": "MDQ6VXNlcjgyNDE5NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pipermerriam",
    "html_url": "https://github.com/pipermerriam",
    "followers_url": "https://api.github.com/users/pipermerriam/followers",
    "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
    "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
    "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
    "repos_url": "https://api.github.com/users/pipermerriam/repos",
    "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/476/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/py-evm/issues/476/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/374171513",
    "html_url": "https://github.com/ethereum/py-evm/issues/476#issuecomment-374171513",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/476",
    "id": 374171513,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NDE3MTUxMw==",
    "user": {
      "login": "cburgdorf",
      "id": 521109,
      "node_id": "MDQ6VXNlcjUyMTEwOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/521109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cburgdorf",
      "html_url": "https://github.com/cburgdorf",
      "followers_url": "https://api.github.com/users/cburgdorf/followers",
      "following_url": "https://api.github.com/users/cburgdorf/following{/other_user}",
      "gists_url": "https://api.github.com/users/cburgdorf/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cburgdorf/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cburgdorf/subscriptions",
      "organizations_url": "https://api.github.com/users/cburgdorf/orgs",
      "repos_url": "https://api.github.com/users/cburgdorf/repos",
      "events_url": "https://api.github.com/users/cburgdorf/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cburgdorf/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-19T10:49:02Z",
    "updated_at": "2018-03-19T10:49:02Z",
    "author_association": "MEMBER",
    "body": "I looked into this. I like the idea of enforcing a common style to completely eliminate any debate about formatting. That said `black` is still alpha software so at this point we need to expect that certain formatting rules will still change over time. May not be a huge problem after all, just something to keep in mind. Even though it is alpha state software they do run a safety check by default that ensures that the AST from before the reformatting matches the AST from after the formatting. So at least, it shouldn't break code.\r\n\r\nHowever, the only really configurable rule in `black` is the max-line width (having no options is the main feature after all) which means it is extremely opinionated and may hurt some peoples feelings. I'm absolutely fine to go with `black` if everyone else is fine as well. Just to give you a feel for the changes, here is what running black would do to the code.\r\n\r\nhttps://github.com/cburgdorf/py-evm/commit/d8484e48e15d86e3bf62d2fac4d8ce2af75f34e4\r\n\r\nIf we do decide that we want to introduce black then it may be a good idea to do a bit of coordination among the team. There probably exist some bigger PRs that would have to go through many merge conflicts if they are forced to rebase on top of the reformatted source code.\r\n\r\nSo, in case we decide for using `black` I'd recommend we create a PR that prepares the changes to CI and coordinate to make the actual formatting changes after some other changes landed (if needed).\r\n\r\nI also looked into the spacing rules that [triggered](https://github.com/ethereum/py-evm/pull/459#discussion_r175168638) this discussion. It turns out that the official style guide [favors to use the spaces around the `=` symbol](https://www.python.org/dev/peps/pep-0008/#variable-annotations) in this case. While I haven't found a way to configure `flake8` to enforce this rule `pylint` can enforce to have the spaces around the `=` symbol (but not the opposite!). Also `black` enforces this so that the code in question would be formatted as.\r\n\r\n```python\r\n\r\n    def __init__(\r\n        self,\r\n        shard_id: int,\r\n        expected_period_number: int,\r\n        period_start_prevhash: bytes,\r\n        parent_hash: bytes,\r\n        number: int,\r\n        transaction_root: bytes = EMPTY_SHA3,\r\n        coinbase: bytes = ZERO_ADDRESS,\r\n        state_root: bytes = EMPTY_SHA3,\r\n        receipt_root: bytes = EMPTY_SHA3,\r\n        sig: bytes = b'',\r\n    ) -> None:\r\n        super(CollationHeader, self).__init__(\r\n            shard_id=shard_id,\r\n            expected_period_number=expected_period_number,\r\n            period_start_prevhash=period_start_prevhash,\r\n            parent_hash=parent_hash,\r\n            transaction_root=transaction_root,\r\n            coinbase=coinbase,\r\n            state_root=state_root,\r\n            receipt_root=receipt_root,\r\n            number=number,\r\n        )\r\n```\r\n\r\nNotice that spaces are only used for the `=` sign in the method signature and not for the call site when keywords are passed with values.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/374171513/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/374209912",
    "html_url": "https://github.com/ethereum/py-evm/issues/476#issuecomment-374209912",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/476",
    "id": 374209912,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NDIwOTkxMg==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-19T13:24:12Z",
    "updated_at": "2018-03-19T13:24:12Z",
    "author_association": "MEMBER",
    "body": "Good research.  👍 \r\n\r\n- lets wait on using `black`\r\n- 👍 on following the pep8 guide for spaces around `=`\r\n- waiting a bit more on the `flake8/pylint` issue, but worth opening an issue to track it (do you mind doing this?)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/374209912/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/374214248",
    "html_url": "https://github.com/ethereum/py-evm/issues/476#issuecomment-374214248",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/476",
    "id": 374214248,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NDIxNDI0OA==",
    "user": {
      "login": "cburgdorf",
      "id": 521109,
      "node_id": "MDQ6VXNlcjUyMTEwOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/521109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cburgdorf",
      "html_url": "https://github.com/cburgdorf",
      "followers_url": "https://api.github.com/users/cburgdorf/followers",
      "following_url": "https://api.github.com/users/cburgdorf/following{/other_user}",
      "gists_url": "https://api.github.com/users/cburgdorf/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cburgdorf/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cburgdorf/subscriptions",
      "organizations_url": "https://api.github.com/users/cburgdorf/orgs",
      "repos_url": "https://api.github.com/users/cburgdorf/repos",
      "events_url": "https://api.github.com/users/cburgdorf/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cburgdorf/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-19T13:38:40Z",
    "updated_at": "2018-03-19T13:38:40Z",
    "author_association": "MEMBER",
    "body": "@pipermerriam Created https://github.com/ethereum/py-evm/issues/485",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/374214248/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/374973261",
    "html_url": "https://github.com/ethereum/py-evm/issues/476#issuecomment-374973261",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/476",
    "id": 374973261,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NDk3MzI2MQ==",
    "user": {
      "login": "carver",
      "id": 205327,
      "node_id": "MDQ6VXNlcjIwNTMyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/205327?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/carver",
      "html_url": "https://github.com/carver",
      "followers_url": "https://api.github.com/users/carver/followers",
      "following_url": "https://api.github.com/users/carver/following{/other_user}",
      "gists_url": "https://api.github.com/users/carver/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/carver/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/carver/subscriptions",
      "organizations_url": "https://api.github.com/users/carver/orgs",
      "repos_url": "https://api.github.com/users/carver/repos",
      "events_url": "https://api.github.com/users/carver/events{/privacy}",
      "received_events_url": "https://api.github.com/users/carver/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-21T15:12:58Z",
    "updated_at": "2018-03-21T15:12:58Z",
    "author_association": "MEMBER",
    "body": "> lets wait on using `black`\r\n\r\nProbably just as well, since it's still in alpha.\r\n\r\n---\r\n\r\nYikes! There were in-line comments in between split lines: black joined the lines, and moved the comment down below the joined line. That loss of context could cause significant loss of comment semantics if we don't notice it during the main conversion.\r\n\r\nhttps://github.com/cburgdorf/py-evm/commit/d8484e48e15d86e3bf62d2fac4d8ce2af75f34e4#diff-05178e170e27782a10a1498ec2aefdefL94",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/374973261/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/375013516",
    "html_url": "https://github.com/ethereum/py-evm/issues/476#issuecomment-375013516",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/476",
    "id": 375013516,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NTAxMzUxNg==",
    "user": {
      "login": "cburgdorf",
      "id": 521109,
      "node_id": "MDQ6VXNlcjUyMTEwOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/521109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cburgdorf",
      "html_url": "https://github.com/cburgdorf",
      "followers_url": "https://api.github.com/users/cburgdorf/followers",
      "following_url": "https://api.github.com/users/cburgdorf/following{/other_user}",
      "gists_url": "https://api.github.com/users/cburgdorf/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cburgdorf/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cburgdorf/subscriptions",
      "organizations_url": "https://api.github.com/users/cburgdorf/orgs",
      "repos_url": "https://api.github.com/users/cburgdorf/repos",
      "events_url": "https://api.github.com/users/cburgdorf/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cburgdorf/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-21T16:48:35Z",
    "updated_at": "2018-03-21T16:48:35Z",
    "author_association": "MEMBER",
    "body": "Yeah, that whole part is something where I think one needs to disable the\nformatter entirely because the formatting *really *serves comprehension\nthere.\n\nOn Mar 21, 2018 16:13, \"Jason Carver\" <notifications@github.com> wrote:\n\n> lets wait on using black\n>\n> Probably just as well, since it's still in alpha.\n> ------------------------------\n>\n> Yikes! There were in-line comments in between split lines: black joined\n> the lines, and moved the comment down below the joined line. That loss of\n> context could cause significant loss of comment semantics if we don't\n> notice it during the main conversion.\n>\n> cburgdorf/py-evm@d8484e4#diff-05178e170e27782a10a1498ec2aefdefL94\n> <https://github.com/cburgdorf/py-evm/commit/d8484e48e15d86e3bf62d2fac4d8ce2af75f34e4#diff-05178e170e27782a10a1498ec2aefdefL94>\n>\n> —\n> You are receiving this because you commented.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/ethereum/py-evm/issues/476#issuecomment-374973261>,\n> or mute the thread\n> <https://github.com/notifications/unsubscribe-auth/AAfzlVWTPqlMU97uipRr0ouSWms9OuoFks5tgm3_gaJpZM4Su6gI>\n> .\n>\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/375013516/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
