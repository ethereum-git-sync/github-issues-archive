{
  "url": "https://api.github.com/repos/ethereum/py-evm/issues/1904",
  "repository_url": "https://api.github.com/repos/ethereum/py-evm",
  "labels_url": "https://api.github.com/repos/ethereum/py-evm/issues/1904/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/py-evm/issues/1904/comments",
  "events_url": "https://api.github.com/repos/ethereum/py-evm/issues/1904/events",
  "html_url": "https://github.com/ethereum/py-evm/issues/1904",
  "id": 540566369,
  "node_id": "MDU6SXNzdWU1NDA1NjYzNjk=",
  "number": 1904,
  "title": "Tests in Py-EVM are much slower than in PyEthereum",
  "user": {
    "login": "sdaveas",
    "id": 48155711,
    "node_id": "MDQ6VXNlcjQ4MTU1NzEx",
    "avatar_url": "https://avatars.githubusercontent.com/u/48155711?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sdaveas",
    "html_url": "https://github.com/sdaveas",
    "followers_url": "https://api.github.com/users/sdaveas/followers",
    "following_url": "https://api.github.com/users/sdaveas/following{/other_user}",
    "gists_url": "https://api.github.com/users/sdaveas/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sdaveas/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sdaveas/subscriptions",
    "organizations_url": "https://api.github.com/users/sdaveas/orgs",
    "repos_url": "https://api.github.com/users/sdaveas/repos",
    "events_url": "https://api.github.com/users/sdaveas/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sdaveas/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-12-19T21:06:30Z",
  "updated_at": "2019-12-23T14:22:15Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "* py-evm Version: 0.3.0a9\r\n* OS: linux 5.4.3-arch1-1\r\n* Python Version: 3.8.0\r\n* Environment:\r\n```\r\nattrdict==2.0.1\r\nattrs==19.3.0\r\nbase58==1.0.3\r\nblake2b-py==0.1.3\r\ncached-property==1.5.1\r\ncertifi==2019.11.28\r\nchardet==3.0.4\r\ncytoolz==0.10.1\r\neth-abi==2.0.0\r\neth-account==0.4.0\r\neth-bloom==1.0.3\r\neth-hash==0.2.0\r\neth-keyfile==0.5.1\r\neth-keys==0.2.4\r\neth-rlp==0.1.2\r\neth-tester==0.3.0b1\r\neth-typing==2.2.1\r\neth-utils==1.8.1\r\nhexbytes==0.2.0\r\nidna==2.8\r\nipfshttpclient==0.4.12\r\njsonschema==3.2.0\r\nlru-dict==1.1.6\r\nmultiaddr==0.0.8\r\nmypy-extensions==0.4.3\r\nnetaddr==0.7.19\r\nparsimonious==0.8.1\r\nprotobuf==3.11.1\r\npy-ecc==1.7.1\r\npy-evm==0.3.0a9\r\npy-solc==3.2.0\r\npy-solc-x==0.6.0\r\npycryptodome==3.9.4\r\npyethash==0.1.27\r\npyrsistent==0.15.6\r\npython-bitcoinlib==0.10.2\r\nrequests==2.22.0\r\nrequests-cache==0.5.2\r\nrlp==1.2.0\r\nsemantic-version==2.8.3\r\nsix==1.13.0\r\nsolc==0.0.4\r\ntoolz==0.10.0\r\ntrie==1.4.0\r\nurllib3==1.25.7\r\nvarint==1.0.2\r\nweb3==5.3.0\r\nwebsockets==8.1\r\n```\r\n### What is wrong?\r\nI am running a piece of Solidity code at `PyEthereum` and `Py-EVM` and I observed performance degradation in the case of Py-EVM.\r\n\r\nHere are two representative tests that outline the performance issue: \r\n\r\n#### Test 1 - Storage\r\n\r\n```\r\nfunction test_1() \r\npublic \r\nreturns(bool) \r\n{\r\n    uint[VAR] memory buffer;\r\n    buffer[0] = 1;\r\n    return buffer[0] == 1;\r\n}\r\n```\r\n##### VAR: 10^5\r\n\r\nEnvironment | Time (sec)\r\n-- | --\r\nPyEthereum | 1.498 \r\nPy-EVM | 10.014 \r\n\r\n##### VAR: 10^6\r\n\r\nEnvironment | Time (sec)\r\n-- | --\r\nPyEthereum | 3.901 \r\nPy-EVM | 47.47 \r\n\r\n---\r\n\r\n#### Test 2 - Iteration\r\n\r\n##### Code\r\n\r\n```\r\nfunction benchmark() \r\npublic \r\nreturns(bool) \r\n{\r\n    uint sum=0;\r\n    for (uint i=0; i<VAR; i++) {\r\n        sum+=i;\r\n    }\r\n    return sum < 1<<15;\r\n}\r\n```\r\n##### VAR: 10^4\r\n\r\nEnvironment | Time (sec)\r\n-- | --\r\nPyEthereum | 1.448 \r\nPy-EVM | 14.642 \r\n\r\n##### VAR: 10^5\r\n\r\nEnvironment | Time (sec)\r\n-- | -- \r\nPyEthereum | 2.749\r\nPy-EVM | 144.88\r\n\r\n---\r\n\r\nThe complete code of the tests along with the flamegraphs of the above examples can be found ![here](https://github.com/sdaveas/popow/tree/crosschain-nipopow-v2/experiment/benchmark).\r\nI am aware of #1213 but given that this issue was opened about a year ago, I am wondering if I am losing any improvements?",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/1904/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/py-evm/issues/1904/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/567683067",
    "html_url": "https://github.com/ethereum/py-evm/issues/1904#issuecomment-567683067",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1904",
    "id": 567683067,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NzY4MzA2Nw==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-19T21:25:43Z",
    "updated_at": "2019-12-19T21:25:43Z",
    "author_association": "MEMBER",
    "body": "I'll admit I'm surprised at the degree to which the two differ, but not surprised `Py-EVM` is slower.\r\n\r\nThe modular design of the library incurs non-trivial overhead due to each opcode execution resulting in a new call frame being created.  This is an area that I suspect we'll make some progress on this year once Trinity goes into beta and we can start focusing on finer tuning as opposed to just getting the core functionality in place.\r\n\r\nIf you happen to identify any areas where there are obvious optimizations available we'd be more than happy to look into them.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/567683067/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/567714199",
    "html_url": "https://github.com/ethereum/py-evm/issues/1904#issuecomment-567714199",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1904",
    "id": 567714199,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NzcxNDE5OQ==",
    "user": {
      "login": "sdaveas",
      "id": 48155711,
      "node_id": "MDQ6VXNlcjQ4MTU1NzEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/48155711?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sdaveas",
      "html_url": "https://github.com/sdaveas",
      "followers_url": "https://api.github.com/users/sdaveas/followers",
      "following_url": "https://api.github.com/users/sdaveas/following{/other_user}",
      "gists_url": "https://api.github.com/users/sdaveas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sdaveas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sdaveas/subscriptions",
      "organizations_url": "https://api.github.com/users/sdaveas/orgs",
      "repos_url": "https://api.github.com/users/sdaveas/repos",
      "events_url": "https://api.github.com/users/sdaveas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sdaveas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-19T22:56:35Z",
    "updated_at": "2019-12-19T22:56:35Z",
    "author_association": "NONE",
    "body": "Thanks! I will let you know if anything comes up.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/567714199/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/568488288",
    "html_url": "https://github.com/ethereum/py-evm/issues/1904#issuecomment-568488288",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1904",
    "id": 568488288,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2ODQ4ODI4OA==",
    "user": {
      "login": "gtklocker",
      "id": 732062,
      "node_id": "MDQ6VXNlcjczMjA2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/732062?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gtklocker",
      "html_url": "https://github.com/gtklocker",
      "followers_url": "https://api.github.com/users/gtklocker/followers",
      "following_url": "https://api.github.com/users/gtklocker/following{/other_user}",
      "gists_url": "https://api.github.com/users/gtklocker/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gtklocker/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gtklocker/subscriptions",
      "organizations_url": "https://api.github.com/users/gtklocker/orgs",
      "repos_url": "https://api.github.com/users/gtklocker/repos",
      "events_url": "https://api.github.com/users/gtklocker/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gtklocker/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-23T14:21:30Z",
    "updated_at": "2019-12-23T14:22:15Z",
    "author_association": "NONE",
    "body": "Kinda offtopic: I'm understanding that running computation heavy code is probably not the best use-case for this library. Is there an alternative to the old PyEthereum which is in-memory and fast that can be used nowadays?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/568488288/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
