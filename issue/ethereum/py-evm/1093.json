{
  "url": "https://api.github.com/repos/ethereum/py-evm/issues/1093",
  "repository_url": "https://api.github.com/repos/ethereum/py-evm",
  "labels_url": "https://api.github.com/repos/ethereum/py-evm/issues/1093/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/py-evm/issues/1093/comments",
  "events_url": "https://api.github.com/repos/ethereum/py-evm/issues/1093/events",
  "html_url": "https://github.com/ethereum/py-evm/issues/1093",
  "id": 344598476,
  "node_id": "MDU6SXNzdWUzNDQ1OTg0NzY=",
  "number": 1093,
  "title": "Trinity stops making peer connections during the state sync",
  "user": {
    "login": "pipermerriam",
    "id": 824194,
    "node_id": "MDQ6VXNlcjgyNDE5NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pipermerriam",
    "html_url": "https://github.com/pipermerriam",
    "followers_url": "https://api.github.com/users/pipermerriam/followers",
    "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
    "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
    "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
    "repos_url": "https://api.github.com/users/pipermerriam/repos",
    "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2018-07-25T20:39:08Z",
  "updated_at": "2018-07-31T07:33:01Z",
  "closed_at": "2018-07-31T07:33:01Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "### What is wrong?\r\n\r\nLogs here: https://gist.githubusercontent.com/pipermerriam/f33802d8d8890af3c6c7a128e2745e75/raw/a523c6ea4d02f96ac6f78a559e91453b7f69f065/trinity-fast-sync-log-no-more-peer-connection-attempts.log\r\n\r\nInitially, there are lots of attempts to connect with peers, however, eventually, those logs stop showing up.  Something happened (haven't dug into logs yet) that has caused few or no more attempts to connect with peers to happen.\r\n\r\n### How can it be fixed\r\n\r\nDon't know yet.\r\n",
  "closed_by": {
    "login": "gsalgado",
    "id": 412274,
    "node_id": "MDQ6VXNlcjQxMjI3NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gsalgado",
    "html_url": "https://github.com/gsalgado",
    "followers_url": "https://api.github.com/users/gsalgado/followers",
    "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
    "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
    "organizations_url": "https://api.github.com/users/gsalgado/orgs",
    "repos_url": "https://api.github.com/users/gsalgado/repos",
    "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gsalgado/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/1093/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/py-evm/issues/1093/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/408057942",
    "html_url": "https://github.com/ethereum/py-evm/issues/1093#issuecomment-408057942",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1093",
    "id": 408057942,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwODA1Nzk0Mg==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-26T10:52:32Z",
    "updated_at": "2018-07-26T10:52:32Z",
    "author_association": "MEMBER",
    "body": "```\r\n   ERROR  07-25 14:07:27     service  Unexpected error in <p2p.discovery.DiscoveryService object at 0x7fd8281cc668>, exiting\r\nTraceback (most recent call last):\r\n  File \"/home/piper/projects/py-evm/p2p/service.py\", line 60, in run\r\n    await self._run()\r\n  File \"/home/piper/projects/py-evm/p2p/discovery.py\", line 339, in _run\r\n    await self.maybe_connect_to_more_peers()\r\n  File \"/home/piper/projects/py-evm/p2p/discovery.py\", line 351, in maybe_connect_to_more_peers\r\n    self.proto.get_nodes_to_connect(self.peer_pool.max_peers))\r\n  File \"/home/piper/projects/py-evm/p2p/peer.py\", line 936, in connect_to_nodes\r\n    await self.start_peer(peer)\r\n  File \"/home/piper/projects/py-evm/p2p/peer.py\", line 851, in start_peer\r\n    msgs = await self.ensure_same_side_on_dao_fork(peer)\r\n  File \"/home/piper/projects/py-evm/p2p/peer.py\", line 981, in ensure_same_side_on_dao_fork\r\n    parent, header = headers\r\nValueError: not enough values to unpack (expected 2, got 0)\r\n```\r\n\r\nCould this be a bug introduced in #1063, which treats empty headers response as valid?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/408057942/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/408058549",
    "html_url": "https://github.com/ethereum/py-evm/issues/1093#issuecomment-408058549",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1093",
    "id": 408058549,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwODA1ODU0OQ==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-26T10:55:21Z",
    "updated_at": "2018-07-26T10:55:21Z",
    "author_association": "MEMBER",
    "body": "AFAICT, the above wouldn't have happened if we were still calling `validate_header_response(headers)` as that'd raise a `ValidationError`, which is would simply result in a failed handshake",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/408058549/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/408058828",
    "html_url": "https://github.com/ethereum/py-evm/issues/1093#issuecomment-408058828",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1093",
    "id": 408058828,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwODA1ODgyOA==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-26T10:56:41Z",
    "updated_at": "2018-07-26T10:56:41Z",
    "author_association": "MEMBER",
    "body": "https://github.com/ethereum/py-evm/pull/1063/files#diff-0c5a90ea9349bdb0b8d152d6c4b24583L859",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/408058828/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/408113622",
    "html_url": "https://github.com/ethereum/py-evm/issues/1093#issuecomment-408113622",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1093",
    "id": 408113622,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwODExMzYyMg==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-26T14:20:03Z",
    "updated_at": "2018-07-26T14:20:03Z",
    "author_association": "MEMBER",
    "body": "Looks like an easy fix, we just need to check that the returned headers for the DAO check have length 2 before unpacking them.\r\n\r\nI don't think `validate_header_response` is the right solution here since an empty response is *valid* for a generic `GetBlockHeaders` request, it's just that in this specific case, we require the response to contain all of the results.  I think that we need two validation levels, one for the *objective* question of is it a valid response according to protocol, and then the subjective one of \"does this response work for the reason we requested\".  In this case, a simple `len(headers) == 2` check should suffice.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/408113622/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/408115180",
    "html_url": "https://github.com/ethereum/py-evm/issues/1093#issuecomment-408115180",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1093",
    "id": 408115180,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwODExNTE4MA==",
    "user": {
      "login": "pipermerriam",
      "id": 824194,
      "node_id": "MDQ6VXNlcjgyNDE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/824194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pipermerriam",
      "html_url": "https://github.com/pipermerriam",
      "followers_url": "https://api.github.com/users/pipermerriam/followers",
      "following_url": "https://api.github.com/users/pipermerriam/following{/other_user}",
      "gists_url": "https://api.github.com/users/pipermerriam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pipermerriam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pipermerriam/subscriptions",
      "organizations_url": "https://api.github.com/users/pipermerriam/orgs",
      "repos_url": "https://api.github.com/users/pipermerriam/repos",
      "events_url": "https://api.github.com/users/pipermerriam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pipermerriam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-26T14:24:53Z",
    "updated_at": "2018-07-26T14:24:53Z",
    "author_association": "MEMBER",
    "body": "Hrm, it looks like this actually isn't present on `master`.  I must have been running off of my branch where the call to `validate_header_response` has been removed.\r\n\r\nhttps://github.com/ethereum/py-evm/blob/master/p2p/peer.py#L859",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/408115180/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/408116083",
    "html_url": "https://github.com/ethereum/py-evm/issues/1093#issuecomment-408116083",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1093",
    "id": 408116083,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwODExNjA4Mw==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-26T14:27:43Z",
    "updated_at": "2018-07-26T14:28:32Z",
    "author_association": "MEMBER",
    "body": "> Hrm, it looks like this actually isn't present on master. I must have been running off of my branch where the call to validate_header_response has been removed.\r\n\r\nThat's what I meant in the comments above",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/408116083/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/409124532",
    "html_url": "https://github.com/ethereum/py-evm/issues/1093#issuecomment-409124532",
    "issue_url": "https://api.github.com/repos/ethereum/py-evm/issues/1093",
    "id": 409124532,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwOTEyNDUzMg==",
    "user": {
      "login": "gsalgado",
      "id": 412274,
      "node_id": "MDQ6VXNlcjQxMjI3NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/412274?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gsalgado",
      "html_url": "https://github.com/gsalgado",
      "followers_url": "https://api.github.com/users/gsalgado/followers",
      "following_url": "https://api.github.com/users/gsalgado/following{/other_user}",
      "gists_url": "https://api.github.com/users/gsalgado/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gsalgado/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gsalgado/subscriptions",
      "organizations_url": "https://api.github.com/users/gsalgado/orgs",
      "repos_url": "https://api.github.com/users/gsalgado/repos",
      "events_url": "https://api.github.com/users/gsalgado/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gsalgado/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-31T07:33:01Z",
    "updated_at": "2018-07-31T07:33:01Z",
    "author_association": "MEMBER",
    "body": "Closing as this issue was never present on master",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/py-evm/issues/comments/409124532/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
