{
  "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17",
  "repository_url": "https://api.github.com/repos/ethereum/consensus-spec-tests",
  "labels_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17/comments",
  "events_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17/events",
  "html_url": "https://github.com/ethereum/consensus-spec-tests/issues/17",
  "id": 540288249,
  "node_id": "MDU6SXNzdWU1NDAyODgyNDk=",
  "number": 17,
  "title": "Fork-choice integration test format and example (WIP)",
  "user": {
    "login": "ericsson49",
    "id": 10426192,
    "node_id": "MDQ6VXNlcjEwNDI2MTky",
    "avatar_url": "https://avatars.githubusercontent.com/u/10426192?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ericsson49",
    "html_url": "https://github.com/ericsson49",
    "followers_url": "https://api.github.com/users/ericsson49/followers",
    "following_url": "https://api.github.com/users/ericsson49/following{/other_user}",
    "gists_url": "https://api.github.com/users/ericsson49/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ericsson49/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ericsson49/subscriptions",
    "organizations_url": "https://api.github.com/users/ericsson49/orgs",
    "repos_url": "https://api.github.com/users/ericsson49/repos",
    "events_url": "https://api.github.com/users/ericsson49/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ericsson49/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 15,
  "created_at": "2019-12-19T12:36:58Z",
  "updated_at": "2020-08-03T16:37:32Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "The issue is opened to communicate the initial draft version of the proposed format for fork choice integration-style compatibility test suite.\r\nIt's an early stage work in progress and will change. However, the main idea will stay the same.\r\nIt is to be moved to a GitHub repo at some point, when it's mature enough.\r\n\r\nThere will be common files like spec constants and genesis states, but this is to be defined.\r\nThere is a file for each test case (yaml format currently, but can be SSZ as well).\r\nEach test consists of test steps, each step being either an event (slot, block or attestation) or a condition to verify. There is also an initial state (should be spec constants plus genesis state, however the last one is lengthy, currently only amount of validators is specified in the file.\r\nTest file format:\r\n```\r\n---\r\n# initial state currently generated from initial amount of deposits/validators\r\n# and spec constants (external file)\r\nvalidators: <InitialValidatorsCount>\r\n\r\n# each test is a sequence of four step type: either one of three event kinds or a condition check\r\nsteps:\r\n# new slot event\r\n- !<slot>\r\n  slot: <Slot>\r\n# new block event (\"standard\" block serialization to yaml is used, as in the other tests)\r\n- !<block>\r\n  block: <Block>\r\n# new attestation event (\"standard\" attestation serialization to yaml is used, as in the other tests)\r\n- !<attestation>\r\n  attestation: <Attestation>\r\n# only head test condition currently, but this is the most important\r\n# it means, that the root of the head block at the moment should be equal to the value specified\r\n# other test conditions to be add in future\r\n- !<check>\r\n  checks:\r\n    head: <Root>\r\n```\r\n\r\nA file with several examples attached\r\nStale [integration_tests_on_attestation.zip](https://github.com/ethereum/eth2.0-spec-tests/files/3983523/integration_tests_on_attestation.zip)\r\n\r\nNew version [fork_choice_integration_tests.zip](https://github.com/ethereum/eth2.0-spec-tests/files/4000404/fork_choice_integration_tests.zip)",
  "closed_by": {
    "login": "ericsson49",
    "id": 10426192,
    "node_id": "MDQ6VXNlcjEwNDI2MTky",
    "avatar_url": "https://avatars.githubusercontent.com/u/10426192?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ericsson49",
    "html_url": "https://github.com/ericsson49",
    "followers_url": "https://api.github.com/users/ericsson49/followers",
    "following_url": "https://api.github.com/users/ericsson49/following{/other_user}",
    "gists_url": "https://api.github.com/users/ericsson49/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ericsson49/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ericsson49/subscriptions",
    "organizations_url": "https://api.github.com/users/ericsson49/orgs",
    "repos_url": "https://api.github.com/users/ericsson49/repos",
    "events_url": "https://api.github.com/users/ericsson49/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ericsson49/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/567550432",
    "html_url": "https://github.com/ethereum/consensus-spec-tests/issues/17#issuecomment-567550432",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17",
    "id": 567550432,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NzU1MDQzMg==",
    "user": {
      "login": "ericsson49",
      "id": 10426192,
      "node_id": "MDQ6VXNlcjEwNDI2MTky",
      "avatar_url": "https://avatars.githubusercontent.com/u/10426192?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ericsson49",
      "html_url": "https://github.com/ericsson49",
      "followers_url": "https://api.github.com/users/ericsson49/followers",
      "following_url": "https://api.github.com/users/ericsson49/following{/other_user}",
      "gists_url": "https://api.github.com/users/ericsson49/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ericsson49/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ericsson49/subscriptions",
      "organizations_url": "https://api.github.com/users/ericsson49/orgs",
      "repos_url": "https://api.github.com/users/ericsson49/repos",
      "events_url": "https://api.github.com/users/ericsson49/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ericsson49/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-19T16:00:39Z",
    "updated_at": "2019-12-19T16:00:39Z",
    "author_association": "NONE",
    "body": "The test scenario files are generated by augmenting our current Kotlin fork choice tests, the code is not part of a public repo yet.\r\nI'm currently splitting the tests into `generator` and `executor` parts, so that `generator` produce test cases and `executor` runs them.\r\nI'm also going to add invocation of the executable python spec code, so that \"golden\" answers are produced by the spec. And probably it makes sense to re-write the Kotlin generator code in Python as well.\r\nI will post a link to a repo, when the `generator` part is ready (working on it right now).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/567550432/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/568882880",
    "html_url": "https://github.com/ethereum/consensus-spec-tests/issues/17#issuecomment-568882880",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17",
    "id": 568882880,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2ODg4Mjg4MA==",
    "user": {
      "login": "ericsson49",
      "id": 10426192,
      "node_id": "MDQ6VXNlcjEwNDI2MTky",
      "avatar_url": "https://avatars.githubusercontent.com/u/10426192?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ericsson49",
      "html_url": "https://github.com/ericsson49",
      "followers_url": "https://api.github.com/users/ericsson49/followers",
      "following_url": "https://api.github.com/users/ericsson49/following{/other_user}",
      "gists_url": "https://api.github.com/users/ericsson49/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ericsson49/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ericsson49/subscriptions",
      "organizations_url": "https://api.github.com/users/ericsson49/orgs",
      "repos_url": "https://api.github.com/users/ericsson49/repos",
      "events_url": "https://api.github.com/users/ericsson49/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ericsson49/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-25T10:35:32Z",
    "updated_at": "2019-12-25T10:35:32Z",
    "author_association": "NONE",
    "body": "I've pushed test executor and other test updates. [https://github.com/harmony-dev/beacon-chain-java/tree/tests/fork-choice-integration-tests/qa/src/test/kotlin/qa](https://github.com/harmony-dev/beacon-chain-java/tree/tests/fork-choice-integration-tests/qa/src/test/kotlin/qa)\r\n\r\nThere are two Kotlin files with tests, one for [block](https://github.com/harmony-dev/beacon-chain-java/blob/tests/fork-choice-integration-tests/qa/src/test/kotlin/qa/integration_tests/on_block_tests.kt) tests and another one for [attestations](https://github.com/harmony-dev/beacon-chain-java/blob/tests/fork-choice-integration-tests/qa/src/test/kotlin/qa/integration_tests/on_attestation_tests.kt). They can be run using IDEA.\r\n\r\nWhen run, they will generate yaml test scenario files. Which can be run by [test_executor](https://github.com/harmony-dev/beacon-chain-java/blob/tests/fork-choice-integration-tests/qa/src/test/kotlin/qa/integration_tests/test_executor.kt).\r\n\r\nCurrently, we are using pseudo BLS signature implementation so that tests run faster. There are also other sources of incompatibilities (like file format extra fields), but I am working on fixing them.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/568882880/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/568893201",
    "html_url": "https://github.com/ethereum/consensus-spec-tests/issues/17#issuecomment-568893201",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17",
    "id": 568893201,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2ODg5MzIwMQ==",
    "user": {
      "login": "ericsson49",
      "id": 10426192,
      "node_id": "MDQ6VXNlcjEwNDI2MTky",
      "avatar_url": "https://avatars.githubusercontent.com/u/10426192?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ericsson49",
      "html_url": "https://github.com/ericsson49",
      "followers_url": "https://api.github.com/users/ericsson49/followers",
      "following_url": "https://api.github.com/users/ericsson49/following{/other_user}",
      "gists_url": "https://api.github.com/users/ericsson49/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ericsson49/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ericsson49/subscriptions",
      "organizations_url": "https://api.github.com/users/ericsson49/orgs",
      "repos_url": "https://api.github.com/users/ericsson49/repos",
      "events_url": "https://api.github.com/users/ericsson49/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ericsson49/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-25T12:18:31Z",
    "updated_at": "2019-12-25T12:18:31Z",
    "author_association": "NONE",
    "body": "New test scenarios attached [fork_choice_integration_tests.zip](https://github.com/ethereum/eth2.0-spec-tests/files/4000404/fork_choice_integration_tests.zip)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/568893201/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/611477173",
    "html_url": "https://github.com/ethereum/consensus-spec-tests/issues/17#issuecomment-611477173",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17",
    "id": 611477173,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMTQ3NzE3Mw==",
    "user": {
      "login": "ericsson49",
      "id": 10426192,
      "node_id": "MDQ6VXNlcjEwNDI2MTky",
      "avatar_url": "https://avatars.githubusercontent.com/u/10426192?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ericsson49",
      "html_url": "https://github.com/ericsson49",
      "followers_url": "https://api.github.com/users/ericsson49/followers",
      "following_url": "https://api.github.com/users/ericsson49/following{/other_user}",
      "gists_url": "https://api.github.com/users/ericsson49/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ericsson49/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ericsson49/subscriptions",
      "organizations_url": "https://api.github.com/users/ericsson49/orgs",
      "repos_url": "https://api.github.com/users/ericsson49/repos",
      "events_url": "https://api.github.com/users/ericsson49/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ericsson49/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-09T11:25:53Z",
    "updated_at": "2020-04-09T11:32:16Z",
    "author_association": "NONE",
    "body": "I've finally adapted fork choice tests so that their format is aligned with the existing eth2.0-spec-tests. Tests are for v0.10.1 tag - I have validated them with Teku, which currently supports v0.10.1.\r\nTests are validated against v0.10.1 specification too.\r\nI've put tests [here](https://github.com/harmony-dev/eth2.0-spec-tests/tree/fork_choice_integration_tests/tests/minimal/phase0/fork_choice/integration_tests)\r\n\r\nThere are problems to be resolved yet:\r\n- the main problem that I see with the format is that there are many files and directories created, which is bad for I/O\r\n- another problem is that there is a lot of duplication (e.g. genesis state files)\r\n- some files can be converted to SSZ, however, I believe, initially it's easier to work with yaml (easier to read). After everything is settled down, they can be converted\r\n\r\nHowever, it closely matches the existing tests format, so, it will be easier to adopt.\r\n\r\nIn general, I would propose another format, where parts are assembled into one file. Another idea is to move common test parts to a common directory. Test format becomes more like a graph. However, it will occupy much less disk space and will require less I/O, which is important if many tests are to be generated.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/611477173/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/611751497",
    "html_url": "https://github.com/ethereum/consensus-spec-tests/issues/17#issuecomment-611751497",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17",
    "id": 611751497,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMTc1MTQ5Nw==",
    "user": {
      "login": "protolambda",
      "id": 19571989,
      "node_id": "MDQ6VXNlcjE5NTcxOTg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/19571989?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/protolambda",
      "html_url": "https://github.com/protolambda",
      "followers_url": "https://api.github.com/users/protolambda/followers",
      "following_url": "https://api.github.com/users/protolambda/following{/other_user}",
      "gists_url": "https://api.github.com/users/protolambda/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/protolambda/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/protolambda/subscriptions",
      "organizations_url": "https://api.github.com/users/protolambda/orgs",
      "repos_url": "https://api.github.com/users/protolambda/repos",
      "events_url": "https://api.github.com/users/protolambda/events{/privacy}",
      "received_events_url": "https://api.github.com/users/protolambda/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-09T21:03:46Z",
    "updated_at": "2020-04-09T21:03:46Z",
    "author_association": "MEMBER",
    "body": "@ericsson49 Great, thanks for this work :). \r\n\r\nRegarding the problems:\r\n- file size: agreed, I would like to change the spec tests in general to share parts of state, and reduce total size. Improving this for forkchoice tests would be good to keep it sustainable to add more forkchoice tests.\r\n- Duplication: same thing, we need to rethink the test format\r\n- Yaml to me is a legacy test format. Most clients use SSZ test inputs since it is more performant. I kept the YAML version of inputs around to keep tests readable. But once something like the viewer on simpleserialize.com works well it should be easy for everyone to just only have SSZ.\r\n\r\nIf we want to ship this fast I think it's best to provide states and blocks as `.ssz` as well, so that each client can enjoy the tests. But if you have more time to put into this, we could rethink the testing format to solve the size/duplication issues before releasing the tests.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/611751497/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/612093050",
    "html_url": "https://github.com/ethereum/consensus-spec-tests/issues/17#issuecomment-612093050",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17",
    "id": 612093050,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMjA5MzA1MA==",
    "user": {
      "login": "ericsson49",
      "id": 10426192,
      "node_id": "MDQ6VXNlcjEwNDI2MTky",
      "avatar_url": "https://avatars.githubusercontent.com/u/10426192?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ericsson49",
      "html_url": "https://github.com/ericsson49",
      "followers_url": "https://api.github.com/users/ericsson49/followers",
      "following_url": "https://api.github.com/users/ericsson49/following{/other_user}",
      "gists_url": "https://api.github.com/users/ericsson49/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ericsson49/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ericsson49/subscriptions",
      "organizations_url": "https://api.github.com/users/ericsson49/orgs",
      "repos_url": "https://api.github.com/users/ericsson49/repos",
      "events_url": "https://api.github.com/users/ericsson49/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ericsson49/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-10T15:55:04Z",
    "updated_at": "2020-04-10T15:55:04Z",
    "author_association": "NONE",
    "body": "@protolambda Thanks for the comments!\r\n\r\nI do want to put more time. I want to develop or generate more tests to improve coverage and disk space. Most tests do not require BLS and so can be run pretty fast. So the main problem is disk usage.\r\nI will convert tests to a new format then in near future.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/612093050/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/612116022",
    "html_url": "https://github.com/ethereum/consensus-spec-tests/issues/17#issuecomment-612116022",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17",
    "id": 612116022,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMjExNjAyMg==",
    "user": {
      "login": "ericsson49",
      "id": 10426192,
      "node_id": "MDQ6VXNlcjEwNDI2MTky",
      "avatar_url": "https://avatars.githubusercontent.com/u/10426192?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ericsson49",
      "html_url": "https://github.com/ericsson49",
      "followers_url": "https://api.github.com/users/ericsson49/followers",
      "following_url": "https://api.github.com/users/ericsson49/following{/other_user}",
      "gists_url": "https://api.github.com/users/ericsson49/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ericsson49/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ericsson49/subscriptions",
      "organizations_url": "https://api.github.com/users/ericsson49/orgs",
      "repos_url": "https://api.github.com/users/ericsson49/repos",
      "events_url": "https://api.github.com/users/ericsson49/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ericsson49/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-10T16:47:17Z",
    "updated_at": "2020-04-10T16:47:52Z",
    "author_association": "NONE",
    "body": "@protolambda \r\nI've converted tests to a new format and put in a [new branch](https://github.com/harmony-dev/eth2.0-spec-tests/tree/fork_choice_integration_tests_v2/tests/minimal/phase0/fork_choice/integration_tests).\r\n\r\nTwo main ideas:\r\n- one file with test description per each test case. So a suite is a list of files, instead of a directory.\r\n- keep common tests parts in a common directory, which I call `cache`. A test description contains references to the parts instead of the parts themselves (a path to file currently, i.e. `../cache/block_0.yaml`).\r\n\r\nAt the moment, parts are blocks, states and attestations. But they can be any top-level containers, defined by eth2.0 specs. Sub-parts like AttestationData will be more difficult to handle.\r\n\r\nTest description is a `dict`. For example, for fork choice tests there are following keys:\r\n- `meta` - can contain `bls_setting`, for example\r\n- `genesis`\r\n- `steps` - a list of steps, which are applied sequentially:\r\n  - 'slot', 'block', 'attestation', 'checks'\r\n\r\nAn additional optimization is that `cache` directory can archived and compressed. It saves disc space considerably. Client impelementers can unpack it, if they like or load the whole archive in memory (should probably change archive format to `tar.gz` or `zip`).\r\n\r\nThe link above illustrates the ideas. The storage savings are significant:\r\n- previous format requires about 1.8 Mbytes data for 35 tests. Mostly, because `genesis.yaml` is duplicated\r\n- the new format requires 225Kbytes, where cached files occupies 174Kbytes and 51K tests themselves\r\n- one can compress cache, then it shrinks down to 23-25K\r\n\r\nAs a result, there is about 1.5K data per test on average, plus cached stuff, which is additionally 1K or 5K on average, depending on whether cache is compressed or not.\r\nCache size is likely to grow sublinearly when new tests are added.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/612116022/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/619029838",
    "html_url": "https://github.com/ethereum/consensus-spec-tests/issues/17#issuecomment-619029838",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17",
    "id": 619029838,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxOTAyOTgzOA==",
    "user": {
      "login": "djrtwo",
      "id": 1433595,
      "node_id": "MDQ6VXNlcjE0MzM1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/djrtwo",
      "html_url": "https://github.com/djrtwo",
      "followers_url": "https://api.github.com/users/djrtwo/followers",
      "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
      "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
      "organizations_url": "https://api.github.com/users/djrtwo/orgs",
      "repos_url": "https://api.github.com/users/djrtwo/repos",
      "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/djrtwo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-24T14:03:16Z",
    "updated_at": "2020-04-24T14:03:16Z",
    "author_association": "MEMBER",
    "body": "Are you hand specifying the tests to ensure reuse of the cache or do you have a method to deduplicate given a set of tests?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/619029838/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/619039470",
    "html_url": "https://github.com/ethereum/consensus-spec-tests/issues/17#issuecomment-619039470",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17",
    "id": 619039470,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxOTAzOTQ3MA==",
    "user": {
      "login": "ericsson49",
      "id": 10426192,
      "node_id": "MDQ6VXNlcjEwNDI2MTky",
      "avatar_url": "https://avatars.githubusercontent.com/u/10426192?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ericsson49",
      "html_url": "https://github.com/ericsson49",
      "followers_url": "https://api.github.com/users/ericsson49/followers",
      "following_url": "https://api.github.com/users/ericsson49/following{/other_user}",
      "gists_url": "https://api.github.com/users/ericsson49/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ericsson49/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ericsson49/subscriptions",
      "organizations_url": "https://api.github.com/users/ericsson49/orgs",
      "repos_url": "https://api.github.com/users/ericsson49/repos",
      "events_url": "https://api.github.com/users/ericsson49/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ericsson49/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-24T14:20:05Z",
    "updated_at": "2020-04-24T14:20:05Z",
    "author_association": "NONE",
    "body": "I record events during a test run, and when converting the trace to a file, I'm using a de-dup cache.\r\nIt's not an external procedure currently.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/619039470/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/619341454",
    "html_url": "https://github.com/ethereum/consensus-spec-tests/issues/17#issuecomment-619341454",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17",
    "id": 619341454,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxOTM0MTQ1NA==",
    "user": {
      "login": "ericsson49",
      "id": 10426192,
      "node_id": "MDQ6VXNlcjEwNDI2MTky",
      "avatar_url": "https://avatars.githubusercontent.com/u/10426192?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ericsson49",
      "html_url": "https://github.com/ericsson49",
      "followers_url": "https://api.github.com/users/ericsson49/followers",
      "following_url": "https://api.github.com/users/ericsson49/following{/other_user}",
      "gists_url": "https://api.github.com/users/ericsson49/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ericsson49/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ericsson49/subscriptions",
      "organizations_url": "https://api.github.com/users/ericsson49/orgs",
      "repos_url": "https://api.github.com/users/ericsson49/repos",
      "events_url": "https://api.github.com/users/ericsson49/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ericsson49/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-25T08:20:54Z",
    "updated_at": "2020-04-25T08:20:54Z",
    "author_association": "NONE",
    "body": "In general, I'm thinking about three-four levels of de-duplication:\r\n- test parts level, where a part is a top-level container (BeaconState, SignedBeaconBlock, Attestation, etc)\r\n- in the case of fork choice tests (and network tests, in general), one can re-use test prefixes, i.e. several test cases may start with the same genesis state (I'm re-using genesis state right now) and apply a number of the same block, slot and attestation events in the same order. So, test cases form a forest, in general - a set of trees, encoding common prefixes of test events.\r\n- when generating test cases (which I'm working on currently), it's easy to get duplicate cases - or very similar ones (e.g. having the same structure)\r\n- test cases can be different, but they may be redundant since they testing the same execution paths, i.e. they do not improve target coverage metrics. One can model it with a set of predicates. So, each test case is assigned with a map, indicating which predicates hold for the test case and which not. So, the idea is ti recognize a test case as a duplicate, if we already have a test case covering the same combination of predicates being true/false.\r\n\r\nThe proposed test format solves the first issue. The second one may be interesting, since implementations can cache `Store` instances and thus, avoid, re-applying same sequences again and again.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/619341454/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/630136883",
    "html_url": "https://github.com/ethereum/consensus-spec-tests/issues/17#issuecomment-630136883",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17",
    "id": 630136883,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzMDEzNjg4Mw==",
    "user": {
      "login": "ericsson49",
      "id": 10426192,
      "node_id": "MDQ6VXNlcjEwNDI2MTky",
      "avatar_url": "https://avatars.githubusercontent.com/u/10426192?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ericsson49",
      "html_url": "https://github.com/ericsson49",
      "followers_url": "https://api.github.com/users/ericsson49/followers",
      "following_url": "https://api.github.com/users/ericsson49/following{/other_user}",
      "gists_url": "https://api.github.com/users/ericsson49/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ericsson49/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ericsson49/subscriptions",
      "organizations_url": "https://api.github.com/users/ericsson49/orgs",
      "repos_url": "https://api.github.com/users/ericsson49/repos",
      "events_url": "https://api.github.com/users/ericsson49/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ericsson49/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-18T12:05:31Z",
    "updated_at": "2020-05-18T12:05:31Z",
    "author_association": "NONE",
    "body": "I've generated a version fork choice tests for [v012x](https://github.com/ethereum/eth2.0-specs/tree/v012x) branch and put them [here](https://github.com/harmony-dev/eth2.0-spec-tests/tree/fork_choice_integration_tests_v012x/tests/minimal/phase0/fork_choice/integration_tests).\r\n\r\nCode to generate and to run the tests against `pyspec phase0` are put into the [branch](https://github.com/ericsson49/eth2.0-specs/tree/v012x_fork_choice_tests/tests/generators/fork_choice).\r\n\r\nThe tests currently do not support optional checks. Optional checks may be required, if some client do not buffer early blocks/attestations and just drop them. Currently, the tests assume such messages are buffered and re-inserted when appropriate (e.g. current slot incremented or a referenced block has arrived). Therefore, such checks can be made optional, to support variations in implementations, though I personally believe it's not a good idea.\r\n\r\nMy priority has been to agree on the fork choice test format and release some official fork choice integration tests first.\r\nGenerating lots of tests has not been a priority, since it can be somewhat painful to run and debug fork choice tests. Therefore, it's better to keep the test suite size reasonably small for the beginning.\r\nI can generate more tests, after everything is settled with the initial version.\r\n\r\nTest generation code also does not yet conform to beacon chain test generators rules and guidelines.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/630136883/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/630164940",
    "html_url": "https://github.com/ethereum/consensus-spec-tests/issues/17#issuecomment-630164940",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17",
    "id": 630164940,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzMDE2NDk0MA==",
    "user": {
      "login": "ericsson49",
      "id": 10426192,
      "node_id": "MDQ6VXNlcjEwNDI2MTky",
      "avatar_url": "https://avatars.githubusercontent.com/u/10426192?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ericsson49",
      "html_url": "https://github.com/ericsson49",
      "followers_url": "https://api.github.com/users/ericsson49/followers",
      "following_url": "https://api.github.com/users/ericsson49/following{/other_user}",
      "gists_url": "https://api.github.com/users/ericsson49/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ericsson49/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ericsson49/subscriptions",
      "organizations_url": "https://api.github.com/users/ericsson49/orgs",
      "repos_url": "https://api.github.com/users/ericsson49/repos",
      "events_url": "https://api.github.com/users/ericsson49/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ericsson49/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-18T12:57:13Z",
    "updated_at": "2020-05-18T12:57:13Z",
    "author_association": "NONE",
    "body": "I've created a version of fork choice test format, which allows optional checks, e.g.:\r\n```\r\nblock_in_store:\r\n  value: '0x654dd99167c3b155924aad2a19086a70f89daa2b0cb86effb07a3e0488c5669c'\r\n  optional: false\r\n```\r\ninstead of just\r\n```\r\nblock_in_store: '0x654dd99167c3b155924aad2a19086a70f89daa2b0cb86effb07a3e0488c5669c'\r\n```\r\n\r\nTests are put [here](https://github.com/harmony-dev/eth2.0-spec-tests/tree/fork_choice_integration_tests_v012x_optional_checks/tests/minimal/phase0/fork_choice/integration_tests) and code [here](https://github.com/ericsson49/eth2.0-specs/tree/v012x_fork_choice_tests_optional_checks/tests/generators/fork_choice)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/630164940/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/668112948",
    "html_url": "https://github.com/ethereum/consensus-spec-tests/issues/17#issuecomment-668112948",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17",
    "id": 668112948,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2ODExMjk0OA==",
    "user": {
      "login": "ericsson49",
      "id": 10426192,
      "node_id": "MDQ6VXNlcjEwNDI2MTky",
      "avatar_url": "https://avatars.githubusercontent.com/u/10426192?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ericsson49",
      "html_url": "https://github.com/ericsson49",
      "followers_url": "https://api.github.com/users/ericsson49/followers",
      "following_url": "https://api.github.com/users/ericsson49/following{/other_user}",
      "gists_url": "https://api.github.com/users/ericsson49/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ericsson49/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ericsson49/subscriptions",
      "organizations_url": "https://api.github.com/users/ericsson49/orgs",
      "repos_url": "https://api.github.com/users/ericsson49/repos",
      "events_url": "https://api.github.com/users/ericsson49/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ericsson49/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-03T16:19:29Z",
    "updated_at": "2020-08-03T16:19:29Z",
    "author_association": "NONE",
    "body": "I've updated tests to match [v0.12.2](https://github.com/ethereum/eth2.0-specs/tree/v0.12.2).\r\n\r\nTests are [here](https://github.com/txrx-research/eth2.0-spec-tests/tree/fork_choice_integration_tests_v012_2/tests/minimal/phase0/fork_choice/integration_tests) and [here (optional checks)](https://github.com/txrx-research/eth2.0-spec-tests/tree/fork_choice_integration_tests_v012_2_optional_checks/tests/minimal/phase0/fork_choice/integration_tests).\r\nCode to generate the tests is [here](https://github.com/ericsson49/eth2.0-specs/tree/v012_2_fork_choice_tests/tests/generators/fork_choice) and [here (optional checks)](https://github.com/ericsson49/eth2.0-specs/tree/v012_2_fork_choice_tests_optional_checks/tests/generators/fork_choice).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/668112948/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/668115344",
    "html_url": "https://github.com/ethereum/consensus-spec-tests/issues/17#issuecomment-668115344",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17",
    "id": 668115344,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2ODExNTM0NA==",
    "user": {
      "login": "terencechain",
      "id": 21316537,
      "node_id": "MDQ6VXNlcjIxMzE2NTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/terencechain",
      "html_url": "https://github.com/terencechain",
      "followers_url": "https://api.github.com/users/terencechain/followers",
      "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
      "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
      "organizations_url": "https://api.github.com/users/terencechain/orgs",
      "repos_url": "https://api.github.com/users/terencechain/repos",
      "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/terencechain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-03T16:24:21Z",
    "updated_at": "2020-08-03T16:24:21Z",
    "author_association": "NONE",
    "body": "> I've updated tests to match [v0.12.2](https://github.com/ethereum/eth2.0-specs/tree/v0.12.2).\r\n> \r\n> Tests are [here](https://github.com/txrx-research/eth2.0-spec-tests/tree/fork_choice_integration_tests_v012_2/tests/minimal/phase0/fork_choice/integration_tests) and [here (optional checks)](https://github.com/txrx-research/eth2.0-spec-tests/tree/fork_choice_integration_tests_v012_2_optional_checks/tests/minimal/phase0/fork_choice/integration_tests).\r\n> Code to generate the tests is [here](https://github.com/ericsson49/eth2.0-specs/tree/v012_2_fork_choice_tests/tests/generators/fork_choice) and [here (optional checks)](https://github.com/ericsson49/eth2.0-specs/tree/v012_2_fork_choice_tests_optional_checks/tests/generators/fork_choice).\r\n\r\nThanks! This is great work. Are we planning to merge these into the official eth2.0-spec-tests repo?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/668115344/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/668121686",
    "html_url": "https://github.com/ethereum/consensus-spec-tests/issues/17#issuecomment-668121686",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/17",
    "id": 668121686,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2ODEyMTY4Ng==",
    "user": {
      "login": "ericsson49",
      "id": 10426192,
      "node_id": "MDQ6VXNlcjEwNDI2MTky",
      "avatar_url": "https://avatars.githubusercontent.com/u/10426192?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ericsson49",
      "html_url": "https://github.com/ericsson49",
      "followers_url": "https://api.github.com/users/ericsson49/followers",
      "following_url": "https://api.github.com/users/ericsson49/following{/other_user}",
      "gists_url": "https://api.github.com/users/ericsson49/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ericsson49/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ericsson49/subscriptions",
      "organizations_url": "https://api.github.com/users/ericsson49/orgs",
      "repos_url": "https://api.github.com/users/ericsson49/repos",
      "events_url": "https://api.github.com/users/ericsson49/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ericsson49/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-03T16:37:32Z",
    "updated_at": "2020-08-03T16:37:32Z",
    "author_association": "NONE",
    "body": "> Thanks! This is great work. Are we planning to merge these into the official eth2.0-spec-tests repo?\r\nThanks!\r\nThey were supposed to be merged, but I do not know current EF plans. \r\n@djrtwo could you please clarify?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-spec-tests/issues/comments/668121686/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
