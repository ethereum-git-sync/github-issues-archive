{
  "url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/329",
  "repository_url": "https://api.github.com/repos/ethereum/execution-spec-tests",
  "labels_url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/329/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/329/comments",
  "events_url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/329/events",
  "html_url": "https://github.com/ethereum/execution-spec-tests/issues/329",
  "id": 1937281398,
  "node_id": "I_kwDOIQGLK85zeJF2",
  "number": 329,
  "title": "feat(fw): use pytest nodeids as test names in json fixtures",
  "user": {
    "login": "danceratopz",
    "id": 91727015,
    "node_id": "U_kgDOBXekpw",
    "avatar_url": "https://avatars.githubusercontent.com/u/91727015?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/danceratopz",
    "html_url": "https://github.com/danceratopz",
    "followers_url": "https://api.github.com/users/danceratopz/followers",
    "following_url": "https://api.github.com/users/danceratopz/following{/other_user}",
    "gists_url": "https://api.github.com/users/danceratopz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/danceratopz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/danceratopz/subscriptions",
    "organizations_url": "https://api.github.com/users/danceratopz/orgs",
    "repos_url": "https://api.github.com/users/danceratopz/repos",
    "events_url": "https://api.github.com/users/danceratopz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/danceratopz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 6008520586,
      "node_id": "LA_kwDOIQGLK88AAAABZiK_ig",
      "url": "https://api.github.com/repos/ethereum/execution-spec-tests/labels/scope:pytest",
      "name": "scope:pytest",
      "color": "4F237B",
      "default": false,
      "description": "Scope: Pytest plugins"
    },
    {
      "id": 6008623232,
      "node_id": "LA_kwDOIQGLK88AAAABZiRQgA",
      "url": "https://api.github.com/repos/ethereum/execution-spec-tests/labels/type:feat",
      "name": "type:feat",
      "color": "0e8a16",
      "default": false,
      "description": "type: Feature"
    },
    {
      "id": 6008698715,
      "node_id": "LA_kwDOIQGLK88AAAABZiV3Ww",
      "url": "https://api.github.com/repos/ethereum/execution-spec-tests/labels/scope:fw",
      "name": "scope:fw",
      "color": "30EAF1",
      "default": false,
      "description": "Scope: Framework (evm|tools|forks|pytest)"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-10-11T09:17:11Z",
  "updated_at": "2023-11-02T14:40:25Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "More info in this discussion: https://github.com/ethereum/execution-spec-tests/pull/307#discussion_r1345986884\r\n\r\nThis will also mean removing the `tag` keyword arguments from tests, which is currently appended to the test names. I think we should add tags though, but not as a name, rather as metadata to allow filtering of tests, by opcode for example, something like `tags=(\"create\", \"tstore\", \"tload\", \"reentrancy\")`.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/329/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/329/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/comments/1790668212",
    "html_url": "https://github.com/ethereum/execution-spec-tests/issues/329#issuecomment-1790668212",
    "issue_url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/329",
    "id": 1790668212,
    "node_id": "IC_kwDOIQGLK85qu220",
    "user": {
      "login": "danceratopz",
      "id": 91727015,
      "node_id": "U_kgDOBXekpw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91727015?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/danceratopz",
      "html_url": "https://github.com/danceratopz",
      "followers_url": "https://api.github.com/users/danceratopz/followers",
      "following_url": "https://api.github.com/users/danceratopz/following{/other_user}",
      "gists_url": "https://api.github.com/users/danceratopz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/danceratopz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/danceratopz/subscriptions",
      "organizations_url": "https://api.github.com/users/danceratopz/orgs",
      "repos_url": "https://api.github.com/users/danceratopz/repos",
      "events_url": "https://api.github.com/users/danceratopz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/danceratopz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-02T12:50:42Z",
    "updated_at": "2023-11-02T12:50:42Z",
    "author_association": "MEMBER",
    "body": "Additional observation that supports this change:\r\n\r\nAs of v1.0.6, the test fixture names (the keys in JSON fixture files) only consist of test parameters (and don't include the test function name) which leads to duplicate test IDs (as seen from a client test runner). \r\n\r\nFor example, these tests:\r\n\r\n```\r\nfill --evm-bin=~/code/github/danceratopz/go-ethereum/build/bin/evm --until=Cancun -k no_outer_selfdestruct --collect-only -q\r\n\r\ntests/cancun/eip6780_selfdestruct/test_selfdestruct_revert.py::test_selfdestruct_created_in_same_tx_with_revert[fork=Cancun-no_outer_selfdestruct]\r\ntests/cancun/eip6780_selfdestruct/test_selfdestruct_revert.py::test_selfdestruct_not_created_in_same_tx_with_revert[fork=Cancun-no_outer_selfdestruct]\r\n```\r\n\r\nproduce the following fixtures with identical names:\r\n\r\n```\r\nack no_outer_selfdestruct fixtures\r\n\r\nfixtures/cancun/eip6780_selfdestruct/selfdestruct_revert/selfdestruct_created_in_same_tx_with_revert.json\r\n2:    \"000-fork=Cancun-no_outer_selfdestruct\": {\r\n\r\nfixtures/cancun/eip6780_selfdestruct/selfdestruct_revert/selfdestruct_not_created_in_same_tx_with_revert.json\r\n2:    \"000-fork=Cancun-no_outer_selfdestruct\": {\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/comments/1790668212/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/comments/1790826781",
    "html_url": "https://github.com/ethereum/execution-spec-tests/issues/329#issuecomment-1790826781",
    "issue_url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/329",
    "id": 1790826781,
    "node_id": "IC_kwDOIQGLK85qvdkd",
    "user": {
      "login": "danceratopz",
      "id": 91727015,
      "node_id": "U_kgDOBXekpw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91727015?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/danceratopz",
      "html_url": "https://github.com/danceratopz",
      "followers_url": "https://api.github.com/users/danceratopz/followers",
      "following_url": "https://api.github.com/users/danceratopz/following{/other_user}",
      "gists_url": "https://api.github.com/users/danceratopz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/danceratopz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/danceratopz/subscriptions",
      "organizations_url": "https://api.github.com/users/danceratopz/orgs",
      "repos_url": "https://api.github.com/users/danceratopz/repos",
      "events_url": "https://api.github.com/users/danceratopz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/danceratopz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-02T14:19:21Z",
    "updated_at": "2023-11-02T14:19:21Z",
    "author_association": "MEMBER",
    "body": "Another consideration for the rename is that dotnet fails with \"=\" when filtering via test Name. Although, the [doc](https://learn.microsoft.com/en-us/dotnet/core/testing/selective-unit-tests?pivots=nunit) claims you can escape \"=\", I couldn't get either of the following to work:\r\n\r\n```console\r\ndotnet test src/Nethermind/Ethereum.Blockchain.Pyspec.Test/ -c debug --no-build --no-restore --filter Name~\"000-tests/cancun/eip6780_selfdestruct/test_selfdestruct_revert.py::test_selfdestruct_created_in_same_tx_with_revert[fork=Cancun-no_outer_selfdestruct]\"\r\n\r\ndotnet test src/Nethermind/Ethereum.Blockchain.Pyspec.Test/ -c debug --no-build --no-restore --filter Name~\"000-tests/cancun/eip6780_selfdestruct/test_selfdestruct_revert.py::test_selfdestruct_created_in_same_tx_with_revert[fork\\=Cancun-no_outer_selfdestruct]\"\r\n```\r\n\r\nThis hack using the AND operator works:\r\n\r\n```console\r\ndotnet test src/Nethermind/Ethereum.Blockchain.Pyspec.Test/ -c debug --no-build --no-restore --filter Name~\"000-tests/cancun/eip6780_selfdestruct/test_selfdestruct_revert.py::test_selfdestruct_created_in_same_tx_with_revert[fork&Cancun-no_outer_selfdestruct]\"\r\n# -->\r\nTest run for /home/dtopz/nethermind/src/Nethermind/Ethereum.Blockchain.Pyspec.Test/bin/debug/net7.0/Ethereum.Blockchain.Pyspec.Test.dll (.NETCoreApp,Version=v7.0)\r\nMicrosoft (R) Test Execution Command Line Tool Version 17.4.1+79d56b02b69a582cd90428878a5e9411ab7538f5 (x64)\r\nCopyright (c) Microsoft Corporation.  All rights reserved.\r\n\r\nStarting test execution, please wait...\r\nA total of 1 test files matched the specified pattern.\r\nRunning 000-tests/cancun/eip6780_selfdestruct/test_selfdestruct_revert.py::test_selfdestruct_created_in_same_tx_with_revert[fork=Cancun-no_outer_selfdestruct], Network: [Cancun] at 14:15:34.111680\r\n\r\n\r\nPassed!  - Failed:     0, Passed:     1, Skipped:     0, Total:     1, Duration: 549 ms - Ethereum.Blockchain.Pyspec.Test.dll (net7.0)\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/comments/1790826781/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/comments/1790861352",
    "html_url": "https://github.com/ethereum/execution-spec-tests/issues/329#issuecomment-1790861352",
    "issue_url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/329",
    "id": 1790861352,
    "node_id": "IC_kwDOIQGLK85qvmAo",
    "user": {
      "login": "danceratopz",
      "id": 91727015,
      "node_id": "U_kgDOBXekpw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91727015?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/danceratopz",
      "html_url": "https://github.com/danceratopz",
      "followers_url": "https://api.github.com/users/danceratopz/followers",
      "following_url": "https://api.github.com/users/danceratopz/following{/other_user}",
      "gists_url": "https://api.github.com/users/danceratopz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/danceratopz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/danceratopz/subscriptions",
      "organizations_url": "https://api.github.com/users/danceratopz/orgs",
      "repos_url": "https://api.github.com/users/danceratopz/repos",
      "events_url": "https://api.github.com/users/danceratopz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/danceratopz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-02T14:38:41Z",
    "updated_at": "2023-11-02T14:40:25Z",
    "author_association": "MEMBER",
    "body": "The pytest `-k` flag always had problems with \"=\", too:\r\n```\r\nfill --until=Cancun -k 'test_withdrawing_to_precompiles[fork=Cancun'\r\n```\r\nresults in:\r\n```\r\nERROR: Wrong expression passed to '-k': test_withdrawing_to_precompiles[fork=Cancun: at column 38: unexpected character \"=\"\r\n```\r\nIt doesn't seem possible to esacpe \"=\" in a `-k` expression either.\r\n\r\nI'd suggest replacing \"=\" with \"_\" in our generated parameter strings used in nodeids in L702 here:\r\nhttps://github.com/ethereum/execution-spec-tests/blob/04591fdb5c02b3532f48e2deb11234f428fd2b01/src/pytest_plugins/test_filler/test_filler.py#L697-L702\r\nhttps://github.com/ethereum/execution-spec-tests/blob/main/src/pytest_plugins/test_filler/test_filler.py#L697-L702\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/comments/1790861352/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
