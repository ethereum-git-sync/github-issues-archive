{
  "url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/3",
  "repository_url": "https://api.github.com/repos/ethereum/execution-spec-tests",
  "labels_url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/3/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/3/comments",
  "events_url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/3/events",
  "html_url": "https://github.com/ethereum/execution-spec-tests/issues/3",
  "id": 1433565615,
  "node_id": "I_kwDOIQGLK85Vcnmv",
  "number": 3,
  "title": "Fix the way BlockchainTest and StateTest handle invalid transactions ",
  "user": {
    "login": "marioevz",
    "id": 11726710,
    "node_id": "MDQ6VXNlcjExNzI2NzEw",
    "avatar_url": "https://avatars.githubusercontent.com/u/11726710?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/marioevz",
    "html_url": "https://github.com/marioevz",
    "followers_url": "https://api.github.com/users/marioevz/followers",
    "following_url": "https://api.github.com/users/marioevz/following{/other_user}",
    "gists_url": "https://api.github.com/users/marioevz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/marioevz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/marioevz/subscriptions",
    "organizations_url": "https://api.github.com/users/marioevz/orgs",
    "repos_url": "https://api.github.com/users/marioevz/repos",
    "events_url": "https://api.github.com/users/marioevz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/marioevz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "marioevz",
    "id": 11726710,
    "node_id": "MDQ6VXNlcjExNzI2NzEw",
    "avatar_url": "https://avatars.githubusercontent.com/u/11726710?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/marioevz",
    "html_url": "https://github.com/marioevz",
    "followers_url": "https://api.github.com/users/marioevz/followers",
    "following_url": "https://api.github.com/users/marioevz/following{/other_user}",
    "gists_url": "https://api.github.com/users/marioevz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/marioevz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/marioevz/subscriptions",
    "organizations_url": "https://api.github.com/users/marioevz/orgs",
    "repos_url": "https://api.github.com/users/marioevz/repos",
    "events_url": "https://api.github.com/users/marioevz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/marioevz/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "marioevz",
      "id": 11726710,
      "node_id": "MDQ6VXNlcjExNzI2NzEw",
      "avatar_url": "https://avatars.githubusercontent.com/u/11726710?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marioevz",
      "html_url": "https://github.com/marioevz",
      "followers_url": "https://api.github.com/users/marioevz/followers",
      "following_url": "https://api.github.com/users/marioevz/following{/other_user}",
      "gists_url": "https://api.github.com/users/marioevz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marioevz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marioevz/subscriptions",
      "organizations_url": "https://api.github.com/users/marioevz/orgs",
      "repos_url": "https://api.github.com/users/marioevz/repos",
      "events_url": "https://api.github.com/users/marioevz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marioevz/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-11-02T18:01:31Z",
  "updated_at": "2022-11-04T14:05:58Z",
  "closed_at": "2022-11-04T14:05:58Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Right now with #2, intrinsically invalid transactions (not reverting transactions) are removed from the block before execution.\r\n\r\nWe need to change this behavior to leave the transactions in the block to properly test that blocks with a certain type of invalid transactions are correctly rejected.\r\n\r\nThis affects the way that StateTest operates, as it bundles all transactions into a single block and then compares the cumulative post-state that results from the execution of all transactions in sequence.\r\n\r\nThis means that if we leave invalid transactions in the block, the entire block will be rejected and nothing will be tested.\r\n\r\nWe could solve this issue of two ways.\r\n\r\nAssuming that we have Tx1..TxN within a StateTest, and also each Tx is contained in a separate block, we can have:\r\n\r\na)\r\n```mermaid\r\nflowchart LR;\r\nG --> B1[Tx1];\r\nB1[Tx1] --> B2[Tx2];\r\nB2[Tx2] --> ...;\r\n... --> BN[TxN];\r\n```\r\nWhere each transaction block is on top of the previous transaction.\r\n\r\nb) \r\n```mermaid\r\nflowchart TD;\r\nG --> B1[Tx1];\r\nG --> B1'[Tx2];\r\nG --> ...;\r\nG --> B1'''[TxN];\r\n```\r\nWhere all blocks are at height `G+1`\r\n\r\n(a) makes writing state tests more complicated, because the tester has to account for the previous transactions to calculate the full post-state. With (b), every transaction is isolated and writing the verification post-state is easier (every transaction could have a different verification post-state).",
  "closed_by": {
    "login": "lightclient",
    "id": 14004106,
    "node_id": "MDQ6VXNlcjE0MDA0MTA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/14004106?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lightclient",
    "html_url": "https://github.com/lightclient",
    "followers_url": "https://api.github.com/users/lightclient/followers",
    "following_url": "https://api.github.com/users/lightclient/following{/other_user}",
    "gists_url": "https://api.github.com/users/lightclient/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lightclient/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lightclient/subscriptions",
    "organizations_url": "https://api.github.com/users/lightclient/orgs",
    "repos_url": "https://api.github.com/users/lightclient/repos",
    "events_url": "https://api.github.com/users/lightclient/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lightclient/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/3/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/3/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/comments/1301256376",
    "html_url": "https://github.com/ethereum/execution-spec-tests/issues/3#issuecomment-1301256376",
    "issue_url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/3",
    "id": 1301256376,
    "node_id": "IC_kwDOIQGLK85Nj5i4",
    "user": {
      "login": "lightclient",
      "id": 14004106,
      "node_id": "MDQ6VXNlcjE0MDA0MTA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14004106?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lightclient",
      "html_url": "https://github.com/lightclient",
      "followers_url": "https://api.github.com/users/lightclient/followers",
      "following_url": "https://api.github.com/users/lightclient/following{/other_user}",
      "gists_url": "https://api.github.com/users/lightclient/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lightclient/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lightclient/subscriptions",
      "organizations_url": "https://api.github.com/users/lightclient/orgs",
      "repos_url": "https://api.github.com/users/lightclient/repos",
      "events_url": "https://api.github.com/users/lightclient/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lightclient/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-02T21:05:31Z",
    "updated_at": "2022-11-02T21:05:31Z",
    "author_association": "MEMBER",
    "body": "So you're proposing we either a) verify the aggregate of all the txs at the end of the block or b) verify the result of each tx? IUC, a) is the current status quo?\r\n\r\nI think I prefer a) because b) is a strict subset of a) where each tx is just a block.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/comments/1301256376/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/comments/1302409022",
    "html_url": "https://github.com/ethereum/execution-spec-tests/issues/3#issuecomment-1302409022",
    "issue_url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/3",
    "id": 1302409022,
    "node_id": "IC_kwDOIQGLK85NoS8-",
    "user": {
      "login": "marioevz",
      "id": 11726710,
      "node_id": "MDQ6VXNlcjExNzI2NzEw",
      "avatar_url": "https://avatars.githubusercontent.com/u/11726710?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marioevz",
      "html_url": "https://github.com/marioevz",
      "followers_url": "https://api.github.com/users/marioevz/followers",
      "following_url": "https://api.github.com/users/marioevz/following{/other_user}",
      "gists_url": "https://api.github.com/users/marioevz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marioevz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marioevz/subscriptions",
      "organizations_url": "https://api.github.com/users/marioevz/orgs",
      "repos_url": "https://api.github.com/users/marioevz/repos",
      "events_url": "https://api.github.com/users/marioevz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marioevz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-03T17:01:28Z",
    "updated_at": "2022-11-03T17:01:28Z",
    "author_association": "MEMBER",
    "body": "Yes, a) is more similar to the status quo.\r\n\r\nThe only problem I see with a) is that if someone wants to design a test with a specific environment, for example, I want to test `BASEFEE`, and I set my environment with `currentBaseFee=123`, then want to check the opcode result on different transactions, if we have a separate block per transaction, the base fee would in reality be dropping each block, so this could potentially be very confusing.\r\n\r\nI don't like b) that much either. Having to specify a different `post` per transaction might also get confusing.\r\n\r\nAnother option could be to keep all transactions in a single block as is right now but not allow invalid transactions in `StateTest`, and if you want to design a test with invalid transactions, do a `BlockchainTest` and explicitly check for the rejected block, and `StateTest` could still allow transactions that revert.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/execution-spec-tests/issues/comments/1302409022/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
