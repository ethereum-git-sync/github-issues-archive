{
  "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/611",
  "repository_url": "https://api.github.com/repos/ethereum/consensus-specs",
  "labels_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/611/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/611/comments",
  "events_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/611/events",
  "html_url": "https://github.com/ethereum/consensus-specs/issues/611",
  "id": 409248880,
  "node_id": "MDU6SXNzdWU0MDkyNDg4ODA=",
  "number": 611,
  "title": "Finalization rule 3 is unreachable",
  "user": {
    "login": "ChihChengLiang",
    "id": 3391420,
    "node_id": "MDQ6VXNlcjMzOTE0MjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3391420?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ChihChengLiang",
    "html_url": "https://github.com/ChihChengLiang",
    "followers_url": "https://api.github.com/users/ChihChengLiang/followers",
    "following_url": "https://api.github.com/users/ChihChengLiang/following{/other_user}",
    "gists_url": "https://api.github.com/users/ChihChengLiang/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ChihChengLiang/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ChihChengLiang/subscriptions",
    "organizations_url": "https://api.github.com/users/ChihChengLiang/orgs",
    "repos_url": "https://api.github.com/users/ChihChengLiang/repos",
    "events_url": "https://api.github.com/users/ChihChengLiang/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ChihChengLiang/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1063043866,
      "node_id": "MDU6TGFiZWwxMDYzMDQzODY2",
      "url": "https://api.github.com/repos/ethereum/consensus-specs/labels/general:bug",
      "name": "general:bug",
      "color": "DD1C1A",
      "default": false,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 10,
  "created_at": "2019-02-12T11:22:00Z",
  "updated_at": "2019-04-20T19:18:49Z",
  "closed_at": "2019-02-14T16:05:49Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "It's impossible to have 0b111 without triggering Rule 2. Observe the bit position of `previous_epoch - 1`, \r\n1. Get left 1 justified\r\n2. In the next epoch the position become previous_justified.\r\n3. In the epoch to trigger rule 3, it trigger rule 2 first.\r\n\r\n\r\n```\r\n  j\r\n0b10\r\n  p\r\n  j\r\n0b111\r\n```\r\n\r\nRule 2: Set `state.finalized_epoch = state.previous_justified_epoch` if `(state.justification_bitfield >> 1) % 4 == 0b11 and state.previous_justified_epoch == previous_epoch - 1`.\r\nRule 3: Set `state.finalized_epoch = state.justified_epoch` if `(state.justification_bitfield >> 0) % 8 == 0b111 and state.justified_epoch == previous_epoch - 1`.\r\n\r\nRelated: \r\n- https://github.com/ethereum/trinity/pull/264/files#r255382122 \r\n- https://github.com/ethereum/eth2.0-specs/issues/410\r\n\r\n",
  "closed_by": {
    "login": "ChihChengLiang",
    "id": 3391420,
    "node_id": "MDQ6VXNlcjMzOTE0MjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3391420?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ChihChengLiang",
    "html_url": "https://github.com/ChihChengLiang",
    "followers_url": "https://api.github.com/users/ChihChengLiang/followers",
    "following_url": "https://api.github.com/users/ChihChengLiang/following{/other_user}",
    "gists_url": "https://api.github.com/users/ChihChengLiang/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ChihChengLiang/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ChihChengLiang/subscriptions",
    "organizations_url": "https://api.github.com/users/ChihChengLiang/orgs",
    "repos_url": "https://api.github.com/users/ChihChengLiang/repos",
    "events_url": "https://api.github.com/users/ChihChengLiang/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ChihChengLiang/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/611/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/611/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/462722906",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/611#issuecomment-462722906",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/611",
    "id": 462722906,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MjcyMjkwNg==",
    "user": {
      "login": "ChihChengLiang",
      "id": 3391420,
      "node_id": "MDQ6VXNlcjMzOTE0MjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3391420?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ChihChengLiang",
      "html_url": "https://github.com/ChihChengLiang",
      "followers_url": "https://api.github.com/users/ChihChengLiang/followers",
      "following_url": "https://api.github.com/users/ChihChengLiang/following{/other_user}",
      "gists_url": "https://api.github.com/users/ChihChengLiang/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ChihChengLiang/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ChihChengLiang/subscriptions",
      "organizations_url": "https://api.github.com/users/ChihChengLiang/orgs",
      "repos_url": "https://api.github.com/users/ChihChengLiang/repos",
      "events_url": "https://api.github.com/users/ChihChengLiang/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ChihChengLiang/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-12T11:25:04Z",
    "updated_at": "2019-02-12T11:25:04Z",
    "author_association": "MEMBER",
    "body": "Rule 1 might also have some issue, it can only finalize the epoch that was already finalized by Rule 2.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/462722906/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/463464351",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/611#issuecomment-463464351",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/611",
    "id": 463464351,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MzQ2NDM1MQ==",
    "user": {
      "login": "vbuterin",
      "id": 2230894,
      "node_id": "MDQ6VXNlcjIyMzA4OTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2230894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vbuterin",
      "html_url": "https://github.com/vbuterin",
      "followers_url": "https://api.github.com/users/vbuterin/followers",
      "following_url": "https://api.github.com/users/vbuterin/following{/other_user}",
      "gists_url": "https://api.github.com/users/vbuterin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vbuterin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vbuterin/subscriptions",
      "organizations_url": "https://api.github.com/users/vbuterin/orgs",
      "repos_url": "https://api.github.com/users/vbuterin/repos",
      "events_url": "https://api.github.com/users/vbuterin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vbuterin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-14T02:43:41Z",
    "updated_at": "2019-02-14T02:43:41Z",
    "author_association": "MEMBER",
    "body": "Suppose that at the end of epoch N+2, epoch N+1 is justified but epoch N+2 is not. Then, at the end of epoch N+3, epochs N+1, N+2 and N+3 are all justified, because of messages that were not yet included in the chain before.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/463464351/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/463469920",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/611#issuecomment-463469920",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/611",
    "id": 463469920,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MzQ2OTkyMA==",
    "user": {
      "login": "ChihChengLiang",
      "id": 3391420,
      "node_id": "MDQ6VXNlcjMzOTE0MjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3391420?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ChihChengLiang",
      "html_url": "https://github.com/ChihChengLiang",
      "followers_url": "https://api.github.com/users/ChihChengLiang/followers",
      "following_url": "https://api.github.com/users/ChihChengLiang/following{/other_user}",
      "gists_url": "https://api.github.com/users/ChihChengLiang/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ChihChengLiang/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ChihChengLiang/subscriptions",
      "organizations_url": "https://api.github.com/users/ChihChengLiang/orgs",
      "repos_url": "https://api.github.com/users/ChihChengLiang/repos",
      "events_url": "https://api.github.com/users/ChihChengLiang/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ChihChengLiang/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-14T03:10:17Z",
    "updated_at": "2019-02-14T03:10:17Z",
    "author_association": "MEMBER",
    "body": "That case will trigger rule 2 before 3. because N+1 is now previous justified epoch and the bitfield in rule 3 is a special case of the bitfield in rule 2",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/463469920/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/463612892",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/611#issuecomment-463612892",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/611",
    "id": 463612892,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MzYxMjg5Mg==",
    "user": {
      "login": "vbuterin",
      "id": 2230894,
      "node_id": "MDQ6VXNlcjIyMzA4OTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2230894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vbuterin",
      "html_url": "https://github.com/vbuterin",
      "followers_url": "https://api.github.com/users/vbuterin/followers",
      "following_url": "https://api.github.com/users/vbuterin/following{/other_user}",
      "gists_url": "https://api.github.com/users/vbuterin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vbuterin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vbuterin/subscriptions",
      "organizations_url": "https://api.github.com/users/vbuterin/orgs",
      "repos_url": "https://api.github.com/users/vbuterin/repos",
      "events_url": "https://api.github.com/users/vbuterin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vbuterin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-14T12:40:57Z",
    "updated_at": "2019-02-14T12:40:57Z",
    "author_association": "MEMBER",
    "body": "Ok, try this:\r\n\r\n* In epoch N+1, JE is N, prev JE is N-1, and not enough messages get in to do anything\r\n* In epoch N+2, JE is N, prev JE is N, and enough messages _from the previous epoch_ get in to justify N+1. N+1 now becomes the JE. Not enough messages from epoch N+2 itself get in to justify N+2.\r\n* In epoch N+3, LJE is N+1, prev LJE is N, and enough messages get in to justify epochs N+2 *and* N+3.\r\n\r\nRule (2) does not get triggered because prev LJE is NOT previous_epoch - 1, but rule (3) does get triggered because LJE is previous_epoch - 1, the previous epoch is justified, and the current epoch is justified.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/463612892/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/463684706",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/611#issuecomment-463684706",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/611",
    "id": 463684706,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MzY4NDcwNg==",
    "user": {
      "login": "ChihChengLiang",
      "id": 3391420,
      "node_id": "MDQ6VXNlcjMzOTE0MjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3391420?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ChihChengLiang",
      "html_url": "https://github.com/ChihChengLiang",
      "followers_url": "https://api.github.com/users/ChihChengLiang/followers",
      "following_url": "https://api.github.com/users/ChihChengLiang/following{/other_user}",
      "gists_url": "https://api.github.com/users/ChihChengLiang/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ChihChengLiang/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ChihChengLiang/subscriptions",
      "organizations_url": "https://api.github.com/users/ChihChengLiang/orgs",
      "repos_url": "https://api.github.com/users/ChihChengLiang/repos",
      "events_url": "https://api.github.com/users/ChihChengLiang/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ChihChengLiang/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-14T16:05:49Z",
    "updated_at": "2019-02-14T16:07:35Z",
    "author_association": "MEMBER",
    "body": "Alright, finally find the problem. Some case could trigger two rules at the same time.\r\n\r\nI made a wrong assumption and implement the spec wrong. The wrong implementation returns the finalized epoch when a rule is triggered, while in the correct one every rule must be checked.\r\n\r\nA simulation in Trinity shows that:\r\n\r\n- In epoch N+2, Rule 2 would finalize N.\r\n- In epoch N+3, Rule 1 would first finalize N again, then Rule 3 finalize N+1.\r\n\r\nA quick look into the different codebases.\r\n\r\n- Prysm has the same style as my implementation, need a head up for this bug. cc @terenc3t.\r\n- The Lighthouse is safe, cc @paulhauner.\r\n\r\nThank you v for the example ❤️ ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/463684706/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 2,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/463840569",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/611#issuecomment-463840569",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/611",
    "id": 463840569,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2Mzg0MDU2OQ==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-14T23:11:57Z",
    "updated_at": "2019-02-14T23:11:57Z",
    "author_association": "MEMBER",
    "body": "Thanks @hwwhww :)\r\n\r\nI've drew up some diagrams a while ago and noticed the same thing about double-execution.\r\n\r\nSomething that I haven't quite got my head across is why rules #1,3 require there to be two justified epochs following the finalized epoch, whilst #2,4 only require one.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/463840569/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/463896109",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/611#issuecomment-463896109",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/611",
    "id": 463896109,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2Mzg5NjEwOQ==",
    "user": {
      "login": "vbuterin",
      "id": 2230894,
      "node_id": "MDQ6VXNlcjIyMzA4OTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2230894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vbuterin",
      "html_url": "https://github.com/vbuterin",
      "followers_url": "https://api.github.com/users/vbuterin/followers",
      "following_url": "https://api.github.com/users/vbuterin/following{/other_user}",
      "gists_url": "https://api.github.com/users/vbuterin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vbuterin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vbuterin/subscriptions",
      "organizations_url": "https://api.github.com/users/vbuterin/orgs",
      "repos_url": "https://api.github.com/users/vbuterin/repos",
      "events_url": "https://api.github.com/users/vbuterin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vbuterin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-15T03:49:38Z",
    "updated_at": "2019-02-15T03:49:38Z",
    "author_association": "MEMBER",
    "body": "The meta-rule behind all four rules is that if there are two epochs `B[1]` and `B[n]`, where both are justified and `B[n]` was justified using `B[1]` as a source, and all intermediate epochs `B[2] ... B[n-1]` are all also justified (no matter what source), then `B[1]` can be finalized. \r\n\r\nRules 1 and 3 cover the n=3 case (the difference between the two is that rule 1 assumes that the _current epoch_ is n+1, and rule 3 assumes it's n),and rules 2 and 4 cover the n=2 case.\r\n\r\nThe reason why any rule except rule 4 (the only rule in the original FFG paper) is necessary is to cover the possibility that it takes an entire epoch for attestations to get included in the chain, and so epoch 1 can't get justified until the chain has already moved on to epoch 2.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/463896109/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/483827810",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/611#issuecomment-483827810",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/611",
    "id": 483827810,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MzgyNzgxMA==",
    "user": {
      "login": "dankrad",
      "id": 6130607,
      "node_id": "MDQ6VXNlcjYxMzA2MDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6130607?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dankrad",
      "html_url": "https://github.com/dankrad",
      "followers_url": "https://api.github.com/users/dankrad/followers",
      "following_url": "https://api.github.com/users/dankrad/following{/other_user}",
      "gists_url": "https://api.github.com/users/dankrad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dankrad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dankrad/subscriptions",
      "organizations_url": "https://api.github.com/users/dankrad/orgs",
      "repos_url": "https://api.github.com/users/dankrad/repos",
      "events_url": "https://api.github.com/users/dankrad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dankrad/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-16T20:19:25Z",
    "updated_at": "2019-04-16T20:19:25Z",
    "author_association": "MEMBER",
    "body": "> The meta-rule behind all four rules is that if there are two epochs `B[1]` and `B[n]`, where both are justified and `B[n]` was justified using `B[1]` as a source, and all intermediate epochs `B[2] ... B[n-1]` are all also justified (no matter what source), then `B[1]` can be finalized.\r\n> \r\n> Rules 1 and 3 cover the n=3 case (the difference between the two is that rule 1 assumes that the _current epoch_ is n+1, and rule 3 assumes it's n),and rules 2 and 4 cover the n=2 case.\r\n> \r\n> The reason why any rule except rule 4 (the only rule in the original FFG paper) is necessary is to cover the possibility that it takes an entire epoch for attestations to get included in the chain, and so epoch 1 can't get justified until the chain has already moved on to epoch 2.\r\n\r\nSo my understanding of the FFG paper was that justification can happen to any past epoch as well. But we only allow attestations to the current and previous epoch. So I guess that is why we have those two cases, whereas I would have expected that we need to check all past epochs for justification/finalisation?\r\nIs there a description of the exact consensus algorithm that is used?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/483827810/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/485133207",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/611#issuecomment-485133207",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/611",
    "id": 485133207,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4NTEzMzIwNw==",
    "user": {
      "login": "djrtwo",
      "id": 1433595,
      "node_id": "MDQ6VXNlcjE0MzM1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/djrtwo",
      "html_url": "https://github.com/djrtwo",
      "followers_url": "https://api.github.com/users/djrtwo/followers",
      "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
      "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
      "organizations_url": "https://api.github.com/users/djrtwo/orgs",
      "repos_url": "https://api.github.com/users/djrtwo/repos",
      "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/djrtwo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-20T14:49:03Z",
    "updated_at": "2019-04-20T14:49:03Z",
    "author_association": "MEMBER",
    "body": "We have these limited cases because of a few reasons:\r\n\r\n* We only allow attestations from previous and current epoch to be included on chain\r\n* We only allow attestations with the expected justified epoch wrt the state at the time of attestation to be included on chain\r\n* We eagerly try to process the current epoch attestations even though not all slot attestations have been given an entire epoch to be included\r\n\r\nThe combination of these three attributes create the 4 possible cases possible to satisfy the general rule described here https://github.com/ethereum/eth2.0-specs/issues/611#issuecomment-463896109\r\n\r\nIf we allowed 3 epochs of inclusions rather than two, we would need to cover the n=4 case (or change the state a bit to handle things more generally).\r\n\r\nThere is a WIP academic paper describing this more general purpose finality rule and it's instantiation in a PoS chain similar to our beacon chain. Will share when there's a draft ready",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/485133207/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/485153711",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/611#issuecomment-485153711",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/611",
    "id": 485153711,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4NTE1MzcxMQ==",
    "user": {
      "login": "dankrad",
      "id": 6130607,
      "node_id": "MDQ6VXNlcjYxMzA2MDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6130607?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dankrad",
      "html_url": "https://github.com/dankrad",
      "followers_url": "https://api.github.com/users/dankrad/followers",
      "following_url": "https://api.github.com/users/dankrad/following{/other_user}",
      "gists_url": "https://api.github.com/users/dankrad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dankrad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dankrad/subscriptions",
      "organizations_url": "https://api.github.com/users/dankrad/orgs",
      "repos_url": "https://api.github.com/users/dankrad/repos",
      "events_url": "https://api.github.com/users/dankrad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dankrad/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-20T19:18:49Z",
    "updated_at": "2019-04-20T19:18:49Z",
    "author_association": "MEMBER",
    "body": "OK, thanks :) This helps me understand what's going on.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/485153711/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
