{
  "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/405",
  "repository_url": "https://api.github.com/repos/ethereum/consensus-specs",
  "labels_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/405/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/405/comments",
  "events_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/405/events",
  "html_url": "https://github.com/ethereum/consensus-specs/issues/405",
  "id": 396615941,
  "node_id": "MDU6SXNzdWUzOTY2MTU5NDE=",
  "number": 405,
  "title": "non-determinism in shuffling from `SEED_LOOKAHEAD` ",
  "user": {
    "login": "djrtwo",
    "id": 1433595,
    "node_id": "MDQ6VXNlcjE0MzM1OTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/djrtwo",
    "html_url": "https://github.com/djrtwo",
    "followers_url": "https://api.github.com/users/djrtwo/followers",
    "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
    "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
    "organizations_url": "https://api.github.com/users/djrtwo/orgs",
    "repos_url": "https://api.github.com/users/djrtwo/repos",
    "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/djrtwo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1063043866,
      "node_id": "MDU6TGFiZWwxMDYzMDQzODY2",
      "url": "https://api.github.com/repos/ethereum/consensus-specs/labels/general:bug",
      "name": "general:bug",
      "color": "DD1C1A",
      "default": false,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-01-07T19:22:28Z",
  "updated_at": "2019-01-08T15:38:15Z",
  "closed_at": "2019-01-08T15:38:15Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "# Issue\r\nshufflings are calculated using a seed from `SEED_LOOKAHEAD` slots ago\r\n\r\n```python\r\nget_shuffling(state.latest_randao_mixes[(state.slot - SEED_LOOKAHEAD) % LATEST_RANDAO_MIXES_LENGTH], state.validator_registry, next_start_shard, state.slot)\r\n```\r\n\r\nThe spec uses `SEED_LOOKAHEAD` for two reasons:\r\n1. to provide more stability in the seed when used. The deeper in the chain the seed is picked from, the more likely there is consensus on the seed when used.\r\n2. to provide lookahead on validator `shard_committee` shuffling so that the validator knows `SEED_LOOKAHEAD` slots in advance what shard they are going to have to crosslink and get get prepared.\r\n\r\n(2) is broken as is. The call to `get_shuffling` utilizes a seed from the past but uses the active validators from present (because passes in `state.slot`).\r\n\r\n# Proposed solution\r\nOne solution is to use the active_validators from `state.slot - SEEDLOOKAHEAD` slots ago to get the shard_committees rather than `state.slot`. This would ensure that committees are known `SEED_LOOKAHEAD` slots in advance, and this works fine as long as `SEED_LOOKAHEAD < ENTRY_EXIT_DELAY` (which it currently is).\r\n\r\n",
  "closed_by": {
    "login": "djrtwo",
    "id": 1433595,
    "node_id": "MDQ6VXNlcjE0MzM1OTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/djrtwo",
    "html_url": "https://github.com/djrtwo",
    "followers_url": "https://api.github.com/users/djrtwo/followers",
    "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
    "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
    "organizations_url": "https://api.github.com/users/djrtwo/orgs",
    "repos_url": "https://api.github.com/users/djrtwo/repos",
    "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/djrtwo/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/405/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/405/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/452137301",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/405#issuecomment-452137301",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/405",
    "id": 452137301,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MjEzNzMwMQ==",
    "user": {
      "login": "vbuterin",
      "id": 2230894,
      "node_id": "MDQ6VXNlcjIyMzA4OTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2230894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vbuterin",
      "html_url": "https://github.com/vbuterin",
      "followers_url": "https://api.github.com/users/vbuterin/followers",
      "following_url": "https://api.github.com/users/vbuterin/following{/other_user}",
      "gists_url": "https://api.github.com/users/vbuterin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vbuterin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vbuterin/subscriptions",
      "organizations_url": "https://api.github.com/users/vbuterin/orgs",
      "repos_url": "https://api.github.com/users/vbuterin/repos",
      "events_url": "https://api.github.com/users/vbuterin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vbuterin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-08T01:00:53Z",
    "updated_at": "2019-01-08T01:00:53Z",
    "author_association": "MEMBER",
    "body": "I believe the idea is that `active_validators` should itself be predictable ENTRY_EXIT_DELAY slots in the future because all entry and exit events are delayed by ENTRY_EXIT_DELAY slots.\r\n\r\nAm I missing some reason why this is not sufficient?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/452137301/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/452139035",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/405#issuecomment-452139035",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/405",
    "id": 452139035,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MjEzOTAzNQ==",
    "user": {
      "login": "djrtwo",
      "id": 1433595,
      "node_id": "MDQ6VXNlcjE0MzM1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/djrtwo",
      "html_url": "https://github.com/djrtwo",
      "followers_url": "https://api.github.com/users/djrtwo/followers",
      "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
      "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
      "organizations_url": "https://api.github.com/users/djrtwo/orgs",
      "repos_url": "https://api.github.com/users/djrtwo/repos",
      "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/djrtwo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-08T01:11:05Z",
    "updated_at": "2019-01-08T15:38:01Z",
    "author_association": "MEMBER",
    "body": "EDIT: You're right. We can predict the `active_validators` `ENTRY_EXIT_DELAY` slots in the future. To ensure that the point at which we get the seed (`SEED_LOOKAHEAD` slots in the past) is a safe point of prediction, `ENTRY_EXIT_DELAY <= SEED_LOOKAHEAD`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/452139035/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/452342863",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/405#issuecomment-452342863",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/405",
    "id": 452342863,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MjM0Mjg2Mw==",
    "user": {
      "login": "djrtwo",
      "id": 1433595,
      "node_id": "MDQ6VXNlcjE0MzM1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/djrtwo",
      "html_url": "https://github.com/djrtwo",
      "followers_url": "https://api.github.com/users/djrtwo/followers",
      "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
      "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
      "organizations_url": "https://api.github.com/users/djrtwo/orgs",
      "repos_url": "https://api.github.com/users/djrtwo/repos",
      "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/djrtwo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-08T15:38:15Z",
    "updated_at": "2019-01-08T15:38:15Z",
    "author_association": "MEMBER",
    "body": "closing in favor of #407",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/452342863/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
