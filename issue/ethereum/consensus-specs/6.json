{
  "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/6",
  "repository_url": "https://api.github.com/repos/ethereum/consensus-specs",
  "labels_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/6/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/6/comments",
  "events_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/6/events",
  "html_url": "https://github.com/ethereum/consensus-specs/issues/6",
  "id": 362875972,
  "node_id": "MDU6SXNzdWUzNjI4NzU5NzI=",
  "number": 6,
  "title": "Separate Single Attestation into its Own Wire Format ",
  "user": {
    "login": "terencechain",
    "id": 21316537,
    "node_id": "MDQ6VXNlcjIxMzE2NTM3",
    "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/terencechain",
    "html_url": "https://github.com/terencechain",
    "followers_url": "https://api.github.com/users/terencechain/followers",
    "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
    "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
    "organizations_url": "https://api.github.com/users/terencechain/orgs",
    "repos_url": "https://api.github.com/users/terencechain/repos",
    "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/terencechain/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1063043868,
      "node_id": "MDU6TGFiZWwxMDYzMDQzODY4",
      "url": "https://api.github.com/repos/ethereum/consensus-specs/labels/general:enhancement",
      "name": "general:enhancement",
      "color": "086788",
      "default": false,
      "description": "New feature or request"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2018-09-22T17:38:03Z",
  "updated_at": "2018-11-05T13:36:25Z",
  "closed_at": "2018-11-05T13:36:25Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Background:**\r\n\r\n`AttestationRecord` is currently used for aggregated attestation and single attestation when attester attest on a block or when proposer include its own attestation when it broadcasts the block at the network layer.\r\n\r\n**Proposal:**\r\n\r\nI wonder if it's worth it to separate out single attestation into its own object which looks below.\r\nAs you can see, we can save the network bandwidth on `oblique_parent_hashes` (don't need for single attestation) and `attester_bitfield` (bytes -> uint32) per attestation every time proposer or attester transmits over the wire. The down side is there's increasing complexity to manage two different attestation objects.\r\n\r\n**SingleAttestation:**\r\n```\r\nfields = {\r\n    'slot': 'int64',\r\n    'shard_id': 'int16',\r\n    'shard_block_hash': 'hash32',\r\n    'attester_index': 'int32',\r\n    'justified_slot': 'int64',\r\n    'justified_block_hash': 'hash32',\r\n    'aggregate_sig': ['int256']\r\n}\r\n```\r\n\r\n**AttestationRecord (AggregatedAttestation):**\r\n```\r\nfields = {\r\n    'slot': 'int64',\r\n    'shard_id': 'int16',\r\n    'oblique_parent_hashes': ['hash32'],\r\n    'shard_block_hash': 'hash32',\r\n    'attester_bitfield': 'bytes',\r\n    'justified_slot': 'int64',\r\n    'justified_block_hash': 'hash32',\r\n    'aggregate_sig': ['int256']\r\n}\r\n```\r\n\r\n",
  "closed_by": {
    "login": "djrtwo",
    "id": 1433595,
    "node_id": "MDQ6VXNlcjE0MzM1OTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/djrtwo",
    "html_url": "https://github.com/djrtwo",
    "followers_url": "https://api.github.com/users/djrtwo/followers",
    "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
    "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
    "organizations_url": "https://api.github.com/users/djrtwo/orgs",
    "repos_url": "https://api.github.com/users/djrtwo/repos",
    "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/djrtwo/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/6/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/6/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/430049267",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/6#issuecomment-430049267",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/6",
    "id": 430049267,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDA0OTI2Nw==",
    "user": {
      "login": "djrtwo",
      "id": 1433595,
      "node_id": "MDQ6VXNlcjE0MzM1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/djrtwo",
      "html_url": "https://github.com/djrtwo",
      "followers_url": "https://api.github.com/users/djrtwo/followers",
      "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
      "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
      "organizations_url": "https://api.github.com/users/djrtwo/orgs",
      "repos_url": "https://api.github.com/users/djrtwo/repos",
      "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/djrtwo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-15T23:31:05Z",
    "updated_at": "2018-10-15T23:31:05Z",
    "author_association": "MEMBER",
    "body": "I'm a bit mixed on this proposal. I wasn't particularly fond of it at first, but I just checked the savings by eliminating the `attester_bitfield` when a single attestation is being broadcast and they are worth considering.\r\n\r\n> Assuming ~300k validators and 1024 shards, we expect committees to be of size ~300 validators. This is a 38 byte bitfield per attestation. If we switch to the SingleAttestation format, we save ~34 bytes per SingleAttestation as they are sent around the network.\r\n\r\nIt's roughly a 15-20% saving in byte size depending on the size of the bls signature.\r\n\r\nAnyone else want to chime in on whether these savings are worth the additional data structure?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/430049267/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/430056246",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/6#issuecomment-430056246",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/6",
    "id": 430056246,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDA1NjI0Ng==",
    "user": {
      "login": "rawfalafel",
      "id": 202157,
      "node_id": "MDQ6VXNlcjIwMjE1Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/202157?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rawfalafel",
      "html_url": "https://github.com/rawfalafel",
      "followers_url": "https://api.github.com/users/rawfalafel/followers",
      "following_url": "https://api.github.com/users/rawfalafel/following{/other_user}",
      "gists_url": "https://api.github.com/users/rawfalafel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rawfalafel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rawfalafel/subscriptions",
      "organizations_url": "https://api.github.com/users/rawfalafel/orgs",
      "repos_url": "https://api.github.com/users/rawfalafel/repos",
      "events_url": "https://api.github.com/users/rawfalafel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rawfalafel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-16T00:08:46Z",
    "updated_at": "2018-10-16T00:20:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "From an implementation perspective, this brings clarity, particularly for the attestation that's attached to a new block. \r\n\r\n`AttestationRecord` has these fields:\r\n```python\r\n{\r\n    # Slot number\r\n    'slot': 'int64',\r\n    # Shard number\r\n    'shard': 'int16',\r\n    # Block hashes not part of the current chain, oldest to newest\r\n    'oblique_parent_hashes': ['hash32'],\r\n    # Shard block hash being attested to\r\n    'shard_block_hash': 'hash32',\r\n    # Attester participation bitfield (1 bit per attester)\r\n    'attester_bitfield': 'bytes',\r\n    # Slot of last justified block\r\n    'justified_slot': 'int64',\r\n    # Hash of last justified block\r\n    'justified_block_hash': 'hash32',\r\n    # BLS aggregate signature\r\n    'aggregate_sig': ['int256']\r\n}\r\n```\r\n\r\nThe proposer's attestation that comes attached to a block only requires `shard_block_hash` and `aggregate_sig`. Every other field is either irrelevant or derived by the block itself. \r\n\r\nHowever at the p2p layer, when aggregating attestations, it may not be worthwhile to separate attestations into two separate data structures.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/430056246/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/430062320",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/6#issuecomment-430062320",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/6",
    "id": 430062320,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDA2MjMyMA==",
    "user": {
      "login": "rawfalafel",
      "id": 202157,
      "node_id": "MDQ6VXNlcjIwMjE1Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/202157?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rawfalafel",
      "html_url": "https://github.com/rawfalafel",
      "followers_url": "https://api.github.com/users/rawfalafel/followers",
      "following_url": "https://api.github.com/users/rawfalafel/following{/other_user}",
      "gists_url": "https://api.github.com/users/rawfalafel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rawfalafel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rawfalafel/subscriptions",
      "organizations_url": "https://api.github.com/users/rawfalafel/orgs",
      "repos_url": "https://api.github.com/users/rawfalafel/repos",
      "events_url": "https://api.github.com/users/rawfalafel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rawfalafel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-16T00:46:32Z",
    "updated_at": "2018-10-16T00:46:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "So maybe an alternate proposal is:\r\n- Keep the name `AttestationRecord` the same.\r\n- Specify that `shard_block_hash` and `proposer_sig` is included along with a new block.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/430062320/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/430152856",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/6#issuecomment-430152856",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/6",
    "id": 430152856,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDE1Mjg1Ng==",
    "user": {
      "login": "jannikluhn",
      "id": 29854669,
      "node_id": "MDQ6VXNlcjI5ODU0NjY5",
      "avatar_url": "https://avatars.githubusercontent.com/u/29854669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jannikluhn",
      "html_url": "https://github.com/jannikluhn",
      "followers_url": "https://api.github.com/users/jannikluhn/followers",
      "following_url": "https://api.github.com/users/jannikluhn/following{/other_user}",
      "gists_url": "https://api.github.com/users/jannikluhn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jannikluhn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jannikluhn/subscriptions",
      "organizations_url": "https://api.github.com/users/jannikluhn/orgs",
      "repos_url": "https://api.github.com/users/jannikluhn/repos",
      "events_url": "https://api.github.com/users/jannikluhn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jannikluhn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-16T08:43:04Z",
    "updated_at": "2018-10-16T08:43:04Z",
    "author_association": "MEMBER",
    "body": "> It's roughly a 15-20% saving in byte size depending on the size of the bls signature.\r\n\r\nI'm assuming we're going with Vitalik's idea of aggregating attestations in the shard networks (which I think is a good idea). Then we should compare the size savings to the whole shard network traffic, not only the attestation traffic. If I didn't make a miscalculate, attestations are roughly 10% of the 1MB/8s collation traffic (128kB/s vs 10kB/s). So the savings compared to this are only 1.5 - 2%.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/430152856/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/430421159",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/6#issuecomment-430421159",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/6",
    "id": 430421159,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDQyMTE1OQ==",
    "user": {
      "login": "djrtwo",
      "id": 1433595,
      "node_id": "MDQ6VXNlcjE0MzM1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/djrtwo",
      "html_url": "https://github.com/djrtwo",
      "followers_url": "https://api.github.com/users/djrtwo/followers",
      "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
      "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
      "organizations_url": "https://api.github.com/users/djrtwo/orgs",
      "repos_url": "https://api.github.com/users/djrtwo/repos",
      "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/djrtwo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-16T22:19:14Z",
    "updated_at": "2018-10-16T22:19:14Z",
    "author_association": "MEMBER",
    "body": "good point @jannikluhn ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/430421159/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/430424675",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/6#issuecomment-430424675",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/6",
    "id": 430424675,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzMDQyNDY3NQ==",
    "user": {
      "login": "terencechain",
      "id": 21316537,
      "node_id": "MDQ6VXNlcjIxMzE2NTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/terencechain",
      "html_url": "https://github.com/terencechain",
      "followers_url": "https://api.github.com/users/terencechain/followers",
      "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
      "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
      "organizations_url": "https://api.github.com/users/terencechain/orgs",
      "repos_url": "https://api.github.com/users/terencechain/repos",
      "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/terencechain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-16T22:34:07Z",
    "updated_at": "2018-10-16T22:34:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yeah. That's a great point. In this case, I don't feel strongly on having two wire formats. I'm ok with closing if everyone is ok too ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/430424675/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/435875558",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/6#issuecomment-435875558",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/6",
    "id": 435875558,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNTg3NTU1OA==",
    "user": {
      "login": "djrtwo",
      "id": 1433595,
      "node_id": "MDQ6VXNlcjE0MzM1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/djrtwo",
      "html_url": "https://github.com/djrtwo",
      "followers_url": "https://api.github.com/users/djrtwo/followers",
      "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
      "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
      "organizations_url": "https://api.github.com/users/djrtwo/orgs",
      "repos_url": "https://api.github.com/users/djrtwo/repos",
      "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/djrtwo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-05T13:36:25Z",
    "updated_at": "2018-11-05T13:36:25Z",
    "author_association": "MEMBER",
    "body": "Not currently going down this road. Only if we end up needing to optimize the netowrk layer and a simple compression alg (snappy compression or otherwise) doesn't work well for our purposes",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/435875558/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
