{
  "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/3122",
  "repository_url": "https://api.github.com/repos/ethereum/consensus-specs",
  "labels_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/3122/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/3122/comments",
  "events_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/3122/events",
  "html_url": "https://github.com/ethereum/consensus-specs/issues/3122",
  "id": 1458901215,
  "node_id": "I_kwDOCOoGbc5W9RDf",
  "number": 3122,
  "title": "Update sanity blocks testing with flag to ignore state root validation",
  "user": {
    "login": "lucassaldanha",
    "id": 1766440,
    "node_id": "MDQ6VXNlcjE3NjY0NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lucassaldanha",
    "html_url": "https://github.com/lucassaldanha",
    "followers_url": "https://api.github.com/users/lucassaldanha/followers",
    "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
    "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
    "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
    "repos_url": "https://api.github.com/users/lucassaldanha/repos",
    "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1295439957,
      "node_id": "MDU6TGFiZWwxMjk1NDM5OTU3",
      "url": "https://api.github.com/repos/ethereum/consensus-specs/labels/scope:CI/tests/pyspec",
      "name": "scope:CI/tests/pyspec",
      "color": "BDC0BA",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-11-22T02:19:18Z",
  "updated_at": "2022-11-22T05:24:00Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "While working to fix our validation of `BlsToExecutionChange` in Teku, we noticed that the test `invalid_duplicate_bls_changes_same_block` was not failing (even though we knew our validation was allowing duplicate BlsToExecutionChange operations in the same block). It turns out that Teku was rejecting the block because the block.state_root after processing the block was not matching the calculated state root.\r\n\r\nThere are some test cases that we are testing for a state root mismatch, but in others (e.g. validating operations), we really want to see if other more specific validation rules have been implemented correctly.\r\n\r\nIn our case, we have updated our test runner to decide if the test is checking for a state root mismatch or not looking at the test name (if it contains `invalid_state_root` in the name). Using this information, we can assert the error message from our state transition to check if we are failing for the right reason.\r\n\r\nHowever, this approach can be brittle and rely on a naming convention that could change. We think we could update the medata we provide to the tests with a flag indicating if we should ignore state root validation for that test case.\r\n\r\nThoughts?\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/3122/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/3122/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/1323090293",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/3122#issuecomment-1323090293",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/3122",
    "id": 1323090293,
    "node_id": "IC_kwDOCOoGbc5O3MF1",
    "user": {
      "login": "hwwhww",
      "id": 9263930,
      "node_id": "MDQ6VXNlcjkyNjM5MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9263930?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hwwhww",
      "html_url": "https://github.com/hwwhww",
      "followers_url": "https://api.github.com/users/hwwhww/followers",
      "following_url": "https://api.github.com/users/hwwhww/following{/other_user}",
      "gists_url": "https://api.github.com/users/hwwhww/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hwwhww/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hwwhww/subscriptions",
      "organizations_url": "https://api.github.com/users/hwwhww/orgs",
      "repos_url": "https://api.github.com/users/hwwhww/repos",
      "events_url": "https://api.github.com/users/hwwhww/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hwwhww/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-22T05:22:35Z",
    "updated_at": "2022-11-22T05:22:35Z",
    "author_association": "MEMBER",
    "body": "I think instead of having an `ignore_state_root_validation` meta field, we can have a more general field to indicate the error type. e.g., `invalid_reason: STATE_TRANSITION_ROOT | UNDEFINED`. So we can set `invalid_reason: UNDEFINED` by default when it's invalid, and then set `invalid_state_root` test case with `invalid_reason: STATE_TRANSITION_ROOT`. It allows us to add other error types in the future, e.g., `BLS_VERIFICATION`.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/1323090293/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/1323091808",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/3122#issuecomment-1323091808",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/3122",
    "id": 1323091808,
    "node_id": "IC_kwDOCOoGbc5O3Mdg",
    "user": {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-22T05:23:59Z",
    "updated_at": "2022-11-22T05:23:59Z",
    "author_association": "NONE",
    "body": "> I think instead of having an ignore_state_root_validation meta field, we can have a more general field to indicate the error type\r\n\r\nSure! This is a great idea.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/1323091808/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
