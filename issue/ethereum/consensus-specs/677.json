{
  "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/677",
  "repository_url": "https://api.github.com/repos/ethereum/consensus-specs",
  "labels_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/677/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/677/comments",
  "events_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/677/events",
  "html_url": "https://github.com/ethereum/consensus-specs/issues/677",
  "id": 413673266,
  "node_id": "MDU6SXNzdWU0MTM2NzMyNjY=",
  "number": 677,
  "title": "The timing of apply rewards/penalties",
  "user": {
    "login": "hwwhww",
    "id": 9263930,
    "node_id": "MDQ6VXNlcjkyNjM5MzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9263930?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hwwhww",
    "html_url": "https://github.com/hwwhww",
    "followers_url": "https://api.github.com/users/hwwhww/followers",
    "following_url": "https://api.github.com/users/hwwhww/following{/other_user}",
    "gists_url": "https://api.github.com/users/hwwhww/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hwwhww/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hwwhww/subscriptions",
    "organizations_url": "https://api.github.com/users/hwwhww/orgs",
    "repos_url": "https://api.github.com/users/hwwhww/repos",
    "events_url": "https://api.github.com/users/hwwhww/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hwwhww/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1063043868,
      "node_id": "MDU6TGFiZWwxMDYzMDQzODY4",
      "url": "https://api.github.com/repos/ethereum/consensus-specs/labels/general:enhancement",
      "name": "general:enhancement",
      "color": "086788",
      "default": false,
      "description": "New feature or request"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2019-02-23T08:36:05Z",
  "updated_at": "2019-03-09T00:08:09Z",
  "closed_at": "2019-03-09T00:08:09Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "### Issue\r\nFollow up of https://github.com/ethereum/eth2.0-specs/issues/616\r\n\r\n> Not if we fix the base reward for each validator before starting the rewards section. So either apply rewards at end or make a base reward var at the beginning and use that to update. Either would result in the same\r\n\r\nThe current description of the spec says \"If validator ...., gains ...\" and \"If validator ...., loses ...\". It's unclear to know that do we apply the reward **immediately** or **at the end**.\r\nAlthough our in-spec parameters setting won't let underflow happen (i.e., the validator won't get penalized that much before they get ejected.), it would be nice to define the procedure strictly.\r\n\r\n### Proposed solution\r\n\r\nRef: https://github.com/ethereum/trinity/pull/273\r\n\r\n1. Set local map/dict variables `rewards_received: Dict[ValidatorIndex -> Gwei]` and `penalties_received: Dict[ValidatorIndex -> Gwei]` at the beginning of the \"Rewards and penalties\" section.\r\n2. Use Python code to explicitly add rewards/penalties to the `rewards_received` map.\r\n3. Add an \"Apply rewards and penalties\" section at the end of \"Rewards and penalties\" section.\r\n    - Apply `rewards_received` to `state.validator_balances`.\r\n    - Apply `penalties_received` to `state.validator_balances`; If underflow, set balance to `0`.\r\n  \r\n\r\n\r\n",
  "closed_by": {
    "login": "hwwhww",
    "id": 9263930,
    "node_id": "MDQ6VXNlcjkyNjM5MzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9263930?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hwwhww",
    "html_url": "https://github.com/hwwhww",
    "followers_url": "https://api.github.com/users/hwwhww/followers",
    "following_url": "https://api.github.com/users/hwwhww/following{/other_user}",
    "gists_url": "https://api.github.com/users/hwwhww/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hwwhww/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hwwhww/subscriptions",
    "organizations_url": "https://api.github.com/users/hwwhww/orgs",
    "repos_url": "https://api.github.com/users/hwwhww/repos",
    "events_url": "https://api.github.com/users/hwwhww/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hwwhww/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/677/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/677/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/471120829",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/677#issuecomment-471120829",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/677",
    "id": 471120829,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MTEyMDgyOQ==",
    "user": {
      "login": "hwwhww",
      "id": 9263930,
      "node_id": "MDQ6VXNlcjkyNjM5MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9263930?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hwwhww",
      "html_url": "https://github.com/hwwhww",
      "followers_url": "https://api.github.com/users/hwwhww/followers",
      "following_url": "https://api.github.com/users/hwwhww/following{/other_user}",
      "gists_url": "https://api.github.com/users/hwwhww/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hwwhww/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hwwhww/subscriptions",
      "organizations_url": "https://api.github.com/users/hwwhww/orgs",
      "repos_url": "https://api.github.com/users/hwwhww/repos",
      "events_url": "https://api.github.com/users/hwwhww/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hwwhww/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-09T00:08:08Z",
    "updated_at": "2019-03-09T00:08:08Z",
    "author_association": "MEMBER",
    "body": "closing via #711 ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/471120829/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
