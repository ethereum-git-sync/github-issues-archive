{
  "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/3103",
  "repository_url": "https://api.github.com/repos/ethereum/consensus-specs",
  "labels_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/3103/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/3103/comments",
  "events_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/3103/events",
  "html_url": "https://github.com/ethereum/consensus-specs/issues/3103",
  "id": 1448536160,
  "node_id": "I_kwDOCOoGbc5WVuhg",
  "number": 3103,
  "title": "BlobSideCar mutable in gossip",
  "user": {
    "login": "djrtwo",
    "id": 1433595,
    "node_id": "MDQ6VXNlcjE0MzM1OTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/djrtwo",
    "html_url": "https://github.com/djrtwo",
    "followers_url": "https://api.github.com/users/djrtwo/followers",
    "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
    "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
    "organizations_url": "https://api.github.com/users/djrtwo/orgs",
    "repos_url": "https://api.github.com/users/djrtwo/repos",
    "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/djrtwo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4163819084,
      "node_id": "LA_kwDOCOoGbc74LtZM",
      "url": "https://api.github.com/repos/ethereum/consensus-specs/labels/eip-4844",
      "name": "eip-4844",
      "color": "A28C37",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-11-14T18:23:18Z",
  "updated_at": "2022-11-16T02:48:59Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "`beacon_block_and_blobs_sidecar` gossip validations are not sufficient to protect against any node mutating the sidecar after the proposer begins the gossip. As there is both no (1) proposer signature on the sidecar payload or (2) a cryptographic check that the commitments in the block map to the blobs in the sidecar.\r\n\r\nEDIT: some background on gossip validations, we generally want to do minimum sufficient crypto-economic and validity checks to ensure the payload is at least \"worth\" gossiping. Usually this is a signature check to know it is from the expected actor and then whatever relatively cheap validity checks you can do to make sure it's generally well-formed. Here we have no crypto-economic commitment taht the adjoining payload was even made by the expected actor\r\n\r\n\r\nSo we can either sign the payload and do another sig check or we can  run the full `validate_blobs_sidecar`.\r\n@Inphi estimates `validate_blobs_sidecar` as ~12ms @ 2MB (4ms at 256kb) whereas the signature check @terencechain estimates at 1 to 4ms. If we run `validate_blobs_sidecar` will it be dominant wrt time? If so, we need to be careful here. If not, lets just do that.\r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/3103/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/3103/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/1315506589",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/3103#issuecomment-1315506589",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/3103",
    "id": 1315506589,
    "node_id": "IC_kwDOCOoGbc5OaQmd",
    "user": {
      "login": "kevaundray",
      "id": 37423678,
      "node_id": "MDQ6VXNlcjM3NDIzNjc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/37423678?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kevaundray",
      "html_url": "https://github.com/kevaundray",
      "followers_url": "https://api.github.com/users/kevaundray/followers",
      "following_url": "https://api.github.com/users/kevaundray/following{/other_user}",
      "gists_url": "https://api.github.com/users/kevaundray/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kevaundray/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kevaundray/subscriptions",
      "organizations_url": "https://api.github.com/users/kevaundray/orgs",
      "repos_url": "https://api.github.com/users/kevaundray/repos",
      "events_url": "https://api.github.com/users/kevaundray/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kevaundray/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-15T15:50:25Z",
    "updated_at": "2022-11-15T15:50:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "Reposting here:\r\n\r\ngoos: darwin\r\ngoarch: amd64\r\npkg: github.com/crate-crypto/go-proto-danksharding-crypto/agg_kzg\r\ncpu: Intel(R) Core(TM) i9-9980HK CPU @ 2.40GHz\r\nBenchmarkAggVerify1-16                          2499203 ns/op\r\nBenchmarkAggVerify2-16                          3278393 ns/op\r\nBenchmarkAggVerify3-16                          4033615 ns/op\r\nBenchmarkAggVerify4-16                          4844001 ns/op\r\nBenchmarkAggVerify5-16                          5763020 ns/op\r\nBenchmarkAggVerify6-16                          6500817 ns/op\r\nBenchmarkAggVerify7-16                          7366121 ns/op\r\nBenchmarkAggVerify8-16                          8267168 ns/op\r\nBenchmarkAggVerify9-16                          8857999 ns/op\r\nBenchmarkAggVerify10-16                         9594048 ns/op\r\nBenchmarkAggVerify11-16                        10273552 ns/op\r\nBenchmarkAggVerify12-16                        14101749 ns/op\r\nBenchmarkAggVerify13-16                        13103934 ns/op\r\nBenchmarkAggVerify14-16                        13431766 ns/op\r\nBenchmarkAggVerify15-16                        15368090 ns/op\r\nBenchmarkAggVerify16-16                        14334650 ns/op\r\n\r\nLegend:\r\n\r\nBenchmarkAggVerifyX-K : X denotes the amount of blobs and K denotes the number of cores on my machine\r\n\r\nBlobs size is 4096, so each blob holds 4096*32 bytes",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/1315506589/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/1316221975",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/3103#issuecomment-1316221975",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/3103",
    "id": 1316221975,
    "node_id": "IC_kwDOCOoGbc5Oc_QX",
    "user": {
      "login": "realbigsean",
      "id": 5160426,
      "node_id": "MDQ6VXNlcjUxNjA0MjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5160426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/realbigsean",
      "html_url": "https://github.com/realbigsean",
      "followers_url": "https://api.github.com/users/realbigsean/followers",
      "following_url": "https://api.github.com/users/realbigsean/following{/other_user}",
      "gists_url": "https://api.github.com/users/realbigsean/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/realbigsean/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/realbigsean/subscriptions",
      "organizations_url": "https://api.github.com/users/realbigsean/orgs",
      "repos_url": "https://api.github.com/users/realbigsean/repos",
      "events_url": "https://api.github.com/users/realbigsean/events{/privacy}",
      "received_events_url": "https://api.github.com/users/realbigsean/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-16T02:48:59Z",
    "updated_at": "2022-11-16T02:48:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "I've been digging into this in lighthouse a bit more - median gossip verification times are around 8-10ms. I found `validate_blobs_sidecar` is pretty comparable to signature verification if we have to sign over the merkleized root of the blob, because the root calculation takes a decent amount of time. @paulhauner suggested we could sign over a \"flat hash\" of the blob `sha2(ssz(blob))` to avoid the root calculation, and this has a more meaningful impact.\r\n\r\nThese are rough numbers:\r\n\r\n| Blobs per block | Sig verification (root calculation) |Flat hash sig verification\r\n| :------------ | :---------------: | :---------------:| \r\n| 16        |  11ms  (9.5ms) | 2.8ms \r\n| 8      |   6ms (4.5ms)  | 2.1ms \r\n| 4         |    3.4 (1.9ms) |1.7ms \r\n\r\nCPU: Ryzen 7 2700X 8 Core 16 thread  w/ sha extensions\r\n\r\nSigning blobs ends up being quite impactful in a few areas (VC, beacon API, and web3signer API) that we otherwise wouldn't need to touch, so I think it's generally preferable not to if we can afford it. I'd be interested in seeing to what degree we can we can parallelize `validate_blobs_sidecar` with the rest of gossip verification. If it becomes apparent that this is a bottleneck, we had previously done an implementation of blob signing that we can revive. And in that case it seems a scheme with a flat hash is what we'd want.\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/1316221975/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
