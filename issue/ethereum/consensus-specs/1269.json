{
  "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1269",
  "repository_url": "https://api.github.com/repos/ethereum/consensus-specs",
  "labels_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1269/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1269/comments",
  "events_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1269/events",
  "html_url": "https://github.com/ethereum/consensus-specs/issues/1269",
  "id": 464122322,
  "node_id": "MDU6SXNzdWU0NjQxMjIzMjI=",
  "number": 1269,
  "title": "Inconsistency between MIN_SEED_LOOKAHEAD and validator spec",
  "user": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1063043866,
      "node_id": "MDU6TGFiZWwxMDYzMDQzODY2",
      "url": "https://api.github.com/repos/ethereum/consensus-specs/labels/general:bug",
      "name": "general:bug",
      "color": "DD1C1A",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1437528763,
      "node_id": "MDU6TGFiZWwxNDM3NTI4NzYz",
      "url": "https://api.github.com/repos/ethereum/consensus-specs/labels/post-freeze%20(substantive)",
      "name": "post-freeze (substantive)",
      "color": "991a40",
      "default": false,
      "description": "Substantive consensus change non-critical for long-lived cross-client testnets"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-07-04T08:00:20Z",
  "updated_at": "2019-07-15T00:11:39Z",
  "closed_at": "2019-07-15T00:11:38Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "The [validator spec](https://github.com/ethereum/eth2.0-specs/blob/v0.8.0/specs/validator/0_beacon-chain-validator.md#lookahead) states:\r\n\r\n> The beacon chain shufflings are designed to provide a minimum of 1 epoch lookahead on the validator's upcoming committee assignments for attesting dictated by the shuffling and slot. Note that this lookahead does not apply to proposing, which must be checked during the epoch in question.\r\n\r\nHowever, the shuffling for `current_epoch + 1` depends on the RANDAO mix for `current_epoch + 1 - MIN_SEED_LOOKAHEAD`, i.e. `current_epoch` with the lookahead set to 1 as it currently is. But this RANDAO mix for the current epoch changes every time a block is processed (as per [process_randao](https://github.com/ethereum/eth2.0-specs/blob/v0.8.0/specs/core/0_beacon-chain.md#randao)). Put another way: once a validator has transitioned to some epoch, they use the RANDAO mix from the previous epoch to determine their shuffling, and this RANDAO mix is changing right up until the last slot of the previous epoch.\r\n\r\nIn Lighthouse we were contemplating deleting our cache of the shuffling for the next epoch for this reason! See: https://github.com/sigp/lighthouse/issues/407\r\n\r\nIt would be good to have some clarity on whether the behaviour of the validator spec or of the beacon chain spec is what we really want. If the lookahead behaviour _is_ desired (which seems reasonable to me), I think we should update the beacon chain spec to account for the RANDAO mix changing in the current epoch.",
  "closed_by": {
    "login": "djrtwo",
    "id": 1433595,
    "node_id": "MDQ6VXNlcjE0MzM1OTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/djrtwo",
    "html_url": "https://github.com/djrtwo",
    "followers_url": "https://api.github.com/users/djrtwo/followers",
    "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
    "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
    "organizations_url": "https://api.github.com/users/djrtwo/orgs",
    "repos_url": "https://api.github.com/users/djrtwo/repos",
    "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/djrtwo/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1269/reactions",
    "total_count": 3,
    "+1": 3,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1269/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/508503460",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/1269#issuecomment-508503460",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1269",
    "id": 508503460,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODUwMzQ2MA==",
    "user": {
      "login": "djrtwo",
      "id": 1433595,
      "node_id": "MDQ6VXNlcjE0MzM1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/djrtwo",
      "html_url": "https://github.com/djrtwo",
      "followers_url": "https://api.github.com/users/djrtwo/followers",
      "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
      "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
      "organizations_url": "https://api.github.com/users/djrtwo/orgs",
      "repos_url": "https://api.github.com/users/djrtwo/repos",
      "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/djrtwo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-04T14:34:01Z",
    "updated_at": "2019-07-04T14:36:05Z",
    "author_association": "MEMBER",
    "body": "This looks like an off-by-one error. nice catch. I suppose in our tests, we are always getting the committees just in time for processing. Will add some to catch this scenario.\r\n\r\nWe should be getting the mix from `get_randao_mix(state, Epoch(epoch + EPOCHS_PER_HISTORICAL_VECTOR - 1 - MIN_SEED_LOOKAHEAD))` in `get_seed` (additional - 1) as the randao lookup. \r\n\r\nNeed to either adjust the constant to `2` as you noted or add the `-1`. Need to think about the semantics a bit.\r\n\r\nOff today through the weekend. Will pick this up monday",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/508503460/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/508585550",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/1269#issuecomment-508585550",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1269",
    "id": 508585550,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwODU4NTU1MA==",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-04T22:30:15Z",
    "updated_at": "2019-07-04T22:30:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yeah I think the additional `-1` is clearer than setting `MIN_SEED_LOOKAHEAD` to 2. Unless we change the name of the variable to make sense with the 2 value meaning \"look at the randao from 2 epochs back\".",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/508585550/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/511246711",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/1269#issuecomment-511246711",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1269",
    "id": 511246711,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMTI0NjcxMQ==",
    "user": {
      "login": "djrtwo",
      "id": 1433595,
      "node_id": "MDQ6VXNlcjE0MzM1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/djrtwo",
      "html_url": "https://github.com/djrtwo",
      "followers_url": "https://api.github.com/users/djrtwo/followers",
      "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
      "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
      "organizations_url": "https://api.github.com/users/djrtwo/orgs",
      "repos_url": "https://api.github.com/users/djrtwo/repos",
      "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/djrtwo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-15T00:11:38Z",
    "updated_at": "2019-07-15T00:11:38Z",
    "author_association": "MEMBER",
    "body": "close via #1296 ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/511246711/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
