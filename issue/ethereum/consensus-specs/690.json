{
  "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/690",
  "repository_url": "https://api.github.com/repos/ethereum/consensus-specs",
  "labels_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/690/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/690/comments",
  "events_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/690/events",
  "html_url": "https://github.com/ethereum/consensus-specs/issues/690",
  "id": 414356215,
  "node_id": "MDU6SXNzdWU0MTQzNTYyMTU=",
  "number": 690,
  "title": "Slashing condition slot issue",
  "user": {
    "login": "djrtwo",
    "id": 1433595,
    "node_id": "MDQ6VXNlcjE0MzM1OTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/djrtwo",
    "html_url": "https://github.com/djrtwo",
    "followers_url": "https://api.github.com/users/djrtwo/followers",
    "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
    "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
    "organizations_url": "https://api.github.com/users/djrtwo/orgs",
    "repos_url": "https://api.github.com/users/djrtwo/repos",
    "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/djrtwo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-02-25T23:25:24Z",
  "updated_at": "2019-04-17T23:07:01Z",
  "closed_at": "2019-04-17T23:07:00Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "# Issue\r\n\r\nBoth `is_surround_vote` and `is_double_vote` use `attestation.data.slot` to figure out the \"target\" epoch (in FFG terms). This assumes that the \"target\" epoch is the same as the epoch the validator has been assigned. If there is high latency or low block production participation, the target epoch might be some previous epoch, and in such a case, the just checking if the validator made two different votes during a single epoch is not sufficient (for `is_double_vote`).\r\n\r\nFor example:\r\n* During epoch N, validator votes on some block B1 with the epoch boundary N1 as the start block of that epoch.\r\n* During epoch N+1, the validator votes on block B2 (from epoch N rather than from epoch N+1) with an the epoch boundary N2 (where `N1 != N2`).\r\n* The validator voted on two conflicting blocks at the same slot height (for ffg) but the `is_double_vote` does not catch it because `attestation.data.slot` is not equal.\r\n\r\nAdding another field `beacon_block_slot` would provide enough information to resolve this issue, but I'm not entirely convinced this is the proper route. Need to mull over these exceptional cases when no blocks are being produced a bit more\r\n\r\n(Thanks @krzhang. This came up in a chat we had about formalizing the [ffg pos mini spec](https://ethresear.ch/t/beacon-chain-casper-mini-spec/2760))\r\n\r\nEdit: This is somewhat related to another issue -- should a validator transition through empty slots from the head they see locally up to the slot at which they are assigned when grabbing the state to attest to. I am 95% sure the answer to this is yes.",
  "closed_by": {
    "login": "djrtwo",
    "id": 1433595,
    "node_id": "MDQ6VXNlcjE0MzM1OTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/djrtwo",
    "html_url": "https://github.com/djrtwo",
    "followers_url": "https://api.github.com/users/djrtwo/followers",
    "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
    "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
    "organizations_url": "https://api.github.com/users/djrtwo/orgs",
    "repos_url": "https://api.github.com/users/djrtwo/repos",
    "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/djrtwo/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/690/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/690/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/467342167",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/690#issuecomment-467342167",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/690",
    "id": 467342167,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2NzM0MjE2Nw==",
    "user": {
      "login": "vbuterin",
      "id": 2230894,
      "node_id": "MDQ6VXNlcjIyMzA4OTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2230894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vbuterin",
      "html_url": "https://github.com/vbuterin",
      "followers_url": "https://api.github.com/users/vbuterin/followers",
      "following_url": "https://api.github.com/users/vbuterin/following{/other_user}",
      "gists_url": "https://api.github.com/users/vbuterin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vbuterin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vbuterin/subscriptions",
      "organizations_url": "https://api.github.com/users/vbuterin/orgs",
      "repos_url": "https://api.github.com/users/vbuterin/repos",
      "events_url": "https://api.github.com/users/vbuterin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vbuterin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-26T08:21:30Z",
    "updated_at": "2019-02-26T08:21:30Z",
    "author_association": "MEMBER",
    "body": "Don't think I understand the distinction. The target epoch is the same as the epoch the validator has been assigned by definition. The epoch the attestation gets _included_ could be later, but we're already taking that into account in other ways.\r\n\r\n> The validator voted on two conflicting blocks at the same slot height (for ffg) but the `is_double_vote` does not catch it because `attestation.data.slot` is not equal.\r\n\r\nSlot height for FFG in this case _is_ the block that's being attested to (ie. `attestation.data.slot`).\r\n\r\nAlso, I thought we're not voting for the start block of an epoch, we're voting for the most recent block _before_ an epoch?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/467342167/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/471124865",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/690#issuecomment-471124865",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/690",
    "id": 471124865,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MTEyNDg2NQ==",
    "user": {
      "login": "hwwhww",
      "id": 9263930,
      "node_id": "MDQ6VXNlcjkyNjM5MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9263930?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hwwhww",
      "html_url": "https://github.com/hwwhww",
      "followers_url": "https://api.github.com/users/hwwhww/followers",
      "following_url": "https://api.github.com/users/hwwhww/following{/other_user}",
      "gists_url": "https://api.github.com/users/hwwhww/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hwwhww/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hwwhww/subscriptions",
      "organizations_url": "https://api.github.com/users/hwwhww/orgs",
      "repos_url": "https://api.github.com/users/hwwhww/repos",
      "events_url": "https://api.github.com/users/hwwhww/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hwwhww/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-09T00:32:15Z",
    "updated_at": "2019-03-09T00:32:15Z",
    "author_association": "MEMBER",
    "body": "@djrtwo \r\nIs it fine to close now?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/471124865/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/484294226",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/690#issuecomment-484294226",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/690",
    "id": 484294226,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4NDI5NDIyNg==",
    "user": {
      "login": "djrtwo",
      "id": 1433595,
      "node_id": "MDQ6VXNlcjE0MzM1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/djrtwo",
      "html_url": "https://github.com/djrtwo",
      "followers_url": "https://api.github.com/users/djrtwo/followers",
      "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
      "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
      "organizations_url": "https://api.github.com/users/djrtwo/orgs",
      "repos_url": "https://api.github.com/users/djrtwo/repos",
      "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/djrtwo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-17T23:07:00Z",
    "updated_at": "2019-04-17T23:07:00Z",
    "author_association": "MEMBER",
    "body": "This has been clarified in the validator guide noting that a validator must transition through state to the slot they are attesting to. A validator is essentially attesting to a (slot, block) tuple rather than jsut a block",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/484294226/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
