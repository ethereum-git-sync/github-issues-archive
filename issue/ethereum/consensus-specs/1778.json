{
  "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1778",
  "repository_url": "https://api.github.com/repos/ethereum/consensus-specs",
  "labels_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1778/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1778/comments",
  "events_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1778/events",
  "html_url": "https://github.com/ethereum/consensus-specs/issues/1778",
  "id": 610530196,
  "node_id": "MDU6SXNzdWU2MTA1MzAxOTY=",
  "number": 1778,
  "title": "is the get_total_active_balance() at current epoch designed even handling previous justification? ",
  "user": {
    "login": "lucianyao",
    "id": 1046069,
    "node_id": "MDQ6VXNlcjEwNDYwNjk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1046069?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lucianyao",
    "html_url": "https://github.com/lucianyao",
    "followers_url": "https://api.github.com/users/lucianyao/followers",
    "following_url": "https://api.github.com/users/lucianyao/following{/other_user}",
    "gists_url": "https://api.github.com/users/lucianyao/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lucianyao/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lucianyao/subscriptions",
    "organizations_url": "https://api.github.com/users/lucianyao/orgs",
    "repos_url": "https://api.github.com/users/lucianyao/repos",
    "events_url": "https://api.github.com/users/lucianyao/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lucianyao/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-05-01T03:06:30Z",
  "updated_at": "2020-05-02T01:12:41Z",
  "closed_at": "2020-05-02T01:12:41Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "at version 4b4fc32,  beacon_chain, in method`process_justification_and_finalization()`, there is:\r\n`\r\nif get_attesting_balance(state, matching_target_attestations) * 3 >= get_total_active_balance(state) * 2:`\r\n\r\nthe `get_total_active_balance` is not from previous epoch, I wonder if it is designed on purpose?\r\nMaybe I don't understand it correctly but I am still wondering if it would be wrong in these cases:\r\n\r\nCase 1: some validators exit at current epoch:\r\nsuppose we have 2 validators, A and B, each with 32 eth, both were active validators, and they voted to previous epoch, but A, B voted at two branches. And  only B exited at current epoch.\r\n                       \r\nA--votes--->state at prev epoch-------state at current epoch(b exited)--------> we are here \r\nB                                                     \r\n|\r\nvotes\r\n|\r\n+---->another root at prev epoch\r\n\r\nthen:\r\ntotal active balance:32 eth(b exited so her stake is not counted) \r\nattesting balance: 32 eth(A's stake) \r\nand then root at prev epoch is justified\r\n\r\nBut the root at prev epoch is not supposed to be justified because the  it only got 1/2 votes?\r\n\r\nCase 2: some validators become active at current epoch\r\neven if the root at previous epoch is supposed to be justified, it will never  be justified because the total balance were diluted by new validators at current epoch.\r\nEven it could turn a justification from true to false, though it is not allowed and our spec doesn't handle it.\r\n\r\n\r\n\r\n",
  "closed_by": {
    "login": "lucianyao",
    "id": 1046069,
    "node_id": "MDQ6VXNlcjEwNDYwNjk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1046069?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lucianyao",
    "html_url": "https://github.com/lucianyao",
    "followers_url": "https://api.github.com/users/lucianyao/followers",
    "following_url": "https://api.github.com/users/lucianyao/following{/other_user}",
    "gists_url": "https://api.github.com/users/lucianyao/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lucianyao/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lucianyao/subscriptions",
    "organizations_url": "https://api.github.com/users/lucianyao/orgs",
    "repos_url": "https://api.github.com/users/lucianyao/repos",
    "events_url": "https://api.github.com/users/lucianyao/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lucianyao/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1778/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1778/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/622456847",
    "html_url": "https://github.com/ethereum/consensus-specs/issues/1778#issuecomment-622456847",
    "issue_url": "https://api.github.com/repos/ethereum/consensus-specs/issues/1778",
    "id": 622456847,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMjQ1Njg0Nw==",
    "user": {
      "login": "djrtwo",
      "id": 1433595,
      "node_id": "MDQ6VXNlcjE0MzM1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/djrtwo",
      "html_url": "https://github.com/djrtwo",
      "followers_url": "https://api.github.com/users/djrtwo/followers",
      "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
      "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
      "organizations_url": "https://api.github.com/users/djrtwo/orgs",
      "repos_url": "https://api.github.com/users/djrtwo/repos",
      "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/djrtwo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-01T16:24:05Z",
    "updated_at": "2020-05-01T16:24:05Z",
    "author_association": "MEMBER",
    "body": "The change in the validator set is bounded slot to slot so the marginal difference (except in extreme cases of small amounts of validators) is very low and translates into a only a small marginal degradation in the max accountable safety of that epoch.\r\n\r\nessentially this slightly affects the max security but in practice is so small that this approximation is fine and tracking historic total balances (in our calculation) was not worth added consensus complexity\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/consensus-specs/issues/comments/622456847/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
