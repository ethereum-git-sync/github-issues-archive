{
  "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/690",
  "repository_url": "https://api.github.com/repos/ethereum/yellowpaper",
  "labels_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/690/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/690/comments",
  "events_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/690/events",
  "html_url": "https://github.com/ethereum/yellowpaper/issues/690",
  "id": 316514550,
  "node_id": "MDU6SXNzdWUzMTY1MTQ1NTA=",
  "number": 690,
  "title": "Bloom Filter Implementations Differ from Yellow Paper",
  "user": {
    "login": "AusIV",
    "id": 977954,
    "node_id": "MDQ6VXNlcjk3Nzk1NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/977954?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AusIV",
    "html_url": "https://github.com/AusIV",
    "followers_url": "https://api.github.com/users/AusIV/followers",
    "following_url": "https://api.github.com/users/AusIV/following{/other_user}",
    "gists_url": "https://api.github.com/users/AusIV/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AusIV/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AusIV/subscriptions",
    "organizations_url": "https://api.github.com/users/AusIV/orgs",
    "repos_url": "https://api.github.com/users/AusIV/repos",
    "events_url": "https://api.github.com/users/AusIV/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AusIV/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2018-04-21T18:37:28Z",
  "updated_at": "2018-11-13T18:34:57Z",
  "closed_at": "2018-11-13T18:34:34Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Recently I've been working on an Ethereum client independent tool that inspects the bloom filter to determine whether to request transactions from the Ethereum client for a given block. In the process I discovered that, for the same transaction receipt with the same topics, go-ethereum and ethereumjs-vm were generating different bloom filters. My initial assumption was that, because go-ethereum is used regularly on mainnet, while ethereumjs-vm is used for testing and simulations, that ethereumjs-vm must be out of compliance with the yellow paper. However, reading through the yellow paper, I've come to believe that go-ethereum (and presumably other in-production Ethereum clients) are out of compliance with the yellow paper.\r\n\r\nThe yellow paper says that a topic is 32 bytes, and defines `m(x, i) â‰¡ KEC(x)[i, i + 1] mod 2048`. If `x` in this equation is a topic, then it follows that `x` should be 32 bytes. This is consistent with the ethereumjs-vm implementation.\r\n\r\nIn go-ethereum, however when something is [added to a bloom filter](https://github.com/ethereum/go-ethereum/blob/master/core/types/bloom9.go#L60), it is converted to a big integer and then back to bytes before applying `KEC`. This means that if the topic has leading zero bytes, it gets trimmed to the number of bytes necessary to represent the integer value, effectively stripping away any null bytes. I don't see anything in the yellow paper that indicates that leading zero bytes should be stripped away, but given that Geth does so and manages to maintain consensus with the other Ethereum clients, it seems that this is at least a defacto standard for maintaining bloom filters.\r\n\r\nAm I missing something in the yellow paper, or are the current implementations inconsistent with the yellow paper?",
  "closed_by": {
    "login": "AusIV",
    "id": 977954,
    "node_id": "MDQ6VXNlcjk3Nzk1NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/977954?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AusIV",
    "html_url": "https://github.com/AusIV",
    "followers_url": "https://api.github.com/users/AusIV/followers",
    "following_url": "https://api.github.com/users/AusIV/following{/other_user}",
    "gists_url": "https://api.github.com/users/AusIV/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AusIV/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AusIV/subscriptions",
    "organizations_url": "https://api.github.com/users/AusIV/orgs",
    "repos_url": "https://api.github.com/users/AusIV/repos",
    "events_url": "https://api.github.com/users/AusIV/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AusIV/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/690/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/690/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/383548873",
    "html_url": "https://github.com/ethereum/yellowpaper/issues/690#issuecomment-383548873",
    "issue_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/690",
    "id": 383548873,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MzU0ODg3Mw==",
    "user": {
      "login": "AusIV",
      "id": 977954,
      "node_id": "MDQ6VXNlcjk3Nzk1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/977954?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AusIV",
      "html_url": "https://github.com/AusIV",
      "followers_url": "https://api.github.com/users/AusIV/followers",
      "following_url": "https://api.github.com/users/AusIV/following{/other_user}",
      "gists_url": "https://api.github.com/users/AusIV/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AusIV/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AusIV/subscriptions",
      "organizations_url": "https://api.github.com/users/AusIV/orgs",
      "repos_url": "https://api.github.com/users/AusIV/repos",
      "events_url": "https://api.github.com/users/AusIV/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AusIV/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-23T11:54:13Z",
    "updated_at": "2018-04-23T11:54:13Z",
    "author_association": "NONE",
    "body": "I don't see any indication that it's supposed to be RLP encoded before KEC is used to calculate the hash for insertion into the bloom filter, and none of the bloom filter implementations do so. Leading zeroes are certainly significant to Keccac, which makes them significant to the output of the bloom filter. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/383548873/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/384933297",
    "html_url": "https://github.com/ethereum/yellowpaper/issues/690#issuecomment-384933297",
    "issue_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/690",
    "id": 384933297,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDkzMzI5Nw==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-27T10:36:47Z",
    "updated_at": "2018-04-27T10:36:47Z",
    "author_association": "MEMBER",
    "body": "@pirapira what do you think?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/384933297/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/384942302",
    "html_url": "https://github.com/ethereum/yellowpaper/issues/690#issuecomment-384942302",
    "issue_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/690",
    "id": 384942302,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDk0MjMwMg==",
    "user": {
      "login": "pirapira",
      "id": 44281,
      "node_id": "MDQ6VXNlcjQ0Mjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/44281?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pirapira",
      "html_url": "https://github.com/pirapira",
      "followers_url": "https://api.github.com/users/pirapira/followers",
      "following_url": "https://api.github.com/users/pirapira/following{/other_user}",
      "gists_url": "https://api.github.com/users/pirapira/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pirapira/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pirapira/subscriptions",
      "organizations_url": "https://api.github.com/users/pirapira/orgs",
      "repos_url": "https://api.github.com/users/pirapira/repos",
      "events_url": "https://api.github.com/users/pirapira/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pirapira/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-27T11:22:42Z",
    "updated_at": "2018-04-27T11:22:42Z",
    "author_association": "MEMBER",
    "body": "If all clients on the mainnet agree, YP should be changed.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/384942302/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/438386033",
    "html_url": "https://github.com/ethereum/yellowpaper/issues/690#issuecomment-438386033",
    "issue_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/690",
    "id": 438386033,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzODM4NjAzMw==",
    "user": {
      "login": "AusIV",
      "id": 977954,
      "node_id": "MDQ6VXNlcjk3Nzk1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/977954?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AusIV",
      "html_url": "https://github.com/AusIV",
      "followers_url": "https://api.github.com/users/AusIV/followers",
      "following_url": "https://api.github.com/users/AusIV/following{/other_user}",
      "gists_url": "https://api.github.com/users/AusIV/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AusIV/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AusIV/subscriptions",
      "organizations_url": "https://api.github.com/users/AusIV/orgs",
      "repos_url": "https://api.github.com/users/AusIV/repos",
      "events_url": "https://api.github.com/users/AusIV/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AusIV/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-13T18:34:34Z",
    "updated_at": "2018-11-13T18:34:34Z",
    "author_association": "NONE",
    "body": "This was my misunderstanding of Geth's code. It looks like bloom.Add() and bloom.Test() aren't used in any consensus critical places, and that the actual construction and testing of bloom filters implements according to the Yellow Paper.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/438386033/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/438386172",
    "html_url": "https://github.com/ethereum/yellowpaper/issues/690#issuecomment-438386172",
    "issue_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/690",
    "id": 438386172,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzODM4NjE3Mg==",
    "user": {
      "login": "AusIV",
      "id": 977954,
      "node_id": "MDQ6VXNlcjk3Nzk1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/977954?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AusIV",
      "html_url": "https://github.com/AusIV",
      "followers_url": "https://api.github.com/users/AusIV/followers",
      "following_url": "https://api.github.com/users/AusIV/following{/other_user}",
      "gists_url": "https://api.github.com/users/AusIV/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AusIV/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AusIV/subscriptions",
      "organizations_url": "https://api.github.com/users/AusIV/orgs",
      "repos_url": "https://api.github.com/users/AusIV/repos",
      "events_url": "https://api.github.com/users/AusIV/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AusIV/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-13T18:34:57Z",
    "updated_at": "2018-11-13T18:34:57Z",
    "author_association": "NONE",
    "body": "I've raised an issue with Geth about this here: https://github.com/ethereum/go-ethereum/issues/18092",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/438386172/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
