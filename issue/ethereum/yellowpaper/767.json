{
  "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/767",
  "repository_url": "https://api.github.com/repos/ethereum/yellowpaper",
  "labels_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/767/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/767/comments",
  "events_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/767/events",
  "html_url": "https://github.com/ethereum/yellowpaper/issues/767",
  "id": 489374577,
  "node_id": "MDU6SXNzdWU0ODkzNzQ1Nzc=",
  "number": 767,
  "title": "MSIZE after access to offset ``2^256-1``",
  "user": {
    "login": "ekpyron",
    "id": 1347491,
    "node_id": "MDQ6VXNlcjEzNDc0OTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ekpyron",
    "html_url": "https://github.com/ekpyron",
    "followers_url": "https://api.github.com/users/ekpyron/followers",
    "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
    "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
    "organizations_url": "https://api.github.com/users/ekpyron/orgs",
    "repos_url": "https://api.github.com/users/ekpyron/repos",
    "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ekpyron/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2019-09-04T20:18:54Z",
  "updated_at": "2021-06-23T14:06:07Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "If I see that correctly, then after ``MSTORE`` or ``MLOAD`` to ``2^256-1`` (no prior memory writes), ``μ_i'`` will be set to ``max(0,ceil(2^256 - 1 + 32)÷32))``, where the addition is specifically excluded from modulo arithmetic. That's ``2^251+1``.\r\n\r\nNow the next ``MSIZE`` will return ``32μ_i`` with arithmetic modulo ``2^256`` - that's ``32``.\r\n\r\nWouldn't the more reasonable value be ``2^256-1``?\r\n\r\nThis is a rather academic corner case, since no client will implement this case, since it will always run out of gas anyways - but we are implementing an EVM interpreter for fuzzing the optimizer of the solidity compiler, which is used to check for execution trace equivalence *without* considering gas and thereby noticed this oddity (https://github.com/ethereum/solidity/pull/7342). What do you think about changing this in the yellow paper?",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/767/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/767/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/528198731",
    "html_url": "https://github.com/ethereum/yellowpaper/issues/767#issuecomment-528198731",
    "issue_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/767",
    "id": 528198731,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyODE5ODczMQ==",
    "user": {
      "login": "acoglio",
      "id": 2409151,
      "node_id": "MDQ6VXNlcjI0MDkxNTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2409151?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/acoglio",
      "html_url": "https://github.com/acoglio",
      "followers_url": "https://api.github.com/users/acoglio/followers",
      "following_url": "https://api.github.com/users/acoglio/following{/other_user}",
      "gists_url": "https://api.github.com/users/acoglio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/acoglio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/acoglio/subscriptions",
      "organizations_url": "https://api.github.com/users/acoglio/orgs",
      "repos_url": "https://api.github.com/users/acoglio/repos",
      "events_url": "https://api.github.com/users/acoglio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/acoglio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-05T05:06:52Z",
    "updated_at": "2019-09-05T05:06:52Z",
    "author_association": "MEMBER",
    "body": "I haven't studied this part of the YP in detail yet, but it looks like perhaps the specifications of MLOAD and MSTORE should use min(µ<sub>s</sub>[0] + 32, 2<sup>256</sup>) instead of (µ<sub>s</sub>[0] + 32). That is, if µ<sub>s</sub>[0] + 32 exceeds 2<sup>256</sup>, and the 32 bytes starting at µ<sub>s</sub>[0] \"wrap around\" to memory locations 0 etc., we want to count all 2<sup>256</sup> bytes of memory as used: the min operation caps the number of used bytes at 2<sup>256</sup>. Then we should have the invariant µ<sub>i</sub> ≤ 2<sup>251</sup>.\r\n\r\nThere would still be a bit of a problem with MSIZE when all 2<sup>256</sup> memory bytes are used, because in this case µ<sub>i</sub> = 2<sup>251</sup> and 32µ<sub>i</sub> = 2<sup>256</sup>, which doesn't fit into a word. Perhaps returning 2<sup>256</sup>-1 is the best we can do in this case, but it would have to be a special case. In all other cases, MSIZE returns a multiple of 32.\r\n\r\n(MSTORE8 looks unproblematic because, given the expected invariant µ<sub>s</sub>[0] < 2<sup>256</sup>, i.e. that µ<sub>s</sub>[0] is a word, we have µ<sub>s</sub>[0] + 1 ≤ 2<sup>256</sup>.)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/528198731/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/528264104",
    "html_url": "https://github.com/ethereum/yellowpaper/issues/767#issuecomment-528264104",
    "issue_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/767",
    "id": 528264104,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyODI2NDEwNA==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-05T08:43:28Z",
    "updated_at": "2019-09-05T08:43:28Z",
    "author_association": "MEMBER",
    "body": "I would actually have been fine with µ_i exceeding 2^251 and consequently have the gas calculation be \"as if memory was extended beyond 2^256\" instead of just considering all 2^256 bytes used - and then just define MSIZE as \"32µi, if µ_i < 2^251 and 2^256-1 otherwise\", but maybe you're right and it might be even cleaner to cap µi itself, I'm not entirely sure - I haven't spent too much time looking into it myself.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/528264104/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/529125875",
    "html_url": "https://github.com/ethereum/yellowpaper/issues/767#issuecomment-529125875",
    "issue_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/767",
    "id": 529125875,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyOTEyNTg3NQ==",
    "user": {
      "login": "acoglio",
      "id": 2409151,
      "node_id": "MDQ6VXNlcjI0MDkxNTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2409151?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/acoglio",
      "html_url": "https://github.com/acoglio",
      "followers_url": "https://api.github.com/users/acoglio/followers",
      "following_url": "https://api.github.com/users/acoglio/following{/other_user}",
      "gists_url": "https://api.github.com/users/acoglio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/acoglio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/acoglio/subscriptions",
      "organizations_url": "https://api.github.com/users/acoglio/orgs",
      "repos_url": "https://api.github.com/users/acoglio/repos",
      "events_url": "https://api.github.com/users/acoglio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/acoglio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-07T16:59:53Z",
    "updated_at": "2019-09-07T16:59:53Z",
    "author_association": "MEMBER",
    "body": "Maybe we can wait a few more days to see if anybody else has comments on this issue, and then we can make a decision on how to proceed with editing the YP?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/529125875/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/634675591",
    "html_url": "https://github.com/ethereum/yellowpaper/issues/767#issuecomment-634675591",
    "issue_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/767",
    "id": 634675591,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNDY3NTU5MQ==",
    "user": {
      "login": "axic",
      "id": 20340,
      "node_id": "MDQ6VXNlcjIwMzQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/20340?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/axic",
      "html_url": "https://github.com/axic",
      "followers_url": "https://api.github.com/users/axic/followers",
      "following_url": "https://api.github.com/users/axic/following{/other_user}",
      "gists_url": "https://api.github.com/users/axic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/axic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/axic/subscriptions",
      "organizations_url": "https://api.github.com/users/axic/orgs",
      "repos_url": "https://api.github.com/users/axic/repos",
      "events_url": "https://api.github.com/users/axic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/axic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-27T13:51:43Z",
    "updated_at": "2020-05-27T13:51:43Z",
    "author_association": "MEMBER",
    "body": "Any decision yet? :wink:",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/634675591/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/635541264",
    "html_url": "https://github.com/ethereum/yellowpaper/issues/767#issuecomment-635541264",
    "issue_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/767",
    "id": 635541264,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNTU0MTI2NA==",
    "user": {
      "login": "acoglio",
      "id": 2409151,
      "node_id": "MDQ6VXNlcjI0MDkxNTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2409151?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/acoglio",
      "html_url": "https://github.com/acoglio",
      "followers_url": "https://api.github.com/users/acoglio/followers",
      "following_url": "https://api.github.com/users/acoglio/following{/other_user}",
      "gists_url": "https://api.github.com/users/acoglio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/acoglio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/acoglio/subscriptions",
      "organizations_url": "https://api.github.com/users/acoglio/orgs",
      "repos_url": "https://api.github.com/users/acoglio/repos",
      "events_url": "https://api.github.com/users/acoglio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/acoglio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-28T19:11:10Z",
    "updated_at": "2020-05-28T19:11:10Z",
    "author_association": "MEMBER",
    "body": "Looking at this again, I still stand by my proposal above. @ekpyron what do you think? If you agree, I can make a PR with the proposed change, leave it there for a few days, and eventually merge.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/635541264/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/637377604",
    "html_url": "https://github.com/ethereum/yellowpaper/issues/767#issuecomment-637377604",
    "issue_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/767",
    "id": 637377604,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNzM3NzYwNA==",
    "user": {
      "login": "ekpyron",
      "id": 1347491,
      "node_id": "MDQ6VXNlcjEzNDc0OTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1347491?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ekpyron",
      "html_url": "https://github.com/ekpyron",
      "followers_url": "https://api.github.com/users/ekpyron/followers",
      "following_url": "https://api.github.com/users/ekpyron/following{/other_user}",
      "gists_url": "https://api.github.com/users/ekpyron/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ekpyron/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ekpyron/subscriptions",
      "organizations_url": "https://api.github.com/users/ekpyron/orgs",
      "repos_url": "https://api.github.com/users/ekpyron/repos",
      "events_url": "https://api.github.com/users/ekpyron/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ekpyron/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-02T08:24:45Z",
    "updated_at": "2020-06-02T08:24:45Z",
    "author_association": "MEMBER",
    "body": "@acoglio Yes, your proposal still sounds like a fine solution to me!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/637377604/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/638402787",
    "html_url": "https://github.com/ethereum/yellowpaper/issues/767#issuecomment-638402787",
    "issue_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/767",
    "id": 638402787,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzODQwMjc4Nw==",
    "user": {
      "login": "acoglio",
      "id": 2409151,
      "node_id": "MDQ6VXNlcjI0MDkxNTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2409151?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/acoglio",
      "html_url": "https://github.com/acoglio",
      "followers_url": "https://api.github.com/users/acoglio/followers",
      "following_url": "https://api.github.com/users/acoglio/following{/other_user}",
      "gists_url": "https://api.github.com/users/acoglio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/acoglio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/acoglio/subscriptions",
      "organizations_url": "https://api.github.com/users/acoglio/orgs",
      "repos_url": "https://api.github.com/users/acoglio/repos",
      "events_url": "https://api.github.com/users/acoglio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/acoglio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-03T19:09:10Z",
    "updated_at": "2020-06-03T19:09:10Z",
    "author_association": "MEMBER",
    "body": "Thanks. I just made the PR -- https://github.com/ethereum/yellowpaper/pull/775\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/638402787/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
