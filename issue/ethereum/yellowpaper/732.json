{
  "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/732",
  "repository_url": "https://api.github.com/repos/ethereum/yellowpaper",
  "labels_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/732/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/732/comments",
  "events_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/732/events",
  "html_url": "https://github.com/ethereum/yellowpaper/issues/732",
  "id": 411371499,
  "node_id": "MDU6SXNzdWU0MTEzNzE0OTk=",
  "number": 732,
  "title": "Incorrect gas forwarding in DELEGATECALL definition",
  "user": {
    "login": "livnev",
    "id": 3964494,
    "node_id": "MDQ6VXNlcjM5NjQ0OTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3964494?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/livnev",
    "html_url": "https://github.com/livnev",
    "followers_url": "https://api.github.com/users/livnev/followers",
    "following_url": "https://api.github.com/users/livnev/following{/other_user}",
    "gists_url": "https://api.github.com/users/livnev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/livnev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/livnev/subscriptions",
    "organizations_url": "https://api.github.com/users/livnev/orgs",
    "repos_url": "https://api.github.com/users/livnev/repos",
    "events_url": "https://api.github.com/users/livnev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/livnev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2019-02-18T09:12:10Z",
  "updated_at": "2019-04-11T22:31:24Z",
  "closed_at": "2019-04-11T22:31:24Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "The definition of `DELEGATECALL` suggests that the amount of gas forwarded for execution is equal to the first stack argument, while in `CALL` the amount forwarded is given by the `C_callgas` formula. I'm pretty sure that the latter is correct, since the former would be kind of absurd, allowing arbitrary amounts of gas inside `DELEGATECALL` execution. To double check, the Jello Paper also supports the version where the amount forwarded is computed in the same way as in `CALL` (note the use of `Ccallgas`):\r\n\r\n```\r\n\r\n    syntax CallSixOp ::= \"DELEGATECALL\"\r\n // -----------------------------------\r\n    rule <k> DELEGATECALL GCAP ACCTTO ARGSTART ARGWIDTH RETSTART RETWIDTH\r\n          => #checkCall ACCTFROM 0\r\n          ~> #call ACCTAPPFROM ACCTFROM ACCTTO Ccallgas(SCHED, #accountNonexistent(ACCTFROM), GCAP, GAVAIL, 0) 0 VALUE #range(LM, ARGSTART, ARGWIDTH) false\r\n          ~> #return RETSTART RETWIDTH\r\n         ...\r\n         </k>\r\n         <schedule> SCHED </schedule>\r\n         <id> ACCTFROM </id>\r\n         <caller> ACCTAPPFROM </caller>\r\n         <callValue> VALUE </callValue>\r\n         <localMem> LM </localMem>\r\n         <previousGas> GAVAIL </previousGas>\r\n```\r\n\r\nSo I believe the sixth argument of `Theta` in the definition of `DELEGATECALL` should be `C_callgas(mu)`. This is a critical issue since it means that implementers following the Yellow Paper would write incorrect semantics for `DELEGATECALL`.",
  "closed_by": {
    "login": "nicksavers",
    "id": 7483198,
    "node_id": "MDQ6VXNlcjc0ODMxOTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7483198?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nicksavers",
    "html_url": "https://github.com/nicksavers",
    "followers_url": "https://api.github.com/users/nicksavers/followers",
    "following_url": "https://api.github.com/users/nicksavers/following{/other_user}",
    "gists_url": "https://api.github.com/users/nicksavers/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nicksavers/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nicksavers/subscriptions",
    "organizations_url": "https://api.github.com/users/nicksavers/orgs",
    "repos_url": "https://api.github.com/users/nicksavers/repos",
    "events_url": "https://api.github.com/users/nicksavers/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nicksavers/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/732/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/732/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/468404020",
    "html_url": "https://github.com/ethereum/yellowpaper/issues/732#issuecomment-468404020",
    "issue_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/732",
    "id": 468404020,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2ODQwNDAyMA==",
    "user": {
      "login": "livnev",
      "id": 3964494,
      "node_id": "MDQ6VXNlcjM5NjQ0OTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3964494?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/livnev",
      "html_url": "https://github.com/livnev",
      "followers_url": "https://api.github.com/users/livnev/followers",
      "following_url": "https://api.github.com/users/livnev/following{/other_user}",
      "gists_url": "https://api.github.com/users/livnev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/livnev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/livnev/subscriptions",
      "organizations_url": "https://api.github.com/users/livnev/orgs",
      "repos_url": "https://api.github.com/users/livnev/repos",
      "events_url": "https://api.github.com/users/livnev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/livnev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-28T19:25:56Z",
    "updated_at": "2019-02-28T19:25:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "Oh, it appears that the KEVM folks also noticed this issue: it's mentioned as the last bullet point in the section \"Issues with description of EVM\" [here](https://jellopaper.org/issues/#issues-with-description-of-evm).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/468404020/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/480595951",
    "html_url": "https://github.com/ethereum/yellowpaper/issues/732#issuecomment-480595951",
    "issue_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/732",
    "id": 480595951,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MDU5NTk1MQ==",
    "user": {
      "login": "MrChico",
      "id": 8930559,
      "node_id": "MDQ6VXNlcjg5MzA1NTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8930559?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MrChico",
      "html_url": "https://github.com/MrChico",
      "followers_url": "https://api.github.com/users/MrChico/followers",
      "following_url": "https://api.github.com/users/MrChico/following{/other_user}",
      "gists_url": "https://api.github.com/users/MrChico/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MrChico/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MrChico/subscriptions",
      "organizations_url": "https://api.github.com/users/MrChico/orgs",
      "repos_url": "https://api.github.com/users/MrChico/repos",
      "events_url": "https://api.github.com/users/MrChico/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MrChico/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-07T14:37:28Z",
    "updated_at": "2019-04-07T14:37:28Z",
    "author_association": "MEMBER",
    "body": "Ping @nicksavers ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/480595951/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/481143461",
    "html_url": "https://github.com/ethereum/yellowpaper/issues/732#issuecomment-481143461",
    "issue_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/732",
    "id": 481143461,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MTE0MzQ2MQ==",
    "user": {
      "login": "nicksavers",
      "id": 7483198,
      "node_id": "MDQ6VXNlcjc0ODMxOTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7483198?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nicksavers",
      "html_url": "https://github.com/nicksavers",
      "followers_url": "https://api.github.com/users/nicksavers/followers",
      "following_url": "https://api.github.com/users/nicksavers/following{/other_user}",
      "gists_url": "https://api.github.com/users/nicksavers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nicksavers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nicksavers/subscriptions",
      "organizations_url": "https://api.github.com/users/nicksavers/orgs",
      "repos_url": "https://api.github.com/users/nicksavers/repos",
      "events_url": "https://api.github.com/users/nicksavers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nicksavers/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-09T07:53:36Z",
    "updated_at": "2019-04-09T07:53:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "This has been part of the document since the addition of `DELEGATECALL` here https://github.com/ethereum/yellowpaper/commit/0de6d7d727b8eee85cf4801f0933c81e52238397#diff-9f702e1491c55da9d76a68d651278764R1981 in accordance with https://eips.ethereum.org/EIPS/eip-7\r\nCurrently checking with @aeronbuchanan & @gavofyork to verify that it was intentional or a mistake.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/481143461/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/481171413",
    "html_url": "https://github.com/ethereum/yellowpaper/issues/732#issuecomment-481171413",
    "issue_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/732",
    "id": 481171413,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MTE3MTQxMw==",
    "user": {
      "login": "livnev",
      "id": 3964494,
      "node_id": "MDQ6VXNlcjM5NjQ0OTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3964494?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/livnev",
      "html_url": "https://github.com/livnev",
      "followers_url": "https://api.github.com/users/livnev/followers",
      "following_url": "https://api.github.com/users/livnev/following{/other_user}",
      "gists_url": "https://api.github.com/users/livnev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/livnev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/livnev/subscriptions",
      "organizations_url": "https://api.github.com/users/livnev/orgs",
      "repos_url": "https://api.github.com/users/livnev/repos",
      "events_url": "https://api.github.com/users/livnev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/livnev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-09T09:16:26Z",
    "updated_at": "2019-04-09T09:16:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "@nicksavers note that the easiest example that differentiates between what's written here and what is actually on the live network (and KEVM etc.) is: if you delegatecall with an amount of gas that's greater than the amount available, following what the yellow paper currently says literally tells you that you'll have that amount of gas available inside the delegatecall, i.e. there is no limit to how much gas you can have in the subcall. \r\n\r\n#### Explanation\r\n\r\n\r\n![screenshot381](https://user-images.githubusercontent.com/3964494/55787994-6d3cf980-5aaf-11e9-99c6-fedc90f9055f.png)\r\n![screenshot382](https://user-images.githubusercontent.com/3964494/55787997-6f9f5380-5aaf-11e9-9c15-78db759724b3.png)\r\n![screenshot384](https://user-images.githubusercontent.com/3964494/55788152-b4c38580-5aaf-11e9-91a7-ed4b56c7a23e.png)\r\nso if the element at the top of the stack when I delegatecall is `G`, the initial gas cost of the call will be `C_gascap = min(L(remaining_gas - 700), G)`, i.e. it's capped at `63/64 * (remaining_gas - 700)` no matter what. But meanwhile, the amount of gas available inside the delegatecall is given by sixth argument to `Theta` here:\r\n\r\n![screenshot383](https://user-images.githubusercontent.com/3964494/55788002-70d08080-5aaf-11e9-9b53-f1efc6a69d8f.png)\r\n\r\ni.e. `G` itself. Thus while our gas cost for the call is bounded, the amount of gas we are getting is unbounded, which is clearly absurd (and can be verified to be empirically not the case in all implementations). The proposed fix is in PR #733 ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/481171413/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/482350847",
    "html_url": "https://github.com/ethereum/yellowpaper/issues/732#issuecomment-482350847",
    "issue_url": "https://api.github.com/repos/ethereum/yellowpaper/issues/732",
    "id": 482350847,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MjM1MDg0Nw==",
    "user": {
      "login": "nicksavers",
      "id": 7483198,
      "node_id": "MDQ6VXNlcjc0ODMxOTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7483198?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nicksavers",
      "html_url": "https://github.com/nicksavers",
      "followers_url": "https://api.github.com/users/nicksavers/followers",
      "following_url": "https://api.github.com/users/nicksavers/following{/other_user}",
      "gists_url": "https://api.github.com/users/nicksavers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nicksavers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nicksavers/subscriptions",
      "organizations_url": "https://api.github.com/users/nicksavers/orgs",
      "repos_url": "https://api.github.com/users/nicksavers/repos",
      "events_url": "https://api.github.com/users/nicksavers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nicksavers/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-11T22:31:24Z",
    "updated_at": "2019-04-11T22:31:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "Merged",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/yellowpaper/issues/comments/482350847/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
