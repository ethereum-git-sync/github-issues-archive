{
  "url": "https://api.github.com/repos/ethereum/tests/issues/770",
  "repository_url": "https://api.github.com/repos/ethereum/tests",
  "labels_url": "https://api.github.com/repos/ethereum/tests/issues/770/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/tests/issues/770/comments",
  "events_url": "https://api.github.com/repos/ethereum/tests/issues/770/events",
  "html_url": "https://github.com/ethereum/tests/issues/770",
  "id": 762257871,
  "node_id": "MDU6SXNzdWU3NjIyNTc4NzE=",
  "number": 770,
  "title": "Possible wrong post state root on ZeroCallTests",
  "user": {
    "login": "leonardostsouza",
    "id": 5089577,
    "node_id": "MDQ6VXNlcjUwODk1Nzc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5089577?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/leonardostsouza",
    "html_url": "https://github.com/leonardostsouza",
    "followers_url": "https://api.github.com/users/leonardostsouza/followers",
    "following_url": "https://api.github.com/users/leonardostsouza/following{/other_user}",
    "gists_url": "https://api.github.com/users/leonardostsouza/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/leonardostsouza/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leonardostsouza/subscriptions",
    "organizations_url": "https://api.github.com/users/leonardostsouza/orgs",
    "repos_url": "https://api.github.com/users/leonardostsouza/repos",
    "events_url": "https://api.github.com/users/leonardostsouza/events{/privacy}",
    "received_events_url": "https://api.github.com/users/leonardostsouza/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-12-11T11:27:29Z",
  "updated_at": "2020-12-14T08:41:17Z",
  "closed_at": "2020-12-14T08:41:16Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Some of the tests seem to be considering empty accounts to calculate the post state root. From what I understand about the protocol, the empty accounts should be treated similar to non-existing accounts, so this would be incorrect behavior. Is there any exception to this rule I am not aware of?\r\n\r\nA quick example to illustrate what I am talking about:\r\n```\r\n==> LegacyTests/Constantinople/GeneralStateTests/stZeroCallsTest/ZeroValue_CALLCODE_ToEmpty (Byzantium):\r\nFinal State:\r\n================\r\n::: Account 0x2adc25665018aa1fe0e6bc666dac8fc2697ff9ba\r\n:::     nonce   :  0x0\r\n:::     balance :  0x13f46\r\n:::     code    :  0x\r\n:::     storage : {}\r\n\r\n::: Account 0xa94f5374fce5edbc8e2a8697c15331677e6ebf0b\r\n:::     nonce   :  0x1\r\n:::     balance :  0xe8d4a3d0ba\r\n:::     code    :  0x\r\n:::     storage : {}\r\n\r\n::: Account 0xb94f5374fce5edbc8e2a8697c15331677e6ebf0b\r\n:::     nonce   :  0x0\r\n:::     balance :  0x0\r\n:::     code    :  0x5a6000556000600060006000600073c94f5374fce5edbc8e2a8697c15331677e6ebf0b61ea60f26001555a606455\r\n:::     storage : {'0x00': '0x08d5b6', '0x01': '0x01', '0x64': '0x08369d'}\r\n\r\n::: Account 0xc94f5374fce5edbc8e2a8697c15331677e6ebf0b\r\n:::     nonce   :  0x0\r\n:::     balance :  0x0\r\n:::     code    :  0x\r\n:::     storage : {}\r\n```\r\nCorrect final state root according to the test file (includes the empty account 0xc94f5374fce5edbc8e2a8697c15331677e6ebf0b): `0x1c57ca04dea8d4f09c81c54593838c45cf059d13dcfb9f9d70dca2bc1ad285e9`\r\n\r\nState root I would expect (not considering account 0xc94f5374fce5edbc8e2a8697c15331677e6ebf0b): `0x1531bd9ebfed425c01ab97871c2f5415683b614160c0de07e95ca46a3f8222e3`\r\n\r\n\r\n\r\nI could observe similar behavior in the following tests for all forks:\r\n* LegacyTests/Constantinople/GeneralStateTests/stZeroCallsTest/ZeroValue_CALLCODE_ToEmpty\r\n* LegacyTests/Constantinople/GeneralStateTests/stZeroCallsTest/ZeroValue_CALLCODE_ToOneStorageKey\r\n* LegacyTests/Constantinople/GeneralStateTests/stZeroCallsTest/ZeroValue_DELEGATECALL_ToEmpty\r\n* LegacyTests/Constantinople/GeneralStateTests/stZeroCallsTest/ZeroValue_DELEGATECALL_ToOneStorageKey\r\n\r\nI didn't check how the non-legacy tests are behaving.\r\nAre the tests really expecting the correct state root?\r\n",
  "closed_by": {
    "login": "leonardostsouza",
    "id": 5089577,
    "node_id": "MDQ6VXNlcjUwODk1Nzc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5089577?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/leonardostsouza",
    "html_url": "https://github.com/leonardostsouza",
    "followers_url": "https://api.github.com/users/leonardostsouza/followers",
    "following_url": "https://api.github.com/users/leonardostsouza/following{/other_user}",
    "gists_url": "https://api.github.com/users/leonardostsouza/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/leonardostsouza/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leonardostsouza/subscriptions",
    "organizations_url": "https://api.github.com/users/leonardostsouza/orgs",
    "repos_url": "https://api.github.com/users/leonardostsouza/repos",
    "events_url": "https://api.github.com/users/leonardostsouza/events{/privacy}",
    "received_events_url": "https://api.github.com/users/leonardostsouza/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/tests/issues/770/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/tests/issues/770/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/tests/issues/comments/743149424",
    "html_url": "https://github.com/ethereum/tests/issues/770#issuecomment-743149424",
    "issue_url": "https://api.github.com/repos/ethereum/tests/issues/770",
    "id": 743149424,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MzE0OTQyNA==",
    "user": {
      "login": "winsvega",
      "id": 4492341,
      "node_id": "MDQ6VXNlcjQ0OTIzNDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4492341?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/winsvega",
      "html_url": "https://github.com/winsvega",
      "followers_url": "https://api.github.com/users/winsvega/followers",
      "following_url": "https://api.github.com/users/winsvega/following{/other_user}",
      "gists_url": "https://api.github.com/users/winsvega/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/winsvega/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/winsvega/subscriptions",
      "organizations_url": "https://api.github.com/users/winsvega/orgs",
      "repos_url": "https://api.github.com/users/winsvega/repos",
      "events_url": "https://api.github.com/users/winsvega/events{/privacy}",
      "received_events_url": "https://api.github.com/users/winsvega/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-11T11:50:04Z",
    "updated_at": "2020-12-11T11:51:44Z",
    "author_association": "MEMBER",
    "body": "The empty account present in a state for the root hash by default. Unless after eip158, if it was touched during the call, it is removed from state. \r\n\r\nhttps://github.com/ethereum/eips/issues/158",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/tests/issues/comments/743149424/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/tests/issues/comments/744278325",
    "html_url": "https://github.com/ethereum/tests/issues/770#issuecomment-744278325",
    "issue_url": "https://api.github.com/repos/ethereum/tests/issues/770",
    "id": 744278325,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NDI3ODMyNQ==",
    "user": {
      "login": "leonardostsouza",
      "id": 5089577,
      "node_id": "MDQ6VXNlcjUwODk1Nzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5089577?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/leonardostsouza",
      "html_url": "https://github.com/leonardostsouza",
      "followers_url": "https://api.github.com/users/leonardostsouza/followers",
      "following_url": "https://api.github.com/users/leonardostsouza/following{/other_user}",
      "gists_url": "https://api.github.com/users/leonardostsouza/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/leonardostsouza/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leonardostsouza/subscriptions",
      "organizations_url": "https://api.github.com/users/leonardostsouza/orgs",
      "repos_url": "https://api.github.com/users/leonardostsouza/repos",
      "events_url": "https://api.github.com/users/leonardostsouza/events{/privacy}",
      "received_events_url": "https://api.github.com/users/leonardostsouza/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-14T08:41:16Z",
    "updated_at": "2020-12-14T08:41:16Z",
    "author_association": "NONE",
    "body": "I see. Thanks for the clarification. It was very helpful",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/tests/issues/comments/744278325/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
