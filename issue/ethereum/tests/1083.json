{
  "url": "https://api.github.com/repos/ethereum/tests/issues/1083",
  "repository_url": "https://api.github.com/repos/ethereum/tests",
  "labels_url": "https://api.github.com/repos/ethereum/tests/issues/1083/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/tests/issues/1083/comments",
  "events_url": "https://api.github.com/repos/ethereum/tests/issues/1083/events",
  "html_url": "https://github.com/ethereum/tests/issues/1083",
  "id": 1387757167,
  "node_id": "I_kwDOAO0i585St35v",
  "number": 1083,
  "title": "Besu consensus failure-test",
  "user": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "marioevz",
    "id": 11726710,
    "node_id": "MDQ6VXNlcjExNzI2NzEw",
    "avatar_url": "https://avatars.githubusercontent.com/u/11726710?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/marioevz",
    "html_url": "https://github.com/marioevz",
    "followers_url": "https://api.github.com/users/marioevz/followers",
    "following_url": "https://api.github.com/users/marioevz/following{/other_user}",
    "gists_url": "https://api.github.com/users/marioevz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/marioevz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/marioevz/subscriptions",
    "organizations_url": "https://api.github.com/users/marioevz/orgs",
    "repos_url": "https://api.github.com/users/marioevz/repos",
    "events_url": "https://api.github.com/users/marioevz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/marioevz/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "marioevz",
      "id": 11726710,
      "node_id": "MDQ6VXNlcjExNzI2NzEw",
      "avatar_url": "https://avatars.githubusercontent.com/u/11726710?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marioevz",
      "html_url": "https://github.com/marioevz",
      "followers_url": "https://api.github.com/users/marioevz/followers",
      "following_url": "https://api.github.com/users/marioevz/following{/other_user}",
      "gists_url": "https://api.github.com/users/marioevz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marioevz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marioevz/subscriptions",
      "organizations_url": "https://api.github.com/users/marioevz/orgs",
      "repos_url": "https://api.github.com/users/marioevz/repos",
      "events_url": "https://api.github.com/users/marioevz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marioevz/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2022-09-27T13:21:39Z",
  "updated_at": "2022-10-13T11:10:44Z",
  "closed_at": "2022-10-13T11:10:44Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "See https://github.com/hyperledger/besu/security/advisories/GHSA-4456-w38r-m53x and write-up https://hackmd.io/@shemnon/besu-gas-leak . \r\nHere is the state-test that triggered the bug: \r\n\r\n```json\r\n{\r\n  \"00009060-naivefuzz-0\": {\r\n    \"env\": {\r\n      \"currentCoinbase\": \"b94f5374fce5edbc8e2a8697c15331677e6ebf0b\",\r\n      \"currentDifficulty\": \"0x20000\",\r\n      \"currentGasLimit\": \"0x26e1f476fe1e22\",\r\n      \"currentNumber\": \"0x1\",\r\n      \"currentTimestamp\": \"0x3e8\",\r\n      \"previousHash\": \"0x0000000000000000000000000000000000000000000000000000000000000000\",\r\n      \"currentBaseFee\": \"0x10\"\r\n    },\r\n    \"pre\": {\r\n      \"0x00000000000000000000000000000000000000f1\": {\r\n        \"code\": \"0x600060016001600260026101f461ffff35957386068b775b8e2078653c115b3a01a13d5359a0737fa111839b1340f48b9f5751615b405459645a036b6b8568768fa390867c9237470967f3a28f1d03f11d14f41d11313974326e8fa0907d81fe51968f9859488489540459148750939f8a43f1017f05023a05a15310978290903388340b93537c747064f18b7f15faf4104764a268620991849d117c84a38764f34846441b447e440002f4526c04473d37a23357979e1b930313a295fa3b90957758389816f460758660f594848f8394654198a10856887f516a003794987f30097e877a8b7e79835b556a076c7900a44515a11d53093f820a6e5738fe697a8f7167446a9e44990b696509331190f0021370640819389608098c68379620fe9e8d1d6b590670f21b72806f7554a459183b085584600b9b1b5a080789976a10a21d111d8a52fe395646750b94558405883b68039e685a8851167b115b9e99f5fd45921319106b7c176f917447f49b98675b8b88a09cf402f4f08e9166fe3e7202627820539c60399807326738083f6c029f7b70606a029035063a9589440967fe187d7095379808f263976812563e9837a0181c1719321b0aa2458c3b04f24010a3893f71070484f0f36e844043fe5a0af11331206e42931870569b0b9b86934106fa73f23e167183921757a135f4008095886bf4083954023a878110108a006c7ff3901869a0530a315102f35516403d4796169a7411209a13607940f2f3f53597a3823a597104136f95778690535341726117895942689a7063043ffe3f07fa723e61731a70401a74371b7d88193b446c527c9ba4743b5543377805997d17853f94a19232689aa19f37123b704633966b0656013b11538c721765603099373b51549f6e876503973343183fa408095670ff6ff1458e8c8f3745f0518854181b6c9d4106a302828534fd7d8c438c965a7112009d75049c8d7e9192fe8493007438f587083e476599083e551991837c9ff45504311d9f774738009f8c02915766f300746f035289703a91ff6e44a13704f53e89a49e8e01856a6a8c7e6692fff374a37396198a40a4a037169b3a1b56723b038537340a8c418f90583b410a33921c613484607e761108610632f18e7b9446f25970037902577ca27f41f387036f588f6383f27952f210624586891498faf27c3a50a46e37519f313dff84a1673e148673f28847503084765a089566fa7d74a46c327202831130f274a3366583156e67443f747bf4569657f177fd74588f5b936738699c8f605bfd3f14431c4537979447087f617e7f663b667997133f3c6005fdfd8a9c3345488b3067361c06458b035b565195679e1904faff8688199330681d89511ba4a25166a17b53faf4038d609259537d56188d8c74015a74ff5308969d409f8970697f897da48a953c6453\",\r\n        \"storage\": {\r\n          \"0x0000000000000000000000000000000000000000000000000000000000000000\": \"0x000000000000000000000000000000000000000000000000000000000000000a\",\r\n          \"0x0000000000000000000000000000000000000000000000000000000000000002\": \"0x0000000000000000000000000000000000000000000000000000000000000009\"\r\n        },\r\n        \"balance\": \"0x0\",\r\n        \"nonce\": \"0x0\"\r\n      },\r\n      \"0xa94f5374fce5edbc8e2a8697c15331677e6ebf0b\": {\r\n        \"code\": \"0x\",\r\n        \"storage\": {},\r\n        \"balance\": \"0xffffffffff\",\r\n        \"nonce\": \"0x0\"\r\n      }\r\n    },\r\n    \"transaction\": {\r\n      \"gasPrice\": \"0x10\",\r\n      \"nonce\": \"0x0\",\r\n      \"to\": \"0x00000000000000000000000000000000000000f1\",\r\n      \"data\": [\r\n        \"0x43562518f9e3e6d0bf88d49ed259be6528ae249bfdc4255b88fd51c08d3cf881f9841d8a0c6b0b8cde08cb2d23054f9d4c574148d16924fa79870ca8\"\r\n      ],\r\n      \"gasLimit\": [\r\n        \"0x7a1200\"\r\n      ],\r\n      \"value\": [\r\n        \"0xdf1608\"\r\n      ],\r\n      \"secretKey\": \"0x45a915e4d060149eb4365960e6a7a45f334393093061116b197e3240065ff2d8\"\r\n    },\r\n    \"out\": \"0x\",\r\n    \"post\": {\r\n      \"London\": [\r\n        {\r\n          \"hash\": \"0x00a46c5f189e4b58a20be94d60ca817f07e9eba09952f5d7bba983a7a309ee2c\",\r\n          \"logs\": \"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347\",\r\n          \"indexes\": {\r\n            \"data\": 0,\r\n            \"gas\": 0,\r\n            \"value\": 0\r\n          }\r\n        }\r\n      ]\r\n    }\r\n  }\r\n}\r\n\r\n```\r\nAnd output when executing it on geth `evm`: \r\n```\r\n[user@work evm]$ ./evm --json statetest ordered.json \r\n{\"pc\":0,\"op\":96,\"gas\":\"0x79bc38\",\"gasCost\":\"0x3\",\"memSize\":0,\"stack\":[],\"depth\":1,\"refund\":0,\"opName\":\"PUSH1\"}\r\n{\"pc\":2,\"op\":96,\"gas\":\"0x79bc35\",\"gasCost\":\"0x3\",\"memSize\":0,\"stack\":[\"0x0\"],\"depth\":1,\"refund\":0,\"opName\":\"PUSH1\"}\r\n{\"pc\":4,\"op\":96,\"gas\":\"0x79bc32\",\"gasCost\":\"0x3\",\"memSize\":0,\"stack\":[\"0x0\",\"0x1\"],\"depth\":1,\"refund\":0,\"opName\":\"PUSH1\"}\r\n{\"pc\":6,\"op\":96,\"gas\":\"0x79bc2f\",\"gasCost\":\"0x3\",\"memSize\":0,\"stack\":[\"0x0\",\"0x1\",\"0x1\"],\"depth\":1,\"refund\":0,\"opName\":\"PUSH1\"}\r\n{\"pc\":8,\"op\":96,\"gas\":\"0x79bc2c\",\"gasCost\":\"0x3\",\"memSize\":0,\"stack\":[\"0x0\",\"0x1\",\"0x1\",\"0x2\"],\"depth\":1,\"refund\":0,\"opName\":\"PUSH1\"}\r\n{\"pc\":10,\"op\":97,\"gas\":\"0x79bc29\",\"gasCost\":\"0x3\",\"memSize\":0,\"stack\":[\"0x0\",\"0x1\",\"0x1\",\"0x2\",\"0x2\"],\"depth\":1,\"refund\":0,\"opName\":\"PUSH2\"}\r\n{\"pc\":13,\"op\":97,\"gas\":\"0x79bc26\",\"gasCost\":\"0x3\",\"memSize\":0,\"stack\":[\"0x0\",\"0x1\",\"0x1\",\"0x2\",\"0x2\",\"0x1f4\"],\"depth\":1,\"refund\":0,\"opName\":\"PUSH2\"}\r\n{\"pc\":16,\"op\":53,\"gas\":\"0x79bc23\",\"gasCost\":\"0x3\",\"memSize\":0,\"stack\":[\"0x0\",\"0x1\",\"0x1\",\"0x2\",\"0x2\",\"0x1f4\",\"0xffff\"],\"depth\":1,\"refund\":0,\"opName\":\"CALLDATALOAD\"}\r\n{\"pc\":17,\"op\":149,\"gas\":\"0x79bc20\",\"gasCost\":\"0x3\",\"memSize\":0,\"stack\":[\"0x0\",\"0x1\",\"0x1\",\"0x2\",\"0x2\",\"0x1f4\",\"0x0\"],\"depth\":1,\"refund\":0,\"opName\":\"SWAP6\"}\r\n{\"pc\":18,\"op\":115,\"gas\":\"0x79bc1d\",\"gasCost\":\"0x3\",\"memSize\":0,\"stack\":[\"0x0\",\"0x1\",\"0x1\",\"0x2\",\"0x2\",\"0x1f4\",\"0x0\"],\"depth\":1,\"refund\":0,\"opName\":\"PUSH20\"}\r\n{\"pc\":39,\"op\":127,\"gas\":\"0x79bc1a\",\"gasCost\":\"0x3\",\"memSize\":0,\"stack\":[\"0x0\",\"0x1\",\"0x1\",\"0x2\",\"0x2\",\"0x1f4\",\"0x0\",\"0x86068b775b8e2078653c115b3a01a13d5359a073\"],\"depth\":1,\"refund\":0,\"opName\":\"PUSH32\"}\r\n{\"pc\":72,\"op\":9,\"gas\":\"0x79bc17\",\"gasCost\":\"0x8\",\"memSize\":0,\"stack\":[\"0x0\",\"0x1\",\"0x1\",\"0x2\",\"0x2\",\"0x1f4\",\"0x0\",\"0x86068b775b8e2078653c115b3a01a13d5359a073\",\"0xa111839b1340f48b9f5751615b405459645a036b6b8568768fa390867c923747\"],\"depth\":1,\"refund\":0,\"opName\":\"MULMOD\"}\r\n{\"pc\":73,\"op\":103,\"gas\":\"0x79bc0f\",\"gasCost\":\"0x3\",\"memSize\":0,\"stack\":[\"0x0\",\"0x1\",\"0x1\",\"0x2\",\"0x2\",\"0x1f4\",\"0x0\"],\"depth\":1,\"refund\":0,\"opName\":\"PUSH8\"}\r\n{\"pc\":82,\"op\":244,\"gas\":\"0x79bc0c\",\"gasCost\":\"0x77d546\",\"memSize\":0,\"stack\":[\"0x0\",\"0x1\",\"0x1\",\"0x2\",\"0x2\",\"0x1f4\",\"0x0\",\"0xf3a28f1d03f11d14\"],\"depth\":1,\"refund\":0,\"opName\":\"DELEGATECALL\"}\r\n{\"pc\":83,\"op\":29,\"gas\":\"0x79b1b4\",\"gasCost\":\"0x3\",\"memSize\":512,\"stack\":[\"0x0\",\"0x1\",\"0x1\"],\"depth\":1,\"refund\":0,\"opName\":\"SAR\"}\r\n{\"pc\":84,\"op\":17,\"gas\":\"0x79b1b1\",\"gasCost\":\"0x3\",\"memSize\":512,\"stack\":[\"0x0\",\"0x0\"],\"depth\":1,\"refund\":0,\"opName\":\"GT\"}\r\n{\"pc\":85,\"op\":49,\"gas\":\"0x79b1ae\",\"gasCost\":\"0x64\",\"memSize\":512,\"stack\":[\"0x0\"],\"depth\":1,\"refund\":0,\"opName\":\"BALANCE\"}\r\n{\"pc\":86,\"op\":57,\"gas\":\"0x79b14a\",\"gasCost\":\"0x3\",\"memSize\":512,\"stack\":[\"0x0\"],\"depth\":1,\"refund\":0,\"opName\":\"CODECOPY\",\"error\":\"stack underflow (1 \\u003c=\\u003e 3)\"}\r\n{\"output\":\"\",\"gasUsed\":\"0x79bc38\",\"time\":213278,\"error\":\"stack underflow (1 \\u003c=\\u003e 3)\"}\r\n{\"stateRoot\": \"00a46c5f189e4b58a20be94d60ca817f07e9eba09952f5d7bba983a7a309ee2c\"}\r\n[\r\n  {\r\n    \"name\": \"00009060-naivefuzz-0\",\r\n    \"pass\": true,\r\n    \"fork\": \"London\"\r\n  }\r\n]\r\n```\r\nThis statetest should be added to the reference-tests, not sure where you want it, so just filing it as a ticket for now. ",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/tests/issues/1083/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/tests/issues/1083/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
