{
  "url": "https://api.github.com/repos/ethereum/tests/issues/553",
  "repository_url": "https://api.github.com/repos/ethereum/tests",
  "labels_url": "https://api.github.com/repos/ethereum/tests/issues/553/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/tests/issues/553/comments",
  "events_url": "https://api.github.com/repos/ethereum/tests/issues/553/events",
  "html_url": "https://github.com/ethereum/tests/issues/553",
  "id": 384535001,
  "node_id": "MDU6SXNzdWUzODQ1MzUwMDE=",
  "number": 553,
  "title": "Move touch simulation, difficulty and gas calculation - affected tests from State to Blockchain",
  "user": {
    "login": "winsvega",
    "id": 4492341,
    "node_id": "MDQ6VXNlcjQ0OTIzNDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4492341?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/winsvega",
    "html_url": "https://github.com/winsvega",
    "followers_url": "https://api.github.com/users/winsvega/followers",
    "following_url": "https://api.github.com/users/winsvega/following{/other_user}",
    "gists_url": "https://api.github.com/users/winsvega/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/winsvega/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/winsvega/subscriptions",
    "organizations_url": "https://api.github.com/users/winsvega/orgs",
    "repos_url": "https://api.github.com/users/winsvega/repos",
    "events_url": "https://api.github.com/users/winsvega/events{/privacy}",
    "received_events_url": "https://api.github.com/users/winsvega/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2018-11-26T22:18:26Z",
  "updated_at": "2019-08-06T15:05:09Z",
  "closed_at": "2019-08-06T15:04:39Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "With NoProof now supporting Difficulty and BlockGasLimit calculation\r\nsome statetests that use difficulty or gaslimit opcodes must be moved into a blockchain tests.\r\n\r\n**the issue**\r\nI found out what was the issue with tests. \r\nretesteth do not overwrite blockheader with difficulty and gaslimit while running the state test. it just set those arguments for genesis block and thats it. we have recently changed noProof to calculate gasLimit and difficulty also. so when retesteth send a transaction it is executed in the next block where those arguments are already calculated / changed from genesis's (because genesis has no transactions the transaction is being executed at block1)\r\n\r\ntesteth rather overwrite difficulty and gaslimit. thus a blockchain form of any state test is not exactly valid. the first block should change the difficulty and the gasLimit according to noProof. but a block with gasLimit and difficulty that equal to genesis is still valid.\r\n\r\n**solution**\r\n looks like any state test that hash difficulty or gaslimit opcode should be moved to blockchain test. because it is now a blockchain test logic. same as it was with blockhash. and I don't see the reason to set difficulty and gaslimit in state tests env section. \r\n\r\nstate tests that operate near the max gasLimit should be reviewed. \r\n\r\nif to keep those tests in state tests it will require a complicated logic similar to the one that simulates coinbase touch. which is not really good. I think coinbase touch simulation should also be desibled in state tests. and those tests that are affected should be moved. ",
  "closed_by": {
    "login": "winsvega",
    "id": 4492341,
    "node_id": "MDQ6VXNlcjQ0OTIzNDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4492341?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/winsvega",
    "html_url": "https://github.com/winsvega",
    "followers_url": "https://api.github.com/users/winsvega/followers",
    "following_url": "https://api.github.com/users/winsvega/following{/other_user}",
    "gists_url": "https://api.github.com/users/winsvega/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/winsvega/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/winsvega/subscriptions",
    "organizations_url": "https://api.github.com/users/winsvega/orgs",
    "repos_url": "https://api.github.com/users/winsvega/repos",
    "events_url": "https://api.github.com/users/winsvega/events{/privacy}",
    "received_events_url": "https://api.github.com/users/winsvega/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/tests/issues/553/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/tests/issues/553/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/tests/issues/comments/441832710",
    "html_url": "https://github.com/ethereum/tests/issues/553#issuecomment-441832710",
    "issue_url": "https://api.github.com/repos/ethereum/tests/issues/553",
    "id": 441832710,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MTgzMjcxMA==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-26T22:57:50Z",
    "updated_at": "2018-11-26T22:57:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "Pantheon is using option 2 - the 'env' section of general state tests is used to create a `BlockHeader` that provides the context for the transaction to execute in (https://github.com/PegaSysEng/pantheon/blob/5f8059d0559509042944488a611bcf554058d41a/ethereum/core/src/test/java/tech/pegasys/pantheon/ethereum/vm/GeneralStateTestCaseSpec.java#L39)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/tests/issues/comments/441832710/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/tests/issues/comments/442136575",
    "html_url": "https://github.com/ethereum/tests/issues/553#issuecomment-442136575",
    "issue_url": "https://api.github.com/repos/ethereum/tests/issues/553",
    "id": 442136575,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MjEzNjU3NQ==",
    "user": {
      "login": "winsvega",
      "id": 4492341,
      "node_id": "MDQ6VXNlcjQ0OTIzNDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4492341?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/winsvega",
      "html_url": "https://github.com/winsvega",
      "followers_url": "https://api.github.com/users/winsvega/followers",
      "following_url": "https://api.github.com/users/winsvega/following{/other_user}",
      "gists_url": "https://api.github.com/users/winsvega/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/winsvega/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/winsvega/subscriptions",
      "organizations_url": "https://api.github.com/users/winsvega/orgs",
      "repos_url": "https://api.github.com/users/winsvega/repos",
      "events_url": "https://api.github.com/users/winsvega/events{/privacy}",
      "received_events_url": "https://api.github.com/users/winsvega/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-27T17:02:20Z",
    "updated_at": "2018-11-27T17:02:20Z",
    "author_association": "MEMBER",
    "body": "Misunderstanding. \r\nOption 2 is about calculating 1st block difficulty and gasLimit from the values provided by env section \r\nas if env section was a previous block. (genesis)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/tests/issues/comments/442136575/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/tests/issues/comments/442143453",
    "html_url": "https://github.com/ethereum/tests/issues/553#issuecomment-442143453",
    "issue_url": "https://api.github.com/repos/ethereum/tests/issues/553",
    "id": 442143453,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MjE0MzQ1Mw==",
    "user": {
      "login": "winsvega",
      "id": 4492341,
      "node_id": "MDQ6VXNlcjQ0OTIzNDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4492341?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/winsvega",
      "html_url": "https://github.com/winsvega",
      "followers_url": "https://api.github.com/users/winsvega/followers",
      "following_url": "https://api.github.com/users/winsvega/following{/other_user}",
      "gists_url": "https://api.github.com/users/winsvega/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/winsvega/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/winsvega/subscriptions",
      "organizations_url": "https://api.github.com/users/winsvega/orgs",
      "repos_url": "https://api.github.com/users/winsvega/repos",
      "events_url": "https://api.github.com/users/winsvega/events{/privacy}",
      "received_events_url": "https://api.github.com/users/winsvega/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-27T17:20:56Z",
    "updated_at": "2018-11-27T17:25:23Z",
    "author_association": "MEMBER",
    "body": "I found out what was the issue with tests. \r\nretesteth do not overwrite blockheader with difficulty and gaslimit while running the state test. it just set those arguments for genesis block and thats it. we have recently changed noProof to calculate gasLimit and difficulty also. so when retesteth send a transaction it is executed in the next block where those arguments are already calculated / changed from genesis's (because genesis has no transactions the transaction is being executed at block1)\r\n\r\ntesteth rather overwrite difficulty and gaslimit. thus a blockchain form of any state test is not exactly valid. the first block should change the difficulty and the gasLimit according to noProof. but a block with gasLimit and difficulty that equal to genesis is still valid.\r\n\r\n looks like any state test that hash difficulty or gaslimit opcode should be moved to blockchain test. because it is now a blockchain test logic. same as it was with blockhash. and I don't see the reason to set difficulty and gaslimit in state tests env section. \r\n\r\nif to keep those tests in state tests it will require a complicated logic similar to the one that simulates coinbase touch. which is not really good. I think coinbase touch simulation should also be desibled in state tests. and those tests that are affected should be moved. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/tests/issues/comments/442143453/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/tests/issues/comments/475906586",
    "html_url": "https://github.com/ethereum/tests/issues/553#issuecomment-475906586",
    "issue_url": "https://api.github.com/repos/ethereum/tests/issues/553",
    "id": 475906586,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NTkwNjU4Ng==",
    "user": {
      "login": "winsvega",
      "id": 4492341,
      "node_id": "MDQ6VXNlcjQ0OTIzNDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4492341?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/winsvega",
      "html_url": "https://github.com/winsvega",
      "followers_url": "https://api.github.com/users/winsvega/followers",
      "following_url": "https://api.github.com/users/winsvega/following{/other_user}",
      "gists_url": "https://api.github.com/users/winsvega/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/winsvega/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/winsvega/subscriptions",
      "organizations_url": "https://api.github.com/users/winsvega/orgs",
      "repos_url": "https://api.github.com/users/winsvega/repos",
      "events_url": "https://api.github.com/users/winsvega/events{/privacy}",
      "received_events_url": "https://api.github.com/users/winsvega/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-23T21:34:30Z",
    "updated_at": "2019-03-23T21:34:30Z",
    "author_association": "MEMBER",
    "body": "fixed some gasLimit issues in general state tests. it appears to be that all tests has gasLimit change if run as a blockchain. but only a few tests rely on that chagne in a post condition. therefore most tests could be fixed. but some still need to be moved. \r\nhttps://github.com/ethereum/tests/pull/590",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/tests/issues/comments/475906586/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/tests/issues/comments/518710233",
    "html_url": "https://github.com/ethereum/tests/issues/553#issuecomment-518710233",
    "issue_url": "https://api.github.com/repos/ethereum/tests/issues/553",
    "id": 518710233,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxODcxMDIzMw==",
    "user": {
      "login": "winsvega",
      "id": 4492341,
      "node_id": "MDQ6VXNlcjQ0OTIzNDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4492341?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/winsvega",
      "html_url": "https://github.com/winsvega",
      "followers_url": "https://api.github.com/users/winsvega/followers",
      "following_url": "https://api.github.com/users/winsvega/following{/other_user}",
      "gists_url": "https://api.github.com/users/winsvega/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/winsvega/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/winsvega/subscriptions",
      "organizations_url": "https://api.github.com/users/winsvega/orgs",
      "repos_url": "https://api.github.com/users/winsvega/repos",
      "events_url": "https://api.github.com/users/winsvega/events{/privacy}",
      "received_events_url": "https://api.github.com/users/winsvega/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-06T15:04:39Z",
    "updated_at": "2019-08-06T15:05:09Z",
    "author_association": "MEMBER",
    "body": "resolved with \r\nhttps://github.com/ethereum/tests/pull/607\r\n\r\napart from touch simulation",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/tests/issues/comments/518710233/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
