{
  "url": "https://api.github.com/repos/ethereum/remix-project/issues/1618",
  "repository_url": "https://api.github.com/repos/ethereum/remix-project",
  "labels_url": "https://api.github.com/repos/ethereum/remix-project/issues/1618/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/remix-project/issues/1618/comments",
  "events_url": "https://api.github.com/repos/ethereum/remix-project/issues/1618/events",
  "html_url": "https://github.com/ethereum/remix-project/issues/1618",
  "id": 1002713594,
  "node_id": "I_kwDODtLRw847xDH6",
  "number": 1618,
  "title": "Solidity Unit Testing: Custom transaction context does not persist into function calls",
  "user": {
    "login": "samuelfrench",
    "id": 5598505,
    "node_id": "MDQ6VXNlcjU1OTg1MDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5598505?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/samuelfrench",
    "html_url": "https://github.com/samuelfrench",
    "followers_url": "https://api.github.com/users/samuelfrench/followers",
    "following_url": "https://api.github.com/users/samuelfrench/following{/other_user}",
    "gists_url": "https://api.github.com/users/samuelfrench/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/samuelfrench/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/samuelfrench/subscriptions",
    "organizations_url": "https://api.github.com/users/samuelfrench/orgs",
    "repos_url": "https://api.github.com/users/samuelfrench/repos",
    "events_url": "https://api.github.com/users/samuelfrench/events{/privacy}",
    "received_events_url": "https://api.github.com/users/samuelfrench/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-09-21T15:28:16Z",
  "updated_at": "2022-03-08T23:03:00Z",
  "closed_at": "2021-09-24T18:37:16Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Docs: https://remix-ide.readthedocs.io/en/latest/unittesting.html\r\n\r\nThe issue is that while the transaction context works within the test function, it seemingly has no effect when actually calling the contract under test. Here is a minimal example I've created to demonstrate the issue:\r\n\r\n`SampleContract.sol`\r\n```\r\npragma solidity 0.8.7;\r\n\r\ncontract SampleContract {\r\n    function debug() external returns (address) {\r\n        return msg.sender;\r\n    }\r\n}\r\n```\r\n\r\n`Sample_test.sol`\r\n```import \"contracts/SampleContract.sol\";\r\nimport \"remix_tests.sol\"; \r\nimport \"remix_accounts.sol\";\r\n\r\ncontract SampleTest {\r\n    \r\n    SampleContract s;\r\n    \r\n    function beforeEach() public {\r\n        s = new SampleContract();\r\n    }\r\n    \r\n    /// #sender: account-0\r\n    function account0Works () public {\r\n        Assert.equal(msg.sender, TestsAccounts.getAccount(0), \"debug\"); //THIS WORKS\r\n        \r\n        address actualSender = s.debug();\r\n        Assert.equal(actualSender, TestsAccounts.getAccount(0), \"this should work\"); //THIS IS BROKEN\r\n    }\r\n    \r\n    /// #sender: account-1\r\n    function account1IsBroken () public {\r\n        Assert.equal(msg.sender, TestsAccounts.getAccount(1), \"\"); //THIS WORKS\r\n        \r\n        address actualSender = s.debug();\r\n        Assert.equal(actualSender, TestsAccounts.getAccount(1), \"this should work\"); //THIS IS BROKEN - actualSender is the same as previous test case\r\n    }\r\n}\r\n```\r\nAs always, this could easily be a case of operator error, so any suggestions or advice is appreciated.",
  "closed_by": {
    "login": "samuelfrench",
    "id": 5598505,
    "node_id": "MDQ6VXNlcjU1OTg1MDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5598505?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/samuelfrench",
    "html_url": "https://github.com/samuelfrench",
    "followers_url": "https://api.github.com/users/samuelfrench/followers",
    "following_url": "https://api.github.com/users/samuelfrench/following{/other_user}",
    "gists_url": "https://api.github.com/users/samuelfrench/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/samuelfrench/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/samuelfrench/subscriptions",
    "organizations_url": "https://api.github.com/users/samuelfrench/orgs",
    "repos_url": "https://api.github.com/users/samuelfrench/repos",
    "events_url": "https://api.github.com/users/samuelfrench/events{/privacy}",
    "received_events_url": "https://api.github.com/users/samuelfrench/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/remix-project/issues/1618/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/remix-project/issues/1618/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/remix-project/issues/comments/924609804",
    "html_url": "https://github.com/ethereum/remix-project/issues/1618#issuecomment-924609804",
    "issue_url": "https://api.github.com/repos/ethereum/remix-project/issues/1618",
    "id": 924609804,
    "node_id": "IC_kwDODtLRw843HG0M",
    "user": {
      "login": "Aniket-Engg",
      "id": 30843294,
      "node_id": "MDQ6VXNlcjMwODQzMjk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/30843294?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Aniket-Engg",
      "html_url": "https://github.com/Aniket-Engg",
      "followers_url": "https://api.github.com/users/Aniket-Engg/followers",
      "following_url": "https://api.github.com/users/Aniket-Engg/following{/other_user}",
      "gists_url": "https://api.github.com/users/Aniket-Engg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Aniket-Engg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Aniket-Engg/subscriptions",
      "organizations_url": "https://api.github.com/users/Aniket-Engg/orgs",
      "repos_url": "https://api.github.com/users/Aniket-Engg/repos",
      "events_url": "https://api.github.com/users/Aniket-Engg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Aniket-Engg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-22T05:56:56Z",
    "updated_at": "2021-09-22T05:57:21Z",
    "author_association": "MEMBER",
    "body": "Hi @samuelfrench , Here is an example given to use `msg.sender`: https://remix-ide.readthedocs.io/en/latest/unittesting_examples.html#testing-a-method-involving-msg-sender . You need to inherit the contract to be testes as shown in example.\r\n\r\nExtra Notes: You can also use `console.log` to check the value like https://remix-ide.readthedocs.io/en/latest/hardhat_console.html#solidity-unit-testing\r\n\r\nLet me know if it helps and resolves the issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/remix-project/issues/comments/924609804/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/remix-project/issues/comments/926835659",
    "html_url": "https://github.com/ethereum/remix-project/issues/1618#issuecomment-926835659",
    "issue_url": "https://api.github.com/repos/ethereum/remix-project/issues/1618",
    "id": 926835659,
    "node_id": "IC_kwDODtLRw843PmPL",
    "user": {
      "login": "samuelfrench",
      "id": 5598505,
      "node_id": "MDQ6VXNlcjU1OTg1MDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5598505?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/samuelfrench",
      "html_url": "https://github.com/samuelfrench",
      "followers_url": "https://api.github.com/users/samuelfrench/followers",
      "following_url": "https://api.github.com/users/samuelfrench/following{/other_user}",
      "gists_url": "https://api.github.com/users/samuelfrench/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/samuelfrench/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/samuelfrench/subscriptions",
      "organizations_url": "https://api.github.com/users/samuelfrench/orgs",
      "repos_url": "https://api.github.com/users/samuelfrench/repos",
      "events_url": "https://api.github.com/users/samuelfrench/events{/privacy}",
      "received_events_url": "https://api.github.com/users/samuelfrench/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-24T18:24:28Z",
    "updated_at": "2021-09-24T18:24:44Z",
    "author_association": "NONE",
    "body": "@Aniket-Engg Thanks for the heads up about `console.log`, that is going to be super useful.\r\n\r\n```\r\nimport \"contracts/SampleContract.sol\";\r\nimport \"remix_tests.sol\"; \r\nimport \"remix_accounts.sol\";\r\nimport \"hardhat/console.sol\";\r\n\r\ncontract SampleTest is SampleContract {\r\n    \r\n    SampleContract s;\r\n    \r\n    function beforeEach() public {\r\n        s = new SampleContract();\r\n    }\r\n    \r\n    /// #sender: account-0\r\n    function account0Works () public {\r\n        Assert.equal(msg.sender, TestsAccounts.getAccount(0), \"debug\"); //THIS WORKS\r\n        \r\n        address actualSender = s.debug();\r\n        console.log(actualSender);\r\n        Assert.equal(actualSender, TestsAccounts.getAccount(0), \"this should work\"); //THIS IS BROKEN\r\n    }\r\n    \r\n    /// #sender: account-1\r\n    function account1IsBroken () public {\r\n        Assert.equal(msg.sender, TestsAccounts.getAccount(1), \"\"); //THIS WORKS\r\n        \r\n        address actualSender = s.debug();\r\n        console.log(actualSender);\r\n        Assert.equal(actualSender, TestsAccounts.getAccount(1), \"this should work\"); //THIS IS BROKEN - actualSender is the same as previous test case\r\n    }\r\n}\r\n```\r\n\r\n\r\nEven if I inherit from the contract under test (as shown in the example), I'm getting the same behavior.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/remix-project/issues/comments/926835659/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/remix-project/issues/comments/926842975",
    "html_url": "https://github.com/ethereum/remix-project/issues/1618#issuecomment-926842975",
    "issue_url": "https://api.github.com/repos/ethereum/remix-project/issues/1618",
    "id": 926842975,
    "node_id": "IC_kwDODtLRw843PoBf",
    "user": {
      "login": "samuelfrench",
      "id": 5598505,
      "node_id": "MDQ6VXNlcjU1OTg1MDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5598505?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/samuelfrench",
      "html_url": "https://github.com/samuelfrench",
      "followers_url": "https://api.github.com/users/samuelfrench/followers",
      "following_url": "https://api.github.com/users/samuelfrench/following{/other_user}",
      "gists_url": "https://api.github.com/users/samuelfrench/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/samuelfrench/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/samuelfrench/subscriptions",
      "organizations_url": "https://api.github.com/users/samuelfrench/orgs",
      "repos_url": "https://api.github.com/users/samuelfrench/repos",
      "events_url": "https://api.github.com/users/samuelfrench/events{/privacy}",
      "received_events_url": "https://api.github.com/users/samuelfrench/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-24T18:37:16Z",
    "updated_at": "2021-09-24T18:37:16Z",
    "author_association": "NONE",
    "body": "I will close this for now as I am able to verify the example works. I'll try to diagnose the difference between the two and re-open if I find anything.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/remix-project/issues/comments/926842975/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/remix-project/issues/comments/926848165",
    "html_url": "https://github.com/ethereum/remix-project/issues/1618#issuecomment-926848165",
    "issue_url": "https://api.github.com/repos/ethereum/remix-project/issues/1618",
    "id": 926848165,
    "node_id": "IC_kwDODtLRw843PpSl",
    "user": {
      "login": "samuelfrench",
      "id": 5598505,
      "node_id": "MDQ6VXNlcjU1OTg1MDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5598505?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/samuelfrench",
      "html_url": "https://github.com/samuelfrench",
      "followers_url": "https://api.github.com/users/samuelfrench/followers",
      "following_url": "https://api.github.com/users/samuelfrench/following{/other_user}",
      "gists_url": "https://api.github.com/users/samuelfrench/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/samuelfrench/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/samuelfrench/subscriptions",
      "organizations_url": "https://api.github.com/users/samuelfrench/orgs",
      "repos_url": "https://api.github.com/users/samuelfrench/repos",
      "events_url": "https://api.github.com/users/samuelfrench/events{/privacy}",
      "received_events_url": "https://api.github.com/users/samuelfrench/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-24T18:47:14Z",
    "updated_at": "2021-09-24T18:47:14Z",
    "author_association": "NONE",
    "body": "@Aniket-Engg Thanks for the help. I was able to get this working with a small modification:\r\n\r\n```import \"contracts/SampleContract.sol\";\r\nimport \"remix_tests.sol\"; \r\nimport \"remix_accounts.sol\";\r\nimport \"hardhat/console.sol\";\r\n\r\ncontract SampleTest is SampleContract {\r\n    \r\n    /// #sender: account-0\r\n    function account0Works () public {\r\n        Assert.equal(msg.sender, TestsAccounts.getAccount(0), \"debug\");\r\n        \r\n        address actualSender = debug();\r\n        console.log(actualSender);\r\n        Assert.equal(actualSender, TestsAccounts.getAccount(0), \"this should work\");\r\n    }\r\n    \r\n    /// #sender: account-1\r\n    function account1IsBroken () public {\r\n        Assert.equal(msg.sender, TestsAccounts.getAccount(1), \"\");\r\n        \r\n        address actualSender = debug();\r\n        console.log(actualSender);\r\n        Assert.equal(actualSender, TestsAccounts.getAccount(1), \"this should work\");\r\n    }\r\n}",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/remix-project/issues/comments/926848165/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/remix-project/issues/comments/1062287804",
    "html_url": "https://github.com/ethereum/remix-project/issues/1618#issuecomment-1062287804",
    "issue_url": "https://api.github.com/repos/ethereum/remix-project/issues/1618",
    "id": 1062287804,
    "node_id": "IC_kwDODtLRw84_UTm8",
    "user": {
      "login": "techiejd",
      "id": 62455039,
      "node_id": "MDQ6VXNlcjYyNDU1MDM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/62455039?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/techiejd",
      "html_url": "https://github.com/techiejd",
      "followers_url": "https://api.github.com/users/techiejd/followers",
      "following_url": "https://api.github.com/users/techiejd/following{/other_user}",
      "gists_url": "https://api.github.com/users/techiejd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/techiejd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/techiejd/subscriptions",
      "organizations_url": "https://api.github.com/users/techiejd/orgs",
      "repos_url": "https://api.github.com/users/techiejd/repos",
      "events_url": "https://api.github.com/users/techiejd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/techiejd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-08T22:32:50Z",
    "updated_at": "2022-03-08T22:32:50Z",
    "author_association": "NONE",
    "body": "What exactly did you change? I'm having the same issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/remix-project/issues/comments/1062287804/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/remix-project/issues/comments/1062331665",
    "html_url": "https://github.com/ethereum/remix-project/issues/1618#issuecomment-1062331665",
    "issue_url": "https://api.github.com/repos/ethereum/remix-project/issues/1618",
    "id": 1062331665,
    "node_id": "IC_kwDODtLRw84_UeUR",
    "user": {
      "login": "techiejd",
      "id": 62455039,
      "node_id": "MDQ6VXNlcjYyNDU1MDM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/62455039?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/techiejd",
      "html_url": "https://github.com/techiejd",
      "followers_url": "https://api.github.com/users/techiejd/followers",
      "following_url": "https://api.github.com/users/techiejd/following{/other_user}",
      "gists_url": "https://api.github.com/users/techiejd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/techiejd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/techiejd/subscriptions",
      "organizations_url": "https://api.github.com/users/techiejd/orgs",
      "repos_url": "https://api.github.com/users/techiejd/repos",
      "events_url": "https://api.github.com/users/techiejd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/techiejd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-08T23:03:00Z",
    "updated_at": "2022-03-08T23:03:00Z",
    "author_association": "NONE",
    "body": "Ok for any one going down this rabbit hole, here is what changes need to be made:\r\n\r\n1. Make the test an instance of the contract to be tested.\r\n2. All calls need to be internal on the particular. So, all `external` functions need to be `public` so that you can call it internally w/o using `contract.func` and/or `this.func` which actually creates a new message and sets something else as the sender.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/remix-project/issues/comments/1062331665/reactions",
      "total_count": 3,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
