{
  "url": "https://api.github.com/repos/ethereum/devp2p/issues/110",
  "repository_url": "https://api.github.com/repos/ethereum/devp2p",
  "labels_url": "https://api.github.com/repos/ethereum/devp2p/issues/110/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/devp2p/issues/110/comments",
  "events_url": "https://api.github.com/repos/ethereum/devp2p/issues/110/events",
  "html_url": "https://github.com/ethereum/devp2p/issues/110",
  "id": 482219270,
  "node_id": "MDU6SXNzdWU0ODIyMTkyNzA=",
  "number": 110,
  "title": "discv5: need more info on global topic queue limit",
  "user": {
    "login": "FrankSzendzielarz",
    "id": 33515470,
    "node_id": "MDQ6VXNlcjMzNTE1NDcw",
    "avatar_url": "https://avatars.githubusercontent.com/u/33515470?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/FrankSzendzielarz",
    "html_url": "https://github.com/FrankSzendzielarz",
    "followers_url": "https://api.github.com/users/FrankSzendzielarz/followers",
    "following_url": "https://api.github.com/users/FrankSzendzielarz/following{/other_user}",
    "gists_url": "https://api.github.com/users/FrankSzendzielarz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/FrankSzendzielarz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/FrankSzendzielarz/subscriptions",
    "organizations_url": "https://api.github.com/users/FrankSzendzielarz/orgs",
    "repos_url": "https://api.github.com/users/FrankSzendzielarz/repos",
    "events_url": "https://api.github.com/users/FrankSzendzielarz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/FrankSzendzielarz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-08-19T10:03:32Z",
  "updated_at": "2019-10-22T14:47:43Z",
  "closed_at": "2019-10-22T14:47:43Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "The topic discovery mechanism has a global limit on topic advertisements:\r\n\r\n> There is also a global limit on the number of ads regardless of the topic queue which contains them. When the global limit is reached, the last entry of the least recently requested topic queue is removed.\r\n\r\nThere are three possible issues with this that I can see:\r\n\r\n1.  An attack where malicious nodes can conspire to continuously register random, new topics, and request the ads placed in those topics to make them no 'least recently requested'\r\n2. A similar attack but where the topic registrations are made concurrently, as if I understand correctly there is no prevention over issuing concurrent ad requests for 1000 different new topics (eg)\r\n3. Legitimate advertisers placing ads on a server with the global limit at threshold may find their ads being selected for immediate removal.",
  "closed_by": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/devp2p/issues/110/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/devp2p/issues/110/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/devp2p/issues/comments/522514690",
    "html_url": "https://github.com/ethereum/devp2p/issues/110#issuecomment-522514690",
    "issue_url": "https://api.github.com/repos/ethereum/devp2p/issues/110",
    "id": 522514690,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMjUxNDY5MA==",
    "user": {
      "login": "FrankSzendzielarz",
      "id": 33515470,
      "node_id": "MDQ6VXNlcjMzNTE1NDcw",
      "avatar_url": "https://avatars.githubusercontent.com/u/33515470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/FrankSzendzielarz",
      "html_url": "https://github.com/FrankSzendzielarz",
      "followers_url": "https://api.github.com/users/FrankSzendzielarz/followers",
      "following_url": "https://api.github.com/users/FrankSzendzielarz/following{/other_user}",
      "gists_url": "https://api.github.com/users/FrankSzendzielarz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/FrankSzendzielarz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/FrankSzendzielarz/subscriptions",
      "organizations_url": "https://api.github.com/users/FrankSzendzielarz/orgs",
      "repos_url": "https://api.github.com/users/FrankSzendzielarz/repos",
      "events_url": "https://api.github.com/users/FrankSzendzielarz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/FrankSzendzielarz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-19T10:42:13Z",
    "updated_at": "2019-08-19T10:42:13Z",
    "author_association": "MEMBER",
    "body": "I suggest a global limiter that applies to the overall rate of new topic creations. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/devp2p/issues/comments/522514690/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/devp2p/issues/comments/522538702",
    "html_url": "https://github.com/ethereum/devp2p/issues/110#issuecomment-522538702",
    "issue_url": "https://api.github.com/repos/ethereum/devp2p/issues/110",
    "id": 522538702,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMjUzODcwMg==",
    "user": {
      "login": "FrankSzendzielarz",
      "id": 33515470,
      "node_id": "MDQ6VXNlcjMzNTE1NDcw",
      "avatar_url": "https://avatars.githubusercontent.com/u/33515470?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/FrankSzendzielarz",
      "html_url": "https://github.com/FrankSzendzielarz",
      "followers_url": "https://api.github.com/users/FrankSzendzielarz/followers",
      "following_url": "https://api.github.com/users/FrankSzendzielarz/following{/other_user}",
      "gists_url": "https://api.github.com/users/FrankSzendzielarz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/FrankSzendzielarz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/FrankSzendzielarz/subscriptions",
      "organizations_url": "https://api.github.com/users/FrankSzendzielarz/orgs",
      "repos_url": "https://api.github.com/users/FrankSzendzielarz/repos",
      "events_url": "https://api.github.com/users/FrankSzendzielarz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/FrankSzendzielarz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-19T11:59:15Z",
    "updated_at": "2019-08-19T11:59:15Z",
    "author_association": "MEMBER",
    "body": "Open question: how to decide which ad is least valuable and so which is evicted.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/devp2p/issues/comments/522538702/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/devp2p/issues/comments/522567769",
    "html_url": "https://github.com/ethereum/devp2p/issues/110#issuecomment-522567769",
    "issue_url": "https://api.github.com/repos/ethereum/devp2p/issues/110",
    "id": 522567769,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMjU2Nzc2OQ==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-19T13:11:50Z",
    "updated_at": "2019-08-19T13:11:50Z",
    "author_association": "MEMBER",
    "body": "@zsfelfoldi says:\r\n\r\n> I've been thinking a bit more about the global limit eviction priority. Now I think it is perfectly fine and simple if we just enforce the same 10 min lifetime for every ad and if registration is limited by the global limit then evict the first ad (regardless of topic importance) whose guaranteed lifetime is over. We just need a per-topic FIFO and a global FIFO. For more popular topics the length of the topic queue will still be limited by per-topic limit. For less popular ones it will be proportional to the total global efforts to register that topic and I think that is fine. Filling most of the table's total allowance with junk is possible but the important thing is that it will not significantly hinder the registration of important and popular topics. For popular topics (where the topic queue size is at its limit) the time of the next round of \"competition\" only depends on the first expiring ad from the same queue. The only trick is that we should mark the soonest expiring ad for eviction when we first issue a ticket for the next registration in that queue and until that happens we do not select it for eviction based on global limit (which happens much more frequently). So we can be sure that in the next round for \"important\" topic registration we are actually have an ad to evict and we can register one of the candidates.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/devp2p/issues/comments/522567769/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
