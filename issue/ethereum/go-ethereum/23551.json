{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23551",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23551/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23551/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23551/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23551",
  "id": 991479364,
  "node_id": "MDU6SXNzdWU5OTE0NzkzNjQ=",
  "number": 23551,
  "title": "abigen cannot parse events with struct arguments",
  "user": {
    "login": "connorwstein",
    "id": 5782319,
    "node_id": "MDQ6VXNlcjU3ODIzMTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5782319?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/connorwstein",
    "html_url": "https://github.com/connorwstein",
    "followers_url": "https://api.github.com/users/connorwstein/followers",
    "following_url": "https://api.github.com/users/connorwstein/following{/other_user}",
    "gists_url": "https://api.github.com/users/connorwstein/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/connorwstein/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/connorwstein/subscriptions",
    "organizations_url": "https://api.github.com/users/connorwstein/orgs",
    "repos_url": "https://api.github.com/users/connorwstein/repos",
    "events_url": "https://api.github.com/users/connorwstein/events{/privacy}",
    "received_events_url": "https://api.github.com/users/connorwstein/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "MariusVanDerWijden",
    "id": 16664698,
    "node_id": "MDQ6VXNlcjE2NjY0Njk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MariusVanDerWijden",
    "html_url": "https://github.com/MariusVanDerWijden",
    "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
    "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
    "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
    "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
    "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
    "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2021-09-08T19:58:36Z",
  "updated_at": "2021-09-22T08:18:18Z",
  "closed_at": "2021-09-22T08:18:18Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: v1.10.8\r\nOS & Version: OSX\r\n\r\n#### Expected behaviour\r\nGenerated log parsing function works for events with struct args\r\n\r\n#### Actual behaviour\r\nPanics when trying to parse a log\r\n\r\n#### Steps to reproduce the behaviour\r\nTest.sol\r\n```\r\npragma solidity ^0.8.0;\r\n\r\ncontract Test {\r\n    struct MyStruct{\r\n        uint256 a;\r\n    }\r\n    event StructEvent(MyStruct s);\r\n    function TestEvent() public {\r\n        emit StructEvent(MyStruct({a: 1}));\r\n    }\r\n}\r\n```\r\n\r\n```\r\nsolc --overwrite --optimize --optimize-runs 1000000 --metadata-hash none --abi --bin Test.sol -o .\r\nabigen --abi Test.abi --pkg wrapper  > wrapper.go\r\n```\r\n\r\nabi_test.go\r\n```\r\nimport \"wrapper\"\r\nfunc TestBlah(t *testing.T) {\r\n\tkey, err := crypto.GenerateKey()\r\n\trequire.NoError(t, err)\r\n\tuser, err := bind.NewKeyedTransactorWithChainID(key, big.NewInt(1337))\r\n\tbackend := backends.NewSimulatedBackend(core.GenesisAlloc{\r\n\t\tuser.From: {Balance: big.NewInt(1000000000000000000)}},\r\n\t\tethconfig.Defaults.Miner.GasCeil)\r\n\t_, _, d, err := wrapper.DeployTest(user, backend)\r\n\trequire.NoError(t, err)\r\n\tbackend.Commit()\r\n\t_, err = d.TestEvent(user)\r\n\trequire.NoError(t, err)\r\n\tbackend.Commit()\r\n\tit, err := d.FilterStructEvent(nil)\r\n\trequire.NoError(t, err)\r\n\tfor it.Next() {\r\n\t\tt.Log(it.Event)\r\n\t}\r\n}\r\n```\r\n\r\n#### Backtrace\r\n\r\n````\r\n--- FAIL: TestBlah (0.01s)\r\npanic: reflect: call of reflect.Value.NumField on ptr Value [recovered]\r\n\tpanic: reflect: call of reflect.Value.NumField on ptr Value\r\n\r\ngoroutine 94 [running]:\r\ntesting.tRunner.func1.2(0x50512e0, 0xc0011c27c8)\r\n\t/usr/local/Cellar/go/1.16.3/libexec/src/testing/testing.go:1143 +0x332\r\ntesting.tRunner.func1(0xc000583680)\r\n\t/usr/local/Cellar/go/1.16.3/libexec/src/testing/testing.go:1146 +0x4b6\r\npanic(0x50512e0, 0xc0011c27c8)\r\n\t/usr/local/Cellar/go/1.16.3/libexec/src/runtime/panic.go:965 +0x1b9\r\nreflect.flag.mustBe(...)\r\n\t/usr/local/Cellar/go/1.16.3/libexec/src/reflect/value.go:221\r\nreflect.Value.NumField(0x5216000, 0xc000df00a0, 0x16, 0xc0007306a0)\r\n\t/usr/local/Cellar/go/1.16.3/libexec/src/reflect/value.go:1369 +0xc5\r\ngithub.com/ethereum/go-ethereum/accounts/abi.setStruct(0x50a94e0, 0xc0011a46e0, 0x199, 0x5216000, 0xc000df00a0, 0x16, 0x6, 0xc000b109e0)\r\n\t/Users/connorstein/go/pkg/mod/github.com/ethereum/go-ethereum@v1.10.8/accounts/abi/reflect.go:166 +0x6c\r\ngithub.com/ethereum/go-ethereum/accounts/abi.set(0x50a94e0, 0xc0011a46e0, 0x199, 0x5216000, 0xc000df00a0, 0x16, 0x199, 0x0)\r\n\t/Users/connorstein/go/pkg/mod/github.com/ethereum/go-ethereum@v1.10.8/accounts/abi/reflect.go:113 +0x353\r\ngithub.com/ethereum/go-ethereum/accounts/abi.setStruct(0x50f9dc0, 0xc0011a46e0, 0x199, 0xc00149ef00, 0xc000df00a0, 0x19, 0xc0007306a0, 0x1)\r\n\t/Users/connorstein/go/pkg/mod/github.com/ethereum/go-ethereum@v1.10.8/accounts/abi/reflect.go:172 +0x151\r\ngithub.com/ethereum/go-ethereum/accounts/abi.set(0x50f9dc0, 0xc0011a46e0, 0x199, 0xc00149ef00, 0xc000df00a0, 0x19, 0x0, 0x0)\r\n\t/Users/connorstein/go/pkg/mod/github.com/ethereum/go-ethereum@v1.10.8/accounts/abi/reflect.go:113 +0x353\r\ngithub.com/ethereum/go-ethereum/accounts/abi.Arguments.copyAtomic(0xc000461200, 0x1, 0x4, 0x504b040, 0xc0011a46e0, 0xc00149ef00, 0xc000df00a0, 0x0, 0x0)\r\n\t/Users/connorstein/go/pkg/mod/github.com/ethereum/go-ethereum@v1.10.8/accounts/abi/argument.go:143 +0x18b\r\ngithub.com/ethereum/go-ethereum/accounts/abi.Arguments.Copy(0xc000461200, 0x1, 0x4, 0x504b040, 0xc0011a46e0, 0xc000535190, 0x1, 0x1, 0x1, 0x0)\r\n\t/Users/connorstein/go/pkg/mod/github.com/ethereum/go-ethereum@v1.10.8/accounts/abi/argument.go:132 +0x233\r\ngithub.com/ethereum/go-ethereum/accounts/abi.ABI.UnpackIntoInterface(0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, ...)\r\n\t/Users/connorstein/go/pkg/mod/github.com/ethereum/go-ethereum@v1.10.8/accounts/abi/abi.go:123 +0x1d1\r\ngithub.com/ethereum/go-ethereum/accounts/abi/bind.(*BoundContract).UnpackLog(0xc00052ea00, 0x504b040, 0xc0011a46e0, 0x5244ec0, 0xb, 0x48e8dd4c4c186086, 0xa12392f908ea91fa, 0x797140e7, 0xc001517200, 0x1, ...)\r\n\t/Users/connorstein/go/pkg/mod/github.com/ethereum/go-ethereum@v1.10.8/accounts/abi/bind/base.go:435 +0x3f4\r\ngithub.com/smartcontractkit/chainlink/core/internal/gethwrappers/generated/test_blah.(*TestStructEventIterator).Next(0xc001508820, 0xc000583680)\r\n\t/Users/connorstein/go/src/github.com/smartcontractkit/chainlink-ccip/core/internal/gethwrappers/generated/test_blah/test_blah.go:226 +0x49f\r\ngithub.com/smartcontractkit/chainlink/core/services/ccip.TestBlah(0xc000583680)\r\n\t/Users/connorstein/go/src/github.com/smartcontractkit/chainlink-ccip/core/services/ccip/log_listener_test.go:116 +0x3f3\r\ntesting.tRunner(0xc000583680, 0x54dec70)\r\n\t/usr/local/Cellar/go/1.16.3/libexec/src/testing/testing.go:1193 +0xef\r\ncreated by testing.(*T).Run\r\n\t/usr/local/Cellar/go/1.16.3/libexec/src/testing/testing.go:1238 +0x2b3\r\n````\r\n\r\n",
  "closed_by": {
    "login": "gballet",
    "id": 3272758,
    "node_id": "MDQ6VXNlcjMyNzI3NTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3272758?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gballet",
    "html_url": "https://github.com/gballet",
    "followers_url": "https://api.github.com/users/gballet/followers",
    "following_url": "https://api.github.com/users/gballet/following{/other_user}",
    "gists_url": "https://api.github.com/users/gballet/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gballet/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gballet/subscriptions",
    "organizations_url": "https://api.github.com/users/gballet/orgs",
    "repos_url": "https://api.github.com/users/gballet/repos",
    "events_url": "https://api.github.com/users/gballet/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gballet/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23551/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23551/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
