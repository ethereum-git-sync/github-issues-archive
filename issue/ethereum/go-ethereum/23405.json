{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23405",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23405/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23405/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23405/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23405",
  "id": 971551613,
  "node_id": "MDU6SXNzdWU5NzE1NTE2MTM=",
  "number": 23405,
  "title": "eth.blockNumber 0 after geth update",
  "user": {
    "login": "bogdangainusa",
    "id": 13803843,
    "node_id": "MDQ6VXNlcjEzODAzODQz",
    "avatar_url": "https://avatars.githubusercontent.com/u/13803843?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bogdangainusa",
    "html_url": "https://github.com/bogdangainusa",
    "followers_url": "https://api.github.com/users/bogdangainusa/followers",
    "following_url": "https://api.github.com/users/bogdangainusa/following{/other_user}",
    "gists_url": "https://api.github.com/users/bogdangainusa/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bogdangainusa/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bogdangainusa/subscriptions",
    "organizations_url": "https://api.github.com/users/bogdangainusa/orgs",
    "repos_url": "https://api.github.com/users/bogdangainusa/repos",
    "events_url": "https://api.github.com/users/bogdangainusa/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bogdangainusa/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-08-16T09:38:35Z",
  "updated_at": "2021-08-17T09:40:48Z",
  "closed_at": "2021-08-16T19:41:47Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "After updating geth from v.1.10.2 to v.1.10.6 geth eth.blockNumber is returning 0 all the time. Update was done more than 2 weeks before and before this eth.blockNumber was returned properly. \r\n\r\nTried to restart geth, increase max peers and server specs but this didn't helped so far. \r\n\r\n\r\n\r\n`------------ GETH SYNCING PROGRESS\r\nprogress: 99.99915613018487 %\r\nblocks left to parse: 110\r\ncurrent Block: 13035076 of 13035186\r\n\r\n> eth.blockNumber;\r\n0\r\n> eth.syncing;\r\n{\r\n  currentBlock: 13035076,\r\n  highestBlock: 13035187,\r\n  knownStates: 1004481264,\r\n  pulledStates: 1004319180,\r\n  startingBlock: 13001938\r\n}\r\n> eth.pendingTransactions;\r\n[]\r\n`\r\n\r\n\r\nGeth version: geth v.1.10.6\r\nOS & Version: Debian 10\r\n\r\nExpected behaviour: eth.blockNumber should return actual blockNumber\r\nActual behaviour: eth.blockNumber return 0 all the time\r\n![11111](https://user-images.githubusercontent.com/13803843/129543447-a27cf2c2-4b28-49d0-b4ef-091b1fa6b2d3.png)\r\n",
  "closed_by": {
    "login": "MariusVanDerWijden",
    "id": 16664698,
    "node_id": "MDQ6VXNlcjE2NjY0Njk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MariusVanDerWijden",
    "html_url": "https://github.com/MariusVanDerWijden",
    "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
    "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
    "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
    "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
    "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
    "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23405/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23405/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/899732274",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23405#issuecomment-899732274",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23405",
    "id": 899732274,
    "node_id": "IC_kwDOAOvK9841oNMy",
    "user": {
      "login": "aghamir",
      "id": 1880925,
      "node_id": "MDQ6VXNlcjE4ODA5MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1880925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aghamir",
      "html_url": "https://github.com/aghamir",
      "followers_url": "https://api.github.com/users/aghamir/followers",
      "following_url": "https://api.github.com/users/aghamir/following{/other_user}",
      "gists_url": "https://api.github.com/users/aghamir/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aghamir/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aghamir/subscriptions",
      "organizations_url": "https://api.github.com/users/aghamir/orgs",
      "repos_url": "https://api.github.com/users/aghamir/repos",
      "events_url": "https://api.github.com/users/aghamir/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aghamir/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-16T18:38:27Z",
    "updated_at": "2021-08-16T18:38:27Z",
    "author_association": "NONE",
    "body": "I encounter the same issue. As I understand, this happens in `fast` mode. Moreover, [blockbook](https://github.com/trezor/blockbook/) will not work with `fast` mode as it returns blockNumber as zero.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/899732274/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/899770257",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23405#issuecomment-899770257",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23405",
    "id": 899770257,
    "node_id": "IC_kwDOAOvK9841oWeR",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-16T19:41:47Z",
    "updated_at": "2021-08-16T19:41:47Z",
    "author_association": "MEMBER",
    "body": "We only return the blocknumber for which we have the _full_ state. As long as you are not synced, the highest block that you have the full state for is the genesis block. So your node will always return 0. If you are full syncing it will return the blocknumber of your current head. But since you're fast syncing it returns 0.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/899770257/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/900019042",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23405#issuecomment-900019042",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23405",
    "id": 900019042,
    "node_id": "IC_kwDOAOvK9841pTNi",
    "user": {
      "login": "bogdangainusa",
      "id": 13803843,
      "node_id": "MDQ6VXNlcjEzODAzODQz",
      "avatar_url": "https://avatars.githubusercontent.com/u/13803843?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bogdangainusa",
      "html_url": "https://github.com/bogdangainusa",
      "followers_url": "https://api.github.com/users/bogdangainusa/followers",
      "following_url": "https://api.github.com/users/bogdangainusa/following{/other_user}",
      "gists_url": "https://api.github.com/users/bogdangainusa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bogdangainusa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bogdangainusa/subscriptions",
      "organizations_url": "https://api.github.com/users/bogdangainusa/orgs",
      "repos_url": "https://api.github.com/users/bogdangainusa/repos",
      "events_url": "https://api.github.com/users/bogdangainusa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bogdangainusa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-17T06:07:34Z",
    "updated_at": "2021-08-17T06:07:34Z",
    "author_association": "NONE",
    "body": "@MariusVanDerWijden  Thanks for your response.\r\n\r\nBefore update we were running geth with -fast sync and sync was done => block was returned properly.\r\nAfter update we didn't changed anything - fast sync was keep and blockchain was almost at latet block into network. However chaindata is still syncing for 2 weeks and reached ~ 1.6 TB so i think there should be some issue as it's keep syncing but never reaching latest block from network.\r\n\r\nQuestion: As i know from the past times if we use -fast flag, it's used by geth only on first start when chaindata is empty. After this if we restart geth fast doesn't count anymore and blockchain is syncing in normal way. Please let me know if this behaviour was changed with this latest versions. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/900019042/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/900021888",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23405#issuecomment-900021888",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23405",
    "id": 900021888,
    "node_id": "IC_kwDOAOvK9841pT6A",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-17T06:12:49Z",
    "updated_at": "2021-08-17T06:12:49Z",
    "author_association": "MEMBER",
    "body": "No that behavior is still the same, once you synced up to the head, your node switches from fast to full sync (importing every block as it arrives). If you are behind the chain too much your node switches back to fast sync. Your node is currently pulling states so its not synced. You can try to use snap sync instead which is a bit faster or wait until fast sync completed. Once your node is synced and the snapshot is generated, you can also shutdown your node and run the prune operation which will take your node from 1.6 TB to ~500GB as it will delete a lot of unnecessary data.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/900021888/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/900121800",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23405#issuecomment-900121800",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23405",
    "id": 900121800,
    "node_id": "IC_kwDOAOvK9841psTI",
    "user": {
      "login": "aghamir",
      "id": 1880925,
      "node_id": "MDQ6VXNlcjE4ODA5MjU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1880925?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aghamir",
      "html_url": "https://github.com/aghamir",
      "followers_url": "https://api.github.com/users/aghamir/followers",
      "following_url": "https://api.github.com/users/aghamir/following{/other_user}",
      "gists_url": "https://api.github.com/users/aghamir/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aghamir/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aghamir/subscriptions",
      "organizations_url": "https://api.github.com/users/aghamir/orgs",
      "repos_url": "https://api.github.com/users/aghamir/repos",
      "events_url": "https://api.github.com/users/aghamir/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aghamir/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-17T09:01:28Z",
    "updated_at": "2021-08-17T09:01:28Z",
    "author_association": "NONE",
    "body": "I think returning zero in blockNumber forces people to run `full` for certain usage(As example I mentioned running blockbook). As I know, the `fast` and the `full` must behave same in most cases. Returning blockNumber is essential for a lot of applications and this update forces people to use `full` mode.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/900121800/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/900148755",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23405#issuecomment-900148755",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23405",
    "id": 900148755,
    "node_id": "IC_kwDOAOvK9841py4T",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-17T09:40:48Z",
    "updated_at": "2021-08-17T09:40:48Z",
    "author_association": "MEMBER",
    "body": "You can always use the following logic:\r\nif blocknumber returns 0\r\nuse eth.syncing.highestBlock",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/900148755/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
