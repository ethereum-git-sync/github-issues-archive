{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26393",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26393/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26393/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26393/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/26393",
  "id": 1513676322,
  "node_id": "I_kwDOAOvK985aON4i",
  "number": 26393,
  "title": "[Metrics] rpc_duration_xxxx  Indirectly return zero data",
  "user": {
    "login": "0xRook1e",
    "id": 49090950,
    "node_id": "MDQ6VXNlcjQ5MDkwOTUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/49090950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0xRook1e",
    "html_url": "https://github.com/0xRook1e",
    "followers_url": "https://api.github.com/users/0xRook1e/followers",
    "following_url": "https://api.github.com/users/0xRook1e/following{/other_user}",
    "gists_url": "https://api.github.com/users/0xRook1e/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0xRook1e/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0xRook1e/subscriptions",
    "organizations_url": "https://api.github.com/users/0xRook1e/orgs",
    "repos_url": "https://api.github.com/users/0xRook1e/repos",
    "events_url": "https://api.github.com/users/0xRook1e/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0xRook1e/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-12-29T12:10:34Z",
  "updated_at": "2023-01-02T08:48:52Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `v1.10.26`\r\n\r\nGeth Args \r\n```\r\nexec geth --authrpc.jwtsecret=/secret/jwtsecret --authrpc.addr=0.0.0.0 --authrpc.port=8551 --authrpc.vhosts=* --http --http.addr=0.0.0.0 --http.port=8599 --http.corsdomain= --http.vhosts=* --http.api=web3,eth,net,engine --nat=extip:$(POD_IP) --port=30303 --ws --ws.addr=0.0.0.0 --ws.port=8546 --ws.origins=* --ws.api=web3,eth,net,engine --datadir=/data/ethereum --ethash.dagdir=/data/ethereum/.ethash --ipcdisable --goerli \"--syncmode=snap\" \"--metrics\" \"--pprof\" \"--pprof.addr=0.0.0.0\" \"--pprof.port=6060\" \"--metrics.expensive\"\r\n```\r\n- http.port=8599\r\n- metrics port= 6060\r\n\r\n\r\nI tried to call eth_blockNumber rpc many times. When requesting the metrics interface, the first time I have data, and later I access the metrics stats again as 0. \r\n\r\n\r\n```\r\n# curl eth_blockNumber jsonRPC \r\ncurl -i -X POST  -H 'content-type: application/json' --data '{\"jsonrpc\":\"2.0\",\"method\":\"eth_blockNumber\",\"params\":[],\"id\":1}'  http://localhost:8599\r\nHTTP/1.1 200 OK\r\nContent-Type: application/json\r\nDate: Thu, 29 Dec 2022 11:56:13 GMT\r\nContent-Length: 45\r\n\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":\"0x7d70e8\"}\r\n\r\n# check metrics \r\ncurl localhost:6060/debug/metrics/prometheus | grep eth_blockNumber\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100 48729  100 48729    0     0  51151      0 --:--:-- --:--:-- --:--:-- 51347\r\n# TYPE rpc_duration_eth_blockNumber_success_count counter\r\nrpc_duration_eth_blockNumber_success_count 1\r\n# TYPE rpc_duration_eth_blockNumber_success summary\r\nrpc_duration_eth_blockNumber_success {quantile=\"0.5\"} 27\r\nrpc_duration_eth_blockNumber_success {quantile=\"0.75\"} 27\r\nrpc_duration_eth_blockNumber_success {quantile=\"0.95\"} 27\r\nrpc_duration_eth_blockNumber_success {quantile=\"0.99\"} 27\r\nrpc_duration_eth_blockNumber_success {quantile=\"0.999\"} 27\r\nrpc_duration_eth_blockNumber_success {quantile=\"0.9999\"} 27\r\n\r\n# check metrics again  \r\ncurl localhost:6060/debug/metrics/prometheus | grep eth_blockNumber\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100 48747  100 48747    0     0  36100      0  0:00:01  0:00:01 --:--:-- 36189\r\n# TYPE rpc_duration_eth_blockNumber_success_count counter\r\nrpc_duration_eth_blockNumber_success_count 0\r\n# TYPE rpc_duration_eth_blockNumber_success summary\r\nrpc_duration_eth_blockNumber_success {quantile=\"0.5\"} 0\r\nrpc_duration_eth_blockNumber_success {quantile=\"0.75\"} 0\r\nrpc_duration_eth_blockNumber_success {quantile=\"0.95\"} 0\r\nrpc_duration_eth_blockNumber_success {quantile=\"0.99\"} 0\r\nrpc_duration_eth_blockNumber_success {quantile=\"0.999\"} 0\r\nrpc_duration_eth_blockNumber_success {quantile=\"0.9999\"} 0\r\n\r\n\r\nEven if I access the interface again, the query metrics are all 0\r\n\r\n```\r\n\r\n\r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26393/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26393/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1367291935",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26393#issuecomment-1367291935",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26393",
    "id": 1367291935,
    "node_id": "IC_kwDOAOvK985Rfzgf",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-29T12:39:40Z",
    "updated_at": "2022-12-29T12:39:40Z",
    "author_association": "MEMBER",
    "body": "I cannot repro your error. Here's my attempt, where I invoke `eth_blokcNumber` and then fetch the metric. Fetching it zeroes the meter, and it becomes non-zero again when I invoke the method another time. \r\n\r\nGeth started with `geth --dev --pprof --pprof.addr=0.0.0.0 --pprof.port=6060 --metrics --http` \r\n\r\n```\r\n[user@work ~]$ curl localhost:6060/debug/metrics/prometheus 2>/dev/null | grep eth_blockNumber | grep 0.5 \r\nrpc_duration_eth_blockNumber_success {quantile=\"0.5\"} 0\r\n[user@work ~]$ curl http://localhost:8545/  -X POST -H \"Content-Type: application/json\" --data '{\"method\":\"eth_blockNumber\",\"params\":[],\"id\":1,\"jsonrpc\":\"2.0\"}'\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":\"0x0\"}\r\n[user@work ~]$ curl localhost:6060/debug/metrics/prometheus 2>/dev/null | grep eth_blockNumber | grep 0.5 \r\nrpc_duration_eth_blockNumber_success {quantile=\"0.5\"} 94\r\n[user@work ~]$ curl localhost:6060/debug/metrics/prometheus 2>/dev/null | grep eth_blockNumber | grep 0.5 \r\nrpc_duration_eth_blockNumber_success {quantile=\"0.5\"} 0\r\n[user@work ~]$ curl http://localhost:8545/  -X POST -H \"Content-Type: application/json\" --data '{\"method\":\"eth_blockNumber\",\"params\":[],\"id\":1,\"jsonrpc\":\"2.0\"}'\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":\"0x0\"}\r\n[user@work ~]$ curl localhost:6060/debug/metrics/prometheus 2>/dev/null | grep eth_blockNumber | grep 0.5 \r\nrpc_duration_eth_blockNumber_success {quantile=\"0.5\"} 36\r\n[user@work ~]$ curl localhost:6060/debug/metrics/prometheus 2>/dev/null | grep eth_blockNumber | grep 0.5 \r\nrpc_duration_eth_blockNumber_success {quantile=\"0.5\"} 0\r\n[user@work ~]$ curl http://localhost:8545/  -X POST -H \"Content-Type: application/json\" --data '{\"method\":\"eth_blockNumber\",\"params\":[],\"id\":1,\"jsonrpc\":\"2.0\"}'\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":\"0x0\"}\r\n[user@work ~]$ curl localhost:6060/debug/metrics/prometheus 2>/dev/null | grep eth_blockNumber | grep 0.5 \r\nrpc_duration_eth_blockNumber_success {quantile=\"0.5\"} 51\r\n[user@work ~]$ curl localhost:6060/debug/metrics/prometheus 2>/dev/null | grep eth_blockNumber | grep 0.5 \r\nrpc_duration_eth_blockNumber_success {quantile=\"0.5\"} 0\r\n[user@work ~]$ curl http://localhost:8545/  -X POST -H \"Content-Type: application/json\" --data '{\"method\":\"eth_blockNumber\",\"params\":[],\"id\":1,\"jsonrpc\":\"2.0\"}'\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":\"0x0\"}\r\n[user@work ~]$ curl localhost:6060/debug/metrics/prometheus 2>/dev/null | grep eth_blockNumber | grep 0.5 \r\nrpc_duration_eth_blockNumber_success {quantile=\"0.5\"} 35\r\n[user@work ~]$ curl localhost:6060/debug/metrics/prometheus 2>/dev/null | grep eth_blockNumber | grep 0.5 \r\nrpc_duration_eth_blockNumber_success {quantile=\"0.5\"} 0\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1367291935/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1367333450",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26393#issuecomment-1367333450",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26393",
    "id": 1367333450,
    "node_id": "IC_kwDOAOvK985Rf9pK",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-29T13:46:49Z",
    "updated_at": "2022-12-29T13:46:49Z",
    "author_association": "MEMBER",
    "body": "As for \"why does the histogram reset\", see https://github.com/ethereum/go-ethereum/pull/26356",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1367333450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1367340116",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26393#issuecomment-1367340116",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26393",
    "id": 1367340116,
    "node_id": "IC_kwDOAOvK985Rf_RU",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-29T13:56:47Z",
    "updated_at": "2022-12-29T13:56:47Z",
    "author_association": "MEMBER",
    "body": "I first interpreted your report as you were saying that even if you again make a call to `eth_blockNumber`, it does not re-arm the meter. \r\nUpon reading it again, however, I interpret it as you are reporting that the histogram resets when you fetch it. \r\n\r\nThis is a known issue, and will be resolved by the PR linked above. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1367340116/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1367705767",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26393#issuecomment-1367705767",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26393",
    "id": 1367705767,
    "node_id": "IC_kwDOAOvK985RhYin",
    "user": {
      "login": "0xRook1e",
      "id": 49090950,
      "node_id": "MDQ6VXNlcjQ5MDkwOTUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/49090950?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xRook1e",
      "html_url": "https://github.com/0xRook1e",
      "followers_url": "https://api.github.com/users/0xRook1e/followers",
      "following_url": "https://api.github.com/users/0xRook1e/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xRook1e/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xRook1e/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xRook1e/subscriptions",
      "organizations_url": "https://api.github.com/users/0xRook1e/orgs",
      "repos_url": "https://api.github.com/users/0xRook1e/repos",
      "events_url": "https://api.github.com/users/0xRook1e/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xRook1e/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-30T03:36:42Z",
    "updated_at": "2022-12-30T03:38:31Z",
    "author_association": "NONE",
    "body": "Thanks for answer, but the metrics type rpc is summary not histogram. So the summary indicator type will be reset as well? Also, it's not just this one rpc metrics, there are many but I didn't list them @holiman \r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1367705767/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1367706977",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26393#issuecomment-1367706977",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26393",
    "id": 1367706977,
    "node_id": "IC_kwDOAOvK985RhY1h",
    "user": {
      "login": "vehicles4real",
      "id": 85257727,
      "node_id": "MDQ6VXNlcjg1MjU3NzI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/85257727?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vehicles4real",
      "html_url": "https://github.com/vehicles4real",
      "followers_url": "https://api.github.com/users/vehicles4real/followers",
      "following_url": "https://api.github.com/users/vehicles4real/following{/other_user}",
      "gists_url": "https://api.github.com/users/vehicles4real/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vehicles4real/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vehicles4real/subscriptions",
      "organizations_url": "https://api.github.com/users/vehicles4real/orgs",
      "repos_url": "https://api.github.com/users/vehicles4real/repos",
      "events_url": "https://api.github.com/users/vehicles4real/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vehicles4real/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-30T03:43:02Z",
    "updated_at": "2023-01-02T08:48:52Z",
    "author_association": "NONE",
    "body": "Can someone please help me with my wallet and my crypto I need it so ðŸ˜”\nbadly right now.\n\nOn Thu, Dec 29, 2022, 9:38 PM Jiawei Zhang ***@***.***> wrote:\n\n> ok, I see that, but the metrics type rpc is summary not histogram. So the\n> summary indicator type will be reset as well? Also, it's not just this one\n> rpc metrics, there are many but I didn't list them @holiman\n> <https://github.com/holiman>\n>\n> â€”\n> Reply to this email directly, view it on GitHub\n> <https://github.com/ethereum/go-ethereum/issues/26393#issuecomment-1367705767>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AUKO374PRNL3SAZ6G7S62ZLWPZKLVANCNFSM6AAAAAATMBNJ2M>\n> .\n> You are receiving this because you are subscribed to this thread.Message\n> ID: ***@***.***>\n>\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1367706977/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
