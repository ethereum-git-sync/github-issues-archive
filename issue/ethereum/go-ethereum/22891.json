{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22891",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22891/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22891/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22891/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/22891",
  "id": 893883701,
  "node_id": "MDU6SXNzdWU4OTM4ODM3MDE=",
  "number": 22891,
  "title": "Geth Imported new chain segment sometimes freezes and sets node back by a minute or so.",
  "user": {
    "login": "ScriptLike",
    "id": 26418129,
    "node_id": "MDQ6VXNlcjI2NDE4MTI5",
    "avatar_url": "https://avatars.githubusercontent.com/u/26418129?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ScriptLike",
    "html_url": "https://github.com/ScriptLike",
    "followers_url": "https://api.github.com/users/ScriptLike/followers",
    "following_url": "https://api.github.com/users/ScriptLike/following{/other_user}",
    "gists_url": "https://api.github.com/users/ScriptLike/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ScriptLike/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ScriptLike/subscriptions",
    "organizations_url": "https://api.github.com/users/ScriptLike/orgs",
    "repos_url": "https://api.github.com/users/ScriptLike/repos",
    "events_url": "https://api.github.com/users/ScriptLike/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ScriptLike/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-05-18T02:24:23Z",
  "updated_at": "2021-05-18T17:04:52Z",
  "closed_at": "2021-05-18T07:50:15Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 1.10.2-stable\r\nOS & Version: Windows\r\n\r\n#### Expected behaviour\r\nnode stays synced at all times\r\n\r\n#### Actual behaviour\r\nSometimes when imported new chain segment the node will become out of sync for a minute or so\r\n\r\n#### Steps to reproduce the behaviour\r\nRun on windows with these settings \r\n\r\nGeth --cache=6144 --http --http.api=eth,web3,net,txpool, --txpool.globalslots=250000 --txpool.globalqueue=50000 --syncmode=fast --maxpeers 100\r\n\r\n\r\n\r\nSee trace below I bolded the line of info where the node becomes out of sync. What is the reason for this is it that I do not use enough cache, should  I limit maxpeers, or some other issue?\r\n\r\n\r\n- INFO [05-17|22:13:11.680] Imported new chain segment               blocks=1  txs=161 mgas=14.973 elapsed=76.824ms  mgasps=194.903 number=12455620 hash=\"782690…bfec0c\" dirty=589.21MiB\r\n- INFO [05-17|22:13:11.683] Unindexed transactions                   blocks=1  txs=97  tail=10105621 elapsed=\"997.1µs\"\r\n- INFO [05-17|22:13:22.337] Imported new chain segment               blocks=1  txs=216 mgas=14.964 elapsed=281.673ms mgasps=53.125  number=12455621 hash=\"a26cc8…50718d\" dirty=589.12MiB\r\n- INFO [05-17|22:13:22.337] Unindexed transactions                   blocks=1  txs=134 tail=10105622 elapsed=0s\r\n- INFO [05-17|22:13:22.841] Imported new chain segment               blocks=1  txs=1   mgas=12.322 elapsed=373.258ms mgasps=33.012  number=12455622 hash=\"ebcc85…0dfdd4\" dirty=588.45MiB\r\n- INFO [05-17|22:13:22.845] Unindexed transactions                   blocks=1  txs=113 tail=10105623 elapsed=1.219ms\r\n- INFO [05-17|22:13:34.094] Deep froze chain segment                 blocks=7  elapsed=7.978ms   number=12365622 hash=\"0189fe…617c45\"\r\n- **INFO [05-17|22:14:29.156]** Imported new chain segment               blocks=1  txs=327 mgas=14.958 elapsed=172.619ms mgasps=86.654  number=12455623 hash=\"ee3d80…507ef2\" **age=1m6s**   dirty=588.65MiB\r\n- INFO [05-17|22:14:29.160] Unindexed transactions                   blocks=1  txs=111 tail=10105624 elapsed=\"997.3µs\"\r\n- INFO [05-17|22:14:55.821] Imported new chain segment               blocks=1  txs=312 mgas=14.964 elapsed=588.364ms mgasps=25.433  number=12455624 hash=\"91406d…598de9\" dirty=588.72MiB\r\n\r\n\r\n\r\nWhen submitting logs: please submit them as text and not screenshots.",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22891/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22891/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/842900561",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22891#issuecomment-842900561",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22891",
    "id": 842900561,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MjkwMDU2MQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-18T06:51:13Z",
    "updated_at": "2021-05-18T06:51:13Z",
    "author_association": "MEMBER",
    "body": "The 'age' of a block is the header timestamp, which is set before the miner starts grinding the proof of work. As such, it's fully possible that the time on a brand new mined block is a bit 'old' already, since the mining time varies a bit. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/842900561/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/842941797",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22891#issuecomment-842941797",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22891",
    "id": 842941797,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0Mjk0MTc5Nw==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-18T07:50:15Z",
    "updated_at": "2021-05-18T07:50:15Z",
    "author_association": "MEMBER",
    "body": "12455623's timestamp is 02:13:23 (the timestamp is when mining starts, so it's the mining timestamp of the parent).\r\n12455624's timestamp is 02:14:28 (the mining time of 12455623).\r\n\r\nSo, it adds up, the \"age\" of 12455623 was correctly 1m6s, because it took 1m5s to mine it (and maybe a bit on top to propagate).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/842941797/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/843342638",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22891#issuecomment-843342638",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22891",
    "id": 843342638,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MzM0MjYzOA==",
    "user": {
      "login": "ScriptLike",
      "id": 26418129,
      "node_id": "MDQ6VXNlcjI2NDE4MTI5",
      "avatar_url": "https://avatars.githubusercontent.com/u/26418129?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ScriptLike",
      "html_url": "https://github.com/ScriptLike",
      "followers_url": "https://api.github.com/users/ScriptLike/followers",
      "following_url": "https://api.github.com/users/ScriptLike/following{/other_user}",
      "gists_url": "https://api.github.com/users/ScriptLike/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ScriptLike/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ScriptLike/subscriptions",
      "organizations_url": "https://api.github.com/users/ScriptLike/orgs",
      "repos_url": "https://api.github.com/users/ScriptLike/repos",
      "events_url": "https://api.github.com/users/ScriptLike/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ScriptLike/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-18T16:43:02Z",
    "updated_at": "2021-05-18T17:04:52Z",
    "author_association": "NONE",
    "body": "@karalabe and @holiman  I looked on etherscan and from block 12455623  and for a few more blocks my node was a couple seconds behind confirming blocks than the confirmed timestamp on etherscan and then after a few more blocks the confirmed time for etherscan and my node were the same again. Is there anything I can do for my node to make sure that the incoming block is the most up to date and not a minute in the past? Should I run another geth node?\r\n\r\nAnother question is this occurrence of having the age being slightly in the past normal? I would really prefer not to have a minute stall on new blocks.\r\n\r\n> 12455623's timestamp is 02:13:23 (the timestamp is when mining starts, so it's the mining timestamp of the parent).\r\n> 12455624's timestamp is 02:14:28 (the mining time of 12455623).\r\n> \r\n> So, it adds up, the \"age\" of 12455623 was correctly 1m6s, because it took 1m5s to mine it (and maybe a bit on top to propagate).\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/843342638/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
