{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1231",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1231/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1231/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1231/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/1231",
  "id": 86947616,
  "node_id": "MDU6SXNzdWU4Njk0NzYxNg==",
  "number": 1231,
  "title": "SEC-45 DoS in hash downloader ",
  "user": {
    "login": "Gustav-Simonsson",
    "id": 293096,
    "node_id": "MDQ6VXNlcjI5MzA5Ng==",
    "avatar_url": "https://avatars.githubusercontent.com/u/293096?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Gustav-Simonsson",
    "html_url": "https://github.com/Gustav-Simonsson",
    "followers_url": "https://api.github.com/users/Gustav-Simonsson/followers",
    "following_url": "https://api.github.com/users/Gustav-Simonsson/following{/other_user}",
    "gists_url": "https://api.github.com/users/Gustav-Simonsson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Gustav-Simonsson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Gustav-Simonsson/subscriptions",
    "organizations_url": "https://api.github.com/users/Gustav-Simonsson/orgs",
    "repos_url": "https://api.github.com/users/Gustav-Simonsson/repos",
    "events_url": "https://api.github.com/users/Gustav-Simonsson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Gustav-Simonsson/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2015-06-10T12:09:43Z",
  "updated_at": "2015-07-01T15:16:46Z",
  "closed_at": "2015-07-01T15:16:45Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "The cross-check is not enough to limit a malicious peer from DoSing a node. An attacker can construct a \"valid\" chain of hashes and keep sending them to a node while caching enough blocks to satisfy cross-checks (which do not fully validate blocks).\n\nThis causes the node to eventually run out of memory as it keeps all hashes downloaded from a peer.\n\nRelated: https://github.com/ethereum/wiki/wiki/Proposal:-BlockHashesFromNumbers\n\nRelated but distinct DoS (affects peer logic/reputation):\n\nWhen a node is syncing up to a longer chain from an attacker, there is a time window between receiving NewBlockMsg and the point where the downloader decides the peer is bad.\n\nIn this window, if the bad peer advertises a block which we do not have the parentHash for, the node will go into synchronization. If the bad peer disconnects, re-connects and repeats the bad block advertising, it will DoS the node and interrupt it indefinitely, preventing it from switching downloading to another peer.\n\nWe need to find a way to accept blocks from peers other than the \"best\" peer based on advertised (but not validated) TD, such that this type of attack is not effective for longer than a short time period.\n",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1231/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1231/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/110833777",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1231#issuecomment-110833777",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1231",
    "id": 110833777,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMDgzMzc3Nw==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-10T16:57:11Z",
    "updated_at": "2015-06-11T09:16:03Z",
    "author_association": "MEMBER",
    "body": "As mentioned in both the above mentioned proposal and in SEC-45 too, the only way to be able to circumvent this attack is to support some mechanism to query hashes/blocks upwards from out current position. There are two issues to be solved here:\n- [ ] Add a mechanism to figure out the common ancestor between our chain and a remote peer's chain. Essentially we require a binary search over out own block chain, querying the remote peer if it has the specific block or not. ~~This can be done cleanly using a new packet, or hackishly by issuing hash requests of length 1. However, I'm not sure the hash request protocol message has all the guarantees that we would need (i.e. return only from the canonical chain) to satisfy this algorithm, so there may be a need for protocol extensions.~~\n- [ ] Add a mechanism to be able to query some data (block/hash) upwards from a given position/hash. The simplest and most non intrusive extension would be the addition of a new flag to the get hashes message, specifying whether the hashes should be retrieved downwards or upwards the chain.\n\nIf we can introduce the necessary changes for upwards chain reconstruction, I don't really see the need either for parallel hash downloads (hashes will load instantly compared to blocks), nor do I see complicating the status messages with chain heights, and the likes and required by the OP linked proposal\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/110833777/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/112121584",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1231#issuecomment-112121584",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1231",
    "id": 112121584,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMjEyMTU4NA==",
    "user": {
      "login": "Gustav-Simonsson",
      "id": 293096,
      "node_id": "MDQ6VXNlcjI5MzA5Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/293096?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gustav-Simonsson",
      "html_url": "https://github.com/Gustav-Simonsson",
      "followers_url": "https://api.github.com/users/Gustav-Simonsson/followers",
      "following_url": "https://api.github.com/users/Gustav-Simonsson/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gustav-Simonsson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gustav-Simonsson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gustav-Simonsson/subscriptions",
      "organizations_url": "https://api.github.com/users/Gustav-Simonsson/orgs",
      "repos_url": "https://api.github.com/users/Gustav-Simonsson/repos",
      "events_url": "https://api.github.com/users/Gustav-Simonsson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gustav-Simonsson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-15T16:07:23Z",
    "updated_at": "2015-06-15T16:07:23Z",
    "author_association": "NONE",
    "body": "@karalabe added a second distinct but related DoS to the description\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/112121584/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/112123614",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1231#issuecomment-112123614",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1231",
    "id": 112123614,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExMjEyMzYxNA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-15T16:12:10Z",
    "updated_at": "2015-06-15T16:12:10Z",
    "author_association": "MEMBER",
    "body": "@Gustav-Simonsson actually, the attack is not that feasible. There is a 30 second connection timeout in the network layer. You cannot connect more often than once per 30 sec, so to execute this attack, you would need to rotate your peer identities.\n\nHowever, maybe the fix to the first issue would also be a fix to this second. We should probably first roll out the fix and then look at this second issue again.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/112123614/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
