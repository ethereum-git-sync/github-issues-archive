{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23112",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23112/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23112/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23112/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23112",
  "id": 930274715,
  "node_id": "MDU6SXNzdWU5MzAyNzQ3MTU=",
  "number": 23112,
  "title": "dumpconfig creates configuration with wrong chain",
  "user": {
    "login": "istoian-ledger",
    "id": 54019550,
    "node_id": "MDQ6VXNlcjU0MDE5NTUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/54019550?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/istoian-ledger",
    "html_url": "https://github.com/istoian-ledger",
    "followers_url": "https://api.github.com/users/istoian-ledger/followers",
    "following_url": "https://api.github.com/users/istoian-ledger/following{/other_user}",
    "gists_url": "https://api.github.com/users/istoian-ledger/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/istoian-ledger/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/istoian-ledger/subscriptions",
    "organizations_url": "https://api.github.com/users/istoian-ledger/orgs",
    "repos_url": "https://api.github.com/users/istoian-ledger/repos",
    "events_url": "https://api.github.com/users/istoian-ledger/events{/privacy}",
    "received_events_url": "https://api.github.com/users/istoian-ledger/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-06-25T15:21:48Z",
  "updated_at": "2021-07-02T08:24:53Z",
  "closed_at": "2021-07-02T08:24:53Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `1.10.4`\r\nOS & Version: Ubuntu 20.04.2 LTS\r\nCommit hash : aa637fd3\r\n\r\n\r\n#### Expected behaviour\r\nNode is started with the correct configuration\r\n````\r\n  protocols: {\r\n    eth: {\r\n      config: {\r\n        berlinBlock: 9812189,\r\n        byzantiumBlock: 1700000,\r\n        chainId: 3,\r\n        constantinopleBlock: 4230000,\r\n        daoForkSupport: true,\r\n        eip150Block: 0,\r\n        eip150Hash: \"0x41941023680923e0fe4d74a34bdac8141f2540e3ae90623718e47d66d1ca4a2d\",\r\n        eip155Block: 10,\r\n        eip158Block: 10,\r\n        ethash: {},\r\n        homesteadBlock: 0,\r\n        istanbulBlock: 6485846,\r\n        londonBlock: 10499401,\r\n        muirGlacierBlock: 7117117,\r\n        petersburgBlock: 4939394\r\n      },\r\n      difficulty: 636744809587392,\r\n      genesis: \"0x41941023680923e0fe4d74a34bdac8141f2540e3ae90623718e47d66d1ca4a2d\",\r\n      head: \"0x6c32de349a0d9579e7e9e28e3e93329e0c4c501d205ef4dc1af03b0a3b582866\",\r\n      network: 3\r\n    },\r\n    snap: {}\r\n  }\r\n````\r\n\r\n#### Actual behaviour\r\nNode starts with incorrect configuration\r\n````\r\n  protocols: {\r\n    eth: {\r\n      config: {\r\n        berlinBlock: 12244000,\r\n        byzantiumBlock: 4370000,\r\n        chainId: 1,\r\n        constantinopleBlock: 7280000,\r\n        daoForkBlock: 1920000,\r\n        daoForkSupport: true,\r\n        eip150Block: 2463000,\r\n        eip150Hash: \"0x2086799aeebeae135c246c65021c82b4e15a2c451340993aacfd2751886514f0\",\r\n        eip155Block: 2675000,\r\n        eip158Block: 2675000,\r\n        ethash: {},\r\n        homesteadBlock: 1150000,\r\n        istanbulBlock: 9069000,\r\n        muirGlacierBlock: 9200000,\r\n        petersburgBlock: 7280000\r\n      },\r\n      difficulty: 17179869184,\r\n      genesis: \"0xd4e56740f876aef8c010b86a40d5f56745a118d0906a34e69aec8c0db1cb8fa3\",\r\n      head: \"0xd4e56740f876aef8c010b86a40d5f56745a118d0906a34e69aec8c0db1cb8fa3\",\r\n      network: 3\r\n    },\r\n    snap: {}\r\n````\r\n\r\n#### Steps to reproduce the behaviour\r\nWhen bootstrapping geth node in ropsten chain with \r\n`/home/ethereum/ropsten/bin/1.10.4/geth --ropsten --syncmode full --gcmode archive --http --http.port 20100 --port 20150 --cache 4096 --http.api admin,net,eth,txpool,web3,debug --http.vhosts \"*\" --datadir /home/ethereum/ropsten/data dumpconfig > /home/ethereum/ropsten/configs/ethereum-ropsten.conf`\r\n\r\nand later starting the node with \r\n`/home/ethereum/ropsten/bin/1.10.4/geth -config /home/ethereum/ropsten/configs/ethereum-ropsten.conf -datadir /home/ethereum/ropsten/data`\r\n\r\nthe node is not able to sync with the chain due to the absence of peers.\r\n\r\nHowever, if running node with \r\n`/home/ethereum/ropsten/bin/1.10.4/geth --ropsten --syncmode full --gcmode archive --http --http.port 20100 --port 20150 --cache 4096 --http.api admin,net,eth,txpool,web3,debug --http.vhosts \"*\" --datadir /home/ethereum/ropsten/data ` and letting it run, it finds peers and starts syncing with chain. After this, dumping config file and using it for consequent starts of the node works flawlessly.\r\n\r\n#### Backtrace\r\n\r\n````\r\nStarting Ethereum Ropsten node (geth)...\r\nStarted Ethereum Ropsten node (geth).\r\nINFO [06-25|15:04:06.136] Starting Geth on Ethereum mainnet...\r\nINFO [06-25|15:04:06.136] Bumping default cache on mainnet         provided=1024 updated=4096\r\nINFO [06-25|15:04:06.138] Maximum peer count                       ETH=50 LES=0 total=50\r\nINFO [06-25|15:04:06.138] Smartcard socket not found, disabling    err=\"stat /run/pcscd/pcscd.comm: no such file or directory\"\r\nINFO [06-25|15:04:06.138] Enabling recording of key preimages since archive mode is used\r\nINFO [06-25|15:04:06.138] Set global gas cap                       cap=50,000,000\r\nINFO [06-25|15:04:06.138] Allocated trie memory caches             clean=1.20GiB dirty=0.00B\r\nINFO [06-25|15:04:06.138] Allocated cache and file handles         database=/home/ethereum/ropsten/data/geth/chaindata cache=2.00GiB handles=262,144\r\nINFO [06-25|15:04:06.145] Opened ancient database                  database=/home/ethereum/ropsten/data/geth/chaindata/ancient readonly=false\r\nINFO [06-25|15:04:06.145] Writing default main-net genesis block\r\nINFO [06-25|15:04:06.259] Persisted trie from memory database      nodes=12356 size=1.78MiB time=32.840972ms gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B\r\nINFO [06-25|15:04:06.260] Initialised chain configuration          config=\"{ChainID: 1 Homestead: 1150000 DAO: 1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000 Byzantium: 4370000 Constantinople: 7280000 Petersburg: 7280000 Istanbul: 9069000, Muir Glacier: 9200000, Berlin: 12244000, London: <nil>, Engine: ethash}\"\r\nINFO [06-25|15:04:06.260] Disk storage enabled for ethash caches   dir=/home/ethereum/ropsten/data/geth/ethash count=3\r\nINFO [06-25|15:04:06.260] Disk storage enabled for ethash DAGs     dir=/home/ethereum/.ethash                  count=2\r\nINFO [06-25|15:04:06.260] Initialising Ethereum protocol           network=3 dbversion=<nil>\r\nINFO [06-25|15:04:06.260] Loaded most recent local header          number=0 hash=d4e567..cb8fa3 td=17,179,869,184 age=52y2mo3w\r\nINFO [06-25|15:04:06.260] Loaded most recent local full block      number=0 hash=d4e567..cb8fa3 td=17,179,869,184 age=52y2mo3w\r\nINFO [06-25|15:04:06.260] Loaded most recent local fast block      number=0 hash=d4e567..cb8fa3 td=17,179,869,184 age=52y2mo3w\r\nWARN [06-25|15:04:06.260] Failed to load snapshot, regenerating    err=\"missing or corrupted snapshot\"\r\nINFO [06-25|15:04:06.260] Rebuilding state snapshot\r\nINFO [06-25|15:04:06.261] Resuming state snapshot generation       root=d7f897..0f0544 accounts=0 slots=0 storage=0.00B elapsed=\"325.845µs\"\r\nINFO [06-25|15:04:06.261] Regenerated local transaction journal    transactions=0 accounts=0\r\nINFO [06-25|15:04:06.261] Gasprice oracle is ignoring threshold set threshold=2\r\nWARN [06-25|15:04:06.261] Error reading unclean shutdown markers   error=\"leveldb: not found\"\r\nINFO [06-25|15:04:06.261] Starting peer-to-peer node               instance=Geth/v1.10.4-stable-aa637fd3/linux-amd64/go1.16.4\r\nINFO [06-25|15:04:06.263] New local node record                    seq=1 id=769054eac948d1e2 ip=127.0.0.1 udp=20150 tcp=20150\r\nINFO [06-25|15:04:06.263] Started P2P networking                   self=enode://34940c98f1b13fb9a50235c163eeebe888f5339a8c5668c406410c428de8d9f0442e74edd2e8ea77cb560e4b348311df9725deb8698fa3db3902aea1ed2fabd2@127.0.0.1:20150\r\nINFO [06-25|15:04:06.264] IPC endpoint opened                      url=/home/ethereum/ropsten/data/geth.ipc\r\nINFO [06-25|15:04:06.264] HTTP server started                      endpoint=10.99.0.236:20100 prefix= cors= vhosts=*\r\nINFO [06-25|15:04:06.330] Generated state snapshot                 accounts=8893 slots=0 storage=409.64KiB elapsed=69.706ms\r\nINFO [06-25|15:04:12.055] New local node record                    seq=2 id=769054eac948d1e2 ip=51.178.91.200 udp=20150 tcp=20150\r\nINFO [06-25|15:04:16.322] Looking for peers                        peercount=0 tried=15 static=0\r\nWARN [06-25|15:04:26.082] Served eth_coinbase                      conn=10.99.0.236:45854 reqid=3 t=\"20.269µs\" err=\"etherbase must be explicitly specified\"\r\nINFO [06-25|15:04:26.445] Looking for peers                        peercount=0 tried=25 static=0\r\nINFO [06-25|15:04:36.446] Looking for peers                        peercount=0 tried=27 static=0\r\nINFO [06-25|15:04:46.555] Looking for peers                        peercount=0 tried=29 static=0\r\nINFO [06-25|15:04:56.868] Looking for peers                        peercount=0 tried=38 static=0\r\nINFO [06-25|15:05:06.951] Looking for peers                        peercount=0 tried=34 static=0\r\nINFO [06-25|15:05:17.110] Looking for peers                        peercount=0 tried=30 static=0\r\nINFO [06-25|15:05:27.282] Looking for peers                        peercount=0 tried=33 static=0\r\nINFO [06-25|15:05:37.305] Looking for peers                        peercount=0 tried=33 static=0\r\nINFO [06-25|15:05:47.563] Looking for peers                        peercount=0 tried=30 static=0\r\n\r\n````\r\n",
  "closed_by": {
    "login": "s1na",
    "id": 1591639,
    "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/s1na",
    "html_url": "https://github.com/s1na",
    "followers_url": "https://api.github.com/users/s1na/followers",
    "following_url": "https://api.github.com/users/s1na/following{/other_user}",
    "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
    "organizations_url": "https://api.github.com/users/s1na/orgs",
    "repos_url": "https://api.github.com/users/s1na/repos",
    "events_url": "https://api.github.com/users/s1na/events{/privacy}",
    "received_events_url": "https://api.github.com/users/s1na/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23112/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23112/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/869819142",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23112#issuecomment-869819142",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23112",
    "id": 869819142,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2OTgxOTE0Mg==",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-28T16:15:19Z",
    "updated_at": "2021-06-28T16:15:19Z",
    "author_association": "MEMBER",
    "body": "I tried to reproduce this. Doing `./geth --ropsten --config ropsten.conf` works, but as op suggests `./geth --config ropsten.conf` doesn't seem to suffice and geth generates the mainnet genesis and uses mainnet chainId. Will dig a bit deeper.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/869819142/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/872817175",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23112#issuecomment-872817175",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23112",
    "id": 872817175,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MjgxNzE3NQ==",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-02T08:24:53Z",
    "updated_at": "2021-07-02T08:24:53Z",
    "author_association": "MEMBER",
    "body": "I asked others about this and found out that the chain flag needs to be provided along with `--config` and documented that in #23146. As far as I gathered, the reason is not all chain info is stored in the config file and that's a deliberate design decision to avoid difficulties for future hardforks.\r\n\r\nSo even though this is a sub-optimal user experience it'll probably stay this way at least until a relatively significant re-design. Closing for now. Thanks for reporting it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/872817175/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
