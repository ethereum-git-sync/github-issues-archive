{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19940",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19940/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19940/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19940/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/19940",
  "id": 479575333,
  "node_id": "MDU6SXNzdWU0Nzk1NzUzMzM=",
  "number": 19940,
  "title": "Question: How can a user specify the number of block after which pruning happens?",
  "user": {
    "login": "LefterisJP",
    "id": 1658405,
    "node_id": "MDQ6VXNlcjE2NTg0MDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1658405?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LefterisJP",
    "html_url": "https://github.com/LefterisJP",
    "followers_url": "https://api.github.com/users/LefterisJP/followers",
    "following_url": "https://api.github.com/users/LefterisJP/following{/other_user}",
    "gists_url": "https://api.github.com/users/LefterisJP/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LefterisJP/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LefterisJP/subscriptions",
    "organizations_url": "https://api.github.com/users/LefterisJP/orgs",
    "repos_url": "https://api.github.com/users/LefterisJP/repos",
    "events_url": "https://api.github.com/users/LefterisJP/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LefterisJP/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2019-08-12T10:35:20Z",
  "updated_at": "2020-08-27T08:59:30Z",
  "closed_at": "2019-08-12T17:12:08Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Problem Definition\r\n\r\nThis is just a question I had. Tried to contact you through gitter and twitter but no response yet so I guess an issue is also good since other people may have the same question.\r\n\r\nIn Raiden we would like to emulate the behaviour of some old blocks being pruned in some of our tests. So naturally the question came up how can this be achieved with geth.\r\n\r\n## Question\r\n\r\nIs there any combination of arguments that can guarantee the number of blocks after which old state is pruned and won't be returned when queried?",
  "closed_by": {
    "login": "LefterisJP",
    "id": 1658405,
    "node_id": "MDQ6VXNlcjE2NTg0MDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1658405?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LefterisJP",
    "html_url": "https://github.com/LefterisJP",
    "followers_url": "https://api.github.com/users/LefterisJP/followers",
    "following_url": "https://api.github.com/users/LefterisJP/following{/other_user}",
    "gists_url": "https://api.github.com/users/LefterisJP/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LefterisJP/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LefterisJP/subscriptions",
    "organizations_url": "https://api.github.com/users/LefterisJP/orgs",
    "repos_url": "https://api.github.com/users/LefterisJP/repos",
    "events_url": "https://api.github.com/users/LefterisJP/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LefterisJP/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19940/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19940/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/520480220",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19940#issuecomment-520480220",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19940",
    "id": 520480220,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMDQ4MDIyMA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-12T15:44:47Z",
    "updated_at": "2019-08-12T15:44:47Z",
    "author_association": "MEMBER",
    "body": "Geth does in-memory pruning for blocks older than HEAD-128. Periodically some states are flushed to disk (every hour + on shutdown). There's no disk pruning yet.\r\n\r\n# Answer\r\n\r\n128 blocks, don't restart Geth in between",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/520480220/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/520495567",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19940#issuecomment-520495567",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19940",
    "id": 520495567,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMDQ5NTU2Nw==",
    "user": {
      "login": "LefterisJP",
      "id": 1658405,
      "node_id": "MDQ6VXNlcjE2NTg0MDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1658405?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LefterisJP",
      "html_url": "https://github.com/LefterisJP",
      "followers_url": "https://api.github.com/users/LefterisJP/followers",
      "following_url": "https://api.github.com/users/LefterisJP/following{/other_user}",
      "gists_url": "https://api.github.com/users/LefterisJP/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LefterisJP/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LefterisJP/subscriptions",
      "organizations_url": "https://api.github.com/users/LefterisJP/orgs",
      "repos_url": "https://api.github.com/users/LefterisJP/repos",
      "events_url": "https://api.github.com/users/LefterisJP/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LefterisJP/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-12T16:24:28Z",
    "updated_at": "2019-08-12T16:24:28Z",
    "author_association": "MEMBER",
    "body": "Hey Peter, thanks for the response.\r\n\r\nSo it's not configurable at all? Can we somehow put it to 5 blocks for a testcase?\r\n\r\nAlso I am trying to determine if the 128 limit is strictly fixed. We have a test that tries to test for this and the test is flaky in between. Some times it works at the 129th block but sometimes it does not. \r\n\r\nCould there be other factors that could make geth not prune for blocks older than HEAD-128 ?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/520495567/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/520500900",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19940#issuecomment-520500900",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19940",
    "id": 520500900,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMDUwMDkwMA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-12T16:39:45Z",
    "updated_at": "2019-08-12T16:39:45Z",
    "author_association": "MEMBER",
    "body": "Well, if you run a PoA chain (clique, dev mode) and HEAD-127 doesn't contain any transactions, then the state of HEAD-127 will be the same as HEAD-128, so it will still be referenced and not deleted.\r\n\r\nThe number 128 is hard coded as the sync code needs to be aware of what state is available in the network and what isn't, so we can't allow users to change it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/520500900/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/520501942",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19940#issuecomment-520501942",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19940",
    "id": 520501942,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMDUwMTk0Mg==",
    "user": {
      "login": "LefterisJP",
      "id": 1658405,
      "node_id": "MDQ6VXNlcjE2NTg0MDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1658405?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LefterisJP",
      "html_url": "https://github.com/LefterisJP",
      "followers_url": "https://api.github.com/users/LefterisJP/followers",
      "following_url": "https://api.github.com/users/LefterisJP/following{/other_user}",
      "gists_url": "https://api.github.com/users/LefterisJP/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LefterisJP/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LefterisJP/subscriptions",
      "organizations_url": "https://api.github.com/users/LefterisJP/orgs",
      "repos_url": "https://api.github.com/users/LefterisJP/repos",
      "events_url": "https://api.github.com/users/LefterisJP/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LefterisJP/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-12T16:42:52Z",
    "updated_at": "2019-08-12T16:42:52Z",
    "author_association": "MEMBER",
    "body": "> Well, if you run a PoA chain (clique, dev mode) and HEAD-127 doesn't contain any transactions, then the state of HEAD-127 will be the same as HEAD-128, so it will still be referenced and not deleted.\r\n\r\nThank you that's valuable info. Let us investigate on the flakiness then.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/520501942/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/520512635",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19940#issuecomment-520512635",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19940",
    "id": 520512635,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMDUxMjYzNQ==",
    "user": {
      "login": "LefterisJP",
      "id": 1658405,
      "node_id": "MDQ6VXNlcjE2NTg0MDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1658405?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LefterisJP",
      "html_url": "https://github.com/LefterisJP",
      "followers_url": "https://api.github.com/users/LefterisJP/followers",
      "following_url": "https://api.github.com/users/LefterisJP/following{/other_user}",
      "gists_url": "https://api.github.com/users/LefterisJP/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LefterisJP/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LefterisJP/subscriptions",
      "organizations_url": "https://api.github.com/users/LefterisJP/orgs",
      "repos_url": "https://api.github.com/users/LefterisJP/repos",
      "events_url": "https://api.github.com/users/LefterisJP/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LefterisJP/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-12T17:12:08Z",
    "updated_at": "2019-08-12T17:12:08Z",
    "author_association": "MEMBER",
    "body": "I will close this issue as I the questions have been answered. May open more if more questions arise. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/520512635/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
