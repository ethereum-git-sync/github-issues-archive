{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28740",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28740/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28740/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28740/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/28740",
  "id": 2057366145,
  "node_id": "I_kwDOAOvK9856oOqB",
  "number": 28740,
  "title": "Improve error handling",
  "user": {
    "login": "joy4eg",
    "id": 878385,
    "node_id": "MDQ6VXNlcjg3ODM4NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/878385?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/joy4eg",
    "html_url": "https://github.com/joy4eg",
    "followers_url": "https://api.github.com/users/joy4eg/followers",
    "following_url": "https://api.github.com/users/joy4eg/following{/other_user}",
    "gists_url": "https://api.github.com/users/joy4eg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/joy4eg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/joy4eg/subscriptions",
    "organizations_url": "https://api.github.com/users/joy4eg/orgs",
    "repos_url": "https://api.github.com/users/joy4eg/repos",
    "events_url": "https://api.github.com/users/joy4eg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/joy4eg/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-12-27T13:19:34Z",
  "updated_at": "2024-01-18T12:10:55Z",
  "closed_at": "2024-01-18T12:10:54Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\nVersion v1.13.8\r\n\r\n#### Expected behaviour\r\n```golang\r\nimport (\r\n    \"errors\"\r\n\r\n    \"github.com/ethereum/go-ethereum/core\"\r\n    \"github.com/ethereum/go-ethereum/ethclient\"\r\n)\r\n\r\nclient, err := ethclient.DialContext(ctx, endpoint)\r\n...\r\n_, err := client.SendTransaction(...)\r\nif errors.Is(err, core.ErrInsufficientFunds) {\r\n    // Some logic goes here.\r\n}\r\n```\r\n\r\n#### Actual behaviour\r\n```golang\r\n_, err := client.SendTransaction(...) // err = insufficient funds for gas * price + value: balance A, queued cost B, tx cost C, overshot D\r\nif errors.Is(err, core.ErrInsufficientFunds) { // <--- always FALSE here.\r\n    // Some logic goes here.\r\n}\r\n```\r\n\r\nIt looks like that RPC client returns errors from a node as-is. Just a string:\r\n```golang\r\n        // &rpc.jsonrpcMessage{Version:\"2.0\", ID:json.RawMessage{0x33}, Method:\"\", Params:json.RawMessage(nil), Error:(*rpc.jsonError)(0xc000940e70), Result:json.RawMessage(nil)} --> {\"jsonrpc\":\"2.0\",\"id\":3,\"error\":{\"code\":-32000,\"message\":\"insufficient funds for gas * price + value: balance A, queued cost B, tx cost C, overshot D\"}}\r\n\tresp := batchresp[0]\r\n\tswitch {\r\n\tcase resp.Error != nil:\r\n\t\treturn resp.Error // <--- Error message.\r\n\tcase len(resp.Result) == 0:\r\n\t\treturn ErrNoResult\r\n\tdefault:\r\n\t\tif result == nil {\r\n\t\t\treturn nil\r\n\t\t}\r\n\t\treturn json.Unmarshal(resp.Result, result)\r\n\t}\r\n```\r\nIn that way, it's impossible to check the error code/message using pre-defined `core.ErrXXX` constants, which makes error handling painful and confusing. \r\n",
  "closed_by": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28740/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28740/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1870860036",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28740#issuecomment-1870860036",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28740",
    "id": 1870860036,
    "node_id": "IC_kwDOAOvK985vgw8E",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-28T06:16:33Z",
    "updated_at": "2023-12-28T06:16:51Z",
    "author_association": "MEMBER",
    "body": "Ethclient is a SDK can interact with any ethereum client which implements the standard JSONRPC spec, not just go-ethereum.\r\n\r\nChecking error with error type is a very golang-specific thing, so we recommend you to handle the error by using error code and error message.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1870860036/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1873855543",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28740#issuecomment-1873855543",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28740",
    "id": 1873855543,
    "node_id": "IC_kwDOAOvK985vsMQ3",
    "user": {
      "login": "joy4eg",
      "id": 878385,
      "node_id": "MDQ6VXNlcjg3ODM4NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/878385?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/joy4eg",
      "html_url": "https://github.com/joy4eg",
      "followers_url": "https://api.github.com/users/joy4eg/followers",
      "following_url": "https://api.github.com/users/joy4eg/following{/other_user}",
      "gists_url": "https://api.github.com/users/joy4eg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/joy4eg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/joy4eg/subscriptions",
      "organizations_url": "https://api.github.com/users/joy4eg/orgs",
      "repos_url": "https://api.github.com/users/joy4eg/repos",
      "events_url": "https://api.github.com/users/joy4eg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/joy4eg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-02T10:35:16Z",
    "updated_at": "2024-01-02T10:35:16Z",
    "author_association": "NONE",
    "body": ">Checking error with error type is a very golang-specific thing, so we recommend you to handle the error by using error code and error message.\r\n\r\nWell, in that case, it would be nice to have a note about this behavior/approach somewhere in the documentation. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1873855543/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1898155895",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28740#issuecomment-1898155895",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28740",
    "id": 1898155895,
    "node_id": "IC_kwDOAOvK985xI493",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-18T09:58:14Z",
    "updated_at": "2024-01-18T09:58:14Z",
    "author_association": "MEMBER",
    "body": "The underlying issue is that package core is not a stable API. It's basically an internal package that implements the Ethereum protocol. The exposed API surface of core is there for Geth to use, but we don't promise it will be stable.\r\n\r\nPackage ethclient IS a stable API for users to consume however. So I understand your frustration with navigating this mix of public and non-public functionality.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1898155895/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1898362723",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28740#issuecomment-1898362723",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28740",
    "id": 1898362723,
    "node_id": "IC_kwDOAOvK985xJrdj",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-18T12:10:54Z",
    "updated_at": "2024-01-18T12:10:54Z",
    "author_association": "MEMBER",
    "body": "We are unfortunately not at a point where the errors from tx validation are forwarded to clients as JSON-RPC error codes. Work toward more error codes is ongoing.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1898362723/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  }
]
