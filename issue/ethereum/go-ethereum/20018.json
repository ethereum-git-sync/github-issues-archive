{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20018",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20018/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20018/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20018/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/20018",
  "id": 486837432,
  "node_id": "MDU6SXNzdWU0ODY4Mzc0MzI=",
  "number": 20018,
  "title": "Periodic stops of new blocks, paired with large disk ops",
  "user": {
    "login": "jleeh",
    "id": 10528926,
    "node_id": "MDQ6VXNlcjEwNTI4OTI2",
    "avatar_url": "https://avatars.githubusercontent.com/u/10528926?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jleeh",
    "html_url": "https://github.com/jleeh",
    "followers_url": "https://api.github.com/users/jleeh/followers",
    "following_url": "https://api.github.com/users/jleeh/following{/other_user}",
    "gists_url": "https://api.github.com/users/jleeh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jleeh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jleeh/subscriptions",
    "organizations_url": "https://api.github.com/users/jleeh/orgs",
    "repos_url": "https://api.github.com/users/jleeh/repos",
    "events_url": "https://api.github.com/users/jleeh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jleeh/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2019-08-29T09:16:07Z",
  "updated_at": "2019-09-02T18:57:11Z",
  "closed_at": "2019-09-02T18:57:11Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `Geth/v1.9.3-unstable-396f1dd8-20190827/linux-amd64/go1.12.6` (I've seen this from versions 1.9.0>)  \r\nOS & Version: Linux\r\n\r\n#### Expected behaviour\r\n\r\nExpected behaviour is to see no delay/issue with getting new blocks in if there's no contention of resources on the servers.\r\n\r\n#### Actual behaviour\r\n\r\n**Some context:** I run a Geth mainnet cluster that services oracles that operate by log filters that depend on new blocks. The speed & reliability of those new blocks getting in is paramount, so I enforce a healthcheck within the cluster that does a basic comparison of the full nodes against Etherscan. If the full nodes aren't up to date compared, the Geth instance will be restarted so each oracle is rebalanced to a node that is currently at the latest height. From monitoring these nodes, it seems the healthcheck catches nodes behind every 2-4hr.\r\n\r\nLogging output:\r\n```\r\nAug 29 08:01:03 ip-10-6-87-63 geth: INFO [08-29|08:01:03.266] Deep froze chain segment blocks=5 elapsed=499.832ms number=8353860 hash=bdbcdc…2b9566\r\nAug 29 08:01:04 ip-10-6-87-63 geth: INFO [08-29|08:01:04.233] Imported new chain segment blocks=1 txs=247 mgas=7.997 elapsed=1.639s mgasps=4.878 number=8443862 hash=fca3ad…05b4d1 dirty=336.42MiB\r\nAug 29 08:01:33 ip-10-6-87-63 geth: INFO [08-29|08:01:33.918] Imported new chain segment blocks=1 txs=157 mgas=8.001 elapsed=144.089ms mgasps=55.526 number=8443863 hash=ffb171…dcd752 dirty=336.76MiB\r\nAug 29 08:01:43 ip-10-6-87-63 geth: INFO [08-29|08:01:43.866] Imported new chain segment blocks=1 txs=202 mgas=7.995 elapsed=161.048ms mgasps=49.642 number=8443864 hash=e4c30e…5e6d0b dirty=337.00MiB\r\nAug 29 08:01:53 ip-10-6-87-63 geth: INFO [08-29|08:01:53.027] Imported new chain segment blocks=1 txs=153 mgas=7.999 elapsed=170.792ms mgasps=46.836 number=8443865 hash=4d280c…972baf dirty=338.12MiB\r\nAug 29 08:02:03 ip-10-6-87-63 geth: INFO [08-29|08:02:03.332] Deep froze chain segment blocks=4 elapsed=57.222ms number=8353864 hash=32662a…a4db93\r\nAug 29 08:02:13 ip-10-6-87-63 geth: INFO [08-29|08:02:13.311] Imported new chain segment blocks=1 txs=166 mgas=8.000 elapsed=218.217ms mgasps=36.660 number=8443866 hash=f53448…92fa05 dirty=338.28MiB\r\nAug 29 08:02:24 ip-10-6-87-63 geth: INFO [08-29|08:02:24.003] Imported new chain segment blocks=1 txs=180 mgas=7.991 elapsed=171.520ms mgasps=46.589 number=8443867 hash=9f75c3…f8e5b8 dirty=338.67MiB\r\nAug 29 08:02:28 ip-10-6-87-63 geth: INFO [08-29|08:02:28.658] Imported new chain segment blocks=1 txs=182 mgas=7.999 elapsed=246.561ms mgasps=32.441 number=8443868 hash=486681…f21dea dirty=338.97MiB\r\nAug 29 08:02:29 ip-10-6-87-63 geth: INFO [08-29|08:02:29.993] Imported new chain segment blocks=1 txs=113 mgas=8.014 elapsed=164.131ms mgasps=48.829 number=8443869 hash=05e97b…5cdef3 dirty=338.92MiB\r\nAug 29 08:02:48 ip-10-6-87-63 geth: INFO [08-29|08:02:48.331] Imported new chain segment blocks=1 txs=125 mgas=8.022 elapsed=153.622ms mgasps=52.221 number=8443870 hash=9044f7…6cfb5f dirty=338.90MiB\r\nAug 29 08:03:03 ip-10-6-87-63 geth: INFO [08-29|08:03:03.388] Deep froze chain segment blocks=5 elapsed=55.810ms number=8353869 hash=987a18…9b99f0\r\nAug 29 08:03:03 ip-10-6-87-63 geth: INFO [08-29|08:03:03.554] Imported new chain segment blocks=1 txs=183 mgas=8.004 elapsed=279.814ms mgasps=28.605 number=8443871 hash=0f38ec…09a6b9 dirty=339.11MiB\r\nAug 29 08:03:28 ip-10-6-87-63 geth: INFO [08-29|08:03:28.427] Imported new chain segment blocks=1 txs=192 mgas=8.002 elapsed=208.235ms mgasps=38.427 number=8443872 hash=b5fd2c…adc4ad dirty=339.32MiB\r\nAug 29 08:03:48 ip-10-6-87-63 geth: INFO [08-29|08:03:48.779] Imported new chain segment blocks=1 txs=177 mgas=7.981 elapsed=192.996ms mgasps=41.355 number=8443873 hash=8373f0…fc3a11 dirty=339.53MiB\r\nAug 29 08:04:03 ip-10-6-87-63 geth: INFO [08-29|08:04:03.452] Deep froze chain segment blocks=3 elapsed=63.828ms number=8353872 hash=ac040b…35256e\r\nAug 29 08:05:02 ip-10-6-87-63 systemd: Stopping Go Ethereum Daemon...\r\nAug 29 08:05:02 ip-10-6-87-63 geth: INFO [08-29|08:05:02.133] Got interrupt, shutting down...\r\n```\r\nFrom those logs, block 8443873 was the last but by looking at the timestamps on Etherscan, the Geth node should of received up to block 8443881 before the healthcheck intervened.\r\n\r\n**Disk ops:**\r\nEvery time I've looking into specific restarts, it always coincides with a high amount of read operations on-disk. Each spike of ops doesn't result in a loss of blocks, but each restart does always co-inside with high ops.\r\n![image](https://user-images.githubusercontent.com/10528926/63926920-96e9c380-ca44-11e9-8829-2671d87b002e.png)\r\n\r\n**Burst credits:**\r\nSince these are GP2 disks that are over provisioned for a larger ops count, we didn't run out of burst credits:\r\n![image](https://user-images.githubusercontent.com/10528926/63927433-969df800-ca45-11e9-85a3-40f434f681ad.png)\r\n\r\n**CPU & RAM:**\r\nNothing unusual here, the boxes always stay around 30-45% CPU and 60-75% RAM utilisation:\r\n![image](https://user-images.githubusercontent.com/10528926/63927261-40c95000-ca45-11e9-9144-2bfad7c90076.png)\r\n\r\nAs this is a very open issue, is there anything else I can provide to help looking into this issue? Just logging at a greater level?\r\n\r\nI'm currently also in the process of pointing Prometheus to the in-built endpoint, is there any exported metrics from that which would help investigation?\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nRunning an active Geth node and monitoring the speed of it getting new blocks in.\r\n",
  "closed_by": {
    "login": "jleeh",
    "id": 10528926,
    "node_id": "MDQ6VXNlcjEwNTI4OTI2",
    "avatar_url": "https://avatars.githubusercontent.com/u/10528926?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jleeh",
    "html_url": "https://github.com/jleeh",
    "followers_url": "https://api.github.com/users/jleeh/followers",
    "following_url": "https://api.github.com/users/jleeh/following{/other_user}",
    "gists_url": "https://api.github.com/users/jleeh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jleeh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jleeh/subscriptions",
    "organizations_url": "https://api.github.com/users/jleeh/orgs",
    "repos_url": "https://api.github.com/users/jleeh/repos",
    "events_url": "https://api.github.com/users/jleeh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jleeh/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20018/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20018/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/527224431",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20018#issuecomment-527224431",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20018",
    "id": 527224431,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyNzIyNDQzMQ==",
    "user": {
      "login": "jleeh",
      "id": 10528926,
      "node_id": "MDQ6VXNlcjEwNTI4OTI2",
      "avatar_url": "https://avatars.githubusercontent.com/u/10528926?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jleeh",
      "html_url": "https://github.com/jleeh",
      "followers_url": "https://api.github.com/users/jleeh/followers",
      "following_url": "https://api.github.com/users/jleeh/following{/other_user}",
      "gists_url": "https://api.github.com/users/jleeh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jleeh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jleeh/subscriptions",
      "organizations_url": "https://api.github.com/users/jleeh/orgs",
      "repos_url": "https://api.github.com/users/jleeh/repos",
      "events_url": "https://api.github.com/users/jleeh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jleeh/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-02T18:57:11Z",
    "updated_at": "2019-09-02T18:57:11Z",
    "author_association": "NONE",
    "body": "If in doubt increase the cache. Seems to alleviated the issue and performance is looking far better, closing the issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/527224431/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
