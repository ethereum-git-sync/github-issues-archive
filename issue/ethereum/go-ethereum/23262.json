{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23262",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23262/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23262/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23262/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23262",
  "id": 951663967,
  "node_id": "MDU6SXNzdWU5NTE2NjM5Njc=",
  "number": 23262,
  "title": "Severe performance degradation on archive node after #22504",
  "user": {
    "login": "mevalphaleak",
    "id": 84503061,
    "node_id": "MDQ6VXNlcjg0NTAzMDYx",
    "avatar_url": "https://avatars.githubusercontent.com/u/84503061?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mevalphaleak",
    "html_url": "https://github.com/mevalphaleak",
    "followers_url": "https://api.github.com/users/mevalphaleak/followers",
    "following_url": "https://api.github.com/users/mevalphaleak/following{/other_user}",
    "gists_url": "https://api.github.com/users/mevalphaleak/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mevalphaleak/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mevalphaleak/subscriptions",
    "organizations_url": "https://api.github.com/users/mevalphaleak/orgs",
    "repos_url": "https://api.github.com/users/mevalphaleak/repos",
    "events_url": "https://api.github.com/users/mevalphaleak/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mevalphaleak/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-07-23T15:08:38Z",
  "updated_at": "2021-07-23T15:46:10Z",
  "closed_at": "2021-07-23T15:46:10Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nArchive node\r\nGeth version: 1.10.3+\r\nOS & Version: Windows/Linux/OSX\r\nCommit hash : 7088f1e81456bdc0bbe801e266ea6ca6c15c1835\r\n\r\n#### Expected behaviour\r\nNormally(before 1.10.3) my archive node was able to consume batch of ~20 blocks in 8 seconds without any issues\r\nIt was taking around 0.2s to perform 100 'eth_call' operations\r\n\r\n#### Actual behaviour\r\nAfter upgrading my archive node to 1.10.6 it started consuming only 1 block in 20 seconds and age started increasing constantly.\r\n'eth_call' operations started randomly freezing sometimes taking 5-10 seconds\r\n\r\n#### Steps to reproduce the behaviour\r\nI've started doing binary search to find exact commit which caused an issue and it was this one: 7088f1e81456bdc0bbe801e266ea6ca6c15c1835\r\n\r\nMy node performs flawlessly on previous commit(a50251e6cbfecfaf26040d42c70d2812bc422a4a) and version 1.10.2 in general but as soon as I update to commit which includes 'core, eth: faster snapshot generation (#22504)'  there's an abysmal drop in performance.\r\nArchive node can't catch up any more even with NVMe drive taking 20 seconds to process a single block.\r\n\r\n\r\n",
  "closed_by": {
    "login": "mevalphaleak",
    "id": 84503061,
    "node_id": "MDQ6VXNlcjg0NTAzMDYx",
    "avatar_url": "https://avatars.githubusercontent.com/u/84503061?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mevalphaleak",
    "html_url": "https://github.com/mevalphaleak",
    "followers_url": "https://api.github.com/users/mevalphaleak/followers",
    "following_url": "https://api.github.com/users/mevalphaleak/following{/other_user}",
    "gists_url": "https://api.github.com/users/mevalphaleak/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mevalphaleak/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mevalphaleak/subscriptions",
    "organizations_url": "https://api.github.com/users/mevalphaleak/orgs",
    "repos_url": "https://api.github.com/users/mevalphaleak/repos",
    "events_url": "https://api.github.com/users/mevalphaleak/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mevalphaleak/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23262/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23262/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/885718678",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23262#issuecomment-885718678",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23262",
    "id": 885718678,
    "node_id": "IC_kwDOAOvK9840yv6W",
    "user": {
      "login": "mevalphaleak",
      "id": 84503061,
      "node_id": "MDQ6VXNlcjg0NTAzMDYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/84503061?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mevalphaleak",
      "html_url": "https://github.com/mevalphaleak",
      "followers_url": "https://api.github.com/users/mevalphaleak/followers",
      "following_url": "https://api.github.com/users/mevalphaleak/following{/other_user}",
      "gists_url": "https://api.github.com/users/mevalphaleak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mevalphaleak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mevalphaleak/subscriptions",
      "organizations_url": "https://api.github.com/users/mevalphaleak/orgs",
      "repos_url": "https://api.github.com/users/mevalphaleak/repos",
      "events_url": "https://api.github.com/users/mevalphaleak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mevalphaleak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-23T15:27:31Z",
    "updated_at": "2021-07-23T15:28:52Z",
    "author_association": "NONE",
    "body": "Seems like '--snapshot=false' fixes the issue but doesn't seem like long-term solution given according to https://github.com/ethereum/go-ethereum/issues/23075 it will be deprecated soon.\r\n\r\nDoes it mean that geth will be completely unusable going forward until snapshot is generated? (My machine randomly reboots once per week)\r\nIs there any simple way for me to revert changes in #22504 while still making sure that consensus rules are London-compatible(1.10.6)?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/885718678/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
