{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23521",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23521/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23521/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23521/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23521",
  "id": 986789264,
  "node_id": "MDU6SXNzdWU5ODY3ODkyNjQ=",
  "number": 23521,
  "title": "Head state missing, always repairing",
  "user": {
    "login": "Atrovzhi",
    "id": 69903690,
    "node_id": "MDQ6VXNlcjY5OTAzNjkw",
    "avatar_url": "https://avatars.githubusercontent.com/u/69903690?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Atrovzhi",
    "html_url": "https://github.com/Atrovzhi",
    "followers_url": "https://api.github.com/users/Atrovzhi/followers",
    "following_url": "https://api.github.com/users/Atrovzhi/following{/other_user}",
    "gists_url": "https://api.github.com/users/Atrovzhi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Atrovzhi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Atrovzhi/subscriptions",
    "organizations_url": "https://api.github.com/users/Atrovzhi/orgs",
    "repos_url": "https://api.github.com/users/Atrovzhi/repos",
    "events_url": "https://api.github.com/users/Atrovzhi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Atrovzhi/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 268304226,
      "node_id": "MDU6TGFiZWwyNjgzMDQyMjY=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:docs",
      "name": "type:docs",
      "color": "fef2c0",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-09-02T14:13:45Z",
  "updated_at": "2023-03-13T12:46:45Z",
  "closed_at": "2023-03-13T12:46:45Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I used geth 1.10.6 to sync mainnet, the command is here:\r\n\r\n> nohup geth --syncmode \"full\" --port \"10080\" --cache=10240 --datadir /data1/eth00 --rpc --rpcapi db,eth,net,web3,personal,admin,miner --rpcport 8332 --rpcaddr 0.0.0.0 --rpccorsdomain \"*\"  --maxpeers 5  --maxpendpeers 5 --allow-insecure-unlock >> /data1/geth_output.log 2>&1 &\r\n\r\nIt was several days before, the node stopped syncing, the highest block number stopped at 13,107,650\r\nTo fix this problem, I updated geth to version 1.10.8, then the problem comes:\r\n\r\n```\r\nINFO [09-02|20:10:01.026] Disk storage enabled for ethash caches   dir=/data1/eth00/geth/ethash count=3\r\nINFO [09-02|20:10:01.026] Disk storage enabled for ethash DAGs     dir=/root/.ethash            count=2\r\nINFO [09-02|20:10:01.026] Initialising Ethereum protocol           network=1 dbversion=8\r\nINFO [09-02|20:10:03.336] Loaded most recent local header          number=13,107,650 hash=5fdac7..2c1bc8 td=29,614,342,018,010,984,500,618 age=5d2h2m\r\nINFO [09-02|20:10:03.336] Loaded most recent local full block      number=13,106,539 hash=dc5265..469486 td=29,605,455,730,625,869,182,141 age=6d3h16m\r\nINFO [09-02|20:10:03.336] Loaded most recent local fast block      number=13,107,650 hash=5fdac7..2c1bc8 td=29,614,342,018,010,984,500,618 age=5d2h2m\r\nWARN [09-02|20:10:03.337] Head state missing, repairing            number=13,106,539 hash=dc5265..469486 snaproot=efafe8..d7f9a2\r\n\r\n```\r\n\r\nI waited for more than 2 hours but it still kept repairing.\r\nShould I wait for a longer time? Is this a bug? \r\nWhat can I do to solve the problem?",
  "closed_by": {
    "login": "MariusVanDerWijden",
    "id": 16664698,
    "node_id": "MDQ6VXNlcjE2NjY0Njk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MariusVanDerWijden",
    "html_url": "https://github.com/MariusVanDerWijden",
    "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
    "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
    "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
    "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
    "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
    "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23521/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23521/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/915906579",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23521#issuecomment-915906579",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23521",
    "id": 915906579,
    "node_id": "IC_kwDOAOvK9842l6AT",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-09T09:11:22Z",
    "updated_at": "2021-09-09T09:11:22Z",
    "author_association": "MEMBER",
    "body": "Just to confirm, did you do a full sync initially or a fast/snap sync?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/915906579/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/915910034",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23521#issuecomment-915910034",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23521",
    "id": 915910034,
    "node_id": "IC_kwDOAOvK9842l62S",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-09T09:15:36Z",
    "updated_at": "2021-09-09T09:15:36Z",
    "author_association": "MEMBER",
    "body": "Our hunch is that you did a fast/snap sync initially with an older version of Geth, and got stuck at a bad fork (there was an attack around the time of your full block). \r\n\r\nWhen you restarted explicitly in full sync mode, it started unrolling some blocks, but there's no state, so it ended up neeing to unroll to genesis.\r\n\r\nIf you indeed did snap/fast sync initially, you can run that again (i.e. don't specify --syncmode=full) to fix up the chain.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/915910034/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/915919798",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23521#issuecomment-915919798",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23521",
    "id": 915919798,
    "node_id": "IC_kwDOAOvK9842l9O2",
    "user": {
      "login": "Atrovzhi",
      "id": 69903690,
      "node_id": "MDQ6VXNlcjY5OTAzNjkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/69903690?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Atrovzhi",
      "html_url": "https://github.com/Atrovzhi",
      "followers_url": "https://api.github.com/users/Atrovzhi/followers",
      "following_url": "https://api.github.com/users/Atrovzhi/following{/other_user}",
      "gists_url": "https://api.github.com/users/Atrovzhi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Atrovzhi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Atrovzhi/subscriptions",
      "organizations_url": "https://api.github.com/users/Atrovzhi/orgs",
      "repos_url": "https://api.github.com/users/Atrovzhi/repos",
      "events_url": "https://api.github.com/users/Atrovzhi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Atrovzhi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-09T09:28:35Z",
    "updated_at": "2021-09-09T09:28:35Z",
    "author_association": "NONE",
    "body": "> Our hunch is that you did a fast/snap sync initially with an older version of Geth, and got stuck at a bad fork (there was an attack around the time of your full block).\r\n> \r\n> When you restarted explicitly in full sync mode, it started unrolling some blocks, but there's no state, so it ended up neeing to unroll to genesis.\r\n> \r\n> If you indeed did snap/fast sync initially, you can run that again (i.e. don't specify --syncmode=full) to fix up the chain.\r\n\r\nI used full sync mode initially, and the command did not changed.\r\n`nohup geth --syncmode \"full\" --port \"10080\" --cache=10240 --datadir /data1/eth00 --rpc --rpcapi db,eth,net,web3,personal,admin,miner --rpcport 8332 --rpcaddr 0.0.0.0 --rpccorsdomain \"*\" --maxpeers 5 --maxpendpeers 5 --allow-insecure-unlock >> /data1/geth_output.log 2>&1 &`\r\nAfter I started and stopped using another directory to sync the data with fast mode, it can sync block data in full mode, but another problem (not sure if it's a bug) appeared that the block data can only sync up to blockheight 12, other block data can not be synced. If i restart the geth node, logs are shown below\r\n\r\n> INFO [09-09|13:53:09.104] Initialising Ethereum protocol           network=1 dbversion=8\r\nINFO [09-09|13:53:17.869] Loaded most recent local header          number=4,531,086 hash=4ea645..78b6d4 td=1,431,305,030,584,087,609,330 age=3y10mo2w\r\nINFO [09-09|13:53:17.869] Loaded most recent local full block      number=12        hash=aac6b1..5dc88a td=222,685,158,039               age=2h20m49s\r\nINFO [09-09|13:53:17.869] Loaded most recent local fast block      number=4,531,086 hash=4ea645..78b6d4 td=1,431,305,030,584,087,609,330 age=3y10mo2w\r\nINFO [09-09|13:53:17.869] Loaded last fast-sync pivot marker       number=13,189,706\r\nWARN [09-09|13:53:17.883] Head state missing, repairing            number=12         hash=aac6b1..5dc88a snaproot=efafe8..d7f9a2\r\nINFO [09-09|13:53:17.898] Loaded most recent local header          number=4,531,086  hash=4ea645..78b6d4 td=1,431,305,030,584,087,609,330 age=3y10mo2w\r\nINFO [09-09|13:53:17.898] Loaded most recent local full block      number=0          hash=d4e567..cb8fa3 td=17,179,869,184                age=52y5mo1w\r\nINFO [09-09|13:53:17.899] Loaded most recent local fast block      number=12         hash=aac6b1..5dc88a td=222,685,158,039               age=2h20m49s\r\nINFO [09-09|13:53:17.899] Loaded last fast-sync pivot marker       number=13,189,706\r\nERROR[09-09|13:53:17.899] Truncating ancient chain                 from=4,531,086 to=12\r\nWARN [09-09|13:53:17.899] Rewinding blockchain                     target=12\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/915919798/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/968351520",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23521#issuecomment-968351520",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23521",
    "id": 968351520,
    "node_id": "IC_kwDOAOvK9845t98g",
    "user": {
      "login": "Quaternioneer",
      "id": 37586000,
      "node_id": "MDQ6VXNlcjM3NTg2MDAw",
      "avatar_url": "https://avatars.githubusercontent.com/u/37586000?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Quaternioneer",
      "html_url": "https://github.com/Quaternioneer",
      "followers_url": "https://api.github.com/users/Quaternioneer/followers",
      "following_url": "https://api.github.com/users/Quaternioneer/following{/other_user}",
      "gists_url": "https://api.github.com/users/Quaternioneer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Quaternioneer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Quaternioneer/subscriptions",
      "organizations_url": "https://api.github.com/users/Quaternioneer/orgs",
      "repos_url": "https://api.github.com/users/Quaternioneer/repos",
      "events_url": "https://api.github.com/users/Quaternioneer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Quaternioneer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-14T19:41:41Z",
    "updated_at": "2021-11-14T19:41:41Z",
    "author_association": "NONE",
    "body": "@Atrovzhi, did you figure it out? I noticed I began having problems after adding `--rpc --rpccorsdomain=...`, and then I read this in the output:\r\n`WARN [11-14|19:40:11.418] The flag --rpc is deprecated and will be removed June 2021, please use --http \r\nWARN [11-14|19:40:11.418] The flag --rpccorsdomain is deprecated and will be removed June 2021, please use --http.corsdomain`\r\nI'm resyncing with http flags instead.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/968351520/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/968498639",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23521#issuecomment-968498639",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23521",
    "id": 968498639,
    "node_id": "IC_kwDOAOvK9845uh3P",
    "user": {
      "login": "Atrovzhi",
      "id": 69903690,
      "node_id": "MDQ6VXNlcjY5OTAzNjkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/69903690?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Atrovzhi",
      "html_url": "https://github.com/Atrovzhi",
      "followers_url": "https://api.github.com/users/Atrovzhi/followers",
      "following_url": "https://api.github.com/users/Atrovzhi/following{/other_user}",
      "gists_url": "https://api.github.com/users/Atrovzhi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Atrovzhi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Atrovzhi/subscriptions",
      "organizations_url": "https://api.github.com/users/Atrovzhi/orgs",
      "repos_url": "https://api.github.com/users/Atrovzhi/repos",
      "events_url": "https://api.github.com/users/Atrovzhi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Atrovzhi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-15T03:12:39Z",
    "updated_at": "2021-11-15T03:12:39Z",
    "author_association": "NONE",
    "body": "> @Atrovzhi, did you figure it out? I noticed I began having problems after adding `--rpc --rpccorsdomain=...`, and then I read this in the output: `WARN [11-14|19:40:11.418] The flag --rpc is deprecated and will be removed June 2021, please use --http WARN [11-14|19:40:11.418] The flag --rpccorsdomain is deprecated and will be removed June 2021, please use --http.corsdomain` I'm resyncing with http flags instead.\r\n\r\nI used the version of 1.10.6 and 1.10.8, this version can still support --rpc flag. The problem happened when the syncing stopped syncing and I tried to upgrade the geth version. \r\nNow I'm resyncing the node using 1.10.12, and used `--http` flag, so it no longer troubles me.\r\nI guess there may be some data crash so that the node not working correctly.And now I just want to figure out  why it happend.\r\nThank you all the same.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/968498639/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1466080387",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23521#issuecomment-1466080387",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23521",
    "id": 1466080387,
    "node_id": "IC_kwDOAOvK985XYpyD",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-13T12:46:45Z",
    "updated_at": "2023-03-13T12:46:45Z",
    "author_association": "MEMBER",
    "body": "This issue got quite stale over the years. I suspect that somehow the node wasn't shutdown cleanly and some data got fried. I'm going to close this for now, please reopen a new issue if you run into this again with a current version.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1466080387/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
