{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15245",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15245/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15245/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15245/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/15245",
  "id": 263054884,
  "node_id": "MDU6SXNzdWUyNjMwNTQ4ODQ=",
  "number": 15245,
  "title": "[iOS] GethKeyStore `newAccount` throws because of `mkdir` error",
  "user": {
    "login": "svdo",
    "id": 4028554,
    "node_id": "MDQ6VXNlcjQwMjg1NTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4028554?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/svdo",
    "html_url": "https://github.com/svdo",
    "followers_url": "https://api.github.com/users/svdo/followers",
    "following_url": "https://api.github.com/users/svdo/following{/other_user}",
    "gists_url": "https://api.github.com/users/svdo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/svdo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/svdo/subscriptions",
    "organizations_url": "https://api.github.com/users/svdo/orgs",
    "repos_url": "https://api.github.com/users/svdo/repos",
    "events_url": "https://api.github.com/users/svdo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/svdo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2017-10-05T09:14:50Z",
  "updated_at": "2017-10-09T19:49:51Z",
  "closed_at": "2017-10-09T19:49:51Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 1.7.1-unstable.11080 via CocoaPods\r\nOS & Version: iOS\r\n\r\n#### Expected behaviour\r\nI have an iOS app that creates a `GethKeyStore` on initial launch. I then create a new account, which works fine. I then relaunch the app. The key store is recreated using the same parameters as before. Again, I create a new account. I expect it to work, just like the first time.\r\n\r\n#### Actual behaviour\r\nOn iPhone Simulator, it does in fact work. However, on a physical phone, I get the following error message:\r\n\r\n`Action:  Rejected(message: \"mkdir /var/mobile/Containers/Data/Application/71AE95D3-F86F-4789-9C10-030ADDDB580D: operation not permitted\")`\r\n\r\nThe directory itself is correct, it is the directory of my application. It is the same one as was used for the first (successful) account creation. Is this maybe because you're not allowed to create anything inside `/var/mobile/Containers/Data/Application` because that's outside of the sandbox?\r\n\r\n#### Steps to reproduce the behaviour\r\n1. Create a key store:\r\n   ```\r\n               let documentsDirectory = NSSearchPathForDirectoriesInDomains(.documentDirectory,\r\n                                                                            .userDomainMask,\r\n                                                                            true)[0]\r\n               let keyStore = GethKeyStore(path: documentsDirectory + \"/main.keystore\",\r\n                                       scryptN: GethStandardScryptN / 4,\r\n                                       scryptP: GethStandardScryptP)\r\n   ```\r\n\r\n2. Create a new account:\r\n   ```\r\n                   do {\r\n                       let gethAccount = try gethKeyStore.newAccount(p)\r\n                   } catch let e {\r\n                       // handle exception\r\n                   }\r\n   ```\r\n\r\n3. Note that no exception is thrown. Also, when inspecting the app container, it can be verified that the account is indeed created in the folder `main.keystore`.\r\n\r\n4. Restart the app\r\n5. Again cause the key store to be created, and call the `newAccount` function.\r\n6. Note that this time an exception is thrown.\r\n\r\n#### Backtrace\r\nN/A\r\n\r\n\r\nP.S. On a side note: where is the best place to talk to people about Geth iOS framework? I'm not getting a lot of response in Gitter (ethereum/light-client)...",
  "closed_by": {
    "login": "svdo",
    "id": 4028554,
    "node_id": "MDQ6VXNlcjQwMjg1NTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4028554?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/svdo",
    "html_url": "https://github.com/svdo",
    "followers_url": "https://api.github.com/users/svdo/followers",
    "following_url": "https://api.github.com/users/svdo/following{/other_user}",
    "gists_url": "https://api.github.com/users/svdo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/svdo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/svdo/subscriptions",
    "organizations_url": "https://api.github.com/users/svdo/orgs",
    "repos_url": "https://api.github.com/users/svdo/repos",
    "events_url": "https://api.github.com/users/svdo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/svdo/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15245/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15245/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/334626586",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15245#issuecomment-334626586",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15245",
    "id": 334626586,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDYyNjU4Ng==",
    "user": {
      "login": "ronaldmannak",
      "id": 455476,
      "node_id": "MDQ6VXNlcjQ1NTQ3Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/455476?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ronaldmannak",
      "html_url": "https://github.com/ronaldmannak",
      "followers_url": "https://api.github.com/users/ronaldmannak/followers",
      "following_url": "https://api.github.com/users/ronaldmannak/following{/other_user}",
      "gists_url": "https://api.github.com/users/ronaldmannak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ronaldmannak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ronaldmannak/subscriptions",
      "organizations_url": "https://api.github.com/users/ronaldmannak/orgs",
      "repos_url": "https://api.github.com/users/ronaldmannak/repos",
      "events_url": "https://api.github.com/users/ronaldmannak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ronaldmannak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-06T00:19:58Z",
    "updated_at": "2017-10-06T00:19:58Z",
    "author_association": "NONE",
    "body": "@svdo I'm not able to reproduce your error. I've tried using 1.7.0 and 1.7.1 and don't see the error message you described.\r\n\r\nI've used your code with added password and renamed keystore to gethKeyStore to make the code run. I've also checked using my own code below, which also works as advertised.\r\n\r\n````\r\nlet dir = NSSearchPathForDirectoriesInDomains(.documentDirectory, .userDomainMask, true).first! + \"/main.keystore\"\r\nlet keystore = GethNewKeyStore(dir, GethStandardScryptN, GethStandardScryptP)\r\ndo {\r\n    let account = try keystore?.newAccount(\"test\")\r\n} catch {\r\n    print(error)\r\n}\r\n````\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/334626586/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/334669557",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15245#issuecomment-334669557",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15245",
    "id": 334669557,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDY2OTU1Nw==",
    "user": {
      "login": "svdo",
      "id": 4028554,
      "node_id": "MDQ6VXNlcjQwMjg1NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4028554?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/svdo",
      "html_url": "https://github.com/svdo",
      "followers_url": "https://api.github.com/users/svdo/followers",
      "following_url": "https://api.github.com/users/svdo/following{/other_user}",
      "gists_url": "https://api.github.com/users/svdo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/svdo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/svdo/subscriptions",
      "organizations_url": "https://api.github.com/users/svdo/orgs",
      "repos_url": "https://api.github.com/users/svdo/repos",
      "events_url": "https://api.github.com/users/svdo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/svdo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-06T06:26:46Z",
    "updated_at": "2017-10-06T06:26:46Z",
    "author_association": "NONE",
    "body": "I'll try with 1.7.1 today and post an update.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/334669557/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/334688092",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15245#issuecomment-334688092",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15245",
    "id": 334688092,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDY4ODA5Mg==",
    "user": {
      "login": "svdo",
      "id": 4028554,
      "node_id": "MDQ6VXNlcjQwMjg1NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4028554?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/svdo",
      "html_url": "https://github.com/svdo",
      "followers_url": "https://api.github.com/users/svdo/followers",
      "following_url": "https://api.github.com/users/svdo/following{/other_user}",
      "gists_url": "https://api.github.com/users/svdo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/svdo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/svdo/subscriptions",
      "organizations_url": "https://api.github.com/users/svdo/orgs",
      "repos_url": "https://api.github.com/users/svdo/repos",
      "events_url": "https://api.github.com/users/svdo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/svdo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-06T08:08:53Z",
    "updated_at": "2017-10-06T08:08:53Z",
    "author_association": "NONE",
    "body": "I just tried again with Geth 1.7.1, and it still fails (both on my iPhone 6 and an iPhone SE). Just to double-check, @ronaldmannak, does this match your test?\r\n\r\n- Physical phone, not iOS simulator\r\n- iOS 11.0.1\r\n- Geth 1.7.1 via CocoaPods (not downloaded directly or something)\r\n- Test scenario: first time it succeeds, then re-rerun the app from Xcode and retry, only then it fails",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/334688092/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/334843495",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15245#issuecomment-334843495",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15245",
    "id": 334843495,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNDg0MzQ5NQ==",
    "user": {
      "login": "ronaldmannak",
      "id": 455476,
      "node_id": "MDQ6VXNlcjQ1NTQ3Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/455476?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ronaldmannak",
      "html_url": "https://github.com/ronaldmannak",
      "followers_url": "https://api.github.com/users/ronaldmannak/followers",
      "following_url": "https://api.github.com/users/ronaldmannak/following{/other_user}",
      "gists_url": "https://api.github.com/users/ronaldmannak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ronaldmannak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ronaldmannak/subscriptions",
      "organizations_url": "https://api.github.com/users/ronaldmannak/orgs",
      "repos_url": "https://api.github.com/users/ronaldmannak/repos",
      "events_url": "https://api.github.com/users/ronaldmannak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ronaldmannak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-06T19:05:49Z",
    "updated_at": "2017-10-06T19:05:49Z",
    "author_association": "NONE",
    "body": "I'm running iOS 11.0.2 but it's otherwise the same setup. If you're able to share your project, I'd be happy to look at it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/334843495/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/335267512",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15245#issuecomment-335267512",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15245",
    "id": 335267512,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzNTI2NzUxMg==",
    "user": {
      "login": "svdo",
      "id": 4028554,
      "node_id": "MDQ6VXNlcjQwMjg1NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4028554?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/svdo",
      "html_url": "https://github.com/svdo",
      "followers_url": "https://api.github.com/users/svdo/followers",
      "following_url": "https://api.github.com/users/svdo/following{/other_user}",
      "gists_url": "https://api.github.com/users/svdo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/svdo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/svdo/subscriptions",
      "organizations_url": "https://api.github.com/users/svdo/orgs",
      "repos_url": "https://api.github.com/users/svdo/repos",
      "events_url": "https://api.github.com/users/svdo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/svdo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-09T19:49:51Z",
    "updated_at": "2017-10-09T19:49:51Z",
    "author_association": "NONE",
    "body": "I found the issue. It is in my own code, not in Geth. Problem was that I was persisting the absolute path to the keystore between launches of my app. Apparently, starting with iOS 8 this path changes every time, must be a sandbox security thing I guess. Thanks a bunch for trying to reproduce this on your end!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/335267512/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
