{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16922",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16922/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16922/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16922/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/16922",
  "id": 330316379,
  "node_id": "MDU6SXNzdWUzMzAzMTYzNzk=",
  "number": 16922,
  "title": "Add metrics for database compaction",
  "user": {
    "login": "AlekSi",
    "id": 11512,
    "node_id": "MDQ6VXNlcjExNTEy",
    "avatar_url": "https://avatars.githubusercontent.com/u/11512?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AlekSi",
    "html_url": "https://github.com/AlekSi",
    "followers_url": "https://api.github.com/users/AlekSi/followers",
    "following_url": "https://api.github.com/users/AlekSi/following{/other_user}",
    "gists_url": "https://api.github.com/users/AlekSi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AlekSi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AlekSi/subscriptions",
    "organizations_url": "https://api.github.com/users/AlekSi/orgs",
    "repos_url": "https://api.github.com/users/AlekSi/repos",
    "events_url": "https://api.github.com/users/AlekSi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AlekSi/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 856638432,
      "node_id": "MDU6TGFiZWw4NTY2Mzg0MzI=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:inactive",
      "name": "status:inactive",
      "color": "ffffff",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2018-06-07T15:09:32Z",
  "updated_at": "2019-06-26T07:33:31Z",
  "closed_at": "2019-06-26T07:33:31Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "It would be helpful to add metrics when LevelDB runs compaction in addition to logs (#15347). Simple `1` when compaction is underway and `0` when it is off would be good. If we can extract more metrics (durations, etc.), they would be helpful too.",
  "closed_by": {
    "login": "rjl493456442",
    "id": 5959481,
    "node_id": "MDQ6VXNlcjU5NTk0ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rjl493456442",
    "html_url": "https://github.com/rjl493456442",
    "followers_url": "https://api.github.com/users/rjl493456442/followers",
    "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
    "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
    "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
    "repos_url": "https://api.github.com/users/rjl493456442/repos",
    "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16922/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16922/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/395457472",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16922#issuecomment-395457472",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16922",
    "id": 395457472,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NTQ1NzQ3Mg==",
    "user": {
      "login": "AlekSi",
      "id": 11512,
      "node_id": "MDQ6VXNlcjExNTEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/11512?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlekSi",
      "html_url": "https://github.com/AlekSi",
      "followers_url": "https://api.github.com/users/AlekSi/followers",
      "following_url": "https://api.github.com/users/AlekSi/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlekSi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlekSi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlekSi/subscriptions",
      "organizations_url": "https://api.github.com/users/AlekSi/orgs",
      "repos_url": "https://api.github.com/users/AlekSi/repos",
      "events_url": "https://api.github.com/users/AlekSi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlekSi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-07T15:13:21Z",
    "updated_at": "2018-06-07T15:13:21Z",
    "author_association": "NONE",
    "body": "/cc @rjl493456442",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/395457472/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/395629411",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16922#issuecomment-395629411",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16922",
    "id": 395629411,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NTYyOTQxMQ==",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-08T02:48:34Z",
    "updated_at": "2018-06-08T02:53:34Z",
    "author_association": "MEMBER",
    "body": "We have already supported the metrics for compaction!\r\n\r\nHow to retrieve the metric data?\r\n1. enable the metric by `--metrics`\r\n2. attach to your geth node `geth attach geth.ipc`\r\n3. retrieve compaction information `debug.metrics(true).eth.db.chaindata.compact`\r\n\r\n**input/output/time** represents the data read/write/time cost for compaction.\r\n**write delay** represents the delay write operation number and total delay duration.\r\nBtw, geth will print log like `Database compacting, degraded performance` if a long compaction is processing leading to the whole system blocked.\r\n\r\nIf more useful metric data needed, feature request is welcomed!\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/395629411/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/395693789",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16922#issuecomment-395693789",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16922",
    "id": 395693789,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NTY5Mzc4OQ==",
    "user": {
      "login": "AlekSi",
      "id": 11512,
      "node_id": "MDQ6VXNlcjExNTEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/11512?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlekSi",
      "html_url": "https://github.com/AlekSi",
      "followers_url": "https://api.github.com/users/AlekSi/followers",
      "following_url": "https://api.github.com/users/AlekSi/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlekSi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlekSi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlekSi/subscriptions",
      "organizations_url": "https://api.github.com/users/AlekSi/orgs",
      "repos_url": "https://api.github.com/users/AlekSi/repos",
      "events_url": "https://api.github.com/users/AlekSi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlekSi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-08T08:46:03Z",
    "updated_at": "2018-06-08T08:46:03Z",
    "author_association": "NONE",
    "body": "Thanks, write delay metrics are enough for me.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/395693789/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/395977633",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16922#issuecomment-395977633",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16922",
    "id": 395977633,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NTk3NzYzMw==",
    "user": {
      "login": "AlekSi",
      "id": 11512,
      "node_id": "MDQ6VXNlcjExNTEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/11512?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlekSi",
      "html_url": "https://github.com/AlekSi",
      "followers_url": "https://api.github.com/users/AlekSi/followers",
      "following_url": "https://api.github.com/users/AlekSi/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlekSi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlekSi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlekSi/subscriptions",
      "organizations_url": "https://api.github.com/users/AlekSi/orgs",
      "repos_url": "https://api.github.com/users/AlekSi/repos",
      "events_url": "https://api.github.com/users/AlekSi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlekSi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-09T15:26:14Z",
    "updated_at": "2018-06-09T15:26:14Z",
    "author_association": "NONE",
    "body": "Sorry, I was wrong, that's not enough.\r\n\r\nRight now I see a lot of `Database compacting, degraded performance` log messages on my geth node. From metrics, I see that rate of change for current block dropped to zero. But I don't see anything indicating that this is due compaction from `eth.db.chaindata.compact` metrics. I _think_ delay duration will skyrocket when compaction ends, but that's too late.\r\n\r\nSo my request for another metric (in the same `if` branch as logging) is still open.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/395977633/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/399825395",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16922#issuecomment-399825395",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16922",
    "id": 399825395,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTgyNTM5NQ==",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-25T04:12:47Z",
    "updated_at": "2018-06-25T04:13:00Z",
    "author_association": "MEMBER",
    "body": "@AlekSi hey, i was thinking about adding some metrics to indicate compaction progress. The question is i have to make sure whether the long pause is due to **single long compaction** or **many continuous compactions**. \r\nFor the former, the `eth.db.chaindata.compact` will not update anymore and geth node will print `Database compacting, degraded performance` log.  **For this situation**, a `inflight compaction progress data` will be valuable.\r\nFor the latter,  the `eth.db.chaindata.compact` will keep update, and i think this metric data is enough.\r\n\r\nSo maybe i need your feedback to decide whether we should do something.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/399825395/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/505719576",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16922#issuecomment-505719576",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16922",
    "id": 505719576,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwNTcxOTU3Ng==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2019-06-26T05:04:27Z",
    "updated_at": "2019-06-26T05:04:27Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/505719576/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
