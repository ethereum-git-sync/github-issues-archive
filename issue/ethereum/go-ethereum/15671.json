{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15671",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15671/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15671/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15671/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/15671",
  "id": 282020632,
  "node_id": "MDU6SXNzdWUyODIwMjA2MzI=",
  "number": 15671,
  "title": "eth_estimateGas returns error in calls where it should succeed",
  "user": {
    "login": "almindor",
    "id": 1950958,
    "node_id": "MDQ6VXNlcjE5NTA5NTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1950958?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/almindor",
    "html_url": "https://github.com/almindor",
    "followers_url": "https://api.github.com/users/almindor/followers",
    "following_url": "https://api.github.com/users/almindor/following{/other_user}",
    "gists_url": "https://api.github.com/users/almindor/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/almindor/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/almindor/subscriptions",
    "organizations_url": "https://api.github.com/users/almindor/orgs",
    "repos_url": "https://api.github.com/users/almindor/repos",
    "events_url": "https://api.github.com/users/almindor/events{/privacy}",
    "received_events_url": "https://api.github.com/users/almindor/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 856638432,
      "node_id": "MDU6TGFiZWw4NTY2Mzg0MzI=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:inactive",
      "name": "status:inactive",
      "color": "ffffff",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2017-12-14T08:38:49Z",
  "updated_at": "2019-02-04T11:44:04Z",
  "closed_at": "2019-02-04T11:44:04Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "eth_estimateGas returns the new `Error: gas required exceeds allowance or always failing transaction` on calls that should succeed.\r\n\r\n#### System information\r\n\r\nGeth version: `Geth Version: 1.7.3-stable`\r\nOS & Version: `Linux Ubuntu-1604-xenial-64-minimal 4.10.0-35-generic #39~16.04.1-Ubuntu SMP Wed Sep 13 09:02:42 UTC 2017 x86_64 x86_64 x86_64 GNU/Linux`\r\n\r\n#### Expected behaviour\r\nweb3.eth.estimateGas returns a proper gas value for a call to an ERC20 contract's Transfer method with 0 for value as well as 1 for value.\r\n\r\n#### Actual behaviour\r\nWorks with 0 for value but returns `Error: gas required exceeds allowance or always failing transaction` if the value is set to 1.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nNOTE: the following contract is [EOS token](https://etherscan.io/address/0x86fa049857e0209aa7d9e616f7eb3b3b78ecfdb0#code)\r\ngeth attach to a fully synchronized live node on mainnet and run:\r\n```\r\nvar sender = '0xaa08abf10edbafd274668eed547f88b786a03410';\r\nvar contractAddress = '0x86fa049857e0209aa7d9e616f7eb3b3b78ecfdb0';\r\nvar receiver = '0x692a70d2e424a56d2c6c27aa97d1a86395877b3a';\r\n\r\nvar ABI = [{\"constant\":true,\"inputs\":[],\"name\":\"name\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"stop\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"guy\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"approve\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"owner_\",\"type\":\"address\"}],\"name\":\"setOwner\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"totalSupply\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"src\",\"type\":\"address\"},{\"name\":\"dst\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"transferFrom\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"decimals\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"dst\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint128\"}],\"name\":\"push\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"name_\",\"type\":\"bytes32\"}],\"name\":\"setName\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"wad\",\"type\":\"uint128\"}],\"name\":\"mint\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"src\",\"type\":\"address\"}],\"name\":\"balanceOf\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"stopped\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"authority_\",\"type\":\"address\"}],\"name\":\"setAuthority\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"src\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint128\"}],\"name\":\"pull\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"wad\",\"type\":\"uint128\"}],\"name\":\"burn\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"symbol\",\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[{\"name\":\"dst\",\"type\":\"address\"},{\"name\":\"wad\",\"type\":\"uint256\"}],\"name\":\"transfer\",\"outputs\":[{\"name\":\"\",\"type\":\"bool\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":false,\"inputs\":[],\"name\":\"start\",\"outputs\":[],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[],\"name\":\"authority\",\"outputs\":[{\"name\":\"\",\"type\":\"address\"}],\"payable\":false,\"type\":\"function\"},{\"constant\":true,\"inputs\":[{\"name\":\"src\",\"type\":\"address\"},{\"name\":\"guy\",\"type\":\"address\"}],\"name\":\"allowance\",\"outputs\":[{\"name\":\"\",\"type\":\"uint256\"}],\"payable\":false,\"type\":\"function\"},{\"inputs\":[{\"name\":\"symbol_\",\"type\":\"bytes32\"}],\"payable\":false,\"type\":\"constructor\"},{\"anonymous\":true,\"inputs\":[{\"indexed\":true,\"name\":\"sig\",\"type\":\"bytes4\"},{\"indexed\":true,\"name\":\"guy\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"foo\",\"type\":\"bytes32\"},{\"indexed\":true,\"name\":\"bar\",\"type\":\"bytes32\"},{\"indexed\":false,\"name\":\"wad\",\"type\":\"uint256\"},{\"indexed\":false,\"name\":\"fax\",\"type\":\"bytes\"}],\"name\":\"LogNote\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"authority\",\"type\":\"address\"}],\"name\":\"LogSetAuthority\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"owner\",\"type\":\"address\"}],\"name\":\"LogSetOwner\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"from\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"to\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"Transfer\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"name\":\"owner\",\"type\":\"address\"},{\"indexed\":true,\"name\":\"spender\",\"type\":\"address\"},{\"indexed\":false,\"name\":\"value\",\"type\":\"uint256\"}],\"name\":\"Approval\",\"type\":\"event\"}];\r\n\r\nvar contract = web3.eth.contract(ABI).at(contractAddress);\r\n\r\nvar data0 = contract.transfer.getData(receiver, 0);\r\nvar data1 = contract.transfer.getData(receiver, 1);\r\n\r\nweb3.eth.estimateGas({data: data0, from: sender, to: contractAddress});\r\nweb3.eth.estimateGas({data: data1, from: sender, to: contractAddress});\r\n```\r\n\r\nResult is\r\n```\r\n> web3.eth.estimateGas({data: data0, from: sender, to: contractAddress});\r\n40395\r\n> web3.eth.estimateGas({data: data1, from: sender, to: contractAddress});\r\nError: gas required exceeds allowance or always failing transaction\r\n```\r\nwhich does not make sense? Why would changing just the transfer value to 1 cause this error?\r\n",
  "closed_by": {
    "login": "stale[bot]",
    "id": 26384082,
    "node_id": "MDM6Qm90MjYzODQwODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stale%5Bbot%5D",
    "html_url": "https://github.com/apps/stale",
    "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15671/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15671/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/351656391",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15671#issuecomment-351656391",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15671",
    "id": 351656391,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTY1NjM5MQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-14T09:30:39Z",
    "updated_at": "2017-12-14T09:30:39Z",
    "author_association": "MEMBER",
    "body": "Are you sure the CALL isn't throwing in the EVM due to perhaps the sender account not having any balance available to send? Or some similar issue?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/351656391/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/351765855",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15671#issuecomment-351765855",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15671",
    "id": 351765855,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTc2NTg1NQ==",
    "user": {
      "login": "almindor",
      "id": 1950958,
      "node_id": "MDQ6VXNlcjE5NTA5NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1950958?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/almindor",
      "html_url": "https://github.com/almindor",
      "followers_url": "https://api.github.com/users/almindor/followers",
      "following_url": "https://api.github.com/users/almindor/following{/other_user}",
      "gists_url": "https://api.github.com/users/almindor/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/almindor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/almindor/subscriptions",
      "organizations_url": "https://api.github.com/users/almindor/orgs",
      "repos_url": "https://api.github.com/users/almindor/repos",
      "events_url": "https://api.github.com/users/almindor/events{/privacy}",
      "received_events_url": "https://api.github.com/users/almindor/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-14T16:40:58Z",
    "updated_at": "2017-12-14T16:40:58Z",
    "author_association": "NONE",
    "body": "You are correct, it seems some ERC20 tokens throw while others just re-value to 0.\r\n\r\nI still think this change is a bug. Aside from not being versioned as a breaking change there are these possibilities when the error is reported:\r\n\r\n1. The function actually ran out of gas (also low current block gaslimit might be mixed in here too)\r\n2. The function explicitly threw\r\n3. The data to the call is malformed\r\n\r\nIs there any way these three could be reported as different errors/codes? It is otherwise quite hard to handle on client side.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/351765855/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/353166417",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15671#issuecomment-353166417",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15671",
    "id": 353166417,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MzE2NjQxNw==",
    "user": {
      "login": "veox",
      "id": 3036030,
      "node_id": "MDQ6VXNlcjMwMzYwMzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3036030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/veox",
      "html_url": "https://github.com/veox",
      "followers_url": "https://api.github.com/users/veox/followers",
      "following_url": "https://api.github.com/users/veox/following{/other_user}",
      "gists_url": "https://api.github.com/users/veox/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/veox/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/veox/subscriptions",
      "organizations_url": "https://api.github.com/users/veox/orgs",
      "repos_url": "https://api.github.com/users/veox/repos",
      "events_url": "https://api.github.com/users/veox/events{/privacy}",
      "received_events_url": "https://api.github.com/users/veox/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-20T19:55:59Z",
    "updated_at": "2017-12-20T19:55:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Is there any way these three could be reported as different errors/codes?\r\n\r\nThe linked contract has been compiled with `solc v0.4.11+commit.68ef5810`. A cursory glance at the sources seems to indicate that it's not using `revert` anywhere (although it should have technically been [available since v0.4.10](https://github.com/ethereum/solidity/releases/tag/v0.4.10)), only `assert` and `throw`.\r\n\r\nSo, even if `geth` was capable of discerning between the three cases you outline (I don't know if it already does), there's no way to do so for the particular linked contract.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/353166417/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/449499703",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15671#issuecomment-449499703",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15671",
    "id": 449499703,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0OTQ5OTcwMw==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2018-12-21T21:13:10Z",
    "updated_at": "2018-12-21T21:13:10Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/449499703/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
