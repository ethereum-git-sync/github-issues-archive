{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17355",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17355/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17355/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17355/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/17355",
  "id": 348724252,
  "node_id": "MDU6SXNzdWUzNDg3MjQyNTI=",
  "number": 17355,
  "title": "Nil pointer dereference error (js tracing)",
  "user": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2018-08-08T13:23:43Z",
  "updated_at": "2018-08-09T09:35:13Z",
  "closed_at": "2018-08-09T09:35:13Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "@gballet found a way to break the mon machine, via some sort of js tracing. \r\n```\r\nAug 08 15:14:34 mon02.ethdevops.io geth-devel: INFO [08-08|13:14:34.432] Imported new chain segment               blocks=1 txs=11  mgas=0.542  elapsed=26.086ms  mgasps=20.771  number=6110647 hash=b08ae7…3ffa7d cache=536.11mB \r\nAug 08 15:14:40 mon02.ethdevops.io geth-devel: INFO [08-08|13:14:40.075] Preparing state for chain trace          block=5701347 start=5701347 elapsed=418.674µs \r\nAug 08 15:14:43 mon02.ethdevops.io geth-devel: WARN [08-08|13:14:43.857] Tracing failed                           hash=a858b5…8023c6 block=5701348 err=\"execution timeout\" \r\nAug 08 15:14:44 mon02.ethdevops.io geth-devel: WARN [08-08|13:14:44.005] Chain tracing aborted                    start=5701346 end=5727531 abort=5701348 transactions=132 elapsed=3.930023922s \r\nAug 08 15:14:44 mon02.ethdevops.io geth-devel: panic: runtime error: invalid memory address or nil pointer dereference \r\nAug 08 15:14:44 mon02.ethdevops.io geth-devel: [signal SIGSEGV: segmentation violation code=0x1 addr=0x18 pc=0x69e99e] \r\nAug 08 15:14:44 mon02.ethdevops.io geth-devel: goroutine 6917801 [running]: \r\nAug 08 15:14:44 mon02.ethdevops.io geth-devel: github.com/ethereum/go-ethereum/trie.(*Database).reference(...) \r\nAug 08 15:14:44 mon02.ethdevops.io geth-devel: \t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/trie/database.go:423 \r\nAug 08 15:14:44 mon02.ethdevops.io geth-devel: github.com/ethereum/go-ethereum/trie.(*Database).Reference(0xc446601a40, 0x55feb18218051d0a, 0x7333d0b2c1db49b7, 0x8b7e28c99111e342, 0x9d0f705446bb1b66, 0x0, 0x0, 0x0, 0x0) \r\nAug 08 15:14:44 mon02.ethdevops.io geth-devel: \t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/trie/database.go:412 +0x18e \r\nAug 08 15:14:44 mon02.ethdevops.io geth-devel: github.com/ethereum/go-ethereum/eth.(*PrivateDebugAPI).traceChain.func2(0xc4313a9c20, 0xc42355ff90, 0xc47fcfcb40, 0xc4b6129290, 0xbed2d91004796d8e, 0x60734224bb8b, 0x1b5a900, 0xc4b7b65260, 0xc4b429a540, 0x56fee3, ...) \r\nAug 08 15:14:44 mon02.ethdevops.io geth-devel: \t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/eth/api_tracer.go:295 +0x894 \r\nAug 08 15:14:44 mon02.ethdevops.io geth-devel: created by github.com/ethereum/go-ethereum/eth.(*PrivateDebugAPI).traceChain \r\nAug 08 15:14:44 mon02.ethdevops.io geth-devel: \t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/eth/api_tracer.go:220 +0x698 \r\n\r\n```\r\n",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17355/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17355/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/411404773",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/17355#issuecomment-411404773",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17355",
    "id": 411404773,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMTQwNDc3Mw==",
    "user": {
      "login": "gballet",
      "id": 3272758,
      "node_id": "MDQ6VXNlcjMyNzI3NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3272758?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gballet",
      "html_url": "https://github.com/gballet",
      "followers_url": "https://api.github.com/users/gballet/followers",
      "following_url": "https://api.github.com/users/gballet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gballet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gballet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gballet/subscriptions",
      "organizations_url": "https://api.github.com/users/gballet/orgs",
      "repos_url": "https://api.github.com/users/gballet/repos",
      "events_url": "https://api.github.com/users/gballet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gballet/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-08T13:27:29Z",
    "updated_at": "2018-08-08T13:27:29Z",
    "author_association": "MEMBER",
    "body": "Er... you're welcome? :D",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/411404773/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/411408233",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/17355#issuecomment-411408233",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17355",
    "id": 411408233,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMTQwODIzMw==",
    "user": {
      "login": "gballet",
      "id": 3272758,
      "node_id": "MDQ6VXNlcjMyNzI3NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3272758?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gballet",
      "html_url": "https://github.com/gballet",
      "followers_url": "https://api.github.com/users/gballet/followers",
      "following_url": "https://api.github.com/users/gballet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gballet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gballet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gballet/subscriptions",
      "organizations_url": "https://api.github.com/users/gballet/orgs",
      "repos_url": "https://api.github.com/users/gballet/repos",
      "events_url": "https://api.github.com/users/gballet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gballet/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-08T13:38:16Z",
    "updated_at": "2018-08-08T13:38:16Z",
    "author_association": "MEMBER",
    "body": "I could reproduce it with a `{}` object. I guess that I am simply missing some important value and that the de-serialization doesn't check for it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/411408233/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/411416848",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/17355#issuecomment-411416848",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17355",
    "id": 411416848,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxMTQxNjg0OA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-08T14:02:59Z",
    "updated_at": "2018-08-08T14:03:19Z",
    "author_association": "MEMBER",
    "body": "> ooooh ,I know\r\n> I moved bytecode out of the trie ref counter\r\n> originally a trie node could reference a) a node b) a subtrie c) bytecode\r\n> the c) part really messes up pruning, so I just committed that directly to disk instead of refcounting\r\n> but forgot tp update the tracer to do the same\r\n> it messes it up because the pruner cannot decide if the arbitrary bytecode blob is a trie node or an evm blob\r\n> so I would need to start special tracking for different data within the trie cache to keep the functionality... but a) code doesn't really weight much, contracts don't regularly self destruct, so it's not heavy; b) code cannot be pruned, because there's absolutely no way to know which accounts might reference the same code without duplicating it for all accounts\r\n> tl;dr it's not possible to prune and it's not worth to bother... then less complexity is better",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/411416848/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
