{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19935",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19935/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19935/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19935/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/19935",
  "id": 479264572,
  "node_id": "MDU6SXNzdWU0NzkyNjQ1NzI=",
  "number": 19935,
  "title": "Fresh full node - \"most recent local full block\" remains 0",
  "user": {
    "login": "SjonHortensius",
    "id": 1684987,
    "node_id": "MDQ6VXNlcjE2ODQ5ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1684987?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/SjonHortensius",
    "html_url": "https://github.com/SjonHortensius",
    "followers_url": "https://api.github.com/users/SjonHortensius/followers",
    "following_url": "https://api.github.com/users/SjonHortensius/following{/other_user}",
    "gists_url": "https://api.github.com/users/SjonHortensius/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/SjonHortensius/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/SjonHortensius/subscriptions",
    "organizations_url": "https://api.github.com/users/SjonHortensius/orgs",
    "repos_url": "https://api.github.com/users/SjonHortensius/repos",
    "events_url": "https://api.github.com/users/SjonHortensius/events{/privacy}",
    "received_events_url": "https://api.github.com/users/SjonHortensius/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2019-08-10T12:54:52Z",
  "updated_at": "2020-05-14T07:08:08Z",
  "closed_at": "2019-08-11T07:49:50Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `instance=Geth/v1.9.1-stable-b7b2f60f/linux-amd64/go1.12.7`\r\nOS & Version: `linux-amd64`\r\n\r\n#### Description of issue\r\n\r\nDespite several restarts, I never seem to get my node to fully sync. For example - here are a few notable log-entries from last restart:\r\n\r\n```\r\nLoaded most recent local header          number=8316493 hash=db0636<E2><80><A6>c951e5 td=11385618476212767437766 age=1m28s\r\nLoaded most recent local full block      number=0       hash=d4e567<E2><80><A6>cb8fa3 td=17179869184             age=50y3mo3w\r\nLoaded most recent local fast block      number=8316425 hash=2590dd<E2><80><A6>bc63df td=11385464097476829842966 age=16m2s\r\n...\r\nSwitch sync mode from full sync to fast sync\r\n...\r\nInitializing fast sync bloom\r\n...\r\nInitializing fast sync bloom             items=332228780 errorrate=0.009 elapsed=37m17.409s\r\nImported new block headers               count=1    elapsed=1.072s     number=8317197 hash=3bfab1<E2><80><A6>2cd548\r\nInitialized fast sync bloom              items=333439053 errorrate=0.009 elapsed=37m22.027s\r\nImported new state entries               count=384  elapsed=2.283ms    processed=334198211 pending=6974  retry=0  duplicate=6 unexpected=86\r\nImported new state entries               count=768  elapsed=4.002ms    processed=334198979 pending=9362  retry=0  duplicate=6 unexpected=86\r\n...\r\nImported new block headers               count=1    elapsed=13.656ms   number=8322584 hash=8ded8b<E2><80><A6>e8772f\r\nImported new state entries               count=494  elapsed=4.524ms    processed=351950314 pending=1637  retry=0   duplicate=5977 unexpected=40197\r\nImported new state entries               count=448  elapsed=6.386ms    processed=351950762 pending=1539  retry=0   duplicate=5977 unexpected=40197\r\nImported new state entries               count=420  elapsed=6.749ms    processed=351951182 pending=1452  retry=0   duplicate=5977 unexpected=40197\r\n...\r\nGot interrupt, shutting down...\r\nHTTP endpoint closed                     url=http://127.0.0.1:8545\r\nIPC endpoint closed                      url=/srv/geth/geth.ipc\r\nBlockchain manager stopped\r\nStopping Ethereum protocol\r\nEthereum protocol stopped\r\nTransaction pool stopped\r\nFailed to store last header's hash       err=\"leveldb: closed\"\r\n```\r\n\r\nDue to the local full block never getting past 0, geth always restarts a fast-sync (even though probably unneccesary). My current eth_syncing output:\r\n\r\n```json\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":{\r\n\"currentBlock\":\"0x7efde8\",\r\n\"highestBlock\":\"0x7efe4b\",\r\n\"knownStates\":\"0x14fb44ff\",\r\n\"pulledStates\":\"0x14fb3fc1\",\r\n\"startingBlock\":\"0x7ee7fa\"\r\n}}\r\n```\r\n\r\nI have a strong suspicion the `Failed to store last header's hash | err=\"leveldb: closed\"` is a significant cause - but I am unable to debug what causes it. I see no other errors and for as far as I can see the other leveldb writes are successful",
  "closed_by": {
    "login": "SjonHortensius",
    "id": 1684987,
    "node_id": "MDQ6VXNlcjE2ODQ5ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1684987?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/SjonHortensius",
    "html_url": "https://github.com/SjonHortensius",
    "followers_url": "https://api.github.com/users/SjonHortensius/followers",
    "following_url": "https://api.github.com/users/SjonHortensius/following{/other_user}",
    "gists_url": "https://api.github.com/users/SjonHortensius/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/SjonHortensius/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/SjonHortensius/subscriptions",
    "organizations_url": "https://api.github.com/users/SjonHortensius/orgs",
    "repos_url": "https://api.github.com/users/SjonHortensius/repos",
    "events_url": "https://api.github.com/users/SjonHortensius/events{/privacy}",
    "received_events_url": "https://api.github.com/users/SjonHortensius/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19935/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19935/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/520207995",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19935#issuecomment-520207995",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19935",
    "id": 520207995,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUyMDIwNzk5NQ==",
    "user": {
      "login": "SjonHortensius",
      "id": 1684987,
      "node_id": "MDQ6VXNlcjE2ODQ5ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1684987?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SjonHortensius",
      "html_url": "https://github.com/SjonHortensius",
      "followers_url": "https://api.github.com/users/SjonHortensius/followers",
      "following_url": "https://api.github.com/users/SjonHortensius/following{/other_user}",
      "gists_url": "https://api.github.com/users/SjonHortensius/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SjonHortensius/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SjonHortensius/subscriptions",
      "organizations_url": "https://api.github.com/users/SjonHortensius/orgs",
      "repos_url": "https://api.github.com/users/SjonHortensius/repos",
      "events_url": "https://api.github.com/users/SjonHortensius/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SjonHortensius/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-11T07:49:50Z",
    "updated_at": "2019-08-11T07:49:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "Okay - so apparently simply more time was needed. The \"leveldb: closed\" is probably caused by leveldb not being opened yet due to the fast-sync not being completed yet. After another day of syncing, the node catched up with 363M state entries and switched to normal syncing:\r\n\r\n```\r\nCommitted new head block   \r\nDeallocated fast sync bloom\r\nImported new chain segment \r\n```\r\n\r\nand a restart now works as expected, logging the correct values",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/520207995/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/624489417",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19935#issuecomment-624489417",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19935",
    "id": 624489417,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDQ4OTQxNw==",
    "user": {
      "login": "sssubik",
      "id": 33048746,
      "node_id": "MDQ6VXNlcjMzMDQ4NzQ2",
      "avatar_url": "https://avatars.githubusercontent.com/u/33048746?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sssubik",
      "html_url": "https://github.com/sssubik",
      "followers_url": "https://api.github.com/users/sssubik/followers",
      "following_url": "https://api.github.com/users/sssubik/following{/other_user}",
      "gists_url": "https://api.github.com/users/sssubik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sssubik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sssubik/subscriptions",
      "organizations_url": "https://api.github.com/users/sssubik/orgs",
      "repos_url": "https://api.github.com/users/sssubik/repos",
      "events_url": "https://api.github.com/users/sssubik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sssubik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-06T07:33:50Z",
    "updated_at": "2020-05-06T07:33:50Z",
    "author_association": "NONE",
    "body": "@SjonHortensius How long did it take for fast sync to completely finish? I am also getting similar logs in my sync.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/624489417/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/624490672",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19935#issuecomment-624490672",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19935",
    "id": 624490672,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDQ5MDY3Mg==",
    "user": {
      "login": "SjonHortensius",
      "id": 1684987,
      "node_id": "MDQ6VXNlcjE2ODQ5ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1684987?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SjonHortensius",
      "html_url": "https://github.com/SjonHortensius",
      "followers_url": "https://api.github.com/users/SjonHortensius/followers",
      "following_url": "https://api.github.com/users/SjonHortensius/following{/other_user}",
      "gists_url": "https://api.github.com/users/SjonHortensius/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SjonHortensius/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SjonHortensius/subscriptions",
      "organizations_url": "https://api.github.com/users/SjonHortensius/orgs",
      "repos_url": "https://api.github.com/users/SjonHortensius/repos",
      "events_url": "https://api.github.com/users/SjonHortensius/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SjonHortensius/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-06T07:36:44Z",
    "updated_at": "2020-05-06T07:36:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "> @SjonHortensius How long did it take for fast sync to completely finish? I am also getting similar logs in my sync.\r\n\r\nthis happened on a virtual server with an ssd, and I'm pretty sure it took a few weeks to get in sync fully",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/624490672/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/628434229",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19935#issuecomment-628434229",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19935",
    "id": 628434229,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyODQzNDIyOQ==",
    "user": {
      "login": "sssubik",
      "id": 33048746,
      "node_id": "MDQ6VXNlcjMzMDQ4NzQ2",
      "avatar_url": "https://avatars.githubusercontent.com/u/33048746?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sssubik",
      "html_url": "https://github.com/sssubik",
      "followers_url": "https://api.github.com/users/sssubik/followers",
      "following_url": "https://api.github.com/users/sssubik/following{/other_user}",
      "gists_url": "https://api.github.com/users/sssubik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sssubik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sssubik/subscriptions",
      "organizations_url": "https://api.github.com/users/sssubik/orgs",
      "repos_url": "https://api.github.com/users/sssubik/repos",
      "events_url": "https://api.github.com/users/sssubik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sssubik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-14T07:06:51Z",
    "updated_at": "2020-05-14T07:08:08Z",
    "author_association": "NONE",
    "body": "@SjonHortensius \r\nHey `Initialized fast sync bloom              items=333439053`. Does the **items** in this line also indicate the number of blocks from state trie downloaded? I am constantly getting this line",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/628434229/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
