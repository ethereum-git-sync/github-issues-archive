{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/2368",
  "id": 142124242,
  "node_id": "MDU6SXNzdWUxNDIxMjQyNDI=",
  "number": 2368,
  "title": "Return value memory is not cleared",
  "user": {
    "login": "immesys",
    "id": 4234131,
    "node_id": "MDQ6VXNlcjQyMzQxMzE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4234131?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/immesys",
    "html_url": "https://github.com/immesys",
    "followers_url": "https://api.github.com/users/immesys/followers",
    "following_url": "https://api.github.com/users/immesys/following{/other_user}",
    "gists_url": "https://api.github.com/users/immesys/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/immesys/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/immesys/subscriptions",
    "organizations_url": "https://api.github.com/users/immesys/orgs",
    "repos_url": "https://api.github.com/users/immesys/repos",
    "events_url": "https://api.github.com/users/immesys/events{/privacy}",
    "received_events_url": "https://api.github.com/users/immesys/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 15,
  "created_at": "2016-03-20T03:09:43Z",
  "updated_at": "2016-03-24T08:56:55Z",
  "closed_at": "2016-03-23T22:41:22Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\n\nGeth version: 1.3.5 with hacks that I don't think affect the problem\nOS & Version: Linux\n#### Expected behaviour\n\nIf the result of env.CallCode [here](https://github.com/ethereum/go-ethereum/blob/bcf565730b1816304947021080981245d084a930/core/vm/instructions.go#L551) is nil, or a byte array smaller than expected by the caller, then the memory left over would be zeroed out.\n#### Actual behaviour\n\nThe memory retains its previous value, because the copy in memory.go only copies the min(len(src),len(dst)) bytes. Generally that value comes from the parameters.\n#### Steps to reproduce the behaviour\n\nI don't know if this affects normal contracts, but if you call a precompiled contract that returns nil on error (such as ECRECOVER), the nil propogates all the way up and the return value in solidity contains data from the parameters. For example:\n\n```\ncontract foo {\n  address public rv1;\n  address public rv2;\n  function test() {\n    /* Example of normal ecrecover: */\n    bytes32 hash = 0x38d18acb67d25c8bb9942764b62f18e17054f66a817bd4295423adf9ed98873e;\n    uint8 v = 27;\n    bytes32 r = 0x723841761d213b60ac1cbf063207cbeba6c2725bcaf7c189e63f13d93fc1dc07;\n    bytes32 s = 0x789d1dd423d25f0772d2748d60f7e4b81bb14d086eba8e8e8efb6dcff8a4ae02;\n    address expected = 0x629defec4044715f5f43403bb88a7074a7a28f67;\n    rv1 = ecrecover(hash, v, r, s);\n\n    /* Incorrect parameters:  */\n    bytes32 fakehash = 0x000000000000000000000000629defec4044715f5f43403bb88a7074a7a28f67;\n    bytes32 r2 = 0;\n    bytes32 s2 = 0;\n    rv2 = ecrecover(fakehash, v, r2, s2);\n\n    /* Now rv2 contains the same address as rv1 (from the hash) with no indication of failure */\n  }\n}\n```\n",
  "closed_by": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/198838929",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2368#issuecomment-198838929",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368",
    "id": 198838929,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5ODgzODkyOQ==",
    "user": {
      "login": "immesys",
      "id": 4234131,
      "node_id": "MDQ6VXNlcjQyMzQxMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4234131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/immesys",
      "html_url": "https://github.com/immesys",
      "followers_url": "https://api.github.com/users/immesys/followers",
      "following_url": "https://api.github.com/users/immesys/following{/other_user}",
      "gists_url": "https://api.github.com/users/immesys/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/immesys/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/immesys/subscriptions",
      "organizations_url": "https://api.github.com/users/immesys/orgs",
      "repos_url": "https://api.github.com/users/immesys/repos",
      "events_url": "https://api.github.com/users/immesys/events{/privacy}",
      "received_events_url": "https://api.github.com/users/immesys/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-20T03:13:20Z",
    "updated_at": "2016-03-20T03:13:20Z",
    "author_association": "NONE",
    "body": "Incidentally the values in my example come from a [question asked on stack overflow today](http://ethereum.stackexchange.com/questions/2171/how-does-one-properly-use-ecrecover-to-verify-ethereum-signatures)\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/198838929/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/198876209",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2368#issuecomment-198876209",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368",
    "id": 198876209,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5ODg3NjIwOQ==",
    "user": {
      "login": "immesys",
      "id": 4234131,
      "node_id": "MDQ6VXNlcjQyMzQxMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4234131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/immesys",
      "html_url": "https://github.com/immesys",
      "followers_url": "https://api.github.com/users/immesys/followers",
      "following_url": "https://api.github.com/users/immesys/following{/other_user}",
      "gists_url": "https://api.github.com/users/immesys/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/immesys/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/immesys/subscriptions",
      "organizations_url": "https://api.github.com/users/immesys/orgs",
      "repos_url": "https://api.github.com/users/immesys/repos",
      "events_url": "https://api.github.com/users/immesys/events{/privacy}",
      "received_events_url": "https://api.github.com/users/immesys/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-20T08:54:15Z",
    "updated_at": "2016-03-20T08:54:15Z",
    "author_association": "NONE",
    "body": "Apologies for the noise, I see that the python implementation appears to have the same behavior so this is probably intended, not a bug.\n\nI don't know if it this opens avenues for selective forgery attacks. Using this I can make a contract believe a hash I provide was signed by a key that it was not. Of course in many cases this may not be useful because if the contract is doing the hashing, I would have to find a preimage. Nevertheless it is quite a step down in security (or at the very least, elegance) compared to ECRECOVER actually indicating failure.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/198876209/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200564230",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2368#issuecomment-200564230",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368",
    "id": 200564230,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDU2NDIzMA==",
    "user": {
      "login": "androlo",
      "id": 2809499,
      "node_id": "MDQ6VXNlcjI4MDk0OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2809499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/androlo",
      "html_url": "https://github.com/androlo",
      "followers_url": "https://api.github.com/users/androlo/followers",
      "following_url": "https://api.github.com/users/androlo/following{/other_user}",
      "gists_url": "https://api.github.com/users/androlo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/androlo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/androlo/subscriptions",
      "organizations_url": "https://api.github.com/users/androlo/orgs",
      "repos_url": "https://api.github.com/users/androlo/repos",
      "events_url": "https://api.github.com/users/androlo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/androlo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-23T22:11:11Z",
    "updated_at": "2016-03-23T22:11:11Z",
    "author_association": "NONE",
    "body": "Hahaha. \n\n\"I found this sneaky as hell bug. Sorry.\"\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200564230/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200568300",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2368#issuecomment-200568300",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368",
    "id": 200568300,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDU2ODMwMA==",
    "user": {
      "login": "androlo",
      "id": 2809499,
      "node_id": "MDQ6VXNlcjI4MDk0OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2809499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/androlo",
      "html_url": "https://github.com/androlo",
      "followers_url": "https://api.github.com/users/androlo/followers",
      "following_url": "https://api.github.com/users/androlo/following{/other_user}",
      "gists_url": "https://api.github.com/users/androlo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/androlo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/androlo/subscriptions",
      "organizations_url": "https://api.github.com/users/androlo/orgs",
      "repos_url": "https://api.github.com/users/androlo/repos",
      "events_url": "https://api.github.com/users/androlo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/androlo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-23T22:28:08Z",
    "updated_at": "2016-03-23T22:28:08Z",
    "author_association": "NONE",
    "body": "I think this is a combination of Solidity and ECRECOVER not playing nice. Certainly not go-ethereum. Solidity seems to use same memory offset for input and output data of a CALL, which is standard procedure, but CALL failing,i.e. putting 0 on stack, will always result in memory being left un-touched.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200568300/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200568612",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2368#issuecomment-200568612",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368",
    "id": 200568612,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDU2ODYxMg==",
    "user": {
      "login": "androlo",
      "id": 2809499,
      "node_id": "MDQ6VXNlcjI4MDk0OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2809499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/androlo",
      "html_url": "https://github.com/androlo",
      "followers_url": "https://api.github.com/users/androlo/followers",
      "following_url": "https://api.github.com/users/androlo/following{/other_user}",
      "gists_url": "https://api.github.com/users/androlo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/androlo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/androlo/subscriptions",
      "organizations_url": "https://api.github.com/users/androlo/orgs",
      "repos_url": "https://api.github.com/users/androlo/repos",
      "events_url": "https://api.github.com/users/androlo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/androlo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-23T22:28:56Z",
    "updated_at": "2016-03-23T22:28:56Z",
    "author_association": "NONE",
    "body": "@immesys\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200568612/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200569627",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2368#issuecomment-200569627",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368",
    "id": 200569627,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDU2OTYyNw==",
    "user": {
      "login": "immesys",
      "id": 4234131,
      "node_id": "MDQ6VXNlcjQyMzQxMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4234131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/immesys",
      "html_url": "https://github.com/immesys",
      "followers_url": "https://api.github.com/users/immesys/followers",
      "following_url": "https://api.github.com/users/immesys/following{/other_user}",
      "gists_url": "https://api.github.com/users/immesys/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/immesys/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/immesys/subscriptions",
      "organizations_url": "https://api.github.com/users/immesys/orgs",
      "repos_url": "https://api.github.com/users/immesys/repos",
      "events_url": "https://api.github.com/users/immesys/events{/privacy}",
      "received_events_url": "https://api.github.com/users/immesys/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-23T22:31:57Z",
    "updated_at": "2016-03-23T22:31:57Z",
    "author_association": "NONE",
    "body": "Yes, I concur. This is not go-ethereum's fault as I initially suspected. I personally would prefer the output memory to always be zeroed, but as we can't change that now, we could rather make solidity use different memory for the returns and that won't change the output of old blocks, right?\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200569627/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200571502",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2368#issuecomment-200571502",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368",
    "id": 200571502,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDU3MTUwMg==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-23T22:40:18Z",
    "updated_at": "2016-03-23T22:40:18Z",
    "author_association": "MEMBER",
    "body": "It's on our backlog: https://www.pivotaltracker.com/story/show/96553924\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200571502/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200572058",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2368#issuecomment-200572058",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368",
    "id": 200572058,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDU3MjA1OA==",
    "user": {
      "login": "immesys",
      "id": 4234131,
      "node_id": "MDQ6VXNlcjQyMzQxMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4234131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/immesys",
      "html_url": "https://github.com/immesys",
      "followers_url": "https://api.github.com/users/immesys/followers",
      "following_url": "https://api.github.com/users/immesys/following{/other_user}",
      "gists_url": "https://api.github.com/users/immesys/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/immesys/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/immesys/subscriptions",
      "organizations_url": "https://api.github.com/users/immesys/orgs",
      "repos_url": "https://api.github.com/users/immesys/repos",
      "events_url": "https://api.github.com/users/immesys/events{/privacy}",
      "received_events_url": "https://api.github.com/users/immesys/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-23T22:43:21Z",
    "updated_at": "2016-03-23T22:43:21Z",
    "author_association": "NONE",
    "body": "Thanks!\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200572058/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200582819",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2368#issuecomment-200582819",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368",
    "id": 200582819,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDU4MjgxOQ==",
    "user": {
      "login": "androlo",
      "id": 2809499,
      "node_id": "MDQ6VXNlcjI4MDk0OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2809499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/androlo",
      "html_url": "https://github.com/androlo",
      "followers_url": "https://api.github.com/users/androlo/followers",
      "following_url": "https://api.github.com/users/androlo/following{/other_user}",
      "gists_url": "https://api.github.com/users/androlo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/androlo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/androlo/subscriptions",
      "organizations_url": "https://api.github.com/users/androlo/orgs",
      "repos_url": "https://api.github.com/users/androlo/repos",
      "events_url": "https://api.github.com/users/androlo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/androlo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-23T23:34:15Z",
    "updated_at": "2016-03-23T23:34:15Z",
    "author_association": "NONE",
    "body": "I would also prefer that, immesys. After all, the memory has been re-allocated for the return value, so you have to expect that whatever was in there may be lost.  What is the use-case for not clearing it?\n\nHad the same issue when i wrote contracts in LLL btw (the old language), where you allocated memory yourself. Had to create rules to avoid this, like allocating new memory for returns, always use multiples of 32 for memory offset and size (size on both ends), and never to use the STOP instruction. This probably caused the most weird and time-consuming bugs that I had at the time.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200582819/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200585605",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2368#issuecomment-200585605",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368",
    "id": 200585605,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDU4NTYwNQ==",
    "user": {
      "login": "androlo",
      "id": 2809499,
      "node_id": "MDQ6VXNlcjI4MDk0OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2809499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/androlo",
      "html_url": "https://github.com/androlo",
      "followers_url": "https://api.github.com/users/androlo/followers",
      "following_url": "https://api.github.com/users/androlo/following{/other_user}",
      "gists_url": "https://api.github.com/users/androlo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/androlo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/androlo/subscriptions",
      "organizations_url": "https://api.github.com/users/androlo/orgs",
      "repos_url": "https://api.github.com/users/androlo/repos",
      "events_url": "https://api.github.com/users/androlo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/androlo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-23T23:46:42Z",
    "updated_at": "2016-03-23T23:46:42Z",
    "author_association": "NONE",
    "body": "https://youtu.be/juuA3VLuiqM?t=6m45s \n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200585605/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200587193",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2368#issuecomment-200587193",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368",
    "id": 200587193,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDU4NzE5Mw==",
    "user": {
      "login": "immesys",
      "id": 4234131,
      "node_id": "MDQ6VXNlcjQyMzQxMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4234131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/immesys",
      "html_url": "https://github.com/immesys",
      "followers_url": "https://api.github.com/users/immesys/followers",
      "following_url": "https://api.github.com/users/immesys/following{/other_user}",
      "gists_url": "https://api.github.com/users/immesys/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/immesys/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/immesys/subscriptions",
      "organizations_url": "https://api.github.com/users/immesys/orgs",
      "repos_url": "https://api.github.com/users/immesys/repos",
      "events_url": "https://api.github.com/users/immesys/events{/privacy}",
      "received_events_url": "https://api.github.com/users/immesys/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-23T23:56:29Z",
    "updated_at": "2016-03-23T23:56:29Z",
    "author_association": "NONE",
    "body": "Yeah exactly, I got bitten by this and to make it worse I assumed it was due to changes I was making to the code so all in all it took about 6 hours to track down, translate to a precompiled contract that existed in mainline (I did not discover it with ECRECOVER, that was just the example I used) and report. \n\nWho knows. Maybe we can get this behavior changed with the next hard fork or the next chain (Serenity looks cool).\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200587193/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200605179",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2368#issuecomment-200605179",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368",
    "id": 200605179,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDYwNTE3OQ==",
    "user": {
      "login": "androlo",
      "id": 2809499,
      "node_id": "MDQ6VXNlcjI4MDk0OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2809499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/androlo",
      "html_url": "https://github.com/androlo",
      "followers_url": "https://api.github.com/users/androlo/followers",
      "following_url": "https://api.github.com/users/androlo/following{/other_user}",
      "gists_url": "https://api.github.com/users/androlo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/androlo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/androlo/subscriptions",
      "organizations_url": "https://api.github.com/users/androlo/orgs",
      "repos_url": "https://api.github.com/users/androlo/repos",
      "events_url": "https://api.github.com/users/androlo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/androlo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-24T01:18:50Z",
    "updated_at": "2016-03-24T01:18:50Z",
    "author_association": "NONE",
    "body": "I see how you did it. This is a simple contract that has a function with conditional STOP-ish behavior.\n\n```\ncontract A {\n    function add(uint x, uint y) returns (uint) {\n        if (x == 0x2222222222222222222222222222222)\n            selfdestruct(msg.sender);\n        else\n            return x + y;\n    }\n}\n\ncontract B {\n    function f() returns(uint){\n        var a = new A();\n        uint x = 0x2222222222222222222222222222222;\n        uint y = 0x3233333333333333333333333333333;\n        return a.add(x,y);\n    }\n}\n```\n\nCalling `f` yields:\n\n```\nResult: \"0x771602f700000000000000000000000000000000022222222222222222222222\"\n```\n\nStopped thinking about this after Solidity came. Guess it's still a thing. Not sure if a hard fork is needed tbh, if it starts clearing memory it would still continue to work for those that does not update, but it'd be same as now. Simply changing return value memory allocation in solidity would maybe be messy, I don't know.\n\nWhat an amazing find.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200605179/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200607772",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2368#issuecomment-200607772",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368",
    "id": 200607772,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDYwNzc3Mg==",
    "user": {
      "login": "immesys",
      "id": 4234131,
      "node_id": "MDQ6VXNlcjQyMzQxMzE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4234131?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/immesys",
      "html_url": "https://github.com/immesys",
      "followers_url": "https://api.github.com/users/immesys/followers",
      "following_url": "https://api.github.com/users/immesys/following{/other_user}",
      "gists_url": "https://api.github.com/users/immesys/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/immesys/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/immesys/subscriptions",
      "organizations_url": "https://api.github.com/users/immesys/orgs",
      "repos_url": "https://api.github.com/users/immesys/repos",
      "events_url": "https://api.github.com/users/immesys/events{/privacy}",
      "received_events_url": "https://api.github.com/users/immesys/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-24T01:36:14Z",
    "updated_at": "2016-03-24T01:36:14Z",
    "author_association": "NONE",
    "body": "Well, everyone needs to start clearing memory at the same time otherwise they will disagree on state. By clearing memory I mean the EVM, not solidity. Solc could start using different return memory without requiring any sort of fork or coordination but like you said, is a little messy.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200607772/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200613609",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2368#issuecomment-200613609",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368",
    "id": 200613609,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDYxMzYwOQ==",
    "user": {
      "login": "androlo",
      "id": 2809499,
      "node_id": "MDQ6VXNlcjI4MDk0OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2809499?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/androlo",
      "html_url": "https://github.com/androlo",
      "followers_url": "https://api.github.com/users/androlo/followers",
      "following_url": "https://api.github.com/users/androlo/following{/other_user}",
      "gists_url": "https://api.github.com/users/androlo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/androlo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/androlo/subscriptions",
      "organizations_url": "https://api.github.com/users/androlo/orgs",
      "repos_url": "https://api.github.com/users/androlo/repos",
      "events_url": "https://api.github.com/users/androlo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/androlo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-24T02:02:15Z",
    "updated_at": "2016-03-24T02:02:15Z",
    "author_association": "NONE",
    "body": "oh, right. sorry...\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200613609/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200742171",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2368#issuecomment-200742171",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2368",
    "id": 200742171,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIwMDc0MjE3MQ==",
    "user": {
      "login": "chriseth",
      "id": 9073706,
      "node_id": "MDQ6VXNlcjkwNzM3MDY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9073706?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chriseth",
      "html_url": "https://github.com/chriseth",
      "followers_url": "https://api.github.com/users/chriseth/followers",
      "following_url": "https://api.github.com/users/chriseth/following{/other_user}",
      "gists_url": "https://api.github.com/users/chriseth/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chriseth/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chriseth/subscriptions",
      "organizations_url": "https://api.github.com/users/chriseth/orgs",
      "repos_url": "https://api.github.com/users/chriseth/repos",
      "events_url": "https://api.github.com/users/chriseth/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chriseth/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-24T08:56:55Z",
    "updated_at": "2016-03-24T08:56:55Z",
    "author_association": "MEMBER",
    "body": "If I understand it correctly, the issue only arises if functions violate type promises (or have \"dependent types\"):\necrecover has a different return type depending on the input value - in one case it returns an address, in another case it returns nothing / the empty tuple.\nThe same holds true for your example, @androlo : If you use selfdestruct in a function returning `uint`, it does not really return `uint`. The compiler could warn about that, but the use of selfdestruct might be nested, so not sure how to do that properly.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/200742171/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
