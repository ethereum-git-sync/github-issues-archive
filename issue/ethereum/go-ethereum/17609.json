{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17609",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17609/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17609/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17609/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/17609",
  "id": 358210673,
  "node_id": "MDU6SXNzdWUzNTgyMTA2NzM=",
  "number": 17609,
  "title": "Miner, successfully found new new block, need broadcast message to peers, and wait to be chosen to add block into chain",
  "user": {
    "login": "quangtran8588",
    "id": 18105931,
    "node_id": "MDQ6VXNlcjE4MTA1OTMx",
    "avatar_url": "https://avatars.githubusercontent.com/u/18105931?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/quangtran8588",
    "html_url": "https://github.com/quangtran8588",
    "followers_url": "https://api.github.com/users/quangtran8588/followers",
    "following_url": "https://api.github.com/users/quangtran8588/following{/other_user}",
    "gists_url": "https://api.github.com/users/quangtran8588/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/quangtran8588/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/quangtran8588/subscriptions",
    "organizations_url": "https://api.github.com/users/quangtran8588/orgs",
    "repos_url": "https://api.github.com/users/quangtran8588/repos",
    "events_url": "https://api.github.com/users/quangtran8588/events{/privacy}",
    "received_events_url": "https://api.github.com/users/quangtran8588/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2018-09-07T21:03:14Z",
  "updated_at": "2018-09-10T10:51:40Z",
  "closed_at": "2018-09-10T10:51:39Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "\r\nHi there,\r\n\r\nI'm currently working on research on Ethereum. I'm a new one in this field. I need to implement a new feature which is miner will be chosen to add new block into chain when it's found. In order to do this, when miner successfully guess a nonce, it needs to broadcast a message to all peers in the network. PoW is implemented in the consensus/ethash/sealer.go, and the broadcast method is declared in eth/handler.go.\r\n**-consensus/ethash/sealer.go:**\r\n\r\n    search:\r\n\tfor {\r\n\t\tselect {\r\n\t\tcase <-abort:\r\n\t\t\t// Mining terminated, update stats and abort\r\n\t\t\tlogger.Trace(\"Ethash nonce search aborted\", \"attempts\", nonce-seed)\r\n\t\t\tethash.hashrate.Mark(attempts)\r\n\t\t\tbreak search\r\n\r\n\t\tdefault:\r\n\t\t\t// We don't have to update hash rate on every nonce, so update after after 2^X nonces\r\n\t\t\tattempts++\r\n\t\t\tif (attempts % (1 << 15)) == 0 {\r\n\t\t\t\tethash.hashrate.Mark(attempts)\r\n\t\t\t\tattempts = 0\r\n\t\t\t}\r\n\t\t\t// Compute the PoW value of this nonce\r\n\t\t\tdigest, result := hashimotoFull(dataset.dataset, hash, nonce)\r\n\t\t\tif new(big.Int).SetBytes(result).Cmp(target) <= 0 {\r\n\t\t\t\t// Correct nonce found, create a new header with it\r\n\t\t\t\theader = types.CopyHeader(header)\r\n\t\t\t\theader.Nonce = types.EncodeNonce(nonce)\r\n\t\t\t\theader.MixDigest = common.BytesToHash(digest)\r\n\r\n\t\t\t\t// Seal and return a block (if still needed)\r\n                                // I will add few lines of code to postpone sealing task to send broadcast message  \r\n                                // to peers, and wait until miner be chosen to add block into chain. Otherwise,\r\n                                // it will be discarded.  \r\n\t\t\t\tselect {\r\n\t\t\t\tcase found <- block.WithSeal(header):\r\n\t\t\t\t\tlogger.Trace(\"Ethash nonce found and reported\", \"attempts\", nonce-seed, \"nonce\", nonce)\r\n\t\t\t\tcase <-abort:\r\n\t\t\t\t\tlogger.Trace(\"Ethash nonce found but discarded\", \"attempts\", nonce-seed, \"nonce\", nonce)\r\n\t\t\t\t}\r\n\t\t\t\tbreak search\r\n\t\t\t}\r\n\t\t\tnonce++\r\n\t\t}\r\n\t}\r\n\t// Datasets are unmapped in a finalizer. Ensure that the dataset stays live\r\n\t// during sealing so it's not unmapped while being read.\r\n\truntime.KeepAlive(dataset)\r\n\r\n\r\nI tried to \"import github.com/ethereum/go-ethereum/eth\" in the sealer.go file to call a function which is implemented in handler.go, but it always gave me an error \"import cycle not allowed\". Is there anyway to do this?\r\n",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17609/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17609/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/419606329",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/17609#issuecomment-419606329",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17609",
    "id": 419606329,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxOTYwNjMyOQ==",
    "user": {
      "login": "hadv",
      "id": 941411,
      "node_id": "MDQ6VXNlcjk0MTQxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/941411?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hadv",
      "html_url": "https://github.com/hadv",
      "followers_url": "https://api.github.com/users/hadv/followers",
      "following_url": "https://api.github.com/users/hadv/following{/other_user}",
      "gists_url": "https://api.github.com/users/hadv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hadv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hadv/subscriptions",
      "organizations_url": "https://api.github.com/users/hadv/orgs",
      "repos_url": "https://api.github.com/users/hadv/repos",
      "events_url": "https://api.github.com/users/hadv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hadv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-08T02:29:32Z",
    "updated_at": "2018-09-08T02:29:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think that it's not a right place to ask these kind of question. You can open question on http://ethereum.stackexchange.com/ instead.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/419606329/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/419871646",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/17609#issuecomment-419871646",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17609",
    "id": 419871646,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxOTg3MTY0Ng==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-10T10:51:39Z",
    "updated_at": "2018-09-10T10:51:39Z",
    "author_association": "MEMBER",
    "body": "Recently mined blocks are already broadcast into the network immediately when they are found. You can find that code piece and extend it to broadcast any other metadata you might need.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/419871646/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
