{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23377",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23377/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23377/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23377/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23377",
  "id": 965856542,
  "node_id": "MDU6SXNzdWU5NjU4NTY1NDI=",
  "number": 23377,
  "title": "incorrect baseFee check in debug_traceCall",
  "user": {
    "login": "bgelb",
    "id": 203273,
    "node_id": "MDQ6VXNlcjIwMzI3Mw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/203273?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bgelb",
    "html_url": "https://github.com/bgelb",
    "followers_url": "https://api.github.com/users/bgelb/followers",
    "following_url": "https://api.github.com/users/bgelb/following{/other_user}",
    "gists_url": "https://api.github.com/users/bgelb/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bgelb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bgelb/subscriptions",
    "organizations_url": "https://api.github.com/users/bgelb/orgs",
    "repos_url": "https://api.github.com/users/bgelb/repos",
    "events_url": "https://api.github.com/users/bgelb/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bgelb/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-08-11T04:07:00Z",
  "updated_at": "2021-08-11T19:14:36Z",
  "closed_at": "2021-08-11T06:42:39Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 1.10.6\r\nOS & Version: Ubuntu 20.04\r\nCommit hash : n/a\r\n\r\n#### Expected behaviour\r\n\r\nWhen I use debug_traceCall to simulate a call on top of base block N, I expect the maxFeePerGas in my simulated call to be checked against the baseFeePerGas of block N+1 (i.e. the block that would contain my simulated call if it were included in a block)\r\n\r\n#### Actual behaviour\r\n\r\nIt appears that my simulated call has its maxFeePerGas checked against the baseFeePerGas of block N (i.e. the block I am executing the call on top of) not block N+1 (the block that would contain my call if it were included in a block).\r\n\r\nIn a case where the baseFeePerGas will decrease in the N+1 block, and the call args contain a maxFeePerGas that is greater than or equal to the block N+1 baseFeePerGas, but less than the block N baseFeePerGas, debug_traceCall will return an error indicating the maxFeePerGas in the call is smaller than the required baseFeePerGas.\r\n\r\nLooking at the code, we can see that the baseFee of the base block (N) is used:\r\nhttps://github.com/ethereum/go-ethereum/blob/686b2884ee3e17fed83c56f7f3515da2897e8d6e/eth/tracers/api.go#L758\r\n\r\nThis line probably needs to incorporate an invokation of CalcBaseFee:\r\nhttps://github.com/ethereum/go-ethereum/blob/94451c2788295901c302c9bf5fa2f7b021c924e2/consensus/misc/eip1559.go#L55\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nset the maxFeePerGas in the call args being passed to debug_traceCall to be less than the baseFeePerGas of the block passed to debug_traceCall (\"block N\") but greater than or equal to the expected baseFeePerGas of the block which would contain the call if it were executed and included into a block (\"block N+1\").",
  "closed_by": {
    "login": "gballet",
    "id": 3272758,
    "node_id": "MDQ6VXNlcjMyNzI3NTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3272758?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gballet",
    "html_url": "https://github.com/gballet",
    "followers_url": "https://api.github.com/users/gballet/followers",
    "following_url": "https://api.github.com/users/gballet/following{/other_user}",
    "gists_url": "https://api.github.com/users/gballet/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gballet/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gballet/subscriptions",
    "organizations_url": "https://api.github.com/users/gballet/orgs",
    "repos_url": "https://api.github.com/users/gballet/repos",
    "events_url": "https://api.github.com/users/gballet/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gballet/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23377/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23377/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/896526321",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23377#issuecomment-896526321",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23377",
    "id": 896526321,
    "node_id": "IC_kwDOAOvK9841b-fx",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-11T06:02:02Z",
    "updated_at": "2021-08-11T06:02:02Z",
    "author_association": "MEMBER",
    "body": "The debug_traceCall means do the tracing for call in the block X. It's the expected behavior.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/896526321/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/896530576",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23377#issuecomment-896530576",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23377",
    "id": 896530576,
    "node_id": "IC_kwDOAOvK9841b_iQ",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-11T06:11:30Z",
    "updated_at": "2021-08-11T06:11:30Z",
    "author_association": "MEMBER",
    "body": "I opened the PR for fixing the doc https://github.com/ethereum/go-ethereum/pull/23378",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/896530576/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/896544767",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23377#issuecomment-896544767",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23377",
    "id": 896544767,
    "node_id": "IC_kwDOAOvK9841cC__",
    "user": {
      "login": "gballet",
      "id": 3272758,
      "node_id": "MDQ6VXNlcjMyNzI3NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3272758?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gballet",
      "html_url": "https://github.com/gballet",
      "followers_url": "https://api.github.com/users/gballet/followers",
      "following_url": "https://api.github.com/users/gballet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gballet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gballet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gballet/subscriptions",
      "organizations_url": "https://api.github.com/users/gballet/orgs",
      "repos_url": "https://api.github.com/users/gballet/repos",
      "events_url": "https://api.github.com/users/gballet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gballet/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-11T06:42:39Z",
    "updated_at": "2021-08-11T06:42:39Z",
    "author_association": "MEMBER",
    "body": "#23378 merged",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/896544767/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/896551385",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23377#issuecomment-896551385",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23377",
    "id": 896551385,
    "node_id": "IC_kwDOAOvK9841cEnZ",
    "user": {
      "login": "bgelb",
      "id": 203273,
      "node_id": "MDQ6VXNlcjIwMzI3Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/203273?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bgelb",
      "html_url": "https://github.com/bgelb",
      "followers_url": "https://api.github.com/users/bgelb/followers",
      "following_url": "https://api.github.com/users/bgelb/following{/other_user}",
      "gists_url": "https://api.github.com/users/bgelb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bgelb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bgelb/subscriptions",
      "organizations_url": "https://api.github.com/users/bgelb/orgs",
      "repos_url": "https://api.github.com/users/bgelb/repos",
      "events_url": "https://api.github.com/users/bgelb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bgelb/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-11T06:55:44Z",
    "updated_at": "2021-08-11T06:55:44Z",
    "author_association": "NONE",
    "body": "Hmm. This seems odd. It's not very obvious to me what use case would desire that behavior, but perhaps I am just unaware of it. I generally think of a call as allowing the simulation of a function call. But I'm not sure of the concept of \"within a block\" or why that is useful. Any yet-to-be-executed function call would have to be placed into the next block after the current one.\r\n\r\nPerhaps it would make sense to at least mirror the behavior of eth_call?\r\n\r\nPer the code, it appears that eth_call does not do any checking of the maxFeePerGas:\r\nhttps://github.com/ethereum/go-ethereum/blob/a879c42bd34e91a4e08c0247138c96957eca2b3f/internal/ethapi/api.go#L910\r\n\r\nThe \"NoBaseFee\" config disables the check, AIUI.\r\n\r\nThat would address the issue from my POV, and makes some amount of sense, since a call does not actually require fees in order to be executed.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/896551385/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/897071397",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23377#issuecomment-897071397",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23377",
    "id": 897071397,
    "node_id": "IC_kwDOAOvK9841eDkl",
    "user": {
      "login": "bgelb",
      "id": 203273,
      "node_id": "MDQ6VXNlcjIwMzI3Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/203273?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bgelb",
      "html_url": "https://github.com/bgelb",
      "followers_url": "https://api.github.com/users/bgelb/followers",
      "following_url": "https://api.github.com/users/bgelb/following{/other_user}",
      "gists_url": "https://api.github.com/users/bgelb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bgelb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bgelb/subscriptions",
      "organizations_url": "https://api.github.com/users/bgelb/orgs",
      "repos_url": "https://api.github.com/users/bgelb/repos",
      "events_url": "https://api.github.com/users/bgelb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bgelb/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-11T18:56:06Z",
    "updated_at": "2021-08-11T18:56:06Z",
    "author_association": "NONE",
    "body": "Upon thinking about it more, I think mirroring the behavior of eth_call really is the right behavior.\r\n\r\nI should be able to do a call with maxFeePerGas set to 0. It doesn't make sense to require gas money in the wallet in order to execute a call, which doesn't modify on-chain state. This is currently true with eth_call (because of the NoBaseFee config field I mentioned above) and it should be true with debug_traceCall as well.\r\n\r\nI believe the GetEVM call within debug_traceCall should also have the NoBaseFee field set to true.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/897071397/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/897083599",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23377#issuecomment-897083599",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23377",
    "id": 897083599,
    "node_id": "IC_kwDOAOvK9841eGjP",
    "user": {
      "login": "bgelb",
      "id": 203273,
      "node_id": "MDQ6VXNlcjIwMzI3Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/203273?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bgelb",
      "html_url": "https://github.com/bgelb",
      "followers_url": "https://api.github.com/users/bgelb/followers",
      "following_url": "https://api.github.com/users/bgelb/following{/other_user}",
      "gists_url": "https://api.github.com/users/bgelb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bgelb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bgelb/subscriptions",
      "organizations_url": "https://api.github.com/users/bgelb/orgs",
      "repos_url": "https://api.github.com/users/bgelb/repos",
      "events_url": "https://api.github.com/users/bgelb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bgelb/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-11T19:14:36Z",
    "updated_at": "2021-08-11T19:14:36Z",
    "author_association": "NONE",
    "body": "Created issue #23382 to follow up.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/897083599/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
