{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20158",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20158/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20158/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20158/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/20158",
  "id": 503829768,
  "node_id": "MDU6SXNzdWU1MDM4Mjk3Njg=",
  "number": 20158,
  "title": "[trie/proof.go] VerifyProof doesn't check node hash",
  "user": {
    "login": "guiguan",
    "id": 940189,
    "node_id": "MDQ6VXNlcjk0MDE4OQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/940189?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/guiguan",
    "html_url": "https://github.com/guiguan",
    "followers_url": "https://api.github.com/users/guiguan/followers",
    "following_url": "https://api.github.com/users/guiguan/following{/other_user}",
    "gists_url": "https://api.github.com/users/guiguan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/guiguan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/guiguan/subscriptions",
    "organizations_url": "https://api.github.com/users/guiguan/orgs",
    "repos_url": "https://api.github.com/users/guiguan/repos",
    "events_url": "https://api.github.com/users/guiguan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/guiguan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-10-08T05:09:38Z",
  "updated_at": "2019-10-12T03:43:49Z",
  "closed_at": "2019-10-12T03:43:48Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "It looks like the `VerifyProof` implementation doesn't re-hash the node loaded from `proofDb` and compare the hash with the wanted one. This could be a security vulnerability because the `proofDb` could be easily tampered with false Merkle paths, and the `VerifyProof` still succeeds. Is there any reason why we don't do the re-hashing?",
  "closed_by": {
    "login": "guiguan",
    "id": 940189,
    "node_id": "MDQ6VXNlcjk0MDE4OQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/940189?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/guiguan",
    "html_url": "https://github.com/guiguan",
    "followers_url": "https://api.github.com/users/guiguan/followers",
    "following_url": "https://api.github.com/users/guiguan/following{/other_user}",
    "gists_url": "https://api.github.com/users/guiguan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/guiguan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/guiguan/subscriptions",
    "organizations_url": "https://api.github.com/users/guiguan/orgs",
    "repos_url": "https://api.github.com/users/guiguan/repos",
    "events_url": "https://api.github.com/users/guiguan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/guiguan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20158/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20158/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/539365442",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20158#issuecomment-539365442",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20158",
    "id": 539365442,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzOTM2NTQ0Mg==",
    "user": {
      "login": "guiguan",
      "id": 940189,
      "node_id": "MDQ6VXNlcjk0MDE4OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/940189?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/guiguan",
      "html_url": "https://github.com/guiguan",
      "followers_url": "https://api.github.com/users/guiguan/followers",
      "following_url": "https://api.github.com/users/guiguan/following{/other_user}",
      "gists_url": "https://api.github.com/users/guiguan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/guiguan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/guiguan/subscriptions",
      "organizations_url": "https://api.github.com/users/guiguan/orgs",
      "repos_url": "https://api.github.com/users/guiguan/repos",
      "events_url": "https://api.github.com/users/guiguan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/guiguan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-08T06:44:58Z",
    "updated_at": "2019-10-08T06:44:58Z",
    "author_association": "NONE",
    "body": "Hmm, probably you assume the proof is an array of RLP encoded nodes instead of KV store? So before calling `VerifyProof`, the process of converting the array to the KV store is already verifying that.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/539365442/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/541278984",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20158#issuecomment-541278984",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20158",
    "id": 541278984,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MTI3ODk4NA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-12T03:21:01Z",
    "updated_at": "2019-10-12T03:21:01Z",
    "author_association": "MEMBER",
    "body": "Yes, I also made this \"mistake\" during a refactor. VerifyProof indeed does not check that the keys are actually the hashes, but that's because we receive only the content from the network and actually hash it and construct this prootDb out of it. So the proofDb does not com directly from the network, rather is constructed locally via hashing.\r\n\r\nPerhaps the API is a it lame and could use some work to make this cleaner/clearer. Maybe we should not pass the proofDb as an argument, rather construct it locally. That would avoid confusion. Although I'm assuming there was a reason why it's not like that in the first place. Should check it out closer.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/541278984/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/541280652",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20158#issuecomment-541280652",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20158",
    "id": 541280652,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MTI4MDY1Mg==",
    "user": {
      "login": "guiguan",
      "id": 940189,
      "node_id": "MDQ6VXNlcjk0MDE4OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/940189?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/guiguan",
      "html_url": "https://github.com/guiguan",
      "followers_url": "https://api.github.com/users/guiguan/followers",
      "following_url": "https://api.github.com/users/guiguan/following{/other_user}",
      "gists_url": "https://api.github.com/users/guiguan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/guiguan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/guiguan/subscriptions",
      "organizations_url": "https://api.github.com/users/guiguan/orgs",
      "repos_url": "https://api.github.com/users/guiguan/repos",
      "events_url": "https://api.github.com/users/guiguan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/guiguan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-12T03:43:48Z",
    "updated_at": "2019-10-12T03:43:48Z",
    "author_association": "NONE",
    "body": "@karalabe Thanks for the clarification. Yes, it would be better if we could mention this in the VerifyProof document. I will close this issue for now.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/541280652/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
