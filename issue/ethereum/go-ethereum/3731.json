{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3731",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3731/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3731/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3731/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/3731",
  "id": 211153176,
  "node_id": "MDU6SXNzdWUyMTExNTMxNzY=",
  "number": 3731,
  "title": "Signing in geth  and verifying in solidity do not produce correct results",
  "user": {
    "login": "ethLouise",
    "id": 26120667,
    "node_id": "MDQ6VXNlcjI2MTIwNjY3",
    "avatar_url": "https://avatars.githubusercontent.com/u/26120667?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ethLouise",
    "html_url": "https://github.com/ethLouise",
    "followers_url": "https://api.github.com/users/ethLouise/followers",
    "following_url": "https://api.github.com/users/ethLouise/following{/other_user}",
    "gists_url": "https://api.github.com/users/ethLouise/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ethLouise/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ethLouise/subscriptions",
    "organizations_url": "https://api.github.com/users/ethLouise/orgs",
    "repos_url": "https://api.github.com/users/ethLouise/repos",
    "events_url": "https://api.github.com/users/ethLouise/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ethLouise/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2017-03-01T17:31:32Z",
  "updated_at": "2019-06-10T18:06:44Z",
  "closed_at": "2017-03-02T12:02:15Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "\r\n\r\nGeth version: `1.5.9-stable`\r\nOS & Version: Linux\r\nCommit hash : a07539fb88db7231d18db918ed7a6a4e32f97450\r\n\r\n\r\nI sign with personal.sign  or web3.eth.sign in geth then I test with personal.ecrecover it works fine, it returns the right address, BUT when I try to verify with solidity it return a wrong address !! can you tell me why please!\r\n\r\n\r\n",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3731/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3731/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/283620075",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/3731#issuecomment-283620075",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3731",
    "id": 283620075,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI4MzYyMDA3NQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-03-02T10:46:30Z",
    "updated_at": "2017-03-02T10:46:30Z",
    "author_association": "MEMBER",
    "body": "I already pointed you to the commit that changes the behavior and the reason behind it: https://github.com/ethereum/go-ethereum/commit/b59c8399fbe42390a3d41e945d03b1f21c1a9b8d\r\n\r\nTL;DR; Geth prepends the string `\\x19Ethereum Signed Message:\\n<length of message>` to all data before signing it (https://github.com/ethereum/wiki/wiki/JSON-RPC#eth_sign). If you want to verify such a signature from Solidity, you'll have to prepend the same string in solidity before doing the ecrecovery.\r\n\r\nThe reason was that by allowing signing arbitrary data, a DApp can trick the user to sign a transaction masqueraded as some arbitrary application data. This prefix ensures that no matter what data a DApp sends Geth, it cannot be abused as a transaction. To use this mechanism for signature verification in solidity, you'll need to have your contract also do this prefixing.\r\n\r\nAlternatively, you might want to do account management client side in your application and not rely on Geth for that. The go-ethereum libraries provide the methods to sign arbitrary data, they are just not exposed by Geth due to security reasons.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/283620075/reactions",
      "total_count": 4,
      "+1": 4,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/291157931",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/3731#issuecomment-291157931",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3731",
    "id": 291157931,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5MTE1NzkzMQ==",
    "user": {
      "login": "gatb27",
      "id": 18337013,
      "node_id": "MDQ6VXNlcjE4MzM3MDEz",
      "avatar_url": "https://avatars.githubusercontent.com/u/18337013?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gatb27",
      "html_url": "https://github.com/gatb27",
      "followers_url": "https://api.github.com/users/gatb27/followers",
      "following_url": "https://api.github.com/users/gatb27/following{/other_user}",
      "gists_url": "https://api.github.com/users/gatb27/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gatb27/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gatb27/subscriptions",
      "organizations_url": "https://api.github.com/users/gatb27/orgs",
      "repos_url": "https://api.github.com/users/gatb27/repos",
      "events_url": "https://api.github.com/users/gatb27/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gatb27/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-03T14:21:21Z",
    "updated_at": "2017-04-03T14:21:33Z",
    "author_association": "NONE",
    "body": "Hi there, do you have any example on how to pre-append the string on the Solidity side? What I have to sign is always a keccak-256 hash, so the size is always the same :) ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/291157931/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/293866868",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/3731#issuecomment-293866868",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3731",
    "id": 293866868,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5Mzg2Njg2OA==",
    "user": {
      "login": "10say",
      "id": 9344694,
      "node_id": "MDQ6VXNlcjkzNDQ2OTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9344694?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/10say",
      "html_url": "https://github.com/10say",
      "followers_url": "https://api.github.com/users/10say/followers",
      "following_url": "https://api.github.com/users/10say/following{/other_user}",
      "gists_url": "https://api.github.com/users/10say/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/10say/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/10say/subscriptions",
      "organizations_url": "https://api.github.com/users/10say/orgs",
      "repos_url": "https://api.github.com/users/10say/repos",
      "events_url": "https://api.github.com/users/10say/events{/privacy}",
      "received_events_url": "https://api.github.com/users/10say/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-13T11:45:36Z",
    "updated_at": "2017-04-13T11:45:36Z",
    "author_association": "NONE",
    "body": "That worked for me :\r\n```\r\nbytes32 msgHash = 0x852daa74cc3c31fe64542bb9b8764cfb91cc30f9acf9389071ffb44a9eefde46;\r\nbytes32 r = 0xb814eaab5953337fed2cf504a5b887cddd65a54b7429d7b191ff1331ca0726b1;\r\nbytes32 s = 0x264de2660d307112075c15f08ba9c25c9a0cc6f8119aff3e7efb0a942773abb0;\r\nuint8 v = 0x1b;\r\n\r\nbytes memory prefix = \"\\x19Ethereum Signed Message:\\n32\";\r\nbytes32 prefixedHash = sha3(prefix, msgHash);\r\n        \r\naddress PK = ecrecover(prefixedHash, v, r, s);\r\n// PK should equal 0xa6fb229e9b0a4e4ef52ea6991adcfc59207c7711\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/293866868/reactions",
      "total_count": 11,
      "+1": 11,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/364579325",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/3731#issuecomment-364579325",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3731",
    "id": 364579325,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDU3OTMyNQ==",
    "user": {
      "login": "EvilJordan",
      "id": 1364262,
      "node_id": "MDQ6VXNlcjEzNjQyNjI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1364262?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/EvilJordan",
      "html_url": "https://github.com/EvilJordan",
      "followers_url": "https://api.github.com/users/EvilJordan/followers",
      "following_url": "https://api.github.com/users/EvilJordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/EvilJordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/EvilJordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/EvilJordan/subscriptions",
      "organizations_url": "https://api.github.com/users/EvilJordan/orgs",
      "repos_url": "https://api.github.com/users/EvilJordan/repos",
      "events_url": "https://api.github.com/users/EvilJordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/EvilJordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-09T21:50:38Z",
    "updated_at": "2018-02-09T21:50:38Z",
    "author_association": "NONE",
    "body": "So, is this ever going to be fixed to be compatible with TREZOR and the like? Specifically, using an ASCII message length vs. a var_int/hex length of the message: [https://github.com/ethereum/go-ethereum/issues/14794](https://github.com/ethereum/go-ethereum/issues/14794)\r\n\r\nIt seems no matter how I attempt to pass in a prefixed message signed from a TREZOR (using ascii length or a hex length), geth can't verify it. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/364579325/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/500520231",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/3731#issuecomment-500520231",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3731",
    "id": 500520231,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMDUyMDIzMQ==",
    "user": {
      "login": "CryptoKiddies",
      "id": 32784002,
      "node_id": "MDQ6VXNlcjMyNzg0MDAy",
      "avatar_url": "https://avatars.githubusercontent.com/u/32784002?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CryptoKiddies",
      "html_url": "https://github.com/CryptoKiddies",
      "followers_url": "https://api.github.com/users/CryptoKiddies/followers",
      "following_url": "https://api.github.com/users/CryptoKiddies/following{/other_user}",
      "gists_url": "https://api.github.com/users/CryptoKiddies/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CryptoKiddies/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CryptoKiddies/subscriptions",
      "organizations_url": "https://api.github.com/users/CryptoKiddies/orgs",
      "repos_url": "https://api.github.com/users/CryptoKiddies/repos",
      "events_url": "https://api.github.com/users/CryptoKiddies/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CryptoKiddies/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-10T18:06:44Z",
    "updated_at": "2019-06-10T18:06:44Z",
    "author_association": "NONE",
    "body": "Something that's been bothering me is the potential for abuse with the SignTransaction method. Though it requires to be fed specific named properties in order to execute, it can still be abused by a dapp that bypasses Metamask and uses its own custom wallet handling. It can still display disinformation and provide differing values under the hood, thus having a transaction with arbitrary data signed and ready to using whatever private key the user had sitting in local storage. How does this change protect against the form of abuse I highlight here?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/500520231/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
