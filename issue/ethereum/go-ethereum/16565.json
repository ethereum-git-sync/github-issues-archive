{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16565",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16565/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16565/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16565/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/16565",
  "id": 317595781,
  "node_id": "MDU6SXNzdWUzMTc1OTU3ODE=",
  "number": 16565,
  "title": "Geth crashes often while syncing with blockchain",
  "user": {
    "login": "Rohithzr",
    "id": 1592554,
    "node_id": "MDQ6VXNlcjE1OTI1NTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1592554?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Rohithzr",
    "html_url": "https://github.com/Rohithzr",
    "followers_url": "https://api.github.com/users/Rohithzr/followers",
    "following_url": "https://api.github.com/users/Rohithzr/following{/other_user}",
    "gists_url": "https://api.github.com/users/Rohithzr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Rohithzr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Rohithzr/subscriptions",
    "organizations_url": "https://api.github.com/users/Rohithzr/orgs",
    "repos_url": "https://api.github.com/users/Rohithzr/repos",
    "events_url": "https://api.github.com/users/Rohithzr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Rohithzr/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2018-04-25T11:56:12Z",
  "updated_at": "2018-04-26T08:50:51Z",
  "closed_at": "2018-04-26T08:50:51Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n```\r\n> geth version\r\nGeth\r\nVersion: 1.8.6-stable\r\nGit Commit: 12683feca7483f0b0bf425c3c520e2724f69f2aa\r\nArchitecture: amd64\r\nProtocol Versions: [63 62]\r\nNetwork Id: 1\r\nGo Version: go1.10\r\nOperating System: linux\r\nGOPATH=\r\nGOROOT=/usr/lib/go-1.10\r\n```\r\n```\r\nInstance type: AWS c5.large\r\nCPU: 2\r\nRAM: 4\r\n```\r\n```\r\nconfig.toml\r\n...\r\nNetworkId = 1\r\nSyncMode = \"fast\"\r\nLightPeers = 100\r\nDatabaseCache = 1536\r\n...\r\n```\r\n#### Actual behaviour\r\ngeth crashes, I have set it to autorestart on failiure, so it's syncing for me, but it is restarting very often. I am guessing it is because the ec2 instance is running out of memory, but I have tried to set the DatabaseCache to 1.5 GiG in hopes that it should work, but that doesn't happen.\r\n\r\n#### Steps to reproduce the behaviour\r\n[Follow the steps installing-from-ppa ](https://github.com/ethereum/go-ethereum/wiki/Installation-Instructions-for-Ubuntu#installing-from-ppa)\r\n#### Backtrace\r\n```\r\n\r\nerror log (journalctl)\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: internal/poll.(*FD).WaitWrite(0xc4865e5580, 0xf95b98, 0x1091760)\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /usr/lib/go-1.10/src/internal/poll/fd_unix.go:440 +0x37\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: net.(*netFD).connect(0xc4865e5580, 0x1091760, 0xc43874bc80, 0x0, 0x0, 0x1087660, 0xc46b850ce0, 0x0, 0x0, 0x0, ...)\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /usr/lib/go-1.10/src/net/fd_unix.go:152 +0x299\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: net.(*netFD).dial(0xc4865e5580, 0x1091760, 0xc43874bc80, 0x1094b20, 0x0, 0x1094b20, 0xc42d36a660, 0xc484592938, 0x5eed0e)\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /usr/lib/go-1.10/src/net/sock_posix.go:142 +0xe9\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: net.socket(0x1091760, 0xc43874bc80, 0xf04e50, 0x3, 0x2, 0x1, 0x0, 0x0, 0x1094b20, 0x0, ...)\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /usr/lib/go-1.10/src/net/sock_posix.go:93 +0x1a6\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: net.internetSocket(0x1091760, 0xc43874bc80, 0xf04e50, 0x3, 0x1094b20, 0x0, 0x1094b20, 0xc42d36a660, 0x1, 0x0, ...)\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /usr/lib/go-1.10/src/net/ipsock_posix.go:141 +0x129\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: net.doDialTCP(0x1091760, 0xc43874bc80, 0xf04e50, 0x3, 0x0, 0xc42d36a660, 0x1b086b0, 0x0, 0x0)\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /usr/lib/go-1.10/src/net/tcpsock_posix.go:62 +0xb9\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: net.dialTCP(0x1091760, 0xc43874bc80, 0xf04e50, 0x3, 0x0, 0xc42d36a660, 0x22e82c2de8, 0x1ae0040, 0x37e11b3f1)\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /usr/lib/go-1.10/src/net/tcpsock_posix.go:58 +0xe4\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: net.dialSingle(0x1091760, 0xc43874bc80, 0xc4865e5500, 0x108ac20, 0xc42d36a660, 0x0, 0x0, 0x0, 0x0)\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /usr/lib/go-1.10/src/net/dial.go:547 +0x375\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: net.dialSerial(0x1091760, 0xc43874bc80, 0xc4865e5500, 0xc4d4c35790, 0x1, 0x1, 0x0, 0x0, 0x0, 0x0)\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /usr/lib/go-1.10/src/net/dial.go:515 +0x22d\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: net.(*Dialer).DialContext(0xc420103d40, 0x1091720, 0xc420032018, 0xf04e50, 0x3, 0xc46b850ca0, 0x13, 0x0, 0x0, 0x0, ...)\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /usr/lib/go-1.10/src/net/dial.go:397 +0x678\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: net.(*Dialer).Dial(0xc420103d40, 0xf04e50, 0x3, 0xc46b850ca0, 0x13, 0x1, 0x0, 0x0, 0x1000000000001)\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /usr/lib/go-1.10/src/net/dial.go:320 +0x75\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: github.com/ethereum/go-ethereum/p2p.TCPDialer.Dial(0xc420103d40, 0xc4487b6000, 0xc4a758f710, 0x60d456, 0x5, 0x44)\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /build/ethereum-LEwR9U/ethereum-1.8.6+build13246+xenial/build/_workspace/src/github.com/ethereum/go-ethereum/p2p/dial.go:65 +0x\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: github.com/ethereum/go-ethereum/p2p.(*dialTask).dial(0xc42d36a630, 0xc42026e000, 0xc4487b6000, 0xc42590f500, 0x5)\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /build/ethereum-LEwR9U/ethereum-1.8.6+build13246+xenial/build/_workspace/src/github.com/ethereum/go-ethereum/p2p/dial.go:349 +0\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: github.com/ethereum/go-ethereum/p2p.(*dialTask).Do(0xc42d36a630, 0xc42026e000)\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /build/ethereum-LEwR9U/ethereum-1.8.6+build13246+xenial/build/_workspace/src/github.com/ethereum/go-ethereum/p2p/dial.go:297 +0\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: github.com/ethereum/go-ethereum/p2p.(*Server).run.func2.1(0x1086320, 0xc42d36a630, 0xc42026e000, 0xc421951b60)\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /build/ethereum-LEwR9U/ethereum-1.8.6+build13246+xenial/build/_workspace/src/github.com/ethereum/go-ethereum/p2p/server.go:570\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: created by github.com/ethereum/go-ethereum/p2p.(*Server).run.func2\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /build/ethereum-LEwR9U/ethereum-1.8.6+build13246+xenial/build/_workspace/src/github.com/ethereum/go-ethereum/p2p/server.go:570\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: goroutine 12154 [runnable]:\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: github.com/ethereum/go-ethereum/p2p.(*Server).runPeer(0xc42026e000, 0xc453b046c0)\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /build/ethereum-LEwR9U/ethereum-1.8.6+build13246+xenial/build/_workspace/src/github.com/ethereum/go-ethereum/p2p/server.go:882\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]: created by github.com/ethereum/go-ethereum/p2p.(*Server).run\r\nApr 25 11:45:58 ip-172-31-40-7 geth[7735]:         /build/ethereum-LEwR9U/ethereum-1.8.6+build13246+xenial/build/_workspace/src/github.com/ethereum/go-ethereum/p2p/server.go:646\r\nApr 25 11:45:58 ip-172-31-40-7 systemd[1]: geth.service: Main process exited, code=exited, status=2/INVALIDARGUMENT\r\nApr 25 11:45:58 ip-172-31-40-7 systemd[1]: geth.service: Unit entered failed state.\r\nApr 25 11:45:58 ip-172-31-40-7 systemd[1]: geth.service: Failed with result 'exit-code'.\r\nApr 25 11:46:02 ip-172-31-40-7 systemd[1]: geth.service: Service hold-off time over, scheduling restart.\r\nApr 25 11:46:02 ip-172-31-40-7 systemd[1]: Stopped Ethereum Geth.\r\nApr 25 11:46:02 ip-172-31-40-7 systemd[1]: Started Ethereum Geth. (I have set it to auto-restart)\r\nApr 25 11:46:02 ip-172-31-40-7 geth[7780]: INFO [04-25|11:46:02] Maximum peer count                       ETH=25 LES=0 total=25\r\nApr 25 11:46:02 ip-172-31-40-7 geth[7780]: INFO [04-25|11:46:02] Starting peer-to-peer node               instance=Geth/v1.8.6-stable-12683fec/linux-amd64/go1.10\r\nApr 25 11:46:02 ip-172-31-40-7 geth[7780]: INFO [04-25|11:46:02] Allocated cache and file handles         database=/ethereumData/data/.ethereum/geth/chaindata cache=1536 handles=\r\n```\r\n\r\n#### Expected behaviour\r\n\r\n`/usr/bin/geth --config=/ethereumData/data/config.toml` should start syncing in fast mode and run without crashing.\r\n\r\n",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16565/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16565/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/384274691",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16565#issuecomment-384274691",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16565",
    "id": 384274691,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDI3NDY5MQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-25T12:49:44Z",
    "updated_at": "2018-04-25T12:49:44Z",
    "author_association": "MEMBER",
    "body": "How much memory does your VM have?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/384274691/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/384275207",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16565#issuecomment-384275207",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16565",
    "id": 384275207,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDI3NTIwNw==",
    "user": {
      "login": "Rohithzr",
      "id": 1592554,
      "node_id": "MDQ6VXNlcjE1OTI1NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1592554?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Rohithzr",
      "html_url": "https://github.com/Rohithzr",
      "followers_url": "https://api.github.com/users/Rohithzr/followers",
      "following_url": "https://api.github.com/users/Rohithzr/following{/other_user}",
      "gists_url": "https://api.github.com/users/Rohithzr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Rohithzr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Rohithzr/subscriptions",
      "organizations_url": "https://api.github.com/users/Rohithzr/orgs",
      "repos_url": "https://api.github.com/users/Rohithzr/repos",
      "events_url": "https://api.github.com/users/Rohithzr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Rohithzr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-25T12:51:30Z",
    "updated_at": "2018-04-25T12:56:18Z",
    "author_association": "NONE",
    "body": "@karalabe \r\n> How much memory does your VM have?\r\n\r\n4 GB\r\n\r\n```\r\n> top\r\nPID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND\r\n7975 root      20   0 4809708 3.330g      0 S   1.6 91.9   4:55.63 geth\r\n```\r\n\r\nHogs all the RAM and crashes, I end up getting this error\r\n```\r\n> cat /ethereumData/data/config.toml\r\n-bash: fork: Cannot allocate memory\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/384275207/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/384281212",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16565#issuecomment-384281212",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16565",
    "id": 384281212,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDI4MTIxMg==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-25T13:12:20Z",
    "updated_at": "2018-04-25T13:12:20Z",
    "author_association": "MEMBER",
    "body": "Generally Go likes to use twice as much memory as you tell it can. This is the way the garbage collector works, it only cleans junk after it used at least as much as it previously left. If you permit 1.5GB for the database, and maybe 500MB for internal caches, then you have 2GB of active memory, so the garbage collector can easily blow that up to 4GB and crash your node.\r\n\r\nMy suggestion for a 4GB memory machine is to run with `--cache=1024`.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/384281212/reactions",
      "total_count": 3,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/384564009",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16565#issuecomment-384564009",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16565",
    "id": 384564009,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDU2NDAwOQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-26T08:50:51Z",
    "updated_at": "2018-04-26T08:50:51Z",
    "author_association": "MEMBER",
    "body": "Closing this, but please reopen if it does not solve the issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/384564009/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
