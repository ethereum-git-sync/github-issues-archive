{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26623",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26623/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26623/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26623/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/26623",
  "id": 1573451401,
  "node_id": "I_kwDOAOvK985dyPaJ",
  "number": 26623,
  "title": "Hex number as parameter for `start`/`count` on `engine_getPayloadBodiesByRange` results in error",
  "user": {
    "login": "marioevz",
    "id": 11726710,
    "node_id": "MDQ6VXNlcjExNzI2NzEw",
    "avatar_url": "https://avatars.githubusercontent.com/u/11726710?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/marioevz",
    "html_url": "https://github.com/marioevz",
    "followers_url": "https://api.github.com/users/marioevz/followers",
    "following_url": "https://api.github.com/users/marioevz/following{/other_user}",
    "gists_url": "https://api.github.com/users/marioevz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/marioevz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/marioevz/subscriptions",
    "organizations_url": "https://api.github.com/users/marioevz/orgs",
    "repos_url": "https://api.github.com/users/marioevz/repos",
    "events_url": "https://api.github.com/users/marioevz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/marioevz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2023-02-06T23:29:28Z",
  "updated_at": "2023-02-08T15:04:46Z",
  "closed_at": "2023-02-08T15:04:46Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: Geth/v1.11.0-unstable-3a5aceed/linux-amd64/go1.19.5\r\nCL client & version: hive https://github.com/ethereum/hive/commit/97d9b7ba95663a6d67d76ce65b4d97e950a0b07b\r\nOS & Version: Linux\r\nCommit hash : 3a5aceed\r\n\r\n#### Expected behaviour\r\nSending  `QUANTITY` value (see https://github.com/ethereum/execution-apis/blob/main/src/engine/common.md#encoding) as `start` and/or `count` parameters for `engine_getPayloadBodiesByRangeV1` (see https://github.com/ethereum/execution-apis/blob/main/src/engine/shanghai.md#request-4) should return a valid response.\r\n\r\n#### Actual behaviour\r\nSending\r\n```\r\n{\"jsonrpc\":\"2.0\",\"id\":9,\"method\":\"engine_getPayloadBodiesByRangeV1\",\"params\":[\"0x1\",\"0x1\"]}\r\n```\r\nResults in:\r\n```\r\n{\"jsonrpc\":\"2.0\",\"id\":9,\"error\":{\"code\":-32602,\"message\":\"invalid argument 0: json: cannot unmarshal string into Go value of type uint64\"}}\r\n```\r\n\r\nSee logs: https://hivetests2.ethdevops.io/suite.html?suiteid=1675704876-3f3a1bd514cc40ba5dfbe08c7a775cb8.json&suitename=engine-withdrawals#test-213\r\n\r\n#### Steps to reproduce the behaviour\r\nRun hive `engine-withdrawals` test suite on latest branch using:\r\n```\r\n./hive --client go-ethereum --sim ethereum/engine --sim.limit \"engine-withdrawals/GetPayloadBodiesByRange\"\r\n```",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26623/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26623/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1420172450",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26623#issuecomment-1420172450",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26623",
    "id": 1420172450,
    "node_id": "IC_kwDOAOvK985Uphyi",
    "user": {
      "login": "jwasinger",
      "id": 3411040,
      "node_id": "MDQ6VXNlcjM0MTEwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3411040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jwasinger",
      "html_url": "https://github.com/jwasinger",
      "followers_url": "https://api.github.com/users/jwasinger/followers",
      "following_url": "https://api.github.com/users/jwasinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/jwasinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jwasinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jwasinger/subscriptions",
      "organizations_url": "https://api.github.com/users/jwasinger/orgs",
      "repos_url": "https://api.github.com/users/jwasinger/repos",
      "events_url": "https://api.github.com/users/jwasinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jwasinger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-07T04:10:42Z",
    "updated_at": "2023-02-07T04:10:42Z",
    "author_association": "MEMBER",
    "body": "I've made https://github.com/ethereum/go-ethereum/pull/26624 to address this.  The hive test still fails, but now the failure is in the rpc method logic (or the hive test?  I haven't looked further).\r\n\r\nlog excerpt from running the test now:\r\n```\r\n>> (2d62df26) {\"jsonrpc\":\"2.0\",\"id\":9,\"method\":\"engine_getPayloadBodiesByRangeV1\",\"params\":[\"0x1\",\"0x1\"]}\r\n<< (2d62df26) {\"jsonrpc\":\"2.0\",\"id\":9,\"result\":[{\"transactions\":[]}]}\r\n>> (2d62df26) {\"jsonrpc\":\"2.0\",\"id\":10,\"method\":\"engine_getPayloadBodiesByRangeV1\",\"params\":[\"0x2\",\"0x1\"]}\r\n<< (2d62df26) {\"jsonrpc\":\"2.0\",\"id\":10,\"result\":null}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1420172450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1421155444",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26623#issuecomment-1421155444",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26623",
    "id": 1421155444,
    "node_id": "IC_kwDOAOvK985UtRx0",
    "user": {
      "login": "marioevz",
      "id": 11726710,
      "node_id": "MDQ6VXNlcjExNzI2NzEw",
      "avatar_url": "https://avatars.githubusercontent.com/u/11726710?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marioevz",
      "html_url": "https://github.com/marioevz",
      "followers_url": "https://api.github.com/users/marioevz/followers",
      "following_url": "https://api.github.com/users/marioevz/following{/other_user}",
      "gists_url": "https://api.github.com/users/marioevz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marioevz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marioevz/subscriptions",
      "organizations_url": "https://api.github.com/users/marioevz/orgs",
      "repos_url": "https://api.github.com/users/marioevz/repos",
      "events_url": "https://api.github.com/users/marioevz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marioevz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-07T17:25:18Z",
    "updated_at": "2023-02-07T17:25:18Z",
    "author_association": "MEMBER",
    "body": "Hey @jwasinger, I have not rerun the test myself yet but this looks incorrect because, if we are requesting beyond the latest known block number, it should respond with empty array, instead of null.\r\nIf we are requesting a known block, it should respond with the payload body, but either way I don't think it should respond with null at any point.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1421155444/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1421421304",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26623#issuecomment-1421421304",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26623",
    "id": 1421421304,
    "node_id": "IC_kwDOAOvK985UuSr4",
    "user": {
      "login": "marioevz",
      "id": 11726710,
      "node_id": "MDQ6VXNlcjExNzI2NzEw",
      "avatar_url": "https://avatars.githubusercontent.com/u/11726710?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marioevz",
      "html_url": "https://github.com/marioevz",
      "followers_url": "https://api.github.com/users/marioevz/followers",
      "following_url": "https://api.github.com/users/marioevz/following{/other_user}",
      "gists_url": "https://api.github.com/users/marioevz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marioevz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marioevz/subscriptions",
      "organizations_url": "https://api.github.com/users/marioevz/orgs",
      "repos_url": "https://api.github.com/users/marioevz/repos",
      "events_url": "https://api.github.com/users/marioevz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marioevz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-07T20:44:29Z",
    "updated_at": "2023-02-07T20:44:29Z",
    "author_association": "MEMBER",
    "body": "I ran the test using the fix branch and there is something definitely going on:\r\nLatest block is B2, which was correctly set as head using `engine_forkchoiceUpdated`, and then we request it by:\r\n```\r\n{\r\n  \"jsonrpc\": \"2.0\",\r\n  \"id\": 8,\r\n  \"method\": \"eth_getBlockByNumber\",\r\n  \"params\": [\r\n    \"0x2\",\r\n    false\r\n  ]\r\n}\r\n```\r\nAnd we get a block:\r\n```\r\n{\r\n  \"jsonrpc\": \"2.0\",\r\n  \"id\": 8,\r\n  \"result\": {\r\n    \"baseFeePerGas\": \"0x2da282a8\",\r\n    \"difficulty\": \"0x0\",\r\n    \"extraData\": \"0xd883010b00846765746888676f312e31392e35856c696e7578\",\r\n    \"gasLimit\": \"0x3007cf\",\r\n    \"gasUsed\": \"0x0\",\r\n    \"hash\": \"0x44d438a288837cc9b79b6d3f1c3617f67476de43f9b12f24d1ce3d0a286a3a23\",\r\n    \"logsBloom\": \"0x00...\",\r\n    \"miner\": \"0x00...\",\r\n    \"mixHash\": \"0xd7fd5146a2cc3df501b34ceb50a92e44ad7604fc93f227d261c46ab3c8172020\",\r\n    \"nonce\": \"0x0000000000000000\",\r\n    \"number\": \"0x2\",\r\n    \"parentHash\": \"0x759c2d610a33755817382e8f9e1caa0a899522a6850e7549b2a560c1acfa75de\",\r\n    \"receiptsRoot\": \"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421\",\r\n    \"sha3Uncles\": \"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347\",\r\n    \"size\": \"0x23a\",\r\n    \"stateRoot\": \"0x0a1d0145d9c5a1da81dd9a48dd9758d43366a076c3c1d0da18126fc4e81cb104\",\r\n    \"timestamp\": \"0x1236\",\r\n    \"totalDifficulty\": \"0x0\",\r\n    \"transactions\": [],\r\n    \"transactionsRoot\": \"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421\",\r\n    \"uncles\": [],\r\n    \"withdrawals\": [],\r\n    \"withdrawalsRoot\": \"0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421\"\r\n  }\r\n}\r\n```\r\nThen we request:\r\n```\r\n{\r\n  \"jsonrpc\": \"2.0\",\r\n  \"id\": 10,\r\n  \"method\": \"engine_getPayloadBodiesByRangeV1\",\r\n  \"params\": [\r\n    \"0x2\",\r\n    \"0x1\"\r\n  ]\r\n}\r\n```\r\nWhich should return:\r\n```\r\n{\r\n  \"jsonrpc\": \"2.0\",\r\n  \"id\": 10,\r\n  \"result\": [\r\n    {\r\n      \"transactions\": [],\r\n      \"withdrawals\": []\r\n    }\r\n  ]\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1421421304/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1421911022",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26623#issuecomment-1421911022",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26623",
    "id": 1421911022,
    "node_id": "IC_kwDOAOvK985UwKPu",
    "user": {
      "login": "jwasinger",
      "id": 3411040,
      "node_id": "MDQ6VXNlcjM0MTEwNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3411040?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jwasinger",
      "html_url": "https://github.com/jwasinger",
      "followers_url": "https://api.github.com/users/jwasinger/followers",
      "following_url": "https://api.github.com/users/jwasinger/following{/other_user}",
      "gists_url": "https://api.github.com/users/jwasinger/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jwasinger/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jwasinger/subscriptions",
      "organizations_url": "https://api.github.com/users/jwasinger/orgs",
      "repos_url": "https://api.github.com/users/jwasinger/repos",
      "events_url": "https://api.github.com/users/jwasinger/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jwasinger/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-08T02:58:55Z",
    "updated_at": "2023-02-08T02:58:55Z",
    "author_association": "MEMBER",
    "body": "Unassigned myself.  If this is easy for anyone else, feel free to pick it up.  I will continue looking into this but I have to do some digging/learning to figure out how to properly debug in Hive.\r\n\r\nAfaict, the issue is improper serialization of the result from [GetPayloadBodiesByRangeV1](https://github.com/ethereum/go-ethereum/blob/master/eth/catalyst/api.go#L775).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1421911022/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1422359473",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26623#issuecomment-1422359473",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26623",
    "id": 1422359473,
    "node_id": "IC_kwDOAOvK985Ux3ux",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-08T10:18:29Z",
    "updated_at": "2023-02-08T10:18:29Z",
    "author_association": "MEMBER",
    "body": "> Which should return:\r\n\r\n... well, what does it return?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1422359473/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1422360516",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26623#issuecomment-1422360516",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26623",
    "id": 1422360516,
    "node_id": "IC_kwDOAOvK985Ux3_E",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-08T10:19:13Z",
    "updated_at": "2023-02-08T10:19:13Z",
    "author_association": "MEMBER",
    "body": "doh!\r\n\r\n ```\r\n<< (2d62df26) {\"jsonrpc\":\"2.0\",\"id\":10,\"result\":null}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1422360516/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
