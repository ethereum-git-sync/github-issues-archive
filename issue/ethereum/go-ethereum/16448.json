{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16448",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16448/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16448/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16448/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/16448",
  "id": 311569692,
  "node_id": "MDU6SXNzdWUzMTE1Njk2OTI=",
  "number": 16448,
  "title": "debug_traceTransaction — JavaScript-based tracing (missing `log` fields)",
  "user": {
    "login": "alexprut",
    "id": 1648497,
    "node_id": "MDQ6VXNlcjE2NDg0OTc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1648497?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alexprut",
    "html_url": "https://github.com/alexprut",
    "followers_url": "https://api.github.com/users/alexprut/followers",
    "following_url": "https://api.github.com/users/alexprut/following{/other_user}",
    "gists_url": "https://api.github.com/users/alexprut/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alexprut/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alexprut/subscriptions",
    "organizations_url": "https://api.github.com/users/alexprut/orgs",
    "repos_url": "https://api.github.com/users/alexprut/repos",
    "events_url": "https://api.github.com/users/alexprut/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alexprut/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 856638432,
      "node_id": "MDU6TGFiZWw4NTY2Mzg0MzI=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:inactive",
      "name": "status:inactive",
      "color": "ffffff",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2018-04-05T11:17:08Z",
  "updated_at": "2020-04-30T10:19:46Z",
  "closed_at": "2019-05-23T13:05:34Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "The `JavaScript-based tracing` option functionality within the `debug_traceTransaction` call is not behaving as expected and as documented in https://github.com/ethereum/go-ethereum/wiki/Management-APIs#debug_tracetransaction.\r\n\r\n#### System information\r\n\r\nGeth version: `Geth/v1.8.3-stable-329ac18e/linux-amd64/go1.10`\r\nOS & Version: Linux\r\n\r\n#### Expected behaviour\r\n\r\nWhen using the `JavaScript-based tracing` option in the `rpc` call most of the `log` fields of the `step` function are `undefined`. More precisely the only fields visible are:\r\n* `op`: Object, an OpCode object representing the current opcode\r\n* `contract`: \r\n* `memory`: Object, a structure representing the contract's memory space\r\n* `stack`: array[big.Int], the EVM execution stack\r\n\r\nInstead the missing and `undefined` fields are:\r\n* `pc`: Number, the current program counter\r\n* `gas`: Number, the amount of gas remaining\r\n* `gasPrice`: Number, the cost in wei of each unit of gas\r\n* `depth`: The execution depth\r\n* `account`: The address of the account executing the current operation\r\n* `err`: If an error occured, information about the error\r\n\r\nIf using the `debug_traceTransaction` method without the `JavaScript-based tracing` it is behaving as expected.\r\n\r\n#### Steps to reproduce the behaviour\r\nThe `JavaScript-based tracing` code used is:\r\n```\r\n{\r\n   logs: [],\r\n   extractStack: function (stack, op) {\r\n       var extract = [];\r\n       for (var i = 0; i < stack.length(); i++) {\r\n           extract.push(stack.peek(i));\r\n       }\r\n       return extract;\r\n   },\r\n   step: function (log, db) {\r\n       this.logs.push({\r\n           op: log.op.toString(),\r\n           stack: this.extractStack(log.stack),\r\n           depth: log.depth,\r\n           error: log.err\r\n       });\r\n   },\r\n   fault: function() {},\r\n   result: function () {\r\n       return {structLogs: this.logs};\r\n   }\r\n}\r\n```\r\n\r\nThe raw `rpc` call with the `JavaScript-based tracing` option:\r\n```\r\ncurl --data '{\"jssonrpc\":\"2.0\",\"method\":\"debug_traceTransaction\", \"id\": 1, \"params\":[\"0x24856e50b82728948a9b1b55907d4c2d13c22b1999eba32eb3f131d92a0fd8ca\", {\"disableMemory\": true, \"disableStorage\": true, \"tracer\": \"{logs: [],extractStack: function (stack, op) {var extract = [];for (var i = 0; i < stack.length(); i++) {extract.push(stack.peek(i));}return extract;},step: function (log, db) {this.logs.push({op: log.op.toString(),stack: this.extractStack(log.stack),depth: log.depth,error: log.err});},fault: function() {},result: function () {return {structLogs: this.logs};}}\"}]}' -H \"Content-Type: application/json\" -X POST  localhost:8545\r\n```\r\n\r\nThe raw `rpc` call without the `JavaScript-based tracing` option:\r\n```\r\ncurl --data '{\"jssonrpc\":\"2.0\",\"method\":\"debug_traceTransaction\", \"id\": 1, \"params\":[\"0x24856e50b82728948a9b1b55907d4c2d13c22b1999eba32eb3f131d92a0fd8ca\", {\"disableMemory\": true, \"disableStorage\": true}]}' -H \"Content-Type: application/json\" -X POST  eth-localhost:8545\r\n```\r\n\r\n\r\n#### Backtrace\r\nOutput of the `rpc` call: `debug_traceTransaction` (with options: `disableStorage`, `disableMemory`, `JavaScript-based tracing`)\r\nhttps://gist.github.com/alexprut/509e3f46dd302acd738dc3a89bc3588b\r\n\r\nOutput of the `rpc` call: `debug_traceTransaction` (with options: `disableStorage`, `disableMemory`)\r\nhttps://gist.github.com/alexprut/002979fdb58e9bc9bcae348744ae61d7",
  "closed_by": {
    "login": "stale[bot]",
    "id": 26384082,
    "node_id": "MDM6Qm90MjYzODQwODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stale%5Bbot%5D",
    "html_url": "https://github.com/apps/stale",
    "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16448/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16448/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/379488642",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16448#issuecomment-379488642",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16448",
    "id": 379488642,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3OTQ4ODY0Mg==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-07T18:12:18Z",
    "updated_at": "2018-04-07T18:12:18Z",
    "author_association": "MEMBER",
    "body": "I'm not sure that the docs are up to date -- I know @karalabe has been working on writing new documentation, and I don't know if that is released... ?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/379488642/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/379490687",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16448#issuecomment-379490687",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16448",
    "id": 379490687,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3OTQ5MDY4Nw==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-07T18:47:08Z",
    "updated_at": "2018-04-07T18:47:08Z",
    "author_association": "MEMBER",
    "body": "Based on https://github.com/ethereum/go-ethereum/blob/master/eth/tracers/tracer.go#L443 , try `log.getDepth()` instead. IIRC, Peter changed the accessors to be functions, which made everything quite a lot faster. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/379490687/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/380079504",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16448#issuecomment-380079504",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16448",
    "id": 380079504,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MDA3OTUwNA==",
    "user": {
      "login": "alexprut",
      "id": 1648497,
      "node_id": "MDQ6VXNlcjE2NDg0OTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1648497?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexprut",
      "html_url": "https://github.com/alexprut",
      "followers_url": "https://api.github.com/users/alexprut/followers",
      "following_url": "https://api.github.com/users/alexprut/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexprut/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexprut/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexprut/subscriptions",
      "organizations_url": "https://api.github.com/users/alexprut/orgs",
      "repos_url": "https://api.github.com/users/alexprut/repos",
      "events_url": "https://api.github.com/users/alexprut/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexprut/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-10T12:24:24Z",
    "updated_at": "2018-04-10T12:24:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks @holiman it works 👍 \r\nHow can I update the docs?\r\n \r\nThe new documentation should be updated as follows:\r\n* `log.pc` → `log.getPC()`\r\n* `log.gas` → `log.getGas()`\r\n* `log.gasPrice` → `log.getCost()`\r\n* `log.depth` → `log.getDepth()`\r\n* `log.err` → `log.getError()`\r\n\r\nThere is another smaller issue:\r\nThe `stack` values returned with the `JavaScript-based tracing` option are represented as `Integer String` instead of a `Hexadecimal String`.\r\n\r\nExample:\r\nhttps://gist.github.com/alexprut/509e3f46dd302acd738dc3a89bc3588b#file-traces-js-txt-L15\r\nhttps://gist.github.com/alexprut/002979fdb58e9bc9bcae348744ae61d7#file-traces-txt-L26\r\n\r\n`\"96\"` and `\"0000000000000000000000000000000000000000000000000000000000000060\"` is the same value but represented with different encoding.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/380079504/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/482105401",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16448#issuecomment-482105401",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16448",
    "id": 482105401,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MjEwNTQwMQ==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2019-04-11T13:04:25Z",
    "updated_at": "2019-04-11T13:04:25Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/482105401/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/621745055",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16448#issuecomment-621745055",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16448",
    "id": 621745055,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMTc0NTA1NQ==",
    "user": {
      "login": "samadsidd",
      "id": 58296793,
      "node_id": "MDQ6VXNlcjU4Mjk2Nzkz",
      "avatar_url": "https://avatars.githubusercontent.com/u/58296793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/samadsidd",
      "html_url": "https://github.com/samadsidd",
      "followers_url": "https://api.github.com/users/samadsidd/followers",
      "following_url": "https://api.github.com/users/samadsidd/following{/other_user}",
      "gists_url": "https://api.github.com/users/samadsidd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/samadsidd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/samadsidd/subscriptions",
      "organizations_url": "https://api.github.com/users/samadsidd/orgs",
      "repos_url": "https://api.github.com/users/samadsidd/repos",
      "events_url": "https://api.github.com/users/samadsidd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/samadsidd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-30T10:19:46Z",
    "updated_at": "2020-04-30T10:19:46Z",
    "author_association": "NONE",
    "body": "@alexprut \r\nHow can i get the account as mentioned in the docs\r\nlog.account is undefined",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/621745055/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
