{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2571",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2571/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2571/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2571/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/2571",
  "id": 154921458,
  "node_id": "MDU6SXNzdWUxNTQ5MjE0NTg=",
  "number": 2571,
  "title": "DoS: geth gossiping \"bad\" (mainnet) nodes throughout a private network",
  "user": {
    "login": "michaelansel",
    "id": 85195,
    "node_id": "MDQ6VXNlcjg1MTk1",
    "avatar_url": "https://avatars.githubusercontent.com/u/85195?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelansel",
    "html_url": "https://github.com/michaelansel",
    "followers_url": "https://api.github.com/users/michaelansel/followers",
    "following_url": "https://api.github.com/users/michaelansel/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelansel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelansel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelansel/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelansel/orgs",
    "repos_url": "https://api.github.com/users/michaelansel/repos",
    "events_url": "https://api.github.com/users/michaelansel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelansel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2016-05-15T18:06:39Z",
  "updated_at": "2019-01-15T09:51:29Z",
  "closed_at": "2019-01-15T09:51:20Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\n\nGeth version: 1.4.3 and 1.4.4\nOS & Version: Linux (Amazon AMI), OSX (El Cap)\n\nEC2\n\n```\n$ geth version\nGeth\nVersion: 1.4.3-stable-dd083aa3\nProtocol Versions: [63 62 61]\nNetwork Id: 1\nGo Version: go1.6.2\nOS: linux\nGOPATH=\nGOROOT=/opt/google/go\n```\n\nOSX\n\n```\n$ geth version\nGeth\nVersion: 1.4.4-stable-fc0638f9\nProtocol Versions: [63 62 61]\nNetwork Id: 1\nGo Version: go1.6.2\nOS: darwin\nGOPATH=\nGOROOT=/usr/local/Cellar/go/1.6.2/libexec\n```\n#### Expected behaviour\n\nI launch a private network; discovery works between nodes on the private network; any interaction with a different network (different genesis block) or any otherwise-bad nodes is not relayed.\n\nAll nodes start up like this (public node bootstraps against itself to force not using compiled-in bootnodes):\n\n``` bash\nBOOTNODES=$(paste -sd',' - <<EOF\nenode://901fb03fa5680615381f155f6c9c3dd867108d507a3384eeaf50b5e73179bc7f9025d966df188606b94cb3b5f6451df830b38b683005963af26d35941cc6a0d6@PUBLIC_IP:1337\nenode://901fb03fa5680615381f155f6c9c3dd867108d507a3384eeaf50b5e73179bc7f9025d966df188606b94cb3b5f6451df830b38b683005963af26d35941cc6a0d6@PUBLIC_IP:1337\nEOF\n)\n\n# Clear out node database\nrm -rf \"$HOME/darknet/data/nodes\"\n\nexec geth --datadir=$HOME/darknet/data --networkid 1337 --port 1337 --bootnodes=\"${BOOTNODES}\" --verbosity 5\n```\n#### Actual behaviour\n\nMy single internet accessible node (EC2) accidentally connected to the public network (with my genesis block) at some point in the past. Now, every time I start up the public node, it is blasted with connections from the main network. My node records those nodes and gossips them on to my other private nodes. As a result, all nodes are constantly trying to connect to the public internet, which is both wasteful and sometimes a denial of service for those nodes (they get stuck working through all public nodes looking for my relatively small number of private nodes).\n#### Steps to reproduce the behaviour\n\nLet me know if you want to repro against my private network (I'd rather not publish all the details, but happy to share with the developers).\n1. Set up a private network node (custom genesis block) with a public IP address and an internet-accessible Eth port\n2. Launch geth WITHOUT bootnodes set (uses the compiled-in list) and then stop it\n3. Clear out all memory of mainnet nodes: `rm -rf data/nodes`\n4. Launch geth WITH bootnodes set (point to anything that isn't the internet; I pointed back at self)\n5. Launch a second instance of geth WITH bootnodes set to the public IP in step 1/step 4 (this new node doesn't need to be internet accessible)\n6. Watch as the node from step 5 picks up invalid nodes from the public node (step 1) and tries to connect to them. If you restart the node from step 5, notice that it spends an inordinate amount of time connecting to bad nodes and rarely makes it to the singular \"good\" node.\n#### Backtrace\n\n(no backtrace; I can collect logs if that would be helpful)\n",
  "closed_by": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2571/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2571/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/219307133",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2571#issuecomment-219307133",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2571",
    "id": 219307133,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxOTMwNzEzMw==",
    "user": {
      "login": "michaelansel",
      "id": 85195,
      "node_id": "MDQ6VXNlcjg1MTk1",
      "avatar_url": "https://avatars.githubusercontent.com/u/85195?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelansel",
      "html_url": "https://github.com/michaelansel",
      "followers_url": "https://api.github.com/users/michaelansel/followers",
      "following_url": "https://api.github.com/users/michaelansel/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelansel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelansel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelansel/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelansel/orgs",
      "repos_url": "https://api.github.com/users/michaelansel/repos",
      "events_url": "https://api.github.com/users/michaelansel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelansel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-05-15T20:00:13Z",
    "updated_at": "2016-05-15T20:00:13Z",
    "author_association": "NONE",
    "body": "Did some more digging, and I think this is more an issue of geth falling back to the compiled-in seeds even when bootnodes is specified.\n\nBest I can tell, my public node is getting \"overloaded\" (hitting the geth connection cap) by the mainnet and ignoring the discovery connection from my non-public node. After the non-public node sees all seeds fail (\"no seeds found\"), it appears to just give up and start dialing all the compiled-in seeds. Then, even though the non-public node was never able to successfully handshake with mainnet (different genesis block), it happily records all seen nodes and uses them as seeds on next restart, effectively locking the new non-public node out of the private network.\n\n**My conclusion**: geth tries too damn hard to connect to the mainnet and won't accept that I want to run a private network with a separate peer discovery table.\n\nI'm going to leave this open with the hopes that a dev can at least shed a little light on what is going on and classify it as \"expected\" or \"bug\". Any suggestions on \"doing a full private network the right way\" would be welcome.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/219307133/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/219313296",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2571#issuecomment-219313296",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2571",
    "id": 219313296,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxOTMxMzI5Ng==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-05-15T22:00:01Z",
    "updated_at": "2016-05-15T22:00:01Z",
    "author_association": "MEMBER",
    "body": "Your conclusion is pretty much correct. The reason for this behaviour is that the discovery protocol doesn't distinguish between networks. We are working on a protocol change to make this work.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/219313296/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/219319082",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2571#issuecomment-219319082",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2571",
    "id": 219319082,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxOTMxOTA4Mg==",
    "user": {
      "login": "michaelansel",
      "id": 85195,
      "node_id": "MDQ6VXNlcjg1MTk1",
      "avatar_url": "https://avatars.githubusercontent.com/u/85195?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelansel",
      "html_url": "https://github.com/michaelansel",
      "followers_url": "https://api.github.com/users/michaelansel/followers",
      "following_url": "https://api.github.com/users/michaelansel/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelansel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelansel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelansel/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelansel/orgs",
      "repos_url": "https://api.github.com/users/michaelansel/repos",
      "events_url": "https://api.github.com/users/michaelansel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelansel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-05-15T23:21:08Z",
    "updated_at": "2016-05-15T23:21:08Z",
    "author_association": "NONE",
    "body": "Thanks for the confirmation! Should I leave this open to connect with that work, or would you rather have it closed?\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/219319082/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/370482579",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2571#issuecomment-370482579",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2571",
    "id": 370482579,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MDQ4MjU3OQ==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2018-03-05T16:44:30Z",
    "updated_at": "2018-03-05T16:44:30Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/370482579/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/370514646",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2571#issuecomment-370514646",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2571",
    "id": 370514646,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MDUxNDY0Ng==",
    "user": {
      "login": "michaelansel",
      "id": 85195,
      "node_id": "MDQ6VXNlcjg1MTk1",
      "avatar_url": "https://avatars.githubusercontent.com/u/85195?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelansel",
      "html_url": "https://github.com/michaelansel",
      "followers_url": "https://api.github.com/users/michaelansel/followers",
      "following_url": "https://api.github.com/users/michaelansel/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelansel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelansel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelansel/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelansel/orgs",
      "repos_url": "https://api.github.com/users/michaelansel/repos",
      "events_url": "https://api.github.com/users/michaelansel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelansel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-05T18:24:26Z",
    "updated_at": "2018-03-05T18:24:26Z",
    "author_association": "NONE",
    "body": "@fjl did this get fixed somewhere else, or is it still broken? Haven't had a chance to play with it in a while. I'll poke around and test it if I get some free time in the next couple weeks.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/370514646/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/378585812",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2571#issuecomment-378585812",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2571",
    "id": 378585812,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3ODU4NTgxMg==",
    "user": {
      "login": "cupaco",
      "id": 693543,
      "node_id": "MDQ6VXNlcjY5MzU0Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/693543?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cupaco",
      "html_url": "https://github.com/cupaco",
      "followers_url": "https://api.github.com/users/cupaco/followers",
      "following_url": "https://api.github.com/users/cupaco/following{/other_user}",
      "gists_url": "https://api.github.com/users/cupaco/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cupaco/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cupaco/subscriptions",
      "organizations_url": "https://api.github.com/users/cupaco/orgs",
      "repos_url": "https://api.github.com/users/cupaco/repos",
      "events_url": "https://api.github.com/users/cupaco/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cupaco/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-04T12:41:03Z",
    "updated_at": "2018-04-04T12:41:03Z",
    "author_association": "NONE",
    "body": "Is there any Update on this? i am having exactly the same issue and i dont want to use firewall rules to prevent from scanning around.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/378585812/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/454331158",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2571#issuecomment-454331158",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2571",
    "id": 454331158,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NDMzMTE1OA==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-15T09:51:20Z",
    "updated_at": "2019-01-15T09:51:20Z",
    "author_association": "MEMBER",
    "body": "We added a flag to white-list IP ranges for discovery to deal with this issue. Example:\r\nIf your private network nodes are on 192.168.0.1, 192.168.0.2, 192.168.0.3 you can use `geth --netrestrict 192.168.0.0/24` to restrict communication to that subnetwork.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/454331158/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
