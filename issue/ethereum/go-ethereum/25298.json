{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25298",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25298/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25298/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25298/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/25298",
  "id": 1304483575,
  "node_id": "I_kwDOAOvK985NwNb3",
  "number": 25298,
  "title": "clef: when --rules is used together with --stdio-ui then clef doesn't respond to clef_foo requests",
  "user": {
    "login": "attila-lendvai",
    "id": 840345,
    "node_id": "MDQ6VXNlcjg0MDM0NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/840345?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/attila-lendvai",
    "html_url": "https://github.com/attila-lendvai",
    "followers_url": "https://api.github.com/users/attila-lendvai/followers",
    "following_url": "https://api.github.com/users/attila-lendvai/following{/other_user}",
    "gists_url": "https://api.github.com/users/attila-lendvai/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/attila-lendvai/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/attila-lendvai/subscriptions",
    "organizations_url": "https://api.github.com/users/attila-lendvai/orgs",
    "repos_url": "https://api.github.com/users/attila-lendvai/repos",
    "events_url": "https://api.github.com/users/attila-lendvai/events{/privacy}",
    "received_events_url": "https://api.github.com/users/attila-lendvai/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-07-14T09:02:18Z",
  "updated_at": "2022-08-10T07:31:16Z",
  "closed_at": "2022-08-10T07:31:16Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nOn Guix (Linux):\r\n\r\n```\r\n~ $ /gnu/store/01m5q699wca57mi5zp5qk0hbcalqmm37-geth-binary-1.10.20/bin/geth version\r\nGeth\r\nVersion: 1.10.20-stable\r\nGit Commit: 8f2416a89a3def6ec2c749d5afafbf2c9a18e3c8\r\nGit Commit Date: 20220629\r\nArchitecture: amd64\r\nGo Version: go1.18.1\r\nOperating System: linux\r\nGOPATH=\r\nGOROOT=go\r\n```\r\n\r\n#### Expected behaviour\r\n\r\nwhen `--rules` is used while `--stdio-ui` is enabled, then Clef still responds to the `clef_foo` requests.\r\n\r\n#### Actual behaviour\r\n\r\nwhen `--rules` is provided, then Clef responds with:\r\n\r\n```\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"error\":{\"code\":-32601,\"message\":\"the method clef_chainId does not exist/is not available\"}}\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n```\r\n~ $ rm -rf /tmp/data /tmp/seed\r\n~ $ mkdir /tmp/data /tmp/seed\r\n~ $ touch /tmp/rules.js\r\n~ $ /gnu/store/ixrvspqpvpnqy45d3aakyafh78ffhdf4-geth-binary-1.10.20-clef/bin/clef --configdir /tmp/data --keystore /tmp/seed --chainid 15 --suppress-bootwarn init\r\nThe master seed of clef will be locked with a password.\r\nPlease specify a password. Do not forget this password!\r\nPassword: \r\nRepeat password: \r\n\r\nA master seed has been generated into /tmp/data/masterseed.json\r\n\r\nThis is required to be able to store credentials, such as:\r\n* Passwords for keystores (used by rule engine)\r\n* Storage for JavaScript auto-signing rules\r\n* Hash of JavaScript rule-file\r\n\r\nYou should treat 'masterseed.json' with utmost secrecy and make a backup of it!\r\n* The password is necessary but not enough, you need to back up the master seed too!\r\n* The master seed does not contain your accounts, those need to be backed up separately!\r\n\r\n~ $ /gnu/store/ixrvspqpvpnqy45d3aakyafh78ffhdf4-geth-binary-1.10.20-clef/bin/clef --configdir /tmp/data --keystore /tmp/seed --chainid 15 --suppress-bootwarn attest $(sha256sum /tmp/rules.js)\r\nDecrypt master seed of clef\r\nPassword: \r\nINFO [07-14|10:55:31.541] Ruleset attestation updated              sha256=e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855\r\n~ $ /gnu/store/ixrvspqpvpnqy45d3aakyafh78ffhdf4-geth-binary-1.10.20-clef/bin/clef --configdir /tmp/data --keystore /tmp/seed --chainid 15 --rules /tmp/rules.js --suppress-bootwarn --stdio-ui\r\nINFO [07-14|10:55:47.570] Using stdin/stdout as UI-channel \r\nINFO [07-14|10:55:47.818] Loaded 4byte database                    embeds=268,621 locals=0 local=./4byte-custom.json\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"ui_onInputRequired\",\"params\":[{\"title\":\"Master Password\",\"prompt\":\"Please enter the password to decrypt the master seed\",\"isPassword\":true}]}\r\n{ \"jsonrpc\": \"2.0\", \"id\":1, \"result\": { \"text\":\"almakortebanan\" } }\r\nINFO [07-14|10:55:57.750] Rule engine configured                   file=/tmp/rules.js\r\nINFO [07-14|10:55:57.750] Starting signer                          chainid=15 keystore=/tmp/seed light-kdf=false advanced=false\r\nDEBUG[07-14|10:55:57.750] FS scan times                            list=\"27.217µs\" set=306ns diff=818ns\r\nDEBUG[07-14|10:55:57.752] Ledger support enabled \r\nDEBUG[07-14|10:55:57.754] Trezor support enabled via HID \r\nDEBUG[07-14|10:55:57.754] Trezor support enabled via WebUSB \r\nINFO [07-14|10:55:57.754] Smartcard socket file missing, disabling err=\"stat /run/pcscd/pcscd.comm: no such file or directory\"\r\nINFO [07-14|10:55:57.754] Audit logs configured                    file=audit.log\r\nDEBUG[07-14|10:55:57.754] IPCs registered                          namespaces=account\r\nINFO [07-14|10:55:57.754] IPC endpoint opened                      url=/tmp/data/clef.ipc\r\n{\"jsonrpc\":\"2.0\",\"method\":\"ui_onSignerStartup\",\"params\":[{\"info\":{\"extapi_http\":\"n/a\",\"extapi_ipc\":\"/tmp/data/clef.ipc\",\"extapi_version\":\"6.1.0\",\"intapi_version\":\"7.0.1\"}}]}\r\nINFO [07-14|10:55:57.769] error occurred during execution          error=\"ReferenceError: OnSignerStartup is not defined at <eval>:1:16(6)\"\r\n{\"id\": 1, \"jsonrpc\": \"2.0\", \"method\": \"clef_chainId\"}\r\nWARN [07-14|10:56:17.698] Served clef_chainId                      conn=/dev/stdin reqid=1 duration=\"24.039µs\" err=\"the method clef_chainId does not exist/is not available\"\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"error\":{\"code\":-32601,\"message\":\"the method clef_chainId does not exist/is not available\"}}\r\n```\r\n\r\nnote that this log includes pasting two lines:\r\n\r\n1. providing the password: `{ \"jsonrpc\": \"2.0\", \"id\":1, \"result\": { \"text\":\"almakortebanan\" } }`\r\n2. the actual request: `{\"id\": 1, \"jsonrpc\": \"2.0\", \"method\": \"clef_chainId\"}`\r\n\r\n#### the same without `--rules`\r\n\r\n```\r\n~ $ /gnu/store/ixrvspqpvpnqy45d3aakyafh78ffhdf4-geth-binary-1.10.20-clef/bin/clef --configdir /tmp/data --keystore /tmp/seed --chainid 15 --suppress-bootwarn --stdio-ui\r\nINFO [07-14|10:57:51.220] Using stdin/stdout as UI-channel \r\nINFO [07-14|10:57:51.446] Loaded 4byte database                    embeds=268,621 locals=0 local=./4byte-custom.json\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"method\":\"ui_onInputRequired\",\"params\":[{\"title\":\"Master Password\",\"prompt\":\"Please enter the password to decrypt the master seed\",\"isPassword\":true}]}\r\n{ \"jsonrpc\": \"2.0\", \"id\":1, \"result\": { \"text\":\"almakortebanan\" } }\r\nINFO [07-14|10:57:56.431] Starting signer                          chainid=15 keystore=/tmp/seed light-kdf=false advanced=false\r\nDEBUG[07-14|10:57:56.432] FS scan times                            list=\"64.07µs\" set=381ns diff=691ns\r\nDEBUG[07-14|10:57:56.433] Ledger support enabled \r\nDEBUG[07-14|10:57:56.433] Trezor support enabled via HID \r\nDEBUG[07-14|10:57:56.433] Trezor support enabled via WebUSB \r\nINFO [07-14|10:57:56.433] Smartcard socket file missing, disabling err=\"stat /run/pcscd/pcscd.comm: no such file or directory\"\r\nINFO [07-14|10:57:56.433] Audit logs configured                    file=audit.log\r\nDEBUG[07-14|10:57:56.433] IPCs registered                          namespaces=account\r\nINFO [07-14|10:57:56.433] IPC endpoint opened                      url=/tmp/data/clef.ipc\r\n{\"jsonrpc\":\"2.0\",\"method\":\"ui_onSignerStartup\",\"params\":[{\"info\":{\"extapi_http\":\"n/a\",\"extapi_ipc\":\"/tmp/data/clef.ipc\",\"extapi_version\":\"6.1.0\",\"intapi_version\":\"7.0.1\"}}]}\r\n{\"id\": 1, \"jsonrpc\": \"2.0\", \"method\": \"clef_chainId\"}\r\nDEBUG[07-14|10:58:03.971] Served clef_chainId                      conn=/dev/stdin reqid=1 duration=\"57.703µs\"\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":\"0xf\"}\r\n```\r\n",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25298/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25298/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
