{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27050",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27050/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27050/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27050/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/27050",
  "id": 1654338329,
  "node_id": "I_kwDOAOvK985imzMZ",
  "number": 27050,
  "title": "Geth (clique) panicked when executing a transaction which contains `Random` opcode ",
  "user": {
    "login": "davidtaikocha",
    "id": 104078303,
    "node_id": "U_kgDOBjQb3w",
    "avatar_url": "https://avatars.githubusercontent.com/u/104078303?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/davidtaikocha",
    "html_url": "https://github.com/davidtaikocha",
    "followers_url": "https://api.github.com/users/davidtaikocha/followers",
    "following_url": "https://api.github.com/users/davidtaikocha/following{/other_user}",
    "gists_url": "https://api.github.com/users/davidtaikocha/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/davidtaikocha/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/davidtaikocha/subscriptions",
    "organizations_url": "https://api.github.com/users/davidtaikocha/orgs",
    "repos_url": "https://api.github.com/users/davidtaikocha/repos",
    "events_url": "https://api.github.com/users/davidtaikocha/events{/privacy}",
    "received_events_url": "https://api.github.com/users/davidtaikocha/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-04-04T18:08:23Z",
  "updated_at": "2023-04-05T09:46:36Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 1.11.5\r\n\r\n#### Expected behaviour\r\n\r\nNo panic when executing a transaction which contains `Random` opcode \r\n\r\n#### Actual behaviour\r\n\r\npanic: runtime error: invalid memory address or nil pointer dereference [signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0xc88ca7] goroutine 63 [running]: github.com/ethereum/go-ethereum/core/vm.opRandom(0xc00812cce8?, 0xc003cbf740?, 0xc003ced710) github.com/ethereum/go-ethereum/core/vm/instructions.go:480 +0x47 github.com/ethereum/go-ethereum/core/vm.(*EVMInterpreter).Run(0xc003cbf740, 0xc002ab03c0, {0xc003ca4900, 0x424, 0x480}, 0x0) github.com/ethereum/go-ethereum/core/vm/interpreter.go:228 +0x9f4 github.com/ethereum/go-ethereum/core/vm.(*EVM).DelegateCall(0xc0007417a0, {0x1c8a940, 0xc002ab0300?}, {0xb7, 0xf8, 0xbc, 0x63, 0xbb, 0xca, 0xd1, ...}, ...) github.com/ethereum/go-ethereum/core/vm/evm.go:336 +0x5de github.com/ethereum/go-ethereum/core/vm.opDelegateCall(0xc0007417a0?, 0xc003cbf740, 0xc003ced6f8) github.com/ethereum/go-ethereum/core/vm/instructions.go:752 +0x47f github.com/ethereum/go-ethereum/core/vm.(*EVMInterpreter).Run(0xc003cbf740, 0xc002ab0300, {0xc0011d7b00, 0x424, 0x424}, 0x0) github.com/ethereum/go-ethereum/core/vm/interpreter.go:228 +0x9f4 github.com/ethereum/go-ethereum/core/vm.(*EVM).Call(0xc0007417a0, {0x1c8e960, 0xc0033f4bb8}, {0xa5, 0x1c, 0x1f, 0xc2, 0xf0, 0xd1, 0xa1, ...}, ...) github.com/ethereum/go-ethereum/core/vm/evm.go:235 +0xb7e github.com/ethereum/go-ethereum/core.(*StateTransition).TransitionDb(0xc003d8af80) github.com/ethereum/go-ethereum/core/state_transition.go:375 +0x835 github.com/ethereum/go-ethereum/core.ApplyMessage(0x257?, 0x700?, 0xc003c9ae00?) github.com/ethereum/go-ethereum/core/state_transition.go:176 +0x5d github.com/ethereum/go-ethereum/core.applyTransaction(0xc00047f560, 0xc0000ed0a0, 0xbd220a?, 0xc003cefc00, 0xc003cf1be0, {0x66, 0x32, 0x6b, 0x32, 0xd0, ...}, ...) github.com/ethereum/go-ethereum/core/state_processor.go:106 +0x2d2 github.com/ethereum/go-ethereum/core.ApplyTransaction(0x62cad7?, {0x1c90130, 0xc000681800}, 0xc003cc4e20?, 0xc0006d8000?, 0xc007c87598?, 0xc002207d40, 0xc007c875f8?, 0x417230?, {0x0, ...}) github.com/ethereum/go-ethereum/core/state_processor.go:157 +0x235 github.com/ethereum/go-ethereum/miner.(*worker).commitTransaction(0xc00020e780?, 0xc003cdb680, 0xc003a9dce0) github.com/ethereum/go-ethereum/miner/worker.go:868 +0x1f8 github.com/ethereum/go-ethereum/miner.(*worker).commitTransactions(0xc00020e780, 0xc003cdb680, 0xc003afd180, 0xc00812cc00) github.com/ethereum/go-ethereum/miner/worker.go:919 +0x415 github.com/ethereum/go-ethereum/miner.(*worker).fillTransactions(0xc00020e780, 0xc007c87a00?, 0xc003cdb680) github.com/ethereum/go-ethereum/miner/worker.go:1083 +0x1c5 github.com/ethereum/go-ethereum/miner.(*worker).commitWork(0xc00020e780, 0xc007c87b84?, 0x1, 0x642c6429) github.com/ethereum/go-ethereum/miner/worker.go:1150 +0x1b4 github.com/ethereum/go-ethereum/miner.(*worker).mainLoop(0xc00020e780) github.com/ethereum/go-ethereum/miner/worker.go:574 +0x785 created by github.com/ethereum/go-ethereum/miner.newWorker github.com/ethereum/go-ethereum/miner/worker.go:326 +0x9ca\r\n\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n\r\n#### Backtrace\r\n\r\n````\r\n[backtrace]\r\n````\r\n\r\nWhen submitting logs: please submit them as text and not screenshots.\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27050/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27050/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1496513257",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27050#issuecomment-1496513257",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27050",
    "id": 1496513257,
    "node_id": "IC_kwDOAOvK985ZMvrp",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-04T19:53:26Z",
    "updated_at": "2023-04-04T19:53:26Z",
    "author_association": "MEMBER",
    "body": " Looks like we access context.Random without checking whether it is actually set https://github.com/ethereum/go-ethereum/blob/master/core/vm/instructions.go#L478.\r\nHowever this opcode should not be enabled on a clique network anyway. Did you enable the Shanghai hardfork in your chain config? Could you paste the chainconfig in the genesis.json you use?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1496513257/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1496830311",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27050#issuecomment-1496830311",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27050",
    "id": 1496830311,
    "node_id": "IC_kwDOAOvK985ZN9Fn",
    "user": {
      "login": "davidtaikocha",
      "id": 104078303,
      "node_id": "U_kgDOBjQb3w",
      "avatar_url": "https://avatars.githubusercontent.com/u/104078303?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davidtaikocha",
      "html_url": "https://github.com/davidtaikocha",
      "followers_url": "https://api.github.com/users/davidtaikocha/followers",
      "following_url": "https://api.github.com/users/davidtaikocha/following{/other_user}",
      "gists_url": "https://api.github.com/users/davidtaikocha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davidtaikocha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davidtaikocha/subscriptions",
      "organizations_url": "https://api.github.com/users/davidtaikocha/orgs",
      "repos_url": "https://api.github.com/users/davidtaikocha/repos",
      "events_url": "https://api.github.com/users/davidtaikocha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davidtaikocha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-05T02:20:53Z",
    "updated_at": "2023-04-05T02:21:13Z",
    "author_association": "NONE",
    "body": "@MariusVanDerWijden yep, Shanghai is enabled:\r\n```json\r\n\"config\": {\r\n    \"chainId\": 1337,\r\n    \"homesteadBlock\": 0,\r\n    \"eip150Block\": 0,\r\n    \"eip150Hash\": \"0x0000000000000000000000000000000000000000000000000000000000000000\",\r\n    \"eip155Block\": 0,\r\n    \"eip158Block\": 0,\r\n    \"byzantiumBlock\": 0,\r\n    \"constantinopleBlock\": 0,\r\n    \"petersburgBlock\": 0,\r\n    \"istanbulBlock\": 0,\r\n    \"muirGlacierBlock\": 0,\r\n    \"berlinBlock\": 0,\r\n    \"londonBlock\": 0,\r\n    \"arrowGlacierBlock\": 0,\r\n    \"grayGlacierBlock\": 0,\r\n    \"mergeNetsplitBlock\": 0,\r\n    \"shanghaiTime\": 0,\r\n    \"clique\": {\r\n      \"period\": 12,\r\n      \"epoch\": 30000\r\n    }\r\n  }\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1496830311/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1497211870",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27050#issuecomment-1497211870",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27050",
    "id": 1497211870,
    "node_id": "IC_kwDOAOvK985ZPaPe",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-05T09:46:36Z",
    "updated_at": "2023-04-05T09:46:36Z",
    "author_association": "MEMBER",
    "body": "Hmm you can not enable shanghai on a clique network. Shanghai defined the merge which is not supported under clique. We're currently working on a new implementation of clique, which might be able to use shanghai rules going forward, but that will take some time. For now you should scrap the network and set it up again without shanghaiTime set.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1497211870/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
