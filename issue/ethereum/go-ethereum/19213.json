{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19213",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19213/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19213/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19213/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/19213",
  "id": 417301541,
  "node_id": "MDU6SXNzdWU0MTczMDE1NDE=",
  "number": 19213,
  "title": "debug.setHead() does not persist across geth restarts",
  "user": {
    "login": "shoenseiwaso",
    "id": 5861379,
    "node_id": "MDQ6VXNlcjU4NjEzNzk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5861379?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/shoenseiwaso",
    "html_url": "https://github.com/shoenseiwaso",
    "followers_url": "https://api.github.com/users/shoenseiwaso/followers",
    "following_url": "https://api.github.com/users/shoenseiwaso/following{/other_user}",
    "gists_url": "https://api.github.com/users/shoenseiwaso/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/shoenseiwaso/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/shoenseiwaso/subscriptions",
    "organizations_url": "https://api.github.com/users/shoenseiwaso/orgs",
    "repos_url": "https://api.github.com/users/shoenseiwaso/repos",
    "events_url": "https://api.github.com/users/shoenseiwaso/events{/privacy}",
    "received_events_url": "https://api.github.com/users/shoenseiwaso/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2019-03-05T13:35:26Z",
  "updated_at": "2020-08-27T09:10:41Z",
  "closed_at": "2020-05-14T08:54:20Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth\r\nVersion: 1.8.22-stable\r\nArchitecture: amd64\r\nProtocol Versions: [63 62]\r\nNetwork Id: 1\r\nGo Version: go1.11.5\r\nOperating System: darwin\r\n\r\n#### Expected behaviour\r\n\r\n- Send some transactions up to block Y\r\n- `debug.setHead()` back to block X\r\n- Exit geth\r\n- Start geth\r\n- `eth.blockNumber` displays block X\r\n\r\n#### Actual behaviour\r\n\r\n- `eth.blockNumber` displays block Y\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n```\r\n$ geth --dev --datadir set_head_bug console\r\n> eth.blockNumber\r\n0\r\n> eth.sendTransaction({from: eth.accounts[0], to: eth.accounts[0], value: 1})\r\n> eth.sendTransaction({from: eth.accounts[0], to: eth.accounts[0], value: 1})\r\n> eth.blockNumber\r\n2\r\n> debug.setHead(\"0x1\")\r\nWARN [03-05|22:29:01.347] Rewinding blockchain                     target=1\r\nINFO [03-05|22:29:01.348] Loaded most recent local header          number=1 hash=6abfb1…1cb613 td=3 age=17s\r\nINFO [03-05|22:29:01.348] Loaded most recent local full block      number=1 hash=6abfb1…1cb613 td=3 age=17s\r\nINFO [03-05|22:29:01.348] Loaded most recent local fast block      number=1 hash=6abfb1…1cb613 td=3 age=17s\r\nnull\r\n> eth.blockNumber\r\n1\r\n> exit\r\n<snip>\r\nINFO [03-05|22:29:07.306] Blockchain manager stopped\r\nINFO [03-05|22:29:07.306] Stopping Ethereum protocol\r\nINFO [03-05|22:29:07.306] Ethereum protocol stopped\r\nINFO [03-05|22:29:07.306] Transaction pool stopped\r\nINFO [03-05|22:29:07.306] Database closed     <snip>\r\nINFO [03-05|22:29:07.306] whisper stopped\r\n$ geth --dev --datadir set_head_bug console\r\n<snip>\r\n> eth.blockNumber\r\n2\r\n```",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19213/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19213/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/628494804",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19213#issuecomment-628494804",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19213",
    "id": 628494804,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyODQ5NDgwNA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-14T08:54:20Z",
    "updated_at": "2020-05-14T08:54:20Z",
    "author_association": "MEMBER",
    "body": "This seems to work with the current release. I guess there might have been a bug a while back that was fixed since.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/628494804/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/628495191",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19213#issuecomment-628495191",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19213",
    "id": 628495191,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyODQ5NTE5MQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-14T08:54:58Z",
    "updated_at": "2020-05-14T08:54:58Z",
    "author_association": "MEMBER",
    "body": "```\r\n> eth.blockNumber\r\n2\r\n> debug.setHead(\"0x1\")\r\nWARN [05-14|11:53:45.405] Rewinding blockchain                     target=1\r\nINFO [05-14|11:53:45.409] Loaded most recent local header          number=1 hash=\"da5306…49e241\" td=3 age=19s\r\nINFO [05-14|11:53:45.409] Loaded most recent local full block      number=1 hash=\"da5306…49e241\" td=3 age=19s\r\nINFO [05-14|11:53:45.409] Loaded most recent local fast block      number=1 hash=\"da5306…49e241\" td=3 age=19s\r\nnull\r\n> eth.blockNumber\r\n1\r\n> INFO [05-14|11:53:50.637] IPC endpoint closed                      url=/tmp/wtf/geth.ipc\r\nINFO [05-14|11:53:50.637] Ethereum protocol stopped \r\nINFO [05-14|11:53:50.638] Transaction pool stopped \r\nINFO [05-14|11:53:50.638] Writing cached state to disk             block=1 hash=\"da5306…49e241\" root=\"2fe91d…f6fd8f\"\r\nINFO [05-14|11:53:50.638] Persisted trie from memory database      nodes=0  size=0.00B   time=\"7.394µs\"  gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B\r\nINFO [05-14|11:53:50.638] Blockchain stopped \r\nINFO [05-14|11:53:50.638] whisper stopped\r\n```\r\n\r\n```\r\n$ geth --dev --datadir /tmp/wtf console\r\nINFO [05-14|11:53:51.585] Starting Geth in ephemeral dev mode... \r\nINFO [05-14|11:53:51.586] Maximum peer count                       ETH=50 LES=0 total=50\r\nINFO [05-14|11:53:52.346] Using developer account                  address=0xbB28d9b6157AC330B708078658E5041D96CA0C22\r\nINFO [05-14|11:53:52.346] Starting peer-to-peer node               instance=Geth/v1.9.14-unstable/linux-amd64/go1.14.2\r\nINFO [05-14|11:53:52.346] Allocated trie memory caches             clean=256.00MiB dirty=256.00MiB\r\nINFO [05-14|11:53:52.346] Allocated cache and file handles         database=/tmp/wtf/geth/chaindata cache=512.00MiB handles=524288\r\nINFO [05-14|11:53:52.361] Opened ancient database                  database=/tmp/wtf/geth/chaindata/ancient\r\nINFO [05-14|11:53:52.362] Persisted trie from memory database      nodes=12 size=1.74KiB time=\"58.755µs\" gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B\r\nINFO [05-14|11:53:52.363] Initialised chain configuration          config=\"{ChainID: 1337 Homestead: 0 DAO: <nil> DAOSupport: false EIP150: 0 EIP155: 0 EIP158: 0 Byzantium: 0 Constantinople: 0 Petersburg: 0 Istanbul: 0, Muir Glacier: <nil>, Engine: clique}\"\r\nINFO [05-14|11:53:52.363] Initialising Ethereum protocol           versions=\"[65 64 63]\" network=1337 dbversion=7\r\nINFO [05-14|11:53:52.363] Loaded most recent local header          number=1 hash=\"da5306…49e241\" td=3 age=26s\r\nINFO [05-14|11:53:52.363] Loaded most recent local full block      number=1 hash=\"da5306…49e241\" td=3 age=26s\r\nINFO [05-14|11:53:52.363] Loaded most recent local fast block      number=1 hash=\"da5306…49e241\" td=3 age=26s\r\nINFO [05-14|11:53:52.364] Loaded local transaction journal         transactions=0 dropped=0\r\nINFO [05-14|11:53:52.364] Regenerated local transaction journal    transactions=0 accounts=0\r\nWARN [05-14|11:53:52.364] Switch sync mode from fast sync to full sync \r\nINFO [05-14|11:53:52.375] started whisper v.6.0 \r\nINFO [05-14|11:53:52.376] New local node record                    seq=3 id=8178492028488344 ip=127.0.0.1 udp=0 tcp=41175\r\nINFO [05-14|11:53:52.377] Started P2P networking                   self=\"enode://39544342b21d0a93857cfe1740634503a875c489f15d916501c7093c4bb68675bbb81b28ee9a10c2a80868e7f5f8c98207903f0f185f743cdd4969535e083cfd@127.0.0.1:41175?discport=0\"\r\nINFO [05-14|11:53:52.378] IPC endpoint opened                      url=/tmp/wtf/geth.ipc\r\nINFO [05-14|11:53:52.378] Transaction pool price threshold updated price=1000000000\r\nINFO [05-14|11:53:52.378] Transaction pool price threshold updated price=1\r\nINFO [05-14|11:53:52.378] Etherbase automatically configured       address=0xbB28d9b6157AC330B708078658E5041D96CA0C22\r\nINFO [05-14|11:53:52.378] Commit new mining work                   number=2 sealhash=\"2d8866…443570\" uncles=0 txs=0 gas=0 fees=0 elapsed=\"144.064µs\"\r\nINFO [05-14|11:53:52.379] Sealing paused, waiting for transactions \r\nWelcome to the Geth JavaScript console!\r\n\r\ninstance: Geth/v1.9.14-unstable/linux-amd64/go1.14.2\r\ncoinbase: 0xbb28d9b6157ac330b708078658e5041d96ca0c22\r\nat block: 1 (Thu May 14 2020 11:53:26 GMT+0300 (EEST))\r\n datadir: /tmp/wtf\r\n modules: admin:1.0 clique:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 shh:1.0 txpool:1.0 web3:1.0\r\n\r\n> eth.blockNumber\r\n1\r\n\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/628495191/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
