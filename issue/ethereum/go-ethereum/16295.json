{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16295",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16295/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16295/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16295/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/16295",
  "id": 304024836,
  "node_id": "MDU6SXNzdWUzMDQwMjQ4MzY=",
  "number": 16295,
  "title": "API Calls Returning Incorrect Results",
  "user": {
    "login": "the-jackalope",
    "id": 17994326,
    "node_id": "MDQ6VXNlcjE3OTk0MzI2",
    "avatar_url": "https://avatars.githubusercontent.com/u/17994326?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/the-jackalope",
    "html_url": "https://github.com/the-jackalope",
    "followers_url": "https://api.github.com/users/the-jackalope/followers",
    "following_url": "https://api.github.com/users/the-jackalope/following{/other_user}",
    "gists_url": "https://api.github.com/users/the-jackalope/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/the-jackalope/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/the-jackalope/subscriptions",
    "organizations_url": "https://api.github.com/users/the-jackalope/orgs",
    "repos_url": "https://api.github.com/users/the-jackalope/repos",
    "events_url": "https://api.github.com/users/the-jackalope/events{/privacy}",
    "received_events_url": "https://api.github.com/users/the-jackalope/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2018-03-10T00:54:06Z",
  "updated_at": "2018-04-05T00:53:01Z",
  "closed_at": "2018-03-10T17:11:39Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi there,\r\n\r\n#### Problem and steps to reproduce\r\n\r\nI'm having some trouble with the `ethclient.Client` not returning correct results from the network. When I try the same calls using `curl` I get the expected results.\r\n\r\n**Ex. 1: Querying balance from an address**\r\nIn go-ethereum:\r\n```go\r\napiKey := \"...\"\r\nconn, err := ethclient.Dial(\"https://mainnet.infura.io/\" + apiKey)\r\nout, err := conn.BalanceAt(context.Background(), common.StringToAddress(\"0xCdA03Cb85BA0e2bCBF6C7CaB1eA10203F6c30495\"), nil)\r\n\r\nfmt.Println(out.String()) // prints \"0\"\r\n```\r\nError handling is omitted for simplicity, but none of these methods error out. I'm not sure if it is worth mentioning that I am running this in a server goroutine, but since I haven't seen that listed as an issue anywhere I'm assuming it is not.\r\n\r\nThe result is incorrect as I can see from etherscan.io that the account has ether. Furthermore, when performing the query using JSON RPC:\r\n```bash\r\n$ curl -X POST -H \"Content-Type: application/json\" --data '{\"jsonrpc\":\"2.0\",\"method\":\"eth_getBalance\",\"params\":[\"0xCdA03Cb85BA0e2bCBF6C7CaB1eA10203F6c30495\", \"latest\"],\"id\":1}' https://mainnet.infura.io/$API_KEY\r\n\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":\"0x28d3cfae09e00\"}\r\n```\r\nI receive the correct result.\r\n\r\n**Ex. 1: Making a contract call**\r\nI'm using the [EOS contract](https://etherscan.io/token/EOS#readContract) as an example:\r\n```go\r\neosAddr := common.StringToAddress(\"0x86fa049857e0209aa7d9e616f7eb3b3b78ecfdb0\")\r\nconn, err := ethclient.Dial(\"https://mainnet.infura.io/\" + apiKey)\r\nparsedBytes, err := abi.JSON(strings.NewReader(tokenABI))\r\ncontract := bind.NewBoundContract(eosAddr, parsedBytes, conn, nil, nil)\r\n\r\nret := new([32]byte)\r\nerr := contract.Call(nil, ret, \"symbol\")\r\n// err message: \"no contract code at given address\"\r\n```\r\n\r\nWhereas with the JSON RPC:\r\n```bash\r\n$ curl -X POST -H \"Content-Type: application/json\" --data '{\"jsonrpc\":\"2.0\", \"method\":\"eth_call\", \"params\":[{\"to\": \"0x86fa049857e0209aa7d9e616f7eb3b3b78ecfdb0\", \"data\": \"0x95d89b410000000000000000000000000000000000000000000000000000000000000000\"}, \"latest\"], \"id\":1}' https://mainnet.infura.io/$API_KEY\r\n\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":\"0x454f530000000000000000000000000000000000000000000000000000000000\"}\r\n```\r\n\r\nAgain, the RPC returns the correct answer. When I use the geth API I seem to either receive no error, or incorrect error messages (seeing as a contract definitely exists at the address). Any results returned seem to be incorrect compared to the RPC. I'd love to know if I'm using the API incorrectly, or to help get to the bottom of this. Many thanks!\r\n\r\n\r\n#### System information\r\n\r\nGeth version: `1.8.2-stable`\r\nOS & Version: macOS High Sierra 10.13.13 ",
  "closed_by": {
    "login": "the-jackalope",
    "id": 17994326,
    "node_id": "MDQ6VXNlcjE3OTk0MzI2",
    "avatar_url": "https://avatars.githubusercontent.com/u/17994326?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/the-jackalope",
    "html_url": "https://github.com/the-jackalope",
    "followers_url": "https://api.github.com/users/the-jackalope/followers",
    "following_url": "https://api.github.com/users/the-jackalope/following{/other_user}",
    "gists_url": "https://api.github.com/users/the-jackalope/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/the-jackalope/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/the-jackalope/subscriptions",
    "organizations_url": "https://api.github.com/users/the-jackalope/orgs",
    "repos_url": "https://api.github.com/users/the-jackalope/repos",
    "events_url": "https://api.github.com/users/the-jackalope/events{/privacy}",
    "received_events_url": "https://api.github.com/users/the-jackalope/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16295/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16295/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/372027537",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16295#issuecomment-372027537",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16295",
    "id": 372027537,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MjAyNzUzNw==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-10T12:52:22Z",
    "updated_at": "2018-03-10T12:52:27Z",
    "author_association": "MEMBER",
    "body": "Use `common.HexToAddress` instead of `common.StringToAddress`. The latter just interprets your string as an address whereas the former actually converts a hex. Not sure why the latter even exists tbh.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/372027537/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/372045720",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16295#issuecomment-372045720",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16295",
    "id": 372045720,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3MjA0NTcyMA==",
    "user": {
      "login": "the-jackalope",
      "id": 17994326,
      "node_id": "MDQ6VXNlcjE3OTk0MzI2",
      "avatar_url": "https://avatars.githubusercontent.com/u/17994326?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/the-jackalope",
      "html_url": "https://github.com/the-jackalope",
      "followers_url": "https://api.github.com/users/the-jackalope/followers",
      "following_url": "https://api.github.com/users/the-jackalope/following{/other_user}",
      "gists_url": "https://api.github.com/users/the-jackalope/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/the-jackalope/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/the-jackalope/subscriptions",
      "organizations_url": "https://api.github.com/users/the-jackalope/orgs",
      "repos_url": "https://api.github.com/users/the-jackalope/repos",
      "events_url": "https://api.github.com/users/the-jackalope/events{/privacy}",
      "received_events_url": "https://api.github.com/users/the-jackalope/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-10T17:11:39Z",
    "updated_at": "2018-03-10T17:11:39Z",
    "author_association": "NONE",
    "body": "Oh my goodness that worked like magic! Thanks for the help, really appreciate it. I was scratching my head over here. I'll close this issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/372045720/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
