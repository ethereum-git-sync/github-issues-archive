{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16134",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16134/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16134/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16134/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/16134",
  "id": 298382469,
  "node_id": "MDU6SXNzdWUyOTgzODI0Njk=",
  "number": 16134,
  "title": "whisper: TTL protocol doesn't work without time synchronization",
  "user": {
    "login": "dshulyak",
    "id": 1964576,
    "node_id": "MDQ6VXNlcjE5NjQ1NzY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1964576?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dshulyak",
    "html_url": "https://github.com/dshulyak",
    "followers_url": "https://api.github.com/users/dshulyak/followers",
    "following_url": "https://api.github.com/users/dshulyak/following{/other_user}",
    "gists_url": "https://api.github.com/users/dshulyak/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dshulyak/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dshulyak/subscriptions",
    "organizations_url": "https://api.github.com/users/dshulyak/orgs",
    "repos_url": "https://api.github.com/users/dshulyak/repos",
    "events_url": "https://api.github.com/users/dshulyak/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dshulyak/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "gballet",
    "id": 3272758,
    "node_id": "MDQ6VXNlcjMyNzI3NTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3272758?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gballet",
    "html_url": "https://github.com/gballet",
    "followers_url": "https://api.github.com/users/gballet/followers",
    "following_url": "https://api.github.com/users/gballet/following{/other_user}",
    "gists_url": "https://api.github.com/users/gballet/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gballet/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gballet/subscriptions",
    "organizations_url": "https://api.github.com/users/gballet/orgs",
    "repos_url": "https://api.github.com/users/gballet/repos",
    "events_url": "https://api.github.com/users/gballet/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gballet/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "gballet",
      "id": 3272758,
      "node_id": "MDQ6VXNlcjMyNzI3NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3272758?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gballet",
      "html_url": "https://github.com/gballet",
      "followers_url": "https://api.github.com/users/gballet/followers",
      "following_url": "https://api.github.com/users/gballet/following{/other_user}",
      "gists_url": "https://api.github.com/users/gballet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gballet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gballet/subscriptions",
      "organizations_url": "https://api.github.com/users/gballet/orgs",
      "repos_url": "https://api.github.com/users/gballet/repos",
      "events_url": "https://api.github.com/users/gballet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gballet/received_events",
      "type": "User",
      "site_admin": false
    },
    {
      "login": "gluk256",
      "id": 9915581,
      "node_id": "MDQ6VXNlcjk5MTU1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9915581?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gluk256",
      "html_url": "https://github.com/gluk256",
      "followers_url": "https://api.github.com/users/gluk256/followers",
      "following_url": "https://api.github.com/users/gluk256/following{/other_user}",
      "gists_url": "https://api.github.com/users/gluk256/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gluk256/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gluk256/subscriptions",
      "organizations_url": "https://api.github.com/users/gluk256/orgs",
      "repos_url": "https://api.github.com/users/gluk256/repos",
      "events_url": "https://api.github.com/users/gluk256/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gluk256/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2018-02-19T19:39:02Z",
  "updated_at": "2018-03-21T12:47:36Z",
  "closed_at": "2018-03-21T12:47:36Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "We are running whisper protocol on mobile devices. Sometimes it is not possible to turn on time synchronization, and basically if significant time skew occurs whole applications becomes useless.\r\nI am very curious to know if there is a plan to re-implement TTL protocol without relying on a wall clock.\r\n\r\nOne naive approach that comes to my mind is to use TTL as a counter, a number of hops every envelope is allowed to travel, and to decrement this counter when each peer receives an envelope. This will require significant changes to a technique used for sealing envelopes though. \r\nHave you considered such approach?\r\n\r\n#### Expected behaviour\r\nEnvelopes are not discarded with significant (more than 10s) time desynchronization.\r\n\r\n#### Actual behaviour\r\nEnvelopes are discarded because of https://github.com/ethereum/go-ethereum/blob/master/whisper/whisperv6/whisper.go#L753-L767\r\n\r\ncc @gballet @gluk256 ",
  "closed_by": {
    "login": "dshulyak",
    "id": 1964576,
    "node_id": "MDQ6VXNlcjE5NjQ1NzY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1964576?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dshulyak",
    "html_url": "https://github.com/dshulyak",
    "followers_url": "https://api.github.com/users/dshulyak/followers",
    "following_url": "https://api.github.com/users/dshulyak/following{/other_user}",
    "gists_url": "https://api.github.com/users/dshulyak/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dshulyak/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dshulyak/subscriptions",
    "organizations_url": "https://api.github.com/users/dshulyak/orgs",
    "repos_url": "https://api.github.com/users/dshulyak/repos",
    "events_url": "https://api.github.com/users/dshulyak/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dshulyak/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16134/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16134/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/366961455",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16134#issuecomment-366961455",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16134",
    "id": 366961455,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2Njk2MTQ1NQ==",
    "user": {
      "login": "mandrigin",
      "id": 466427,
      "node_id": "MDQ6VXNlcjQ2NjQyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/466427?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mandrigin",
      "html_url": "https://github.com/mandrigin",
      "followers_url": "https://api.github.com/users/mandrigin/followers",
      "following_url": "https://api.github.com/users/mandrigin/following{/other_user}",
      "gists_url": "https://api.github.com/users/mandrigin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mandrigin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mandrigin/subscriptions",
      "organizations_url": "https://api.github.com/users/mandrigin/orgs",
      "repos_url": "https://api.github.com/users/mandrigin/repos",
      "events_url": "https://api.github.com/users/mandrigin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mandrigin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-20T12:24:35Z",
    "updated_at": "2018-02-20T12:24:35Z",
    "author_association": "NONE",
    "body": "One alternative we thought about is a relative time approach.\r\n\r\nInstead of keeping the absolute timestamp of when the envelope was created, we can make TTL counter relative to `now()` of the current node.\r\n\r\nTo do that, we create an envelope with a creation time and a TTL (e.g. 50 seconds), we enqueue it.\r\nJust before sending it to another peer via a socket, we subtract `now() - creation_time` from TTL, and write this value there.\r\nOn the receiving node, we update `creation_time` to `now()`. Again, just before sending, we subtract `now() - creation_time` from TTL.\r\n\r\nThat makes TTL to be smaller and smaller with each hop.\r\n\r\nWe can keep the logic of discarding messages as it is now.\r\n\r\n\r\n<img width=\"1187\" alt=\"img_0001\" src=\"https://user-images.githubusercontent.com/466427/36423723-4d40842a-1641-11e8-8ee1-0cc0db6c0d3e.PNG\">\r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/366961455/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/367366231",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16134#issuecomment-367366231",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16134",
    "id": 367366231,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NzM2NjIzMQ==",
    "user": {
      "login": "adambabik",
      "id": 277870,
      "node_id": "MDQ6VXNlcjI3Nzg3MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/277870?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adambabik",
      "html_url": "https://github.com/adambabik",
      "followers_url": "https://api.github.com/users/adambabik/followers",
      "following_url": "https://api.github.com/users/adambabik/following{/other_user}",
      "gists_url": "https://api.github.com/users/adambabik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adambabik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adambabik/subscriptions",
      "organizations_url": "https://api.github.com/users/adambabik/orgs",
      "repos_url": "https://api.github.com/users/adambabik/repos",
      "events_url": "https://api.github.com/users/adambabik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adambabik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-21T15:36:31Z",
    "updated_at": "2018-02-21T15:36:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "One potential issue that came to my mind. This solution requires changing envelope's data (TTL). Has it been checked whether Whisper envelopes have a signature or something like that which makes sure the content has not been altered during passing from sender to recipient? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/367366231/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/367605230",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16134#issuecomment-367605230",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16134",
    "id": 367605230,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NzYwNTIzMA==",
    "user": {
      "login": "dshulyak",
      "id": 1964576,
      "node_id": "MDQ6VXNlcjE5NjQ1NzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1964576?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dshulyak",
      "html_url": "https://github.com/dshulyak",
      "followers_url": "https://api.github.com/users/dshulyak/followers",
      "following_url": "https://api.github.com/users/dshulyak/following{/other_user}",
      "gists_url": "https://api.github.com/users/dshulyak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dshulyak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dshulyak/subscriptions",
      "organizations_url": "https://api.github.com/users/dshulyak/orgs",
      "repos_url": "https://api.github.com/users/dshulyak/repos",
      "events_url": "https://api.github.com/users/dshulyak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dshulyak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-22T08:37:17Z",
    "updated_at": "2018-02-22T08:37:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "It should be, otherwise, it would be really easy to spam the network. I thought there might be a way to leave TTL field mutable but protect from such thing differently, e.g blacklisting a peer who misbehaves",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/367605230/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/374879661",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16134#issuecomment-374879661",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16134",
    "id": 374879661,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NDg3OTY2MQ==",
    "user": {
      "login": "gluk256",
      "id": 9915581,
      "node_id": "MDQ6VXNlcjk5MTU1ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9915581?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gluk256",
      "html_url": "https://github.com/gluk256",
      "followers_url": "https://api.github.com/users/gluk256/followers",
      "following_url": "https://api.github.com/users/gluk256/following{/other_user}",
      "gists_url": "https://api.github.com/users/gluk256/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gluk256/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gluk256/subscriptions",
      "organizations_url": "https://api.github.com/users/gluk256/orgs",
      "repos_url": "https://api.github.com/users/gluk256/repos",
      "events_url": "https://api.github.com/users/gluk256/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gluk256/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-21T09:38:34Z",
    "updated_at": "2018-03-21T09:38:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "The message format is not going to change in v6.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/374879661/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/374924808",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16134#issuecomment-374924808",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16134",
    "id": 374924808,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NDkyNDgwOA==",
    "user": {
      "login": "dshulyak",
      "id": 1964576,
      "node_id": "MDQ6VXNlcjE5NjQ1NzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1964576?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dshulyak",
      "html_url": "https://github.com/dshulyak",
      "followers_url": "https://api.github.com/users/dshulyak/followers",
      "following_url": "https://api.github.com/users/dshulyak/following{/other_user}",
      "gists_url": "https://api.github.com/users/dshulyak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dshulyak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dshulyak/subscriptions",
      "organizations_url": "https://api.github.com/users/dshulyak/orgs",
      "repos_url": "https://api.github.com/users/dshulyak/repos",
      "events_url": "https://api.github.com/users/dshulyak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dshulyak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-21T12:47:36Z",
    "updated_at": "2018-03-21T12:47:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "I remember that we agreed that it is possible to use another source of time. I can close it upstream if it doesn't fit v6 roadmap. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/374924808/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
