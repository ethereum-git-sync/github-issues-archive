{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1038",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1038/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1038/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1038/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/1038",
  "id": 77981468,
  "node_id": "MDU6SXNzdWU3Nzk4MTQ2OA==",
  "number": 1038,
  "title": "eth_getFilterLogs takes ~15s and 100% CPU to get logs from block 0",
  "user": {
    "login": "frozeman",
    "id": 232662,
    "node_id": "MDQ6VXNlcjIzMjY2Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/232662?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/frozeman",
    "html_url": "https://github.com/frozeman",
    "followers_url": "https://api.github.com/users/frozeman/followers",
    "following_url": "https://api.github.com/users/frozeman/following{/other_user}",
    "gists_url": "https://api.github.com/users/frozeman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/frozeman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/frozeman/subscriptions",
    "organizations_url": "https://api.github.com/users/frozeman/orgs",
    "repos_url": "https://api.github.com/users/frozeman/repos",
    "events_url": "https://api.github.com/users/frozeman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/frozeman/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233652,
      "node_id": "MDU6TGFiZWw3MjIzMzY1Mg==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:feature",
      "name": "type:feature",
      "color": "84b6eb",
      "default": false,
      "description": null
    },
    {
      "id": 1157707837,
      "node_id": "MDU6TGFiZWwxMTU3NzA3ODM3",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/area:rpc",
      "name": "area:rpc",
      "color": "d4c5f9",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2015-05-19T07:52:47Z",
  "updated_at": "2018-12-14T14:24:35Z",
  "closed_at": "2016-02-16T11:24:39Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Getting past logs using a filter created like the following:\n\n```\n{\"jsonrpc\":\"2.0\",\"method\":\"eth_newFilter\",\"params\":[{\"topics\":[\"0xe1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109c\"],\"address\":\"0xbd999ac9af99055bdbc8b0fe564b64381513fa99\",\"fromBlock\":\"0x0\",\"toBlock\":\"latest\"}],\"id\":8}\n```\n\nTakes up to 15s and 100% CPU for all current 370 000 blocks to scan.\n\nIf a lot of dapps request filters like this its very likely that the node crashes or makes the computer unusable.\n\nWe need to look into ways of improving the performance here.\n",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1038/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1038/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/116354839",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1038#issuecomment-116354839",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1038",
    "id": 116354839,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNjM1NDgzOQ==",
    "user": {
      "login": "caktux",
      "id": 13692,
      "node_id": "MDQ6VXNlcjEzNjky",
      "avatar_url": "https://avatars.githubusercontent.com/u/13692?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/caktux",
      "html_url": "https://github.com/caktux",
      "followers_url": "https://api.github.com/users/caktux/followers",
      "following_url": "https://api.github.com/users/caktux/following{/other_user}",
      "gists_url": "https://api.github.com/users/caktux/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/caktux/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/caktux/subscriptions",
      "organizations_url": "https://api.github.com/users/caktux/orgs",
      "repos_url": "https://api.github.com/users/caktux/repos",
      "events_url": "https://api.github.com/users/caktux/events{/privacy}",
      "received_events_url": "https://api.github.com/users/caktux/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-28T22:16:11Z",
    "updated_at": "2015-06-28T22:16:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "I had to limit filtering events to a few hundred blocks (forget it with the current 700,000+ blocks with tx spam), and it still takes a few seconds for those calls, so a big +1 on better performance here\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/116354839/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/116511704",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1038#issuecomment-116511704",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1038",
    "id": 116511704,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNjUxMTcwNA==",
    "user": {
      "login": "tgerring",
      "id": 731472,
      "node_id": "MDQ6VXNlcjczMTQ3Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/731472?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tgerring",
      "html_url": "https://github.com/tgerring",
      "followers_url": "https://api.github.com/users/tgerring/followers",
      "following_url": "https://api.github.com/users/tgerring/following{/other_user}",
      "gists_url": "https://api.github.com/users/tgerring/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tgerring/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tgerring/subscriptions",
      "organizations_url": "https://api.github.com/users/tgerring/orgs",
      "repos_url": "https://api.github.com/users/tgerring/repos",
      "events_url": "https://api.github.com/users/tgerring/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tgerring/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-29T08:01:35Z",
    "updated_at": "2015-06-29T08:01:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "It's unlikely that we can get near-instant performance as you want, even with an explicit index on all the predicates. The way you're querying the data structure will naturally result in what the relational world calls a \"table scan\". These are always slow because the entire data structure has to be scanned form beginning to end. Traditionally, this is overcome with the creation of specific indexes to meet the type of predicates being requested.\n\nThis is further complicated by the fact that we're essentially using a key/value store, so we can't necessarily expect the same kind of performance we would from a relational search. Even if we had the structure normalised in to a relational database, we would have to manually create indexes for the most common types of queries, which results in a degradation of write performance (due to needing to update al the indexes). We could build something like thing in a KV store, of course, but it's unlikely that we'd build it to cover all use cases of \"earliest to latest\" and people would STILL run into scanning behaviour.\n\nWhat is the use case of fetching all historical logs that can't be met by scanning the last epoch or so?\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/116511704/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/116528969",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1038#issuecomment-116528969",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1038",
    "id": 116528969,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNjUyODk2OQ==",
    "user": {
      "login": "caktux",
      "id": 13692,
      "node_id": "MDQ6VXNlcjEzNjky",
      "avatar_url": "https://avatars.githubusercontent.com/u/13692?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/caktux",
      "html_url": "https://github.com/caktux",
      "followers_url": "https://api.github.com/users/caktux/followers",
      "following_url": "https://api.github.com/users/caktux/following{/other_user}",
      "gists_url": "https://api.github.com/users/caktux/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/caktux/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/caktux/subscriptions",
      "organizations_url": "https://api.github.com/users/caktux/orgs",
      "repos_url": "https://api.github.com/users/caktux/repos",
      "events_url": "https://api.github.com/users/caktux/events{/privacy}",
      "received_events_url": "https://api.github.com/users/caktux/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-29T08:46:19Z",
    "updated_at": "2015-06-29T08:46:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "If scanning the last epoch can be done relatively well, that'd be perfect. This is for historical price data and listing specific transactions data. As it stands I have to limit this to a 1 hour range (300 blocks or so), filtering on indexed event data only, but from what you're saying I doubt those indexes are currently optimized; there could be some gains to be made there.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/116528969/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/116532239",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1038#issuecomment-116532239",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1038",
    "id": 116532239,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNjUzMjIzOQ==",
    "user": {
      "login": "frozeman",
      "id": 232662,
      "node_id": "MDQ6VXNlcjIzMjY2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/232662?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frozeman",
      "html_url": "https://github.com/frozeman",
      "followers_url": "https://api.github.com/users/frozeman/followers",
      "following_url": "https://api.github.com/users/frozeman/following{/other_user}",
      "gists_url": "https://api.github.com/users/frozeman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frozeman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frozeman/subscriptions",
      "organizations_url": "https://api.github.com/users/frozeman/orgs",
      "repos_url": "https://api.github.com/users/frozeman/repos",
      "events_url": "https://api.github.com/users/frozeman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frozeman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-29T08:51:52Z",
    "updated_at": "2015-06-29T08:51:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "When you start a dapp for the second time on another computer, or restore e.g. a wallet contract from a backup, you want to get all past transactions, which would require a full scan.\n\nIf we would index the logs by address, which created the log, we would are lady minify the to scanlable documents to a fraction of the whole chain.\n\nMost logs are anyway filtered by specifying an address, only in som rare cases you filter only by topics, without and address.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/116532239/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/116545942",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1038#issuecomment-116545942",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1038",
    "id": 116545942,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNjU0NTk0Mg==",
    "user": {
      "login": "tgerring",
      "id": 731472,
      "node_id": "MDQ6VXNlcjczMTQ3Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/731472?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tgerring",
      "html_url": "https://github.com/tgerring",
      "followers_url": "https://api.github.com/users/tgerring/followers",
      "following_url": "https://api.github.com/users/tgerring/following{/other_user}",
      "gists_url": "https://api.github.com/users/tgerring/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tgerring/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tgerring/subscriptions",
      "organizations_url": "https://api.github.com/users/tgerring/orgs",
      "repos_url": "https://api.github.com/users/tgerring/repos",
      "events_url": "https://api.github.com/users/tgerring/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tgerring/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-29T09:07:12Z",
    "updated_at": "2015-06-29T09:07:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "> If we would index the logs by address\n\nThis is a tricky proposition. If we create a data structure that allows the lookup of log by address, do we have any link back from the log to the generating transaction or block? In general, I think we need to take a hard look at what explicit references we should store to make lookup from child structure to parent structure easier.\n\nCurrently, in the \"extradb\", we store full context for a transaction (i.e. tx index) or receipt (i.e. bloom), but this is actually unnecessary if we store smartly-indexed references since the data can be quickly looked up in near-real-time with leveldb's range queries.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/116545942/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/158897431",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1038#issuecomment-158897431",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1038",
    "id": 158897431,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE1ODg5NzQzMQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-11-23T10:22:31Z",
    "updated_at": "2015-11-23T10:22:31Z",
    "author_association": "MEMBER",
    "body": "@obscuren This was sorted out by the log mipmaps right? If so, please close.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/158897431/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
