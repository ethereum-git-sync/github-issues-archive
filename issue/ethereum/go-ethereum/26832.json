{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26832",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26832/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26832/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26832/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/26832",
  "id": 1615439524,
  "node_id": "I_kwDOAOvK985gSaak",
  "number": 26832,
  "title": "clef: Programatically create new accounts and store their password in the Clef vault",
  "user": {
    "login": "roosemberth",
    "id": 3621083,
    "node_id": "MDQ6VXNlcjM2MjEwODM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3621083?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/roosemberth",
    "html_url": "https://github.com/roosemberth",
    "followers_url": "https://api.github.com/users/roosemberth/followers",
    "following_url": "https://api.github.com/users/roosemberth/following{/other_user}",
    "gists_url": "https://api.github.com/users/roosemberth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/roosemberth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/roosemberth/subscriptions",
    "organizations_url": "https://api.github.com/users/roosemberth/orgs",
    "repos_url": "https://api.github.com/users/roosemberth/repos",
    "events_url": "https://api.github.com/users/roosemberth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/roosemberth/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 268304226,
      "node_id": "MDU6TGFiZWwyNjgzMDQyMjY=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:docs",
      "name": "type:docs",
      "color": "fef2c0",
      "default": false,
      "description": null
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-03-08T15:11:52Z",
  "updated_at": "2023-03-08T15:18:16Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I'm not sure whether this may be a bug or a feature request; I'm looking to move away from `personal_*` methods in geth's RPC to using clef. My use-case is as follows:\r\n\r\n- I create a new eth account using `personal_newAccount`. A different password is generated for each account.\r\n- Funds are sent to the address of the generated account.\r\n- At some moment, I decide this account will no-longer receive funds.\r\n- I send all of the account funds to some fixed address.\r\n\r\nThis procedure is completely non-interactive.\r\n\r\nI'm now migrating to clef. After reading the clef documentation, I understand the following needs to happen:\r\n\r\n- Use the `account_new` RPC method to generate new eth accounts.\r\n- Create a rule file, enroll it using `clef attest ...`, which approves calls to `account_new` and `account_signTransaction` adequately.\r\n- For every new account, call `clef setpw ${account address}` to store the account password in the Clef vault.\r\n\r\n\r\nWhat is unclear to me is the following:\r\n\r\n- How do I programatically provide the account password?\r\n\r\n  From what I gather, I need to write a wrapper application that launches clef with `--stdio-ui`, and provides a password upon `ui_onInputRequired` when the message contains `Please enter a password for the new account to be created`. This seems rather brittle and from what I understand unsupported.\r\n\r\n- How do I avoid race-conditions between storing the password and an RPC requiring access to the account password? This is currently unlikely since funds are typically collected a couple minutes after the account is created, but I can imagine this procedure envolving to require signing some data using the new account before funds are received.\r\n\r\nAn alternative would be for me not needing to generate and provide a password for as long as the credentials were automatically added to the Clef vault. I did not see this in the documentation, so I assume this is not possible. Moreover, it's unclear whether a filesystem snapshot is sufficient to backup the Clef vault.\r\n\r\nBonus question:\r\n\r\n- How do I remove no-longer used accounts? After collecting all funds in the account there's no reason to keep the account around. There seems to be no methods to remove ~~credentials from the Clef vault nor~~ accounts from Clef itself. (Edit: `clef delpw` removes credentials from the Clef vault).",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26832/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26832/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
