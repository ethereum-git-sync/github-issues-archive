{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3326",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3326/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3326/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3326/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/3326",
  "id": 191195547,
  "node_id": "MDU6SXNzdWUxOTExOTU1NDc=",
  "number": 3326,
  "title": "cannot connect to static/trusted peers with --maxpeers 0",
  "user": {
    "login": "iciakky",
    "id": 13136516,
    "node_id": "MDQ6VXNlcjEzMTM2NTE2",
    "avatar_url": "https://avatars.githubusercontent.com/u/13136516?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/iciakky",
    "html_url": "https://github.com/iciakky",
    "followers_url": "https://api.github.com/users/iciakky/followers",
    "following_url": "https://api.github.com/users/iciakky/following{/other_user}",
    "gists_url": "https://api.github.com/users/iciakky/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/iciakky/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/iciakky/subscriptions",
    "organizations_url": "https://api.github.com/users/iciakky/orgs",
    "repos_url": "https://api.github.com/users/iciakky/repos",
    "events_url": "https://api.github.com/users/iciakky/events{/privacy}",
    "received_events_url": "https://api.github.com/users/iciakky/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2016-11-23T06:14:16Z",
  "updated_at": "2018-02-27T10:52:59Z",
  "closed_at": "2018-02-27T10:52:59Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 1.5.2+ (from master)\r\nOS & Version: Windows 10\r\n\r\n#### Expected behaviour\r\n\r\nwhen set --maxpeer 0, only the trusted/static peers can connect\r\n\r\n#### Actual behaviour\r\n\r\nwhen set --maxpeer 0, even trusted/static peers can NOT connect\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n1. prepare static-nodes.js with one static node N you can connect to\r\n2. run geth with --maxpeers 1 --nodiscover\r\n3. make sure you can connect to N\r\n4. restart geth with --maxpeers 0 --nodiscover --verbosity 6\r\n5. you will see that N is removed from peers right after it's added, for \"too many peers!\"\r\nit could be caused by light clinet/server mode's implementation,\r\nwhich limit connections only by maxpeers in protocol manager/handler.\r\n\r\nbesides, there is a race condition for the maxpeers check in protocol manager/handler. \r\nyou can connect to more then one static nodes even with static-nodes.js and --maxpeers 1,\r\nbut you can not further add more static nodes with admin.addPeer(). \r\n(It will be removed for \"too many peers!\")\r\n\r\n#### Partial output of geth\r\n\r\nnotice that what have been done to peer ceabe1b1b4fa9c88\r\n````\r\nI1122 16:17:14.634244 p2p/server.go:466] new task: static dial ceabe1b1b4fa9c88 163.172.189.38:8080\r\nI1122 16:17:15.363159 p2p/server.go:524] <-posthandshake: trusted static dial conn ceabe1b1b4fa9c88 163.172.189.38:8080\r\nI1122 16:17:15.365165 p2p/server.go:530] <-addpeer: trusted static dial conn ceabe1b1b4fa9c88 163.172.189.38:8080\r\nI1122 16:17:15.366168 p2p/server.go:722] Added Peer ceabe1b1b4fa9c88 163.172.189.38:8080\r\nI1122 16:17:15.366168 p2p/server.go:514] <-taskdone: static dial ceabe1b1b4fa9c88 163.172.189.38:8080\r\nI1122 16:17:15.370183 p2p/peer.go:301] Peer ceabe1b1b4fa9c88 163.172.189.38:8080: Starting protocol eth/63\r\nI1122 16:17:15.372188 p2p/peer.go:308] Peer ceabe1b1b4fa9c88 163.172.189.38:8080: Protocol eth/63 error: Too many peers\r\nI1122 16:17:15.377213 p2p/peer.go:177] Peer ceabe1b1b4fa9c88 163.172.189.38:8080: protocol error: Too many peers (Too many peers)\r\nI1122 16:21:12.601907 p2p/server.go:738] Removed Peer ceabe1b1b4fa9c88 163.172.189.38:8080 (Too many peers)\r\nI1122 16:21:12.601907 p2p/server.go:546] <-delpeer: Peer ceabe1b1b4fa9c88 163.172.189.38:8080\r\n````\r\n",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3326/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3326/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/263506255",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/3326#issuecomment-263506255",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3326",
    "id": 263506255,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MzUwNjI1NQ==",
    "user": {
      "login": "coeniebeyers",
      "id": 5429884,
      "node_id": "MDQ6VXNlcjU0Mjk4ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5429884?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coeniebeyers",
      "html_url": "https://github.com/coeniebeyers",
      "followers_url": "https://api.github.com/users/coeniebeyers/followers",
      "following_url": "https://api.github.com/users/coeniebeyers/following{/other_user}",
      "gists_url": "https://api.github.com/users/coeniebeyers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/coeniebeyers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/coeniebeyers/subscriptions",
      "organizations_url": "https://api.github.com/users/coeniebeyers/orgs",
      "repos_url": "https://api.github.com/users/coeniebeyers/repos",
      "events_url": "https://api.github.com/users/coeniebeyers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/coeniebeyers/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-29T08:25:36Z",
    "updated_at": "2016-11-29T08:25:36Z",
    "author_association": "NONE",
    "body": "I confirm this behaviour on geth 1.5.3, on geth 1.4.9, 1.4.10 and 1.4.11 the expected behaviour is still working correctly.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/263506255/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/265994609",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/3326#issuecomment-265994609",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3326",
    "id": 265994609,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2NTk5NDYwOQ==",
    "user": {
      "login": "coeniebeyers",
      "id": 5429884,
      "node_id": "MDQ6VXNlcjU0Mjk4ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5429884?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coeniebeyers",
      "html_url": "https://github.com/coeniebeyers",
      "followers_url": "https://api.github.com/users/coeniebeyers/followers",
      "following_url": "https://api.github.com/users/coeniebeyers/following{/other_user}",
      "gists_url": "https://api.github.com/users/coeniebeyers/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/coeniebeyers/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/coeniebeyers/subscriptions",
      "organizations_url": "https://api.github.com/users/coeniebeyers/orgs",
      "repos_url": "https://api.github.com/users/coeniebeyers/repos",
      "events_url": "https://api.github.com/users/coeniebeyers/events{/privacy}",
      "received_events_url": "https://api.github.com/users/coeniebeyers/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-12-09T11:39:11Z",
    "updated_at": "2016-12-09T11:39:11Z",
    "author_association": "NONE",
    "body": "Any update on this? Parity explicitly allows this:\r\n\r\n--reserved-peers FILE    Provide a file containing enodes, one per line.\r\n                          These nodes will always have a reserved slot on top\r\n                          of the normal maximum peers. (default: None)\r\n --reserved-only          Connect only to reserved nodes. (default: false)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/265994609/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
