{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18255",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18255/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18255/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18255/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/18255",
  "id": 388491902,
  "node_id": "MDU6SXNzdWUzODg0OTE5MDI=",
  "number": 18255,
  "title": "The swarm http api cannot binding itself to the IPv4 0.0.0.0 adapter",
  "user": {
    "login": "justinmchase",
    "id": 10974,
    "node_id": "MDQ6VXNlcjEwOTc0",
    "avatar_url": "https://avatars.githubusercontent.com/u/10974?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/justinmchase",
    "html_url": "https://github.com/justinmchase",
    "followers_url": "https://api.github.com/users/justinmchase/followers",
    "following_url": "https://api.github.com/users/justinmchase/following{/other_user}",
    "gists_url": "https://api.github.com/users/justinmchase/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/justinmchase/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/justinmchase/subscriptions",
    "organizations_url": "https://api.github.com/users/justinmchase/orgs",
    "repos_url": "https://api.github.com/users/justinmchase/repos",
    "events_url": "https://api.github.com/users/justinmchase/events{/privacy}",
    "received_events_url": "https://api.github.com/users/justinmchase/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2018-12-07T03:31:37Z",
  "updated_at": "2018-12-08T16:47:31Z",
  "closed_at": "2018-12-08T16:47:31Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version:\r\n```sh\r\n# geth version\r\nGeth\r\nVersion: 1.8.19-stable\r\nGit Commit: dae82f098570e15d44584f0d7f350713f4774727\r\nArchitecture: amd64\r\nProtocol Versions: [63 62]\r\nNetwork Id: 1\r\nGo Version: go1.10.4\r\nOperating System: linux\r\nGOPATH=\r\nGOROOT=/usr/lib/go-1.10\r\n```\r\nOS & Version: Linux (ubuntu)\r\n\r\n#### Expected behaviour\r\nI am able to access the http api from the host machine when running swarm from within a docker container.\r\n\r\ne.g.\r\n```\r\n# curl http://localhost:8500\r\nCode: 200\r\nMessage: Swarm: Please request a valid ENS or swarm hash with the appropriate bzz scheme\r\nTimestamp: Fri, 07 Dec 2018 03:10:47 UTC\r\n```\r\n\r\n#### Actual behaviour\r\n```\r\n# curl http://localhost:8500\r\ncurl: (7) Failed to connect to localhost port 8500: Connection refused\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\n1. Install Docker\r\n2. Create the files below in a folder\r\n3. On host machine run:\r\n```sh\r\n# terminal 1\r\ndocker-compose run gateway\r\n\r\n# terminal 2\r\ncurl http://localhost:8500\r\n```\r\n\r\n**File Structure:**\r\n```\r\n/ ─┐\r\n   ├─ Dockerfile\r\n   ├─ docker-compose.yml\r\n   └─ run.sh\r\n```\r\n\r\n**Dockerfile**\r\n```dockerfile\r\nFROM ubuntu:18.04\r\n\r\nRUN apt-get update && \\\r\n    apt-get install -y \\\r\n      vim \\\r\n      lsof \\\r\n      curl \\\r\n      golang-go \\\r\n      software-properties-common\r\n\r\nRUN add-apt-repository -y ppa:ethereum/ethereum\r\nRUN apt-get update\r\nRUN apt-get install -y \\\r\n    ethereum \\\r\n    ethereum-swarm\r\n\r\nWORKDIR /root\r\nCOPY run.sh run.sh\r\n\r\nEXPOSE 8500\r\nEXPOSE 30399\r\nENTRYPOINT [ \"sh\", \"-c\" ]\r\nCMD [ \"./run.sh\" ]\r\n```\r\n\r\n**run.sh**\r\n```sh\r\n#!/bin/bash\r\nACCOUNT=\r\nPASSWORD=\r\n\r\n# If no account exists, then create one.\r\nif [ ! -f .ethereum/.account ]; then\r\n  echo \"creating account...\"\r\n  if [ ! -f .ethereum/.password ]; then\r\n    echo \"creating password...\"\r\n    PASSWORD=$(cat /dev/urandom | tr -dc 'a-zA-Z0-9' | fold -w 32 | head -n 1)\r\n    echo $PASSWORD > .ethereum/.password\r\n  fi\r\n\r\n  ACCOUNT=$(geth account new --password=.ethereum/.password | sed -e \"s/.*{//\" -e \"s/}//\")\r\n  echo $ACCOUNT > .ethereum/.account\r\nelse\r\n  PASSWORD=$(cat .ethereum/.password)\r\n  ACCOUNT=$(cat .ethereum/.account)\r\nfi\r\n\r\necho \"pass: $PASSWORD\"\r\necho \"acct: $ACCOUNT\"\r\n\r\nswarm \\\r\n  --bzzaccount $ACCOUNT \\\r\n  --password .ethereum/.password \\\r\n  --bzzapi 0.0.0.0 \\\r\n  --httpaddr 0.0.0.0 \\\r\n  --lightnode \r\n\r\n```\r\n\r\n**docker-compose.yml**\r\n```yml\r\nversion: \"3\"\r\nservices:\r\n  gateway:\r\n    build: .\r\n    volumes:\r\n      - \"$PWD/.data/gateway:/root/.ethereum\"\r\n    ports:\r\n      - \"8500:8500\"\r\n      - \"30399:30399\"\r\n```\r\n\r\n#### Clues\r\n* If you run `curl http://localhost:8500` from _within_ the container, then it does work. It can connect to its own loop back in that case.\r\n* If you run `lsof -i TCP` from within the container you see this curious line:\r\n```\r\nswarm    42 root   31u  IPv6 3733193      0t0  TCP *:8500 (LISTEN)\r\n```\r\nWhen I would expect it to be this give that I am setting `--httpaddr 0.0.0.0`\r\n```\r\nswarm    42 root   31u  IPv4 3733193      0t0  TCP 0.0.0.0:8500 (LISTEN)\r\n```",
  "closed_by": {
    "login": "justinmchase",
    "id": 10974,
    "node_id": "MDQ6VXNlcjEwOTc0",
    "avatar_url": "https://avatars.githubusercontent.com/u/10974?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/justinmchase",
    "html_url": "https://github.com/justinmchase",
    "followers_url": "https://api.github.com/users/justinmchase/followers",
    "following_url": "https://api.github.com/users/justinmchase/following{/other_user}",
    "gists_url": "https://api.github.com/users/justinmchase/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/justinmchase/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/justinmchase/subscriptions",
    "organizations_url": "https://api.github.com/users/justinmchase/orgs",
    "repos_url": "https://api.github.com/users/justinmchase/repos",
    "events_url": "https://api.github.com/users/justinmchase/events{/privacy}",
    "received_events_url": "https://api.github.com/users/justinmchase/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18255/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18255/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/445472504",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18255#issuecomment-445472504",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18255",
    "id": 445472504,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NTQ3MjUwNA==",
    "user": {
      "login": "justinmchase",
      "id": 10974,
      "node_id": "MDQ6VXNlcjEwOTc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/10974?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/justinmchase",
      "html_url": "https://github.com/justinmchase",
      "followers_url": "https://api.github.com/users/justinmchase/followers",
      "following_url": "https://api.github.com/users/justinmchase/following{/other_user}",
      "gists_url": "https://api.github.com/users/justinmchase/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/justinmchase/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/justinmchase/subscriptions",
      "organizations_url": "https://api.github.com/users/justinmchase/orgs",
      "repos_url": "https://api.github.com/users/justinmchase/repos",
      "events_url": "https://api.github.com/users/justinmchase/events{/privacy}",
      "received_events_url": "https://api.github.com/users/justinmchase/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-12-08T16:47:31Z",
    "updated_at": "2018-12-08T16:47:31Z",
    "author_association": "NONE",
    "body": "I got it to work, not sure why it wasn't working before because I barely changed anything but here is what I have now and it is working:\r\n```\r\nswarm \\\r\n  --bzzaccount $ACCOUNT \\\r\n  --password .ethereum/.password \\\r\n  --httpaddr \"0.0.0.0\" \\\r\n  --lightnode \r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/445472504/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
