{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16762",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16762/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16762/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16762/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/16762",
  "id": 324692731,
  "node_id": "MDU6SXNzdWUzMjQ2OTI3MzE=",
  "number": 16762,
  "title": "[Android] Transaction call resulting in lack of gas error (\"insufficient funds for [..]\")",
  "user": {
    "login": "therealdannzor",
    "id": 35889839,
    "node_id": "MDQ6VXNlcjM1ODg5ODM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/35889839?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/therealdannzor",
    "html_url": "https://github.com/therealdannzor",
    "followers_url": "https://api.github.com/users/therealdannzor/followers",
    "following_url": "https://api.github.com/users/therealdannzor/following{/other_user}",
    "gists_url": "https://api.github.com/users/therealdannzor/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/therealdannzor/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/therealdannzor/subscriptions",
    "organizations_url": "https://api.github.com/users/therealdannzor/orgs",
    "repos_url": "https://api.github.com/users/therealdannzor/repos",
    "events_url": "https://api.github.com/users/therealdannzor/events{/privacy}",
    "received_events_url": "https://api.github.com/users/therealdannzor/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1132689577,
      "node_id": "MDU6TGFiZWwxMTMyNjg5NTc3",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:triage",
      "name": "status:triage",
      "color": "6be514",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "zsfelfoldi",
    "id": 9884311,
    "node_id": "MDQ6VXNlcjk4ODQzMTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9884311?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zsfelfoldi",
    "html_url": "https://github.com/zsfelfoldi",
    "followers_url": "https://api.github.com/users/zsfelfoldi/followers",
    "following_url": "https://api.github.com/users/zsfelfoldi/following{/other_user}",
    "gists_url": "https://api.github.com/users/zsfelfoldi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zsfelfoldi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zsfelfoldi/subscriptions",
    "organizations_url": "https://api.github.com/users/zsfelfoldi/orgs",
    "repos_url": "https://api.github.com/users/zsfelfoldi/repos",
    "events_url": "https://api.github.com/users/zsfelfoldi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zsfelfoldi/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "zsfelfoldi",
      "id": 9884311,
      "node_id": "MDQ6VXNlcjk4ODQzMTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9884311?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zsfelfoldi",
      "html_url": "https://github.com/zsfelfoldi",
      "followers_url": "https://api.github.com/users/zsfelfoldi/followers",
      "following_url": "https://api.github.com/users/zsfelfoldi/following{/other_user}",
      "gists_url": "https://api.github.com/users/zsfelfoldi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zsfelfoldi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zsfelfoldi/subscriptions",
      "organizations_url": "https://api.github.com/users/zsfelfoldi/orgs",
      "repos_url": "https://api.github.com/users/zsfelfoldi/repos",
      "events_url": "https://api.github.com/users/zsfelfoldi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zsfelfoldi/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2018-05-20T08:28:44Z",
  "updated_at": "2019-11-21T09:52:37Z",
  "closed_at": "2019-11-21T09:52:37Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi there,\r\n\r\nWith an Android client, I'm trying to send a transaction call to a (payable) contract to manipulate a **private blockchain** (light mode enabled). Ordinary calls to get information works as intended but it in this case when gas is involved, it just does not work. I have been struggling with this specific part for a week now, with many tries.\r\n\r\nAlso, somewhat related is that I for a month or so back managed to make a call that consumed gas (and thus I thought I had this issue resolved), but seems I cannot manage to replicate that. Unsure if it is a version thing or not. As of now, none of my transactions consume any gas. \r\n\r\n**Note 1)**: not trying to transfer funds between accounts\r\n**Note 2)**: calling the function from the geth server works without any issue\r\n\r\n#### System information\r\n\r\nGeth version: `1.8.8-stable`\r\nServer OS & Version: `macOS High Sierra 10.13.4`\r\nClient device & OS: `Galaxy S6, OS: 7.0`\r\nAndroid Studio version: `3.1.2`\r\nNetwork: `LAN`\r\n\r\n#### Expected behaviour\r\nA successful transaction, gas consumed for changing the temporary state of the blockchain, and to observe a token created at the address in question (public address of android device).\r\n\r\n#### Actual behaviour\r\n`go.Universe$proxyerror: insufficient funds for gas * price + value`\r\n\r\n#### Steps to reproduce the behaviour\r\n1. Continuation of my previous issue #16420 (Wallet creation) with the same flags (and the standard procedure of starting private chain, adding light peer, and mining)\r\n```\r\ngeth --datadir <path> --networkid <number_1> --port <number_2> --maxpeers 10 --rpcaddr 0.0.0.0 --rpc --rpcport <number_3> --targetgaslimit <very_high_number> -gasprice <high_number> --lightserv 50  --rpcapi personal,db,eth,net,web3 console\r\n```\r\n\r\n2. The standard mintable token function I'm attempting to call, after deploying it to the blockchain and subsequently adding the ABI and the contract address to my mobile application\r\n```\r\n    function pureSecretMint(string _str) public payable {\r\n        MintableToken.mint(msg.sender, 1);\r\n    }\r\n```\r\n\r\n3. When calling the function through `boundContract.transact(..)`, observe the error\r\n\r\n![180520_txfailgas](https://user-images.githubusercontent.com/35889839/40276762-bcee77c0-5c12-11e8-950c-67ab3b21a95f.png)\r\n\r\n\r\n#### Backtrace\r\n\r\n````\r\nE/GoLog: INFO [05-20|08:01:14] Imported new block headers               count=1  elapsed=124.996ms number=905 hash=5d2e4d…f46b75 ignored=0\r\nW/System.err: go.Universe$proxyerror: insufficient funds for gas * price + value\r\nW/System.err: at org.ethereum.geth.BoundContract.transact(Native Method)\r\nW/System.err: at com.example.gitdannzor.lightclient.MainActivity$1.onNewHead(MainActivity.java:208) \r\nE/GoLog: INFO [05-20|08:01:17] Imported new block headers               count=1  elapsed=30.723ms  number=906 hash=7cd0a2…139e39 ignored=0\r\n````\r\n\r\n**An observation that confirms that there is enough balance**\r\n\r\nThe price seems to have increased however from what I set it to be. Then I guess the binary search algorithm works for finding a price.\r\n```\r\nD/Android:: tx.getGasPrice(): 18000000000, tx.getGas(): 70000000, tx.getCost(): 1260000000000000000\r\nbalance = {BigInt@5384} = 6400000000000000000000\r\n```\r\nDespite not a being value transaction, I have also confirmed that `tx.getValue(): 0`. Thus, in theory we can conclude that\r\n```\r\ngas * price + value < balance\r\n``` \r\n#### Different attempts to solve the problem\r\n1) Omit setting `DEFAULT_GAS_PRICE` and `DEFAULT_GAS_LIMIT` at all (and hope it calculates suitable gas by itself), but then I received the error `go.Universe$proxyerror: failed to estimate gas needed: gas required exceeds allowance or always failing transaction`. Discussed this issue briefly with @mcdee.\r\n\r\n2) Set `DEFAULT_GAS_PRICE.setString(\"0\", 10)`, resulting in a new error `Known transaction (abc123)`.\r\n\r\n3) Just omit setting `DEFAULT_GAS_PRICE`. Same error as original thread start.\r\n\r\n4) Adjusting the `DEFAULT_GAS_PRICE`, from 1 to *large number* in varying steps and sizes. Still same error.\r\n\r\n5) Create new blockchains with varying gas prices and target gas limits. Same error.\r\n\r\n6) Making sure that the chain ID is the same as the network ID (and not zero), as well as instead of `chainId` explicitly write `chainID` in the genesis. Same error.\r\n\r\n7) Try other ways of signing the transaction (https://github.com/ethereum/go-ethereum/wiki/Mobile:-Account-management) from section \"Signing on Android (Java)\" and unlocking the account in varying ways (temporarily/permanent unlocks). Same error.\r\n\r\n8) Naively tried with a `callOpts`, instead of `transactOpts`, and as a parameter used a string `{from: pubaddr, gas: 2500000}`, emulating the web3. Of course failed due to incorrect amount of parameters.\r\n\r\n9) Try to fill the account with a significant balance (> 10,000 ETH), just to see if the error message goes away. \r\n\r\n10) For science, I tried to both alter the file **../core/tx_pool.go** and compile the library with `make android` to see if it was a mismatch with the `Cmp` function (which can return -1,0, or 1 depending on max{x,y}). It skips that error but instead shows `Known transaction`.",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16762/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16762/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/390485902",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16762#issuecomment-390485902",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16762",
    "id": 390485902,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MDQ4NTkwMg==",
    "user": {
      "login": "therealdannzor",
      "id": 35889839,
      "node_id": "MDQ6VXNlcjM1ODg5ODM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/35889839?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/therealdannzor",
      "html_url": "https://github.com/therealdannzor",
      "followers_url": "https://api.github.com/users/therealdannzor/followers",
      "following_url": "https://api.github.com/users/therealdannzor/following{/other_user}",
      "gists_url": "https://api.github.com/users/therealdannzor/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/therealdannzor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/therealdannzor/subscriptions",
      "organizations_url": "https://api.github.com/users/therealdannzor/orgs",
      "repos_url": "https://api.github.com/users/therealdannzor/repos",
      "events_url": "https://api.github.com/users/therealdannzor/events{/privacy}",
      "received_events_url": "https://api.github.com/users/therealdannzor/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-20T14:13:08Z",
    "updated_at": "2018-05-22T20:36:37Z",
    "author_association": "NONE",
    "body": "I find point 10) above very strange. It exists both in /core/tx_pool and /light/tx_pool and `pool.currentState.getBalance(from)` doesn't seem to be greater than `tx.Cost()`, or the corresponding evaluation in the light client `currentState.GetBalance(from)`.\r\n```\r\n\t// Transactor should have enough funds to cover the costs\r\n\t// cost == V + GP * GL\r\n\tif pool.currentState.GetBalance(from).Cmp(tx.Cost()) < 0 {\r\n\t\treturn ErrInsufficientFunds\r\n\t}\r\n```\r\n```\r\n\t // Transactor should have enough funds to cover the costs\r\n\t cost == V + GP * GL\r\n\t if b := currentState.GetBalance(from); b.Cmp(tx.Cost()) < 0 {\r\n\t\treturn core.ErrInsufficientFunds\r\n\t}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/390485902/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/394068477",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16762#issuecomment-394068477",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16762",
    "id": 394068477,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NDA2ODQ3Nw==",
    "user": {
      "login": "therealdannzor",
      "id": 35889839,
      "node_id": "MDQ6VXNlcjM1ODg5ODM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/35889839?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/therealdannzor",
      "html_url": "https://github.com/therealdannzor",
      "followers_url": "https://api.github.com/users/therealdannzor/followers",
      "following_url": "https://api.github.com/users/therealdannzor/following{/other_user}",
      "gists_url": "https://api.github.com/users/therealdannzor/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/therealdannzor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/therealdannzor/subscriptions",
      "organizations_url": "https://api.github.com/users/therealdannzor/orgs",
      "repos_url": "https://api.github.com/users/therealdannzor/repos",
      "events_url": "https://api.github.com/users/therealdannzor/events{/privacy}",
      "received_events_url": "https://api.github.com/users/therealdannzor/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-02T08:07:44Z",
    "updated_at": "2018-06-02T08:07:44Z",
    "author_association": "NONE",
    "body": "Still an issue on `1.8.11-SNAPSHOT`.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/394068477/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/481875955",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16762#issuecomment-481875955",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16762",
    "id": 481875955,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MTg3NTk1NQ==",
    "user": {
      "login": "mizo2go",
      "id": 43551152,
      "node_id": "MDQ6VXNlcjQzNTUxMTUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/43551152?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mizo2go",
      "html_url": "https://github.com/mizo2go",
      "followers_url": "https://api.github.com/users/mizo2go/followers",
      "following_url": "https://api.github.com/users/mizo2go/following{/other_user}",
      "gists_url": "https://api.github.com/users/mizo2go/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mizo2go/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mizo2go/subscriptions",
      "organizations_url": "https://api.github.com/users/mizo2go/orgs",
      "repos_url": "https://api.github.com/users/mizo2go/repos",
      "events_url": "https://api.github.com/users/mizo2go/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mizo2go/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-10T21:37:38Z",
    "updated_at": "2019-04-10T21:37:38Z",
    "author_association": "NONE",
    "body": "hi @therealdannzor , i have the same problem. Have you found the solution for it? Thanks in advance :)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/481875955/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/482696443",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16762#issuecomment-482696443",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16762",
    "id": 482696443,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MjY5NjQ0Mw==",
    "user": {
      "login": "therealdannzor",
      "id": 35889839,
      "node_id": "MDQ6VXNlcjM1ODg5ODM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/35889839?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/therealdannzor",
      "html_url": "https://github.com/therealdannzor",
      "followers_url": "https://api.github.com/users/therealdannzor/followers",
      "following_url": "https://api.github.com/users/therealdannzor/following{/other_user}",
      "gists_url": "https://api.github.com/users/therealdannzor/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/therealdannzor/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/therealdannzor/subscriptions",
      "organizations_url": "https://api.github.com/users/therealdannzor/orgs",
      "repos_url": "https://api.github.com/users/therealdannzor/repos",
      "events_url": "https://api.github.com/users/therealdannzor/events{/privacy}",
      "received_events_url": "https://api.github.com/users/therealdannzor/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-12T19:33:27Z",
    "updated_at": "2019-04-12T19:33:27Z",
    "author_association": "NONE",
    "body": "Hi @mizo2go, it's been a while since I touched this project but before authorising the transaction with _setSigner_ I added something like\r\n```\r\nlong nonceTransaction = ec.getNonceAt(Geth.newContext(), firstAccount.getAddress(), -1);\r\ntransactOpts.setNonce(nonceTransaction);\r\n```\r\nHaven't worked with the new Geth versions within this domain since my last post. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/482696443/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/557006758",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16762#issuecomment-557006758",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16762",
    "id": 557006758,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NzAwNjc1OA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-21T09:52:37Z",
    "updated_at": "2019-11-21T09:52:37Z",
    "author_association": "MEMBER",
    "body": "One thing you can do, if you're recompiling anyway, is to modify the error message to spit out more detailed information. Instead of `ErrInsufficientFunds`, make it \r\n```golang\r\nreturn fmt.Errorf(\"Insufficient balance, cost: %v, balance %v\", tx.Cost(), currentState.GetBalance(from))\r\n```\r\nor something to that effect. \r\n\r\nSince this issue is rather old (sorry about not answering sooner), I'll close this for now. Feel free to open a new issue if this seems to still be happening ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/557006758/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
