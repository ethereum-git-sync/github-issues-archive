{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20172",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20172/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20172/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20172/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/20172",
  "id": 507587532,
  "node_id": "MDU6SXNzdWU1MDc1ODc1MzI=",
  "number": 20172,
  "title": "Memory Leak? during transaction decoding",
  "user": {
    "login": "james-ray",
    "id": 26137182,
    "node_id": "MDQ6VXNlcjI2MTM3MTgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/26137182?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/james-ray",
    "html_url": "https://github.com/james-ray",
    "followers_url": "https://api.github.com/users/james-ray/followers",
    "following_url": "https://api.github.com/users/james-ray/following{/other_user}",
    "gists_url": "https://api.github.com/users/james-ray/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/james-ray/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/james-ray/subscriptions",
    "organizations_url": "https://api.github.com/users/james-ray/orgs",
    "repos_url": "https://api.github.com/users/james-ray/repos",
    "events_url": "https://api.github.com/users/james-ray/events{/privacy}",
    "received_events_url": "https://api.github.com/users/james-ray/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 9,
  "created_at": "2019-10-16T03:17:37Z",
  "updated_at": "2019-10-16T11:46:38Z",
  "closed_at": "2019-10-16T11:46:38Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Entering interactive mode (type \"help\" for commands, \"o\" for options)\r\n(pprof) top20\r\nShowing nodes accounting for 1114.87MB, 93.85% of 1187.94MB total\r\nDropped 166 nodes (cum <= 5.94MB)\r\nShowing top 20 nodes out of 174\r\n      flat  flat%   sum%        cum   cum%\r\n  259.53MB 21.85% 21.85%   259.53MB 21.85%  reflect.New\r\n  244.01MB 20.54% 42.39%   477.02MB 40.16%  github.com/ethereum/go-ethereum/rlp.decodeBigInt\r\n  217.01MB 18.27% 60.66%   217.01MB 18.27%  math/big.nat.make\r\n     192MB 16.16% 76.82%      192MB 16.16%  github.com/ethereum/go-ethereum/vendor/github.com/syndtr/goleveldb/leveldb/memdb.New\r\n   40.50MB  3.41% 80.23%    40.50MB  3.41%  github.com/ethereum/go-ethereum/rlp.(*Stream).Bytes\r\n   20.01MB  1.68% 81.91%    20.01MB  1.68%  github.com/tendermint/tendermint/vendor/github.com/syndtr/goleveldb/leveldb/memdb.New\r\n   16.93MB  1.43% 83.34%    16.93MB  1.43%  bytes.makeSlice\r\n   15.33MB  1.29% 84.63%    15.33MB  1.29%  fmt.(*fmt).fmtSbx\r\n   15.27MB  1.29% 85.91%    15.27MB  1.29%  github.com/ethereum/go-ethereum/eth/filters.(*EventSystem).eventLoop\r\n   13.20MB  1.11% 87.02%    13.70MB  1.15%  github.com/ethereum/go-ethereum/core/types.(*Block).WithBody\r\n   12.50MB  1.05% 88.08%   553.52MB 46.60%  github.com/ethereum/go-ethereum/core/types.(*Transaction).DecodeRLP\r\n      11MB  0.93% 89.00%       13MB  1.09%  github.com/tendermint/tendermint/libs/clist.(*CList).PushBack\r\n   10.96MB  0.92% 89.92%    18.20MB  1.53%  sync.(*Map).Store\r\n    9.73MB  0.82% 90.74%     9.73MB  0.82%  github.com/tendermint/go-amino.DecodeByteSlice\r\n    8.04MB  0.68% 91.42%     8.04MB  0.68%  github.com/tendermint/tendermint/vendor/github.com/syndtr/goleveldb/leveldb/util.(*BufferPool).Get\r\n       7MB  0.59% 92.01%    21.50MB  1.81%  github.com/ethereum/go-ethereum/core/types.(*Transaction).WithSignature\r\n    6.62MB  0.56% 92.57%     6.62MB  0.56%  github.com/green-element-chain/gelchain/ethereum.(*Backend).InsertCachedTxFrom\r\n    6.24MB  0.53% 93.09%     6.24MB  0.53%  sync.(*Map).dirtyLocked\r\n    4.50MB  0.38% 93.47%    36.20MB  3.05%  github.com/tendermint/tendermint/mempool.(*CListMempool).resCbFirstTime\r\n    4.50MB  0.38% 93.85%        8MB  0.67%  github.com/ethereum/go-ethereum/core/state.(*stateObject).SetBalance\r\n\r\n\r\nOur application is based on ethermint and Tendermint, we are doing performance test lately. We found the memory used for big.int decoding continuously rising.\r\nAny hint about this?",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20172/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20172/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542501269",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20172#issuecomment-542501269",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20172",
    "id": 542501269,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjUwMTI2OQ==",
    "user": {
      "login": "james-ray",
      "id": 26137182,
      "node_id": "MDQ6VXNlcjI2MTM3MTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/26137182?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/james-ray",
      "html_url": "https://github.com/james-ray",
      "followers_url": "https://api.github.com/users/james-ray/followers",
      "following_url": "https://api.github.com/users/james-ray/following{/other_user}",
      "gists_url": "https://api.github.com/users/james-ray/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/james-ray/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/james-ray/subscriptions",
      "organizations_url": "https://api.github.com/users/james-ray/orgs",
      "repos_url": "https://api.github.com/users/james-ray/repos",
      "events_url": "https://api.github.com/users/james-ray/events{/privacy}",
      "received_events_url": "https://api.github.com/users/james-ray/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-16T03:55:58Z",
    "updated_at": "2019-10-16T03:55:58Z",
    "author_association": "NONE",
    "body": "Time: Oct 16, 2019 at 11:54am (CST)\r\nEntering interactive mode (type \"help\" for commands, \"o\" for options)\r\n(pprof) top20\r\nShowing nodes accounting for 2030.17MB, 94.28% of 2153.44MB total\r\nDropped 285 nodes (cum <= 10.77MB)\r\nShowing top 20 nodes out of 140\r\n      flat  flat%   sum%        cum   cum%\r\n  545.56MB 25.33% 25.33%   545.56MB 25.33%  reflect.New\r\n  524.02MB 24.33% 49.67%  1039.04MB 48.25%  github.com/ethereum/go-ethereum/rlp.decodeBigInt\r\n  468.03MB 21.73% 71.40%   468.03MB 21.73%  math/big.nat.make\r\n     192MB  8.92% 80.32%      192MB  8.92%  github.com/ethereum/go-ethereum/vendor/github.com/syndtr/goleveldb/leveldb/memdb.New\r\n      83MB  3.85% 84.17%       83MB  3.85%  github.com/ethereum/go-ethereum/rlp.(*Stream).Bytes\r\n      30MB  1.39% 85.57%  1202.05MB 55.82%  github.com/ethereum/go-ethereum/core/types.(*Transaction).DecodeRLP\r\n   27.07MB  1.26% 86.82%    27.07MB  1.26%  github.com/ethereum/go-ethereum/core/types.(*Block).WithBody\r\n   21.72MB  1.01% 87.83%    59.57MB  2.77%  github.com/ethereum/go-ethereum/core/vm.NewEVM\r\n   20.71MB  0.96% 88.79%    37.85MB  1.76%  github.com/ethereum/go-ethereum/core/vm.NewInterpreter\r\n   20.01MB  0.93% 89.72%    20.01MB  0.93%  github.com/tendermint/tendermint/vendor/github.com/syndtr/goleveldb/leveldb/memdb.New\r\n   17.13MB   0.8% 90.52%    17.13MB   0.8%  github.com/ethereum/go-ethereum/core/vm.newstack\r\n   15.27MB  0.71% 91.23%    15.27MB  0.71%  github.com/ethereum/go-ethereum/eth/filters.(*EventSystem).eventLoop\r\n   12.29MB  0.57% 91.80%    12.29MB  0.57%  github.com/tendermint/tendermint/vendor/github.com/syndtr/goleveldb/leveldb/util.(*BufferPool).Get\r\n   12.01MB  0.56% 92.36%    12.01MB  0.56%  github.com/ethereum/go-ethereum/crypto/sha3.(*state).clone\r\n      12MB  0.56% 92.91%       12MB  0.56%  github.com/tendermint/tendermint/libs/clist.(*CList).PushBack\r\n   10.84MB   0.5% 93.42%    10.84MB   0.5%  github.com/ethereum/go-ethereum/vendor/github.com/syndtr/goleveldb/leveldb/memdb.(*DB).Put\r\n       7MB  0.33% 93.74%   111.08MB  5.16%  github.com/tendermint/tendermint/abci/client.(*localClient).DeliverTxAsync\r\n    5.50MB  0.26% 94.00%    14.07MB  0.65%  sync.(*Map).Store\r\n       4MB  0.19% 94.18%       11MB  0.51%  github.com/ethereum/go-ethereum/core/types.(*Transaction).WithSignature\r\n       2MB 0.093% 94.28%    30.07MB  1.40%  github.com/tendermint/tendermint/mempool.(*CListMempool).resCbFirstTime\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542501269/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542539179",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20172#issuecomment-542539179",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20172",
    "id": 542539179,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjUzOTE3OQ==",
    "user": {
      "login": "james-ray",
      "id": 26137182,
      "node_id": "MDQ6VXNlcjI2MTM3MTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/26137182?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/james-ray",
      "html_url": "https://github.com/james-ray",
      "followers_url": "https://api.github.com/users/james-ray/followers",
      "following_url": "https://api.github.com/users/james-ray/following{/other_user}",
      "gists_url": "https://api.github.com/users/james-ray/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/james-ray/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/james-ray/subscriptions",
      "organizations_url": "https://api.github.com/users/james-ray/orgs",
      "repos_url": "https://api.github.com/users/james-ray/repos",
      "events_url": "https://api.github.com/users/james-ray/events{/privacy}",
      "received_events_url": "https://api.github.com/users/james-ray/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-16T06:20:40Z",
    "updated_at": "2019-10-16T06:20:40Z",
    "author_association": "NONE",
    "body": "Type: inuse_space\r\nTime: Oct 16, 2019 at 2:20pm (CST)\r\nEntering interactive mode (type \"help\" for commands, \"o\" for options)\r\n(pprof) top20\r\nShowing nodes accounting for 2959.73MB, 94.31% of 3138.16MB total\r\nDropped 314 nodes (cum <= 15.69MB)\r\nShowing top 20 nodes out of 109\r\n      flat  flat%   sum%        cum   cum%\r\n  816.60MB 26.02% 26.02%   816.60MB 26.02%  reflect.New\r\n  778.52MB 24.81% 50.83%  1566.56MB 49.92%  github.com/ethereum/go-ethereum/rlp.decodeBigInt\r\n  723.54MB 23.06% 73.89%   723.54MB 23.06%  math/big.nat.make\r\n     192MB  6.12% 80.00%      192MB  6.12%  github.com/ethereum/go-ethereum/vendor/github.com/syndtr/goleveldb/leveldb/memdb.New\r\n  119.50MB  3.81% 83.81%   119.50MB  3.81%  github.com/ethereum/go-ethereum/rlp.(*Stream).Bytes\r\n   60.62MB  1.93% 85.74%   160.04MB  5.10%  github.com/ethereum/go-ethereum/core/vm.NewEVM\r\n   60.62MB  1.93% 87.68%    98.92MB  3.15%  github.com/ethereum/go-ethereum/core/vm.NewInterpreter\r\n      43MB  1.37% 89.05%  1800.57MB 57.38%  github.com/ethereum/go-ethereum/core/types.(*Transaction).DecodeRLP\r\n   38.29MB  1.22% 90.27%    38.29MB  1.22%  github.com/ethereum/go-ethereum/core/vm.newstack\r\n   37.54MB  1.20% 91.46%    37.54MB  1.20%  github.com/ethereum/go-ethereum/core/types.(*Block).WithBody\r\n   20.51MB  0.65% 92.12%    20.51MB  0.65%  github.com/ethereum/go-ethereum/crypto/sha3.(*state).clone\r\n   17.01MB  0.54% 92.66%    17.01MB  0.54%  github.com/ethereum/go-ethereum/trie.(*fullNode).copy\r\n   16.50MB  0.53% 93.18%    26.42MB  0.84%  sync.(*Map).Store\r\n   16.01MB  0.51% 93.69%    16.01MB  0.51%  github.com/tendermint/tendermint/vendor/github.com/syndtr/goleveldb/leveldb/memdb.New\r\n       4MB  0.13% 93.82%    48.42MB  1.54%  github.com/tendermint/tendermint/mempool.(*CListMempool).resCbFirstTime\r\n       4MB  0.13% 93.95%    26.01MB  0.83%  github.com/ethereum/go-ethereum/common.Address.Hex\r\n    3.50MB  0.11% 94.06%    27.41MB  0.87%  github.com/tendermint/tendermint/mempool.(*CListMempool).addTx\r\n       3MB 0.096% 94.16%   272.57MB  8.69%  github.com/tendermint/tendermint/abci/client.(*localClient).DeliverTxAsync\r\n       3MB 0.096% 94.25%    23.51MB  0.75%  github.com/ethereum/go-ethereum/crypto/sha3.(*state).Sum\r\n    1.96MB 0.062% 94.31%    44.88MB  1.43%  github.com/green-element-chain/gelchain/ethereum.(*Backend).txBroadcastLoop\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542539179/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542568751",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20172#issuecomment-542568751",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20172",
    "id": 542568751,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjU2ODc1MQ==",
    "user": {
      "login": "fnaticwang",
      "id": 13617589,
      "node_id": "MDQ6VXNlcjEzNjE3NTg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/13617589?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fnaticwang",
      "html_url": "https://github.com/fnaticwang",
      "followers_url": "https://api.github.com/users/fnaticwang/followers",
      "following_url": "https://api.github.com/users/fnaticwang/following{/other_user}",
      "gists_url": "https://api.github.com/users/fnaticwang/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fnaticwang/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fnaticwang/subscriptions",
      "organizations_url": "https://api.github.com/users/fnaticwang/orgs",
      "repos_url": "https://api.github.com/users/fnaticwang/repos",
      "events_url": "https://api.github.com/users/fnaticwang/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fnaticwang/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-16T07:42:49Z",
    "updated_at": "2019-10-16T07:42:49Z",
    "author_association": "NONE",
    "body": "advertent",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542568751/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542593775",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20172#issuecomment-542593775",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20172",
    "id": 542593775,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjU5Mzc3NQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-16T08:42:19Z",
    "updated_at": "2019-10-16T08:42:19Z",
    "author_association": "MEMBER",
    "body": "Hard to say anything about this. IIUC, the data above shows where the memory was allocated, not who holds the memory. Meaning, that although a lot of data was allocated during the `rlp` decoding of e..g transactions, the cause of holding on to memory might be within the transaction pool. It seems that you're using tendermint, which has it's own txpool. \r\n\r\nThat txpool stores transactions in a synced map: https://github.com/tendermint/tendermint/blob/master/mempool/clist_mempool.go#L340 , and I'm not sure if it get's cleaned up properly. \r\n\r\nYou might want to open this ticket with tendermint instead, we have refactored our txpool quite a lot and it's very different from theirs.   ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542593775/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542599833",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20172#issuecomment-542599833",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20172",
    "id": 542599833,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjU5OTgzMw==",
    "user": {
      "login": "james-ray",
      "id": 26137182,
      "node_id": "MDQ6VXNlcjI2MTM3MTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/26137182?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/james-ray",
      "html_url": "https://github.com/james-ray",
      "followers_url": "https://api.github.com/users/james-ray/followers",
      "following_url": "https://api.github.com/users/james-ray/following{/other_user}",
      "gists_url": "https://api.github.com/users/james-ray/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/james-ray/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/james-ray/subscriptions",
      "organizations_url": "https://api.github.com/users/james-ray/orgs",
      "repos_url": "https://api.github.com/users/james-ray/repos",
      "events_url": "https://api.github.com/users/james-ray/events{/privacy}",
      "received_events_url": "https://api.github.com/users/james-ray/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-16T08:55:57Z",
    "updated_at": "2019-10-16T09:49:23Z",
    "author_association": "NONE",
    "body": "Originally I doubt that map too, below was the original pprof heap result:\r\n\r\n> \r\nEntering interactive mode (type \"help\" for commands, \"o\" for options)\r\n(pprof) top30\r\nShowing nodes accounting for 2956.49MB, 96.83% of 3053.21MB total\r\nDropped 221 nodes (cum <= 15.27MB)\r\nShowing top 30 nodes out of 94\r\nflat flat% sum% cum cum%\r\n455.04MB 14.90% 14.90% 575MB 18.83% sync.(*Map).Store\r\n405.05MB 13.27% 28.17% 405.05MB 13.27% reflect.New\r\n368.51MB 12.07% 40.24% 763.03MB 24.99% github.com/ethereum/go-ethereum/rlp.decodeBigInt\r\n367.52MB 12.04% 52.28% 367.52MB 12.04% math/big.nat.make\r\n347.53MB 11.38% 63.66% 378.53MB 12.40% github.com/tendermint/tendermint/libs/clist.(*CList).PushBack\r\n195.52MB 6.40% 70.06% 195.52MB 6.40% github.com/ethereum/go-ethereum/rlp.(*encbuf).toBytes\r\n192MB 6.29% 76.35% 192MB 6.29% github.com/ethereum/go-ethereum/vendor/github.com/syndtr/goleveldb/leveldb/memdb.New\r\n168.52MB 5.52% 81.87% 198.02MB 6.49% github.com/tendermint/tendermint/libs/clist.(*CElement).SetPrev\r\n153.01MB 5.01% 86.88% 1108.04MB 36.29% github.com/tendermint/tendermint/mempool.(*CListMempool).resCbFirstTime\r\n102.46MB 3.36% 90.24% 102.46MB 3.36% sync.(*Map).dirtyLocked\r\n60.50MB 1.98% 92.22% 60.50MB 1.98% github.com/tendermint/tendermint/libs/clist.waitGroup1\r\n59MB 1.93% 94.15% 59MB 1.93% github.com/ethereum/go-ethereum/rlp.(*Stream).Bytes\r\n20.32MB 0.67% 94.82% 20.82MB 0.68% github.com/ethereum/go-ethereum/core/types.(*Block).WithBody\r\n20MB 0.66% 95.47% 877.53MB 28.74% github.com/ethereum/go-ethereum/core/types.(*Transaction).DecodeRLP\r\n17.50MB 0.57% 96.05% 17.50MB 0.57% sync.newEntry\r\n16.01MB 0.52% 96.57% 16.01MB 0.52% github.com/tendermint/tendermint/vendor/github.com/syndtr/goleveldb/leveldb/memdb.New\r\n6.50MB 0.21% 96.78% 18MB 0.59% github.com/ethereum/go-ethereum/core/types.(*Transaction).WithSignature\r\n1.50MB 0.049% 96.83% 387.45MB 12.69% github.com/tendermint/tendermint/mempool.(*CListMempool).addTx\r\n0 0% 96.83% 18MB 0.59% github.com/ethereum/go-ethereum/accounts/keystore.(*KeyStore).SignTx\r\n0 0% 96.83% 18MB 0.59% github.com/ethereum/go-ethereum/accounts/keystore.(*keystoreWallet).SignTx\r\n0 0% 96.83% 1223.90MB 40.09% github.com/ethereum/go-ethereum/core.(*BlockChain).GetBlock\r\n0 0% 96.83% 1223.90MB 40.09% github.com/ethereum/go-ethereum/core.(*BlockChain).GetBlockByNumber\r\n0 0% 96.83% 196.77MB 6.44% github.com/ethereum/go-ethereum/core.(*BlockChain).WriteBlockWithState\r\n0 0% 96.83% 1223.90MB 40.09% github.com/ethereum/go-ethereum/core.GetBlock\r\n0 0% 96.83% 1203.08MB 39.40% github.com/ethereum/go-ethereum/core.GetBody\r\n0 0% 96.83% 18MB 0.59% github.com/ethereum/go-ethereum/core/types.SignTx\r\n0 0% 96.83% 1223.90MB 40.09% github.com/ethereum/go-ethereum/eth.(*EthApiBackend).BlockByNumber\r\n0 0% 96.83% 1223.90MB 40.09% github.com/ethereum/go-ethereum/eth/gasprice.(*Oracle).getBlockPrices\r\n0 0% 96.83% 193.10MB 6.32% github.com/ethereum/go-ethereum/ethdb.(*ldbBatch).Write\r\n0 0% 96.83% 33.08MB 1.08% github.com/ethereum/go-ethereum/internal/ethapi.(*PublicTransactionPoolAPI).SendTransaction\r\n\r\n> \r\n\r\n\r\nBut later I found some of our codes that iterate the txlist in the memPool sleeps for a long time without set nil to the iterated element, so I modified them. After the modification, the pprof result turned as shown in this issue. We can see the allocation in this line:\r\n16.50MB  0.53% 93.18%    26.42MB  0.84%  sync.(*Map).Store    \r\nhas dropped.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542599833/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542604552",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20172#issuecomment-542604552",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20172",
    "id": 542604552,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjYwNDU1Mg==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-16T09:06:35Z",
    "updated_at": "2019-10-16T09:07:05Z",
    "author_association": "MEMBER",
    "body": "It might be better to run @fjl 's memory tool https://github.com/fjl/memsize to figure out not only where it's allocated, but who holds on to the memory. @fjl, can you provide some info on how to use it? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542604552/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542605066",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20172#issuecomment-542605066",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20172",
    "id": 542605066,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjYwNTA2Ng==",
    "user": {
      "login": "james-ray",
      "id": 26137182,
      "node_id": "MDQ6VXNlcjI2MTM3MTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/26137182?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/james-ray",
      "html_url": "https://github.com/james-ray",
      "followers_url": "https://api.github.com/users/james-ray/followers",
      "following_url": "https://api.github.com/users/james-ray/following{/other_user}",
      "gists_url": "https://api.github.com/users/james-ray/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/james-ray/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/james-ray/subscriptions",
      "organizations_url": "https://api.github.com/users/james-ray/orgs",
      "repos_url": "https://api.github.com/users/james-ray/repos",
      "events_url": "https://api.github.com/users/james-ray/events{/privacy}",
      "received_events_url": "https://api.github.com/users/james-ray/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-16T09:07:48Z",
    "updated_at": "2019-10-16T09:43:51Z",
    "author_association": "NONE",
    "body": "1:\r\n```\r\n0: 0 [3: 48] @ 0x5682a3 0x568142 0x5b3a1e 0x5b39eb 0x5c0af3 0x5b912e 0x6ff39f 0x11e8a58 0x11e4358 0x10283f2 0x10330f1 0x1037dc7 0x10379e9 0x103f53a 0x103e845 0x10a876a 0x10a7c00 0x107eab4 0x109ecc1 0x4998f1\r\n\t0x5682a2\tmath/big.nat.make+0x182\t\t\t\t\t\t\t\t\t/root/.go/src/math/big/nat.go:63\r\n\t0x568141\tmath/big.nat.setBytes+0x21\t\t\t\t\t\t\t\t/root/.go/src/math/big/nat.go:1312\r\n\t0x5b3a1d\tmath/big.(*Int).SetBytes+0x67d\t\t\t\t\t\t\t\t/root/.go/src/math/big/int.go:434\r\n\t0x5b39ea\tgithub.com/ethereum/go-ethereum/rlp.decodeBigInt+0x64a\t\t\t\t\t/energy/gopath/src/github.com/ethereum/go-ethereum/rlp/decode.go:236\r\n\t0x5c0af2\tgithub.com/ethereum/go-ethereum/rlp.makeStructDecoder.func1+0x632\t\t\t/energy/gopath/src/github.com/ethereum/go-ethereum/rlp/decode.go:398\r\n\t0x5b912d\tgithub.com/ethereum/go-ethereum/rlp.(*Stream).Decode+0x1ed\t\t\t\t/energy/gopath/src/github.com/ethereum/go-ethereum/rlp/decode.go:764\r\n\t0x6ff39e\tgithub.com/ethereum/go-ethereum/core/types.(*Transaction).DecodeRLP+0x5e\t\t/energy/gopath/src/github.com/ethereum/go-ethereum/core/types/transaction.go:144\r\n\t0x11e8a57\tgithub.com/green-element-chain/gelchain/app.decodeTx+0xd7\t\t\t\t/energy/gopath/src/github.com/green-element-chain/gelchain/app/utils.go:31\r\n\t0x11e4357\tgithub.com/green-element-chain/gelchain/app.(*EthermintApplication).CheckTx+0x87\t/energy/gopath/src/github.com/green-element-chain/gelchain/app/app.go:208\r\n\t0x10283f1\tgithub.com/tendermint/tendermint/abci/client.(*localClient).CheckTxAsync+0xd1\t\t/energy/gopath/src/github.com/tendermint/tendermint/abci/client/local_client.go:99\r\n\t0x10330f0\tgithub.com/tendermint/tendermint/proxy.(*appConnMempool).CheckTxAsync+0x60\t\t/energy/gopath/src/github.com/tendermint/tendermint/proxy/app_conn.go:114\r\n\t0x1037dc6\tgithub.com/tendermint/tendermint/mempool.(*CListMempool).recheckTxs+0x236\t\t/energy/gopath/src/github.com/tendermint/tendermint/mempool/clist_mempool.go:621\r\n\t0x10379e8\tgithub.com/tendermint/tendermint/mempool.(*CListMempool).Update+0x378\t\t\t/energy/gopath/src/github.com/tendermint/tendermint/mempool/clist_mempool.go:592\r\n\t0x103f539\tgithub.com/tendermint/tendermint/state.(*BlockExecutor).Commit+0x6b9\t\t\t/energy/gopath/src/github.com/tendermint/tendermint/state/execution.go:258\r\n\t0x103e844\tgithub.com/tendermint/tendermint/state.(*BlockExecutor).ApplyBlock+0x704\t\t/energy/gopath/src/github.com/tendermint/tendermint/state/execution.go:195\r\n\t0x10a8769\tgithub.com/tendermint/tendermint/consensus.(*ConsensusState).finalizeCommit+0x9d9\t/energy/gopath/src/github.com/tendermint/tendermint/consensus/state.go:1403\r\n\t0x10a7bff\tgithub.com/tendermint/tendermint/consensus.(*ConsensusState).tryFinalizeCommit+0x3df\t/energy/gopath/src/github.com/tendermint/tendermint/consensus/state.go:1321\r\n\t0x107eab3\tgithub.com/tendermint/tendermint/consensus.(*ConsensusReactor).handleSignMsg+0x1563\t/energy/gopath/src/github.com/tendermint/tendermint/consensus/reactor.go:1940\r\n\t0x109ecc0\tgithub.com/tendermint/tendermint/consensus.(*ConsensusState).receiveRoutine+0x590\t/energy/gopath/src/github.com/tendermint/tendermint/consensus/state.go:683\r\n```\r\n2:\r\n```\r\n0: 0 [1: 32] @ 0x5b8489 0x5b33e0 0x5c0af3 0x5b912e 0x6ff39f 0x11e8a58 0x11e46bb 0x1028052 0x1032dce 0x103fd12 0x103e2bb 0x10a876a 0x10a7c00 0x107eab4 0x109ecc1 0x4998f1\r\n\t0x5b8488\tgithub.com/ethereum/go-ethereum/rlp.(*Stream).Bytes+0x78\t\t\t\t/energy/gopath/src/github.com/ethereum/go-ethereum/rlp/decode.go:612\r\n\t0x5b33df\tgithub.com/ethereum/go-ethereum/rlp.decodeBigInt+0x3f\t\t\t\t\t/energy/gopath/src/github.com/ethereum/go-ethereum/rlp/decode.go:223\r\n\t0x5c0af2\tgithub.com/ethereum/go-ethereum/rlp.makeStructDecoder.func1+0x632\t\t\t/energy/gopath/src/github.com/ethereum/go-ethereum/rlp/decode.go:398\r\n\t0x5b912d\tgithub.com/ethereum/go-ethereum/rlp.(*Stream).Decode+0x1ed\t\t\t\t/energy/gopath/src/github.com/ethereum/go-ethereum/rlp/decode.go:764\r\n\t0x6ff39e\tgithub.com/ethereum/go-ethereum/core/types.(*Transaction).DecodeRLP+0x5e\t\t/energy/gopath/src/github.com/ethereum/go-ethereum/core/types/transaction.go:144\r\n\t0x11e8a57\tgithub.com/green-element-chain/gelchain/app.decodeTx+0xd7\t\t\t\t/energy/gopath/src/github.com/green-element-chain/gelchain/app/utils.go:31\r\n\t0x11e46ba\tgithub.com/green-element-chain/gelchain/app.(*EthermintApplication).DeliverTx+0x8a\t/energy/gopath/src/github.com/green-element-chain/gelchain/app/app.go:225\r\n\t0x1028051\tgithub.com/tendermint/tendermint/abci/client.(*localClient).DeliverTxAsync+0xd1\t\t/energy/gopath/src/github.com/tendermint/tendermint/abci/client/local_client.go:88\r\n\t0x1032dcd\tgithub.com/tendermint/tendermint/proxy.(*appConnConsensus).DeliverTxAsync+0x5d\t\t/energy/gopath/src/github.com/tendermint/tendermint/proxy/app_conn.go:73\r\n\t0x103fd11\tgithub.com/tendermint/tendermint/state.execBlockOnProxyApp+0x6b1\t\t\t/energy/gopath/src/github.com/tendermint/tendermint/state/execution.go:323\r\n\t0x103e2ba\tgithub.com/tendermint/tendermint/state.(*BlockExecutor).ApplyBlock+0x17a\t\t/energy/gopath/src/github.com/tendermint/tendermint/state/execution.go:160\r\n\t0x10a8769\tgithub.com/tendermint/tendermint/consensus.(*ConsensusState).finalizeCommit+0x9d9\t/energy/gopath/src/github.com/tendermint/tendermint/consensus/state.go:1403\r\n\t0x10a7bff\tgithub.com/tendermint/tendermint/consensus.(*ConsensusState).tryFinalizeCommit+0x3df\t/energy/gopath/src/github.com/tendermint/tendermint/consensus/state.go:1321\r\n\t0x107eab3\tgithub.com/tendermint/tendermint/consensus.(*ConsensusReactor).handleSignMsg+0x1563\t/energy/gopath/src/github.com/tendermint/tendermint/consensus/reactor.go:1940\r\n\t0x109ecc0\tgithub.com/tendermint/tendermint/consensus.(*ConsensusState).receiveRoutine+0x590\t/energy/gopath/src/github.com/tendermint/tendermint/consensus/state.go:683\r\n```\r\n3:\r\n```\r\n0: 0 [64: 1024] @ 0x5682a3 0x568142 0x5b3a1e 0x5b39eb 0x5c0af3 0x5b912e 0x6ff39f 0x11e8a58 0x11e4358 0x10283f2 0x10330f1 0x1035646 0x103517f 0x11dd382 0x11dd772 0x11dd065 0x4998f1\r\n\t0x5682a2\tmath/big.nat.make+0x182\t\t\t\t\t\t\t\t\t/root/.go/src/math/big/nat.go:63\r\n\t0x568141\tmath/big.nat.setBytes+0x21\t\t\t\t\t\t\t\t/root/.go/src/math/big/nat.go:1312\r\n\t0x5b3a1d\tmath/big.(*Int).SetBytes+0x67d\t\t\t\t\t\t\t\t/root/.go/src/math/big/int.go:434\r\n\t0x5b39ea\tgithub.com/ethereum/go-ethereum/rlp.decodeBigInt+0x64a\t\t\t\t\t/energy/gopath/src/github.com/ethereum/go-ethereum/rlp/decode.go:236\r\n\t0x5c0af2\tgithub.com/ethereum/go-ethereum/rlp.makeStructDecoder.func1+0x632\t\t\t/energy/gopath/src/github.com/ethereum/go-ethereum/rlp/decode.go:398\r\n\t0x5b912d\tgithub.com/ethereum/go-ethereum/rlp.(*Stream).Decode+0x1ed\t\t\t\t/energy/gopath/src/github.com/ethereum/go-ethereum/rlp/decode.go:764\r\n\t0x6ff39e\tgithub.com/ethereum/go-ethereum/core/types.(*Transaction).DecodeRLP+0x5e\t\t/energy/gopath/src/github.com/ethereum/go-ethereum/core/types/transaction.go:144\r\n\t0x11e8a57\tgithub.com/green-element-chain/gelchain/app.decodeTx+0xd7\t\t\t\t/energy/gopath/src/github.com/green-element-chain/gelchain/app/utils.go:31\r\n\t0x11e4357\tgithub.com/green-element-chain/gelchain/app.(*EthermintApplication).CheckTx+0x87\t/energy/gopath/src/github.com/green-element-chain/gelchain/app/app.go:208\r\n\t0x10283f1\tgithub.com/tendermint/tendermint/abci/client.(*localClient).CheckTxAsync+0xd1\t\t/energy/gopath/src/github.com/tendermint/tendermint/abci/client/local_client.go:99\r\n\t0x10330f0\tgithub.com/tendermint/tendermint/proxy.(*appConnMempool).CheckTxAsync+0x60\t\t/energy/gopath/src/github.com/tendermint/tendermint/proxy/app_conn.go:114\r\n\t0x1035645\tgithub.com/tendermint/tendermint/mempool.(*CListMempool).CheckTxWithInfo+0x405\t\t/energy/gopath/src/github.com/tendermint/tendermint/mempool/clist_mempool.go:301\r\n\t0x103517e\tgithub.com/tendermint/tendermint/mempool.(*CListMempool).CheckTx+0x5e\t\t\t/energy/gopath/src/github.com/tendermint/tendermint/mempool/clist_mempool.go:223\r\n\t0x11dd381\tgithub.com/green-element-chain/gelchain/ethereum.(*Backend).BroadcastTxSync+0xc1\t/energy/gopath/src/github.com/green-element-chain/gelchain/ethereum/txs.go:51\r\n\t0x11dd771\tgithub.com/green-element-chain/gelchain/ethereum.(*Backend).BroadcastTx+0x151\t\t/energy/gopath/src/github.com/green-element-chain/gelchain/ethereum/txs.go:84\r\n\t0x11dd064\tgithub.com/green-element-chain/gelchain/ethereum.(*Backend).txBroadcastLoop+0x1f4\t/energy/gopath/src/github.com/green-element-chain/gelchain/ethereum/txs.go:34\r\n```\r\nThe three cases show how the decoding was called, mainly in \"CheckTx\" triggered by Tendermint.\r\n\r\nThe 4 is about how reflect.New is triggered:\r\n```\r\n0: 0 [9: 432] @ 0x4d51d5 0x86bc48 0x854c66 0x8541fa 0x85122c 0x1091476 0x106a6a7 0x1015812 0xfb43f9 0x4998f1\r\n\t0x4d51d4\treflect.New+0x44\t\t\t\t\t\t\t\t/root/.go/src/reflect/value.go:2290\r\n\t0x86bc47\tgithub.com/tendermint/go-amino.constructConcreteType+0x47\t\t\t/energy/gopath/src/github.com/tendermint/go-amino/reflect.go:184\r\n\t0x854c65\tgithub.com/tendermint/go-amino.(*Codec).decodeReflectBinaryInterface+0x315\t/energy/gopath/src/github.com/tendermint/go-amino/binary-decode.go:360\r\n\t0x8541f9\tgithub.com/tendermint/go-amino.(*Codec).decodeReflectBinary+0x18c9\t\t/energy/gopath/src/github.com/tendermint/go-amino/binary-decode.go:86\r\n\t0x85122b\tgithub.com/tendermint/go-amino.(*Codec).UnmarshalBinaryBare+0x1fb\t\t/energy/gopath/src/github.com/tendermint/go-amino/amino.go:344\r\n\t0x1091475\tgithub.com/tendermint/tendermint/consensus.decodeMsg+0x195\t\t\t/energy/gopath/src/github.com/tendermint/tendermint/consensus/reactor.go:3713\r\n\t0x106a6a6\tgithub.com/tendermint/tendermint/consensus.(*ConsensusReactor).Receive+0x2a6\t/energy/gopath/src/github.com/tendermint/tendermint/consensus/reactor.go:261\r\n\t0x1015811\tgithub.com/tendermint/tendermint/p2p.createMConnection.func1+0x271\t\t/energy/gopath/src/github.com/tendermint/tendermint/p2p/peer.go:385\r\n\t0xfb43f8\tgithub.com/tendermint/tendermint/p2p/conn.(*MConnection).recvRoutine+0x888\t/energy/gopath/src/github.com/tendermint/tendermint/p2p/conn/connection.go:586\r\n\r\n\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542605066/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542612258",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20172#issuecomment-542612258",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20172",
    "id": 542612258,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjYxMjI1OA==",
    "user": {
      "login": "james-ray",
      "id": 26137182,
      "node_id": "MDQ6VXNlcjI2MTM3MTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/26137182?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/james-ray",
      "html_url": "https://github.com/james-ray",
      "followers_url": "https://api.github.com/users/james-ray/followers",
      "following_url": "https://api.github.com/users/james-ray/following{/other_user}",
      "gists_url": "https://api.github.com/users/james-ray/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/james-ray/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/james-ray/subscriptions",
      "organizations_url": "https://api.github.com/users/james-ray/orgs",
      "repos_url": "https://api.github.com/users/james-ray/repos",
      "events_url": "https://api.github.com/users/james-ray/events{/privacy}",
      "received_events_url": "https://api.github.com/users/james-ray/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-16T09:24:48Z",
    "updated_at": "2019-10-16T09:38:49Z",
    "author_association": "NONE",
    "body": "> \r\n    func (app *EthermintApplication) CheckTx(req abciTypes.RequestCheckTx) abciTypes.ResponseCheckTx {\r\n\ttxBytes := req.Tx\r\n\ttx, err := decodeTx(txBytes)\r\n\tif err != nil {\r\n\t\t// nolint: errcheck\r\n\t\tapp.logger.Debug(\"CheckTx: Received invalid transaction\", \"tx\", tx)\r\n\t\treturn abciTypes.ResponseCheckTx{\r\n\t\t\tCode: uint32(errors.CodeInternal),\r\n\t\t\tLog:  err.Error(),\r\n\t\t}\r\n\t}\r\n\tapp.logger.Debug(\"CheckTx: Received valid transaction\", \"tx\", tx) // nolint: errcheck\r\n\r\n\treturn app.validateTx(tx, req.Type)\r\n> \r\n\r\n\r\nThe CheckTx in ethermint is shown as above, and below is one place where it is called:\r\n\r\n> \t\r\n      invalidTxs := make([]common.Hash, 0)\r\n\tfor e := mem.txs.Front(); e != nil; e = e.Next() {\r\n\t\tmemTx := e.Value.(*mempoolTx)\r\n\t\treqRes := mem.proxyAppConn.CheckTxAsync(abci.RequestCheckTx{Tx: memTx.tx, Type: abci.CheckTxType_Recheck})\r\n\t\tr := reqRes.Response.GetCheckTx()\r\n\t\tif r.Code != abci.CodeTypeOK {\r\n\t\t\ttransaction, err := DecodeTx(memTx.tx)\r\n\t\t\tif err != nil {\r\n\t\t\t\tmem.logger.Error(fmt.Sprintf(\"tx recheck decodeTx fail,tx is %X \", memTx.tx))\r\n\t\t\t}\r\n\t\t\ttxHash := transaction.Hash()\r\n\t\t\tmem.logger.Info(fmt.Sprintf(\"Invalid Tx, after decodeTx is %v, txHash is %v\",  transaction, txHash))\r\n\t\t\tinvalidTxs = append(invalidTxs, txHash)\r\n\t\t}\r\n\t}\r\n> \r\n\r\nIf the mem.txs have not been released correctly, it is indeed possible that the txBytes is still held. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542612258/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542661499",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20172#issuecomment-542661499",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20172",
    "id": 542661499,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MjY2MTQ5OQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-16T11:46:38Z",
    "updated_at": "2019-10-16T11:46:38Z",
    "author_association": "MEMBER",
    "body": "The `rlp` pckage simply decodes the big.Int. It's up to you what you do with it afterwards. If you can create a repro that leaks memory using only the `rlp` package we'll gladly take a closer look. Without a repro, I'm going to assume the leak is in `ethermint`, which we will not be able to help you with. Please open an issue on the `ethermint` repo.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/542661499/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
