{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15711",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15711/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15711/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15711/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/15711",
  "id": 283414066,
  "node_id": "MDU6SXNzdWUyODM0MTQwNjY=",
  "number": 15711,
  "title": "Two separate main-net Geth nodes (v1.8.0-unstable-c6069a62) crashed on the same block number",
  "user": {
    "login": "infamousrev",
    "id": 16310390,
    "node_id": "MDQ6VXNlcjE2MzEwMzkw",
    "avatar_url": "https://avatars.githubusercontent.com/u/16310390?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/infamousrev",
    "html_url": "https://github.com/infamousrev",
    "followers_url": "https://api.github.com/users/infamousrev/followers",
    "following_url": "https://api.github.com/users/infamousrev/following{/other_user}",
    "gists_url": "https://api.github.com/users/infamousrev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/infamousrev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/infamousrev/subscriptions",
    "organizations_url": "https://api.github.com/users/infamousrev/orgs",
    "repos_url": "https://api.github.com/users/infamousrev/repos",
    "events_url": "https://api.github.com/users/infamousrev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/infamousrev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2017-12-20T00:38:39Z",
  "updated_at": "2017-12-20T10:34:43Z",
  "closed_at": "2017-12-20T10:34:43Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Two Geth nodes running on two completely independent servers with plenty of memory and other system resources crashed while processing the exact same block number with the exact same error, leading me to believe it may be caused by a reproducible bug in the software.\r\n\r\n Server1:\r\n````\r\nINFO [12-19|22:20:49] Imported new chain segment               blocks=1 txs=305  mgas=7.985  elapsed=2.510s    mgasps=3.181  number=4762226 hash=23e774…a28e8e\r\nINFO [12-19|22:20:57] Imported new chain segment               blocks=1 txs=112  mgas=7.996  elapsed=498.418ms mgasps=16.042 number=4762227 hash=db6bf0…27d0a5\r\nINFO [12-19|22:21:01] Imported new chain segment               blocks=1 txs=245  mgas=7.992  elapsed=2.146s    mgasps=3.724  number=4762227 hash=b2814d…f45cc6\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x8 pc=0x8c80db]\r\n\r\n\r\n\r\ngoroutine 14809 [running]:\r\ngithub.com/ethereum/go-ethereum/core.(*TxPool).Status(0xc420211dc0, 0xc4587cb220, 0x1, 0x1, 0x0, 0x0, 0x0)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/core/tx_pool.go:841 +0x29b\r\ngithub.com/ethereum/go-ethereum/les.(*ProtocolManager).txStatus(0xc4220e2000, 0xc4587cb220, 0x1, 0x1, 0xc4479fa110, 0x1, 0x1)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/les/handler.go:1111 +0xb6\r\ngithub.com/ethereum/go-ethereum/les.(*ProtocolManager).handleMsg(0xc4220e2000, 0xc4201de480, 0x0, 0x0)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/les/handler.go:1020 +0x82a6\r\ngithub.com/ethereum/go-ethereum/les.(*ProtocolManager).handle(0xc4220e2000, 0xc4201de480, 0x0, 0x0)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/les/handler.go:315 +0x72f\r\ngithub.com/ethereum/go-ethereum/les.NewProtocolManager.func1(0xc4353b4cc0, 0x1850ba0, 0xc42f308150, 0x0, 0x0)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/les/handler.go:175 +0x252\r\ngithub.com/ethereum/go-ethereum/p2p.(*Peer).startProtocols.func1(0xc42f308150, 0xc4353b4cc0, 0x1850ba0, 0xc42f308150)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/p2p/peer.go:349 +0x66\r\ncreated by github.com/ethereum/go-ethereum/p2p.(*Peer).startProtocols\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/p2p/peer.go:348 +0x228\r\n````\r\n\r\nServer2:\r\n````\r\nINFO [12-19|22:20:43] Imported new chain segment               blocks=1 txs=271  mgas=7.989  elapsed=3.142s    mgasps=2.542  number=4762225 hash=c027ca…f9d46e\r\nINFO [12-19|22:20:50] Imported new chain segment               blocks=1 txs=305  mgas=7.985  elapsed=2.785s    mgasps=2.866  number=4762226 hash=23e774…a28e8e\r\nINFO [12-19|22:20:56] Imported new chain segment               blocks=1 txs=112  mgas=7.996  elapsed=588.105ms mgasps=13.596 number=4762227 hash=db6bf0…27d0a5\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x8 pc=0x8c80cb]\r\n\r\n\r\ngoroutine 11021853 [running]:\r\ngithub.com/ethereum/go-ethereum/core.(*TxPool).Status(0xc42020bdc0, 0xc445ab38e0, 0x1, 0x1, 0x0, 0x0, 0x0)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/core/tx_pool.go:841 +0x29b\r\ngithub.com/ethereum/go-ethereum/les.(*ProtocolManager).txStatus(0xc4202b4ee0, 0xc445ab38e0, 0x1, 0x1, 0xc42bd004a0, 0x1, 0x1)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/les/handler.go:1111 +0xb6\r\ngithub.com/ethereum/go-ethereum/les.(*ProtocolManager).handleMsg(0xc4202b4ee0, 0xc4354d6180, 0x0, 0x0)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/les/handler.go:1020 +0x82a6\r\ngithub.com/ethereum/go-ethereum/les.(*ProtocolManager).handle(0xc4202b4ee0, 0xc4354d6180, 0x0, 0x0)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/les/handler.go:315 +0x72f\r\ngithub.com/ethereum/go-ethereum/les.NewProtocolManager.func1(0xc456c6dda0, 0x184fba0, 0xc422a53260, 0x0, 0x0)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/les/handler.go:175 +0x252\r\ngithub.com/ethereum/go-ethereum/p2p.(*Peer).startProtocols.func1(0xc422a53260, 0xc456c6dda0, 0x184fba0, 0xc422a53260)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/p2p/peer.go:349 +0x66\r\ncreated by github.com/ethereum/go-ethereum/p2p.(*Peer).startProtocols\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/p2p/peer.go:348 +0x228\r\n````\r\n\r\n\r\nOS: \r\nLinux Centos 7.3 running: docker run -ti -p 30303:30303 docker.io/ethereum/client-go --maxpeers 150 --lightserv 90 --lightpeers 150\r\n\r\n\r\nIt seems hash=db6bf0…27d0a5 was the block that caused the crash, two other servers running the same software and hardware did not crash, so it is likely a bug that gets triggered only with a certain probability.",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15711/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15711/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/352955947",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15711#issuecomment-352955947",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15711",
    "id": 352955947,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1Mjk1NTk0Nw==",
    "user": {
      "login": "infamousrev",
      "id": 16310390,
      "node_id": "MDQ6VXNlcjE2MzEwMzkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/16310390?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/infamousrev",
      "html_url": "https://github.com/infamousrev",
      "followers_url": "https://api.github.com/users/infamousrev/followers",
      "following_url": "https://api.github.com/users/infamousrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/infamousrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/infamousrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/infamousrev/subscriptions",
      "organizations_url": "https://api.github.com/users/infamousrev/orgs",
      "repos_url": "https://api.github.com/users/infamousrev/repos",
      "events_url": "https://api.github.com/users/infamousrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/infamousrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-20T03:36:57Z",
    "updated_at": "2017-12-20T03:36:57Z",
    "author_association": "NONE",
    "body": "Update: Another node crashed with the same error, but this time only one node crashed:\r\n\r\n````\r\nINFO [12-20|03:25:03] Imported new chain segment               blocks=1  txs=173  mgas=7.994  elapsed=1.160s    mgasps=6.887  number=4763367 hash=1426a3…ff4f75\r\nINFO [12-20|03:25:09] Imported new chain segment               blocks=1  txs=44   mgas=1.133  elapsed=657.926ms mgasps=1.722  number=4763368 hash=80d9e5…83685d\r\nINFO [12-20|03:25:16] Imported new chain segment               blocks=1  txs=14   mgas=0.335  elapsed=90.226ms  mgasps=3.718  number=4763369 hash=2131f2…3066b1\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x8 pc=0x8c80db]\r\n\r\ngoroutine 31290856 [running]:\r\ngithub.com/ethereum/go-ethereum/core.(*TxPool).Status(0xc4201fddc0, 0xc4a75475e0, 0x1, 0x1, 0x0, 0x0, 0x0)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/core/tx_pool.go:841 +0x29b\r\ngithub.com/ethereum/go-ethereum/les.(*ProtocolManager).txStatus(0xc4202a6ee0, 0xc4a75475e0, 0x1, 0x1, 0xc42e6a72c0, 0x1, 0x1)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/les/handler.go:1111 +0xb6\r\ngithub.com/ethereum/go-ethereum/les.(*ProtocolManager).handleMsg(0xc4202a6ee0, 0xc486480e40, 0x0, 0x0)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/les/handler.go:1020 +0x82a6\r\ngithub.com/ethereum/go-ethereum/les.(*ProtocolManager).handle(0xc4202a6ee0, 0xc486480e40, 0x0, 0x0)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/les/handler.go:315 +0x72f\r\ngithub.com/ethereum/go-ethereum/les.NewProtocolManager.func1(0xc4408f8120, 0x1850ba0, 0xc494d41c00, 0x0, 0x0)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/les/handler.go:175 +0x252\r\ngithub.com/ethereum/go-ethereum/p2p.(*Peer).startProtocols.func1(0xc494d41c00, 0xc4408f8120, 0x1850ba0, 0xc494d41c00)\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/p2p/peer.go:349 +0x66\r\ncreated by github.com/ethereum/go-ethereum/p2p.(*Peer).startProtocols\r\n\t/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/p2p/peer.go:348 +0x228\r\n````",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/352955947/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/353007518",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15711#issuecomment-353007518",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15711",
    "id": 353007518,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MzAwNzUxOA==",
    "user": {
      "login": "marcogohi",
      "id": 749317,
      "node_id": "MDQ6VXNlcjc0OTMxNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/749317?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marcogohi",
      "html_url": "https://github.com/marcogohi",
      "followers_url": "https://api.github.com/users/marcogohi/followers",
      "following_url": "https://api.github.com/users/marcogohi/following{/other_user}",
      "gists_url": "https://api.github.com/users/marcogohi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marcogohi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marcogohi/subscriptions",
      "organizations_url": "https://api.github.com/users/marcogohi/orgs",
      "repos_url": "https://api.github.com/users/marcogohi/repos",
      "events_url": "https://api.github.com/users/marcogohi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marcogohi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-20T09:13:49Z",
    "updated_at": "2017-12-20T09:28:32Z",
    "author_association": "NONE",
    "body": "Hi!\r\n\r\nHappens the same in my private network. The node that crashes is the node serving light clients (geth 1.7.3-stable with --lightserv 20) if I remove that parameter it doesn't crash. It crashes sometimes when the light client (geth 1.7.3-stable with --light) connected to it sends a tx.\r\n\r\nAny fix?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/353007518/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/353023076",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15711#issuecomment-353023076",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15711",
    "id": 353023076,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MzAyMzA3Ng==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-20T10:16:12Z",
    "updated_at": "2017-12-20T10:16:12Z",
    "author_association": "MEMBER",
    "body": "Thanks for this! It's indeed a bug in the txpool used only by the light client. I've opened a PR, will probably be merged today into master.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/353023076/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
