{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15582",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15582/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15582/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15582/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/15582",
  "id": 277827928,
  "node_id": "MDU6SXNzdWUyNzc4Mjc5Mjg=",
  "number": 15582,
  "title": "Error when syncing blockchain - \"too many open files\"",
  "user": {
    "login": "mr-sk",
    "id": 842085,
    "node_id": "MDQ6VXNlcjg0MjA4NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/842085?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mr-sk",
    "html_url": "https://github.com/mr-sk",
    "followers_url": "https://api.github.com/users/mr-sk/followers",
    "following_url": "https://api.github.com/users/mr-sk/following{/other_user}",
    "gists_url": "https://api.github.com/users/mr-sk/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mr-sk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mr-sk/subscriptions",
    "organizations_url": "https://api.github.com/users/mr-sk/orgs",
    "repos_url": "https://api.github.com/users/mr-sk/repos",
    "events_url": "https://api.github.com/users/mr-sk/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mr-sk/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 856638432,
      "node_id": "MDU6TGFiZWw4NTY2Mzg0MzI=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:inactive",
      "name": "status:inactive",
      "color": "ffffff",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2017-11-29T16:50:29Z",
  "updated_at": "2019-06-25T10:01:28Z",
  "closed_at": "2019-06-25T10:01:27Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `geth version`\r\n`\r\nGeth\r\nVersion: 1.7.3-stable\r\nArchitecture: amd64\r\nProtocol Versions: [63 62]\r\nNetwork Id: 1\r\nGo Version: go1.9.2\r\nOperating System: darwin\r\nGOPATH=\r\nGOROOT=/usr/local/Cellar/go/1.9.2/libexec\r\n`\r\nOS & Version: Windows/Linux/OSX\r\n`\r\nDarwin Bens-MacBook-Pro.local 16.7.0 Darwin Kernel Version 16.7.0: Thu Jun 15 17:36:27 PDT 2017; root:xnu-3789.70.16~2/RELEASE_X86_64 x86_64\r\n`\r\nCommit hash : (if `develop`)\r\n\r\n#### Expected behaviour\r\nI want to sync the blockchain.\r\n\r\n#### Actual behaviour\r\nI get an error, `CRIT [11-29|11:33:18] Failed to store hash to number mapping   err=\"open /Users/ben/Library/Ethereum/geth/chaindata/128935.ldb: too many open files\"`\r\n\r\n#### Steps to reproduce the behaviour\r\nRun `geth` or `geth --fast --cache=512`\r\n\r\n#### Backtrace\r\n\r\n````\r\nINFO [11-29|11:33:11] Imported new state entries               count=1168 elapsed=59.677ms  processed=54931 pending=7933  retry=0   duplicate=0 unexpected=0\r\nINFO [11-29|11:33:11] Imported new block receipts              count=205  elapsed=102.370ms bytes=857904  number=2836427 hash=868b82…fdad4e ignored=0\r\nINFO [11-29|11:33:14] Imported new state entries               count=1152 elapsed=5.668ms   processed=56083 pending=8059  retry=0   duplicate=0 unexpected=0\r\nINFO [11-29|11:33:16] Imported new state entries               count=1000 elapsed=5.157ms   processed=57083 pending=7533  retry=0   duplicate=0 unexpected=0\r\nINFO [11-29|11:33:18] Imported new block receipts              count=626  elapsed=290.663ms bytes=2278239 number=2837053 hash=2ea19d…1bd46c ignored=0\r\nCRIT [11-29|11:33:18] Failed to store hash to number mapping   err=\"open /Users/ben/Library/Ethereum/geth/chaindata/128935.ldb: too many open files\"\r\n````\r\n",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15582/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15582/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/348371583",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15582#issuecomment-348371583",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15582",
    "id": 348371583,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0ODM3MTU4Mw==",
    "user": {
      "login": "huckphin",
      "id": 648121,
      "node_id": "MDQ6VXNlcjY0ODEyMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/648121?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huckphin",
      "html_url": "https://github.com/huckphin",
      "followers_url": "https://api.github.com/users/huckphin/followers",
      "following_url": "https://api.github.com/users/huckphin/following{/other_user}",
      "gists_url": "https://api.github.com/users/huckphin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huckphin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huckphin/subscriptions",
      "organizations_url": "https://api.github.com/users/huckphin/orgs",
      "repos_url": "https://api.github.com/users/huckphin/repos",
      "events_url": "https://api.github.com/users/huckphin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huckphin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-01T01:08:13Z",
    "updated_at": "2017-12-01T01:08:13Z",
    "author_association": "NONE",
    "body": "The number of open files that one process can open is based upon your system limits by the operating system.\r\n\r\nI see that you are using Darwin (Mac).\r\n\r\nYou can check your limits, by opening iTerm, and running `ulimit -a`:\r\n\r\n```\r\n$ ulimit -a\r\ncore file size          (blocks, -c) 0\r\ndata seg size           (kbytes, -d) unlimited\r\nfile size               (blocks, -f) unlimited\r\nmax locked memory       (kbytes, -l) unlimited\r\nmax memory size         (kbytes, -m) unlimited\r\nopen files                      (-n) 7168\r\npipe size            (512 bytes, -p) 1\r\nstack size              (kbytes, -s) 8192\r\ncpu time               (seconds, -t) unlimited\r\nmax user processes              (-u) 709\r\nvirtual memory          (kbytes, -v) unlimited\r\n```\r\n\r\nTo just see the number of open files, you can use `launchctl`.\r\n\r\nHere is a helpful Stack Overflow article on [launchctl usage](https://superuser.com/questions/302754/increase-the-maximum-number-of-open-file-descriptors-in-snow-leopard) to up the maximum amount of open files that you want.\r\n\r\nThere is not much harm to setting it to a much higher value. 100,000 open files for both soft and hard limits is safe for you to put in place.\r\n\r\nLet me know if you have any other questions.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/348371583/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/351585822",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15582#issuecomment-351585822",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15582",
    "id": 351585822,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1MTU4NTgyMg==",
    "user": {
      "login": "LYY",
      "id": 508941,
      "node_id": "MDQ6VXNlcjUwODk0MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/508941?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LYY",
      "html_url": "https://github.com/LYY",
      "followers_url": "https://api.github.com/users/LYY/followers",
      "following_url": "https://api.github.com/users/LYY/following{/other_user}",
      "gists_url": "https://api.github.com/users/LYY/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LYY/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LYY/subscriptions",
      "organizations_url": "https://api.github.com/users/LYY/orgs",
      "repos_url": "https://api.github.com/users/LYY/repos",
      "events_url": "https://api.github.com/users/LYY/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LYY/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-14T02:05:30Z",
    "updated_at": "2017-12-14T02:05:30Z",
    "author_association": "NONE",
    "body": "@huckphin I found go-ethereum hard code the soft limit of open files to 2048, link is [here](https://github.com/ethereum/go-ethereum/blob/46e5583993afe7b9d0ff432f846b2a97bcb89876/cmd/utils/flags.go#L723).\r\n\r\nuse `cat /proc/<process_id>/limits` also can confirm that:\r\n\r\n```\r\nLimit                     Soft Limit           Hard Limit           Units\r\nMax cpu time              unlimited            unlimited            seconds\r\nMax file size             unlimited            unlimited            bytes\r\nMax data size             unlimited            unlimited            bytes\r\nMax stack size            8388608              unlimited            bytes\r\nMax core file size        unlimited            unlimited            bytes\r\nMax resident set          unlimited            unlimited            bytes\r\nMax processes             65535                65535                processes\r\nMax open files            2048                 65535                files\r\nMax locked memory         65536                65536                bytes\r\nMax address space         unlimited            unlimited            bytes\r\nMax file locks            unlimited            unlimited            locks\r\nMax pending signals       31791                31791                signals\r\nMax msgqueue size         819200               819200               bytes\r\nMax nice priority         0                    0\r\nMax realtime priority     0                    0\r\nMax realtime timeout      unlimited            unlimited            us\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/351585822/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/391127507",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15582#issuecomment-391127507",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15582",
    "id": 391127507,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MTEyNzUwNw==",
    "user": {
      "login": "davidhq",
      "id": 3899,
      "node_id": "MDQ6VXNlcjM4OTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3899?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/davidhq",
      "html_url": "https://github.com/davidhq",
      "followers_url": "https://api.github.com/users/davidhq/followers",
      "following_url": "https://api.github.com/users/davidhq/following{/other_user}",
      "gists_url": "https://api.github.com/users/davidhq/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/davidhq/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/davidhq/subscriptions",
      "organizations_url": "https://api.github.com/users/davidhq/orgs",
      "repos_url": "https://api.github.com/users/davidhq/repos",
      "events_url": "https://api.github.com/users/davidhq/events{/privacy}",
      "received_events_url": "https://api.github.com/users/davidhq/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-22T20:21:39Z",
    "updated_at": "2018-05-22T20:21:39Z",
    "author_association": "NONE",
    "body": "How to increase system limits: \r\nhttps://www.cyberciti.biz/faq/linux-increase-the-maximum-number-of-open-files/",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/391127507/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/495384747",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15582#issuecomment-495384747",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15582",
    "id": 495384747,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NTM4NDc0Nw==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2019-05-23T21:05:31Z",
    "updated_at": "2019-05-23T21:05:31Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/495384747/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/505376312",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15582#issuecomment-505376312",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15582",
    "id": 505376312,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwNTM3NjMxMg==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-25T10:01:27Z",
    "updated_at": "2019-06-25T10:01:27Z",
    "author_association": "MEMBER",
    "body": "we've fixed a lot with how geth handles open files, and how geth determines a safe value for number of open files to keep without blowing up. Please file a new ticket if this still persists with latest master",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/505376312/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
