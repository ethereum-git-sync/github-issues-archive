{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16148",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16148/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16148/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16148/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/16148",
  "id": 298834595,
  "node_id": "MDU6SXNzdWUyOTg4MzQ1OTU=",
  "number": 16148,
  "title": "leveldb/table corrupted, then dropping peers and failing to sync.",
  "user": {
    "login": "okayplanet",
    "id": 3144575,
    "node_id": "MDQ6VXNlcjMxNDQ1NzU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3144575?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/okayplanet",
    "html_url": "https://github.com/okayplanet",
    "followers_url": "https://api.github.com/users/okayplanet/followers",
    "following_url": "https://api.github.com/users/okayplanet/following{/other_user}",
    "gists_url": "https://api.github.com/users/okayplanet/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/okayplanet/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/okayplanet/subscriptions",
    "organizations_url": "https://api.github.com/users/okayplanet/orgs",
    "repos_url": "https://api.github.com/users/okayplanet/repos",
    "events_url": "https://api.github.com/users/okayplanet/events{/privacy}",
    "received_events_url": "https://api.github.com/users/okayplanet/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2018-02-21T04:00:17Z",
  "updated_at": "2018-02-21T14:40:54Z",
  "closed_at": "2018-02-21T13:01:48Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth\r\nVersion: 1.7.3-stable\r\nGit Commit: 4bb3c89d44e372e6a9ab85a8be0c9345265c763a\r\nArchitecture: amd64\r\nProtocol Versions: [63 62]\r\nNetwork Id: 1\r\nGo Version: go1.9.2\r\nOperating System: linux\r\nGOPATH=\r\nGOROOT=/usr/local/go\r\n\r\n#### Expected behaviour\r\nSync\r\n\r\n#### Actual behaviour\r\nNot syncing, and dropping peers due to invalid hashchain.\r\n\r\n#### Steps to reproduce the behaviour\r\nUnsure if the issue is reproducible to a reliable certainty.  But I pressed Ctrl+C while in the console, and after being unable to kill geth with kill -HUP, and -INT, I used kill -9.  The received the error: \r\n\r\n```CRIT [02-20|20:18:58] Failed to store block total difficulty err=\"leveldb/table: corruption on data-block (pos=207183): checksum mismatch, want=0xa1787c60 got=0x2327cc80 [file=149623.ldb]\"```\r\n\r\nAfterwards, I deleted the file in question 149623.ldb and now am getting the following issues with my peers:\r\n```\r\nWARN [02-20|20:40:20] Synchronisation failed, dropping peer peer=9097f897caa6997e err=\"retrieved hash chain is invalid\"\r\nINFO [02-20|20:40:32] Imported new chain segment blocks=4 txs=39 mgas=5.276 elapsed=9.189s mgasps=0.574 number=2590712 hash=f466b5â€¦2b40b5\r\nERROR[02-20|20:40:44]\r\n#### BAD BLOCK\r\n\r\nChain config: {ChainID: 3 Homestead: 0 DAO: <nil> DAOSupport: true EIP150: 0 EIP155: 10 EIP158: 10 Byzantium: 1700000 Engine: ethash}\r\n\r\nNumber: 2590716\r\nHash: 0x6cb2c18886e6764810bcd495ffa14ce16cbe0b3733a0c9d0b99058e9554b7f39\r\n\r\nError: nonce too high\r\n#\r\n\r\nWARN [02-20|20:40:44] Synchronisation failed, dropping peer peer=e80276aabb7682a4 err=\"retrieved hash chain is invalid\"\r\n```",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16148/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16148/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/367245802",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16148#issuecomment-367245802",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16148",
    "id": 367245802,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NzI0NTgwMg==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-21T08:15:09Z",
    "updated_at": "2018-02-21T08:15:09Z",
    "author_association": "MEMBER",
    "body": "Why would you delete a file from the database? Anyway, seems either that your disk is failing (which caused the corruption in the first place), or perhaps a power outage / OS crash caused the database to fail mid write. I'm voting for the disk failing though, please run a bad sector check.\r\n\r\nAll in all with the database file deleted, your only option now is to sync from scratch.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/367245802/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/367345491",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16148#issuecomment-367345491",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16148",
    "id": 367345491,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NzM0NTQ5MQ==",
    "user": {
      "login": "okayplanet",
      "id": 3144575,
      "node_id": "MDQ6VXNlcjMxNDQ1NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3144575?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/okayplanet",
      "html_url": "https://github.com/okayplanet",
      "followers_url": "https://api.github.com/users/okayplanet/followers",
      "following_url": "https://api.github.com/users/okayplanet/following{/other_user}",
      "gists_url": "https://api.github.com/users/okayplanet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/okayplanet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/okayplanet/subscriptions",
      "organizations_url": "https://api.github.com/users/okayplanet/orgs",
      "repos_url": "https://api.github.com/users/okayplanet/repos",
      "events_url": "https://api.github.com/users/okayplanet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/okayplanet/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-21T14:35:37Z",
    "updated_at": "2018-02-21T14:35:37Z",
    "author_association": "NONE",
    "body": "Others have done this on past tickets with varying degrees of success.  Also, I didn't realize the software would have trouble recovering.  Would the ```kill -9``` not be responsible for the initial corruption?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/367345491/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/367347124",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16148#issuecomment-367347124",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16148",
    "id": 367347124,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NzM0NzEyNA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-21T14:40:53Z",
    "updated_at": "2018-02-21T14:40:53Z",
    "author_association": "MEMBER",
    "body": "Everyone doing such a thing will end up with bad blocks eventually, when they try to access data they just deleted. Never delete individual files from the database.\r\n\r\nGeth does try to recover from various problems, as long as the database is available. Not sure whether `kill -9` was the culprit of something else, but if leveldb reports its datafiles as corrupted, there's not much geth can do, since leveldb doesn't even allow geth to touch any data any more.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/367347124/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
