{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1358",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1358/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1358/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1358/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/1358",
  "id": 91889843,
  "node_id": "MDU6SXNzdWU5MTg4OTg0Mw==",
  "number": 1358,
  "title": "Bulk block downloading stops before max chain height",
  "user": {
    "login": "samlavery",
    "id": 717772,
    "node_id": "MDQ6VXNlcjcxNzc3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/717772?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/samlavery",
    "html_url": "https://github.com/samlavery",
    "followers_url": "https://api.github.com/users/samlavery/followers",
    "following_url": "https://api.github.com/users/samlavery/following{/other_user}",
    "gists_url": "https://api.github.com/users/samlavery/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/samlavery/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/samlavery/subscriptions",
    "organizations_url": "https://api.github.com/users/samlavery/orgs",
    "repos_url": "https://api.github.com/users/samlavery/repos",
    "events_url": "https://api.github.com/users/samlavery/events{/privacy}",
    "received_events_url": "https://api.github.com/users/samlavery/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2015-06-29T19:35:57Z",
  "updated_at": "2015-08-09T22:12:01Z",
  "closed_at": "2015-08-09T22:12:00Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "The geth bulk downloader only targets the block height when it starts bulk downloading, and stops when it's hit that.  Meanwhile, the chain has grown n blocks depending on how long you were downloading.  It might be useful to check the current block height while downloading and stay in bulk mode until you are near the real top block. \n",
  "closed_by": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1358/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1358/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/116812027",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1358#issuecomment-116812027",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1358",
    "id": 116812027,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNjgxMjAyNw==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-29T19:37:09Z",
    "updated_at": "2015-06-29T19:46:18Z",
    "author_association": "MEMBER",
    "body": "@karalabe please verify\n\nhttps://gitter.im/ethereum/go-ethereum?at=55919be7666fd9af6736a3e5 and below.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/116812027/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/116887118",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1358#issuecomment-116887118",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1358",
    "id": 116887118,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNjg4NzExOA==",
    "user": {
      "login": "samlavery",
      "id": 717772,
      "node_id": "MDQ6VXNlcjcxNzc3Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/717772?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/samlavery",
      "html_url": "https://github.com/samlavery",
      "followers_url": "https://api.github.com/users/samlavery/followers",
      "following_url": "https://api.github.com/users/samlavery/following{/other_user}",
      "gists_url": "https://api.github.com/users/samlavery/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/samlavery/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/samlavery/subscriptions",
      "organizations_url": "https://api.github.com/users/samlavery/orgs",
      "repos_url": "https://api.github.com/users/samlavery/repos",
      "events_url": "https://api.github.com/users/samlavery/events{/privacy}",
      "received_events_url": "https://api.github.com/users/samlavery/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-30T00:28:52Z",
    "updated_at": "2015-06-30T00:28:52Z",
    "author_association": "NONE",
    "body": "By stop block I mean the block height geth grabs at startup, that's what it targets for bulk downloading.  Say the chain is at 700,000 when you fire up an old geth, it will bulk download until block 700,000, while the chain has grown to 720,000.  Once it hits 700,000, it goes into normal consensus mode, but a lot of nodes can't catch up fast enough in normal peer mode.  It shouldn't stop bulk until it's fully caught up.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/116887118/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/117029306",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1358#issuecomment-117029306",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1358",
    "id": 117029306,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExNzAyOTMwNg==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-06-30T07:11:03Z",
    "updated_at": "2015-06-30T07:11:03Z",
    "author_association": "MEMBER",
    "body": "The currently implemented protocol had a limitation by design/spec that only allowed backwards hash downloads. This meant that you pick the latest hash you know in the system, pull everything from there, then fill the blocks. This obviously could only pull blocks up until the origin hash you picked.\n\nHowever, while you are importing the last 1024 blocks, the downloader already completes, and starts a fresh sync cycle, looking for a new hash to import from. So yes, downloading will be done in possibly multiple phases, but they should continue one another almost continuously. Geth will **not** do a single bulk download and then switch to a different strategy, but instead the downloader runs whenever geth sees that someone's ahead of it. Furthermore, blocks propagated that are close to your head are cached specifically to prevent this issue that the downloader cannot sync up to latest head fast enough.\n\nI'm working on the eth/61 protocol, which should allow forward block retrievals, so this has the potential to make both transitioning smoother, as well as downloading in general more stable. But IMHO, the issue has nothing really to do with the downloader and everything to do with the system in general being overloaded. My geth is using 100%, all my cores when idling (i.e. in sync with the network, nothing to import).\n\nSo, all in all, this \"stopping before head is reached\" is by protocol design, will be fixed hopefully using a protocol update, but shouldn't matter much if the network wouldn't be fully overloaded. Let's see how the new protocol would behave after I write it. \n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/117029306/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/118339448",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1358#issuecomment-118339448",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1358",
    "id": 118339448,
    "node_id": "MDEyOklzc3VlQ29tbWVudDExODMzOTQ0OA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-07-03T12:51:33Z",
    "updated_at": "2015-07-03T12:51:33Z",
    "author_association": "MEMBER",
    "body": "Eth/61 was merged 1-2 days ago, please verify how sync works now with the develop branch. It should be much much stabler.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/118339448/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
