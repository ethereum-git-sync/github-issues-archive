{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20786",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20786/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20786/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20786/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/20786",
  "id": 584614735,
  "node_id": "MDU6SXNzdWU1ODQ2MTQ3MzU=",
  "number": 20786,
  "title": "Ways to improve RLP processing speed (caching?, concurrency?)",
  "user": {
    "login": "fxfactorial",
    "id": 3036816,
    "node_id": "MDQ6VXNlcjMwMzY4MTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3036816?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fxfactorial",
    "html_url": "https://github.com/fxfactorial",
    "followers_url": "https://api.github.com/users/fxfactorial/followers",
    "following_url": "https://api.github.com/users/fxfactorial/following{/other_user}",
    "gists_url": "https://api.github.com/users/fxfactorial/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fxfactorial/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fxfactorial/subscriptions",
    "organizations_url": "https://api.github.com/users/fxfactorial/orgs",
    "repos_url": "https://api.github.com/users/fxfactorial/repos",
    "events_url": "https://api.github.com/users/fxfactorial/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fxfactorial/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2020-03-19T18:30:34Z",
  "updated_at": "2020-05-18T15:23:49Z",
  "closed_at": "2020-05-18T15:23:48Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "I understand that RLP encoding isn't going away anytime soon because the advantage of byte for byte correctness is hard to beat. That said, I find the performance of RLP encoding/decoding to be quite slow and I'm looking for ways to increase speed. That is, are there any tricks or insights that the ethereum codebase uses to make RLP encoding go faster? Or insights about how to organize data structures that are fastest, easiest for RLP to encode/decode. \r\n\r\nWhat about concurrency, would it be possible somehow to say take a slice of 1000 encodable things and then have 10 threads encode 100 at once and then concat the byte results? Anyway to cache RLP partial results without issues of losing correctness?\r\n\r\nThank you\r\n\r\n@karalabe (tagging you because I appreciate you answering in previous issue of mine and maybe you can help explain here too) ",
  "closed_by": {
    "login": "fxfactorial",
    "id": 3036816,
    "node_id": "MDQ6VXNlcjMwMzY4MTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3036816?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fxfactorial",
    "html_url": "https://github.com/fxfactorial",
    "followers_url": "https://api.github.com/users/fxfactorial/followers",
    "following_url": "https://api.github.com/users/fxfactorial/following{/other_user}",
    "gists_url": "https://api.github.com/users/fxfactorial/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fxfactorial/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fxfactorial/subscriptions",
    "organizations_url": "https://api.github.com/users/fxfactorial/orgs",
    "repos_url": "https://api.github.com/users/fxfactorial/repos",
    "events_url": "https://api.github.com/users/fxfactorial/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fxfactorial/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20786/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20786/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/601591146",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20786#issuecomment-601591146",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20786",
    "id": 601591146,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTU5MTE0Ng==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-20T08:48:19Z",
    "updated_at": "2020-03-20T08:48:19Z",
    "author_association": "MEMBER",
    "body": "RLP encoding/decoding isn't particularly speedy (it was never really attempted to make it super fast). But generally there's also no particular need for it (I may be horribly wrong here). Can you provide some infos about what you're trying to do and why RLP is a bottleneck there?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/601591146/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/601639115",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20786#issuecomment-601639115",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20786",
    "id": 601639115,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTYzOTExNQ==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-20T10:52:37Z",
    "updated_at": "2020-03-20T10:53:53Z",
    "author_association": "MEMBER",
    "body": "Are you using Go and the RLP implementation contained in the go-ethereum repo for your work?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/601639115/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/601639423",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20786#issuecomment-601639423",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20786",
    "id": 601639423,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTYzOTQyMw==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-20T10:53:25Z",
    "updated_at": "2020-03-20T10:53:25Z",
    "author_association": "MEMBER",
    "body": "Concurrency will not really help I think. If we wanted to make RLP processing faster, the next step would be creating a code generator.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/601639423/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/601952471",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20786#issuecomment-601952471",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20786",
    "id": 601952471,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMTk1MjQ3MQ==",
    "user": {
      "login": "fxfactorial",
      "id": 3036816,
      "node_id": "MDQ6VXNlcjMwMzY4MTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3036816?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fxfactorial",
      "html_url": "https://github.com/fxfactorial",
      "followers_url": "https://api.github.com/users/fxfactorial/followers",
      "following_url": "https://api.github.com/users/fxfactorial/following{/other_user}",
      "gists_url": "https://api.github.com/users/fxfactorial/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fxfactorial/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fxfactorial/subscriptions",
      "organizations_url": "https://api.github.com/users/fxfactorial/orgs",
      "repos_url": "https://api.github.com/users/fxfactorial/repos",
      "events_url": "https://api.github.com/users/fxfactorial/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fxfactorial/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-20T23:28:14Z",
    "updated_at": "2020-03-20T23:28:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "@karalabe Just thinking of places where I could have data structures like slices of types which themselves have fields which are slices. Where the nested slices can be of length 100,000 and have many usages of things like `*big.Int`. The decode and encode is painful in both memory and compute. \r\n\r\n@fjl yes, using the plain RLP impl. Has there been any improvement in it since go ethereum 1.8.27?\r\n\r\nBut I was thinking, say I have a RLP encoded slice of 100 items. Is there no way to correctly know where the middle index is and have at least two go threads decoding in parallel? \r\n\r\nOr what about EncodeToBytes, any caching ideas I could use there ? \r\n\r\nCan you elaborate on code generator? I want to keep the RLP encoding itself, just the runtime impl of it is something I wish I could make faster in some way (either in compute, or memory, or some caching) ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/601952471/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/614586219",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20786#issuecomment-614586219",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20786",
    "id": 614586219,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNDU4NjIxOQ==",
    "user": {
      "login": "ferranbt",
      "id": 30872539,
      "node_id": "MDQ6VXNlcjMwODcyNTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/30872539?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ferranbt",
      "html_url": "https://github.com/ferranbt",
      "followers_url": "https://api.github.com/users/ferranbt/followers",
      "following_url": "https://api.github.com/users/ferranbt/following{/other_user}",
      "gists_url": "https://api.github.com/users/ferranbt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ferranbt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ferranbt/subscriptions",
      "organizations_url": "https://api.github.com/users/ferranbt/orgs",
      "repos_url": "https://api.github.com/users/ferranbt/repos",
      "events_url": "https://api.github.com/users/ferranbt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ferranbt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-16T11:13:46Z",
    "updated_at": "2020-04-16T11:13:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "You may want to check [fastrlp](https://github.com/umbracle/fastrlp). It does not do reflection so you can optimize both memory and cpu more efficiently (there are some benchmarks with respect to go-ethereum/rlp). You need to manually write the encoding/decoding yourself though. However, in the case of eth1, there are not that many data structures that need RLP encoding so is not that hard to do it manually like [here](https://github.com/umbracle/minimal/blob/develop/types/transaction_encoding.go#L11).\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/614586219/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/630256018",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20786#issuecomment-630256018",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20786",
    "id": 630256018,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzMDI1NjAxOA==",
    "user": {
      "login": "fxfactorial",
      "id": 3036816,
      "node_id": "MDQ6VXNlcjMwMzY4MTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3036816?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fxfactorial",
      "html_url": "https://github.com/fxfactorial",
      "followers_url": "https://api.github.com/users/fxfactorial/followers",
      "following_url": "https://api.github.com/users/fxfactorial/following{/other_user}",
      "gists_url": "https://api.github.com/users/fxfactorial/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fxfactorial/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fxfactorial/subscriptions",
      "organizations_url": "https://api.github.com/users/fxfactorial/orgs",
      "repos_url": "https://api.github.com/users/fxfactorial/repos",
      "events_url": "https://api.github.com/users/fxfactorial/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fxfactorial/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-18T15:23:48Z",
    "updated_at": "2020-05-18T15:23:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "Not relevant to me anymore ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/630256018/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
