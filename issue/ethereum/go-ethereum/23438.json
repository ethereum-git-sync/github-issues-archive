{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23438",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23438/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23438/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23438/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23438",
  "id": 977061077,
  "node_id": "MDU6SXNzdWU5NzcwNjEwNzc=",
  "number": 23438,
  "title": "panic: runtime error: integer divide by zero Snapshot.go:.inturn()",
  "user": {
    "login": "akinmail",
    "id": 9999611,
    "node_id": "MDQ6VXNlcjk5OTk2MTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9999611?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/akinmail",
    "html_url": "https://github.com/akinmail",
    "followers_url": "https://api.github.com/users/akinmail/followers",
    "following_url": "https://api.github.com/users/akinmail/following{/other_user}",
    "gists_url": "https://api.github.com/users/akinmail/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/akinmail/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/akinmail/subscriptions",
    "organizations_url": "https://api.github.com/users/akinmail/orgs",
    "repos_url": "https://api.github.com/users/akinmail/repos",
    "events_url": "https://api.github.com/users/akinmail/events{/privacy}",
    "received_events_url": "https://api.github.com/users/akinmail/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-08-23T13:52:30Z",
  "updated_at": "2021-08-23T20:57:53Z",
  "closed_at": "2021-08-23T20:57:53Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: ` instance=Geth/v1.10.7-stable-12f0ff40/darwin-amd64/go1.13.4`\r\nOS & Version: Linux and OSX\r\nCommit hash : \r\n\r\n#### Expected behaviour\r\nAfter runnning geth init, trying to run geth and attach to it should work\r\n\r\n\r\n#### Actual behaviour\r\ntrying to run geth and attach to it throws panic: runtime error: integer divide by zero Snapshot.go:.inturn()\r\n\r\n#### Steps to reproduce the behaviour\r\n```\r\ngit clone https://github.com/ethereum/go-ethereum.git\r\ncd go-ethereum/\r\ngit checkout remotes/origin/release/1.10\r\nmake geth\r\ncd build/bin\r\n./geth --datadir=\"data\" init dev.json\r\n\r\n./geth --datadir=\"data\" --unlock \"0xxxxxx\" --miner.etherbase \"0xxxx\" --password ./password.txt --txpool.nolocals --mine  --miner.threads 8 --rpc.gascap 0 --allow-insecure-unlock --nousb --networkid 200 --syncmode 'full' --http --http.addr '0.0.0.0' --http.port 8501 --http.api 'personal,eth,net,web3,txpool,miner' --ws  --ws.addr '0.0.0.0'  --ws.port 8601  --ws.api 'personal,eth,net,web3,txpool,miner'  --ws.origins '*' --http.corsdomain '*' --bootnodes \"enode://44b7c541a6f7b8cb44f84f396b042c40dcdf79659273a9c991800794763523c18af5c94ef3df414e26939a7e06d8e7c75febab7aae20b8a4bca7cdbce33442d4@52.165.155.198:30301\"\r\n```\r\n\r\n\r\n#### Backtrace\r\n\r\n````\r\nINFO [08-23|17:44:53.176] Maximum peer count                       ETH=50 LES=0 total=50\r\nWARN [08-23|17:44:53.176] Option nousb is deprecated and USB is deactivated by default. Use --usb to enable \r\nINFO [08-23|17:44:53.177] Global gas cap disabled \r\nINFO [08-23|17:44:53.177] Allocated trie memory caches             clean=154.00MiB dirty=256.00MiB\r\nINFO [08-23|17:44:53.177] Allocated cache and file handles         database=/Users/akinyemiakindele/Downloads/go-ethereum-latest/build/bin/data/geth/chaindata cache=512.00MiB handles=5120\r\nINFO [08-23|17:44:53.379] Opened ancient database                  database=/Users/akinyemiakindele/Downloads/go-ethereum-latest/build/bin/data/geth/chaindata/ancient readonly=false\r\nINFO [08-23|17:44:53.380] Initialised chain configuration          config=\"{ChainID: 200 Homestead: 0 DAO: <nil> DAOSupport: false EIP150: 0 EIP155: 0 EIP158: 0 Byzantium: 0 Constantinople: 0 Petersburg: 0 Istanbul: 0, Muir Glacier: <nil>, Berlin: <nil>, London: <nil>, Engine: clique}\"\r\nINFO [08-23|17:44:53.381] Initialising Ethereum protocol           network=200 dbversion=8\r\nINFO [08-23|17:44:53.382] Loaded most recent local header          number=0 hash=773cee..a7059e td=1 age=11mo2w3d\r\nINFO [08-23|17:44:53.382] Loaded most recent local full block      number=0 hash=773cee..a7059e td=1 age=11mo2w3d\r\nINFO [08-23|17:44:53.382] Loaded most recent local fast block      number=0 hash=773cee..a7059e td=1 age=11mo2w3d\r\nWARN [08-23|17:44:53.382] Loaded snapshot journal                  diskroot=e1372c..239798 diffs=missing\r\nINFO [08-23|17:44:53.383] Gasprice oracle is ignoring threshold set threshold=2\r\nnumber is  1\r\nWARN [08-23|17:44:53.384] Unclean shutdown detected                booted=2021-08-23T17:30:01+0400 age=14m52s\r\nWARN [08-23|17:44:53.384] Unclean shutdown detected                booted=2021-08-23T17:43:40+0400 age=1m13s\r\nINFO [08-23|17:44:53.384] Starting peer-to-peer node               instance=Geth/v1.10.7-stable-12f0ff40/darwin-amd64/go1.13.4\r\npanic: runtime error: integer divide by zero\r\n\r\ngoroutine 103 [running]:\r\ngithub.com/ethereum/go-ethereum/consensus/clique.(*Snapshot).inturn(0xc000226070, 0x1, 0x0, 0x0, 0x0, 0x5d4cf20)\r\n        github.com/ethereum/go-ethereum@/consensus/clique/snapshot.go:327 +0x18d\r\ngithub.com/ethereum/go-ethereum/consensus/clique.calcDifficulty(0xc000226070, 0x0, 0x0, 0x0, 0xbebffa7ceee3c77)\r\n        github.com/ethereum/go-ethereum@/consensus/clique/clique.go:682 +0x67\r\ngithub.com/ethereum/go-ethereum/consensus/clique.(*Clique).Prepare(0xc000120850, 0x52d7000, 0xc00037e000, 0xc0000de000, 0x9e05a7439da6001e, 0x0)\r\n        github.com/ethereum/go-ethereum@/consensus/clique/clique.go:539 +0x43f\r\ngithub.com/ethereum/go-ethereum/miner.(*worker).commitNewWork(0xc0004f58c0, 0xc000422000, 0x0, 0x6123a655)\r\n        github.com/ethereum/go-ethereum@/miner/worker.go:920 +0x397\r\ngithub.com/ethereum/go-ethereum/miner.(*worker).mainLoop(0xc0004f58c0)\r\n        github.com/ethereum/go-ethereum@/miner/worker.go:456 +0xcd5\r\ncreated by github.com/ethereum/go-ethereum/miner.newWorker\r\n        github.com/ethereum/go-ethereum@/miner/worker.go:228 +0x525\r\n\r\n[backtrace]\r\n````\r\n\r\nI checked the code, and it seems to me that `Snapshot.signers()` is null or empty and because of that it is doing `number % uint64(len(signers))` causing it to divide by zero. I just want to start geth, is there anything i am doing wrong?\r\n```\r\n// inturn returns if a signer at a given block height is in-turn or not.\r\nfunc (s *Snapshot) inturn(number uint64, signer common.Address) bool {\r\n\tsigners, offset := s.signers(), 0\r\n\tfor offset < len(signers) && signers[offset] != signer {\r\n\t\toffset++\r\n\t}\r\n\treturn (number % uint64(len(signers))) == uint64(offset)\r\n}\r\n```",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23438/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23438/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/903852238",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23438#issuecomment-903852238",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23438",
    "id": 903852238,
    "node_id": "IC_kwDOAOvK984137DO",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-23T15:00:48Z",
    "updated_at": "2021-08-23T15:00:48Z",
    "author_association": "MEMBER",
    "body": "My guess is that your `dev.json` is configured to be a Clique network with 0 signers. You'll need to have at least 1 signer in the genesis spec. Generating a clique generis is easier with `puppeth`.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/903852238/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
