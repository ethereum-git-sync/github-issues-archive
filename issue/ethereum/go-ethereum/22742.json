{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22742",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22742/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22742/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22742/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/22742",
  "id": 868382881,
  "node_id": "MDU6SXNzdWU4NjgzODI4ODE=",
  "number": 22742,
  "title": "ERROR gasused and blockchain sync was stucked",
  "user": {
    "login": "wangjunasd",
    "id": 4216411,
    "node_id": "MDQ6VXNlcjQyMTY0MTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4216411?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wangjunasd",
    "html_url": "https://github.com/wangjunasd",
    "followers_url": "https://api.github.com/users/wangjunasd/followers",
    "following_url": "https://api.github.com/users/wangjunasd/following{/other_user}",
    "gists_url": "https://api.github.com/users/wangjunasd/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wangjunasd/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wangjunasd/subscriptions",
    "organizations_url": "https://api.github.com/users/wangjunasd/orgs",
    "repos_url": "https://api.github.com/users/wangjunasd/repos",
    "events_url": "https://api.github.com/users/wangjunasd/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wangjunasd/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-04-27T02:36:46Z",
  "updated_at": "2021-10-20T06:24:40Z",
  "closed_at": "2021-10-20T06:24:40Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `geth 1.10.2`\r\nOS & Version: Linux\r\nCommit hash : \r\n\r\n#### Expected behaviour\r\nvalid gas used (remote: 14974234)\r\n\r\n#### Actual behaviour\r\nError: invalid gas used (remote: 14974234 local: 14858167)\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n````\r\nINFO [04-27|09:21:45.993] Loaded most recent local header          number=12317448 hash=\"ebd7a7…e37d1e\" td=23817217690060155471174 age=7h21m20s\r\nINFO [04-27|09:21:45.993] Loaded most recent local full block      number=12317448 hash=\"ebd7a7…e37d1e\" td=23817217690060155471174 age=7h21m20s\r\nINFO [04-27|09:21:45.993] Loaded most recent local fast block      number=12317448 hash=\"ebd7a7…e37d1e\" td=23817217690060155471174 age=7h21m20s\r\n````\r\n\r\nThe bug transaction hash is 0xf8b637da81026cab168afd380b50006383823f65adb09355c3f30967ecae570e\r\nand my geth calc to result is 29107, but remote is 145174..\r\n\r\nOur geth's mode was snap on sync start, and, change to fast when sync end. Maybe this has something to do with it\r\n\r\n#### Backtrace\r\n\r\n````\r\nERROR[04-27|08:35:09.559]\r\n########## BAD BLOCK #########\r\nChain config: {ChainID: 1 Homestead: 1150000 DAO: 1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000 Byzantium: 4370000 Constantinople: 7280000 Petersburg: 7280000 Istanbul: 9069000, Muir Glacier: 9200000, Berlin: 12244000, YOLO v3: <nil>, Engine: ethash}\r\n\r\nNumber: 12317449\r\nHash: 0x6e0670a8c3912e1d3014c0bf45e8e5d6337a71129430e3579774ce95af094d93\r\n\r\n 101: cumulative: 4395492 gas: 29107 contract: 0x0000000000000000000000000000000000000000 status: 0 tx: 0xf8b637da81026cab168afd380b50006383823f65adb09355c3f30967ecae570e logs: [] bloom: 0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000                                                                                                                           00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000                                                                                                                           00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 state:\r\n\r\nError: invalid gas used (remote: 14974234 local: 14858167)\r\n##############################\r\n````\r\n",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22742/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22742/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/829002139",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22742#issuecomment-829002139",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22742",
    "id": 829002139,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyOTAwMjEzOQ==",
    "user": {
      "login": "ligi",
      "id": 111600,
      "node_id": "MDQ6VXNlcjExMTYwMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ligi",
      "html_url": "https://github.com/ligi",
      "followers_url": "https://api.github.com/users/ligi/followers",
      "following_url": "https://api.github.com/users/ligi/following{/other_user}",
      "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
      "organizations_url": "https://api.github.com/users/ligi/orgs",
      "repos_url": "https://api.github.com/users/ligi/repos",
      "events_url": "https://api.github.com/users/ligi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ligi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-29T07:25:26Z",
    "updated_at": "2021-04-29T07:25:26Z",
    "author_association": "MEMBER",
    "body": "Can you please provide more log (especially of the start) ?\r\nDid you have a crash or unclean shutdown of geth before?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/829002139/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/829022796",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22742#issuecomment-829022796",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22742",
    "id": 829022796,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyOTAyMjc5Ng==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-29T07:59:11Z",
    "updated_at": "2021-04-29T07:59:11Z",
    "author_association": "MEMBER",
    "body": "This is the block: https://etherscan.io/block/12317449\r\nThis is the transaction: https://etherscan.io/tx/0xf8b637da81026cab168afd380b50006383823f65adb09355c3f30967ecae570e\r\n\r\nThe error: \r\n```\r\nError: invalid gas used (remote: 14974234 local: 14858167)\r\n```\r\nThat error is for the _block_, not the tx itself. The extra info about tx number `101` comes from a post-processing step, when we report the block. In this step, we look at the receipts and compare against the external receipts. \r\n\r\nIt looks here like the tx in the local execution has `29107` gas used. It looks like you cropped the other receipts from the output? \r\n\r\nMy speculation would be that your node database is a bit corrupt, and does not have contract `0x465cd370132d6ac57aed9c0be84af00fde0753c0` in the database, thus the execution only\r\n\r\nThe intrinsic gas for that transaction is `21668`, so it's a bit odd that it reports `29107` if the contract were not there. \r\n\r\nSo, to investigate this further, we could do two things. One would be `debug.standardTraceBadBlock(\"0x6e0670a8c3912e1d3014c0bf45e8e5d6337a71129430e3579774ce95af094d93\")`. This will spit out the full trace of the execution into your tmp-folder. \r\n\r\nAnother would be to check if the contract destination seems to exist: `eth.getCode(\"0x465cd370132d6ac57aed9c0be84af00fde0753c0\")`\r\n\r\nWe should also investigate a bit for possible corner-cases when switching between `snap` and `fast` sync mode. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/829022796/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/830783052",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22742#issuecomment-830783052",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22742",
    "id": 830783052,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzMDc4MzA1Mg==",
    "user": {
      "login": "wangjunasd",
      "id": 4216411,
      "node_id": "MDQ6VXNlcjQyMTY0MTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4216411?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wangjunasd",
      "html_url": "https://github.com/wangjunasd",
      "followers_url": "https://api.github.com/users/wangjunasd/followers",
      "following_url": "https://api.github.com/users/wangjunasd/following{/other_user}",
      "gists_url": "https://api.github.com/users/wangjunasd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wangjunasd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wangjunasd/subscriptions",
      "organizations_url": "https://api.github.com/users/wangjunasd/orgs",
      "repos_url": "https://api.github.com/users/wangjunasd/repos",
      "events_url": "https://api.github.com/users/wangjunasd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wangjunasd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-02T10:05:52Z",
    "updated_at": "2021-05-02T10:05:52Z",
    "author_association": "NONE",
    "body": "This error occurs on a normal node.  When the error occurs,  the node is operating normally,  and there is no abnormal shutdown, etc., which may cause database damage.  Then I shut down the node normally and started it ,  Still so that.\r\n\r\nIt seems that as mentioned above,  the content of the contract does not exist.  This situation can only be solved by deleting all the data and resynchronizing.\r\n\r\nAnd, this situation has occurred twice on different nodes.  I have asked other mining pools and they do not have this situation,\r\n so I think that after the synchronization mode snap and fast are switched, database data errors may occur. My previous operation was to synchronize with snap first. After the synchronization was finished, change to fast mode and close snap.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/830783052/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/833347198",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22742#issuecomment-833347198",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22742",
    "id": 833347198,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzMzM0NzE5OA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-06T08:42:09Z",
    "updated_at": "2021-05-06T08:42:09Z",
    "author_association": "MEMBER",
    "body": "It would be useful if you gave us the exact commands that you used, for example when you say \"snap on sync start, and, change to fast when sync end\". What does \"when sync end\" mean, and exactly how did you change it? \r\n\r\nDid you verify any of the commands I posted before you resynced? \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/833347198/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/833347635",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22742#issuecomment-833347635",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22742",
    "id": 833347635,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzMzM0NzYzNQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-06T08:42:46Z",
    "updated_at": "2021-05-06T08:42:46Z",
    "author_association": "MEMBER",
    "body": "It's a bit hard to make heads or tails of this issue because there's not much to go from. If you could give us a lot more logs that happened before and after the bad blocks, that would be helpful. It would also allow us to see what Geth was doing without having to ask about it and potentially lost some valuable information.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/833347635/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/947366003",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22742#issuecomment-947366003",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22742",
    "id": 947366003,
    "node_id": "IC_kwDOAOvK9844d6hz",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-20T06:24:40Z",
    "updated_at": "2021-10-20T06:24:40Z",
    "author_association": "MEMBER",
    "body": "Can't do anything here, not much info to go on",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/947366003/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
