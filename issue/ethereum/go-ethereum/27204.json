{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27204",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27204/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27204/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27204/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/27204",
  "id": 1691041057,
  "node_id": "I_kwDOAOvK985kyz0h",
  "number": 27204,
  "title": "Frequent desynchronizations - Failed to clean stale beacon headers",
  "user": {
    "login": "PanosChtz",
    "id": 5301283,
    "node_id": "MDQ6VXNlcjUzMDEyODM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5301283?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/PanosChtz",
    "html_url": "https://github.com/PanosChtz",
    "followers_url": "https://api.github.com/users/PanosChtz/followers",
    "following_url": "https://api.github.com/users/PanosChtz/following{/other_user}",
    "gists_url": "https://api.github.com/users/PanosChtz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/PanosChtz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/PanosChtz/subscriptions",
    "organizations_url": "https://api.github.com/users/PanosChtz/orgs",
    "repos_url": "https://api.github.com/users/PanosChtz/repos",
    "events_url": "https://api.github.com/users/PanosChtz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/PanosChtz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-05-01T16:36:33Z",
  "updated_at": "2023-05-08T07:48:32Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 1.11.5\r\nCL client & version: nimbus 23.3.2\r\nOS & Version: Ubuntu 20.04 LTS\r\n\r\n#### Expected behaviour\r\nGeth remaining in sync.\r\n\r\n#### Actual behaviour\r\nDesynchronizing and missing attestations very frequently, counted 13 times over the last 48 hours\r\n\r\n#### Steps to reproduce the behaviour\r\nN/Î‘\r\n\r\n#### Backtrace\r\nSome recent logs when this desync happened:\r\n````\r\nApr 26 12:51:40 validator geth[1732613]: INFO [04-26|12:51:40.374] Imported new potential chain segment     number=17,130,514 hash=a61584..9bbf0b blocks=1 txs=264  mgas=22.084  elapsed=488.564ms    mgasps=45.201  dirty=510.78MiB\r\nApr 26 12:51:47 validator geth[1732613]: INFO [04-26|12:51:47.082] Chain head was updated                   number=17,130,514 hash=a61584..9bbf0b root=7f17cf..f52061 elapsed=28.596779ms\r\nApr 26 12:52:49 validator geth[1732613]: WARN [04-26|12:52:49.548] Ignoring payload with missing parent     number=17,130,520 hash=96fe98..1b2575 parent=1c7ddb..15cd97\r\nApr 26 12:52:50 validator geth[1732613]: INFO [04-26|12:52:50.319] Forkchoice requested sync to new head    number=17,130,520 hash=96fe98..1b2575 finalized=unknown\r\nApr 26 12:52:50 validator geth[1732613]: WARN [04-26|12:52:50.321] Beacon chain gapped                      head=17,130,471 newHead=17,130,520\r\nApr 26 12:52:50 validator geth[1732613]: INFO [04-26|12:52:50.573] Syncing beacon headers                   downloaded=320 left=0 eta=0s\r\nApr 26 12:52:50 validator geth[1732613]: ERROR[04-26|12:52:50.578] Failed to clean stale beacon headers     err=\"filled header below beacon header tail: 17130471 < 17130515\"\r\nApr 26 12:52:50 validator geth[1732613]: WARN [04-26|12:52:50.607] Retrieved pivot header from local        number=17,130,456 hash=c7327e..dec849 latest=17,130,520 oldest=17,130,515\r\nApr 26 12:52:54 validator geth[1732613]: INFO [04-26|12:52:54.650] Imported new chain segment               number=17,130,520 hash=96fe98..1b2575 blocks=6 txs=885  mgas=74.090  elapsed=3.575s       mgasps=20.719  dirty=510.28MiB\r\n...\r\nApr 26 17:57:37 validator geth[1732613]: WARN [04-26|17:57:37.863] Ignoring payload with missing parent     number=17,132,032 hash=b04aa1..b5cc33 parent=dfb7ec..0261ed\r\nApr 26 17:57:39 validator geth[1732613]: INFO [04-26|17:57:39.179] Forkchoice requested sync to new head    number=17,132,032 hash=b04aa1..b5cc33 finalized=unknown\r\nApr 26 17:57:39 validator geth[1732613]: WARN [04-26|17:57:39.182] Beacon chain gapped                      head=17,131,918 newHead=17,132,032\r\nApr 26 17:57:40 validator geth[1732613]: INFO [04-26|17:57:40.626] Syncing beacon headers                   downloaded=339 left=0 eta=0s\r\nApr 26 17:57:40 validator geth[1732613]: ERROR[04-26|17:57:40.633] Failed to clean stale beacon headers     err=\"filled header below beacon header tail: 17131918 < 17132024\"\r\nApr 26 17:57:41 validator geth[1732613]: WARN [04-26|17:57:41.012] Retrieved pivot header from local        number=17,131,968 hash=94a8f5..d750eb latest=17,132,032 oldest=17,132,024\r\nApr 26 17:57:45 validator geth[1732613]: INFO [04-26|17:57:45.233] Chain reorg detected                     number=17,132,022 hash=5dbf2d..f3ff48 drop=1 dropfrom=38e33a..324257 add=2 addfrom=7d90b5..f816fb\r\nApr 26 17:57:49 validator geth[1732613]: WARN [04-26|17:57:49.617] Peer delivering stale transactions       peer=74f473c67422999be06eaedf8f327f9ebe0b66d3e7241ac47d67f65e363bf9e7 rejected=128\r\n...\r\nApr 27 11:41:21 validator geth[1732613]: INFO [04-27|11:41:21.147] Imported new chain segment               number=17,137,276 hash=71b671..41061a blocks=4 txs=578  mgas=62.225  elapsed=5.150s       mgasps=12.082  dirty=511.06MiB\r\nApr 27 11:41:23 validator geth[1732613]: INFO [04-27|11:41:23.480] Forkchoice requested sync to new head    number=17,137,279 hash=7a119b..b15ec0 finalized=unknown\r\nApr 27 11:41:23 validator geth[1732613]: WARN [04-27|11:41:23.522] Beacon chain gapped                      head=17,137,277 newHead=17,137,279\r\nApr 27 11:41:23 validator geth[1732613]: ERROR[04-27|11:41:23.736] Cleaning spurious beacon sync leftovers  stale_head_1=17,137,277 stale_tail_1=17,137,276 stale_next_1=07b2bd..52529d\r\nApr 27 11:41:23 validator geth[1732613]: INFO [04-27|11:41:23.738] Syncing beacon headers                   downloaded=388 left=0 eta=0s\r\nApr 27 11:41:23 validator geth[1732613]: ERROR[04-27|11:41:23.740] Failed to clean stale beacon headers     err=\"filled header below beacon header tail: 17137276 < 17137277\"\r\nApr 27 11:41:23 validator geth[1732613]: WARN [04-27|11:41:23.868] Retrieved pivot header from local        number=17,137,215 hash=8f4ae1..3415d9 latest=17,137,279 oldest=17,137,277\r\nApr 27 11:41:27 validator geth[1732613]: WARN [04-27|11:41:27.399] Ignoring already known beacon payload    number=17,137,278 hash=ff09b8..2a3b38 age=28s\r\nApr 27 11:41:28 validator geth[1732613]: INFO [04-27|11:41:28.845] Forkchoice requested sync to new head    number=17,137,280 hash=453a08..82fb0c finalized=unknown\r\n...\r\nMay 01 15:45:39 validator geth[1732613]: INFO [05-01|15:45:39.001] Forkchoice requested sync to new head    number=17,166,952 hash=71c82e..10dbb1 finalized=unknown\r\nMay 01 15:45:39 validator geth[1732613]: WARN [05-01|15:45:39.007] Beacon chain gapped                      head=17,166,936 newHead=17,166,952\r\nMay 01 15:45:39 validator geth[1732613]: INFO [05-01|15:45:39.487] Syncing beacon headers                   downloaded=575 left=0 eta=0s\r\nMay 01 15:45:39 validator geth[1732613]: ERROR[05-01|15:45:39.496] Failed to clean stale beacon headers     err=\"filled header below beacon header tail: 17166936 < 17166946\"\r\nMay 01 15:45:39 validator geth[1732613]: WARN [05-01|15:45:39.549] Retrieved pivot header from local        number=17,166,888 hash=827ea6..7fda1f latest=17,166,952 oldest=17,166,946\r\nMay 01 15:45:49 validator geth[1732613]: INFO [05-01|15:45:49.468] Forkchoice requested sync to new head    number=17,166,953 hash=c929ad..97e3c9 finalized=unknown\r\n````\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27204/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27204/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1529930263",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27204#issuecomment-1529930263",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27204",
    "id": 1529930263,
    "node_id": "IC_kwDOAOvK985bMOIX",
    "user": {
      "login": "PanosChtz",
      "id": 5301283,
      "node_id": "MDQ6VXNlcjUzMDEyODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5301283?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/PanosChtz",
      "html_url": "https://github.com/PanosChtz",
      "followers_url": "https://api.github.com/users/PanosChtz/followers",
      "following_url": "https://api.github.com/users/PanosChtz/following{/other_user}",
      "gists_url": "https://api.github.com/users/PanosChtz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/PanosChtz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/PanosChtz/subscriptions",
      "organizations_url": "https://api.github.com/users/PanosChtz/orgs",
      "repos_url": "https://api.github.com/users/PanosChtz/repos",
      "events_url": "https://api.github.com/users/PanosChtz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/PanosChtz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-01T16:38:25Z",
    "updated_at": "2023-05-01T16:38:25Z",
    "author_association": "NONE",
    "body": "A log from nimbus:\r\n\r\n```\r\nMay 01 15:44:11 validator nimbus_beacon_node[1234080]: INF 2023-05-01 15:44:11.001+00:00 Slot start                                 topics=\"beacnde\" slot=6344319 epoch=198259 sync=synced peers=30 head=66e786ed:6344318 finalized=198257:9bd7d165 delay=65us165ns\r\nMay 01 15:44:23 validator nimbus_beacon_node[1234080]: INF 2023-05-01 15:44:23.392+00:00 State replayed                             topics=\"chaindag\" blocks=0 slots=1 current=a1d12164:6344288@6344320 ancestor=169a2994:6344319 target=169a2994:6344319@6344320 ancestorStateRoot=f6301e52 targetStateRoot=603441af found=true assignDur=5s487ms702us197ns replayDur=2s225ms51us868ns\r\nMay 01 15:44:24 validator nimbus_beacon_node[1234080]: INF 2023-05-01 15:44:24.600+00:00 Missed multiple heartbeats                 topics=\"libp2p gossipsub\" heartbeat=GossipSub delay=8s858ms750us978ns hinterval=700ms\r\nMay 01 15:44:24 validator nimbus_beacon_node[1234080]: INF 2023-05-01 15:44:24.802+00:00 Slot end                                   topics=\"beacnde\" slot=6344319 nextActionWait=34s208ms95us148ns nextAttestationSlot=6344323 nextProposalSlot=-1 syncCommitteeDuties=none head=169a2994:6344319\r\nMay 01 15:44:25 validator nimbus_beacon_node[1234080]: INF 2023-05-01 15:44:25.071+00:00 Slot start                                 topics=\"beacnde\" slot=6344320 epoch=198260 sync=synced peers=30 head=169a2994:6344319 finalized=198257:9bd7d165 delay=2s65ms617us214ns\r\nMay 01 15:44:26 validator nimbus_beacon_node[1234080]: WRN 2023-05-01 15:44:26.023+00:00 Failed to exchange transition configuration topics=\"elmon\" url=http://127.0.0.1:8551 err=Timeout\r\nMay 01 15:44:46 validator nimbus_beacon_node[1234080]: INF 2023-05-01 15:44:45.943+00:00 State replayed                             topics=\"chaindag\" blocks=0 slots=1 current=169a2994:6344319 ancestor=169a2994:6344319 target=169a2994:6344319@6344320 ancestorStateRoot=f6301e52 targetStateRoot=603441af found=true assignDur=34us278ns replayDur=19s122ms667us996ns\r\nMay 01 15:44:48 validator nimbus_beacon_node[1234080]: INF 2023-05-01 15:44:48.069+00:00 State replayed                             topics=\"chaindag\" blocks=0 slots=0 current=169a2994:6344319 ancestor=c5057235:6344320 target=c5057235:6344320 ancestorStateRoot=474f4bb2 targetStateRoot=474f4bb2 found=true assignDur=706ms8us577ns replayDur=19ms742us223ns\r\nMay 01 15:44:49 validator nimbus_beacon_node[1234080]: INF 2023-05-01 15:44:49.177+00:00 Missed multiple heartbeats                 topics=\"libp2p gossipsub\" heartbeat=GossipSub delay=21s77ms216us911ns hinterval=700ms\r\nMay 01 15:44:49 validator nimbus_beacon_node[1234080]: WRN 2023-05-01 15:44:49.251+00:00 Discovered new external address but ENR auto update is off topics=\"eth p2p discv5\" majority=some(100.36.126.155:9000) previous=none(Address)\r\nMay 01 15:44:50 validator nimbus_beacon_node[1234080]: INF 2023-05-01 15:44:49.999+00:00 Slot end                                   topics=\"beacnde\" slot=6344320 nextActionWait=9s4ms625us264ns nextAttestationSlot=6344323 nextProposalSlot=-1 syncCommitteeDuties=none head=c5057235:6344320\r\nMay 01 15:44:50 validator nimbus_beacon_node[1234080]: NOT 2023-05-01 15:44:50.192+00:00 Missed expected slot start, catching up    topics=\"beacnde\" delay=15s192ms947us99ns curSlot=6344320 nextSlot=6344320\r\nMay 01 15:44:50 validator nimbus_beacon_node[1234080]: INF 2023-05-01 15:44:50.193+00:00 Slot start                                 topics=\"beacnde\" slot=6344322 epoch=198260 sync=synced/opt peers=30 head=c5057235:6344320 finalized=198258:777a66f0 delay=15s192ms947us99ns\r\nMay 01 15:44:50 validator nimbus_beacon_node[1234080]: INF 2023-05-01 15:44:50.227+00:00 Execution client not in sync; skipping validator duties for now topics=\"beacval\" slot=6344322 headSlot=6344320\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1529930263/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
