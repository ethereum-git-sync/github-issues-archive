{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22097",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22097/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22097/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22097/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/22097",
  "id": 777004054,
  "node_id": "MDU6SXNzdWU3NzcwMDQwNTQ=",
  "number": 22097,
  "title": "Add an option to disable locking so that it can be used as a deployment i k8s",
  "user": {
    "login": "krasi-georgiev",
    "id": 8903888,
    "node_id": "MDQ6VXNlcjg5MDM4ODg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8903888?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/krasi-georgiev",
    "html_url": "https://github.com/krasi-georgiev",
    "followers_url": "https://api.github.com/users/krasi-georgiev/followers",
    "following_url": "https://api.github.com/users/krasi-georgiev/following{/other_user}",
    "gists_url": "https://api.github.com/users/krasi-georgiev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/krasi-georgiev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/krasi-georgiev/subscriptions",
    "organizations_url": "https://api.github.com/users/krasi-georgiev/orgs",
    "repos_url": "https://api.github.com/users/krasi-georgiev/repos",
    "events_url": "https://api.github.com/users/krasi-georgiev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/krasi-georgiev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233652,
      "node_id": "MDU6TGFiZWw3MjIzMzY1Mg==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:feature",
      "name": "type:feature",
      "color": "84b6eb",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-12-31T13:45:29Z",
  "updated_at": "2021-01-01T08:01:52Z",
  "closed_at": "2021-01-01T08:01:52Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Why should this feature exist?\r\nTo allow using geth in kubernetes\r\nIn k8s a deployment rollout creates a second container before deleting the original one so with the file locking this is no possible as the second container can't start. I know that allowing more then a single app to write to the same data folder is dangerous and might lead to corruptions, but with k8s that is the only way AFAIC\r\n\r\n\r\n## What are the use-cases?\r\nHA\r\n\r\n## Implementation\r\n\r\nAre you willing to implement this feature?\r\nYES",
  "closed_by": {
    "login": "krasi-georgiev",
    "id": 8903888,
    "node_id": "MDQ6VXNlcjg5MDM4ODg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8903888?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/krasi-georgiev",
    "html_url": "https://github.com/krasi-georgiev",
    "followers_url": "https://api.github.com/users/krasi-georgiev/followers",
    "following_url": "https://api.github.com/users/krasi-georgiev/following{/other_user}",
    "gists_url": "https://api.github.com/users/krasi-georgiev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/krasi-georgiev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/krasi-georgiev/subscriptions",
    "organizations_url": "https://api.github.com/users/krasi-georgiev/orgs",
    "repos_url": "https://api.github.com/users/krasi-georgiev/repos",
    "events_url": "https://api.github.com/users/krasi-georgiev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/krasi-georgiev/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22097/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22097/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/753058094",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22097#issuecomment-753058094",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22097",
    "id": 753058094,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MzA1ODA5NA==",
    "user": {
      "login": "raohammad",
      "id": 10757983,
      "node_id": "MDQ6VXNlcjEwNzU3OTgz",
      "avatar_url": "https://avatars.githubusercontent.com/u/10757983?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/raohammad",
      "html_url": "https://github.com/raohammad",
      "followers_url": "https://api.github.com/users/raohammad/followers",
      "following_url": "https://api.github.com/users/raohammad/following{/other_user}",
      "gists_url": "https://api.github.com/users/raohammad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/raohammad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/raohammad/subscriptions",
      "organizations_url": "https://api.github.com/users/raohammad/orgs",
      "repos_url": "https://api.github.com/users/raohammad/repos",
      "events_url": "https://api.github.com/users/raohammad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/raohammad/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-31T19:54:24Z",
    "updated_at": "2020-12-31T19:54:24Z",
    "author_association": "NONE",
    "body": "I am running geth based full node in K8s without problems. Probably I\ndidn't have that scenario yet? What can I do to create failure scenario?\n\nThanks,\n\nOn Thu, 31 Dec 2020, 14:46 Krasimir Georgiev, <notifications@github.com>\nwrote:\n\n> Rationale\n>\n> Why should this feature exist?\n> To allow using geth in kubernetes\n> In k8s a deployment rollout creates a second container before deleting the\n> original one so with the file locking this is no possible as the second\n> container can't start. I know that allowing more then a single app to write\n> to the same data folder is dangerous and might lead to corruptions, but\n> with k8s that is the only way AFAIC\n>\n> What are the use-cases?\n> HA\n> Implementation\n>\n> Are you willing to implement this feature?\n> YES\n>\n> â€”\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/ethereum/go-ethereum/issues/22097>, or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/ACSCOX6BFVYIVV3KQUSCFM3SXR6C7ANCNFSM4VPNZF2Q>\n> .\n>\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/753058094/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/753226184",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22097#issuecomment-753226184",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22097",
    "id": 753226184,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MzIyNjE4NA==",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-31T23:42:02Z",
    "updated_at": "2020-12-31T23:42:02Z",
    "author_association": "MEMBER",
    "body": "Disabling the locking for the data directory can be dangerous. It would mean that two different processes would be able to write and change files that are currently in use by the other process. I don't think it would be possible to allow this with the way geth uses the datadir. There are some tutorials that use geth inside kubernetes without a problem e.g. https://messari.io/article/running-an-ethereum-node-on-kubernetes-is-easy",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/753226184/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/753283144",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22097#issuecomment-753283144",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22097",
    "id": 753283144,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MzI4MzE0NA==",
    "user": {
      "login": "krasi-georgiev",
      "id": 8903888,
      "node_id": "MDQ6VXNlcjg5MDM4ODg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8903888?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/krasi-georgiev",
      "html_url": "https://github.com/krasi-georgiev",
      "followers_url": "https://api.github.com/users/krasi-georgiev/followers",
      "following_url": "https://api.github.com/users/krasi-georgiev/following{/other_user}",
      "gists_url": "https://api.github.com/users/krasi-georgiev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/krasi-georgiev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krasi-georgiev/subscriptions",
      "organizations_url": "https://api.github.com/users/krasi-georgiev/orgs",
      "repos_url": "https://api.github.com/users/krasi-georgiev/repos",
      "events_url": "https://api.github.com/users/krasi-georgiev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/krasi-georgiev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-01T08:01:52Z",
    "updated_at": "2021-01-01T08:01:52Z",
    "author_association": "NONE",
    "body": "Thanks, for the link my manifests are almost identical. The problem is when do rolling updates.\r\nFor example if you change anything in the manifest file and do \r\n```\r\nkubectl apply -f deploy.yml\r\n```\r\nWhat happens in the background is that k8s will schedule a new pod with the same data directory but because of the LOCK file this new pod can't start so k8s will never delete the old one.\r\n\r\nLike I said I understand it is dangerous, but don't think there is another way in k8s to set it up so that is deletes the old pod first and only then to create the new one.\r\nhttps://github.com/tellor-io/eth-node\r\n\r\nStrange thing is that I tried it again just now and it seems that this time it managed to do a complete rolling update without any issues.\r\n\r\nclosing and will re-open if needed with more details.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/753283144/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
