{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26493",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26493/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26493/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26493/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/26493",
  "id": 1533211420,
  "node_id": "I_kwDOAOvK985bYvMc",
  "number": 26493,
  "title": "Unclean shutdown throws geth 4-5 days behind",
  "user": {
    "login": "pokrovskyy",
    "id": 1635058,
    "node_id": "MDQ6VXNlcjE2MzUwNTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1635058?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pokrovskyy",
    "html_url": "https://github.com/pokrovskyy",
    "followers_url": "https://api.github.com/users/pokrovskyy/followers",
    "following_url": "https://api.github.com/users/pokrovskyy/following{/other_user}",
    "gists_url": "https://api.github.com/users/pokrovskyy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pokrovskyy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pokrovskyy/subscriptions",
    "organizations_url": "https://api.github.com/users/pokrovskyy/orgs",
    "repos_url": "https://api.github.com/users/pokrovskyy/repos",
    "events_url": "https://api.github.com/users/pokrovskyy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pokrovskyy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-01-14T10:42:43Z",
  "updated_at": "2023-01-16T09:25:29Z",
  "closed_at": "2023-01-16T09:25:28Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth\r\nVersion: 1.10.19-stable\r\nArchitecture: amd64\r\nGo Version: go1.18.4\r\nOperating System: linux (CentOS 9)\r\n\r\n#### Actual behaviour\r\nFirst off, I am using a custom modified geth, however I tend to think the issue is more global. So anytime my geth gets killed for whatever reason (eg. by OOM killer etc.), it complains on head state missing (understandably) and starts 4 to 5 days back (given it's been running for at least this amount of time)\r\n\r\n#### Expected behaviour\r\ngeth should better maintain state so that unclean shutdown does not throw it back so far (it takes considerable amount of time to re-sync and get it back to speed)\r\n\r\n#### Steps to reproduce the behaviour\r\nHave geth running for >4 days. Then SIGKILL it eg. `kill -9 <pid>` and try starting\r\n\r\nNote `age=4d4h41m` in the log excerpt:\r\n```\r\nINFO [01-14|10:40:00.197] Forkchoice requested sync to new head    number=16,404,503 hash=b3ae17..6057e9\r\nINFO [01-14|10:40:05.654] Imported new chain segment               blocks=12    txs=1472      mgas=186.814 elapsed=8.827s    mgasps=21.162 number=16,374,464 hash=00d3ea..1e6ddc age=4d4h41m  dirty=1022.00MiB\r\nINFO [01-14|10:40:12.003] Forkchoice requested sync to new head    number=16,404,504 hash=862adc..e78b9d\r\nINFO [01-14|10:40:16.250] Imported new chain segment               blocks=16    txs=2272      mgas=247.983 elapsed=10.596s   mgasps=23.402 number=16,374,480 hash=553fb6..0ec4c6 age=4d4h38m  dirty=1022.56MiB\r\nINFO [01-14|10:40:24.492] Imported new chain segment               blocks=13    txs=1563      mgas=192.997 elapsed=8.241s    mgasps=23.418 number=16,374,493 hash=a54a08..37d5b4 age=4d4h36m  dirty=1022.70MiB\r\n```",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26493/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26493/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1383623550",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26493#issuecomment-1383623550",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26493",
    "id": 1383623550,
    "node_id": "IC_kwDOAOvK985SeGt-",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-16T08:00:20Z",
    "updated_at": "2023-01-16T08:00:20Z",
    "author_association": "MEMBER",
    "body": "It's expected behavior. \r\n\r\nGeth will maintain dirty states in memory in order to perform in-memory garbage collection algorithm. \r\nThis GC mechanism is vital to reduce the data written into disk.\r\n\r\nBy default, Geth will save the state that needs to be executed for one hour in memory, so state gets\r\nrewound the past in case of unclean shutdown happens.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1383623550/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1383729114",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26493#issuecomment-1383729114",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26493",
    "id": 1383729114,
    "node_id": "IC_kwDOAOvK985Segfa",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-16T09:25:28Z",
    "updated_at": "2023-01-16T09:25:28Z",
    "author_association": "MEMBER",
    "body": "It's unfortunate, but expected. Try to alway shut down geth gracefully (giving it up to 2 minutes)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1383729114/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
