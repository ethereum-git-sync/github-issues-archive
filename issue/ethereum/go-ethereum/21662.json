{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21662",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21662/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21662/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21662/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/21662",
  "id": 715039512,
  "node_id": "MDU6SXNzdWU3MTUwMzk1MTI=",
  "number": 21662,
  "title": "eth/tracers: call tracer doesn't work properly for some edge cases",
  "user": {
    "login": "bulgakovk",
    "id": 8983736,
    "node_id": "MDQ6VXNlcjg5ODM3MzY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8983736?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bulgakovk",
    "html_url": "https://github.com/bulgakovk",
    "followers_url": "https://api.github.com/users/bulgakovk/followers",
    "following_url": "https://api.github.com/users/bulgakovk/following{/other_user}",
    "gists_url": "https://api.github.com/users/bulgakovk/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bulgakovk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bulgakovk/subscriptions",
    "organizations_url": "https://api.github.com/users/bulgakovk/orgs",
    "repos_url": "https://api.github.com/users/bulgakovk/repos",
    "events_url": "https://api.github.com/users/bulgakovk/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bulgakovk/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-10-05T17:48:14Z",
  "updated_at": "2020-10-26T16:09:47Z",
  "closed_at": "2020-10-22T08:56:49Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "`callTracer` seems to incorrectly parse some edge contract creation cases.\r\n\r\n#### System information\r\n\r\nGeth version: `1.9.22`\r\nOS & Version: Linux\r\n\r\n#### Expected behaviour\r\n\r\nTwo traces should have two different errors to reflect happened internal transfers.\r\n\r\n#### Actual behaviour\r\n\r\nTrace of `0x47bf53491a14e64bc8938afa97d4b012677f465bddd7c3c0bbfb5df2baa99127` (_TX1_) has the same error (`contract creation code storage out of gas`) as `0x549261429725c180c4b6a007d0e1b03d58c4145395250685a0dce4f7dbc1bb46` (_TX2_). However, contract was successfully created and internal transfer happened within _TX2_ what it's not true for _TX1_. Seems their traces should be different to reflect the difference.\r\n\r\n#### Steps to reproduce the behaviour\r\nMake RPC calls for two TXs:\r\n```\r\ncurl --location --request POST 'http://localhost:8545' \\\r\n--header 'Content-Type: application/json' \\\r\n--data-raw '{\r\n    \"id\": 1,\r\n    \"method\": \"debug_traceTransaction\",\r\n    \"params\": [<TX HASH>, { \"tracer\": \"callTracer\" }]\r\n}'\r\n```\r\nand compare them. For internal transfers info I was using [etherscan](https://etherscan.io/tx/0x47bf53491a14e64bc8938afa97d4b012677f465bddd7c3c0bbfb5df2baa99127#statechange)\r\n",
  "closed_by": {
    "login": "ligi",
    "id": 111600,
    "node_id": "MDQ6VXNlcjExMTYwMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ligi",
    "html_url": "https://github.com/ligi",
    "followers_url": "https://api.github.com/users/ligi/followers",
    "following_url": "https://api.github.com/users/ligi/following{/other_user}",
    "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
    "organizations_url": "https://api.github.com/users/ligi/orgs",
    "repos_url": "https://api.github.com/users/ligi/repos",
    "events_url": "https://api.github.com/users/ligi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ligi/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21662/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21662/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/704656693",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21662#issuecomment-704656693",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21662",
    "id": 704656693,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDY1NjY5Mw==",
    "user": {
      "login": "tjayrush",
      "id": 5417918,
      "node_id": "MDQ6VXNlcjU0MTc5MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5417918?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tjayrush",
      "html_url": "https://github.com/tjayrush",
      "followers_url": "https://api.github.com/users/tjayrush/followers",
      "following_url": "https://api.github.com/users/tjayrush/following{/other_user}",
      "gists_url": "https://api.github.com/users/tjayrush/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tjayrush/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tjayrush/subscriptions",
      "organizations_url": "https://api.github.com/users/tjayrush/orgs",
      "repos_url": "https://api.github.com/users/tjayrush/repos",
      "events_url": "https://api.github.com/users/tjayrush/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tjayrush/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T02:36:57Z",
    "updated_at": "2020-10-07T02:36:57Z",
    "author_association": "NONE",
    "body": "A note. When you change the file `./call_tracer.js` in `./eth/tracers/internal/tracers/` you have to also autogenerate the corresponding `assets.go` file otherwise the changes don't take effect. I posted this PR against TurboGeth, but I think the same is true of Geth as well. https://github.com/ledgerwatch/turbo-geth/pull/1197. The autogenerate line is documented in the PR.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/704656693/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/709113988",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21662#issuecomment-709113988",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21662",
    "id": 709113988,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwOTExMzk4OA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-15T10:27:28Z",
    "updated_at": "2020-10-15T10:27:28Z",
    "author_association": "MEMBER",
    "body": "```\r\n> debug.traceTransaction(\"0x47bf53491a14e64bc8938afa97d4b012677f465bddd7c3c0bbfb5df2baa99127\", {tracer: \"callTracer\"})\r\n{\r\n  error: \"contract creation code storage out of gas\",\r\n  from: \"0xca5fdcfed26afbcc2526139ff941b8a5ddc4483e\",\r\n  gas: \"0x44c58\",\r\n  gasUsed: \"0x44c58\",\r\n  input: \"0x6060604052604051610a00380380610a008339810160405280510160008054600160a060020a031916331790558060016000509080519060200190828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10609f57805160ff19168380011785555b50608e9291505b8082111560cc57600081558301607d565b505050610930806100d06000396000f35b828001600101855582156076579182015b82811115607657825182600050559160200191906001019060b0565b5090566060604052361561004b5760e060020a60003504632c531258811461010057806341c0e1b51461015c5780638da5cb5b14610179578063c5e579851461018b578063f2fde38b146101e8575b60408051602081810183526000808352835180850190945260028085527f696e0000000000000000000000000000000000000000000000000000000000009483019485526006805492819052855160ff191660041781556102089590937ff652222313e28459528d920b65115c16c04f3efc82aaedc97be59f3f377c0d3f60018516156101000260001901909416839004601f010483019290506102769291505b808211156102fc57600081556001016100ec565b6102086004356024356040805160208101909152600081526002548311156106a8575060408051808201909152601c81527f6572726f722030313a20696e73756666696369656e742066756e64730000000060208201526106a2565b6105ae600054600160a060020a033381169116146105e257610002565b6105b0600054600160a060020a031681565b60408051600180546020600282841615610100026000190190921691909104601f8101829004820284018201909452838352610208939083018282801561061b5780601f106105f05761010080835404028352916020019161061b565b6105ae600435600054600160a060020a033381169116146105cd57610002565b60405180806020018281038252838181518152602001915080519060200190808383829060006004602084601f0104600f02600301f150905090810190601f1680156102685780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b50503460075560098054600160a060020a03199081163317909155600054600a8054909216600160a060020a0391909116179055600b80546001810180835582818380158290116103005760008390526103009060069081027f0175b7a638427703f0dbe7bb9bbf987a2551717b34e79f33b5b1008d1fa01db9908101918402016103b6565b5090565b5050509190906000526020600020906006020160006005600050909190915060008201600050816000016000509080546001816001161561010002031660029004828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061045157805485555b5061048d9291506100ec565b50506000600282018190556003820155600481018054600160a060020a031990811690915560058201805490911690556001015b808211156102fc57600060008201600050805460018160011615610100020316600290046000825580601f1061041557505b5060018201600050805460018160011615610100020316600290046000825580601f106104335750610382565b601f0160209004906000526020600020908101906103e891906100ec565b601f01602090049060005260206000209081019061038291906100ec565b8280016001018555821561037657600052602060002091601f016020900482015b82811115610376578254825591600101919060010190610472565b505060018201600050816001016000509080546001816001161561010002031660029004828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106104f257805485555b5061052e9291506100ec565b828001600101855582156104e657600052602060002091601f016020900482015b828111156104e6578254825591600101919060010190610513565b505060028281015482820155600383810154908301556004838101549083018054600160a060020a0319908116600160a060020a03938416179091556005948501549390940180549094169216919091179091558054340190555050604080518082019091526007815260c860020a667375636365737302602082015290565b005b60408051600160a060020a03929092168252519081900360200190f35b60008054600160a060020a0319168217905550565b600054600160a060020a0316ff5b820191906000526020600020905b8154815290600101906020018083116105fe57829003601f168201915b505050505081565b505060028281015482820155600383810154908301556004838101549083018054600160a060020a0319908116600160a060020a0393841617909155600594850154939094018054909416921691909117909155805434900390555050604080518082019091526007815260c860020a66737563636573730260208201525b92915050565b604051600160a060020a03831690600090859082818181858883f1935050505050600b60005080548060010182818154818355818115116107025760060281600602836000526020600020918201910161070291906107b8565b5050509190906000526020600020906006020160006005600050909190915060008201600050816000016000509080546001816001161561010002031660029004828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f1061085357805485555b5061088f9291506100ec565b50506000600282018190556003820155600481018054600160a060020a031990811690915560058201805490911690556001015b808211156102fc57600060008201600050805460018160011615610100020316600290046000825580601f1061081757505b5060018201600050805460018160011615610100020316600290046000825580601f106108355750610784565b601f0160209004906000526020600020908101906107ea91906100ec565b601f01602090049060005260206000209081019061078491906100ec565b8280016001018555821561077857600052602060002091601f016020900482015b82811115610778578254825591600101919060010190610874565b505060018201600050816001016000509080546001816001161561010002031660029004828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f106108f457805485555b506106239291506100ec565b828001600101855582156108e857600052602060002091601f016020900482015b828111156108e8578254825591600101919060010190610915560000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000000c4772616e64204361796d616e0000000000000000000000000000000000000000\",\r\n  time: \"920.064µs\",\r\n  to: \"0x1cb2560d17379e3c1d90f5e29d8a93848d1e59cb\",\r\n  type: \"CREATE\",\r\n  value: \"0x470de4df820000\"\r\n}\r\n```\r\n```\r\n> debug.traceTransaction(\"0x549261429725c180c4b6a007d0e1b03d58c4145395250685a0dce4f7dbc1bb46\", {tracer: \"callTracer\", reexec:100000})\r\n{\r\n  error: \"contract creation code storage out of gas\",\r\n  from: \"0x326be8f71bfb0379f989aab1cc1fe37f0a771f60\",\r\n  gas: \"0x285dc\",\r\n  gasUsed: \"0x9e54\",\r\n  input: \"0x60606040526000805433600160a060020a0319918216811783556001805490921617905561067c90819061003390396000f300606060405236156100b95760e060020a600035046303750d9481146100bb57806306b5f02d146100e15780630e1da6c3146100ff5780630f06670a1461010c5780632d9a37d31461013b5780632e1a7d4d1461015457806355b775ea14610177578063839930ba1461019a5780638d216186146101a4578063a094a031146101d5578063add4c78414610201578063bd66528a14610230578063cb96012e14610260578063d8389dc514610271578063da9328561461028e575b005b6100b9600435602435600154600160a060020a039081163391909116146103a457610369565b6102ba6004356024355b606460628302046101000281900492915050565b6100b96000610628610292565b6102ba600435600160a060020a03331660009081526002602052604081206004810154821415610442576103f6565b6102ba5b606430600160a060020a031631600502045b90565b6100b9600435600054600160a060020a0390811633919091161461065557610625565b6100b9600435600054600160a060020a0390811633919091161461063357610625565b6102ba6000610151565b6100b960043560243560018210806101bc575060ff82115b806101c75750600034105b8061036f575061039a61013f565b6102ba600160a060020a033316600090815260026020526040812060048101548214156103ea576103ef565b6102ba600435600160a060020a033316600090815260026020526040812060048101548214156103fc576103f6565b6100b9600435600160a060020a03331660009081526002602052604081206004810154909114156104a557610369565b6102ba6004355b60ff81165b919050565b6102ba60043560408051828152905190819003602001902061026c565b6102ba5b600160a060020a0333166000908152600260205260408120600481015482146105a6576103ef565b60408051918252519081900360200190f35b6040805160a0810182523480825260208281018681524384860190815260608501878152600060808701818152600160a060020a0333168083526002808852928a90209851895594516001890155925190870155516003860155516004949094019390935583519182528101859052825191927ff41b7910e085d0992d604fd470931728fd77cc8eb504d99e50e51a0a30fcfd1a92918290030190a25b5050565b115b156102cc57604051600160a060020a03331690600090349082818181858883f1935050505050610369565b61036d34846100eb565b600160a060020a038216600090815260026020526040812060040154146103ca57610369565b600160a060020a0391909116600090815260026020526040902060040155565b600191505b5090565b91505b50919050565b60408051600383015485825291519081900360200190201461041d576103f6565b604080516004830154858252602082015281519081900390910190206103f390610267565b604080516003830154858252915190819003602001902014610463576103f6565b60408051600183015460048401548683526020830152825191829003909201902061048d90610267565b101561049c57600191506103f6565b600091506103f6565b6040805160038301548482529151908190036020019020146104c657610369565b6040805160018301546004840154858352602083015282519182900390920190206104f090610267565b101561056d5780546001820154600160a060020a0333169160009161051591906100eb565b6040516000818181858888f15084546001860154908252602082015260408051600160a060020a03331695507ffdc49939175858b2bb557093a7d52fa6b6f3aad917d282d61758fab4805f102a945091829003019150a25b600160a060020a033316600090815260026020819052604082208281556001810183905590810182905560038101829055600401555050565b8054600090116105b957600091506103ef565b60028101546014014310156103ea57600091506103ef565b50600160a060020a03331660008181526002602052604080822080549151909392919082818181858883f1505050908152600260208190528183556001830182905582018190556003820181905560048201555b50565b15156105d157610625565b6001805473ffffffffffffffffffffffffffffffffffffffff19168217905550565b60008054604051600160a060020a03919091169190839082818181858883f150505050505056\",\r\n  time: \"340.158µs\",\r\n  to: \"0xae3703584494ade958ad27ec2d289b7a67c19e90\",\r\n  type: \"CREATE\",\r\n  value: \"0xde0b6b3a7640000\"\r\n}\r\n>\r\n```\r\n`0x549261` happend at block `72586`, and `0x47bf5349` at block `1474903`.\r\nAt the early block `72586`, there was a quirk: if the creation failed due to too-low-gas-to-store-code, then\r\nthe state-change was not reverted, but an empty contract was created.\r\n\r\nYou can see that the [actual contract](https://etherscan.io/address/0xae3703584494ade958ad27ec2d289b7a67c19e90) created has no code,\r\nand `1 ether` forever locked up (the `1 ether` was sent during construction).\r\n\r\nSo the tracer is correct, the creation did fail, and return an error. However, it also had a side-effect, which confuses things.\r\n\r\nThis quirk was rectified in Homestead, at block `1150000`. \r\n\r\nI don't know if there's anything we should change here, I think the tracer does \"as expected\" on somewhat quirky rules. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/709113988/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/716652704",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21662#issuecomment-716652704",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21662",
    "id": 716652704,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxNjY1MjcwNA==",
    "user": {
      "login": "bulgakovk",
      "id": 8983736,
      "node_id": "MDQ6VXNlcjg5ODM3MzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8983736?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bulgakovk",
      "html_url": "https://github.com/bulgakovk",
      "followers_url": "https://api.github.com/users/bulgakovk/followers",
      "following_url": "https://api.github.com/users/bulgakovk/following{/other_user}",
      "gists_url": "https://api.github.com/users/bulgakovk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bulgakovk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bulgakovk/subscriptions",
      "organizations_url": "https://api.github.com/users/bulgakovk/orgs",
      "repos_url": "https://api.github.com/users/bulgakovk/repos",
      "events_url": "https://api.github.com/users/bulgakovk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bulgakovk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-26T16:09:47Z",
    "updated_at": "2020-10-26T16:09:47Z",
    "author_association": "NONE",
    "body": "@holiman Thanks for the explanation, it makes much sense now. Agreed, it appears the tracer works correct, I didn't know about this early behaviour.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/716652704/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
