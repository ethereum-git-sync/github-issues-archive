{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22376",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22376/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22376/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22376/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/22376",
  "id": 815783082,
  "node_id": "MDU6SXNzdWU4MTU3ODMwODI=",
  "number": 22376,
  "title": "Peers connecting to different local ports",
  "user": {
    "login": "krychla1",
    "id": 33096727,
    "node_id": "MDQ6VXNlcjMzMDk2NzI3",
    "avatar_url": "https://avatars.githubusercontent.com/u/33096727?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/krychla1",
    "html_url": "https://github.com/krychla1",
    "followers_url": "https://api.github.com/users/krychla1/followers",
    "following_url": "https://api.github.com/users/krychla1/following{/other_user}",
    "gists_url": "https://api.github.com/users/krychla1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/krychla1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/krychla1/subscriptions",
    "organizations_url": "https://api.github.com/users/krychla1/orgs",
    "repos_url": "https://api.github.com/users/krychla1/repos",
    "events_url": "https://api.github.com/users/krychla1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/krychla1/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 268304226,
      "node_id": "MDU6TGFiZWwyNjgzMDQyMjY=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:docs",
      "name": "type:docs",
      "color": "fef2c0",
      "default": false,
      "description": null
    },
    {
      "id": 1380070748,
      "node_id": "MDU6TGFiZWwxMzgwMDcwNzQ4",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/area:p2p",
      "name": "area:p2p",
      "color": "ea9adb",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-02-24T19:38:07Z",
  "updated_at": "2021-10-25T20:39:13Z",
  "closed_at": "2021-10-25T20:39:12Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I have a geth node running on a linux machine with --port 30303 and have set up a firewall (UFW) to allow all outgoing connections, but inbound connections to 30303/udp and 30303/tcp only.\r\n\r\nIâ€™m noticing in my system logs that the firewall is blocking a lot of attempts to connect to other ports on my machine. For example:\r\n```\r\nFeb 24 16:37:48 ---removed--- kernel: [601776.737302] [UFW BLOCK] IN=eno1 OUT= MAC=---removed--- SRC=34.80.166.189 DST=---removed--- LEN=40 TOS=0x00 PREC=0x00 TTL=58 ID=0 DF PROTO=TCP SPT=30303 DPT=37640 WINDOW=0 RES=0x00 RST URGP=0\r\nFeb 24 16:38:20 ---removed--- kernel: [601808.607364] [UFW BLOCK] IN=eno1 OUT= MAC=---removed--- SRC=46.4.192.189 DST=---removed--- LEN=40 TOS=0x00 PREC=0x00 TTL=57 ID=0 DF PROTO=TCP SPT=30303 DPT=43922 WINDOW=0 RES=0x00 RST URGP=0\r\nFeb 24 16:38:41 ---removed--- kernel: [601829.738767] [UFW BLOCK] IN=eno1 OUT= MAC=---removed--- SRC=161.97.120.53 DST=---removed--- LEN=40 TOS=0x00 PREC=0x00 TTL=54 ID=0 DF PROTO=TCP SPT=30303 DPT=38936 WINDOW=0 RES=0x00 RST URGP=0\r\nFeb 24 16:38:59 ---removed--- kernel: [601847.269559] [UFW BLOCK] IN=eno1 OUT= MAC=---removed--- SRC=61.78.78.108 DST=---removed--- LEN=40 TOS=0x00 PREC=0x00 TTL=48 ID=0 DF PROTO=TCP SPT=30306 DPT=45938 WINDOW=0 RES=0x00 RST URGP=0\r\nFeb 24 16:39:20 ---removed--- kernel: [601868.544822] [UFW BLOCK] IN=eno1 OUT= MAC=---removed--- SRC=176.9.99.226 DST=---removed--- LEN=40 TOS=0x00 PREC=0x00 TTL=57 ID=0 DF PROTO=TCP SPT=30303 DPT=59058 WINDOW=0 RES=0x00 RST URGP=0\r\nFeb 24 16:39:29 ---removed--- kernel: [601877.709886] [UFW BLOCK] IN=eno1 OUT= MAC=---removed--- SRC=78.47.194.158 DST=---removed--- LEN=40 TOS=0x00 PREC=0x00 TTL=53 ID=0 DF PROTO=TCP SPT=30303 DPT=50734 WINDOW=0 RES=0x00 RST URGP=0\r\nFeb 24 16:39:56 ---removed--- kernel: [601904.275443] [UFW BLOCK] IN=eno1 OUT= MAC=---removed--- SRC=24.5.40.205 DST=---removed--- LEN=40 TOS=0x00 PREC=0x00 TTL=48 ID=0 DF PROTO=TCP SPT=30303 DPT=42732 WINDOW=0 RES=0x00 RST URGP=0\r\nFeb 24 16:40:17 ---removed--- kernel: [601925.963359] [UFW BLOCK] IN=eno1 OUT= MAC=---removed--- SRC=108.30.122.251 DST=---removed--- LEN=40 TOS=0x00 PREC=0x00 TTL=49 ID=25532 DF PROTO=TCP SPT=30303 DPT=35492 WINDOW=0 RES=0x00 RST URGP=0\r\nFeb 24 16:40:31 ---removed--- kernel: [601939.683622] [UFW BLOCK] IN=eno1 OUT= MAC=---removed--- SRC=91.223.40.200 DST=---removed--- LEN=40 TOS=0x00 PREC=0x00 TTL=52 ID=0 DF PROTO=TCP SPT=30303 DPT=53826 WINDOW=0 RES=0x00 RST URGP=0\r\nFeb 24 16:42:16 ---removed--- kernel: [602044.771557] [UFW BLOCK] IN=eno1 OUT= MAC=---removed--- SRC=35.246.226.30 DST=---removed--- LEN=40 TOS=0x00 PREC=0x00 TTL=59 ID=0 DF PROTO=TCP SPT=33834 DPT=30303 WINDOW=0 RES=0x00 RST URGP=0\r\nFeb 24 16:42:16 ---removed--- kernel: [602044.771584] [UFW BLOCK] IN=eno1 OUT= MAC=---removed--- SRC=35.246.226.30 DST=---removed--- LEN=40 TOS=0x00 PREC=0x00 TTL=59 ID=0 DF PROTO=TCP SPT=33834 DPT=30303 WINDOW=0 RES=0x00 RST URGP=0\r\n\r\n```\r\nHow can we set geth to use only 30303 (or range) for peers, so that the local firewall doesn't go wild?\r\nThank you!\r\n",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22376/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22376/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/785888380",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22376#issuecomment-785888380",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22376",
    "id": 785888380,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NTg4ODM4MA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-25T13:18:03Z",
    "updated_at": "2021-02-25T13:18:03Z",
    "author_association": "MEMBER",
    "body": "The UFW rules looks a bit strange -- how come the last two were blocked? \r\n```\r\nPROTO=TCP SPT=33834 DPT=30303 WINDOW=0 RES=0x00 RST URGP=0\r\nPROTO=TCP SPT=33834 DPT=30303 WINDOW=0 RES=0x00 RST URGP=0\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/785888380/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/785889336",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22376#issuecomment-785889336",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22376",
    "id": 785889336,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NTg4OTMzNg==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-25T13:19:41Z",
    "updated_at": "2021-02-25T13:19:41Z",
    "author_association": "MEMBER",
    "body": "Just checking: are you 100% certain that you have allowed `established` connections? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/785889336/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/785914564",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22376#issuecomment-785914564",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22376",
    "id": 785914564,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NTkxNDU2NA==",
    "user": {
      "login": "krychla1",
      "id": 33096727,
      "node_id": "MDQ6VXNlcjMzMDk2NzI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/33096727?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/krychla1",
      "html_url": "https://github.com/krychla1",
      "followers_url": "https://api.github.com/users/krychla1/followers",
      "following_url": "https://api.github.com/users/krychla1/following{/other_user}",
      "gists_url": "https://api.github.com/users/krychla1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/krychla1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krychla1/subscriptions",
      "organizations_url": "https://api.github.com/users/krychla1/orgs",
      "repos_url": "https://api.github.com/users/krychla1/repos",
      "events_url": "https://api.github.com/users/krychla1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/krychla1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-25T13:58:41Z",
    "updated_at": "2021-02-25T14:04:01Z",
    "author_association": "NONE",
    "body": "Hi @holiman,\r\nI'm glad you noticed those two, I included them on purpose. I have no idea why they were blocked, thought I can find here any insights.\r\nMy ufw settings are very simple:\r\n```\r\nStatus: active\r\nLogging: on (low)\r\nDefault: deny (incoming), allow (outgoing), disabled (routed)\r\nNew profiles: skip\r\n\r\nTo                         Action      From\r\n--                         ------      ----\r\n30303                      ALLOW IN    Anywhere\r\n30303 (v6)                 ALLOW IN    Anywhere (v6)\r\n\r\n```\r\nRouter forwards 30303->30303.\r\n\r\n\r\n\r\n> are you 100% certain that you have allowed established connections?\r\n\r\nWhere can I do that? iptables? How can I double check?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/785914564/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/951310153",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22376#issuecomment-951310153",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22376",
    "id": 951310153,
    "node_id": "IC_kwDOAOvK9844s9dJ",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-25T20:39:12Z",
    "updated_at": "2021-10-25T20:39:12Z",
    "author_association": "MEMBER",
    "body": "Sorry for late response\r\n`iptables -L` should show\r\nExample:\r\n```\r\nChain FORWARD (policy DROP)\r\ntarget     prot opt source               destination         \r\nDROP       all  --  anywhere             anywhere             state INVALID\r\nACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED\r\n\r\n```\r\nThis one accepts everything that is already established (and also related, whatever that means... ) \r\nI'll close this for now, please reopen if you have some new information or want to keep digging the root cause here. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/951310153/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
