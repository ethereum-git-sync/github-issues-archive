{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23560",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23560/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23560/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23560/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23560",
  "id": 992723371,
  "node_id": "MDU6SXNzdWU5OTI3MjMzNzE=",
  "number": 23560,
  "title": "EIP-2930 accessList structure discrepancy",
  "user": {
    "login": "fselmo",
    "id": 3532824,
    "node_id": "MDQ6VXNlcjM1MzI4MjQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3532824?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fselmo",
    "html_url": "https://github.com/fselmo",
    "followers_url": "https://api.github.com/users/fselmo/followers",
    "following_url": "https://api.github.com/users/fselmo/following{/other_user}",
    "gists_url": "https://api.github.com/users/fselmo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fselmo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fselmo/subscriptions",
    "organizations_url": "https://api.github.com/users/fselmo/orgs",
    "repos_url": "https://api.github.com/users/fselmo/repos",
    "events_url": "https://api.github.com/users/fselmo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fselmo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    },
    {
      "id": 1132689577,
      "node_id": "MDU6TGFiZWwxMTMyNjg5NTc3",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:triage",
      "name": "status:triage",
      "color": "6be514",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-09-09T22:51:43Z",
  "updated_at": "2021-09-10T15:22:41Z",
  "closed_at": "2021-09-10T09:32:32Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `v1.10.8`\r\nOS & Version: `macOS Big Sur 11.4`\r\n\r\n#### Expected behaviour\r\n\r\nAs per EIP-2930: \r\n\r\n\"For the transaction to be valid, `accessList` must be of type `[[{20 bytes}, [{32 bytes}...]]...]`\"\r\n\r\ne.g.\r\n```\r\n[\r\n    [\r\n        \"0xde0b295669a9fd93d5f28d9ec85e40f4cb697bae\",\r\n        [\r\n            \"0x0000000000000000000000000000000000000000000000000000000000000003\",\r\n            \"0x0000000000000000000000000000000000000000000000000000000000000007\"\r\n        ]\r\n    ],\r\n    [\r\n        \"0xbb9bc244d798123fde783fcc1c72d3bb8c189413\",\r\n        []\r\n    ]\r\n]\r\n```\r\n\r\nThe expected behavior is that this is a valid way to structure an `accessList` within a transaction.\r\n\r\n#### Actual behaviour\r\n\r\nWhen a transaction is sent with the `accessList` structure provided by the EIP, the following error occurs:\r\n\r\n`ValueError: {'code': -32602, 'message': 'invalid argument 0: json: cannot unmarshal array into Go struct field TransactionArgs.accessList of type types.AccessTuple'}`\r\n\r\nThis error seems to stem from the `types.AccessTuple` expecting each element in the parent list to be a key / value pair with 'address' and 'storageKeys' as keys:\r\n\r\n```\r\n [\r\n    {\r\n        \"address\" : \"0xde0b295669a9fd93d5f28d9ec85e40f4cb697bae\",\r\n        \"storageKeys\": [\r\n            \"0x0000000000000000000000000000000000000000000000000000000000000003\",\r\n            \"0x0000000000000000000000000000000000000000000000000000000000000007\",\r\n        ]\r\n    },\r\n    {\r\n        \"address\": \"0xbb9bc244d798123fde783fcc1c72d3bb8c189413\",\r\n        \"storageKeys\": []\r\n    }\r\n]\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nweb3.py example:\r\n\r\n- Ran `$ geth --dev` in background\r\n- Executed the following python code:\r\n\r\n```python\r\nfrom web3 import Web3, IPCProvider\r\nfrom web3.middleware import geth_poa_middleware\r\n\r\nw3 = Web3(IPCProvider('/var/folders/fj/ft8tvf_s3hv4k06lxjxg9z340000gn/T/geth.ipc'))\r\nw3.middleware_onion.inject(geth_poa_middleware, layer=0)\r\n\r\naccess_list_txn = {\r\n    \"input\": \"0x\",\r\n    \"gas\": \"0x5208\",\r\n    \"nonce\": \"0x0\",\r\n    \"to\": \"0x1111111111111111111111111111111111111111\",\r\n    \"value\": \"0x20\",\r\n    \"chainId\": 1337,\r\n    \"type\": \"0x2\",\r\n    \"maxFeePerGas\": \"0xfa0\",\r\n    \"maxPriorityFeePerGas\": \"0x20\",\r\n    \"accessList\": [  # accessList example taken directly from EIP-2930\r\n        [\r\n            \"0xde0b295669a9fd93d5f28d9ec85e40f4cb697bae\",\r\n            [\r\n                \"0x0000000000000000000000000000000000000000000000000000000000000003\",\r\n                \"0x0000000000000000000000000000000000000000000000000000000000000007\"\r\n            ]\r\n        ],\r\n        [\r\n            \"0xbb9bc244d798123fde783fcc1c72d3bb8c189413\",\r\n            []\r\n        ]\r\n    ],\r\n}\r\n\r\nw3.eth.send_transaction(access_list_txn)\r\n```\r\n\r\n\r\n#### Backtrace\r\n\r\n```python\r\nPython 3.9.7 (default, Sep  2 2021, 14:42:43)\r\nType 'copyright', 'credits' or 'license' for more information\r\nIPython 7.27.0 -- An enhanced Interactive Python. Type '?' for help.\r\n---------------------------------------------------------------------------\r\nValueError                                Traceback (most recent call last)\r\n~/codigo/e/py/geth_access_list_error.py in <module>\r\n     34 }\r\n     35\r\n---> 36 w3.eth.send_transaction(access_list_txn)\r\n\r\n~/.pyenv/versions/3.9.7/envs/default/lib/python3.9/site-packages/web3/eth.py in send_transaction(self, transaction)\r\n    684\r\n    685     def send_transaction(self, transaction: TxParams) -> HexBytes:\r\n--> 686         return self._send_transaction(transaction)\r\n    687\r\n    688     send_raw_transaction: Method[Callable[[Union[HexStr, bytes]], HexBytes]] = Method(\r\n\r\n~/.pyenv/versions/3.9.7/envs/default/lib/python3.9/site-packages/web3/module.py in caller(*args, **kwargs)\r\n     55             return LogFilter(eth_module=module, filter_id=err.filter_id)\r\n     56         result_formatters, error_formatters, null_result_formatters = response_formatters\r\n---> 57         result = w3.manager.request_blocking(method_str,\r\n     58                                              params,\r\n     59                                              error_formatters,\r\n\r\n~/.pyenv/versions/3.9.7/envs/default/lib/python3.9/site-packages/web3/manager.py in request_blocking(self, method, params, error_formatters, null_result_formatters)\r\n    185         \"\"\"\r\n    186         response = self._make_request(method, params)\r\n--> 187         return self.formatted_response(response,\r\n    188                                        params,\r\n    189                                        error_formatters,\r\n\r\n~/.pyenv/versions/3.9.7/envs/default/lib/python3.9/site-packages/web3/manager.py in formatted_response(self, response, params, error_formatters, null_result_formatters)\r\n    166         if \"error\" in response:\r\n    167             apply_error_formatters(error_formatters, response)\r\n--> 168             raise ValueError(response[\"error\"])\r\n    169         elif response['result'] in NULL_RESPONSES:\r\n    170             # null_result_formatters raise either a BlockNotFound\r\n\r\nValueError: {'code': -32602, 'message': 'invalid argument 0: json: cannot unmarshal array into Go struct field TransactionArgs.accessList of type types.AccessTuple'}\r\n```",
  "closed_by": {
    "login": "MariusVanDerWijden",
    "id": 16664698,
    "node_id": "MDQ6VXNlcjE2NjY0Njk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MariusVanDerWijden",
    "html_url": "https://github.com/MariusVanDerWijden",
    "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
    "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
    "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
    "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
    "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
    "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23560/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23560/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/916494759",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23560#issuecomment-916494759",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23560",
    "id": 916494759,
    "node_id": "IC_kwDOAOvK9842oJmn",
    "user": {
      "login": "fselmo",
      "id": 3532824,
      "node_id": "MDQ6VXNlcjM1MzI4MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3532824?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fselmo",
      "html_url": "https://github.com/fselmo",
      "followers_url": "https://api.github.com/users/fselmo/followers",
      "following_url": "https://api.github.com/users/fselmo/following{/other_user}",
      "gists_url": "https://api.github.com/users/fselmo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fselmo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fselmo/subscriptions",
      "organizations_url": "https://api.github.com/users/fselmo/orgs",
      "repos_url": "https://api.github.com/users/fselmo/repos",
      "events_url": "https://api.github.com/users/fselmo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fselmo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-09T22:55:19Z",
    "updated_at": "2021-09-09T22:55:19Z",
    "author_association": "MEMBER",
    "body": "Relevant issue with `accessList` structure discrepancy with `web3.py` / `eth-account`: https://github.com/ethereum/web3.py/issues/2140",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/916494759/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/916642627",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23560#issuecomment-916642627",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23560",
    "id": 916642627,
    "node_id": "IC_kwDOAOvK9842ottD",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-10T05:30:12Z",
    "updated_at": "2021-09-10T05:30:12Z",
    "author_association": "MEMBER",
    "body": "In EIP it's the description for rlp encoding. The RPC spec is here https://github.com/ethereum/execution-apis/blob/main/src/schemas/transaction.json#L2",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/916642627/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/916768946",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23560#issuecomment-916768946",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23560",
    "id": 916768946,
    "node_id": "IC_kwDOAOvK9842pMiy",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-10T09:32:32Z",
    "updated_at": "2021-09-10T09:32:32Z",
    "author_association": "MEMBER",
    "body": "I think this can be closed, we use two different structures for accesslist, we use `types.AccessListTuple`s in the RPC and `vm.accessList` during execution which is `type accessList map[common.Address]accessListSlots`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/916768946/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/916987834",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23560#issuecomment-916987834",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23560",
    "id": 916987834,
    "node_id": "IC_kwDOAOvK9842qB-6",
    "user": {
      "login": "fselmo",
      "id": 3532824,
      "node_id": "MDQ6VXNlcjM1MzI4MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3532824?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fselmo",
      "html_url": "https://github.com/fselmo",
      "followers_url": "https://api.github.com/users/fselmo/followers",
      "following_url": "https://api.github.com/users/fselmo/following{/other_user}",
      "gists_url": "https://api.github.com/users/fselmo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fselmo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fselmo/subscriptions",
      "organizations_url": "https://api.github.com/users/fselmo/orgs",
      "repos_url": "https://api.github.com/users/fselmo/repos",
      "events_url": "https://api.github.com/users/fselmo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fselmo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-10T15:22:41Z",
    "updated_at": "2021-09-10T15:22:41Z",
    "author_association": "MEMBER",
    "body": "Ah, yep. There is a difference between the rlp and RPC access list structures. Nothing to see here. We just need to improve the user experience on our end.\r\n\r\nThanks 👍 ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/916987834/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
