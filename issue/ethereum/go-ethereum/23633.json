{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23633",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23633/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23633/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23633/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23633",
  "id": 1005961232,
  "node_id": "I_kwDOAOvK98479cAQ",
  "number": 23633,
  "title": "Performance for DebugTraceCall",
  "user": {
    "login": "FeurJak",
    "id": 77963837,
    "node_id": "MDQ6VXNlcjc3OTYzODM3",
    "avatar_url": "https://avatars.githubusercontent.com/u/77963837?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/FeurJak",
    "html_url": "https://github.com/FeurJak",
    "followers_url": "https://api.github.com/users/FeurJak/followers",
    "following_url": "https://api.github.com/users/FeurJak/following{/other_user}",
    "gists_url": "https://api.github.com/users/FeurJak/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/FeurJak/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/FeurJak/subscriptions",
    "organizations_url": "https://api.github.com/users/FeurJak/orgs",
    "repos_url": "https://api.github.com/users/FeurJak/repos",
    "events_url": "https://api.github.com/users/FeurJak/events{/privacy}",
    "received_events_url": "https://api.github.com/users/FeurJak/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 268304226,
      "node_id": "MDU6TGFiZWwyNjgzMDQyMjY=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:docs",
      "name": "type:docs",
      "color": "fef2c0",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-09-24T00:24:18Z",
  "updated_at": "2021-09-28T06:57:01Z",
  "closed_at": "2021-09-27T20:18:00Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Is there any benchmark on the performance of DebugTraceCall available somewhere? \r\n\r\nIt takes 1ms to make a Call to an Address and get results, but if with the standard Call Tracer it can take 100ms - 300ms. \r\n\r\nEven with a simple custom Tracer:\r\n` \"{    hist: {},\tstep: function(log) {         var error = log.getError();        if (error !== undefined) {            this.fault(log);        }     },\tfault: function(log) {         this.hist['addr'] = toHex(toAddress(log.stack.peek(3).toString(16)));;    },\tresult: function(ctx){return this.hist;}}\"`\r\n\r\nWhich just tells me which call to an Address has failed, it takes 60ms-70ms to get a response. \r\n\r\nI apologies if I'm incorrect but I thought using DebugTraceCall is similar to making a standard call, except that the VM logs are interpreted with the specified JavaScript ? Which component is responsible for taking >10ms when Tracing a Call ? \r\n",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23633/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23633/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/927749981",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23633#issuecomment-927749981",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23633",
    "id": 927749981,
    "node_id": "IC_kwDOAOvK9843TFdd",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-27T10:54:45Z",
    "updated_at": "2021-09-27T10:54:45Z",
    "author_association": "MEMBER",
    "body": "Tracing comes with some overhead. Most of it is because on every opcode execution we have to execute JS code from Go which is expensive, specially if the transaction is computationally expensive.\r\n\r\n#23087 was recently merged which comes with a faster callTracer. And if you only care about the status of internal calls then you can instead of `step` use the new `enter` and `exit` JS methods and that'll make tracing faster because this Go-JS overhead doesn't happen at the opcode-level, rather call-level.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/927749981/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/928237794",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23633#issuecomment-928237794",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23633",
    "id": 928237794,
    "node_id": "IC_kwDOAOvK9843U8ji",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-27T20:18:00Z",
    "updated_at": "2021-09-27T20:18:00Z",
    "author_association": "MEMBER",
    "body": "As @s1na has pointed out, there's a _heavy_ overhead. Each single EVM opcode execution becomes a switch from go-lang to C++, where it runs interpreted javascript. In your simple tracer, you have a `getErrror()` for each opcode, which is a call from C++ land back to go (and it's pretty pointless, because `fault` will be invoked on errors automatically. )\r\n\r\nIf your usecase fits it, you can skip `step` and implement `enter` and `exit` instead, which can boost the speed by orders of magnitude. If the usecase doesn't fit it, not much to do at this point. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/928237794/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/928434233",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23633#issuecomment-928434233",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23633",
    "id": 928434233,
    "node_id": "IC_kwDOAOvK9843Vsg5",
    "user": {
      "login": "FeurJak",
      "id": 77963837,
      "node_id": "MDQ6VXNlcjc3OTYzODM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/77963837?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/FeurJak",
      "html_url": "https://github.com/FeurJak",
      "followers_url": "https://api.github.com/users/FeurJak/followers",
      "following_url": "https://api.github.com/users/FeurJak/following{/other_user}",
      "gists_url": "https://api.github.com/users/FeurJak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/FeurJak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/FeurJak/subscriptions",
      "organizations_url": "https://api.github.com/users/FeurJak/orgs",
      "repos_url": "https://api.github.com/users/FeurJak/repos",
      "events_url": "https://api.github.com/users/FeurJak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/FeurJak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-27T23:24:49Z",
    "updated_at": "2021-09-27T23:24:49Z",
    "author_association": "NONE",
    "body": "Really awesome replies guys ! I will check out the new merge. I'm operating with the BSC geth version and I don't think that was ever implemented, so will try to append the same changes. \r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/928434233/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/928782748",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23633#issuecomment-928782748",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23633",
    "id": 928782748,
    "node_id": "IC_kwDOAOvK9843XBmc",
    "user": {
      "login": "FeurJak",
      "id": 77963837,
      "node_id": "MDQ6VXNlcjc3OTYzODM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/77963837?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/FeurJak",
      "html_url": "https://github.com/FeurJak",
      "followers_url": "https://api.github.com/users/FeurJak/followers",
      "following_url": "https://api.github.com/users/FeurJak/following{/other_user}",
      "gists_url": "https://api.github.com/users/FeurJak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/FeurJak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/FeurJak/subscriptions",
      "organizations_url": "https://api.github.com/users/FeurJak/orgs",
      "repos_url": "https://api.github.com/users/FeurJak/repos",
      "events_url": "https://api.github.com/users/FeurJak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/FeurJak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-28T04:31:56Z",
    "updated_at": "2021-09-28T04:31:56Z",
    "author_association": "NONE",
    "body": "@holiman @s1na , not sure what magic potion you guys were on, but those changes made a massive decrease in the time it takes for callTracer. Just applied the features on BSC and on my test  it was reduced from 100ms down to 17ms, that's massive.... ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/928782748/reactions",
      "total_count": 3,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 3,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/928909365",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23633#issuecomment-928909365",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23633",
    "id": 928909365,
    "node_id": "IC_kwDOAOvK9843Xgg1",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-28T06:57:01Z",
    "updated_at": "2021-09-28T06:57:01Z",
    "author_association": "MEMBER",
    "body": "> 100ms down to 17ms, that's massive...\r\n\r\nThanks! But actually, I'd expect more than a 5x speed up for most calltrace ops, somewhere between1 and 3 orders of magnitude, but YMMV I guess",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/928909365/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
