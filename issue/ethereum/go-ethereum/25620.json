{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/25620",
  "id": 1353185513,
  "node_id": "I_kwDOAOvK985Qp_jp",
  "number": 25620,
  "title": "Frequent unindexed transactions after fresh sync with 1.10.23",
  "user": {
    "login": "adamkoch",
    "id": 869261,
    "node_id": "MDQ6VXNlcjg2OTI2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/869261?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/adamkoch",
    "html_url": "https://github.com/adamkoch",
    "followers_url": "https://api.github.com/users/adamkoch/followers",
    "following_url": "https://api.github.com/users/adamkoch/following{/other_user}",
    "gists_url": "https://api.github.com/users/adamkoch/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/adamkoch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/adamkoch/subscriptions",
    "organizations_url": "https://api.github.com/users/adamkoch/orgs",
    "repos_url": "https://api.github.com/users/adamkoch/repos",
    "events_url": "https://api.github.com/users/adamkoch/events{/privacy}",
    "received_events_url": "https://api.github.com/users/adamkoch/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 15,
  "created_at": "2022-08-27T22:07:05Z",
  "updated_at": "2022-08-30T01:01:44Z",
  "closed_at": "2022-08-30T01:01:44Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\nGeth version: 1.10.23\r\nOS & Version: Ubuntu 22.04.1\r\n\r\n#### Expected behaviour\r\nNo continual, frequent, \"unindexed transactions\" logging.\r\n\r\n#### Actual behaviour\r\nContinual logging of \"unindexed transactions\":\r\n```\r\nINFO [08-27|20:21:23.819] Imported new chain segment               blocks=1   txs=131   mgas=15.098  elapsed=145.835ms   mgasps=103.527 number=15,423,650 hash=de39ba..55d1b4 dirty=1014.00MiB\r\nINFO [08-27|20:21:23.823] Unindexed transactions                   blocks=1   txs=162   tail=13,073,651 elapsed=3.336ms\r\nINFO [08-27|20:21:24.640] Imported new chain segment               blocks=1   txs=27    mgas=2.244   elapsed=431.786ms   mgasps=5.198   number=15,423,651 hash=7aabee..c1952f dirty=1012.92MiB\r\nINFO [08-27|20:21:24.663] Unindexed transactions                   blocks=1   txs=12    tail=13,073,652 elapsed=5.325ms\r\nINFO [08-27|20:22:11.547] Imported new chain segment               blocks=1   txs=360   mgas=29.996  elapsed=237.176ms   mgasps=126.471 number=15,423,652 hash=b849cc..96d10f dirty=1016.07MiB\r\nINFO [08-27|20:22:11.549] Unindexed transactions                   blocks=1   txs=108   tail=13,073,653 elapsed=1.504ms\r\nINFO [08-27|20:22:15.671] Imported new chain segment               blocks=1   txs=149   mgas=15.289  elapsed=179.028ms   mgasps=85.403  number=15,423,653 hash=6c4846..5344b2 dirty=1015.71MiB\r\nINFO [08-27|20:22:15.677] Unindexed transactions                   blocks=1   txs=397   tail=13,073,654 elapsed=4.897ms\r\nINFO [08-27|20:22:18.911] Imported new chain segment               blocks=1   txs=110   mgas=18.883  elapsed=101.967ms   mgasps=185.191 number=15,423,654 hash=8d9a06..49ddd8 dirty=1015.96MiB\r\nINFO [08-27|20:22:18.913] Unindexed transactions                   blocks=1   txs=229   tail=13,073,655 elapsed=2.120ms\r\nINFO [08-27|20:22:25.106] Imported new chain segment               blocks=1   txs=74    mgas=6.257   elapsed=50.760ms    mgasps=123.267 number=15,423,655 hash=98a708..54cff0 dirty=1016.05MiB\r\nINFO [08-27|20:22:25.107] Unindexed transactions                   blocks=1   txs=42    tail=13,073,656 elapsed=\"661.722µs\"\r\nINFO [08-27|20:22:27.042] Imported new chain segment               blocks=1   txs=19    mgas=1.446   elapsed=19.256ms    mgasps=75.108  number=15,423,656 hash=737d74..393304 dirty=1015.83MiB\r\nINFO [08-27|20:22:27.042] Unindexed transactions                   blocks=1   txs=21    tail=13,073,657 elapsed=\"350.415µs\"\r\nINFO [08-27|20:22:29.595] Imported new chain segment               blocks=1   txs=32    mgas=6.210   elapsed=38.052ms    mgasps=163.185 number=15,423,657 hash=8f3e21..dc0f6b dirty=1015.37MiB\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\nI was affected by the 1.10.22 bug, I tried to shift the head back to an earlier date but ran into similar errors to others. I decided to just do a complete resync so I removed all my data and started the resync. After about 12-14 hours it successfully caught up to the latest block and I see `Imported new chain segment` (as per above) that matches the latest block.\r\n\r\nHowever, for every `Imported new chain segment` I also see a `Unindexed transactions` log. This has been happening for ~2 days now.\r\n\r\nThere are a few others in the Geth Discord who seem to have similar issues.\r\n\r\nIt seems Geth is still running ok but before I ran into the `1.10.22` bug I never saw this behavior before.\r\n\r\nAlso what is the meaning of `tail` within the `Unindexed transactions` logs? It seems to be a very old block number and it is very slowly slowly making progress (block is incrementing) but it's such slow progress I'm not sure it will ever catch up.\r\n",
  "closed_by": {
    "login": "adamkoch",
    "id": 869261,
    "node_id": "MDQ6VXNlcjg2OTI2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/869261?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/adamkoch",
    "html_url": "https://github.com/adamkoch",
    "followers_url": "https://api.github.com/users/adamkoch/followers",
    "following_url": "https://api.github.com/users/adamkoch/following{/other_user}",
    "gists_url": "https://api.github.com/users/adamkoch/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/adamkoch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/adamkoch/subscriptions",
    "organizations_url": "https://api.github.com/users/adamkoch/orgs",
    "repos_url": "https://api.github.com/users/adamkoch/repos",
    "events_url": "https://api.github.com/users/adamkoch/events{/privacy}",
    "received_events_url": "https://api.github.com/users/adamkoch/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229276781",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25620#issuecomment-1229276781",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620",
    "id": 1229276781,
    "node_id": "IC_kwDOAOvK985JRUZt",
    "user": {
      "login": "adamkoch",
      "id": 869261,
      "node_id": "MDQ6VXNlcjg2OTI2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/869261?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adamkoch",
      "html_url": "https://github.com/adamkoch",
      "followers_url": "https://api.github.com/users/adamkoch/followers",
      "following_url": "https://api.github.com/users/adamkoch/following{/other_user}",
      "gists_url": "https://api.github.com/users/adamkoch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adamkoch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adamkoch/subscriptions",
      "organizations_url": "https://api.github.com/users/adamkoch/orgs",
      "repos_url": "https://api.github.com/users/adamkoch/repos",
      "events_url": "https://api.github.com/users/adamkoch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adamkoch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-27T22:07:49Z",
    "updated_at": "2022-08-27T22:07:49Z",
    "author_association": "NONE",
    "body": "I also see similar logs in this comment:\r\nhttps://github.com/ethereum/go-ethereum/issues/25589#issuecomment-1226214944",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229276781/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229278065",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25620#issuecomment-1229278065",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620",
    "id": 1229278065,
    "node_id": "IC_kwDOAOvK985JRUtx",
    "user": {
      "login": "Jor-Tech",
      "id": 48367297,
      "node_id": "MDQ6VXNlcjQ4MzY3Mjk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/48367297?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Jor-Tech",
      "html_url": "https://github.com/Jor-Tech",
      "followers_url": "https://api.github.com/users/Jor-Tech/followers",
      "following_url": "https://api.github.com/users/Jor-Tech/following{/other_user}",
      "gists_url": "https://api.github.com/users/Jor-Tech/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Jor-Tech/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Jor-Tech/subscriptions",
      "organizations_url": "https://api.github.com/users/Jor-Tech/orgs",
      "repos_url": "https://api.github.com/users/Jor-Tech/repos",
      "events_url": "https://api.github.com/users/Jor-Tech/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Jor-Tech/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-27T22:15:52Z",
    "updated_at": "2022-08-27T22:15:52Z",
    "author_association": "NONE",
    "body": "Having the exact same behavior in the Geth logs as @adamkoch and I did not do a full resync after the v1.10.22 bug, but used the setHead method. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229278065/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229391019",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25620#issuecomment-1229391019",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620",
    "id": 1229391019,
    "node_id": "IC_kwDOAOvK985JRwSr",
    "user": {
      "login": "jamesmorgan",
      "id": 110869,
      "node_id": "MDQ6VXNlcjExMDg2OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/110869?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jamesmorgan",
      "html_url": "https://github.com/jamesmorgan",
      "followers_url": "https://api.github.com/users/jamesmorgan/followers",
      "following_url": "https://api.github.com/users/jamesmorgan/following{/other_user}",
      "gists_url": "https://api.github.com/users/jamesmorgan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jamesmorgan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jamesmorgan/subscriptions",
      "organizations_url": "https://api.github.com/users/jamesmorgan/orgs",
      "repos_url": "https://api.github.com/users/jamesmorgan/repos",
      "events_url": "https://api.github.com/users/jamesmorgan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jamesmorgan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-28T06:31:18Z",
    "updated_at": "2022-08-28T06:31:18Z",
    "author_association": "NONE",
    "body": "Also seeing this after a fresh upgrade - its been resyncing from about 8 weeks ago, unsure of why this reindex process has started  as all I did was upgrade geth as normal. First output line is\r\n\r\n```\r\nAug 27 14:00:11 moonshot geth[1401]: INFO [08-27|14:00:11.363] Imported new chain segment               blocks=18 txs=2492 mgas=237.368 elapsed=8.194s mgasps=28.965 number=15,049,901 hash=6dbed9..ebaf40 age=1mo4w3h dirty=27.27MiB\r\n```\r\n\r\nI also see a warning about the merge happening but it looks like its way off in the future e.g. \r\n\r\n```\r\nAug 27 13:58:50 moonshot geth[1401]: WARN [08-27|13:58:50.946] Merge is configured, but no beacon client seen. Please ensure you have one available before the transition arrives! eta=2mo3w6d\r\n```\r\nIs this in relation to the current sync state and not the current time?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229391019/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229506038",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25620#issuecomment-1229506038",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620",
    "id": 1229506038,
    "node_id": "IC_kwDOAOvK985JSMX2",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-28T16:52:11Z",
    "updated_at": "2022-08-28T16:52:11Z",
    "author_association": "MEMBER",
    "body": "Geth will only keep the transaction indexes of the last year by default, specifically `2350000` blocks. And the background thread will wipe the indexes before this threshold, print the log as `Unindexed transactions ...`.\r\n\r\nI think it's expected, I am just very curious why these logs never occur before. It's a very old feature we delivered long time ago.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229506038/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229613128",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25620#issuecomment-1229613128",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620",
    "id": 1229613128,
    "node_id": "IC_kwDOAOvK985JSmhI",
    "user": {
      "login": "adamkoch",
      "id": 869261,
      "node_id": "MDQ6VXNlcjg2OTI2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/869261?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adamkoch",
      "html_url": "https://github.com/adamkoch",
      "followers_url": "https://api.github.com/users/adamkoch/followers",
      "following_url": "https://api.github.com/users/adamkoch/following{/other_user}",
      "gists_url": "https://api.github.com/users/adamkoch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adamkoch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adamkoch/subscriptions",
      "organizations_url": "https://api.github.com/users/adamkoch/orgs",
      "repos_url": "https://api.github.com/users/adamkoch/repos",
      "events_url": "https://api.github.com/users/adamkoch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adamkoch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-29T01:02:53Z",
    "updated_at": "2022-08-29T01:02:53Z",
    "author_association": "NONE",
    "body": "@rjl493456442 thanks for the extra info. I thought it was saying \"there are unindexed transactions\" but what you're saying is this log is saying it removed an index for those old transactions. Looking at the code, none of it looks touched for ~2 years AFAICT.\r\n\r\nPerhaps somehow the full resync caused the much older blocked to be indexed and now it has a backlog of old tx's to unindex. Unindexing seems very slow (around 10 seconds+ per block). However, as you mentioned, the default is about 1 year of blocks in the index, so theoretically it should stop around the 1 year mark.\r\n\r\nFor me, it's currently at block 13081084 so within a day or two it should get to -365 days. Will report back then.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229613128/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229652051",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25620#issuecomment-1229652051",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620",
    "id": 1229652051,
    "node_id": "IC_kwDOAOvK985JSwBT",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-29T01:54:40Z",
    "updated_at": "2022-08-29T01:54:40Z",
    "author_association": "MEMBER",
    "body": "> none of it looks touched for ~2 years AFAICT.\r\n\r\nYou mean your node hasn't been upgraded for 2 years? How can it survive though.\r\n\r\n> However, as you mentioned, the default is about 1 year of blocks in the index, so theoretically it should stop around the 1 year mark\r\n\r\nSince new blocks are being built all the time, the unindexer will keep working to unindex the indices of block `HEAD-2350000`, it will never stop.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229652051/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229655459",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25620#issuecomment-1229655459",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620",
    "id": 1229655459,
    "node_id": "IC_kwDOAOvK985JSw2j",
    "user": {
      "login": "adamkoch",
      "id": 869261,
      "node_id": "MDQ6VXNlcjg2OTI2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/869261?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adamkoch",
      "html_url": "https://github.com/adamkoch",
      "followers_url": "https://api.github.com/users/adamkoch/followers",
      "following_url": "https://api.github.com/users/adamkoch/following{/other_user}",
      "gists_url": "https://api.github.com/users/adamkoch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adamkoch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adamkoch/subscriptions",
      "organizations_url": "https://api.github.com/users/adamkoch/orgs",
      "repos_url": "https://api.github.com/users/adamkoch/repos",
      "events_url": "https://api.github.com/users/adamkoch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adamkoch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-29T01:59:52Z",
    "updated_at": "2022-08-29T01:59:52Z",
    "author_association": "NONE",
    "body": "> You mean your node hasn't been upgraded for 2 years? How can it survive though.\r\n\r\nNo I mean the geth code for unindexing transactions ([here](https://github.com/ethereum/go-ethereum/blob/e44d6551c3c872584722c366c863381f7e91df91/core/rawdb/chain_iterator.go#L338) and [here](https://github.com/ethereum/go-ethereum/blob/e44d6551c3c872584722c366c863381f7e91df91/core/blockchain.go#L2331))\r\n\r\n> Since new blocks are being built all the time, the unindexer will keep working to unindex the indices of block HEAD-2350000, it will never stop.\r\n\r\nAh yeh good point. I guess hopefully the unindexing can unindex quicker than new blocks arrive. Otherwise this will continue on forever :(\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229655459/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229657932",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25620#issuecomment-1229657932",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620",
    "id": 1229657932,
    "node_id": "IC_kwDOAOvK985JSxdM",
    "user": {
      "login": "adamkoch",
      "id": 869261,
      "node_id": "MDQ6VXNlcjg2OTI2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/869261?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adamkoch",
      "html_url": "https://github.com/adamkoch",
      "followers_url": "https://api.github.com/users/adamkoch/followers",
      "following_url": "https://api.github.com/users/adamkoch/following{/other_user}",
      "gists_url": "https://api.github.com/users/adamkoch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adamkoch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adamkoch/subscriptions",
      "organizations_url": "https://api.github.com/users/adamkoch/orgs",
      "repos_url": "https://api.github.com/users/adamkoch/repos",
      "events_url": "https://api.github.com/users/adamkoch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adamkoch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-29T02:03:05Z",
    "updated_at": "2022-08-29T02:03:05Z",
    "author_association": "NONE",
    "body": "> Ah yeh good point. I guess hopefully the unindexing can unindex quicker than new blocks arrive. Otherwise this will continue on forever :(\r\n\r\nOne thing I noticed is that there is exactly one `unindexed log` message for every `imported new chain segment`. Even if the unindexing only takes 1-2 seconds, it's still 1:1 ratio. If this is the case, it really will never catch up. Do you think that's expected? Maybe that's why it's \"stuck\".\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229657932/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229718164",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25620#issuecomment-1229718164",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620",
    "id": 1229718164,
    "node_id": "IC_kwDOAOvK985JTAKU",
    "user": {
      "login": "adamkoch",
      "id": 869261,
      "node_id": "MDQ6VXNlcjg2OTI2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/869261?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adamkoch",
      "html_url": "https://github.com/adamkoch",
      "followers_url": "https://api.github.com/users/adamkoch/followers",
      "following_url": "https://api.github.com/users/adamkoch/following{/other_user}",
      "gists_url": "https://api.github.com/users/adamkoch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adamkoch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adamkoch/subscriptions",
      "organizations_url": "https://api.github.com/users/adamkoch/orgs",
      "repos_url": "https://api.github.com/users/adamkoch/repos",
      "events_url": "https://api.github.com/users/adamkoch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adamkoch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-29T03:34:48Z",
    "updated_at": "2022-08-29T03:34:48Z",
    "author_association": "NONE",
    "body": "Just to confirm this. I looked at my logs from 4-5 days back and the unindexed logs were ~370 days behind. And today, it is still ~370  days behind. So it will never catch up.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229718164/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229888653",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25620#issuecomment-1229888653",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620",
    "id": 1229888653,
    "node_id": "IC_kwDOAOvK985JTpyN",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-29T07:29:24Z",
    "updated_at": "2022-08-29T07:29:24Z",
    "author_association": "MEMBER",
    "body": "```\r\nINFO [08-27|20:21:23.819] Imported new chain segment               blocks=1   txs=131   mgas=15.098  elapsed=145.835ms   mgasps=103.527 number=15,423,650 hash=de39ba..55d1b4 dirty=1014.00MiB\r\nINFO [08-27|20:21:23.823] Unindexed transactions                   blocks=1   txs=162   tail=13,073,651 elapsed=3.336ms\r\n```\r\n\r\nLook at this log, you import a new block `15,423,650`, then geth will try to unindex block `15,423,650 - 2350000 = 13073650`, so it reports `tail=13,073,651`. It's correct.\r\n\r\nThe 1 year threshold is just the *estimation*. We use `2350000` blocks to roughly represent 1 year time.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229888653/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229895125",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25620#issuecomment-1229895125",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620",
    "id": 1229895125,
    "node_id": "IC_kwDOAOvK985JTrXV",
    "user": {
      "login": "adamkoch",
      "id": 869261,
      "node_id": "MDQ6VXNlcjg2OTI2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/869261?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adamkoch",
      "html_url": "https://github.com/adamkoch",
      "followers_url": "https://api.github.com/users/adamkoch/followers",
      "following_url": "https://api.github.com/users/adamkoch/following{/other_user}",
      "gists_url": "https://api.github.com/users/adamkoch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adamkoch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adamkoch/subscriptions",
      "organizations_url": "https://api.github.com/users/adamkoch/orgs",
      "repos_url": "https://api.github.com/users/adamkoch/repos",
      "events_url": "https://api.github.com/users/adamkoch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adamkoch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-29T07:35:20Z",
    "updated_at": "2022-08-29T07:35:20Z",
    "author_association": "NONE",
    "body": "Ah I see. So this logging is essentially working as intended as it's unindexing ~1 year old blocks as it moves forward at the head.\r\n\r\nThe question is, why isn't this something everyone sees in their logs? And why wasn't I see this previously before I re-sync'd from scratch? Could it be that for some users the older blocks are not indexed so no need to unindex?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1229895125/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1230106749",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25620#issuecomment-1230106749",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620",
    "id": 1230106749,
    "node_id": "IC_kwDOAOvK985JUfB9",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-29T10:36:54Z",
    "updated_at": "2022-08-29T10:36:54Z",
    "author_association": "MEMBER",
    "body": "@adamkoch I am also wondering why you guys don't see this logs. Which version are you using previously? What's the command line flags you used for your previous setup?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1230106749/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1230126119",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25620#issuecomment-1230126119",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620",
    "id": 1230126119,
    "node_id": "IC_kwDOAOvK985JUjwn",
    "user": {
      "login": "adamkoch",
      "id": 869261,
      "node_id": "MDQ6VXNlcjg2OTI2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/869261?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adamkoch",
      "html_url": "https://github.com/adamkoch",
      "followers_url": "https://api.github.com/users/adamkoch/followers",
      "following_url": "https://api.github.com/users/adamkoch/following{/other_user}",
      "gists_url": "https://api.github.com/users/adamkoch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adamkoch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adamkoch/subscriptions",
      "organizations_url": "https://api.github.com/users/adamkoch/orgs",
      "repos_url": "https://api.github.com/users/adamkoch/repos",
      "events_url": "https://api.github.com/users/adamkoch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adamkoch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-29T10:58:00Z",
    "updated_at": "2022-08-29T10:58:00Z",
    "author_association": "NONE",
    "body": "I generally stay up-to-date with latest version (maybe within a week of release). I was previously on 1.10.22 and before that 1.10.21. That said, I'm not sure I never had any unindexed transaction logs, it's more I don't recall seeing them show this frequently (1:1 ratio with `imported new chain segment` log).\r\n\r\nJust to confirm though - are we saying that having one `Unindexed transactions` log matched with one `Imported new chain segment` is 100% expected in a healthy geth node? Is this what everyone sees?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1230126119/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1230248006",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25620#issuecomment-1230248006",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620",
    "id": 1230248006,
    "node_id": "IC_kwDOAOvK985JVBhG",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-29T12:54:20Z",
    "updated_at": "2022-08-29T12:54:20Z",
    "author_association": "MEMBER",
    "body": "> Just to confirm though - are we saying that having one Unindexed transactions log matched with one Imported new chain segment is 100% expected in a healthy geth node? Is this what everyone sees?\r\n\r\nyes, once we have a new block, a old block will be triggered for unindexing, by default. Unless you explicitly set to keep full indices.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1230248006/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1231024333",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25620#issuecomment-1231024333",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25620",
    "id": 1231024333,
    "node_id": "IC_kwDOAOvK985JX_DN",
    "user": {
      "login": "adamkoch",
      "id": 869261,
      "node_id": "MDQ6VXNlcjg2OTI2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/869261?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adamkoch",
      "html_url": "https://github.com/adamkoch",
      "followers_url": "https://api.github.com/users/adamkoch/followers",
      "following_url": "https://api.github.com/users/adamkoch/following{/other_user}",
      "gists_url": "https://api.github.com/users/adamkoch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adamkoch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adamkoch/subscriptions",
      "organizations_url": "https://api.github.com/users/adamkoch/orgs",
      "repos_url": "https://api.github.com/users/adamkoch/repos",
      "events_url": "https://api.github.com/users/adamkoch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adamkoch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-30T01:01:44Z",
    "updated_at": "2022-08-30T01:01:44Z",
    "author_association": "NONE",
    "body": "> yes, once we have a new block, a old block will be triggered for unindexing, by default. Unless you explicitly set to keep full indices.\r\n\r\nThanks for confirming. Closing this issue as it is WAI.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1231024333/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
