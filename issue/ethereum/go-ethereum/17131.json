{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17131",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17131/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17131/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17131/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/17131",
  "id": 338792186,
  "node_id": "MDU6SXNzdWUzMzg3OTIxODY=",
  "number": 17131,
  "title": "OOM when create account on geth ver 1.8.11 ",
  "user": {
    "login": "ylight007",
    "id": 40877299,
    "node_id": "MDQ6VXNlcjQwODc3Mjk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/40877299?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ylight007",
    "html_url": "https://github.com/ylight007",
    "followers_url": "https://api.github.com/users/ylight007/followers",
    "following_url": "https://api.github.com/users/ylight007/following{/other_user}",
    "gists_url": "https://api.github.com/users/ylight007/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ylight007/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ylight007/subscriptions",
    "organizations_url": "https://api.github.com/users/ylight007/orgs",
    "repos_url": "https://api.github.com/users/ylight007/repos",
    "events_url": "https://api.github.com/users/ylight007/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ylight007/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2018-07-06T03:21:52Z",
  "updated_at": "2018-07-09T01:34:21Z",
  "closed_at": "2018-07-09T01:34:21Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi there,\r\n\r\nI've done cross-compilation for Ethereum client \"geth\" (without modified), \r\nand executed on an armv7 platform.\r\nWhen I want to create a user account on the geth console, I got out of memory dump.\r\nThe device has limited memory. Before running geth, it has about 80MB for free in size.\r\nI know the default db cache size will be 1024MB on ver 1.8.11.\r\nAnd it seem likes it can self-adjust the cache value on ver 1.8.11.\r\nBut somehow when I create account on the console, always got OOM error there.\r\nEven I specify the cache size as 16MB. \r\nnote: it works well on x64 enviornment\r\n\r\nThanks for reading and replying.\r\n\r\n#### System information\r\n\r\nGeth version: 1.8.11-stable \r\nOS & Version: Linux\r\nCommit hash : n/a\r\n\r\n#### Expected behaviour\r\n\\# ./geth init genesis.json --datadir hi\r\n\\# ./geth --fast --cache=16 --networkid 123 --datadir hi --rpc --rpcaddr x.x.x.x --port 3000 console\r\n\\> personal.newAccount(\"1234567\")\r\nAccount created successfully.\r\n\r\n#### Actual behaviour\r\n\\# ./geth init genesis.json --datadir hi\r\n```\r\nWARN [07-06|17:54:38] Sanitizing cache to Go's GC limits       provided=1024 updated=61\r\nINFO [07-06|17:54:38] Maximum peer count                       ETH=25 LES=0 total=25\r\nINFO [07-06|17:54:38] Allocated cache and file handles         database=/mnt/hi/geth/chaindata cache=16 handles=16\r\nINFO [07-06|17:54:39] Persisted trie from memory database      nodes=0 size=0.00B time=3.828667ms gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B\r\nINFO [07-06|17:54:39] Successfully wrote genesis state         database=chaindata                        hash=54d897…ec32ef\r\nINFO [07-06|17:54:39] Allocated cache and file handles         database=/mnt/hi/geth/lightchaindata cache=16 handles=16\r\nINFO [07-06|17:54:40] Persisted trie from memory database      nodes=0 size=0.00B time=415.667µs  gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B\r\nINFO [07-06|17:54:40] Successfully wrote genesis state         database=lightchaindata                        hash=54d897…ec32ef\r\n```\r\n\\# ./geth --fast --cache=16 --networkid 123 --datadir hi --rpc --rpcaddr x.x.x.x --port 3000 console\r\n```\r\nINFO [07-06|17:55:07] Maximum peer count                       ETH=25 LES=0 total=25\r\nINFO [07-06|17:55:07] Starting peer-to-peer node               instance=Geth/v1.8.11-stable/linux-arm/go1.10.3\r\nINFO [07-06|17:55:07] Allocated cache and file handles         database=/mnt/hi/geth/chaindata cache=16 handles=512\r\nINFO [07-06|17:55:07] Initialised chain configuration          config=\"{ChainID: <nil> Homestead: <nil> DAO: <nil> DAOSupport: false EIP150: <nil> EIP155: <nil> EIP158: <nil> Byzantium: <nil> Constantinople: <nil> Engine: unknown}\"\r\nINFO [07-06|17:55:07] Disk storage enabled for ethash caches   dir=/mnt/hi/geth/ethash count=3\r\nINFO [07-06|17:55:07] Disk storage enabled for ethash DAGs     dir=/mnt/ramdisk/.ethash          count=2\r\nINFO [07-06|17:55:07] Initialising Ethereum protocol           versions=\"[63 62]\" network=123\r\nINFO [07-06|17:55:07] Loaded most recent local header          number=0 hash=54d897…ec32ef td=10\r\nINFO [07-06|17:55:07] Loaded most recent local full block      number=0 hash=54d897…ec32ef td=10\r\nINFO [07-06|17:55:07] Loaded most recent local fast block      number=0 hash=54d897…ec32ef td=10\r\nINFO [07-06|17:55:07] Loaded local transaction journal         transactions=0 dropped=0\r\nINFO [07-06|17:55:08] Regenerated local transaction journal    transactions=0 accounts=0\r\nINFO [07-06|17:55:08] Starting P2P networking\r\nINFO [07-06|17:55:11] UDP listener up                          self=enode://f5b60b84e95dfc118dba821650e55826e39f385592295cdd934310a70d27a44f25d5d886c0ff4708372d8b6a4e37260c2e3d8584be61f65f3871e2355a2bdf4a@[::]:3000\r\nINFO [07-06|17:55:11] RLPx listener up                         self=enode://f5b60b84e95dfc118dba821650e55826e39f385592295cdd934310a70d27a44f25d5d886c0ff4708372d8b6a4e37260c2e3d8584be61f65f3871e2355a2bdf4a@[::]:3000\r\nINFO [07-06|17:55:12] IPC endpoint opened                      url=/mnt/hi/geth.ipc\r\nINFO [07-06|17:55:12] HTTP endpoint opened                     url=http://x.x.x.x:8545      cors= vhosts=localhost\r\n```\r\n\\> personal.newAccount(\"1234567\")\r\n```\r\nfatal error: runtime: out of memory\r\n\r\nruntime stack:\r\nruntime.throw(0x99e2ab, 0x16)\r\n        /usr/local/go/src/runtime/panic.go:616 +0x60\r\nruntime.sysMap(0x13000000, 0x10000000, 0x42f01, 0x12ee8c0)\r\n        /usr/local/go/src/runtime/mem_linux.go:227 +0x11c\r\nruntime.(*mheap).sysAlloc(0x12e1718, 0x10000000, 0x118cec01)\r\n        /usr/local/go/src/runtime/malloc.go:470 +0x23c\r\nruntime.(*mheap).grow(0x12e1718, 0x8000, 0x0)\r\n        /usr/local/go/src/runtime/mheap.go:907 +0x48\r\nruntime.(*mheap).allocSpanLocked(0x12e1718, 0x8000, 0x12ee8d0, 0x9fe4)\r\n        /usr/local/go/src/runtime/mheap.go:820 +0x30c\r\nruntime.(*mheap).alloc_m(0x12e1718, 0x8000, 0xb2b90101, 0x60000010)\r\n        /usr/local/go/src/runtime/mheap.go:686 +0x118\r\n...\r\n```\r\n\\# cat genesis.json\r\n```\r\n{\r\n        \"config\": {},\r\n        \"gasLimit\": \"2000000\",\r\n        \"difficulty\": \"10\",\r\n        \"alloc\": {}\r\n}\r\n```\r\n#### Steps to reproduce the behaviour\r\n./geth init genesis.json --datadir hi\r\n./geth --fast --cache=16 --networkid 123 --datadir hi --rpc --rpcaddr x.x.x.x --port 3000 console\r\n\\> personal.newAccount(\"1234567\")\r\n\r\n#### Backtrace\r\n\r\n````\r\nfatal error: runtime: out of memory\r\n\r\nruntime stack:\r\nruntime.throw(0x99e2ab, 0x16)\r\n        /usr/local/go/src/runtime/panic.go:616 +0x60\r\nruntime.sysMap(0x13000000, 0x10000000, 0x42f01, 0x12ee8c0)\r\n        /usr/local/go/src/runtime/mem_linux.go:227 +0x11c\r\nruntime.(*mheap).sysAlloc(0x12e1718, 0x10000000, 0x118cec01)\r\n        /usr/local/go/src/runtime/malloc.go:470 +0x23c\r\nruntime.(*mheap).grow(0x12e1718, 0x8000, 0x0)\r\n        /usr/local/go/src/runtime/mheap.go:907 +0x48\r\nruntime.(*mheap).allocSpanLocked(0x12e1718, 0x8000, 0x12ee8d0, 0x9fe4)\r\n        /usr/local/go/src/runtime/mheap.go:820 +0x30c\r\nruntime.(*mheap).alloc_m(0x12e1718, 0x8000, 0xb2b90101, 0x60000010)\r\n        /usr/local/go/src/runtime/mheap.go:686 +0x118\r\nruntime.(*mheap).alloc.func1()\r\n        /usr/local/go/src/runtime/mheap.go:753 +0x3c\r\nruntime.(*mheap).alloc(0x12e1718, 0x8000, 0x10101, 0x12e34b8)\r\n        /usr/local/go/src/runtime/mheap.go:752 +0x60\r\nruntime.largeAlloc(0x10000000, 0x80101, 0xb6dc6000)\r\n        /usr/local/go/src/runtime/malloc.go:826 +0x74\r\nruntime.mallocgc.func1()\r\n        /usr/local/go/src/runtime/malloc.go:721 +0x38\r\nruntime.systemstack(0x0)\r\n        /usr/local/go/src/runtime/asm_arm.s:349 +0x80\r\nruntime.mstart()\r\n        /usr/local/go/src/runtime/proc.go:1175\r\n\r\ngoroutine 341 [running]:\r\nruntime.systemstack_switch()\r\n        /usr/local/go/src/runtime/asm_arm.s:294 +0x4 fp=0x12a4687c sp=0x12a46878 pc=0x8156c\r\nruntime.mallocgc(0x10000000, 0x899920, 0x1163d401, 0x1238a000)\r\n        /usr/local/go/src/runtime/malloc.go:720 +0x8a0 fp=0x12a468e0 sp=0x12a4687c pc=0x33aa0\r\nruntime.makeslice(0x899920, 0x4000000, 0x4000000, 0x1238a000, 0x200, 0x200)\r\n        /usr/local/go/src/runtime/slice.go:61 +0x68 fp=0x12a468f4 sp=0x12a468e0 pc=0x67cf4\r\ngithub.com/ethereum/go-ethereum/vendor/golang.org/x/crypto/scrypt.Key(0x12ab5cb0, 0x7, 0x8, 0x11ad3ac0, 0x20, 0x20, 0x40000, 0x8, 0x1, 0x20, ...)\r\n        /home/ngips/blockchain/go-ethereum-source/go-ethereum-1.8.11/build/_workspace/src/github.com/ethereum/go-ethereum/vendor/golang.org/x/crypto/scrypt/scrypt.go:236 +0x140 fp=0x12a46954 sp=0x12a468f4 pc=0x29f764\r\n...\r\n````\r\n",
  "closed_by": {
    "login": "ylight007",
    "id": 40877299,
    "node_id": "MDQ6VXNlcjQwODc3Mjk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/40877299?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ylight007",
    "html_url": "https://github.com/ylight007",
    "followers_url": "https://api.github.com/users/ylight007/followers",
    "following_url": "https://api.github.com/users/ylight007/following{/other_user}",
    "gists_url": "https://api.github.com/users/ylight007/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ylight007/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ylight007/subscriptions",
    "organizations_url": "https://api.github.com/users/ylight007/orgs",
    "repos_url": "https://api.github.com/users/ylight007/repos",
    "events_url": "https://api.github.com/users/ylight007/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ylight007/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17131/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17131/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/403207256",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/17131#issuecomment-403207256",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17131",
    "id": 403207256,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMzIwNzI1Ng==",
    "user": {
      "login": "ligi",
      "id": 111600,
      "node_id": "MDQ6VXNlcjExMTYwMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ligi",
      "html_url": "https://github.com/ligi",
      "followers_url": "https://api.github.com/users/ligi/followers",
      "following_url": "https://api.github.com/users/ligi/following{/other_user}",
      "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
      "organizations_url": "https://api.github.com/users/ligi/orgs",
      "repos_url": "https://api.github.com/users/ligi/repos",
      "events_url": "https://api.github.com/users/ligi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ligi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-07T10:55:02Z",
    "updated_at": "2018-07-07T10:55:02Z",
    "author_association": "MEMBER",
    "body": "please try to use  \r\n`--lightkdf                        Reduce key-derivation RAM & CPU usage at some expense of KDF strength\r\n`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/403207256/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/403335640",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/17131#issuecomment-403335640",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17131",
    "id": 403335640,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMzMzNTY0MA==",
    "user": {
      "login": "ylight007",
      "id": 40877299,
      "node_id": "MDQ6VXNlcjQwODc3Mjk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/40877299?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ylight007",
      "html_url": "https://github.com/ylight007",
      "followers_url": "https://api.github.com/users/ylight007/followers",
      "following_url": "https://api.github.com/users/ylight007/following{/other_user}",
      "gists_url": "https://api.github.com/users/ylight007/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ylight007/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ylight007/subscriptions",
      "organizations_url": "https://api.github.com/users/ylight007/orgs",
      "repos_url": "https://api.github.com/users/ylight007/repos",
      "events_url": "https://api.github.com/users/ylight007/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ylight007/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-09T01:34:21Z",
    "updated_at": "2018-07-09T01:34:21Z",
    "author_association": "NONE",
    "body": "Thanks for your advice.\r\nI have tried it and it worked well.\r\nHere I provide my new command again:\r\n\\# ./geth --fast --cache=16 --lightkdf --networkid 123 --datadir hi --rpc --rpcaddr x.x.x.x --port 3000 console\r\n\\> personal.newAccount(\"1234567\")\r\n**Account created successfully.**\r\n\r\nThanks @ligi , have a good day.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/403335640/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
