{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27516",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27516/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27516/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27516/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/27516",
  "id": 1764089745,
  "node_id": "I_kwDOAOvK985pJd-R",
  "number": 27516,
  "title": "ethclient: BlockByNumber doesn't handle 'pending' block properly",
  "user": {
    "login": "nuliknol",
    "id": 1125368,
    "node_id": "MDQ6VXNlcjExMjUzNjg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1125368?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nuliknol",
    "html_url": "https://github.com/nuliknol",
    "followers_url": "https://api.github.com/users/nuliknol/followers",
    "following_url": "https://api.github.com/users/nuliknol/following{/other_user}",
    "gists_url": "https://api.github.com/users/nuliknol/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nuliknol/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nuliknol/subscriptions",
    "organizations_url": "https://api.github.com/users/nuliknol/orgs",
    "repos_url": "https://api.github.com/users/nuliknol/repos",
    "events_url": "https://api.github.com/users/nuliknol/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nuliknol/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-06-19T19:17:33Z",
  "updated_at": "2023-11-07T10:21:46Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "The following script:\r\n\r\n```\r\npackage main\r\n\r\nimport (\r\n\t\"os\"\r\n\t\"fmt\"\r\n\t\"context\"\r\n\t\"time\"\r\n\t\"math/big\"\r\n\r\n\t\"github.com/ethereum/go-ethereum/ethclient\"\r\n\r\n)\r\nconst (\r\n)\r\nvar (\r\n\tRPC_URL string\r\n)\r\nfunc main() {\r\n\r\n\tRPC_URL = os.Getenv(\"RPC_URL\")\r\n\teclient, err := ethclient.Dial(RPC_URL)\r\n\tif err!=nil {\r\n\t\tfmt.Printf(\"Can't connect to ETH RPC: %v\\n\",err)\r\n\t\tos.Exit(1)\r\n\t}\r\n\tfor {\r\n\t\tbnum := big.NewInt(-1)\r\n\t\tblock,err := eclient.BlockByNumber(context.Background(),bnum)\r\n\t\tif err != nil {\r\n\t\t\tfmt.Printf(\"Error in BlockByNumber(): %v\\n\",err)\r\n\t\t} else {\r\n\t\t\tfmt.Printf(\"timestamp = %v\\n\",block.Time)\r\n\t\t}\r\n\t\ttime.Sleep(5 * time.Second)\r\n\t}\r\n}\r\n```\r\n\r\nproduces the following error:\r\n```\r\n\r\nError in BlockByNumber(): missing required field 'number' for Header\r\nError in BlockByNumber(): missing required field 'number' for Header\r\nError in BlockByNumber(): missing required field 'number' for Header\r\nError in BlockByNumber(): Post \"http://XX.XX.XX.XX:YYYY\"\": EOF\r\nError in BlockByNumber(): missing required field 'number' for Header\r\nError in BlockByNumber(): missing required field 'number' for Header\r\nError in BlockByNumber(): Post \"http://XX.XX.XX.XX:YYYY\": EOF\r\n```\r\n\r\n\r\nbut it should not be producing any errors, instead it should output the timestamp of the server\r\n\r\nthe above error is shown for geth client v1.10.26, I didn't check for 1.11 yet",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27516/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27516/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1602610903",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27516#issuecomment-1602610903",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27516",
    "id": 1602610903,
    "node_id": "IC_kwDOAOvK985fhebX",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-22T13:08:39Z",
    "updated_at": "2023-06-22T13:08:39Z",
    "author_association": "MEMBER",
    "body": "I have tested this, and it looks like a bug in the RPC server you are using. `number` is required by the spec. When the geth RPC server returns a pending block, the `number` field will be non-null.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1602610903/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1602611216",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27516#issuecomment-1602611216",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27516",
    "id": 1602611216,
    "node_id": "IC_kwDOAOvK985fhegQ",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-22T13:08:52Z",
    "updated_at": "2023-06-22T13:08:52Z",
    "author_association": "MEMBER",
    "body": "Which server did you use?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1602611216/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1798172305",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27516#issuecomment-1798172305",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27516",
    "id": 1798172305,
    "node_id": "IC_kwDOAOvK985rLe6R",
    "user": {
      "login": "pavleprica",
      "id": 30871717,
      "node_id": "MDQ6VXNlcjMwODcxNzE3",
      "avatar_url": "https://avatars.githubusercontent.com/u/30871717?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pavleprica",
      "html_url": "https://github.com/pavleprica",
      "followers_url": "https://api.github.com/users/pavleprica/followers",
      "following_url": "https://api.github.com/users/pavleprica/following{/other_user}",
      "gists_url": "https://api.github.com/users/pavleprica/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pavleprica/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pavleprica/subscriptions",
      "organizations_url": "https://api.github.com/users/pavleprica/orgs",
      "repos_url": "https://api.github.com/users/pavleprica/repos",
      "events_url": "https://api.github.com/users/pavleprica/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pavleprica/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-07T09:55:18Z",
    "updated_at": "2023-11-07T10:21:46Z",
    "author_association": "NONE",
    "body": "Hey, team, we are facing a similar, perhaps the same, issue.\r\n\r\nWe are attempting the latest block with Alchemy and Infura, receiving the `transaction type not supported` err. When debugging, it throws that error when parsing it here: `github.com/ethereum/go-ethereum/ethclient/ethclient.go:146`. However, when specifying some other block, for example, `18519286`, it passes without issues.\r\n\r\nEDIT: Just for reference, we were using `nil` to get the latest one.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1798172305/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
