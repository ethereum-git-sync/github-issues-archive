{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/28074",
  "id": 1885987571,
  "node_id": "I_kwDOAOvK985waeLz",
  "number": 28074,
  "title": "The gasUsed of each EVM call is not clear.",
  "user": {
    "login": "xuht724",
    "id": 82167452,
    "node_id": "MDQ6VXNlcjgyMTY3NDUy",
    "avatar_url": "https://avatars.githubusercontent.com/u/82167452?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/xuht724",
    "html_url": "https://github.com/xuht724",
    "followers_url": "https://api.github.com/users/xuht724/followers",
    "following_url": "https://api.github.com/users/xuht724/following{/other_user}",
    "gists_url": "https://api.github.com/users/xuht724/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/xuht724/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/xuht724/subscriptions",
    "organizations_url": "https://api.github.com/users/xuht724/orgs",
    "repos_url": "https://api.github.com/users/xuht724/repos",
    "events_url": "https://api.github.com/users/xuht724/events{/privacy}",
    "received_events_url": "https://api.github.com/users/xuht724/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 268304226,
      "node_id": "MDU6TGFiZWwyNjgzMDQyMjY=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:docs",
      "name": "type:docs",
      "color": "fef2c0",
      "default": false,
      "description": null
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 14,
  "created_at": "2023-09-07T14:11:37Z",
  "updated_at": "2023-09-08T14:57:21Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I am analysing the gas used distribution in a transaction. Here is a trace example and my analysis result. I am curious about why the calculated remaining gas is larger than the gas after the final call. (40554 > 36662)\r\nDoes any gas refund that I do not consider. How can I correctly get the gas used in each evm call.\r\n\r\n```\r\nTrx Hash 0xb06aca08b58e7b89c47aa33fd250560d3f2d8790902af2895d677c07111f40ca\r\ntrx gas 135181 trx used 94627\r\nTransaction remaining gas 40554\r\naccessList gas cost 33800\r\ncalldata_gascost 432\r\nbegin gas 79949\r\n\r\nEVM Call Gas Distribution \r\n0x6b75d8af000000e20b7a7ddf000ba900b4009a80 0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2 transferFrom\r\nBegin gas 78436 Call gas cost 8732 After Call Gas 69704\r\n0x6b75d8af000000e20b7a7ddf000ba900b4009a80 0x3a22710dbd18ddcfe64e28ed5a97fa4774fd2c3d v2swap\r\nBegin gas 69682 Call gas cost 33020 After Call Gas 36662\r\n```\r\n---\r\n\r\n```json\r\n{\r\n    \"from\": \"0xae2fc483527b8ef99eb5d9b44875f005ba1fae13\",\r\n    \"gas\": \"0x1384d\",\r\n    \"gasUsed\": \"0x171a3\",\r\n    \"to\": \"0x6b75d8af000000e20b7a7ddf000ba900b4009a80\",\r\n    \"input\": \"0x802f183a22710dbd18ddcfe64e28ed5a97fa4774fd2c3d480d4c32\",\r\n    \"calls\": [\r\n        {\r\n            \"from\": \"0x6b75d8af000000e20b7a7ddf000ba900b4009a80\",\r\n            \"gas\": \"0x13264\",\r\n            \"gasUsed\": \"0x221c\",\r\n            \"to\": \"0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2\",\r\n            \"input\": \"0x23b872dd0000000000000000000000006b75d8af000000e20b7a7ddf000ba900b4009a800000000000000000000000003a22710dbd18ddcfe64e28ed5a97fa4774fd2c3d0000000000000000000000000000000000000000000000000ab200a500000000\",\r\n            \"output\": \"0x0000000000000000000000000000000000000000000000000000000000000001\",\r\n            \"value\": \"0x0\",\r\n            \"type\": \"CALL\"\r\n        },\r\n        {\r\n            \"from\": \"0x6b75d8af000000e20b7a7ddf000ba900b4009a80\",\r\n            \"gas\": \"0x11032\",\r\n            \"gasUsed\": \"0x80fc\",\r\n            \"to\": \"0x3a22710dbd18ddcfe64e28ed5a97fa4774fd2c3d\",\r\n            \"input\": \"0x022c0d9f0000000000000000000000000000000000000000480d4c32000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006b75d8af000000e20b7a7ddf000ba900b4009a8000000000000000000000000000000000000000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000000\",\r\n            \"calls\": [\r\n                {\r\n                    \"from\": \"0x3a22710dbd18ddcfe64e28ed5a97fa4774fd2c3d\",\r\n                    \"gas\": \"0xf933\",\r\n                    \"gasUsed\": \"0x28d0\",\r\n                    \"to\": \"0x27f103f86070cc639fef262787a16887d22d8415\",\r\n                    \"input\": \"0xa9059cbb0000000000000000000000006b75d8af000000e20b7a7ddf000ba900b4009a800000000000000000000000000000000000000000480d4c320000000000000000\",\r\n                    \"output\": \"0x0000000000000000000000000000000000000000000000000000000000000001\",\r\n                    \"value\": \"0x0\",\r\n                    \"type\": \"CALL\"\r\n                },\r\n                {\r\n                    \"from\": \"0x3a22710dbd18ddcfe64e28ed5a97fa4774fd2c3d\",\r\n                    \"gas\": \"0xce99\",\r\n                    \"gasUsed\": \"0x2cb\",\r\n                    \"to\": \"0x27f103f86070cc639fef262787a16887d22d8415\",\r\n                    \"input\": \"0x70a082310000000000000000000000003a22710dbd18ddcfe64e28ed5a97fa4774fd2c3d\",\r\n                    \"output\": \"0x000000000000000000000000000000000000000b38821d736fa08423600f081b\",\r\n                    \"type\": \"STATICCALL\"\r\n                },\r\n                {\r\n                    \"from\": \"0x3a22710dbd18ddcfe64e28ed5a97fa4774fd2c3d\",\r\n                    \"gas\": \"0xca44\",\r\n                    \"gasUsed\": \"0x216\",\r\n                    \"to\": \"0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2\",\r\n                    \"input\": \"0x70a082310000000000000000000000003a22710dbd18ddcfe64e28ed5a97fa4774fd2c3d\",\r\n                    \"output\": \"0x000000000000000000000000000000000000000000000001b3cefd15d747e50e\",\r\n                    \"type\": \"STATICCALL\"\r\n                }\r\n            ],\r\n            \"value\": \"0x0\",\r\n            \"type\": \"CALL\"\r\n        }\r\n    ],\r\n    \"value\": \"0xab200a5\",\r\n    \"type\": \"CALL\"\r\n}\r\n```\r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711555949",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28074#issuecomment-1711555949",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074",
    "id": 1711555949,
    "node_id": "IC_kwDOAOvK985mBEVt",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-08T11:57:51Z",
    "updated_at": "2023-09-08T11:57:51Z",
    "author_association": "MEMBER",
    "body": "The trace you posted doesn't seem to match the transaction hash. The input is different on etherscan.\r\n\r\nBut it's strange that the `gasUsed` is higher than `gas` on the top call of the trace you posted. Can you please find the right hash so we can investigate?\r\nThe only explanation would be if there was a lot of refunds. Or indicates a bug in the tracer.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711555949/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711575923",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28074#issuecomment-1711575923",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074",
    "id": 1711575923,
    "node_id": "IC_kwDOAOvK985mBJNz",
    "user": {
      "login": "xuht724",
      "id": 82167452,
      "node_id": "MDQ6VXNlcjgyMTY3NDUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/82167452?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/xuht724",
      "html_url": "https://github.com/xuht724",
      "followers_url": "https://api.github.com/users/xuht724/followers",
      "following_url": "https://api.github.com/users/xuht724/following{/other_user}",
      "gists_url": "https://api.github.com/users/xuht724/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/xuht724/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/xuht724/subscriptions",
      "organizations_url": "https://api.github.com/users/xuht724/orgs",
      "repos_url": "https://api.github.com/users/xuht724/repos",
      "events_url": "https://api.github.com/users/xuht724/events{/privacy}",
      "received_events_url": "https://api.github.com/users/xuht724/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-08T12:14:43Z",
    "updated_at": "2023-09-08T12:14:43Z",
    "author_association": "NONE",
    "body": "> The trace you posted doesn't seem to match the transaction hash. The input is different on etherscan.\r\n> \r\n> But it's strange that the `gasUsed` is higher than `gas` on the top call of the trace you posted. Can you please find the right hash so we can investigate? The only explanation would be if there was a lot of refunds. Or indicates a bug in the tracer.\r\n\r\nThank you for your correction. I have edited the comment and post the correct transaction trace. I have found many transactions like this. And I really curious about the reason.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711575923/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711594668",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28074#issuecomment-1711594668",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074",
    "id": 1711594668,
    "node_id": "IC_kwDOAOvK985mBNys",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-08T12:29:58Z",
    "updated_at": "2023-09-08T12:29:58Z",
    "author_association": "MEMBER",
    "body": "Strangely enough what's wrong is the gasLimit, not gasUsed. What's reported in the trace doesn't match tx's gas limit. But this doesn't seem to be happening for all the txes. Trying to figure out in which case this happens.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711594668/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711605664",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28074#issuecomment-1711605664",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074",
    "id": 1711605664,
    "node_id": "IC_kwDOAOvK985mBQeg",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-08T12:38:51Z",
    "updated_at": "2023-09-08T12:38:51Z",
    "author_association": "MEMBER",
    "body": "Can you please find a recent tx (last 128 blocks ideally) for me to reproduce locally? Also which version are you running on?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711605664/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711620062",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28074#issuecomment-1711620062",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074",
    "id": 1711620062,
    "node_id": "IC_kwDOAOvK985mBT_e",
    "user": {
      "login": "xuht724",
      "id": 82167452,
      "node_id": "MDQ6VXNlcjgyMTY3NDUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/82167452?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/xuht724",
      "html_url": "https://github.com/xuht724",
      "followers_url": "https://api.github.com/users/xuht724/followers",
      "following_url": "https://api.github.com/users/xuht724/following{/other_user}",
      "gists_url": "https://api.github.com/users/xuht724/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/xuht724/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/xuht724/subscriptions",
      "organizations_url": "https://api.github.com/users/xuht724/orgs",
      "repos_url": "https://api.github.com/users/xuht724/repos",
      "events_url": "https://api.github.com/users/xuht724/events{/privacy}",
      "received_events_url": "https://api.github.com/users/xuht724/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-08T12:50:46Z",
    "updated_at": "2023-09-08T12:50:46Z",
    "author_association": "NONE",
    "body": "> Strangely enough what's wrong is the gasLimit, not gasUsed. What's reported in the trace doesn't match tx's gas limit. But this doesn't seem to be happening for all the txes. Trying to figure out in which case this happens.\r\n\r\nI could explain the difference between transaction gaslimit and trace limit. The trace limit is calculated by the transaction gas limit minus accessList gascost, calldata gascost and 21000 (transaction base cost).\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711620062/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711627361",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28074#issuecomment-1711627361",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074",
    "id": 1711627361,
    "node_id": "IC_kwDOAOvK985mBVxh",
    "user": {
      "login": "xuht724",
      "id": 82167452,
      "node_id": "MDQ6VXNlcjgyMTY3NDUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/82167452?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/xuht724",
      "html_url": "https://github.com/xuht724",
      "followers_url": "https://api.github.com/users/xuht724/followers",
      "following_url": "https://api.github.com/users/xuht724/following{/other_user}",
      "gists_url": "https://api.github.com/users/xuht724/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/xuht724/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/xuht724/subscriptions",
      "organizations_url": "https://api.github.com/users/xuht724/orgs",
      "repos_url": "https://api.github.com/users/xuht724/repos",
      "events_url": "https://api.github.com/users/xuht724/events{/privacy}",
      "received_events_url": "https://api.github.com/users/xuht724/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-08T12:54:22Z",
    "updated_at": "2023-09-08T12:54:22Z",
    "author_association": "NONE",
    "body": "> Can you please find a recent tx (last 128 blocks ideally) for me to reproduce locally? Also which version are you running on?\r\n\r\nI think you can try the transaction hash:\r\n0x3200bdf43b3f7290181da46b9996e09c2135625dd3d9358adc0e2b5aa5029e07\r\nI am using Alchemy node service. \r\nI speculate this is caused by the gas refund. But I do not know any method to get gas refund number of the transaction. Do you know any method to do?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711627361/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711639714",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28074#issuecomment-1711639714",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074",
    "id": 1711639714,
    "node_id": "IC_kwDOAOvK985mBYyi",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-08T13:03:59Z",
    "updated_at": "2023-09-08T13:03:59Z",
    "author_association": "MEMBER",
    "body": "```terminal\r\n> debug.traceTransaction('0x3200bdf43b3f7290181da46b9996e09c2135625dd3d9358adc0e2b5aa5029e07', { tracer: 'callTracer' }).gas\r\n\"0x318ee\"\r\n> eth.getTransaction('0x3200bdf43b3f7290181da46b9996e09c2135625dd3d9358adc0e2b5aa5029e07').gas\r\n202990\r\n> 0x318ee\r\n202990\r\n```\r\n\r\nThe gas limit issue was fixed 5 months ago https://github.com/ethereum/go-ethereum/pull/27029. I think Alchemy hasn't updated their nodes. But you said there's something else?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711639714/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711655236",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28074#issuecomment-1711655236",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074",
    "id": 1711655236,
    "node_id": "IC_kwDOAOvK985mBclE",
    "user": {
      "login": "xuht724",
      "id": 82167452,
      "node_id": "MDQ6VXNlcjgyMTY3NDUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/82167452?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/xuht724",
      "html_url": "https://github.com/xuht724",
      "followers_url": "https://api.github.com/users/xuht724/followers",
      "following_url": "https://api.github.com/users/xuht724/following{/other_user}",
      "gists_url": "https://api.github.com/users/xuht724/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/xuht724/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/xuht724/subscriptions",
      "organizations_url": "https://api.github.com/users/xuht724/orgs",
      "repos_url": "https://api.github.com/users/xuht724/repos",
      "events_url": "https://api.github.com/users/xuht724/events{/privacy}",
      "received_events_url": "https://api.github.com/users/xuht724/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-08T13:14:49Z",
    "updated_at": "2023-09-08T13:14:49Z",
    "author_association": "NONE",
    "body": "> ```\r\n> > debug.traceTransaction('0x3200bdf43b3f7290181da46b9996e09c2135625dd3d9358adc0e2b5aa5029e07', { tracer: 'callTracer' }).gas\r\n> \"0x318ee\"\r\n> > eth.getTransaction('0x3200bdf43b3f7290181da46b9996e09c2135625dd3d9358adc0e2b5aa5029e07').gas\r\n> 202990\r\n> > 0x318ee\r\n> 202990\r\n> ```\r\n> \r\n> The gas limit issue was fixed 5 months ago #27029. I think Alchemy hasn't updated their nodes. But you said there's something else?\r\n\r\nThanks for your introduction. But my question focus on the gas refund. I notice that transaction remaining gas is higher than the last call remaining gas. \r\nFor transaction 0x3200bdf43b3f7290181da46b9996e09c2135625dd3d9358adc0e2b5aa5029e07\r\ntransaction remaining gas = 202990 - 142093 = 60897\r\nLast Call remaining gas = 76550 - 22433 = 54117\r\nI would like to ask the reason, may be it is caused by gas refund. But I do not know how to check it and how to calculate the gas refund.\r\n ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711655236/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711672767",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28074#issuecomment-1711672767",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074",
    "id": 1711672767,
    "node_id": "IC_kwDOAOvK985mBg2_",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-08T13:27:21Z",
    "updated_at": "2023-09-08T13:27:21Z",
    "author_association": "MEMBER",
    "body": "According to this https://etherscan.io/vmtrace?txhash=0x3200bdf43b3f7290181da46b9996e09c2135625dd3d9358adc0e2b5aa5029e07&type=parity that's not the last call. The last call has 62635 gas and usage of 534 which turns out to be 62101 remaining gas.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711672767/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711686999",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28074#issuecomment-1711686999",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074",
    "id": 1711686999,
    "node_id": "IC_kwDOAOvK985mBkVX",
    "user": {
      "login": "xuht724",
      "id": 82167452,
      "node_id": "MDQ6VXNlcjgyMTY3NDUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/82167452?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/xuht724",
      "html_url": "https://github.com/xuht724",
      "followers_url": "https://api.github.com/users/xuht724/followers",
      "following_url": "https://api.github.com/users/xuht724/following{/other_user}",
      "gists_url": "https://api.github.com/users/xuht724/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/xuht724/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/xuht724/subscriptions",
      "organizations_url": "https://api.github.com/users/xuht724/orgs",
      "repos_url": "https://api.github.com/users/xuht724/repos",
      "events_url": "https://api.github.com/users/xuht724/events{/privacy}",
      "received_events_url": "https://api.github.com/users/xuht724/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-08T13:37:14Z",
    "updated_at": "2023-09-08T13:37:14Z",
    "author_association": "NONE",
    "body": "> According to this https://etherscan.io/vmtrace?txhash=0x3200bdf43b3f7290181da46b9996e09c2135625dd3d9358adc0e2b5aa5029e07&type=parity that's not the last call. The last call has 62635 gas and usage of 534 which turns out to be 62101 remaining gas.\r\n\r\nYes. But please notice the action[9]. The gas is 76550 and gasused is 22433. You mentioned is the last subcall. I used the last topcall to calculate. Is there any mistake? \r\nBesides, I want to ask if the gasUsed in the calltrace includes its subcall gasUsed. I think it should include but I want to check. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711686999/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711703798",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28074#issuecomment-1711703798",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074",
    "id": 1711703798,
    "node_id": "IC_kwDOAOvK985mBob2",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-08T13:47:39Z",
    "updated_at": "2023-09-08T13:54:21Z",
    "author_association": "MEMBER",
    "body": "> Yes. But please notice the action[9]. The gas is 76550 and gasused is 22433. You mentioned is the last subcall. I used the last topcall to calculate. Is there any mistake?\r\n\r\nAh of course you're right, my bad.\r\n\r\nTo see the refund you can do `debug.traceTransaction('txhash')`. The result is massive, it reports every opcode execution. But it does give a running total of refund gas at each point.\r\n\r\n> Besides, I want to ask if the gasUsed in the calltrace includes its subcall gasUsed. I think it should include but I want to check.\r\n\r\nYes it includes.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711703798/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711718868",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28074#issuecomment-1711718868",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074",
    "id": 1711718868,
    "node_id": "IC_kwDOAOvK985mBsHU",
    "user": {
      "login": "xuht724",
      "id": 82167452,
      "node_id": "MDQ6VXNlcjgyMTY3NDUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/82167452?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/xuht724",
      "html_url": "https://github.com/xuht724",
      "followers_url": "https://api.github.com/users/xuht724/followers",
      "following_url": "https://api.github.com/users/xuht724/following{/other_user}",
      "gists_url": "https://api.github.com/users/xuht724/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/xuht724/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/xuht724/subscriptions",
      "organizations_url": "https://api.github.com/users/xuht724/orgs",
      "repos_url": "https://api.github.com/users/xuht724/repos",
      "events_url": "https://api.github.com/users/xuht724/events{/privacy}",
      "received_events_url": "https://api.github.com/users/xuht724/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-08T13:58:34Z",
    "updated_at": "2023-09-08T13:58:34Z",
    "author_association": "NONE",
    "body": "> > Yes. But please notice the action[9]. The gas is 76550 and gasused is 22433. You mentioned is the last subcall. I used the last topcall to calculate. Is there any mistake?\r\n> \r\n> Ah of course you're right, my bad.\r\n> \r\n> To see the refund you can do `debug.traceTransaction('txhash')`. The result is massive, it reports every opcode execution. But it does give a running total of refund gas at each point.\r\n> \r\n> > Besides, I want to ask if the gasUsed in the calltrace includes its subcall gasUsed. I think it should include but I want to check.\r\n> \r\n> Yes it includes.\r\n\r\nOh! Thanks. And I want ask if there is any rpc to get the debug.traceTransaction('txhash') result for gasrefund. Again, I want to ask if I want to simulate the trx locally, Can I get the trace information about gasrefund and how.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711718868/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711785398",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28074#issuecomment-1711785398",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074",
    "id": 1711785398,
    "node_id": "IC_kwDOAOvK985mB8W2",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-08T14:42:52Z",
    "updated_at": "2023-09-08T14:42:52Z",
    "author_association": "MEMBER",
    "body": "> Oh! Thanks. And I want ask if there is any rpc to get the debug.traceTransaction('txhash') result for gasrefund. Again, I want to ask if I want to simulate the trx locally, Can I get the trace information about gasrefund and how.\r\n\r\nYes there's an RPC method with the same name. `debug_traceTransaction`. I think Alchemy only supports the `callTracer` and `prestateTracer`. So you will probably need a local synced node for this. But then you can see refunds with the default (opcode) tracer. Unfortunately my node doesn't have the state for the tx you sent anymore to check the refund myself.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711785398/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711805996",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28074#issuecomment-1711805996",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28074",
    "id": 1711805996,
    "node_id": "IC_kwDOAOvK985mCBYs",
    "user": {
      "login": "xuht724",
      "id": 82167452,
      "node_id": "MDQ6VXNlcjgyMTY3NDUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/82167452?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/xuht724",
      "html_url": "https://github.com/xuht724",
      "followers_url": "https://api.github.com/users/xuht724/followers",
      "following_url": "https://api.github.com/users/xuht724/following{/other_user}",
      "gists_url": "https://api.github.com/users/xuht724/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/xuht724/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/xuht724/subscriptions",
      "organizations_url": "https://api.github.com/users/xuht724/orgs",
      "repos_url": "https://api.github.com/users/xuht724/repos",
      "events_url": "https://api.github.com/users/xuht724/events{/privacy}",
      "received_events_url": "https://api.github.com/users/xuht724/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-08T14:57:21Z",
    "updated_at": "2023-09-08T14:57:21Z",
    "author_association": "NONE",
    "body": "Really thanks for your help. And I want to if you know some ways to get trace for those transactions that I want to send (I want to check the gas_refund) using any framework. I am using hardhat for testing, but it seems its 'debug_transaction' rpc method will not return gasrefund result. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1711805996/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
