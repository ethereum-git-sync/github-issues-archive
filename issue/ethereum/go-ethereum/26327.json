{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26327",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26327/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26327/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26327/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/26327",
  "id": 1483366701,
  "node_id": "I_kwDOAOvK985YamEt",
  "number": 26327,
  "title": "Geth crashing every few days in snap sync mode",
  "user": {
    "login": "zaneran9",
    "id": 58467733,
    "node_id": "MDQ6VXNlcjU4NDY3NzMz",
    "avatar_url": "https://avatars.githubusercontent.com/u/58467733?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zaneran9",
    "html_url": "https://github.com/zaneran9",
    "followers_url": "https://api.github.com/users/zaneran9/followers",
    "following_url": "https://api.github.com/users/zaneran9/following{/other_user}",
    "gists_url": "https://api.github.com/users/zaneran9/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zaneran9/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zaneran9/subscriptions",
    "organizations_url": "https://api.github.com/users/zaneran9/orgs",
    "repos_url": "https://api.github.com/users/zaneran9/repos",
    "events_url": "https://api.github.com/users/zaneran9/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zaneran9/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-12-08T01:59:42Z",
  "updated_at": "2022-12-08T09:32:28Z",
  "closed_at": "2022-12-08T09:32:27Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `1.10.26-stable`\r\nCL client & version: `prysm@v3.1.2`\r\nOS & Version: `Linux`\r\nCommit hash :  `e5eb32acee19cc9fca6a03b10283b7484246b15a`\r\n\r\n#### Expected behaviour\r\nrun stably\r\n\r\n#### Actual behaviour\r\nIt always crashes again after a few days, although I can get it to work with a reboot\r\n\r\n#### Steps to reproduce the behaviour\r\n##### Server configs\r\n```\r\ncpu 64 (Intel(R) Xeon(R) CPU E5-2678 v3 @ 2.50GHz)\r\nmemory 128G\r\nhard disk(Ordinary) 1.5T\r\n```\r\n\r\n##### run command\r\n```\r\n/data/ethereum/execution/geth --identity prod2-geth --mainnet --networkid 1 --datadir=/data/chain/geth/main --authrpc.vhosts=\"localhost\" --authrpc.jwtsecret=/data/ethereum/consensus/jwt.hex --allow-insecure-unlock --syncmode=snap --http --http.addr 0.0.0.0 --http.port 31000 --http.api admin,web3,eth,txpool,personal,net --http.corsdomain * --http.vhosts * --ws --ws.addr 0.0.0.0 --ws.port 32000 --ws.api admin,web3,eth,txpool,personal,net --ws.origins * --maxpeers 10000 --cache 4096\r\n```\r\n\r\n\r\n#### Backtrace\r\n\r\n````\r\n[backtrace]\r\n````\r\n\r\nWhen submitting logs: please submit them as text and not screenshots.\r\n[logs here](https://github.com/zaneran9/logs/blob/7a40688f9d3305d33bb13a99bfc7aa9a0979e0f0/geth_error_20221208.log)\r\n",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26327/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26327/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1341931683",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26327#issuecomment-1341931683",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26327",
    "id": 1341931683,
    "node_id": "IC_kwDOAOvK985P_ECj",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-08T03:19:16Z",
    "updated_at": "2022-12-08T03:19:16Z",
    "author_association": "MEMBER",
    "body": "Your database looks very wrong, data is corrupted. It's hard to say what's the initial issue for panic.\r\n\r\nBtw, you set the maxPeer to 10k, it's a very large number. Each peer connection will consume some\r\nmemory and my hunch is your memory(128G) may be not enough. I would recommend to decrease \r\nit a bit.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1341931683/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1341955607",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26327#issuecomment-1341955607",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26327",
    "id": 1341955607,
    "node_id": "IC_kwDOAOvK985P_J4X",
    "user": {
      "login": "zaneran9",
      "id": 58467733,
      "node_id": "MDQ6VXNlcjU4NDY3NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/58467733?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zaneran9",
      "html_url": "https://github.com/zaneran9",
      "followers_url": "https://api.github.com/users/zaneran9/followers",
      "following_url": "https://api.github.com/users/zaneran9/following{/other_user}",
      "gists_url": "https://api.github.com/users/zaneran9/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zaneran9/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zaneran9/subscriptions",
      "organizations_url": "https://api.github.com/users/zaneran9/orgs",
      "repos_url": "https://api.github.com/users/zaneran9/repos",
      "events_url": "https://api.github.com/users/zaneran9/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zaneran9/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-08T03:55:00Z",
    "updated_at": "2022-12-08T03:55:00Z",
    "author_association": "NONE",
    "body": "> Your database looks very wrong, data is corrupted. It's hard to say what's the initial issue for panic.\r\n> \r\n> Btw, you set the maxPeer to 10k, it's a very large number. Each peer connection will consume some memory and my hunch is your memory(128G) may be not enough. I would recommend to decrease it a bit.\r\n\r\nThanks for your reply quickly. \r\n\r\nI'm comfused, why does it continue to sync after restarting since the database is corrupted?  And then the best way for me now is to delete the data and start syncing from scratch.\r\n\r\nSetting the max peers is a big reminder for me. Thanks again!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1341955607/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1341955890",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26327#issuecomment-1341955890",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26327",
    "id": 1341955890,
    "node_id": "IC_kwDOAOvK985P_J8y",
    "user": {
      "login": "zaneran9",
      "id": 58467733,
      "node_id": "MDQ6VXNlcjU4NDY3NzMz",
      "avatar_url": "https://avatars.githubusercontent.com/u/58467733?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zaneran9",
      "html_url": "https://github.com/zaneran9",
      "followers_url": "https://api.github.com/users/zaneran9/followers",
      "following_url": "https://api.github.com/users/zaneran9/following{/other_user}",
      "gists_url": "https://api.github.com/users/zaneran9/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zaneran9/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zaneran9/subscriptions",
      "organizations_url": "https://api.github.com/users/zaneran9/orgs",
      "repos_url": "https://api.github.com/users/zaneran9/repos",
      "events_url": "https://api.github.com/users/zaneran9/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zaneran9/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-08T03:55:30Z",
    "updated_at": "2022-12-08T03:55:30Z",
    "author_association": "NONE",
    "body": "> \r\n\r\n@rjl493456442 ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1341955890/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1342358593",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26327#issuecomment-1342358593",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26327",
    "id": 1342358593,
    "node_id": "IC_kwDOAOvK985QAsRB",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-08T09:32:27Z",
    "updated_at": "2022-12-08T09:32:27Z",
    "author_association": "MEMBER",
    "body": "Your system is also complaining about too many open files. That is usually a bad sign that there's a huge usage load from somewhere that's exhausting system resources. Perhaps some open API being hammered via HTTP requests?\r\n\r\nplease raise the number of allowed file descriptors and/or investigate what's DoSing your node and resolve it. After that the missing trie node error means you'll need to just dleete your chaindata folder (you might leave the ancients in there) and resync, there's no salvaging corrupted state unfortunately.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1342358593/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
