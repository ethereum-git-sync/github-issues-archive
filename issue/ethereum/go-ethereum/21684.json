{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21684",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21684/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21684/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21684/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/21684",
  "id": 718533618,
  "node_id": "MDU6SXNzdWU3MTg1MzM2MTg=",
  "number": 21684,
  "title": "ethclient.SendTransaction hangs indefinitely, transaction is not broadcast until node is restarted",
  "user": {
    "login": "RaghavSood",
    "id": 903072,
    "node_id": "MDQ6VXNlcjkwMzA3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/903072?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/RaghavSood",
    "html_url": "https://github.com/RaghavSood",
    "followers_url": "https://api.github.com/users/RaghavSood/followers",
    "following_url": "https://api.github.com/users/RaghavSood/following{/other_user}",
    "gists_url": "https://api.github.com/users/RaghavSood/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/RaghavSood/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/RaghavSood/subscriptions",
    "organizations_url": "https://api.github.com/users/RaghavSood/orgs",
    "repos_url": "https://api.github.com/users/RaghavSood/repos",
    "events_url": "https://api.github.com/users/RaghavSood/events{/privacy}",
    "received_events_url": "https://api.github.com/users/RaghavSood/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-10-10T05:02:22Z",
  "updated_at": "2020-10-17T11:55:31Z",
  "closed_at": "2020-10-17T11:55:31Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 1.9.13-stable\r\nOS & Version: Linux\r\nCommit hash: 1.9.13 release build \r\n\r\n#### Expected behaviour\r\n\r\nCalling SendTransaction results in the transaction being broadcast, and transaction hash being returned\r\n\r\n#### Actual behaviour\r\n\r\nThe transaction is not broadcast, and the call hangs indefinitely\r\n\r\nI believe this might be linked to the state clean up procedures - the same node was able to broadcast transactions just fine about 24 hours ago, and starting having this issue around 16 hours ago. The logs contain messages such as:\r\n\r\n```\r\nDeleted state snapshot leftovers         kind=accounts wiped=104546 elapsed=1m25.876s\r\nCompacting snapshot account area\r\nWiper running, state snapshotting paused\r\n```\r\n\r\nThe deletion and wiper messages indicated `elapsed` times of several hours (which is not an issue, I'd expect that given that this is an archival node)\r\n\r\nIf I restart the node, I receive the submission messages (outlined below) for all the SendTransaction calls that are currently pending:\r\n\r\n```\r\nSubmitted transaction                    fullhash=txid recipient=destination\r\n```\r\n\r\nAfter those messages in the logs, the transactions are still not broadcast - the node shuts down, and the transactions are sent to the network only after it starts again.\r\n\r\nOnce restarted, the SendTransaction call works fine for a minute or two, after which is starts demonstrating the same behaviour.\r\n\r\nThroughout all this, other calls over the same ethclient+websocket endpoint continue to work fine - I am able to receive new chain heads, get transaction receipts, get account balances/nonces without any additional delays or issues.\r\n\r\nEven before the `Submitted transaction` log messages are created, if I try and resend a stuck transaction via the `geth attach` console, it says the tx is already known - however, it is not broadcast into the network until after a restart, and the original SendTransaction call remains stuck\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nTry and broadcast a transaction with a node exhibiting the above behaviour, possibly caused by snapshot cleanup.\r\n\r\n#### Backtrace\r\n\r\nN/A, the node does not crash\r\n",
  "closed_by": {
    "login": "RaghavSood",
    "id": 903072,
    "node_id": "MDQ6VXNlcjkwMzA3Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/903072?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/RaghavSood",
    "html_url": "https://github.com/RaghavSood",
    "followers_url": "https://api.github.com/users/RaghavSood/followers",
    "following_url": "https://api.github.com/users/RaghavSood/following{/other_user}",
    "gists_url": "https://api.github.com/users/RaghavSood/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/RaghavSood/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/RaghavSood/subscriptions",
    "organizations_url": "https://api.github.com/users/RaghavSood/orgs",
    "repos_url": "https://api.github.com/users/RaghavSood/repos",
    "events_url": "https://api.github.com/users/RaghavSood/events{/privacy}",
    "received_events_url": "https://api.github.com/users/RaghavSood/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21684/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21684/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/706491920",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21684#issuecomment-706491920",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21684",
    "id": 706491920,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNjQ5MTkyMA==",
    "user": {
      "login": "RaghavSood",
      "id": 903072,
      "node_id": "MDQ6VXNlcjkwMzA3Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/903072?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RaghavSood",
      "html_url": "https://github.com/RaghavSood",
      "followers_url": "https://api.github.com/users/RaghavSood/followers",
      "following_url": "https://api.github.com/users/RaghavSood/following{/other_user}",
      "gists_url": "https://api.github.com/users/RaghavSood/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RaghavSood/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RaghavSood/subscriptions",
      "organizations_url": "https://api.github.com/users/RaghavSood/orgs",
      "repos_url": "https://api.github.com/users/RaghavSood/repos",
      "events_url": "https://api.github.com/users/RaghavSood/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RaghavSood/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-10T05:35:39Z",
    "updated_at": "2020-10-10T07:12:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "The node now appears to be regenerating state snapshots:\r\n\r\n```\r\nINFO [10-10|05:33:37.493] Aborting state snapshot generation       at=004ee6…4f717c accounts=123825 slots=890805 storage=69.41MiB  elapsed=34m5.704s  eta=471h25m56.083s\r\nINFO [10-10|05:33:37.494] Resuming state snapshot generation       at=004ee6…4f717c accounts=123825 slots=890805 storage=69.41MiB  elapsed=34m5.704s  eta=471h25m56.083s\r\n```\r\n\r\nThese messages show up every 30-40 seconds, always in quick succession - the eta started at a couple of days, and has moved up to around 20 days now.\r\n\r\nTransaction broadcasting still hangs indefinitely.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/706491920/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/707733545",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21684#issuecomment-707733545",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21684",
    "id": 707733545,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNzczMzU0NQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-13T13:21:05Z",
    "updated_at": "2020-10-13T13:21:05Z",
    "author_association": "MEMBER",
    "body": "Please update your node to a recent release. We're constantly doing bugfix releases and there's a high chance your issue is already solved. We're 10 releases ahead of your node.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/707733545/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/710862724",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21684#issuecomment-710862724",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21684",
    "id": 710862724,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMDg2MjcyNA==",
    "user": {
      "login": "RaghavSood",
      "id": 903072,
      "node_id": "MDQ6VXNlcjkwMzA3Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/903072?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RaghavSood",
      "html_url": "https://github.com/RaghavSood",
      "followers_url": "https://api.github.com/users/RaghavSood/followers",
      "following_url": "https://api.github.com/users/RaghavSood/following{/other_user}",
      "gists_url": "https://api.github.com/users/RaghavSood/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RaghavSood/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RaghavSood/subscriptions",
      "organizations_url": "https://api.github.com/users/RaghavSood/orgs",
      "repos_url": "https://api.github.com/users/RaghavSood/repos",
      "events_url": "https://api.github.com/users/RaghavSood/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RaghavSood/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-17T11:55:31Z",
    "updated_at": "2020-10-17T11:55:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing for now as an upgrade does seem to have fixed it",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/710862724/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
