{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23015",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23015/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23015/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23015/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23015",
  "id": 914871157,
  "node_id": "MDU6SXNzdWU5MTQ4NzExNTc=",
  "number": 23015,
  "title": "return constructor response in abigen",
  "user": {
    "login": "huahuayu",
    "id": 1725060,
    "node_id": "MDQ6VXNlcjE3MjUwNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1725060?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/huahuayu",
    "html_url": "https://github.com/huahuayu",
    "followers_url": "https://api.github.com/users/huahuayu/followers",
    "following_url": "https://api.github.com/users/huahuayu/following{/other_user}",
    "gists_url": "https://api.github.com/users/huahuayu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/huahuayu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/huahuayu/subscriptions",
    "organizations_url": "https://api.github.com/users/huahuayu/orgs",
    "repos_url": "https://api.github.com/users/huahuayu/repos",
    "events_url": "https://api.github.com/users/huahuayu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/huahuayu/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 268304226,
      "node_id": "MDU6TGFiZWwyNjgzMDQyMjY=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:docs",
      "name": "type:docs",
      "color": "fef2c0",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-06-08T11:28:31Z",
  "updated_at": "2022-03-02T06:23:11Z",
  "closed_at": "2021-09-09T12:15:39Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## background\r\n\r\nhi, here is a very smart and generic multicall contract ([source](https://github.com/indexed-finance/multicall/blob/master/contracts/MultiCall.sol))\r\n\r\n```sol\r\ncontract MultiCall {\r\n  constructor(\r\n    address[] memory targets,\r\n    bytes[] memory datas\r\n  ) public {\r\n    uint256 len = targets.length;\r\n    require(datas.length == len, \"Error: Array lengths do not match.\");\r\n\r\n    bytes[] memory returnDatas = new bytes[](len);\r\n\r\n    for (uint256 i = 0; i < len; i++) {\r\n      address target = targets[i];\r\n      bytes memory data = datas[i];\r\n      (bool success, bytes memory returnData) = target.call(data);\r\n      if (!success) {\r\n        returnDatas[i] = bytes(\"\");\r\n      } else {\r\n        returnDatas[i] = returnData;\r\n      }\r\n    }\r\n    bytes memory data = abi.encode(block.number, returnDatas);\r\n    assembly { return(add(data, 32), data) }\r\n  }\r\n}\r\n```\r\n\r\nThe idea behind it is to call the constructor to query chain data without any fee. It's flexible so I like it.\r\n\r\nHere is the usage by javascript https://github.com/indexed-finance/multicall#general-usage\r\n\r\nBut when it comes to go,  I don't know how to call it to get same result.\r\n\r\n## question\r\n\r\nI use abigen to get it's go binding code\r\n\r\n```go\r\nfunc DeployMulticall(auth *bind.TransactOpts, backend bind.ContractBackend, targets []common.Address, datas [][]byte) (common.Address, *types.Transaction, *Multicall, error) {\r\n\tparsed, err := abi.JSON(strings.NewReader(MulticallABI))\r\n\tif err != nil {\r\n\t\treturn common.Address{}, nil, nil, err\r\n\t}\r\n\r\n\taddress, tx, contract, err := bind.DeployContract(auth, parsed, common.FromHex(MulticallBin), backend, targets, datas)\r\n\tif err != nil {\r\n\t\treturn common.Address{}, nil, nil, err\r\n\t}\r\n\treturn address, tx, &Multicall{MulticallCaller: MulticallCaller{contract: contract}, MulticallTransactor: MulticallTransactor{contract: contract}, MulticallFilterer: MulticallFilterer{contract: contract}}, nil\r\n}\r\n```\r\n\r\nQ1. The go binding contract doesn't return the constructor's response, so I can't get the multicall result.\r\n\r\nQ2. The first param in the go binding code is `auth *bind.TransactOpts` means that I have to use an address with some eth balance to deploy it, but if I just want to simulate the call, I also need to provide it.\r\n\r\n\r\n",
  "closed_by": {
    "login": "MariusVanDerWijden",
    "id": 16664698,
    "node_id": "MDQ6VXNlcjE2NjY0Njk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MariusVanDerWijden",
    "html_url": "https://github.com/MariusVanDerWijden",
    "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
    "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
    "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
    "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
    "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
    "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23015/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23015/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/856697918",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23015#issuecomment-856697918",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23015",
    "id": 856697918,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1NjY5NzkxOA==",
    "user": {
      "login": "huahuayu",
      "id": 1725060,
      "node_id": "MDQ6VXNlcjE3MjUwNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1725060?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huahuayu",
      "html_url": "https://github.com/huahuayu",
      "followers_url": "https://api.github.com/users/huahuayu/followers",
      "following_url": "https://api.github.com/users/huahuayu/following{/other_user}",
      "gists_url": "https://api.github.com/users/huahuayu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huahuayu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huahuayu/subscriptions",
      "organizations_url": "https://api.github.com/users/huahuayu/orgs",
      "repos_url": "https://api.github.com/users/huahuayu/repos",
      "events_url": "https://api.github.com/users/huahuayu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huahuayu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-08T11:53:08Z",
    "updated_at": "2021-06-08T11:53:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "usually, the constructor don't have return values, but it can have, abigen don't cover this.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/856697918/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/856707030",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23015#issuecomment-856707030",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23015",
    "id": 856707030,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1NjcwNzAzMA==",
    "user": {
      "login": "huahuayu",
      "id": 1725060,
      "node_id": "MDQ6VXNlcjE3MjUwNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1725060?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huahuayu",
      "html_url": "https://github.com/huahuayu",
      "followers_url": "https://api.github.com/users/huahuayu/followers",
      "following_url": "https://api.github.com/users/huahuayu/following{/other_user}",
      "gists_url": "https://api.github.com/users/huahuayu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huahuayu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huahuayu/subscriptions",
      "organizations_url": "https://api.github.com/users/huahuayu/orgs",
      "repos_url": "https://api.github.com/users/huahuayu/repos",
      "events_url": "https://api.github.com/users/huahuayu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huahuayu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-08T12:06:46Z",
    "updated_at": "2021-06-13T06:52:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think I can use this:\r\n\r\nhttps://github.com/ethereum/go-ethereum/blob/c503f98f6d5e80e079c1d8a3601d188af2a899da/ethclient/ethclient.go#L475\r\nbut to encode the request data and decode response data take some effort, not so straightforward. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/856707030/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/916036892",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23015#issuecomment-916036892",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23015",
    "id": 916036892,
    "node_id": "IC_kwDOAOvK9842mZ0c",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-09T12:15:39Z",
    "updated_at": "2021-09-09T12:15:39Z",
    "author_association": "MEMBER",
    "body": "Constructors do not return anything in solidity. Due to the assembly used in the contract you can force the constructor to return something. We have **no** idea what that something is (as we can not parse it from the contracts abi), thus we can not decode the response. Yes you can use `CallContract` (or `Transact` in the auto generated bindings) to invoke your contract with arbitrary code and parse the result. \r\n\r\nThis is such a niche use case (wanting to get data from the constructor) that I don't think we should support it in abigen.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/916036892/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
