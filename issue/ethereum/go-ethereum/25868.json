{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25868",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25868/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25868/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25868/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/25868",
  "id": 1385668635,
  "node_id": "I_kwDOAOvK985Sl6Ab",
  "number": 25868,
  "title": "Data race via graphql",
  "user": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "s1na",
    "id": 1591639,
    "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/s1na",
    "html_url": "https://github.com/s1na",
    "followers_url": "https://api.github.com/users/s1na/followers",
    "following_url": "https://api.github.com/users/s1na/following{/other_user}",
    "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
    "organizations_url": "https://api.github.com/users/s1na/orgs",
    "repos_url": "https://api.github.com/users/s1na/repos",
    "events_url": "https://api.github.com/users/s1na/events{/privacy}",
    "received_events_url": "https://api.github.com/users/s1na/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-09-26T08:41:02Z",
  "updated_at": "2022-10-13T11:21:52Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Detected by travis cron-job (https://app.travis-ci.com/github/ethereum/go-ethereum/jobs/583768087) \r\n```\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c0006fe4a0 by goroutine 364:\r\n  github.com/ethereum/go-ethereum/graphql.(*Transaction).Logs()\r\n      /home/travis/gopath/src/github.com/ethereum/go-ethereum/graphql/graphql.go:466 +0x3b0\r\n  runtime.call32()\r\n      /home/travis/.gimme/versions/go1.19.1.linux.amd64/src/runtime/asm_amd64.s:725 +0x48\r\n  reflect.Value.Call()\r\n      /home/travis/.gimme/versions/go1.19.1.linux.amd64/src/reflect/value.go:368 +0xc7\r\n  github.com/graph-gophers/graphql-go/internal/exec.execFieldSelection.func2()\r\n      /home/travis/gopath/pkg/mod/github.com/graph-gophers/graphql-go@v1.3.0/internal/exec/exec.go:211 +0xa1b\r\n  github.com/graph-gophers/graphql-go/internal/exec.execFieldSelection()\r\n      /home/travis/gopath/pkg/mod/github.com/graph-gophers/graphql-go@v1.3.0/internal/exec/exec.go:231 +0x37d\r\n  github.com/graph-gophers/graphql-go/internal/exec.(*Request).execSelections.func1()\r\n      /home/travis/gopath/pkg/mod/github.com/graph-gophers/graphql-go@v1.3.0/internal/exec/exec.go:81 +0x2d4\r\n  github.com/graph-gophers/graphql-go/internal/exec.(*Request).execSelections.func2()\r\n      /home/travis/gopath/pkg/mod/github.com/graph-gophers/graphql-go@v1.3.0/internal/exec/exec.go:82 +0x47\r\n\r\nPrevious read at 0x00c0006fe4a0 by goroutine 365:\r\n  github.com/ethereum/go-ethereum/rpc.(*BlockNumberOrHash).Hash()\r\n      /home/travis/gopath/src/github.com/ethereum/go-ethereum/rpc/types.go:223 +0x144\r\n  github.com/ethereum/go-ethereum/graphql.(*Transaction).Logs()\r\n      /home/travis/gopath/src/github.com/ethereum/go-ethereum/graphql/graphql.go:460 +0xcb\r\n  runtime.call32()\r\n      /home/travis/.gimme/versions/go1.19.1.linux.amd64/src/runtime/asm_amd64.s:725 +0x48\r\n  reflect.Value.Call()\r\n      /home/travis/.gimme/versions/go1.19.1.linux.amd64/src/reflect/value.go:368 +0xc7\r\n  github.com/graph-gophers/graphql-go/internal/exec.execFieldSelection.func2()\r\n      /home/travis/gopath/pkg/mod/github.com/graph-gophers/graphql-go@v1.3.0/internal/exec/exec.go:211 +0xa1b\r\n  github.com/graph-gophers/graphql-go/internal/exec.execFieldSelection()\r\n      /home/travis/gopath/pkg/mod/github.com/graph-gophers/graphql-go@v1.3.0/internal/exec/exec.go:231 +0x37d\r\n  github.com/graph-gophers/graphql-go/internal/exec.(*Request).execSelections.func1()\r\n      /home/travis/gopath/pkg/mod/github.com/graph-gophers/graphql-go@v1.3.0/internal/exec/exec.go:81 +0x2d4\r\n  github.com/graph-gophers/graphql-go/internal/exec.(*Request).execSelections.func2()\r\n      /home/travis/gopath/pkg/mod/github.com/graph-gophers/graphql-go@v1.3.0/internal/exec/exec.go:82 +0x47\r\nGoroutine 364 (running) created at:\r\n```\r\n\r\n```golang\r\n\r\nfunc (t *Transaction) Logs(ctx context.Context) (*[]*Log, error) {\r\n\tif _, err := t.resolve(ctx); err != nil {\r\n\t\treturn nil, err\r\n\t}\r\n\tif t.block == nil {\r\n\t\treturn nil, nil\r\n\t}\r\n\tif _, ok := t.block.numberOrHash.Hash(); !ok {\r\n\t\theader, err := t.r.backend.HeaderByNumberOrHash(ctx, *t.block.numberOrHash)\r\n\t\tif err != nil {\r\n\t\t\treturn nil, err\r\n\t\t}\r\n\t\thash := header.Hash()\r\n\t\tt.block.numberOrHash.BlockHash = &hash             //  <--- THIS LINE\r\n\t}\r\n\treturn t.getLogs(ctx)\r\n}\r\n```\r\n```golang\r\nfunc (bnh *BlockNumberOrHash) Hash() (common.Hash, bool) {\r\n\tif bnh.BlockHash != nil {                              //   <-- PREV READ\r\n\t\treturn *bnh.BlockHash, true \r\n\t}\r\n\treturn common.Hash{}, false\r\n}\r\n```\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25868/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25868/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1258032903",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25868#issuecomment-1258032903",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25868",
    "id": 1258032903,
    "node_id": "IC_kwDOAOvK985K_A8H",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-26T13:20:39Z",
    "updated_at": "2022-09-26T13:20:39Z",
    "author_association": "MEMBER",
    "body": "This code keeps on giving...I'll look into it thanks for reporting.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1258032903/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1277441819",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25868#issuecomment-1277441819",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25868",
    "id": 1277441819,
    "node_id": "IC_kwDOAOvK985MJDcb",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-13T11:13:10Z",
    "updated_at": "2022-10-13T11:13:10Z",
    "author_association": "MEMBER",
    "body": "```\r\nt.block.numberOrHash.BlockHash = &hash \r\n```\r\nPerhaps you can just change this to be set/read using `atomic` , via a setter and a getter?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1277441819/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1277451511",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25868#issuecomment-1277451511",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25868",
    "id": 1277451511,
    "node_id": "IC_kwDOAOvK985MJFz3",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-13T11:21:52Z",
    "updated_at": "2022-10-13T11:21:52Z",
    "author_association": "MEMBER",
    "body": "> Perhaps you can just change this to be set/read using atomic , via a setter and a getter?\r\n\r\nHm, the fields are public, so that's not a super-great change",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1277451511/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
