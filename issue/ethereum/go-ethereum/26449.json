{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26449",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26449/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26449/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26449/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/26449",
  "id": 1524436225,
  "node_id": "I_kwDOAOvK985a3Q0B",
  "number": 26449,
  "title": "Invalid merkle root - on two separate servers, latest release",
  "user": {
    "login": "quakemmo",
    "id": 39710297,
    "node_id": "MDQ6VXNlcjM5NzEwMjk3",
    "avatar_url": "https://avatars.githubusercontent.com/u/39710297?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/quakemmo",
    "html_url": "https://github.com/quakemmo",
    "followers_url": "https://api.github.com/users/quakemmo/followers",
    "following_url": "https://api.github.com/users/quakemmo/following{/other_user}",
    "gists_url": "https://api.github.com/users/quakemmo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/quakemmo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/quakemmo/subscriptions",
    "organizations_url": "https://api.github.com/users/quakemmo/orgs",
    "repos_url": "https://api.github.com/users/quakemmo/repos",
    "events_url": "https://api.github.com/users/quakemmo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/quakemmo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    },
    {
      "id": 1132754722,
      "node_id": "MDU6TGFiZWwxMTMyNzU0NzIy",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/need:more-information",
      "name": "need:more-information",
      "color": "db6fa3",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-01-08T10:02:08Z",
  "updated_at": "2023-02-07T12:55:58Z",
  "closed_at": "2023-02-07T12:55:58Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `1.10.26`\r\nCL client & version: lighthouse/nimbus/prysm@v3.1.2\r\nOS & Version: Debian Linux 11, 128 GB of RAM, 6 TB SSD, i5 cpu\r\nCommit hash :\r\n\r\n#### Expected behaviour\r\nSync and keep running fine\r\n\r\n#### Actual behaviour\r\nEvery few days, the fully synced node gets the invalid merkle root error, then quits keeping up with the network. I run TWO separate identical nodes on two different physical servers, it happens about once every 4-5 days to either one or the other. I then have to rewind with setHead a few thousand blocks back, or fully resync from scratch (if setHead doesn't help).\r\n\r\n#### Steps to reproduce the behaviour\r\nLaunch cmdline:\r\n```./geth --mainnet --http --http.api admin,eth,net,web3,txpool,personal,les,debug --http.corsdomain * --http.addr 0.0.0.0 --http.port 8546 --http.vhosts=* --port 0 --nat none --syncmode=snap --snapshot=false --maxpeers=100 --authrpc.jwtsecret /home/geth/jwt.hex```\r\n\r\n#### Backtrace\r\n\r\n````\r\n         145: cumulative: 29861364 gas: 346913 contract: 0x0000000000000000000000000000000000000000 status: 1 tx: 0x292f63c6755db640be00a1cc24a932cfb07c87020e177c25d34b02570228c59b logs: [0xc09f035290 0xc09f035340 0xc09f0353f0 0xc09f0354a0] bloom: 00000000002000000000000000000000000000000000000000000100000000000880000010000000000000000008000000000000000100000000000000000000000000000000000000000008000000000000000000000800001000000000100000800000020000000000000000000800000000000000000000000010000000000000000000000000000200000000000000000000000000000000000010000000000000800000000000000000000000000000000000000020000000000000000000000002000000000008000000000000004000000200000000000000000020000000000001000000000000000000000040000000400000000000000000000000 state:\r\n         146: cumulative: 29882364 gas: 21000 contract: 0x0000000000000000000000000000000000000000 status: 1 tx: 0x83a34446328f830c14b8be9805d8282d267f9ad1f78e235bb6c2c103580ecedd logs: [] bloom: 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 state:\r\n         147: cumulative: 29929044 gas: 46680 contract: 0x0000000000000000000000000000000000000000 status: 1 tx: 0x6ed50f3567535635ebc9256906ae6963a648992991c7997af8f9cbbab649331d logs: [0xc09f035550] bloom: 00000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000000000008000002000000000000000000000000000040000000000000000000000040001000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000200000000000000000000200800000000000000000000000000000000000000000000000000000000 state:\r\n         148: cumulative: 29950099 gas: 21055 contract: 0x0000000000000000000000000000000000000000 status: 1 tx: 0xa43b611f3a49750eefaa367ef1a7d6c0e193a4800b03c187f0bce9195206d5a6 logs: [] bloom: 00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000 state:\r\n\r\n\r\nError: invalid merkle root (remote: 6a203ae01ed15655c731a325e321f8a80791dc33324527399483e9308c4e28d0 local: 65cbf4ac72763e224058b0ebd1370fd8f7191e841753766927d28efe1e76333e)\r\n##############################\r\n\r\nWARN [01-08|09:42:37.129] NewPayloadV1: inserting block failed     error=\"invalid merkle root (remote: 6a203ae01ed15655c731a325e321f8a80791dc33324527399483e9308c4e28d0 local: 65cbf4ac72763e224058b0ebd1370fd8f7191e841753766927d28efe1e76333e)\"\r\n\r\n````\r\n\r\nWhen submitting logs: please submit them as text and not screenshots.\r\n",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26449/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 1,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26449/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1374832801",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26449#issuecomment-1374832801",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26449",
    "id": 1374832801,
    "node_id": "IC_kwDOAOvK985R8kih",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-08T13:09:54Z",
    "updated_at": "2023-01-08T13:09:54Z",
    "author_association": "MEMBER",
    "body": "Feels like your database is corrupted. Do you have any unclean shutdown? (You can see it from startup logs)\r\n \r\n`--snapshot=false` snapshot is disabled by you, so it's irrelevant with snapshot, only with trie itself.\r\n\r\nYou can check if your state database is fired by `geth snapshot traverse-state --datadir <your dir>`, but it will take probably the entire day to finish, or capture the corrupted state early.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1374832801/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1374946007",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26449#issuecomment-1374946007",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26449",
    "id": 1374946007,
    "node_id": "IC_kwDOAOvK985R9ALX",
    "user": {
      "login": "quakemmo",
      "id": 39710297,
      "node_id": "MDQ6VXNlcjM5NzEwMjk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/39710297?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/quakemmo",
      "html_url": "https://github.com/quakemmo",
      "followers_url": "https://api.github.com/users/quakemmo/followers",
      "following_url": "https://api.github.com/users/quakemmo/following{/other_user}",
      "gists_url": "https://api.github.com/users/quakemmo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/quakemmo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/quakemmo/subscriptions",
      "organizations_url": "https://api.github.com/users/quakemmo/orgs",
      "repos_url": "https://api.github.com/users/quakemmo/repos",
      "events_url": "https://api.github.com/users/quakemmo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/quakemmo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-08T22:36:01Z",
    "updated_at": "2023-01-08T22:36:01Z",
    "author_association": "NONE",
    "body": "There were no unclean shutdowns or any shutdowns at all.\r\n\r\nBoth nodes run properly for days, then one will have the invalid merkle root problem, and require massive amounts of massaging to start working again, sometimes setHead'ing back a little, sometimes a lot, sometimes requiring a DB wipe and resync from scratch.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1374946007/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1375596601",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26449#issuecomment-1375596601",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26449",
    "id": 1375596601,
    "node_id": "IC_kwDOAOvK985R_fA5",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-09T13:06:02Z",
    "updated_at": "2023-01-09T13:06:02Z",
    "author_association": "MEMBER",
    "body": "Since you use `--snapshot=false `, you are running on 'raw trie', not using the snapshot acceleration structure. This means that any corruption should be pretty simple to find, we can just iterate the trie from the top, and see if it is indeed intact. \r\n\r\nI assume that it is not: some node is missing, and when a block is executed, the missing node causes the execution to see an account as \"not existing\" while in fact it does exist. \r\n\r\nAnd we do already have just a diagnostic command. `geth snapshot traverse-state`. \r\n\r\nRunning that  will take quite some time, but after that we should know a bit more about the error. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1375596601/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1420727099",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26449#issuecomment-1420727099",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26449",
    "id": 1420727099,
    "node_id": "IC_kwDOAOvK985UrpM7",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-07T12:55:58Z",
    "updated_at": "2023-02-07T12:55:58Z",
    "author_association": "MEMBER",
    "body": "This seems abandoned, closing",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1420727099/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
