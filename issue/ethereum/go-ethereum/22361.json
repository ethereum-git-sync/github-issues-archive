{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/22361",
  "id": 812915576,
  "node_id": "MDU6SXNzdWU4MTI5MTU1NzY=",
  "number": 22361,
  "title": "high clef memory usage",
  "user": {
    "login": "attila-lendvai",
    "id": 840345,
    "node_id": "MDQ6VXNlcjg0MDM0NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/840345?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/attila-lendvai",
    "html_url": "https://github.com/attila-lendvai",
    "followers_url": "https://api.github.com/users/attila-lendvai/followers",
    "following_url": "https://api.github.com/users/attila-lendvai/following{/other_user}",
    "gists_url": "https://api.github.com/users/attila-lendvai/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/attila-lendvai/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/attila-lendvai/subscriptions",
    "organizations_url": "https://api.github.com/users/attila-lendvai/orgs",
    "repos_url": "https://api.github.com/users/attila-lendvai/repos",
    "events_url": "https://api.github.com/users/attila-lendvai/events{/privacy}",
    "received_events_url": "https://api.github.com/users/attila-lendvai/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 14,
  "created_at": "2021-02-21T18:14:42Z",
  "updated_at": "2021-05-27T09:50:32Z",
  "closed_at": "2021-05-27T09:50:32Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\n```\r\n/nix/store/hd5qrid1y7pawrc1l5r963miwj9fg9hx-go-ethereum-1.9.25/bin/clef --version\r\nClef version 0.0.0\r\n```\r\n\r\nOS & Version: Linux (NixOS)\r\n\r\n#### Expected behaviour\r\n\r\nMemory usage in the ballpark of 200MB\r\n\r\n#### Actual behaviour\r\n\r\nMemory usage goes up to 1-1.5GB soon after operation begins, and i've seen processes with 9GB of memory usage.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nhttp://docs.ethswarm.org/\r\n\r\nThis is with bee-clef, which is just some integration scripts to start up a clef executable for a bee process to serve it as an automated external signer.\r\n\r\nDue to architectural reasons, bee scales better when running multiple instances on the same machine (as opposed to increasing the provided storage capacity), and each bee instance requires an exclusive clef instance, but this quickly eats up a lot of memory.\r\n",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/783409956",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22361#issuecomment-783409956",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361",
    "id": 783409956,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MzQwOTk1Ng==",
    "user": {
      "login": "attila-lendvai",
      "id": 840345,
      "node_id": "MDQ6VXNlcjg0MDM0NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/840345?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/attila-lendvai",
      "html_url": "https://github.com/attila-lendvai",
      "followers_url": "https://api.github.com/users/attila-lendvai/followers",
      "following_url": "https://api.github.com/users/attila-lendvai/following{/other_user}",
      "gists_url": "https://api.github.com/users/attila-lendvai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/attila-lendvai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/attila-lendvai/subscriptions",
      "organizations_url": "https://api.github.com/users/attila-lendvai/orgs",
      "repos_url": "https://api.github.com/users/attila-lendvai/repos",
      "events_url": "https://api.github.com/users/attila-lendvai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/attila-lendvai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-22T14:22:33Z",
    "updated_at": "2021-02-22T14:22:33Z",
    "author_association": "NONE",
    "body": "a wild guess: bee initiates multiple parallel requests to clef, this slows down clef's response, this results in more open requests... turning into a positive feedback loop.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/783409956/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/783497794",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22361#issuecomment-783497794",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361",
    "id": 783497794,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MzQ5Nzc5NA==",
    "user": {
      "login": "attila-lendvai",
      "id": 840345,
      "node_id": "MDQ6VXNlcjg0MDM0NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/840345?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/attila-lendvai",
      "html_url": "https://github.com/attila-lendvai",
      "followers_url": "https://api.github.com/users/attila-lendvai/followers",
      "following_url": "https://api.github.com/users/attila-lendvai/following{/other_user}",
      "gists_url": "https://api.github.com/users/attila-lendvai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/attila-lendvai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/attila-lendvai/subscriptions",
      "organizations_url": "https://api.github.com/users/attila-lendvai/orgs",
      "repos_url": "https://api.github.com/users/attila-lendvai/repos",
      "events_url": "https://api.github.com/users/attila-lendvai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/attila-lendvai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-22T16:27:17Z",
    "updated_at": "2021-02-22T16:27:17Z",
    "author_association": "NONE",
    "body": "@acud i have just seen 11GB memory usage for a clef process. i stopped the bee process that was using it, which stopped gracefully. clef continued to consume 11GB for around the next 5 minutes, and sometimes also a lot of CPU, and then its memory usage started to decrease.\r\n\r\nthis very much smells like bee is sending a torrent of signing operations to clef that it has trouble processing fast enough. and the more requests come, the slower clef becomes. then stopping the source of the requests normalizes memory usage after 5-10 more minutes.\r\n\r\nnote that when this happened with one of the bee+clef pairs on my server, i had another two running on the same machine, and they were not having the same issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/783497794/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/783683191",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22361#issuecomment-783683191",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361",
    "id": 783683191,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MzY4MzE5MQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-22T21:21:35Z",
    "updated_at": "2021-02-22T21:21:35Z",
    "author_association": "MEMBER",
    "body": "Have you tried using --lightkdf keystores? Opening them otherwise consumes a lot of ram",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/783683191/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/784024606",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22361#issuecomment-784024606",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361",
    "id": 784024606,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NDAyNDYwNg==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-23T09:13:25Z",
    "updated_at": "2021-02-23T09:13:25Z",
    "author_association": "MEMBER",
    "body": "@acud the auditlog should help find what happens -- you should be able to see exactly at what times what requests were made (and figure out the response times for those that were responded to)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/784024606/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/784031160",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22361#issuecomment-784031160",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361",
    "id": 784031160,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NDAzMTE2MA==",
    "user": {
      "login": "attila-lendvai",
      "id": 840345,
      "node_id": "MDQ6VXNlcjg0MDM0NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/840345?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/attila-lendvai",
      "html_url": "https://github.com/attila-lendvai",
      "followers_url": "https://api.github.com/users/attila-lendvai/followers",
      "following_url": "https://api.github.com/users/attila-lendvai/following{/other_user}",
      "gists_url": "https://api.github.com/users/attila-lendvai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/attila-lendvai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/attila-lendvai/subscriptions",
      "organizations_url": "https://api.github.com/users/attila-lendvai/orgs",
      "repos_url": "https://api.github.com/users/attila-lendvai/repos",
      "events_url": "https://api.github.com/users/attila-lendvai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/attila-lendvai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-23T09:25:08Z",
    "updated_at": "2021-02-23T09:26:03Z",
    "author_association": "NONE",
    "body": "i will test running with `--lightkdf`, and enable `audit.log` into `/var/lib/bee-clef/audit.log` (assuming that it doesn't contain sensitive data).\r\n\r\nwill report the results here.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/784031160/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/784053245",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22361#issuecomment-784053245",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361",
    "id": 784053245,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NDA1MzI0NQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-23T10:03:26Z",
    "updated_at": "2021-02-23T10:03:26Z",
    "author_association": "MEMBER",
    "body": "Note, though, `--lightkdf` only make a change for new keystores, it doesn't affect how much mem it requires to decrypt an existing keystore",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/784053245/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/784053957",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22361#issuecomment-784053957",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361",
    "id": 784053957,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NDA1Mzk1Nw==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-23T10:04:26Z",
    "updated_at": "2021-02-23T10:04:26Z",
    "author_association": "MEMBER",
    "body": "A potential change (if this is the cause) could be to make it possible to _keep_ the decrypted keystore in memory, after the initial decryption. It would probably have to be hidden behind a flag, so it would only be available for advanced users.  ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/784053957/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/784100434",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22361#issuecomment-784100434",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361",
    "id": 784100434,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NDEwMDQzNA==",
    "user": {
      "login": "attila-lendvai",
      "id": 840345,
      "node_id": "MDQ6VXNlcjg0MDM0NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/840345?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/attila-lendvai",
      "html_url": "https://github.com/attila-lendvai",
      "followers_url": "https://api.github.com/users/attila-lendvai/followers",
      "following_url": "https://api.github.com/users/attila-lendvai/following{/other_user}",
      "gists_url": "https://api.github.com/users/attila-lendvai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/attila-lendvai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/attila-lendvai/subscriptions",
      "organizations_url": "https://api.github.com/users/attila-lendvai/orgs",
      "repos_url": "https://api.github.com/users/attila-lendvai/repos",
      "events_url": "https://api.github.com/users/attila-lendvai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/attila-lendvai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-23T10:31:28Z",
    "updated_at": "2021-02-23T11:26:45Z",
    "author_association": "NONE",
    "body": "confirmed: i have recreated the keystore using `--lightkdf` and now clef's memory usage remains trivial: it's some 70 MB compared to sometimes running up to 10+ GB previously.\r\n\r\ni don't see any downsides to using `--lightkdf`: these keys will be lowsec stuff in an automated environment anyway. i'll prepare a PR to bee-clef, unless advised otherwise.\r\n\r\nthank you for the help @holiman !\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/784100434/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/785053035",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22361#issuecomment-785053035",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361",
    "id": 785053035,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NTA1MzAzNQ==",
    "user": {
      "login": "filoozom",
      "id": 6319092,
      "node_id": "MDQ6VXNlcjYzMTkwOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6319092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/filoozom",
      "html_url": "https://github.com/filoozom",
      "followers_url": "https://api.github.com/users/filoozom/followers",
      "following_url": "https://api.github.com/users/filoozom/following{/other_user}",
      "gists_url": "https://api.github.com/users/filoozom/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/filoozom/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/filoozom/subscriptions",
      "organizations_url": "https://api.github.com/users/filoozom/orgs",
      "repos_url": "https://api.github.com/users/filoozom/repos",
      "events_url": "https://api.github.com/users/filoozom/events{/privacy}",
      "received_events_url": "https://api.github.com/users/filoozom/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-24T12:50:54Z",
    "updated_at": "2021-02-24T12:50:54Z",
    "author_association": "NONE",
    "body": "Is there a way to convert existing keys to the lighter version? If so, how? If not, what about older nodes?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/785053035/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/785058376",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22361#issuecomment-785058376",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361",
    "id": 785058376,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NTA1ODM3Ng==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-24T13:00:48Z",
    "updated_at": "2021-02-24T13:00:48Z",
    "author_association": "MEMBER",
    "body": "There's no super simple built-in way, but there is an API-method to import a keystore file, on the 'trusted' API. If you feed the keystores in via that, it would save it as lightkdf. SO basically you'd have to copy the keystore folder to a different name, and then reimport them.  ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/785058376/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/785094860",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22361#issuecomment-785094860",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361",
    "id": 785094860,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NTA5NDg2MA==",
    "user": {
      "login": "filoozom",
      "id": 6319092,
      "node_id": "MDQ6VXNlcjYzMTkwOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6319092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/filoozom",
      "html_url": "https://github.com/filoozom",
      "followers_url": "https://api.github.com/users/filoozom/followers",
      "following_url": "https://api.github.com/users/filoozom/following{/other_user}",
      "gists_url": "https://api.github.com/users/filoozom/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/filoozom/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/filoozom/subscriptions",
      "organizations_url": "https://api.github.com/users/filoozom/orgs",
      "repos_url": "https://api.github.com/users/filoozom/repos",
      "events_url": "https://api.github.com/users/filoozom/events{/privacy}",
      "received_events_url": "https://api.github.com/users/filoozom/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-24T13:59:34Z",
    "updated_at": "2021-02-24T15:07:51Z",
    "author_association": "NONE",
    "body": "That sounds cumbersome and hard to automate. Would probably be easier to use something like this (very simplistic example):\r\n\r\n```js\r\nconst { readFile, readdir, copyFile, writeFile } = require(\"fs/promises\");\r\nconst path = require(\"path\");\r\nconst Accounts = require(\"web3-eth-accounts\");\r\nconst accounts = new Accounts();\r\n\r\nconst file = process.argv[2];\r\nconst directory = path.join(process.cwd(), file);\r\nconst keystoreDirectory = path.join(directory, \"keystore\");\r\n\r\n// Script\r\n(async () => {\r\n  const files = await readdir(keystoreDirectory);\r\n\r\n  await files.map(async (file) => {\r\n    if (file.endsWith(\".bak\")) {\r\n      return;\r\n    }\r\n\r\n    const inputFile = path.join(keystoreDirectory, file);\r\n    const backupFile = inputFile + \".bak\";\r\n    const passwordFile = path.join(directory, \"password\");\r\n\r\n    // Back the file up\r\n    console.log(`Backing up ${file} to ${file}.bak`);\r\n    await copyFile(inputFile, backupFile);\r\n\r\n    // Read keystore and password\r\n    const input = JSON.parse(await readFile(inputFile));\r\n    const password = await readFile(passwordFile, \"utf8\");\r\n\r\n    // Decrypt and recrypt\r\n    console.log(`Converting ${file}`);\r\n    const { privateKey } = accounts.decrypt(input, password);\r\n    const keystore = accounts.encrypt(privateKey, password, { n: 4096 });\r\n\r\n    // Write the file\r\n    console.log(`Writing converted ${file}`);\r\n    await writeFile(inputFile, JSON.stringify(keystore));\r\n  });\r\n})();\r\n```\r\n\r\nAnd then run it with:\r\n```\r\n$ node convert.js path/to/clef/_data\r\n```\r\n\r\nAt this point I guess I can just copy the keystore file over and restart clef?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/785094860/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/785160899",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22361#issuecomment-785160899",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361",
    "id": 785160899,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NTE2MDg5OQ==",
    "user": {
      "login": "filoozom",
      "id": 6319092,
      "node_id": "MDQ6VXNlcjYzMTkwOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6319092?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/filoozom",
      "html_url": "https://github.com/filoozom",
      "followers_url": "https://api.github.com/users/filoozom/followers",
      "following_url": "https://api.github.com/users/filoozom/following{/other_user}",
      "gists_url": "https://api.github.com/users/filoozom/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/filoozom/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/filoozom/subscriptions",
      "organizations_url": "https://api.github.com/users/filoozom/orgs",
      "repos_url": "https://api.github.com/users/filoozom/repos",
      "events_url": "https://api.github.com/users/filoozom/events{/privacy}",
      "received_events_url": "https://api.github.com/users/filoozom/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-24T15:34:07Z",
    "updated_at": "2021-02-24T15:34:07Z",
    "author_association": "NONE",
    "body": "I upgraded all my keystores with this script, and can confirm it works. I have only converted files in `keystore/` and not `masterseed.json`.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/785160899/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/785757549",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22361#issuecomment-785757549",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361",
    "id": 785757549,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NTc1NzU0OQ==",
    "user": {
      "login": "ligi",
      "id": 111600,
      "node_id": "MDQ6VXNlcjExMTYwMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ligi",
      "html_url": "https://github.com/ligi",
      "followers_url": "https://api.github.com/users/ligi/followers",
      "following_url": "https://api.github.com/users/ligi/following{/other_user}",
      "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
      "organizations_url": "https://api.github.com/users/ligi/orgs",
      "repos_url": "https://api.github.com/users/ligi/repos",
      "events_url": "https://api.github.com/users/ligi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ligi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-25T09:36:20Z",
    "updated_at": "2021-02-25T09:36:20Z",
    "author_association": "MEMBER",
    "body": "Just to make sure you are aware of the security implications: lightkdf reduces security",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/785757549/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/849497837",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22361#issuecomment-849497837",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22361",
    "id": 849497837,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0OTQ5NzgzNw==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-27T09:50:32Z",
    "updated_at": "2021-05-27T09:50:32Z",
    "author_association": "MEMBER",
    "body": "Closing this, the mem consumption is a feature of the chosen encryption format",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/849497837/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
