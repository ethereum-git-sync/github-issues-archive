{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27092",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27092/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27092/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27092/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/27092",
  "id": 1665502808,
  "node_id": "I_kwDOAOvK985jRY5Y",
  "number": 27092,
  "title": "Nimbus + Geth missed the Shanghai fork",
  "user": {
    "login": "hydrodan",
    "id": 10092081,
    "node_id": "MDQ6VXNlcjEwMDkyMDgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/10092081?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hydrodan",
    "html_url": "https://github.com/hydrodan",
    "followers_url": "https://api.github.com/users/hydrodan/followers",
    "following_url": "https://api.github.com/users/hydrodan/following{/other_user}",
    "gists_url": "https://api.github.com/users/hydrodan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hydrodan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hydrodan/subscriptions",
    "organizations_url": "https://api.github.com/users/hydrodan/orgs",
    "repos_url": "https://api.github.com/users/hydrodan/repos",
    "events_url": "https://api.github.com/users/hydrodan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hydrodan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-04-13T01:14:09Z",
  "updated_at": "2023-04-13T16:14:39Z",
  "closed_at": "2023-04-13T16:14:38Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `1.11.5-stable`\r\nCL client & version: Nimbus: v23.3.2-6c0d75-stateofus\r\nOS & Version: Ubuntu 22.04.2 LTS / Linux 5.15.0-56-generic\r\nCommit hash : (if `develop`)\r\n\r\n#### Expected behaviour\r\nNo errors on fork\r\n\r\n#### Actual behaviour\r\nGeth errored out at the fork and stopped doing something important\r\n\r\n#### Steps to reproduce the behaviour\r\ngeth --http --datadir /some/path/goethereum --maxpeers 30 --ws --pprof --metrics --port 30305 --identity \"fubar\" --authrpc.addr localhost --authrpc.port 8551 --authrpc.vhosts localhost\r\n\r\nGeth + Nimus had been running correctly and was attesting in the epoch prior to the fork as expected, and then there was an issue that prevented attestations. Restarting Geth appears to have cleared the error, which is odd. I posted this in the Nimbus github issues, and one of the contributors replied that it was a Geth-side error.\r\n\r\n#### Backtrace\r\n\r\nGeth logs from the fork time:\r\n```\r\nApr 12 15:27:24 local geth[946]: INFO [04-12|15:27:24.134] Imported new potential chain segment     blocks=1    txs=93      mgas=8.450   elapsed=82.579ms     mgasps=102.328  number=17,034,869 hash=c2558f..d85d8f dirty=1022.43MiB\r\nApr 12 15:27:24 local geth[946]: INFO [04-12|15:27:24.914] Chain head was updated                   number=17,034,869 hash=c2558f..d85d8f root=8b8da1..fdd295 elapsed=3.405233ms\r\nApr 12 15:27:24 local geth[946]: INFO [04-12|15:27:24.918] Unindexed transactions                   blocks=1    txs=364     tail=14,684,870 elapsed=4.023ms\r\nApr 12 15:27:57 local geth[946]: WARN [04-12|15:27:57.158] Beacon client online, but no consensus updates received in a while. Please fix your beacon client to follow the chain!\r\nApr 12 15:28:03 local geth[946]: WARN [04-12|15:28:03.167] Served engine_newPayloadV2               reqid=52180                     duration=\"219.31µs\" err=\"the method engine_newPayloadV2 does not exist/is not available\"\r\nApr 12 15:28:03 local geth[946]: WARN [04-12|15:28:03.471] Forkchoice requested unknown head        hash=e22c56..f5216c\r\nApr 12 15:28:24 local geth[946]: WARN [04-12|15:28:24.014] Served engine_newPayloadV2               reqid=2                         duration=\"21.502µs\" err=\"the method engine_newPayloadV2 does not exist/is not available\"\r\nApr 12 15:28:24 local geth[946]: WARN [04-12|15:28:24.285] Forkchoice requested unknown head        hash=17cf53..9fea5b\r\nApr 12 15:28:50 local geth[946]: WARN [04-12|15:28:50.209] Served engine_newPayloadV2               reqid=1                         duration=\"16.476µs\" err=\"the method engine_newPayloadV2 does not exist/is not available\"\r\nApr 12 15:28:50 local geth[946]: WARN [04-12|15:28:50.492] Forkchoice requested unknown head        hash=6eade1..c44c30\r\nApr 12 15:29:13 local geth[946]: WARN [04-12|15:29:13.384] Served engine_newPayloadV2               reqid=1                         duration=\"18.781µs\" err=\"the method engine_newPayloadV2 does not exist/is not available\"\r\nApr 12 15:29:13 local geth[946]: WARN [04-12|15:29:13.671] Forkchoice requested unknown head        hash=1ff891..47b523\r\nApr 12 15:29:23 local geth[946]: WARN [04-12|15:29:23.637] Served engine_newPayloadV2               reqid=1                         duration=\"16.017µs\" err=\"the method engine_newPayloadV2 does not exist/is not available\"\r\n\r\n```\r\n\r\nNimbus logs from the same time:\r\n```\r\nApr 12 15:27:23 local bash[1620405]: INF 2023-04-12 15:27:23.000-07:00 Slot start                                 topics=\"beacnde\" slot=6209535 epoch=194047 sync=synced peers=160 head=fb538537:6209534 finalized=194045:1171bd9c delay=459us425ns\r\nApr 12 15:27:24 local bash[1620405]: INF 2023-04-12 15:27:24.883-07:00 State replayed                             topics=\"chaindag\" blocks=0 slots=1 current=17994865:6209504@6209536 ancestor=d82611c7:6209535 target=d82611c7:6209535@6209536 ancestorStateRoot=267c9d8d targetSt>\r\nApr 12 15:27:31 local bash[1620405]: INF 2023-04-12 15:27:31.063-07:00 Slot end                                   topics=\"beacnde\" slot=6209535 nextActionWait=4m3s936ms821us936ns nextAttestationSlot=6209556 nextProposalSlot=-1 syncCommitteeDuties=none head=d82611c7:6209535\r\nApr 12 15:27:34 local bash[1620405]: NOT 2023-04-12 15:27:34.730-07:00 Attestation failed to match head           topics=\"chaindag\" epoch=194046 validator=8c8bb599\r\nApr 12 15:27:35 local bash[1620405]: INF 2023-04-12 15:27:35.000-07:00 Slot start                                 topics=\"beacnde\" slot=6209536 epoch=194048 sync=synced peers=160 head=d82611c7:6209535 finalized=194045:1171bd9c delay=537us619ns\r\nApr 12 15:27:43 local bash[1620405]: INF 2023-04-12 15:27:43.912-07:00 State replayed                             topics=\"chaindag\" blocks=0 slots=32 current=d82611c7:6209535@6209536 ancestor=d82611c7:6209535@6209536 target=d82611c7:6209535@6209568 ancestorStateRoot=809b134f>\r\nApr 12 15:27:44 local bash[1620405]: INF 2023-04-12 15:27:44.199-07:00 Slot end                                   topics=\"beacnde\" slot=6209536 nextActionWait=3m50s800ms11us129ns nextAttestationSlot=6209556 nextProposalSlot=-1 syncCommitteeDuties=none head=d82611c7:6209535\r\nApr 12 15:27:47 local bash[1620405]: INF 2023-04-12 15:27:47.000-07:00 Slot start                                 topics=\"beacnde\" slot=6209537 epoch=194048 sync=synced peers=161 head=d82611c7:6209535 finalized=194045:1171bd9c delay=701us718ns\r\nApr 12 15:27:55 local bash[1620405]: INF 2023-04-12 15:27:55.047-07:00 Slot end                                   topics=\"beacnde\" slot=6209537 nextActionWait=3m39s952ms275us181ns nextAttestationSlot=6209556 nextProposalSlot=-1 syncCommitteeDuties=none head=d82611c7:6209535\r\nApr 12 15:27:59 local bash[1620405]: INF 2023-04-12 15:27:59.000-07:00 Slot start                                 topics=\"beacnde\" slot=6209538 epoch=194048 sync=synced peers=159 head=d82611c7:6209535 finalized=194045:1171bd9c delay=71us719ns\r\nApr 12 15:28:03 local bash[1620405]: NOT 2023-04-12 15:28:03.564-07:00\r\nApr 12 15:28:03 local bash[1620405]:     .     .                                          .\r\nApr 12 15:28:03 local bash[1620405]:     .                  _                                          .        :\r\nApr 12 15:28:03 local bash[1620405]:                         $..           .          %_...-                    :\r\nApr 12 15:28:03 local bash[1620405]:     .                  /{$$$b'                  ./$#% <                    |\r\nApr 12 15:28:03 local bash[1620405]:     :                    Q.  $b.              |/$$#% |                     |\r\nApr 12 15:28:03 local bash[1620405]:     :         .         `|%..  $b__....._____/$$#%  .'^  .                 |\r\nApr 12 15:28:03 local bash[1620405]:     :                    `.%x.    %%% %% .%%      ^              - --  - --+---\r\nApr 12 15:28:03 local bash[1620405]:     |                    .)%:% $b%%%%%%%%%%%%  .%   .                      |\r\nApr 12 15:28:03 local bash[1620405]:     |                    |%%%  ==$$%%%%%X__-=$'x%%%                        |\r\nApr 12 15:28:03 local bash[1620405]:     |                    d@%% .:::.`.  .'.:::. %%%  .      .     .         |\r\nApr 12 15:28:03 local bash[1620405]: ----+-- -  -            :$%%x ::.::.d    ::.:: %%x                         :\r\nApr 12 15:28:03 local bash[1620405]:     |     .             :$%%%  `::'d' .P `::' %%\"  . ---- -      .    .    :\r\nApr 12 15:28:03 local bash[1620405]:     |                   :$%%%x.  .C'  d' %%\";%.                  :         .\r\nApr 12 15:28:03 local bash[1620405]:     |                 .  !%%%% ^  | .P'  %Xx   . %               :\r\nApr 12 15:28:03 local bash[1620405]:     :                 :   Q%%%%%  `Q                             :\r\nApr 12 15:28:03 local bash[1620405]:     :   . .     .     : .\"$##%                      .            |  . .\r\nApr 12 15:28:03 local bash[1620405]:     .   | :           :d$##%% ^           .d$%%             .    |  | :\r\nApr 12 15:28:03 local bash[1620405]:        || ::          |##%x  ^   .        $$$%%%      .          | || ::\r\nApr 12 15:28:03 local bash[1620405]:     . ||| :::         d##%%%  ^           Q$$%%%%%      -  -- ---+||| :::\r\nApr 12 15:28:03 local bash[1620405]:      ||\\\\ //::       :$####%%  .           Q$$$#%%%              ||\\\\ //::    .\r\nApr 12 15:28:03 local bash[1620405]:     |\\\\\\\\ ////:  - --d$##%%% ^     .        Q$$$%%%     .       |\\\\\\\\ ////:\r\nApr 12 15:28:03 local bash[1620405]:     .. \\\\ // ..      $$#%%%^ ^               Q$$%%x         .   .. \\\\ // ..\r\nApr 12 15:28:03 local bash[1620405]:     `::.. ..:;'     .$$$##%%  ^  .            $$%%%%     :      `::.. ..:;'\r\nApr 12 15:28:03 local bash[1620405]:       `:: ::'      .$$BS22#%%% ^      .       ~Q$%%%%      .      `:: ::'\r\nApr 12 15:28:03 local bash[1620405]:  d   b $$$$$ $$$$$ $   5 $$$b  $$$$b d$$$b d   b $     d$$$$       d$$$b $b  $\r\nApr 12 15:28:03 local bash[1620405]:  $   $   $     $   $mmm$ $   $ $   $ $   $ $   $ $     Q.          $   $ $`$ $\r\nApr 12 15:28:03 local bash[1620405]:  $ $ $   $     $   $\"\" $ $   $ $\"\"$b $.  $ $ $ $ $     `\"\"$b       $. .$ $ `$$\r\nApr 12 15:28:03 local bash[1620405]:  `$$$' $$$$$   $   $   $ $$$P' $  `$ `$$$' `$$$' $$$$$ `$$$P       `$$$' $  :$\r\nApr 12 15:28:07 local bash[1620405]: INF 2023-04-12 15:28:07.063-07:00 Slot end                                   topics=\"beacnde\" slot=6209538 nextActionWait=3m27s936ms296us637ns nextAttestationSlot=6209556 nextProposalSlot=-1 syncCommitteeDuties=none head=0aeac0ff:6209538\r\nApr 12 15:28:11 local bash[1620405]: INF 2023-04-12 15:28:11.000-07:00 Slot start                                 topics=\"beacnde\" slot=6209539 epoch=194048 sync=synced/opt peers=152 head=0aeac0ff:6209538 finalized=194046:fdb109e5 delay=229us106ns\r\nApr 12 15:28:11 local bash[1620405]: INF 2023-04-12 15:28:11.021-07:00 Execution client not in sync; skipping validator duties for now topics=\"beacval\" slot=6209539 headSlot=6209538\r\nApr 12 15:28:11 local bash[1620405]: INF 2023-04-12 15:28:11.071-07:00 Slot end                                   topics=\"beacnde\" slot=6209539 nextActionWait=3m23s928ms735us396ns nextAttestationSlot=6209556 nextProposalSlot=-1 syncCommitteeDuties=none head=0aeac0ff:6209538\r\nApr 12 15:28:11 local bash[1620405]: WRN 2023-04-12 15:28:11.155-07:00 Connection to EL node degraded             topics=\"elmon\" url=ws://localhost:8551 failedRequest=newPayload statusCode=0 err=\"{\\\"code\\\":-32601,\\\"message\\\":\\\"the method engine_newPayloadV2 does not exist/is>\r\nApr 12 15:28:20 local bash[1620405]: INF 2023-04-12 15:28:20.300-07:00 Connection to EL node restored             topics=\"elmon\" url=ws://localhost:8551\r\nApr 12 15:28:23 local bash[1620405]: INF 2023-04-12 15:28:23.001-07:00 Slot start                                 topics=\"beacnde\" slot=6209540 epoch=194048 sync=synced/opt peers=156 head=0aeac0ff:6209538 finalized=194046:fdb109e5 delay=1ms86us64ns\r\nApr 12 15:28:23 local bash[1620405]: INF 2023-04-12 15:28:23.021-07:00 Execution client not in sync; skipping validator duties for now topics=\"beacval\" slot=6209540 headSlot=6209538\r\n```\r\n",
  "closed_by": {
    "login": "hydrodan",
    "id": 10092081,
    "node_id": "MDQ6VXNlcjEwMDkyMDgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/10092081?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hydrodan",
    "html_url": "https://github.com/hydrodan",
    "followers_url": "https://api.github.com/users/hydrodan/followers",
    "following_url": "https://api.github.com/users/hydrodan/following{/other_user}",
    "gists_url": "https://api.github.com/users/hydrodan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hydrodan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hydrodan/subscriptions",
    "organizations_url": "https://api.github.com/users/hydrodan/orgs",
    "repos_url": "https://api.github.com/users/hydrodan/repos",
    "events_url": "https://api.github.com/users/hydrodan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hydrodan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27092/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27092/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1506447634",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27092#issuecomment-1506447634",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27092",
    "id": 1506447634,
    "node_id": "IC_kwDOAOvK985ZypES",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-13T06:56:43Z",
    "updated_at": "2023-04-13T06:56:43Z",
    "author_association": "MEMBER",
    "body": " > Restarting Geth appears to have cleared the error\r\n\r\nMy hunch is you compiled the 1.10.5 but forgot to restart, so you were running the non-1.10.5 geth and `engine_newPayloadV2` is not available. When you restart, the correct version geth is used.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1506447634/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1507237977",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27092#issuecomment-1507237977",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27092",
    "id": 1507237977,
    "node_id": "IC_kwDOAOvK985Z1qBZ",
    "user": {
      "login": "hydrodan",
      "id": 10092081,
      "node_id": "MDQ6VXNlcjEwMDkyMDgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/10092081?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hydrodan",
      "html_url": "https://github.com/hydrodan",
      "followers_url": "https://api.github.com/users/hydrodan/followers",
      "following_url": "https://api.github.com/users/hydrodan/following{/other_user}",
      "gists_url": "https://api.github.com/users/hydrodan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hydrodan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hydrodan/subscriptions",
      "organizations_url": "https://api.github.com/users/hydrodan/orgs",
      "repos_url": "https://api.github.com/users/hydrodan/repos",
      "events_url": "https://api.github.com/users/hydrodan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hydrodan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-13T16:14:38Z",
    "updated_at": "2023-04-13T16:14:38Z",
    "author_association": "NONE",
    "body": "Thanks for the reply - you're correct, I had mistakenly assumed that updating the geth ubuntu package would restart geth automatically, but my logs show it wasn't restarted until I did it manually post-fork.\r\nFeel free delete since it's not a bug.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1507237977/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
