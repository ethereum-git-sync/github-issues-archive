{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18480",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18480/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18480/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18480/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/18480",
  "id": 400833322,
  "node_id": "MDU6SXNzdWU0MDA4MzMzMjI=",
  "number": 18480,
  "title": "accounts/abi.Unpack method no longer accepts empty interface as destination",
  "user": {
    "login": "i-norden",
    "id": 28617060,
    "node_id": "MDQ6VXNlcjI4NjE3MDYw",
    "avatar_url": "https://avatars.githubusercontent.com/u/28617060?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/i-norden",
    "html_url": "https://github.com/i-norden",
    "followers_url": "https://api.github.com/users/i-norden/followers",
    "following_url": "https://api.github.com/users/i-norden/following{/other_user}",
    "gists_url": "https://api.github.com/users/i-norden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/i-norden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/i-norden/subscriptions",
    "organizations_url": "https://api.github.com/users/i-norden/orgs",
    "repos_url": "https://api.github.com/users/i-norden/repos",
    "events_url": "https://api.github.com/users/i-norden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/i-norden/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "rjl493456442",
    "id": 5959481,
    "node_id": "MDQ6VXNlcjU5NTk0ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rjl493456442",
    "html_url": "https://github.com/rjl493456442",
    "followers_url": "https://api.github.com/users/rjl493456442/followers",
    "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
    "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
    "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
    "repos_url": "https://api.github.com/users/rjl493456442/repos",
    "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2019-01-18T18:10:32Z",
  "updated_at": "2019-01-23T13:36:50Z",
  "closed_at": "2019-01-23T13:36:50Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 1.21\r\nOS & Version: macOS Mojave v10.14.2\r\nCommit hash : 7ca40306af9da68a0d31439117246de8247f99d6\r\n\r\n#### Expected behaviour\r\nPrior to the 1.21 release, one could pass a pointer to an empty interface (v) to the abi.Unpack(v interface{}, data []byte) method in order to unpack values returned from contract method calls without needing to know the type of the returned values beforehand. This was a rather convenient \"feature\" as a developer that wants to work with contracts in a dynamic and generic manner. \r\n\r\n\r\n#### Actual behaviour\r\nPost 1.21 release (post commit 7ca40306af9da68a0d31439117246de8247f99d6 ) doing so now throws errors in the accounts/abi.Reflect package as it is attempting to [call](https://github.com/ethereum/go-ethereum/blob/master/accounts/abi/reflect.go#L75) reflect.Value.Type on a zero [Value](https://github.com/ethereum/go-ethereum/blob/master/accounts/abi/argument.go#L109)\r\n\r\n\r\n#### Steps to reproduce the behaviour\r\nThis error is thrown when attempting to unpack contract method results into an empty interface [here](https://github.com/vulcanize/vulcanizedb/blob/master/pkg/omni/shared/poller/poller.go#L148) using the FetchContractData method defined [here](https://github.com/vulcanize/vulcanizedb/blob/master/pkg/geth/contract.go#L32) which calls the abi.Unpack [method](https://github.com/ethereum/go-ethereum/blob/master/accounts/abi/abi.go#L75).\r\n\r\n[Master branch](https://github.com/vulcanize/vulcanizedb) of vulcanizeDB is working using geth 1.18, the [updated branch](https://github.com/vulcanize/vulcanizedb/tree/updates) using geth 1.21 fails to pass [tests](https://travis-ci.org/vulcanize/vulcanizedb/builds/481464708?utm_source=github_status&utm_medium=notification) with the below errors.\r\n\r\nIt should be noted that some of the line numbers in the below stack trace are offset due to vulcanizeDB currently using a modified version of the Geth abi package that includes the updates [here](https://github.com/ethereum/go-ethereum/pull/18440), but these additional methods are not involved in this error.\r\n\r\n#### Backtrace\r\n\r\n````\r\n/usr/local/go/src/runtime/panic.go:513 +0x1b9\r\n      reflect.Value.Type(0x0, 0x0, 0x0, 0xc0003ee120, 0x0)\r\n      \t/usr/local/go/src/reflect/value.go:1743 +0x16c\r\n      github.com/vulcanize/vulcanizedb/vendor/github.com/ethereum/go-ethereum/accounts/abi.set(0x0, 0x0, 0x0, 0x457aba0, 0xc0004688c0, 0x91, 0x0, 0x0)\r\n      \t/Users/iannorden/go/src/github.com/vulcanize/vulcanizedb/vendor/github.com/ethereum/go-ethereum/accounts/abi/reflect.go:75 +0x5a\r\n      github.com/vulcanize/vulcanizedb/vendor/github.com/ethereum/go-ethereum/accounts/abi.set(0x45139a0, 0xc0004104b0, 0x194, 0x457aba0, 0xc0004688c0, 0x91, 0x403e273, 0x45139a0)\r\n      \t/Users/iannorden/go/src/github.com/vulcanize/vulcanizedb/vendor/github.com/ethereum/go-ethereum/accounts/abi/reflect.go:78 +0x4ef\r\n      github.com/vulcanize/vulcanizedb/vendor/github.com/ethereum/go-ethereum/accounts/abi.unpack(0xc0002f07e0, 0x44d92e0, 0xc0004104b0, 0x457aba0, 0xc0004688c0, 0x16, 0x457aba0)\r\n      \t/Users/iannorden/go/src/github.com/vulcanize/vulcanizedb/vendor/github.com/ethereum/go-ethereum/accounts/abi/argument.go:124 +0xc72\r\n      github.com/vulcanize/vulcanizedb/vendor/github.com/ethereum/go-ethereum/accounts/abi.Arguments.unpackAtomic(0xc0002c4900, 0x1, 0x4, 0x44d92e0, 0xc0004104b0, 0x457aba0, 0xc0004688c0, 0x1, 0x1)\r\n      \t/Users/iannorden/go/src/github.com/vulcanize/vulcanizedb/vendor/github.com/ethereum/go-ethereum/accounts/abi/argument.go:205 +0x44b\r\n      github.com/vulcanize/vulcanizedb/vendor/github.com/ethereum/go-ethereum/accounts/abi.Arguments.Unpack(0xc0002c4900, 0x1, 0x4, 0x44d92e0, 0xc0004104b0, 0xc0004688a0, 0x20, 0x20, 0xc000402500, 0x24)\r\n      \t/Users/iannorden/go/src/github.com/vulcanize/vulcanizedb/vendor/github.com/ethereum/go-ethereum/accounts/abi/argument.go:102 +0x187\r\n      github.com/vulcanize/vulcanizedb/vendor/github.com/ethereum/go-ethereum/accounts/abi.ABI.Unpack(0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0xc0002e4c60, ...)\r\n      \t/Users/iannorden/go/src/github.com/vulcanize/vulcanizedb/vendor/github.com/ethereum/go-ethereum/accounts/abi/abi.go:85 +0x2fa\r\n      github.com/vulcanize/vulcanizedb/pkg/geth.(*BlockChain).FetchContractData(0xc000178230, 0x45e4afa, 0x735, 0x45d89be, 0x2a, 0xc000424648, 0x8, 0xc000410460, 0x1, 0x1, ...)\r\n      \t/Users/iannorden/go/src/github.com/vulcanize/vulcanizedb/pkg/geth/contract.go:50 +0x2da\r\n      github.com/vulcanize/vulcanizedb/pkg/omni/shared/poller.(*poller).pollSingleArgAt(0xc0000e6ea0, 0xc000424648, 0x8, 0x1, 0xc000277540, 0x1, 0x1, 0xc0002775e0, 0x1, 0x1, ...)\r\n      \t/Users/iannorden/go/src/github.com/vulcanize/vulcanizedb/pkg/omni/shared/poller/poller.go:148 +0x424\r\n      github.com/vulcanize/vulcanizedb/pkg/omni/shared/poller.(*poller).PollContractAt(0xc0000e6ea0, 0x45c5e8b, 0xc, 0x45d89be, 0x2a, 0x0, 0x0, 0x699eef, 0x699ef0, 0x45e4afa, ...)\r\n      \t/Users/iannorden/go/src/github.com/vulcanize/vulcanizedb/pkg/omni/shared/poller/poller.go:72 +0x2dd\r\n      github.com/vulcanize/vulcanizedb/pkg/omni/shared/poller.(*poller).PollContract(0xc0000e6ea0, 0x45c5e8b, 0xc, 0x45d89be, 0x2a, 0x0, 0x0, 0x699eef, 0x699ef0, 0x45e4afa, ...)\r\n      \t/Users/iannorden/go/src/github.com/vulcanize/vulcanizedb/pkg/omni/shared/poller/poller.go:57 +0x8a\r\n      github.com/vulcanize/vulcanizedb/pkg/omni/shared/poller_test.glob..func2.3.2.4()\r\n      \t/Users/iannorden/go/src/github.com/vulcanize/vulcanizedb/pkg/omni/shared/poller/poller_test.go:221 +0x385\r\n      github.com/vulcanize/vulcanizedb/vendor/github.com/onsi/ginkgo/internal/leafnodes.(*runner).runSync(0xc0000a7ec0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, ...)\r\n      \t/Users/iannorden/go/src/github.com/vulcanize/vulcanizedb/pkg/omni/shared/poller/poller_suite_test.go:30 +0x63\r\n      testing.tRunner(0xc0000ee400, 0x45ee758)\r\n      \t/usr/local/go/src/testing/testing.go:827 +0xbf\r\n      created by testing.(*T).Run\r\n      \t/usr/local/go/src/testing/testing.go:878 +0x35c\r\n````\r\n\r\n#### Questions\r\nWas this an intended effect of these changes to the abi package or is this an unwanted side effect?  \r\nIn lieu of these changes is there or should there be a way to unpack method results into an empty interface?\r\n\r\nThanks!",
  "closed_by": {
    "login": "gballet",
    "id": 3272758,
    "node_id": "MDQ6VXNlcjMyNzI3NTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3272758?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gballet",
    "html_url": "https://github.com/gballet",
    "followers_url": "https://api.github.com/users/gballet/followers",
    "following_url": "https://api.github.com/users/gballet/following{/other_user}",
    "gists_url": "https://api.github.com/users/gballet/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gballet/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gballet/subscriptions",
    "organizations_url": "https://api.github.com/users/gballet/orgs",
    "repos_url": "https://api.github.com/users/gballet/repos",
    "events_url": "https://api.github.com/users/gballet/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gballet/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18480/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18480/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/456268416",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18480#issuecomment-456268416",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18480",
    "id": 456268416,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NjI2ODQxNg==",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-22T04:35:37Z",
    "updated_at": "2019-01-22T04:35:37Z",
    "author_association": "MEMBER",
    "body": "Hi, the original version(before commit `7ca4030`) should allow interface as the unpack destination for **single return value** while not for **tuple return value**.  I guess in your case the contract return should be single value.\r\n\r\nI have a PR #18490 to allow interface as the destination for single value, could you please have a try ?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/456268416/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/456470608",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18480#issuecomment-456470608",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18480",
    "id": 456470608,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NjQ3MDYwOA==",
    "user": {
      "login": "i-norden",
      "id": 28617060,
      "node_id": "MDQ6VXNlcjI4NjE3MDYw",
      "avatar_url": "https://avatars.githubusercontent.com/u/28617060?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/i-norden",
      "html_url": "https://github.com/i-norden",
      "followers_url": "https://api.github.com/users/i-norden/followers",
      "following_url": "https://api.github.com/users/i-norden/following{/other_user}",
      "gists_url": "https://api.github.com/users/i-norden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/i-norden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/i-norden/subscriptions",
      "organizations_url": "https://api.github.com/users/i-norden/orgs",
      "repos_url": "https://api.github.com/users/i-norden/repos",
      "events_url": "https://api.github.com/users/i-norden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/i-norden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-22T16:42:55Z",
    "updated_at": "2019-01-23T06:02:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "I gave the changes in PR [#18490](https://github.com/ethereum/go-ethereum/pull/18490) a [try](https://travis-ci.org/vulcanize/vulcanizedb/builds/483031996?utm_source=github_status&utm_medium=notification) and it has resolved the issue! Thank you! ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/456470608/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
