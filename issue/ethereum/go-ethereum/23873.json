{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23873",
  "id": 1047770686,
  "node_id": "I_kwDOAOvK984-c7Y-",
  "number": 23873,
  "title": "Generating snapshots makes geth slow",
  "user": {
    "login": "elsampsa",
    "id": 13978980,
    "node_id": "MDQ6VXNlcjEzOTc4OTgw",
    "avatar_url": "https://avatars.githubusercontent.com/u/13978980?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/elsampsa",
    "html_url": "https://github.com/elsampsa",
    "followers_url": "https://api.github.com/users/elsampsa/followers",
    "following_url": "https://api.github.com/users/elsampsa/following{/other_user}",
    "gists_url": "https://api.github.com/users/elsampsa/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/elsampsa/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/elsampsa/subscriptions",
    "organizations_url": "https://api.github.com/users/elsampsa/orgs",
    "repos_url": "https://api.github.com/users/elsampsa/repos",
    "events_url": "https://api.github.com/users/elsampsa/events{/privacy}",
    "received_events_url": "https://api.github.com/users/elsampsa/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 17,
  "created_at": "2021-11-08T18:25:20Z",
  "updated_at": "2022-01-05T20:39:46Z",
  "closed_at": "2021-11-10T08:06:23Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I'm experiencing a slow-down due to snapshot generation.  Snapshot generation takes ages (the estimated time just keeps growing) and the blockchain sync slows down as well.\r\n\r\n#### System information\r\n\r\nGeth version: `Geth/v1.10.10-stable-bb74230f/linux-amd64/go1.15.6`\r\nOS & Version: Linux\r\nCommit hash : (not `develop`)\r\n\r\n#### Expected behaviour\r\n\r\n- Sync *not* starting to lag behind\r\n- Snapshot generated in a matter of few days\r\n\r\n#### Actual behaviour\r\n\r\n- When snapshot gen is enabled, the synchronization starts to creep and lag behind.  \r\n- Estimated time for snaphot completion keeps on creeping up\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nRun geth in a laptop with:\r\n\r\n- 8 x Intel(R) Core(TM) i7-4700HQ CPU @ 2.40GHz\r\n- 2TB SSD drive: \"Crucial BX500\"\r\n- 12 GB RAM (& all the swap you could wish for)\r\n```\r\nnice -n 5 go-ethereum/build/bin/geth --datadir.ancient=/mnt/hdd/ancient --syncmode=full --gcmode=full --cache=2048 --maxpeers=50 --snapshot=true --txlookuplimit=0\r\n```\r\n\r\n#### Backtrace\r\n````\r\nINFO [11-08|20:21:25.087] Resuming state snapshot generation       root=85b967..037d98 at=004c78..040c78 accounts=177,869 slots=974,903 storage=77.78MiB elapsed=38m11.550s eta=544h52m33.234s\r\nINFO [11-08|20:21:25.090] Imported new chain segment               blocks=1 txs=375  mgas=30.028 elapsed=28.038s    mgasps=1.071   number=13,577,264 hash=2bdcca..8de18c age=11m29s   dirty=226.78MiB\r\n````\r\nETA for snapshots keeps on growing, so does the \"age\" for the chain segments.\r\n",
  "closed_by": {
    "login": "elsampsa",
    "id": 13978980,
    "node_id": "MDQ6VXNlcjEzOTc4OTgw",
    "avatar_url": "https://avatars.githubusercontent.com/u/13978980?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/elsampsa",
    "html_url": "https://github.com/elsampsa",
    "followers_url": "https://api.github.com/users/elsampsa/followers",
    "following_url": "https://api.github.com/users/elsampsa/following{/other_user}",
    "gists_url": "https://api.github.com/users/elsampsa/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/elsampsa/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/elsampsa/subscriptions",
    "organizations_url": "https://api.github.com/users/elsampsa/orgs",
    "repos_url": "https://api.github.com/users/elsampsa/repos",
    "events_url": "https://api.github.com/users/elsampsa/events{/privacy}",
    "received_events_url": "https://api.github.com/users/elsampsa/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/963457772",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23873#issuecomment-963457772",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
    "id": 963457772,
    "node_id": "IC_kwDOAOvK9845bTLs",
    "user": {
      "login": "elsampsa",
      "id": 13978980,
      "node_id": "MDQ6VXNlcjEzOTc4OTgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/13978980?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/elsampsa",
      "html_url": "https://github.com/elsampsa",
      "followers_url": "https://api.github.com/users/elsampsa/followers",
      "following_url": "https://api.github.com/users/elsampsa/following{/other_user}",
      "gists_url": "https://api.github.com/users/elsampsa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/elsampsa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/elsampsa/subscriptions",
      "organizations_url": "https://api.github.com/users/elsampsa/orgs",
      "repos_url": "https://api.github.com/users/elsampsa/repos",
      "events_url": "https://api.github.com/users/elsampsa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/elsampsa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-08T18:37:38Z",
    "updated_at": "2021-11-08T20:45:13Z",
    "author_association": "NONE",
    "body": "found a related issue: https://github.com/ethereum/go-ethereum/issues/23114\r\n\r\n..compared to that (& if I got it right), in my case the blocks complete faster.\r\n\r\nI set cache to 4096 & now the log look slightly different.. no crazy estimated times anymore, but block sync still lags behind.\r\n```\r\n...\r\nINFO [11-08|21:10:09.900] Aborting state snapshot generation       root=636f6c..0c4588 at=004c78..040c78 accounts=177,869 slots=987,154 storage=78.61MiB elapsed=17m19.062s\r\nINFO [11-08|21:10:09.900] Resuming state snapshot generation       root=77d32e..ad8b9f at=004c78..040c78 accounts=177,869 slots=987,154 storage=78.61MiB elapsed=17m19.063s\r\nINFO [11-08|21:10:09.903] Imported new chain segment               blocks=1 txs=102 mgas=7.904  elapsed=13.063s    mgasps=0.605 number=13,577,449 hash=07903f..a5952f age=19m52s   dirty=132.63MiB\r\nINFO [11-08|21:10:23.116] Aborting state snapshot generation       root=77d32e..ad8b9f at=004c78..040c78 accounts=177,869 slots=987,154 storage=78.61MiB elapsed=17m32.279s\r\nINFO [11-08|21:10:23.117] Resuming state snapshot generation       root=307b7a..e6c5ed at=004c78..040c78 accounts=177,869 slots=987,154 storage=78.61MiB elapsed=17m32.279s\r\nINFO [11-08|21:10:23.119] Imported new chain segment               blocks=1 txs=89  mgas=9.522  elapsed=13.216s    mgasps=0.720 number=13,577,450 hash=e9db7a..6e5fc4 age=20m1s    dirty=133.68MiB\r\nINFO [11-08|21:10:36.312] Aborting state snapshot generation       root=307b7a..e6c5ed at=004c78..040c78 accounts=177,869 slots=987,154 storage=78.61MiB elapsed=17m45.475s\r\nINFO [11-08|21:10:36.313] Resuming state snapshot generation       root=9262ac..f1e5ef at=004c78..040c78 accounts=177,869 slots=987,154 storage=78.61MiB elapsed=17m45.475s\r\nINFO [11-08|21:10:36.315] Imported new chain segment               blocks=1 txs=271 mgas=20.193 elapsed=13.196s    mgasps=1.530 number=13,577,451 hash=0f544d..78b9b4 age=20m8s    dirty=136.15MiB\r\nINFO [11-08|21:10:46.009] Deep froze chain segment                 blocks=4 elapsed=18.185ms   number=13,487,451 hash=e7d321..322636\r\nINFO [11-08|21:10:49.548] Aborting state snapshot generation       root=9262ac..f1e5ef at=004c78..040c78 accounts=177,869 slots=987,154 storage=78.61MiB elapsed=17m58.710s\r\nINFO [11-08|21:10:49.548] Resuming state snapshot generation       root=459a7b..dba245 at=004c78..040c78 accounts=177,869 slots=987,154 storage=78.61MiB elapsed=17m58.711s\r\nINFO [11-08|21:10:49.550] Imported new chain segment               blocks=1 txs=149 mgas=10.399 elapsed=13.234s    mgasps=0.786 number=13,577,452 hash=e5bc8e..ca52bb age=20m9s    dirty=137.43MiB\r\nERROR[11-08|21:10:55.620] Snapshot extension registration failed   peer=1d11e356 err=\"peer connected on snap without compatible eth support\"\r\nINFO [11-08|21:11:02.484] Aborting state snapshot generation       root=459a7b..dba245 at=004c78..040c78 accounts=177,869 slots=987,154 storage=78.61MiB elapsed=18m11.646s\r\nINFO [11-08|21:11:02.484] Resuming state snapshot generation       root=f6b577..b0533f at=004c78..040c78 accounts=177,869 slots=987,154 storage=78.61MiB elapsed=18m11.647s\r\nINFO [11-08|21:11:02.487] Imported new chain segment               blocks=1 txs=96  mgas=5.837  elapsed=12.936s    mgasps=0.451 number=13,577,453 hash=7d4bae..16a8f0 age=20m4s    dirty=138.30MiB\r\nINFO [11-08|21:11:15.597] Aborting state snapshot generation       root=f6b577..b0533f at=004c78..040c78 accounts=177,869 slots=987,154 storage=78.61MiB elapsed=18m24.760s\r\nINFO [11-08|21:11:15.598] Resuming state snapshot generation       root=54890b..926f33 at=004c78..040c78 accounts=177,869 slots=987,154 storage=78.61MiB elapsed=18m24.760s\r\nINFO [11-08|21:11:15.600] Imported new chain segment               blocks=1 txs=396 mgas=29.742 elapsed=13.113s    mgasps=2.268 number=13,577,454 hash=56d5a2..1f9873 age=20m12s   dirty=141.64MiB\r\nINFO [11-08|21:11:28.861] Aborting state snapshot generation       root=54890b..926f33 at=004c78..040c78 accounts=177,869 slots=987,154 storage=78.61MiB elapsed=18m38.023s\r\nINFO [11-08|21:11:28.861] Resuming state snapshot generation       root=851418..8d0544 at=004c78..040c78 accounts=177,869 slots=987,154 storage=78.61MiB elapsed=18m38.023s\r\nINFO [11-08|21:11:28.866] Imported new chain segment               blocks=1 txs=495 mgas=30.005 elapsed=13.265s    mgasps=2.262 number=13,577,455 hash=580940..cd1c17 age=20m7s    dirty=144.90MiB\r\n...\r\n```\r\n**EDIT** I take that back, same error still:\r\n```\r\nINFO [11-08|22:43:58.177] Aborting state snapshot generation       root=197318..64ce2b at=004cdc..828cd9 accounts=178,779 slots=994,256 storage=79.13MiB elapsed=1h51m7.340s  eta=311773h42m50.901s                                          \r\nINFO [11-08|22:43:58.177] Resuming state snapshot generation       root=719dd2..aefe56 at=004cdc..828cd9 accounts=178,779 slots=994,256 storage=79.13MiB elapsed=1h51m7.340s  eta=311773h42m50.901s                                          \r\nINFO [11-08|22:43:58.183] Imported new chain segment               blocks=1 txs=201 mgas=13.956 elapsed=17.332s      mgasps=0.805 number=13,577,814 hash=ccc70e..fba304 age=27m44s   dirty=403.20MiB\r\n```\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/963457772/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/963843944",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23873#issuecomment-963843944",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
    "id": 963843944,
    "node_id": "IC_kwDOAOvK9845cxdo",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-09T06:04:58Z",
    "updated_at": "2021-11-09T06:06:40Z",
    "author_association": "MEMBER",
    "body": "@elsampsa Looks like you are running an archive node. Since you are upgrading from a legacy database(by enable the snapshot), so it's extremely slow for regeneration.\r\n\r\nIn order to speedup the snapshot generation, one trick you can apply is:\r\n- sync a new geth node  in `syncmode=snap` mode.\r\n- export the snapshot data from that **synced node** by command `geth db export --datadir <path_to_your_fresh_synced_node> snapshot  snapshot.data.gz`\r\n- import the exported snapshot data into your archive node by command `geth db import --datadir <path_to_your_archive_node> snapshot.data.gz`\r\n\r\nAfter that your snapshot will be rebuilt. However with the help of existent snapshot data it can save you a lot of time for regeneration.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/963843944/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/963872136",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23873#issuecomment-963872136",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
    "id": 963872136,
    "node_id": "IC_kwDOAOvK9845c4WI",
    "user": {
      "login": "elsampsa",
      "id": 13978980,
      "node_id": "MDQ6VXNlcjEzOTc4OTgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/13978980?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/elsampsa",
      "html_url": "https://github.com/elsampsa",
      "followers_url": "https://api.github.com/users/elsampsa/followers",
      "following_url": "https://api.github.com/users/elsampsa/following{/other_user}",
      "gists_url": "https://api.github.com/users/elsampsa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/elsampsa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/elsampsa/subscriptions",
      "organizations_url": "https://api.github.com/users/elsampsa/orgs",
      "repos_url": "https://api.github.com/users/elsampsa/repos",
      "events_url": "https://api.github.com/users/elsampsa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/elsampsa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-09T07:08:51Z",
    "updated_at": "2021-11-09T07:08:51Z",
    "author_association": "NONE",
    "body": "My geth cli arguments are:\r\n```\r\n--syncmode=full --gcmode=full\r\n```\r\nAccording to geth:\r\n```\r\n--gcmode value       Blockchain garbage collection mode (\"full\", \"archive\") (default: \"full\")\r\n```\r\nSo I'd need to use \"archive\" to have an archive node..?  I think my node is just a regular \"full\"  node, not an archive node..?\r\n\r\nBut anyway, thanks for the tip.  I will try it for sure.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/963872136/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/963880815",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23873#issuecomment-963880815",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
    "id": 963880815,
    "node_id": "IC_kwDOAOvK9845c6dv",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-09T07:24:53Z",
    "updated_at": "2021-11-09T07:24:53Z",
    "author_association": "MEMBER",
    "body": "Ah right. It's a normal full node. My bad.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/963880815/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/963891853",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23873#issuecomment-963891853",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
    "id": 963891853,
    "node_id": "IC_kwDOAOvK9845c9KN",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-09T07:45:58Z",
    "updated_at": "2021-11-09T07:45:58Z",
    "author_association": "MEMBER",
    "body": "```\r\nINFO [11-08|21:10:09.903] Imported new chain segment               blocks=1 txs=102 mgas=7.904  elapsed=13.063s    mgasps=0.605 number=13,577,449 hash=07903f..a5952f age=19m52s   dirty=132.63MiB\r\nINFO [11-08|21:10:23.119] Imported new chain segment               blocks=1 txs=89  mgas=9.522  elapsed=13.216s    mgasps=0.720 number=13,577,450 hash=e9db7a..6e5fc4 age=20m1s    dirty=133.68MiB\r\nINFO [11-08|21:10:36.315] Imported new chain segment               blocks=1 txs=271 mgas=20.193 elapsed=13.196s    mgasps=1.530 number=13,577,451 hash=0f544d..78b9b4 age=20m8s    dirty=136.15MiB\r\nINFO [11-08|21:10:49.550] Imported new chain segment               blocks=1 txs=149 mgas=10.399 elapsed=13.234s    mgasps=0.786 number=13,577,452 hash=e5bc8e..ca52bb age=20m9s    dirty=137.43MiB\r\nINFO [11-08|21:11:02.487] Imported new chain segment               blocks=1 txs=96  mgas=5.837  elapsed=12.936s    mgasps=0.451 number=13,577,453 hash=7d4bae..16a8f0 age=20m4s    dirty=138.30MiB\r\nINFO [11-08|21:11:15.600] Imported new chain segment               blocks=1 txs=396 mgas=29.742 elapsed=13.113s    mgasps=2.268 number=13,577,454 hash=56d5a2..1f9873 age=20m12s   dirty=141.64MiB\r\nINFO [11-08|21:11:28.866] Imported new chain segment               blocks=1 txs=495 mgas=30.005 elapsed=13.265s    mgasps=2.262 number=13,577,455 hash=580940..cd1c17 age=20m7s    dirty=144.90MiB\r\n```\r\nThis is interesting -- block import times are 12-13 seconds per block. There is a thrashing-component when doing snapshot generation simultaneously as importing blocks, which I tried to address in https://github.com/ethereum/go-ethereum/pull/23728 . However, that PR is incomplete and would not help you. \r\n\r\nSo blocks are being imported really slowly. A few things would be interesting to know: \r\n- What is the size of your leveldb data? \r\n- Do you know anything about the effective disk IO speeds? Done any speed-checks? \r\n\r\nAlso, @rjl493456442 's trick is good. Another thing you might try is to run it in `--nodiscover --maxpeers 0`, making it do _only_ snapshot generation, and not simultaneously import any blocks.\r\n\r\nA third thing we could  test is to hook it up to our graphing endpoint, and see there if we can detect what the anomaly comes from.  ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/963891853/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/963930001",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23873#issuecomment-963930001",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
    "id": 963930001,
    "node_id": "IC_kwDOAOvK9845dGeR",
    "user": {
      "login": "elsampsa",
      "id": 13978980,
      "node_id": "MDQ6VXNlcjEzOTc4OTgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/13978980?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/elsampsa",
      "html_url": "https://github.com/elsampsa",
      "followers_url": "https://api.github.com/users/elsampsa/followers",
      "following_url": "https://api.github.com/users/elsampsa/following{/other_user}",
      "gists_url": "https://api.github.com/users/elsampsa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/elsampsa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/elsampsa/subscriptions",
      "organizations_url": "https://api.github.com/users/elsampsa/orgs",
      "repos_url": "https://api.github.com/users/elsampsa/repos",
      "events_url": "https://api.github.com/users/elsampsa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/elsampsa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-09T08:42:39Z",
    "updated_at": "2021-11-09T08:51:04Z",
    "author_association": "NONE",
    "body": "Chaindata in ``dev/sdb``, ancient data in ``dev/sda``\r\n\r\nRead speed test:\r\n```\r\nsampsa@sampsa-asus:~$ sudo hdparm -Tf /dev/sdb\r\n/dev/sdb:\r\n Timing cached reads:   21648 MB in  1.99 seconds = 10880.31 MB/sec\r\n\r\nsampsa@sampsa-asus:~$ sudo hdparm -Tf /dev/sda\r\n/dev/sda:\r\n Timing cached reads:   20190 MB in  1.99 seconds = 10140.64 MB/sec\r\n```\r\nWrite speed test I'd rather not do.. \r\n\r\nDisk usage:\r\n```\r\nsampsa@sampsa-asus:~$ du -S -h .ethereum/geth/chaindata\r\n1,4T    .ethereum/geth/chaindata\r\nsampsa@sampsa-asus:~$ du -S -h /mnt/hdd/ancient\r\n263G    /mnt/hdd/ancient\r\n```\r\nIt's a \"full\" node that's been running for few years.. never did re-fast-sync or anything like that.  Maybe that's the problem?\r\n\r\nIt's now doing that offline snapshot generation as you suggested.  Will let you know then.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/963930001/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964000536",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23873#issuecomment-964000536",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
    "id": 964000536,
    "node_id": "IC_kwDOAOvK9845dXsY",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-09T10:09:28Z",
    "updated_at": "2021-11-09T10:09:28Z",
    "author_association": "MEMBER",
    "body": "> never did re-fast-sync or anything like that. Maybe that's the problem?\r\n\r\nYes, the size has grown to `1,4T `. With a database that large, leveldb is doing a _lot_ of work to keep up. A re-sync would likely solve the problems. You would lose a lot of state, naturally, but it seems that even with the current ssd speeds ( which seem pretty good), the disk IO isn't sufficient. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964000536/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964086626",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23873#issuecomment-964086626",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
    "id": 964086626,
    "node_id": "IC_kwDOAOvK9845dsti",
    "user": {
      "login": "elsampsa",
      "id": 13978980,
      "node_id": "MDQ6VXNlcjEzOTc4OTgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/13978980?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/elsampsa",
      "html_url": "https://github.com/elsampsa",
      "followers_url": "https://api.github.com/users/elsampsa/followers",
      "following_url": "https://api.github.com/users/elsampsa/following{/other_user}",
      "gists_url": "https://api.github.com/users/elsampsa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/elsampsa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/elsampsa/subscriptions",
      "organizations_url": "https://api.github.com/users/elsampsa/orgs",
      "repos_url": "https://api.github.com/users/elsampsa/repos",
      "events_url": "https://api.github.com/users/elsampsa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/elsampsa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-09T12:00:19Z",
    "updated_at": "2021-11-09T12:00:19Z",
    "author_association": "NONE",
    "body": "I wish I could connect with my own node to my own node for a fast re-sync (a slight pun intended).  If I do that snapshot import trick as discussed above, that will solve all my performance issues I guess..?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964086626/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964110849",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23873#issuecomment-964110849",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
    "id": 964110849,
    "node_id": "IC_kwDOAOvK9845dyoB",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-09T12:34:05Z",
    "updated_at": "2021-11-09T12:34:05Z",
    "author_association": "MEMBER",
    "body": "> If I do that snapshot import trick as discussed above, that will solve all my performance issues I guess..?\r\n\r\nUnfortunately not. \r\nIt will make read-access faster, so the reads when executing blocks will increase. However, at the end of the block, the state trie root needs to be calculated/verified, and for this, the snapshot data is not sufficient - for this, trie data is needed. So that bloated 1.4T database will still cause problems. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964110849/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964280977",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23873#issuecomment-964280977",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
    "id": 964280977,
    "node_id": "IC_kwDOAOvK9845ecKR",
    "user": {
      "login": "elsampsa",
      "id": 13978980,
      "node_id": "MDQ6VXNlcjEzOTc4OTgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/13978980?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/elsampsa",
      "html_url": "https://github.com/elsampsa",
      "followers_url": "https://api.github.com/users/elsampsa/followers",
      "following_url": "https://api.github.com/users/elsampsa/following{/other_user}",
      "gists_url": "https://api.github.com/users/elsampsa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/elsampsa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/elsampsa/subscriptions",
      "organizations_url": "https://api.github.com/users/elsampsa/orgs",
      "repos_url": "https://api.github.com/users/elsampsa/repos",
      "events_url": "https://api.github.com/users/elsampsa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/elsampsa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-09T15:51:27Z",
    "updated_at": "2021-11-09T15:51:27Z",
    "author_association": "NONE",
    "body": "So, the only way to keep the db \"non-bloated\" & fast, is to perform periodically a  \"fast sync\".  hmm.. if everyone does that, then it  means that eventually the global network will only consist of fast-synced nodes.  I guess that't not a problem..?  I guess somebody has the complete state trie somewhere.. eeh.. what do I know.  I'm just an old guy with an old laptop.  :-)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964280977/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964296461",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23873#issuecomment-964296461",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
    "id": 964296461,
    "node_id": "IC_kwDOAOvK9845ef8N",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-09T16:07:27Z",
    "updated_at": "2021-11-09T16:07:27Z",
    "author_association": "MEMBER",
    "body": ">  I guess somebody has the complete state trie somewhere.. \r\n\r\nJust to clarify -- it doesn't matter if anybody does. If I want to know what the state was at block 5M, then I can always re-execute from genesis to obtain it.  Might take me a few days (or a week for later >12M blocks), but it's not 'gone'. State is derived from block progression",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964296461/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964764208",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23873#issuecomment-964764208",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
    "id": 964764208,
    "node_id": "IC_kwDOAOvK9845gSIw",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-10T04:00:01Z",
    "updated_at": "2021-11-10T04:00:24Z",
    "author_association": "MEMBER",
    "body": "@elsampsa Yes it's not good for accumulating \"junk\" states all the time. However I am working a new state scheme recently, with the new scheme all the stale states will be pruned by default. It means you can enjoy a full node with low state growth rate. Unfortunately this big change still needs time to be finished/reviewed/tested. Hopefully we can ship it as soon as possible.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964764208/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964765162",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23873#issuecomment-964765162",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
    "id": 964765162,
    "node_id": "IC_kwDOAOvK9845gSXq",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-10T04:02:33Z",
    "updated_at": "2021-11-10T04:02:52Z",
    "author_association": "MEMBER",
    "body": "@elsampsa In case you want to play my trick, don't forget to sync your new node with this mode \"syncmode=snap\", not the legacy fast sync! Also I don't think your node can serve the new snap sync since your snapshot is not generated yet. \r\n\r\nBut snap sync is faster than fast sync, so even sync with public network is supposed to be working.  ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964765162/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964875656",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23873#issuecomment-964875656",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
    "id": 964875656,
    "node_id": "IC_kwDOAOvK9845gtWI",
    "user": {
      "login": "elsampsa",
      "id": 13978980,
      "node_id": "MDQ6VXNlcjEzOTc4OTgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/13978980?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/elsampsa",
      "html_url": "https://github.com/elsampsa",
      "followers_url": "https://api.github.com/users/elsampsa/followers",
      "following_url": "https://api.github.com/users/elsampsa/following{/other_user}",
      "gists_url": "https://api.github.com/users/elsampsa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/elsampsa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/elsampsa/subscriptions",
      "organizations_url": "https://api.github.com/users/elsampsa/orgs",
      "repos_url": "https://api.github.com/users/elsampsa/repos",
      "events_url": "https://api.github.com/users/elsampsa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/elsampsa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-10T08:06:23Z",
    "updated_at": "2021-11-10T08:07:02Z",
    "author_association": "NONE",
    "body": "Thank you for taking the time to explain me the basics.\r\n\r\nNow I (sort of) get that..\r\n\r\nSlowdown: when a new block arrives, it must be verified.  For verification, we need the state. Geth needs to crunch throught the whole database to get the (partial?) state (i) for the accounts that are being permutated by the new block.  However, if there is a snapshot of the complete state, then no need to crunch through the whole database (=fast).\r\n\r\nOr (ii) alternatively to (i), for a full node that's been running for ages, there _is_ a complete state trie, but it's been constructed in an unoptimal way..?  So geth needs more time to crunch through it.\r\n\r\nLooking forward to that new state scheme update..!  Please feel free to close this ticket now.  :)  (woops.. I closed it accidentally myself)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964875656/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964937201",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23873#issuecomment-964937201",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
    "id": 964937201,
    "node_id": "IC_kwDOAOvK9845g8Xx",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-10T09:24:30Z",
    "updated_at": "2021-11-10T09:24:30Z",
    "author_association": "MEMBER",
    "body": "My explanation was not fully correct. \r\n\r\nWhenever we want to process a new block, we need to read a lot of state. Historically, we've looked up e.g. an account by iterating the trie, meaning that each account lookup takes maybe ~7 db lookups. \r\n\r\nWith snapshots, it's more of a O(1) db-lookup, so that's faster. However, when the trie root is calculated, we still need to lookup a lot of trie nodes. \r\n\r\nSo snapshots makes it faster, but if you have a very large DB, even if we reduce the number of lookups, it may still be too slow. Because the db becomes less efficient, basically - the trie keys are spread all over the disk, and the caches/bloomfilters aren't as effective as they would be on a smaller dataset. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964937201/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964951610",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23873#issuecomment-964951610",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
    "id": 964951610,
    "node_id": "IC_kwDOAOvK9845g_46",
    "user": {
      "login": "elsampsa",
      "id": 13978980,
      "node_id": "MDQ6VXNlcjEzOTc4OTgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/13978980?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/elsampsa",
      "html_url": "https://github.com/elsampsa",
      "followers_url": "https://api.github.com/users/elsampsa/followers",
      "following_url": "https://api.github.com/users/elsampsa/following{/other_user}",
      "gists_url": "https://api.github.com/users/elsampsa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/elsampsa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/elsampsa/subscriptions",
      "organizations_url": "https://api.github.com/users/elsampsa/orgs",
      "repos_url": "https://api.github.com/users/elsampsa/repos",
      "events_url": "https://api.github.com/users/elsampsa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/elsampsa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-10T09:43:21Z",
    "updated_at": "2021-11-10T09:43:21Z",
    "author_association": "NONE",
    "body": "\"the trie keys are spread all over the disk\".. this sound similar normal filesystem fragmentation.. could one make a \"defrag\" on the trie..?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/964951610/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1006060578",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23873#issuecomment-1006060578",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23873",
    "id": 1006060578,
    "node_id": "IC_kwDOAOvK984790Qi",
    "user": {
      "login": "Kevostos",
      "id": 18055961,
      "node_id": "MDQ6VXNlcjE4MDU1OTYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/18055961?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kevostos",
      "html_url": "https://github.com/Kevostos",
      "followers_url": "https://api.github.com/users/Kevostos/followers",
      "following_url": "https://api.github.com/users/Kevostos/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kevostos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kevostos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kevostos/subscriptions",
      "organizations_url": "https://api.github.com/users/Kevostos/orgs",
      "repos_url": "https://api.github.com/users/Kevostos/repos",
      "events_url": "https://api.github.com/users/Kevostos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kevostos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-05T20:39:12Z",
    "updated_at": "2022-01-05T20:39:46Z",
    "author_association": "NONE",
    "body": "Same issue: my `snap` node keeps getting behind since it is generating snapshots. The completion ETA is between 300h and 3000h on an i3.xlarge AWS machine, which seems odd. How to speed this up? Can the snapshot be downloaded?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1006060578/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
