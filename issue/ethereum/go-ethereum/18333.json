{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18333",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18333/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18333/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18333/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/18333",
  "id": 392428809,
  "node_id": "MDU6SXNzdWUzOTI0Mjg4MDk=",
  "number": 18333,
  "title": "[SECURITY] Run other local command on the server with admin.setSolc",
  "user": {
    "login": "zchicc",
    "id": 42854169,
    "node_id": "MDQ6VXNlcjQyODU0MTY5",
    "avatar_url": "https://avatars.githubusercontent.com/u/42854169?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zchicc",
    "html_url": "https://github.com/zchicc",
    "followers_url": "https://api.github.com/users/zchicc/followers",
    "following_url": "https://api.github.com/users/zchicc/following{/other_user}",
    "gists_url": "https://api.github.com/users/zchicc/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zchicc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zchicc/subscriptions",
    "organizations_url": "https://api.github.com/users/zchicc/orgs",
    "repos_url": "https://api.github.com/users/zchicc/repos",
    "events_url": "https://api.github.com/users/zchicc/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zchicc/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2018-12-19T03:43:41Z",
  "updated_at": "2019-06-25T09:28:15Z",
  "closed_at": "2019-06-25T09:28:15Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi there,\r\n\r\nWhen auditing the rpc of geth, I find that there's a method `admin.setSolc(admin_setSolc)` in previous versions, which would invoke command `cmd := exec.Command(solc, \"--version\")` to query version info of solc. By setting the parameter `solc`, we could run any command with `admin.setSolc()`. This security issue no longer exists in the current version since the method `admin.setSolc()` has been removed.\r\n\r\nThe vulnerability is in the following function:\r\n\r\n```\r\n// SolidityVersion runs solc and parses its version output.\r\nfunc SolidityVersion(solc string) (*Solidity, error) {\r\n    if solc == \"\" {\r\n        solc = \"solc\"\r\n    }\r\n    var out bytes.Buffer\r\n    cmd := exec.Command(solc, \"--version\")\r\n    cmd.Stdout = &out\r\n    if err := cmd.Run(); err != nil {\r\n        return nil, err\r\n    }\r\n    s := &Solidity{\r\n        Path:        cmd.Path,\r\n        FullVersion: out.String(),\r\n        Version:     versionRegexp.FindString(out.String()),\r\n\t}\r\n\treturn s, nil\r\n}\r\n```\r\n\r\nExploit:\r\n\r\n1. Get software info on the server(the software needs to support parameter --version):\r\n\r\n```\r\n> admin.setSolc(\"/usr/bin/java\")\r\n\"java 10.0.2 2018-07-17\\nJava(TM) SE Runtime Environment 18.3 (build\r\n10.0.2+13)\\nJava HotSpot(TM) 64-Bit Server VM 18.3 (build 10.0.2+13, mixed\r\nmode)\\n\"\r\n```\r\n2. If geth has rpc admin module, then the method could be invoked remotely\r\n3. Privilege escalation. If the user has the permission on the server to create script file, then the user can exploit the bug and run the script with the permission of geth\r\n\r\n#### System information\r\n\r\nGeth version: v1.5.6\r\nOS & Version: Windows/Linux/OSX\r\nCommit hash : NA\r\n\r\n#### Expected behaviour\r\nThe command should not be executed.\r\n\r\n#### Actual behaviour\r\nWe can run almost any command.\r\n\r\n#### Steps to reproduce the behaviour\r\n```\r\n> admin.setSolc(\"/usr/bin/java\")\r\n\"java 10.0.2 2018-07-17\\nJava(TM) SE Runtime Environment 18.3 (build\r\n10.0.2+13)\\nJava HotSpot(TM) 64-Bit Server VM 18.3 (build 10.0.2+13, mixed\r\nmode)\\n\"\r\n```\r\n\r\n#### Backtrace\r\n\r\nNA\r\n",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18333/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18333/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/505364689",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18333#issuecomment-505364689",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18333",
    "id": 505364689,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwNTM2NDY4OQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-25T09:28:15Z",
    "updated_at": "2019-06-25T09:28:15Z",
    "author_association": "MEMBER",
    "body": "As you say yourself, this is already removed. Additionally, the `admin` namespace should not be exposed to untrusted parties, such as the internet... ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/505364689/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
