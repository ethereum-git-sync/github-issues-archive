{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19419",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19419/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19419/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19419/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/19419",
  "id": 430861046,
  "node_id": "MDU6SXNzdWU0MzA4NjEwNDY=",
  "number": 19419,
  "title": "Throttling in propagating pending transactions to sealer nodes ?",
  "user": {
    "login": "puneet-khushwani-bits",
    "id": 8430594,
    "node_id": "MDQ6VXNlcjg0MzA1OTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8430594?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/puneet-khushwani-bits",
    "html_url": "https://github.com/puneet-khushwani-bits",
    "followers_url": "https://api.github.com/users/puneet-khushwani-bits/followers",
    "following_url": "https://api.github.com/users/puneet-khushwani-bits/following{/other_user}",
    "gists_url": "https://api.github.com/users/puneet-khushwani-bits/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/puneet-khushwani-bits/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/puneet-khushwani-bits/subscriptions",
    "organizations_url": "https://api.github.com/users/puneet-khushwani-bits/orgs",
    "repos_url": "https://api.github.com/users/puneet-khushwani-bits/repos",
    "events_url": "https://api.github.com/users/puneet-khushwani-bits/events{/privacy}",
    "received_events_url": "https://api.github.com/users/puneet-khushwani-bits/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 202012689,
      "node_id": "MDU6TGFiZWwyMDIwMTI2ODk=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/area:core",
      "name": "area:core",
      "color": "fbca04",
      "default": false,
      "description": null
    },
    {
      "id": 1132687333,
      "node_id": "MDU6TGFiZWwxMTMyNjg3MzMz",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/need:check-with-current-version",
      "name": "need:check-with-current-version",
      "color": "d3b300",
      "default": false,
      "description": ""
    },
    {
      "id": 1132754722,
      "node_id": "MDU6TGFiZWwxMTMyNzU0NzIy",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/need:more-information",
      "name": "need:more-information",
      "color": "db6fa3",
      "default": false,
      "description": ""
    },
    {
      "id": 1380056442,
      "node_id": "MDU6TGFiZWwxMzgwMDU2NDQy",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/area:mining",
      "name": "area:mining",
      "color": "ca4ff7",
      "default": false,
      "description": ""
    },
    {
      "id": 1400760354,
      "node_id": "MDU6TGFiZWwxNDAwNzYwMzU0",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/area:txpool",
      "name": "area:txpool",
      "color": "cc0ef2",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-04-09T09:25:22Z",
  "updated_at": "2019-11-13T07:47:07Z",
  "closed_at": "2019-11-13T07:47:07Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi,\r\n\r\n#### System information\r\n\r\nWe have setup a private network of **POA** Geth with 3 Sealer Nodes (**SN**) & 2 nodes (**WN**) which is being used by the application to submit transactions & fetch data. We have set block generation time as 3 seconds.\r\n\r\nGeth version: `1.8.23-stable`\r\nOS & Machine details: CentOs 7 (4 core 16 GB RAM)\r\n\r\nGeth command to start SN\r\n\r\ngeth  --nodiscover --networkid 2000 --datadir /my_folder/node_u --keystore /my_folder/keystore --mine --unlock 0x* --password /my_folder/pwfile  --port 30301 --miner.gastarget 150000000 --miner.gaslimit 150000000 --miner.gasprice 0x3B9ACA00 --txpool.accountslots 2048 --txpool.globalslots 50000 --txpool.accountqueue 100000 --txpool.globalqueue 20480000\r\n\r\nGeth command to start WN\r\n\r\ngeth  --nodiscover --networkid 2000 --datadir /my_folder/node_u --keystore /my_folder/keystore  --port 30301 --rpc --rpcvhosts \"*\" --rpcaddr myhostname  --rpcapi eth,net,web3,personal,txpool --rpcport 8541 --ws --wsapi eth,net,web3,personal,txpool --wsaddr myhostname  --wsport 8551 --wsorigins \"*\"  --txpool.accountslots 2048 --txpool.globalslots 50000 --txpool.accountqueue 100000 --txpool.globalqueue 20480000\r\n\r\n\r\n#### Experiment\r\n\r\nWe are submitting transactions at a rate of ~300 per second on WN for ~ 1 hour.\r\n\r\n#### Expected behaviour\r\n\r\nAs miner.gaslimit & miner.gastarget are enough to accommodate ~1300 transactions in a block,  we were expecting blocks being mined with ~ 900 transactions in each block\r\n\r\n#### Actual behaviour\r\n\r\nAfter a few initial seconds we observe blocks being mined with ~ 400 transactions in each block. After that the number of transactions making into these blocks drastically decreases to ~ 60 .\r\n\r\nThe number of pending transactions (as seen from txpool.status) on WN were gradually increasing and went up to ~100,000 after which we stopped the submission script.\r\n\r\nHowever on the sealer nodes this number wasn't going above ~ 60. This we think was the reason for blocks mining only ~20 transactions.\r\n\r\nNOTE : Please note that on none of the machines CPU utilization is going above 50%. Memory utilization is also  fine\r\n\r\n####\r\n\r\nIn cases where rate of incoming transactions is high ~1000 per second, do we have some throttling in place which (within a few minutes) results in reducing the rate of propagation of pending transactions from WN to SN's ?\r\n\r\nWhile finding solutions to this, we managed to figure out a couple of workarounds to restore this propagation rate.\r\n\r\n1. Restarting WN.\r\n2. On WN, remove any one of SN enode entry via admin.peers and add it back again via admin.addPeer.\r\n3. This scenario used to work when we had WN on  geth v1.7.3\r\n\r\nCan we get help with better solution(s) to our problem.\r\n",
  "closed_by": {
    "login": "no-response[bot]",
    "id": 32965360,
    "node_id": "MDM6Qm90MzI5NjUzNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/26350515?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/no-response%5Bbot%5D",
    "html_url": "https://github.com/apps/no-response",
    "followers_url": "https://api.github.com/users/no-response%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/no-response%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/no-response%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/no-response%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/no-response%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/no-response%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/no-response%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/no-response%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/no-response%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19419/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19419/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/481175911",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19419#issuecomment-481175911",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19419",
    "id": 481175911,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4MTE3NTkxMQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-09T09:29:32Z",
    "updated_at": "2019-04-09T09:29:32Z",
    "author_association": "MEMBER",
    "body": "Could you try your test scenario with a build from the master branch and see how that performs? We've added a few optimizations around transaction signature recoveries. We may need more, but would be nice to know how they compare to the stable release.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/481175911/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/541532907",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19419#issuecomment-541532907",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19419",
    "id": 541532907,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MTUzMjkwNw==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-14T07:35:45Z",
    "updated_at": "2019-10-14T07:35:45Z",
    "author_association": "MEMBER",
    "body": "I'd echo what Peter said, we reworked tx pool things quite a lot in 1.9. Transactions were basically piling up goroutines, and I can imagine that would have an even worse effect on the sealer node, which not only needs to shuffle txs through the pool, but also regenerated state for mining and compete with the mining threads for state. \r\n\r\nSo, please check if this is still an issue on 1.9, otherwise I'll let the bot close this in a couple of weeks. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/541532907/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/553280775",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19419#issuecomment-553280775",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19419",
    "id": 553280775,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MzI4MDc3NQ==",
    "user": {
      "login": "no-response[bot]",
      "id": 32965360,
      "node_id": "MDM6Qm90MzI5NjUzNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/26350515?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/no-response%5Bbot%5D",
      "html_url": "https://github.com/apps/no-response",
      "followers_url": "https://api.github.com/users/no-response%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/no-response%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/no-response%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/no-response%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/no-response%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/no-response%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/no-response%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/no-response%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/no-response%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2019-11-13T07:47:06Z",
    "updated_at": "2019-11-13T07:47:06Z",
    "author_association": "NONE",
    "body": "This issue has been automatically closed because there has been no response to our request for more information from the original author. With only the information that is currently in the issue, we don't have enough information to take action. Please reach out if you have more relevant information or answers to our questions so that we can investigate further.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/553280775/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
