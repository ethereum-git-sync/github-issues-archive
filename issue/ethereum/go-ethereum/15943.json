{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15943",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15943/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15943/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15943/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/15943",
  "id": 290586316,
  "node_id": "MDU6SXNzdWUyOTA1ODYzMTY=",
  "number": 15943,
  "title": "Remote LES drops connection after local client submits transaction",
  "user": {
    "login": "veox",
    "id": 3036030,
    "node_id": "MDQ6VXNlcjMwMzYwMzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3036030?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/veox",
    "html_url": "https://github.com/veox",
    "followers_url": "https://api.github.com/users/veox/followers",
    "following_url": "https://api.github.com/users/veox/following{/other_user}",
    "gists_url": "https://api.github.com/users/veox/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/veox/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/veox/subscriptions",
    "organizations_url": "https://api.github.com/users/veox/orgs",
    "repos_url": "https://api.github.com/users/veox/repos",
    "events_url": "https://api.github.com/users/veox/events{/privacy}",
    "received_events_url": "https://api.github.com/users/veox/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2018-01-22T19:28:18Z",
  "updated_at": "2018-01-29T14:00:08Z",
  "closed_at": "2018-01-26T17:30:46Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nLocal light client:\r\n\r\nOS & Version: Ubuntu 16.04.3 LTS\r\nGeth version: `v1.7.3-stable-4bb3c89d` (via Ubuntu PPA)\r\n\r\nRemote light server:\r\n\r\nOS & Version: Ubuntu 16.04.3 LTS\r\nGeth version: `v1.8.0-unstable-02aeb3d` (self-built)\r\nGo: 1.9.2\r\n\r\n#### Expected behaviour\r\n\r\nRemote LES peers remain connected after local light client broadcasts a transaction.\r\n\r\n#### Actual behaviour\r\n\r\nRemote LES servers with versions >= v1.7.3 routinely disconnect after my local LES client broadcasts a transaction through them.\r\n\r\nObserved with remote servers of v1.7.3 and v1.8.0 (unstable). So far seems not to affect v1.7.2 remotes.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n* Wait until local light client connects to a v1.7.3 or v1.8.0 remote (console: `admin.peers`).\r\n* Turn on debugging (console: `debug.vmodule(\"p2p=5\")`).\r\n* Send a transaction (console: `eth.sendTransaction({from: ..., to: ..., value: ..., gasPrice: ...})`.\r\n\r\n#### Log\r\n\r\nIn the client's log (via `journalctl`, since running `geth` using `systemd`):\r\n\r\n````\r\n...\r\nJan 22 21:00:14 egs geth[3452]: INFO [01-22|21:00:14] Submitted transaction                    fullhash=<snipped> recipient=<snipped>\r\nJan 22 21:00:14 egs geth[3452]: DEBUG[01-22|21:00:14] Removing p2p peer                        id=138ec659b5ec0202 conn=inbound duration=17m25.607s peers=1 req=true  err=\"disconnect requested\"\r\nJan 22 21:00:14 egs geth[3452]: TRACE[01-22|21:00:14] New dial task                            task=\"staticdial 138ec659b5ec0202 :::30303\"\r\nJan 22 21:00:14 egs geth[3452]: TRACE[01-22|21:00:14] Accepted connection                      addr=[::1]:34494\r\nJan 22 21:00:14 egs geth[3452]: TRACE[01-22|21:00:14] Failed RLPx handshake                    addr=[::1]:34494                       conn=inbound err=\"ecies: invalid message\"\r\nJan 22 21:00:14 egs geth[3452]: TRACE[01-22|21:00:14] Failed RLPx handshake                    addr=[::1]:30303                       conn=staticdial err=EOF\r\nJan 22 21:00:14 egs geth[3452]: TRACE[01-22|21:00:14] Dial task done                           task=\"staticdial 138ec659b5ec0202 :::30303\"\r\n...\r\n````\r\n\r\nThat is, right after the the transaction is submitted, the remote requests a disconnect. (Any other modules than `p2p` I should make more verbose?)\r\n\r\nIn this case, the `138ec659b5ec0202` peer also happens to be mine (its version info is at the top).",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15943/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15943/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/361252564",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15943#issuecomment-361252564",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15943",
    "id": 361252564,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MTI1MjU2NA==",
    "user": {
      "login": "veox",
      "id": 3036030,
      "node_id": "MDQ6VXNlcjMwMzYwMzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3036030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/veox",
      "html_url": "https://github.com/veox",
      "followers_url": "https://api.github.com/users/veox/followers",
      "following_url": "https://api.github.com/users/veox/following{/other_user}",
      "gists_url": "https://api.github.com/users/veox/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/veox/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/veox/subscriptions",
      "organizations_url": "https://api.github.com/users/veox/orgs",
      "repos_url": "https://api.github.com/users/veox/repos",
      "events_url": "https://api.github.com/users/veox/events{/privacy}",
      "received_events_url": "https://api.github.com/users/veox/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-29T13:57:03Z",
    "updated_at": "2018-01-29T13:57:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "Confirming issue fixed after PR #15974.\r\n\r\n`v1.8.0-unstable-722bac84` peers - one commit after PR merge - don't drop the connection. (Now tested with same version for both client and server.)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/361252564/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/361253394",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15943#issuecomment-361253394",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15943",
    "id": 361253394,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MTI1MzM5NA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-29T14:00:08Z",
    "updated_at": "2018-01-29T14:00:08Z",
    "author_association": "MEMBER",
    "body": "Thanks for the confirm @veox !",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/361253394/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
