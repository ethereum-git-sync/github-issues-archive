{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15945",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15945/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15945/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15945/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/15945",
  "id": 290637110,
  "node_id": "MDU6SXNzdWUyOTA2MzcxMTA=",
  "number": 15945,
  "title": "Transaction tracer: gasCost of CALL opcode seems very high",
  "user": {
    "login": "vsaraph",
    "id": 5934167,
    "node_id": "MDQ6VXNlcjU5MzQxNjc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5934167?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vsaraph",
    "html_url": "https://github.com/vsaraph",
    "followers_url": "https://api.github.com/users/vsaraph/followers",
    "following_url": "https://api.github.com/users/vsaraph/following{/other_user}",
    "gists_url": "https://api.github.com/users/vsaraph/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vsaraph/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vsaraph/subscriptions",
    "organizations_url": "https://api.github.com/users/vsaraph/orgs",
    "repos_url": "https://api.github.com/users/vsaraph/repos",
    "events_url": "https://api.github.com/users/vsaraph/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vsaraph/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1132689577,
      "node_id": "MDU6TGFiZWwxMTMyNjg5NTc3",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:triage",
      "name": "status:triage",
      "color": "6be514",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2018-01-22T22:20:04Z",
  "updated_at": "2019-09-17T09:39:53Z",
  "closed_at": "2019-09-17T09:32:41Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I am using geth version 1.8.0 on OS X.\r\n(commit 02aeb3d76652a4c0451e5c3734e6881aefe46249)\r\n\r\nIt seems to me like there's something off with the gas cost of `CALL` instructions as calculated by the tracer. Consider the following snippet from the trace of transaction [0xe5c0b9656aba44735008202d975dd4f9ca07db5e7b2ec4611d63237fd45974b0](https://etherscan.io/tx/0xe5c0b9656aba44735008202d975dd4f9ca07db5e7b2ec4611d63237fd45974b0):\r\n\r\n...\r\n{u'pc': 3134, u'depth': 1, u'gasCost': 1, u'gas': 1952713, u'op': u'JUMPDEST'}\r\n{u'pc': 3135, u'depth': 1, u'gasCost': 3, u'gas': 1952712, u'op': u'PUSH2'}\r\n{u'pc': 3138, u'depth': 1, u'gasCost': 2, u'gas': 1952709, u'op': u'GAS'}\r\n{u'pc': 3139, u'depth': 1, u'gasCost': 3, u'gas': 1952707, u'op': u'SUB'}\r\n**{u'pc': 3140, u'depth': 1, u'gasCost': 1922204, u'gas': 1952704, u'op': u'CALL'}**\r\n{u'pc': 0, u'depth': 2, u'gasCost': 3, u'gas': 1921504, u'op': u'PUSH1'}\r\n{u'pc': 2, u'depth': 2, u'gasCost': 3, u'gas': 1921501, u'op': u'PUSH1'}\r\n{u'pc': 4, u'depth': 2, u'gasCost': 12, u'gas': 1921498, u'op': u'MSTORE'}\r\n{u'pc': 5, u'depth': 2, u'gasCost': 2, u'gas': 1921486, u'op': u'CALLDATASIZE'}\r\n{u'pc': 6, u'depth': 2, u'gasCost': 3, u'gas': 1921484, u'op': u'ISZERO'}\r\n...\r\n\r\nThe cost of `CALL` (bolded above) above seems far too high to me. With every other instruction, the `gas` field of the next instruction is equal to `gas - gasCost` of the current instruction, but this is clearly not true for the `CALL` above, or for any other `CALL` I looked at.\r\n\r\nI also noticed that`CALL`'s `gasCost` seems to always be 700 more than the next entry's `gas`. Note that 700 gas is the base cost for a `CALL` instruction, according to the yellow paper.\r\n\r\nI didn't use a custom Javascript tracer, just the default tracer, with storage, memory, and stack all disabled.\r\n\r\nAm I misinterpreting the output for the `CALL` opcode, or is something actually wrong here? I have not yet looked at the output for the related `CALLCODE` and `DELEGATECALL` opcodes, but they might also have a similar issue.",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15945/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15945/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/453541345",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15945#issuecomment-453541345",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15945",
    "id": 453541345,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1MzU0MTM0NQ==",
    "user": {
      "login": "LogvinovLeon",
      "id": 6204356,
      "node_id": "MDQ6VXNlcjYyMDQzNTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6204356?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LogvinovLeon",
      "html_url": "https://github.com/LogvinovLeon",
      "followers_url": "https://api.github.com/users/LogvinovLeon/followers",
      "following_url": "https://api.github.com/users/LogvinovLeon/following{/other_user}",
      "gists_url": "https://api.github.com/users/LogvinovLeon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LogvinovLeon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LogvinovLeon/subscriptions",
      "organizations_url": "https://api.github.com/users/LogvinovLeon/orgs",
      "repos_url": "https://api.github.com/users/LogvinovLeon/repos",
      "events_url": "https://api.github.com/users/LogvinovLeon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LogvinovLeon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-11T14:51:02Z",
    "updated_at": "2019-01-11T14:51:02Z",
    "author_association": "NONE",
    "body": "I'm hitting the same issue. I was able to fix it for me by checking if gas cost is unreasonably high and taking it as a difference between consecutive gas fields, but that's a hack.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/453541345/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/532141918",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15945#issuecomment-532141918",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15945",
    "id": 532141918,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMjE0MTkxOA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-17T09:31:34Z",
    "updated_at": "2019-09-17T09:32:08Z",
    "author_association": "MEMBER",
    "body": "```\r\n{u'pc': 3138, u'depth': 1, u'gasCost': 2, u'gas': 1952709, u'op': u'GAS'}\r\n{u'pc': 3139, u'depth': 1, u'gasCost': 3, u'gas': 1952707, u'op': u'SUB'}\r\n{u'pc': 3140, u'depth': 1, u'gasCost': 1922204, u'gas': 1952704, u'op': u'CALL'}\r\n```\r\nThe `gas` in `call( gas...)` is the entire gas available, minus some constant which we're not seeing on the trace. So at that point in time, as far as the evm is aware, you're sending all gas -- the cost is thus all gas. Then some goes away (create account is 25K gas, and probably some other things get removed). ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/532141918/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/532145002",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15945#issuecomment-532145002",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15945",
    "id": 532145002,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMjE0NTAwMg==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-09-17T09:39:53Z",
    "updated_at": "2019-09-17T09:39:53Z",
    "author_association": "MEMBER",
    "body": "If you are interested in the gas **used**, that can only be calculated when the call returns. In the case of opcode traces, it's up to you to calculate it. Geth also has a `callTracer` that can do it for you. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/532145002/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
