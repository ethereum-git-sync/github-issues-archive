{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26467",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26467/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26467/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26467/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/26467",
  "id": 1527513554,
  "node_id": "I_kwDOAOvK985bDAHS",
  "number": 26467,
  "title": "p2p: ingress connections fail when netrestrict is used",
  "user": {
    "login": "okorolov",
    "id": 31506341,
    "node_id": "MDQ6VXNlcjMxNTA2MzQx",
    "avatar_url": "https://avatars.githubusercontent.com/u/31506341?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/okorolov",
    "html_url": "https://github.com/okorolov",
    "followers_url": "https://api.github.com/users/okorolov/followers",
    "following_url": "https://api.github.com/users/okorolov/following{/other_user}",
    "gists_url": "https://api.github.com/users/okorolov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/okorolov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/okorolov/subscriptions",
    "organizations_url": "https://api.github.com/users/okorolov/orgs",
    "repos_url": "https://api.github.com/users/okorolov/repos",
    "events_url": "https://api.github.com/users/okorolov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/okorolov/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-01-10T14:42:33Z",
  "updated_at": "2023-07-10T12:23:13Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `1.10.26`\r\nCL client & version: `Prysm 3.2.0`\r\nOS & Version: `Ubuntu 20.04`\r\n\r\n#### Expected behaviour\r\n\r\nNode is discoverable by remote peers from the defined networks in `netrestrict` configuration. \r\n\r\n#### Actual behaviour\r\n\r\nThe connected peer count is eventually locked to 16 (if `maxpeers=50`) or 32-33 (if `maxpeers=100`).\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nRestrict some public subnets with live nodes and wait until peers start connecting\r\n\r\nWhen submitting logs: please submit them as text and not screenshots.\r\n\r\n#### Additional information\r\n\r\nI'm trying to limit Geth communication with some big public subnets (mostly cloud providers). \r\nWith this scenario, my node is struggling to add more peers and will be eventually locked to 16/33 peers depending on the `maxpeers` configuration. \r\nBased on https://github.com/ethereum/go-ethereum/issues/19864 it seems that remote peers are not able to find my node. \r\nThe configuration from my side should be correct. I am using `nat extip` configuration (Running on EC2 instance with Elastic IP attached). A similar configuration on Prysm works as expected.\r\n\r\nThe confusing part here is that the Prysm client with a similar configuration quickly finds peers and I'm able to see that part of those are \"inbound\" which means that external peers were able to detect the node and perform the connection. \r\n",
  "closed_by": {
    "login": "lightclient",
    "id": 14004106,
    "node_id": "MDQ6VXNlcjE0MDA0MTA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/14004106?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lightclient",
    "html_url": "https://github.com/lightclient",
    "followers_url": "https://api.github.com/users/lightclient/followers",
    "following_url": "https://api.github.com/users/lightclient/following{/other_user}",
    "gists_url": "https://api.github.com/users/lightclient/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lightclient/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lightclient/subscriptions",
    "organizations_url": "https://api.github.com/users/lightclient/orgs",
    "repos_url": "https://api.github.com/users/lightclient/repos",
    "events_url": "https://api.github.com/users/lightclient/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lightclient/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26467/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26467/timeline",
  "performed_via_github_app": null,
  "state_reason": "reopened"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1628449702",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26467#issuecomment-1628449702",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26467",
    "id": 1628449702,
    "node_id": "IC_kwDOAOvK985hECum",
    "user": {
      "login": "oiooj",
      "id": 2253095,
      "node_id": "MDQ6VXNlcjIyNTMwOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2253095?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/oiooj",
      "html_url": "https://github.com/oiooj",
      "followers_url": "https://api.github.com/users/oiooj/followers",
      "following_url": "https://api.github.com/users/oiooj/following{/other_user}",
      "gists_url": "https://api.github.com/users/oiooj/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/oiooj/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/oiooj/subscriptions",
      "organizations_url": "https://api.github.com/users/oiooj/orgs",
      "repos_url": "https://api.github.com/users/oiooj/repos",
      "events_url": "https://api.github.com/users/oiooj/events{/privacy}",
      "received_events_url": "https://api.github.com/users/oiooj/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-10T08:09:43Z",
    "updated_at": "2023-07-10T08:09:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "It seems that your node only can dial other nodes, and it's limit is `srv.MaxPeers / 3`\r\nIf you set `maxpeers=50`, the limit of dial num is 16, the limit of inbond conns is 34.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1628449702/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1628820027",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26467#issuecomment-1628820027",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26467",
    "id": 1628820027,
    "node_id": "IC_kwDOAOvK985hFdI7",
    "user": {
      "login": "lightclient",
      "id": 14004106,
      "node_id": "MDQ6VXNlcjE0MDA0MTA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14004106?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lightclient",
      "html_url": "https://github.com/lightclient",
      "followers_url": "https://api.github.com/users/lightclient/followers",
      "following_url": "https://api.github.com/users/lightclient/following{/other_user}",
      "gists_url": "https://api.github.com/users/lightclient/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lightclient/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lightclient/subscriptions",
      "organizations_url": "https://api.github.com/users/lightclient/orgs",
      "repos_url": "https://api.github.com/users/lightclient/repos",
      "events_url": "https://api.github.com/users/lightclient/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lightclient/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-10T11:58:59Z",
    "updated_at": "2023-07-10T11:58:59Z",
    "author_association": "MEMBER",
    "body": "@oiooj is correct. You will need to increase `maxpeers` or set `DialRatio` to something smaller than 3 in Node.P2P section of the toml config.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1628820027/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1628825450",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26467#issuecomment-1628825450",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26467",
    "id": 1628825450,
    "node_id": "IC_kwDOAOvK985hFedq",
    "user": {
      "login": "lightclient",
      "id": 14004106,
      "node_id": "MDQ6VXNlcjE0MDA0MTA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14004106?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lightclient",
      "html_url": "https://github.com/lightclient",
      "followers_url": "https://api.github.com/users/lightclient/followers",
      "following_url": "https://api.github.com/users/lightclient/following{/other_user}",
      "gists_url": "https://api.github.com/users/lightclient/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lightclient/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lightclient/subscriptions",
      "organizations_url": "https://api.github.com/users/lightclient/orgs",
      "repos_url": "https://api.github.com/users/lightclient/repos",
      "events_url": "https://api.github.com/users/lightclient/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lightclient/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-10T12:02:55Z",
    "updated_at": "2023-07-10T12:02:55Z",
    "author_association": "MEMBER",
    "body": "Sorry didn't mean to close yet. \r\n\r\nIt likely something with your setup causing it so that you are unable to be dialed externally. This is why you continue getting capped at the outbound limit. Do you have any logs, maybe with `--vmodule=p2p/*=5` set?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1628825450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
