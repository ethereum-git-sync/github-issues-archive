{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26941",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26941/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26941/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26941/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/26941",
  "id": 1633824476,
  "node_id": "I_kwDOAOvK985hYi7c",
  "number": 26941,
  "title": "Why should we make sure the rewound point is lower than disk layer before head state recovery?",
  "user": {
    "login": "jongrun",
    "id": 31625057,
    "node_id": "MDQ6VXNlcjMxNjI1MDU3",
    "avatar_url": "https://avatars.githubusercontent.com/u/31625057?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jongrun",
    "html_url": "https://github.com/jongrun",
    "followers_url": "https://api.github.com/users/jongrun/followers",
    "following_url": "https://api.github.com/users/jongrun/following{/other_user}",
    "gists_url": "https://api.github.com/users/jongrun/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jongrun/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jongrun/subscriptions",
    "organizations_url": "https://api.github.com/users/jongrun/orgs",
    "repos_url": "https://api.github.com/users/jongrun/repos",
    "events_url": "https://api.github.com/users/jongrun/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jongrun/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-03-21T12:34:20Z",
  "updated_at": "2023-03-22T14:15:13Z",
  "closed_at": "2023-03-21T13:32:16Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "https://github.com/ethereum/go-ethereum/blob/e5eb32acee19cc9fca6a03b10283b7484246b15a/core/blockchain.go#L293-L310\r\n@rjl493456442 Why should we make sure the rewound point is lower than disk layer before head state recovery?\r\nIn my understanding, we must make sure the rewound point is lower then the last snapshot (including the diff layer). Otherwise, the snapshot is inconsistent with the head and unusable. But why should it be lower than disk layer? Is it possible that we firstly load the diff layer from journal and then compare the last diff layer with the rewound point?",
  "closed_by": {
    "login": "rjl493456442",
    "id": 5959481,
    "node_id": "MDQ6VXNlcjU5NTk0ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rjl493456442",
    "html_url": "https://github.com/rjl493456442",
    "followers_url": "https://api.github.com/users/rjl493456442/followers",
    "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
    "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
    "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
    "repos_url": "https://api.github.com/users/rjl493456442/repos",
    "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26941/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26941/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1477769043",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26941#issuecomment-1477769043",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26941",
    "id": 1477769043,
    "node_id": "IC_kwDOAOvK985YFPdT",
    "user": {
      "login": "jongrun",
      "id": 31625057,
      "node_id": "MDQ6VXNlcjMxNjI1MDU3",
      "avatar_url": "https://avatars.githubusercontent.com/u/31625057?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jongrun",
      "html_url": "https://github.com/jongrun",
      "followers_url": "https://api.github.com/users/jongrun/followers",
      "following_url": "https://api.github.com/users/jongrun/following{/other_user}",
      "gists_url": "https://api.github.com/users/jongrun/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jongrun/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jongrun/subscriptions",
      "organizations_url": "https://api.github.com/users/jongrun/orgs",
      "repos_url": "https://api.github.com/users/jongrun/repos",
      "events_url": "https://api.github.com/users/jongrun/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jongrun/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-21T12:39:39Z",
    "updated_at": "2023-03-21T13:40:34Z",
    "author_association": "NONE",
    "body": "@rjl493456442 By the way, the state between the rewound point and the disk layer can not be got from snapshot. I don't know if my understanding is right?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1477769043/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1477840972",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26941#issuecomment-1477840972",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26941",
    "id": 1477840972,
    "node_id": "IC_kwDOAOvK985YFhBM",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-21T13:29:55Z",
    "updated_at": "2023-03-21T13:29:55Z",
    "author_association": "MEMBER",
    "body": "Snapshot might still be generating. The disk layer of snapshot must have a corresponding trie for generation.\r\nIf we rewind the trie state lower or equal to snapshot disk layer, we can ensure trie state will be progressed \r\nand connect with snapshot later on.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1477840972/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1477856671",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26941#issuecomment-1477856671",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26941",
    "id": 1477856671,
    "node_id": "IC_kwDOAOvK985YFk2f",
    "user": {
      "login": "jongrun",
      "id": 31625057,
      "node_id": "MDQ6VXNlcjMxNjI1MDU3",
      "avatar_url": "https://avatars.githubusercontent.com/u/31625057?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jongrun",
      "html_url": "https://github.com/jongrun",
      "followers_url": "https://api.github.com/users/jongrun/followers",
      "following_url": "https://api.github.com/users/jongrun/following{/other_user}",
      "gists_url": "https://api.github.com/users/jongrun/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jongrun/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jongrun/subscriptions",
      "organizations_url": "https://api.github.com/users/jongrun/orgs",
      "repos_url": "https://api.github.com/users/jongrun/repos",
      "events_url": "https://api.github.com/users/jongrun/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jongrun/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-21T13:39:43Z",
    "updated_at": "2023-03-22T14:15:13Z",
    "author_association": "NONE",
    "body": "> Snapshot might still be generating. The disk layer of snapshot must have a corresponding trie for generation. If we rewind the trie state lower or equal to snapshot disk layer, we can ensure trie state will be progressed and connect with snapshot later on.\r\n\r\n@rjl493456442 Can we just rewind the trie state lower or equal to last diff layer if the diff layer journal is valid?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1477856671/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
