{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19504",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19504/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19504/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19504/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/19504",
  "id": 438037182,
  "node_id": "MDU6SXNzdWU0MzgwMzcxODI=",
  "number": 19504,
  "title": "Head state missing, repairing chain",
  "user": {
    "login": "BeOleg",
    "id": 3058791,
    "node_id": "MDQ6VXNlcjMwNTg3OTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3058791?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/BeOleg",
    "html_url": "https://github.com/BeOleg",
    "followers_url": "https://api.github.com/users/BeOleg/followers",
    "following_url": "https://api.github.com/users/BeOleg/following{/other_user}",
    "gists_url": "https://api.github.com/users/BeOleg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/BeOleg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/BeOleg/subscriptions",
    "organizations_url": "https://api.github.com/users/BeOleg/orgs",
    "repos_url": "https://api.github.com/users/BeOleg/repos",
    "events_url": "https://api.github.com/users/BeOleg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/BeOleg/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2019-04-28T09:44:18Z",
  "updated_at": "2021-08-09T09:58:24Z",
  "closed_at": "2019-06-07T14:20:39Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "```\r\nroot@nexwallet-eth3:/mnt/STORAGE/WALLETS# cat /var/lib/docker/containers/23406ad9bc38a5b9ab3c8e342295c91f2550d3b5c16f00d681f181aed9721c0d/23406ad9bc38a5b9ab3c8e342295c91f2550d3b5c16f00d681f181aed9721c0d-json.log | grep 'Head state missing'\r\n\r\n{\"log\":\"WARN [04-24|12:13:48.884] Head state missing, repairing chain      number=7623347 hash=b6c254…3a0dad\\n\",\"stream\":\"stderr\",\"time\":\"2019-04-24T12:13:48.885446409Z\"}\r\n\r\n{\"log\":\"WARN [04-25|19:19:10.008] Head state missing, repairing chain      number=7638271 hash=c73676…151eb8\\n\",\"stream\":\"stderr\",\"time\":\"2019-04-25T19:19:10.008881355Z\"}\r\n\r\n{\"log\":\"WARN [04-26|08:52:25.125] Head state missing, repairing chain      number=7641791 hash=c263d9…dfbe79\\n\",\"stream\":\"stderr\",\"time\":\"2019-04-26T08:52:25.125447127Z\"}\r\n\r\n{\"log\":\"WARN [04-28|09:21:28.698] Head state missing, repairing chain      number=7655058 hash=f11663…507ae5\\n\",\"stream\":\"stderr\",\"time\":\"2019-04-28T09:21:28.698886159Z\"}\r\n```\r\n\r\nI have found this in our logs.\r\nI suspect that this happens dues to planned restart (using docker-compose, official geth image from dockerhub), or due to crashes (not sure why, where can I find more verbose info?).\r\n\r\n\r\nI suspect that this causes:\r\n1. Our node to fall behind.\r\n2. Our node to generate transactions which are not properly published.\r\n\r\nAll as described in https://github.com/ethereum/go-ethereum/issues/19455\r\n\r\nI would appreciate any assistance",
  "closed_by": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19504/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19504/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/487454700",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19504#issuecomment-487454700",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19504",
    "id": 487454700,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4NzQ1NDcwMA==",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-29T05:23:04Z",
    "updated_at": "2019-04-29T05:23:04Z",
    "author_association": "MEMBER",
    "body": "Now geth will maintain lots of **trie nodes** in the memory the GC them. So geth does not flush all generated tries into disk but periodically persists.\r\n\r\nWhen geth receives stop (or ctrl+c), it will flush the necessary trie nodes in memory into the disk, but this process takes a certain amount of time. I guess the docker forcibly stop the process without waiting the flush finished.\r\n\r\nSo when the node restarts, a few trie nodes are missing and repairing starts.\r\n\r\nYou can increase the docker stop-timeout to fix it. `--stop-timeout  180`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/487454700/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/890550408",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19504#issuecomment-890550408",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19504",
    "id": 890550408,
    "node_id": "IC_kwDOAOvK9841FLiI",
    "user": {
      "login": "jayboy-mabushi",
      "id": 60149478,
      "node_id": "MDQ6VXNlcjYwMTQ5NDc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/60149478?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jayboy-mabushi",
      "html_url": "https://github.com/jayboy-mabushi",
      "followers_url": "https://api.github.com/users/jayboy-mabushi/followers",
      "following_url": "https://api.github.com/users/jayboy-mabushi/following{/other_user}",
      "gists_url": "https://api.github.com/users/jayboy-mabushi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jayboy-mabushi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jayboy-mabushi/subscriptions",
      "organizations_url": "https://api.github.com/users/jayboy-mabushi/orgs",
      "repos_url": "https://api.github.com/users/jayboy-mabushi/repos",
      "events_url": "https://api.github.com/users/jayboy-mabushi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jayboy-mabushi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-01T16:31:55Z",
    "updated_at": "2021-08-01T16:31:55Z",
    "author_association": "NONE",
    "body": "@BeOleg did you get a solution for this issue?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/890550408/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/890582749",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19504#issuecomment-890582749",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19504",
    "id": 890582749,
    "node_id": "IC_kwDOAOvK9841FTbd",
    "user": {
      "login": "jayboy-mabushi",
      "id": 60149478,
      "node_id": "MDQ6VXNlcjYwMTQ5NDc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/60149478?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jayboy-mabushi",
      "html_url": "https://github.com/jayboy-mabushi",
      "followers_url": "https://api.github.com/users/jayboy-mabushi/followers",
      "following_url": "https://api.github.com/users/jayboy-mabushi/following{/other_user}",
      "gists_url": "https://api.github.com/users/jayboy-mabushi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jayboy-mabushi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jayboy-mabushi/subscriptions",
      "organizations_url": "https://api.github.com/users/jayboy-mabushi/orgs",
      "repos_url": "https://api.github.com/users/jayboy-mabushi/repos",
      "events_url": "https://api.github.com/users/jayboy-mabushi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jayboy-mabushi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-01T20:35:20Z",
    "updated_at": "2021-08-01T20:35:20Z",
    "author_association": "NONE",
    "body": "@fjl is there a fix for this? my node is not starting pulling it new data it is stuck at this error. \r\n\r\n![image](https://user-images.githubusercontent.com/60149478/127776154-3ec657f7-eb8c-422f-a9bf-86fbe73fc561.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/890582749/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/893700860",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19504#issuecomment-893700860",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19504",
    "id": 893700860,
    "node_id": "IC_kwDOAOvK9841RMr8",
    "user": {
      "login": "GrinderBrad",
      "id": 16588910,
      "node_id": "MDQ6VXNlcjE2NTg4OTEw",
      "avatar_url": "https://avatars.githubusercontent.com/u/16588910?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/GrinderBrad",
      "html_url": "https://github.com/GrinderBrad",
      "followers_url": "https://api.github.com/users/GrinderBrad/followers",
      "following_url": "https://api.github.com/users/GrinderBrad/following{/other_user}",
      "gists_url": "https://api.github.com/users/GrinderBrad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/GrinderBrad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/GrinderBrad/subscriptions",
      "organizations_url": "https://api.github.com/users/GrinderBrad/orgs",
      "repos_url": "https://api.github.com/users/GrinderBrad/repos",
      "events_url": "https://api.github.com/users/GrinderBrad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/GrinderBrad/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-05T18:53:34Z",
    "updated_at": "2021-08-05T18:53:34Z",
    "author_association": "NONE",
    "body": "@jayboy-mabushi I ran into the same problem just now. Any updates on your side?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/893700860/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/893727803",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19504#issuecomment-893727803",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19504",
    "id": 893727803,
    "node_id": "IC_kwDOAOvK9841RTQ7",
    "user": {
      "login": "jayboy-mabushi",
      "id": 60149478,
      "node_id": "MDQ6VXNlcjYwMTQ5NDc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/60149478?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jayboy-mabushi",
      "html_url": "https://github.com/jayboy-mabushi",
      "followers_url": "https://api.github.com/users/jayboy-mabushi/followers",
      "following_url": "https://api.github.com/users/jayboy-mabushi/following{/other_user}",
      "gists_url": "https://api.github.com/users/jayboy-mabushi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jayboy-mabushi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jayboy-mabushi/subscriptions",
      "organizations_url": "https://api.github.com/users/jayboy-mabushi/orgs",
      "repos_url": "https://api.github.com/users/jayboy-mabushi/repos",
      "events_url": "https://api.github.com/users/jayboy-mabushi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jayboy-mabushi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-05T19:30:39Z",
    "updated_at": "2021-08-05T19:30:39Z",
    "author_association": "NONE",
    "body": "@GrinderBrad nope I just resynced deleted everything\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/893727803/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/895033662",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19504#issuecomment-895033662",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19504",
    "id": 895033662,
    "node_id": "IC_kwDOAOvK9841WSE-",
    "user": {
      "login": "cryptobrokering",
      "id": 86203753,
      "node_id": "MDQ6VXNlcjg2MjAzNzUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/86203753?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cryptobrokering",
      "html_url": "https://github.com/cryptobrokering",
      "followers_url": "https://api.github.com/users/cryptobrokering/followers",
      "following_url": "https://api.github.com/users/cryptobrokering/following{/other_user}",
      "gists_url": "https://api.github.com/users/cryptobrokering/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cryptobrokering/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cryptobrokering/subscriptions",
      "organizations_url": "https://api.github.com/users/cryptobrokering/orgs",
      "repos_url": "https://api.github.com/users/cryptobrokering/repos",
      "events_url": "https://api.github.com/users/cryptobrokering/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cryptobrokering/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-09T08:14:35Z",
    "updated_at": "2021-08-09T08:17:47Z",
    "author_association": "NONE",
    "body": "Also have the same problem. For me a restart of the server helped to get the syncing process running again but not sure how stable it is yet.\r\n\r\n@jayboy-mabushi You mean you had to start the whole syncing process again from scratch?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/895033662/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/895068234",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19504#issuecomment-895068234",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19504",
    "id": 895068234,
    "node_id": "IC_kwDOAOvK9841WahK",
    "user": {
      "login": "GrinderBrad",
      "id": 16588910,
      "node_id": "MDQ6VXNlcjE2NTg4OTEw",
      "avatar_url": "https://avatars.githubusercontent.com/u/16588910?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/GrinderBrad",
      "html_url": "https://github.com/GrinderBrad",
      "followers_url": "https://api.github.com/users/GrinderBrad/followers",
      "following_url": "https://api.github.com/users/GrinderBrad/following{/other_user}",
      "gists_url": "https://api.github.com/users/GrinderBrad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/GrinderBrad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/GrinderBrad/subscriptions",
      "organizations_url": "https://api.github.com/users/GrinderBrad/orgs",
      "repos_url": "https://api.github.com/users/GrinderBrad/repos",
      "events_url": "https://api.github.com/users/GrinderBrad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/GrinderBrad/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-09T09:14:13Z",
    "updated_at": "2021-08-09T09:58:24Z",
    "author_association": "NONE",
    "body": "For me helped \r\n\r\n- update to geth 1.10.6\r\n- adding `--snapshot=false --syncmode=fast` to run arguments\r\n\r\nNo re-sync needed.\r\n\r\nP.S. Be careful if you run geth in docker. When you exiting geth process it takes some time. Make sure to add `--time=180` to docker stop command when you need to stop it. Otherwise you'll lose some blocks and re-sycning might take 2-5 hours.\r\n\r\nAlso don't try to wait it resolve on its own. I left it for a day - and no luck.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/895068234/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
