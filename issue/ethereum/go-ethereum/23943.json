{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23943",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23943/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23943/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23943/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23943",
  "id": 1059313738,
  "node_id": "I_kwDOAOvK984_I9hK",
  "number": 23943,
  "title": "eth.subscribe() does not fire any event",
  "user": {
    "login": "Art-Mas",
    "id": 26169538,
    "node_id": "MDQ6VXNlcjI2MTY5NTM4",
    "avatar_url": "https://avatars.githubusercontent.com/u/26169538?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Art-Mas",
    "html_url": "https://github.com/Art-Mas",
    "followers_url": "https://api.github.com/users/Art-Mas/followers",
    "following_url": "https://api.github.com/users/Art-Mas/following{/other_user}",
    "gists_url": "https://api.github.com/users/Art-Mas/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Art-Mas/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Art-Mas/subscriptions",
    "organizations_url": "https://api.github.com/users/Art-Mas/orgs",
    "repos_url": "https://api.github.com/users/Art-Mas/repos",
    "events_url": "https://api.github.com/users/Art-Mas/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Art-Mas/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 268304226,
      "node_id": "MDU6TGFiZWwyNjgzMDQyMjY=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:docs",
      "name": "type:docs",
      "color": "fef2c0",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-11-21T07:41:41Z",
  "updated_at": "2021-11-22T07:13:44Z",
  "closed_at": "2021-11-22T07:13:43Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "1. I have deployed and started a local node \r\n\r\n```\r\nwget https://github.com/binance-chain/bsc/releases/download/v1.1.5/geth_linux\r\n\r\n./geth_linux --config ./config.toml --datadir ./mainnet --cache 18000 --rpc.allow-unprotected-txs --txlookuplimit 0 --http --maxpeers 100 --ws --syncmode=snap --snapshot=false --diffsync\r\n```\r\n\r\n2. I can't say for sure, but it seems that it should be completely synchronized. Here is log from  `tail -f /home/geth/mainnet/bsc.log`: \r\n\r\n```\r\n\r\nt=2021-11-21T08:22:27+0100 lvl=eror msg=\"Snapshot extension registration failed\" peer=9c8d9aaf err=\"peer connected on snap without compatible eth support\"\r\nt=2021-11-21T08:22:28+0100 lvl=info msg=\"Imported new block headers\"             count=1    elapsed=\"186.589µs\" number=12,827,964 hash=0x015adaddad770c83281031a0c0dca3e17aed39ee2620ac487c052f3edc07ae38\r\nt=2021-11-21T08:22:29+0100 lvl=info msg=\"Imported new block headers\"             count=1    elapsed=\"208.147µs\" number=12,827,965 hash=0xed1b2494dc1dcfdcd936eccfcf2b9f00447bd8994c039bc48f3b6ce6adcf11dc\r\nt=2021-11-21T08:22:34+0100 lvl=info msg=\"Imported new block headers\"             count=2    elapsed=\"302.325µs\" number=12,827,967 hash=0x2aeae23dd0341ff4bc6e95364dfce19a9a8ad781478d407c8b652b80dee473f8\r\nt=2021-11-21T08:22:34+0100 lvl=info msg=\"State heal in progress\"                 accounts=43560@2.51MiB   slots=160,512@11.63MiB codes=2921@22.77MiB nodes=98,984,729@22.79GiB pending=86084\r\nt=2021-11-21T08:22:38+0100 lvl=info msg=\"Imported new block headers\"             count=1    elapsed=\"196.401µs\" number=12,827,968 hash=0xe23fa128649ccc783e63d71186081e28162e3bd6d6d071cc9e8b2863fb6168f2\r\nt=2021-11-21T08:22:41+0100 lvl=info msg=\"Imported new block headers\"             count=1    elapsed=\"379.502µs\" number=12,827,969 hash=0x4da37f07fe2eb35fb3db1bb096e603ee1822828377c5a3d1e34fd4b0bab095db\r\nt=2021-11-21T08:22:42+0100 lvl=info msg=\"State heal in progress\"                 accounts=43560@2.51MiB   slots=169,065@12.27MiB codes=2921@22.77MiB nodes=99,008,151@22.79GiB pending=80133\r\nt=2021-11-21T08:22:45+0100 lvl=info msg=\"Imported new block headers\"             count=1    elapsed=\"239.071µs\" number=12,827,970 hash=0xad366235b990877df41cb44837ae9d7e56efcb8943cebed608e10699cc1b5c1d\r\nt=2021-11-21T08:22:47+0100 lvl=eror msg=\"Snapshot extension registration failed\" peer=968fed87 err=\"peer connected on snap without compatible eth support\"\r\nt=2021-11-21T08:22:49+0100 lvl=info msg=\"Imported new block headers\"             count=1    elapsed=\"283.531µs\" number=12,827,971 hash=0x7f6999a2faeda18a87d647ecc216591e80f2f6abaa0790a4911b17a227130b7e\r\nt=2021-11-21T08:22:50+0100 lvl=info msg=\"State heal in progress\"                 accounts=43560@2.51MiB   slots=177,373@12.89MiB codes=2921@22.77MiB nodes=99,031,605@22.79GiB pending=79208\r\nt=2021-11-21T08:22:53+0100 lvl=info msg=\"Imported new block headers\"             count=2    elapsed=\"407.495µs\" number=12,827,973 hash=0x070e3e5df153f4a54063a2e0072d0ca0f3171107cc12c05462e3e149d4388316\r\nt=2021-11-21T08:22:56+0100 lvl=info msg=\"Imported new block headers\"             count=1    elapsed=\"205.154µs\" number=12,827,974 hash=0xc5c6742d2d472c33620d7f50954b995613338a7e82fee531a3611fcfb4a641f8\r\nt=2021-11-21T08:22:57+0100 lvl=info msg=\"Downloader queue stats\"                 receiptTasks=0    blockTasks=0    itemSize=\"713.16 KiB\" throttle=92\r\nt=2021-11-21T08:22:58+0100 lvl=info msg=\"State heal in progress\"                 accounts=43560@2.51MiB   slots=200,269@14.55MiB codes=2921@22.77MiB nodes=99,073,508@22.80GiB pending=69433\r\nt=2021-11-21T08:23:00+0100 lvl=info msg=\"Imported new block headers\"             count=1    elapsed=\"190.701µs\" number=12,827,975 hash=0x1bdc8d305e07fded805e58ea15e5b70574e020cc732658e35dc4b6e1f199da26\r\nt=2021-11-21T08:23:01+0100 lvl=info msg=\"Imported new block headers\"             count=1    elapsed=\"207.991µs\" number=12,827,976 hash=0xabd776546e2e06b06659713860423bc386a1f4d482ce4b04dda529afa7c5d142\r\nt=2021-11-21T08:23:05+0100 lvl=info msg=\"Imported new block headers\"             count=1    elapsed=\"275.947µs\" number=12,827,977 hash=0xb1f4e8bd6b929fdade61118052fee70c34cace61ae220717e21bf87a199e352c\r\nt=2021-11-21T08:23:06+0100 lvl=info msg=\"State heal in progress\"                 accounts=43560@2.51MiB   slots=204,695@14.86MiB codes=2921@22.77MiB nodes=99,090,703@22.80GiB pending=74850\r\nt=2021-11-21T08:23:08+0100 lvl=info msg=\"Imported new block headers\"             count=1    elapsed=\"201.384µs\" number=12,827,978 hash=0x7f202a77d91f32a914052626bca73899612ea1eca8f036887f1096986d32276c\r\nt=2021-11-21T08:23:12+0100 lvl=info msg=\"Imported new block headers\"             count=1    elapsed=\"334.951µs\" number=12,827,979 hash=0xa40e875a09e0f81bfacf80b99cfb860266fc25f7757da9f4b02c5ec541ddb239\r\nt=2021-11-21T08:23:14+0100 lvl=info msg=\"State heal in progress\"                 accounts=43560@2.51MiB   slots=214,562@15.54MiB codes=2921@22.77MiB nodes=99,116,317@22.81GiB pending=68705\r\nt=2021-11-21T08:23:16+0100 lvl=info msg=\"Imported new block headers\"             count=1    elapsed=\"235.803µs\" number=12,827,980 hash=0x355abc69a20347c3a78943a48a7365241d98cc093985456fbf5eeaf8c95feac5\r\nt=2021-11-21T08:23:16+0100 lvl=info msg=\"Imported new block headers\"             count=1    elapsed=\"179.303µs\" number=12,827,981 hash=0xe9dbd8eaa60de26daa1c3cbe51df247da1d0a8ad10122bbc4d774f241b63d4f8\r\nt=2021-11-21T08:23:21+0100 lvl=info msg=\"Imported new block headers\"             count=1    elapsed=\"202.442µs\" number=12,827,982 hash=0xe578d24c514648a741ccb4cc5be8d08b0a9fb08cc4fe2dae754afbd25a66215a\r\nt=2021-11-21T08:23:22+0100 lvl=info msg=\"State heal in progress\"                 accounts=43560@2.51MiB   slots=220,021@15.91MiB codes=2921@22.77MiB nodes=99,134,314@22.81GiB pending=68204\r\nt=2021-11-21T08:23:25+0100 lvl=info msg=\"Imported new block headers\"             count=2    elapsed=33.312ms    number=12,827,984 hash=0x2869380759013ebdac485c0d5483c9a5884a7c6ae6a10876305d7ee9570dfb95\r\nt=2021-11-21T08:23:31+0100 lvl=info msg=\"State heal in progress\"                 accounts=43560@2.51MiB   slots=226,319@16.36MiB codes=2921@22.77MiB nodes=99,155,048@22.82GiB pending=66858\r\nt=2021-11-21T08:23:31+0100 lvl=eror msg=\"Snapshot extension registration failed\" peer=70d956b8 err=\"peer connected on snap without compatible eth support\"\r\nt=2021-11-21T08:23:32+0100 lvl=info msg=\"Imported new block headers\"             count=2    elapsed=\"487.893µs\" number=12,827,986 hash=0x9bd9fa1fd4e2819b3f7453a6414be4eec34f03df4ede07a7a3f14598c2ccadd3\r\n```\r\n\r\n3. I successfully connect to ws, but in each type of subscribe (newBlockHeaders, pendingTransactions, syncing) no events except \"connected\" do not work. For example:\r\n\r\n```\r\nconst PROVIDER = new Web3.providers.WebsocketProvider('ws://localhost:8546');\r\nconst web3 = new Web3(PROVIDER)\r\n\r\nconst subscription = web3.eth.subscribe('newBlockHeaders', (err, res) => {\r\n  if (err) {\r\n    console.log('here1', err);\r\n  }\r\n  console.log('here2', res)\r\n});\r\n\r\nsubscription.on('error', error => {\r\n  console.log('here3', error)\r\n})\r\n\r\nsubscription.on('connected', () => {\r\n  console.log('here4', 'connected to ws') // <---- Only this is displayed\r\n})\r\n\r\nsubscription.on(\"changed\", function(){\r\n  console.log('here5')\r\n});\r\n  \r\nsubscription.on('data', (data) => {\r\n  console.log('here6', data)\r\n})\r\n\r\n```\r\nAnd after a short period of time (~ 5min) i got this output to console:\r\n\r\n```\r\n{ Error: CONNECTION ERROR: The connection got closed with the close code `1006` and the following reason string `Connection dropped by remote peer.`\r\n    at Object.ConnectionError (/home/geth/nft-bot/node_modules/web3-core-helpers/lib/errors.js:66:23)\r\n    at Object.ConnectionCloseError (/home/geth/nft-bot/node_modules/web3-core-helpers/lib/errors.js:53:25)\r\n    at /home/geth/nft-bot/node_modules/web3-core-requestmanager/lib/index.js:119:50\r\n    at Map.forEach (<anonymous>)\r\n    at WebsocketProvider.disconnect (/home/geth/nft-bot/node_modules/web3-core-requestmanager/lib/index.js:118:37)\r\n    at WebsocketProvider.emit (/home/geth/nft-bot/node_modules/eventemitter3/index.js:181:35)\r\n    at WebsocketProvider._onClose (/home/geth/nft-bot/node_modules/web3-providers-ws/lib/index.js:152:10)\r\n    at W3CWebSocket._dispatchEvent [as dispatchEvent] (/home/geth/nft-bot/node_modules/yaeti/lib/EventTarget.js:115:12)\r\n    at W3CWebSocket.onClose (/home/geth/nft-bot/node_modules/websocket/lib/W3CWebSocket.js:228:10)\r\n    at WebSocketConnection.<anonymous> (/home/geth/nft-bot/node_modules/websocket/lib/W3CWebSocket.js:201:17)\r\n    at WebSocketConnection.emit (events.js:198:13)\r\n    at WebSocketConnection.handleSocketClose (/home/geth/nft-bot/node_modules/websocket/lib/WebSocketConnection.js:389:14)\r\n    at Socket.emit (events.js:198:13)\r\n    at TCP._handle.close (net.js:607:12) code: 1006, reason: 'Connection dropped by remote peer.' }\r\n```\r\n\r\n\r\nPlease help me. I don't have any ideas how to fix it\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23943/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23943/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/975193760",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23943#issuecomment-975193760",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23943",
    "id": 975193760,
    "node_id": "IC_kwDOAOvK9846IEag",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-22T07:13:43Z",
    "updated_at": "2021-11-22T07:13:43Z",
    "author_association": "MEMBER",
    "body": "You are not is sync.\r\n\r\n`\"State heal in progress\"                 accounts=43560@2.51MiB   slots=226,319@16.36MiB codes=2921@22.77MiB nodes=99,155,048@22.82GiB pending=66858`\r\n\r\nYou need to wait it out until it starts importing blocks (it will tell you that state heal finished).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/975193760/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
