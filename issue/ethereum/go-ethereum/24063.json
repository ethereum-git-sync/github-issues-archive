{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24063",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24063/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24063/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24063/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/24063",
  "id": 1071856049,
  "node_id": "I_kwDOAOvK984_4zmx",
  "number": 24063,
  "title": "Is there a way to get a partial archived node?",
  "user": {
    "login": "TonyHzr",
    "id": 37975300,
    "node_id": "MDQ6VXNlcjM3OTc1MzAw",
    "avatar_url": "https://avatars.githubusercontent.com/u/37975300?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/TonyHzr",
    "html_url": "https://github.com/TonyHzr",
    "followers_url": "https://api.github.com/users/TonyHzr/followers",
    "following_url": "https://api.github.com/users/TonyHzr/following{/other_user}",
    "gists_url": "https://api.github.com/users/TonyHzr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/TonyHzr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/TonyHzr/subscriptions",
    "organizations_url": "https://api.github.com/users/TonyHzr/orgs",
    "repos_url": "https://api.github.com/users/TonyHzr/repos",
    "events_url": "https://api.github.com/users/TonyHzr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/TonyHzr/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 268304226,
      "node_id": "MDU6TGFiZWwyNjgzMDQyMjY=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:docs",
      "name": "type:docs",
      "color": "fef2c0",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 8,
  "created_at": "2021-12-06T08:17:29Z",
  "updated_at": "2023-01-09T21:12:44Z",
  "closed_at": "2021-12-06T08:49:40Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hello, I want to analyze the data on Ethereum, which may require a archived node. But in fact, I only care about the blocks after 8,000,000  blocks height. \r\n\r\nSo is there any way to directly request the world state at that height and get a partial archived node?",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24063/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24063/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/986560623",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24063#issuecomment-986560623",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24063",
    "id": 986560623,
    "node_id": "IC_kwDOAOvK9846zbhv",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-06T08:49:40Z",
    "updated_at": "2021-12-06T08:49:40Z",
    "author_association": "MEMBER",
    "body": "The closest way to do that is to sync `syncmode=full` from genesis. Once you reach `8M`, you need to stop the node, and then use `gcmode=archive`. That will make it so that you will prune most of the data up to 8M, but from 8M onwards you will have every state. \r\n\r\nIt is theoretically possible to do a snap-sync to block 8M, but it would require that you modify geth to target a particular block (and not move the pivot along the way), and it would also require that you find an archive node which has that state available, which is very _very_ unlikely. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/986560623/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/986561572",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24063#issuecomment-986561572",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24063",
    "id": 986561572,
    "node_id": "IC_kwDOAOvK9846zbwk",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-06T08:51:00Z",
    "updated_at": "2021-12-06T08:51:00Z",
    "author_association": "MEMBER",
    "body": "Follow-up: you only need an archive node if you are really interested in the 'state' data, e.g. balances and storage at certain heights. If you're only interested in the block data (transactions / receipts / headers etc) , a regular node would suffice.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/986561572/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1375196899",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24063#issuecomment-1375196899",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24063",
    "id": 1375196899,
    "node_id": "IC_kwDOAOvK985R99bj",
    "user": {
      "login": "martinboehm",
      "id": 11609674,
      "node_id": "MDQ6VXNlcjExNjA5Njc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/11609674?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/martinboehm",
      "html_url": "https://github.com/martinboehm",
      "followers_url": "https://api.github.com/users/martinboehm/followers",
      "following_url": "https://api.github.com/users/martinboehm/following{/other_user}",
      "gists_url": "https://api.github.com/users/martinboehm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/martinboehm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/martinboehm/subscriptions",
      "organizations_url": "https://api.github.com/users/martinboehm/orgs",
      "repos_url": "https://api.github.com/users/martinboehm/repos",
      "events_url": "https://api.github.com/users/martinboehm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/martinboehm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-09T07:17:32Z",
    "updated_at": "2023-01-09T07:17:32Z",
    "author_association": "NONE",
    "body": "@holiman Hi, we have an archive node, which we use to fetch internal transactions. After the internal transactions are processed, the archive data are not interesting for us. To save the disk space (and also time), we would like to do the following:\r\n\r\n1. fully sync archive node and process the internal transactions up to the last block\r\n2. delete the geth database, keep only the ancient folder\r\n3. let the DB sync from the ancient, still using archive mode (or possibly only full mode, I am not sure)\r\n4. after the sync is finished, switch to archive mode (if not already in it) and keep processing new internal transactions\r\n\r\nAfter the DB grows again to too large size, repeat.\r\n\r\nIs this scenario feasible? Are there some issues with it?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1375196899/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1375301812",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24063#issuecomment-1375301812",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24063",
    "id": 1375301812,
    "node_id": "IC_kwDOAOvK985R-XC0",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-09T09:08:58Z",
    "updated_at": "2023-01-09T09:08:58Z",
    "author_association": "MEMBER",
    "body": "@martinboehm that doesn't make sense to me. \r\n\r\n\r\n\r\n> 1.  fully sync archive node and process the internal transactions up to the last block\r\n\r\nOk, so while doing this, you can process internal transactions. You don't actually need the state for block `5` while you process block `13M`, so you don't actually _need_ archive, if you instead process while you import each block. \r\n\r\n> 2.     delete the geth database, keep only the ancient folder\r\n\r\nOk, save the block data, nuke the state. \r\n\r\n> 3.  let the DB sync from the ancient, still using archive mode (or possibly only full mode, I am not sure)\r\n\r\nThis means doing a new (archive-) sync from genesis. I see no point in doing this. After doing this, you're back at point one. You're probably better off doing a snap-sync at this point, if you don't want old state-data to be present. \r\n\r\n> 4.   after the sync is finished, switch to archive mode (if not already in it) and keep processing new internal transactions\r\n\r\nAgain, you can just process these in lock-step with the import. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1375301812/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1375995092",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24063#issuecomment-1375995092",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24063",
    "id": 1375995092,
    "node_id": "IC_kwDOAOvK985SBATU",
    "user": {
      "login": "martinboehm",
      "id": 11609674,
      "node_id": "MDQ6VXNlcjExNjA5Njc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/11609674?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/martinboehm",
      "html_url": "https://github.com/martinboehm",
      "followers_url": "https://api.github.com/users/martinboehm/followers",
      "following_url": "https://api.github.com/users/martinboehm/following{/other_user}",
      "gists_url": "https://api.github.com/users/martinboehm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/martinboehm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/martinboehm/subscriptions",
      "organizations_url": "https://api.github.com/users/martinboehm/orgs",
      "repos_url": "https://api.github.com/users/martinboehm/repos",
      "events_url": "https://api.github.com/users/martinboehm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/martinboehm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-09T17:30:09Z",
    "updated_at": "2023-01-09T17:30:09Z",
    "author_association": "NONE",
    "body": "@holiman Thank you for a fast answer!\r\nMaybe I will explain a bit more. We are currently at the point 1 - we have fully synced archive mode, which takes about 13T of disk space. And as you wrote here https://github.com/ethereum/go-ethereum/issues/24063#issuecomment-986560623, we could create a second instance in full mode, synchronize it up to certain point and then turn on archive mode. This way we would have a node which would contain archive data only from certain moment, i.e. the DB would be a lot smaller. \r\nTo use the ancient data is only a way how to speed-up the process of the initial sync. \r\n\r\nThe question is if something would be missing from the DB if we restore it in snap-sync or full mode using ancient data? We need transaction data, transaction logs but not the debug info.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1375995092/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1376040555",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24063#issuecomment-1376040555",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24063",
    "id": 1376040555,
    "node_id": "IC_kwDOAOvK985SBLZr",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-09T18:07:49Z",
    "updated_at": "2023-01-09T18:07:49Z",
    "author_association": "MEMBER",
    "body": "> The question is if something would be missing from the DB if we restore it in snap-sync or full mode using ancient data? We need transaction data, transaction logs but not the debug info.\r\n\r\nAncient data is only block data. If you \"sync from ancient data\", the only possible sync is block by block import.\r\n\r\nHowever, if you do a `snap` sync, you can still \"make use of\" your ancient data, simply by making it available to geth. Then geth will avoid downloading ~500GB of data from the network (but the the state is still downloaded from the network). \r\n\r\n\r\nIf you want to partition your nodes have different \"epochs\" of responsibility, then snap-sync is not very useful for you: a snap-sync can only sync to \"now\" -- since only recent state is available on the network. So it's not possible to snap-sync to e.g. block 10M. So that kind of forces you to use block-by-block sync...\r\n\r\n... although, technically that's not really true. It would be possible (but not trivial) to make it so that you snap-sync off your own archive node, which _can_ serve the historic state you are interested in. So theoretically, your node 2 could sync to \"state at 10M\" off the archive node, and then it could import `1M` blocks in archive mode, and you'd have a node which is \"archive from 10M to 11M\". But that requires a bit of programming to pull off \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1376040555/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1376286411",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24063#issuecomment-1376286411",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24063",
    "id": 1376286411,
    "node_id": "IC_kwDOAOvK985SCHbL",
    "user": {
      "login": "martinboehm",
      "id": 11609674,
      "node_id": "MDQ6VXNlcjExNjA5Njc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/11609674?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/martinboehm",
      "html_url": "https://github.com/martinboehm",
      "followers_url": "https://api.github.com/users/martinboehm/followers",
      "following_url": "https://api.github.com/users/martinboehm/following{/other_user}",
      "gists_url": "https://api.github.com/users/martinboehm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/martinboehm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/martinboehm/subscriptions",
      "organizations_url": "https://api.github.com/users/martinboehm/orgs",
      "repos_url": "https://api.github.com/users/martinboehm/repos",
      "events_url": "https://api.github.com/users/martinboehm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/martinboehm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-09T20:39:17Z",
    "updated_at": "2023-01-09T20:39:17Z",
    "author_association": "NONE",
    "body": "It would be OK for us to do `snap sync` to \"now\", if we could afterwards switch to `archive` mode. Is it possible?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1376286411/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1376301280",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24063#issuecomment-1376301280",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24063",
    "id": 1376301280,
    "node_id": "IC_kwDOAOvK985SCLDg",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-09T20:55:04Z",
    "updated_at": "2023-01-09T20:55:04Z",
    "author_association": "MEMBER",
    "body": "Yes it is perfectly possible. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1376301280/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
