{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26091",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26091/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26091/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26091/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/26091",
  "id": 1433280553,
  "node_id": "I_kwDOAOvK985VbiAp",
  "number": 26091,
  "title": "Geth missing blocks, rewind goes to genesis instead of last good block",
  "user": {
    "login": "caseybrown89",
    "id": 1410742,
    "node_id": "MDQ6VXNlcjE0MTA3NDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1410742?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/caseybrown89",
    "html_url": "https://github.com/caseybrown89",
    "followers_url": "https://api.github.com/users/caseybrown89/followers",
    "following_url": "https://api.github.com/users/caseybrown89/following{/other_user}",
    "gists_url": "https://api.github.com/users/caseybrown89/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/caseybrown89/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/caseybrown89/subscriptions",
    "organizations_url": "https://api.github.com/users/caseybrown89/orgs",
    "repos_url": "https://api.github.com/users/caseybrown89/repos",
    "events_url": "https://api.github.com/users/caseybrown89/events{/privacy}",
    "received_events_url": "https://api.github.com/users/caseybrown89/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-11-02T14:48:24Z",
  "updated_at": "2022-11-03T14:51:01Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version:\r\n```\r\n/ # geth version\r\nGeth\r\nVersion: 1.11.0-unstable\r\nGit Commit: 468d1844c7a32b51eebce6c5f35c44a66b9acf64\r\nGit Commit Date: 20220919\r\nArchitecture: amd64\r\nGo Version: go1.18.6\r\nOperating System: linux\r\nGOPATH=\r\nGOROOT=go\r\n```\r\nCL client & version: `gcr.io/prysmaticlabs/prysm/beacon-chain:v3.1.0`\r\n\r\nOS & Version:\r\n\r\n```\r\nuname -a\r\nLinux geth-mainnet-eth-etl-0 5.4.209-116.367.amzn2.x86_64 #1 SMP Wed Aug 31 00:09:52 UTC 2022 x86_64 Linux\r\n```\r\n\r\nCommit hash : `468d1844c7a32b51eebce6c5f35c44a66b9acf64`\r\n\r\n#### Expected behaviour\r\n\r\nOver the past couple of months I have been running/syncing a `--syncmode=full` Geth node on EKS.  Recently I was looking at block data and noticed that I am missing data for block 15,012,712 through 15,012,866. I'm not sure how this happened. There have been some unclean shutdowns of Geth in the past but I don't think these took place around the time those blocks were synced.\r\n\r\nMissing blocks:\r\n```bash\r\ncurl -s -X POST -H 'Content-Type: application/json' -d '{\"jsonrpc\":\"2.0\",\"method\":\"eth_getBlockByNumber\",\"params\":[\"0xe51367\",true],\"id\":1}' 10.0.143.11:8545 | jq .'result'.'hash'\r\n\"0x78db5823c2610aed6b73c28fbc05f4d7b6948787bad33f92c81776bc424f3524\"\r\ncurl -s -X POST -H 'Content-Type: application/json' -d '{\"jsonrpc\":\"2.0\",\"method\":\"eth_getBlockByNumber\",\"params\":[\"0xe51368\",true],\"id\":1}' 10.0.143.11:8545 | jq .'result'.'hash'\r\nnull\r\ncurl -s -X POST -H 'Content-Type: application/json' -d '{\"jsonrpc\":\"2.0\",\"method\":\"eth_getBlockByNumber\",\"params\":[\"0xe513b5\",true],\"id\":1}' 10.0.143.11:8545 | jq .'result'.'hash'\r\nnull\r\ncurl -s -X POST -H 'Content-Type: application/json' -d '{\"jsonrpc\":\"2.0\",\"method\":\"eth_getBlockByNumber\",\"params\":[\"0xe51402\",true],\"id\":1}' 10.0.143.11:8545 | jq .'result'.'hash'\r\nnull\r\ncurl -s -X POST -H 'Content-Type: application/json' -d '{\"jsonrpc\":\"2.0\",\"method\":\"eth_getBlockByNumber\",\"params\":[\"0xe51403\",true],\"id\":1}' 10.0.143.11:8545 | jq .'result'.'hash'\r\n\"0x238e84b4a80403b1425b6dc1e45dd67456dea30e9e84b84b19130ae4eab03fe4\"\r\n```\r\n\r\nThe log doesn't output anything when I make getBlock calls for missing blocks. It does output some info when trying to get the logs for those blocks:\r\n\r\n```bash\r\ncurl -s -X POST -H 'Content-Type: application/json' -d '{\"jsonrpc\":\"2.0\",\"method\":\"eth_getLogs\",\"params\":[{\"fromBlock\":\"0xe51368\",\"toBlock\":\"0xe51368\"}],\"id\":1}' 10.0.143.11:8545\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"error\":{\"code\":-32000,\"message\":\"failed to get logs for block #15012712 (0x64940d..45c4aa)\"}}\r\n...\r\nERROR[11-02|14:36:01.487] Missing body but have receipt            hash=64940d..45c4aa number=15,012,712\r\nWARN [11-02|14:36:01.490] Served eth_getLogs                       conn=10.0.15.200:58362 reqid=1 duration=6.981005ms err=\"failed to get logs for block #15012712 (0x64940d..45c4aa)\"\r\n```\r\n\r\nIn an attempt to get data for those blocks, I looked for possible ways to fill in the gap. That didn't seem possible so I opted to \"rewind\" back to the point of the first missing block and then resync from there forward. To do this, I did the following:\r\n\r\n- Restart Geth with `--maxpeers=0`\r\n- Restart Prysm with `--no-discovery`\r\n- Rewind to the block via\r\n```\r\n/ # geth attach /data/geth.ipc\r\nWelcome to the Geth JavaScript console!\r\n\r\ninstance: Geth/v1.11.0-unstable-468d1844-20220919/linux-amd64/go1.18.6\r\ncoinbase: 0xb2e19d23405f1b16a86c0d1ad4110e59357bd47c\r\nat block: 15870557 (Mon Oct 31 2022 20:54:35 GMT+0000 (UTC))\r\n datadir: /data\r\n modules: admin:1.0 debug:1.0 engine:1.0 eth:1.0 ethash:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 txpool:1.0 web3:1.0\r\n\r\nTo exit, press ctrl-d or type exit\r\n> debug.setHead('0xe51368')\r\n```\r\n\r\nAt this point, I expected Geth to slowly make its way back to block 15,012,712. I'd then undo the peer/discovery changes and start syncing again.\r\n\r\n#### Actual behaviour\r\n\r\nThe `setHead` command ran for a few hours before this appeared in the log:\r\n\r\n```\r\nERROR[11-01|19:28:24.906] Missing block in the middle, aiming genesis number=15,012,866 hash=096e67..35c886\r\nWARN [11-01|19:28:24.908] Force rewinding till ancient limit       head=0\r\n```\r\nhttps://github.com/ethereum/go-ethereum/blob/2415911f5366059d739a36b24e79e99d3b5901ed/core/blockchain.go#L608-L609\r\n\r\nAfter that, disk continued to slowly free up and then stopped when the setHead command returned with `null`. In total, disk usage went from something like 2.1TB on disk to 1.6TB. At that point, I restarted  Geth with peers and resyncs began from block 0. The sync does appear to be going fast-ish as it has made its way to 4MM and change ~12 hours later, but it is showing signs of slowing down.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nHard to reproduce. I have EBS snapshots I could offer.\r\n\r\n#### Backtrace\r\n\r\nRestarting Geth, executing `setHead` command and waiting, and restarting Geth:\r\n\r\n```\r\n> debug.setHead('0xe51368')\r\n```\r\n...\r\n````\r\nINFO [11-01|17:45:55.792] Starting Geth on Ethereum mainnet...\r\nINFO [11-01|17:45:55.792] Bumping default cache on mainnet         provided=1024 updated=4096\r\nINFO [11-01|17:45:55.792] Enabling metrics collection\r\nINFO [11-01|17:45:55.792] Enabling stand-alone metrics HTTP endpoint address=0.0.0.0:6060\r\nINFO [11-01|17:45:55.792] Starting metrics server                  addr=http://0.0.0.0:6060/debug/metrics\r\nINFO [11-01|17:45:55.793] Maximum peer count                       ETH=0 LES=0 total=0\r\nINFO [11-01|17:45:55.794] Smartcard socket not found, disabling    err=\"stat /run/pcscd/pcscd.comm: no such file or directory\"\r\nINFO [11-01|17:45:56.547] Set global gas cap                       cap=50,000,000\r\nINFO [11-01|17:45:56.558] Allocated trie memory caches             clean=614.00MiB dirty=1024.00MiB\r\nINFO [11-01|17:45:56.558] Allocated cache and file handles         database=/data/geth/chaindata cache=2.00GiB handles=524,288\r\nINFO [11-01|17:48:21.145] Found legacy ancient chain path          location=/data/geth/chaindata/ancient\r\nINFO [11-01|17:48:23.265] Opened ancient database                  database=/data/geth/chaindata/ancient readonly=false\r\nINFO [11-01|17:49:16.568] Disk storage enabled for ethash caches   dir=/data/geth/ethash count=3\r\nINFO [11-01|17:49:16.568] Disk storage enabled for ethash DAGs     dir=/root/.ethash     count=2\r\nINFO [11-01|17:49:18.138] Initialising Ethereum protocol           network=1 dbversion=8\r\nINFO [11-01|17:49:18.635]\r\nINFO [11-01|17:49:18.635] ---------------------------------------------------------------------------------------------------------------------------------------------------------\r\nINFO [11-01|17:49:18.635] Chain ID:  1 (mainnet)\r\nINFO [11-01|17:49:18.635] Consensus: Beacon (proof-of-stake), merged from Ethash (proof-of-work)\r\nINFO [11-01|17:49:18.635]\r\nINFO [11-01|17:49:18.635] Pre-Merge hard forks:\r\nINFO [11-01|17:49:18.635]  - Homestead:                   1150000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/homestead.md)\r\nINFO [11-01|17:49:18.635]  - DAO Fork:                    1920000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/dao-fork.md)\r\nINFO [11-01|17:49:18.635]  - Tangerine Whistle (EIP 150): 2463000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/tangerine-whistle.md)\r\nINFO [11-01|17:49:18.635]  - Spurious Dragon/1 (EIP 155): 2675000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/spurious-dragon.md)\r\nINFO [11-01|17:49:18.635]  - Spurious Dragon/2 (EIP 158): 2675000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/spurious-dragon.md)\r\nINFO [11-01|17:49:18.635]  - Byzantium:                   4370000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/byzantium.md)\r\nINFO [11-01|17:49:18.635]  - Constantinople:              7280000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/constantinople.md)\r\nINFO [11-01|17:49:18.635]  - Petersburg:                  7280000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/petersburg.md)\r\nINFO [11-01|17:49:18.635]  - Istanbul:                    9069000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/istanbul.md)\r\nINFO [11-01|17:49:18.635]  - Muir Glacier:                9200000  (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/muir-glacier.md)\r\nINFO [11-01|17:49:18.635]  - Berlin:                      12244000 (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/berlin.md)\r\nINFO [11-01|17:49:18.635]  - London:                      12965000 (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/london.md)\r\nINFO [11-01|17:49:18.635]  - Arrow Glacier:               13773000 (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/arrow-glacier.md)\r\nINFO [11-01|17:49:18.635]  - Gray Glacier:                15050000 (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/gray-glacier.md)\r\nINFO [11-01|17:49:18.635]\r\nINFO [11-01|17:49:18.635] Merge configured:\r\nINFO [11-01|17:49:18.635]  - Hard-fork specification:    https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/paris.md\r\nINFO [11-01|17:49:18.635]  - Network known to be merged: true\r\nINFO [11-01|17:49:18.635]  - Total terminal difficulty:  58750000000000000000000\r\nINFO [11-01|17:49:18.635]  - Merge netsplit block:       <nil>\r\nINFO [11-01|17:49:18.635] ---------------------------------------------------------------------------------------------------------------------------------------------------------\r\nINFO [11-01|17:49:18.635]\r\nINFO [11-01|17:49:42.672] Loaded most recent local header          number=15,870,557 hash=fe10e0..9522fa td=58,750,003,716,598,352,816,469 age=20h55m7s\r\nINFO [11-01|17:49:42.672] Loaded most recent local full block      number=15,870,557 hash=fe10e0..9522fa td=58,750,003,716,598,352,816,469 age=20h55m7s\r\nINFO [11-01|17:49:42.672] Loaded most recent local fast block      number=15,870,557 hash=fe10e0..9522fa td=58,750,003,716,598,352,816,469 age=20h55m7s\r\nINFO [11-01|17:49:42.672] Loaded most recent local finalized block number=15,870,479 hash=ef0b8f..72beec td=58,750,003,716,598,352,816,469 age=21h10m55s\r\nINFO [11-01|17:49:47.839] Loaded local transaction journal         transactions=0 dropped=0\r\nINFO [11-01|17:49:47.839] Regenerated local transaction journal    transactions=0 accounts=0\r\nINFO [11-01|17:49:47.839] Chain post-merge, sync via beacon client\r\nINFO [11-01|17:49:47.839] Gasprice oracle is ignoring threshold set threshold=2\r\nWARN [11-01|17:49:48.116] Unclean shutdown detected                booted=2022-08-23T03:36:13+0000 age=2mo1w3d\r\nWARN [11-01|17:49:48.116] Unclean shutdown detected                booted=2022-09-01T07:09:01+0000 age=2mo1d10h\r\nWARN [11-01|17:49:48.116] Unclean shutdown detected                booted=2022-09-02T09:25:55+0000 age=2mo8h23m\r\nWARN [11-01|17:49:48.116] Unclean shutdown detected                booted=2022-09-16T13:32:44+0000 age=1mo2w2d\r\nWARN [11-01|17:49:48.116] Engine API enabled                       protocol=eth\r\nINFO [11-01|17:49:48.228] Starting peer-to-peer node               instance=Geth/v1.11.0-unstable-468d1844-20220919/linux-amd64/go1.18.6\r\nINFO [11-01|17:49:50.076] New local node record                    seq=1,660,867,625,814 id=05c8f483ed1db120 ip=127.0.0.1 udp=30303 tcp=30303\r\nINFO [11-01|17:49:50.076] Started P2P networking                   self=enode://daecb556c75b8d70d7dc5c513450456517bb543704bbf81104136c5e6f8d65467478ee81508d24a666e301597decf5106a5ceea7e85161068aea907999056bc3@127.0\r\n.0.1:30303\r\nINFO [11-01|17:49:50.078] IPC endpoint opened                      url=/data/geth.ipc\r\nINFO [11-01|17:49:50.078] Loaded JWT secret file                   path=/etc/keys/jwt.hex crc32=0xcbc83b4b\r\nINFO [11-01|17:49:50.078] HTTP server started                      endpoint=[::]:8545 auth=false prefix= cors= vhosts=geth-node-mainnet-full\r\nINFO [11-01|17:49:50.078] WebSocket enabled                        url=ws://[::]:8546\r\nINFO [11-01|17:49:50.078] WebSocket enabled                        url=ws://127.0.0.1:8551\r\nINFO [11-01|17:49:50.078] HTTP server started                      endpoint=127.0.0.1:8551 auth=true  prefix= cors=localhost vhosts=localhost\r\nWARN [11-01|17:50:11.218] Served eth_getLogs                       conn=127.0.0.1:46290 reqid=11 duration=6.643932208s err=\"context canceled\"\r\nWARN [11-01|17:50:23.118] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|17:50:31.910] Served eth_getLogs                       conn=127.0.0.1:46300 reqid=4  duration=6.332393546s err=\"context canceled\"\r\nWARN [11-01|17:52:05.027] Served eth_getLogs                       conn=127.0.0.1:45744 reqid=12 duration=6.195762619s err=\"context canceled\"\r\nWARN [11-01|17:52:25.943] Served eth_getLogs                       conn=127.0.0.1:57224 reqid=4  duration=6.107904275s err=\"context canceled\"\r\nWARN [11-01|17:52:48.240] Served eth_getLogs                       conn=127.0.0.1:51644 reqid=6  duration=6.096511163s err=\"context canceled\"\r\nWARN [11-01|17:53:14.599] Served eth_getLogs                       conn=127.0.0.1:43208 reqid=5  duration=6.008904903s err=\"context canceled\"\r\nINFO [11-01|17:53:29.053] Etherbase automatically configured       address=0xb2E19D23405F1B16a86c0D1AD4110e59357Bd47C\r\nWARN [11-01|17:53:33.609] Rewinding blockchain                     target=15,012,712\r\nWARN [11-01|17:53:39.319] Served eth_getLogs                       conn=127.0.0.1:57658 reqid=6  duration=6.209518539s err=\"context canceled\"\r\nWARN [11-01|17:54:03.249] Served eth_getLogs                       conn=127.0.0.1:50960 reqid=9  duration=6.151890567s err=\"context canceled\"\r\nWARN [11-01|17:54:24.700] Served eth_getLogs                       conn=127.0.0.1:60942 reqid=5  duration=6.310364947s err=\"context canceled\"\r\nWARN [11-01|17:54:49.357] Served eth_getLogs                       conn=127.0.0.1:38786 reqid=12 duration=6.306824584s err=\"context canceled\"\r\nWARN [11-01|17:55:23.151] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|18:00:23.185] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|18:05:23.220] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|18:10:23.254] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|18:15:23.290] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|18:20:23.322] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|18:25:23.358] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|18:30:23.389] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|18:35:23.419] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|18:40:23.452] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|18:45:23.486] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nINFO [11-01|18:49:47.839] Writing clean trie cache to disk         path=/data/geth/triecache threads=1\r\nINFO [11-01|18:49:47.840] Regenerated local transaction journal    transactions=0 accounts=0\r\nINFO [11-01|18:49:48.286] Persisted the clean trie cache           path=/data/geth/triecache elapsed=447.330ms\r\nWARN [11-01|18:50:23.520] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|18:55:23.565] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|19:00:23.621] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|19:05:23.710] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|19:10:23.757] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|19:15:23.811] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|19:20:23.900] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|19:25:23.998] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nERROR[11-01|19:28:24.906] Missing block in the middle, aiming genesis number=15,012,866 hash=096e67..35c886\r\nWARN [11-01|19:28:24.908] Force rewinding till ancient limit       head=0\r\nWARN [11-01|19:30:24.049] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|19:35:24.125] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|19:40:24.175] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|19:45:24.261] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nINFO [11-01|19:49:47.857] Writing clean trie cache to disk         path=/data/geth/triecache threads=1\r\nINFO [11-01|19:49:47.858] Regenerated local transaction journal    transactions=0 accounts=0\r\nINFO [11-01|19:49:48.535] Persisted the clean trie cache           path=/data/geth/triecache elapsed=677.190ms\r\nWARN [11-01|19:50:24.352] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|19:55:24.471] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|20:00:24.556] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|20:05:24.620] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|20:10:24.729] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|20:15:24.870] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|20:20:24.953] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|20:25:25.026] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|20:30:25.093] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|20:35:25.198] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|20:40:25.363] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|20:45:25.434] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nINFO [11-01|20:49:47.839] Writing clean trie cache to disk         path=/data/geth/triecache threads=1\r\nINFO [11-01|20:49:47.860] Regenerated local transaction journal    transactions=0 accounts=0\r\nINFO [11-01|20:49:48.478] Persisted the clean trie cache           path=/data/geth/triecache elapsed=629.699ms\r\nWARN [11-01|20:50:25.543] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|20:55:25.622] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|21:00:25.697] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|21:05:25.838] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|21:10:25.971] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|21:15:26.113] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|21:20:26.197] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|21:25:26.325] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|21:30:26.492] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|21:35:26.630] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|21:40:26.730] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|21:45:26.907] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nINFO [11-01|21:49:47.843] Writing clean trie cache to disk         path=/data/geth/triecache threads=1\r\nINFO [11-01|21:49:47.844] Regenerated local transaction journal    transactions=0 accounts=0\r\nINFO [11-01|21:49:48.471] Persisted the clean trie cache           path=/data/geth/triecache elapsed=627.806ms\r\nWARN [11-01|21:50:27.008] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|21:55:27.179] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|22:00:27.300] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|22:05:27.418] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|22:10:27.518] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|22:15:27.583] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|22:20:27.686] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|22:25:27.859] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|22:30:28.085] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|22:35:28.249] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|22:40:28.452] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|22:45:28.572] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nINFO [11-01|22:49:47.841] Regenerated local transaction journal    transactions=0 accounts=0\r\nINFO [11-01|22:49:47.841] Writing clean trie cache to disk         path=/data/geth/triecache threads=1\r\nINFO [11-01|22:49:48.619] Persisted the clean trie cache           path=/data/geth/triecache elapsed=776.983ms\r\nWARN [11-01|22:50:28.785] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|22:55:28.918] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|23:00:29.101] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|23:05:29.236] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|23:10:29.393] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|23:15:29.619] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|23:20:29.829] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|23:25:30.004] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|23:30:30.153] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|23:35:30.339] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|23:40:30.570] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|23:45:30.752] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nINFO [11-01|23:49:47.851] Writing clean trie cache to disk         path=/data/geth/triecache threads=1\r\nINFO [11-01|23:49:47.851] Regenerated local transaction journal    transactions=0 accounts=0\r\nINFO [11-01|23:49:48.662] Persisted the clean trie cache           path=/data/geth/triecache elapsed=810.500ms\r\nWARN [11-01|23:50:30.926] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-01|23:55:31.157] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-02|00:00:31.433] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-02|00:05:31.654] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-02|00:10:31.904] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-02|00:15:32.076] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-02|00:16:04.879] SetHead invalidated safe block\r\nINFO [11-02|00:16:04.997] Loaded most recent local header          number=0          hash=d4e567..cb8fa3 td=17,179,869,184                 age=53y7mo1w\r\nINFO [11-02|00:16:04.997] Loaded most recent local full block      number=0          hash=d4e567..cb8fa3 td=17,179,869,184                 age=53y7mo1w\r\nINFO [11-02|00:16:04.997] Loaded most recent local fast block      number=0          hash=d4e567..cb8fa3 td=17,179,869,184                 age=53y7mo1w\r\nWARN [11-02|00:20:32.116] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-02|00:25:32.151] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nWARN [11-02|00:30:32.188] Beacon client online, but never received consensus updates. Please ensure your beacon client is operational to follow the chain!\r\nINFO [11-02|00:32:48.505] Got interrupt, shutting down...\r\nINFO [11-02|00:32:48.507] HTTP server stopped                      endpoint=[::]:8545\r\nINFO [11-02|00:32:48.508] HTTP server stopped                      endpoint=[::]:8546\r\nINFO [11-02|00:32:48.509] HTTP server stopped                      endpoint=127.0.0.1:8551\r\nINFO [11-02|00:32:48.510] IPC endpoint closed                      url=/data/geth.ipc\r\nINFO [11-02|00:32:48.511] Ethereum protocol stopped\r\nINFO [11-02|00:32:48.511] Transaction pool stopped\r\nERROR[11-02|00:32:48.512] Failed to journal state snapshot         err=\"snapshot [0xd7f8974fb5ac78d9ac099b9ad5018bedc2ce0a72dad1827a1709da30580f0544] missing\"\r\nINFO [11-02|00:32:48.513] Writing clean trie cache to disk         path=/data/geth/triecache threads=8\r\nINFO [11-02|00:32:48.610] Persisted the clean trie cache           path=/data/geth/triecache elapsed=97.372ms\r\nINFO [11-02|00:32:48.611] Blockchain stopped\r\n````\r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26091/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26091/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1301596780",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26091#issuecomment-1301596780",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26091",
    "id": 1301596780,
    "node_id": "IC_kwDOAOvK985NlMps",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-03T03:15:56Z",
    "updated_at": "2022-11-03T03:15:56Z",
    "author_association": "MEMBER",
    "body": "Sorry for it, it's a logic in Geth that if some blocks are missing in between then we can't simply find the parent block and thus interrupt the rewinding. It's expected behavior.\r\n\r\nWe should investigate why the block bodies will be missing in the first place.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1301596780/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1302230603",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26091#issuecomment-1302230603",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26091",
    "id": 1302230603,
    "node_id": "IC_kwDOAOvK985NnnZL",
    "user": {
      "login": "caseybrown89",
      "id": 1410742,
      "node_id": "MDQ6VXNlcjE0MTA3NDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1410742?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/caseybrown89",
      "html_url": "https://github.com/caseybrown89",
      "followers_url": "https://api.github.com/users/caseybrown89/followers",
      "following_url": "https://api.github.com/users/caseybrown89/following{/other_user}",
      "gists_url": "https://api.github.com/users/caseybrown89/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/caseybrown89/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/caseybrown89/subscriptions",
      "organizations_url": "https://api.github.com/users/caseybrown89/orgs",
      "repos_url": "https://api.github.com/users/caseybrown89/repos",
      "events_url": "https://api.github.com/users/caseybrown89/events{/privacy}",
      "received_events_url": "https://api.github.com/users/caseybrown89/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-03T14:51:00Z",
    "updated_at": "2022-11-03T14:51:00Z",
    "author_association": "NONE",
    "body": "thanks @rjl493456442!\r\n\r\n>Sorry for it, it's a logic in Geth that if some blocks are missing in between then we can't simply find the parent block and thus interrupt the rewinding. It's expected behavior.\r\n\r\nI understand this is the way it was written. I don't understand why it needs to be this way though, if there is a last known \"good\" block, or even Geth could search for that itself. If at the end of the day the data can no longer be trusted, each block could probably be verified which would probably be faster than resyncing? Maybe something for the future.\r\n\r\n> We should investigate why the block bodies will be missing in the first place.\r\n\r\nIf I can provide anything here, please let me know.\r\n\r\nGiven that ~1.6TB of space was still persisted after the going back to 0, does that mean the resync is using some local data and is repopulating faster? Or it will all be overwritten as data comes in from peers?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1302230603/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
