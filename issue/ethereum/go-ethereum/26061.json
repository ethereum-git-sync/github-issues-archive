{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26061",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26061/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26061/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26061/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/26061",
  "id": 1427525338,
  "node_id": "I_kwDOAOvK985VFk7a",
  "number": 26061,
  "title": "Feature request: Command line flag to stop client before running out of disk space",
  "user": {
    "login": "dankrad",
    "id": 6130607,
    "node_id": "MDQ6VXNlcjYxMzA2MDc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6130607?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dankrad",
    "html_url": "https://github.com/dankrad",
    "followers_url": "https://api.github.com/users/dankrad/followers",
    "following_url": "https://api.github.com/users/dankrad/following{/other_user}",
    "gists_url": "https://api.github.com/users/dankrad/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dankrad/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dankrad/subscriptions",
    "organizations_url": "https://api.github.com/users/dankrad/orgs",
    "repos_url": "https://api.github.com/users/dankrad/repos",
    "events_url": "https://api.github.com/users/dankrad/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dankrad/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-10-28T16:52:54Z",
  "updated_at": "2022-11-06T13:44:07Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Currently go-ethereum keeps running until it is out of disk space. However pruning requires about 40GB of extra disk space, so this is not reasonable behaviour. It should automatically stop before there is not enough disk space available for pruning.\r\n\r\nI suggest adding a command line flag that specifies the available space at which geth automatically shuts down to allow the user to prune. I would also suggest setting it to a reasonable default like 40 GB, so users don't get trapped as it happens now: go-ethereum just keeps running until the disk is full, at which point pruning becomes impossible.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26061/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26061/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1295236536",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26061#issuecomment-1295236536",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26061",
    "id": 1295236536,
    "node_id": "IC_kwDOAOvK985NM724",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-28T16:58:40Z",
    "updated_at": "2022-10-28T16:58:40Z",
    "author_association": "MEMBER",
    "body": "> I suggest adding a command line flag that specifies the available space at which geth automatically shuts down to allow the user to prune.\r\n\r\nWe have it already\r\n\r\n```\r\n[user@work ~]$ geth -h | grep freedisk -A2\r\n    --datadir.minfreedisk value   \r\n          Minimum free disk space in MB, once reached triggers auto shut down (default =\r\n          --cache.gc converted to MB, 0 = disabled)\r\n\r\n```\r\nIt currently default-set to be the in-memory cache allowance, with the reasoning \" we need to shut down if we cannot flush our caches to disk\"",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1295236536/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1295238368",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26061#issuecomment-1295238368",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26061",
    "id": 1295238368,
    "node_id": "IC_kwDOAOvK985NM8Tg",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-28T17:00:53Z",
    "updated_at": "2022-10-28T17:01:28Z",
    "author_association": "MEMBER",
    "body": "Also, pruning doesn't really get impossible. It ought to be possible to do a workaround: delete all \"finished\" ancient-files, do the pruning, and then restore them from some other installation somewhere. \r\nHowever, it may be that `geth --prune`  detects the missing files and ejects. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1295238368/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1304804686",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26061#issuecomment-1304804686",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26061",
    "id": 1304804686,
    "node_id": "IC_kwDOAOvK985Nxb1O",
    "user": {
      "login": "dankrad",
      "id": 6130607,
      "node_id": "MDQ6VXNlcjYxMzA2MDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6130607?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dankrad",
      "html_url": "https://github.com/dankrad",
      "followers_url": "https://api.github.com/users/dankrad/followers",
      "following_url": "https://api.github.com/users/dankrad/following{/other_user}",
      "gists_url": "https://api.github.com/users/dankrad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dankrad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dankrad/subscriptions",
      "organizations_url": "https://api.github.com/users/dankrad/orgs",
      "repos_url": "https://api.github.com/users/dankrad/repos",
      "events_url": "https://api.github.com/users/dankrad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dankrad/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-06T13:43:57Z",
    "updated_at": "2022-11-06T13:44:07Z",
    "author_association": "MEMBER",
    "body": "This switch should then just be set to default to 40 GB, so that a user running the default config will not run out of space to prune their node.\r\n\r\n> It ought to be possible to do a workaround: delete all \"finished\" ancient-files, do the pruning, and then restore them from some other installation somewhere.\r\n\r\nThis is terrible UX, and isn't documented anywhere!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1304804686/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
