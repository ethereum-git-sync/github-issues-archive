{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26429",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26429/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26429/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26429/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/26429",
  "id": 1519530948,
  "node_id": "I_kwDOAOvK985akjPE",
  "number": 26429,
  "title": "No pivot movements during block download",
  "user": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-01-04T20:25:50Z",
  "updated_at": "2023-01-04T20:25:51Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "![image](https://user-images.githubusercontent.com/142290/209782002-97eeb4bf-e9f4-44f0-9874-bfb861522c46.png)\r\n\r\nThe image shows the `snap` traffic during a sync from scratch. It started ok, then nothing happened, and as soon as the block body download completed, the snap sync got started again. \r\n\r\nThe abbreviated logs that mention pivoting from that time: \r\n```\r\nDec 22 20:01:12 bench06.ethdevops.io geth WARN [12-22|19:01:12.117] Pivot became stale, moving old=16,240,072 new=16,240,289\r\nDec 22 20:01:14 bench06.ethdevops.io geth WARN [12-22|19:01:14.379] Pivot became stale, moving old=16,240,289 new=16,240,369\r\nDec 22 20:01:15 bench06.ethdevops.io geth WARN [12-22|19:01:15.509] Pivot became stale, moving old=16,240,369 new=16,241,203\r\nDec 22 20:01:17 bench06.ethdevops.io geth WARN [12-22|19:01:17.485] Pivot became stale, moving old=16,241,203 new=16,241,413\r\nDec 22 20:01:18 bench06.ethdevops.io geth WARN [12-22|19:01:18.838] Pivot became stale, moving old=16,241,413 new=16,242,137\r\nDec 22 20:14:04 bench06.ethdevops.io geth WARN [12-22|19:14:03.987] Pivot became stale, moving old=16,242,137 new=16,242,201\r\nDec 22 20:26:54 bench06.ethdevops.io geth WARN [12-22|19:26:54.145] Pivot became stale, moving old=16,242,201 new=16,242,265\r\nDec 22 20:33:17 bench06.ethdevops.io geth INFO [12-22|19:33:17.075] Loaded last fast-sync pivot marker number=16,242,265\r\nDec 22 20:41:37 bench06.ethdevops.io geth INFO [12-22|19:41:36.944] Loaded last fast-sync pivot marker number=16,242,296\r\nDec 22 20:48:38 bench06.ethdevops.io geth INFO [12-22|19:48:38.560] Loaded last fast-sync pivot marker number=16,242,336\r\nDec 22 20:59:52 bench06.ethdevops.io geth INFO [12-22|19:59:52.177] Loaded last fast-sync pivot marker number=16,242,372\r\nDec 22 21:05:15 bench06.ethdevops.io geth INFO [12-22|20:05:15.853] Loaded last fast-sync pivot marker number=16,242,427\r\nDec 22 21:17:02 bench06.ethdevops.io geth INFO [12-22|20:17:02.419] Loaded last fast-sync pivot marker number=16,242,454\r\nDec 22 21:29:14 bench06.ethdevops.io geth INFO [12-22|20:29:14.868] Loaded last fast-sync pivot marker number=16,242,513\r\nDec 22 21:36:02 bench06.ethdevops.io geth INFO [12-22|20:36:02.103] Loaded last fast-sync pivot marker number=16,242,574\r\nDec 22 21:41:59 bench06.ethdevops.io geth INFO [12-22|20:41:59.003] Loaded last fast-sync pivot marker number=16,242,608\r\nDec 22 21:52:35 bench06.ethdevops.io geth INFO [12-22|20:52:35.468] Loaded last fast-sync pivot marker number=16,242,637\r\nDec 22 21:59:39 bench06.ethdevops.io geth INFO [12-22|20:59:39.659] Loaded last fast-sync pivot marker number=16,242,690\r\nDec 22 22:06:08 bench06.ethdevops.io geth INFO [12-22|21:06:08.784] Loaded last fast-sync pivot marker number=16,242,726\r\nDec 22 22:18:54 bench06.ethdevops.io geth WARN [12-22|21:18:54.860] Pivot became stale, moving old=16,242,758 new=16,242,824\r\nDec 22 22:26:38 bench06.ethdevops.io geth INFO [12-22|21:26:38.847] Loaded last fast-sync pivot marker number=16,242,824\r\nDec 22 22:33:28 bench06.ethdevops.io geth INFO [12-22|21:33:27.969] Loaded last fast-sync pivot marker number=16,242,860\r\nDec 22 22:39:52 bench06.ethdevops.io geth INFO [12-22|21:39:52.875] Loaded last fast-sync pivot marker number=16,242,894\r\nDec 22 22:47:05 bench06.ethdevops.io geth INFO [12-22|21:47:05.580] Loaded last fast-sync pivot marker number=16,242,926\r\nDec 22 22:54:07 bench06.ethdevops.io geth INFO [12-22|21:54:07.114] Loaded last fast-sync pivot marker number=16,242,962\r\nDec 22 23:01:35 bench06.ethdevops.io geth INFO [12-22|22:01:35.340] Loaded last fast-sync pivot marker number=16,242,997\r\nDec 22 23:09:02 bench06.ethdevops.io geth INFO [12-22|22:09:02.134] Loaded last fast-sync pivot marker number=16,243,034\r\nDec 22 23:19:35 bench06.ethdevops.io geth INFO [12-22|22:19:35.564] Loaded last fast-sync pivot marker number=16,243,072\r\nDec 22 23:27:58 bench06.ethdevops.io geth INFO [12-22|22:27:57.948] Loaded last fast-sync pivot marker number=16,243,124\r\nDec 22 23:35:50 bench06.ethdevops.io geth INFO [12-22|22:35:50.523] Loaded last fast-sync pivot marker number=16,243,166\r\nDec 22 23:44:13 bench06.ethdevops.io geth INFO [12-22|22:44:13.809] Loaded last fast-sync pivot marker number=16,243,205\r\nDec 22 23:51:15 bench06.ethdevops.io geth INFO [12-22|22:51:14.997] Loaded last fast-sync pivot marker number=16,243,248\r\nDec 22 23:57:51 bench06.ethdevops.io geth INFO [12-22|22:57:51.087] Loaded last fast-sync pivot marker number=16,243,283\r\nDec 23 00:05:35 bench06.ethdevops.io geth INFO [12-22|23:05:35.251] Loaded last fast-sync pivot marker number=16,243,316\r\nDec 23 00:12:52 bench06.ethdevops.io geth INFO [12-22|23:12:52.381] Loaded last fast-sync pivot marker number=16,243,354\r\nDec 23 00:25:13 bench06.ethdevops.io geth WARN [12-22|23:25:13.747] Pivot became stale, moving old=16,243,391 new=16,243,455```\r\n```\r\n\r\nThe TL;DR is that once the block download phase finished, it does 5 pivot movements with a few seconds in between. 16,240,072 -> 16,242,137 , 2065 blocks, representing nearly 7 hours.\r\n\r\n\r\nThis is because head updates from the CL node does not trigger pivot movements, only full block download does. But if our head pivot is already at 16M, and we spend 6 hours downloading `16M -> genesis`, then obviously nothing will push it. \r\n\r\nThis needs to be fixed by somehow trigger pivot movements from head updates. ",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26429/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26429/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
