{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24101",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24101/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24101/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24101/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/24101",
  "id": 1078023578,
  "node_id": "I_kwDOAOvK985AQVWa",
  "number": 24101,
  "title": "light node: Transaction returning null until second try.",
  "user": {
    "login": "JoeGruffins",
    "id": 34998433,
    "node_id": "MDQ6VXNlcjM0OTk4NDMz",
    "avatar_url": "https://avatars.githubusercontent.com/u/34998433?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/JoeGruffins",
    "html_url": "https://github.com/JoeGruffins",
    "followers_url": "https://api.github.com/users/JoeGruffins/followers",
    "following_url": "https://api.github.com/users/JoeGruffins/following{/other_user}",
    "gists_url": "https://api.github.com/users/JoeGruffins/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/JoeGruffins/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/JoeGruffins/subscriptions",
    "organizations_url": "https://api.github.com/users/JoeGruffins/orgs",
    "repos_url": "https://api.github.com/users/JoeGruffins/repos",
    "events_url": "https://api.github.com/users/JoeGruffins/events{/privacy}",
    "received_events_url": "https://api.github.com/users/JoeGruffins/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 268304226,
      "node_id": "MDU6TGFiZWwyNjgzMDQyMjY=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:docs",
      "name": "type:docs",
      "color": "fef2c0",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-12-13T02:52:18Z",
  "updated_at": "2021-12-16T04:33:12Z",
  "closed_at": "2021-12-15T07:48:37Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "We are testing with a private network. Two snap sync nodes and two light nodes using the proof of authority \"clique\" to mine blocks. Light nodes sometimes do not find transactions until the second time you ask for them.\r\n\r\n```\r\n[harness-ctl]$ ./gamma attach --exec 'eth.getTransaction(\"0xb2846bb0c1b97c22ff2f886ed0e5ca383e054b5830abdacb7066c1daa14ec7a9\")'\r\nnull\r\n[harness-ctl]$ ./gamma attach --exec 'eth.getTransaction(\"0xb2846bb0c1b97c22ff2f886ed0e5ca383e054b5830abdacb7066c1daa14ec7a9\")'\r\n{\r\n  accessList: [],\r\n  blockHash: \"0x045666f2a4c7c5e077065b182f97538c93ba935c95ab13476b25c87fbaf3238b\",\r\n  blockNumber: 221,\r\n  chainId: \"0x2a\",\r\n  from: \"0xdd93b447f7ebca361805ebe056259853f3912e04\",\r\n  gas: 21000,\r\n  gasPrice: 2000000000,\r\n  hash: \"0xb2846bb0c1b97c22ff2f886ed0e5ca383e054b5830abdacb7066c1daa14ec7a9\",\r\n  input: \"0x\",\r\n  maxFeePerGas: 2000000000,\r\n  maxPriorityFeePerGas: 2000000000,\r\n  nonce: 45,\r\n  r: \"0x640cc950e3a71cc1cb5a487a62edd9b778d178ea24da2fb22de4f6dad23076ea\",\r\n  s: \"0x4507a46a4f4a1f2d40d2de89039f81fd09ac254b313d67b50c927995614c6ac5\",\r\n  to: \"0x8d83b207674bfd53b418a6e47da148f5bfecc652\",\r\n  transactionIndex: 0,\r\n  type: \"0x2\",\r\n  v: \"0x0\",\r\n  value: 1000000000\r\n}\r\n```\r\nThis only seems to happen very rarely. I do not know how to reproduce. We're using \"clique\" with a one second period if that would matter.\r\n\r\nedit: Originally it seemed to be connected to fetching the block separately but that does not seem so. Title also edited to reflect the revelation that asking for it twice finds it.",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24101/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24101/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/994449664",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24101#issuecomment-994449664",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24101",
    "id": 994449664,
    "node_id": "IC_kwDOAOvK9847RhkA",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-15T07:48:37Z",
    "updated_at": "2021-12-15T07:48:37Z",
    "author_association": "MEMBER",
    "body": "With a light node, you won't always get up-to-date results. It needs to have a server to query about things, and that can't always be guaranteed. Since you're also running with very fast blocks, 1 second between them, the chance that a les client is cannot obtain the requested information in time increases. \r\nI don't think this is an issue in geth, rather \"the way things are\" due to the nature of light clients. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/994449664/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/995429791",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24101#issuecomment-995429791",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24101",
    "id": 995429791,
    "node_id": "IC_kwDOAOvK9847VQ2f",
    "user": {
      "login": "chappjc",
      "id": 9373513,
      "node_id": "MDQ6VXNlcjkzNzM1MTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9373513?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chappjc",
      "html_url": "https://github.com/chappjc",
      "followers_url": "https://api.github.com/users/chappjc/followers",
      "following_url": "https://api.github.com/users/chappjc/following{/other_user}",
      "gists_url": "https://api.github.com/users/chappjc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chappjc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chappjc/subscriptions",
      "organizations_url": "https://api.github.com/users/chappjc/orgs",
      "repos_url": "https://api.github.com/users/chappjc/repos",
      "events_url": "https://api.github.com/users/chappjc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chappjc/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-16T04:29:29Z",
    "updated_at": "2021-12-16T04:33:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "> them, the chance that a les client is cannot obtain the requested information in time increases\r\n\r\nThanks for responding.  Could you clarify what is meant here by \"in time\" w.r.t a `getTransaction` request?  Assuming the light client does have a connection to a full node, what circumstances and timing issues might cause it to fail to retrieve the transaction if the server it is connected to has it?  Lagging block processing on said server or a timeout on the request itself?\r\n\r\nMy understanding from the original ORD getTransaction PR (https://github.com/ethereum/go-ethereum/pull/19069#issuecomment-489608576), and the code, which follows through light/odr_util.go like `GetTransaction` > ... > `rawdb.ReadBodyRLP` otherwise `odr.Retrieve`, is that if the upstream full node has the data, it will be retrieved.\r\n\r\nThanks for helping us understand and set our expectations for these requests.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/995429791/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
