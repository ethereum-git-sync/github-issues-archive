{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20226",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20226/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20226/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20226/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/20226",
  "id": 515309090,
  "node_id": "MDU6SXNzdWU1MTUzMDkwOTA=",
  "number": 20226,
  "title": "Inconsistent dependencies when using `go-ethereum` with go modules",
  "user": {
    "login": "Pet3ris",
    "id": 224585,
    "node_id": "MDQ6VXNlcjIyNDU4NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/224585?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Pet3ris",
    "html_url": "https://github.com/Pet3ris",
    "followers_url": "https://api.github.com/users/Pet3ris/followers",
    "following_url": "https://api.github.com/users/Pet3ris/following{/other_user}",
    "gists_url": "https://api.github.com/users/Pet3ris/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Pet3ris/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Pet3ris/subscriptions",
    "organizations_url": "https://api.github.com/users/Pet3ris/orgs",
    "repos_url": "https://api.github.com/users/Pet3ris/repos",
    "events_url": "https://api.github.com/users/Pet3ris/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Pet3ris/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-10-31T10:10:04Z",
  "updated_at": "2019-11-21T13:53:07Z",
  "closed_at": "2019-11-21T13:51:54Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi there,\r\n\r\nI'm using go modules in a project that uses `go-ethereum` and it seems like it may be impossible to use it as a library.\r\n\r\n#### System information\r\n\r\nGeth version: `1.9.6`\r\nOS & Version: OS X\r\nCommit hash : n/a\r\n\r\n#### Expected behaviour\r\n\r\n`go build` should compile when building on `go-ethereum`\r\n\r\n#### Actual behaviour\r\n\r\nReturns the following error:\r\n\r\n```bash\r\n$ go build\r\n# github.com/ethereum/go-ethereum/ethdb/leveldb\r\n~/go/pkg/mod/github.com/ethereum/go-ethereum@v1.9.6/ethdb/leveldb/leveldb.go:103:3: unknown field 'DisableSeeksCompaction' in struct literal of type opt.Options\r\n```\r\n\r\nThis happens because the field `DisableSeeksCompaction` is available in `github.com/syndtr/goleveldb` on the `master` branch but not in the published `1.0.0`. it seems like `go-ethereum` depends on the `master` branch, but `go modules` is pulling in `1.0.0` by default. Here is an excerpt from my `go.mod` file for context:\r\n\r\n```\r\n..\r\n\tgithub.com/ethereum/go-ethereum v1.9.6\r\n\tgithub.com/syndtr/goleveldb v1.0.0 // indirect\r\n..\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nImport one of `go-ethereum` subpackages that has an indirect dependency to `leveldb`.\r\n\r\nFor example this file:\r\n\r\n```go\r\n// Copyright 2017 The go-ethereum Authors\r\n// This file is part of the go-ethereum library.\r\n//\r\n// The go-ethereum library is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU Lesser General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// The go-ethereum library is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\r\n// GNU Lesser General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU Lesser General Public License\r\n// along with the go-ethereum library. If not, see <http://www.gnu.org/licenses/>.\r\n\r\npackage main\r\n\r\nimport (\r\n\t\"sync\"\r\n\r\n\t\"github.com/ethereum/go-ethereum/common\"\r\n)\r\n\r\ntype AddrLocker struct {\r\n\tmu    sync.Mutex\r\n\tlocks map[common.Address]*sync.Mutex\r\n}\r\n\r\n// lock returns the lock of the given address.\r\nfunc (l *AddrLocker) lock(address common.Address) *sync.Mutex {\r\n\tl.mu.Lock()\r\n\tdefer l.mu.Unlock()\r\n\tif l.locks == nil {\r\n\t\tl.locks = make(map[common.Address]*sync.Mutex)\r\n\t}\r\n\tif _, ok := l.locks[address]; !ok {\r\n\t\tl.locks[address] = new(sync.Mutex)\r\n\t}\r\n\treturn l.locks[address]\r\n}\r\n\r\n// LockAddr locks an account's mutex. This is used to prevent another tx getting the\r\n// same nonce until the lock is released. The mutex prevents the (an identical nonce) from\r\n// being read again during the time that the first transaction is being signed.\r\nfunc (l *AddrLocker) LockAddr(address common.Address) {\r\n\tl.lock(address).Lock()\r\n}\r\n\r\n// UnlockAddr unlocks the mutex of the given account.\r\nfunc (l *AddrLocker) UnlockAddr(address common.Address) {\r\n\tl.lock(address).Unlock()\r\n}\r\n\r\nfunc main() {}\r\n```\r\n\r\n^ (Yes this is `go-ethereum` `internal` code that I need to refer to).\r\n\r\nIn an empty go module folder does not build.\r\n\r\n#### Backtrace\r\n\r\nn/a",
  "closed_by": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20226/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20226/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/548303441",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20226#issuecomment-548303441",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20226",
    "id": 548303441,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0ODMwMzQ0MQ==",
    "user": {
      "login": "Pet3ris",
      "id": 224585,
      "node_id": "MDQ6VXNlcjIyNDU4NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/224585?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Pet3ris",
      "html_url": "https://github.com/Pet3ris",
      "followers_url": "https://api.github.com/users/Pet3ris/followers",
      "following_url": "https://api.github.com/users/Pet3ris/following{/other_user}",
      "gists_url": "https://api.github.com/users/Pet3ris/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Pet3ris/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Pet3ris/subscriptions",
      "organizations_url": "https://api.github.com/users/Pet3ris/orgs",
      "repos_url": "https://api.github.com/users/Pet3ris/repos",
      "events_url": "https://api.github.com/users/Pet3ris/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Pet3ris/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-31T10:23:42Z",
    "updated_at": "2019-10-31T10:35:15Z",
    "author_association": "NONE",
    "body": "There is a work-around to force installation from `leveldb` repo using the latest commit:\r\n\r\n```bash\r\ngo get github.com/syndtr/goleveldb/leveldb@758128399b1df3a87e92df6c26c1d2063da8fabe\r\n```\r\n\r\nor\r\n\r\n```bash\r\ngo get github.com/syndtr/goleveldb/leveldb@master\r\n```\r\n\r\nwhich will always pull the latest.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/548303441/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/549118914",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20226#issuecomment-549118914",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20226",
    "id": 549118914,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0OTExODkxNA==",
    "user": {
      "login": "eccles",
      "id": 1104895,
      "node_id": "MDQ6VXNlcjExMDQ4OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1104895?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eccles",
      "html_url": "https://github.com/eccles",
      "followers_url": "https://api.github.com/users/eccles/followers",
      "following_url": "https://api.github.com/users/eccles/following{/other_user}",
      "gists_url": "https://api.github.com/users/eccles/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eccles/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eccles/subscriptions",
      "organizations_url": "https://api.github.com/users/eccles/orgs",
      "repos_url": "https://api.github.com/users/eccles/repos",
      "events_url": "https://api.github.com/users/eccles/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eccles/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-03T09:25:07Z",
    "updated_at": "2019-11-03T09:25:07Z",
    "author_association": "NONE",
    "body": "For a permanent change try adding a replace directive in your go.mod file.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/549118914/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/549337111",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20226#issuecomment-549337111",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20226",
    "id": 549337111,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0OTMzNzExMQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-04T12:45:01Z",
    "updated_at": "2019-11-04T12:45:01Z",
    "author_association": "MEMBER",
    "body": "Myeah, `go modules` picks the latest stable release of go-leveldb by default, which does not contain all the fixes we've upstreamed. The solutions are: a) manually swap your dependency as suggested above; b) get go-leveldb to merge the master changes into `v1`; c) update go-ethereum to use modules (blocked by https://github.com/ethereum/go-ethereum/pull/20228)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/549337111/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
