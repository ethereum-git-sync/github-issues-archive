{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27981",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27981/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27981/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27981/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/27981",
  "id": 1862755256,
  "node_id": "I_kwDOAOvK985vB2O4",
  "number": 27981,
  "title": "Failed to flush frozen tables when try re-init",
  "user": {
    "login": "anhnh131",
    "id": 43759289,
    "node_id": "MDQ6VXNlcjQzNzU5Mjg5",
    "avatar_url": "https://avatars.githubusercontent.com/u/43759289?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/anhnh131",
    "html_url": "https://github.com/anhnh131",
    "followers_url": "https://api.github.com/users/anhnh131/followers",
    "following_url": "https://api.github.com/users/anhnh131/following{/other_user}",
    "gists_url": "https://api.github.com/users/anhnh131/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/anhnh131/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/anhnh131/subscriptions",
    "organizations_url": "https://api.github.com/users/anhnh131/orgs",
    "repos_url": "https://api.github.com/users/anhnh131/repos",
    "events_url": "https://api.github.com/users/anhnh131/events{/privacy}",
    "received_events_url": "https://api.github.com/users/anhnh131/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 268304226,
      "node_id": "MDU6TGFiZWwyNjgzMDQyMjY=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:docs",
      "name": "type:docs",
      "color": "fef2c0",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-08-23T07:41:23Z",
  "updated_at": "2023-08-23T07:53:24Z",
  "closed_at": "2023-08-23T07:53:24Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I am using Geth to build a POA network. When I try re-init geth (after updating the genesis config), I received the error (`CRIT: Failed to flush frozen tables`) the first time. That seems like an \"unclean shutdown\" https://geth.ethereum.org/docs/fundamentals/databases#unclean-shutdowns. \r\nHow can check it clean shutdown successfully?\r\n**Note**: I tried waiting for about 10 minutes after stopping and running `geth init`, but it still fails the first time ( my network only has about 250k blocks)\r\n\r\n\r\n#### System information\r\n - Geth version: v1.10.18\r\n - OS & Version: Docker\r\n\r\n#### Steps to reproduce the behavior\r\n\r\n```\r\n$ sudo docker stop -t 300 geth\r\ngeth\r\n\r\n$ sudo docker run --rm -v /data/ethereum:/data/ethereum ethereum/client-go:v1.10.18 --verbosity 5 init --datadir=/data/ethereum /data/ethereum/genesis.json\r\nINFO [08-23|07:11:26.840] Maximum peer count                       ETH=50 LES=0 total=50\r\nINFO [08-23|07:11:26.840] Smartcard socket not found, disabling    err=\"stat /run/pcscd/pcscd.comm: no such file or directory\"\r\nDEBUG[08-23|07:11:26.841] FS scan times                            list=\"33.088µs\" set=\"8.09µs\" diff=\"2.501µs\"\r\nTRACE[08-23|07:11:26.841] Handled keystore changes                 time=\"90.767µs\"\r\nTRACE[08-23|07:11:26.841] Started watching keystore folder         path=/data/ethereum/keystore\r\nDEBUG[08-23|07:11:26.842] Sanitizing Go's GC trigger               percent=100\r\nINFO [08-23|07:11:26.842] Set global gas cap                       cap=50,000,000\r\nINFO [08-23|07:11:26.842] Allocated cache and file handles         database=/data/ethereum/geth/chaindata cache=16.00MiB handles=16\r\nDEBUG[08-23|07:11:26.862] Chain freezer table opened               database=/data/ethereum/geth/chaindata/ancient table=headers items=191,396 size=56.90MiB\r\nDEBUG[08-23|07:11:26.862] Chain freezer table opened               database=/data/ethereum/geth/chaindata/ancient table=hashes  items=191,396 size=5.84MiB\r\nDEBUG[08-23|07:11:26.863] Chain freezer table opened               database=/data/ethereum/geth/chaindata/ancient table=bodies  items=191,396 size=935.33KiB\r\nDEBUG[08-23|07:11:26.868] Chain freezer table opened               database=/data/ethereum/geth/chaindata/ancient table=receipts items=191,396 size=560.77KiB\r\nDEBUG[08-23|07:11:26.871] Chain freezer table opened               database=/data/ethereum/geth/chaindata/ancient table=diffs    items=191,396 size=706.67KiB\r\nINFO [08-23|07:11:26.871] Opened ancient database                  database=/data/ethereum/geth/chaindata/ancient readonly=false\r\nINFO [08-23|07:11:26.899] Persisted trie from memory database      nodes=355 size=50.41KiB  time=2.231182ms gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B\r\nCRIT [08-23|07:11:26.902] Failed to flush frozen tables            err=\"[invalid argument]\"\r\n\r\n$ sudo docker run --rm -v /data/ethereum:/data/ethereum ethereum/client-go:v1.10.18 --verbosity 5 init --datadir=/data/ethereum /data/ethereum/genesis.json\r\nINFO [08-23|07:11:35.386] Maximum peer count                       ETH=50 LES=0 total=50\r\nINFO [08-23|07:11:35.386] Smartcard socket not found, disabling    err=\"stat /run/pcscd/pcscd.comm: no such file or directory\"\r\nTRACE[08-23|07:11:35.386] Started watching keystore folder         path=/data/ethereum/keystore\r\nDEBUG[08-23|07:11:35.386] FS scan times                            list=\"29.377µs\" set=\"8.173µs\" diff=\"2.551µs\"\r\nTRACE[08-23|07:11:35.386] Handled keystore changes                 time=\"52.914µs\"\r\nDEBUG[08-23|07:11:35.386] Sanitizing Go's GC trigger               percent=100\r\nINFO [08-23|07:11:35.386] Set global gas cap                       cap=50,000,000\r\nINFO [08-23|07:11:35.387] Allocated cache and file handles         database=/data/ethereum/geth/chaindata cache=16.00MiB handles=16\r\nDEBUG[08-23|07:11:35.399] Chain freezer table opened               database=/data/ethereum/geth/chaindata/ancient table=hashes items=191,446 size=5.84MiB\r\nDEBUG[08-23|07:11:35.400] Chain freezer table opened               database=/data/ethereum/geth/chaindata/ancient table=bodies items=191,446 size=935.57KiB\r\nDEBUG[08-23|07:11:35.401] Chain freezer table opened               database=/data/ethereum/geth/chaindata/ancient table=receipts items=191,446 size=560.92KiB\r\nDEBUG[08-23|07:11:35.402] Chain freezer table opened               database=/data/ethereum/geth/chaindata/ancient table=diffs    items=191,446 size=706.86KiB\r\nDEBUG[08-23|07:11:35.404] Chain freezer table opened               database=/data/ethereum/geth/chaindata/ancient table=headers  items=191,446 size=56.92MiB\r\nINFO [08-23|07:11:35.405] Opened ancient database                  database=/data/ethereum/geth/chaindata/ancient readonly=false\r\nDEBUG[08-23|07:11:35.412] Ancient blocks frozen already            number=281,445 hash=623176..c5a59e frozen=191,446\r\nINFO [08-23|07:11:35.416] Persisted trie from memory database      nodes=355 size=50.41KiB  time=\"864.965µs\" gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B\r\nINFO [08-23|07:11:35.448] Successfully wrote genesis state         database=chaindata                             hash=960aa6..e46774\r\nINFO [08-23|07:11:35.448] Allocated cache and file handles         database=/data/ethereum/geth/lightchaindata    cache=16.00MiB handles=16\r\nDEBUG[08-23|07:11:35.458] Chain freezer table opened               database=/data/ethereum/geth/lightchaindata/ancient table=diffs    items=0       size=0.00B\r\nDEBUG[08-23|07:11:35.458] Chain freezer table opened               database=/data/ethereum/geth/lightchaindata/ancient table=headers  items=0       size=0.00B\r\nDEBUG[08-23|07:11:35.458] Chain freezer table opened               database=/data/ethereum/geth/lightchaindata/ancient table=hashes   items=0       size=0.00B\r\nDEBUG[08-23|07:11:35.458] Chain freezer table opened               database=/data/ethereum/geth/lightchaindata/ancient table=bodies   items=0       size=0.00B\r\nDEBUG[08-23|07:11:35.459] Chain freezer table opened               database=/data/ethereum/geth/lightchaindata/ancient table=receipts items=0       size=0.00B\r\nINFO [08-23|07:11:35.459] Opened ancient database                  database=/data/ethereum/geth/lightchaindata/ancient readonly=false\r\nDEBUG[08-23|07:11:35.459] Current full block not old enough        number=0       hash=960aa6..e46774 delay=90000\r\nINFO [08-23|07:11:35.464] Persisted trie from memory database      nodes=355 size=50.41KiB  time=1.260342ms  gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B\r\nINFO [08-23|07:11:35.466] Successfully wrote genesis state         database=lightchaindata                        hash=960aa6..e46774\r\n```",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27981/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27981/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1689465309",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27981#issuecomment-1689465309",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27981",
    "id": 1689465309,
    "node_id": "IC_kwDOAOvK985kszHd",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-23T07:53:24Z",
    "updated_at": "2023-08-23T07:53:24Z",
    "author_association": "MEMBER",
    "body": "Hi, \r\nThe latest geth-release is `1.12.2`, your version `v1.10.18` is about 15 months old, and we cannot provide support for such old releases -- when doing so, more often than not, we just rediscover bugs that were fixed in the meantime. \r\nPlease test with the latest version of geth, and see if the problem remains. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1689465309/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
