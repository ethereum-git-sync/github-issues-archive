{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2905",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2905/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2905/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2905/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/2905",
  "id": 170907596,
  "node_id": "MDU6SXNzdWUxNzA5MDc1OTY=",
  "number": 2905,
  "title": "I'm failing to import a testnet blockchain binary file (Bad block #1)",
  "user": {
    "login": "jjmr007",
    "id": 17028457,
    "node_id": "MDQ6VXNlcjE3MDI4NDU3",
    "avatar_url": "https://avatars.githubusercontent.com/u/17028457?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jjmr007",
    "html_url": "https://github.com/jjmr007",
    "followers_url": "https://api.github.com/users/jjmr007/followers",
    "following_url": "https://api.github.com/users/jjmr007/following{/other_user}",
    "gists_url": "https://api.github.com/users/jjmr007/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jjmr007/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jjmr007/subscriptions",
    "organizations_url": "https://api.github.com/users/jjmr007/orgs",
    "repos_url": "https://api.github.com/users/jjmr007/repos",
    "events_url": "https://api.github.com/users/jjmr007/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jjmr007/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2016-08-12T16:18:51Z",
  "updated_at": "2016-08-24T07:36:03Z",
  "closed_at": "2016-08-24T07:36:03Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\n\nGeth version: `1.4.7`\nOS & Version: Windows 7\n#### Expected behaviour\n\nImport testnet blockchain from a binary file to the testnet database\n#### Actual behaviour\n\nGeth preloads the default genesis block. The process ends in the block #1.\n#### Steps to reproduce the behaviour\n\nMy first try was:\n\n`geth --testnet import ~testnetblockchain.bin`\n\nAnd geth gave me back:\n\n> I0811 23:59:37.301085 ethdb/database.go:82] Alloted 128MB cache and 1024 file handles to C:\\Users\\MultiEBD\\AppData\\Roaming\\Ethereum\\testnet\\chaindata\n> I0811 23:59:37.742111 core/headerchain.go:94] WARNING: Wrote default ethereum genesis block\n> I0811 23:59:37.742111 core/blockchain.go:206] Last header: #0 [d4e56740.] TD=17179869184\n> I0811 23:59:37.742111 core/blockchain.go:207] Last block: #0 [d4e56740.] TD=17179869184\n> I0811 23:59:37.742111 core/blockchain.go:208] Fast block: #0 [d4e56740.] TD=17179869184\n> I0811 23:59:37.742111 cmd/utils/cmd.go:123] Importing blockchain H:\\RESPALDOS\\CRYPTO\\Ethereum\\test11082016.bin\n> E0811 23:59:38.888176 core/blockchain.go:1128] Bad block #1 (0xad47413137a753b2061ad9b484bf7b0fc061f654b951b562218e9f66505be6ce)\n> E0811 23:59:38.888176 core/blockchain.go:1129]     Block's parent unknown 0cd786a2425d16f152c658316c423e6ce1181e15c3295826d7c9904cba9ce303\n> I0811 23:59:38.888176 ethdb/database.go:169] closed db:C:\\Users\\MultiEBD\\AppData\\Roaming\\Ethereum\\testnet\\chaindata\n> Fatal: Import error: invalid block 2500: Block's parent unknown 0cd786a2425d16f152c658316c423e6ce1181e15c3295826d7c9904cba9ce303\n> Fatal: Import error: invalid block 2500: Block's parent unknown 0cd786a2425d16f152c658316c423e6ce1181e15c3295826d7c9904cba9ce303\n\nNow, `0cd786a2425d16f152c658316c423e6ce1181e15c3295826d7c9904cba9ce303` is the right hash of the MORDEN genesis block. So I thought that I just needed the [genesis.json](https://github.com/ethereum/homestead-guide/blob/master/source/network/test-networks.rst)\n\nMy second try was:\n\n`geth --testnet init genesis.json`\n\nAnd geth gave me: `successfully wrote genesis block and/or chain rule set: c31c07282c5f803da583b8b65f3aa0b5cce411f3ffa6ae11c5e0adb3e057ef4a`\n\nthen I try again:\n\n`geth --testnet import ~testnetblockchain.bin`\n\nAnd geth gave me back:\n\n> I0811 23:29:00.224011 ethdb/database.go:82] Alloted 128MB cache and 1024 file handles to C:\\Users\\MultiEBD\\AppData\\Roaming\\Ethereum\\testnet\\chaindata\n> I0811 23:29:00.605032 core/blockchain.go:206] Last header: #0 [c31c0728.] TD=131072\n> I0811 23:29:00.605032 core/blockchain.go:207] Last block: #0 [c31c0728.] TD=131072\n> I0811 23:29:00.605032 core/blockchain.go:208] Fast block: #0 [c31c0728.] TD=131072\n> I0811 23:29:00.605032 cmd/utils/cmd.go:123] Importing blockchain H:\\RESPALDOS\\CRYPTO\\Ethereum\\test11082016.bin\n> E0811 23:29:01.764099 core/blockchain.go:1128] Bad block #1 (0xad47413137a753b2061ad9b484bf7b0fc061f654b951b562218e9f66505be6ce)\n> E0811 23:29:01.796101 core/blockchain.go:1129]     Block's parent unknown 0cd786a2425d16f152c658316c423e6ce1181e15c3295826d7c9904cba9ce303\n> I0811 23:29:01.845103 ethdb/database.go:169] closed db:C:\\Users\\MultiEBD\\AppData\\Roaming\\Ethereum\\testnet\\chaindata\n> Fatal: Import error: invalid block 2500: Block's parent unknown 0cd786a2425d16f152c658316c423e6ce1181e15c3295826d7c9904cba9ce303\n> Fatal: Import error: invalid block 2500: Block's parent unknown 0cd786a2425d16f152c658316c423e6ce1181e15c3295826d7c9904cba9ce303\n\nAnd I don't know what I'm doing wrong.\nMay be I need the right MORDEN genesis.json file yet.\nOr may be that I need to use some geth command to tell it not to write the default genesis block in the chaindata, but import it from the testnetblockchain file I have.\n\nAny suggestion?\n\nThanks =)\n",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2905/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2905/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/240760307",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2905#issuecomment-240760307",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2905",
    "id": 240760307,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MDc2MDMwNw==",
    "user": {
      "login": "Hellsegga",
      "id": 20972132,
      "node_id": "MDQ6VXNlcjIwOTcyMTMy",
      "avatar_url": "https://avatars.githubusercontent.com/u/20972132?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Hellsegga",
      "html_url": "https://github.com/Hellsegga",
      "followers_url": "https://api.github.com/users/Hellsegga/followers",
      "following_url": "https://api.github.com/users/Hellsegga/following{/other_user}",
      "gists_url": "https://api.github.com/users/Hellsegga/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Hellsegga/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Hellsegga/subscriptions",
      "organizations_url": "https://api.github.com/users/Hellsegga/orgs",
      "repos_url": "https://api.github.com/users/Hellsegga/repos",
      "events_url": "https://api.github.com/users/Hellsegga/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Hellsegga/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-18T15:28:37Z",
    "updated_at": "2016-08-18T15:28:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "Here is what I understand from the code:\n- the `import` command ignores the testnet flag and loads the default genesis block (for the production network), and then of course when it tries to import testnet blocks on top of the prod genesis block it fails\n- using the `init` command would work, but there is a small problem here: when testnet is initialized (for instance if you run `geth --testnet`), it does 2 things: it loads the genesis block but it also sets the initial transaction nonce (http://ethereum.stackexchange.com/questions/3215/testnet-first-transaction-nonce), which the `init` command does not seem to do. This nonce makes it into the state trie root because of the allocations made in the genesis file, and since the state trie root is included in the block header it results in a different block hash and thus running `import` after `init` for testnet blocks fails\n\nI'll see if I can propose a fix for this.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/240760307/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/240988387",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2905#issuecomment-240988387",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2905",
    "id": 240988387,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MDk4ODM4Nw==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-19T10:52:40Z",
    "updated_at": "2016-08-19T10:52:40Z",
    "author_association": "MEMBER",
    "body": "Thanks for this. I also notices while developing hive for the fork but didn't have time to fix it. Thanks also for the detailed analysis :)\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/240988387/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/241943286",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2905#issuecomment-241943286",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2905",
    "id": 241943286,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTk0MzI4Ng==",
    "user": {
      "login": "jjmr007",
      "id": 17028457,
      "node_id": "MDQ6VXNlcjE3MDI4NDU3",
      "avatar_url": "https://avatars.githubusercontent.com/u/17028457?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jjmr007",
      "html_url": "https://github.com/jjmr007",
      "followers_url": "https://api.github.com/users/jjmr007/followers",
      "following_url": "https://api.github.com/users/jjmr007/following{/other_user}",
      "gists_url": "https://api.github.com/users/jjmr007/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jjmr007/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jjmr007/subscriptions",
      "organizations_url": "https://api.github.com/users/jjmr007/orgs",
      "repos_url": "https://api.github.com/users/jjmr007/repos",
      "events_url": "https://api.github.com/users/jjmr007/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jjmr007/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-24T02:51:38Z",
    "updated_at": "2016-08-24T02:51:38Z",
    "author_association": "NONE",
    "body": "Thank you!\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/241943286/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/241981564",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2905#issuecomment-241981564",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2905",
    "id": 241981564,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTk4MTU2NA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-24T07:36:03Z",
    "updated_at": "2016-08-24T07:36:03Z",
    "author_association": "MEMBER",
    "body": "Closing as fixed on develop :)\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/241981564/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
