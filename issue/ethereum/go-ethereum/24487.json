{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24487",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24487/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24487/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24487/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/24487",
  "id": 1155144115,
  "node_id": "I_kwDOAOvK985E2hmz",
  "number": 24487,
  "title": "eth/tracers/logger: use omitempty in error JSON tag to avoid unnecessary log bloat",
  "user": {
    "login": "odeke-em",
    "id": 4898263,
    "node_id": "MDQ6VXNlcjQ4OTgyNjM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4898263?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/odeke-em",
    "html_url": "https://github.com/odeke-em",
    "followers_url": "https://api.github.com/users/odeke-em/followers",
    "following_url": "https://api.github.com/users/odeke-em/following{/other_user}",
    "gists_url": "https://api.github.com/users/odeke-em/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/odeke-em/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/odeke-em/subscriptions",
    "organizations_url": "https://api.github.com/users/odeke-em/orgs",
    "repos_url": "https://api.github.com/users/odeke-em/repos",
    "events_url": "https://api.github.com/users/odeke-em/events{/privacy}",
    "received_events_url": "https://api.github.com/users/odeke-em/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-03-01T10:14:21Z",
  "updated_at": "2022-03-29T20:36:56Z",
  "closed_at": "2022-03-29T20:36:56Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `geth version` Not Applicable\r\nOS & Version: Windows/Linux/OSX Not Applicable\r\nCommit hash : 687e4dc8555b3b53fd8d4a4974b8f8f4b594b552\r\n\r\n#### Expected behaviour\r\nLack of error strings should NOT log `\"error\":\"\"` which bloats logs and can actually be confusing when you grep for \"error\" in logs when things are failing.\r\n\r\n#### Actual behaviour\r\nLooking at such logs like\r\n```shell\r\n{\"pc\":4716,\"op\":80,\"gas\":\"0x688e5\",\"gasCost\":\"0x2\",\"memory\":\"0x\",\"memSize\":352,\"stack\":[\"0xfa31de01\",\"0x29a\",\"0x7d0\",\"0xabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcd\",\"0x80\",\"0x534\",\"0xc0\",\"0x5f646b5592c4159d4963fbf901f81144ef53cc51a7082435e3a6120a45002ff7\",\"0x15dc\",\"0x34\",\"0x5f646b5592c4159d4963fbf901f81144ef53cc51a7082435e3a6120a45002ff7\"],\"returnData\":\"0x\",\"depth\":2,\"refund\":0,\"opName\":\"POP\",\"error\":\"\"}\r\n{\"pc\":4717,\"op\":80,\"gas\":\"0x688e3\",\"gasCost\":\"0x2\",\"memory\":\"0x\",\"memSize\":352,\"stack\":[\"0xfa31de01\",\"0x29a\",\"0x7d0\",\"0xabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcd\",\"0x80\",\"0x534\",\"0xc0\",\"0x5f646b5592c4159d4963fbf901f81144ef53cc51a7082435e3a6120a45002ff7\",\"0x15dc\",\"0x34\"],\"returnData\":\"0x\",\"depth\":2,\"refund\":0,\"opName\":\"POP\",\"error\":\"\"}\r\n{\"pc\":4718,\"op\":86,\"gas\":\"0x688e1\",\"gasCost\":\"0x8\",\"memory\":\"0x\",\"memSize\":352,\"stack\":[\"0xfa31de01\",\"0x29a\",\"0x7d0\",\"0xabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcd\",\"0x80\",\"0x534\",\"0xc0\",\"0x5f646b5592c4159d4963fbf901f81144ef53cc51a7082435e3a6120a45002ff7\",\"0x15dc\"],\"returnData\":\"0x\",\"depth\":2,\"refund\":0,\"opName\":\"JUMP\",\"error\":\"\"}\r\n{\"pc\":5596,\"op\":91,\"gas\":\"0x688d9\",\"gasCost\":\"0x1\",\"memory\":\"0x\",\"memSize\":352,\"stack\":[\"0xfa31de01\",\"0x29a\",\"0x7d0\",\"0xabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcd\",\"0x80\",\"0x534\",\"0xc0\",\"0x5f646b5592c4159d4963fbf901f81144ef53cc51a7082435e3a6120a45002ff7\"],\"returnData\":\"0x\",\"depth\":2,\"refund\":0,\"opName\":\"JUMPDEST\",\"error\":\"\"}\r\n{\"pc\":5597,\"op\":97,\"gas\":\"0x688d8\",\"gasCost\":\"0x3\",\"memory\":\"0x\",\"memSize\":352,\"stack\":[\"0xfa31de01\",\"0x29a\",\"0x7d0\",\"0xabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcd\",\"0x80\",\"0x534\",\"0xc0\",\"0x5f646b5592c4159d4963fbf901f81144ef53cc51a7082435e3a6120a45002ff7\"],\"returnData\":\"0x\",\"depth\":2,\"refund\":0,\"opName\":\"PUSH2\",\"error\":\"\"}\r\n{\"pc\":5600,\"op\":97,\"gas\":\"0x688d5\",\"gasCost\":\"0x3\",\"memory\":\"0x\",\"memSize\":352,\"stack\":[\"0xfa31de01\",\"0x29a\",\"0x7d0\",\"0xabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcd\",\"0x80\",\"0x534\",\"0xc0\",\"0x5f646b5592c4159d4963fbf901f81144ef53cc51a7082435e3a6120a45002ff7\",\"0x15ef\"],\"returnData\":\"0x\",\"depth\":2,\"refund\":0,\"opName\":\"PUSH2\",\"error\":\"\"}\r\n{\"pc\":5603,\"op\":97,\"gas\":\"0x688d2\",\"gasCost\":\"0x3\",\"memory\":\"0x\",\"memSize\":352,\"stack\":[\"0xfa31de01\",\"0x29a\",\"0x7d0\",\"0xabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcd\",\"0x80\",\"0x534\",\"0xc0\",\"0x5f646b5592c4159d4963fbf901f81144ef53cc51a7082435e3a6120a45002ff7\",\"0x15ef\",\"0x15e7\"],\"returnData\":\"0x\",\"depth\":2,\"refund\":0,\"opName\":\"PUSH2\",\"error\":\"\"}\r\n```\r\n\r\nNotice that each log line has `\"error\":\"\"` per\r\n<img width=\"714\" alt=\"Screen Shot 2022-03-01 at 12 31 39 PM\" src=\"https://user-images.githubusercontent.com/4898263/156142874-2f925986-537f-4696-a111-ad5431107163.png\">\r\n\r\n\r\n#### Steps to reproduce the behaviour\r\nJust run the tracers\r\n\r\nThis bug was sponsored by Tharsis / evmos.org\r\n",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24487/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24487/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1055504390",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24487#issuecomment-1055504390",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24487",
    "id": 1055504390,
    "node_id": "IC_kwDOAOvK984-6bgG",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-01T14:30:39Z",
    "updated_at": "2022-03-01T14:30:39Z",
    "author_association": "MEMBER",
    "body": "I take it you're using the `evm` command? Because `debug_traceTransaction` already omits empty errors. Anyhow this patch should omit empty errors for `evm` too.\r\n\r\n```patch\r\ndiff --git a/eth/tracers/logger/gen_structlog.go b/eth/tracers/logger/gen_structlog.go\r\nindex 9e71b555c..7818fbe70 100644\r\n--- a/eth/tracers/logger/gen_structlog.go\r\n+++ b/eth/tracers/logger/gen_structlog.go\r\n@@ -30,7 +30,7 @@ func (s StructLog) MarshalJSON() ([]byte, error) {\r\n                RefundCounter uint64                      `json:\"refund\"`\r\n                Err           error                       `json:\"-\"`\r\n                OpName        string                      `json:\"opName\"`\r\n-               ErrorString   string                      `json:\"error\"`\r\n+               ErrorString   string                      `json:\"error,omitempty\"`\r\n        }\r\n        var enc StructLog\r\n        enc.Pc = s.Pc\r\ndiff --git a/eth/tracers/logger/logger.go b/eth/tracers/logger/logger.go\r\nindex 846193582..444a665d6 100644\r\n--- a/eth/tracers/logger/logger.go\r\n+++ b/eth/tracers/logger/logger.go\r\n@@ -82,8 +82,8 @@ type structLogMarshaling struct {\r\n        GasCost     math.HexOrDecimal64\r\n        Memory      hexutil.Bytes\r\n        ReturnData  hexutil.Bytes\r\n-       OpName      string `json:\"opName\"` // adds call to OpName() in MarshalJSON\r\n-       ErrorString string `json:\"error\"`  // adds call to ErrorString() in MarshalJSON\r\n+       OpName      string `json:\"opName\"`          // adds call to OpName() in MarshalJSON\r\n+       ErrorString string `json:\"error,omitempty\"` // adds call to ErrorString() in MarshalJSON\r\n }\r\n\r\n // OpName formats the operand name in a human-readable format.\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1055504390/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
