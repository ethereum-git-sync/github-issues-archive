{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26446",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26446/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26446/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26446/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/26446",
  "id": 1522920712,
  "node_id": "I_kwDOAOvK985axe0I",
  "number": 26446,
  "title": "geth gets killed with OOM",
  "user": {
    "login": "geomad",
    "id": 7707517,
    "node_id": "MDQ6VXNlcjc3MDc1MTc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7707517?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/geomad",
    "html_url": "https://github.com/geomad",
    "followers_url": "https://api.github.com/users/geomad/followers",
    "following_url": "https://api.github.com/users/geomad/following{/other_user}",
    "gists_url": "https://api.github.com/users/geomad/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/geomad/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/geomad/subscriptions",
    "organizations_url": "https://api.github.com/users/geomad/orgs",
    "repos_url": "https://api.github.com/users/geomad/repos",
    "events_url": "https://api.github.com/users/geomad/events{/privacy}",
    "received_events_url": "https://api.github.com/users/geomad/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-01-06T17:40:23Z",
  "updated_at": "2023-08-10T18:05:52Z",
  "closed_at": "2023-01-09T10:59:27Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 1.10.26-stable\r\nGit Commit: e5eb32acee19cc9fca6a03b10283b7484246b15a\r\nOS & Version: Linux\r\nMachine specs: 64 GB ram, AMD 3900x, Gen4 ssd\r\n\r\nSince 2-3 months geth is crashing with OOM every few days. Same behaviour happens on master.\r\n\r\nRevelant startup arguments:\r\n`--cache 21412`\r\n\r\nOOM log:\r\n````\r\nJan 06 20:22:58 server kernel: atopacctd invoked oom-killer: gfp_mask=0x140cca(GFP_HIGHUSER_MOVABLE|__GFP_COMP), order=0, oom_score_adj=0\r\nJan 06 20:22:58 server kernel: CPU: 6 PID: 731 Comm: atopacctd Not tainted 6.0.0-4-amd64 #1  Debian 6.0.8-1\r\nJan 06 20:22:58 server kernel: Hardware name: Gigabyte Technology Co., Ltd. X570 I AORUS PRO WIFI/X570 I AORUS PRO WIFI, BIOS F35 01/04/2022\r\nJan 06 20:22:58 server kernel: Call Trace:\r\nJan 06 20:22:58 server kernel:  <TASK>\r\nJan 06 20:22:58 server kernel:  dump_stack_lvl+0x44/0x5c\r\nJan 06 20:22:58 server kernel:  dump_header+0x4a/0x1ff\r\nJan 06 20:22:58 server kernel:  oom_kill_process.cold+0xb/0x10\r\nJan 06 20:22:58 server kernel:  out_of_memory+0x1fd/0x4d0\r\nJan 06 20:22:58 server kernel:  __alloc_pages_slowpath.constprop.0+0xc6c/0xdb0\r\nJan 06 20:22:58 server kernel:  __alloc_pages+0x305/0x330\r\nJan 06 20:22:58 server kernel:  folio_alloc+0x17/0x50\r\nJan 06 20:22:58 server kernel:  __filemap_get_folio+0x155/0x340\r\nJan 06 20:22:58 server kernel:  filemap_fault+0x13c/0x930\r\nJan 06 20:22:58 server kernel:  ? filemap_map_pages+0x153/0x7b0\r\nJan 06 20:22:58 server kernel:  __do_fault+0x36/0x110\r\nJan 06 20:22:58 server kernel:  do_fault+0x1c2/0x420\r\nJan 06 20:22:58 server kernel:  __handle_mm_fault+0x665/0xf50\r\nJan 06 20:22:58 server kernel:  handle_mm_fault+0xae/0x290\r\nJan 06 20:22:58 server kernel:  do_user_addr_fault+0x1cd/0x690\r\nJan 06 20:22:58 server kernel:  exc_page_fault+0x70/0x170\r\nJan 06 20:22:58 server kernel:  asm_exc_page_fault+0x22/0x30\r\nJan 06 20:22:58 server kernel: RIP: 0033:0x557be747655b\r\nJan 06 20:22:58 server kernel: Code: Unable to access opcode bytes at RIP 0x557be7476531.\r\nJan 06 20:22:58 server kernel: RSP: 002b:00007ffeefaa5f60 EFLAGS: 00010207\r\nJan 06 20:22:58 server kernel: RAX: 0000000000000000 RBX: 0000000000000007 RCX: 00007fb87449c0ed\r\nJan 06 20:22:58 server kernel: RDX: 0000000000003e80 RSI: 00007ffeefaa5fa0 RDI: 0000000000000000\r\nJan 06 20:22:58 server kernel: RBP: 0000000000000000 R08: 0000000000000000 R09: 0000000000000000\r\nJan 06 20:22:58 server kernel: R10: 0000000000000000 R11: 0000000000000246 R12: 00007ffeefaa5fa0\r\nJan 06 20:22:58 server kernel: R13: 00007ffeefaa5f90 R14: 0000000000000000 R15: 0000000000000000\r\nJan 06 20:22:58 server kernel:  </TASK>\r\nJan 06 20:22:58 server kernel: Mem-Info:\r\nJan 06 20:22:58 server kernel: active_anon:1040592 inactive_anon:12825374 isolated_anon:654\r\n                                active_file:68 inactive_file:132 isolated_file:285\r\n                                unevictable:2855 dirty:0 writeback:204\r\n                                slab_reclaimable:768312 slab_unreclaimable:100297\r\n                                mapped:1189 shmem:173 pagetables:1483799 bounce:0\r\n                                kernel_misc_reclaimable:0\r\n                                free:136995 free_pcp:468 free_cma:0\r\nJan 06 20:22:58 server kernel: Node 0 active_anon:4162368kB inactive_anon:51301496kB active_file:272kB inactive_file:528kB unevictable:11420kB isolated(anon):2616kB isolated(file):1140kB mapped:4756kB dirty:0kB writeback:816kB shmem:692kB shmem_thp: 0kB shmem_pmdmapped: 0kB anon_thp: 12414976kB writeback_tmp:0kB kernel_stack:13376kB pagetables:5935196kB all_unreclaimable? no\r\nJan 06 20:22:58 server kernel: Node 0 DMA free:11276kB boost:0kB min:12kB low:24kB high:36kB reserved_highatomic:0KB active_anon:0kB inactive_anon:0kB active_file:0kB inactive_file:0kB unevictable:0kB writepending:0kB present:15996kB managed:15372kB mlocked:0kB bounce:0kB free_pcp:0kB local_pcp:0kB free_cma:0kB\r\nJan 06 20:22:58 server kernel: lowmem_reserve[]: 0 2897 64180 64180 64180\r\nJan 06 20:22:58 server kernel: Node 0 DMA32 free:248144kB boost:0kB min:3048kB low:6012kB high:8976kB reserved_highatomic:0KB active_anon:102220kB inactive_anon:1928584kB active_file:112kB inactive_file:0kB unevictable:0kB writepending:248kB present:3064240kB managed:2998684kB mlocked:0kB bounce:0kB free_pcp:280kB local_pcp:0kB free_cma:0kB\r\nJan 06 20:22:58 server kernel: lowmem_reserve[]: 0 0 61283 61283 61283\r\nJan 06 20:22:58 server kernel: Node 0 Normal free:288560kB boost:285028kB min:349544kB low:412296kB high:475048kB reserved_highatomic:2048KB active_anon:4059660kB inactive_anon:49372632kB active_file:1080kB inactive_file:2408kB unevictable:11420kB writepending:1016kB present:63949824kB managed:62762176kB mlocked:11420kB bounce:0kB free_pcp:1592kB local_pcp:0kB free_cma:0kB\r\nJan 06 20:22:58 server kernel: lowmem_reserve[]: 0 0 0 0 0\r\nJan 06 20:22:58 server kernel: Node 0 DMA: 1*4kB (U) 1*8kB (U) 0*16kB 0*32kB 0*64kB 0*128kB 0*256kB 0*512kB 1*1024kB (U) 1*2048kB (M) 2*4096kB (M) = 11276kB\r\nJan 06 20:22:58 server kernel: Node 0 DMA32: 74*4kB (UE) 164*8kB (UME) 4353*16kB (UME) 704*32kB (UME) 281*64kB (UME) 260*128kB (UME) 135*256kB (UM) 96*512kB (UM) 19*1024kB (M) 0*2048kB 0*4096kB = 248216kB\r\nJan 06 20:22:58 server kernel: Node 0 Normal: 5232*4kB (ME) 1814*8kB (UME) 9123*16kB (ME) 1924*32kB (UME) 31*64kB (M) 43*128kB (M) 47*256kB (M) 61*512kB (M) 0*1024kB 0*2048kB 0*4096kB = 293728kB\r\nJan 06 20:22:58 server kernel: Node 0 hugepages_total=0 hugepages_free=0 hugepages_surp=0 hugepages_size=1048576kB\r\nJan 06 20:22:58 server kernel: Node 0 hugepages_total=0 hugepages_free=0 hugepages_surp=0 hugepages_size=2048kB\r\nJan 06 20:22:58 server kernel: 244420 total pagecache pages\r\nJan 06 20:22:58 server kernel: 242305 pages in swap cache\r\nJan 06 20:22:58 server kernel: Free swap  = 15737340kB\r\nJan 06 20:22:58 server kernel: Total swap = 17825788kB\r\nJan 06 20:22:58 server kernel: 16757515 pages RAM\r\nJan 06 20:22:58 server kernel: 0 pages HighMem/MovableOnly\r\nJan 06 20:22:58 server kernel: 313457 pages reserved\r\nJan 06 20:22:58 server kernel: 0 pages hwpoisoned\r\nJan 06 20:22:58 server kernel: Tasks state (memory values in pages):\r\nJan 06 20:22:58 server kernel: [  pid  ]   uid  tgid total_vm      rss pgtables_bytes swapents oom_score_adj name\r\nJan 06 20:22:58 server kernel: [    731]     0   731      618        6    40960       24             0 atopacctd\r\nJan 06 20:22:58 server kernel: [    733]   104   733     2335       22    53248      197          -900 dbus-daemon\r\nJan 06 20:22:58 server kernel: [    748]  1003   748  2947664     7944  1335296     2900             0 node\r\nJan 06 20:22:58 server kernel: [    752]  1003   752   226190     1978  2646016     9405             0 node\r\nJan 06 20:22:58 server kernel: [    756]     0   756     2862        8    53248      333             0 smartd\r\nJan 06 20:22:58 server kernel: [    760]     0   760    12466       10    90112      287             0 systemd-logind\r\nJan 06 20:22:58 server kernel: [    765]     0   765      895        5    45056       38             0 atd\r\nJan 06 20:22:58 server kernel: [   1047]     0  1047   100226     2565   147456     1594             0 fail2ban-server\r\nJan 06 20:22:58 server kernel: [   1060]     0  1060    40672        3    69632      104             0 apcupsd\r\nJan 06 20:22:58 server kernel: [   1067]     0  1067     1468        0    49152       32             0 agetty\r\nJan 06 20:22:58 server kernel: [   1091]     0  1091     3837       12    69632      322         -1000 sshd\r\nJan 06 20:22:58 server kernel: [   3377]  1004  3377  1450023     5378   823296     7970             0 lighthouse\r\nJan 06 20:22:58 server kernel: [ 696434]  1000 696434    19569        1    53248       82             0 gpg-agent\r\nJan 06 20:22:58 server kernel: [ 997453]     0 997453     1652        6    49152       57             0 cron\r\nJan 06 20:22:58 server kernel: [1693040]  1003 1693040   679839     1446   409600     5018             0 mev-boost\r\nJan 06 20:22:58 server kernel: [1913678]     0 1913678    54673       31   417792      383          -250 systemd-journal\r\nJan 06 20:22:58 server kernel: [1914639]   101 1914639    22511        0    73728      240             0 systemd-timesyn\r\nJan 06 20:22:58 server kernel: [1914677]     0 1914677     6227        5    73728      249         -1000 systemd-udevd\r\nJan 06 20:22:58 server kernel: [1914724]     0 1914724   725115     3851   471040     4345          -999 containerd\r\nJan 06 20:22:58 server kernel: [1914742]     0 1914742   731357     3184   552960     6304          -500 dockerd\r\nJan 06 20:22:58 server kernel: [1927639]  1002 1927639 3032109018   548556 1505775616    69561             0 rpcdaemon\r\nJan 06 20:22:58 server kernel: [1981975]   112 1981975   274090       23   163840     3747             0 prometheus-node\r\nJan 06 20:22:58 server kernel: [2072077]     0 2072077    55448       75    73728      852             0 rsyslogd\r\nJan 06 20:22:58 server kernel: [2278813]  1002 2278813 12183393  8825916 77631488    21680             0 geth\r\nJan 06 20:22:58 server kernel: [2304970]  1001 2304970  3740924   802378 90570752    11480             0 node\r\nJan 06 20:22:58 server kernel: [2305096]  1002 2305096 3912468962  2735732 4379918336   159535             0 erigon\r\nJan 06 20:22:58 server kernel: [2477100]  1002 2477100  3674959   850186 14254080     4300             0 lighthouse\r\nJan 06 20:22:58 server kernel: [2487620]  1003 2487620  5596916    37047  3715072     1404             0 node\r\nJan 06 20:22:58 server kernel: [2499515]     0 2499515     3062     2856    65536        0         -1000 atop\r\nJan 06 20:22:58 server kernel: oom-kill:constraint=CONSTRAINT_NONE,nodemask=(null),cpuset=atopacct.service,mems_allowed=0,global_oom,task_memcg=/system.slice/geth.service,task=geth,pid=2278813,uid=1002\r\nJan 06 20:22:58 server kernel: Out of memory: Killed process 2278813 (geth) total-vm:48733572kB, anon-rss:35303640kB, file-rss:0kB, shmem-rss:0kB, UID:1002 pgtables:75812kB oom_score_adj:0\r\n\r\n````",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26446/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26446/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1375432961",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26446#issuecomment-1375432961",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26446",
    "id": 1375432961,
    "node_id": "IC_kwDOAOvK985R-3EB",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-09T10:59:27Z",
    "updated_at": "2023-01-09T10:59:27Z",
    "author_association": "MEMBER",
    "body": "Go likes to use more memory than permitted (2x more really), since you're running a lot of other things too on your machine, they will all race for the same RAM and something will have to give. I think it's completely fine if you ran Geth with half that memory allowance. Any free memory will be used by the OS for caching anyway, so it's not like you lose out on having it idle.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1375432961/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1646840635",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26446#issuecomment-1646840635",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26446",
    "id": 1646840635,
    "node_id": "IC_kwDOAOvK985iKMs7",
    "user": {
      "login": "geomad",
      "id": 7707517,
      "node_id": "MDQ6VXNlcjc3MDc1MTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7707517?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/geomad",
      "html_url": "https://github.com/geomad",
      "followers_url": "https://api.github.com/users/geomad/followers",
      "following_url": "https://api.github.com/users/geomad/following{/other_user}",
      "gists_url": "https://api.github.com/users/geomad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/geomad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/geomad/subscriptions",
      "organizations_url": "https://api.github.com/users/geomad/orgs",
      "repos_url": "https://api.github.com/users/geomad/repos",
      "events_url": "https://api.github.com/users/geomad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/geomad/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-23T13:26:14Z",
    "updated_at": "2023-07-23T13:26:14Z",
    "author_association": "NONE",
    "body": "@karalabe this keeps happening lately, even with `--cache 12288` . I used to run it successfully with `--cache  32768` and then with `--cache  21412` without issues. Ram keeps growing for 3 days until geth crashes, so I wanted to confirm that this is normal? My ram is 64gb.\r\n\r\n![geth](https://github.com/ethereum/go-ethereum/assets/7707517/fccf5005-f7ce-4e11-bf91-fe66f1227cbc)\r\n```\r\n systemd invoked oom-killer: gfp_mask=0x140cca(GFP_HIGHUSER_MOVABLE|__GFP_COMP), order=0, oom_score_adj=0\r\n CPU: 0 PID: 1 Comm: systemd Not tainted 6.1.0-9-amd64 #1  Debian 6.1.27-1\r\n Hardware name: Gigabyte Technology Co., Ltd. X570 I AORUS PRO WIFI/X570 I AORUS PRO WIFI, BIOS F35 01/04/2022\r\n Call Trace:\r\n  <TASK>\r\n  dump_stack_lvl+0x44/0x5c\r\n  dump_header+0x4a/0x211\r\n  oom_kill_process.cold+0xb/0x10\r\n  out_of_memory+0x1fd/0x4c0\r\n  __alloc_pages_slowpath.constprop.0+0xc73/0xdc0\r\n  __alloc_pages+0x305/0x330\r\n  folio_alloc+0x17/0x50\r\n  __filemap_get_folio+0x155/0x340\r\n  filemap_fault+0x139/0x910\r\n  ? filemap_map_pages+0x150/0x6e0\r\n  __do_fault+0x33/0x110\r\n  do_fault+0x1b9/0x410\r\n  __handle_mm_fault+0x660/0xfa0\r\n  handle_mm_fault+0xdb/0x2d0\r\n  do_user_addr_fault+0x1cd/0x690\r\n  exc_page_fault+0x70/0x170\r\n  asm_exc_page_fault+0x22/0x30\r\n RIP: 0033:0x7faea4670d90\r\n Code: Unable to access opcode bytes at 0x7faea4670d66.\r\n RSP: 002b:00007ffe1e8484c8 EFLAGS: 00010293\r\n RAX: 0000000000000007 RBX: 00007ffe1e8484d0 RCX: 00000000fffffe00\r\n RDX: 0000000000000009 RSI: 00007ffe1e8484d0 RDI: 0000000000000000\r\n RBP: 0000000000000000 R08: 0000000000000000 R09: 174e378a4ec751f5\r\n R10: 21e613183e04e5c9 R11: 0000000000000293 R12: 00005647c00a08c0\r\n R13: 0000000000000000 R14: 0000000000000000 R15: 0000000000000000\r\n  </TASK>\r\n Mem-Info:\r\n active_anon:703581 inactive_anon:13298469 isolated_anon:0\r\n  active_file:572 inactive_file:222 isolated_file:0\r\n  unevictable:2596 dirty:0 writeback:202\r\n  slab_reclaimable:668488 slab_unreclaimable:77394\r\n  mapped:1191 shmem:77 pagetables:1503874\r\n  sec_pagetables:0 bounce:0\r\n  kernel_misc_reclaimable:0\r\n  free:127416 free_pcp:98 free_cma:0\r\n Node 0 active_anon:2814324kB inactive_anon:53193876kB active_file:2288kB inactive_file:888kB unevictable:10384kB isolated(anon):0kB isolated(file):0kB mapped:4764kB dirty:0kB writeback:808kB shmem:308kB shmem_thp: 0kB shmem_pmdmapped: 0kB anon_thp: 11950080kB writeback_tmp:0kB kernel_stack:15408kB pagetables:6015496kB sec_pagetables:0kB all_unreclaimable? no\r\n Node 0 DMA free:11276kB boost:0kB min:12kB low:24kB high:36kB reserved_highatomic:0KB active_anon:0kB inactive_anon:0kB active_file:0kB inactive_file:0kB unevictable:0kB writepending:0kB present:15996kB managed:15372kB mlocked:0kB bounce:0kB free_pcp:0kB local_pcp:0kB free_cma:0kB\r\n lowmem_reserve[]: 0 2898 64167 64167 64167\r\n Node 0 DMA32 free:248128kB boost:0kB min:3052kB low:6020kB high:8988kB reserved_highatomic:0KB active_anon:333092kB inactive_anon:2326032kB active_file:0kB inactive_file:28kB unevictable:0kB writepending:0kB present:3064240kB managed:2998696kB mlocked:0kB bounce:0kB free_pcp:0kB local_pcp:0kB free_cma:0kB\r\n lowmem_reserve[]: 0 0 61269 61269 61269\r\n Node 0 Normal free:250260kB boost:284672kB min:349184kB low:411920kB high:474656kB reserved_highatomic:10240KB active_anon:2480220kB inactive_anon:50867040kB active_file:0kB inactive_file:1528kB unevictable:10384kB writepending:1008kB present:63949824kB managed:62748000kB mlocked:10384kB bounce:0kB free_pcp:392kB local_pcp:0kB free_cma:0kB\r\n lowmem_reserve[]: 0 0 0 0 0\r\n Node 0 DMA: 1*4kB (U) 1*8kB (U) 0*16kB 0*32kB 0*64kB 0*128kB 0*256kB 0*512kB 1*1024kB (U) 1*2048kB (M) 2*4096kB (M) = 11276kB\r\n Node 0 DMA32: 1354*4kB (UM) 1461*8kB (UME) 2601*16kB (UME) 880*32kB (UME) 553*64kB (UME) 304*128kB (UME) 110*256kB (UME) 31*512kB (UME) 4*1024kB (UM) 17*2048kB (M) 1*4096kB (M) = 248224kB\r\n Node 0 Normal: 7548*4kB (UME) 128*8kB (ME) 8432*16kB (UME) 2783*32kB (UME) 1*64kB (M) 1*128kB (M) 0*256kB 0*512kB 0*1024kB 0*2048kB 0*4096kB = 255376kB\r\n Node 0 hugepages_total=0 hugepages_free=0 hugepages_surp=0 hugepages_size=1048576kB\r\n Node 0 hugepages_total=0 hugepages_free=0 hugepages_surp=0 hugepages_size=2048kB\r\n 224179 total pagecache pages\r\n 221955 pages in swap cache\r\n Free swap  = 14497276kB\r\n Total swap = 17825788kB\r\n 16757515 pages RAM\r\n 0 pages HighMem/MovableOnly\r\n 316998 pages reserved\r\n 0 pages hwpoisoned\r\n Tasks state (memory values in pages):\r\n [  pid  ]   uid  tgid total_vm      rss pgtables_bytes swapents oom_score_adj name\r\n [    766]   104   766     2368        1    57344      231          -900 dbus-daemon\r\n [    775]     0   775     2869        1    61440      340             0 smartd\r\n [    776]     0   776    12488       29    90112      287             0 systemd-logind\r\n [   1007]     0  1007   104039     4774   176128     3534             0 fail2ban-server\r\n [   1014]  1005  1014   181968     2410   139264     2156             0 node_exporter\r\n [   1016]   112  1016   599057    20530  1396736     3740             0 prometheus\r\n [   1028]     0  1028   505635     1518   364544     5208          -999 containerd\r\n [   1030]     0  1030    40672       14    73728       92             0 apcupsd\r\n [   1039]     0  1039     1468        0    49152       33             0 agetty\r\n [ 256677]  1003 256677   682213     1543   417792     6110             0 mev-boost\r\n [ 293568]  1002 293568 1446843092  1146962 2747863040    38985             0 rpcdaemon\r\n [ 295851]  1003 295851  2946741     6147  1114112     2824             0 node\r\n [ 328656]  1004 328656   597194     4451   483328     5512             0 lighthouse\r\n [ 333440]     0 333440    56434        0    65536       93             0 gpg-agent\r\n [ 334510]  1000 334510    19568        1    53248       84             0 gpg-agent\r\n [ 335577]     0 335577     3856        0    69632      330         -1000 sshd\r\n [ 335845]     0 335845     1653        8    49152       54             0 cron\r\n [ 337663]  1002 337663   409826    31970   634880    15728             0 executionbackup\r\n [ 337695]  1002 337695  4691828  1521658 21884928   125104             0 lighthouse\r\n [ 344928]     0 344928      619        9    45056       21             0 atopacctd\r\n [ 377091]     0 377091    60780      267   434176      430          -250 systemd-journal\r\n [ 377678]     0 377678      896        0    40960       42             0 atd\r\n [ 378265]   101 378265    22532       15    73728      225             0 systemd-timesyn\r\n [ 378298]     0 378298     6277       11    65536      241         -1000 systemd-udevd\r\n [ 378368]   109 378368   776598    28371   806912     4020             0 grafana\r\n [ 387196]  1002 387196  7111324  5698694 50085888   201743             0 geth\r\n [ 387328]  1003 387328   226582     8806  2605056     2990             0 bot\r\n [ 403895]  1002 403895 2080997953  4622857 3220021248   138823             0 erigon\r\n [ 404018]  1001 404018  3308343   319098 43225088    46545             0 node\r\n [ 408756]     0 408756    94479      471   114688      571             0 rsyslogd\r\n [ 415646]  1003 415646  2954192    11489  1818624     3430             0 node\r\n [ 423063]  1003 423063  6124209   487906 67805184    75859             0 node\r\n [ 426721]     0 426721     2819     2598    61440        0         -1000 atop\r\n oom-kill:constraint=CONSTRAINT_NONE,nodemask=(null),cpuset=init.scope,mems_allowed=0,global_oom,task_memcg=/system.slice/geth.service,task=geth,pid=387196,uid=1002\r\n Out of memory: Killed process 387196 (geth) total-vm:28445296kB, anon-rss:22794776kB, file-rss:0kB, shmem-rss:0kB, UID:1002 pgtables:48912kB oom_score_adj:0\r\n\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1646840635/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1673669998",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26446#issuecomment-1673669998",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26446",
    "id": 1673669998,
    "node_id": "IC_kwDOAOvK985jwi1u",
    "user": {
      "login": "nuliknol",
      "id": 1125368,
      "node_id": "MDQ6VXNlcjExMjUzNjg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1125368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nuliknol",
      "html_url": "https://github.com/nuliknol",
      "followers_url": "https://api.github.com/users/nuliknol/followers",
      "following_url": "https://api.github.com/users/nuliknol/following{/other_user}",
      "gists_url": "https://api.github.com/users/nuliknol/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nuliknol/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nuliknol/subscriptions",
      "organizations_url": "https://api.github.com/users/nuliknol/orgs",
      "repos_url": "https://api.github.com/users/nuliknol/repos",
      "events_url": "https://api.github.com/users/nuliknol/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nuliknol/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-10T18:02:36Z",
    "updated_at": "2023-08-10T18:02:36Z",
    "author_association": "NONE",
    "body": "I was trying to make geth + beacon-chain to run on 16GB and 32GB servers and I wasn't able to. The reason: geth (or beacon-chain) process was killed by oom_reaper kernel thread. After studying the oom-kill and trying to configure it the way that it doesn't kill my processes I failed. Maybe I should read more docs, but I decided not to waste time on it and I patched my kernel to disable oom-kill completely. The only thing you need is to modify mm/oom_kill.c file making this function to look like this:\r\n\r\n```\r\n/* return true if the task is not adequate as candidate victim task. */\r\nstatic bool oom_unkillable_task(struct task_struct *p)\r\n{\r\n        if (is_global_init(p))\r\n                return true;\r\n        if (p->flags & PF_KTHREAD)\r\n                return true;\r\n        return true;  <-- I hardcoded this from \"false\" to \"true\"\r\n}\r\n```\r\n\r\nI also extended swap partition to 8 times the memory , being 128GB. After rebooting and running geth for a few days the 32GB server has successfully synced, no panics, no oom-problems. Everything works perfectly. The swap is only used in about 12GB . The other server , with 16GB RAM is still syncing, but I bet it will also successfully sync , it just needs more time.\r\n\r\nThe only disadvantage in this approach is that if any process starts consuming the memory without control the server will stall and you will have to reboot it manually.  Don't forget to have enough space in your swap partition if you want to try it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1673669998/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1673674588",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26446#issuecomment-1673674588",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26446",
    "id": 1673674588,
    "node_id": "IC_kwDOAOvK985jwj9c",
    "user": {
      "login": "nuliknol",
      "id": 1125368,
      "node_id": "MDQ6VXNlcjExMjUzNjg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1125368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nuliknol",
      "html_url": "https://github.com/nuliknol",
      "followers_url": "https://api.github.com/users/nuliknol/followers",
      "following_url": "https://api.github.com/users/nuliknol/following{/other_user}",
      "gists_url": "https://api.github.com/users/nuliknol/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nuliknol/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nuliknol/subscriptions",
      "organizations_url": "https://api.github.com/users/nuliknol/orgs",
      "repos_url": "https://api.github.com/users/nuliknol/repos",
      "events_url": "https://api.github.com/users/nuliknol/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nuliknol/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-10T18:05:52Z",
    "updated_at": "2023-08-10T18:05:52Z",
    "author_association": "NONE",
    "body": ">  Ram keeps growing for 3 days until geth crashes, so I wanted to confirm that this is normal? My ram is 64gb.\r\n\r\n@geomad disable the `oom_reaper` completely like I did, and check if it works, make sure your swap is 2 times the RAM size",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1673674588/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
