{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21524",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21524/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21524/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21524/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/21524",
  "id": 695024668,
  "node_id": "MDU6SXNzdWU2OTUwMjQ2Njg=",
  "number": 21524,
  "title": "Docs: update the metrics page",
  "user": {
    "login": "MariusVanDerWijden",
    "id": 16664698,
    "node_id": "MDQ6VXNlcjE2NjY0Njk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MariusVanDerWijden",
    "html_url": "https://github.com/MariusVanDerWijden",
    "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
    "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
    "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
    "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
    "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
    "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 268304226,
      "node_id": "MDU6TGFiZWwyNjgzMDQyMjY=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:docs",
      "name": "type:docs",
      "color": "fef2c0",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "MariusVanDerWijden",
    "id": 16664698,
    "node_id": "MDQ6VXNlcjE2NjY0Njk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MariusVanDerWijden",
    "html_url": "https://github.com/MariusVanDerWijden",
    "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
    "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
    "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
    "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
    "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
    "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-09-07T11:53:47Z",
  "updated_at": "2021-01-28T12:05:19Z",
  "closed_at": "2021-01-28T12:04:27Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Just a reminder so I don't forget, we have to move and update the documentation for the metrics.\r\nDraft:\r\n(docs/_interface/metrics.md)\r\n\r\n\r\n---\r\ntitle: Metrics\r\nsort_key: C\r\n---\r\n\r\n## Meters and Timers\r\n\r\nNote, metrics collection is disabled by default in order not to incur reporting overhead for the average user. To enable it please specify the `--metrics` flag to geth.\r\n\r\nGeth has quite a nice logging system, capable of creating leveled log entries tagged with various parts of the system. This helps enormously during debugging to see exactly what the system is doing, what branches it's taking, etc. However, logs are not particularly useful when the system does work correctly, just not very optimally: one - or even a  handful - of logged events is not really statistically relevant, and tracing more in log files can quickly become unwieldy.\r\n\r\nThe goal of the Geth metrics system is that - similar to logs - we should be able to add arbitrary metric collection to any part of the code without requiring fancy constructs to analyze them (counter variables, public interfaces, crossing over the APIs, console hooks, etc). Instead, we should just \"update\" metrics whenever and wherever needed, and have them automatically collected, surfaced through the APIs, queryable and visualizable for analysis.\r\n\r\nTo that extent, Geth currently implement two types of metrics:\r\n * **Meters**: Analogous to physical meters (electricity, water, etc), they are capable of measuring the *amount* of \"things\" that pass through and at the *rate* at which they do that. A meter doesn't have a specific unit of measure (byte, block, malloc, etc), it just counts arbitrary *events*. At any point in time it can report:\r\n   * *Total number of events* that passed through the meter\r\n   * *Mean throughput rate* of the meter since startup (events / second)\r\n   * *Weighted throughput rate* in the last *1*, *5* and *15* minutes (events / second)\r\n     * (*\"weighted\" means that recent seconds count more that in older ones*)\r\n * **Timers**: Extension of *meters*, where not only the occurrence of some event is measured, its *duration* is also collected. Similarly to meters, a timer can also measure arbitrary events, but each requires a duration to be assigned individually. Beside **all** the reports a meter can generate, a timer has additionally:\r\n   * *Percentiles (5, 20, 50, 80, 95)*, reporting that some percentage of the events took less than the reported time to execute (*e.g. Percentile 20 = 1.5s would mean that 20% of the measured events took less time than 1.5 seconds to execute; inherently 80%(=100%-20%) took more that 1.5s*)\r\n     * Percentile 5: minimum durations (this is as fast as it gets)\r\n     * Percentile 50: well behaved samples (boring, just to give an idea)\r\n     * Percentile 80: general performance (these should be optimised)\r\n     * Percentile 95: worst case outliers (rare, just handle gracefully)\r\n\r\n## Creating and updating metrics\r\n\r\nMetrics can be added easily in the code:\r\n\r\n```go\r\nmeter := metrics.NewMeter(\"system/memory/allocs\")\r\ntimer := metrics.NewTimer(\"chain/inserts\")\r\n```\r\n\r\nThe name can be any arbitrary string, however since Geth assumes it to be some meaningful sub-system hierarchy, please name accordingly. Metrics can then be updated equally simply:\r\n\r\n```go\r\nmeter.Mark(n) // Record the occurrence of `n` events\r\n\r\ntimer.Update(duration)  // Record an event that took `duration`\r\ntimer.UpdateSince(time) // Record an event that started at `time`\r\ntimer.Time(function)    // Measure and record the execution of `function`\r\n```\r\n\r\n## Querying metrics\r\n\r\nGeth exposes all collected metrics at `127.0.0.1:6060/debug/metrics`. \r\nFor collecting metrics you need to add the `--metrics` flag. In order to start the metric server you need to specify the `--metrics.addr` flag. \r\n\r\nGeth also supports dumping metrics directly into an influx database. In order to activate this, you need to specify the `--metrics.influxdb` flag. You can specify the API endpoint as well as password and username and other influxdb tags.\r\n\r\n\r\n## Available metrics\r\n\r\nMetrics are a debugging tool, with every developer being free to add, remove or modify them as seen fit. As they can change between commits, the exactly available ones can be queried by opening `127.0.0.1:6060/debug/metrics` in your browser. A few however may warrant longevity, so feel free to add to the below list if you feel it's worth a more general audience:\r\n\r\n * system/\r\n    * memory/\r\n        * allocs: number of memory allocations made\r\n        * used: amount of memory currently used\r\n        * held: memory allocated on the heap\r\n        * pauses: garbage collector pauses\r\n        * frees: number of memory allocations freed\r\n    * cpu/\r\n        * sysload: time spent by CPU on all processes\r\n        * syswait: time spent waiting on disk i/o\r\n        * procload: time spent by CPU on this process\r\n        * threads: number of threads\r\n        * goroutines: number of goroutines\r\n    * disk/\r\n        * readcount: number of read operations\r\n        * readdata: total number of bytes read\r\n        * readbytes: counter of bytes read\r\n        * writecount: number of write operations\r\n        * writedata: total number of bytes written\r\n        * writebytes: counter of bytes written\r\n\r\n* rpc/\r\n    * requests: number of requests\r\n    * success: number of successful requests\r\n    * failure: number of failed requests\r\n\r\n* chain/\r\n    * reorg/\r\n        * drop: blocks dropped by reorg\r\n        * add: blocks added by reorg\r\n    * head/\r\n        * block: currently newest block\r\n        * header: currently newest header\r\n        * receipt: currently newest receipt\r\n\r\n* p2p/\r\n    * peers: number of connected peers\r\n    * ingress: inbound traffic in bytes\r\n    * egress: outbound traffic in bytes\r\n\r\n* txpool/\r\n    * pending: currently pending transactions\r\n    * local: number of transactions send from this node\r\n    \r\n\r\n\r\n\r\n",
  "closed_by": {
    "login": "MariusVanDerWijden",
    "id": 16664698,
    "node_id": "MDQ6VXNlcjE2NjY0Njk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MariusVanDerWijden",
    "html_url": "https://github.com/MariusVanDerWijden",
    "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
    "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
    "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
    "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
    "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
    "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21524/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21524/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/769008976",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21524#issuecomment-769008976",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21524",
    "id": 769008976,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2OTAwODk3Ng==",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-28T12:05:19Z",
    "updated_at": "2021-01-28T12:05:19Z",
    "author_association": "MEMBER",
    "body": "resolved in https://github.com/ethereum/go-ethereum/pull/22030",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/769008976/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
