{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23752",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23752/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23752/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23752/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23752",
  "id": 1028030512,
  "node_id": "I_kwDOAOvK9849RoAw",
  "number": 23752,
  "title": "Sim backend returns 1 for SuggestGasPrice not Basefee",
  "user": {
    "login": "MariusVanDerWijden",
    "id": 16664698,
    "node_id": "MDQ6VXNlcjE2NjY0Njk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MariusVanDerWijden",
    "html_url": "https://github.com/MariusVanDerWijden",
    "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
    "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
    "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
    "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
    "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
    "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-10-16T11:54:20Z",
  "updated_at": "2022-02-21T20:05:07Z",
  "closed_at": "2021-11-03T13:01:22Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "```go\r\n// SuggestGasPrice implements ContractTransactor.SuggestGasPrice. Since the simulated\r\n// chain doesn't have miners, we just return a gas price of 1 for any call.\r\nfunc (b *SimulatedBackend) SuggestGasPrice(ctx context.Context) (*big.Int, error) {\r\n\treturn big.NewInt(1), nil\r\n}\r\n```\r\n-> Does not work post 1559, just return `pendingBlock.Header.Basefee` or something",
  "closed_by": {
    "login": "MariusVanDerWijden",
    "id": 16664698,
    "node_id": "MDQ6VXNlcjE2NjY0Njk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MariusVanDerWijden",
    "html_url": "https://github.com/MariusVanDerWijden",
    "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
    "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
    "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
    "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
    "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
    "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23752/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23752/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/945153174",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23752#issuecomment-945153174",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23752",
    "id": 945153174,
    "node_id": "IC_kwDOAOvK9844VeSW",
    "user": {
      "login": "Sparty",
      "id": 3923604,
      "node_id": "MDQ6VXNlcjM5MjM2MDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3923604?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sparty",
      "html_url": "https://github.com/Sparty",
      "followers_url": "https://api.github.com/users/Sparty/followers",
      "following_url": "https://api.github.com/users/Sparty/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sparty/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sparty/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sparty/subscriptions",
      "organizations_url": "https://api.github.com/users/Sparty/orgs",
      "repos_url": "https://api.github.com/users/Sparty/repos",
      "events_url": "https://api.github.com/users/Sparty/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sparty/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-17T16:20:11Z",
    "updated_at": "2021-10-17T16:20:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "Can I work on this?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/945153174/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/945189226",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23752#issuecomment-945189226",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23752",
    "id": 945189226,
    "node_id": "IC_kwDOAOvK9844VnFq",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-17T20:24:36Z",
    "updated_at": "2021-10-17T20:24:36Z",
    "author_association": "MEMBER",
    "body": "Sure!\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/945189226/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/959014495",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23752#issuecomment-959014495",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23752",
    "id": 959014495,
    "node_id": "IC_kwDOAOvK9845KWZf",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-03T13:01:22Z",
    "updated_at": "2021-11-03T13:01:22Z",
    "author_association": "MEMBER",
    "body": "fixed",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/959014495/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1047193690",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23752#issuecomment-1047193690",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23752",
    "id": 1047193690,
    "node_id": "IC_kwDOAOvK984-auha",
    "user": {
      "login": "deitch",
      "id": 282526,
      "node_id": "MDQ6VXNlcjI4MjUyNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/282526?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/deitch",
      "html_url": "https://github.com/deitch",
      "followers_url": "https://api.github.com/users/deitch/followers",
      "following_url": "https://api.github.com/users/deitch/following{/other_user}",
      "gists_url": "https://api.github.com/users/deitch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/deitch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/deitch/subscriptions",
      "organizations_url": "https://api.github.com/users/deitch/orgs",
      "repos_url": "https://api.github.com/users/deitch/repos",
      "events_url": "https://api.github.com/users/deitch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/deitch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-21T20:05:06Z",
    "updated_at": "2022-02-21T20:05:06Z",
    "author_association": "NONE",
    "body": "I just stumbled across this. Given that this is a simulated backend, how is the original base fee set? I am doing a simple chain creation and getting a base fee of some absurdly high number, something like 875000000.\r\n\r\nWhat particularly threw me off was the function description:\r\n\r\n> SuggestGasPrice implements ContractTransactor.SuggestGasPrice. Since the simulated chain doesn't have miners, we just return a gas price of 1 for any call.\r\n\r\nThat definitely is not 1.\r\n\r\nI am not doing anything fancy, as simple as:\r\n\r\n```go\r\n\tprivateKey, err := crypto.GenerateKey()\r\n\tif err != nil {\r\n\t\treturn nil, err\r\n\t}\r\n\r\n\tauth, err := bind.NewKeyedTransactorWithChainID(privateKey, big.NewInt(1337))\r\n\tif err != nil {\r\n\t\treturn nil, err\r\n\t}\r\n\r\n\tbalance := new(big.Int)\r\n\tbalance.SetString(\"10000000000000000000\", 10) // 10 eth in wei\r\n\r\n\taddress := auth.From\r\n\tgenesisAlloc := map[common.Address]core.GenesisAccount{\r\n\t\taddress: {\r\n\t\t\tBalance: balance,\r\n\t\t},\r\n\t}\r\n\r\n\tblockGasLimit := uint64(4712388)\r\n\tclient := backends.NewSimulatedBackend(genesisAlloc, blockGasLimit)\r\n```\r\n\r\nStepping through, it looks like it creates it [here](https://github.com/ethereum/go-ethereum/blob/afe344bcf31bfb477a6e1ad5b862a70fc5c1a22b/accounts/abi/bind/backends/simulated.go#L78-L91) as part of `NewSimulatedBackendWithDatabase`, specifically as part of the `core.Genesis`, which has an option to set the `BaseFee` (but is unused here), which then is inherited in `core.NewBlockChain()`. I think.\r\n\r\n```go\r\nfunc NewSimulatedBackendWithDatabase(database ethdb.Database, alloc core.GenesisAlloc, gasLimit uint64) *SimulatedBackend {\r\n\tgenesis := core.Genesis{Config: params.AllEthashProtocolChanges, GasLimit: gasLimit, Alloc: alloc}\r\n\tgenesis.MustCommit(database)\r\n\tblockchain, _ := core.NewBlockChain(database, nil, genesis.Config, ethash.NewFaker(), vm.Config{}, nil, nil)\r\n\r\n\tbackend := &SimulatedBackend{\r\n\t\tdatabase:   database,\r\n\t\tblockchain: blockchain,\r\n\t\tconfig:     genesis.Config,\r\n\t\tevents:     filters.NewEventSystem(&filterBackend{database, blockchain}, false),\r\n\t}\r\n\tbackend.rollback(blockchain.CurrentBlock())\r\n\treturn backend\r\n}\r\n```\r\n\r\nIs this a bug in how `SuggestGasPrice()` works? Am I setting up the chain incorrectly? Or is it that it needs some option that is missing?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1047193690/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
