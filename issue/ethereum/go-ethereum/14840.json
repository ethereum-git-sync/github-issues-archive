{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14840",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14840/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14840/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14840/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/14840",
  "id": 244550855,
  "node_id": "MDU6SXNzdWUyNDQ1NTA4NTU=",
  "number": 14840,
  "title": "Port chain events over to Feed",
  "user": {
    "login": "tailingchen",
    "id": 18319268,
    "node_id": "MDQ6VXNlcjE4MzE5MjY4",
    "avatar_url": "https://avatars.githubusercontent.com/u/18319268?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tailingchen",
    "html_url": "https://github.com/tailingchen",
    "followers_url": "https://api.github.com/users/tailingchen/followers",
    "following_url": "https://api.github.com/users/tailingchen/following{/other_user}",
    "gists_url": "https://api.github.com/users/tailingchen/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tailingchen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tailingchen/subscriptions",
    "organizations_url": "https://api.github.com/users/tailingchen/orgs",
    "repos_url": "https://api.github.com/users/tailingchen/repos",
    "events_url": "https://api.github.com/users/tailingchen/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tailingchen/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2017-07-21T02:56:13Z",
  "updated_at": "2017-09-22T17:58:12Z",
  "closed_at": "2017-09-22T17:57:54Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "According to [comment](https://github.com/ethereum/go-ethereum/pull/14808#issuecomment-315699891), I think it’s a good change to replace all `TypeMux` to `Feed`. I’m willing to do this and have some ideas.\r\nDue to a `Feed` can only be used with a single type. I’d like to add `FeedPool` to maintain all feeds have subscribed, like the following:\r\n```\r\ntype FeedPool struct {\r\n        ...\r\n        mu    sync.RWMutex\r\n        feeds map[reflect.Type]*Feed\r\n}\r\n```\r\nIn this way, we can subscribe and send any events through one `FeedPool` instead of passing many Feed to a function.\r\nAny comments and suggestions are welcome.",
  "closed_by": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14840/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14840/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/316889545",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14840#issuecomment-316889545",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14840",
    "id": 316889545,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjg4OTU0NQ==",
    "user": {
      "login": "yutelin",
      "id": 1516485,
      "node_id": "MDQ6VXNlcjE1MTY0ODU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1516485?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yutelin",
      "html_url": "https://github.com/yutelin",
      "followers_url": "https://api.github.com/users/yutelin/followers",
      "following_url": "https://api.github.com/users/yutelin/following{/other_user}",
      "gists_url": "https://api.github.com/users/yutelin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yutelin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yutelin/subscriptions",
      "organizations_url": "https://api.github.com/users/yutelin/orgs",
      "repos_url": "https://api.github.com/users/yutelin/repos",
      "events_url": "https://api.github.com/users/yutelin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yutelin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-21T03:05:15Z",
    "updated_at": "2017-07-21T03:05:15Z",
    "author_association": "NONE",
    "body": "TypeMux causes performance issues since it centralizes all event handling in one place.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/316889545/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/316890748",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14840#issuecomment-316890748",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14840",
    "id": 316890748,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNjg5MDc0OA==",
    "user": {
      "login": "tailingchen",
      "id": 18319268,
      "node_id": "MDQ6VXNlcjE4MzE5MjY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/18319268?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tailingchen",
      "html_url": "https://github.com/tailingchen",
      "followers_url": "https://api.github.com/users/tailingchen/followers",
      "following_url": "https://api.github.com/users/tailingchen/following{/other_user}",
      "gists_url": "https://api.github.com/users/tailingchen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tailingchen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tailingchen/subscriptions",
      "organizations_url": "https://api.github.com/users/tailingchen/orgs",
      "repos_url": "https://api.github.com/users/tailingchen/repos",
      "events_url": "https://api.github.com/users/tailingchen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tailingchen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-21T03:14:44Z",
    "updated_at": "2017-07-21T03:15:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think `centralizing all event handling in one place` is not a quite big problem.  The issue of `TypeMux` is that subscriptions of the same event might wait for each other due to the channel of the subscription is full while `TypeMux` delivers events.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/316890748/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/317691479",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14840#issuecomment-317691479",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14840",
    "id": 317691479,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNzY5MTQ3OQ==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-25T10:05:17Z",
    "updated_at": "2017-07-25T10:37:19Z",
    "author_association": "MEMBER",
    "body": "An issue with `TypeMux` (unrelated to the blocking send) is that it is passed around as an object. This obscures dependencies between components because once an object has reference to the `TypeMux`, it can subscribe to any event type.\r\n\r\nThe original motivation for `Feed` was that this should change so that subscribers should track the *producer* of the events (e.g. to get chain events, the consumer should call `SubscribeXXX` on the `BlockChain` object). You can see an example [here](https://github.com/ethereum/go-ethereum/issues/1867#issuecomment-233182850).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/317691479/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/317708605",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14840#issuecomment-317708605",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14840",
    "id": 317708605,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNzcwODYwNQ==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-25T11:24:54Z",
    "updated_at": "2017-07-25T11:24:54Z",
    "author_association": "MEMBER",
    "body": "To be more clear: I think `FeedPool` is not a good solution. Instead, we should focus on removing uses of `TypeMux` where possible, adding `SubscribeXXX` methods for individual events and calling them. This can happen across multiple small PRs.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/317708605/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/317709399",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14840#issuecomment-317709399",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14840",
    "id": 317709399,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMxNzcwOTM5OQ==",
    "user": {
      "login": "tailingchen",
      "id": 18319268,
      "node_id": "MDQ6VXNlcjE4MzE5MjY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/18319268?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tailingchen",
      "html_url": "https://github.com/tailingchen",
      "followers_url": "https://api.github.com/users/tailingchen/followers",
      "following_url": "https://api.github.com/users/tailingchen/following{/other_user}",
      "gists_url": "https://api.github.com/users/tailingchen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tailingchen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tailingchen/subscriptions",
      "organizations_url": "https://api.github.com/users/tailingchen/orgs",
      "repos_url": "https://api.github.com/users/tailingchen/repos",
      "events_url": "https://api.github.com/users/tailingchen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tailingchen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-07-25T11:28:55Z",
    "updated_at": "2017-07-25T11:28:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "@fjl Thanks for your suggestions. As your said, the `FeedPool` is not a proper design. I will try `SubscriptionScope` to manage multiple subscriptions in  component. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/317709399/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/331518264",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14840#issuecomment-331518264",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14840",
    "id": 331518264,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzMTUxODI2NA==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-09-22T17:58:11Z",
    "updated_at": "2017-09-22T17:58:11Z",
    "author_association": "MEMBER",
    "body": "Done in 1.7.0. Thank you so much!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/331518264/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
