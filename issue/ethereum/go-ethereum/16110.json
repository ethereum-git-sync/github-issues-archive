{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16110",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16110/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16110/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16110/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/16110",
  "id": 297906703,
  "node_id": "MDU6SXNzdWUyOTc5MDY3MDM=",
  "number": 16110,
  "title": "Topics in messages are ignored in filters from shh console",
  "user": {
    "login": "pablochacin",
    "id": 720259,
    "node_id": "MDQ6VXNlcjcyMDI1OQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/720259?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pablochacin",
    "html_url": "https://github.com/pablochacin",
    "followers_url": "https://api.github.com/users/pablochacin/followers",
    "following_url": "https://api.github.com/users/pablochacin/following{/other_user}",
    "gists_url": "https://api.github.com/users/pablochacin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pablochacin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pablochacin/subscriptions",
    "organizations_url": "https://api.github.com/users/pablochacin/orgs",
    "repos_url": "https://api.github.com/users/pablochacin/repos",
    "events_url": "https://api.github.com/users/pablochacin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pablochacin/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2018-02-16T20:13:30Z",
  "updated_at": "2018-02-24T16:28:20Z",
  "closed_at": "2018-02-24T16:27:51Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi there,\r\n\r\nI have setup a private network for testing Whisper. I cannot make filters based on topics to be of any use, because regardless of how I set them, all messages are received.\r\n\r\nI already have found some issues with the documentation (see issue #16013 ) so maybe this is more a documentation issue.\r\n\r\n#### System information\r\n\r\nGeth version: `Geth/v1.7.3-stable-4bb3c89d/linux-amd64/go1.9`\r\n\r\n#### Expected behaviour\r\nposting whisper messages with a topic different from the one used in the message filter should prevent that message to be received\r\n\r\n#### Actual behaviour\r\n\r\nAl messages post are received regardless of the topics used in the filter and the message.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nThe Following sequence of commands from the geth console reproduce the result:\r\n```\r\nWelcome to the Geth JavaScript console!\r\n\r\ninstance: Geth/v1.7.3-stable-4bb3c89d/linux-amd64/go1.9\r\ncoinbase: 0xde2326ceead41ddb2a2a421373b619ce4364771c\r\nat block: 0 (Thu, 01 Jan 1970 00:00:00 UTC)\r\n datadir: /var/lib/geth/data\r\n modules: admin:1.0 debug:1.0 eth:1.0 miner:1.0 net:1.0 personal:1.0 rpc:1.0 shh:1.0 txpool:1.0 web3:1.0\r\n\r\nkp = shh.newKeyPair()\r\n\"81ba9ff48a16247ec57a09450bc68171a708fb12217a7bb216919b2536262c1b\"\r\n> cb = function(err,messages){console.log(JSON.stringify(err||messages))}\r\nfunction(err,messages)\r\n> cbe=function(error){console.log(error)}\r\nfunction(error)\r\n\r\n> f = shh.newMessageFilter({topics: ['0x68656c6f'], privateKeyId: kp},cb,cbe)\r\n{\r\n  callbacks: [function(err,messages)],\r\n  filterId: \"2bf504a0c9c075e8b264cc98caca058d6fafca40b546206974e5b43daec0cd84\",\r\n  formatter: null,\r\n  getLogsCallbacks: [],\r\n  implementation: {\r\n    getLogs: function(),\r\n    newFilter: function(),\r\n    poll: function(),\r\n    uninstallFilter: function()\r\n  },\r\n  options: {\r\n    privateKeyId: \"81ba9ff48a16247ec57a09450bc68171a708fb12217a7bb216919b2536262c1b\",\r\n    topics: [\"0x68656c6f\"]\r\n  },\r\n  pollFilters: [],\r\n  requestManager: {\r\n    polls: {\r\n      2bf504a0c9c075e8b264cc98caca058d6fafca40b546206974e5b43daec0cd84: {\r\n        data: {...},\r\n        id: \"2bf504a0c9c075e8b264cc98caca058d6fafca40b546206974e5b43daec0cd84\",\r\n        callback: function(error, messages),\r\n        uninstall: function()\r\n      }\r\n    },\r\n    provider: {\r\n      newAccount: function(),\r\n      openWallet: function(),\r\n      send: function github.com/ethereum/go-ethereum/console.(*bridge).Send-fm(),\r\n      sendAsync: function github.com/ethereum/go-ethereum/console.(*bridge).Send-fm(),\r\n      sign: function(),\r\n      unlockAccount: function()\r\n    },\r\n    timeout: {},\r\n    poll: function(),\r\n    reset: function(keepIsSyncing),\r\n    send: function(data),\r\n    sendAsync: function(data, callback),\r\n    sendBatch: function(data, callback),\r\n    setProvider: function(p),\r\n    startPolling: function(data, pollId, callback, uninstall),\r\n    stopPolling: function(pollId)\r\n  },\r\n  get: function(callback),\r\n  stopWatching: function(callback),\r\n  watch: function(callback)\r\n}\r\n>  pubKey = shh.getPublicKey(kp)\r\n\"0x04a0068172ab906410c12bcccfdfa8530239b57885513aee35411196466b544c12559f739efcd1455e24206e35ba2e0aadb0330b684fb76741d64e7ee6280bd45a\"\r\nshh.post({ttl: 7, powTarget: 2.01, powTime: 2, payload: '0x68656c6c6f', topic: '0x68656c6f', pubKey: pubKey})\r\ntrue\r\n> {\"hash\":\"0x5169a2984c15cf2c46a15879e90ad3a7a62112c992860f7efa6b6d491bc670cf\",\"padding\":\"0xa7be508d8914d8aecec03fbfd7f5713424cc4fe844a3d6bf32ab3381ff19f468b97e1c356f66109c0e176d655ceec09c0bb7bb7599765bfea0df058adb077f165f3dbb9d1701b5ef258bd411d4c00e3e5daeaed458e335e8999f46eef39da1c8f95eaa74a8576b08d678ccf2fa18297260402fcc1a7612fa2fae6f8476687d9cbcbbbf373b7bcc1578acbf996d43a717d463af638907b729c5611118305cc4222ee3f4236f2399d8f447f72abcf0a0f407ff6e5d35c0d2197e88dbb1c044f63c9c62564d34c6f0d23d96bee8e9fdcbc464fdd467ebd6c7d09e0f90469bef2723e8e00ee38bd015d72bba2f75241f088c5e52e1771993af1aff\",\"payload\":\"0x68656c6c6f\",\"pow\":3.0007326007326007,\"recipientPublicKey\":\"0x04a0068172ab906410c12bcccfdfa8530239b57885513aee35411196466b544c12559f739efcd1455e24206e35ba2e0aadb0330b684fb76741d64e7ee6280bd45a\",\"timestamp\":1518811000,\"topic\":\"0x68656c6f\",\"ttl\":7\r\n\r\n```\r\nChange Post topic\r\n\r\n```\r\nshh.post({ttl: 7, powTarget: 2.01, powTime: 2, payload: '0x68656c6c6f', topic: '0x20202020', pubKey: pubKey})\r\ntrue\r\n> {\"hash\":\"0xea7b345e3cfd866fe966a041156ef6ceb58d054dd63db33604b79d4010efc7d5\",\"padding\":\"0x4d6e3e1a3879f07c74511919b5d3b65918474a426a0a32913a1d3ce724bd24071542fb6d338bc565c6d3969ec45fddb11c0d5163331055605623c8bff376447971bccb5fb7dedee88a4cf54838dbdcbe3fb4ca74629ef04da83f6e75481a43634f0a5aec3e9ee2c375659bcffe56ecb56066f280e7ffc840f290015f4f0d493130cfb964bf2141a1dd3cbaedad66255c7a66d1184b09a206a72339566dab76809ca9507eb9d506a957b05956dcd0a0b39571782b884ef1195499af6f0b9fcbc0f99ca8d0898babe95fbe8fcc62a6f350245a65918e22edac33fcb7cec17b043a0a7b2dc6603de8e2beb71539554801ed2f138adeefe4a2961a\",\"payload\":\"0x68656c6c6f\",\"pow\":6.0014652014652015,\"recipientPublicKey\":\"0x04a0068172ab906410c12bcccfdfa8530239b57885513aee35411196466b544c12559f739efcd1455e24206e35ba2e0aadb0330b684fb76741d64e7ee6280bd45a\",\"timestamp\":1518811012,\"topic\":\"0x20202020\",\"ttl\":7}\r\n\r\n```\r\n\r\nNotice that the message is received with the message used in the post, therefore It seems like it is not being ignored. \r\n\r\nI have tested with both symmetric and asymmetric keys, and also posting from a different node than the one on which I define the filter. In any case, as long as keys match, the message is received.\r\n\r\n",
  "closed_by": {
    "login": "pablochacin",
    "id": 720259,
    "node_id": "MDQ6VXNlcjcyMDI1OQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/720259?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pablochacin",
    "html_url": "https://github.com/pablochacin",
    "followers_url": "https://api.github.com/users/pablochacin/followers",
    "following_url": "https://api.github.com/users/pablochacin/following{/other_user}",
    "gists_url": "https://api.github.com/users/pablochacin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pablochacin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pablochacin/subscriptions",
    "organizations_url": "https://api.github.com/users/pablochacin/orgs",
    "repos_url": "https://api.github.com/users/pablochacin/repos",
    "events_url": "https://api.github.com/users/pablochacin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pablochacin/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16110/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16110/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/366782272",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16110#issuecomment-366782272",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16110",
    "id": 366782272,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2Njc4MjI3Mg==",
    "user": {
      "login": "dshulyak",
      "id": 1964576,
      "node_id": "MDQ6VXNlcjE5NjQ1NzY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1964576?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dshulyak",
      "html_url": "https://github.com/dshulyak",
      "followers_url": "https://api.github.com/users/dshulyak/followers",
      "following_url": "https://api.github.com/users/dshulyak/following{/other_user}",
      "gists_url": "https://api.github.com/users/dshulyak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dshulyak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dshulyak/subscriptions",
      "organizations_url": "https://api.github.com/users/dshulyak/orgs",
      "repos_url": "https://api.github.com/users/dshulyak/repos",
      "events_url": "https://api.github.com/users/dshulyak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dshulyak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-19T19:19:22Z",
    "updated_at": "2018-02-19T19:19:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "You may be hitting problem that was fixed with https://github.com/ethereum/go-ethereum/pull/15811 . afaik it is not backported to 1.7.3",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/366782272/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/368240056",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16110#issuecomment-368240056",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16110",
    "id": 368240056,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2ODI0MDA1Ng==",
    "user": {
      "login": "pablochacin",
      "id": 720259,
      "node_id": "MDQ6VXNlcjcyMDI1OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/720259?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pablochacin",
      "html_url": "https://github.com/pablochacin",
      "followers_url": "https://api.github.com/users/pablochacin/followers",
      "following_url": "https://api.github.com/users/pablochacin/following{/other_user}",
      "gists_url": "https://api.github.com/users/pablochacin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pablochacin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pablochacin/subscriptions",
      "organizations_url": "https://api.github.com/users/pablochacin/orgs",
      "repos_url": "https://api.github.com/users/pablochacin/repos",
      "events_url": "https://api.github.com/users/pablochacin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pablochacin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-24T16:28:20Z",
    "updated_at": "2018-02-24T16:28:20Z",
    "author_association": "NONE",
    "body": "You are right, @dshulyak Upgrading to 1.8.1 solves the issue. Thanks, ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/368240056/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
