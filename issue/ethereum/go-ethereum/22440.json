{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22440",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22440/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22440/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22440/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/22440",
  "id": 822987188,
  "node_id": "MDU6SXNzdWU4MjI5ODcxODg=",
  "number": 22440,
  "title": "Stuck at \"Allocated cache and file handles\" and SEGFAULT",
  "user": {
    "login": "elsampsa",
    "id": 13978980,
    "node_id": "MDQ6VXNlcjEzOTc4OTgw",
    "avatar_url": "https://avatars.githubusercontent.com/u/13978980?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/elsampsa",
    "html_url": "https://github.com/elsampsa",
    "followers_url": "https://api.github.com/users/elsampsa/followers",
    "following_url": "https://api.github.com/users/elsampsa/following{/other_user}",
    "gists_url": "https://api.github.com/users/elsampsa/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/elsampsa/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/elsampsa/subscriptions",
    "organizations_url": "https://api.github.com/users/elsampsa/orgs",
    "repos_url": "https://api.github.com/users/elsampsa/repos",
    "events_url": "https://api.github.com/users/elsampsa/events{/privacy}",
    "received_events_url": "https://api.github.com/users/elsampsa/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-03-05T11:12:07Z",
  "updated_at": "2021-03-08T13:10:51Z",
  "closed_at": "2021-03-08T13:10:51Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `1.9.25`\r\nOS & Version: Linux\r\nCommit hash : N/A\r\n\r\n#### Expected behaviour\r\n\r\nWhen started, geth should inform me that it's trying to find peers\r\n\r\n#### Actual behaviour\r\n\r\nThe last log line says: \"Allocated cache and file handles\".\r\nAfter that, geth gets complete stuck.  JS console doesn't work (it can't find the .ipc file).\r\n\r\nI removed the \"./ethereum/geth/LOCK\" file & and cleaned the \".ethereum/geth/ethash/\" directory before starting geth.  Doesn't help.\r\n\r\nInterestingly, after I stop geth in a clean way (the log tells me \"Stopped Ethereum go client\"), the \"LOCK\" file persists.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nDirty-stop geth a few times\r\n\r\n#### Backtrace\r\n\r\n**UPDATE** \r\n\r\nUpdated to \"release/1.10\" branch.  Actually I had to wait some time .. that reveals a segfault:\r\n```\r\nmaalis 05 23:20:00 sampsa-asus geth[1221]: INFO [03-05|23:20:00.556] Starting Geth on Ethereum mainnet...\r\nmaalis 05 23:20:00 sampsa-asus geth[1221]: INFO [03-05|23:20:00.559] Maximum peer count                       ETH=50 LES=0 total=50\r\nmaalis 05 23:20:00 sampsa-asus geth[1221]: INFO [03-05|23:20:00.560] Smartcard socket not found, disabling    err=\"stat /run/pcscd/pcscd.comm: no such file or directory\"\r\nmaalis 05 23:20:00 sampsa-asus systemd[1190]: Started Ethereum go client.\r\nmaalis 05 23:20:00 sampsa-asus geth[1221]: INFO [03-05|23:20:00.561] Set global gas cap                       cap=25000000\r\nmaalis 05 23:20:00 sampsa-asus geth[1221]: INFO [03-05|23:20:00.561] Allocated trie memory caches             clean=307.00MiB dirty=512.00MiB\r\nmaalis 05 23:20:00 sampsa-asus geth[1221]: INFO [03-05|23:20:00.561] Allocated cache and file handles         database=/home/sampsa/.ethereum/geth/chaindata cache=1024.00MiB handles=2048\r\nmaalis 05 23:20:05 sampsa-asus geth[1221]: INFO [03-05|23:20:05.065] Opened ancient database                  database=/home/sampsa/.ethereum/geth/chaindata/ancient\r\nmaalis 05 23:20:05 sampsa-asus geth[1221]: INFO [03-05|23:20:05.534] Initialised chain configuration          config=\"{ChainID: 1 Homestead: 1150000 DAO: 1920000 DAOSupport: true EIP150: 2463000 EIP155: 2675000 EIP158: 2675000 Byzantium: 4370000 Constantinople: 7280000 Petersburg: 7280000 Istanbul: 9069000, Muir Glacier: 9200000, Berlin: <nil>, YOLO v3: <nil>, Engine: ethash}\"\r\nmaalis 05 23:20:11 sampsa-asus geth[1221]: INFO [03-05|23:20:11.885] Disk storage enabled for ethash caches   dir=/home/sampsa/.ethereum/geth/ethash count=3\r\nmaalis 05 23:20:11 sampsa-asus geth[1221]: INFO [03-05|23:20:11.885] Disk storage enabled for ethash DAGs     dir=/home/sampsa/.ethash               count=2\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: INFO [03-05|23:20:12.196] Initialising Ethereum protocol           network=1 dbversion=8\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: WARN [03-05|23:20:12.536] Head block missing, resetting chain      hash=\"77dc58â€¦65f04a\"\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: panic: runtime error: invalid memory address or nil pointer dereference\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: [signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x9eb734]\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: goroutine 1 [running]:\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: github.com/ethereum/go-ethereum/core/types.(*Block).NumberU64(...)\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]:         github.com/ethereum/go-ethereum/core/types/block.go:312\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: github.com/ethereum/go-ethereum/core.(*BlockChain).SetHeadBeyondRoot(0xc0000af900, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]:         github.com/ethereum/go-ethereum/core/blockchain.go:606 +0x1f4\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: github.com/ethereum/go-ethereum/core.(*BlockChain).SetHead(0xc0000af900, 0x0, 0xc0001c67e0, 0x0)\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]:         github.com/ethereum/go-ethereum/core/blockchain.go:480 +0x45\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: github.com/ethereum/go-ethereum/core.(*BlockChain).ResetWithGenesisBlock(0xc0000af900, 0xc0001ac120, 0x0, 0x0)\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]:         github.com/ethereum/go-ethereum/core/blockchain.go:708 +0x65\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: github.com/ethereum/go-ethereum/core.(*BlockChain).Reset(0xc0000af900, 0x1399f79, 0x23)\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]:         github.com/ethereum/go-ethereum/core/blockchain.go:701 +0x37\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: github.com/ethereum/go-ethereum/core.(*BlockChain).loadLastState(0xc0000af900, 0x1344000, 0x0)\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]:         github.com/ethereum/go-ethereum/core/blockchain.go:435 +0x13fc\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: github.com/ethereum/go-ethereum/core.NewBlockChain(0x15b4ec0, 0xc000184620, 0xc0066c94a0, 0x1e7b6e0, 0x15b20c0, 0xc0001c6620, 0x0, 0x0, 0x0, 0x0, ...)\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]:         github.com/ethereum/go-ethereum/core/blockchain.go:280 +0x765\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: github.com/ethereum/go-ethereum/eth.New(0xc00019cd00, 0xc000437500, 0xc00002e178, 0xc00020aba0, 0xbf1cf0)\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]:         github.com/ethereum/go-ethereum/eth/backend.go:186 +0xbda\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: github.com/ethereum/go-ethereum/cmd/utils.RegisterEthService(0xc00019cd00, 0xc000437500, 0xf, 0x0)\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]:         github.com/ethereum/go-ethereum/cmd/utils/flags.go:1677 +0x20f\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: main.makeFullNode(0xc0001a02c0, 0x13728bb, 0xc000010020, 0xc000167d40)\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]:         github.com/ethereum/go-ethereum/cmd/geth/config.go:146 +0x145\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: main.geth(0xc0001a02c0, 0x0, 0x0)\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]:         github.com/ethereum/go-ethereum/cmd/geth/main.go:339 +0xf4\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: gopkg.in/urfave/cli%2ev1.HandleAction(0x1191200, 0x144f2f0, 0xc0001a02c0, 0xc00007c780, 0x0)\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]:         gopkg.in/urfave/cli.v1@v1.20.0/app.go:490 +0x82\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: gopkg.in/urfave/cli%2ev1.(*App).Run(0xc00009c340, 0xc0000320a0, 0x5, 0x5, 0x0, 0x0)\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]:         gopkg.in/urfave/cli.v1@v1.20.0/app.go:264 +0x5f5\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]: main.main()\r\nmaalis 05 23:20:12 sampsa-asus geth[1221]:         github.com/ethereum/go-ethereum/cmd/geth/main.go:260 +0x55\r\nmaalis 05 23:20:12 sampsa-asus systemd[1190]: geth.service: Main process exited, code=exited, status=2/INVALIDARGUMENT\r\nmaalis 05 23:20:12 sampsa-asus systemd[1190]: geth.service: Failed with result 'exit-code'.\r\n```",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22440/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22440/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/791591490",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22440#issuecomment-791591490",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22440",
    "id": 791591490,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MTU5MTQ5MA==",
    "user": {
      "login": "elsampsa",
      "id": 13978980,
      "node_id": "MDQ6VXNlcjEzOTc4OTgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/13978980?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/elsampsa",
      "html_url": "https://github.com/elsampsa",
      "followers_url": "https://api.github.com/users/elsampsa/followers",
      "following_url": "https://api.github.com/users/elsampsa/following{/other_user}",
      "gists_url": "https://api.github.com/users/elsampsa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/elsampsa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/elsampsa/subscriptions",
      "organizations_url": "https://api.github.com/users/elsampsa/orgs",
      "repos_url": "https://api.github.com/users/elsampsa/repos",
      "events_url": "https://api.github.com/users/elsampsa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/elsampsa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-05T18:10:23Z",
    "updated_at": "2021-03-05T18:10:23Z",
    "author_association": "NONE",
    "body": "Updated to branch \"release/1.10\".. the same problem persists",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/791591490/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/791900272",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22440#issuecomment-791900272",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22440",
    "id": 791900272,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MTkwMDI3Mg==",
    "user": {
      "login": "elsampsa",
      "id": 13978980,
      "node_id": "MDQ6VXNlcjEzOTc4OTgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/13978980?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/elsampsa",
      "html_url": "https://github.com/elsampsa",
      "followers_url": "https://api.github.com/users/elsampsa/followers",
      "following_url": "https://api.github.com/users/elsampsa/following{/other_user}",
      "gists_url": "https://api.github.com/users/elsampsa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/elsampsa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/elsampsa/subscriptions",
      "organizations_url": "https://api.github.com/users/elsampsa/orgs",
      "repos_url": "https://api.github.com/users/elsampsa/repos",
      "events_url": "https://api.github.com/users/elsampsa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/elsampsa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-06T09:11:34Z",
    "updated_at": "2021-03-06T09:11:34Z",
    "author_association": "NONE",
    "body": "recoving .ethereum folder from a backup disk solved the issue.  Please close this issue if you feel like it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/791900272/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/792586585",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22440#issuecomment-792586585",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22440",
    "id": 792586585,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MjU4NjU4NQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-08T08:48:25Z",
    "updated_at": "2021-03-08T08:48:25Z",
    "author_association": "MEMBER",
    "body": "A follow-up question: You seem to be running this as some form of service (systemd?). When you close the process, do you properly allow it to exit gracefully, i.e sending it a `ctrl-c`-like signal and giving it two minutes to exit? \r\nOtherwise, if you just kill the process, it may cause data corruption. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/792586585/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/792724147",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22440#issuecomment-792724147",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22440",
    "id": 792724147,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MjcyNDE0Nw==",
    "user": {
      "login": "elsampsa",
      "id": 13978980,
      "node_id": "MDQ6VXNlcjEzOTc4OTgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/13978980?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/elsampsa",
      "html_url": "https://github.com/elsampsa",
      "followers_url": "https://api.github.com/users/elsampsa/followers",
      "following_url": "https://api.github.com/users/elsampsa/following{/other_user}",
      "gists_url": "https://api.github.com/users/elsampsa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/elsampsa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/elsampsa/subscriptions",
      "organizations_url": "https://api.github.com/users/elsampsa/orgs",
      "repos_url": "https://api.github.com/users/elsampsa/repos",
      "events_url": "https://api.github.com/users/elsampsa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/elsampsa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-08T12:29:38Z",
    "updated_at": "2021-03-08T12:29:38Z",
    "author_association": "NONE",
    "body": "Originally it was running as systemd daemon..  maybe that's the problem => systemd gives it not enough time to exit gracefully & the data got corrupted.  I finally recovered blockchain from a backup hdd & updated to 1.10 & started running it from the command line.  Not sure which one of these three things actually fixed the issue..",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/792724147/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/792745938",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22440#issuecomment-792745938",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22440",
    "id": 792745938,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5Mjc0NTkzOA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-08T13:10:51Z",
    "updated_at": "2021-03-08T13:10:51Z",
    "author_association": "MEMBER",
    "body": "In that case, I'm fairly certain that insufficient time to exit is the culprit. There's a lot of data to be written to disk during exit. I'll close this ticket then. Thanks for confirming!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/792745938/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
