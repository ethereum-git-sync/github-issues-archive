{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19260",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19260/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19260/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19260/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/19260",
  "id": 420106921,
  "node_id": "MDU6SXNzdWU0MjAxMDY5MjE=",
  "number": 19260,
  "title": "Initial value of homestead flag used before mining starts, can cause transaction to go into pending state",
  "user": {
    "login": "SatpalSandhu61",
    "id": 28562234,
    "node_id": "MDQ6VXNlcjI4NTYyMjM0",
    "avatar_url": "https://avatars.githubusercontent.com/u/28562234?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/SatpalSandhu61",
    "html_url": "https://github.com/SatpalSandhu61",
    "followers_url": "https://api.github.com/users/SatpalSandhu61/followers",
    "following_url": "https://api.github.com/users/SatpalSandhu61/following{/other_user}",
    "gists_url": "https://api.github.com/users/SatpalSandhu61/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/SatpalSandhu61/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/SatpalSandhu61/subscriptions",
    "organizations_url": "https://api.github.com/users/SatpalSandhu61/orgs",
    "repos_url": "https://api.github.com/users/SatpalSandhu61/repos",
    "events_url": "https://api.github.com/users/SatpalSandhu61/events{/privacy}",
    "received_events_url": "https://api.github.com/users/SatpalSandhu61/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 856638432,
      "node_id": "MDU6TGFiZWw4NTY2Mzg0MzI=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:inactive",
      "name": "status:inactive",
      "color": "ffffff",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2019-03-12T17:13:02Z",
  "updated_at": "2020-04-25T05:55:07Z",
  "closed_at": "2020-04-25T05:55:07Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Note that I've created the ticket just to highlight this issue; however it's not a big problem.\r\nFeel free to just close the ticket, although you may want to consider my suggestion under the \"solution\" section.\r\n\r\n#### System information\r\n\r\nGeth\r\nVersion: 1.9.0-unstable\r\nGit Commit: ce3ea8c9b1f6170c9a0dc44260b6bbafe6bd3f7d\r\nArchitecture: amd64\r\nProtocol Versions: [63 62]\r\nNetwork Id: 1\r\nGo Version: go1.10.4\r\nOperating System: darwin\r\n\r\n#### Expected behaviour\r\n\r\nIf a contract creation is submitted with insufficient gas then it should be rejected.\r\n\r\n#### Actual behaviour\r\n\r\nIf the homestead flag is set and a contract creation is submitted with marginally insufficient intrinsic gas, then it goes into pending state.\r\nThis scenario only occurs if the transaction is submitted prior to any blocks having been minted. It can be reproduced under ethhash and clique.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n1. Start local node with mining disabled, ensuring that “homesteadBlock” is set in genesis.\r\n2. Submit a new contract where the gas provided is slightly less than that required under homestead gas calculation rules.\r\n3. Enable mining.\r\n4. You will see that the transaction is stuck on the pending queue.\r\n\r\n#### Explanation\r\n\r\nRequired value of IntrinsicGas is higher under homestead rules due to 53000 gas required for contract creation (instead of 21000 gas).\r\nThe value of tx_pool.go::pool.homestead is initialised to ‘false’ and is only set to ‘true’ on a ChainHead event in tx_pool.go::loop(). Therefore, if the transaction is submitted before any block has been minted (or a synced), then:\r\n\r\n- When transaction validation occurs, IntrinsicGas() is called with homestead == false; which gives a lower IntrinsicGas value and the transaction is accepted.\r\n- During minting, IntrinsicGas() is called with homestead == true.; which gives a higher IntrinsicGas value, so transaction has insufficient gas and is not included in a block.\r\n\r\nI.e. A different intrinsic gas value requirement is calculated between validation and minting.\r\n\r\n#### Solution\r\n\r\nThe transaction can simply be resubmitted with more gas and a higher gasPrice, which will clear the pending transaction.\r\n\r\nIt may be that the homestead flag could be initialised to \"true\" in the code, since all network chains should now be created with homestead enabled.\r\n",
  "closed_by": {
    "login": "stale[bot]",
    "id": 26384082,
    "node_id": "MDM6Qm90MjYzODQwODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stale%5Bbot%5D",
    "html_url": "https://github.com/apps/stale",
    "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19260/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19260/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/598312607",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19260#issuecomment-598312607",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19260",
    "id": 598312607,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5ODMxMjYwNw==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2020-03-12T17:22:48Z",
    "updated_at": "2020-03-12T17:22:48Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/598312607/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
