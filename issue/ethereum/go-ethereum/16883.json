{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16883",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16883/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16883/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16883/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/16883",
  "id": 329014275,
  "node_id": "MDU6SXNzdWUzMjkwMTQyNzU=",
  "number": 16883,
  "title": "Geth stop syncing with network for 10 hours, followed by too many open files error",
  "user": {
    "login": "calvinaco",
    "id": 38898718,
    "node_id": "MDQ6VXNlcjM4ODk4NzE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/38898718?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/calvinaco",
    "html_url": "https://github.com/calvinaco",
    "followers_url": "https://api.github.com/users/calvinaco/followers",
    "following_url": "https://api.github.com/users/calvinaco/following{/other_user}",
    "gists_url": "https://api.github.com/users/calvinaco/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/calvinaco/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/calvinaco/subscriptions",
    "organizations_url": "https://api.github.com/users/calvinaco/orgs",
    "repos_url": "https://api.github.com/users/calvinaco/repos",
    "events_url": "https://api.github.com/users/calvinaco/events{/privacy}",
    "received_events_url": "https://api.github.com/users/calvinaco/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 856638432,
      "node_id": "MDU6TGFiZWw4NTY2Mzg0MzI=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:inactive",
      "name": "status:inactive",
      "color": "ffffff",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2018-06-04T11:23:23Z",
  "updated_at": "2019-08-12T07:34:13Z",
  "closed_at": "2019-08-12T07:34:13Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `Geth/v1.8.9-stable-ff9b1461/linux-amd64/go1.10`\r\nOS & Version: `Ubuntu 16.04`\r\nCommit hash : \r\n\r\n#### Expected behaviour\r\n\r\nGeth should keep in sync with the network\r\n\r\n#### Actual behaviour\r\n\r\n- `geth` is keep running but suddenly stop syncing with the network for 10 hours\r\n  - JSONRPC server is still running returning the outdated block number during this period of time\r\n  - Running `net.peerCount` shows 25 peers is connected consistently at the moment\r\n- After ~10 hours, `geth` starts to throw `http: Accept error: accept tcp [::]:8545: accept4: too many open files; retrying in 5ms` and never stop\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nIt happens kind of random. But the pattern usually happens after running the node for a week time.\r\n\r\n#### Backtrace\r\n\r\n````\r\n2018-06-04_10:30:29.51348 INFO [06-04|10:30:29] Imported new chain segment               blocks=1  txs=133  mgas=7.972   elapsed=261.803ms  mgasps=30.452  number=5730266 hash=1e6af4�~@�34b7a8 cache=250.74mB\r\n2018-06-04_10:30:54.74518 INFO [06-04|10:30:54] Imported new chain segment               blocks=1  txs=72   mgas=7.962   elapsed=425.775ms  mgasps=18.701  number=5730264 hash=615c90�~@�406f96 cache=251.10mB\r\n2018-06-04_10:30:59.70970 INFO [06-04|10:30:59] Imported new chain segment               blocks=1  txs=195  mgas=7.996   elapsed=299.451ms  mgasps=26.702  number=5730267 hash=232e98�~@�915a2b cache=251.58mB\r\n2018-06-04_10:31:08.82194 INFO [06-04|10:31:08] Imported new chain segment               blocks=1  txs=221  mgas=7.987   elapsed=302.543ms  mgasps=26.399  number=5730268 hash=f2c702�~@�8b6f57 cache=251.73mB\r\n2018-06-04_10:31:09.78174 INFO [06-04|10:31:09] Imported new chain segment               blocks=1  txs=168  mgas=6.782   elapsed=136.483ms  mgasps=49.694  number=5730267 hash=46c08e�~@�6c1699 cache=251.87mB\r\n2018-06-04_10:31:32.31166 INFO [06-04|10:31:32] Imported new chain segment               blocks=1  txs=71   mgas=7.910   elapsed=86.345ms   mgasps=91.614  number=5730267 hash=586b8f�~@�d4586c cache=251.93mB\r\n2018-06-04_10:31:36.68506 INFO [06-04|10:31:36] Imported new chain segment               blocks=1  txs=97   mgas=7.965   elapsed=218.409ms  mgasps=36.470  number=5730269 hash=96ed21�~@�09f5a3 cache=251.66mB\r\n2018-06-04_10:31:41.04692 INFO [06-04|10:31:41] Imported new chain segment               blocks=1  txs=144  mgas=7.996   elapsed=265.208ms  mgasps=30.150  number=5730270 hash=da0e68�~@�593e30 cache=251.56mB\r\n2018-06-04_10:31:58.49037 INFO [06-04|10:31:58] Imported new chain segment               blocks=1  txs=86   mgas=7.985   elapsed=189.417ms  mgasps=42.154  number=5730271 hash=934fe6�~@�597ac3 cache=251.92mB\r\n2018-06-04_10:32:02.94437 INFO [06-04|10:32:02] Imported new chain segment               blocks=1  txs=100  mgas=7.992   elapsed=181.368ms  mgasps=44.063  number=5730272 hash=5d3417�~@�08d039 cache=251.86mB\r\n2018-06-04_10:32:15.92040 INFO [06-04|10:32:15] Imported new chain segment               blocks=1  txs=65   mgas=7.993   elapsed=188.916ms  mgasps=42.309  number=5730273 hash=9c1994�~@�e7faaa cache=251.49mB\r\n2018-06-04_10:32:17.50921 INFO [06-04|10:32:17] Imported new chain segment               blocks=1  txs=285  mgas=8.000   elapsed=412.995ms  mgasps=19.370  number=5730273 hash=c397e8�~@�6568f1 cache=252.19mB\r\n2018-06-04_10:32:28.17922 INFO [06-04|10:32:28] Imported new chain segment               blocks=1  txs=179  mgas=7.985   elapsed=417.219ms  mgasps=19.138  number=5730274 hash=df4fa7�~@�e02efd cache=252.42mB\r\n2018-06-04_10:32:28.55545 INFO [06-04|10:32:28] Imported new chain segment               blocks=1  txs=169  mgas=7.981   elapsed=242.306ms  mgasps=32.939  number=5730274 hash=541f16�~@�3144ad cache=252.60mB\r\n2018-06-04_10:32:36.66976 INFO [06-04|10:32:36] Imported new chain segment               blocks=1  txs=326  mgas=8.000   elapsed=253.852ms  mgasps=31.513  number=5730275 hash=4eb8c8�~@�317ff7 cache=252.40mB\r\n2018-06-04_10:33:44.79329 INFO [06-04|10:33:44] Imported new chain segment               blocks=2  txs=2389 mgas=15.965  elapsed=475.924ms  mgasps=33.546  number=5730276 hash=a94b31�~@�bb6bbb cache=253.01mB ignored=15\r\n2018-06-05_00:59:26.04264 2018/06/05 00:59:26 http: Accept error: accept tcp [::]:8545: accept4: too many open files; retrying in 5ms\r\n2018-06-05_00:59:26.04775 2018/06/05 00:59:26 http: Accept error: accept tcp [::]:8545: accept4: too many open files; retrying in 10ms\r\n2018-06-05_00:59:26.05786 2018/06/05 00:59:26 http: Accept error: accept tcp [::]:8545: accept4: too many open files; retrying in 20ms\r\n2018-06-05_00:59:26.07795 2018/06/05 00:59:26 http: Accept error: accept tcp [::]:8545: accept4: too many open files; retrying in 40ms\r\n2018-06-05_00:59:26.11809 2018/06/05 00:59:26 http: Accept error: accept tcp [::]:8545: accept4: too many open files; retrying in 80ms\r\n2018-06-05_00:59:32.34530 2018/06/05 00:59:32 http: Accept error: accept tcp [::]:8545: accept4: too many open files; retrying in 5ms\r\n2018-06-05_00:59:32.35039 2018/06/05 00:59:32 http: Accept error: accept tcp [::]:8545: accept4: too many open files; retrying in 10ms\r\n2018-06-05_00:59:32.36056 2018/06/05 00:59:32 http: Accept error: accept tcp [::]:8545: accept4: too many open files; retrying in 5ms\r\n2018-06-05_00:59:32.36568 2018/06/05 00:59:32 http: Accept error: accept tcp [::]:8545: accept4: too many open files; retrying in 10ms\r\n2018-06-05_00:59:32.37582 2018/06/05 00:59:32 http: Accept error: accept tcp [::]:8545: accept4: too many open files; retrying in 20ms\r\n2018-06-05_00:59:32.39594 2018/06/05 00:59:32 http: Accept error: accept tcp [::]:8545: accept4: too many open files; retrying in 40ms\r\n2018-06-05_00:59:32.43605 2018/06/05 00:59:32 http: Accept error: accept tcp [::]:8545: accept4: too many open files; retrying in 80ms\r\n2018-06-05_00:59:32.51616 2018/06/05 00:59:32 http: Accept error: accept tcp [::]:8545: accept4: too many open files; retrying in 160ms\r\n2018-06-05_00:59:32.67632 2018/06/05 00:59:32 http: Accept error: accept tcp [::]:8545: accept4: too many open files; retrying in 320ms\r\n````\r\n\r\n`debug.stacks()`\r\n[debug_stacks.log](https://github.com/ethereum/go-ethereum/files/2068008/debug_stacks.log)\r\n\r\n",
  "closed_by": {
    "login": "stale[bot]",
    "id": 26384082,
    "node_id": "MDM6Qm90MjYzODQwODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stale%5Bbot%5D",
    "html_url": "https://github.com/apps/stale",
    "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16883/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16883/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/394322351",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16883#issuecomment-394322351",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16883",
    "id": 394322351,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NDMyMjM1MQ==",
    "user": {
      "login": "calvinaco",
      "id": 38898718,
      "node_id": "MDQ6VXNlcjM4ODk4NzE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/38898718?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/calvinaco",
      "html_url": "https://github.com/calvinaco",
      "followers_url": "https://api.github.com/users/calvinaco/followers",
      "following_url": "https://api.github.com/users/calvinaco/following{/other_user}",
      "gists_url": "https://api.github.com/users/calvinaco/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/calvinaco/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/calvinaco/subscriptions",
      "organizations_url": "https://api.github.com/users/calvinaco/orgs",
      "repos_url": "https://api.github.com/users/calvinaco/repos",
      "events_url": "https://api.github.com/users/calvinaco/events{/privacy}",
      "received_events_url": "https://api.github.com/users/calvinaco/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-04T11:29:04Z",
    "updated_at": "2018-06-05T02:19:36Z",
    "author_association": "NONE",
    "body": "Attaching CPU and network utilization during the \"stop syncing\" period for reference\r\n\r\n<img width=\"1478\" alt=\"screen shot 2018-06-04 at 7 08 12 pm\" src=\"https://user-images.githubusercontent.com/38898718/40915143-8626f434-682d-11e8-9ce2-6d51570d1ace.png\">\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/394322351/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/394786984",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16883#issuecomment-394786984",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16883",
    "id": 394786984,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NDc4Njk4NA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-05T17:06:14Z",
    "updated_at": "2018-06-05T17:06:14Z",
    "author_association": "MEMBER",
    "body": "Are you running a publicly open RPC server? That is probably a bad idea as anyone from the internet can grief your node. We've added some limits on master that forcefully close idle connections, which should definitely help, but please make sure you indeed want the entire internet to access your machine.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/394786984/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/401522642",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16883#issuecomment-401522642",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16883",
    "id": 401522642,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMTUyMjY0Mg==",
    "user": {
      "login": "calvinaco",
      "id": 38898718,
      "node_id": "MDQ6VXNlcjM4ODk4NzE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/38898718?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/calvinaco",
      "html_url": "https://github.com/calvinaco",
      "followers_url": "https://api.github.com/users/calvinaco/followers",
      "following_url": "https://api.github.com/users/calvinaco/following{/other_user}",
      "gists_url": "https://api.github.com/users/calvinaco/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/calvinaco/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/calvinaco/subscriptions",
      "organizations_url": "https://api.github.com/users/calvinaco/orgs",
      "repos_url": "https://api.github.com/users/calvinaco/repos",
      "events_url": "https://api.github.com/users/calvinaco/events{/privacy}",
      "received_events_url": "https://api.github.com/users/calvinaco/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-30T07:04:38Z",
    "updated_at": "2018-06-30T07:04:38Z",
    "author_association": "NONE",
    "body": "Thanks @karalabe . I am running the node on a trial but definitely I will restrict the access later. For the limits you mention, may I know if you are referring to #16880 ?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/401522642/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/507145722",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16883#issuecomment-507145722",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16883",
    "id": 507145722,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwNzE0NTcyMg==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2019-07-01T07:16:39Z",
    "updated_at": "2019-07-01T07:16:39Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/507145722/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
