{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25361",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25361/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25361/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25361/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/25361",
  "id": 1312933464,
  "node_id": "I_kwDOAOvK985OQcZY",
  "number": 25361,
  "title": "Geth sepolia node working with prysm consensus node stopped syncing with an error",
  "user": {
    "login": "bgiegel",
    "id": 5302294,
    "node_id": "MDQ6VXNlcjUzMDIyOTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5302294?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bgiegel",
    "html_url": "https://github.com/bgiegel",
    "followers_url": "https://api.github.com/users/bgiegel/followers",
    "following_url": "https://api.github.com/users/bgiegel/following{/other_user}",
    "gists_url": "https://api.github.com/users/bgiegel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bgiegel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bgiegel/subscriptions",
    "organizations_url": "https://api.github.com/users/bgiegel/orgs",
    "repos_url": "https://api.github.com/users/bgiegel/repos",
    "events_url": "https://api.github.com/users/bgiegel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bgiegel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-07-21T09:10:52Z",
  "updated_at": "2022-08-08T09:46:09Z",
  "closed_at": "2022-08-08T09:46:09Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 1.10.20\r\nOS & Version: Linux\r\n\r\n#### Expected behaviour\r\n\r\nWhen I sync a new ETH2 Sepolia testnet geth node using prysm as the consensus node the node sync fully without errors\r\n\r\n#### Actual behaviour\r\n\r\nThe geth node get stuck on a specific block and cannot seem to make any progress : \r\n\r\n```\r\nERROR[07-21|09:04:12.120] Beacon sync linkup unavailable           number=1,523,438 hash=e98bff..5d9a7b\r\nERROR[07-21|09:04:12.120] Beacon backfilling failed                err=\"beacon linkup unavailable locally: 1523438 [e98bff49c8015a828e4d9fbc1fd22b7f926c2f588bdc8b528c025c72185d9a7b]\"\r\n```\r\nWhen querying the node height using the API I get the same block height : `1523439`\r\n\r\nI tried to look in geth’s code to find some hint. And I found this : https://github.com/ethereum/go-ethereum/blob/89b138cf2fe5c988eea8f2e74d042fc092849f8e/eth/downloader/beaconsync.go#L227\r\n\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nI don’t know exactly it looks like a race condition with the beacon node from what I can see in the comment above the error in geth.\r\n\r\nTo help here are the options passed to geth :\r\n```\r\n/usr/bin/geth \r\n--sepolia \r\n--authrpc.jwtsecret /secrets/jwt.hex \r\n--override.terminaltotaldifficulty 17000000000000000\r\n--config /configs/geth.toml \r\n--syncmode snap --nousb \r\n--cache 4096 \r\n--http --http.api eth,net,engine,admin,debug \r\n--http.vhosts * \r\n--gcmode archive \r\n--rpc.txfeecap 2 \r\n--authrpc.vhosts *\r\n--authrpc.addr 0.0.0.0\r\n```\r\nThe toml config file : \r\n```\r\n      [Node]\r\n      DataDir = \"/var/lib/geth\"\r\n      IPCPath = \"geth.ipc\"\r\n      HTTPHost = \"0.0.0.0\"\r\n      HTTPPort = 8545\r\n      HTTPVirtualHosts = [\"localhost\"]\r\n      HTTPModules = [\"net\", \"web3\", \"eth\"]\r\n```\r\n\r\nand the params for the prysm command : \r\n```\r\n              /usr/bin/prysm\r\n              --http-web3provider=http://localhost:8551\r\n              --sepolia\r\n              --jwt-secret=/secrets/jwt.hex\r\n              --grpc-gateway-host=0.0.0.0\r\n              --rpc-host=0.0.0.0\r\n              --monitoring-host=0.0.0.0\r\n              --monitoring-port=8081\r\n              --accept-terms-of-use\r\n              --datadir=/var/lib/prysm/data\r\n              --genesis-state=/var/lib/prysm/sepolia-genesis.ssz\r\n```\r\n\r\nAlso might be usefull to say that during the setup I’ve made a mistake. The authentication mecanisme wasn’t working. The prysm process was returning 403 errors because my geth node didn’t set `--authrpc.vhosts *`. I fixed it and then it worked.\r\n\r\n\r\nIs there any workaround ? Restart from scratch maybe ?",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25361/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25361/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1191383824",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25361#issuecomment-1191383824",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25361",
    "id": 1191383824,
    "node_id": "IC_kwDOAOvK985HAxMQ",
    "user": {
      "login": "bgiegel",
      "id": 5302294,
      "node_id": "MDQ6VXNlcjUzMDIyOTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5302294?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bgiegel",
      "html_url": "https://github.com/bgiegel",
      "followers_url": "https://api.github.com/users/bgiegel/followers",
      "following_url": "https://api.github.com/users/bgiegel/following{/other_user}",
      "gists_url": "https://api.github.com/users/bgiegel/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bgiegel/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bgiegel/subscriptions",
      "organizations_url": "https://api.github.com/users/bgiegel/orgs",
      "repos_url": "https://api.github.com/users/bgiegel/repos",
      "events_url": "https://api.github.com/users/bgiegel/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bgiegel/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-21T11:45:04Z",
    "updated_at": "2022-07-21T11:45:04Z",
    "author_association": "NONE",
    "body": "ok so I actually wiped the node’s data (and beacon’s data). And starting the sync from scratch. And now it works ! So maybe it was indeed due to the fact that my authentiaction service was not setup properly.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1191383824/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
