{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26197",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26197/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26197/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26197/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/26197",
  "id": 1452655205,
  "node_id": "I_kwDOAOvK985WlcJl",
  "number": 26197,
  "title": "Restart geth kept throwing Unhandled trie error: missing trie node",
  "user": {
    "login": "J1a-wei",
    "id": 49090950,
    "node_id": "MDQ6VXNlcjQ5MDkwOTUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/49090950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/J1a-wei",
    "html_url": "https://github.com/J1a-wei",
    "followers_url": "https://api.github.com/users/J1a-wei/followers",
    "following_url": "https://api.github.com/users/J1a-wei/following{/other_user}",
    "gists_url": "https://api.github.com/users/J1a-wei/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/J1a-wei/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/J1a-wei/subscriptions",
    "organizations_url": "https://api.github.com/users/J1a-wei/orgs",
    "repos_url": "https://api.github.com/users/J1a-wei/repos",
    "events_url": "https://api.github.com/users/J1a-wei/events{/privacy}",
    "received_events_url": "https://api.github.com/users/J1a-wei/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-11-17T03:58:25Z",
  "updated_at": "2023-01-04T16:23:17Z",
  "closed_at": "2022-11-22T07:12:37Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `latest v1.10.26`\r\nCL client & version:  prysm  latest v3.1.2\r\nOS & Version: docker / kubernetes\r\nCommit hash : (if `develop`)\r\n\r\nargs: \r\n```\r\nexec geth --authrpc.jwtsecret=/secret/jwtsecret --authrpc.addr=0.0.0.0 --authrpc.port=8551 --authrpc.vhosts=* --http --http.addr=0.0.0.0 --http.port=8599 --http.corsdomain= --http.vhosts=* --http.api=web3,eth,net,engine --nat=extip:$(POD_IP) --port=30303 --ws --ws.addr=0.0.0.0 --ws.port=8546 --ws.origins=* --ws.api=web3,eth,net,engine --datadir=/data/ethereum --ethash.dagdir=/data/ethereum/.ethash --ipcdisable --mainnet \"--syncmode=snap\" \"--cache=12288\" \"--metrics\" \"--pprof\" \"--pprof.addr=0.0.0.0\" \"--pprof.port=6060\r\n```\r\n\r\n\r\n\r\n#### Steps to reproduce the behaviour\r\nWe migrated the new ec2, the data is stored on ebs, theoretically there is no data loss\r\n\r\n#### Backtrace\r\n\r\n````\r\n[backtrace]\r\n````\r\n\r\nWhen submitting logs: please submit them as text and not screenshots.\r\n```\r\nERROR[11-17\\|10:48:50.615] Unhandled trie error: missing trie node 3fdeaeffccad12a7af25c3a35c41afc400eb8c818ad5ccce052b6dc726fd5547 (path 05) <nil>\r\n\r\nERROR[11-17\\|10:48:50.624] Unhandled trie error: missing trie node 69080b1fb1ae31bbaa0230af33ea0fc82a5070b8ad087979d18ca40469aba18b (path 0a07) <nil>\r\n```\r\nBTW, After each reboot, we have lost some blocks (monitoring shows almost 50,000 or so missing blocks), is this normal?\r\n\r\n\r\n",
  "closed_by": {
    "login": "J1a-wei",
    "id": 49090950,
    "node_id": "MDQ6VXNlcjQ5MDkwOTUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/49090950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/J1a-wei",
    "html_url": "https://github.com/J1a-wei",
    "followers_url": "https://api.github.com/users/J1a-wei/followers",
    "following_url": "https://api.github.com/users/J1a-wei/following{/other_user}",
    "gists_url": "https://api.github.com/users/J1a-wei/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/J1a-wei/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/J1a-wei/subscriptions",
    "organizations_url": "https://api.github.com/users/J1a-wei/orgs",
    "repos_url": "https://api.github.com/users/J1a-wei/repos",
    "events_url": "https://api.github.com/users/J1a-wei/events{/privacy}",
    "received_events_url": "https://api.github.com/users/J1a-wei/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26197/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26197/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1318329620",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26197#issuecomment-1318329620",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26197",
    "id": 1318329620,
    "node_id": "IC_kwDOAOvK985OlB0U",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-17T09:20:48Z",
    "updated_at": "2022-11-17T09:21:38Z",
    "author_association": "MEMBER",
    "body": "> After each reboot, we have lost some blocks (monitoring shows almost 50,000 or so missing blocks), is this normal?\r\n\r\nThis is normal IFF you do not restart gracefully. Continuously doing hard restarts without giving geth sufficient time to save data held in memory to disk can lead to data corruption in the long run. You should always give geth a couple of minutes (maybe 3) after sending the interrupt, but before killing the process.\r\n\r\nRegarding the trie error: are the blocks progressing, or is geth 'stranded' due to these errors? If it progresses, these errors may come from external requests that request state-data that you do not have (nor need). If it does not progress, then yeah, you have a problem. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1318329620/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1371141602",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26197#issuecomment-1371141602",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26197",
    "id": 1371141602,
    "node_id": "IC_kwDOAOvK985RufXi",
    "user": {
      "login": "paymog",
      "id": 1986950,
      "node_id": "MDQ6VXNlcjE5ODY5NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1986950?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paymog",
      "html_url": "https://github.com/paymog",
      "followers_url": "https://api.github.com/users/paymog/followers",
      "following_url": "https://api.github.com/users/paymog/following{/other_user}",
      "gists_url": "https://api.github.com/users/paymog/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paymog/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paymog/subscriptions",
      "organizations_url": "https://api.github.com/users/paymog/orgs",
      "repos_url": "https://api.github.com/users/paymog/repos",
      "events_url": "https://api.github.com/users/paymog/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paymog/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-04T16:23:17Z",
    "updated_at": "2023-01-04T16:23:17Z",
    "author_association": "NONE",
    "body": "@holiman I'm seeing this issue but I'm also seeing log lines like the following as well:\r\n\r\n```\r\n{\"severity\":\"ERROR\",\"timestamp\":\"2023-01-04T11:22:21.359599888-05:00\",\"logger\":\"reader.geth\",\"message\":\"eRROR[01-04|11:22:21.359] Unhandled trie error: missing trie node 189fe45db81dee3bf57cec7f5e13209eface53f03ef58f86ceb8493d4cde0334 (path 06040500) <nil> \",\"logging.googleapis.com/labels\":{},\"serviceContext\":{\"service\":\"unknown\"}}\r\n{\"severity\":\"INFO\",\"timestamp\":\"2023-01-04T11:22:22.468495181-05:00\",\"logger\":\"reader.geth\",\"message\":\"imported new chain segment               blocks=1  txs=166  mgas=14.196 elapsed=15.878s   mgasps=0.894 number=16,326,663 hash=e0829e..0f5c93 age=1d2h32m  dirty=325.41MiB\",\"logging.googleapis.com/labels\":{}}\r\n{\"severity\":\"ERROR\",\"timestamp\":\"2023-01-04T11:22:23.584454097-05:00\",\"logger\":\"reader.geth\",\"message\":\"eRROR[01-04|11:22:23.584] Unhandled trie error: missing trie node fc38e46b4dec0e22649f5211301feeca3725915e6b119dc499c6f61211a10c9b (path 0b0809) <nil> \",\"logging.googleapis.com/labels\":{},\"serviceContext\":{\"service\":\"unknown\"}}\r\n{\"severity\":\"INFO\",\"timestamp\":\"2023-01-04T11:22:25.295982328-05:00\",\"logger\":\"reader.geth\",\"message\":\"writing clean trie cache to disk         path=/data/firehose/reader/data/geth/triecache threads=1\",\"logging.googleapis.com/labels\":{}}\r\n{\"severity\":\"INFO\",\"timestamp\":\"2023-01-04T11:22:25.98031204-05:00\",\"logger\":\"reader.geth\",\"message\":\"regenerated local transaction journal    transactions=0 accounts=0\",\"logging.googleapis.com/labels\":{}}\r\n{\"severity\":\"INFO\",\"timestamp\":\"2023-01-04T11:22:27.247244799-05:00\",\"logger\":\"reader.geth\",\"message\":\"persisted the clean trie cache           path=/data/firehose/reader/data/geth/triecache elapsed=1.951s\",\"logging.googleapis.com/labels\":{}}\r\n```\r\n\r\ncan I ignore these errors since it seems like I'm continuing to import new chain segments?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1371141602/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
