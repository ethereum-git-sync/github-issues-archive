{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16067",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16067/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16067/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16067/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/16067",
  "id": 296284702,
  "node_id": "MDU6SXNzdWUyOTYyODQ3MDI=",
  "number": 16067,
  "title": "Cost not updated at client side in flow control LES Protocol",
  "user": {
    "login": "OniReimu",
    "id": 22544855,
    "node_id": "MDQ6VXNlcjIyNTQ0ODU1",
    "avatar_url": "https://avatars.githubusercontent.com/u/22544855?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/OniReimu",
    "html_url": "https://github.com/OniReimu",
    "followers_url": "https://api.github.com/users/OniReimu/followers",
    "following_url": "https://api.github.com/users/OniReimu/following{/other_user}",
    "gists_url": "https://api.github.com/users/OniReimu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/OniReimu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/OniReimu/subscriptions",
    "organizations_url": "https://api.github.com/users/OniReimu/orgs",
    "repos_url": "https://api.github.com/users/OniReimu/repos",
    "events_url": "https://api.github.com/users/OniReimu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/OniReimu/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2018-02-12T07:22:03Z",
  "updated_at": "2018-02-12T15:16:36Z",
  "closed_at": "2018-02-12T14:46:25Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `geth 1.6.7`\r\nOS & Version: Windows/Linux/OSX\r\n\r\n#### Expected behaviour\r\n1) fcCosts synced at both server and client.\r\n\r\n2) bv sent back from server to client when sending SendTxMsg from client to server, in order to set BLE to this real bv.\r\n\r\n#### Actual behaviour\r\n1) It seems like the fcCosts at client side does not update via the GotReply message sent from server side. Note that GotReply only manipulate the buf stuffs but nothing to do with the fcCosts at client side.\r\n\r\n2) In les/handler.go - handleMsg(), receiving a SendTxMsg does not involve a response sending back to client, which means client is not able to get the real bv.\r\n\r\n#### More\r\n1) The fcCosts should not only be updated when every handshaking during which server side calls les/server.go - getCurrentlist() and sends to client, but also being updated every time client receives GotReply() sent from server, otherwise every time client manages to send a request invoked no matter from - GetRequestCost() in light/txrelay.go  or les/odr.go, client always get the old costs. Unless the protocol does define as what it is, only the non-initial handshakes will update the fcCosts at client side while client disconnects and logs in again. \r\nAlso from les/peers.go,  all sendRequest including SendTx have not involved the \"cost\" in the sending function even if some of them have this cost as a parameter. **It indicates that there seems no connection between the fcCosts at client and server side**. Then it turns out to be a weird issue, why do we need to have the fcCosts at client side? You keep it, but not use it when sending request, and no update when GotReply. Is that trivial? \r\n\r\n2) I am not pretty sure about the behaviour of receiving a SendTxMsg in les/handler.go. Server still calculates the real cost and updates its local fcCosts without sending any info back to client, contributing to client knowing nothing about the status of this request, and having nothing to do with its local bufEstimate. Would it matter if it is in this case?",
  "closed_by": {
    "login": "ligi",
    "id": 111600,
    "node_id": "MDQ6VXNlcjExMTYwMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ligi",
    "html_url": "https://github.com/ligi",
    "followers_url": "https://api.github.com/users/ligi/followers",
    "following_url": "https://api.github.com/users/ligi/following{/other_user}",
    "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
    "organizations_url": "https://api.github.com/users/ligi/orgs",
    "repos_url": "https://api.github.com/users/ligi/repos",
    "events_url": "https://api.github.com/users/ligi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ligi/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16067/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16067/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/364883800",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16067#issuecomment-364883800",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16067",
    "id": 364883800,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDg4MzgwMA==",
    "user": {
      "login": "ligi",
      "id": 111600,
      "node_id": "MDQ6VXNlcjExMTYwMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ligi",
      "html_url": "https://github.com/ligi",
      "followers_url": "https://api.github.com/users/ligi/followers",
      "following_url": "https://api.github.com/users/ligi/following{/other_user}",
      "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
      "organizations_url": "https://api.github.com/users/ligi/orgs",
      "repos_url": "https://api.github.com/users/ligi/repos",
      "events_url": "https://api.github.com/users/ligi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ligi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-12T10:32:25Z",
    "updated_at": "2018-02-12T10:36:28Z",
    "author_association": "MEMBER",
    "body": "Can you try with geth 1.7.3 - or is there any specific reason you use 1.6.7?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/364883800/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/364885607",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16067#issuecomment-364885607",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16067",
    "id": 364885607,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDg4NTYwNw==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-12T10:40:45Z",
    "updated_at": "2018-02-12T10:40:45Z",
    "author_association": "MEMBER",
    "body": "I'd suggest going with master, not 1.7.3. We're wrapping up the release, so even 1.7.3 is mostly irrelevant now.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/364885607/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/364942017",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16067#issuecomment-364942017",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16067",
    "id": 364942017,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDk0MjAxNw==",
    "user": {
      "login": "OniReimu",
      "id": 22544855,
      "node_id": "MDQ6VXNlcjIyNTQ0ODU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/22544855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/OniReimu",
      "html_url": "https://github.com/OniReimu",
      "followers_url": "https://api.github.com/users/OniReimu/followers",
      "following_url": "https://api.github.com/users/OniReimu/following{/other_user}",
      "gists_url": "https://api.github.com/users/OniReimu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/OniReimu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/OniReimu/subscriptions",
      "organizations_url": "https://api.github.com/users/OniReimu/orgs",
      "repos_url": "https://api.github.com/users/OniReimu/repos",
      "events_url": "https://api.github.com/users/OniReimu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/OniReimu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-12T14:41:27Z",
    "updated_at": "2018-02-12T14:41:27Z",
    "author_association": "NONE",
    "body": "@ligi Ehh...our project forks from 1.6.7 and make lots of customization on each module. A couple of works are needed if we move to the latest version. But anyway, if master or 1.7.3 has solved the issue I will try to figure it out and add the release based on 1.6.7. If issues still exist, I will let you guys know, thx.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/364942017/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/364943446",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16067#issuecomment-364943446",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16067",
    "id": 364943446,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDk0MzQ0Ng==",
    "user": {
      "login": "ligi",
      "id": 111600,
      "node_id": "MDQ6VXNlcjExMTYwMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ligi",
      "html_url": "https://github.com/ligi",
      "followers_url": "https://api.github.com/users/ligi/followers",
      "following_url": "https://api.github.com/users/ligi/following{/other_user}",
      "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
      "organizations_url": "https://api.github.com/users/ligi/orgs",
      "repos_url": "https://api.github.com/users/ligi/repos",
      "events_url": "https://api.github.com/users/ligi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ligi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-12T14:46:25Z",
    "updated_at": "2018-02-12T14:46:53Z",
    "author_association": "MEMBER",
    "body": "@OniReimu : great - closing this issue then - feel free to reopen if you still have the problem on master\r\n\r\nAnyway - just curious - would like to know what your project is",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/364943446/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/364945132",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16067#issuecomment-364945132",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16067",
    "id": 364945132,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2NDk0NTEzMg==",
    "user": {
      "login": "OniReimu",
      "id": 22544855,
      "node_id": "MDQ6VXNlcjIyNTQ0ODU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/22544855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/OniReimu",
      "html_url": "https://github.com/OniReimu",
      "followers_url": "https://api.github.com/users/OniReimu/followers",
      "following_url": "https://api.github.com/users/OniReimu/following{/other_user}",
      "gists_url": "https://api.github.com/users/OniReimu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/OniReimu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/OniReimu/subscriptions",
      "organizations_url": "https://api.github.com/users/OniReimu/orgs",
      "repos_url": "https://api.github.com/users/OniReimu/repos",
      "events_url": "https://api.github.com/users/OniReimu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/OniReimu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-12T14:51:53Z",
    "updated_at": "2018-02-12T14:51:53Z",
    "author_association": "NONE",
    "body": "@ligi ucot Australia, a very new IoT project with blockchain.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/364945132/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
