{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21294",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21294/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21294/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21294/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/21294",
  "id": 651132067,
  "node_id": "MDU6SXNzdWU2NTExMzIwNjc=",
  "number": 21294,
  "title": "Sync checkpoint failed",
  "user": {
    "login": "flgh",
    "id": 33400822,
    "node_id": "MDQ6VXNlcjMzNDAwODIy",
    "avatar_url": "https://avatars.githubusercontent.com/u/33400822?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/flgh",
    "html_url": "https://github.com/flgh",
    "followers_url": "https://api.github.com/users/flgh/followers",
    "following_url": "https://api.github.com/users/flgh/following{/other_user}",
    "gists_url": "https://api.github.com/users/flgh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/flgh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/flgh/subscriptions",
    "organizations_url": "https://api.github.com/users/flgh/orgs",
    "repos_url": "https://api.github.com/users/flgh/repos",
    "events_url": "https://api.github.com/users/flgh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/flgh/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1132689577,
      "node_id": "MDU6TGFiZWwxMTMyNjg5NTc3",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:triage",
      "name": "status:triage",
      "color": "6be514",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-07-05T19:38:06Z",
  "updated_at": "2020-09-03T08:34:10Z",
  "closed_at": "2020-09-03T08:34:10Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 1.9.15-stable\r\nOS & Version: Linux\r\n\r\nBoth client and server are in each other's static and trusted peer.\r\n#### Expected behaviour\r\n\r\nLight client sync succesfully with remote light server peer (--nodiscover --netrestrict 192.168.1.2/32 --maxpeers 1) \r\n#### Actual behaviour\r\nWorks flawlessly for a few months then:\r\nWARN [07-05|15:58:25.827] Synchronisation failed, retrying         err=\"peer is unknown or unhealthy\"\r\n\r\n<pre>\r\nTRACE[07-05|19:45:29.798] Starting p2p dial                        id=dfc7027894e168c3 ip=192.168.1.2  flag=staticdial\r\nDEBUG[07-05|19:45:29.800] Adding p2p peer                          peercount=1 id=dfc7027894e168c3 conn=trusted-staticdial addr=192.168.1.2:30303 name=Geth/v1.9.15-stable-...\r\nTRACE[07-05|19:45:29.800] Starting protocol les/3                  id=dfc7027894e168c3 conn=trusted-staticdial\r\nDEBUG[07-05|19:45:29.800] Light Ethereum peer connected            id=dfc7027894e168c3 conn=trusted-staticdial name=Geth/v1.9.15-stable-0f77f34b/linux-amd64/go1.14.4\r\nDEBUG[07-05|19:45:29.800] Node entered                             set=connected id=dfc7027894e168c3 count=1\r\nTRACE[07-05|19:45:29.801] Registering sync peer                    peer=dfc7027894e168c3292c50b5461ef8ec635a5e04874b1e13b5ad7596a98f3bda\r\nDEBUG[07-05|19:45:29.801] Received new announcement                id=dfc7027894e168c3 conn=trusted-staticdial number=10400821 hash=\"792667â€¦f8e5b3\" reorg=0\r\nDEBUG[07-05|19:45:29.801] Synchronisation started                  id=dfc7027894e168c3 conn=trusted-staticdial\r\nDEBUG[07-05|19:45:29.801] Disable checkpoint syncing               reason=\"checkpoint is hardcoded\"\r\nDEBUG[07-05|19:45:29.801] Checkpoint syncing start                 peer=dfc7027894e168c3292c50b5461ef8ec635a5e04874b1e13b5ad7596a98f3bda checkpoint=310\r\nDEBUG[07-05|19:45:29.801] Sync checkpoint failed\r\nDEBUG[07-05|19:45:29.801] Node left                                set=connected id=dfc7027894e168c3 count=0\r\nTRACE[07-05|19:45:29.801] Unregistering sync peer                  peer=dfc7027894e168c3292c50b5461ef8ec635a5e04874b1e13b5ad7596a98f3bda\r\nDEBUG[07-05|19:45:29.801] Done synchronising with peer             id=dfc7027894e168c3 conn=trusted-staticdial\r\nDEBUG[07-05|19:45:29.801] Light Ethereum message handling failed   id=dfc7027894e168c3 conn=trusted-staticdial err=EOF\r\nDEBUG[07-05|19:45:29.801] Unknown peer to check sync headers       id=dfc7027894e168c3 conn=trusted-staticdial\r\nDEBUG[07-05|19:45:29.801] Removing p2p peer                        peercount=0 id=dfc7027894e168c3 duration=1.060ms     req=false err=\"disconnect requested\"\r\n</pre>\r\nTried removing ~/.ethereum/geth content on the light client, doesn't fix the issue.\r\nThen after a few hours, the light client syncs again correctly.",
  "closed_by": {
    "login": "adamschmideg",
    "id": 208822,
    "node_id": "MDQ6VXNlcjIwODgyMg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/208822?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/adamschmideg",
    "html_url": "https://github.com/adamschmideg",
    "followers_url": "https://api.github.com/users/adamschmideg/followers",
    "following_url": "https://api.github.com/users/adamschmideg/following{/other_user}",
    "gists_url": "https://api.github.com/users/adamschmideg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/adamschmideg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/adamschmideg/subscriptions",
    "organizations_url": "https://api.github.com/users/adamschmideg/orgs",
    "repos_url": "https://api.github.com/users/adamschmideg/repos",
    "events_url": "https://api.github.com/users/adamschmideg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/adamschmideg/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21294/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21294/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/653979753",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21294#issuecomment-653979753",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21294",
    "id": 653979753,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1Mzk3OTc1Mw==",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-06T02:14:20Z",
    "updated_at": "2020-07-06T02:14:20Z",
    "author_association": "MEMBER",
    "body": "The mechanism of light sync is light client will try to start with a checkpoint and then sync the remaining headers.\r\nIn this case(from your log), light client is failed to fetch the checkpoint header, so the procedure is aborted.\r\n\r\nThere are lots of possibilities that can lead to this situation:\r\n- the peer doesn't delivery the requested header in time\r\n- the peer doesn't have the requested header(out of sync, in the fork chain)\r\n- the peer deliberately don't send the requested header\r\n\r\nSo it's not incorrect behavior.\r\n\r\n> Then after a few hours\r\n\r\nBecause there are limited LES server for serving clients, so it takes that long time to find the next suitable server.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/653979753/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
