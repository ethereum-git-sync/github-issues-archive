{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3384",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3384/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3384/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3384/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/3384",
  "id": 192537575,
  "node_id": "MDU6SXNzdWUxOTI1Mzc1NzU=",
  "number": 3384,
  "title": "Missing transactions on private chain",
  "user": {
    "login": "mrhornsby",
    "id": 8075558,
    "node_id": "MDQ6VXNlcjgwNzU1NTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8075558?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mrhornsby",
    "html_url": "https://github.com/mrhornsby",
    "followers_url": "https://api.github.com/users/mrhornsby/followers",
    "following_url": "https://api.github.com/users/mrhornsby/following{/other_user}",
    "gists_url": "https://api.github.com/users/mrhornsby/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mrhornsby/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mrhornsby/subscriptions",
    "organizations_url": "https://api.github.com/users/mrhornsby/orgs",
    "repos_url": "https://api.github.com/users/mrhornsby/repos",
    "events_url": "https://api.github.com/users/mrhornsby/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mrhornsby/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2016-11-30T11:08:08Z",
  "updated_at": "2016-12-01T08:37:57Z",
  "closed_at": "2016-12-01T08:37:57Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 1.4.11\r\nOS & Version: Linux\r\n\r\n#### Expected behaviour\r\n\r\n10,000 transactions in chain\r\n\r\n#### Actual behaviour\r\n\r\n9,998 transactions in chain\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nWe are running a private chain, two nodes, both mining, and submitting a large number of transactions in quick succession from the first node (we are starting on a very low difficulty and therefore blocks are occurring every second or two).\r\n\r\nOn submitting 10,000 transactions we see 10,000 transactions in the logs (both \"Tx(...)\" messages as well as the sum of transactions included in both imports and mined blocks), however when logging in to the console and counting the transactions in each block we see a mismatch between what the log says and how many transactions are actually in the block.\r\n\r\nThe block in question in the example below is #502. This block has 29 transactions according to the geth console, however the logs shows two \"commit new work messages\" with 49 and 50 transactions respectively and then an import showing 31 transactions - note the difference of 2 (we have verified that the two missing transactions were submitted to geth just before this block).\r\n\r\neth.pendingTransactions on the console shows an empty array.\r\n\r\n````\r\nI1129 17:33:44.237831 miner/worker.go:435] ðŸ”¨ ðŸ”—  Mined 5 blocks back: block #494\r\nI1129 17:33:44.241910 miner/worker.go:573] commit new work on block 500 with 4 txs & 0 uncles. Took 4.045376ms\r\nI1129 17:33:45.163184 miner/worker.go:339] ðŸ”¨  Mined block (#500 / e0950924). Wait 5 blocks for confirmation\r\nI1129 17:33:45.182119 miner/worker.go:573] commit new work on block 501 with 18 txs & 0 uncles. Took 18.865122ms\r\nI1129 17:33:45.182179 miner/worker.go:435] ðŸ”¨ ðŸ”—  Mined 5 blocks back: block #495\r\nI1129 17:33:45.201126 miner/worker.go:573] commit new work on block 501 with 19 txs & 0 uncles. Took 18.913025ms\r\nI1129 17:33:45.972615 core/blockchain.go:962] imported 0 block(s) (0 queued 2 ignored) including 0 txs in 9.1836ms. #486 [3b8174e1 / 813a4de5]\r\nI1129 17:33:45.999537 core/blockchain.go:962] imported 1 block(s) (3 queued 12 ignored) including 1 txs in 17.932182ms. #502 [efe2fc92 / ba134a8e]\r\nI1129 17:33:47.648530 miner/worker.go:339] ðŸ”¨  Mined block (#501 / cc534f99). Wait 5 blocks for confirmation\r\nI1129 17:33:47.698761 miner/worker.go:573] commit new work on block 502 with 49 txs & 1 uncles. Took 50.201788ms\r\nI1129 17:33:47.698821 miner/worker.go:435] ðŸ”¨ ðŸ”—  Mined 5 blocks back: block #496\r\nI1129 17:33:47.754573 miner/worker.go:573] commit new work on block 502 with 50 txs & 1 uncles. Took 55.582923ms\r\nI1129 17:33:48.190609 core/blockchain.go:962] imported 3 block(s) (0 queued 0 ignored) including 31 txs in 102.864085ms. #502 [99ce6546 / ba134a8e]\r\nI1129 17:33:48.251861 miner/worker.go:573] commit new work on block 503 with 51 txs & 0 uncles. Took 61.139165ms\r\nI1129 17:33:48.251905 miner/worker.go:435] ðŸ”¨ ðŸ”—  Mined 5 blocks back: block #497\r\nI1129 17:33:49.838009 core/blockchain.go:962] imported 1 block(s) (0 queued 0 ignored) including 8 txs in 12.364739ms. #503 [8a81a71b / 8a81a71b]\r\nI1129 17:33:49.914839 miner/worker.go:573] commit new work on block 504 with 76 txs & 0 uncles. Took 76.555537ms\r\n````\r\n\r\nWe are currently upgrading to geth 1.5.4 to verify if we see the same behaviour.\r\n\r\nOur client code can track the missing transactions and could re-submit them, but this seems like a nasty hack and I'd like to understand if I'm missing something in terms of geth telling me the two transactions failed for some reason (I'd expect some kind of json rpc error) or is there some kind of race condition allowing these two transactions to dissappear when importing multiple blocks.",
  "closed_by": {
    "login": "mrhornsby",
    "id": 8075558,
    "node_id": "MDQ6VXNlcjgwNzU1NTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8075558?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mrhornsby",
    "html_url": "https://github.com/mrhornsby",
    "followers_url": "https://api.github.com/users/mrhornsby/followers",
    "following_url": "https://api.github.com/users/mrhornsby/following{/other_user}",
    "gists_url": "https://api.github.com/users/mrhornsby/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mrhornsby/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mrhornsby/subscriptions",
    "organizations_url": "https://api.github.com/users/mrhornsby/orgs",
    "repos_url": "https://api.github.com/users/mrhornsby/repos",
    "events_url": "https://api.github.com/users/mrhornsby/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mrhornsby/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3384/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3384/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/263862948",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/3384#issuecomment-263862948",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3384",
    "id": 263862948,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2Mzg2Mjk0OA==",
    "user": {
      "login": "mrhornsby",
      "id": 8075558,
      "node_id": "MDQ6VXNlcjgwNzU1NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8075558?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mrhornsby",
      "html_url": "https://github.com/mrhornsby",
      "followers_url": "https://api.github.com/users/mrhornsby/followers",
      "following_url": "https://api.github.com/users/mrhornsby/following{/other_user}",
      "gists_url": "https://api.github.com/users/mrhornsby/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mrhornsby/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mrhornsby/subscriptions",
      "organizations_url": "https://api.github.com/users/mrhornsby/orgs",
      "repos_url": "https://api.github.com/users/mrhornsby/repos",
      "events_url": "https://api.github.com/users/mrhornsby/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mrhornsby/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-30T12:34:10Z",
    "updated_at": "2016-11-30T12:34:10Z",
    "author_association": "NONE",
    "body": "Just to add - we've confirmed similar behaviour under 1.5.4. We've also noticed that we tend to drop more transactions at higher rates (we currently limit to 20 tx/s and were seeing 2-3 missing transactions in 10000. At 30 tx/s we saw 96 missing transactions in 10000). We're continuing to investigate.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/263862948/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/264111564",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/3384#issuecomment-264111564",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/3384",
    "id": 264111564,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2NDExMTU2NA==",
    "user": {
      "login": "mrhornsby",
      "id": 8075558,
      "node_id": "MDQ6VXNlcjgwNzU1NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8075558?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mrhornsby",
      "html_url": "https://github.com/mrhornsby",
      "followers_url": "https://api.github.com/users/mrhornsby/followers",
      "following_url": "https://api.github.com/users/mrhornsby/following{/other_user}",
      "gists_url": "https://api.github.com/users/mrhornsby/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mrhornsby/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mrhornsby/subscriptions",
      "organizations_url": "https://api.github.com/users/mrhornsby/orgs",
      "repos_url": "https://api.github.com/users/mrhornsby/repos",
      "events_url": "https://api.github.com/users/mrhornsby/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mrhornsby/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-12-01T08:37:57Z",
    "updated_at": "2016-12-01T08:37:57Z",
    "author_association": "NONE",
    "body": "Having investigated further this appears to be a duplicate of #2950. Our missing transactions are caused by duplicate nonces being assigned in the tx_pool and then the transactions being silently dropped. We have worked around this by issuing our own nonces from our client code in calls to eth_sendTransaction.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/264111564/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
