{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21948",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21948/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21948/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21948/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/21948",
  "id": 756025675,
  "node_id": "MDU6SXNzdWU3NTYwMjU2NzU=",
  "number": 21948,
  "title": "Shutdown is too slow",
  "user": {
    "login": "ligi",
    "id": 111600,
    "node_id": "MDQ6VXNlcjExMTYwMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ligi",
    "html_url": "https://github.com/ligi",
    "followers_url": "https://api.github.com/users/ligi/followers",
    "following_url": "https://api.github.com/users/ligi/following{/other_user}",
    "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
    "organizations_url": "https://api.github.com/users/ligi/orgs",
    "repos_url": "https://api.github.com/users/ligi/repos",
    "events_url": "https://api.github.com/users/ligi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ligi/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2020-12-03T09:32:38Z",
  "updated_at": "2021-10-28T09:29:34Z",
  "closed_at": "2021-10-28T09:29:34Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "follow up from #21917\r\neither make it faster or make it more resilient when shutting down to not lead to bad states",
  "closed_by": {
    "login": "ligi",
    "id": 111600,
    "node_id": "MDQ6VXNlcjExMTYwMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ligi",
    "html_url": "https://github.com/ligi",
    "followers_url": "https://api.github.com/users/ligi/followers",
    "following_url": "https://api.github.com/users/ligi/following{/other_user}",
    "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
    "organizations_url": "https://api.github.com/users/ligi/orgs",
    "repos_url": "https://api.github.com/users/ligi/repos",
    "events_url": "https://api.github.com/users/ligi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ligi/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21948/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21948/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/738297423",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21948#issuecomment-738297423",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21948",
    "id": 738297423,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczODI5NzQyMw==",
    "user": {
      "login": "bokkypoobah",
      "id": 17121975,
      "node_id": "MDQ6VXNlcjE3MTIxOTc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/17121975?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bokkypoobah",
      "html_url": "https://github.com/bokkypoobah",
      "followers_url": "https://api.github.com/users/bokkypoobah/followers",
      "following_url": "https://api.github.com/users/bokkypoobah/following{/other_user}",
      "gists_url": "https://api.github.com/users/bokkypoobah/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bokkypoobah/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bokkypoobah/subscriptions",
      "organizations_url": "https://api.github.com/users/bokkypoobah/orgs",
      "repos_url": "https://api.github.com/users/bokkypoobah/repos",
      "events_url": "https://api.github.com/users/bokkypoobah/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bokkypoobah/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-03T20:47:06Z",
    "updated_at": "2020-12-03T20:47:06Z",
    "author_association": "NONE",
    "body": "Experiencing issues with the geth shutdown as well.\r\n\r\n```Dec 04 07:11:55 zozzfozzel systemd[1]: Stopping Geth...\r\nDec 04 07:11:55 zozzfozzel geth[764]: INFO [12-04|07:11:55.458] Got interrupt, shutting down...\r\nDec 04 07:11:55 zozzfozzel geth[764]: INFO [12-04|07:11:55.958] HTTP server stopped                      endpoint=127.0.0.1:8545\r\nDec 04 07:11:55 zozzfozzel geth[764]: INFO [12-04|07:11:55.960] IPC endpoint closed                      url=/home/geth/.ethereum/geth.ipc\r\nDec 04 07:11:55 zozzfozzel geth[764]: INFO [12-04|07:11:55.960] Terminated topic registration            topic=LES2@d4e56740f876aef8\r\nDec 04 07:12:10 zozzfozzel geth[764]: INFO [12-04|07:12:10.989] Deep froze chain segment                 blocks=4    elapsed=12.895ms  number=11291759 hash=\"8e1db4…ae4e57\"\r\nDec 04 07:12:22 zozzfozzel geth[764]: WARN [12-04|07:12:22.883] Checkpoint challenge timed out, dropping id=6a0f99574c10145e conn=dyndial addr=150.109.126.69:30303  type=Geth/v1.9.24-stable-...\r\nDec 04 07:12:40 zozzfozzel geth[764]: INFO [12-04|07:12:40.282] Imported new chain segment               blocks=1    txs=205   mgas=12.478  elapsed=160.840ms mgasps=77.582  number=11381760 hash=\"bf9a98…91a623\" age=1m1s      dirty=1022.46MiB\r\nDec 04 07:13:12 zozzfozzel geth[764]: INFO [12-04|07:13:12.576] Imported new chain segment               blocks=1    txs=389   mgas=12.455  elapsed=123.502ms mgasps=100.849 number=11381761 hash=\"4276af…a995f1\" dirty=1022.51MiB\r\nDec 04 07:14:11 zozzfozzel geth[764]: INFO [12-04|07:14:11.002] Deep froze chain segment                 blocks=2    elapsed=12.018ms  number=11291761 hash=\"975c1f…69f1b1\"\r\nDec 04 07:14:37 zozzfozzel geth[764]: INFO [12-04|07:14:37.151] Imported new chain segment               blocks=1    txs=202   mgas=12.488  elapsed=129.809ms mgasps=96.199  number=11381762 hash=\"8565c4…7aaa46\" age=1m26s     dirty=1022.74MiB\r\nDec 04 07:14:47 zozzfozzel geth[764]: INFO [12-04|07:14:47.451] Imported new chain segment               blocks=1    txs=191   mgas=12.464  elapsed=123.413ms mgasps=100.993 number=11381763 hash=\"e77f2a…489380\" dirty=1022.46MiB\r\nDec 04 07:14:49 zozzfozzel geth[764]: INFO [12-04|07:14:49.888] Imported new chain segment               blocks=1    txs=188   mgas=12.482  elapsed=457.867ms mgasps=27.262  number=11381764 hash=\"b3cb61…db5237\" dirty=1022.77MiB\r\nDec 04 07:14:51 zozzfozzel geth[764]: INFO [12-04|07:14:51.863] Imported new chain segment               blocks=1    txs=147   mgas=12.461  elapsed=1.156s    mgasps=10.777  number=11381765 hash=\"6365ff…174761\" dirty=1022.59MiB\r\nDec 04 07:14:51 zozzfozzel geth[764]: INFO [12-04|07:14:51.944] Imported new chain segment               blocks=1    txs=149   mgas=12.485  elapsed=81.334ms  mgasps=153.503 number=11381765 hash=\"38cb8b…430a2f\" dirty=1022.75MiB\r\nDec 04 07:14:52 zozzfozzel geth[764]: INFO [12-04|07:14:52.496] Chain reorg detected                     number=11381764 hash=\"b3cb61…db5237\" drop=1 dropfrom=\"6365ff…174761\" add=2 addfrom=\"9c3614…cc253c\"\r\nDec 04 07:14:52 zozzfozzel geth[764]: INFO [12-04|07:14:52.500] Imported new chain segment               blocks=1    txs=172   mgas=12.508  elapsed=108.364ms mgasps=115.427 number=11381766 hash=\"9c3614…cc253c\" dirty=1022.53MiB\r\nDec 04 07:15:03 zozzfozzel geth[764]: WARN [12-04|07:15:03.485] Already shutting down, interrupt more to panic. times=9\r\nDec 04 07:15:03 zozzfozzel geth[764]: INFO [12-04|07:15:03.672] Imported new chain segment               blocks=1    txs=123   mgas=12.510  elapsed=133.953ms mgasps=93.393  number=11381767 hash=\"ad74f5…6ea36f\" dirty=1023.18MiB\r\nDec 04 07:15:09 zozzfozzel geth[764]: INFO [12-04|07:15:09.285] Imported new chain segment               blocks=1    txs=184   mgas=12.503  elapsed=141.811ms mgasps=88.170  number=11381768 hash=\"fb2038…c93b0a\" dirty=1022.52MiB\r\nDec 04 07:15:11 zozzfozzel geth[764]: INFO [12-04|07:15:11.015] Deep froze chain segment                 blocks=7    elapsed=12.485ms  number=11291768 hash=\"a7b4bc…e4a15a\"\r\nDec 04 07:15:14 zozzfozzel geth[764]: INFO [12-04|07:15:14.788] Imported new chain segment               blocks=1    txs=166   mgas=12.512  elapsed=128.842ms mgasps=97.110  number=11381769 hash=\"4a2da4…06a874\" dirty=1022.29MiB\r\nDec 04 07:15:18 zozzfozzel geth[764]: INFO [12-04|07:15:18.062] Imported new chain segment               blocks=1    txs=139   mgas=12.489  elapsed=90.776ms  mgasps=137.576 number=11381770 hash=\"d21588…908ed1\" dirty=1023.10MiB\r\nDec 04 07:15:44 zozzfozzel geth[764]: INFO [12-04|07:15:44.272] Imported new chain segment               blocks=1    txs=196   mgas=12.474  elapsed=189.911ms mgasps=65.682  number=11381771 hash=\"858e8c…2349f2\" dirty=1022.76MiB\r\nDec 04 07:15:48 zozzfozzel geth[764]: INFO [12-04|07:15:48.151] Imported new chain segment               blocks=1    txs=142   mgas=12.462  elapsed=103.671ms mgasps=120.207 number=11381772 hash=\"d3ca88…c3004d\" dirty=1022.31MiB\r\nDec 04 07:15:57 zozzfozzel geth[764]: INFO [12-04|07:15:57.998] Imported new chain segment               blocks=1    txs=137   mgas=12.450  elapsed=172.826ms mgasps=72.037  number=11381773 hash=\"9b5946…f7b923\" dirty=1022.72MiB\r\nDec 04 07:16:05 zozzfozzel geth[764]: INFO [12-04|07:16:05.485] Imported new chain segment               blocks=1    txs=163   mgas=12.269  elapsed=132.791ms mgasps=92.391  number=11381774 hash=\"0770aa…cb2415\" dirty=1022.56MiB\r\nDec 04 07:16:06 zozzfozzel geth[764]: INFO [12-04|07:16:06.399] Imported new chain segment               blocks=1    txs=0     mgas=0.000   elapsed=16.408ms  mgasps=0.000   number=11381775 hash=\"1f9e58…33c415\" dirty=1021.06MiB\r\nDec 04 07:16:11 zozzfozzel geth[764]: INFO [12-04|07:16:11.035] Deep froze chain segment                 blocks=7    elapsed=16.237ms  number=11291775 hash=\"ca7604…7f385b\"\r\nDec 04 07:16:12 zozzfozzel geth[764]: INFO [12-04|07:16:12.501] Imported new chain segment               blocks=1    txs=136   mgas=12.441  elapsed=113.503ms mgasps=109.607 number=11381776 hash=\"3c4745…8177da\" dirty=1021.15MiB\r\nDec 04 07:16:13 zozzfozzel geth[764]: INFO [12-04|07:16:13.282] Imported new chain segment               blocks=1    txs=144   mgas=12.312  elapsed=92.223ms  mgasps=133.503 number=11381777 hash=\"dd7e70…5ffdcd\" dirty=1021.00MiB\r\nDec 04 07:16:18 zozzfozzel geth[764]: INFO [12-04|07:16:18.595] Imported new chain segment               blocks=1    txs=193   mgas=12.445  elapsed=97.510ms  mgasps=127.626 number=11381778 hash=\"a38327…666837\" dirty=1021.22MiB\r\nDec 04 07:16:32 zozzfozzel geth[764]: INFO [12-04|07:16:32.519] Imported new chain segment               blocks=1    txs=168   mgas=12.427  elapsed=151.894ms mgasps=81.814  number=11381779 hash=\"993f85…efe74c\" dirty=1021.22MiB\r\nDec 04 07:16:36 zozzfozzel geth[764]: INFO [12-04|07:16:36.066] Imported new chain segment               blocks=1    txs=109   mgas=12.446  elapsed=110.722ms mgasps=112.407 number=11381780 hash=\"b60a19…0fbbcd\" dirty=1022.00MiB\r\nDec 04 07:16:50 zozzfozzel geth[764]: INFO [12-04|07:16:50.962] Imported new chain segment               blocks=1    txs=154   mgas=12.426  elapsed=291.779ms mgasps=42.588  number=11381781 hash=\"800df7…03dda4\" dirty=1022.48MiB\r\nDec 04 07:16:55 zozzfozzel systemd[1]: geth.service: State 'stop-sigterm' timed out. Killing.\r\nDec 04 07:16:55 zozzfozzel systemd[1]: geth.service: Killing process 764 (geth) with signal SIGKILL.\r\nDec 04 07:16:55 zozzfozzel systemd[1]: geth.service: Main process exited, code=killed, status=9/KILL\r\nDec 04 07:16:55 zozzfozzel systemd[1]: geth.service: Failed with result 'timeout'.\r\nDec 04 07:16:55 zozzfozzel systemd[1]: Stopped Geth.\r\nDec 04 07:17:34 zozzfozzel systemd[1]: Started Geth.\r\n```\r\n\r\nSent geth a systemd restart. geth receives the interrupt and says it's shutting down. But geth continues receiving new blocks. systemd then sends a KILL signal - default is 90 seconds but I've configured to 3 minutes. You can see the KILL signal logged.\r\n\r\ngeth then loses about 30,000+ blocks, and has to resync again.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/738297423/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/738339465",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21948#issuecomment-738339465",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21948",
    "id": 738339465,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczODMzOTQ2NQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-03T21:48:18Z",
    "updated_at": "2020-12-03T21:48:18Z",
    "author_association": "MEMBER",
    "body": "@bokkypoobah were you running light server? We recently fixed a shutdown-hang there: https://github.com/ethereum/go-ethereum/pull/21927 ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/738339465/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/738343491",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21948#issuecomment-738343491",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21948",
    "id": 738343491,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczODM0MzQ5MQ==",
    "user": {
      "login": "bokkypoobah",
      "id": 17121975,
      "node_id": "MDQ6VXNlcjE3MTIxOTc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/17121975?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bokkypoobah",
      "html_url": "https://github.com/bokkypoobah",
      "followers_url": "https://api.github.com/users/bokkypoobah/followers",
      "following_url": "https://api.github.com/users/bokkypoobah/following{/other_user}",
      "gists_url": "https://api.github.com/users/bokkypoobah/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bokkypoobah/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bokkypoobah/subscriptions",
      "organizations_url": "https://api.github.com/users/bokkypoobah/orgs",
      "repos_url": "https://api.github.com/users/bokkypoobah/repos",
      "events_url": "https://api.github.com/users/bokkypoobah/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bokkypoobah/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-03T21:56:45Z",
    "updated_at": "2020-12-03T21:56:45Z",
    "author_association": "NONE",
    "body": "> @bokkypoobah were you running light server? We recently fixed a shutdown-hang there: #21927\r\n\r\nYes. Had --light.serve 20 . Removed this parameter before the last restart, so hopefully this problem will no longer happen.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/738343491/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/953591402",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21948#issuecomment-953591402",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21948",
    "id": 953591402,
    "node_id": "IC_kwDOAOvK98441qZq",
    "user": {
      "login": "ligi",
      "id": 111600,
      "node_id": "MDQ6VXNlcjExMTYwMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ligi",
      "html_url": "https://github.com/ligi",
      "followers_url": "https://api.github.com/users/ligi/followers",
      "following_url": "https://api.github.com/users/ligi/following{/other_user}",
      "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
      "organizations_url": "https://api.github.com/users/ligi/orgs",
      "repos_url": "https://api.github.com/users/ligi/repos",
      "events_url": "https://api.github.com/users/ligi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ligi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-28T07:53:29Z",
    "updated_at": "2021-10-28T07:53:29Z",
    "author_association": "MEMBER",
    "body": "duplicate of #22524",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/953591402/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
