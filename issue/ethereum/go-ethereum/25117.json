{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25117",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25117/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25117/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25117/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/25117",
  "id": 1274775918,
  "node_id": "I_kwDOAOvK985L-4lu",
  "number": 25117,
  "title": "Geth node at some stage of synchronization sees the wrong last block",
  "user": {
    "login": "JeySee3",
    "id": 42541852,
    "node_id": "MDQ6VXNlcjQyNTQxODUy",
    "avatar_url": "https://avatars.githubusercontent.com/u/42541852?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/JeySee3",
    "html_url": "https://github.com/JeySee3",
    "followers_url": "https://api.github.com/users/JeySee3/followers",
    "following_url": "https://api.github.com/users/JeySee3/following{/other_user}",
    "gists_url": "https://api.github.com/users/JeySee3/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/JeySee3/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/JeySee3/subscriptions",
    "organizations_url": "https://api.github.com/users/JeySee3/orgs",
    "repos_url": "https://api.github.com/users/JeySee3/repos",
    "events_url": "https://api.github.com/users/JeySee3/events{/privacy}",
    "received_events_url": "https://api.github.com/users/JeySee3/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-06-17T09:05:35Z",
  "updated_at": "2022-09-30T02:30:04Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `v1.10.18`\r\nOS & Version: Docker\r\nNetwork ropsten\r\n\r\n#### Expected behaviour\r\nGeth node must be synced and have the same actual block as on the [resource](https://ropsten.etherscan.io/).\r\n\r\n#### Actual behaviour\r\nGeth node at some stage of synchronization sees the wrong last block:\r\n```\r\n{\r\n  currentBlock: 12307984,\r\n  healedBytecodeBytes: \"0x0\",\r\n  healedBytecodes: \"0x0\",\r\n  healedTrienodeBytes: \"0x0\",\r\n  healedTrienodes: \"0x0\",\r\n  healingBytecode: \"0x0\",\r\n  healingTrienodes: \"0x0\",\r\n  highestBlock: 12363123,\r\n  startingBlock: 0,\r\n  syncedAccountBytes: \"0x1245641c6\",\r\n  syncedAccounts: \"0x1b83e256\",\r\n  syncedBytecodeBytes: \"0x1b730e275\",\r\n  syncedBytecodes: \"0x143984\",\r\n  syncedStorage: \"0x702b11b\",\r\n  syncedStorageBytes: \"0x61b629c65\"\r\n}\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\nRunning docker containers beacon node and geth node\r\n```\r\nversion: '3.9'\r\nservices:\r\n  beacon-node:\r\n    image: gcr.io/prysmaticlabs/prysm/beacon-chain:v2.1.3-rc.3\r\n    hostname: beacon-node\r\n    restart: always\r\n    container_name: beacon-node\r\n    volumes:\r\n      - \"./data:/data\"\r\n      - \"./genesis.ssz:/genesis/genesis.ssz\"\r\n      - \"./eth-node/root/.ethereum/ropsten:/ropsten\"\r\n    command:\r\n      - --datadir=/data\r\n      - --rpc-host=0.0.0.0\r\n      - --monitoring-host=0.0.0.0\r\n      - --http-web3provider=http://eth-node:8550\r\n      - --genesis-state=/genesis/genesis.ssz\r\n      - --terminal-total-difficulty-override=50000000000000000\r\n      - --ropsten\r\n      - --accept-terms-of-use\r\n      - --jwt-secret=/ropsten/geth/jwtsecret\r\n    ports:\r\n      - 4000:4000\r\n      - 13000:13000 \r\n      - 12000:12000/udp\r\n\r\n  eth-node:\r\n    image: ethereum/client-go:v1.10.18\r\n    hostname: eth-node\r\n    restart: always\r\n    container_name: eth-node\r\n    ports:\r\n      - 30303:30303\r\n      - 30303:30303/udp\r\n      - 8550:8550\r\n      - 8546:8546\r\n      - 6060:6060\r\n    restart: always\r\n    volumes:\r\n      - \"./eth-node/root:/root\"\r\n    command:\r\n      - --ropsten\r\n      - --cache=1024\r\n      - --nousb\r\n      - --port=30303\r\n      - --http\r\n      - --http.api=admin,debug,miner,txpool,personal,eth,net,web3\r\n      - --http.port=8550\r\n      - --http.addr=0.0.0.0\r\n      - --http.vhosts=*\r\n      - --http.corsdomain=*\r\n      - --metrics\r\n      - --metrics.addr=0.0.0.0\r\n      - --metrics.port=6060\r\n      - --graphql\r\n      - --graphql.vhosts=*\r\n      - --ws\r\n      - --ws.addr=0.0.0.0\r\n      - --ws.port=8546\r\n      - --ws.api=admin,debug,miner,txpool,personal,eth,net,web3\r\n      - --ws.origins=*\r\n      - --rpc.allow-unprotected-txs\r\n      - --override.terminaltotaldifficulty=50000000000000000\r\n```\r\n\r\n\r\n#### Backtrace\r\n**beacon-node** constantly repeating logs:\r\n```\r\ntime=\"2022-06-17 11:39:06\" level=info msg=\"Processing block batch of size 63 starting from  0xaaab6212... 65592/127695 - estimated time remaining 22m24s\" blocksPerSecond=46.2 peers=31 prefix=initial-sync\r\ntime=\"2022-06-17 11:39:06\" level=warning msg=\"Batch is not processed\" error=\"beacon node doesn't have a parent in db with root: 0x3cf390dad7e844346f0d12911dbd5efd007696fe8331bcd793952c9095c2840b (in processBatchedBlocks, slot=65592)\" prefix=initial-sync\r\ntime=\"2022-06-17 11:39:06\" level=error msg=\"Could not connect to execution client endpoint: could not make initial request to verify execution chain ID: chain not synced beyond EIP-155 replay-protection fork block\" prefix=powchain\r\ntime=\"2022-06-17 11:39:12\" level=info msg=\"Processing block batch of size 51 starting from  0x43636c7b... 65144/127696 - estimated time remaining 22m33s\" blocksPerSecond=46.2 peers=31 prefix=initial-sync\r\ntime=\"2022-06-17 11:39:15\" level=warning msg=\"Batch is not processed\" error=\"could not process block in batch: method not found: received an undefined ee error\" prefix=initial-sync\r\ntime=\"2022-06-17 11:39:15\" level=info msg=\"Processing block batch of size 48 starting from  0xdf9ccf76... 65208/127696 - estimated time remaining 37m7s\" blocksPerSecond=28.1 peers=31 prefix=initial-sync\r\ntime=\"2022-06-17 11:39:15\" level=warning msg=\"Batch is not processed\" error=\"beacon node doesn't have a parent in db with root: 0x70daaf3efd184ee1c99b3af2eea39f1ee6f9b4a42a0f70fa9cc7c84181930f43 (in processBatchedBlocks, slot=65208)\" prefix=initial-sync\r\n```\r\n**geth-node**   constantly repeating logs:\r\n```\r\nINFO [06-17|08:44:04.223] Legacy sync reached merge threshold      number=12,308,106 hash=a6fbe9..bdbf28 td=43,532,321,247,089,466 ttd=43,531,756,765,713,534\r\nINFO [06-17|08:44:04.223] State sync in progress                   synced=50.84% state=35.94GiB  accounts=465,546,463@4.58GiB  slots=117,887,308@24.48GiB codes=1,328,948@6.88GiB  eta=18h41m57.108s\r\nWARN [06-17|08:44:04.223] Local chain is post-merge, waiting for beacon client sync switch-over... \r\nWARN [06-17|08:44:04.250] Unexpected account range packet          peer=e8833b70 reqid=8,514,626,685,972,389,954\r\nWARN [06-17|08:44:04.252] Unexpected account range packet          peer=139fa632 reqid=1,086,043,285,859,566,162\r\nWARN [06-17|08:44:04.253] Unexpected storage ranges packet         peer=139fa632 reqid=7,529,167,791,326,941,287\r\nWARN [06-17|08:44:04.253] Unexpected bytecode packet               peer=139fa632 reqid=646,791,935,132,217,832\r\nWARN [06-17|08:44:04.256] Unexpected account range packet          peer=2c13243c reqid=7,653,476,202,871,043,935\r\nWARN [06-17|08:44:04.263] Unexpected account range packet          peer=b0445182 reqid=4,755,942,332,859,140,285\r\nWARN [06-17|08:44:04.288] Unexpected account range packet          peer=95281c67 reqid=7,277,932,409,281,940,899\r\nWARN [06-17|08:44:04.325] Unexpected account range packet          peer=0729594e reqid=2,615,073,081,028,114,705\r\nWARN [06-17|08:44:04.327] Unexpected bytecode packet               peer=86842165 reqid=8,950,867,808,705,118,033\r\nWARN [06-17|08:44:04.419] Unexpected account range packet          peer=080fda6b reqid=2,070,293,642,309,205,639\r\nWARN [06-17|08:44:04.420] Unexpected storage ranges packet         peer=080fda6b reqid=838,929,813,382,532,662\r\nINFO [06-17|08:44:04.653] Disabling direct-ancient mode            origin=12,307,984 ancient=11,370,495\r\nINFO [06-17|08:44:04.790] Imported new block headers               count=0    elapsed=9.287ms     number=12,308,105 hash=52ffbb..ee8ee8 age=3w14h15m   ignored=121\r\n```\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25117/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25117/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1158688272",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25117#issuecomment-1158688272",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25117",
    "id": 1158688272,
    "node_id": "IC_kwDOAOvK985FEC4Q",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-17T09:29:42Z",
    "updated_at": "2022-06-17T09:29:42Z",
    "author_association": "MEMBER",
    "body": "Geth is just waiting for the beacon client to tell us what the head is. Your beacon client seems to be reporting it's stuck: `level=warning msg=\"Batch is not processed\" error=\"beacon node doesn't have a parent in db with root: 0x3cf390dad7e844346f0d12911dbd5efd007696fe8331bcd793952c9095c2840b (in processBatchedBlocks, slot=65592)\"` My guess is that your beacon node fails to sync for whatever reason?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1158688272/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1158697630",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25117#issuecomment-1158697630",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25117",
    "id": 1158697630,
    "node_id": "IC_kwDOAOvK985FEFKe",
    "user": {
      "login": "JeySee3",
      "id": 42541852,
      "node_id": "MDQ6VXNlcjQyNTQxODUy",
      "avatar_url": "https://avatars.githubusercontent.com/u/42541852?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JeySee3",
      "html_url": "https://github.com/JeySee3",
      "followers_url": "https://api.github.com/users/JeySee3/followers",
      "following_url": "https://api.github.com/users/JeySee3/following{/other_user}",
      "gists_url": "https://api.github.com/users/JeySee3/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JeySee3/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JeySee3/subscriptions",
      "organizations_url": "https://api.github.com/users/JeySee3/orgs",
      "repos_url": "https://api.github.com/users/JeySee3/repos",
      "events_url": "https://api.github.com/users/JeySee3/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JeySee3/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-17T09:40:48Z",
    "updated_at": "2022-06-17T09:40:48Z",
    "author_association": "NONE",
    "body": "Yes, it is, but we cannot understand why this is happening.\r\nPerhaps we somehow started the beacon node incorrectly? Or is there something else needed to make it work?\r\nCan you suggest something about this?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1158697630/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1160225423",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25117#issuecomment-1160225423",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25117",
    "id": 1160225423,
    "node_id": "IC_kwDOAOvK985FJ6KP",
    "user": {
      "login": "basvlanat",
      "id": 60644692,
      "node_id": "MDQ6VXNlcjYwNjQ0Njky",
      "avatar_url": "https://avatars.githubusercontent.com/u/60644692?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/basvlanat",
      "html_url": "https://github.com/basvlanat",
      "followers_url": "https://api.github.com/users/basvlanat/followers",
      "following_url": "https://api.github.com/users/basvlanat/following{/other_user}",
      "gists_url": "https://api.github.com/users/basvlanat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/basvlanat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/basvlanat/subscriptions",
      "organizations_url": "https://api.github.com/users/basvlanat/orgs",
      "repos_url": "https://api.github.com/users/basvlanat/repos",
      "events_url": "https://api.github.com/users/basvlanat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/basvlanat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-20T09:49:32Z",
    "updated_at": "2022-06-20T09:49:32Z",
    "author_association": "NONE",
    "body": "Hello.\r\nI'm seeing a similar problem myself.\r\nI created a [task](https://github.com/prysmaticlabs/prysm/issues/10877) in the prism repository, but unfortunately no one answered me. \r\n@karalabe Can you help me get around it somehow?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1160225423/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1263031524",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25117#issuecomment-1263031524",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25117",
    "id": 1263031524,
    "node_id": "IC_kwDOAOvK985LSFTk",
    "user": {
      "login": "brainstormk",
      "id": 109654392,
      "node_id": "U_kgDOBokxeA",
      "avatar_url": "https://avatars.githubusercontent.com/u/109654392?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/brainstormk",
      "html_url": "https://github.com/brainstormk",
      "followers_url": "https://api.github.com/users/brainstormk/followers",
      "following_url": "https://api.github.com/users/brainstormk/following{/other_user}",
      "gists_url": "https://api.github.com/users/brainstormk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/brainstormk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/brainstormk/subscriptions",
      "organizations_url": "https://api.github.com/users/brainstormk/orgs",
      "repos_url": "https://api.github.com/users/brainstormk/repos",
      "events_url": "https://api.github.com/users/brainstormk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/brainstormk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-30T02:30:04Z",
    "updated_at": "2022-09-30T02:30:04Z",
    "author_association": "NONE",
    "body": "I think that you can fix it with checkpoint switch when run beacon node by using prysm.\r\n```\r\n./prysm.sh beacon-chain --checkpoint-sync-url=http://localhost:3500 --genesis-beacon-api-url=http://localhost:3500\r\n```\r\nYou can find checkpoint url on https://eth-clients.github.io/checkpoint-sync-endpoints/",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1263031524/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
