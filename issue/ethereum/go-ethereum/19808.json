{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19808",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19808/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19808/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19808/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/19808",
  "id": 465502441,
  "node_id": "MDU6SXNzdWU0NjU1MDI0NDE=",
  "number": 19808,
  "title": "LESv2 SendTx2 Fails If Node is Syncing",
  "user": {
    "login": "EBGToo",
    "id": 673875,
    "node_id": "MDQ6VXNlcjY3Mzg3NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/673875?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/EBGToo",
    "html_url": "https://github.com/EBGToo",
    "followers_url": "https://api.github.com/users/EBGToo/followers",
    "following_url": "https://api.github.com/users/EBGToo/following{/other_user}",
    "gists_url": "https://api.github.com/users/EBGToo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/EBGToo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/EBGToo/subscriptions",
    "organizations_url": "https://api.github.com/users/EBGToo/orgs",
    "repos_url": "https://api.github.com/users/EBGToo/repos",
    "events_url": "https://api.github.com/users/EBGToo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/EBGToo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "rjl493456442",
    "id": 5959481,
    "node_id": "MDQ6VXNlcjU5NTk0ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rjl493456442",
    "html_url": "https://github.com/rjl493456442",
    "followers_url": "https://api.github.com/users/rjl493456442/followers",
    "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
    "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
    "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
    "repos_url": "https://api.github.com/users/rjl493456442/repos",
    "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    {
      "login": "zsfelfoldi",
      "id": 9884311,
      "node_id": "MDQ6VXNlcjk4ODQzMTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9884311?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zsfelfoldi",
      "html_url": "https://github.com/zsfelfoldi",
      "followers_url": "https://api.github.com/users/zsfelfoldi/followers",
      "following_url": "https://api.github.com/users/zsfelfoldi/following{/other_user}",
      "gists_url": "https://api.github.com/users/zsfelfoldi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zsfelfoldi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zsfelfoldi/subscriptions",
      "organizations_url": "https://api.github.com/users/zsfelfoldi/orgs",
      "repos_url": "https://api.github.com/users/zsfelfoldi/repos",
      "events_url": "https://api.github.com/users/zsfelfoldi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zsfelfoldi/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2019-07-08T23:31:23Z",
  "updated_at": "2020-08-27T08:59:28Z",
  "closed_at": "2020-06-25T08:53:33Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "If I submit a transaction to a node that is syncing, I'd expect that node to handle the submission (or if it can't to disconnect the peer, perhaps).  Instead I get what looks like a random error in the TxStatus result.\r\n\r\nI submitted this:\r\n```\r\nETH: LES: Send: [ LES,         SendTx2 ] \r\nETH: SEND: L  2: [\r\nETH: SEND:   I  1: 0x23\r\nETH: SEND:   L  2: [\r\nETH: SEND:     I  1: 0x1e\r\nETH: SEND:     L  1: [\r\nETH: SEND:       L  9: [\r\nETH: SEND:         I  1: 0x13\r\nETH: SEND:         I  4: 0x3b9aca00\r\nETH: SEND:         I  2: 0x5208\r\nETH: SEND:         I 20: 0x04d542459de6765682d21771d1ba23dc30fb675f\r\nETH: SEND:         I  6: 0x6d23ad5f8000\r\nETH: SEND:         I  0: 0x\r\nETH: SEND:         I  1: 0x26\r\nETH: SEND:         I 32: 0x3149...\r\nETH: SEND:         I 32: 0x424a...\r\nETH: SEND:       ]\r\nETH: SEND:     ]\r\nETH: SEND:   ]\r\nETH: SEND: ]\r\n```\r\n\r\nand I got this:\r\n```\r\nETH: RECV: L  3: [\r\nETH: RECV:   I  1: 0x1e\r\nETH: RECV:   I  4: 0x11e1a300\r\nETH: RECV:   L  1: [\r\nETH: RECV:     L  3: [\r\nETH: RECV:       I  0: 0x\r\nETH: RECV:       L  0: []\r\nETH: RECV:       I 23: 0x6578636565647320626c6f636b20676173206c696d6974\r\nETH: RECV:     ]\r\nETH: RECV:   ]\r\nETH: RECV: ]\r\nETH: LES: Recv: [ LES,        TxStatus ]\r\n```\r\n\r\nwhere the error string of `0x6578...` decodes to `\"exceeds block gas limit\"`.  Note the same transaction was submitted to multiple other nodes at the same time and the transaction succeeds (was eventually included in the blockchain).\r\n\r\nThe Ethereum node receiving this SendTx2 was version v1.8.23.",
  "closed_by": {
    "login": "zsfelfoldi",
    "id": 9884311,
    "node_id": "MDQ6VXNlcjk4ODQzMTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9884311?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zsfelfoldi",
    "html_url": "https://github.com/zsfelfoldi",
    "followers_url": "https://api.github.com/users/zsfelfoldi/followers",
    "following_url": "https://api.github.com/users/zsfelfoldi/following{/other_user}",
    "gists_url": "https://api.github.com/users/zsfelfoldi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zsfelfoldi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zsfelfoldi/subscriptions",
    "organizations_url": "https://api.github.com/users/zsfelfoldi/orgs",
    "repos_url": "https://api.github.com/users/zsfelfoldi/repos",
    "events_url": "https://api.github.com/users/zsfelfoldi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zsfelfoldi/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19808/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19808/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/509529850",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19808#issuecomment-509529850",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19808",
    "id": 509529850,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTUyOTg1MA==",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-09T07:44:10Z",
    "updated_at": "2019-07-09T07:44:10Z",
    "author_association": "MEMBER",
    "body": "In the latest branch, if the node is not synced it will reject all LES connections. Hopefully it can make more sense.\r\n\r\nRegarding the `exceeds block gas limit` error. Are you sending a transaction with large gas usage?  Since the transaction exceeds the current block limit gas.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/509529850/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/509679271",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19808#issuecomment-509679271",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19808",
    "id": 509679271,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTY3OTI3MQ==",
    "user": {
      "login": "EBGToo",
      "id": 673875,
      "node_id": "MDQ6VXNlcjY3Mzg3NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/673875?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/EBGToo",
      "html_url": "https://github.com/EBGToo",
      "followers_url": "https://api.github.com/users/EBGToo/followers",
      "following_url": "https://api.github.com/users/EBGToo/following{/other_user}",
      "gists_url": "https://api.github.com/users/EBGToo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/EBGToo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/EBGToo/subscriptions",
      "organizations_url": "https://api.github.com/users/EBGToo/orgs",
      "repos_url": "https://api.github.com/users/EBGToo/repos",
      "events_url": "https://api.github.com/users/EBGToo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/EBGToo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-09T15:01:31Z",
    "updated_at": "2019-07-09T15:01:31Z",
    "author_association": "NONE",
    "body": "It was not a large gas usage transaction; just an ETH transfer (\"0x5208\" -> 22,000).  The same transaction was submitted to other fully synced nodes and was eventually included (https://etherscan.io/tx/0xc18c61933d99c006615f650564ee054f88cd1d8845479a428defdf8acc3a2f92).\r\n\r\nIn the latest branch, will current LES connections be *dropped* if a sync starts?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/509679271/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/509901046",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19808#issuecomment-509901046",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19808",
    "id": 509901046,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwOTkwMTA0Ng==",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-10T04:19:29Z",
    "updated_at": "2019-07-10T04:19:29Z",
    "author_association": "MEMBER",
    "body": "I would say the LES connections will not be accepted before a node is synced.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/509901046/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/510074967",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19808#issuecomment-510074967",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19808",
    "id": 510074967,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMDA3NDk2Nw==",
    "user": {
      "login": "veox",
      "id": 3036030,
      "node_id": "MDQ6VXNlcjMwMzYwMzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3036030?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/veox",
      "html_url": "https://github.com/veox",
      "followers_url": "https://api.github.com/users/veox/followers",
      "following_url": "https://api.github.com/users/veox/following{/other_user}",
      "gists_url": "https://api.github.com/users/veox/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/veox/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/veox/subscriptions",
      "organizations_url": "https://api.github.com/users/veox/orgs",
      "repos_url": "https://api.github.com/users/veox/repos",
      "events_url": "https://api.github.com/users/veox/events{/privacy}",
      "received_events_url": "https://api.github.com/users/veox/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-10T14:03:50Z",
    "updated_at": "2019-07-10T14:03:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "I've experienced the `exceeds block gas limit` error on submitting to syncing nodes for a long time (quite sure that for v1.8.23 it has been the case), LES or not.\r\n\r\nI'd guess this has to do with the fact that, according to the remote server - especially if it's doing fast sync?.. - the block gas limit is very low: [5000 on Frontier](https://etherscan.io/block/1).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/510074967/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/510198924",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19808#issuecomment-510198924",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19808",
    "id": 510198924,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMDE5ODkyNA==",
    "user": {
      "login": "EBGToo",
      "id": 673875,
      "node_id": "MDQ6VXNlcjY3Mzg3NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/673875?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/EBGToo",
      "html_url": "https://github.com/EBGToo",
      "followers_url": "https://api.github.com/users/EBGToo/followers",
      "following_url": "https://api.github.com/users/EBGToo/following{/other_user}",
      "gists_url": "https://api.github.com/users/EBGToo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/EBGToo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/EBGToo/subscriptions",
      "organizations_url": "https://api.github.com/users/EBGToo/orgs",
      "repos_url": "https://api.github.com/users/EBGToo/repos",
      "events_url": "https://api.github.com/users/EBGToo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/EBGToo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-10T19:37:28Z",
    "updated_at": "2019-07-10T19:39:43Z",
    "author_association": "NONE",
    "body": "@rjl493456442 A conclusion being that since many/my Light Clients maintain an open connection to a LES node and since a LES node can start a sync at any time, the Light Client needs to handle a 'exceeds block gas limit' error by, probably, disconnecting and connecting to another LES node.  Reasonable?\r\n\r\nThat is, existing connections won't be dropped by a syncing LES node and on submit the LES node will not confirm/propagate the transaction?\r\n\r\nA syncing LES node won't be sending 'announce' message to the connected Light Clients, will respond to PING with PONG and will handle other LES/v2 messages (eg, GetBlocks) properly?\r\n\r\nNaively I'd suggest a LES node immediately boot all Light Clients (with a P2P Disconnect message) and flush any queued requests.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/510198924/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/649393535",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19808#issuecomment-649393535",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19808",
    "id": 649393535,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0OTM5MzUzNQ==",
    "user": {
      "login": "zsfelfoldi",
      "id": 9884311,
      "node_id": "MDQ6VXNlcjk4ODQzMTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9884311?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zsfelfoldi",
      "html_url": "https://github.com/zsfelfoldi",
      "followers_url": "https://api.github.com/users/zsfelfoldi/followers",
      "following_url": "https://api.github.com/users/zsfelfoldi/following{/other_user}",
      "gists_url": "https://api.github.com/users/zsfelfoldi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zsfelfoldi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zsfelfoldi/subscriptions",
      "organizations_url": "https://api.github.com/users/zsfelfoldi/orgs",
      "repos_url": "https://api.github.com/users/zsfelfoldi/repos",
      "events_url": "https://api.github.com/users/zsfelfoldi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zsfelfoldi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-25T08:53:33Z",
    "updated_at": "2020-06-25T08:53:33Z",
    "author_association": "MEMBER",
    "body": "As previously stated, now we try to avoid such misleading errors by not accepting LES connections on unsynced servers. In general if a tx send fails it might always be reasonable to retry with a few other server nodes because there is no way to exactly verify whether the failure happened because there is a problem with the tx or because there is a problem with the server.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/649393535/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
