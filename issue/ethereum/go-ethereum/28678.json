{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28678",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28678/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28678/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28678/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/28678",
  "id": 2041706269,
  "node_id": "I_kwDOAOvK9855sfcd",
  "number": 28678,
  "title": "Call by golang reverts unknown reason using hardhat-deploy in local env",
  "user": {
    "login": "Aliceonly",
    "id": 72842607,
    "node_id": "MDQ6VXNlcjcyODQyNjA3",
    "avatar_url": "https://avatars.githubusercontent.com/u/72842607?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Aliceonly",
    "html_url": "https://github.com/Aliceonly",
    "followers_url": "https://api.github.com/users/Aliceonly/followers",
    "following_url": "https://api.github.com/users/Aliceonly/following{/other_user}",
    "gists_url": "https://api.github.com/users/Aliceonly/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Aliceonly/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Aliceonly/subscriptions",
    "organizations_url": "https://api.github.com/users/Aliceonly/orgs",
    "repos_url": "https://api.github.com/users/Aliceonly/repos",
    "events_url": "https://api.github.com/users/Aliceonly/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Aliceonly/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2023-12-14T13:30:08Z",
  "updated_at": "2024-01-03T13:30:50Z",
  "closed_at": "2024-01-03T13:30:50Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nI'm using \"hardhat-deploy\": \"^0.11.44\" and \"@nomicfoundation/hardhat-toolbox-viem\": \"^2.0.0\" libs\r\nwhich are recommanded by hardhat official templates (with viem)\r\nit automatically run deploy scripts when I run command \"yarn hardhat node --hostname 0.0.0.0\"\r\nbut calls to local hardhat network in golang seems reverted with no reason\r\nIt leads to hard to debug in local env\r\nbut it can call in online chains\r\n\r\n#### Expected behaviour\r\nPlz advise me some paths to debug with golang in local env using viem and hardhat-deploy\r\nCheck hardhat-deploy to fully support for Viem which recommands by hardhat official\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nrunning 'yarn hardhat node --hostname 0.0.0.0' , it deploy contracts before local accounts shows up and didn't cost (may be the problem)\r\n\r\ngenerate go files with abis :\r\nsolc --abi contracts/${name} --include-path node_modules --base-path . -o goBuild/${fileName} --overwrite\r\nabigen --abi=goBuild/${fileName}/${fileName}.abi --pkg=${fileName} --out goBuild/${fileName}/${fileName}.go\r\n\r\nusing generated abi in go to call methods but reverted with no reason (func sig error)\r\nbut it can successfully call in online chain but failed in hardhat node\r\n\r\n#### Version\r\n\r\nhardhat-deploy\": \"^0.11.44\r\n@nomicfoundation/hardhat-toolbox-viem\r\n\"viem\": \"^1.19.11\"\r\n\"hardhat\": \"^2.19.1\"\r\ngo-ethereum\r\n",
  "closed_by": {
    "login": "s1na",
    "id": 1591639,
    "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/s1na",
    "html_url": "https://github.com/s1na",
    "followers_url": "https://api.github.com/users/s1na/followers",
    "following_url": "https://api.github.com/users/s1na/following{/other_user}",
    "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
    "organizations_url": "https://api.github.com/users/s1na/orgs",
    "repos_url": "https://api.github.com/users/s1na/repos",
    "events_url": "https://api.github.com/users/s1na/events{/privacy}",
    "received_events_url": "https://api.github.com/users/s1na/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28678/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28678/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1860206237",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28678#issuecomment-1860206237",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28678",
    "id": 1860206237,
    "node_id": "IC_kwDOAOvK985u4H6d",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-18T11:22:49Z",
    "updated_at": "2023-12-18T11:22:49Z",
    "author_association": "MEMBER",
    "body": "This is very hard to debug. Can you add your contracts? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1860206237/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1867433722",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28678#issuecomment-1867433722",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28678",
    "id": 1867433722,
    "node_id": "IC_kwDOAOvK985vTsb6",
    "user": {
      "login": "Aliceonly",
      "id": 72842607,
      "node_id": "MDQ6VXNlcjcyODQyNjA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/72842607?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Aliceonly",
      "html_url": "https://github.com/Aliceonly",
      "followers_url": "https://api.github.com/users/Aliceonly/followers",
      "following_url": "https://api.github.com/users/Aliceonly/following{/other_user}",
      "gists_url": "https://api.github.com/users/Aliceonly/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Aliceonly/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Aliceonly/subscriptions",
      "organizations_url": "https://api.github.com/users/Aliceonly/orgs",
      "repos_url": "https://api.github.com/users/Aliceonly/repos",
      "events_url": "https://api.github.com/users/Aliceonly/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Aliceonly/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-22T09:11:50Z",
    "updated_at": "2023-12-22T09:11:50Z",
    "author_association": "NONE",
    "body": "> This is very hard to debug. Can you add your contracts?\r\n\r\nThis has nothing to do with specific contracts. The problem is that contract repo using hardhat-deploy and viem causes go-ethereum call reverts in hardhat local node",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1867433722/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1867458869",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28678#issuecomment-1867458869",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28678",
    "id": 1867458869,
    "node_id": "IC_kwDOAOvK985vTyk1",
    "user": {
      "login": "Aliceonly",
      "id": 72842607,
      "node_id": "MDQ6VXNlcjcyODQyNjA3",
      "avatar_url": "https://avatars.githubusercontent.com/u/72842607?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Aliceonly",
      "html_url": "https://github.com/Aliceonly",
      "followers_url": "https://api.github.com/users/Aliceonly/followers",
      "following_url": "https://api.github.com/users/Aliceonly/following{/other_user}",
      "gists_url": "https://api.github.com/users/Aliceonly/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Aliceonly/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Aliceonly/subscriptions",
      "organizations_url": "https://api.github.com/users/Aliceonly/orgs",
      "repos_url": "https://api.github.com/users/Aliceonly/repos",
      "events_url": "https://api.github.com/users/Aliceonly/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Aliceonly/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-22T09:35:49Z",
    "updated_at": "2023-12-22T09:37:36Z",
    "author_association": "NONE",
    "body": "> This is very hard to debug. Can you add your contracts?\r\n\r\nI have created a sample hardhat project to debug, plz read README to start local hardhat node\r\nhttps://github.com/Aliceonly/go-hardhat-debug\r\n\r\nThis is a fatal issue to develop in Web3 project with golang\r\nExtremely grateful !!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1867458869/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1869512140",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28678#issuecomment-1869512140",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28678",
    "id": 1869512140,
    "node_id": "IC_kwDOAOvK985vbn3M",
    "user": {
      "login": "krzysztof-cywinski",
      "id": 2004078,
      "node_id": "MDQ6VXNlcjIwMDQwNzg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2004078?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/krzysztof-cywinski",
      "html_url": "https://github.com/krzysztof-cywinski",
      "followers_url": "https://api.github.com/users/krzysztof-cywinski/followers",
      "following_url": "https://api.github.com/users/krzysztof-cywinski/following{/other_user}",
      "gists_url": "https://api.github.com/users/krzysztof-cywinski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/krzysztof-cywinski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krzysztof-cywinski/subscriptions",
      "organizations_url": "https://api.github.com/users/krzysztof-cywinski/orgs",
      "repos_url": "https://api.github.com/users/krzysztof-cywinski/repos",
      "events_url": "https://api.github.com/users/krzysztof-cywinski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/krzysztof-cywinski/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-26T12:30:14Z",
    "updated_at": "2023-12-26T12:30:14Z",
    "author_association": "NONE",
    "body": "Hi @Aliceonly and @MariusVanDerWijden \r\nI've just run into the same issue.\r\n\r\nThere seems to be a problem with function selector incompatibility between the hardhat node and the go-ethereum contract bindings.\r\nRegular RPC calls to the hardhat node such as `eth_blockNumber` or `eth_chainId` work flawlessly and return correct values. It's only when you try to call a contract using the generated bindings when the issues start.\r\n\r\nI've tested it on several contracts with both http and ws connections with and without forking. The contracts work, because their functions are callable both with a regular RPC call and with tools such as Laika with a Metamask connected to the local node.\r\n\r\nInterestingly, there is no issue when using the bindings on public networks. For example, I can deploy a contract to a testnet and use it with the generated binding using a public RPC. The same binding fails when calling a local RPC using testnet forking with a local hardhat node. The call still works when the local hardhat fork is called through Metamask. It seems that the issue is somewhere between the go binding and the hardhat node, because both work well on their own.\r\n\r\nEasiest way to test would be to generate a binding for IERC20, fork Ethereum mainnet with hardhat using:\r\n`npx hardhat node --hostname 127.0.0.1 --fork https://ethereum.publicnode.com`\r\n\r\nWhen you use the generated binding to get WETH total supply with the public RPC it works:\r\n```\r\nclient, _ := ethclient.Dial(\"https://ethereum.publicnode.com\")\r\nweth, _ := contracts.NewIERC20(common.HexToAddress(\"0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2\"), client)\r\nsupply, err := weth.TotalSupply(nil)\r\nif err != nil {\r\n\tlog.Fatal(err)\r\n}\r\nlog.Println(\"WETH total supply: \", supply.String())\r\n```\r\nbut if you change the RPC to `http://127.0.0.1:8545` the total supply call fails with `abi: attempting to unmarshall an empty string while arguments are expected`\r\n\r\nmaking a direct `eth_call` to the hardhat fork works\r\n```\r\n{\r\n  \"jsonrpc\": \"2.0\",\r\n  \"method\": \"eth_call\",\r\n  \"params\": [\r\n    {\r\n      \"from\": \"0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2\",\r\n      \"to\": \"0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2\",\r\n      \"gas\": \"0x76c0\",\r\n      \"gasPrice\": \"0x9184e72a000\",\r\n      \"value\": \"0x0\",\r\n      \"data\": \"0x18160ddd\"\r\n    },\r\n    \"latest\"\r\n  ],\r\n  \"id\": 1\r\n}\r\n```\r\n\r\nAny idea what the issue could be and how to debug it?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1869512140/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1869719479",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28678#issuecomment-1869719479",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28678",
    "id": 1869719479,
    "node_id": "IC_kwDOAOvK985vcae3",
    "user": {
      "login": "krzysztof-cywinski",
      "id": 2004078,
      "node_id": "MDQ6VXNlcjIwMDQwNzg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2004078?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/krzysztof-cywinski",
      "html_url": "https://github.com/krzysztof-cywinski",
      "followers_url": "https://api.github.com/users/krzysztof-cywinski/followers",
      "following_url": "https://api.github.com/users/krzysztof-cywinski/following{/other_user}",
      "gists_url": "https://api.github.com/users/krzysztof-cywinski/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/krzysztof-cywinski/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krzysztof-cywinski/subscriptions",
      "organizations_url": "https://api.github.com/users/krzysztof-cywinski/orgs",
      "repos_url": "https://api.github.com/users/krzysztof-cywinski/repos",
      "events_url": "https://api.github.com/users/krzysztof-cywinski/events{/privacy}",
      "received_events_url": "https://api.github.com/users/krzysztof-cywinski/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-26T18:58:28Z",
    "updated_at": "2023-12-26T20:58:32Z",
    "author_association": "NONE",
    "body": "I think I managed to finally get to the bottom of this issue.\r\nWhen go-ethereum creates the request it uses an `input` param instead of a `data` param.\r\nMost RPCs seem to accept either, but the hardhat node only seems to accept `data`.\r\nThe spec available [here](https://ethereum.github.io/execution-apis/api-documentation/) specifies an `input` param so I guess this is more of a hardhat issue than a go-ethereum issue.\r\n\r\n@Aliceonly a hacky fix is to change line 650 in `~/go/pkg/mod/github.com/ethereum/go-ethereum@v1.13.5/ethclient/ethclient.go` from `arg[\"input\"] = hexutil.Bytes(msg.Data)` to `arg[\"data\"] = hexutil.Bytes(msg.Data)`\r\n\r\nOpened a PR in the hardhat repo here: https://github.com/NomicFoundation/hardhat/pull/4718",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1869719479/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1875375966",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28678#issuecomment-1875375966",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28678",
    "id": 1875375966,
    "node_id": "IC_kwDOAOvK985vx_de",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-03T13:30:50Z",
    "updated_at": "2024-01-03T13:30:50Z",
    "author_association": "MEMBER",
    "body": "Thanks for looking into this @krzysztof-cywinski. Indeed we stopped accepting `data` param recently. This field was deprecated a looong time ago. Sorry for the inconvenience but it was time to stop this dual-use. I will close the issue here.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1875375966/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
