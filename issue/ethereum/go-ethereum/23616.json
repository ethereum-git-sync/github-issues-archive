{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23616",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23616/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23616/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23616/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23616",
  "id": 1002589946,
  "node_id": "I_kwDOAOvK9847wk76",
  "number": 23616,
  "title": "EIP1559 mempool TX replacement condition ",
  "user": {
    "login": "pdyraga",
    "id": 4712360,
    "node_id": "MDQ6VXNlcjQ3MTIzNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4712360?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pdyraga",
    "html_url": "https://github.com/pdyraga",
    "followers_url": "https://api.github.com/users/pdyraga/followers",
    "following_url": "https://api.github.com/users/pdyraga/following{/other_user}",
    "gists_url": "https://api.github.com/users/pdyraga/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pdyraga/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pdyraga/subscriptions",
    "organizations_url": "https://api.github.com/users/pdyraga/orgs",
    "repos_url": "https://api.github.com/users/pdyraga/repos",
    "events_url": "https://api.github.com/users/pdyraga/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pdyraga/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 268304226,
      "node_id": "MDU6TGFiZWwyNjgzMDQyMjY=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:docs",
      "name": "type:docs",
      "color": "fef2c0",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-09-21T14:23:05Z",
  "updated_at": "2021-11-03T13:03:22Z",
  "closed_at": "2021-11-03T13:03:22Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "While working on adjusting the code increasing the gas price for transactions after EIP 1559 changes, we noticed that the transaction pool rejects to replace transactions if both `opts.GasTipCap` and `opts.GasFeeCap` are not higher than the previous values or if at least one of them is not higher than the previous value by at least 10%.\r\n\r\nLet's say that my original transaction had `opts.GasTipCap = 10`, `head.BaseFee` was `20` so according to [this](https://github.com/ethereum/go-ethereum/blob/e28f713ada67af2380bd7052cb85b2e255a62a6a/accounts/abi/bind/base.go#L270-L273) formula`opts.GasFeeCap = 2 * 20 + 10 = 50`. Let's say no miner picked the transaction because other transactions had higher `opts.GasTipCap`, thus `opts.GasFeeCap` as well. \r\n\r\nAfter a few hours, I decide to increase the tip for miners and I see that `head.BaseFee` dropped to `5` but all other transactions in the pool have a pretty large `opts.GasTipCap` what makes my transaction still waiting. I decide to increase `opts.GasTipCap` to `30` and recalculate `opts.GasFeeCap = 2 * 5 + 30 = 45`. \r\n\r\nNow, we have a situation when miners can earn more for processing my transaction than before (10 vs 30) but the mempool rejects the replacement.\r\n\r\nIsn't it a bug in the mempool implementation? We found [this](https://github.com/ethereum/go-ethereum/pull/22898/files#r636583352) comment in the original PR but there is no reasoning described why the current replacement condition is the best choice.\r\n\r\n",
  "closed_by": {
    "login": "MariusVanDerWijden",
    "id": 16664698,
    "node_id": "MDQ6VXNlcjE2NjY0Njk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MariusVanDerWijden",
    "html_url": "https://github.com/MariusVanDerWijden",
    "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
    "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
    "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
    "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
    "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
    "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23616/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23616/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/924657965",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23616#issuecomment-924657965",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23616",
    "id": 924657965,
    "node_id": "IC_kwDOAOvK9843HSkt",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-22T07:23:17Z",
    "updated_at": "2021-09-22T07:23:17Z",
    "author_association": "MEMBER",
    "body": "Transactions require a total ordering. I.e. there must be some sorting which can unambiguously compare two transactions. This is needed to avoid SPAM attacks on the pool where some transactions push out one set, then another transaction pushes out the original pushers. That would allow an amplification attack where transactions are constantly being pushed out, rotating in a loop.\r\n\r\nRequiring both tip and fee to be bumped by 10% is one such way that's easy to reason about. In general, the current pool construction tries to enforce that \"promised\" fees are never allowed to go down. That means each replacement tx (which ripples through the network) is more and more costly to the sender, so it's not worth it to keep pushing txs in.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/924657965/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/959018953",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23616#issuecomment-959018953",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23616",
    "id": 959018953,
    "node_id": "IC_kwDOAOvK9845KXfJ",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-03T13:03:22Z",
    "updated_at": "2021-11-03T13:03:22Z",
    "author_association": "MEMBER",
    "body": "fixed the comment here: https://github.com/ethereum/go-ethereum/pull/23825",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/959018953/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
