{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23355",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23355/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23355/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23355/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23355",
  "id": 963517341,
  "node_id": "MDU6SXNzdWU5NjM1MTczNDE=",
  "number": 23355,
  "title": "blocking issue found at test ",
  "user": {
    "login": "charlesxsh",
    "id": 8362565,
    "node_id": "MDQ6VXNlcjgzNjI1NjU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8362565?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/charlesxsh",
    "html_url": "https://github.com/charlesxsh",
    "followers_url": "https://api.github.com/users/charlesxsh/followers",
    "following_url": "https://api.github.com/users/charlesxsh/following{/other_user}",
    "gists_url": "https://api.github.com/users/charlesxsh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/charlesxsh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/charlesxsh/subscriptions",
    "organizations_url": "https://api.github.com/users/charlesxsh/orgs",
    "repos_url": "https://api.github.com/users/charlesxsh/repos",
    "events_url": "https://api.github.com/users/charlesxsh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/charlesxsh/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-08-08T21:21:28Z",
  "updated_at": "2021-08-26T10:14:11Z",
  "closed_at": "2021-08-26T08:30:11Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `geth version`\r\nOS & Version: Windows/Linux/OSX\r\nCommit hash : (if `develop`)\r\n\r\n#### Expected behaviour\r\nall goroutine/channels properly exit/close\r\n\r\n#### Actual behaviour\r\nTest `TestLifecycleStartupError` in file `node/node_test.go`\r\n\r\nhttps://github.com/rjeczalik/notify/blob/0f065fa99b48b842c3fd3e2c8b194c6f2b69f6b8/watcher_inotify.go#L254\r\n```go\r\nfunc (i *inotify) send(esch <-chan []*event) {\r\n\tfor es := range esch {  <------ line 254\r\n\t\tfor _, e := range i.transform(es) {\r\n\t\t\tif e != nil {\r\n\t\t\t\ti.c <- e\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\ti.wg.Done()\r\n}\r\n```\r\nThe channel `esch` does not been closed during test `TestLifecycleStartupError`, so one of goroutine blocked at line 254 mentioned above.\r\n\r\n\r\nThe only usage of notify is in accounts/keystore/watch.go. Since test `TestLifecycleStartupError` does not explicitly create related resource\r\n#### Steps to reproduce the behaviour\r\n\r\n\r\n#### Backtrace\r\n\r\n````\r\n[backtrace]\r\n````\r\n\r\nWhen submitting logs: please submit them as text and not screenshots.",
  "closed_by": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23355/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23355/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/899262575",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23355#issuecomment-899262575",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23355",
    "id": 899262575,
    "node_id": "IC_kwDOAOvK9841mahv",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-16T06:40:50Z",
    "updated_at": "2021-08-16T06:40:50Z",
    "author_association": "MEMBER",
    "body": "Weird, the test shouldn't create any KexStores (which starts the notify service) during tests, as the `ExternalSigners`are set to 0 during tests, will investigate more",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/899262575/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/899271033",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23355#issuecomment-899271033",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23355",
    "id": 899271033,
    "node_id": "IC_kwDOAOvK9841mcl5",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-16T07:00:25Z",
    "updated_at": "2021-08-16T07:00:25Z",
    "author_association": "MEMBER",
    "body": "Ahh nvm, we create a new `KeyStore` in `node/config.go` l490. The problem is that we don't close this keystore (which would release the resources) in the account manager `accounts/manager.go` l127 but rely on the garbage collector to destroy KeyStore\r\nThe test only behaves non-deterministically as it relies on the KeyStore to be Finalized in order to remove the AccountCache which has the reference to notify. \r\nSince the test only fails every so often (I couldn't repro it a single time) I would just vote to ignore it for now",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/899271033/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/906204856",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23355#issuecomment-906204856",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23355",
    "id": 906204856,
    "node_id": "IC_kwDOAOvK9842A5a4",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-26T08:30:11Z",
    "updated_at": "2021-08-26T08:30:11Z",
    "author_association": "MEMBER",
    "body": "Since #23019 is now merged, this issue should be a lot less of a problem. node.Node no longer creates a KeyStore by default. The underlying issue is still present, but fixing this is complicated and would required a lot of refactoring changes.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/906204856/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
