{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18954",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18954/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18954/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18954/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/18954",
  "id": 403775976,
  "node_id": "MDU6SXNzdWU0MDM3NzU5NzY=",
  "number": 18954,
  "title": "Memory leak due to big.Int(rlp encode/decode)",
  "user": {
    "login": "bishaoqing",
    "id": 11451492,
    "node_id": "MDQ6VXNlcjExNDUxNDky",
    "avatar_url": "https://avatars.githubusercontent.com/u/11451492?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bishaoqing",
    "html_url": "https://github.com/bishaoqing",
    "followers_url": "https://api.github.com/users/bishaoqing/followers",
    "following_url": "https://api.github.com/users/bishaoqing/following{/other_user}",
    "gists_url": "https://api.github.com/users/bishaoqing/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bishaoqing/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bishaoqing/subscriptions",
    "organizations_url": "https://api.github.com/users/bishaoqing/orgs",
    "repos_url": "https://api.github.com/users/bishaoqing/repos",
    "events_url": "https://api.github.com/users/bishaoqing/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bishaoqing/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2019-01-28T11:49:08Z",
  "updated_at": "2019-05-03T12:47:38Z",
  "closed_at": "2019-05-03T12:47:38Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Geth version: 1.8.9\r\nOS & Version: Windows + Linux\r\n\r\nHello, I build a private block-chain in my AWS server,and change some codes to enable a large number of txs, but i find that memory kept growing, it was 30 MB at the beginning, but after 30 mins, it grown to 15 GB, and then crushed.\r\n\r\nHere is my flame graph of the heap(Because of the word limit,i save the flame graph in pastebin)\r\n[https://pastebin.com/UjmWZ8K1](url)\r\n\r\n1st, paste the url into the browser\r\n2nd, save all the codes as an SVG file\r\n3rd, open the SVG file in any browser\r\n\r\nAnd then, you will see the flame graph about the mem leak i met",
  "closed_by": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18954/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18954/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/458139178",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18954#issuecomment-458139178",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18954",
    "id": 458139178,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1ODEzOTE3OA==",
    "user": {
      "login": "hadv",
      "id": 941411,
      "node_id": "MDQ6VXNlcjk0MTQxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/941411?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hadv",
      "html_url": "https://github.com/hadv",
      "followers_url": "https://api.github.com/users/hadv/followers",
      "following_url": "https://api.github.com/users/hadv/following{/other_user}",
      "gists_url": "https://api.github.com/users/hadv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hadv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hadv/subscriptions",
      "organizations_url": "https://api.github.com/users/hadv/orgs",
      "repos_url": "https://api.github.com/users/hadv/repos",
      "events_url": "https://api.github.com/users/hadv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hadv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-28T13:50:17Z",
    "updated_at": "2019-01-28T16:16:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yeah, I have the same problem on private chain with 10 thousand tnx https://github.com/ethereum/go-ethereum/issues/17450#issuecomment-457987428",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/458139178/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/458397008",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18954#issuecomment-458397008",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18954",
    "id": 458397008,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1ODM5NzAwOA==",
    "user": {
      "login": "bishaoqing",
      "id": 11451492,
      "node_id": "MDQ6VXNlcjExNDUxNDky",
      "avatar_url": "https://avatars.githubusercontent.com/u/11451492?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bishaoqing",
      "html_url": "https://github.com/bishaoqing",
      "followers_url": "https://api.github.com/users/bishaoqing/followers",
      "following_url": "https://api.github.com/users/bishaoqing/following{/other_user}",
      "gists_url": "https://api.github.com/users/bishaoqing/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bishaoqing/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bishaoqing/subscriptions",
      "organizations_url": "https://api.github.com/users/bishaoqing/orgs",
      "repos_url": "https://api.github.com/users/bishaoqing/repos",
      "events_url": "https://api.github.com/users/bishaoqing/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bishaoqing/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-29T03:47:21Z",
    "updated_at": "2019-01-29T03:54:21Z",
    "author_association": "NONE",
    "body": "@hadv i found it could be caused by the 'blockCache'(blockchain.go), it seems something hold the references of the big.Int objects (or say txs) and causes the memory assigned to them cann't be freed,and i guess it's because of block caching,and then i change the code below:\r\n\r\n### \"core/blockchain.go\"\r\n`const (\r\n\tbodyCacheLimit      = 256\r\n\tblockCacheLimit     = 256\r\n\treceiptsCacheLimit  = 32\r\n\tmaxFutureBlocks     = 256\r\n\tmaxTimeFutureBlocks = 30\r\n\tbadBlockLimit       = 10\r\n\ttriesInMemory       = 128\r\n\r\n\t// BlockChainVersion ensures that an incompatible database forces a resync from scratch.\r\n\tBlockChainVersion = 3\r\n)`\r\n\r\nto\r\n\r\n### \"core/blockchain.go\"\r\n`const (\r\n\tbodyCacheLimit      = 1\r\n\tblockCacheLimit     = 1\r\n\treceiptsCacheLimit  = 1\r\n\tmaxFutureBlocks     = 1\r\n\tmaxTimeFutureBlocks = 1\r\n\tbadBlockLimit       = 1\r\n\ttriesInMemory       = 1\r\n\r\n\t// BlockChainVersion ensures that an incompatible database forces a resync from scratch.\r\n\tBlockChainVersion = 3\r\n)`\r\n\r\nAnd then i run geth again, after about 1 hour,memory up to  4GB and don't increase any more(or say it increases slowly).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/458397008/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/458398336",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18954#issuecomment-458398336",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18954",
    "id": 458398336,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1ODM5ODMzNg==",
    "user": {
      "login": "hadv",
      "id": 941411,
      "node_id": "MDQ6VXNlcjk0MTQxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/941411?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hadv",
      "html_url": "https://github.com/hadv",
      "followers_url": "https://api.github.com/users/hadv/followers",
      "following_url": "https://api.github.com/users/hadv/following{/other_user}",
      "gists_url": "https://api.github.com/users/hadv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hadv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hadv/subscriptions",
      "organizations_url": "https://api.github.com/users/hadv/orgs",
      "repos_url": "https://api.github.com/users/hadv/repos",
      "events_url": "https://api.github.com/users/hadv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hadv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-01-29T03:55:17Z",
    "updated_at": "2019-01-29T03:55:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "yeah, if we reduce cache then i might be better. But it seems that there's goroutine leak on feed.Send() event\r\n\r\nhttps://github.com/ethereum/go-ethereum/issues/17450#issuecomment-458388801",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/458398336/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/489083468",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18954#issuecomment-489083468",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18954",
    "id": 489083468,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4OTA4MzQ2OA==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-03T12:47:38Z",
    "updated_at": "2019-05-03T12:47:38Z",
    "author_association": "MEMBER",
    "body": "Closing this because it's not related to RLP decoding. It's just the memory profile showing that big.Ints were allocated during decoding.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/489083468/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
