{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20383",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20383/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20383/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20383/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/20383",
  "id": 527935282,
  "node_id": "MDU6SXNzdWU1Mjc5MzUyODI=",
  "number": 20383,
  "title": "geth does not persist trie node data from memory to disk on ungraceful system restart",
  "user": {
    "login": "ryzhak",
    "id": 6339689,
    "node_id": "MDQ6VXNlcjYzMzk2ODk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6339689?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ryzhak",
    "html_url": "https://github.com/ryzhak",
    "followers_url": "https://api.github.com/users/ryzhak/followers",
    "following_url": "https://api.github.com/users/ryzhak/following{/other_user}",
    "gists_url": "https://api.github.com/users/ryzhak/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ryzhak/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ryzhak/subscriptions",
    "organizations_url": "https://api.github.com/users/ryzhak/orgs",
    "repos_url": "https://api.github.com/users/ryzhak/repos",
    "events_url": "https://api.github.com/users/ryzhak/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ryzhak/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 8,
  "created_at": "2019-11-25T08:46:44Z",
  "updated_at": "2022-06-16T11:39:33Z",
  "closed_at": "2019-11-25T16:49:42Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hello everybody!\r\n\r\nIssue: geth 1.8.22 starts mining from one of the first blocks instead of the last one on system reboot.\r\n\r\n**System information**\r\n\r\nGeth version: `1.8.22-stable-7fa3509e`\r\nOS & Version: Linux Mint 19\r\n\r\n**What we have**\r\n\r\nWe have 3 synced private geth nodes using PoA(clique).\r\n\r\n**What happened**\r\n\r\nOne day(a week ago) we had issues with our hosting provider so we had to restart 2 out of 3 nodes(each node is on separate VPS). Current block is 4 000 000. When node 1 and node 2 were restarted they started mining from block 372 instead of the last one 4 000 000.\r\n\r\n**Why it happened (my guess)**\r\n\r\nGeth 1.8.22 keeps some data with trie node data in RAM instead of a disk. On graceful node shutdown(for example from console) this trie node data is saved to hard drive from RAM. On forced system shutdown(for example from hosting admin panel) trie node data does not have time to be saved on a hard drive. We had our nodes running for 6 months without any reboot so I think that this trie node data was kept in RAM for the whole time and it was vanished on system reboot(though we still have node 3 which is up and running).\r\n\r\n**Logs**\r\n\r\nHere are the logs when I'm trying to run the backup version of one of the nodes:\r\n```\r\nvladimir@comp:~/Public/projects/ethereum/repro-geth-bug/geth-linux-amd64-1.8.22-7fa3509e$ ./geth --datadir ../opt/ethereum/data/ --networkid 1515 --unlock 0xd6ee38421e1713dd50e888c6d689b82953946bc3 --password ../opt/ethereum/unlock_password --port 30306 --mine\r\nINFO [11-21|17:06:25.374] Maximum peer count                       ETH=25 LES=0 total=25\r\nINFO [11-21|17:06:25.374] Starting peer-to-peer node               instance=Geth/v1.8.22-stable-7fa3509e/linux-amd64/go1.11.5\r\nINFO [11-21|17:06:25.374] Allocated cache and file handles         database=/home/vladimir/Public/projects/ethereum/repro-geth-bug/opt/ethereum/data/geth/chaindata cache=512 handles=2048\r\nINFO [11-21|17:06:26.550] Initialised chain configuration          config=\"{ChainID: 1515 Homestead: 1 DAO: <nil> DAOSupport: false EIP150: 2 EIP155: 3 EIP158: 3 Byzantium: 4 Constantinople: 5  ConstantinopleFix: <nil> Engine: clique}\"\r\nINFO [11-21|17:06:26.550] Initialising Ethereum protocol           versions=\"[63 62]\" network=1515\r\nWARN [11-21|17:06:26.579] Head state missing, repairing chain      number=4073749 hash=9bfb53â€¦56d503\r\nINFO [11-21|17:07:45.179] Rewound blockchain to past state         number=371     hash=102018â€¦d91947\r\nINFO [11-21|17:07:45.180] Loaded most recent local header          number=4073749 hash=9bfb53â€¦56d503 td=8147499 age=2d5h43m\r\nINFO [11-21|17:07:45.180] Loaded most recent local full block      number=371     hash=102018â€¦d91947 td=743     age=7mo3w6d\r\nINFO [11-21|17:07:45.180] Loaded most recent local fast block      number=4073749 hash=9bfb53â€¦56d503 td=8147499 age=2d5h43m\r\nINFO [11-21|17:07:45.180] Loaded local transaction journal         transactions=3 dropped=3\r\nINFO [11-21|17:07:45.180] Regenerated local transaction journal    transactions=0 accounts=0\r\nWARN [11-21|17:07:45.180] Blockchain not empty, fast sync disabled \r\nINFO [11-21|17:07:45.623] New local node record                    seq=6 id=e8c5a9e8848d4e30 ip=127.0.0.1 udp=30306 tcp=30306\r\nINFO [11-21|17:07:45.623] Started P2P networking                   self=enode://9647000ba2579dd529574b49f472f029839a09257c1bc3ade5135cbbb5f3ceaf1237aff5b6b947d2fa4f218fa24858dc2767bd4b78e082b04c9d013c1482cfa6@127.0.0.1:30306\r\nINFO [11-21|17:07:45.624] IPC endpoint opened                      url=/home/vladimir/Public/projects/ethereum/repro-geth-bug/opt/ethereum/data/geth.ipc\r\nINFO [11-21|17:07:46.192] Unlocked account                         address=0xd6ee38421e1713dD50E888c6D689B82953946bC3\r\nINFO [11-21|17:07:46.192] Transaction pool price threshold updated price=1000000000\r\nINFO [11-21|17:07:46.192] Transaction pool price threshold updated price=1000000000\r\nINFO [11-21|17:07:46.192] Etherbase automatically configured       address=0xd6ee38421e1713dD50E888c6D689B82953946bC3\r\nINFO [11-21|17:07:46.192] Commit new mining work                   number=372     sealhash=685e15â€¦2c52df uncles=0 txs=0 gas=0 fees=0 elapsed=75.951Âµs\r\nINFO [11-21|17:07:46.192] Successfully sealed new block            number=372     sealhash=685e15â€¦2c52df hash=0c60efâ€¦f29e6b elapsed=385.27Âµs\r\nINFO [11-21|17:07:46.192] ðŸ”¨ mined potential block                  number=372     hash=0c60efâ€¦f29e6b\r\nINFO [11-21|17:07:46.193] Commit new mining work                   number=373     sealhash=337ae5â€¦2b4704 uncles=0 txs=0 gas=0 fees=0 elapsed=222.362Âµs\r\nINFO [11-21|17:07:47.962] Mapped network port                      proto=tcp extport=30306 intport=30306 interface=\"UPNP IGDv1-IP1\"\r\nINFO [11-21|17:07:48.391] Mapped network port                      proto=udp extport=30306 intport=30306 interface=\"UPNP IGDv1-IP1\"\r\nINFO [11-21|17:07:49.625] New local node record                    seq=7 id=e8c5a9e8848d4e30 ip=128.71.103.50 udp=30306 tcp=30306\r\nINFO [11-21|17:07:51.001] Successfully sealed new block            number=373     sealhash=337ae5â€¦2b4704 hash=b67668â€¦81f164 elapsed=4.807s\r\nINFO [11-21|17:07:51.001] ðŸ”¨ mined potential block                  number=373     hash=b67668â€¦81f164\r\nINFO [11-21|17:07:51.002] Commit new mining work                   number=374     sealhash=c0e9f6â€¦628d51 uncles=0 txs=0 gas=0 fees=0 elapsed=1.434ms\r\nINFO [11-21|17:07:56.001] Successfully sealed new block            number=374     sealhash=c0e9f6â€¦628d51 hash=77aae2â€¦9c44e8 elapsed=4.998s\r\nINFO [11-21|17:07:56.001] ðŸ”¨ mined potential block                  number=374     hash=77aae2â€¦9c44e8\r\nINFO [11-21|17:07:56.003] Commit new mining work                   number=375     sealhash=6f7db7â€¦adca12 uncles=0 txs=0 gas=0 fees=0 elapsed=1.305ms\r\n^CINFO [11-21|17:07:58.483] Got interrupt, shutting down... \r\nINFO [11-21|17:07:58.483] IPC endpoint closed                      url=/home/vladimir/Public/projects/ethereum/repro-geth-bug/opt/ethereum/data/geth.ipc\r\nINFO [11-21|17:07:58.483] Writing cached state to disk             block=374 hash=77aae2â€¦9c44e8 root=e16e04â€¦e93be1\r\nINFO [11-21|17:07:58.483] Persisted trie from memory database      nodes=0 size=0.00B time=7.185Âµs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B\r\nINFO [11-21|17:07:58.483] Writing cached state to disk             block=373 hash=b67668â€¦81f164 root=e16e04â€¦e93be1\r\nINFO [11-21|17:07:58.483] Persisted trie from memory database      nodes=0 size=0.00B time=2.571Âµs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B\r\nINFO [11-21|17:07:58.484] Writing cached state to disk             block=247 hash=7b422aâ€¦5f9a62 root=e16e04â€¦e93be1\r\nINFO [11-21|17:07:58.484] Persisted trie from memory database      nodes=0 size=0.00B time=2.784Âµs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B\r\nINFO [11-21|17:07:58.484] Blockchain manager stopped \r\nINFO [11-21|17:07:58.484] Stopping Ethereum protocol \r\nINFO [11-21|17:07:58.484] Ethereum protocol stopped \r\nINFO [11-21|17:07:58.484] Transaction pool stopped \r\nINFO [11-21|17:07:58.497] Database closed                          database=/home/vladimir/Public/projects/ethereum/repro-geth-bug/opt/ethereum/data/geth/chaindata\r\n```\r\n\r\n**How to fix**\r\n\r\nThe 1st thing that comes to mind is to restart geth nodes(gracefully) via cron everyday so that nodes persist trie node data on the disk.\r\n\r\n**So question is**: how to handle **UN**graceful system shutdown so that geth node persists data and keeps mining from the latest block on restart? Probably I miss something or have wrong understanding of how geth works.\r\n\r\nHope you got what I mean, thanks in advance",
  "closed_by": {
    "login": "ryzhak",
    "id": 6339689,
    "node_id": "MDQ6VXNlcjYzMzk2ODk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6339689?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ryzhak",
    "html_url": "https://github.com/ryzhak",
    "followers_url": "https://api.github.com/users/ryzhak/followers",
    "following_url": "https://api.github.com/users/ryzhak/following{/other_user}",
    "gists_url": "https://api.github.com/users/ryzhak/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ryzhak/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ryzhak/subscriptions",
    "organizations_url": "https://api.github.com/users/ryzhak/orgs",
    "repos_url": "https://api.github.com/users/ryzhak/repos",
    "events_url": "https://api.github.com/users/ryzhak/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ryzhak/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20383/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20383/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/558107815",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20383#issuecomment-558107815",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20383",
    "id": 558107815,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1ODEwNzgxNQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-25T11:10:55Z",
    "updated_at": "2019-11-25T11:10:55Z",
    "author_association": "MEMBER",
    "body": "Geth persists data after 1 hour worth of block processing (so for example if your blocks are processed in 100ms, that's 10/s * 60s * 60m = after 36000 blocks). If your network is super light (i.e. mostly empty blocks), it may happen that it takes a very very long time until blocks are flushed.\r\n\r\nAn ungraceful shutdown should still eventually sync up with the network when connections are made to old nodes that are still healthy, so it should eventually self heal itself.\r\n\r\nCurrently there is no way to configure the period for these persistency rounds because every piece of data pushed to disk cannot be garbage collected any more, so the more frequent, the more junk. You can hack around the issue currently with your workaround of restarting Geth periodically.\r\n\r\nWe have an alternative idea in the works that would persist the in-memory state not to the database, rather to a flat file. That will allow users to configure wall-clock timeouts for the backups without adding junk to their databases. Not sure when that will ship however, it's not a high priority feature.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/558107815/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/558242050",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20383#issuecomment-558242050",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20383",
    "id": 558242050,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1ODI0MjA1MA==",
    "user": {
      "login": "ryzhak",
      "id": 6339689,
      "node_id": "MDQ6VXNlcjYzMzk2ODk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6339689?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryzhak",
      "html_url": "https://github.com/ryzhak",
      "followers_url": "https://api.github.com/users/ryzhak/followers",
      "following_url": "https://api.github.com/users/ryzhak/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryzhak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryzhak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryzhak/subscriptions",
      "organizations_url": "https://api.github.com/users/ryzhak/orgs",
      "repos_url": "https://api.github.com/users/ryzhak/repos",
      "events_url": "https://api.github.com/users/ryzhak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryzhak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-25T16:49:42Z",
    "updated_at": "2019-11-25T16:49:42Z",
    "author_association": "NONE",
    "body": "> If your network is super light (i.e. mostly empty blocks), it may happen that it takes a very very long time until blocks are flushed.\r\n\r\nyes, we have a super light network\r\n\r\n> An ungraceful shutdown should still eventually sync up with the network when connections are made to old nodes that are still healthy, so it should eventually self heal itself.\r\n\r\nyes, but if we had restarted all our nodes at the same time then data would have been lost(or at least we would have to think how to restore it, wonder if it is possible)\r\n\r\n> You can hack around the issue currently with your workaround of restarting Geth periodically.\r\n\r\nyes, it seems the only option\r\n\r\n@karalabe thank you for clarification!\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/558242050/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/813959721",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20383#issuecomment-813959721",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20383",
    "id": 813959721,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxMzk1OTcyMQ==",
    "user": {
      "login": "balajipachai",
      "id": 32358081,
      "node_id": "MDQ6VXNlcjMyMzU4MDgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/32358081?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/balajipachai",
      "html_url": "https://github.com/balajipachai",
      "followers_url": "https://api.github.com/users/balajipachai/followers",
      "following_url": "https://api.github.com/users/balajipachai/following{/other_user}",
      "gists_url": "https://api.github.com/users/balajipachai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/balajipachai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/balajipachai/subscriptions",
      "organizations_url": "https://api.github.com/users/balajipachai/orgs",
      "repos_url": "https://api.github.com/users/balajipachai/repos",
      "events_url": "https://api.github.com/users/balajipachai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/balajipachai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-06T09:05:38Z",
    "updated_at": "2021-04-06T09:05:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Geth persists data after 1 hour worth of block processing (so for example if your blocks are processed in 100ms, that's 10/s * 60s * 60m = after 36000 blocks). If your network is super light (i.e. mostly empty blocks), it may happen that it takes a very very long time until blocks are flushed.\r\n> \r\n> An ungraceful shutdown should still eventually sync up with the network when connections are made to old nodes that are still healthy, so it should eventually self heal itself.\r\n> \r\n> Currently there is no way to configure the period for these persistency rounds because every piece of data pushed to disk cannot be garbage collected any more, so the more frequent, the more junk. You can hack around the issue currently with your workaround of restarting Geth periodically.\r\n> \r\n> We have an alternative idea in the works that would persist the in-memory state not to the database, rather to a flat file. That will allow users to configure wall-clock timeouts for the backups without adding junk to their databases. Not sure when that will ship however, it's not a high priority feature.\r\n\r\nThis might sound a dumb question:\r\n\r\n1. How would I know that the blocks are not yet processed and are still in memory?\r\n2. What if during the periodic restart, a transaction is submitted to the network and all my geth nodes are undergoing periodic restarts?\r\n3. Apart from a workaround is there any fix solution to counter this problem?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/813959721/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/813964469",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20383#issuecomment-813964469",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20383",
    "id": 813964469,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxMzk2NDQ2OQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-06T09:12:48Z",
    "updated_at": "2021-04-06T09:12:48Z",
    "author_association": "MEMBER",
    "body": "1. Blocks are written to disk recent state is not. Whenever Geth flushes state to disk, it prints something along the lines of \"Persisted state to disk [...]\".\r\n2. Don't do periodic restarts. It just pushes more junk into the database.\r\n3. What's the problem? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/813964469/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/813971997",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20383#issuecomment-813971997",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20383",
    "id": 813971997,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxMzk3MTk5Nw==",
    "user": {
      "login": "balajipachai",
      "id": 32358081,
      "node_id": "MDQ6VXNlcjMyMzU4MDgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/32358081?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/balajipachai",
      "html_url": "https://github.com/balajipachai",
      "followers_url": "https://api.github.com/users/balajipachai/followers",
      "following_url": "https://api.github.com/users/balajipachai/following{/other_user}",
      "gists_url": "https://api.github.com/users/balajipachai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/balajipachai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/balajipachai/subscriptions",
      "organizations_url": "https://api.github.com/users/balajipachai/orgs",
      "repos_url": "https://api.github.com/users/balajipachai/repos",
      "events_url": "https://api.github.com/users/balajipachai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/balajipachai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-06T09:24:32Z",
    "updated_at": "2021-04-06T09:44:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "Please find the below logs:\r\n```\r\nINFO [10-08|10:33:36.296] Maximum peer count                       ETH=50 LES=0 total=50\r\nINFO [10-08|10:33:36.296] Smartcard socket not found, disabling    err=\"stat /run/pcscd/pcscd.comm: no such file or directory\"\r\nERROR[10-08|10:33:36.540] Failed to enumerate USB devices          hub=ledger vendor=11415 failcount=1 err=\"failed to initialize libusb: libusb: unknown error [code -99]\"\r\nERROR[10-08|10:33:36.541] Failed to enumerate USB devices          hub=trezor vendor=21324 failcount=1 err=\"failed to initialize libusb: libusb: unknown error [code -99]\"\r\nERROR[10-08|10:33:36.541] Failed to enumerate USB devices          hub=trezor vendor=4617  failcount=1 err=\"failed to initialize libusb: libusb: unknown error [code -99]\"\r\nERROR[10-08|10:33:36.541] Failed to enumerate USB devices          hub=ledger vendor=11415 failcount=2 err=\"failed to initialize libusb: libusb: unknown error [code -99]\"\r\nERROR[10-08|10:33:36.541] Failed to enumerate USB devices          hub=trezor vendor=21324 failcount=2 err=\"failed to initialize libusb: libusb: unknown error [code -99]\"\r\nERROR[10-08|10:33:36.542] Failed to enumerate USB devices          hub=trezor vendor=4617  failcount=2 err=\"failed to initialize libusb: libusb: unknown error [code -99]\"\r\nINFO [10-08|10:33:36.543] Starting peer-to-peer node               instance=Geth/Node1/v1.9.1-stable-b7b2f60f/linux-amd64/go1.11.5\r\nWARN [10-08|10:33:36.544] Sanitizing invalid miner gas price       provided=0 updated=0\r\nINFO [10-08|10:33:36.544] Allocated trie memory caches             clean=256.00MiB dirty=256.00MiB\r\nINFO [10-08|10:33:36.544] Allocated cache and file handles         database=/home/ibcadmin/Node1/geth/chaindata cache=512.00MiB handles=524288\r\nINFO [10-08|10:33:36.764] Opened ancient database                  database=/home/ibcadmin/Node1/geth/chaindata/ancient\r\nINFO [10-08|10:33:36.766] Initialised chain configuration          config=\"{ChainID: 25 Homestead: 1 DAO: <nil> DAOSupport: false EIP150: 2 EIP155: 3 EIP158: 3 Byzantium: 4 Constantinople: <nil>  Petersburg: <nil> Engine: clique}\"\r\nINFO [10-08|10:33:36.767] Initialising Ethereum protocol           versions=[63] network=25 dbversion=7\r\nWARN [10-08|10:33:36.806] Head state missing, repairing chain      number=554 hash=b3e5c9â€¦8ae258\r\nINFO [10-08|10:33:36.808] Rewound blockchain to past state         number=490 hash=0a243dâ€¦6b0b76\r\nINFO [10-08|10:33:36.809] Loaded most recent local header          number=554 hash=b3e5c9â€¦8ae258 td=1109 age=17m53s\r\nINFO [10-08|10:33:36.809] Loaded most recent local full block      number=490 hash=0a243dâ€¦6b0b76 td=981  age=18h59m54s\r\nINFO [10-08|10:33:36.809] Loaded most recent local fast block      number=554 hash=b3e5c9â€¦8ae258 td=1109 age=17m53s\r\nINFO [10-08|10:33:36.969] Loaded local transaction journal         transactions=15 dropped=0\r\nINFO [10-08|10:33:36.970] Regenerated local transaction journal    transactions=15 accounts=15\r\nINFO [10-08|10:33:37.287] New local node record                    seq=47 id=e8588b1b796c694a ip=127.0.0.1 udp=30321 tcp=30321\r\nINFO [10-08|10:33:37.290] IPC endpoint opened                      \r\nINFO [10-08|10:33:37.291] HTTP endpoint opened                     cors=* vhosts=localhost\r\nINFO [10-08|10:33:37.297] Started P2P networking                   self=enode://f73fe00b3bdabfad87b55765f69dbd7d9c28f62f7d20db2fbae23da3c93354add0a605cd312c175dab2914bb487b75fba5fb5e2c26dca79510d6880ccdd1c887@127.0.0.1:30321\r\nERROR[10-08|10:33:37.542] Failed to enumerate USB devices          hub=ledger vendor=11415 failcount=3 err=\"failed to initialize libusb: libusb: unknown error [code -99]\"\r\nERROR[10-08|10:33:37.543] Failed to enumerate USB devices          hub=trezor vendor=4617  failcount=3 err=\"failed to initialize libusb: libusb: unknown error [code -99]\"\r\nERROR[10-08|10:33:37.543] Failed to enumerate USB devices          hub=trezor vendor=21324 failcount=3 err=\"failed to initialize libusb: libusb: unknown error [code -99]\"\r\nINFO [10-08|10:33:38.201] Unlocked account                         address=0x1e9b9105B313c5AdcBF003aAc21461e88c4Da9AF\r\nINFO [10-08|10:33:38.201] Transaction pool price threshold updated price=0\r\nINFO [10-08|10:33:38.201] Transaction pool price threshold updated price=0\r\nINFO [10-08|10:33:38.201] Etherbase automatically configured       address=0x1e9b9105B313c5AdcBF003aAc21461e88c4Da9AF\r\nINFO [10-08|10:33:38.201] Commit new mining work                   number=491 sealhash=ce85caâ€¦8b06b1 uncles=0 txs=0 gas=0 fees=0 elapsed=126.1Âµs\r\nINFO [10-08|10:33:38.202] Successfully sealed new block            number=491 sealhash=ce85caâ€¦8b06b1 hash=0de3d9â€¦6ec3ad elapsed=1.064ms\r\nINFO [10-08|10:33:38.202] ðŸ”¨ mined potential block                  number=491 hash=0de3d9â€¦6ec3ad\r\nINFO [10-08|10:33:38.203] Commit new mining work                   number=491 sealhash=8c160aâ€¦371e24 uncles=0 txs=15 gas=683304 fees=0 elapsed=2.167ms\r\nINFO [10-08|10:33:38.204] Commit new mining work                   number=492 sealhash=8db4abâ€¦92ef58 uncles=0 txs=0  gas=0      fees=0 elapsed=545.4Âµs\r\nINFO [10-08|10:33:38.205] Successfully sealed new block            number=491 sealhash=8c160aâ€¦371e24 hash=eb6f69â€¦bc7be5 elapsed=1.928ms\r\nINFO [10-08|10:33:38.205] ðŸ”¨ mined potential block                  number=491 hash=eb6f69â€¦bc7be5\r\nINFO [10-08|10:33:38.206] Commit new mining work                   number=492 sealhash=12ce39â€¦739672 uncles=0 txs=15 gas=683304 fees=0 elapsed=2.703ms\r\nINFO [10-08|10:33:38.208] Commit new mining work                   number=492 sealhash=12ce39â€¦739672 uncles=1 txs=15 gas=683304 fees=0 elapsed=469.2Âµs\r\nINFO [10-08|10:33:43.001] Successfully sealed new block            number=492 sealhash=12ce39â€¦739672 hash=9b8cffâ€¦7b71fb elapsed=4.794s\r\n```\r\n\r\nThe logs shows a warning: WARN [10-08|10:33:36.806] Head state missing, repairing chain      number=554 hash=b3e5c9â€¦8ae258 and then you can see that instead of mining the new block from number 555, the mining started from block number 491.\r\n\r\nIn the logs, I see `INFO [03-15|14:22:55.816] Persisted trie from memory database      nodes=27 size=5.29KiB time=654.399Âµs gcnodes=0 gcsize=0.00B gctime=0s livenodes=8 livesize=2.44KiB` and there is not even a single entry referred `Persisted state to disk [...]`\r\n\r\nI am running a geth private network of 2 nodes, and occassionally say after a crash or after killing and restarting the geth node, it exhibits the above behaviour which results in block losses.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/813971997/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/813991944",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20383#issuecomment-813991944",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20383",
    "id": 813991944,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxMzk5MTk0NA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-06T09:55:32Z",
    "updated_at": "2021-04-06T09:55:32Z",
    "author_association": "MEMBER",
    "body": "Don't kill it. Shut it down gracefully. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/813991944/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/814004343",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20383#issuecomment-814004343",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20383",
    "id": 814004343,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNDAwNDM0Mw==",
    "user": {
      "login": "balajipachai",
      "id": 32358081,
      "node_id": "MDQ6VXNlcjMyMzU4MDgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/32358081?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/balajipachai",
      "html_url": "https://github.com/balajipachai",
      "followers_url": "https://api.github.com/users/balajipachai/followers",
      "following_url": "https://api.github.com/users/balajipachai/following{/other_user}",
      "gists_url": "https://api.github.com/users/balajipachai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/balajipachai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/balajipachai/subscriptions",
      "organizations_url": "https://api.github.com/users/balajipachai/orgs",
      "repos_url": "https://api.github.com/users/balajipachai/repos",
      "events_url": "https://api.github.com/users/balajipachai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/balajipachai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-06T10:15:54Z",
    "updated_at": "2021-04-06T10:15:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thank You, this helps.\r\nI am following below approach for shutting it down gracefully:\r\n\r\n- When geth is launched in console mode, then I do `Ctrl^c` or `exit`\r\n- When geth is launched as a daemon, then I do `pkill -INT pid` where pid is of geth process\r\n\r\nAny other methods of shutting it down gracefully, you are aware of, that's missing from the above points.\r\nHowever, what if the system crashes? in that case how do we mitigate the risk of block losses? Does geth shuts down gracefully in this scenario?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/814004343/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1157560410",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/20383#issuecomment-1157560410",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/20383",
    "id": 1157560410,
    "node_id": "IC_kwDOAOvK985E_vha",
    "user": {
      "login": "saccura",
      "id": 102767426,
      "node_id": "U_kgDOBiAbQg",
      "avatar_url": "https://avatars.githubusercontent.com/u/102767426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/saccura",
      "html_url": "https://github.com/saccura",
      "followers_url": "https://api.github.com/users/saccura/followers",
      "following_url": "https://api.github.com/users/saccura/following{/other_user}",
      "gists_url": "https://api.github.com/users/saccura/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/saccura/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/saccura/subscriptions",
      "organizations_url": "https://api.github.com/users/saccura/orgs",
      "repos_url": "https://api.github.com/users/saccura/repos",
      "events_url": "https://api.github.com/users/saccura/events{/privacy}",
      "received_events_url": "https://api.github.com/users/saccura/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-16T11:39:33Z",
    "updated_at": "2022-06-16T11:39:33Z",
    "author_association": "NONE",
    "body": "Any solution here?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1157560410/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
