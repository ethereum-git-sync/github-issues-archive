{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22971",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22971/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22971/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22971/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/22971",
  "id": 906705222,
  "node_id": "MDU6SXNzdWU5MDY3MDUyMjI=",
  "number": 22971,
  "title": "Simple restart causes two minutes of downtime",
  "user": {
    "login": "AlexSSD7",
    "id": 43043344,
    "node_id": "MDQ6VXNlcjQzMDQzMzQ0",
    "avatar_url": "https://avatars.githubusercontent.com/u/43043344?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AlexSSD7",
    "html_url": "https://github.com/AlexSSD7",
    "followers_url": "https://api.github.com/users/AlexSSD7/followers",
    "following_url": "https://api.github.com/users/AlexSSD7/following{/other_user}",
    "gists_url": "https://api.github.com/users/AlexSSD7/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AlexSSD7/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AlexSSD7/subscriptions",
    "organizations_url": "https://api.github.com/users/AlexSSD7/orgs",
    "repos_url": "https://api.github.com/users/AlexSSD7/repos",
    "events_url": "https://api.github.com/users/AlexSSD7/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AlexSSD7/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 11,
  "created_at": "2021-05-30T10:10:33Z",
  "updated_at": "2023-12-01T09:49:33Z",
  "closed_at": "2023-12-01T09:49:33Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: v1.10.2\r\nOS & Version: Linux\r\nHardware: AWS c5ad.4xlarge\r\n\r\n#### CLI params\r\n\r\n```--http --ws --mine  --maxpeers 200 --cache 16384```\r\n\r\n\r\n#### Expected behaviour\r\n\r\nGeth restarting quickly resulting in less than 5 seconds of downtime.\r\n\r\n#### Actual behaviour\r\n\r\nGeth is being offline for two minutes.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nJust restart the node. From my observations, a higher cache size results in more downtime.\r\n\r\n#### Log\r\n\r\n````\r\nINFO [05-30|10:00:08.831] Got interrupt, shutting down... \r\nINFO [05-30|10:00:08.836] HTTP server stopped                      endpoint=[::]:8545\r\nINFO [05-30|10:00:08.837] HTTP server stopped                      endpoint=[::]:8546\r\nINFO [05-30|10:00:08.838] IPC endpoint closed                      url=/data/geth/geth.ipc\r\nINFO [05-30|10:00:08.840] Ethereum protocol stopped \r\nINFO [05-30|10:00:08.842] Transaction pool stopped \r\nINFO [05-30|10:00:08.890] Writing cached state to disk             block=12535045 hash=\"e8f038…fd447c\" root=\"68818c…acfb06\"\r\nINFO [05-30|10:00:09.108] Looking for peers                        peercount=1  tried=23 static=13\r\nINFO [05-30|10:00:10.346] Deep froze chain segment                 blocks=6  elapsed=5.316ms     number=12445045     hash=\"0c0280…a46758\"\r\nINFO [05-30|10:00:19.278] Looking for peers                        peercount=0  tried=52 static=13\r\nINFO [05-30|10:00:29.385] Looking for peers                        peercount=0  tried=45 static=13\r\nERROR[05-30|10:00:33.409] Snapshot extension registration failed   peer=5e8011ec              err=\"peer connected on snap without compatible eth support\"\r\nINFO [05-30|10:00:39.670] Looking for peers                        peercount=1  tried=56 static=13\r\nINFO [05-30|10:00:49.903] Looking for peers                        peercount=1  tried=33 static=13\r\nINFO [05-30|10:00:59.921] Looking for peers                        peercount=0  tried=57 static=13\r\nERROR[05-30|10:01:02.724] Snapshot extension registration failed   peer=0daa5b20              err=\"peer connected on snap without compatible eth support\"\r\nINFO [05-30|10:01:08.303] Persisted trie from memory database      nodes=12340440 size=2.66GiB time=2m12.247990658s gcnodes=65254860 gcsize=24.56GiB gctime=5m8.532106118s livenodes=1663009 livesize=662.59MiB\r\nINFO [05-30|10:01:08.314] Writing cached state to disk             block=12535044 hash=\"17f37f…5bd88f\" root=\"c28953…bf91f4\"\r\nINFO [05-30|10:01:08.356] Persisted trie from memory database      nodes=3157     size=1.17MiB time=41.989108ms     gcnodes=0        gcsize=0.00B    gctime=0s             livenodes=1659852 livesize=661.42MiB\r\nINFO [05-30|10:01:08.357] Writing cached state to disk             block=12534534 hash=\"ce3c98…e96401\" root=\"f17c6d…19c295\"\r\nINFO [05-30|10:01:09.925] Looking for peers                        peercount=1  tried=48 static=13\r\nINFO [05-30|10:01:13.122] Persisted trie from memory database      nodes=370131   size=140.85MiB time=4.765080814s    gcnodes=0        gcsize=0.00B    gctime=0s             livenodes=1289721 livesize=520.57MiB\r\nINFO [05-30|10:01:13.122] Writing snapshot state to disk           root=\"e3d347…1df167\"\r\nINFO [05-30|10:01:14.374] Persisted trie from memory database      nodes=99867    size=39.25MiB  time=1.252318946s    gcnodes=0        gcsize=0.00B    gctime=0s             livenodes=1189854 livesize=481.32MiB\r\nERROR[05-30|10:01:18.856] Dangling trie nodes after full cleanup \r\nINFO [05-30|10:01:18.856] Writing clean trie cache to disk         path=/data/geth/geth/triecache threads=16\r\nINFO [05-30|10:01:19.111] Persisted the clean trie cache           path=/data/geth/geth/triecache elapsed=254.498ms\r\nINFO [05-30|10:01:19.111] Blockchain stopped \r\nINFO [05-30|10:01:49.671] Starting Geth on Ethereum mainnet... \r\n````",
  "closed_by": {
    "login": "MariusVanDerWijden",
    "id": 16664698,
    "node_id": "MDQ6VXNlcjE2NjY0Njk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MariusVanDerWijden",
    "html_url": "https://github.com/MariusVanDerWijden",
    "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
    "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
    "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
    "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
    "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
    "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22971/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22971/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/852940950",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22971#issuecomment-852940950",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22971",
    "id": 852940950,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1Mjk0MDk1MA==",
    "user": {
      "login": "ligi",
      "id": 111600,
      "node_id": "MDQ6VXNlcjExMTYwMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ligi",
      "html_url": "https://github.com/ligi",
      "followers_url": "https://api.github.com/users/ligi/followers",
      "following_url": "https://api.github.com/users/ligi/following{/other_user}",
      "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
      "organizations_url": "https://api.github.com/users/ligi/orgs",
      "repos_url": "https://api.github.com/users/ligi/repos",
      "events_url": "https://api.github.com/users/ligi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ligi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-02T11:15:46Z",
    "updated_at": "2021-06-02T11:15:46Z",
    "author_association": "MEMBER",
    "body": "What is the reason you need to restart the node?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/852940950/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/852945777",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22971#issuecomment-852945777",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22971",
    "id": 852945777,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1Mjk0NTc3Nw==",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-02T11:24:00Z",
    "updated_at": "2021-06-02T11:24:38Z",
    "author_association": "MEMBER",
    "body": "During restarts all information that is currently in memory has to persisted to disk. \r\nThus if you specify a cache of 16GB a lot of time is spent on saving the information in the cache to disk.\r\nWriting 16GB to disk on a disk with 500MB/s write speeds alone takes ~32 seconds. This time does not include computing _where_ to write the data. Additionally the data is not written in a continuous blob, but small random writes all over the disk occur additionally impacting performance. In your log you can see that the most time is spent during `Persisted trie from memory database` which has to write  `12340440` nodes all over the disk\r\n\r\nWe could investigate whether we can speed this up though",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/852945777/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/852950922",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22971#issuecomment-852950922",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22971",
    "id": 852950922,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1Mjk1MDkyMg==",
    "user": {
      "login": "AlexSSD7",
      "id": 43043344,
      "node_id": "MDQ6VXNlcjQzMDQzMzQ0",
      "avatar_url": "https://avatars.githubusercontent.com/u/43043344?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexSSD7",
      "html_url": "https://github.com/AlexSSD7",
      "followers_url": "https://api.github.com/users/AlexSSD7/followers",
      "following_url": "https://api.github.com/users/AlexSSD7/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexSSD7/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexSSD7/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexSSD7/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexSSD7/orgs",
      "repos_url": "https://api.github.com/users/AlexSSD7/repos",
      "events_url": "https://api.github.com/users/AlexSSD7/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexSSD7/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-02T11:32:31Z",
    "updated_at": "2021-06-02T11:32:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "> What is the reason you need to restart the node?\r\n\r\nMany reasons: upgrading the node, changing flags, reloading `{static,trusted}-nodes.json`, etc.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/852950922/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/852952555",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22971#issuecomment-852952555",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22971",
    "id": 852952555,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1Mjk1MjU1NQ==",
    "user": {
      "login": "AlexSSD7",
      "id": 43043344,
      "node_id": "MDQ6VXNlcjQzMDQzMzQ0",
      "avatar_url": "https://avatars.githubusercontent.com/u/43043344?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AlexSSD7",
      "html_url": "https://github.com/AlexSSD7",
      "followers_url": "https://api.github.com/users/AlexSSD7/followers",
      "following_url": "https://api.github.com/users/AlexSSD7/following{/other_user}",
      "gists_url": "https://api.github.com/users/AlexSSD7/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AlexSSD7/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AlexSSD7/subscriptions",
      "organizations_url": "https://api.github.com/users/AlexSSD7/orgs",
      "repos_url": "https://api.github.com/users/AlexSSD7/repos",
      "events_url": "https://api.github.com/users/AlexSSD7/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AlexSSD7/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-02T11:35:18Z",
    "updated_at": "2021-06-02T11:35:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "> During restarts all information that is currently in memory has to persisted to disk.\r\n> Thus if you specify a cache of 16GB a lot of time is spent on saving the information in the cache to disk.\r\n> Writing 16GB to disk on a disk with 500MB/s write speeds alone takes ~32 seconds. This time does not include computing _where_ to write the data. Additionally the data is not written in a continuous blob, but small random writes all over the disk occur additionally impacting performance. In your log you can see that the most time is spent during `Persisted trie from memory database` which has to write `12340440` nodes all over the disk\r\n> \r\n> We could investigate whether we can speed this up though\r\n\r\nI understand that writing all data takes quite a while. The problem here is that the RPC is shut down before those writes have been completed, not after.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/852952555/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/852959568",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22971#issuecomment-852959568",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22971",
    "id": 852959568,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1Mjk1OTU2OA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-02T11:47:04Z",
    "updated_at": "2021-06-02T11:47:04Z",
    "author_association": "MEMBER",
    "body": ">  The problem here is that the RPC is shut down before those writes have been completed, not after.\r\n\r\nThat's an interesting take. So, geth 'boots' up the blockchain before it boots up the RPC, so the shutdown sequence happens in the reverse order. However, I'm not sure that it's _intrinsically_ any need for the RPC to shut down before the blockchain, so there might possibly be something we can do there. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/852959568/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/852961448",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22971#issuecomment-852961448",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22971",
    "id": 852961448,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1Mjk2MTQ0OA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-02T11:50:18Z",
    "updated_at": "2021-06-02T11:50:18Z",
    "author_association": "MEMBER",
    "body": "Actually, that wasn't quite true. The termination of rpc is not part of the service-shutdown, it's done explicitly _before_ closing down the other services: \r\n```golang\r\n// stopServices terminates running services, RPC and p2p networking.\r\n// It is the inverse of Start.\r\nfunc (n *Node) stopServices(running []Lifecycle) error {\r\n\tn.stopRPC()\r\n\r\n\t// Stop running lifecycles in reverse order.\r\n\tfailure := &StopError{Services: make(map[reflect.Type]error)}\r\n\tfor i := len(running) - 1; i >= 0; i-- {\r\n\t\tif err := running[i].Stop(); err != nil {\r\n\t\t\tfailure.Services[reflect.TypeOf(running[i])] = err\r\n\t\t}\r\n\t}\r\n\r\n\t// Stop p2p networking.\r\n\tn.server.Stop()\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/852961448/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/853128506",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22971#issuecomment-853128506",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22971",
    "id": 853128506,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MzEyODUwNg==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-02T15:32:50Z",
    "updated_at": "2021-06-02T15:35:57Z",
    "author_association": "MEMBER",
    "body": "The shutdown being slow is a general issue with the way geth writes the state. I think it is not a good idea to try and paper over the issue by stopping the RPC later. The problem with stopping it later is that some functionality offered by the RPC will no longer be available while the component providing it is terminated. Also, the RPC being fully stopped first protects against shutdown bugs in components. The last thing you want during the precious shutdown write operation is some  minor component crashing because it can't handle being called after it has already been stopped.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/853128506/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/853131559",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22971#issuecomment-853131559",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22971",
    "id": 853131559,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MzEzMTU1OQ==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-02T15:36:39Z",
    "updated_at": "2021-06-02T15:36:39Z",
    "author_association": "MEMBER",
    "body": "We also have this other issue for the shutdown speed problem: https://github.com/ethereum/go-ethereum/issues/22524",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/853131559/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/853711743",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22971#issuecomment-853711743",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22971",
    "id": 853711743,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MzcxMTc0Mw==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-03T09:03:34Z",
    "updated_at": "2021-06-03T09:03:34Z",
    "author_association": "MEMBER",
    "body": "One idea that would help here is if we didn't flush the dirty data into leveldb, rather just flattened the thing into an external file and then loaded it back up on startup. It would solve a lot of issues, but it's not super trivial to serialize a full refcounting GC dataset to disk.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/853711743/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/867263807",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22971#issuecomment-867263807",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22971",
    "id": 867263807,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NzI2MzgwNw==",
    "user": {
      "login": "AusIV",
      "id": 977954,
      "node_id": "MDQ6VXNlcjk3Nzk1NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/977954?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AusIV",
      "html_url": "https://github.com/AusIV",
      "followers_url": "https://api.github.com/users/AusIV/followers",
      "following_url": "https://api.github.com/users/AusIV/following{/other_user}",
      "gists_url": "https://api.github.com/users/AusIV/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AusIV/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AusIV/subscriptions",
      "organizations_url": "https://api.github.com/users/AusIV/orgs",
      "repos_url": "https://api.github.com/users/AusIV/repos",
      "events_url": "https://api.github.com/users/AusIV/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AusIV/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-24T01:29:53Z",
    "updated_at": "2021-06-24T01:29:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "It's maybe worth calling out that running with `--gcmode=archive` tends to shutdown fairly quickly, as there is less that needs to be persisted to disk at shutdown time. That's definitely using a hatchet where a scalpel would seem more appropriate, but depending on your use case and needs it may be a useful trade-off.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/867263807/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1835789693",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22971#issuecomment-1835789693",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22971",
    "id": 1835789693,
    "node_id": "IC_kwDOAOvK985ta-19",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-01T09:49:33Z",
    "updated_at": "2023-12-01T09:49:33Z",
    "author_association": "MEMBER",
    "body": "This issue seems quite stale now. With PBSS and Pebble the shutdown times of a geth node are quite fast now. I'm going to close this issue for now. If you see long shutdown times with PBSS and Pebble, please open a new issue",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1835789693/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
