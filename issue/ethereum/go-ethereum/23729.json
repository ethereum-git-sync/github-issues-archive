{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23729",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23729/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23729/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23729/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23729",
  "id": 1025197106,
  "node_id": "I_kwDOAOvK9849G0Qy",
  "number": 23729,
  "title": "New callTracer fails at block 1,431,916",
  "user": {
    "login": "tanmaster",
    "id": 3981445,
    "node_id": "MDQ6VXNlcjM5ODE0NDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3981445?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tanmaster",
    "html_url": "https://github.com/tanmaster",
    "followers_url": "https://api.github.com/users/tanmaster/followers",
    "following_url": "https://api.github.com/users/tanmaster/following{/other_user}",
    "gists_url": "https://api.github.com/users/tanmaster/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tanmaster/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tanmaster/subscriptions",
    "organizations_url": "https://api.github.com/users/tanmaster/orgs",
    "repos_url": "https://api.github.com/users/tanmaster/repos",
    "events_url": "https://api.github.com/users/tanmaster/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tanmaster/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-10-13T12:37:51Z",
  "updated_at": "2021-10-13T13:22:45Z",
  "closed_at": "2021-10-13T12:50:05Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `1.10.10-unstable`, build from master branch\r\nOS & Version: Linux\r\nCommit hash : 633e7ef4781453111c4b29e14a65c5335bb9ecac\r\n\r\nI was not sure if this was reported or maybe even fixed already (saw some similar sounding discussions in #23669), so this is just in case. The new callTracer fails at block `1431916` for transaction number 38 (hash: `0x0c10fafe0cdbfff32abfe53d57ec861d09986cc1050c850481f79b1a862bb10a`). \r\n\r\n#### Expected behaviour\r\nTraces are returned via RPC socket / websocket.\r\n\r\n#### Actual behaviour\r\nOnce that transaction is reached, the following is logged into the geth console (and the tracing continues):\r\n```\r\nWARN [10-12|20:56:42.851] Tracing failed                           hash=0c10fa..2bb10a block=1,431,916 err=\"RangeError: json encode recursion limit    in server-side tracer function 'result'\"\r\n```\r\nThe error message is quite telling. This transaction spawns a call which recursively calls itself 1024 times (which is the maximum depth for calls in the EVM it think?). After a bit of fiddling, I found that go-duktape sets the default value for the encoding recursion limit to 1000:\r\n\r\nhttps://github.com/olebedev/go-duktape/blob/650f7c85444083d383394f0ac179080ae3b94325/duk_config.h#L3015:\r\n\r\n```C\r\n#define DUK_USE_JSON_ENC_RECLIMIT 1000\r\n```\r\nSo my guess is: Since the data structure that holds the results for this transaction is a 1024x nested object, it can't be jsonified. However, trying to set that limit higher (by editing the source file and recompiling) did not work for me, but I am not sure if that is the correct way to do it anyway.\r\n\r\nMy limited understanding leads me to think that this behaviour could be mitigated by unwrangling the nested object inside the finalize method into an array before returning it. But I also think that doing so would eat up a lot of computation time in the process, making tracing overall slower. So maybe trying to set up the limit is the best approach, especially if the maximum depth is only larger by 24...?\r\n\r\n#### Steps to reproduce the behaviour\r\nUnfortunately, on my machine, it takes almost 1 hour to trace up to said failing block since I have to start at block 0. So reproducing would be easier on a full archive machine I guess.\r\n\r\nThe command I use for tracing: \r\n```json\r\n{\"id\": 1, \"method\": \"debug_subscribe\", \"params\": [\"traceChain\", \"0x0\", \"0x15d96d\", {\"tracer\": \"callTracer\"}]}\r\n```",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23729/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23729/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/942271204",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23729#issuecomment-942271204",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23729",
    "id": 942271204,
    "node_id": "IC_kwDOAOvK9844Kerk",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-13T12:50:05Z",
    "updated_at": "2021-10-13T12:50:05Z",
    "author_association": "MEMBER",
    "body": "See https://github.com/ethereum/go-ethereum/issues/21879 and https://github.com/ethereum/go-ethereum/issues/16426 . We've \"handled\" it insofar as we don't crash, but can't really fix the root problem. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/942271204/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/942272206",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23729#issuecomment-942272206",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23729",
    "id": 942272206,
    "node_id": "IC_kwDOAOvK9844Ke7O",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-13T12:51:09Z",
    "updated_at": "2021-10-13T12:51:09Z",
    "author_association": "MEMBER",
    "body": "See https://github.com/ethereum/go-ethereum/pull/22857 for even more context",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/942272206/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/942303023",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23729#issuecomment-942303023",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23729",
    "id": 942303023,
    "node_id": "IC_kwDOAOvK9844Kmcv",
    "user": {
      "login": "tanmaster",
      "id": 3981445,
      "node_id": "MDQ6VXNlcjM5ODE0NDU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3981445?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tanmaster",
      "html_url": "https://github.com/tanmaster",
      "followers_url": "https://api.github.com/users/tanmaster/followers",
      "following_url": "https://api.github.com/users/tanmaster/following{/other_user}",
      "gists_url": "https://api.github.com/users/tanmaster/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tanmaster/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tanmaster/subscriptions",
      "organizations_url": "https://api.github.com/users/tanmaster/orgs",
      "repos_url": "https://api.github.com/users/tanmaster/repos",
      "events_url": "https://api.github.com/users/tanmaster/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tanmaster/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-13T13:22:45Z",
    "updated_at": "2021-10-13T13:22:45Z",
    "author_association": "NONE",
    "body": "Bummer, thanks for the swift reply though!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/942303023/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
