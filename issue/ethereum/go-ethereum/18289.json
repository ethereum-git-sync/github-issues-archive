{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18289",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18289/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18289/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18289/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/18289",
  "id": 390050286,
  "node_id": "MDU6SXNzdWUzOTAwNTAyODY=",
  "number": 18289,
  "title": "EVM dynamic array maybe occupy large memory",
  "user": {
    "login": "lcatro",
    "id": 10431717,
    "node_id": "MDQ6VXNlcjEwNDMxNzE3",
    "avatar_url": "https://avatars.githubusercontent.com/u/10431717?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lcatro",
    "html_url": "https://github.com/lcatro",
    "followers_url": "https://api.github.com/users/lcatro/followers",
    "following_url": "https://api.github.com/users/lcatro/following{/other_user}",
    "gists_url": "https://api.github.com/users/lcatro/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lcatro/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lcatro/subscriptions",
    "organizations_url": "https://api.github.com/users/lcatro/orgs",
    "repos_url": "https://api.github.com/users/lcatro/repos",
    "events_url": "https://api.github.com/users/lcatro/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lcatro/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2018-12-12T03:29:59Z",
  "updated_at": "2020-01-09T15:07:20Z",
  "closed_at": "2019-06-25T09:26:55Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "\r\n#### System information\r\n\r\nGeth version: `1.8.19`\r\nOS & Version: Linux\r\nCommit hash : no found\r\n\r\n#### Expected behaviour\r\nDynamic array save itself length in memory and this length will restrict index of array .\r\n\r\n```\r\n\r\n    function a(uint[] b) {\r\n        b[2]=0x10;\r\n    }\r\n\r\n```\r\n\r\nSee the assambly ,`b[2] = 0x10` implicate index of array check .\r\n\r\n```\r\n\r\n----  Address 0x97  Function a() Main Code  ----\r\n151 JUMPDEST\r\n152 PUSH1 10    ;  value : 0x10\r\n154 DUP2\r\n155 PUSH1 02    ;  index of array .0x02\r\n157 DUP2\r\n158 MLOAD       ;  MLOAD 0x80 ,Get the array length\r\n159 DUP2\r\n160 LT          ;  check index of array with array lengtj\r\n161 ISZERO\r\n162 ISZERO  \r\n163 PUSH1 a7\r\n165 JUMPI       ;  jump to write data into array\r\n166 INVALID     ;  exit contract \r\n----  Address 0xA7  ----\r\n167 JUMPDEST\r\n168 PUSH1 20    ;  /\r\n170 SWAP1       ;  |\r\n171 DUP2        ;  |\r\n172 MUL         ;  |  calculate the data location in array and store the number in it \r\n173 SWAP1       ;  |\r\n174 SWAP2       ;  |\r\n175 ADD         ;  |\r\n176 ADD         ;  \\\r\n177 MSTORE      ;  MSTORE 0xE0,0x10 .\r\n\r\n```\r\n\r\nSo call function a like this `a([1,2,3])` ,`b[2]=0x10` will success execute ;but `a([1,2])` ,`b[2]=0x10` will except.\r\n\r\n#### Actual behaviour\r\nWe know Solc will auto insert array index check code in assambly ,so I try still rewrite the dynamic length .\r\n\r\n```\r\n\r\npragma solidity ^0.4.24;\r\n\r\ncontract test {\r\n\r\n    function a(uint[] b) {\r\n        b.length = 0x10;\r\n    }\r\n\r\n}\r\n\r\n```\r\n\r\nUnfortunately ,it can't pass compile .It mean we rewrite the length of dynamic array .But I try to rewrite the array length on memory that is work .\r\n\r\n```\r\n\r\npragma solidity ^0.4.24;\r\n\r\ncontract test {\r\n\r\n    function a(uint[] b,uint[] c) {\r\n        uint c_length = c.length;\r\n        assembly {\r\n            mstore(add(0x80,mul(3,0x20)),0x5)  //  rewrite the length of dynamic array in memory\r\n        }\r\n        c_length = c.length;   //  array length change to 0x5\r\n    }\r\n\r\n}\r\n\r\n```\r\n\r\nLastly ,I try writing a data to offset 0xC800000 in array .EVM will occupy large memory (200 MB)\r\n\r\n```\r\npragma solidity ^0.4.24;\r\n\r\ncontract test {\r\n\r\n    function a(uint[] b,uint[] c) {\r\n        uint c_length = c.length;\r\n        assembly {\r\n            mstore(add(0x80,mul(3,0x20)),0xAAAAAAAA)\r\n        }\r\n        c_length = c.length;\r\n        c[0xC800000] = 0xFF;\r\n    }\r\n\r\n}\r\n\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\nThis is EVM test command (ignore gas-limit ):\r\n./evm --code 608060405260043610610041576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff16806396f40e3d14610046575b600080fd5b34801561005257600080fd5b506100ed60048036038101908080359060200190820180359060200190808060200260200160405190810160405280939291908181526020018383602002808284378201915050505050509192919290803590602001908201803590602001908080602002602001604051908101604052809392919081815260200183836020028082843782019150505050505091929192905050506100ef565b005b60008151905063aaaaaaaa6020600302608001528151905060ff826210000081518110151561011a57fe5b90602001906020020181815250505050505600a165627a7a72305820fe133e12a0270131204b3cc47bb934f4d348bad747ca490adc53d935690806ac0029 --input 96f40e3d000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000004 --gas 10000000000000000 --debug run\r\n\r\n![image](https://user-images.githubusercontent.com/10431717/49844385-bdf05e80-fdfd-11e8-9220-637e65fefdb0.png)\r\n\r\n![image](https://user-images.githubusercontent.com/10431717/49844431-e9734900-fdfd-11e8-9e08-436628cecf88.png)\r\n\r\n\r\n#### Backtrace\r\nNot found ,you can see large memory alloc output on console by --debug flag .\r\n\r\n",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18289/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18289/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/505364187",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18289#issuecomment-505364187",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18289",
    "id": 505364187,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwNTM2NDE4Nw==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-25T09:26:55Z",
    "updated_at": "2019-06-25T09:26:55Z",
    "author_association": "MEMBER",
    "body": "I don't quite understand what the bug report is. Is it about the fact that it's possible to DoS your node with high gas allowance? Because that's already known, and a trivial thing to do. `--gas 10000000000000000` is essentially 1 billion times more than would ever be in a mainnet block. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/505364187/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/572602596",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18289#issuecomment-572602596",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18289",
    "id": 572602596,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MjYwMjU5Ng==",
    "user": {
      "login": "NicoleG25",
      "id": 50918335,
      "node_id": "MDQ6VXNlcjUwOTE4MzM1",
      "avatar_url": "https://avatars.githubusercontent.com/u/50918335?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NicoleG25",
      "html_url": "https://github.com/NicoleG25",
      "followers_url": "https://api.github.com/users/NicoleG25/followers",
      "following_url": "https://api.github.com/users/NicoleG25/following{/other_user}",
      "gists_url": "https://api.github.com/users/NicoleG25/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NicoleG25/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NicoleG25/subscriptions",
      "organizations_url": "https://api.github.com/users/NicoleG25/orgs",
      "repos_url": "https://api.github.com/users/NicoleG25/repos",
      "events_url": "https://api.github.com/users/NicoleG25/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NicoleG25/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-09T15:07:20Z",
    "updated_at": "2020-01-09T15:07:20Z",
    "author_association": "NONE",
    "body": "> I don't quite understand what the bug report is. Is it about the fact that it's possible to DoS your node with high gas allowance? Because that's already known, and a trivial thing to do. `--gas 10000000000000000` is essentially 1 billion times more than would ever be in a mainnet block.\r\n\r\nHave you contacted MITRE to dispute/reject the [CVE](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2018-20421) that was apparently issued on this case?\r\n\r\nJust wanna make sure this issue wont be addressed since its disputed :)\r\nThanks in advance @holiman  !",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/572602596/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
