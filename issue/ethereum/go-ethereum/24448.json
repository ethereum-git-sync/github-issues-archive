{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24448",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24448/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24448/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24448/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/24448",
  "id": 1146388427,
  "node_id": "I_kwDOAOvK985EVH_L",
  "number": 24448,
  "title": "ERROR: Failed to journal state snapshot err=\"snapshot [*] missing\"",
  "user": {
    "login": "sardChen",
    "id": 7438696,
    "node_id": "MDQ6VXNlcjc0Mzg2OTY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7438696?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sardChen",
    "html_url": "https://github.com/sardChen",
    "followers_url": "https://api.github.com/users/sardChen/followers",
    "following_url": "https://api.github.com/users/sardChen/following{/other_user}",
    "gists_url": "https://api.github.com/users/sardChen/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sardChen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sardChen/subscriptions",
    "organizations_url": "https://api.github.com/users/sardChen/orgs",
    "repos_url": "https://api.github.com/users/sardChen/repos",
    "events_url": "https://api.github.com/users/sardChen/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sardChen/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-02-22T02:37:19Z",
  "updated_at": "2023-01-09T04:48:19Z",
  "closed_at": "2022-05-12T19:12:02Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: Geth-1.10.9-unstable/go1.13.8\r\nOS & Version: ubuntu 20.04\r\n\r\n#### Expected behaviour\r\nStop the node(ctrl-d) and the node exit as normal\r\n\r\n#### Actual behaviour\r\nAn error reported\r\n\r\n#### Steps to reproduce the behaviour\r\n```\r\n./build/bin/geth --identity \"ETH-node3\" --datadir \"node3\" --ethash.dagdir \"node3\" --port \"30305\" --maxpeers 10 --networkid 10086  --syncmode \"snap\" --snapshot --bootnodes \"enode://6728a506177abb60fd5b49b1461f4b99fc018e4d4c9839a4ded5a395d5b64439fad1d02dd7699324532fbfc82dca501c84eb3dd213b95cdf788454edb7d65cd4@127.0.0.1:0?discport=30301\" --mine --miner.etherbase 0xce68ED3107fe511B37a663496aE473c0f8ea088B --miner.threads 1 --http --http.port 8547 console\r\n```\r\nAfter a while, stop the node.\r\n\r\n#### Backtrace\r\n\r\n````\r\n\r\nINFO [02-20|12:20:06.154] Imported new chain segment               blocks=1   txs=0 mgas=0.000 elapsed=2.786ms     mgasps=0.000  number=11192 hash=c0fa5c..6d2f58 dirty=186.04KiB\r\nINFO [02-20|12:20:06.154] Commit new mining work                   number=11193 sealhash=1c872d..cbea86 uncles=0 txs=0 gas=0     fees=0       elapsed=\"171.473µs\"\r\nINFO [02-20|12:20:06.154] Commit new mining work                   number=11193 sealhash=1c872d..cbea86 uncles=0 txs=0 gas=0     fees=0       elapsed=\"259.864µs\"\r\nINFO [02-20|12:20:10.836] Looking for peers                        peercount=4 tried=0 static=0\r\nINFO [02-20|12:20:20.842] Looking for peers                        peercount=2 tried=1 static=0\r\nINFO [02-20|12:20:21.656] HTTP server stopped                      endpoint=127.0.0.1:8547\r\nINFO [02-20|12:20:21.657] IPC endpoint closed                      url=/root/workplace/blockchain/geth/newFuzzExperiment/node3/geth.ipc\r\nINFO [02-20|12:20:21.657] Ethereum protocol stopped \r\nINFO [02-20|12:20:21.657] Transaction pool stopped \r\nERROR[02-20|12:20:21.657] Failed to journal state snapshot         err=\"snapshot [0xf9e45e285feb1e2ab8ec62664cd30dd4d16e6d56686d7f5cf4f67849b6481636] missing\"\r\nINFO [02-20|12:20:21.657] Writing cached state to disk             block=11192 hash=c0fa5c..6d2f58 root=f9e45e..481636\r\nINFO [02-20|12:20:21.657] Persisted trie from memory database      nodes=26 size=6.03KiB time=\"210.032µs\" gcnodes=33035 gcsize=11.03MiB gctime=68.037928ms livenodes=409 livesize=139.32KiB\r\nINFO [02-20|12:20:21.657] Writing cached state to disk             block=11191 hash=21ec6c..07a385 root=8d5ae2..d593cb\r\nINFO [02-20|12:20:21.658] Persisted trie from memory database      nodes=3  size=1.08KiB time=\"24.694µs\"  gcnodes=0     gcsize=0.00B    gctime=0s          livenodes=406 livesize=138.24KiB\r\nINFO [02-20|12:20:21.658] Writing cached state to disk             block=11065 hash=e1f8a4..0b4db6 root=08de2a..c99724\r\nINFO [02-20|12:20:21.658] Persisted trie from memory database      nodes=12 size=3.27KiB time=\"98.914µs\"  gcnodes=0     gcsize=0.00B    gctime=0s          livenodes=394 livesize=134.97KiB\r\nINFO [02-20|12:20:21.658] Writing clean trie cache to disk         path=/root/workplace/blockchain/geth/newFuzzExperiment/node3/geth/triecache threads=20\r\nINFO [02-20|12:20:21.683] Persisted the clean trie cache           path=/root/workplace/blockchain/geth/newFuzzExperiment/node3/geth/triecache elapsed=24.499ms\r\nINFO [02-20|12:20:21.683] Blockchain stopped\r\n````\r\n\r\nWhen submitting logs: please submit them as text and not screenshots.",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24448/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24448/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1047400474",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24448#issuecomment-1047400474",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24448",
    "id": 1047400474,
    "node_id": "IC_kwDOAOvK984-bhAa",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-22T03:54:47Z",
    "updated_at": "2022-02-22T03:54:47Z",
    "author_association": "MEMBER",
    "body": "It's because your snapshot is not matched with the head trie state. There are two types of states stored in Geth internally, one managed by trie and another managed by snapshot. Snapshot state is given the priority since it's more efficient, and trie state is used as the fallback if snapshot is not available.\r\n\r\nThere are a few causes for the mismatch between the snapshot state and trie state, for example the trie state is rewound because of the previous unclean shutdown. But the snapshot is supposed to be recovered by importing the missing blocks.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1047400474/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1047400817",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24448#issuecomment-1047400817",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24448",
    "id": 1047400817,
    "node_id": "IC_kwDOAOvK984-bhFx",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-22T03:55:53Z",
    "updated_at": "2022-02-22T03:55:53Z",
    "author_association": "MEMBER",
    "body": "Maybe you can provide more information. Do you have unclean shutdown? What's the log when Geth is just started?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1047400817/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1047433204",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24448#issuecomment-1047433204",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24448",
    "id": 1047433204,
    "node_id": "IC_kwDOAOvK984-bo_0",
    "user": {
      "login": "sardChen",
      "id": 7438696,
      "node_id": "MDQ6VXNlcjc0Mzg2OTY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7438696?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sardChen",
      "html_url": "https://github.com/sardChen",
      "followers_url": "https://api.github.com/users/sardChen/followers",
      "following_url": "https://api.github.com/users/sardChen/following{/other_user}",
      "gists_url": "https://api.github.com/users/sardChen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sardChen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sardChen/subscriptions",
      "organizations_url": "https://api.github.com/users/sardChen/orgs",
      "repos_url": "https://api.github.com/users/sardChen/repos",
      "events_url": "https://api.github.com/users/sardChen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sardChen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-22T05:15:15Z",
    "updated_at": "2022-02-22T05:15:15Z",
    "author_association": "NONE",
    "body": "> Maybe you can provide more information. Do you have unclean shutdown? What's the log when Geth is just started?\r\n\r\nSorry, since the log info is too long, the log when Geth is just started has been discarded by my terminal. But I am pretty sure there is no unclean shutdown, because it is the first time to start this node in the environment, and there is no shutdown before.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1047433204/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1049696845",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24448#issuecomment-1049696845",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24448",
    "id": 1049696845,
    "node_id": "IC_kwDOAOvK984-kRpN",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-24T10:14:30Z",
    "updated_at": "2022-02-24T10:15:26Z",
    "author_association": "MEMBER",
    "body": "Could you restart the node and print the startup logs?\r\nYou can use `tee` to write the logs to file e.g. `geth | tee logfile`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1049696845/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1125334648",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24448#issuecomment-1125334648",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24448",
    "id": 1125334648,
    "node_id": "IC_kwDOAOvK985DEz54",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-12T19:12:02Z",
    "updated_at": "2022-05-12T19:12:02Z",
    "author_association": "MEMBER",
    "body": "I don't think any more info is forthcoming here. Closing, not much more we can do",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1125334648/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
