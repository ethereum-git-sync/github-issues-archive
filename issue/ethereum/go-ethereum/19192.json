{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19192",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19192/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19192/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19192/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/19192",
  "id": 416087928,
  "node_id": "MDU6SXNzdWU0MTYwODc5Mjg=",
  "number": 19192,
  "title": "goroutine memory leak ",
  "user": {
    "login": "hadv",
    "id": 941411,
    "node_id": "MDQ6VXNlcjk0MTQxMQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/941411?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hadv",
    "html_url": "https://github.com/hadv",
    "followers_url": "https://api.github.com/users/hadv/followers",
    "following_url": "https://api.github.com/users/hadv/following{/other_user}",
    "gists_url": "https://api.github.com/users/hadv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hadv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hadv/subscriptions",
    "organizations_url": "https://api.github.com/users/hadv/orgs",
    "repos_url": "https://api.github.com/users/hadv/repos",
    "events_url": "https://api.github.com/users/hadv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hadv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2019-03-01T12:47:04Z",
  "updated_at": "2019-06-21T08:29:15Z",
  "closed_at": "2019-06-21T08:29:15Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Thank you for your information @marcosmartinez7 \r\n\r\nBy the way, I still can reproduce the issue on 1.8.20 & 1.8.21 with 16GB of RAM by sending 10 thousands of tnx (2000 txs/block sealing & txpool always fill up with ~10,000 txs)\r\n\r\nAnd one thing very strange is mining node with public RPC endpoint don't have the issue on the same computing configuration. So I think there's must be memory leak somewhere.\r\n\r\n**mining**\r\n![image](https://user-images.githubusercontent.com/941411/51849466-5dd45e00-2352-11e9-8d1e-bde459ffb98e.png)\r\n\r\n**un-mining** (**memory leak**)\r\n\r\n![image](https://user-images.githubusercontent.com/941411/51849572-9411dd80-2352-11e9-83ba-3feb5f194b8c.png)\r\n\r\n_Originally posted by @hadv in https://github.com/ethereum/go-ethereum/issues/17450#issuecomment-458196386_\r\n\r\ncc: @karalabe @fjl \r\ngoroutine leak on unmining RPC node\r\n\r\n![image](https://user-images.githubusercontent.com/941411/51881076-5d68b100-23ac-11e9-97ca-115fa89a807f.png)\r\n\r\nmining node (no leak)\r\n\r\n![image](https://user-images.githubusercontent.com/941411/51881086-6a85a000-23ac-11e9-94d1-89f61040936a.png)\r\n\r\n_Originally posted by @hadv in https://github.com/ethereum/go-ethereum/issues/17450#issuecomment-458388801_\r\n\r\n@holiman hope this will help\r\n\r\nhttps://drive.google.com/open?id=1xK6F95bmLsleuvM9qMQaH2Y7K9Gk2ZFD\r\n\r\n_Originally posted by @hadv in https://github.com/ethereum/go-ethereum/issues/17450#issuecomment-458860709_\r\n\r\nI don't know yet.. However, there appears to be ~10K routines spawned by `promoteExecutables`, that are waiting on the lock in `feed.go`. One is busy in the loop. \r\n\r\nI think an underlying problem is that a better model for the transaction handling would be to use active objects (one thread/routine) which receives data, instead of each sender spawning it's own goroutine (https://github.com/ethereum/go-ethereum/blob/master/core/tx_pool.go#L1000) . Btw, @hadv , I don't know what code you're running, but the line numbers from your stack does not match up with what's on master now. \r\n\r\nI'm not sure if there are any simple solutions to this ticket, since IMO it would probably require a non-trivial rewrite of tx pool internals.\r\n\r\n_Originally posted by @holiman in https://github.com/ethereum/go-ethereum/issues/17450#issuecomment-458877573_",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19192/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19192/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/486330517",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19192#issuecomment-486330517",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19192",
    "id": 486330517,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4NjMzMDUxNw==",
    "user": {
      "login": "ryanschneider",
      "id": 53520,
      "node_id": "MDQ6VXNlcjUzNTIw",
      "avatar_url": "https://avatars.githubusercontent.com/u/53520?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanschneider",
      "html_url": "https://github.com/ryanschneider",
      "followers_url": "https://api.github.com/users/ryanschneider/followers",
      "following_url": "https://api.github.com/users/ryanschneider/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanschneider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanschneider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanschneider/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanschneider/orgs",
      "repos_url": "https://api.github.com/users/ryanschneider/repos",
      "events_url": "https://api.github.com/users/ryanschneider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanschneider/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-24T16:52:54Z",
    "updated_at": "2019-04-24T16:52:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "Also possibly related: https://github.com/ethereum/go-ethereum/issues/14669#issuecomment-383406707",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/486330517/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/486495127",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19192#issuecomment-486495127",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19192",
    "id": 486495127,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4NjQ5NTEyNw==",
    "user": {
      "login": "hadv",
      "id": 941411,
      "node_id": "MDQ6VXNlcjk0MTQxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/941411?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hadv",
      "html_url": "https://github.com/hadv",
      "followers_url": "https://api.github.com/users/hadv/followers",
      "following_url": "https://api.github.com/users/hadv/following{/other_user}",
      "gists_url": "https://api.github.com/users/hadv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hadv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hadv/subscriptions",
      "organizations_url": "https://api.github.com/users/hadv/orgs",
      "repos_url": "https://api.github.com/users/hadv/repos",
      "events_url": "https://api.github.com/users/hadv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hadv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-25T02:21:57Z",
    "updated_at": "2019-04-25T02:21:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "@ryanschneider right, I encountered that problem also on private network when sending up dozen thousands of tnx heavily ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/486495127/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
