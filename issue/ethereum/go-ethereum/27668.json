{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27668",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27668/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27668/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27668/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/27668",
  "id": 1793014902,
  "node_id": "I_kwDOAOvK985q3zx2",
  "number": 27668,
  "title": "Private PoA connecting to random public nodes",
  "user": {
    "login": "petrkr",
    "id": 6428351,
    "node_id": "MDQ6VXNlcjY0MjgzNTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6428351?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/petrkr",
    "html_url": "https://github.com/petrkr",
    "followers_url": "https://api.github.com/users/petrkr/followers",
    "following_url": "https://api.github.com/users/petrkr/following{/other_user}",
    "gists_url": "https://api.github.com/users/petrkr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/petrkr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/petrkr/subscriptions",
    "organizations_url": "https://api.github.com/users/petrkr/orgs",
    "repos_url": "https://api.github.com/users/petrkr/repos",
    "events_url": "https://api.github.com/users/petrkr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/petrkr/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    },
    {
      "id": 1132689577,
      "node_id": "MDU6TGFiZWwxMTMyNjg5NTc3",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:triage",
      "name": "status:triage",
      "color": "6be514",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "lightclient",
    "id": 14004106,
    "node_id": "MDQ6VXNlcjE0MDA0MTA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/14004106?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lightclient",
    "html_url": "https://github.com/lightclient",
    "followers_url": "https://api.github.com/users/lightclient/followers",
    "following_url": "https://api.github.com/users/lightclient/following{/other_user}",
    "gists_url": "https://api.github.com/users/lightclient/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lightclient/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lightclient/subscriptions",
    "organizations_url": "https://api.github.com/users/lightclient/orgs",
    "repos_url": "https://api.github.com/users/lightclient/repos",
    "events_url": "https://api.github.com/users/lightclient/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lightclient/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "lightclient",
      "id": 14004106,
      "node_id": "MDQ6VXNlcjE0MDA0MTA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14004106?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lightclient",
      "html_url": "https://github.com/lightclient",
      "followers_url": "https://api.github.com/users/lightclient/followers",
      "following_url": "https://api.github.com/users/lightclient/following{/other_user}",
      "gists_url": "https://api.github.com/users/lightclient/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lightclient/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lightclient/subscriptions",
      "organizations_url": "https://api.github.com/users/lightclient/orgs",
      "repos_url": "https://api.github.com/users/lightclient/repos",
      "events_url": "https://api.github.com/users/lightclient/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lightclient/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-07-07T08:02:40Z",
  "updated_at": "2023-07-10T23:59:04Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "If you create private PoA blockchain by using init genesis and then you are using --netrestrict, by documentation on https://geth.ethereum.org/docs/fundamentals/private-network is written part `With the above setting, Geth will only allow connections from the 172.16.254.0/24 subnet, and will not attempt to connect to other nodes outside of the set IP range.`\r\nBut if I will use this --netrestrict, it stops write to console tried peers, but still there are lots of connections on firewall, so I consider this flag does not work, thus it is bug.\r\n\r\n#### System information\r\n\r\nGeth\r\nVersion: 1.12.0-stable\r\nGit Commit: e501b3b05db8e169f67dc78b7b59bc352b3c638d\r\nGit Commit Date: 20230525\r\nArchitecture: amd64\r\nGo Version: go1.20.3\r\nOperating System: linux\r\n\r\n#### Expected behaviour\r\nDo not make any outgoing connections except addPeer ones (or local perimeter specified by --netrestrict)\r\n\r\n#### Actual behaviour\r\nEven --netrestrict is set to private network like 192.168.1.0/24 there are many outgoing connections somewhere to internet on port 30303\r\n\r\n#### Steps to reproduce the behaviour\r\ngeth init genesis.json\r\ngeth --networkid 12345 --netrestrict 192.168.1.0/24 --nat none\r\n\r\ncheck tcpdump / wireshark\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27668/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27668/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1625722256",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27668#issuecomment-1625722256",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27668",
    "id": 1625722256,
    "node_id": "IC_kwDOAOvK985g5o2Q",
    "user": {
      "login": "chenjia404",
      "id": 2457958,
      "node_id": "MDQ6VXNlcjI0NTc5NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2457958?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chenjia404",
      "html_url": "https://github.com/chenjia404",
      "followers_url": "https://api.github.com/users/chenjia404/followers",
      "following_url": "https://api.github.com/users/chenjia404/following{/other_user}",
      "gists_url": "https://api.github.com/users/chenjia404/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chenjia404/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chenjia404/subscriptions",
      "organizations_url": "https://api.github.com/users/chenjia404/orgs",
      "repos_url": "https://api.github.com/users/chenjia404/repos",
      "events_url": "https://api.github.com/users/chenjia404/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chenjia404/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-07T17:28:49Z",
    "updated_at": "2023-07-07T17:28:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "Are other nodes trying to connect to you? This flag is to control the local not to connect to other nodes.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1625722256/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1628603388",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27668#issuecomment-1628603388",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27668",
    "id": 1628603388,
    "node_id": "IC_kwDOAOvK985hEoP8",
    "user": {
      "login": "petrkr",
      "id": 6428351,
      "node_id": "MDQ6VXNlcjY0MjgzNTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6428351?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/petrkr",
      "html_url": "https://github.com/petrkr",
      "followers_url": "https://api.github.com/users/petrkr/followers",
      "following_url": "https://api.github.com/users/petrkr/following{/other_user}",
      "gists_url": "https://api.github.com/users/petrkr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/petrkr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/petrkr/subscriptions",
      "organizations_url": "https://api.github.com/users/petrkr/orgs",
      "repos_url": "https://api.github.com/users/petrkr/repos",
      "events_url": "https://api.github.com/users/petrkr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/petrkr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-10T09:42:57Z",
    "updated_at": "2023-07-10T09:42:57Z",
    "author_association": "NONE",
    "body": "Other nodes can not connect to me, because it's behind NAT and firewall. But local node trying to connect to some external nodes.\r\nBut workaround seems to be create config.toml and remove Bootnodes. But still I think flag should stop connecting even to boot nodes, especially if --networkid is specified and there is 99% chance, those stock boot nodes will NOT have that networkid chain\r\n\r\n```\r\n[Node.P2P]\r\nBootstrapNodes = []\r\nBootstrapNodesV5 = []\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1628603388/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1629893095",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27668#issuecomment-1629893095",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27668",
    "id": 1629893095,
    "node_id": "IC_kwDOAOvK985hJjHn",
    "user": {
      "login": "lightclient",
      "id": 14004106,
      "node_id": "MDQ6VXNlcjE0MDA0MTA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14004106?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lightclient",
      "html_url": "https://github.com/lightclient",
      "followers_url": "https://api.github.com/users/lightclient/followers",
      "following_url": "https://api.github.com/users/lightclient/following{/other_user}",
      "gists_url": "https://api.github.com/users/lightclient/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lightclient/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lightclient/subscriptions",
      "organizations_url": "https://api.github.com/users/lightclient/orgs",
      "repos_url": "https://api.github.com/users/lightclient/repos",
      "events_url": "https://api.github.com/users/lightclient/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lightclient/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-10T23:58:43Z",
    "updated_at": "2023-07-10T23:58:43Z",
    "author_association": "MEMBER",
    "body": "It looks like the problematic line is here: https://github.com/ethereum/go-ethereum/blob/af8b138c1a4362bd3c9892ceefec8e4ca2128f58/p2p/discover/table.go#L324\r\n\r\nThe nursery is essentially the bootnodes. So these nodes are added to the table and then that allows the table to start looking for peers, which is likely the traffic you're seeing.\r\n\r\nI'm not sure the proper way to resolve this. Maybe the most straightforward thing to do is to have `netrestrict` check the seed nodes before they're added to the table in the first place.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1629893095/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
