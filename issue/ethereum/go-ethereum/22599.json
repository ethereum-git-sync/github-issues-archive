{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22599",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22599/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22599/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22599/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/22599",
  "id": 843789437,
  "node_id": "MDU6SXNzdWU4NDM3ODk0Mzc=",
  "number": 22599,
  "title": "Sometimes there are very high values for the gas estimation",
  "user": {
    "login": "hhio618",
    "id": 1272158,
    "node_id": "MDQ6VXNlcjEyNzIxNTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1272158?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hhio618",
    "html_url": "https://github.com/hhio618",
    "followers_url": "https://api.github.com/users/hhio618/followers",
    "following_url": "https://api.github.com/users/hhio618/following{/other_user}",
    "gists_url": "https://api.github.com/users/hhio618/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hhio618/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hhio618/subscriptions",
    "organizations_url": "https://api.github.com/users/hhio618/orgs",
    "repos_url": "https://api.github.com/users/hhio618/repos",
    "events_url": "https://api.github.com/users/hhio618/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hhio618/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-03-29T20:40:45Z",
  "updated_at": "2021-05-20T18:35:01Z",
  "closed_at": "2021-04-08T07:37:04Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `1.10.1-stable`\r\nOS & Version: GNU/Linux\r\nCommit hash : `c2d2f4ed8f232bb11663a1b01a2e578aa22f24bd`\r\n\r\nThere are some very high values for the gas estimations like in this [tx](https://rinkeby.etherscan.io/tx/0x159c81254f744bbb24c1ee933593e35ac3b73dfef7d03e7807e5ffa5bdf91645).\r\n\r\nHere are some transactions that call the same contract method and almost had similar gas estimations (including transactions with very high values)\r\n````\r\ngo-ethereum:base.go: gasLimit: 2489154, txHash: 0xe4aa2ce86e9bb63fe669e6112be86b424993f1839c2931543020eb03ec37c0bd\r\ngo-ethereum:base.go: gasLimit: 2477575, txHash: 0xfd51491a4bdcbc1e6107d454a477aa4d335107c9a5cb7538e978a0c4a84a22b2\r\ngo-ethereum:base.go: gasLimit: 2483365, txHash: 0x02e6b16b3a6b332beeac669b5fe38e3bd349f68c49c0918673601cc3470adc3d\r\ngo-ethereum:base.go: gasLimit: 2483365, txHash: 0x6dbe7c2806c590414818a11c619c5186f95f4819c376899ac76950738402260a\r\ngo-ethereum:base.go: gasLimit: 2477563, txHash: 0xa5c79ac3e3f1fe9102f19498b3a8f13b07ea383c5f07e97a1c63b32b975dd3e0\r\ngo-ethereum:base.go: gasLimit: 2503210, txHash: 0xb7466744e554b835c88df9811f2fc69246a9132961e1fe32d726ef51d246ad2b\r\ngo-ethereum:base.go: gasLimit: 2485143, txHash: 0xf827b615abef52352bee2a2e9efa8f6bda952c8edf3995f370fac2414e1a6445\r\ngo-ethereum:base.go: gasLimit: 2483389, txHash: 0xe7abfec04d72c1bce8e1394e198e4785eaaa4b844343a024c4ecd429af0ffbf0\r\ngo-ethereum:base.go: gasLimit: 2483413, txHash: 0xda77be60c8aec20e9db1e3a8c7161214618503d5228404e8f2886da4641e0b3a\r\ngo-ethereum:base.go: gasLimit: 2477611, txHash: 0x8653a595dabad87959eb269ee986e25478684eea6367901c31d4619f1435a996\r\ngo-ethereum:base.go: gasLimit: 2483413, txHash: 0x1f6c62c27962374c2e20ab1a026610bad0e923fca9888f1ea096062f1a779163\r\ngo-ethereum:base.go: gasLimit: 2509428, txHash: 0x0d1b971b2ba063316be493d402312cc3fd7df4cd529296c0ae103e85cd2fbac5\r\ngo-ethereum:base.go: gasLimit: 2477623, txHash: 0x552d9c3d231d4dbf6c637cd64b52a21cf48ac478994b03c474ebdb6fa4b53cd3\r\ngo-ethereum:base.go: gasLimit: 2487849, txHash: 0x0919d3b18f69ecc4f9b49549387cef8aacc56a02fdb25e4729281722a2ad4a8e\r\ngo-ethereum:base.go: gasLimit: 2477611, txHash: 0x1a672df5b0599f6b283b9286c4612e28b22877ea9f49e0c472e852806cb22579\r\ngo-ethereum:base.go: gasLimit: 2483413, txHash: 0xba82753a595611cef05280c58fae1787622e4df102aaaef5c4a3a6c800efb5b3\r\ngo-ethereum:base.go: gasLimit: 2483413, txHash: 0x6049500d5250896d402a5335aca09fbc65572e00f5514a2df9adb9bd7bffe8c5\r\ngo-ethereum:base.go: gasLimit: 2483413, txHash: 0xb5111949eae93c2a52b8d5da8c51b009699e85e32b8027fdbd977d8eb36a7ff8\r\ngo-ethereum:base.go: gasLimit: 9367159, txHash: 0x159c81254f744bbb24c1ee933593e35ac3b73dfef7d03e7807e5ffa5bdf91645 \r\ngo-ethereum:base.go: gasLimit: 2491157, txHash: 0x1db1b25f8795fefdedd0718d4b43e63fb8b07d7261c653e3e92e7f0c850932d2\r\ngo-ethereum:base.go: gasLimit: 2479578, txHash: 0x1a7488e6cbe81ec1f2ec77aaa74d9560e492120a17800fc7cd701d40cc457fb4\r\ngo-ethereum:base.go: gasLimit: 9834467, txHash: 0xb8989ce9840b7180ed440f3d1a7715988de39a1d528f634e86d5ce9a2c7497cb\r\ngo-ethereum:base.go: gasLimit: 2528200, txHash: 0xfba29f98bfbed89aabd6056e647f3916b7568779ecdfbc8a49494b27b50b4037\r\ngo-ethereum:base.go: gasLimit: 2517798, txHash: 0x38a2f07fb9346f875a4686d45f9df2013f33d77f121f38040b04b2a71435ef25\r\ngo-ethereum:base.go: gasLimit: 2494729, txHash: 0xa1abeeb404345b42e7fd7d7a2116fe3fda870603156ddd9a6062619bfa9ce668\r\ngo-ethereum:base.go: gasLimit: 2477623, txHash: 0x3c1e19a4aa9c722efc7d971e18c0d6a428c492fdb776796271da8cb5c9f5f5ac\r\ngo-ethereum:base.go: gasLimit: 2483413, txHash: 0xc39b2ed7afff967f795b6a77048c0b7207e174bf0ddbb8f10f4cd070b5953a7b\r\ngo-ethereum:base.go: gasLimit: 2489202, txHash: 0x3326d805f0f6a28e209530a77afd9e19771533e7d31b2fc8842ca3872e8bb673\r\ngo-ethereum:base.go: gasLimit: 2483990, txHash: 0xabf45615476abaab0e14523fa186893b9f435265c2f252d6bdb8fd0b0d244aae\r\ngo-ethereum:base.go: gasLimit: 2511833, txHash: 0x94376af79feee299a6f2e2be103a221a3eeab3c8a0ac112fa3115050f0d7cd74\r\ngo-ethereum:base.go: gasLimit: 2504690, txHash: 0x334996fed853ae992668b7260d3bc4da9ddbe7453932c83ae8bf3717902291c2\r\ngo-ethereum:base.go: gasLimit: 2489792, txHash: 0x0b0bbcca8832a26dfd07cbce621d4bd127e6388dc8c0ca23f0118c388692a803\r\ngo-ethereum:base.go: gasLimit: 2486496, txHash: 0x26771f06fd92a08a04920c48241c5ecf7acb8290f49236017ccbbfe120751e1b\r\ngo-ethereum:base.go: gasLimit: 2479566, txHash: 0xc10f3dc23c729772a7f14d01914df13357b6b403e90829dedb45ea5a716caa18\r\ngo-ethereum:base.go: gasLimit: 2483413, txHash: 0xce62efd59ae483cb2d28048aee57daf518d0ce94868b9ac2ad437c4bd04e1904\r\n````\r\ncc @krasi-georgiev",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22599/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22599/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/809848952",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22599#issuecomment-809848952",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22599",
    "id": 809848952,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwOTg0ODk1Mg==",
    "user": {
      "login": "krasi-georgiev",
      "id": 8903888,
      "node_id": "MDQ6VXNlcjg5MDM4ODg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8903888?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/krasi-georgiev",
      "html_url": "https://github.com/krasi-georgiev",
      "followers_url": "https://api.github.com/users/krasi-georgiev/followers",
      "following_url": "https://api.github.com/users/krasi-georgiev/following{/other_user}",
      "gists_url": "https://api.github.com/users/krasi-georgiev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/krasi-georgiev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krasi-georgiev/subscriptions",
      "organizations_url": "https://api.github.com/users/krasi-georgiev/orgs",
      "repos_url": "https://api.github.com/users/krasi-georgiev/repos",
      "events_url": "https://api.github.com/users/krasi-georgiev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/krasi-georgiev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-30T02:04:48Z",
    "updated_at": "2021-03-30T02:04:48Z",
    "author_association": "NONE",
    "body": "Just to clarify this a log directly from the EstimateGase in the base.go file",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/809848952/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/815528508",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22599#issuecomment-815528508",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22599",
    "id": 815528508,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNTUyODUwOA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-08T07:37:03Z",
    "updated_at": "2021-04-08T07:37:03Z",
    "author_association": "MEMBER",
    "body": "See https://rinkeby.etherscan.io/tx/0x159c81254f744bbb24c1ee933593e35ac3b73dfef7d03e7807e5ffa5bdf91645#statechange\r\n\r\n![Screenshot_2021-04-08 Rinkeby Transaction Hash (Txhash) Details Etherscan](https://user-images.githubusercontent.com/142290/113986680-cb8f4500-984d-11eb-9c13-96de9e981119.png)\r\nThere are a lot of slots being set to non-zero, and a lot of slots being set to zero. That adds up to a large high-water mark gas usage, and, due to the slots set zero, a lot of refund. The refund is given back after execution, so the total end gas usage is a lot lower than what was needed during execution.  ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/815528508/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/815606512",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22599#issuecomment-815606512",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22599",
    "id": 815606512,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNTYwNjUxMg==",
    "user": {
      "login": "krasi-georgiev",
      "id": 8903888,
      "node_id": "MDQ6VXNlcjg5MDM4ODg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8903888?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/krasi-georgiev",
      "html_url": "https://github.com/krasi-georgiev",
      "followers_url": "https://api.github.com/users/krasi-georgiev/followers",
      "following_url": "https://api.github.com/users/krasi-georgiev/following{/other_user}",
      "gists_url": "https://api.github.com/users/krasi-georgiev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/krasi-georgiev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krasi-georgiev/subscriptions",
      "organizations_url": "https://api.github.com/users/krasi-georgiev/orgs",
      "repos_url": "https://api.github.com/users/krasi-georgiev/repos",
      "events_url": "https://api.github.com/users/krasi-georgiev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/krasi-georgiev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-08T09:27:20Z",
    "updated_at": "2021-04-08T10:04:03Z",
    "author_association": "NONE",
    "body": "I  think that the culprit here is different, look at another identical  transaction and the estimation there is 1.6mil\r\n\r\nhttps://rinkeby.etherscan.io/tx/0xd74181d32834173a504e1e349ec0ae6b6a9e55d1040751275fd1918166d41649\r\n\r\nBoth TXs set exactly 41 slots to zero so the gas estimation should be the same but in one case it is 1.6mil and in the other 9,3mil \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/815606512/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/845367765",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22599#issuecomment-845367765",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22599",
    "id": 845367765,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NTM2Nzc2NQ==",
    "user": {
      "login": "krasi-georgiev",
      "id": 8903888,
      "node_id": "MDQ6VXNlcjg5MDM4ODg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8903888?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/krasi-georgiev",
      "html_url": "https://github.com/krasi-georgiev",
      "followers_url": "https://api.github.com/users/krasi-georgiev/followers",
      "following_url": "https://api.github.com/users/krasi-georgiev/following{/other_user}",
      "gists_url": "https://api.github.com/users/krasi-georgiev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/krasi-georgiev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/krasi-georgiev/subscriptions",
      "organizations_url": "https://api.github.com/users/krasi-georgiev/orgs",
      "repos_url": "https://api.github.com/users/krasi-georgiev/repos",
      "events_url": "https://api.github.com/users/krasi-georgiev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/krasi-georgiev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-20T18:35:01Z",
    "updated_at": "2021-05-20T18:35:01Z",
    "author_association": "NONE",
    "body": "@holiman would you mind reopening this one as I believe that the estimation is not behaving as expected",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/845367765/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
