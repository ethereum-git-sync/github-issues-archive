{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23445",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23445/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23445/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23445/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23445",
  "id": 977690734,
  "node_id": "MDU6SXNzdWU5Nzc2OTA3MzQ=",
  "number": 23445,
  "title": "The app stop syncing and cannot recover by relaunch.",
  "user": {
    "login": "leon-prestolabs",
    "id": 35245505,
    "node_id": "MDQ6VXNlcjM1MjQ1NTA1",
    "avatar_url": "https://avatars.githubusercontent.com/u/35245505?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/leon-prestolabs",
    "html_url": "https://github.com/leon-prestolabs",
    "followers_url": "https://api.github.com/users/leon-prestolabs/followers",
    "following_url": "https://api.github.com/users/leon-prestolabs/following{/other_user}",
    "gists_url": "https://api.github.com/users/leon-prestolabs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/leon-prestolabs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leon-prestolabs/subscriptions",
    "organizations_url": "https://api.github.com/users/leon-prestolabs/orgs",
    "repos_url": "https://api.github.com/users/leon-prestolabs/repos",
    "events_url": "https://api.github.com/users/leon-prestolabs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/leon-prestolabs/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-08-24T04:27:09Z",
  "updated_at": "2021-08-26T08:02:43Z",
  "closed_at": "2021-08-26T08:02:43Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `release Geth v1.10.7`\r\nOS & Version: Amazon Linux 2.0 (2017.12) LTS Release Candidate\r\nCommit hash : 12f0ff40b1bfb484cafc3be6e0040262e96743bd\r\n\r\n#### Expected behaviour\r\nI created a fresh AWS instance and run geth client. I synced with snap mode. After the syncing is done, I was able to interact smart contracts by web3 app.\r\nOf course I expect the application to run stably for long. At least, if it crashed or break or something, I expect I can relaunch and recover very soon.\r\n\r\n#### Actual behaviour\r\nBut after run for about 3 days, the geth stop syncing, sometimes it kept dropping peers and sometimes it just quit.\r\nThis issue has been happening many times to me in the last 3 weeks. So I try these:\r\n1. Relaunch the geth, but the app will stuck from the beginning and do nothing.\r\n2. After research on the internet, I try re-sync. Re-sync cannot work by removedb partially. I have to run removedb to purge all sync history (including ancient db data) and after that re-sync from the scratch. It started to run successfully.\r\n3. But after a few days, around 3 days typically (the longest time I got is no more than 1 week). I see the stop syncing issue again. And I have to removedb for all and re-sync again.\r\n4. So I try upgrade software, and now I am on the latest stable release of Geth v1.10.7. Not working, still keep happening.\r\n5. I want to exclude any hardware or environment issue. So I create another new AWS machine and install same version of geth and run. And I see the same issue on the new machine as well. And the two machines did not encounter this issue at the same time. When 1 machine stop syncing, the other one is still working. But after I re-sync the broken one, the previous working one will break afterwards.\r\n\r\n#### Steps to reproduce the behaviour\r\n1. create a AWS machine\r\n2. download geth from github and make.\r\n3. run with this command\r\nbuild/bin/geth --mainnet --syncmode \"snap\" --http --http.port 8545 --http.addr 0.0.0.0 --signer=/home/ec2-user/.clef/clef.ipc --http.api eth,net,web3\r\n\r\n#### Backtrace\r\n\r\nWARN [08-23|16:31:57.660] Synchronisation failed, retrying         err=\"peer is unknown or unhealthy\"\r\nWARN [08-23|16:31:57.660] Synchronisation failed, retrying         err=\"peer is unknown or unhealthy\"\r\nWARN [08-23|16:32:37.554] Ancestor below allowance                 peer=59b61b14 number=12,988,910 hash=000000..000000 allowance=12,988,910\r\nWARN [08-23|16:32:37.554] Synchronisation failed, dropping peer    peer=59b61b14b5acaf3cba50dceaa8dc17e650dfb36f27ab2e582ad798856b457082 err=\"retrieved ancestor is invalid\"\r\nWARN [08-23|16:32:43.554] Synchronisation failed, dropping peer    peer=59b61b14b5acaf3cba50dceaa8dc17e650dfb36f27ab2e582ad798856b457082 err=timeout\r\nERROR[08-23|16:32:48.961] Block body missing, can't freeze         number=12,988,830 hash=79362d..684dd6\r\nINFO [08-23|16:32:48.961] Deep froze chain segment                 blocks=0     elapsed=\"165.866µs\"  number=12,988,829\r\nWARN [08-23|16:33:19.251] Synchronisation failed, dropping peer    peer=541c8345e169a0fee877e8d1e3b359ecdc25ad5821bd41c283b1af23827d0a97 err=timeout\r\nWARN [08-23|16:33:19.251] Synchronisation failed, retrying         err=\"peer is unknown or unhealthy\"\r\nWARN [08-23|16:33:19.251] Synchronisation failed, retrying         err=\"peer is unknown or unhealthy\"\r\nWARN [08-23|16:33:32.600] Ancestor below allowance                 peer=d00dd05a number=12,988,910 hash=000000..000000 allowance=12,988,910\r\nWARN [08-23|16:33:32.600] Synchronisation failed, dropping peer    peer=d00dd05a891f359d304e054b9a00d825e2267fcb349600d41d59c72d26d43549 err=\"retrieved ancestor is invalid\"\r\nWARN [08-23|16:33:32.601] Synchronisation failed, retrying         err=\"peer is unknown or unhealthy\"\r\nWARN [08-23|16:33:32.601] Synchronisation failed, retrying         err=\"peer is unknown or unhealthy\"\r\nWARN [08-23|16:33:32.601] Synchronisation failed, retrying         err=\"peer is unknown or unhealthy\"\r\nERROR[08-23|16:33:48.961] Block body missing, can't freeze         number=12,988,830 hash=79362d..684dd6\r\nINFO [08-23|16:33:48.961] Deep froze chain segment                 blocks=0     elapsed=\"209.117µs\"  number=12,988,829\r\nWARN [08-23|16:34:32.365] Synchronisation failed, dropping peer    peer=5dc97e21fe6171baae40f46c17e04af484a0b7aadb66d80b9fbacc8a5b74871a err=timeout\r\nWARN [08-23|16:34:32.365] Synchronisation failed, retrying         err=\"peer is unknown or unhealthy\"\r\nWARN [08-23|16:34:32.365] Synchronisation failed, retrying         err=\"peer is unknown or unhealthy\"\r\nWARN [08-23|16:34:32.366] Synchronisation failed, retrying         err=\"peer is unknown or unhealthy\"\r\nERROR[08-23|16:34:48.962] Block body missing, can't freeze         number=12,988,830 hash=79362d..684dd6\r\nINFO [08-23|16:34:48.962] Deep froze chain segment                 blocks=0     elapsed=\"190.673µs\"  number=12,988,829\r\nWARN [08-23|16:35:34.650] Ancestor below allowance                 peer=566b9ccf number=12,988,910 hash=000000..000000 allowance=12,988,910\r\nWARN [08-23|16:35:34.651] Synchronisation failed, dropping peer    peer=566b9ccfd9768eb4e2b6179bb8e3c4e4fe38a8003cb0a451820ae7acef8290fd err=\"retrieved ancestor is invalid\"\r\nWARN [08-23|16:35:34.651] Synchronisation failed, retrying         err=\"peer is unknown or unhealthy\"\r\nWARN [08-23|16:35:34.651] Synchronisation failed, retrying         err=\"peer is unknown or unhealthy\"\r\nERROR[08-23|16:35:48.962] Block body missing, can't freeze         number=12,988,830 hash=79362d..684dd6\r\nINFO [08-23|16:35:48.962] Deep froze chain segment                 blocks=0     elapsed=\"190.042µs\"  number=12,988,829\r\nERROR[08-23|16:36:48.962] Block body missing, can't freeze         number=12,988,830 hash=79362d..684dd6\r\nINFO [08-23|16:36:48.963] Deep froze chain segment                 blocks=0     elapsed=\"199.65µs\"   number=12,988,829\r\nWARN [08-23|16:37:04.457] Synchronisation failed, dropping peer    peer=62525e3ad63bc192b2f8ca20013b0d35d36342dfd4fe0cabee90c1d10551a3e5 err=timeout\r\nWARN [08-23|16:37:04.457] Synchronisation failed, retrying         err=\"peer is unknown or unhealthy\"\r\nERROR[08-23|16:37:48.963] Block body missing, can't freeze         number=12,988,830 hash=79362d..684dd6\r\nINFO [08-23|16:37:48.963] Deep froze chain segment                 blocks=0     elapsed=\"177.856µs\"  number=12,988,829\r\nERROR[08-23|16:38:48.963] Block body missing, can't freeze         number=12,988,830 hash=79362d..684dd6\r\nINFO [08-23|16:38:48.963] Deep froze chain segment                 blocks=0     elapsed=\"180.284µs\"  number=12,988,829\r\nWARN [08-23|16:39:35.022] Synchronisation failed, dropping peer    peer=d549bed3868e592fcc03516130adb479d26538d8d5d720c5b4bf2ce283b6ab3b err=timeout\r\nWARN [08-23|16:39:35.022] Synchronisation failed, retrying         err=\"peer is unknown or unhealthy\"\r\nERROR[08-23|16:39:48.964] Block body missing, can't freeze         number=12,988,830 hash=79362d..684dd6\r\nINFO [08-23|16:39:48.964] Deep froze chain segment                 blocks=0     elapsed=\"201.611µs\"  number=12,988,829\r\nINFO [08-23|16:40:43.164] Downloader queue stats                   receiptTasks=0     blockTasks=239   itemSize=84.17KiB  throttle=3115\r\nINFO [08-23|16:40:46.239] Sidechain written to disk                start=13,014,851 end=13,014,852 sidetd=28,875,389,264,772,925,316,788 localtd=29,379,675,825,056,567,817,913\r\nERROR[08-23|16:40:48.965] Block body missing, can't freeze         number=12,988,830 hash=79362d..684dd6\r\nINFO [08-23|16:40:48.965] Deep froze chain segment                 blocks=0     elapsed=\"270.521µs\"  number=12,988,829\r\nINFO [08-23|16:40:54.114] Sidechain written to disk                start=13,014,853 end=13,016,636 sidetd=28,888,974,146,146,705,485,427 localtd=29,379,675,825,056,567,817,913\r\nINFO [08-23|16:41:02.059] Sidechain written to disk                start=13,016,637 end=13,018,443 sidetd=28,903,103,283,443,349,018,472 localtd=29,379,675,825,056,567,817,913\r\nINFO [08-23|16:41:05.874] Generating ethash verification cache     epoch=434 percentage=48 elapsed=3.022s\r\nWARN [08-23|16:41:06.302] Pivot seemingly stale, moving            old=13,043,684 new=13,043,748\r\nINFO [08-23|16:41:08.832] Generated ethash verification cache      epoch=434 elapsed=5.980s\r\nINFO [08-23|16:41:10.160] Sidechain written to disk                start=13,018,444 end=13,020,491 sidetd=28,919,344,776,655,050,011,093 localtd=29,379,675,825,056,567,817,913\r\nCRIT [08-23|16:41:16.389] Failed to write block into disk          err=\"open /home/ec2-user/.ethereum/geth/chaindata/682571.sst: no such file or directory\"\r\n",
  "closed_by": {
    "login": "rjl493456442",
    "id": 5959481,
    "node_id": "MDQ6VXNlcjU5NTk0ODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rjl493456442",
    "html_url": "https://github.com/rjl493456442",
    "followers_url": "https://api.github.com/users/rjl493456442/followers",
    "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
    "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
    "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
    "repos_url": "https://api.github.com/users/rjl493456442/repos",
    "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23445/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23445/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/904316542",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23445#issuecomment-904316542",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23445",
    "id": 904316542,
    "node_id": "IC_kwDOAOvK98415sZ-",
    "user": {
      "login": "leon-prestolabs",
      "id": 35245505,
      "node_id": "MDQ6VXNlcjM1MjQ1NTA1",
      "avatar_url": "https://avatars.githubusercontent.com/u/35245505?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/leon-prestolabs",
      "html_url": "https://github.com/leon-prestolabs",
      "followers_url": "https://api.github.com/users/leon-prestolabs/followers",
      "following_url": "https://api.github.com/users/leon-prestolabs/following{/other_user}",
      "gists_url": "https://api.github.com/users/leon-prestolabs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/leon-prestolabs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leon-prestolabs/subscriptions",
      "organizations_url": "https://api.github.com/users/leon-prestolabs/orgs",
      "repos_url": "https://api.github.com/users/leon-prestolabs/repos",
      "events_url": "https://api.github.com/users/leon-prestolabs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/leon-prestolabs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-24T04:37:31Z",
    "updated_at": "2021-08-24T04:37:31Z",
    "author_association": "NONE",
    "body": "Hi, this issue is very annoying and the critical part is, I am not able to workaround by the method of detecting and relaunch.\r\nIf I Immediate relaunch after the issue happened, it got stuck. See the log below:\r\nINFO [08-24|04:29:30.485] Starting Geth on Ethereum mainnet... \r\nINFO [08-24|04:29:30.485] Bumping default cache on mainnet         provided=1024 updated=4096\r\nINFO [08-24|04:29:30.487] Maximum peer count                       ETH=50 LES=0 total=50\r\nINFO [08-24|04:29:30.488] Smartcard socket not found, disabling    err=\"stat /run/pcscd/pcscd.comm: no such file or directory\"\r\nINFO [08-24|04:29:30.488] Using external signer                    url=/home/ec2-user/.clef/clef.ipc\r\nINFO [08-24|04:29:30.507] Set global gas cap                       cap=50,000,000\r\nINFO [08-24|04:29:30.519] Allocated trie memory caches             clean=614.00MiB dirty=1024.00MiB\r\nINFO [08-24|04:29:30.519] Allocated cache and file handles         database=/home/ec2-user/.ethereum/geth/chaindata cache=2.00GiB handles=4098\r\n\r\nAnd nothing after this.\r\n\r\nSo 2 more questions:\r\n1. Is there a way to save the historical chain data from time to time and help to make the relaunch working immediately?\r\nRight now, every time this issue happened, I always have to removedb for all and re-sync. It will take like 10 hours or something. Really not possible for a production solution.\r\n2. Is there any stable version I should try which is proven to be good? I see the public service like infura. How do they provide public eth node interface without having this kind of stable issue? Are they running GETH as well or other app?\r\n\r\nThanks in advance for any answer or help!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/904316542/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/904382703",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23445#issuecomment-904382703",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23445",
    "id": 904382703,
    "node_id": "IC_kwDOAOvK984158jv",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-24T07:11:21Z",
    "updated_at": "2021-08-24T07:11:21Z",
    "author_association": "MEMBER",
    "body": "Looks like your database is fired `CRIT [08-23|16:41:16.389] Failed to write block into disk err=\"open /home/ec2-user/.ethereum/geth/chaindata/682571.sst: no such file or directory\"`. Is it manually deleted? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/904382703/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/904398320",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23445#issuecomment-904398320",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23445",
    "id": 904398320,
    "node_id": "IC_kwDOAOvK98416AXw",
    "user": {
      "login": "leon-prestolabs",
      "id": 35245505,
      "node_id": "MDQ6VXNlcjM1MjQ1NTA1",
      "avatar_url": "https://avatars.githubusercontent.com/u/35245505?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/leon-prestolabs",
      "html_url": "https://github.com/leon-prestolabs",
      "followers_url": "https://api.github.com/users/leon-prestolabs/followers",
      "following_url": "https://api.github.com/users/leon-prestolabs/following{/other_user}",
      "gists_url": "https://api.github.com/users/leon-prestolabs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/leon-prestolabs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leon-prestolabs/subscriptions",
      "organizations_url": "https://api.github.com/users/leon-prestolabs/orgs",
      "repos_url": "https://api.github.com/users/leon-prestolabs/repos",
      "events_url": "https://api.github.com/users/leon-prestolabs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/leon-prestolabs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-24T07:35:25Z",
    "updated_at": "2021-08-24T07:35:25Z",
    "author_association": "NONE",
    "body": "@rjl493456442 Thanks for the reply!\r\nI check the machine, there is a tmpwatch rule which clean old data. Lol so stupid..\r\nLet me clean up the rule and watch for a few days and report if this is the root cause!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/904398320/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/906185143",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23445#issuecomment-906185143",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23445",
    "id": 906185143,
    "node_id": "IC_kwDOAOvK9842A0m3",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-26T08:02:43Z",
    "updated_at": "2021-08-26T08:02:43Z",
    "author_association": "MEMBER",
    "body": "Close it now, feel free to reopen if it's not resolved.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/906185143/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
