{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2925",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2925/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2925/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2925/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/2925",
  "id": 172289236,
  "node_id": "MDU6SXNzdWUxNzIyODkyMzY=",
  "number": 2925,
  "title": "Lost peer connections after 1 month",
  "user": {
    "login": "Firescar96",
    "id": 5351374,
    "node_id": "MDQ6VXNlcjUzNTEzNzQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5351374?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Firescar96",
    "html_url": "https://github.com/Firescar96",
    "followers_url": "https://api.github.com/users/Firescar96/followers",
    "following_url": "https://api.github.com/users/Firescar96/following{/other_user}",
    "gists_url": "https://api.github.com/users/Firescar96/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Firescar96/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Firescar96/subscriptions",
    "organizations_url": "https://api.github.com/users/Firescar96/orgs",
    "repos_url": "https://api.github.com/users/Firescar96/repos",
    "events_url": "https://api.github.com/users/Firescar96/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Firescar96/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2016-08-20T20:28:01Z",
  "updated_at": "2016-08-29T19:19:02Z",
  "closed_at": "2016-08-29T19:19:02Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\n\nGeth version: `1.4.10` and `1.4.11`\nOS & Version: geth docker running on coreos on a vm in azure\n`docker run --rm --net host -ti <username>/geth:1.4.11`\n#### Expected behaviour\n\nGeth uses the bootstrap nodes to find and maintain connections to peers on a variety of ports. It reaches `--maxpeers=25` within a couple minutes and stays there.\n#### Actual behaviour\n\nGeth quickly gets 1-3 peers on startup, and over the course of at least an hour slowly makes it's way to 13 peers. Then within a month (but sometimes as little as a couple days) the peer count drops to 0 and geth has to be restarted to resync. The exact peers in the list after restart differs, but there is never more than 13 and they are almost exclusively on remote port 30303.\n#### Steps to reproduce the behaviour\n\nThis may not actually be an issue, my setup on azure (details to follow) may be incompatible with the indended behaviour of geth. If it is an issue, then it's not just a bug in just geth, ipfs/p2p is also using an implementation of Kademlia and appears to have the same trouble. Although, there are differences in how many peers are found, what port they are found on, and how long before they are all lost.\n##### Azure VM setup\n\nThe vm is running on azure without a public ip address. All outbound connections are allowed, so the initial connection into the network works. Additionally, when I give the vm a public IP geth runs just fine and doesn't lose peers over time, but without the public ip it does not. If possible it's preferable to run the node without a public ip to mitigate hacks.\n\nBut I'm not sure if that's any more secure than using a public ip and setting azure to block all inbound connections on ports other than 30303 (which geth is listening on).\n",
  "closed_by": {
    "login": "Firescar96",
    "id": 5351374,
    "node_id": "MDQ6VXNlcjUzNTEzNzQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5351374?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Firescar96",
    "html_url": "https://github.com/Firescar96",
    "followers_url": "https://api.github.com/users/Firescar96/followers",
    "following_url": "https://api.github.com/users/Firescar96/following{/other_user}",
    "gists_url": "https://api.github.com/users/Firescar96/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Firescar96/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Firescar96/subscriptions",
    "organizations_url": "https://api.github.com/users/Firescar96/orgs",
    "repos_url": "https://api.github.com/users/Firescar96/repos",
    "events_url": "https://api.github.com/users/Firescar96/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Firescar96/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2925/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2925/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/241249571",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2925#issuecomment-241249571",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2925",
    "id": 241249571,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTI0OTU3MQ==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-21T10:21:08Z",
    "updated_at": "2016-08-21T10:21:08Z",
    "author_association": "MEMBER",
    "body": "> but there is never more than 13\n\nThis is because the max number of peers is split equally into 'accepted' and 'dialed' connections. Since nobody can connect to you, you won't get any more connections.\n\n> Then within a month (but sometimes as little as a couple days) the peer count drops to 0\n\nThis sounds like a real issue.\n\nPlease be aware that UDP connectivity needs to work, did you open UDP as well?\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/241249571/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/241270405",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2925#issuecomment-241270405",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2925",
    "id": 241270405,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTI3MDQwNQ==",
    "user": {
      "login": "Firescar96",
      "id": 5351374,
      "node_id": "MDQ6VXNlcjUzNTEzNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5351374?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Firescar96",
      "html_url": "https://github.com/Firescar96",
      "followers_url": "https://api.github.com/users/Firescar96/followers",
      "following_url": "https://api.github.com/users/Firescar96/following{/other_user}",
      "gists_url": "https://api.github.com/users/Firescar96/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Firescar96/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Firescar96/subscriptions",
      "organizations_url": "https://api.github.com/users/Firescar96/orgs",
      "repos_url": "https://api.github.com/users/Firescar96/repos",
      "events_url": "https://api.github.com/users/Firescar96/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Firescar96/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-21T17:32:28Z",
    "updated_at": "2016-08-21T21:27:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "UDP and TCP are both open in the azure network security group.\n\nDo you have any thoughts to using a public IP and blocking all the other inbound ports?\n\nIs there something special about the first few peer searches that lets it punch through the NAT while not all subsequent searches can?\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/241270405/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/241280317",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2925#issuecomment-241280317",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2925",
    "id": 241280317,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTI4MDMxNw==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-21T20:34:25Z",
    "updated_at": "2016-08-21T20:34:25Z",
    "author_association": "MEMBER",
    "body": "I don't think there is anything special about the initial search. I'll have to think about this a bit.\n\n> Do you have any thoughts to using a public IP and blocking all the other inbound ports?\n\nI would recommend using a public IP.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/241280317/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/241334504",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2925#issuecomment-241334504",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2925",
    "id": 241334504,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTMzNDUwNA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-22T07:32:15Z",
    "updated_at": "2016-08-22T07:32:15Z",
    "author_association": "MEMBER",
    "body": "1.4.11 does include quite a few sync fixes which could affect peer anomalies. You be nice if you could do a `debug.vmodule(\"downloader=6\")` the next time when you drop to zero and wait a bit for logs. I'm really curious what might be causing this but I've no way to repro them.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/241334504/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/241859256",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2925#issuecomment-241859256",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2925",
    "id": 241859256,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MTg1OTI1Ng==",
    "user": {
      "login": "Firescar96",
      "id": 5351374,
      "node_id": "MDQ6VXNlcjUzNTEzNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5351374?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Firescar96",
      "html_url": "https://github.com/Firescar96",
      "followers_url": "https://api.github.com/users/Firescar96/followers",
      "following_url": "https://api.github.com/users/Firescar96/following{/other_user}",
      "gists_url": "https://api.github.com/users/Firescar96/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Firescar96/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Firescar96/subscriptions",
      "organizations_url": "https://api.github.com/users/Firescar96/orgs",
      "repos_url": "https://api.github.com/users/Firescar96/repos",
      "events_url": "https://api.github.com/users/Firescar96/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Firescar96/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-23T20:05:51Z",
    "updated_at": "2016-08-23T20:05:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "Geth 1.4.10 was pretty bad. I thought I tried geth 1.4.11 earlier, but didn't update properly. We are now running 1.4.11 with a public IP and trialing a few 1.4.11 instances behind a NAT. I'll let you know how it goes in a month.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/241859256/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/243226338",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2925#issuecomment-243226338",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2925",
    "id": 243226338,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI0MzIyNjMzOA==",
    "user": {
      "login": "Firescar96",
      "id": 5351374,
      "node_id": "MDQ6VXNlcjUzNTEzNzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5351374?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Firescar96",
      "html_url": "https://github.com/Firescar96",
      "followers_url": "https://api.github.com/users/Firescar96/followers",
      "following_url": "https://api.github.com/users/Firescar96/following{/other_user}",
      "gists_url": "https://api.github.com/users/Firescar96/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Firescar96/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Firescar96/subscriptions",
      "organizations_url": "https://api.github.com/users/Firescar96/orgs",
      "repos_url": "https://api.github.com/users/Firescar96/repos",
      "events_url": "https://api.github.com/users/Firescar96/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Firescar96/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-08-29T19:19:02Z",
    "updated_at": "2016-08-29T19:19:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "The nodes are stable, gethv1.4.11 fixed the problem.Thanks.\nCC @hermanjunge\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/243226338/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
