{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16557",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16557/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16557/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16557/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/16557",
  "id": 317335962,
  "node_id": "MDU6SXNzdWUzMTczMzU5NjI=",
  "number": 16557,
  "title": "Possible memory leak in 1.8.6",
  "user": {
    "login": "kingjerod",
    "id": 2287252,
    "node_id": "MDQ6VXNlcjIyODcyNTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2287252?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kingjerod",
    "html_url": "https://github.com/kingjerod",
    "followers_url": "https://api.github.com/users/kingjerod/followers",
    "following_url": "https://api.github.com/users/kingjerod/following{/other_user}",
    "gists_url": "https://api.github.com/users/kingjerod/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kingjerod/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kingjerod/subscriptions",
    "organizations_url": "https://api.github.com/users/kingjerod/orgs",
    "repos_url": "https://api.github.com/users/kingjerod/repos",
    "events_url": "https://api.github.com/users/kingjerod/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kingjerod/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2018-04-24T18:05:44Z",
  "updated_at": "2018-04-25T19:24:59Z",
  "closed_at": "2018-04-25T19:24:59Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `1.8.6-stable`\r\nOS & Version: Linux (Ubuntu 16.04)\r\nServer: AWS m5.large (2 vCPU 8 gigs of ram, 300 GB SSD)\r\n\r\n#### Expected behaviour\r\nGeth to run for a very long time and not consume 7 gigs of memory\r\n\r\n#### Actual behaviour\r\nAfter running for 3 hours (synced up) memory is maxed out and server is almost unresponsive. For a bit I couldn't even run top because there wasn't enough memory. \r\n\r\n#### Steps to reproduce the behaviour\r\nRun geth on AWS m5.large with this command:\r\n`geth --syncmode fast --ws --wsapi web3,net,rpc,admin,eth --wsport 5000 --wsaddr 0.0.0.0 --wsorigins * --cache 4096 --rpc --rpcaddr 0.0.0.0 --rpcport 5001 --rpcapi web3,net,rpc,admin,eth`\r\n\r\nNo commands were sent to geth during this time, it was just allowed to sync up. This is the only thing running on this server. I have it running in supervisor and have noticed geth is restarted frequently, I think this time I just caught it while memory was maxed out. \r\n\r\nScreenshot of top:\r\n![maxmemory](https://user-images.githubusercontent.com/2287252/39205230-f6dac57e-47ae-11e8-95e7-5a820fc32666.png)\r\n\r\nEdit:\r\nBeen running for 50 minutes now and memory is up to 6 GB. Chain is still fully synced. Last log statements:\r\n```\r\nINFO [04-24|18:49:36] Imported new chain segment               blocks=1  txs=234  mgas=7.981   elapsed=263.386ms mgasps=30.302  number=5498918 hash=b3daa2…14b319 cache=173.56mB\r\nINFO [04-24|18:49:55] Imported new chain segment               blocks=1  txs=161  mgas=8.000   elapsed=989.497ms mgasps=8.085   number=5498919 hash=439249…dc9ff0 cache=173.85mB\r\nINFO [04-24|18:50:00] Imported new chain segment               blocks=1  txs=106  mgas=7.845   elapsed=184.399ms mgasps=42.546  number=5498920 hash=3855a8…a37254 cache=173.49mB\r\nINFO [04-24|18:50:09] Imported new chain segment               blocks=1  txs=141  mgas=7.980   elapsed=567.333ms mgasps=14.067  number=5498921 hash=57f93d…ee08f7 cache=173.61mB\r\nINFO [04-24|18:50:57] Imported new chain segment               blocks=1  txs=190  mgas=7.818   elapsed=522.828ms mgasps=14.954  number=5498922 hash=b6d606…5d3c39 cache=173.66mB\r\n```\r\n\r\n",
  "closed_by": {
    "login": "kingjerod",
    "id": 2287252,
    "node_id": "MDQ6VXNlcjIyODcyNTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2287252?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kingjerod",
    "html_url": "https://github.com/kingjerod",
    "followers_url": "https://api.github.com/users/kingjerod/followers",
    "following_url": "https://api.github.com/users/kingjerod/following{/other_user}",
    "gists_url": "https://api.github.com/users/kingjerod/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kingjerod/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kingjerod/subscriptions",
    "organizations_url": "https://api.github.com/users/kingjerod/orgs",
    "repos_url": "https://api.github.com/users/kingjerod/repos",
    "events_url": "https://api.github.com/users/kingjerod/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kingjerod/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16557/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16557/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/384241221",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16557#issuecomment-384241221",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16557",
    "id": 384241221,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDI0MTIyMQ==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-25T10:32:24Z",
    "updated_at": "2018-04-25T10:32:24Z",
    "author_association": "MEMBER",
    "body": "`--cache 4096` leads to high memory usage. Please reduce your cache amount (maybe use `--cache 512`) and report whether memory usage is more reasonable.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/384241221/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/384241362",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16557#issuecomment-384241362",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16557",
    "id": 384241362,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDI0MTM2Mg==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-25T10:32:59Z",
    "updated_at": "2018-04-25T10:32:59Z",
    "author_association": "MEMBER",
    "body": "Hi there! Go's garbage collector only runs when it accumulated twice as much memory as it left active after the previous run. If you run with a cache of 4GB, you will always have at least 4GB of memory used, since the database allocates it for caches. However, that means Go will start garbage collection when it reaches 8GB-ish. My suggestion is to try running with 1 (default) or 2GB cache allowance for larger servers.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/384241362/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/384405228",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16557#issuecomment-384405228",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16557",
    "id": 384405228,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4NDQwNTIyOA==",
    "user": {
      "login": "kingjerod",
      "id": 2287252,
      "node_id": "MDQ6VXNlcjIyODcyNTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2287252?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kingjerod",
      "html_url": "https://github.com/kingjerod",
      "followers_url": "https://api.github.com/users/kingjerod/followers",
      "following_url": "https://api.github.com/users/kingjerod/following{/other_user}",
      "gists_url": "https://api.github.com/users/kingjerod/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kingjerod/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kingjerod/subscriptions",
      "organizations_url": "https://api.github.com/users/kingjerod/orgs",
      "repos_url": "https://api.github.com/users/kingjerod/repos",
      "events_url": "https://api.github.com/users/kingjerod/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kingjerod/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-25T19:24:59Z",
    "updated_at": "2018-04-25T19:24:59Z",
    "author_association": "NONE",
    "body": "Great, thanks guys! ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/384405228/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
