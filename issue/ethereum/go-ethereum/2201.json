{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2201",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2201/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2201/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2201/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/2201",
  "id": 132943906,
  "node_id": "MDU6SXNzdWUxMzI5NDM5MDY=",
  "number": 2201,
  "title": "Geth runs out of memory when syncing from a local node",
  "user": {
    "login": "jesuscript",
    "id": 1161241,
    "node_id": "MDQ6VXNlcjExNjEyNDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1161241?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jesuscript",
    "html_url": "https://github.com/jesuscript",
    "followers_url": "https://api.github.com/users/jesuscript/followers",
    "following_url": "https://api.github.com/users/jesuscript/following{/other_user}",
    "gists_url": "https://api.github.com/users/jesuscript/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jesuscript/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jesuscript/subscriptions",
    "organizations_url": "https://api.github.com/users/jesuscript/orgs",
    "repos_url": "https://api.github.com/users/jesuscript/repos",
    "events_url": "https://api.github.com/users/jesuscript/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jesuscript/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/milestones/20",
    "html_url": "https://github.com/ethereum/go-ethereum/milestone/20",
    "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/milestones/20/labels",
    "id": 1299388,
    "node_id": "MDk6TWlsZXN0b25lMTI5OTM4OA==",
    "number": 20,
    "title": "1.4.0",
    "description": "",
    "creator": {
      "login": "obscuren",
      "id": 6264126,
      "node_id": "MDQ6VXNlcjYyNjQxMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6264126?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/obscuren",
      "html_url": "https://github.com/obscuren",
      "followers_url": "https://api.github.com/users/obscuren/followers",
      "following_url": "https://api.github.com/users/obscuren/following{/other_user}",
      "gists_url": "https://api.github.com/users/obscuren/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/obscuren/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/obscuren/subscriptions",
      "organizations_url": "https://api.github.com/users/obscuren/orgs",
      "repos_url": "https://api.github.com/users/obscuren/repos",
      "events_url": "https://api.github.com/users/obscuren/events{/privacy}",
      "received_events_url": "https://api.github.com/users/obscuren/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 141,
    "state": "closed",
    "created_at": "2015-09-10T13:53:50Z",
    "updated_at": "2016-08-17T20:07:24Z",
    "due_on": null,
    "closed_at": "2016-05-10T10:44:41Z"
  },
  "comments": 5,
  "created_at": "2016-02-11T11:05:48Z",
  "updated_at": "2016-02-29T14:05:41Z",
  "closed_at": "2016-02-29T14:05:38Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "```\n$ geth version\nGeth\nVersion: 1.4.0-unstable\nProtocol Versions: [63 62 61]\nNetwork Id: 1\nGo Version: go1.5.1\nOS: linux\nGOPATH=\nGOROOT=/usr/lib/go\n```\n\nI have two geth nodes running on the same machine (2 GB Memory, 2CPU, Ubuntu 14.04). One is fully in sync (previously synced from the main net using `--fast` sync), switched to run as \n\n```\ngeth --nodiscover --datadir ~/.ethereum-master --port 30305\n```\n\nThe other node is running as\n\n```\ngeth --datadir /tmp/geth-slave --nodiscover\n```\n\nWith /tmp/geth-slave/static-nodes.json containing one entry pointing at the master node.\n\nWhile the master node is running OK, the second node very quickly starts consuming increasingly more memory \n\n```\nPID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                   \n 9639 root      20   0 1689880 1.118g   4820 S 146.0 57.2   6:24.82 geth                                                      \n 8983 root      20   0  279896  47772   3112 S  48.9  2.3   5:04.48 geth\n```\n\nuntil it crashes\n\n```\nERR: fatal error:\nERR: runtime: out of memory\nERR:\n\nERR:\nruntime stack:\n\nERR: runtime.throw(0xf02c10, 0x16)\n\nERR:    /usr/lib/go/src/runtime/panic.go:527 +0x90\nruntime.sysMap(0xc8847c0000, 0x5400000, 0x0, 0x1700a78)\n        /usr/lib/go/src/runtime/mem_linux.go:143 +0x9b\nruntime.mHeap_SysAlloc(0x16e0ce0, 0x5400000, 0x16d7e40)\n        /usr/lib/go/src/runtime/malloc.go:423 +0x160\nruntime.mHeap_Grow(0x16e0ce0, 0x2a00, 0x0)\n        /usr/lib/go/src/runtime/mheap.go:628 +0x63\n\nERR: runtime.mHeap_AllocSpanLocked(0x16e0ce0, 0x2a00, 0x100)\n        /usr/lib/go/src/runtime/mheap.go:532 +0x5f1\nruntime.mHeap_Alloc_m(0x16e0ce0, 0x2a00, 0x100000000, 0xc800000001)\n        /usr/lib/go/src/runtime/mheap.go:425 +0x1ac\nruntime.mHeap_Alloc.func1()\n```\n",
  "closed_by": {
    "login": "obscuren",
    "id": 6264126,
    "node_id": "MDQ6VXNlcjYyNjQxMjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6264126?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/obscuren",
    "html_url": "https://github.com/obscuren",
    "followers_url": "https://api.github.com/users/obscuren/followers",
    "following_url": "https://api.github.com/users/obscuren/following{/other_user}",
    "gists_url": "https://api.github.com/users/obscuren/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/obscuren/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/obscuren/subscriptions",
    "organizations_url": "https://api.github.com/users/obscuren/orgs",
    "repos_url": "https://api.github.com/users/obscuren/repos",
    "events_url": "https://api.github.com/users/obscuren/events{/privacy}",
    "received_events_url": "https://api.github.com/users/obscuren/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2201/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2201/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/183059292",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2201#issuecomment-183059292",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2201",
    "id": 183059292,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE4MzA1OTI5Mg==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-02-11T21:04:19Z",
    "updated_at": "2016-02-11T21:04:19Z",
    "author_association": "MEMBER",
    "body": "Please create a memory profile using the following steps: \n- run `geth --memprofilerate=100` \n- when mem usage is high (but before it crashes), connect to it using `geth attach`\n- in the JS console, run `debug.writeMemProfile(\"mem.out\")`\n- put the file in a gist\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/183059292/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/183852824",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2201#issuecomment-183852824",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2201",
    "id": 183852824,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE4Mzg1MjgyNA==",
    "user": {
      "login": "chinh7",
      "id": 2062919,
      "node_id": "MDQ6VXNlcjIwNjI5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2062919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chinh7",
      "html_url": "https://github.com/chinh7",
      "followers_url": "https://api.github.com/users/chinh7/followers",
      "following_url": "https://api.github.com/users/chinh7/following{/other_user}",
      "gists_url": "https://api.github.com/users/chinh7/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chinh7/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chinh7/subscriptions",
      "organizations_url": "https://api.github.com/users/chinh7/orgs",
      "repos_url": "https://api.github.com/users/chinh7/repos",
      "events_url": "https://api.github.com/users/chinh7/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chinh7/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-02-14T08:45:49Z",
    "updated_at": "2016-02-14T08:45:55Z",
    "author_association": "NONE",
    "body": "having the same problem. 4GB on a ubuntu 14.04 box doesn't seem to be enough\nhere's the memory profile https://gist.github.com/chinh7/4ab13c5ba445c250b3bb\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/183852824/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/183860869",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2201#issuecomment-183860869",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2201",
    "id": 183860869,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE4Mzg2MDg2OQ==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-02-14T09:28:24Z",
    "updated_at": "2016-02-14T09:28:24Z",
    "author_association": "MEMBER",
    "body": "Thanks for capturing the profile. In order to interpret the data, we also need the geth binary that produced it. If you installed from the 'unstable' PPA it is sufficient to give the package version number. If you built it yourself, you'll need to upload it somewhere.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/183860869/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/183863827",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2201#issuecomment-183863827",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2201",
    "id": 183863827,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE4Mzg2MzgyNw==",
    "user": {
      "login": "chinh7",
      "id": 2062919,
      "node_id": "MDQ6VXNlcjIwNjI5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2062919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chinh7",
      "html_url": "https://github.com/chinh7",
      "followers_url": "https://api.github.com/users/chinh7/followers",
      "following_url": "https://api.github.com/users/chinh7/following{/other_user}",
      "gists_url": "https://api.github.com/users/chinh7/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chinh7/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chinh7/subscriptions",
      "organizations_url": "https://api.github.com/users/chinh7/orgs",
      "repos_url": "https://api.github.com/users/chinh7/repos",
      "events_url": "https://api.github.com/users/chinh7/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chinh7/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-02-14T09:52:55Z",
    "updated_at": "2016-02-14T10:05:57Z",
    "author_association": "NONE",
    "body": "Here's the package info\nii  geth           1.4.0+890SNA amd64        Ethereum CLI client.\nVersion: 1.4.0-unstable\nProtocol Versions: [63 62 61]\nNetwork Id: 1\nGo Version: go1.5.1\nOS: linux\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/183863827/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/184004480",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2201#issuecomment-184004480",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2201",
    "id": 184004480,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE4NDAwNDQ4MA==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-02-14T23:29:26Z",
    "updated_at": "2016-02-14T23:31:59Z",
    "author_association": "MEMBER",
    "body": "I have analysed the profile. The live set known to GC was 530.65MB when the profile was written.\nAbout half of the space is taken up by structs allocated through RLP decoding when parsing eth\nprotocol messages. My guess is that these are mostly blocks and transactions.\n\n``` text\n501.67MB of 530.65MB total (94.54%)\nDropped 1235 nodes (cum <= 2.65MB)\nShowing top 10 nodes out of 114 (cum >= 25.43MB)\n      flat  flat%   sum%        cum   cum%\n  217.81MB 41.05% 41.05%   217.81MB 41.05%  reflect.unsafe_New\n  109.16MB 20.57% 61.62%   109.16MB 20.57%  math/big.nat.make\n   71.92MB 13.55% 75.17%   175.76MB 33.12%  github.com/ethereum/go-ethereum/rlp.decodeBigInt\n   24.40MB  4.60% 79.77%    40.61MB  7.65%  github.com/ethereum/go-ethereum/eth/downloader.(*queue).Schedule\n   16.86MB  3.18% 82.95%    16.86MB  3.18%  github.com/syndtr/goleveldb/leveldb/util.(*BufferPool).Get\n   16.74MB  3.15% 86.10%    21.94MB  4.13%  github.com/ethereum/go-ethereum/core/types.CopyHeader\n   15.93MB  3.00% 89.10%    15.93MB  3.00%  github.com/ethereum/go-ethereum/rlp.(*Stream).Bytes\n   13.24MB  2.49% 91.60%    16.21MB  3.05%  gopkg.in/karalabe/cookiejar.v2/collections/prque.(*Prque).Push\n      12MB  2.26% 93.86%    12.02MB  2.26%  github.com/syndtr/goleveldb/leveldb/memdb.New\n    3.61MB  0.68% 94.54%    25.43MB  4.79%  github.com/ethereum/go-ethereum/core/types.(*Block).WithBody\n```\n\nI'll do a PR attempting to tackle tx retention issues some time this week.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/184004480/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
