{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15354",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15354/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15354/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15354/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/15354",
  "id": 267439500,
  "node_id": "MDU6SXNzdWUyNjc0Mzk1MDA=",
  "number": 15354,
  "title": "Pre-fund account success, then add nodes failed, No pre-fund account, add nodes successfully",
  "user": {
    "login": "ljbb",
    "id": 15681227,
    "node_id": "MDQ6VXNlcjE1NjgxMjI3",
    "avatar_url": "https://avatars.githubusercontent.com/u/15681227?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ljbb",
    "html_url": "https://github.com/ljbb",
    "followers_url": "https://api.github.com/users/ljbb/followers",
    "following_url": "https://api.github.com/users/ljbb/following{/other_user}",
    "gists_url": "https://api.github.com/users/ljbb/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ljbb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ljbb/subscriptions",
    "organizations_url": "https://api.github.com/users/ljbb/orgs",
    "repos_url": "https://api.github.com/users/ljbb/repos",
    "events_url": "https://api.github.com/users/ljbb/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ljbb/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 856638432,
      "node_id": "MDU6TGFiZWw4NTY2Mzg0MzI=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:inactive",
      "name": "status:inactive",
      "color": "ffffff",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2017-10-22T06:16:01Z",
  "updated_at": "2018-12-23T16:48:31Z",
  "closed_at": "2018-12-23T16:48:31Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `1.7.2`\r\nOS & Version: Linux\r\nCommit hash : (`develop`)\r\n\r\n#### Expected behaviour\r\nAfter pre-fund account in private-network successfully, add nodes by using admin.addPeer(\"publickey@ip:port\") function could find other node with the same chainId and newtworkid.\r\n\r\n#### Actual behaviour\r\nAfter pre-fund account in private-network successfully, add nodes by using admin.addPeer(\"publickey@ip:port\") function never add peer successfully.\r\n\r\nBut, without pre-fund, addPeer function works as always.\r\n\r\n#### Steps to reproduce the behaviour\r\n1. Generate new account before init the genesis block.\r\n[CMD] geth --datadir \"/path\" --password \"/path/passwd.txt\" account new\r\n2. vi genesis.json and put the new account into the file with specific number of ether value.\r\n3. generate the genesis block.\r\n[CMD] geth --datadir \"/path\" init /path/genesis.json\r\n4. launch the console.\r\n[CMD] geth --rpc --rpccorsdomain \"*\" --datadir \"/path\" --port \"30303\" --rpcapi \"db,eth,net,web3\" --networkid xxxxxx console\r\n5. run up another node without step 1,2\r\n6. use admin.addPeer(\"publickey@ip:port\") function to add the node, system return value: true\r\n7. admin.peers shows nothing.\r\n\r\nIf skip the Pre-fund step, the add peer action is successful.\r\n\r\nConfirm no network issue.\r\n\r\n\r\n#### genesis.json content\r\n{       \r\n\r\n        \"config\": {\r\n                \"chainId\": xxxxxx,\r\n                \"homesteadBlock\": 0,\r\n                \"eip155Block\": 0,\r\n                \"eip158Block\": 0\r\n        },\r\n\t\"nonce\": \"0x00\",\r\n\t\"timestamp\": \"0x00\",\r\n\t\"parentHash\": \"0x0000000000000000000000000000000000000000000000000000000000000000\",\r\n\t\"extraData\": \"0x00\",\r\n\t\"gasLimit\": \"0x2fefd8\",\r\n\t\"difficulty\": \"0x20000\",\r\n\t\"mixhash\": \"0x0000000000000000000000000000000000000000000000000000000000000000\",\r\n\t\"coinbase\": \"0x0000000000000000000000000000000000000000\",\r\n\t\"alloc\": {\r\n                \"0x4987f42b3ba00f90a3a02f5f34588bc8386ec495\":{\"balance\":\"999000000000000000000000000\"}\r\n        }\r\n}\r\n",
  "closed_by": {
    "login": "stale[bot]",
    "id": 26384082,
    "node_id": "MDM6Qm90MjYzODQwODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stale%5Bbot%5D",
    "html_url": "https://github.com/apps/stale",
    "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15354/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15354/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/338784064",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15354#issuecomment-338784064",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15354",
    "id": 338784064,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzODc4NDA2NA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-23T20:19:43Z",
    "updated_at": "2017-10-23T20:19:43Z",
    "author_association": "MEMBER",
    "body": "I'm betting your `geth --datadir \"/path\" init /path/genesis.json` is failing with an error that you already inited your chain to an old genesis, which you just ignore, and thus the two nodes get different genesis blocks.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/338784064/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/339672547",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15354#issuecomment-339672547",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15354",
    "id": 339672547,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzOTY3MjU0Nw==",
    "user": {
      "login": "ljbb",
      "id": 15681227,
      "node_id": "MDQ6VXNlcjE1NjgxMjI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/15681227?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ljbb",
      "html_url": "https://github.com/ljbb",
      "followers_url": "https://api.github.com/users/ljbb/followers",
      "following_url": "https://api.github.com/users/ljbb/following{/other_user}",
      "gists_url": "https://api.github.com/users/ljbb/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ljbb/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ljbb/subscriptions",
      "organizations_url": "https://api.github.com/users/ljbb/orgs",
      "repos_url": "https://api.github.com/users/ljbb/repos",
      "events_url": "https://api.github.com/users/ljbb/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ljbb/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-26T13:51:22Z",
    "updated_at": "2017-10-26T13:51:22Z",
    "author_association": "NONE",
    "body": "hmm... those two nodes already used the same chainId as well as network id, so how to identify my two nodes get different genesis?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/339672547/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/341821418",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15354#issuecomment-341821418",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15354",
    "id": 341821418,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MTgyMTQxOA==",
    "user": {
      "login": "manicprogrammer",
      "id": 5179219,
      "node_id": "MDQ6VXNlcjUxNzkyMTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5179219?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/manicprogrammer",
      "html_url": "https://github.com/manicprogrammer",
      "followers_url": "https://api.github.com/users/manicprogrammer/followers",
      "following_url": "https://api.github.com/users/manicprogrammer/following{/other_user}",
      "gists_url": "https://api.github.com/users/manicprogrammer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/manicprogrammer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/manicprogrammer/subscriptions",
      "organizations_url": "https://api.github.com/users/manicprogrammer/orgs",
      "repos_url": "https://api.github.com/users/manicprogrammer/repos",
      "events_url": "https://api.github.com/users/manicprogrammer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/manicprogrammer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-03T20:41:22Z",
    "updated_at": "2017-11-03T20:42:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "**SO...**\r\nI wrote all of the below and then I remembered you said it worked fine if you didn't pre-fund the genesis block. In which case I don't think any of the below helps out as it works for you otherwise. I used the same genesis.json you posted obviousuly with a unique chainId and appropriate account and got the below results. Sorry it is not likely to help especially after I wrote all that. tl;dr\r\n\r\nSince I wrote all of the below I'll leave it in case someone else has a similar issue but is helped by the below.\r\n- - - - - -\r\n\r\nI followed the above steps. In the first case it failed and in the second it performed as expected. The difference was the IP address I utilized to addPeer. For node 1 getting the nodeInfo gave me the following:\r\n\r\n> admin.nodeInfo.enode\r\n> \"enode://768ab38ebbea826e27c0b6e68f3d2c15563a18e207f9eef1eff1b70b67da86cbb42c8c15531e331597dee61157b360cfadc130399b1d7b6f85b446b1d451584a@72.xx.xx.xx:30308\"\r\n\r\n(note the public ip)\r\n\r\nIf I used the enode URI with the public IP for me it never added the node. I can feel pretty certain due to my network sitting behind a router in my home and how I certainly don't have the ports I was testing with in this case open on the router and directing to that machine. I'll try it out with the ports open as well and see what happens. Also note I did not provide node 1 with that public IP. The machine it is on only has a local network IP- that public IP is the router ip that the geth software is picking up on its own.\r\n\r\nIf instead I put the local network ip into the URI instead of the public IP and called addPeer it worked almost always. When it didn't work I was getting an I/O timeout this is likely due to me logging heavy to a non-SSD drive for the test and the machine was doing a lot of other things. It certainly appeared to be more the environment of the process than the process itself. I did note that sometimes after calling addPeer it could be a small handful of seconds before I would see it appear. If I checked instantly after calling it was not uncommon to not be showing up. If I kept checking after a short time it did appear. \r\n\r\nI noticed the lag often seemed to correlate with if it had found another peer to talk to and determining if it should be added. I'd see a remote machine in the peers for a bit and then it would be gone.  Sometimes I'd see a remote machine in there be gone another instantly appear then it disappeared and then my addPeer entry would show up. I apologize I don't know (yet) how it threads those operations out. It certainly looked like there could be a little queueing going on  (just my conjecture based on observation) regardless for that environment it was running it seemed slower to show up if it was already evaluating for another peer. These other nodes appeared temporarily despite having a non-standard networkId and chainId. Perhaps there was collision in my choices or just a slow evaluation process that I would sometimes catch.\r\n\r\nBottom line- based on the above and that I also I researched the code related to the `geth account new` @karalabe thought that it was related to an issue with the genesis block and non-ideal operation of the account commands (see #15374) but that doesn't seem to hold up after some investigation, if I am understanding correctly.  \r\n\r\nI suspect it's one or combination of these that is really environmental:\r\n\r\n- use of an ip (public ip) that doesn't route properly or have the needed ports open\r\n- need to give it a handful of seconds to see if the peer gets added as there can be some lag\r\n- system is too busy and you get an I/O timeout\r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/341821418/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/343508841",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15354#issuecomment-343508841",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15354",
    "id": 343508841,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0MzUwODg0MQ==",
    "user": {
      "login": "manicprogrammer",
      "id": 5179219,
      "node_id": "MDQ6VXNlcjUxNzkyMTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5179219?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/manicprogrammer",
      "html_url": "https://github.com/manicprogrammer",
      "followers_url": "https://api.github.com/users/manicprogrammer/followers",
      "following_url": "https://api.github.com/users/manicprogrammer/following{/other_user}",
      "gists_url": "https://api.github.com/users/manicprogrammer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/manicprogrammer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/manicprogrammer/subscriptions",
      "organizations_url": "https://api.github.com/users/manicprogrammer/orgs",
      "repos_url": "https://api.github.com/users/manicprogrammer/repos",
      "events_url": "https://api.github.com/users/manicprogrammer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/manicprogrammer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-10T15:48:56Z",
    "updated_at": "2017-11-10T15:48:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "I am going to dig in deeper into this. Apparently there are a number of similar reports that are expected to be related. There has to be a findable cause.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/343508841/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/437683032",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15354#issuecomment-437683032",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15354",
    "id": 437683032,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzNzY4MzAzMg==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2018-11-11T16:14:17Z",
    "updated_at": "2018-11-11T16:14:17Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/437683032/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
