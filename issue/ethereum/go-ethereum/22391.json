{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22391",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22391/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22391/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22391/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/22391",
  "id": 818214995,
  "node_id": "MDU6SXNzdWU4MTgyMTQ5OTU=",
  "number": 22391,
  "title": "geth repeatedly \"killed\" due to oom (out of memory). Can't fast sync",
  "user": {
    "login": "cyrusadkisson",
    "id": 2284720,
    "node_id": "MDQ6VXNlcjIyODQ3MjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2284720?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cyrusadkisson",
    "html_url": "https://github.com/cyrusadkisson",
    "followers_url": "https://api.github.com/users/cyrusadkisson/followers",
    "following_url": "https://api.github.com/users/cyrusadkisson/following{/other_user}",
    "gists_url": "https://api.github.com/users/cyrusadkisson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cyrusadkisson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cyrusadkisson/subscriptions",
    "organizations_url": "https://api.github.com/users/cyrusadkisson/orgs",
    "repos_url": "https://api.github.com/users/cyrusadkisson/repos",
    "events_url": "https://api.github.com/users/cyrusadkisson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cyrusadkisson/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    },
    {
      "id": 1132689577,
      "node_id": "MDU6TGFiZWwxMTMyNjg5NTc3",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:triage",
      "name": "status:triage",
      "color": "6be514",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-02-28T14:09:32Z",
  "updated_at": "2021-03-08T14:39:59Z",
  "closed_at": "2021-03-08T14:39:58Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 1.9.25 e7872729\r\nOS & Version: Linux Ubuntu 20.04.1\r\n\r\n#### Expected behaviour\r\n\r\nSmooth fast sync\r\n\r\n#### Actual behaviour\r\n\r\nGeth dies repeatedly with \"killed\". Dmesg shows \r\n\r\n```\r\n[272157.031359] [  39469]  1000 39469  1711669  1088459  9228288        0             0 geth\r\n[272157.031361] oom-kill:constraint=CONSTRAINT_NONE,nodemask=(null),cpuset=/,mems_allowed=0,global_oom,task_memcg=/user.slice/user-1000.slice/user@1000.service,task=geth,pid=39469,uid=1000\r\n[272157.031405] Out of memory: Killed process 39469 (geth) total-vm:6846676kB, anon-rss:4353836kB, file-rss:0kB, shmem-rss:0kB, UID:1000 pgtables:9012kB oom_score_adj:0\r\n[272157.175183] oom_reaper: reaped process 39469 (geth), now anon-rss:0kB, file-rss:0kB, shmem-rss:0kB\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nNot sure. My computer is a normal x64 laptop feat. core i5 with 8GB of memory. Should be able to handle this, no problem. My command is:\r\n\r\n`geth --syncmode fast --datadir /media/cyrus/WD\\ red\\ 500\\ GB/ethereum --cache 2048 --maxpeers 60 --light.serve 30 --light.maxpeers 30 --nousb`\r\n\r\nI was able to get to block number ~7M and eventually to 7.4M by repeatedly restarting geth but eventually gave up.",
  "closed_by": {
    "login": "cyrusadkisson",
    "id": 2284720,
    "node_id": "MDQ6VXNlcjIyODQ3MjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2284720?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cyrusadkisson",
    "html_url": "https://github.com/cyrusadkisson",
    "followers_url": "https://api.github.com/users/cyrusadkisson/followers",
    "following_url": "https://api.github.com/users/cyrusadkisson/following{/other_user}",
    "gists_url": "https://api.github.com/users/cyrusadkisson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cyrusadkisson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cyrusadkisson/subscriptions",
    "organizations_url": "https://api.github.com/users/cyrusadkisson/orgs",
    "repos_url": "https://api.github.com/users/cyrusadkisson/repos",
    "events_url": "https://api.github.com/users/cyrusadkisson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cyrusadkisson/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22391/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22391/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/787460218",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22391#issuecomment-787460218",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22391",
    "id": 787460218,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NzQ2MDIxOA==",
    "user": {
      "login": "cyrusadkisson",
      "id": 2284720,
      "node_id": "MDQ6VXNlcjIyODQ3MjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2284720?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cyrusadkisson",
      "html_url": "https://github.com/cyrusadkisson",
      "followers_url": "https://api.github.com/users/cyrusadkisson/followers",
      "following_url": "https://api.github.com/users/cyrusadkisson/following{/other_user}",
      "gists_url": "https://api.github.com/users/cyrusadkisson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cyrusadkisson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cyrusadkisson/subscriptions",
      "organizations_url": "https://api.github.com/users/cyrusadkisson/orgs",
      "repos_url": "https://api.github.com/users/cyrusadkisson/repos",
      "events_url": "https://api.github.com/users/cyrusadkisson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cyrusadkisson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-28T14:22:15Z",
    "updated_at": "2021-02-28T14:22:15Z",
    "author_association": "NONE",
    "body": "Update: also happens on ethereum-unstable from ppa (previous report was stable from ppa)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/787460218/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/790470760",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22391#issuecomment-790470760",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22391",
    "id": 790470760,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MDQ3MDc2MA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-04T09:30:37Z",
    "updated_at": "2021-03-04T09:30:37Z",
    "author_association": "MEMBER",
    "body": "So, this seems like a bug that's compounded by a variety of things.\r\n\r\nGo's GC is a bit relaxed in that it only starts wiping when 100% junk accumulates vs. the RAM left from the previous sweep. This makes RAM usage a bit funky. However, with 2GB cache, it should not hit 8.\r\n\r\nSo, my hunch is that fast sync might be expanding too many nodes sideways, causing a lot of RAM to be used temporarily. It would help if you could attach some logs from before the crash.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/790470760/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/791797874",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22391#issuecomment-791797874",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22391",
    "id": 791797874,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5MTc5Nzg3NA==",
    "user": {
      "login": "cyrusadkisson",
      "id": 2284720,
      "node_id": "MDQ6VXNlcjIyODQ3MjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2284720?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cyrusadkisson",
      "html_url": "https://github.com/cyrusadkisson",
      "followers_url": "https://api.github.com/users/cyrusadkisson/followers",
      "following_url": "https://api.github.com/users/cyrusadkisson/following{/other_user}",
      "gists_url": "https://api.github.com/users/cyrusadkisson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cyrusadkisson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cyrusadkisson/subscriptions",
      "organizations_url": "https://api.github.com/users/cyrusadkisson/orgs",
      "repos_url": "https://api.github.com/users/cyrusadkisson/repos",
      "events_url": "https://api.github.com/users/cyrusadkisson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cyrusadkisson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-05T23:53:37Z",
    "updated_at": "2021-03-05T23:53:37Z",
    "author_association": "NONE",
    "body": "FWIW, I upgraded to 1.10 when it was released a few days ago, wiped everything and have now sync'd to 7.5 million without any issues. I'll check back in when/if it goes the whole way.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/791797874/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/792799382",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22391#issuecomment-792799382",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22391",
    "id": 792799382,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5Mjc5OTM4Mg==",
    "user": {
      "login": "cyrusadkisson",
      "id": 2284720,
      "node_id": "MDQ6VXNlcjIyODQ3MjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2284720?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cyrusadkisson",
      "html_url": "https://github.com/cyrusadkisson",
      "followers_url": "https://api.github.com/users/cyrusadkisson/followers",
      "following_url": "https://api.github.com/users/cyrusadkisson/following{/other_user}",
      "gists_url": "https://api.github.com/users/cyrusadkisson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cyrusadkisson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cyrusadkisson/subscriptions",
      "organizations_url": "https://api.github.com/users/cyrusadkisson/orgs",
      "repos_url": "https://api.github.com/users/cyrusadkisson/repos",
      "events_url": "https://api.github.com/users/cyrusadkisson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cyrusadkisson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-08T14:39:58Z",
    "updated_at": "2021-03-08T14:39:58Z",
    "author_association": "NONE",
    "body": "Chain successfully sync'd with same options on 1.10.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/792799382/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
