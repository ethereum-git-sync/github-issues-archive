{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1093",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1093/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1093/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1093/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/1093",
  "id": 80506798,
  "node_id": "MDU6SXNzdWU4MDUwNjc5OA==",
  "number": 1093,
  "title": "blockchain corruption, or similar nil panic",
  "user": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2015-05-25T11:38:29Z",
  "updated_at": "2015-05-29T14:09:12Z",
  "closed_at": "2015-05-29T14:03:02Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "I've been stuck on a block that I couldn't import, was considered invalid for some reason (latest develop as of now)\n\n```\nI0525 14:23:14.557295    8676 chain_manager.go:743] INVALID block #433182 (b83ca3c4d28bc2233f5c6cfed4a1536d2ee05fcbc2781669a7202960ee7338ac)\nI0525 14:23:14.557349    8676 chain_manager.go:744] Transaction w/ invalid nonce. tx=5184  state=0)\nI0525 14:23:14.557371    8676 sync.go:66] Block insertion failed: Transaction w/ invalid nonce. tx=5184  state=0)\nI0525 14:23:14.557499    8676 sync.go:114] Synchronisation failed: block downloading cancelled (requested)\n```\n\nso I figured I'd set my head block a bit backwards to maybe pull a fresh batch if for some reason I've got a just block). After running `admin.debug.setHead(430000)` geth more or less froze. I terminated it with `Ctrl+C`, after which every time I tried to start geth I got a nil panic.\n\n```\n> geth console\nI0525 14:31:09.633109    8921 backend.go:255] Protocol Version: 60, Network Id: 0\nI0525 14:31:09.634549    8921 backend.go:265] Blockchain DB Version: 2\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0x1 addr=0x0 pc=0x5063ca]\n\ngoroutine 1 [running]:\ngithub.com/ethereum/go-ethereum/core/types.(*Block).Hash(0x0, 0x0, 0x0, 0x0, 0x0)\n        /work/src/github.com/ethereum/go-ethereum/core/types/block.go:319 +0xca\ngithub.com/ethereum/go-ethereum/core.(*ChainManager).setLastState(0xc20878b7a0)\n        /work/src/github.com/ethereum/go-ethereum/core/chain_manager.go:237 +0x155\ngithub.com/ethereum/go-ethereum/core.NewChainManager(0x7fba19fd8e18, 0xc20813f620, 0x7fba19fd8e18, 0xc2085fd2c0, 0x7fba19fda728, 0xc208734b60, 0xc2085fc0c0, 0x0)\n        /work/src/github.com/ethereum/go-ethereum/core/chain_manager.go:119 +0x23f\ngithub.com/ethereum/go-ethereum/eth.New(0xc20806d800, 0x4, 0x0, 0x0)\n        /work/src/github.com/ethereum/go-ethereum/eth/backend.go:287 +0x1778\nmain.console(0xc20807c540)\n        /work/src/github.com/ethereum/go-ethereum/cmd/geth/main.go:329 +0x175\ngithub.com/codegangsta/cli.Command.Run(0xca7e90, 0x7, 0x0, 0x0, 0x0, 0x0, 0x0, 0xdc1c70, 0x30, 0xf51eb0, ...)\n        /work/src/github.com/ethereum/go-ethereum/Godeps/_workspace/src/github.com/codegangsta/cli/command.go:118 +0x104b\ngithub.com/codegangsta/cli.(*App).Run(0xc208166000, 0xc20800a000, 0x2, 0x2, 0x0, 0x0)\n        /work/src/github.com/ethereum/go-ethereum/Godeps/_workspace/src/github.com/codegangsta/cli/app.go:177 +0xdf6\nmain.main()\n        /work/src/github.com/ethereum/go-ethereum/cmd/geth/main.go:300 +0x80\n```\n\nIn the end I just dumped the entire block chain database. However, this was an unpleasant xp and now I have to resync 1+ hours, so it would be nice if we could look into this.\n",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1093/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1093/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/105215441",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1093#issuecomment-105215441",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1093",
    "id": 105215441,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNTIxNTQ0MQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-05-25T11:41:25Z",
    "updated_at": "2015-05-25T11:41:25Z",
    "author_association": "MEMBER",
    "body": "Seems to hit the same issue as #1080.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/105215441/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/105228139",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1093#issuecomment-105228139",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1093",
    "id": 105228139,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNTIyODEzOQ==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-05-25T12:55:49Z",
    "updated_at": "2015-05-25T12:55:49Z",
    "author_association": "MEMBER",
    "body": "```\n                                                                                  This is a good hint as to where the nil blocks might be coming from.Seems as if interrupting during sync causes invalid block data to get written.\n```\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/105228139/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/105420885",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1093#issuecomment-105420885",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1093",
    "id": 105420885,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNTQyMDg4NQ==",
    "user": {
      "login": "Quiark",
      "id": 59075,
      "node_id": "MDQ6VXNlcjU5MDc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/59075?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Quiark",
      "html_url": "https://github.com/Quiark",
      "followers_url": "https://api.github.com/users/Quiark/followers",
      "following_url": "https://api.github.com/users/Quiark/following{/other_user}",
      "gists_url": "https://api.github.com/users/Quiark/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Quiark/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Quiark/subscriptions",
      "organizations_url": "https://api.github.com/users/Quiark/orgs",
      "repos_url": "https://api.github.com/users/Quiark/repos",
      "events_url": "https://api.github.com/users/Quiark/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Quiark/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-05-26T07:09:37Z",
    "updated_at": "2015-05-26T07:09:37Z",
    "author_association": "NONE",
    "body": "I think the same thing happened to me, running b2b9b3b567291c02a34f16b510621f8ac75d368c\n\nI was stuck on invalid block and went back\n\n```\n> eth.blockNumber\n446423\n> admin.debug.setHead(444444)\nundefined\n> eth.blockNumber\n444467\n> eth.blockNumber\n444630\n> eth.blockNumber\n444634\n> eth.blockNumber\n4\n```\n\nThen I tried to `exit`  geth but it never finished so I Ctrl-C'ed it. Now got this crash\n\n```\nI0526 07:03:00.582247    1320 peer.go:109] [262167eb28c7ce1b] fetching 128 blocks\nI0526 07:03:00.758725    1320 downloader.go:413] Added 128 blocks from: 3b3bd5cdd92c02e7\nI0526 07:03:00.759520    1320 peer.go:109] [3b3bd5cdd92c02e7] fetching 128 blocks\nI0526 07:03:00.965860    1320 sync.go:60] Inserting chain with 128 blocks (#446924 - #447051)\nI0526 07:03:00.980398    1320 state_object.go:241] 82b27dbe07d34fb96309d2306e2729b6c5d155ff: gas (+ 3142770)\nI0526 07:03:00.984677    1320 downloader.go:413] Added 0 blocks from: fdd299011508d51b\nI0526 07:03:00.984914    1320 ethash.go:73] Generating cache for epoch 14 (526ee6e688a9b3d466fe4a7355197a89898593509d75c570942cc73a5ca8299d)\nI0526 07:03:00.994985    1320 state_object.go:197] 82b27dbe07d34fb96309d2306e2729b6c5d155ff: #1 46975858129337085034714 (+ 1500000000000000000)\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0x1 addr=0x40 pc=0x50621f]\n\ngoroutine 534 [running]:\ngithub.com/ethereum/go-ethereum/core/types.(*Block).NumberU64(0x0, 0x30540b85f5a78477)\n        /root/ether/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/core/types/block.go:269 +0x1f\ngithub.com/ethereum/go-ethereum/core.(*ChainManager).diff(0xc2089ac900, 0xc20800a300, 0x0, 0x0, 0x0, 0x0)\n        /root/ether/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/core/chain_manager.go:670 +0xa13\ngithub.com/ethereum/go-ethereum/core.(*ChainManager).merge(0xc2089ac900, 0xc20800a300, 0xc20d13be00)\n        /root/ether/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/core/chain_manager.go:696 +0x45\ngithub.com/ethereum/go-ethereum/core.(*ChainManager).InsertChain(0xc2089ac900, 0xc209d44400, 0x80, 0x80, 0x0, 0x0, 0x0)\n        /root/ether/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/core/chain_manager.go:596 +0x1379\ngithub.com/ethereum/go-ethereum/eth.(*ProtocolManager).processBlocks(0xc2094a63c0, 0x0, 0x0)\n        /root/ether/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/eth/sync.go:64 +0x374\ngithub.com/ethereum/go-ethereum/eth.func·005()\n        /root/ether/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/eth/sync.go:37 +0x33\ncreated by github.com/ethereum/go-ethereum/eth.(*ProtocolManager).update\n        /root/ether/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/eth/sync.go:39 +0x2bd\n\n\n```\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/105420885/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/106814430",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1093#issuecomment-106814430",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1093",
    "id": 106814430,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNjgxNDQzMA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-05-29T14:03:02Z",
    "updated_at": "2015-05-29T14:03:02Z",
    "author_association": "MEMBER",
    "body": "Closing this. The shutdown procedure was fixed to not allow force closing, but rather finish up syncing with the database first. If we/you still force kill the app, then we can accept data corruption.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/106814430/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/106817803",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/1093#issuecomment-106817803",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/1093",
    "id": 106817803,
    "node_id": "MDEyOklzc3VlQ29tbWVudDEwNjgxNzgwMw==",
    "user": {
      "login": "Quiark",
      "id": 59075,
      "node_id": "MDQ6VXNlcjU5MDc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/59075?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Quiark",
      "html_url": "https://github.com/Quiark",
      "followers_url": "https://api.github.com/users/Quiark/followers",
      "following_url": "https://api.github.com/users/Quiark/following{/other_user}",
      "gists_url": "https://api.github.com/users/Quiark/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Quiark/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Quiark/subscriptions",
      "organizations_url": "https://api.github.com/users/Quiark/orgs",
      "repos_url": "https://api.github.com/users/Quiark/repos",
      "events_url": "https://api.github.com/users/Quiark/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Quiark/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2015-05-29T14:09:12Z",
    "updated_at": "2015-05-29T14:09:12Z",
    "author_association": "NONE",
    "body": "oh so that's why I had to reboot to get rid of the stuck geth process the other day :D \n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/106817803/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
