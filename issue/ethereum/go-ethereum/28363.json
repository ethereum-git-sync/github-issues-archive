{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/28363",
  "id": 1947331144,
  "node_id": "I_kwDOAOvK9850EepI",
  "number": 28363,
  "title": "BAD BLOCK Error: could not apply tx 108 [...]: nonce too high",
  "user": {
    "login": "adaszko",
    "id": 165678,
    "node_id": "MDQ6VXNlcjE2NTY3OA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/165678?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/adaszko",
    "html_url": "https://github.com/adaszko",
    "followers_url": "https://api.github.com/users/adaszko/followers",
    "following_url": "https://api.github.com/users/adaszko/following{/other_user}",
    "gists_url": "https://api.github.com/users/adaszko/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/adaszko/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/adaszko/subscriptions",
    "organizations_url": "https://api.github.com/users/adaszko/orgs",
    "repos_url": "https://api.github.com/users/adaszko/repos",
    "events_url": "https://api.github.com/users/adaszko/events{/privacy}",
    "received_events_url": "https://api.github.com/users/adaszko/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2023-10-17T12:41:14Z",
  "updated_at": "2023-10-17T13:31:46Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `geth version 1.12.0-stable-e501b3b0`\r\nCL client & version: Lighthouse v4.2.0-c547a11+\r\nOS & Version: Linux\r\nSMP Debian 5.10.179-2 (2023-07-14) aarch64 GNU/Linux\r\nDebian 11\r\n\r\n#### Expected behaviour\r\ngeth is able to sync up with the network\r\n\r\n\r\n#### Actual behaviour\r\ngeth sync gets stuck on `block 18366358 (0xeadfc5ddd3fcb3fbe4172be329a20176442242b8aa00a6375111dfe861cd29d9)`\r\n```\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: WARN [10-17|02:02:04.433] Failed to load old bad blocks            error=\"open /var/lib/geth/geth/chaindata/6446805.ldb: too many open files\"\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: ERROR[10-17|02:02:04.435]\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: ########## BAD BLOCK #########\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: Block: 18366358 (0xeadfc5ddd3fcb3fbe4172be329a20176442242b8aa00a6375111dfe861cd29d9)\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: Error: could not apply tx 108 [0x512f216b4b6b524c29e39370331265807efddeadb0490eb6bd2da567bd468981]: nonce too high: address 0x08994e0D86A83BF66Cb63935CCFFF66f6ffc4625, tx: 547 state: 0\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: Platform: geth (devel) go1.20.5 arm64 linux\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: VCS: e501b3b0-20230525 (dirty)\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: Chain config: &params.ChainConfig{ChainID:1, HomesteadBlock:1150000, DAOForkBlock:1920000, DAOForkSupport:true, EIP150Block:2463000, EIP155Block:2675000, EIP158Block:2675000, ByzantiumBlock:4370000, ConstantinopleBlock:7280000, PetersburgBlock:7280000, IstanbulBlock:9069000, MuirGlacierBlock:9200000, BerlinBlock:12244000, LondonBlock:12965000, ArrowGlacierBlock:13773000, GrayGlacierBlock:15050000, MergeNetsplitBlock:<nil>, ShanghaiTime:(*uint64)(0x4000126190), CancunTime:(*uint64)(nil), PragueTime:(*uint64)(nil), TerminalTotalDifficulty:58750000000000000000000, TerminalTotalDifficultyPassed:true, Ethash:(*params.EthashConfig)(0x2a7fd80), Clique:(*params.CliqueConfig)(nil)}\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: Receipts:\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: ##############################\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]:  \r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: ERROR[10-17|02:02:04.452] Beacon backfilling failed                err=\"retrieved hash chain is invalid: could not apply tx 108 [0x512f216b4b6b524c29e39370331265807efddeadb0490eb6bd2da567bd468981]: nonce too high: address 0x08994e0D86A83BF66Cb63935CCFFF66f6ffc4625, tx: 547 state: 0\"\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: INFO [10-17|02:02:04.690] Syncing beacon headers                   downloaded=6656 left=18,366,356 eta=1787h56m5.688s\r\nOct 17 02:02:05 geth-lighthouse geth[1096598]: INFO [10-17|02:02:05.216] Skip duplicated bad block                number=18,366,358 hash=eadfc5..cd29d9\r\nOct 17 02:02:05 geth-lighthouse geth[1096598]: ERROR[10-17|02:02:05.216]\r\nOct 17 02:02:05 geth-lighthouse geth[1096598]: ########## BAD BLOCK #########\r\nOct 17 02:02:05 geth-lighthouse geth[1096598]: Block: 18366358 (0xeadfc5ddd3fcb3fbe4172be329a20176442242b8aa00a6375111dfe861cd29d9)\r\nOct 17 02:02:05 geth-lighthouse geth[1096598]: Error: could not apply tx 108 [0x512f216b4b6b524c29e39370331265807efddeadb0490eb6bd2da567bd468981]: nonce too high: address 0x08994e0D86A83BF66Cb63935CCFFF66f6ffc4625, tx: 547 state: 0\r\nOct 17 02:02:05 geth-lighthouse geth[1096598]: Platform: geth (devel) go1.20.5 arm64 linux\r\nOct 17 02:02:05 geth-lighthouse geth[1096598]: VCS: e501b3b0-20230525 (dirty)\r\nOct 17 02:02:05 geth-lighthouse geth[1096598]: Chain config: &params.ChainConfig{ChainID:1, HomesteadBlock:1150000, DAOForkBlock:1920000, DAOForkSupport:true, EIP150Block:2463000, EIP155Block:2675000, EIP158Block:2675000, ByzantiumBlock:4370000, ConstantinopleBlock:7280000, PetersburgBlock:7280000, IstanbulBlock:9069000, MuirGlacierBlock:9200000, BerlinBlock:12244000, LondonBlock:12965000, ArrowGlacierBlock:13773000, GrayGlacierBlock:15050000, MergeNetsplitBlock:<nil>, ShanghaiTime:(*uint64)(0x4000126190), CancunTime:(*uint64)(nil), PragueTime:(*uint64)(nil), TerminalTotalDifficulty:58750000000000000000000, TerminalTotalDifficultyPassed:true, Ethash:(*params.EthashConfig)(0x2a7fd80), Clique:(*params.CliqueConfig)(nil)}\r\n```\r\n\r\nFull logs: https://gist.githubusercontent.com/adaszko/03002209abea3fb1e7bc909cff7d53b5/raw/8a8eff8abd10cd36d65f89f141aceb749559d644/cant-sync-geth.log\r\n\r\n\r\n#### Steps to reproduce the behaviour\r\nUnknown, but etherscan shows the problematic block is a valid one: https://etherscan.io/block/18366358",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766346022",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1766346022",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1766346022,
    "node_id": "IC_kwDOAOvK985pSE0m",
    "user": {
      "login": "adaszko",
      "id": 165678,
      "node_id": "MDQ6VXNlcjE2NTY3OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/165678?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adaszko",
      "html_url": "https://github.com/adaszko",
      "followers_url": "https://api.github.com/users/adaszko/followers",
      "following_url": "https://api.github.com/users/adaszko/following{/other_user}",
      "gists_url": "https://api.github.com/users/adaszko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adaszko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adaszko/subscriptions",
      "organizations_url": "https://api.github.com/users/adaszko/orgs",
      "repos_url": "https://api.github.com/users/adaszko/repos",
      "events_url": "https://api.github.com/users/adaszko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adaszko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T12:45:12Z",
    "updated_at": "2023-10-17T12:45:12Z",
    "author_association": "NONE",
    "body": "The error message is very similar to this one: https://github.com/ethereum/go-ethereum/issues/26486#issuecomment-1436040516",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766346022/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766350629",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1766350629",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1766350629,
    "node_id": "IC_kwDOAOvK985pSF8l",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T12:47:48Z",
    "updated_at": "2023-10-17T12:47:48Z",
    "author_association": "MEMBER",
    "body": "```\r\nWARN [10-17|02:02:04.433] Failed to load old bad blocks            error=\"open /var/lib/geth/geth/chaindata/6446805.ldb: too many open files\"\r\n```\r\n\r\nYou have too many open files, which is causing database failures -- geth is unable to lookup info from the database. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766350629/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766353522",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1766353522",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1766353522,
    "node_id": "IC_kwDOAOvK985pSGpy",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T12:49:20Z",
    "updated_at": "2023-10-17T12:49:20Z",
    "author_association": "MEMBER",
    "body": "The reason for the too many open files can be a combination of \r\n\r\n- Several different programs, all using many files (files and/or sockets) \r\n- Remote filesystems, where the OS has one idea about the fd_limit, and the remote filesystem has another, more restrictive, idea. Are you using an externally mounted filesystem? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766353522/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766365452",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1766365452",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1766365452,
    "node_id": "IC_kwDOAOvK985pSJkM",
    "user": {
      "login": "adaszko",
      "id": 165678,
      "node_id": "MDQ6VXNlcjE2NTY3OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/165678?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adaszko",
      "html_url": "https://github.com/adaszko",
      "followers_url": "https://api.github.com/users/adaszko/followers",
      "following_url": "https://api.github.com/users/adaszko/following{/other_user}",
      "gists_url": "https://api.github.com/users/adaszko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adaszko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adaszko/subscriptions",
      "organizations_url": "https://api.github.com/users/adaszko/orgs",
      "repos_url": "https://api.github.com/users/adaszko/repos",
      "events_url": "https://api.github.com/users/adaszko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adaszko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T12:56:31Z",
    "updated_at": "2023-10-17T12:56:31Z",
    "author_association": "NONE",
    "body": "I will test out with increased ulimit soon.  It's not a hard error though, only a warning.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766365452/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766399666",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1766399666",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1766399666,
    "node_id": "IC_kwDOAOvK985pSR6y",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T13:16:37Z",
    "updated_at": "2023-10-17T13:16:37Z",
    "author_association": "MEMBER",
    "body": "No, that's a hard error, I guarantee. Internally geth will croak on that",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766399666/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766425020",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1766425020",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1766425020,
    "node_id": "IC_kwDOAOvK985pSYG8",
    "user": {
      "login": "adaszko",
      "id": 165678,
      "node_id": "MDQ6VXNlcjE2NTY3OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/165678?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adaszko",
      "html_url": "https://github.com/adaszko",
      "followers_url": "https://api.github.com/users/adaszko/followers",
      "following_url": "https://api.github.com/users/adaszko/following{/other_user}",
      "gists_url": "https://api.github.com/users/adaszko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adaszko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adaszko/subscriptions",
      "organizations_url": "https://api.github.com/users/adaszko/orgs",
      "repos_url": "https://api.github.com/users/adaszko/repos",
      "events_url": "https://api.github.com/users/adaszko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adaszko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T13:30:32Z",
    "updated_at": "2023-10-17T13:31:46Z",
    "author_association": "NONE",
    "body": "> No, that's a hard error, I guarantee. Internally geth will croak on that\r\n\r\nI appreciate the input but it leads to a broken state, so perhaps it should become a hard error.  Geth is not able to sync even after a restart and the `too many open files` error gone.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766425020/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
