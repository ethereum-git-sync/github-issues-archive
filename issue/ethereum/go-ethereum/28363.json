{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/28363",
  "id": 1947331144,
  "node_id": "I_kwDOAOvK9850EepI",
  "number": 28363,
  "title": "BAD BLOCK Error: could not apply tx 108 [...]: nonce too high",
  "user": {
    "login": "adaszko",
    "id": 165678,
    "node_id": "MDQ6VXNlcjE2NTY3OA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/165678?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/adaszko",
    "html_url": "https://github.com/adaszko",
    "followers_url": "https://api.github.com/users/adaszko/followers",
    "following_url": "https://api.github.com/users/adaszko/following{/other_user}",
    "gists_url": "https://api.github.com/users/adaszko/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/adaszko/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/adaszko/subscriptions",
    "organizations_url": "https://api.github.com/users/adaszko/orgs",
    "repos_url": "https://api.github.com/users/adaszko/repos",
    "events_url": "https://api.github.com/users/adaszko/events{/privacy}",
    "received_events_url": "https://api.github.com/users/adaszko/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 15,
  "created_at": "2023-10-17T12:41:14Z",
  "updated_at": "2023-11-09T10:10:50Z",
  "closed_at": "2023-11-09T09:35:56Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `geth version 1.12.0-stable-e501b3b0`\r\nCL client & version: Lighthouse v4.2.0-c547a11+\r\nOS & Version: Linux\r\nSMP Debian 5.10.179-2 (2023-07-14) aarch64 GNU/Linux\r\nDebian 11\r\n\r\n#### Expected behaviour\r\ngeth is able to sync up with the network\r\n\r\n\r\n#### Actual behaviour\r\ngeth sync gets stuck on `block 18366358 (0xeadfc5ddd3fcb3fbe4172be329a20176442242b8aa00a6375111dfe861cd29d9)`\r\n```\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: WARN [10-17|02:02:04.433] Failed to load old bad blocks            error=\"open /var/lib/geth/geth/chaindata/6446805.ldb: too many open files\"\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: ERROR[10-17|02:02:04.435]\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: ########## BAD BLOCK #########\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: Block: 18366358 (0xeadfc5ddd3fcb3fbe4172be329a20176442242b8aa00a6375111dfe861cd29d9)\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: Error: could not apply tx 108 [0x512f216b4b6b524c29e39370331265807efddeadb0490eb6bd2da567bd468981]: nonce too high: address 0x08994e0D86A83BF66Cb63935CCFFF66f6ffc4625, tx: 547 state: 0\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: Platform: geth (devel) go1.20.5 arm64 linux\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: VCS: e501b3b0-20230525 (dirty)\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: Chain config: &params.ChainConfig{ChainID:1, HomesteadBlock:1150000, DAOForkBlock:1920000, DAOForkSupport:true, EIP150Block:2463000, EIP155Block:2675000, EIP158Block:2675000, ByzantiumBlock:4370000, ConstantinopleBlock:7280000, PetersburgBlock:7280000, IstanbulBlock:9069000, MuirGlacierBlock:9200000, BerlinBlock:12244000, LondonBlock:12965000, ArrowGlacierBlock:13773000, GrayGlacierBlock:15050000, MergeNetsplitBlock:<nil>, ShanghaiTime:(*uint64)(0x4000126190), CancunTime:(*uint64)(nil), PragueTime:(*uint64)(nil), TerminalTotalDifficulty:58750000000000000000000, TerminalTotalDifficultyPassed:true, Ethash:(*params.EthashConfig)(0x2a7fd80), Clique:(*params.CliqueConfig)(nil)}\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: Receipts:\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: ##############################\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]:  \r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: ERROR[10-17|02:02:04.452] Beacon backfilling failed                err=\"retrieved hash chain is invalid: could not apply tx 108 [0x512f216b4b6b524c29e39370331265807efddeadb0490eb6bd2da567bd468981]: nonce too high: address 0x08994e0D86A83BF66Cb63935CCFFF66f6ffc4625, tx: 547 state: 0\"\r\nOct 17 02:02:04 geth-lighthouse geth[1096598]: INFO [10-17|02:02:04.690] Syncing beacon headers                   downloaded=6656 left=18,366,356 eta=1787h56m5.688s\r\nOct 17 02:02:05 geth-lighthouse geth[1096598]: INFO [10-17|02:02:05.216] Skip duplicated bad block                number=18,366,358 hash=eadfc5..cd29d9\r\nOct 17 02:02:05 geth-lighthouse geth[1096598]: ERROR[10-17|02:02:05.216]\r\nOct 17 02:02:05 geth-lighthouse geth[1096598]: ########## BAD BLOCK #########\r\nOct 17 02:02:05 geth-lighthouse geth[1096598]: Block: 18366358 (0xeadfc5ddd3fcb3fbe4172be329a20176442242b8aa00a6375111dfe861cd29d9)\r\nOct 17 02:02:05 geth-lighthouse geth[1096598]: Error: could not apply tx 108 [0x512f216b4b6b524c29e39370331265807efddeadb0490eb6bd2da567bd468981]: nonce too high: address 0x08994e0D86A83BF66Cb63935CCFFF66f6ffc4625, tx: 547 state: 0\r\nOct 17 02:02:05 geth-lighthouse geth[1096598]: Platform: geth (devel) go1.20.5 arm64 linux\r\nOct 17 02:02:05 geth-lighthouse geth[1096598]: VCS: e501b3b0-20230525 (dirty)\r\nOct 17 02:02:05 geth-lighthouse geth[1096598]: Chain config: &params.ChainConfig{ChainID:1, HomesteadBlock:1150000, DAOForkBlock:1920000, DAOForkSupport:true, EIP150Block:2463000, EIP155Block:2675000, EIP158Block:2675000, ByzantiumBlock:4370000, ConstantinopleBlock:7280000, PetersburgBlock:7280000, IstanbulBlock:9069000, MuirGlacierBlock:9200000, BerlinBlock:12244000, LondonBlock:12965000, ArrowGlacierBlock:13773000, GrayGlacierBlock:15050000, MergeNetsplitBlock:<nil>, ShanghaiTime:(*uint64)(0x4000126190), CancunTime:(*uint64)(nil), PragueTime:(*uint64)(nil), TerminalTotalDifficulty:58750000000000000000000, TerminalTotalDifficultyPassed:true, Ethash:(*params.EthashConfig)(0x2a7fd80), Clique:(*params.CliqueConfig)(nil)}\r\n```\r\n\r\nFull logs: https://gist.githubusercontent.com/adaszko/03002209abea3fb1e7bc909cff7d53b5/raw/8a8eff8abd10cd36d65f89f141aceb749559d644/cant-sync-geth.log\r\n\r\n\r\n#### Steps to reproduce the behaviour\r\nUnknown, but etherscan shows the problematic block is a valid one: https://etherscan.io/block/18366358",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766346022",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1766346022",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1766346022,
    "node_id": "IC_kwDOAOvK985pSE0m",
    "user": {
      "login": "adaszko",
      "id": 165678,
      "node_id": "MDQ6VXNlcjE2NTY3OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/165678?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adaszko",
      "html_url": "https://github.com/adaszko",
      "followers_url": "https://api.github.com/users/adaszko/followers",
      "following_url": "https://api.github.com/users/adaszko/following{/other_user}",
      "gists_url": "https://api.github.com/users/adaszko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adaszko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adaszko/subscriptions",
      "organizations_url": "https://api.github.com/users/adaszko/orgs",
      "repos_url": "https://api.github.com/users/adaszko/repos",
      "events_url": "https://api.github.com/users/adaszko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adaszko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T12:45:12Z",
    "updated_at": "2023-10-17T12:45:12Z",
    "author_association": "NONE",
    "body": "The error message is very similar to this one: https://github.com/ethereum/go-ethereum/issues/26486#issuecomment-1436040516",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766346022/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766350629",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1766350629",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1766350629,
    "node_id": "IC_kwDOAOvK985pSF8l",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T12:47:48Z",
    "updated_at": "2023-10-17T12:47:48Z",
    "author_association": "MEMBER",
    "body": "```\r\nWARN [10-17|02:02:04.433] Failed to load old bad blocks            error=\"open /var/lib/geth/geth/chaindata/6446805.ldb: too many open files\"\r\n```\r\n\r\nYou have too many open files, which is causing database failures -- geth is unable to lookup info from the database. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766350629/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766353522",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1766353522",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1766353522,
    "node_id": "IC_kwDOAOvK985pSGpy",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T12:49:20Z",
    "updated_at": "2023-10-17T12:49:20Z",
    "author_association": "MEMBER",
    "body": "The reason for the too many open files can be a combination of \r\n\r\n- Several different programs, all using many files (files and/or sockets) \r\n- Remote filesystems, where the OS has one idea about the fd_limit, and the remote filesystem has another, more restrictive, idea. Are you using an externally mounted filesystem? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766353522/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766365452",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1766365452",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1766365452,
    "node_id": "IC_kwDOAOvK985pSJkM",
    "user": {
      "login": "adaszko",
      "id": 165678,
      "node_id": "MDQ6VXNlcjE2NTY3OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/165678?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adaszko",
      "html_url": "https://github.com/adaszko",
      "followers_url": "https://api.github.com/users/adaszko/followers",
      "following_url": "https://api.github.com/users/adaszko/following{/other_user}",
      "gists_url": "https://api.github.com/users/adaszko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adaszko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adaszko/subscriptions",
      "organizations_url": "https://api.github.com/users/adaszko/orgs",
      "repos_url": "https://api.github.com/users/adaszko/repos",
      "events_url": "https://api.github.com/users/adaszko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adaszko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T12:56:31Z",
    "updated_at": "2023-10-17T12:56:31Z",
    "author_association": "NONE",
    "body": "I will test out with increased ulimit soon.  It's not a hard error though, only a warning.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766365452/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766399666",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1766399666",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1766399666,
    "node_id": "IC_kwDOAOvK985pSR6y",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T13:16:37Z",
    "updated_at": "2023-10-17T13:16:37Z",
    "author_association": "MEMBER",
    "body": "No, that's a hard error, I guarantee. Internally geth will croak on that",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766399666/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766425020",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1766425020",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1766425020,
    "node_id": "IC_kwDOAOvK985pSYG8",
    "user": {
      "login": "adaszko",
      "id": 165678,
      "node_id": "MDQ6VXNlcjE2NTY3OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/165678?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adaszko",
      "html_url": "https://github.com/adaszko",
      "followers_url": "https://api.github.com/users/adaszko/followers",
      "following_url": "https://api.github.com/users/adaszko/following{/other_user}",
      "gists_url": "https://api.github.com/users/adaszko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adaszko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adaszko/subscriptions",
      "organizations_url": "https://api.github.com/users/adaszko/orgs",
      "repos_url": "https://api.github.com/users/adaszko/repos",
      "events_url": "https://api.github.com/users/adaszko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adaszko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T13:30:32Z",
    "updated_at": "2023-10-17T13:31:46Z",
    "author_association": "NONE",
    "body": "> No, that's a hard error, I guarantee. Internally geth will croak on that\r\n\r\nI appreciate the input but it leads to a broken state, so perhaps it should become a hard error.  Geth is not able to sync even after a restart and the `too many open files` error gone.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1766425020/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1770329239",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1770329239",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1770329239,
    "node_id": "IC_kwDOAOvK985phRSX",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-19T08:35:46Z",
    "updated_at": "2023-10-19T08:35:46Z",
    "author_association": "MEMBER",
    "body": "> Geth is not able to sync even after a restart and the too many open files error gone.\r\n\r\nAre you sure about this? Could you provide logs showing the errors - because (theoretically) it should work.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1770329239/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1770861142",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1770861142",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1770861142,
    "node_id": "IC_kwDOAOvK985pjTJW",
    "user": {
      "login": "adaszko",
      "id": 165678,
      "node_id": "MDQ6VXNlcjE2NTY3OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/165678?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adaszko",
      "html_url": "https://github.com/adaszko",
      "followers_url": "https://api.github.com/users/adaszko/followers",
      "following_url": "https://api.github.com/users/adaszko/following{/other_user}",
      "gists_url": "https://api.github.com/users/adaszko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adaszko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adaszko/subscriptions",
      "organizations_url": "https://api.github.com/users/adaszko/orgs",
      "repos_url": "https://api.github.com/users/adaszko/repos",
      "events_url": "https://api.github.com/users/adaszko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adaszko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-19T12:24:39Z",
    "updated_at": "2023-10-19T12:24:39Z",
    "author_association": "NONE",
    "body": "> > Geth is not able to sync even after a restart and the too many open files error gone.\r\n> \r\n> Are you sure about this? Could you provide logs showing the errors - because (theoretically) it should work.\r\n\r\nYes, absolutely sure.  I posted geth logs earlier.  I also captured Lighthouse logs in this gist: https://gist.github.com/adaszko/03002209abea3fb1e7bc909cff7d53b5\r\n\r\ngeth got stuck and I had to wipe out the state of both geth and lighthouse to force them to resume syncing again.\r\n\r\ngeth clearly refused (see the block hash in the logs) to process a block that etherscan considers totally valid: https://etherscan.io/block/18366358\r\n\r\nIs there something preventing geth from bailing out if isn't able to open the bad blocks database?  You said it yourself that that's the source of the problem.  Should I submit a PR?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1770861142/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1770884352",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1770884352",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1770884352,
    "node_id": "IC_kwDOAOvK985pjY0A",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-19T12:32:45Z",
    "updated_at": "2023-10-19T12:32:45Z",
    "author_association": "MEMBER",
    "body": "> Yes, absolutely sure. I posted geth logs earlier. \r\n\r\nAre you referring to the logs https://gist.githubusercontent.com/adaszko/03002209abea3fb1e7bc909cff7d53b5/raw/8a8eff8abd10cd36d65f89f141aceb749559d644/cant-sync-geth.log ? Those logs show the error still very much active and happening. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1770884352/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1770940824",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1770940824",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1770940824,
    "node_id": "IC_kwDOAOvK985pjmmY",
    "user": {
      "login": "adaszko",
      "id": 165678,
      "node_id": "MDQ6VXNlcjE2NTY3OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/165678?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adaszko",
      "html_url": "https://github.com/adaszko",
      "followers_url": "https://api.github.com/users/adaszko/followers",
      "following_url": "https://api.github.com/users/adaszko/following{/other_user}",
      "gists_url": "https://api.github.com/users/adaszko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adaszko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adaszko/subscriptions",
      "organizations_url": "https://api.github.com/users/adaszko/orgs",
      "repos_url": "https://api.github.com/users/adaszko/repos",
      "events_url": "https://api.github.com/users/adaszko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adaszko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-19T12:59:55Z",
    "updated_at": "2023-10-19T12:59:55Z",
    "author_association": "NONE",
    "body": "Yes, those logs.  Neither geth nor Lighthouse was making any progress in that state.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1770940824/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1770948382",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1770948382",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1770948382,
    "node_id": "IC_kwDOAOvK985pjoce",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-19T13:03:58Z",
    "updated_at": "2023-10-19T13:03:58Z",
    "author_association": "MEMBER",
    "body": "So, do you have any logs showing `not able to sync even after a restart and the too many open files error gone`? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1770948382/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1770990533",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1770990533",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1770990533,
    "node_id": "IC_kwDOAOvK985pjyvF",
    "user": {
      "login": "adaszko",
      "id": 165678,
      "node_id": "MDQ6VXNlcjE2NTY3OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/165678?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adaszko",
      "html_url": "https://github.com/adaszko",
      "followers_url": "https://api.github.com/users/adaszko/followers",
      "following_url": "https://api.github.com/users/adaszko/following{/other_user}",
      "gists_url": "https://api.github.com/users/adaszko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adaszko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adaszko/subscriptions",
      "organizations_url": "https://api.github.com/users/adaszko/orgs",
      "repos_url": "https://api.github.com/users/adaszko/repos",
      "events_url": "https://api.github.com/users/adaszko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adaszko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-19T13:27:50Z",
    "updated_at": "2023-10-19T13:31:21Z",
    "author_association": "NONE",
    "body": "My bad (actually, my colleague's :P)!  It turned out that the ulimit for open files wasn't *actually* increased.  It was running with the same ulimit and there was multiple errors that I missed:\r\n\r\n```\r\nOct 19 12:50:57 geth-lighthouse geth[1128887]: 2023/10/19 12:50:57 background error: open /var/lib/geth/geth/chaindata/521757.sst: too many open files\r\nOct 19 12:50:57 geth-lighthouse geth[1128887]: 2023/10/19 12:50:57 background error: open /var/lib/geth/geth/chaindata/585648.sst: too many open files\r\nOct 19 12:50:57 geth-lighthouse geth[1128887]: 2023/10/19 12:50:57 background error: open /var/lib/geth/geth/chaindata/585650.sst: too many open files\r\nOct 19 12:50:57 geth-lighthouse geth[1128887]: 2023/10/19 12:50:57 background error: open /var/lib/geth/geth/chaindata/585641.sst: too many open files\r\nOct 19 12:50:57 geth-lighthouse geth[1128887]: 2023/10/19 12:50:57 background error: open /var/lib/geth/geth/chaindata/585644.sst: too many open files\r\n```\r\n\r\nAgain, it would be easier to notice problems like this if geth simply exited on any such error.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1770990533/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1803476188",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1803476188",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1803476188,
    "node_id": "IC_kwDOAOvK985rftzc",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-09T09:35:56Z",
    "updated_at": "2023-11-09T09:35:56Z",
    "author_association": "MEMBER",
    "body": "> Again, it would be easier to notice problems like this if geth simply exited on any such error.\r\n\r\nIf geth does not exit, there's a chance that the node operator can solve the problem, and geth, when shutting down, can persist data in a good fashion. \r\n\r\nIf geth exits, it has no chance to actually save stuff, and the likelihood of data corruption is very high. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1803476188/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1803489485",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1803489485",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1803489485,
    "node_id": "IC_kwDOAOvK985rfxDN",
    "user": {
      "login": "adaszko",
      "id": 165678,
      "node_id": "MDQ6VXNlcjE2NTY3OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/165678?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adaszko",
      "html_url": "https://github.com/adaszko",
      "followers_url": "https://api.github.com/users/adaszko/followers",
      "following_url": "https://api.github.com/users/adaszko/following{/other_user}",
      "gists_url": "https://api.github.com/users/adaszko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adaszko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adaszko/subscriptions",
      "organizations_url": "https://api.github.com/users/adaszko/orgs",
      "repos_url": "https://api.github.com/users/adaszko/repos",
      "events_url": "https://api.github.com/users/adaszko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adaszko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-09T09:44:28Z",
    "updated_at": "2023-11-09T10:10:50Z",
    "author_association": "NONE",
    "body": "Thanks for stating your viewpoint.\r\n\r\n> If geth does not exit, there's a chance that the node operator can solve the problem, and geth, when shutting down, can persist data in a good fashion.\r\n\r\nIt's not possible to solve the open files problem without restarting geth.  There was no other processes running on the system that could free enough file descriptors.\r\n\r\n> If geth exits, it has no chance to actually save stuff, and the likelihood of data corruption is very high.\r\n\r\n\"exit\" doesn't need to be taken so literally here.  On an error, an exit sequence could be initiated with all necessary shutdowns/flushes/etc preventing corrruption.  The sense you're using it is usually referred to as \"aborting\".",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1803489485/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1803522928",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28363#issuecomment-1803522928",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28363",
    "id": 1803522928,
    "node_id": "IC_kwDOAOvK985rf5Nw",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-09T10:01:34Z",
    "updated_at": "2023-11-09T10:01:34Z",
    "author_association": "MEMBER",
    "body": "> It's not possible to solve the open files problem without restarting geth. \r\n\r\nIn general, the problem of \"too many open files\" can be solveable, e..g if the ulimit can be raised, or socket connections torn down (pull the internet cable), or a other programs with open files closed. In specific instances, it might not be.  \r\n\r\n> On an error, an exit sequence could be initiated with all necessary shutdowns/flushes/etc preventing corrruption.\r\n\r\nI think you misunderstood. What I meant was that if geth tries to do an orderly shutdown, that means _persisting stuff to disk_. And persisting stuff to disk has a very high likelihood of failing, if we've just encountered \"too many open files\". \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1803522928/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
