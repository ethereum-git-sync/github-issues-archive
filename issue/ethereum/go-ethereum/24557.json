{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24557",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24557/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24557/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24557/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/24557",
  "id": 1172418326,
  "node_id": "I_kwDOAOvK985F4a8W",
  "number": 24557,
  "title": "private network peer and miner don't connect with each other",
  "user": {
    "login": "huahuayu",
    "id": 1725060,
    "node_id": "MDQ6VXNlcjE3MjUwNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1725060?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/huahuayu",
    "html_url": "https://github.com/huahuayu",
    "followers_url": "https://api.github.com/users/huahuayu/followers",
    "following_url": "https://api.github.com/users/huahuayu/following{/other_user}",
    "gists_url": "https://api.github.com/users/huahuayu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/huahuayu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/huahuayu/subscriptions",
    "organizations_url": "https://api.github.com/users/huahuayu/orgs",
    "repos_url": "https://api.github.com/users/huahuayu/repos",
    "events_url": "https://api.github.com/users/huahuayu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/huahuayu/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-03-17T13:53:45Z",
  "updated_at": "2022-03-17T16:05:24Z",
  "closed_at": "2022-03-17T16:05:23Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Hi, I want build a local ethereum development environment, I do it by run several nodes in docker, Basically I followed the official [private-net-toturial](https://geth.ethereum.org/docs/getting-started/private-net), for convenient I wrote some script in this [repo](https://github.com/huahuayu/ethereum-local-development-env). \r\n\r\nThere's one problem, peer and miner don't connect with each other, although they share same bootnode.\r\n\r\nI spent several hours tried to find the issue but failed, I can provide more info, logs for example, please help to check.\r\n\r\n## Start nodes\r\n\r\n```bash\r\ngit clone https://github.com/huahuayu/ethereum-local-development-env.git\r\ncd ethereum-local-development-env\r\n./start_all.sh\r\n```\r\n\r\nCheck the containers\r\n\r\n```bash\r\ndocker ps | grep eth\r\n```\r\n\r\nNode info summary\r\n\r\n| node type | container name | enode                                   |\r\n| --------- | -------------- | --------------------------------------- |\r\n| bootnode  | eth-bootnode   | enode://$str@127.0.0.1:0?discport=30301 |\r\n| fullnode  | eth-node1      | enode://$str@127.0.0.1:30697            |\r\n| miner     | eth-miner1     | enode://$str@127.0.0.1:42983            |\r\n\r\nAll the node use same [genesis.json](https://github.com/huahuayu/ethereum-local-development-env/blob/master/genesis_file/eth/genesis.json) file.\r\n\r\n## Expected\r\n\r\n- [x] fullnode & miner can find and connect with each other, because they use same bootnode\r\n- [x] miner start mining\r\n- [x] fullnode keep syncing with miner\r\n\r\n## Actually\r\n\r\nOnly 1 matchs\r\n\r\n- [x] miner start mining\r\n\r\nFullnode can sense the highest block number change, but can't sync\r\n\r\nManually `admin.addPeer` not working too\r\n\r\n## Check status\r\n\r\nAfter a while (after the miner mined few blocks)\r\n\r\n**miner**\r\n\r\nMiner console `./attach.sh miner1`\r\n\r\n```bash\r\n> eth.syncing\r\nfalse\r\n\r\n> eth.blockNumber\r\n100\r\n\r\n> admin.peers\r\n[]\r\n```\r\n\r\n**fullnode**\r\n\r\nFullnode console `./attach.sh node1`\r\n\r\n```bash\r\n> eth.syncing\r\n{\r\n  ...\r\n  currentBlock: 0,\r\n  highestBlock: 100,\r\n  ...\r\n}\r\n\r\n> eth.blockNumber\r\n0\r\n\r\n> admin.peers\r\n[]\r\n```\r\n\r\n## Logs\r\n\r\nThis is the logs keep printing in peer\r\n\r\n```text\r\nINFO [03-17|15:45:58.446] Looking for peers                        peercount=0 tried=21 static=0\r\nINFO [03-17|15:46:08.483] Looking for peers                        peercount=0 tried=25 static=0\r\nINFO [03-17|15:46:09.055] State heal in progress                   accounts=0@0.00B   slots=0@0.00B codes=0@0.00B nodes=0@0.00B pending=1\r\nINFO [03-17|15:46:09.074] State heal in progress                   accounts=2@93.00B  slots=0@0.00B codes=0@0.00B nodes=3@314.00B pending=0\r\nWARN [03-17|15:46:09.099] Invalid header encountered               number=1 hash=532397..e41f42 parent=1fe3fd..dcc5b0 err=\"bad DAO pro-fork extra-data\"\r\nWARN [03-17|15:46:09.104] Synchronisation failed, dropping peer    peer=90c51af323cee4bcc745d6f3888d1a935bbac7bea4d7113fe70ed72f5465855c err=\"retrieved hash chain is invalid: bad DAO pro-fork extra-data\"\r\n```",
  "closed_by": {
    "login": "huahuayu",
    "id": 1725060,
    "node_id": "MDQ6VXNlcjE3MjUwNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1725060?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/huahuayu",
    "html_url": "https://github.com/huahuayu",
    "followers_url": "https://api.github.com/users/huahuayu/followers",
    "following_url": "https://api.github.com/users/huahuayu/following{/other_user}",
    "gists_url": "https://api.github.com/users/huahuayu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/huahuayu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/huahuayu/subscriptions",
    "organizations_url": "https://api.github.com/users/huahuayu/orgs",
    "repos_url": "https://api.github.com/users/huahuayu/repos",
    "events_url": "https://api.github.com/users/huahuayu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/huahuayu/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24557/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24557/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1071006226",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24557#issuecomment-1071006226",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24557",
    "id": 1071006226,
    "node_id": "IC_kwDOAOvK984_1kIS",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-17T15:52:38Z",
    "updated_at": "2022-03-17T15:52:38Z",
    "author_association": "MEMBER",
    "body": "Please delete the \r\n\r\n```\r\n    \"daoForkBlock\": 0,\r\n    \"daoForkSupport\": true,\r\n```\r\n\r\nfields from your genesis json.\r\n\r\nThis enabled the DAO fork, which requires special mining logic that has been deleted in Geth (since it's only relevant on mainnet, which forked 6 years ago).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1071006226/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1071021887",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24557#issuecomment-1071021887",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24557",
    "id": 1071021887,
    "node_id": "IC_kwDOAOvK984_1n8_",
    "user": {
      "login": "huahuayu",
      "id": 1725060,
      "node_id": "MDQ6VXNlcjE3MjUwNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1725060?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huahuayu",
      "html_url": "https://github.com/huahuayu",
      "followers_url": "https://api.github.com/users/huahuayu/followers",
      "following_url": "https://api.github.com/users/huahuayu/following{/other_user}",
      "gists_url": "https://api.github.com/users/huahuayu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huahuayu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huahuayu/subscriptions",
      "organizations_url": "https://api.github.com/users/huahuayu/orgs",
      "repos_url": "https://api.github.com/users/huahuayu/repos",
      "events_url": "https://api.github.com/users/huahuayu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huahuayu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-17T16:05:23Z",
    "updated_at": "2022-03-17T16:05:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "@karalabe thank you! that's the case, just now I turn the flag to `false` it works, I went back to close the issue and found you replied :)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1071021887/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
