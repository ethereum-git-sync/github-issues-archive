{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21059",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21059/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21059/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21059/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/21059",
  "id": 615776385,
  "node_id": "MDU6SXNzdWU2MTU3NzYzODU=",
  "number": 21059,
  "title": "[snapshotter]: generator does not exit orderly on shutdown ",
  "user": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1132754722,
      "node_id": "MDU6TGFiZWwxMTMyNzU0NzIy",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/need:more-information",
      "name": "need:more-information",
      "color": "db6fa3",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2020-05-11T10:31:08Z",
  "updated_at": "2021-09-12T10:51:50Z",
  "closed_at": "2020-06-11T09:42:21Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "I don't know if it's always been the case, or it's a regression.. but if the snapshot generator is doing it's job, it's not closed when geth it stopped. So it just goes on generating, and eventually the process is killed, and the next time we start it detects that it's corrupted. \r\n\r\n```\r\nINFO [05-11|10:23:28.428] Resuming state snapshot generation in=\"1a4fa1…3f633f\" at=\"ffdd51…6453a9\" accounts=2667281 slots=8908680 storage=789.94MiB elapsed=28m41.883s eta=4h10m31.616s\r\nINFO [05-11|10:23:28.619] Aborting state snapshot generation at=\"1a4fec…c54234\" accounts=2667406 slots=8910486 storage=790.07MiB elapsed=28m42.075s eta=4h10m32.559s\r\nINFO [05-11|10:23:28.620] Resuming state snapshot generation at=\"1a4fec…c54234\" accounts=2667406 slots=8910486 storage=790.07MiB elapsed=28m42.076s eta=4h10m32.568s\r\nINFO [05-11|10:23:28.773] Got interrupt, shutting down...\r\nINFO [05-11|10:23:28.781] HTTP endpoint closed url=http://[::]:8545/\r\nINFO [05-11|10:23:28.783] IPC endpoint closed url=/datadir/geth/geth.ipc\r\nINFO [05-11|10:23:28.836] Aborting state snapshot generation at=\"1a54ba…6282ea\" accounts=2669281 slots=8911374 storage=790.23MiB elapsed=28m42.291s eta=4h10m22.502s\r\nINFO [05-11|10:23:28.837] Resuming state snapshot generation at=\"1a54ba…6282ea\" accounts=2669281 slots=8911374 storage=790.23MiB elapsed=28m42.292s eta=4h10m22.511s\r\nINFO [05-11|10:23:29.028] Aborting state snapshot generation in=\"1a58bd…0a5b8d\" at=\"3bd126…30fd88\" accounts=2670829 slots=8912278 storage=790.37MiB elapsed=28m42.484s eta=4h10m14.226s\r\nINFO [05-11|10:23:29.029] Resuming state snapshot generation in=\"1a58bd…0a5b8d\" at=\"3bd126…30fd88\" accounts=2670829 slots=8912278 storage=790.37MiB elapsed=28m42.484s eta=4h10m14.226s\r\nINFO [05-11|10:23:29.199] Aborting state snapshot generation at=\"1a5a44…1e7889\" accounts=2671433 slots=8913955 storage=790.51MiB elapsed=28m42.654s eta=4h10m11.917s\r\nINFO [05-11|10:23:29.199] Resuming state snapshot generation at=\"1a5a44…1e7889\" accounts=2671433 slots=8913955 storage=790.51MiB elapsed=28m42.655s eta=4h10m11.925s\r\nINFO [05-11|10:23:29.398] Aborting state snapshot generation at=\"1a5f68…632e2b\" accounts=2673483 slots=8914567 storage=790.66MiB elapsed=28m42.854s eta=4h10m0.922s\r\nINFO [05-11|10:23:29.399] Resuming state snapshot generation at=\"1a5f68…632e2b\" accounts=2673483 slots=8914567 storage=790.66MiB elapsed=28m42.855s eta=4h10m0.931s\r\n```",
  "closed_by": {
    "login": "no-response[bot]",
    "id": 32965360,
    "node_id": "MDM6Qm90MzI5NjUzNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/26350515?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/no-response%5Bbot%5D",
    "html_url": "https://github.com/apps/no-response",
    "followers_url": "https://api.github.com/users/no-response%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/no-response%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/no-response%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/no-response%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/no-response%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/no-response%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/no-response%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/no-response%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/no-response%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21059/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21059/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/626639919",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21059#issuecomment-626639919",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21059",
    "id": 626639919,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjYzOTkxOQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-11T11:16:55Z",
    "updated_at": "2020-05-11T11:16:55Z",
    "author_association": "MEMBER",
    "body": "No, this was not always the case. I guess it's another regression with the eth shutdown \"fix\".",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/626639919/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/626789470",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21059#issuecomment-626789470",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21059",
    "id": 626789470,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjc4OTQ3MA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-11T15:52:42Z",
    "updated_at": "2020-05-11T15:53:48Z",
    "author_association": "MEMBER",
    "body": "Here are the logs: https://my.papertrailapp.com/systems/5254076742/events?focus=1196447807830175751&selected=1196447807830175751 . \r\nThis is `master` at commit `82f9ed49`\r\n\r\n`10:23:28.773] Got interrupt, shutting down`, then the last entry is ten seconds later\r\n```\r\n May 11 12:23:38 bench02.ethdevops.io geth INFO [05-11|10:23:38.716] Resuming state snapshot generation at=\"1ac4e8…701b74\" accounts=2714183 slots=8969009 storage=796.48MiB elapsed=28m52.172s eta=4h7m13.013s\r\n```\r\nAnd then the restart `12s` later:\r\n```\r\nMay 11 12:23:51 bench02.ethdevops.io geth WARN [05-11|10:23:50.961] The flag --pprofaddr is deprecated and will be removed in the future, please use --pprof.addr \r\n```\r\n\r\nSo it looks a bit odd -- it's not actually hitting the one-minute timeout, just seems to shut down uncleanly. I was just fooled by that 10s delay between interrupt and stop, I guess",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/626789470/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/626906177",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21059#issuecomment-626906177",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21059",
    "id": 626906177,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjkwNjE3Nw==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-11T19:21:55Z",
    "updated_at": "2020-05-11T19:21:55Z",
    "author_association": "MEMBER",
    "body": "I guess this was a false positive.. Perhaps more than one minute is needed, with snapshots requiring flushing too",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/626906177/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/627212014",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21059#issuecomment-627212014",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21059",
    "id": 627212014,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNzIxMjAxNA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-12T09:03:06Z",
    "updated_at": "2020-05-12T09:03:06Z",
    "author_association": "MEMBER",
    "body": "I tagged it more info needed, we can leave it for the PR bot to close this in a month if nobody says anything new.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/627212014/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/642536362",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21059#issuecomment-642536362",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21059",
    "id": 642536362,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0MjUzNjM2Mg==",
    "user": {
      "login": "no-response[bot]",
      "id": 32965360,
      "node_id": "MDM6Qm90MzI5NjUzNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/26350515?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/no-response%5Bbot%5D",
      "html_url": "https://github.com/apps/no-response",
      "followers_url": "https://api.github.com/users/no-response%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/no-response%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/no-response%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/no-response%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/no-response%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/no-response%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/no-response%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/no-response%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/no-response%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2020-06-11T09:42:20Z",
    "updated_at": "2020-06-11T09:42:20Z",
    "author_association": "NONE",
    "body": "This issue has been automatically closed because there has been no response to our request for more information from the original author. With only the information that is currently in the issue, we don't have enough information to take action. Please reach out if you have more relevant information or answers to our questions so that we can investigate further.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/642536362/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/917611309",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21059#issuecomment-917611309",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21059",
    "id": 917611309,
    "node_id": "IC_kwDOAOvK9842saMt",
    "user": {
      "login": "tiptan83",
      "id": 44696540,
      "node_id": "MDQ6VXNlcjQ0Njk2NTQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/44696540?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tiptan83",
      "html_url": "https://github.com/tiptan83",
      "followers_url": "https://api.github.com/users/tiptan83/followers",
      "following_url": "https://api.github.com/users/tiptan83/following{/other_user}",
      "gists_url": "https://api.github.com/users/tiptan83/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tiptan83/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tiptan83/subscriptions",
      "organizations_url": "https://api.github.com/users/tiptan83/orgs",
      "repos_url": "https://api.github.com/users/tiptan83/repos",
      "events_url": "https://api.github.com/users/tiptan83/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tiptan83/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-12T10:51:10Z",
    "updated_at": "2021-09-12T10:51:50Z",
    "author_association": "NONE",
    "body": "same issue is still open\r\n\r\nt=2021-09-12T13:46:32+0300 lvl=warn msg=\"Already shutting down, interrupt more to panic.\" times=9\r\nt=2021-09-12T13:46:34+0300 lvl=info msg=\"Generating state snapshot\" .....",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/917611309/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
