{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/16871",
  "id": 328813687,
  "node_id": "MDU6SXNzdWUzMjg4MTM2ODc=",
  "number": 16871,
  "title": "geth archive node gets stuck during full sync",
  "user": {
    "login": "shoenseiwaso",
    "id": 5861379,
    "node_id": "MDQ6VXNlcjU4NjEzNzk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5861379?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/shoenseiwaso",
    "html_url": "https://github.com/shoenseiwaso",
    "followers_url": "https://api.github.com/users/shoenseiwaso/followers",
    "following_url": "https://api.github.com/users/shoenseiwaso/following{/other_user}",
    "gists_url": "https://api.github.com/users/shoenseiwaso/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/shoenseiwaso/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/shoenseiwaso/subscriptions",
    "organizations_url": "https://api.github.com/users/shoenseiwaso/orgs",
    "repos_url": "https://api.github.com/users/shoenseiwaso/repos",
    "events_url": "https://api.github.com/users/shoenseiwaso/events{/privacy}",
    "received_events_url": "https://api.github.com/users/shoenseiwaso/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 12,
  "created_at": "2018-06-03T09:28:04Z",
  "updated_at": "2018-06-20T11:42:06Z",
  "closed_at": "2018-06-06T02:23:39Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version:\r\n```\r\n$ geth version\r\nGeth\r\nVersion: 1.8.8-stable\r\nGit Commit: 2688dab48c9b8ae71b8d95c7678817eaa17f2b53\r\nArchitecture: amd64\r\nProtocol Versions: [63 62]\r\nNetwork Id: 1\r\nGo Version: go1.10.1\r\nOperating System: linux\r\nGOPATH=\r\nGOROOT=/home/travis/.gimme/versions/go1.10.1.linux.amd64\r\n```\r\n\r\nGeth command line:\r\n```\r\nnohup geth --datadir \"/chaindata/.ethereum\" --ipcdisable --rpc --rpcaddr localhost --rpcport 8645 --rpcapi web3,eth,net,personal --rpccorsdomain http://localhost:* --ws --wsaddr localhost --wsport 8646 --wsapi web3,eth,net,personal --wsorigins \"*\" --rpcvhosts \"*\" --syncmode full --gcmode archive >> log/geth-standalone-log.txt 2>&1 &\r\n```\r\n\r\nOS & Version:\r\n```$ uname -a\r\nLinux ip-abc 4.4.0-1060-aws #69-Ubuntu SMP Sun May 20 13:42:07 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n\r\nMachine: AWS i3.2xlarge, 8 vCPU, 61 GiB RAM, 10 GigE Ethernet, 1 x 1.9 NVMe SSD (where .ethereum is located)\r\n\r\n#### Expected behaviour\r\nSyncing blocks would continue uninterrupted.\r\n\r\n#### Actual behaviour\r\nSyncing blocks stopped after about a day.\r\n\r\n#### Steps to reproduce the behaviour\r\nRan the archive node for about a day before it stopped syncing blocks. See the geth console out in the 'Backtrace' section below for more details.\r\n\r\n#### Backtrace\r\ngeth output including last few successful blocks sync'd, attempt to stop via `kill`, then panic after 9x more `kill` commands issued:\r\nhttps://gist.github.com/shoenseiwaso/aaceeda22d01cd4f1d3056e18a3125d3\r\n",
  "closed_by": {
    "login": "shoenseiwaso",
    "id": 5861379,
    "node_id": "MDQ6VXNlcjU4NjEzNzk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5861379?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/shoenseiwaso",
    "html_url": "https://github.com/shoenseiwaso",
    "followers_url": "https://api.github.com/users/shoenseiwaso/followers",
    "following_url": "https://api.github.com/users/shoenseiwaso/following{/other_user}",
    "gists_url": "https://api.github.com/users/shoenseiwaso/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/shoenseiwaso/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/shoenseiwaso/subscriptions",
    "organizations_url": "https://api.github.com/users/shoenseiwaso/orgs",
    "repos_url": "https://api.github.com/users/shoenseiwaso/repos",
    "events_url": "https://api.github.com/users/shoenseiwaso/events{/privacy}",
    "received_events_url": "https://api.github.com/users/shoenseiwaso/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/394149173",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16871#issuecomment-394149173",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871",
    "id": 394149173,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NDE0OTE3Mw==",
    "user": {
      "login": "shoenseiwaso",
      "id": 5861379,
      "node_id": "MDQ6VXNlcjU4NjEzNzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5861379?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shoenseiwaso",
      "html_url": "https://github.com/shoenseiwaso",
      "followers_url": "https://api.github.com/users/shoenseiwaso/followers",
      "following_url": "https://api.github.com/users/shoenseiwaso/following{/other_user}",
      "gists_url": "https://api.github.com/users/shoenseiwaso/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shoenseiwaso/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shoenseiwaso/subscriptions",
      "organizations_url": "https://api.github.com/users/shoenseiwaso/orgs",
      "repos_url": "https://api.github.com/users/shoenseiwaso/repos",
      "events_url": "https://api.github.com/users/shoenseiwaso/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shoenseiwaso/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-03T09:30:35Z",
    "updated_at": "2018-06-04T01:36:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "I should add that this has happened twice in the past two days. So it runs fine for about a day, then just stops syncing blocks until a forced panic and restart of geth.\r\n\r\n**Update**: it's now happening roughly every 30 minutes and I've instituted a watchdog script that `cron` runs every 2 minutes to monitor, kill (force it to panic) and restart as necessary. For those interested:\r\n\r\n```bash\r\n#!/bin/bash\r\n\r\nGETH_LOG_LAST=\"/eth/log/geth-log-last-line.txt\"\r\nGETH_LOG=\"/eth/log/geth-log.txt\"\r\n\r\nif [ \"$(cat $GETH_LOG_LAST)\" == \"$(tail -n 1 $GETH_LOG)\" ] && [ $(pgrep -x \"geth\") > 0 ]\r\nthen\r\n    for i in {1..11}\r\n    do\r\n        pkill -x \"geth\"\r\n        sleep 2\r\n    done\r\n\r\n    sleep 10\r\n    /eth/run-geth.sh\r\nelse\r\n    tail -n 1 $GETH_LOG > $GETH_LOG_LAST\r\nfi\r\n```\r\n\r\nAny pointers as to where it might be hanging? I'm thinking about installing the geth source code and attaching Delve to step through if necessary.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/394149173/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/394786042",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16871#issuecomment-394786042",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871",
    "id": 394786042,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NDc4NjA0Mg==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-05T17:03:15Z",
    "updated_at": "2018-06-05T17:03:15Z",
    "author_association": "MEMBER",
    "body": "Could you try with the latest stable release? We've added a warning that should in theory print warning when the database is compacting.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/394786042/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/394904275",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16871#issuecomment-394904275",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871",
    "id": 394904275,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NDkwNDI3NQ==",
    "user": {
      "login": "shoenseiwaso",
      "id": 5861379,
      "node_id": "MDQ6VXNlcjU4NjEzNzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5861379?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shoenseiwaso",
      "html_url": "https://github.com/shoenseiwaso",
      "followers_url": "https://api.github.com/users/shoenseiwaso/followers",
      "following_url": "https://api.github.com/users/shoenseiwaso/following{/other_user}",
      "gists_url": "https://api.github.com/users/shoenseiwaso/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shoenseiwaso/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shoenseiwaso/subscriptions",
      "organizations_url": "https://api.github.com/users/shoenseiwaso/orgs",
      "repos_url": "https://api.github.com/users/shoenseiwaso/repos",
      "events_url": "https://api.github.com/users/shoenseiwaso/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shoenseiwaso/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-06T00:43:26Z",
    "updated_at": "2018-06-06T00:43:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok thanks, will give it a try.\r\n\r\nIs there any way to completely disable leveldb compaction? I traced the code for `--nocompaction` and it looks like (as the `--help` text indicates) only works on import of a chain file. Will the database continue to work without compaction, just slower, or is it required? I'm less concerned at this point about the space usage, and more concerned about having a node unavailable for 10s of minutes or even hours at a time because it's compacting.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/394904275/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/394919179",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16871#issuecomment-394919179",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871",
    "id": 394919179,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NDkxOTE3OQ==",
    "user": {
      "login": "shoenseiwaso",
      "id": 5861379,
      "node_id": "MDQ6VXNlcjU4NjEzNzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5861379?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shoenseiwaso",
      "html_url": "https://github.com/shoenseiwaso",
      "followers_url": "https://api.github.com/users/shoenseiwaso/followers",
      "following_url": "https://api.github.com/users/shoenseiwaso/following{/other_user}",
      "gists_url": "https://api.github.com/users/shoenseiwaso/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shoenseiwaso/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shoenseiwaso/subscriptions",
      "organizations_url": "https://api.github.com/users/shoenseiwaso/orgs",
      "repos_url": "https://api.github.com/users/shoenseiwaso/repos",
      "events_url": "https://api.github.com/users/shoenseiwaso/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shoenseiwaso/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-06T02:23:39Z",
    "updated_at": "2018-06-06T02:23:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "Great, confirmed that latest stable (1.8.10) indeed prints messages that it's compacting. I'm going to close this issue, but would you be open to a pull request that includes an option such as `--no-ongoing-compaction` that disables this altogether? If we're running an archive node, would DB compaction really be beneficial?\r\n\r\n```bash\r\nINFO [06-06|02:12:57] Imported new chain segment               blocks=18 txs=3418 mgas=143.584 elapsed=8.165s mgasps=17.585 number=5690525 hash=0ee1ce…c686f0 cache=0.00B\r\nINFO [06-06|02:13:06] Imported new chain segment               blocks=16 txs=2843 mgas=127.796 elapsed=8.570s mgasps=14.911 number=5690541 hash=06153f…8320b6 cache=0.00B\r\nINFO [06-06|02:13:14] Imported new chain segment               blocks=16 txs=3624 mgas=126.255 elapsed=8.227s mgasps=15.345 number=5690557 hash=d69ee8…215349 cache=0.00B\r\nINFO [06-06|02:13:22] Imported new chain segment               blocks=16 txs=3228 mgas=127.621 elapsed=8.331s mgasps=15.318 number=5690573 hash=3bbe55…76e2ef cache=0.00B\r\nINFO [06-06|02:13:30] Imported new chain segment               blocks=16 txs=3204 mgas=118.254 elapsed=8.140s mgasps=14.526 number=5690589 hash=14b183…598e9f cache=0.00B\r\nWARN [06-06|02:13:32] Database compacting, degraded performance database=/chaindata/.ethereum/geth/chaindata\r\nWARN [06-06|02:14:33] Database compacting, degraded performance database=/chaindata/.ethereum/geth/chaindata\r\nWARN [06-06|02:15:33] Database compacting, degraded performance database=/chaindata/.ethereum/geth/chaindata\r\nWARN [06-06|02:16:34] Database compacting, degraded performance database=/chaindata/.ethereum/geth/chaindata\r\nWARN [06-06|02:17:34] Database compacting, degraded performance database=/chaindata/.ethereum/geth/chaindata\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/394919179/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/394920037",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16871#issuecomment-394920037",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871",
    "id": 394920037,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NDkyMDAzNw==",
    "user": {
      "login": "shoenseiwaso",
      "id": 5861379,
      "node_id": "MDQ6VXNlcjU4NjEzNzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5861379?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shoenseiwaso",
      "html_url": "https://github.com/shoenseiwaso",
      "followers_url": "https://api.github.com/users/shoenseiwaso/followers",
      "following_url": "https://api.github.com/users/shoenseiwaso/following{/other_user}",
      "gists_url": "https://api.github.com/users/shoenseiwaso/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shoenseiwaso/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shoenseiwaso/subscriptions",
      "organizations_url": "https://api.github.com/users/shoenseiwaso/orgs",
      "repos_url": "https://api.github.com/users/shoenseiwaso/repos",
      "events_url": "https://api.github.com/users/shoenseiwaso/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shoenseiwaso/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-06T02:29:15Z",
    "updated_at": "2018-06-06T02:29:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "BTW, DB compaction performance is less than ideal. Note the values for `iowait`:\r\n\r\n```\r\nFilesystem      Size  Used Avail Use% Mounted on\r\n/dev/xvda1       97G  1.5G   96G   2% /\r\n/dev/nvme0n1    1.8T  1.2T  520G  69% /chaindata\r\nLinux 4.4.0-1060-aws (ip-[masked]) \t06/06/2018 \t_x86_64_\t(8 CPU)\r\n\r\navg-cpu:  %user   %nice %system %iowait  %steal   %idle\r\n          16.31    0.00    0.83    0.82    0.02   82.01\r\n\r\nDevice:            tps    kB_read/s    kB_wrtn/s    kB_read    kB_wrtn\r\nxvda              0.33         4.61         2.73    1756047    1038656\r\nnvme0n1         786.38     10879.86     20320.98 4144706201 7741320738\r\n```\r\n\r\nBasically, only seeing 20 MB/s write, 10 MB/s read on a locally attached NVMe SSD (should be capable of 100s of MB/s R/W), backed up by <1% I/O wait, and the CPU is only 16% busy with user processes (i.e., geth).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/394920037/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/395370934",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16871#issuecomment-395370934",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871",
    "id": 395370934,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NTM3MDkzNA==",
    "user": {
      "login": "xuhcc",
      "id": 1660460,
      "node_id": "MDQ6VXNlcjE2NjA0NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1660460?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/xuhcc",
      "html_url": "https://github.com/xuhcc",
      "followers_url": "https://api.github.com/users/xuhcc/followers",
      "following_url": "https://api.github.com/users/xuhcc/following{/other_user}",
      "gists_url": "https://api.github.com/users/xuhcc/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/xuhcc/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/xuhcc/subscriptions",
      "organizations_url": "https://api.github.com/users/xuhcc/orgs",
      "repos_url": "https://api.github.com/users/xuhcc/repos",
      "events_url": "https://api.github.com/users/xuhcc/events{/privacy}",
      "received_events_url": "https://api.github.com/users/xuhcc/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-07T10:21:28Z",
    "updated_at": "2018-06-07T10:21:28Z",
    "author_association": "NONE",
    "body": "I'm too experiencing issues with db compaction, it could last for several hours. Same for CPU/RAM/disk usage, it is low.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/395370934/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/395372313",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16871#issuecomment-395372313",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871",
    "id": 395372313,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NTM3MjMxMw==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-07T10:26:58Z",
    "updated_at": "2018-06-07T10:26:58Z",
    "author_association": "MEMBER",
    "body": "Unfortunately compaction is just part of how leveldb operates. We have some plans for reorganizing some of the trie data that might help a bit with the compactions, but they will still be present.\r\n\r\nA wild idea might be to split the tries into individual epochs. That would duplicate some data (might be irrelevant at an archive node scale), but would restrict compactions to certain portions of the database opposed to throughout.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/395372313/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/395372625",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16871#issuecomment-395372625",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871",
    "id": 395372625,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NTM3MjYyNQ==",
    "user": {
      "login": "shoenseiwaso",
      "id": 5861379,
      "node_id": "MDQ6VXNlcjU4NjEzNzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5861379?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shoenseiwaso",
      "html_url": "https://github.com/shoenseiwaso",
      "followers_url": "https://api.github.com/users/shoenseiwaso/followers",
      "following_url": "https://api.github.com/users/shoenseiwaso/following{/other_user}",
      "gists_url": "https://api.github.com/users/shoenseiwaso/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shoenseiwaso/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shoenseiwaso/subscriptions",
      "organizations_url": "https://api.github.com/users/shoenseiwaso/orgs",
      "repos_url": "https://api.github.com/users/shoenseiwaso/repos",
      "events_url": "https://api.github.com/users/shoenseiwaso/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shoenseiwaso/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-07T10:28:15Z",
    "updated_at": "2018-06-07T10:28:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "@xuhcc we let DB compaction run for about a day and it didn’t finish so we killed it. We then restarted geth and I guess leveldb had compacted “enough” because we didn’t experience any further compactions through to the end of the full sync, about a million more blocks. The compaction also didn’t really save us any space. Hope that helps!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/395372625/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/396134988",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16871#issuecomment-396134988",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871",
    "id": 396134988,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NjEzNDk4OA==",
    "user": {
      "login": "RaghavSood",
      "id": 903072,
      "node_id": "MDQ6VXNlcjkwMzA3Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/903072?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RaghavSood",
      "html_url": "https://github.com/RaghavSood",
      "followers_url": "https://api.github.com/users/RaghavSood/followers",
      "following_url": "https://api.github.com/users/RaghavSood/following{/other_user}",
      "gists_url": "https://api.github.com/users/RaghavSood/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RaghavSood/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RaghavSood/subscriptions",
      "organizations_url": "https://api.github.com/users/RaghavSood/orgs",
      "repos_url": "https://api.github.com/users/RaghavSood/repos",
      "events_url": "https://api.github.com/users/RaghavSood/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RaghavSood/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-11T06:25:02Z",
    "updated_at": "2018-06-11T06:25:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "We're also seeing this on an archival node. Around 700000 blocks to go, and it's been compacting for days now. Restarting geth lets it sync a few more blocks before it starts compacting again",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/396134988/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/396189214",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16871#issuecomment-396189214",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871",
    "id": 396189214,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5NjE4OTIxNA==",
    "user": {
      "login": "shoenseiwaso",
      "id": 5861379,
      "node_id": "MDQ6VXNlcjU4NjEzNzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5861379?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shoenseiwaso",
      "html_url": "https://github.com/shoenseiwaso",
      "followers_url": "https://api.github.com/users/shoenseiwaso/followers",
      "following_url": "https://api.github.com/users/shoenseiwaso/following{/other_user}",
      "gists_url": "https://api.github.com/users/shoenseiwaso/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shoenseiwaso/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shoenseiwaso/subscriptions",
      "organizations_url": "https://api.github.com/users/shoenseiwaso/orgs",
      "repos_url": "https://api.github.com/users/shoenseiwaso/repos",
      "events_url": "https://api.github.com/users/shoenseiwaso/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shoenseiwaso/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-11T09:58:01Z",
    "updated_at": "2018-06-11T09:58:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Would it be worth investigating the knobs that go-leveldb offers around compaction? [This issue](https://github.com/syndtr/goleveldb/issues/212) suggests adjusting `CompactionTableSize` and `CompactionTableSizeMultiplier`. @karalabe do you know if anyone has done any work in this area before, or would it be worth investigating?\r\n\r\nI'm also wondering for a 1.7 TB geth database if it wouldn't be worth trying go-leveldb files larger than 2 MB as well.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/396189214/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/397878869",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16871#issuecomment-397878869",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871",
    "id": 397878869,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5Nzg3ODg2OQ==",
    "user": {
      "login": "giacecco",
      "id": 303693,
      "node_id": "MDQ6VXNlcjMwMzY5Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/303693?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/giacecco",
      "html_url": "https://github.com/giacecco",
      "followers_url": "https://api.github.com/users/giacecco/followers",
      "following_url": "https://api.github.com/users/giacecco/following{/other_user}",
      "gists_url": "https://api.github.com/users/giacecco/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/giacecco/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/giacecco/subscriptions",
      "organizations_url": "https://api.github.com/users/giacecco/orgs",
      "repos_url": "https://api.github.com/users/giacecco/repos",
      "events_url": "https://api.github.com/users/giacecco/events{/privacy}",
      "received_events_url": "https://api.github.com/users/giacecco/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-17T13:23:59Z",
    "updated_at": "2018-06-17T13:26:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "A quick note to share that running `geth` 1.8.11 from the official Docker image has the same issue. The console says that compaction is happening with one new message every minute, no progress % is given, and it just never ends, even after ~20 hours.\r\n\r\n`docker stats` does not show memory or CPU distress, CPU seems stable <25% and memory <2Gb (I am running this on Docker for MacOS with the total memory pushed up to 4Gb).\r\n\r\nUnfortunately I am doing this on a laptop that I need to take with me every now and then, hence I cannot leave it undisturbed for days, I need to interrupt the process occasionally, and my guess is that it restarts from scratch every time. \r\n\r\nAny suggestions? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/397878869/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/398719964",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16871#issuecomment-398719964",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16871",
    "id": 398719964,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5ODcxOTk2NA==",
    "user": {
      "login": "maxsiz",
      "id": 17234183,
      "node_id": "MDQ6VXNlcjE3MjM0MTgz",
      "avatar_url": "https://avatars.githubusercontent.com/u/17234183?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maxsiz",
      "html_url": "https://github.com/maxsiz",
      "followers_url": "https://api.github.com/users/maxsiz/followers",
      "following_url": "https://api.github.com/users/maxsiz/following{/other_user}",
      "gists_url": "https://api.github.com/users/maxsiz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/maxsiz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/maxsiz/subscriptions",
      "organizations_url": "https://api.github.com/users/maxsiz/orgs",
      "repos_url": "https://api.github.com/users/maxsiz/repos",
      "events_url": "https://api.github.com/users/maxsiz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/maxsiz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-20T11:42:05Z",
    "updated_at": "2018-06-20T11:42:05Z",
    "author_association": "NONE",
    "body": "Just for  information.\r\nDatabase compacting have successfully finished  after 18..20 minutes.  Then   syncing  continued  and  then finished too.   But    it    was  on Rinkeby network.\r\n\r\ngeth Version: 1.8.11-stable\r\nIntel® Core™ i5-3230M CPU @ 2.60GHz × 4 ,  RAM 7.7\r\nGo Version: go1.10\r\nOperating System: linux, ubuntu 16.04\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/398719964/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
