{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19286",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19286/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19286/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19286/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/19286",
  "id": 422075299,
  "node_id": "MDU6SXNzdWU0MjIwNzUyOTk=",
  "number": 19286,
  "title": "panic: interface conversion: interface {} is nil, not *types.Block",
  "user": {
    "login": "Swader",
    "id": 1430603,
    "node_id": "MDQ6VXNlcjE0MzA2MDM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1430603?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Swader",
    "html_url": "https://github.com/Swader",
    "followers_url": "https://api.github.com/users/Swader/followers",
    "following_url": "https://api.github.com/users/Swader/following{/other_user}",
    "gists_url": "https://api.github.com/users/Swader/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Swader/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Swader/subscriptions",
    "organizations_url": "https://api.github.com/users/Swader/orgs",
    "repos_url": "https://api.github.com/users/Swader/repos",
    "events_url": "https://api.github.com/users/Swader/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Swader/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2019-03-18T07:37:30Z",
  "updated_at": "2019-09-26T09:10:38Z",
  "closed_at": "2019-09-26T09:10:38Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `1.8.23`\r\nOS & Version: Ubuntu 18.04.2\r\n\r\n#### Expected behaviour\r\n\r\nAfter weeks of being in sync, if the full node is offline for a few days due to a power outage, it should be able to catch up and become in sync again.\r\n\r\n#### Actual behaviour\r\n\r\n```bash\r\nINFO [03-18|07:31:09.725] Disk storage enabled for ethash caches   dir=/home/ethereum/.ethereum/geth/ethash count=3\r\nINFO [03-18|07:31:09.725] Disk storage enabled for ethash DAGs     dir=/home/ethereum/.ethash               count=2\r\nINFO [03-18|07:31:09.787] Initialising Ethereum protocol           versions=\"[63 62]\" network=1\r\nWARN [03-18|07:31:10.802] Head block missing, resetting chain      hash=5414aaâ€¦aaf1f5\r\nWARN [03-18|07:31:10.802] Rewinding blockchain                     target=0\r\npanic: interface conversion: interface {} is nil, not *types.Block\r\n\r\ngoroutine 1 [running]:\r\ngithub.com/ethereum/go-ethereum/core.(*BlockChain).CurrentBlock(...)\r\n        /home/travis/gopath/src/github.com/ethereum/go-ethereum/core/blockchain.go:359\r\ngithub.com/ethereum/go-ethereum/core.(*BlockChain).SetHead(0x40195d4000, 0x0, 0x0, 0x0)\r\n        /home/travis/gopath/src/github.com/ethereum/go-ethereum/core/blockchain.go:302 +0x8a0\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n- Full sync a mainnet node\r\n- Pull the plug\r\n- Wait a few days\r\n- Reset the node\r\n\r\n#### Other info\r\n\r\nThis is part of my [Ethereum on ARM experiment](https://www.reddit.com/r/ethereum/comments/alnmxn/ethereum_on_arm_geth_and_parity_clients_update/). It took a week to fully sync, so starting from 0 is obviously not an acceptable solution, not when there's a chance of this so easily happening again.\r\n\r\nI have the full 171GB in chaindata, so all my data is still there from the full sync from before.\r\n\r\nThis issue has also been posted in [StackExchange](https://ethereum.stackexchange.com/q/68453/31497).",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19286/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19286/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/474276446",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19286#issuecomment-474276446",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19286",
    "id": 474276446,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDI3NjQ0Ng==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-19T09:57:30Z",
    "updated_at": "2019-03-19T09:57:30Z",
    "author_association": "MEMBER",
    "body": "```golang\r\n\tif currentBlock := bc.CurrentBlock(); currentBlock != nil && currentHeader.Number.Uint64() < currentBlock.NumberU64() {\r\n\t\tbc.currentBlock.Store(bc.GetBlock(currentHeader.Hash(), currentHeader.Number.Uint64()))\r\n}\r\n```\r\nand \r\n```golang\r\n// CurrentBlock retrieves the current head block of the canonical chain. The\r\n// block is retrieved from the blockchain's internal cache.\r\nfunc (bc *BlockChain) CurrentBlock() *types.Block {\r\n\treturn bc.currentBlock.Load().(*types.Block)\r\n}\r\n```\r\n\r\nSo the calling code expects that `GetCurrentBlock` can return `nil`, however, internally it will blow up on the type conversion. \r\n\r\nHere's some possible ways to solve it: \r\n\r\n- Either store a `nil` block interface at init\r\n- Or do a `nil`-check in `CurrentBlock` before conversion\r\n- Or fix `Reset` to work differently",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/474276446/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/474281943",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19286#issuecomment-474281943",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19286",
    "id": 474281943,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NDI4MTk0Mw==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-19T10:09:05Z",
    "updated_at": "2019-03-19T10:09:05Z",
    "author_association": "MEMBER",
    "body": "Best way to fix would be not calling `Reset` in `loadLastState`. `Reset` is API that can be used after the BlockChain is already created but `loadLastState` runs in the constructor and some things like current block pointer aren't set up yet. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/474281943/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/477586493",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19286#issuecomment-477586493",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19286",
    "id": 477586493,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzU4NjQ5Mw==",
    "user": {
      "login": "Swader",
      "id": 1430603,
      "node_id": "MDQ6VXNlcjE0MzA2MDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1430603?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Swader",
      "html_url": "https://github.com/Swader",
      "followers_url": "https://api.github.com/users/Swader/followers",
      "following_url": "https://api.github.com/users/Swader/following{/other_user}",
      "gists_url": "https://api.github.com/users/Swader/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Swader/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Swader/subscriptions",
      "organizations_url": "https://api.github.com/users/Swader/orgs",
      "repos_url": "https://api.github.com/users/Swader/repos",
      "events_url": "https://api.github.com/users/Swader/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Swader/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-28T13:06:16Z",
    "updated_at": "2019-03-28T13:06:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "Any fix branch I can test on?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/477586493/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/477589979",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19286#issuecomment-477589979",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19286",
    "id": 477589979,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzU4OTk3OQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-28T13:16:04Z",
    "updated_at": "2019-03-28T13:16:04Z",
    "author_association": "MEMBER",
    "body": "Sorry, not yet, it's in my backlog. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/477589979/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/477957146",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19286#issuecomment-477957146",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19286",
    "id": 477957146,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3Nzk1NzE0Ng==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-29T10:59:14Z",
    "updated_at": "2019-03-29T10:59:14Z",
    "author_association": "MEMBER",
    "body": "PR is up for testing: https://github.com/ethereum/go-ethereum/pull/19352 . However, a word of caution\r\n\r\n> t took a week to fully sync, so starting from 0 is obviously not an acceptable solution, not when there's a chance of this so easily happening again.\r\n\r\nThe fix _will_ reset from `0`, since the fix only handles the `panic`. It might be possible to salvage your data, but please not that the PR does _not_ attempt to do so.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/477957146/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
