{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14594",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14594/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14594/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14594/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/14594",
  "id": 234281741,
  "node_id": "MDU6SXNzdWUyMzQyODE3NDE=",
  "number": 14594,
  "title": "Private network on single node occasionally fails to process a transaction",
  "user": {
    "login": "ckeenan",
    "id": 1154540,
    "node_id": "MDQ6VXNlcjExNTQ1NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1154540?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ckeenan",
    "html_url": "https://github.com/ckeenan",
    "followers_url": "https://api.github.com/users/ckeenan/followers",
    "following_url": "https://api.github.com/users/ckeenan/following{/other_user}",
    "gists_url": "https://api.github.com/users/ckeenan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ckeenan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ckeenan/subscriptions",
    "organizations_url": "https://api.github.com/users/ckeenan/orgs",
    "repos_url": "https://api.github.com/users/ckeenan/repos",
    "events_url": "https://api.github.com/users/ckeenan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ckeenan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 856638432,
      "node_id": "MDU6TGFiZWw4NTY2Mzg0MzI=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:inactive",
      "name": "status:inactive",
      "color": "ffffff",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2017-06-07T17:16:12Z",
  "updated_at": "2019-03-02T03:17:42Z",
  "closed_at": "2019-03-02T03:17:42Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `1.6.6-unstable`\r\nOS & Version: OSX\r\nCommit hash : 6171d01b1195abd7ac75044dcd507d4758d83cde\r\n\r\n#### Expected behaviour\r\nFor a private network running on a single node, sending a series of transactions from an account with correct nonces which are received by the client without error will eventually be included in a block.\r\n\r\n#### Actual behaviour\r\nOccasionally, perhaps 5% of the time, when sending a series of transactions (let's say 5+) on a single-node private network (either clique or ethash), geth will get \"stuck\" on one transaction and remove the higher-nonced transactions from the mempool. This occurs even though all sent transaction hashes are logged as a \"Submitted transaction\" by geth. Details about the \"stuck\" transaction are visible via web3.eth.getTransaction, showing blockNumber as null, blockHash as 0x00.... The response from web3.eth.getTransactionCount for the sender matches the nonce of the stuck transaction. The pending block shows an empty transaction array and the txpool lists no queued or pending transactions. Attempting to resubmit the stuck transaction results in the error: `Error: known transaction: <hash>`. If a different transaction with the same nonce is submitted, it will get processed and the client proceeds as usual.\r\n\r\n#### Steps to reproduce the behaviour\r\nStart a single-node private network with an unlocked and well-endowed coinbase. Repeatedly run this js snipped until it hangs \"waiting on\" a particular hash, then inspect the stuck transaction:\r\n```\r\nn = 30;\r\nnonce = web3.eth.getTransactionCount(web3.eth.coinbase);\r\nreceived = 0;\r\n\r\nhashArray = []\r\nhashMap = {}\r\n\r\nfor (var i = 0; i < n; i++) {\r\n    txNonce = nonce++;\r\n    hash = web3.eth.sendTransaction({from: web3.eth.coinbase, to: web3.eth.coinbase, value: 1, nonce: txNonce})\r\n    console.log(nonce, hash)\r\n    hashArray.push(hash);\r\n    hashMap[hash] = txNonce;\r\n}\r\n\r\nblockFilter = web3.eth.filter('latest')\r\n\r\nblockFilter.watch(function(err, log) {\r\n    var receipt = true;\r\n    while (receipt) {\r\n        receipt = web3.eth.getTransactionReceipt(hashArray[received]);\r\n        if (receipt) {\r\n            hash = hashArray[received];\r\n            console.log('seen', hashMap[hash], hash);\r\n            received++;\r\n        }\r\n    }\r\n    console.log('received', received)\r\n    console.log('waiting on', hashArray[received])\r\n    console.log('pending block transactions', web3.eth.getBlock('pending').transactions)\r\n    if (received == hashArray.length) {\r\n        console.log('DONE');\r\n        blockFilter.stopWatching();\r\n    }\r\n})\r\n```\r\n",
  "closed_by": {
    "login": "stale[bot]",
    "id": 26384082,
    "node_id": "MDM6Qm90MjYzODQwODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stale%5Bbot%5D",
    "html_url": "https://github.com/apps/stale",
    "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14594/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14594/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/308385825",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14594#issuecomment-308385825",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14594",
    "id": 308385825,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwODM4NTgyNQ==",
    "user": {
      "login": "bas-vk",
      "id": 4280775,
      "node_id": "MDQ6VXNlcjQyODA3NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4280775?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bas-vk",
      "html_url": "https://github.com/bas-vk",
      "followers_url": "https://api.github.com/users/bas-vk/followers",
      "following_url": "https://api.github.com/users/bas-vk/following{/other_user}",
      "gists_url": "https://api.github.com/users/bas-vk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bas-vk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bas-vk/subscriptions",
      "organizations_url": "https://api.github.com/users/bas-vk/orgs",
      "repos_url": "https://api.github.com/users/bas-vk/repos",
      "events_url": "https://api.github.com/users/bas-vk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bas-vk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-14T10:04:36Z",
    "updated_at": "2017-06-14T10:04:36Z",
    "author_association": "MEMBER",
    "body": "I tried to reproduce the issue but failed to do so. Could you run geth with the following option:\r\n`geth --vmodule=core/*=6` and dump the log in a gist and post it here when you hit this problem?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/308385825/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/308472069",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14594#issuecomment-308472069",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14594",
    "id": 308472069,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwODQ3MjA2OQ==",
    "user": {
      "login": "ckeenan",
      "id": 1154540,
      "node_id": "MDQ6VXNlcjExNTQ1NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1154540?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ckeenan",
      "html_url": "https://github.com/ckeenan",
      "followers_url": "https://api.github.com/users/ckeenan/followers",
      "following_url": "https://api.github.com/users/ckeenan/following{/other_user}",
      "gists_url": "https://api.github.com/users/ckeenan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ckeenan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ckeenan/subscriptions",
      "organizations_url": "https://api.github.com/users/ckeenan/orgs",
      "repos_url": "https://api.github.com/users/ckeenan/repos",
      "events_url": "https://api.github.com/users/ckeenan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ckeenan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-14T15:41:50Z",
    "updated_at": "2017-06-14T15:42:50Z",
    "author_association": "NONE",
    "body": "Sure. https://gist.github.com/ckeenan/11be006c0b228503b4e309e87d34fd7b is a full log of running that script 3 times with n=30. The third run, it stops on hash `0xa8d8bbea95a10e82c9e03190ae46e0f4459ced6b9c86771ea943a35ba9e49bcb`\r\n\r\nwith the following RPC results\r\n```\r\n> web3.eth.getTransaction('0xa8d8bbea95a10e82c9e03190ae46e0f4459ced6b9c86771ea943a35ba9e49bcb')\r\n{ blockHash: '0x0000000000000000000000000000000000000000000000000000000000000000',\r\n  blockNumber: null,\r\n  from: '0x41ad2bc63a2059f9b623533d87fe99887d794847',\r\n  gas: 90000,\r\n  gasPrice: { [String: '18000000000'] s: 1, e: 10, c: [ 18000000000 ] },\r\n  hash: '0xa8d8bbea95a10e82c9e03190ae46e0f4459ced6b9c86771ea943a35ba9e49bcb',\r\n  input: '0x',\r\n  nonce: 855,\r\n  to: '0x41ad2bc63a2059f9b623533d87fe99887d794847',\r\n  transactionIndex: 0,\r\n  value: { [String: '1'] s: 1, e: 0, c: [ 1 ] },\r\n  v: '0x1d4a7',\r\n  r: '0xceb20f788d75fcc3a8eac919e83f5570869b9604000401fc2e5f885321767dc3',\r\n  s: '0x32ee226faac42f9cfa0c0b7b4852ec18ec8517f92049ed09c25d12cbb73ca172' }\r\n\r\n> web3.eth.getTransactionCount('0x41ad2bc63a2059f9b623533d87fe99887d794847')\r\n855\r\n```\r\n\r\nAlso I have been testing previous docker builds and fwiw the latest `stable` tag does not appear to have this problem\r\nHere is the output of `geth version` from that build:\r\n```\r\nGeth\r\nVersion: 1.6.1-stable\r\nArchitecture: amd64\r\nProtocol Versions: [63 62]\r\nNetwork Id: 1\r\nGo Version: go1.7.3\r\nOperating System: linux\r\nGOPATH=\r\nGOROOT=/usr/lib/go\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/308472069/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/308669527",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14594#issuecomment-308669527",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14594",
    "id": 308669527,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMwODY2OTUyNw==",
    "user": {
      "login": "bas-vk",
      "id": 4280775,
      "node_id": "MDQ6VXNlcjQyODA3NzU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4280775?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bas-vk",
      "html_url": "https://github.com/bas-vk",
      "followers_url": "https://api.github.com/users/bas-vk/followers",
      "following_url": "https://api.github.com/users/bas-vk/following{/other_user}",
      "gists_url": "https://api.github.com/users/bas-vk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bas-vk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bas-vk/subscriptions",
      "organizations_url": "https://api.github.com/users/bas-vk/orgs",
      "repos_url": "https://api.github.com/users/bas-vk/repos",
      "events_url": "https://api.github.com/users/bas-vk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bas-vk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-06-15T08:48:10Z",
    "updated_at": "2017-06-15T08:48:10Z",
    "author_association": "MEMBER",
    "body": "Are you sure that you use commit 6171d01? The output of the console doesn't match the output of that commit. Also, which chain id are you using?\r\n\r\nCould you run the test again with:\r\n`geth --vmodule=miner/*=6`\r\n\r\nand post the output in a gist, together with the hash of the transaction that get stuck?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/308669527/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/355860803",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14594#issuecomment-355860803",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14594",
    "id": 355860803,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM1NTg2MDgwMw==",
    "user": {
      "login": "pcardune",
      "id": 124827,
      "node_id": "MDQ6VXNlcjEyNDgyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/124827?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcardune",
      "html_url": "https://github.com/pcardune",
      "followers_url": "https://api.github.com/users/pcardune/followers",
      "following_url": "https://api.github.com/users/pcardune/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcardune/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcardune/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcardune/subscriptions",
      "organizations_url": "https://api.github.com/users/pcardune/orgs",
      "repos_url": "https://api.github.com/users/pcardune/repos",
      "events_url": "https://api.github.com/users/pcardune/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcardune/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-07T23:09:04Z",
    "updated_at": "2018-01-07T23:09:04Z",
    "author_association": "NONE",
    "body": "Did anyone ever figure out what was causing this and how to fix it? I'm seeing something similar with a puppeth-based testnet running on a single machine with geth-1.8 unstable.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/355860803/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/455743676",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14594#issuecomment-455743676",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14594",
    "id": 455743676,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1NTc0MzY3Ng==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2019-01-19T03:00:28Z",
    "updated_at": "2019-01-19T03:00:28Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/455743676/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
