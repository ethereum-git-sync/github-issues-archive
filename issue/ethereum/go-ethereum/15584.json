{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15584",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15584/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15584/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15584/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/15584",
  "id": 278002073,
  "node_id": "MDU6SXNzdWUyNzgwMDIwNzM=",
  "number": 15584,
  "title": "Why using Mutex in lightFetcher, peerHasBlock(), les/fetcher.go?",
  "user": {
    "login": "OniReimu",
    "id": 22544855,
    "node_id": "MDQ6VXNlcjIyNTQ0ODU1",
    "avatar_url": "https://avatars.githubusercontent.com/u/22544855?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/OniReimu",
    "html_url": "https://github.com/OniReimu",
    "followers_url": "https://api.github.com/users/OniReimu/followers",
    "following_url": "https://api.github.com/users/OniReimu/following{/other_user}",
    "gists_url": "https://api.github.com/users/OniReimu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/OniReimu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/OniReimu/subscriptions",
    "organizations_url": "https://api.github.com/users/OniReimu/orgs",
    "repos_url": "https://api.github.com/users/OniReimu/repos",
    "events_url": "https://api.github.com/users/OniReimu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/OniReimu/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 856638432,
      "node_id": "MDU6TGFiZWw4NTY2Mzg0MzI=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:inactive",
      "name": "status:inactive",
      "color": "ffffff",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2017-11-30T05:21:58Z",
  "updated_at": "2019-01-19T03:01:13Z",
  "closed_at": "2019-01-19T03:01:13Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `geth 1.6.7`\r\nOS & Version: Windows/Linux/OSX\r\n\r\n#### Expected behaviour\r\nFrom my own setting, every time a light client receiving an announce message from a light server and try to invoke `InsertHeaderChain()` in `light/lightchain.go`, now it will try to fetch info of this certain header from the light server. And the info received will be entered into a pre-defined verification function. Only passing ones will be inserted, not otherwise. \r\n\r\n#### Actual behaviour\r\nThe function got stuck at right after the `f.lock.Lock()` in `peerHasBlock()` in `les/fetcher.go`, no more actions will be conducted afterwards, which contributes to the fact that a light node cannot sync with light servers whenever they starts from the same height. The process just gets stuck and the other actions have to wait in the execqueue, and infinite loop. Thus even `> exit` fails unless I Ctrl+C 10 times to force exit.\r\n\r\n#### Workaround\r\nI replaced the \r\n```\r\nf.lock.Lock()\r\ndefer f.lock.Unlock()\r\n```\r\nwith \r\n```\r\nf.reqMu.RLock()\r\ndefer f.reqMu.RUnlock()\r\n```\r\nAnd all good thus they are all reading processes.\r\n\r\n#### Confusion\r\n\r\n- What is the point that you guys use Mutex here rather than RWMutex?\r\n\r\n- Is it good to use RWMutex in here?\r\n\r\n- What does it mean by the comment related to the definition of Mutex locker of lightFetcher? It actually shows`lock       sync.Mutex // qwerqwerqwe` \r\n",
  "closed_by": {
    "login": "stale[bot]",
    "id": 26384082,
    "node_id": "MDM6Qm90MjYzODQwODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stale%5Bbot%5D",
    "html_url": "https://github.com/apps/stale",
    "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15584/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15584/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/349435621",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15584#issuecomment-349435621",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15584",
    "id": 349435621,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0OTQzNTYyMQ==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-12-05T20:43:49Z",
    "updated_at": "2017-12-05T20:43:49Z",
    "author_association": "MEMBER",
    "body": "@zsfelfoldi please look",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/349435621/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/445032482",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15584#issuecomment-445032482",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15584",
    "id": 445032482,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NTAzMjQ4Mg==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2018-12-06T21:17:13Z",
    "updated_at": "2018-12-06T21:17:13Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/445032482/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
