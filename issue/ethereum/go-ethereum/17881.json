{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17881",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17881/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17881/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17881/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/17881",
  "id": 368455849,
  "node_id": "MDU6SXNzdWUzNjg0NTU4NDk=",
  "number": 17881,
  "title": "CREATE2 can be ran twice creating code at the same address instead of reverting (no storage is changed)",
  "user": {
    "login": "eggy-eth",
    "id": 44010363,
    "node_id": "MDQ6VXNlcjQ0MDEwMzYz",
    "avatar_url": "https://avatars.githubusercontent.com/u/44010363?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/eggy-eth",
    "html_url": "https://github.com/eggy-eth",
    "followers_url": "https://api.github.com/users/eggy-eth/followers",
    "following_url": "https://api.github.com/users/eggy-eth/following{/other_user}",
    "gists_url": "https://api.github.com/users/eggy-eth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/eggy-eth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/eggy-eth/subscriptions",
    "organizations_url": "https://api.github.com/users/eggy-eth/orgs",
    "repos_url": "https://api.github.com/users/eggy-eth/repos",
    "events_url": "https://api.github.com/users/eggy-eth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/eggy-eth/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2018-10-10T01:10:38Z",
  "updated_at": "2023-04-29T03:16:04Z",
  "closed_at": "2018-10-10T06:49:57Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `Version: 1.8.17-stable`\r\nOS & Version: OSX\r\n\r\n#### Expected behaviour\r\nCREATE2 reverts tx if a contract is tried to be deployed twice at the same address\r\n\r\n#### Actual behaviour\r\nDoes not revert. Uses more gas than in the initial creation. For some reason does not alter the storage even though there is a check to see if the storage is altered. Does return address 0x0 on the second create.\r\n\r\n#### Steps to reproduce the behaviour\r\n1) Deploy the TestMe contract\r\n2) Call Deploy with any seed and set argument to any value.\r\n3) Verify that the contract A is created at the address which can be found in Last (CurrVal should be same as argument)\r\n4) Now redeploy TestMe: use the same seed but a different argument\r\n5) The code now re-runs, does not revert. Last is now 0x0. The CurrVal in A does not change.\r\n```solidity\r\ncontract TestMe{\r\n    \r\n    address public Last;\r\n    \r\n    uint public Argument;\r\n    \r\n    function Deploy(uint seed, uint arg) public returns (address) {\r\n        Argument = arg;\r\n        // ctr is the actual runtime bytecode of contract A \r\n        // compiled with 0.5.0-nightly.2018.10.9+commit.4ab2e03b.Emscripten.clang in remix\r\n        bytes memory ctr = hex'608060405234801561001057600080fd5b50600033905080600160a060020a0316631543b3136040518163ffffffff167c010000000000000000000000000000000000000000000000000000000002815260040160206040518083038186803b15801561006b57600080fd5b505afa15801561007f573d6000803e3d6000fd5b505050506040513d602081101561009557600080fd5b5051600055506099806100a96000396000f3fe608060405260043610603e5763ffffffff7c0100000000000000000000000000000000000000000000000000000000600035041663f1aab64181146043575b600080fd5b348015604e57600080fd5b5060556067565b60408051918252519081900360200190f35b6000548156fea165627a7a723058205665d5eb639b7be5314a60862785a6b2285a4de4f2a382d6f5aa4ddf8917e9570029';\r\n        address a;\r\n        assembly{\r\n            let pointer := ctr\r\n            let len := mload(pointer)\r\n            let start := add(pointer, 0x20)\r\n            a := create2(0, start, len, seed)\r\n        }\r\n        Last = a;\r\n        return (a);\r\n    }\r\n}\r\n\r\ncontract A{\r\n    uint public CurrVal;\r\n    constructor() public {\r\n        TestMe target = TestMe(msg.sender);\r\n        CurrVal = target.Argument();\r\n    }\r\n}\r\n```\r\n\r\nNote: you cannot pass \"argument\" in the constructor because this changes the init_code.\r\n\r\nBy EIP 1014 create2 at an address which has already code OR a nonce it should revert.",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17881/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17881/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/428457820",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/17881#issuecomment-428457820",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17881",
    "id": 428457820,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyODQ1NzgyMA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-10-10T06:49:57Z",
    "updated_at": "2018-10-10T06:49:57Z",
    "author_association": "MEMBER",
    "body": "> By EIP 1014 create2 at an address which has already code OR a nonce it should revert. \r\n\r\nNope, the [EIP](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1014.md) reads:\r\n\r\n>Specifically, if nonce or code is nonzero, then the create-operation fails.\r\n\r\nIf a create-operation succeeds, the new address will be returned on the top of the stack. If you get a `0` on the top of the stack, the create has failed. Which seems to be exactly what happened: \" Last is now 0x0.\" ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/428457820/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1528578011",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/17881#issuecomment-1528578011",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17881",
    "id": 1528578011,
    "node_id": "IC_kwDOAOvK985bHD_b",
    "user": {
      "login": "ElKornacio",
      "id": 5374757,
      "node_id": "MDQ6VXNlcjUzNzQ3NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5374757?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ElKornacio",
      "html_url": "https://github.com/ElKornacio",
      "followers_url": "https://api.github.com/users/ElKornacio/followers",
      "following_url": "https://api.github.com/users/ElKornacio/following{/other_user}",
      "gists_url": "https://api.github.com/users/ElKornacio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ElKornacio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ElKornacio/subscriptions",
      "organizations_url": "https://api.github.com/users/ElKornacio/orgs",
      "repos_url": "https://api.github.com/users/ElKornacio/repos",
      "events_url": "https://api.github.com/users/ElKornacio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ElKornacio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-29T03:16:04Z",
    "updated_at": "2023-04-29T03:16:04Z",
    "author_association": "NONE",
    "body": "@holiman I think it is quite reasonable to state this in the EIP more explicitly. Right now, [EIP-684](https://github.com/ethereum/EIPs/issues/684) says:\r\n> ... the destination address already has either nonzero nonce, or nonempty code, then the creation **throws immediately**\r\n\r\nAnd [EIP-1014](https://github.com/ethereum/EIPs/issues/1014) says: \"The behaviour at collisions is specified by [EIP-684](https://github.com/ethereum/EIPs/issues/684)\". And even quotes the line above.\r\n\r\nSo it doesn't feel obvious that after the words \"throws immediately\", the phase \"the create-operation fails\" means \"zero on top of the stack\".",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1528578011/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
