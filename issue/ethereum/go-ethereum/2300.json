{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2300",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2300/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2300/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2300/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/2300",
  "id": 139010620,
  "node_id": "MDU6SXNzdWUxMzkwMTA2MjA=",
  "number": 2300,
  "title": "Duplicate events reported by get_ethFilterChanges",
  "user": {
    "login": "dabooz",
    "id": 14004614,
    "node_id": "MDQ6VXNlcjE0MDA0NjE0",
    "avatar_url": "https://avatars.githubusercontent.com/u/14004614?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dabooz",
    "html_url": "https://github.com/dabooz",
    "followers_url": "https://api.github.com/users/dabooz/followers",
    "following_url": "https://api.github.com/users/dabooz/following{/other_user}",
    "gists_url": "https://api.github.com/users/dabooz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dabooz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dabooz/subscriptions",
    "organizations_url": "https://api.github.com/users/dabooz/orgs",
    "repos_url": "https://api.github.com/users/dabooz/repos",
    "events_url": "https://api.github.com/users/dabooz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dabooz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "obscuren",
    "id": 6264126,
    "node_id": "MDQ6VXNlcjYyNjQxMjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6264126?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/obscuren",
    "html_url": "https://github.com/obscuren",
    "followers_url": "https://api.github.com/users/obscuren/followers",
    "following_url": "https://api.github.com/users/obscuren/following{/other_user}",
    "gists_url": "https://api.github.com/users/obscuren/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/obscuren/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/obscuren/subscriptions",
    "organizations_url": "https://api.github.com/users/obscuren/orgs",
    "repos_url": "https://api.github.com/users/obscuren/repos",
    "events_url": "https://api.github.com/users/obscuren/events{/privacy}",
    "received_events_url": "https://api.github.com/users/obscuren/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "obscuren",
      "id": 6264126,
      "node_id": "MDQ6VXNlcjYyNjQxMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6264126?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/obscuren",
      "html_url": "https://github.com/obscuren",
      "followers_url": "https://api.github.com/users/obscuren/followers",
      "following_url": "https://api.github.com/users/obscuren/following{/other_user}",
      "gists_url": "https://api.github.com/users/obscuren/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/obscuren/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/obscuren/subscriptions",
      "organizations_url": "https://api.github.com/users/obscuren/orgs",
      "repos_url": "https://api.github.com/users/obscuren/repos",
      "events_url": "https://api.github.com/users/obscuren/events{/privacy}",
      "received_events_url": "https://api.github.com/users/obscuren/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/milestones/20",
    "html_url": "https://github.com/ethereum/go-ethereum/milestone/20",
    "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/milestones/20/labels",
    "id": 1299388,
    "node_id": "MDk6TWlsZXN0b25lMTI5OTM4OA==",
    "number": 20,
    "title": "1.4.0",
    "description": "",
    "creator": {
      "login": "obscuren",
      "id": 6264126,
      "node_id": "MDQ6VXNlcjYyNjQxMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6264126?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/obscuren",
      "html_url": "https://github.com/obscuren",
      "followers_url": "https://api.github.com/users/obscuren/followers",
      "following_url": "https://api.github.com/users/obscuren/following{/other_user}",
      "gists_url": "https://api.github.com/users/obscuren/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/obscuren/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/obscuren/subscriptions",
      "organizations_url": "https://api.github.com/users/obscuren/orgs",
      "repos_url": "https://api.github.com/users/obscuren/repos",
      "events_url": "https://api.github.com/users/obscuren/events{/privacy}",
      "received_events_url": "https://api.github.com/users/obscuren/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 141,
    "state": "closed",
    "created_at": "2015-09-10T13:53:50Z",
    "updated_at": "2016-08-17T20:07:24Z",
    "due_on": null,
    "closed_at": "2016-05-10T10:44:41Z"
  },
  "comments": 2,
  "created_at": "2016-03-07T15:43:06Z",
  "updated_at": "2016-05-10T10:44:36Z",
  "closed_at": "2016-05-10T10:44:36Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I am running in a private chain (v1.3.3), go ethereum. Sometimes (it is recreateable) eth_getFilterChanges will return duplicate events. I have a fair amount of detail for you, so hopefully the following is clear. I have 2 go threads, each thread is tracking a different contract address. Each thread wakes up every 15 seconds and calls eth_getFilterChanges. Sometimes (maybe once an hour?) the response to that API call will return duplicate events. That is, only 1 event has occurred on the blockchain but the API returns an array of 2 events, dup of each other. These are events that my contract creates as it runs. Here's something interesting. In one instance of the problem, both threads saw duplicate events in the EXACT SAME BLOCK. My 2 contracts do call each other, so it makes sense that both contracts will have an event in the same block but there shouldnt be duplicates. This seems interesting to me because this is happening from 2 different calls (remember I have 2 threads) to the eth_getFilterChanges API (using different filter ids), so this says to me that the duplicate events are not a problem with the API itself but seem to have something to do with the block state that the events are in.\n\nHere's another interesting thing to note. I blew away my geth client's local state (db, ethash etc), restarted it, allowed it to resync to the chain, then I started my threads again. When the threads dumped events for the block in question (this time using eth_getFilterLogs), there were NO duplicate entries. So, whatever block state was confused previously, was resolved by the restart. Further, this also tells me that the dup events DO NOT exist in the blockchain, again it seems to have something to do with the local block state from which get_ethFilterChanges derives it's data.\n\nIn order to try to help resolve this issue, I created a scaled down testcase. I've attached a geth log, a log from my RPC client, my RPC client code, and my solidity file inside the zip file. You probably wont be able to run the program directly because I havent provided all the other libraries but you will be able to clearly see what's going on in the testcase.\n\n[event-defect.zip](https://github.com/ethereum/go-ethereum/files/161569/event-defect.zip)\n",
  "closed_by": {
    "login": "obscuren",
    "id": 6264126,
    "node_id": "MDQ6VXNlcjYyNjQxMjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6264126?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/obscuren",
    "html_url": "https://github.com/obscuren",
    "followers_url": "https://api.github.com/users/obscuren/followers",
    "following_url": "https://api.github.com/users/obscuren/following{/other_user}",
    "gists_url": "https://api.github.com/users/obscuren/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/obscuren/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/obscuren/subscriptions",
    "organizations_url": "https://api.github.com/users/obscuren/orgs",
    "repos_url": "https://api.github.com/users/obscuren/repos",
    "events_url": "https://api.github.com/users/obscuren/events{/privacy}",
    "received_events_url": "https://api.github.com/users/obscuren/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2300/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2300/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/193662048",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2300#issuecomment-193662048",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2300",
    "id": 193662048,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5MzY2MjA0OA==",
    "user": {
      "login": "obscuren",
      "id": 6264126,
      "node_id": "MDQ6VXNlcjYyNjQxMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6264126?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/obscuren",
      "html_url": "https://github.com/obscuren",
      "followers_url": "https://api.github.com/users/obscuren/followers",
      "following_url": "https://api.github.com/users/obscuren/following{/other_user}",
      "gists_url": "https://api.github.com/users/obscuren/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/obscuren/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/obscuren/subscriptions",
      "organizations_url": "https://api.github.com/users/obscuren/orgs",
      "repos_url": "https://api.github.com/users/obscuren/repos",
      "events_url": "https://api.github.com/users/obscuren/events{/privacy}",
      "received_events_url": "https://api.github.com/users/obscuren/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-08T08:30:32Z",
    "updated_at": "2016-03-08T08:30:32Z",
    "author_association": "MEMBER",
    "body": "Thanks for the detailed report. Will take a look\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/193662048/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/193821389",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2300#issuecomment-193821389",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2300",
    "id": 193821389,
    "node_id": "MDEyOklzc3VlQ29tbWVudDE5MzgyMTM4OQ==",
    "user": {
      "login": "dabooz",
      "id": 14004614,
      "node_id": "MDQ6VXNlcjE0MDA0NjE0",
      "avatar_url": "https://avatars.githubusercontent.com/u/14004614?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dabooz",
      "html_url": "https://github.com/dabooz",
      "followers_url": "https://api.github.com/users/dabooz/followers",
      "following_url": "https://api.github.com/users/dabooz/following{/other_user}",
      "gists_url": "https://api.github.com/users/dabooz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dabooz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dabooz/subscriptions",
      "organizations_url": "https://api.github.com/users/dabooz/orgs",
      "repos_url": "https://api.github.com/users/dabooz/repos",
      "events_url": "https://api.github.com/users/dabooz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dabooz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-03-08T15:19:27Z",
    "updated_at": "2016-03-08T15:19:27Z",
    "author_association": "NONE",
    "body": "Reran my test on 1.3.4 this morning and I can still recreate the dup event problem.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/193821389/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
