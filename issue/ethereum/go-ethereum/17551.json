{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17551",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17551/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17551/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17551/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/17551",
  "id": 355463829,
  "node_id": "MDU6SXNzdWUzNTU0NjM4Mjk=",
  "number": 17551,
  "title": "Wrong unpack result for negative BigNumber",
  "user": {
    "login": "favadi",
    "id": 782760,
    "node_id": "MDQ6VXNlcjc4Mjc2MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/782760?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/favadi",
    "html_url": "https://github.com/favadi",
    "followers_url": "https://api.github.com/users/favadi/followers",
    "following_url": "https://api.github.com/users/favadi/following{/other_user}",
    "gists_url": "https://api.github.com/users/favadi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/favadi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/favadi/subscriptions",
    "organizations_url": "https://api.github.com/users/favadi/orgs",
    "repos_url": "https://api.github.com/users/favadi/repos",
    "events_url": "https://api.github.com/users/favadi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/favadi/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2018-08-30T07:44:55Z",
  "updated_at": "2018-09-05T03:01:52Z",
  "closed_at": "2018-09-05T03:01:52Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: unrelated\r\nOS & Version: Windows/Linux/OSX\r\nCommit hash : 62e94895da80838ec694b4ba19eeac80c9dc88c1\r\n\r\n#### Expected behaviour\r\n\r\n`int256` should be unpacked to correct `*big.Int` value.\r\n\r\n#### Actual behaviour\r\n\r\nNegative `int256` output is unpackaged `*big.Int` to positive `*big.Int` value.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n```go\r\npackage balance\r\n\r\nimport (\r\n\t\"bytes\"\r\n\t\"encoding/hex\"\r\n\t\"math/big\"\r\n\t\"testing\"\r\n\r\n\t\"github.com/ethereum/go-ethereum/accounts/abi\"\r\n)\r\n\r\nfunc TestInt256Unpack(t *testing.T) {\r\n\tconst method = \"aTestMethod\"\r\n\tconst output = \"ffffffffffffffffffffffffffffffffffffffffffffffec6dc439894e200000\"\r\n\tconst abiJSON = `[{\r\n  \"constant\":true,\r\n  \"inputs\":[\r\n  ],\r\n  \"name\":\"aTestMethod\",\r\n  \"outputs\":[\r\n    {\r\n      \"name\":\"\",\r\n      \"type\":\"int256\"\r\n    }\r\n  ],\r\n  \"payable\":false,\r\n  \"stateMutability\":\"view\",\r\n  \"type\":\"function\"\r\n}]`\r\n\r\n\tvar ret = big.NewInt(0)\r\n\toutputBytes, err := hex.DecodeString(output)\r\n\tif err != nil {\r\n\t\tt.Fatal()\r\n\t}\r\n\tpricingABI, err := abi.JSON(bytes.NewReader([]byte(abiJSON)))\r\n\tif err != nil {\r\n\t\tt.Fatal(err)\r\n\t}\r\n\r\n\tif err = pricingABI.Unpack(&ret, method, outputBytes); err != nil {\r\n\t\tt.Fatal(err)\r\n\t}\r\n\tif ret.Sign() != -1 {\r\n\t\tt.Errorf(\"result should be negative, got: %s\", ret.String())\r\n\t}\r\n}\r\n```\r\n\r\noutput: `115792089237316195423570985008687907853269984665640564039096558636546392064000`\r\n\r\nWeb3.js unpackaged the correct value.\r\n\r\n```js\r\n    const web3 = new Web3()\r\n    console.log(\r\n      web3.eth.abi.decodeParameter(\r\n        'int256',\r\n        '0xffffffffffffffffffffffffffffffffffffffffffffffec6dc439894e200000'\r\n      )\r\n    )\r\n```\r\n\r\noutput: `-361025371366737575936`",
  "closed_by": {
    "login": "favadi",
    "id": 782760,
    "node_id": "MDQ6VXNlcjc4Mjc2MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/782760?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/favadi",
    "html_url": "https://github.com/favadi",
    "followers_url": "https://api.github.com/users/favadi/followers",
    "following_url": "https://api.github.com/users/favadi/following{/other_user}",
    "gists_url": "https://api.github.com/users/favadi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/favadi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/favadi/subscriptions",
    "organizations_url": "https://api.github.com/users/favadi/orgs",
    "repos_url": "https://api.github.com/users/favadi/repos",
    "events_url": "https://api.github.com/users/favadi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/favadi/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17551/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17551/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/417277788",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/17551#issuecomment-417277788",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17551",
    "id": 417277788,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNzI3Nzc4OA==",
    "user": {
      "login": "cyberliem",
      "id": 13779034,
      "node_id": "MDQ6VXNlcjEzNzc5MDM0",
      "avatar_url": "https://avatars.githubusercontent.com/u/13779034?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cyberliem",
      "html_url": "https://github.com/cyberliem",
      "followers_url": "https://api.github.com/users/cyberliem/followers",
      "following_url": "https://api.github.com/users/cyberliem/following{/other_user}",
      "gists_url": "https://api.github.com/users/cyberliem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cyberliem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cyberliem/subscriptions",
      "organizations_url": "https://api.github.com/users/cyberliem/orgs",
      "repos_url": "https://api.github.com/users/cyberliem/repos",
      "events_url": "https://api.github.com/users/cyberliem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cyberliem/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-30T10:54:44Z",
    "updated_at": "2018-08-30T10:54:44Z",
    "author_association": "NONE",
    "body": "This is due to the fact that bigInt.SetBytes as used [here](https://github.com/ethereum/go-ethereum/blob/62e94895da80838ec694b4ba19eeac80c9dc88c1/accounts/abi/unpack.go#L48) assume that the byte array represent positive number. Byte array to negative Big number is currently unsupported by math/big. Consider using custom arithmetic logic instead.  ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/417277788/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/417289685",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/17551#issuecomment-417289685",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17551",
    "id": 417289685,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxNzI4OTY4NQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-08-30T11:42:25Z",
    "updated_at": "2018-08-30T11:42:25Z",
    "author_association": "MEMBER",
    "body": "Well, big.Int might not have a way to set a negative byte array, but we should most definitely be able to handle that case by explicitly pre/post processing the number.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/417289685/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/418306765",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/17551#issuecomment-418306765",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17551",
    "id": 418306765,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODMwNjc2NQ==",
    "user": {
      "login": "favadi",
      "id": 782760,
      "node_id": "MDQ6VXNlcjc4Mjc2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/782760?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/favadi",
      "html_url": "https://github.com/favadi",
      "followers_url": "https://api.github.com/users/favadi/followers",
      "following_url": "https://api.github.com/users/favadi/following{/other_user}",
      "gists_url": "https://api.github.com/users/favadi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/favadi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/favadi/subscriptions",
      "organizations_url": "https://api.github.com/users/favadi/orgs",
      "repos_url": "https://api.github.com/users/favadi/repos",
      "events_url": "https://api.github.com/users/favadi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/favadi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-04T09:44:20Z",
    "updated_at": "2018-09-04T09:44:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "I created #17583 to fix the wrong int256 unpack value.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/418306765/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/418584184",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/17551#issuecomment-418584184",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17551",
    "id": 418584184,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQxODU4NDE4NA==",
    "user": {
      "login": "favadi",
      "id": 782760,
      "node_id": "MDQ6VXNlcjc4Mjc2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/782760?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/favadi",
      "html_url": "https://github.com/favadi",
      "followers_url": "https://api.github.com/users/favadi/followers",
      "following_url": "https://api.github.com/users/favadi/following{/other_user}",
      "gists_url": "https://api.github.com/users/favadi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/favadi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/favadi/subscriptions",
      "organizations_url": "https://api.github.com/users/favadi/orgs",
      "repos_url": "https://api.github.com/users/favadi/repos",
      "events_url": "https://api.github.com/users/favadi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/favadi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-05T03:01:49Z",
    "updated_at": "2018-09-05T03:01:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "As https://github.com/ethereum/go-ethereum/pull/17583 is merged, the issue is fixed.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/418584184/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
