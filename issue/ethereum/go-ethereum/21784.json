{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21784",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21784/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21784/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21784/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/21784",
  "id": 735514433,
  "node_id": "MDU6SXNzdWU3MzU1MTQ0MzM=",
  "number": 21784,
  "title": "Block timestamp equals last block received time, not mining time",
  "user": {
    "login": "Taodactyl",
    "id": 73904049,
    "node_id": "MDQ6VXNlcjczOTA0MDQ5",
    "avatar_url": "https://avatars.githubusercontent.com/u/73904049?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Taodactyl",
    "html_url": "https://github.com/Taodactyl",
    "followers_url": "https://api.github.com/users/Taodactyl/followers",
    "following_url": "https://api.github.com/users/Taodactyl/following{/other_user}",
    "gists_url": "https://api.github.com/users/Taodactyl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Taodactyl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Taodactyl/subscriptions",
    "organizations_url": "https://api.github.com/users/Taodactyl/orgs",
    "repos_url": "https://api.github.com/users/Taodactyl/repos",
    "events_url": "https://api.github.com/users/Taodactyl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Taodactyl/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-11-03T17:38:24Z",
  "updated_at": "2021-04-07T13:50:22Z",
  "closed_at": "2020-11-05T09:25:48Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "As I experiments with hosting a full node, I've runned this little code to understand block propagation in the network :\r\n\r\n```\r\nconst web3 = initWeb3();\r\nconst newBlockHeaders = web3.eth.subscribe(\"newBlockHeaders\");\r\nnewBlockHeaders.on(\"data\", async (blockHeader) => {\r\n    console.log(\"block: \" + blockHeader[\"number\"] + \" - ts: \" + blockHeader[\"timestamp\"] + \" - received at: \" + Math.floor(new Date() / 1000));\r\n});\r\n```\r\n\r\n#### System information\r\n\r\nGeth version: `Geth\r\nVersion: 1.9.23-stable\r\nGit Commit: 8c2f271528f9cccf541c6ea1c022e98407f26872\r\nArchitecture: amd64\r\nProtocol Versions: [65 64 63]\r\nGo Version: go1.15\r\nOperating System: linux\r\nGOPATH=\r\nGOROOT=go\r\n`\r\nOS & Version: Ubuntu 20.04.1 LTS\r\n\r\n#### Expected behaviour\r\n\r\nThe new block's timestamp is equal to the time of mining on the remote node. If a new block is mined at TS=1234, sent to the network and received by my node at TS=1257, I expect the block timestamp to be 1234, not 1257.\r\n\r\n#### Actual behaviour\r\n\r\nHere is a dump of the result :\r\n\r\n```\r\nblock: 11185527 - ts: 1604424887 - received at: 1604424911\r\nblock: 11185528 - ts: 1604424911 - received at: 1604424915\r\nblock: 11185529 - ts: 1604424914 - received at: 1604424934\r\nblock: 11185530 - ts: 1604424935 - received at: 1604424970\r\nblock: 11185531 - ts: 1604424970 - received at: 1604424979\r\nblock: 11185532 - ts: 1604424979 - received at: 1604424983\r\nblock: 11185533 - ts: 1604424983 - received at: 1604424987\r\nblock: 11185534 - ts: 1604424987 - received at: 1604424991\r\nblock: 11185535 - ts: 1604424991 - received at: 1604425007\r\nblock: 11185536 - ts: 1604425007 - received at: 1604425013\r\nblock: 11185537 - ts: 1604425012 - received at: 1604425027\r\nblock: 11185538 - ts: 1604425026 - received at: 1604425031\r\n```\r\n\r\nYou can see that the received block's timestamp is equal to the last block received time (accounting for rounding errors and time execution of my code). My guess is that the timestamp of the next block to be mined is set when we receive a block. I checked the timestamps for a few block, they are the same in the geth console and on etherscan.io",
  "closed_by": {
    "login": "ligi",
    "id": 111600,
    "node_id": "MDQ6VXNlcjExMTYwMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ligi",
    "html_url": "https://github.com/ligi",
    "followers_url": "https://api.github.com/users/ligi/followers",
    "following_url": "https://api.github.com/users/ligi/following{/other_user}",
    "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
    "organizations_url": "https://api.github.com/users/ligi/orgs",
    "repos_url": "https://api.github.com/users/ligi/repos",
    "events_url": "https://api.github.com/users/ligi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ligi/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21784/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21784/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/722254187",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21784#issuecomment-722254187",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21784",
    "id": 722254187,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyMjI1NDE4Nw==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-05T09:24:43Z",
    "updated_at": "2020-11-05T09:24:43Z",
    "author_association": "MEMBER",
    "body": "The block timestamp is set when the miner _starts_ working on the block. So it will most likely be pretty close to the time when the previous block was propagated on the network. The header needs to be set before the pow-grinding starts. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/722254187/reactions",
      "total_count": 4,
      "+1": 4,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/814930784",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21784#issuecomment-814930784",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21784",
    "id": 814930784,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNDkzMDc4NA==",
    "user": {
      "login": "isramali1",
      "id": 19797505,
      "node_id": "MDQ6VXNlcjE5Nzk3NTA1",
      "avatar_url": "https://avatars.githubusercontent.com/u/19797505?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/isramali1",
      "html_url": "https://github.com/isramali1",
      "followers_url": "https://api.github.com/users/isramali1/followers",
      "following_url": "https://api.github.com/users/isramali1/following{/other_user}",
      "gists_url": "https://api.github.com/users/isramali1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/isramali1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/isramali1/subscriptions",
      "organizations_url": "https://api.github.com/users/isramali1/orgs",
      "repos_url": "https://api.github.com/users/isramali1/repos",
      "events_url": "https://api.github.com/users/isramali1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/isramali1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-07T13:50:22Z",
    "updated_at": "2021-04-07T13:50:22Z",
    "author_association": "NONE",
    "body": "> The block timestamp is set when the miner _starts_ working on the block. So it will most likely be pretty close to the time when the previous block was propagated on the network. The header needs to be set before the pow-grinding starts.\r\n\r\nI would like to change the block timestamp from seconds to milliseconds to be more precise. \r\nI wonder if it is possible to point me to the source-code line at which the timestamp is recorded by the miner. \r\nThanks.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/814930784/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
