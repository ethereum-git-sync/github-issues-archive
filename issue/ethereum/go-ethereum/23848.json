{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23848",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23848/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23848/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23848/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23848",
  "id": 1042488846,
  "node_id": "I_kwDOAOvK984-Ix4O",
  "number": 23848,
  "title": "Some tests fail with data races",
  "user": {
    "login": "piersy",
    "id": 5087847,
    "node_id": "MDQ6VXNlcjUwODc4NDc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5087847?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/piersy",
    "html_url": "https://github.com/piersy",
    "followers_url": "https://api.github.com/users/piersy/followers",
    "following_url": "https://api.github.com/users/piersy/following{/other_user}",
    "gists_url": "https://api.github.com/users/piersy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/piersy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/piersy/subscriptions",
    "organizations_url": "https://api.github.com/users/piersy/orgs",
    "repos_url": "https://api.github.com/users/piersy/repos",
    "events_url": "https://api.github.com/users/piersy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/piersy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "zsfelfoldi",
    "id": 9884311,
    "node_id": "MDQ6VXNlcjk4ODQzMTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9884311?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zsfelfoldi",
    "html_url": "https://github.com/zsfelfoldi",
    "followers_url": "https://api.github.com/users/zsfelfoldi/followers",
    "following_url": "https://api.github.com/users/zsfelfoldi/following{/other_user}",
    "gists_url": "https://api.github.com/users/zsfelfoldi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zsfelfoldi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zsfelfoldi/subscriptions",
    "organizations_url": "https://api.github.com/users/zsfelfoldi/orgs",
    "repos_url": "https://api.github.com/users/zsfelfoldi/repos",
    "events_url": "https://api.github.com/users/zsfelfoldi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zsfelfoldi/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "zsfelfoldi",
      "id": 9884311,
      "node_id": "MDQ6VXNlcjk4ODQzMTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9884311?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zsfelfoldi",
      "html_url": "https://github.com/zsfelfoldi",
      "followers_url": "https://api.github.com/users/zsfelfoldi/followers",
      "following_url": "https://api.github.com/users/zsfelfoldi/following{/other_user}",
      "gists_url": "https://api.github.com/users/zsfelfoldi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zsfelfoldi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zsfelfoldi/subscriptions",
      "organizations_url": "https://api.github.com/users/zsfelfoldi/orgs",
      "repos_url": "https://api.github.com/users/zsfelfoldi/repos",
      "events_url": "https://api.github.com/users/zsfelfoldi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zsfelfoldi/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-11-02T15:12:09Z",
  "updated_at": "2021-12-14T10:34:50Z",
  "closed_at": "2021-12-14T10:34:50Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `geth version`\r\n```\r\nGeth\r\nVersion: 1.10.11-stable\r\nGit Commit: 7231b3efb8095d3dd18d7164c3fa84d7705759d3\r\nArchitecture: amd64\r\nGo Version: go1.17.1\r\nOperating System: darwin\r\nGOPATH=/Users/piersy/go\r\nGOROOT=go\r\n```\r\nOS & Version: OSX\r\n\r\n#### Expected behaviour\r\n\r\nTests should not encounter data races\r\n\r\n#### Actual behaviour\r\n\r\nSome tests do encounter data races, logs below:\r\n\r\n`vflux/client`\r\n```\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c0002f8090 by goroutine 56:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPoolTest).run()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:237 +0x108\r\n  github.com/ethereum/go-ethereum/les/vflux/client.testServerPool()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:299 +0x9b\r\n  github.com/ethereum/go-ethereum/les/vflux/client.TestServerPoolWithPreNeg()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:292 +0x35\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n\r\nPrevious read at 0x00c0002f8090 by goroutine 23:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPoolTest).start.func1()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:115 +0x152\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPool).addPreNegFilter.func1.1()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool.go:275 +0x65\r\n\r\nGoroutine 56 (running) created at:\r\n  testing.(*T).Run()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x726\r\n  testing.runTests.func1()\r\n      /usr/local/go/src/testing/testing.go:1598 +0x99\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.runTests()\r\n      /usr/local/go/src/testing/testing.go:1596 +0x7ca\r\n  testing.(*M).Run()\r\n      /usr/local/go/src/testing/testing.go:1504 +0x9d1\r\n  main.main()\r\n      _testmain.go:87 +0x22b\r\n\r\nGoroutine 23 (running) created at:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPool).addPreNegFilter.func1()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool.go:274 +0x293\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).setState.func1()\r\n      /Users/piersy/projects/go-ethereum/p2p/nodestate/nodestate.go:687 +0x165\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).opFinish()\r\n      /Users/piersy/projects/go-ethereum/p2p/nodestate/nodestate.go:722 +0x1e1\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).SetState()\r\n      /Users/piersy/projects/go-ethereum/p2p/nodestate/nodestate.go:633 +0x211\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*FillSet).readLoop()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/fillset.go:81 +0x9e\r\n  github.com/ethereum/go-ethereum/les/vflux/client.NewFillSet·dwrap·1()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/fillset.go:64 +0x39\r\n==================\r\n--- FAIL: TestServerPoolWithPreNeg (0.19s)\r\n    testing.go:1152: race detected during execution of test\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c0002f8258 by goroutine 92:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPoolTest).start()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:158 +0x717\r\n  github.com/ethereum/go-ethereum/les/vflux/client.testServerPoolRestartNoDiscovery()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:336 +0x109\r\n  github.com/ethereum/go-ethereum/les/vflux/client.TestServerPoolRestartNoDiscovery()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:323 +0x30\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n\r\nPrevious read at 0x00c0002f8258 by goroutine 84:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPoolTest).start.func3()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:170 +0x77\r\n\r\nGoroutine 92 (running) created at:\r\n  testing.(*T).Run()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x726\r\n  testing.runTests.func1()\r\n      /usr/local/go/src/testing/testing.go:1598 +0x99\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.runTests()\r\n      /usr/local/go/src/testing/testing.go:1596 +0x7ca\r\n  testing.(*M).Run()\r\n      /usr/local/go/src/testing/testing.go:1504 +0x9d1\r\n  main.main()\r\n      _testmain.go:87 +0x22b\r\n\r\nGoroutine 84 (finished) created at:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPoolTest).start()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:159 +0x7cb\r\n  github.com/ethereum/go-ethereum/les/vflux/client.testServerPoolRestartNoDiscovery()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:331 +0x8e\r\n  github.com/ethereum/go-ethereum/les/vflux/client.TestServerPoolRestartNoDiscovery()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:323 +0x30\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n==================\r\n--- FAIL: TestServerPoolRestartNoDiscovery (0.18s)\r\n    testing.go:1152: race detected during execution of test\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c0002f8390 by goroutine 18:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPoolTest).run()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:237 +0x108\r\n  github.com/ethereum/go-ethereum/les/vflux/client.testServerPoolRestartNoDiscovery()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:332 +0x98\r\n  github.com/ethereum/go-ethereum/les/vflux/client.TestServerPoolRestartNoDiscoveryWithPreNeg()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:325 +0x33\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n\r\nPrevious read at 0x00c0002f8390 by goroutine 88:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPoolTest).start.func1()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:115 +0x152\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPool).addPreNegFilter.func1.1()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool.go:275 +0x65\r\n\r\nGoroutine 18 (running) created at:\r\n  testing.(*T).Run()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x726\r\n  testing.runTests.func1()\r\n      /usr/local/go/src/testing/testing.go:1598 +0x99\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.runTests()\r\n      /usr/local/go/src/testing/testing.go:1596 +0x7ca\r\n  testing.(*M).Run()\r\n      /usr/local/go/src/testing/testing.go:1504 +0x9d1\r\n  main.main()\r\n      _testmain.go:87 +0x22b\r\n\r\nGoroutine 88 (running) created at:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPool).addPreNegFilter.func1()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool.go:274 +0x293\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).setState.func1()\r\n      /Users/piersy/projects/go-ethereum/p2p/nodestate/nodestate.go:687 +0x165\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).opFinish()\r\n      /Users/piersy/projects/go-ethereum/p2p/nodestate/nodestate.go:722 +0x1e1\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).SetState()\r\n      /Users/piersy/projects/go-ethereum/p2p/nodestate/nodestate.go:633 +0x211\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*FillSet).readLoop()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/fillset.go:81 +0x9e\r\n  github.com/ethereum/go-ethereum/les/vflux/client.NewFillSet·dwrap·1()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/fillset.go:64 +0x39\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c0002f8318 by goroutine 18:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPoolTest).start()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:158 +0x717\r\n  github.com/ethereum/go-ethereum/les/vflux/client.testServerPoolRestartNoDiscovery()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:336 +0x109\r\n  github.com/ethereum/go-ethereum/les/vflux/client.TestServerPoolRestartNoDiscoveryWithPreNeg()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:325 +0x33\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n\r\nPrevious read at 0x00c0002f8318 by goroutine 38:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPoolTest).start.func3()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:170 +0x77\r\n\r\nGoroutine 18 (running) created at:\r\n  testing.(*T).Run()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x726\r\n  testing.runTests.func1()\r\n      /usr/local/go/src/testing/testing.go:1598 +0x99\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.runTests()\r\n      /usr/local/go/src/testing/testing.go:1596 +0x7ca\r\n  testing.(*M).Run()\r\n      /usr/local/go/src/testing/testing.go:1504 +0x9d1\r\n  main.main()\r\n      _testmain.go:87 +0x22b\r\n\r\nGoroutine 38 (finished) created at:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPoolTest).start()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:159 +0x7cb\r\n  github.com/ethereum/go-ethereum/les/vflux/client.testServerPoolRestartNoDiscovery()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:331 +0x8e\r\n  github.com/ethereum/go-ethereum/les/vflux/client.TestServerPoolRestartNoDiscoveryWithPreNeg()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/serverpool_test.go:325 +0x33\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n==================\r\n--- FAIL: TestServerPoolRestartNoDiscoveryWithPreNeg (0.26s)\r\n    testing.go:1152: race detected during execution of test\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c0001424e0 by goroutine 75:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*referenceBasket).updateReqValues()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/requestbasket.go:178 +0x67\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*referenceBasket).add()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/requestbasket.go:172 +0xdd\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ValueTracker).periodicUpdate()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker.go:473 +0x27b\r\n  github.com/ethereum/go-ethereum/les/vflux/client.NewValueTracker.func1()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker.go:219 +0x75\r\n\r\nPrevious read at 0x00c0001424e0 by goroutine 57:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*NodeValueTracker).Served()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker.go:115 +0x2c9\r\n  github.com/ethereum/go-ethereum/les/vflux/client.TestValueTracker()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker_test.go:80 +0x1405\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n\r\nGoroutine 75 (running) created at:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.NewValueTracker()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker.go:214 +0x644\r\n  github.com/ethereum/go-ethereum/les/vflux/client.TestValueTracker()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker_test.go:60 +0x3a7\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n\r\nGoroutine 57 (running) created at:\r\n  testing.(*T).Run()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x726\r\n  testing.runTests.func1()\r\n      /usr/local/go/src/testing/testing.go:1598 +0x99\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.runTests()\r\n      /usr/local/go/src/testing/testing.go:1596 +0x7ca\r\n  testing.(*M).Run()\r\n      /usr/local/go/src/testing/testing.go:1504 +0x9d1\r\n  main.main()\r\n      _testmain.go:87 +0x22b\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c000446a18 by goroutine 57:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*NodeValueTracker).Served()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker.go:115 +0x192\r\n  github.com/ethereum/go-ethereum/les/vflux/client.TestValueTracker()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker_test.go:80 +0x1405\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n\r\nPrevious write at 0x00c000446a18 by goroutine 75:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*referenceBasket).updateReqValues()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/requestbasket.go:181 +0x1b3\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*referenceBasket).add()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/requestbasket.go:172 +0xdd\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ValueTracker).periodicUpdate()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker.go:473 +0x27b\r\n  github.com/ethereum/go-ethereum/les/vflux/client.NewValueTracker.func1()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker.go:219 +0x75\r\n\r\nGoroutine 57 (running) created at:\r\n  testing.(*T).Run()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x726\r\n  testing.runTests.func1()\r\n      /usr/local/go/src/testing/testing.go:1598 +0x99\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.runTests()\r\n      /usr/local/go/src/testing/testing.go:1596 +0x7ca\r\n  testing.(*M).Run()\r\n      /usr/local/go/src/testing/testing.go:1504 +0x9d1\r\n  main.main()\r\n      _testmain.go:87 +0x22b\r\n\r\nGoroutine 75 (running) created at:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.NewValueTracker()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker.go:214 +0x644\r\n  github.com/ethereum/go-ethereum/les/vflux/client.TestValueTracker()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker_test.go:60 +0x3a7\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c000446c08 by goroutine 57:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*NodeValueTracker).Served()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker.go:115 +0x192\r\n  github.com/ethereum/go-ethereum/les/vflux/client.TestValueTracker()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker_test.go:80 +0x1405\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n\r\nPrevious write at 0x00c000446c08 by goroutine 75:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*referenceBasket).updateReqValues()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/requestbasket.go:181 +0x1b3\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ValueTracker).periodicUpdate()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker.go:477 +0x2db\r\n  github.com/ethereum/go-ethereum/les/vflux/client.NewValueTracker.func1()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker.go:219 +0x75\r\n\r\nGoroutine 57 (running) created at:\r\n  testing.(*T).Run()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x726\r\n  testing.runTests.func1()\r\n      /usr/local/go/src/testing/testing.go:1598 +0x99\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.runTests()\r\n      /usr/local/go/src/testing/testing.go:1596 +0x7ca\r\n  testing.(*M).Run()\r\n      /usr/local/go/src/testing/testing.go:1504 +0x9d1\r\n  main.main()\r\n      _testmain.go:87 +0x22b\r\n\r\nGoroutine 75 (running) created at:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.NewValueTracker()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker.go:214 +0x644\r\n  github.com/ethereum/go-ethereum/les/vflux/client.TestValueTracker()\r\n      /Users/piersy/projects/go-ethereum/les/vflux/client/valuetracker_test.go:60 +0x3a7\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n==================\r\n--- FAIL: TestValueTracker (0.34s)\r\n    testing.go:1152: race detected during execution of test\r\nFAIL\r\nFAIL\tgithub.com/ethereum/go-ethereum/les/vflux/client\t6.030s\r\n```\r\n`p2p/discover`\r\n```\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c000332600 by goroutine 56:\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).nodeToRevalidate()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:364 +0x1b7\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).doRevalidate()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:319 +0xaa\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).loop·dwrap·12()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:256 +0x47\r\n\r\nPrevious write at 0x00c000332600 by goroutine 9:\r\n  github.com/ethereum/go-ethereum/p2p/discover.fillBucket()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_util_test.go:104 +0x39e\r\n  github.com/ethereum/go-ethereum/p2p/discover.testPingReplace()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:62 +0x2ed\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace.func1.1()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:41 +0x50\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n\r\nGoroutine 56 (running) created at:\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).loop()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:256 +0x9a8\r\n  github.com/ethereum/go-ethereum/p2p/discover.newTestTable·dwrap·61()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_util_test.go:47 +0x39\r\n\r\nGoroutine 9 (running) created at:\r\n  testing.(*T).Run()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x726\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace.func1()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:39 +0x106\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:46 +0x68\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c0001a0378 by goroutine 56:\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).nodeToRevalidate()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:365 +0x21d\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).doRevalidate()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:319 +0xaa\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).loop·dwrap·12()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:256 +0x47\r\n\r\nPrevious write at 0x00c0001a0378 by goroutine 9:\r\n  github.com/ethereum/go-ethereum/p2p/discover.fillBucket()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_util_test.go:104 +0x358\r\n  github.com/ethereum/go-ethereum/p2p/discover.testPingReplace()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:62 +0x2ed\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace.func1.1()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:41 +0x50\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n\r\nGoroutine 56 (running) created at:\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).loop()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:256 +0x9a8\r\n  github.com/ethereum/go-ethereum/p2p/discover.newTestTable·dwrap·61()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_util_test.go:47 +0x39\r\n\r\nGoroutine 9 (running) created at:\r\n  testing.(*T).Run()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x726\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace.func1()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:39 +0x106\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:46 +0x68\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c0001367a0 by goroutine 56:\r\n  runtime.racereadrange()\r\n      <autogenerated>:1 +0x1b\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).doRevalidate()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:326 +0x102\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).loop·dwrap·12()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:256 +0x47\r\n\r\nPrevious write at 0x00c0001367a0 by goroutine 9:\r\n  github.com/ethereum/go-ethereum/p2p/discover.wrapNode()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/node.go:68 +0x15b\r\n  github.com/ethereum/go-ethereum/p2p/discover.nodeAtDistance()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_util_test.go:55 +0x26\r\n  github.com/ethereum/go-ethereum/p2p/discover.fillBucket()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_util_test.go:104 +0x2dc\r\n  github.com/ethereum/go-ethereum/p2p/discover.testPingReplace()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:62 +0x2ed\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace.func1.1()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:41 +0x50\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n\r\nGoroutine 56 (running) created at:\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).loop()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:256 +0x9a8\r\n  github.com/ethereum/go-ethereum/p2p/discover.newTestTable·dwrap·61()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_util_test.go:47 +0x39\r\n\r\nGoroutine 9 (running) created at:\r\n  testing.(*T).Run()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x726\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace.func1()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:39 +0x106\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:46 +0x68\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c00007fdd0 by goroutine 56:\r\n  runtime.mapaccess1()\r\n      /usr/local/go/src/runtime/map.go:394 +0x0\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*pingRecorder).ping()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_util_test.go:156 +0x1d5\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).doRevalidate()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:326 +0x102\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).loop·dwrap·12()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:256 +0x47\r\n\r\nPrevious write at 0x00c00007fdd0 by goroutine 9:\r\n  runtime.mapassign()\r\n      /usr/local/go/src/runtime/map.go:571 +0x0\r\n  github.com/ethereum/go-ethereum/p2p/discover.testPingReplace()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:66 +0x38b\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace.func1.1()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:41 +0x50\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n\r\nGoroutine 56 (running) created at:\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).loop()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:256 +0x9a8\r\n  github.com/ethereum/go-ethereum/p2p/discover.newTestTable·dwrap·61()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_util_test.go:47 +0x39\r\n\r\nGoroutine 9 (running) created at:\r\n  testing.(*T).Run()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x726\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace.func1()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:39 +0x106\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:46 +0x68\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c0002be108 by goroutine 56:\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*pingRecorder).ping()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_util_test.go:156 +0x1e4\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).doRevalidate()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:326 +0x102\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).loop·dwrap·12()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:256 +0x47\r\n\r\nPrevious write at 0x00c0002be108 by goroutine 9:\r\n  github.com/ethereum/go-ethereum/p2p/discover.testPingReplace()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:66 +0x39a\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace.func1.1()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:41 +0x50\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n\r\nGoroutine 56 (running) created at:\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).loop()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:256 +0x9a8\r\n  github.com/ethereum/go-ethereum/p2p/discover.newTestTable·dwrap·61()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_util_test.go:47 +0x39\r\n\r\nGoroutine 9 (running) created at:\r\n  testing.(*T).Run()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x726\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace.func1()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:39 +0x106\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:46 +0x68\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c000136750 by goroutine 56:\r\n  github.com/ethereum/go-ethereum/p2p/enr.(*Record).Seq()\r\n      /Users/piersy/projects/go-ethereum/p2p/enr/enr.go:101 +0x11a\r\n  github.com/ethereum/go-ethereum/p2p/enode.(*Node).Seq()\r\n      /Users/piersy/projects/go-ethereum/p2p/enode/node.go:89 +0x10d\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).doRevalidate()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:329 +0x12b\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).loop·dwrap·12()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:256 +0x47\r\n\r\nPrevious write at 0x00c000136750 by goroutine 9:\r\n  github.com/ethereum/go-ethereum/p2p/discover.wrapNode()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/node.go:68 +0x15b\r\n  github.com/ethereum/go-ethereum/p2p/discover.nodeAtDistance()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_util_test.go:55 +0x26\r\n  github.com/ethereum/go-ethereum/p2p/discover.fillBucket()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_util_test.go:104 +0x2dc\r\n  github.com/ethereum/go-ethereum/p2p/discover.testPingReplace()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:62 +0x2ed\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace.func1.1()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:41 +0x50\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n\r\nGoroutine 56 (running) created at:\r\n  github.com/ethereum/go-ethereum/p2p/discover.(*Table).loop()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table.go:256 +0x9a8\r\n  github.com/ethereum/go-ethereum/p2p/discover.newTestTable·dwrap·61()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_util_test.go:47 +0x39\r\n\r\nGoroutine 9 (running) created at:\r\n  testing.(*T).Run()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x726\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace.func1()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:39 +0x106\r\n  github.com/ethereum/go-ethereum/p2p/discover.TestTable_pingReplace()\r\n      /Users/piersy/projects/go-ethereum/p2p/discover/table_test.go:46 +0x68\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n==================\r\n--- FAIL: TestTable_pingReplace (0.00s)\r\n    --- FAIL: TestTable_pingReplace/newNodeResponding=false/lastInBucketResponding=false (0.01s)\r\n        testing.go:1152: race detected during execution of test\r\n    --- FAIL: TestTable_pingReplace/newNodeResponding=true/lastInBucketResponding=false (0.01s)\r\n        testing.go:1152: race detected during execution of test\r\n    --- FAIL: TestTable_pingReplace/newNodeResponding=false/lastInBucketResponding=true (0.01s)\r\n        testing.go:1152: race detected during execution of test\r\n    --- FAIL: TestTable_pingReplace/newNodeResponding=true/lastInBucketResponding=true (0.01s)\r\n        testing.go:1152: race detected during execution of test\r\nFAIL\r\nFAIL\tgithub.com/ethereum/go-ethereum/p2p/discover\t70.881s\r\n```\r\n\r\n#### Steps to reproduce the behaviour\r\n```\r\ngo test -p 1 -race ./...\r\n```\r\n\r\n",
  "closed_by": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23848/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23848/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/963898258",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23848#issuecomment-963898258",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23848",
    "id": 963898258,
    "node_id": "IC_kwDOAOvK9845c-uS",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-09T07:57:10Z",
    "updated_at": "2021-11-09T07:57:10Z",
    "author_association": "MEMBER",
    "body": "Thanks for reporting, this was fixed by https://github.com/ethereum/go-ethereum/pull/23865",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/963898258/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/963898800",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23848#issuecomment-963898800",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23848",
    "id": 963898800,
    "node_id": "IC_kwDOAOvK9845c-2w",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-09T07:58:12Z",
    "updated_at": "2021-11-09T07:58:12Z",
    "author_association": "MEMBER",
    "body": "Actually, it wasn't though. Or maybe this is a new one\r\n\r\n```\r\n[user@work client]$ go test . -race --count 5\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c00060a8c0 by goroutine 81:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPoolTest).resetNodes()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool_test.go:276 +0x297\r\n  github.com/ethereum/go-ethereum/les/vflux/client.testServerPoolChangedNodes()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool_test.go:324 +0xcc\r\n  github.com/ethereum/go-ethereum/les/vflux/client.TestServerPoolChangedNodesWithPreNeg()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool_test.go:315 +0x33\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n\r\nPrevious read at 0x00c00060a8c0 by goroutine 11:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPoolTest).start.func1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool_test.go:119 +0x150\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPool).addPreNegFilter.func1.1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool.go:275 +0x65\r\n\r\nGoroutine 81 (running) created at:\r\n  testing.(*T).Run()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x726\r\n  testing.runTests.func1()\r\n      /usr/local/go/src/testing/testing.go:1598 +0x99\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.runTests()\r\n      /usr/local/go/src/testing/testing.go:1596 +0x7ca\r\n  testing.(*M).Run()\r\n      /usr/local/go/src/testing/testing.go:1504 +0x9d1\r\n  main.main()\r\n      _testmain.go:87 +0x22b\r\n\r\nGoroutine 11 (running) created at:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPool).addPreNegFilter.func1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool.go:274 +0x293\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).setState.func1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/p2p/nodestate/nodestate.go:687 +0x165\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).opFinish()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/p2p/nodestate/nodestate.go:722 +0x1e1\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).SetState()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/p2p/nodestate/nodestate.go:633 +0x211\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*FillSet).readLoop()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/fillset.go:81 +0x9e\r\n  github.com/ethereum/go-ethereum/les/vflux/client.NewFillSet·dwrap·1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/fillset.go:64 +0x39\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c00060a8d0 by goroutine 81:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPoolTest).resetNodes()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool_test.go:276 +0x297\r\n  github.com/ethereum/go-ethereum/les/vflux/client.testServerPoolChangedNodes()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool_test.go:324 +0xcc\r\n  github.com/ethereum/go-ethereum/les/vflux/client.TestServerPoolChangedNodesWithPreNeg()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool_test.go:315 +0x33\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.(*T).Run·dwrap·21()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x47\r\n\r\nPrevious read at 0x00c00060a8d0 by goroutine 11:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPoolTest).start.func1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool_test.go:119 +0x1a6\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPool).addPreNegFilter.func1.1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool.go:275 +0x65\r\n\r\nGoroutine 81 (running) created at:\r\n  testing.(*T).Run()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x726\r\n  testing.runTests.func1()\r\n      /usr/local/go/src/testing/testing.go:1598 +0x99\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.runTests()\r\n      /usr/local/go/src/testing/testing.go:1596 +0x7ca\r\n  testing.(*M).Run()\r\n      /usr/local/go/src/testing/testing.go:1504 +0x9d1\r\n  main.main()\r\n      _testmain.go:87 +0x22b\r\n\r\nGoroutine 11 (running) created at:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPool).addPreNegFilter.func1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool.go:274 +0x293\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).setState.func1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/p2p/nodestate/nodestate.go:687 +0x165\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).opFinish()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/p2p/nodestate/nodestate.go:722 +0x1e1\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).SetState()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/p2p/nodestate/nodestate.go:633 +0x211\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*FillSet).readLoop()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/fillset.go:81 +0x9e\r\n  github.com/ethereum/go-ethereum/les/vflux/client.NewFillSet·dwrap·1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/fillset.go:64 +0x39\r\n==================\r\n--- FAIL: TestServerPoolChangedNodesWithPreNeg (1.88s)\r\n    testing.go:1152: race detected during execution of test\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c00053f510 by goroutine 72:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPoolTest).start.func1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool_test.go:119 +0x12b\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPool).addPreNegFilter.func1.1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool.go:275 +0x65\r\n\r\nPrevious write at 0x00c00053f510 by goroutine 52:\r\n  [failed to restore the stack]\r\n\r\nGoroutine 72 (running) created at:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPool).addPreNegFilter.func1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool.go:274 +0x293\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).setState.func1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/p2p/nodestate/nodestate.go:687 +0x165\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).opFinish()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/p2p/nodestate/nodestate.go:722 +0x1e1\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).SetState()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/p2p/nodestate/nodestate.go:633 +0x211\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*FillSet).readLoop()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/fillset.go:81 +0x9e\r\n  github.com/ethereum/go-ethereum/les/vflux/client.NewFillSet·dwrap·1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/fillset.go:64 +0x39\r\n\r\nGoroutine 52 (running) created at:\r\n  testing.(*T).Run()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x726\r\n  testing.runTests.func1()\r\n      /usr/local/go/src/testing/testing.go:1598 +0x99\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.runTests()\r\n      /usr/local/go/src/testing/testing.go:1596 +0x7ca\r\n  testing.(*M).Run()\r\n      /usr/local/go/src/testing/testing.go:1504 +0x9d1\r\n  main.main()\r\n      _testmain.go:87 +0x22b\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c00053f500 by goroutine 72:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPoolTest).start.func1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool_test.go:119 +0x1a6\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPool).addPreNegFilter.func1.1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool.go:275 +0x65\r\n\r\nPrevious write at 0x00c00053f500 by goroutine 52:\r\n  [failed to restore the stack]\r\n\r\nGoroutine 72 (running) created at:\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*ServerPool).addPreNegFilter.func1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/serverpool.go:274 +0x293\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).setState.func1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/p2p/nodestate/nodestate.go:687 +0x165\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).opFinish()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/p2p/nodestate/nodestate.go:722 +0x1e1\r\n  github.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).SetState()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/p2p/nodestate/nodestate.go:633 +0x211\r\n  github.com/ethereum/go-ethereum/les/vflux/client.(*FillSet).readLoop()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/fillset.go:81 +0x9e\r\n  github.com/ethereum/go-ethereum/les/vflux/client.NewFillSet·dwrap·1()\r\n      /home/user/go/src/github.com/ethereum/go-ethereum/les/vflux/client/fillset.go:64 +0x39\r\n\r\nGoroutine 52 (running) created at:\r\n  testing.(*T).Run()\r\n      /usr/local/go/src/testing/testing.go:1306 +0x726\r\n  testing.runTests.func1()\r\n      /usr/local/go/src/testing/testing.go:1598 +0x99\r\n  testing.tRunner()\r\n      /usr/local/go/src/testing/testing.go:1259 +0x22f\r\n  testing.runTests()\r\n      /usr/local/go/src/testing/testing.go:1596 +0x7ca\r\n  testing.(*M).Run()\r\n      /usr/local/go/src/testing/testing.go:1504 +0x9d1\r\n  main.main()\r\n      _testmain.go:87 +0x22b\r\n==================\r\n--- FAIL: TestServerPoolRestartNoDiscoveryWithPreNeg (0.39s)\r\n    testing.go:1152: race detected during execution of test\r\nFAIL\r\nFAIL    github.com/ethereum/go-ethereum/les/vflux/client        39.898s\r\nFAIL\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/963898800/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/980053721",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23848#issuecomment-980053721",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23848",
    "id": 980053721,
    "node_id": "IC_kwDOAOvK9846am7Z",
    "user": {
      "login": "piersy",
      "id": 5087847,
      "node_id": "MDQ6VXNlcjUwODc4NDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5087847?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/piersy",
      "html_url": "https://github.com/piersy",
      "followers_url": "https://api.github.com/users/piersy/followers",
      "following_url": "https://api.github.com/users/piersy/following{/other_user}",
      "gists_url": "https://api.github.com/users/piersy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/piersy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/piersy/subscriptions",
      "organizations_url": "https://api.github.com/users/piersy/orgs",
      "repos_url": "https://api.github.com/users/piersy/repos",
      "events_url": "https://api.github.com/users/piersy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/piersy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-26T15:19:45Z",
    "updated_at": "2021-11-26T15:19:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "@holiman Just noting that whether races occur is not deterministic, so a clean run does not imply that all races are fixed.\r\n\r\nWhen tackling such problems I generally run tests 10,100,1000,10000 times as much as time permits to see if the races have been fixed (you never really know for sure).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/980053721/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
