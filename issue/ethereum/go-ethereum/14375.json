{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/14375",
  "id": 223809169,
  "node_id": "MDU6SXNzdWUyMjM4MDkxNjk=",
  "number": 14375,
  "title": "Transaction load test (fails when asyncronous creation of contract is used via multiple RPC calls for contract creation )",
  "user": {
    "login": "Anatoliy4041",
    "id": 22852830,
    "node_id": "MDQ6VXNlcjIyODUyODMw",
    "avatar_url": "https://avatars.githubusercontent.com/u/22852830?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Anatoliy4041",
    "html_url": "https://github.com/Anatoliy4041",
    "followers_url": "https://api.github.com/users/Anatoliy4041/followers",
    "following_url": "https://api.github.com/users/Anatoliy4041/following{/other_user}",
    "gists_url": "https://api.github.com/users/Anatoliy4041/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Anatoliy4041/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Anatoliy4041/subscriptions",
    "organizations_url": "https://api.github.com/users/Anatoliy4041/orgs",
    "repos_url": "https://api.github.com/users/Anatoliy4041/repos",
    "events_url": "https://api.github.com/users/Anatoliy4041/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Anatoliy4041/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 12,
  "created_at": "2017-04-24T12:50:45Z",
  "updated_at": "2017-05-19T13:03:57Z",
  "closed_at": "2017-05-19T13:03:57Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System  #information\r\n\r\nGeth version: v1.5.9-stable-a07539fb\r\nOS & Version:  Ubuntu 16.04.2 LTS\r\n\r\n\r\nHi Guys!\r\n\r\nActually I'd like to ask help about transaction load test which I try to perform.\r\nI created a simple person storage contract and coded nodejs simple app to load private ethereum network where I sent 10 new person to. So it's one transaction per one person. \r\nThe issue is that some transaction were mined , however some were not, and those even weren't added into pending txpool.\r\nThen I tried for 50, 100 persons and the result was - only 1/4 transactions where each one represents one person - disappeared.\r\nI tried to set -verbosity for max to 6 to trace those and did't find any clue what happened with them.\r\n\r\nFor example - logs the transaction of person which were not added into block chain:\r\n\r\nLine 8663: I0424 11:55:06.227721 core/tx_pool.go:343] (t) 0x09aa3330 => e7df539a (0x56cc50) f4abe26906f2675b054707b6c86df1b9f74f12e7706d3cb0e50249042d0be506\r\n\tLine 8678:         TX(f4abe26906f2675b054707b6c86df1b9f74f12e7706d3cb0e50249042d0be506)\r\n\tLine 8691: I0424 11:55:06.239756 internal/ethapi/api.go:1143] Tx(0xf4abe26906f2675b054707b6c86df1b9f74f12e7706d3cb0e50249042d0be506) to: 0xe7df539af99387efb4c26ab6f60f5f613ae90e93\r\n\tLine 8788: I0424 11:55:06.275486 internal/ethapi/api.go:1026] receipt not found for transaction 0xf4abe26906f2675b054707b6c86df1b9f74f12e7706d3cb0e50249042d0be506\r\n\r\nFrom that it is clearly seen that transaction was created, however it was found in pending  neither found receipt\r\n\r\nCould you help to sort this question please!\r\n\r\n#### Expected behaviour\r\n\r\nAll of 100 transaction mined into blockchain\r\n\r\n#### Actual behaviour\r\n\r\nSome transactions are not mined and even not added to pending (txpool) \r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nTo reproduce that behavior just try to perform load test  by genereting 100 transaction at once \r\n",
  "closed_by": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375/reactions",
    "total_count": 3,
    "+1": 3,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/296666705",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14375#issuecomment-296666705",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375",
    "id": 296666705,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NjY2NjcwNQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-24T13:25:16Z",
    "updated_at": "2017-04-24T13:25:16Z",
    "author_association": "MEMBER",
    "body": "Could you provide the code that you used? \r\nAs you can see here: https://github.com/ethereum/go-ethereum/issues/14361#issuecomment-296187252 , I can create thousands of transactions without losing any, so any additional information you can provide would be helpful. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/296666705/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/297067005",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14375#issuecomment-297067005",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375",
    "id": 297067005,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NzA2NzAwNQ==",
    "user": {
      "login": "Anatoliy4041",
      "id": 22852830,
      "node_id": "MDQ6VXNlcjIyODUyODMw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22852830?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Anatoliy4041",
      "html_url": "https://github.com/Anatoliy4041",
      "followers_url": "https://api.github.com/users/Anatoliy4041/followers",
      "following_url": "https://api.github.com/users/Anatoliy4041/following{/other_user}",
      "gists_url": "https://api.github.com/users/Anatoliy4041/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Anatoliy4041/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Anatoliy4041/subscriptions",
      "organizations_url": "https://api.github.com/users/Anatoliy4041/orgs",
      "repos_url": "https://api.github.com/users/Anatoliy4041/repos",
      "events_url": "https://api.github.com/users/Anatoliy4041/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Anatoliy4041/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-25T15:24:59Z",
    "updated_at": "2017-04-25T15:24:59Z",
    "author_association": "NONE",
    "body": "I'll post it here in the nearest future!\r\n\r\nBy now I'll like to share what I've got so far - I implemented your code  in #14361 and it woked perfectly!\r\nHowever I'd like to add some intresting point I came accross when I tried to get it sorted.\r\nMy script for load test is working in asynchronous way (via callback) by sending request to RPC standart geth client port 8545 (it shoud be relatively high amount of transactions 20, 50 or 100). In this case some of transactions disappeared. When I do it in synchronous way it's fine(or I do it asynchronously via geth console).\r\n\r\nSo based on that, I'd wonder to know is there any limitation for request which geth RPC can handle? And did you came accross on the similar geth behaviour?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/297067005/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/297693498",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14375#issuecomment-297693498",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375",
    "id": 297693498,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NzY5MzQ5OA==",
    "user": {
      "login": "Anatoliy4041",
      "id": 22852830,
      "node_id": "MDQ6VXNlcjIyODUyODMw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22852830?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Anatoliy4041",
      "html_url": "https://github.com/Anatoliy4041",
      "followers_url": "https://api.github.com/users/Anatoliy4041/followers",
      "following_url": "https://api.github.com/users/Anatoliy4041/following{/other_user}",
      "gists_url": "https://api.github.com/users/Anatoliy4041/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Anatoliy4041/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Anatoliy4041/subscriptions",
      "organizations_url": "https://api.github.com/users/Anatoliy4041/orgs",
      "repos_url": "https://api.github.com/users/Anatoliy4041/repos",
      "events_url": "https://api.github.com/users/Anatoliy4041/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Anatoliy4041/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-27T11:59:50Z",
    "updated_at": "2017-04-27T11:59:50Z",
    "author_association": "NONE",
    "body": "[Here](https://github.com/Anatoliy4041/loadtest) is the link to the code I used to reproduce the bug.\r\nSo as you can see when you run the test (e.g for creating 10 contracts) you'll get 10 tx hashes, however you won't get the same amount of contract addreses.\r\n\r\nSome intresing points I found using that test(RPC calls via 8545 port) is:\r\n1) as many tx as were added to txpool will be mined and we will get their addresses\r\n2) when I do the test in syncronous way (without callbacl after \"MyContract.new(..\" It works perfectly!\r\n\r\nSo the issue happens when ascyncronous multiple RPC calls for contract creation happen.\r\nWhen I tried to launch via console my code and @holiman  in #14361 both in syncronous and ascyncronous way it was fine",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/297693498/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/297699843",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14375#issuecomment-297699843",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375",
    "id": 297699843,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5NzY5OTg0Mw==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-27T12:31:27Z",
    "updated_at": "2017-04-27T12:31:27Z",
    "author_association": "MEMBER",
    "body": "Thanks for the update and the very thorough documentation! I'll look into it\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/297699843/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/297749416",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14375#issuecomment-297749416",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375",
    "id": 297749416,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5Nzc0OTQxNg==",
    "user": {
      "login": "fabio-muramatsu",
      "id": 14302074,
      "node_id": "MDQ6VXNlcjE0MzAyMDc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/14302074?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fabio-muramatsu",
      "html_url": "https://github.com/fabio-muramatsu",
      "followers_url": "https://api.github.com/users/fabio-muramatsu/followers",
      "following_url": "https://api.github.com/users/fabio-muramatsu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fabio-muramatsu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fabio-muramatsu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fabio-muramatsu/subscriptions",
      "organizations_url": "https://api.github.com/users/fabio-muramatsu/orgs",
      "repos_url": "https://api.github.com/users/fabio-muramatsu/repos",
      "events_url": "https://api.github.com/users/fabio-muramatsu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fabio-muramatsu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-27T15:29:21Z",
    "updated_at": "2017-04-27T15:29:21Z",
    "author_association": "NONE",
    "body": "I'm experiencing a similar issue in a private network, but using `sendRawTransaction` instead. More specifically, I was creating ~200 transactions in a loop, each of them sending some ether to an account. Interestingly, all 200 transactions were received by the geth node, since they were all logged in the console as shown below.\r\n```\r\nINFO [04-27|11:37:24] Submitted transaction                    fullhash=0x904309d3e850edad865b50805d5f19db6fdb2ad2ab971f8ce415773ce57b7250 recipient=0x7423c975164969881680c7ad944444dfae1887f9\r\n...\r\n```\r\nHowever, in most of my tests, some of these transactions were not added in the transaction pool. The results of `txpool.content.pending` and `txpool.content.queued` show less than 200 transactions, which means a few transactions were somehow lost in geth.\r\nAnother interesting fact is that this problem seems to be related to the request throughput. For instance, the problem happens when I call `sendRawTransaction` once every 5ms. If I increase this interval to 50ms, all 200 transactions are correctly added to the pool.\r\n\r\nI'm running geth v1.6.0 on Arch Linux, and my tests were run in Node.js v7.8 using web3js. All `sendRawTransaction` calls were performed asynchronously. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/297749416/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/297753169",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14375#issuecomment-297753169",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375",
    "id": 297753169,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5Nzc1MzE2OQ==",
    "user": {
      "login": "Anatoliy4041",
      "id": 22852830,
      "node_id": "MDQ6VXNlcjIyODUyODMw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22852830?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Anatoliy4041",
      "html_url": "https://github.com/Anatoliy4041",
      "followers_url": "https://api.github.com/users/Anatoliy4041/followers",
      "following_url": "https://api.github.com/users/Anatoliy4041/following{/other_user}",
      "gists_url": "https://api.github.com/users/Anatoliy4041/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Anatoliy4041/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Anatoliy4041/subscriptions",
      "organizations_url": "https://api.github.com/users/Anatoliy4041/orgs",
      "repos_url": "https://api.github.com/users/Anatoliy4041/repos",
      "events_url": "https://api.github.com/users/Anatoliy4041/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Anatoliy4041/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-27T15:41:50Z",
    "updated_at": "2017-04-27T15:41:50Z",
    "author_association": "NONE",
    "body": "@holiman I also want to add that the number of transactions which are not added to txpool is changed every time I run my ascync create contract requests",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/297753169/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/297756794",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14375#issuecomment-297756794",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375",
    "id": 297756794,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5Nzc1Njc5NA==",
    "user": {
      "login": "Anatoliy4041",
      "id": 22852830,
      "node_id": "MDQ6VXNlcjIyODUyODMw",
      "avatar_url": "https://avatars.githubusercontent.com/u/22852830?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Anatoliy4041",
      "html_url": "https://github.com/Anatoliy4041",
      "followers_url": "https://api.github.com/users/Anatoliy4041/followers",
      "following_url": "https://api.github.com/users/Anatoliy4041/following{/other_user}",
      "gists_url": "https://api.github.com/users/Anatoliy4041/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Anatoliy4041/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Anatoliy4041/subscriptions",
      "organizations_url": "https://api.github.com/users/Anatoliy4041/orgs",
      "repos_url": "https://api.github.com/users/Anatoliy4041/repos",
      "events_url": "https://api.github.com/users/Anatoliy4041/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Anatoliy4041/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-27T15:54:21Z",
    "updated_at": "2017-04-27T15:54:21Z",
    "author_association": "NONE",
    "body": "@fabio-muramatsu Could you share please, how did you get your geth logs in such way? e.g. the original one looks like:\r\nI0425 17:02:54.289282 miner/worker.go:517] commit new work on block 1523 with 0 txs & 0 uncles. Took 557.556µs\r\nDid you set up disent logger?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/297756794/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/297781851",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14375#issuecomment-297781851",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375",
    "id": 297781851,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5Nzc4MTg1MQ==",
    "user": {
      "login": "fabio-muramatsu",
      "id": 14302074,
      "node_id": "MDQ6VXNlcjE0MzAyMDc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/14302074?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fabio-muramatsu",
      "html_url": "https://github.com/fabio-muramatsu",
      "followers_url": "https://api.github.com/users/fabio-muramatsu/followers",
      "following_url": "https://api.github.com/users/fabio-muramatsu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fabio-muramatsu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fabio-muramatsu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fabio-muramatsu/subscriptions",
      "organizations_url": "https://api.github.com/users/fabio-muramatsu/orgs",
      "repos_url": "https://api.github.com/users/fabio-muramatsu/repos",
      "events_url": "https://api.github.com/users/fabio-muramatsu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fabio-muramatsu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-04-27T17:20:52Z",
    "updated_at": "2017-04-27T17:20:52Z",
    "author_association": "NONE",
    "body": "@Anatoliy4041 Actually that's the default log displayed in the console. I think it was changed in v1.6.0.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/297781851/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/298429584",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14375#issuecomment-298429584",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375",
    "id": 298429584,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5ODQyOTU4NA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-05-01T20:52:59Z",
    "updated_at": "2017-05-01T20:54:06Z",
    "author_association": "MEMBER",
    "body": "I've managed to reproduce it. It's quite simple, to begin with... \r\n[`sendTransaction`](https://github.com/ethereum/go-ethereum/blob/fff16169c64a83d57d2eed35b6a2e33248c7d5eb/internal/ethapi/api.go#L1172) calls [`setDefaults`](https://github.com/ethereum/go-ethereum/blob/fff16169c64a83d57d2eed35b6a2e33248c7d5eb/internal/ethapi/api.go#L1138) which calls [`getPoolNonce`](https://github.com/ethereum/go-ethereum/blob/a7b9e484d05ceb0afce4ba5dbc62b8f262c2e354/eth/api_backend.go#L159) . There's a small sync around `getPoolNonce`, but two (or several) requests which hit `sendTransaction` simultaneously _will_ obtain the same nonce, since\r\n\r\n* setDefaults (sets nonce to whatever the `state` says)\r\n* It takes some time to sign the transaction (unsynched here)\r\n* Transaction is submitted, in [`submitTransaction`](https://github.com/ethereum/go-ethereum/blob/fff16169c64a83d57d2eed35b6a2e33248c7d5eb/internal/ethapi/api.go#L1195). \r\n* Only when the tx is submitted is the nonce in the pending state increased. \r\n\r\nSo basically, paralellism fails for submission of transactions from the same account, since the bottleneck in signing a tx creates a lot of colliding nonces. \r\n\r\nBut it's even worse :(\r\n\r\nI tried using a `GetAndIncNonce`, a synchronized method which gets and sets the nonce in one go. This solves the first problem, and N tx:s submitted simultaneously don't get the same nonce. They get `1,2,3,4,5,6`. Then the first one is submitted, internally - to the tx_pool, and somewhere in `tx_pool`, I believe `promoteTx`, the method thing which previously 'saved' us now bites us in the ass: \r\n```\r\n\tpool.pendingState.SetNonce(addr, tx.Nonce()+1)\r\n```\r\nSo this sets the `nonce` back to `2`. And instead of continuing at `7`, the nonces now are set back to `2`. \r\n\r\nSo the sequence becomes: \r\n`0,1,2,3,4,5,6,2,3,3,6,7,8,9,8,9,10,7,8`. \r\n\r\nIn order to solve this, I have a feeling that we need\r\n\r\n* `pendingState` with nonces for everything submitted to the pool\r\n* `localState` with nonces for transactions submitted locally, which haven't yet reached the pool. \r\n\r\nSubmitting a `default` transaction does the following (synched): \r\n* Call `localState.getAndIncreaseNonce(account)`\r\n  * If not available\r\n      * set `localState<account><nonce>`= `pendingState.getNonce(account)`\r\n  * set `localstate<account><nonce>++` \r\n  * return `localstate<account><nonce>`\r\n \r\n@karalabe @fjl thoughts ?\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/298429584/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/298447726",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14375#issuecomment-298447726",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375",
    "id": 298447726,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5ODQ0NzcyNg==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-05-01T22:18:09Z",
    "updated_at": "2017-05-01T22:18:09Z",
    "author_association": "MEMBER",
    "body": "Submitted a PR, to demo one way of fixing the issue. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/298447726/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/298452113",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14375#issuecomment-298452113",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375",
    "id": 298452113,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5ODQ1MjExMw==",
    "user": {
      "login": "fabio-muramatsu",
      "id": 14302074,
      "node_id": "MDQ6VXNlcjE0MzAyMDc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/14302074?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fabio-muramatsu",
      "html_url": "https://github.com/fabio-muramatsu",
      "followers_url": "https://api.github.com/users/fabio-muramatsu/followers",
      "following_url": "https://api.github.com/users/fabio-muramatsu/following{/other_user}",
      "gists_url": "https://api.github.com/users/fabio-muramatsu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fabio-muramatsu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fabio-muramatsu/subscriptions",
      "organizations_url": "https://api.github.com/users/fabio-muramatsu/orgs",
      "repos_url": "https://api.github.com/users/fabio-muramatsu/repos",
      "events_url": "https://api.github.com/users/fabio-muramatsu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fabio-muramatsu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-05-01T22:42:23Z",
    "updated_at": "2017-05-01T22:42:23Z",
    "author_association": "NONE",
    "body": "@holiman Thank you for your response. If I got it right, geth has an issue determining the nonce for transactions sent successively from the same account, right? However, in my case, I'm creating transactions manually with the right nonce (i.e., transactions with sequential nonces), signing them and submitting to geth with `sendRawTransaction`. So geth seems to be dropping transactions even when it is not required to set the nonce internally, as I'm already defining it externally. Do you think my issue is related to your findings?\r\nThank you again for your attention.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/298452113/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/298516791",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/14375#issuecomment-298516791",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/14375",
    "id": 298516791,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI5ODUxNjc5MQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-05-02T07:09:24Z",
    "updated_at": "2017-05-02T07:09:24Z",
    "author_association": "MEMBER",
    "body": "@fabio-muramatsu iiuc, the problem you're describing is something else. Could you please open a separate ticket for that ? Any test-scripts you have, or detailed instructions about reproducing it is appreciated.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/298516791/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
