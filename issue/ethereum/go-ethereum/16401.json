{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16401",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16401/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16401/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16401/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/16401",
  "id": 309263880,
  "node_id": "MDU6SXNzdWUzMDkyNjM4ODA=",
  "number": 16401,
  "title": "run 2 nodes in private network will cause fatal error",
  "user": {
    "login": "gravin",
    "id": 11954585,
    "node_id": "MDQ6VXNlcjExOTU0NTg1",
    "avatar_url": "https://avatars.githubusercontent.com/u/11954585?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gravin",
    "html_url": "https://github.com/gravin",
    "followers_url": "https://api.github.com/users/gravin/followers",
    "following_url": "https://api.github.com/users/gravin/following{/other_user}",
    "gists_url": "https://api.github.com/users/gravin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gravin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gravin/subscriptions",
    "organizations_url": "https://api.github.com/users/gravin/orgs",
    "repos_url": "https://api.github.com/users/gravin/repos",
    "events_url": "https://api.github.com/users/gravin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gravin/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2018-03-28T08:16:04Z",
  "updated_at": "2018-03-28T09:14:55Z",
  "closed_at": "2018-03-28T09:14:55Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "```\r\nnohup geth --identity \"node00\" --networkid 99 --datadir ./data/00 --nodiscover --mine --rpc --rpcport 8200 --port 61910 >>data00.log 2>&1 &\r\n\r\nnohup geth --identity \"node01\" --networkid 99 --datadir ./data/01 --nodiscover --mine --rpc --rpcport 8201 --port 61911 >>data01.log 2>&1 &\r\n```\r\nwhen the second command start up, the first process will break up immediately, end with \r\n```\r\nINFO [03-28|16:10:49] Commit new mining work                   number=9 txs=0 uncles=0 elapsed=152.759µs\r\nunexpected fault address 0x7f03d5f70000\r\nfatal error: fault\r\n[signal SIGBUS: bus error code=0x2 addr=0x7f03d5f70000 pc=0x46a060]\r\n\r\ngoroutine 77 [running]:\r\nruntime.throw(0xf02b33, 0x5)\r\n\t/home/sw/go/src/runtime/panic.go:619 +0x81 fp=0xc4203ade68 sp=0xc4203ade48 pc=0x4399f1\r\nruntime.sigpanic()\r\n\t/home/sw/go/src/runtime/signal_unix.go:385 +0x273 fp=0xc4203adeb8 sp=0xc4203ade68 pc=0x44f6b3\r\nruntime.memmove(0x7f03d5f6ffc8, 0xc42824ad00, 0x40)\r\n\t/home/sw/go/src/runtime/memmove_amd64.s:191 +0x180 fp=0xc4203adec0 sp=0xc4203adeb8 pc=0x46a060\r\ngithub.com/ethereum/go-ethereum/consensus/ethash.generateDataset.func2(0xc4201f6060, 0x407fff80, 0x2, 0xc4204f6000, 0x407f30, 0x407f30, 0x0, 0x7f03b3800008, 0x407fff80, 0x407fff80, ...)\r\n\t/home/sw/go-ethereum/build/_workspace/src/github.com/ethereum/go-ethereum/consensus/ethash/algorithm.go:318 +0x201 fp=0xc4203adf58 sp=0xc4203adec0 pc=0x9e5c91\r\nruntime.goexit()\r\n\t/home/sw/go/src/runtime/asm_amd64.s:2361 +0x1 fp=0xc4203adf60 sp=0xc4203adf58 pc=0x469671\r\n```",
  "closed_by": {
    "login": "gravin",
    "id": 11954585,
    "node_id": "MDQ6VXNlcjExOTU0NTg1",
    "avatar_url": "https://avatars.githubusercontent.com/u/11954585?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gravin",
    "html_url": "https://github.com/gravin",
    "followers_url": "https://api.github.com/users/gravin/followers",
    "following_url": "https://api.github.com/users/gravin/following{/other_user}",
    "gists_url": "https://api.github.com/users/gravin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gravin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gravin/subscriptions",
    "organizations_url": "https://api.github.com/users/gravin/orgs",
    "repos_url": "https://api.github.com/users/gravin/repos",
    "events_url": "https://api.github.com/users/gravin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gravin/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16401/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16401/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/376805766",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16401#issuecomment-376805766",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16401",
    "id": 376805766,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NjgwNTc2Ng==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-28T08:32:33Z",
    "updated_at": "2018-03-28T08:32:33Z",
    "author_association": "MEMBER",
    "body": "Can confirm! And this is great, we've been hit by that bug several times, but never easily reproduceable. \r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/376805766/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/376808848",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16401#issuecomment-376808848",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16401",
    "id": 376808848,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NjgwODg0OA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-28T08:43:20Z",
    "updated_at": "2018-03-28T08:43:20Z",
    "author_association": "MEMBER",
    "body": "The first one:\r\n```\r\nINFO [03-28|10:41:06] IPC endpoint opened                      url=/tmp/data00/geth.ipc\r\nTRACE[03-28|10:41:06] Requiring new ethash dataset             epoch=0\r\nTRACE[03-28|10:41:06] Requiring new future ethash dataset      epoch=1\r\nDEBUG[03-28|10:41:06] Failed to load old ethash dataset        epoch=0 err=\"open /home/user/.ethash/full-R23-0000000000000000: no such file or directory\"\r\nDEBUG[03-28|10:41:07] Generated ethash verification cache      epoch=0 elapsed=976.187ms\r\nDEBUG[03-28|10:41:08] Couldn't add port mapping                proto=tcp extport=61910 intport=61910 interface=\"UPnP or NAT-PMP\" err=\"no UPnP or NAT-PMP router discovered\"\r\nunexpected fault address 0x76cd2c3ad308\r\nfatal error: fault\r\n[signal SIGBUS: bus error code=0x2 addr=0x76cd2c3ad308 pc=0x470e01]\r\n\r\ngoroutine 15 [running]:\r\n```\r\n\r\nThe second one:\r\n\r\n```\r\nINFO [03-28|10:41:09] Commit new mining work                   number=1 txs=0 uncles=0 elapsed=244.193µs\r\nTRACE[03-28|10:41:09] Requiring new ethash dataset             epoch=0\r\nTRACE[03-28|10:41:09] Requiring new future ethash dataset      epoch=1\r\nDEBUG[03-28|10:41:09] Failed to load old ethash dataset        epoch=0 err=\"open /home/user/.ethash/full-R23-0000000000000000: no such file or directory\"\r\nDEBUG[03-28|10:41:10] Generated ethash verification cache      epoch=0 elapsed=1.247s\r\n\r\n```\r\nCommand:\r\n```\r\nBIN=./build/bin/geth\r\nFLAGS=\"--verbosity 5 --networkid 99 --datadir /tmp/data00 --nodiscover --mine --rpc --etherbase=0x0000000000000000000000000000000000001337\"\r\n\r\n./build/bin/geth $FLAGS --identity \"node00\" --datadir /tmp/data00 --rpcport 8200 --port 61910\r\n```\r\n\r\nSo obviously, the ethash generator does not respect the `datadir`.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/376808848/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/376810275",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16401#issuecomment-376810275",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16401",
    "id": 376810275,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NjgxMDI3NQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-28T08:48:10Z",
    "updated_at": "2018-03-28T08:48:10Z",
    "author_association": "MEMBER",
    "body": "Ah\r\n```\r\n\tEthashDatasetDirFlag = DirectoryFlag{\r\n\t\tName:  \"ethash.dagdir\",\r\n\t\tUsage: \"Directory to store the ethash mining DAGs (default = inside home folder)\",\r\n\t\tValue: DirectoryString{eth.DefaultConfig.Ethash.DatasetDir},\r\n\t}\r\n```\r\nIt defaults to the home folder, not the datadir. Seems to be intentional, which kind of makes sense, since if you are running several miners, you want to reuse the dag. \r\n\r\nHowever, I guess the bug is that there is no lockfile used to determine which process is allowed ownership of generating dags there...? @karalabe?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/376810275/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/376818003",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16401#issuecomment-376818003",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16401",
    "id": 376818003,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM3NjgxODAwMw==",
    "user": {
      "login": "gravin",
      "id": 11954585,
      "node_id": "MDQ6VXNlcjExOTU0NTg1",
      "avatar_url": "https://avatars.githubusercontent.com/u/11954585?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gravin",
      "html_url": "https://github.com/gravin",
      "followers_url": "https://api.github.com/users/gravin/followers",
      "following_url": "https://api.github.com/users/gravin/following{/other_user}",
      "gists_url": "https://api.github.com/users/gravin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gravin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gravin/subscriptions",
      "organizations_url": "https://api.github.com/users/gravin/orgs",
      "repos_url": "https://api.github.com/users/gravin/repos",
      "events_url": "https://api.github.com/users/gravin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gravin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-03-28T09:14:55Z",
    "updated_at": "2018-03-28T09:14:55Z",
    "author_association": "NONE",
    "body": "found it is because i let 2 processes to mine, only 1 process miner allowed, so close. as this https://github.com/ethereum/go-ethereum/issues/16033",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/376818003/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
