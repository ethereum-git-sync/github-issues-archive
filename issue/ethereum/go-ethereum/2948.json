{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2948",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2948/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2948/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2948/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/2948",
  "id": 173094471,
  "node_id": "MDU6SXNzdWUxNzMwOTQ0NzE=",
  "number": 2948,
  "title": "panic: close of nil channel in miner.(*worker).stop",
  "user": {
    "login": "elliots",
    "id": 622455,
    "node_id": "MDQ6VXNlcjYyMjQ1NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/622455?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/elliots",
    "html_url": "https://github.com/elliots",
    "followers_url": "https://api.github.com/users/elliots/followers",
    "following_url": "https://api.github.com/users/elliots/following{/other_user}",
    "gists_url": "https://api.github.com/users/elliots/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/elliots/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/elliots/subscriptions",
    "organizations_url": "https://api.github.com/users/elliots/orgs",
    "repos_url": "https://api.github.com/users/elliots/repos",
    "events_url": "https://api.github.com/users/elliots/events{/privacy}",
    "received_events_url": "https://api.github.com/users/elliots/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/milestones/26",
    "html_url": "https://github.com/ethereum/go-ethereum/milestone/26",
    "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/milestones/26/labels",
    "id": 1593424,
    "node_id": "MDk6TWlsZXN0b25lMTU5MzQyNA==",
    "number": 26,
    "title": "1.5.0",
    "description": "",
    "creator": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 74,
    "state": "closed",
    "created_at": "2016-02-19T15:55:33Z",
    "updated_at": "2019-02-19T11:15:37Z",
    "due_on": null,
    "closed_at": "2016-11-15T21:55:24Z"
  },
  "comments": 1,
  "created_at": "2016-08-25T01:25:22Z",
  "updated_at": "2016-11-15T16:57:49Z",
  "closed_at": "2016-11-15T16:57:49Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "G'day.\n#### System information\n\nGeth version: \n\n```\nVersion: 1.4.11-stable-fed692f6\nProtocol Versions: [63 62]\nNetwork Id: 1\nGo Version: go1.7\nOS: darwin\nGOPATH=/Users/elliot/.go\nGOROOT=/usr/local/opt/go/libexec\n```\n\nOS & Version: Windows/Linux/OSX\n\n```\nOSX 10.11.5\n```\n#### Expected behaviour\n\nNot panic\n#### Actual behaviour\n\nPanic\n#### Steps to reproduce the behaviour\n\nI'm starting geth with \n\n```\ngeth --datadir=\"data\" init genesis.json\n```\n\nthen\n\n```\ngeth --datadir=\"data\" --keystore=\"keystore\" --password=\"./password\"  --port 30303 --rpc --rpcport 8101 --rpcaddr localhost --networkid 21423 --rpccorsdomain=\"*\" --minerthreads=1 --mine --rpcapi \"eth,web3,personal\" --maxpeers 4 --unlock=$(cat genesis.json | jq '.alloc | with_entries(select(.value.unlock != false)) | keys | join(\",\")' -r) js mine.js\n```\n\nmine.js is from embark  (https://github.com/iurimatias/embark-framework/blob/develop/js/mine.js)\n\nCan't seem to make it die without mine.js, and looks like it has something to do with stopping mining.\n## What I'm doing\n\nConnecting via HTTP from node.js, calling a contract 50 times, fetching the 50 transactions that result, filtering for 50 events coming back. No batching.\n\nDoesn't happen every time.\n#### Backtrace\n\n```\n== Pending transactions! Looking for next block...\n== Pending transactions! Looking for next block...\n== Pending transactions! Looking for next block...\n== Pending transactions! Looking for next block...\nI0825 10:42:10.419129 miner/worker.go:573] commit new work on block 189 with 50 txs & 0 uncles. Took 514.889961ms\nI0825 10:42:10.419393 miner/miner.go:119] Starting mining operation (CPU=4 TOT=17)\nI0825 10:42:11.252229 miner/worker.go:573] commit new work on block 189 with 50 txs & 0 uncles. Took 832.800055ms\nI0825 10:42:11.252379 miner/miner.go:119] Starting mining operation (CPU=4 TOT=21)\nI0825 10:42:11.516675 miner/worker.go:339] ðŸ”¨  Mined block (#189 / 35b43fbb). Wait 5 blocks for confirmation\nI0825 10:42:11.861606 miner/worker.go:573] commit new work on block 189 with 50 txs & 0 uncles. Took 609.182259ms\nI0825 10:42:11.861696 miner/miner.go:119] Starting mining operation (CPU=4 TOT=25)\nI0825 10:42:12.089754 miner/worker.go:573] commit new work on block 190 with 0 txs & 0 uncles. Took 261.719Âµs\nI0825 10:42:12.263832 miner/miner.go:119] Starting mining operation (CPU=4 TOT=29)\nI0825 10:42:12.265277 miner/worker.go:573] commit new work on block 190 with 0 txs & 0 uncles. Took 1.221938ms\nI0825 10:42:12.508372 miner/miner.go:119] Starting mining operation (CPU=4 TOT=33)\nI0825 10:42:12.508929 miner/worker.go:573] commit new work on block 190 with 0 txs & 0 uncles. Took 499.909Âµs\nI0825 10:42:12.734714 miner/miner.go:119] Starting mining operation (CPU=4 TOT=37)\nI0825 10:42:12.735308 miner/worker.go:573] commit new work on block 190 with 0 txs & 0 uncles. Took 375.778Âµs\nI0825 10:42:14.051396 miner/miner.go:119] Starting mining operation (CPU=4 TOT=46)\nI0825 10:42:15.218144 miner/worker.go:573] commit new work on block 190 with 0 txs & 0 uncles. Took 298.943Âµs\nI0825 10:42:15.361249 miner/miner.go:119] Starting mining operation (CPU=4 TOT=50)\nI0825 10:42:16.717218 miner/worker.go:573] commit new work on block 190 with 0 txs & 0 uncles. Took 1.355905235s\nI0825 10:42:17.500571 miner/miner.go:119] Starting mining operation (CPU=4 TOT=54)\nI0825 10:42:17.500923 miner/worker.go:573] commit new work on block 190 with 0 txs & 0 uncles. Took 279.117Âµs\nI0825 10:42:17.780828 miner/miner.go:119] Starting mining operation (CPU=4 TOT=58)\nI0825 10:42:17.781361 miner/worker.go:573] commit new work on block 190 with 0 txs & 0 uncles. Took 262.624Âµs\n== No transactions left. Stopping miner...\nI0825 10:42:20.739047 miner/miner.go:119] Starting mining operation (CPU=4 TOT=5)\nI0825 10:42:20.739459 miner/worker.go:573] commit new work on block 190 with 0 txs & 0 uncles. Took 357.111Âµs\nI0825 10:42:21.601187 miner/worker.go:573] commit new work on block 190 with 0 txs & 0 uncles. Took 7.380731ms\nI0825 10:42:21.602076 miner/miner.go:119] Starting mining operation (CPU=4 TOT=39)\n== No transactions left. Stopping miner...\nI0825 10:42:21.624625 miner/worker.go:339] ðŸ”¨  Mined block (#190 / da12f53f). Wait 5 blocks for confirmation\nI0825 10:42:21.717035 miner/worker.go:573] commit new work on block 191 with 0 txs & 0 uncles. Took 307.93Âµs\npanic: close of nil channel\n\ngoroutine 2836 [running]:\npanic(0x47fb700, 0xc4205e4090)\n        /usr/local/opt/go/libexec/src/runtime/panic.go:500 +0x1a1\ngithub.com/ethereum/go-ethereum/miner.(*CpuAgent).Stop(0xc4459a38b0)\n        /private/tmp/ethereum-20160824-96982-s9fitz/build/_workspace/src/github.com/ethereum/go-ethereum/miner/agent.go:61 +0x65\ngithub.com/ethereum/go-ethereum/miner.(*worker).stop(0xc4203997a0)\n        /private/tmp/ethereum-20160824-96982-s9fitz/build/_workspace/src/github.com/ethereum/go-ethereum/miner/worker.go:199 +0x127\ngithub.com/ethereum/go-ethereum/miner.(*Miner).Stop(0xc420409200)\n        /private/tmp/ethereum-20160824-96982-s9fitz/build/_workspace/src/github.com/ethereum/go-ethereum/miner/miner.go:127 +0x2f\ngithub.com/ethereum/go-ethereum/eth.(*Ethereum).StopMining(0xc420399680)\n        /private/tmp/ethereum-20160824-96982-s9fitz/build/_workspace/src/github.com/ethereum/go-ethereum/eth/backend.go:385 +0x32\ngithub.com/ethereum/go-ethereum/eth.(*PrivateMinerAPI).Stop(0xc4201d61f8, 0x0)\n        /private/tmp/ethereum-20160824-96982-s9fitz/build/_workspace/src/github.com/ethereum/go-ethereum/eth/api.go:261 +0x2e\nreflect.Value.call(0xc4214cbbc0, 0xc4201d6918, 0x13, 0x48d893d, 0x4, 0xc4217a3e80, 0x1, 0x1, 0x743752a7f3fd1792, 0x14, ...)\n        /usr/local/opt/go/libexec/src/reflect/value.go:434 +0x5c8\nreflect.Value.Call(0xc4214cbbc0, 0xc4201d6918, 0x13, 0xc4217a3e80, 0x1, 0x1, 0x2, 0x2, 0xc420465618)\n        /usr/local/opt/go/libexec/src/reflect/value.go:302 +0xa4\ngithub.com/ethereum/go-ethereum/rpc.(*Server).handle(0xc420091ef0, 0x4e469a0, 0xc4201d8a50, 0x4e49d40, 0xc4200c7c70, 0xc448ad8fc0, 0xc4204657a0, 0xc420465720, 0xc444dff440)\n        /private/tmp/ethereum-20160824-96982-s9fitz/build/_workspace/src/github.com/ethereum/go-ethereum/rpc/server.go:323 +0x903\ngithub.com/ethereum/go-ethereum/rpc.(*Server).exec(0xc420091ef0, 0x4e469a0, 0xc4201d8a50, 0x4e49d40, 0xc4200c7c70, 0xc448ad8fc0)\n        /private/tmp/ethereum-20160824-96982-s9fitz/build/_workspace/src/github.com/ethereum/go-ethereum/rpc/server.go:345 +0x1e4\ncreated by github.com/ethereum/go-ethereum/rpc.(*Server).serveRequest\n        /private/tmp/ethereum-20160824-96982-s9fitz/build/_workspace/src/github.com/ethereum/go-ethereum/rpc/server.go:216 +0x34d\n```\n\nand another time\n\n```\nI0825 11:04:27.847320 miner/worker.go:339] ðŸ”¨  Mined block (#199 / 6d2aac6c). Wait 5 blocks for confirmation\nI0825 11:04:27.847640 miner/worker.go:573] commit new work on block 200 with 0 txs & 1 uncles. Took 283.353Âµs\nI0825 11:04:31.028575 miner/miner.go:119] Starting mining operation (CPU=4 TOT=70)\nI0825 11:04:31.028555 miner/miner.go:119] Starting mining operation (CPU=4 TOT=67)\nI0825 11:04:33.001447 miner/worker.go:339] ðŸ”¨  Mined block (#199 / e8d18fa7). Wait 5 blocks for confirmation\nI0825 11:04:33.823435 miner/worker.go:573] commit new work on block 200 with 0 txs & 1 uncles. Took 1.688746936s\nI0825 11:04:33.823771 miner/miner.go:119] Starting mining operation (CPU=4 TOT=73)\nI0825 11:04:33.824176 miner/worker.go:573] commit new work on block 200 with 0 txs & 1 uncles. Took 357.273Âµs\nI0825 11:04:38.107613 miner/worker.go:573] commit new work on block 200 with 0 txs & 1 uncles. Took 760.942976ms\nI0825 11:04:40.066858 miner/worker.go:573] commit new work on block 200 with 0 txs & 1 uncles. Took 1.408152ms\nI0825 11:04:40.067499 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 328.937Âµs\nI0825 11:04:41.956777 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 392.285Âµs\nI0825 11:04:41.957268 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 382.171Âµs\nI0825 11:04:48.731872 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 3.709715838s\nI0825 11:04:48.732346 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 354.505Âµs\nI0825 11:04:51.665796 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 694.453Âµs\nI0825 11:04:52.119866 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 1.066103ms\nI0825 11:04:52.120374 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 418.248Âµs\nI0825 11:04:55.830796 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 359.535Âµs\nI0825 11:04:55.831110 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 243.539Âµs\nI0825 11:05:00.916900 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 1.22005ms\nI0825 11:05:00.917346 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 360.515Âµs\nI0825 11:05:03.650018 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 372.837Âµs\nI0825 11:05:03.650331 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 235.644Âµs\nI0825 11:05:07.514641 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 386.16Âµs\nI0825 11:05:07.514958 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 253.433Âµs\nI0825 11:05:09.836426 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 491.46Âµs\nI0825 11:05:09.869512 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 525.265Âµs\nI0825 11:05:10.216684 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 332.964Âµs\nI0825 11:05:11.251834 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 346.189Âµs\nI0825 11:05:11.252218 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 319.868Âµs\nI0825 11:05:18.495318 miner/miner.go:119] Starting mining operation (CPU=4 TOT=89)\nI0825 11:05:18.495840 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 424.515Âµs\nI0825 11:05:18.496685 miner/miner.go:119] Starting mining operation (CPU=4 TOT=93)\nI0825 11:05:18.497184 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 392.348Âµs\nI0825 11:05:21.069182 miner/miner.go:119] Starting mining operation (CPU=4 TOT=97)\nI0825 11:05:21.069670 miner/worker.go:573] commit new work on block 200 with 0 txs & 2 uncles. Took 415.291Âµs\npanic: close of nil channel\n\ngoroutine 5315 [running]:\npanic(0x47fb700, 0xc439346a20)\n        /usr/local/opt/go/libexec/src/runtime/panic.go:500 +0x1a1\ngithub.com/ethereum/go-ethereum/miner.(*CpuAgent).Stop(0xc43b5e0a50)\n        /private/tmp/ethereum-20160824-96982-s9fitz/build/_workspace/src/github.com/ethereum/go-ethereum/miner/agent.go:61 +0x65\ngithub.com/ethereum/go-ethereum/miner.(*worker).stop(0xc4202c45a0)\n        /private/tmp/ethereum-20160824-96982-s9fitz/build/_workspace/src/github.com/ethereum/go-ethereum/miner/worker.go:199 +0x127\ngithub.com/ethereum/go-ethereum/miner.(*Miner).Stop(0xc4203f8f60)\n        /private/tmp/ethereum-20160824-96982-s9fitz/build/_workspace/src/github.com/ethereum/go-ethereum/miner/miner.go:127 +0x2f\ngithub.com/ethereum/go-ethereum/eth.(*Ethereum).StopMining(0xc4202c4360)\n        /private/tmp/ethereum-20160824-96982-s9fitz/build/_workspace/src/github.com/ethereum/go-ethereum/eth/backend.go:385 +0x32\ngithub.com/ethereum/go-ethereum/eth.(*PrivateMinerAPI).Stop(0xc4204287f8, 0x0)\n        /private/tmp/ethereum-20160824-96982-s9fitz/build/_workspace/src/github.com/ethereum/go-ethereum/eth/api.go:261 +0x2e\nreflect.Value.call(0xc4214450e0, 0xc420428f18, 0x13, 0x48d893d, 0x4, 0xc43bcf5e80, 0x1, 0x1, 0x0, 0x0, ...)\n        /usr/local/opt/go/libexec/src/reflect/value.go:434 +0x5c8\nreflect.Value.Call(0xc4214450e0, 0xc420428f18, 0x13, 0xc43bcf5e80, 0x1, 0x1, 0x0, 0x0, 0x0)\n        /usr/local/opt/go/libexec/src/reflect/value.go:302 +0xa4\ngithub.com/ethereum/go-ethereum/rpc.(*Server).handle(0xc420421ef0, 0x4e469a0, 0xc420253170, 0x4e49d40, 0xc42009e230, 0xc43bb86850, 0x0, 0x0, 0x0)\n        /private/tmp/ethereum-20160824-96982-s9fitz/build/_workspace/src/github.com/ethereum/go-ethereum/rpc/server.go:323 +0x903\ngithub.com/ethereum/go-ethereum/rpc.(*Server).exec(0xc420421ef0, 0x4e469a0, 0xc420253170, 0x4e49d40, 0xc42009e230, 0xc43bb86850)\n        /private/tmp/ethereum-20160824-96982-s9fitz/build/_workspace/src/github.com/ethereum/go-ethereum/rpc/server.go:345 +0x1e4\ncreated by github.com/ethereum/go-ethereum/rpc.(*Server).serveRequest\n        /private/tmp/ethereum-20160824-96982-s9fitz/build/_workspace/src/github.com/ethereum/go-ethereum/rpc/server.go:216 +0x34d\n```\n",
  "closed_by": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2948/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2948/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/260699548",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2948#issuecomment-260699548",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2948",
    "id": 260699548,
    "node_id": "MDEyOklzc3VlQ29tbWVudDI2MDY5OTU0OA==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-11-15T16:57:49Z",
    "updated_at": "2016-11-15T16:57:49Z",
    "author_association": "MEMBER",
    "body": "Fix released in 1.5.0.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/260699548/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
