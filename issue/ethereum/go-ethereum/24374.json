{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24374",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24374/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24374/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24374/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/24374",
  "id": 1132635947,
  "node_id": "I_kwDOAOvK985Dgqcr",
  "number": 24374,
  "title": "Slow snap sync",
  "user": {
    "login": "GBBx",
    "id": 76771769,
    "node_id": "MDQ6VXNlcjc2NzcxNzY5",
    "avatar_url": "https://avatars.githubusercontent.com/u/76771769?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/GBBx",
    "html_url": "https://github.com/GBBx",
    "followers_url": "https://api.github.com/users/GBBx/followers",
    "following_url": "https://api.github.com/users/GBBx/following{/other_user}",
    "gists_url": "https://api.github.com/users/GBBx/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/GBBx/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/GBBx/subscriptions",
    "organizations_url": "https://api.github.com/users/GBBx/orgs",
    "repos_url": "https://api.github.com/users/GBBx/repos",
    "events_url": "https://api.github.com/users/GBBx/events{/privacy}",
    "received_events_url": "https://api.github.com/users/GBBx/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-02-11T13:55:15Z",
  "updated_at": "2022-05-16T08:22:34Z",
  "closed_at": "2022-02-14T12:27:52Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\nThis problem seems to be the same as #23873 but the suggestions from that ticket do not help.\r\nI used to use Geth with `--syncmode=fast` and `--snapshot=false` but fast sync is not available anymore and I cannot turn off snapshot generation.\r\nWhen I updated to 1.10.15 and switched to `--syncmode=snap` it started to fall behind. I tried to resynchronise it from scratch but the difference between my `eth_blockNumber` and that of other sources, e.g. etherscan just keeps growing.\r\n\r\nI/O, memory, CPU seem to be in the normal range.\r\n\r\nGeth version: \r\n```\r\nVersion: 1.10.15-stable\r\nGit Commit: 8be800ffa9c4992666e2620e0ab4725a1a83352b\r\nGit Commit Date: 20220105\r\n```\r\nOS & Version: Linux\r\nCommit hash : `8be800ffa9c4992666e2620e0ab4725a1a83352b`\r\n\r\n#### Expected behaviour\r\n\"Snap\" sync should not be slower than \"fast\" sync.\r\n\r\n#### Actual behaviour\r\nSince version 1.10.15 Geth is slow to synchronise and unable to catch up.\r\n\r\n#### Steps to reproduce the behaviour\r\nUpdate from 1.10.13 to 1.10.15 and switch to `--syncmode=snap`.\r\n\r\n#### Backtrace\r\n\r\n````\r\nINFO [02-11|13:53:20.059] Aborting state snapshot generation       root=5c1ffc..f561fd at=0017f8..1fd7a6 accounts=58963 slots=93352 storage=9.30MiB elapsed=1h23m58.922s\r\nINFO [02-11|13:53:20.059] Resuming state snapshot generation       root=3e84ed..f10d3b at=0017f8..1fd7a6 accounts=58963 slots=93352 storage=9.30MiB elapsed=1h23m58.923s\r\nINFO [02-11|13:53:20.099] Imported new chain segment               blocks=1  txs=263  mgas=21.046 elapsed=12.071s      mgasps=1.743 number=14,063,809 hash=471239..156900 age=2w4d18h   dirty=255.09MiB\r\nINFO [02-11|13:53:33.393] Aborting state snapshot generation       root=3e84ed..f10d3b at=0017f8..1fd7a6 accounts=58963 slots=93352 storage=9.30MiB elapsed=1h24m12.257s\r\nINFO [02-11|13:53:33.393] Resuming state snapshot generation       root=bdd0de..3a04e8 at=0017f8..1fd7a6 accounts=58963 slots=93352 storage=9.30MiB elapsed=1h24m12.257s\r\nINFO [02-11|13:53:33.434] Imported new chain segment               blocks=1  txs=247  mgas=17.360 elapsed=13.335s      mgasps=1.302 number=14,063,810 hash=963e13..5ad4ad age=2w4d18h   dirty=254.64MiB\r\nINFO [02-11|13:53:45.721] Aborting state snapshot generation       root=bdd0de..3a04e8 at=0017f8..1fd7a6 accounts=58963 slots=93352 storage=9.30MiB elapsed=1h24m24.585s\r\nINFO [02-11|13:53:45.722] Resuming state snapshot generation       root=5e9040..d7e88a at=0017f8..1fd7a6 accounts=58963 slots=93352 storage=9.30MiB elapsed=1h24m24.585s\r\nINFO [02-11|13:53:45.726] Imported new chain segment               blocks=1  txs=66   mgas=5.705  elapsed=12.292s      mgasps=0.464 number=14,063,811 hash=a2843c..cb0e65 age=2w4d18h   dirty=255.11MiB\r\nINFO [02-11|13:53:51.647] Deep froze chain segment                 blocks=5  elapsed=19.039ms     number=13,973,811 hash=420665..353775\r\nINFO [02-11|13:53:57.910] Aborting state snapshot generation       root=5e9040..d7e88a at=0017f8..1fd7a6 accounts=58963 slots=93352 storage=9.30MiB elapsed=1h24m36.774s\r\nINFO [02-11|13:53:57.911] Resuming state snapshot generation       root=64bbe4..c60c90 at=0017f8..1fd7a6 accounts=58963 slots=93352 storage=9.30MiB elapsed=1h24m36.774s\r\nINFO [02-11|13:53:57.929] Imported new chain segment               blocks=1  txs=16   mgas=1.090  elapsed=12.202s      mgasps=0.089 number=14,063,812 hash=5145d5..b62f2b age=2w4d18h   dirty=253.30MiB\r\nINFO [02-11|13:54:10.213] Aborting state snapshot generation       root=64bbe4..c60c90 at=0017f8..1fd7a6 accounts=58963 slots=93352 storage=9.30MiB elapsed=1h24m49.077s\r\nINFO [02-11|13:54:10.214] Resuming state snapshot generation       root=bd9991..2e5181 at=0017f8..1fd7a6 accounts=58963 slots=93352 storage=9.30MiB elapsed=1h24m49.077s\r\nINFO [02-11|13:54:10.248] Imported new chain segment               blocks=1  txs=386  mgas=29.996 elapsed=12.318s      mgasps=2.435 number=14,063,813 hash=9e9bff..b61b6d age=2w4d18h   dirty=253.88MiB\r\n\r\n````\r\n\r\nWhen submitting logs: please submit them as text and not screenshots.",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24374/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24374/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1036248642",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24374#issuecomment-1036248642",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24374",
    "id": 1036248642,
    "node_id": "IC_kwDOAOvK9849w-ZC",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-11T14:07:06Z",
    "updated_at": "2022-02-11T14:07:06Z",
    "author_association": "MEMBER",
    "body": "Your node is generating the snapshot after finishing up snap sync. The snapshot only needs to be generated once. I'm guessing the extra processing is affecting block import performance. Please wait until the snapshot has been fully generated and see if the node starts catching up then.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1036248642/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1036359546",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24374#issuecomment-1036359546",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24374",
    "id": 1036359546,
    "node_id": "IC_kwDOAOvK9849xZd6",
    "user": {
      "login": "GBBx",
      "id": 76771769,
      "node_id": "MDQ6VXNlcjc2NzcxNzY5",
      "avatar_url": "https://avatars.githubusercontent.com/u/76771769?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/GBBx",
      "html_url": "https://github.com/GBBx",
      "followers_url": "https://api.github.com/users/GBBx/followers",
      "following_url": "https://api.github.com/users/GBBx/following{/other_user}",
      "gists_url": "https://api.github.com/users/GBBx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/GBBx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/GBBx/subscriptions",
      "organizations_url": "https://api.github.com/users/GBBx/orgs",
      "repos_url": "https://api.github.com/users/GBBx/repos",
      "events_url": "https://api.github.com/users/GBBx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/GBBx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-11T15:57:12Z",
    "updated_at": "2022-02-11T15:57:12Z",
    "author_association": "NONE",
    "body": "@s1na Thank you for the hint.\r\n\r\nI just found this in the log after a restart:\r\n```\r\nWARN [02-11|15:54:46.034] Head state missing, repairing            number=14,063,980 hash=26a5e0..d6eb07 snaproot=1516dd..9cfa07\r\nINFO [02-11|15:54:49.912] Loaded most recent local header          number=14,063,980 hash=26a5e0..d6eb07 td=39,686,017,956,806,147,053,811 age=2w4d19h\r\nINFO [02-11|15:54:49.912] Loaded most recent local full block      number=14,063,387 hash=7b429d..a37d83 td=39,678,434,622,220,812,476,496 age=2w4d21h\r\nINFO [02-11|15:54:49.912] Loaded most recent local fast block      number=14,063,980 hash=26a5e0..d6eb07 td=39,686,017,956,806,147,053,811 age=2w4d19h\r\nINFO [02-11|15:54:49.912] Loaded last fast-sync pivot marker       number=13,214,746\r\nWARN [02-11|15:54:49.917] Enabling snapshot recovery               chainhead=14,063,387 diskbase=14,063,972\r\nWARN [02-11|15:54:49.925] Loaded snapshot journal                  diskroot=1516dd..9cfa07 diffs=unmatched\r\nWARN [02-11|15:54:49.925] Snapshot is not continuous with chain    snaproot=1516dd..9cfa07 chainroot=776eae..38a447\r\nINFO [02-11|15:54:49.926] Resuming state snapshot generation       root=1516dd..9cfa07 at=0017f8..1fd7a6 accounts=58963 slots=93352 storage=9.30MiB elapsed=\"131.343µs\"\r\nINFO [02-11|15:54:49.926] Loaded local transaction journal         transactions=0 dropped=0\r\nINFO [02-11|15:54:49.926] Regenerated local transaction journal    transactions=0 accounts=0\r\nWARN [02-11|15:54:49.927] Switch sync mode from snap sync to full sync\r\n```\r\n\r\nDo you - or anybody else - know why it switches to full sync?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1036359546/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1036377572",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24374#issuecomment-1036377572",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24374",
    "id": 1036377572,
    "node_id": "IC_kwDOAOvK9849xd3k",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-11T16:15:59Z",
    "updated_at": "2022-02-11T16:15:59Z",
    "author_association": "MEMBER",
    "body": "You already finished sync, but now it's catching up two weeks worth of blocks, while also generating the new snapshot. I'd recommend to run 'geth --nodiscover --maxpeers 0' and let it finish generating in peace, then process the blocks afterwards. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1036377572/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1036378991",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24374#issuecomment-1036378991",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24374",
    "id": 1036378991,
    "node_id": "IC_kwDOAOvK9849xeNv",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-11T16:17:37Z",
    "updated_at": "2022-02-11T16:17:37Z",
    "author_association": "MEMBER",
    "body": "Sorry, didn't see the other messages :)It switches to full sync, i.e import block by block, after the fast/snap sync is complete.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1036378991/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1127375363",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24374#issuecomment-1127375363",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24374",
    "id": 1127375363,
    "node_id": "IC_kwDOAOvK985DMmID",
    "user": {
      "login": "hritique",
      "id": 47852078,
      "node_id": "MDQ6VXNlcjQ3ODUyMDc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/47852078?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hritique",
      "html_url": "https://github.com/hritique",
      "followers_url": "https://api.github.com/users/hritique/followers",
      "following_url": "https://api.github.com/users/hritique/following{/other_user}",
      "gists_url": "https://api.github.com/users/hritique/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hritique/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hritique/subscriptions",
      "organizations_url": "https://api.github.com/users/hritique/orgs",
      "repos_url": "https://api.github.com/users/hritique/repos",
      "events_url": "https://api.github.com/users/hritique/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hritique/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-16T08:22:34Z",
    "updated_at": "2022-05-16T08:22:34Z",
    "author_association": "NONE",
    "body": "I'm getting these logs everytime I restart the node. And it starts syncing from a couple of days back(not the last synced block)\r\nShouldn't it just pickup from the last block it synced before the restart?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1127375363/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
