{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28645",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28645/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28645/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28645/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/28645",
  "id": 2026397170,
  "node_id": "I_kwDOAOvK9854yF3y",
  "number": 28645,
  "title": "Sustained high CPU usage after switching to path-based scheme",
  "user": {
    "login": "vogelito",
    "id": 1325863,
    "node_id": "MDQ6VXNlcjEzMjU4NjM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1325863?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vogelito",
    "html_url": "https://github.com/vogelito",
    "followers_url": "https://api.github.com/users/vogelito/followers",
    "following_url": "https://api.github.com/users/vogelito/following{/other_user}",
    "gists_url": "https://api.github.com/users/vogelito/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vogelito/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vogelito/subscriptions",
    "organizations_url": "https://api.github.com/users/vogelito/orgs",
    "repos_url": "https://api.github.com/users/vogelito/repos",
    "events_url": "https://api.github.com/users/vogelito/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vogelito/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-12-05T14:52:42Z",
  "updated_at": "2023-12-05T16:39:55Z",
  "closed_at": "2023-12-05T16:35:20Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: \r\n```\r\n$ geth version\r\nGeth\r\nVersion: 1.13.5-stable\r\nGit Commit: 916d6a441a866cb618ae826c220866de118899f7\r\nArchitecture: amd64\r\nGo Version: go1.21.4\r\nOperating System: linux\r\nGOPATH=\r\nGOROOT=\r\n```\r\nCL client & version: lighthouse\r\n```\r\nLighthouse v4.4.1-2841f60\r\nBLS library: blst-portable\r\nSHA256 hardware acceleration: false\r\nAllocator: jemalloc\r\nProfile: maxperf\r\nSpecs: mainnet (true), minimal (false), gnosis (true)\r\n```\r\nOS & Version: Linux\r\n```\r\n$ uname -a\r\nLinux lighthouse-mainnet 5.4.0-1054-aws #57~18.04.1-Ubuntu SMP Thu Jul 15 03:21:36 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\r\n```\r\n\r\n#### Expected behaviour\r\nCPU usage of my node was around 30-40% before upgrade. \r\n\r\n#### Actual behaviour\r\nAfter upgrade CPU usage is sustained at 85%+. This is making me miss attestations on my validator node.\r\n\r\nIn the following graph, you can see when I switched over to path-based scheme, CPU usage went up to 100%. The first big dip is when the node finally synced. However, it went straight back up and even though the trend is clearly decreasing CPU usage, it's still very high.\r\n\r\n<img width=\"504\" alt=\"image\" src=\"https://github.com/ethereum/go-ethereum/assets/1325863/5acc01ab-f2ce-4b7b-b16e-44d5883bc34b\">\r\n\r\nHere's a disk latency chart that makes it obvious when the node stopped sync'ing:\r\n<img width=\"501\" alt=\"image\" src=\"https://github.com/ethereum/go-ethereum/assets/1325863/0cee42f8-22da-49e2-aca0-9cf3a1a5049c\">\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nThis is the path I followed:\r\n\r\n1. Stopped my node\r\n2. ran `geth removedb` Selected yes for `Remove full node state database` and no for `Remove full node ancient database`\r\n3. Added `--state.scheme=path` to my service and started the node\r\n\r\n```\r\n$ geth removedb\r\nINFO [12-04|23:19:22.490] Maximum peer count                       ETH=50 LES=0 total=50\r\nINFO [12-04|23:19:22.493] Smartcard socket not found, disabling    err=\"stat /run/pcscd/pcscd.comm: no such file or directory\"\r\nINFO [12-04|23:19:22.496] Set global gas cap                       cap=50,000,000\r\nINFO [12-04|23:19:22.497] Initializing the KZG library             backend=gokzg\r\nRemove full node state database (/home/ether/.ethereum/geth/chaindata)? [y/n] y\r\nRemove full node state database (/home/ether/.ethereum/geth/chaindata)? [y/n] y\r\nINFO [12-04|23:19:56.413] Database successfully deleted            path=/home/ether/.ethereum/geth/chaindata elapsed=30.368s\r\nRemove full node ancient database (/home/ether/.ethereum/geth/chaindata/ancient)? [y/n] n\r\nRemove full node ancient database (/home/ether/.ethereum/geth/chaindata/ancient)? [y/n] n\r\nINFO [12-04|23:20:07.446] Database deletion skipped                path=/home/ether/.ethereum/geth/chaindata/ancient\r\nINFO [12-04|23:20:07.446] Light node database missing              path=/home/ether/.ethereum/geth/lightchaindata\r\n```\r\n\r\n#### Logs\r\n\r\nThese are the last few log lines. I see a lot of `Generating/Aborting/Resuming state snapshot` going back to right after geth fully sync'ed\r\n````\r\nDec 05 14:48:49 lighthouse-mainnet geth[6666]: INFO [12-05|14:48:49.670] Chain head was updated                   number=18,720,838 hash=15b2c3..9b7023 root=07f35f..e11ffe elapsed=43.783712ms\r\nDec 05 14:48:56 lighthouse-mainnet geth[6666]: INFO [12-05|14:48:56.914] Generating state snapshot                root=afe02a..7a2a81 in=e4d318..5bdf82 at=975037..48af57 accounts=203,146,664          slots=955,519,931             storage=78.10GiB  \r\nDec 05 14:49:02 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:02.869] Aborting state snapshot generation       root=afe02a..7a2a81 in=e4d318..5bdf82 at=e3b6b8..aa0fdf accounts=203,146,664          slots=956,095,419             storage=78.14GiB  \r\nDec 05 14:49:02 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:02.878] Resuming state snapshot generation       root=71c439..e07206 in=e4d318..5bdf82 at=e3b6b8..aa0fdf accounts=203,146,664          slots=956,095,419             storage=78.14GiB  \r\nDec 05 14:49:02 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:02.900] Imported new potential chain segment     number=18,720,839 hash=54d01b..cbcf9b blocks=1          txs=293        mgas=24.745  elapsed=657.268ms    mgasps=37.648 snapdiffs=299.7\r\nDec 05 14:49:03 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:03.780] Chain head was updated                   number=18,720,839 hash=54d01b..cbcf9b root=2789c9..f40030 elapsed=36.692129ms\r\nDec 05 14:49:10 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:10.878] Generating state snapshot                root=71c439..e07206 in=e4f0a2..812d87 at=290dec..f3e563 accounts=203,249,257          slots=956,514,475             storage=78.17GiB  \r\nDec 05 14:49:14 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:14.325] Aborting state snapshot generation       root=71c439..e07206 in=e506cf..977f29 at=ae99d8..1090de accounts=203,325,998          slots=956,672,700             storage=78.19GiB  \r\nDec 05 14:49:14 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:14.344] Resuming state snapshot generation       root=282483..aa3cfa in=e506cf..977f29 at=ae99d8..1090de accounts=203,325,998          slots=956,672,700             storage=78.19GiB  \r\nDec 05 14:49:14 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:14.378] Imported new potential chain segment     number=18,720,840 hash=25815c..5d9994 blocks=1          txs=232        mgas=15.972  elapsed=598.472ms    mgasps=26.688 snapdiffs=309.2\r\nDec 05 14:49:15 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:15.084] Chain head was updated                   number=18,720,840 hash=25815c..5d9994 root=fc875d..ed3cd6 elapsed=9.513915ms\r\nDec 05 14:49:22 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:22.349] Generating state snapshot                root=282483..aa3cfa in=e5279d..e0d9e4 at=006e1b..badfb5 accounts=203,439,684          slots=957,046,309             storage=78.22GiB  \r\nDec 05 14:49:25 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:25.449] Aborting state snapshot generation       root=282483..aa3cfa in=e5279d..e0d9e4 at=28fbea..af23cc accounts=203,439,684          slots=957,332,005             storage=78.24GiB  \r\nDec 05 14:49:25 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:25.461] Resuming state snapshot generation       root=e01842..e27a25 in=e5279d..e0d9e4 at=28fbea..af23cc accounts=203,439,684          slots=957,332,005             storage=78.24GiB  \r\nDec 05 14:49:25 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:25.490] Imported new potential chain segment     number=18,720,841 hash=577c59..dda544 blocks=1          txs=200        mgas=18.188  elapsed=546.490ms    mgasps=33.282 snapdiffs=324.0\r\nDec 05 14:49:26 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:26.088] Chain head was updated                   number=18,720,841 hash=577c59..dda544 root=613a10..e87186 elapsed=38.403323ms\r\nDec 05 14:49:33 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:33.464] Generating state snapshot                root=e01842..e27a25 in=e5279d..e0d9e4 at=89047a..6aa26b accounts=203,439,684          slots=958,007,846             storage=78.29GiB  \r\nDec 05 14:49:38 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:38.145] Aborting state snapshot generation       root=e01842..e27a25 in=e5279d..e0d9e4 at=c9921c..045c4c accounts=203,439,684          slots=958,462,502             storage=78.32GiB  \r\nDec 05 14:49:38 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:38.160] Resuming state snapshot generation       root=5b55df..c35382 in=e5279d..e0d9e4 at=c9921c..045c4c accounts=203,439,684          slots=958,462,502             storage=78.32GiB  \r\nDec 05 14:49:38 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:38.176] Imported new potential chain segment     number=18,720,842 hash=0f2574..69bccf blocks=1          txs=192        mgas=18.719  elapsed=597.330ms    mgasps=31.338 snapdiffs=337.3\r\nDec 05 14:49:38 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:38.892] Chain head was updated                   number=18,720,842 hash=0f2574..69bccf root=bb26a8..9bf3a9 elapsed=29.194368ms\r\nDec 05 14:49:46 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:46.172] Generating state snapshot                root=5b55df..c35382 in=e538dc..a583b9 at=4ab307..cc487a accounts=203,499,861          slots=959,033,683             storage=78.36GiB  \r\nDec 05 14:49:50 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:50.402] Aborting state snapshot generation       root=5b55df..c35382 in=e549c4..4a4177 at=2d0a9c..6a9816 accounts=203,559,006          slots=959,320,936             storage=78.38GiB  \r\nDec 05 14:49:50 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:50.421] Resuming state snapshot generation       root=b9a2eb..ef2f52 in=e549c4..4a4177 at=2d0a9c..6a9816 accounts=203,559,006          slots=959,320,936             storage=78.38GiB  \r\nDec 05 14:49:50 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:50.466] Imported new potential chain segment     number=18,720,843 hash=c2abd5..3afe6f blocks=1          txs=162        mgas=11.976  elapsed=524.109ms    mgasps=22.851 snapdiffs=319.7\r\nDec 05 14:49:51 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:51.108] Chain head was updated                   number=18,720,843 hash=c2abd5..3afe6f root=cc02ad..6d4a98 elapsed=6.290756ms\r\nDec 05 14:49:58 lighthouse-mainnet geth[6666]: INFO [12-05|14:49:58.421] Generating state snapshot                root=b9a2eb..ef2f52 at=e56aa8..461d3a accounts=203,673,107          slots=959,617,665             storage=78.41GiB   dangling=0 elapse\r\nDec 05 14:50:02 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:02.508] Aborting state snapshot generation       root=b9a2eb..ef2f52 at=e58628..2ab1be accounts=203,768,299          slots=959,768,148             storage=78.43GiB   dangling=0 elapse\r\nDec 05 14:50:02 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:02.511] Resuming state snapshot generation       root=9509cd..62612d at=e58628..2ab1be accounts=203,768,299          slots=959,768,148             storage=78.43GiB   dangling=0 elapse\r\nDec 05 14:50:02 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:02.541] Imported new potential chain segment     number=18,720,844 hash=fcb664..34bc13 blocks=1          txs=160        mgas=10.515  elapsed=284.516ms    mgasps=36.956 snapdiffs=316.4\r\nDec 05 14:50:02 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:02.986] Chain head was updated                   number=18,720,844 hash=fcb664..34bc13 root=2c43eb..f52a75 elapsed=6.676037ms\r\nDec 05 14:50:10 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:10.515] Generating state snapshot                root=9509cd..62612d at=e593d8..5764ac accounts=203,815,793          slots=960,247,701             storage=78.46GiB   dangling=0 elapse\r\nDec 05 14:50:12 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:12.934] Aborting state snapshot generation       root=9509cd..62612d at=e59d67..525323 accounts=203,848,948          slots=960,427,004             storage=78.47GiB   dangling=0 elapse\r\nDec 05 14:50:12 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:12.937] Resuming state snapshot generation       root=564b44..d9386b at=e59d67..525323 accounts=203,848,948          slots=960,427,004             storage=78.47GiB   dangling=0 elapse\r\nDec 05 14:50:12 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:12.964] Imported new potential chain segment     number=18,720,845 hash=abcb19..7248f6 blocks=1          txs=210        mgas=12.086  elapsed=314.788ms    mgasps=38.395 snapdiffs=321.1\r\nDec 05 14:50:13 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:13.488] Chain head was updated                   number=18,720,845 hash=abcb19..7248f6 root=3674b8..efb131 elapsed=7.300266ms\r\nDec 05 14:50:20 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:20.938] Generating state snapshot                root=564b44..d9386b at=e5d235..e6caf8 accounts=204,031,494          slots=960,661,233             storage=78.50GiB   dangling=0 elapse\r\nDec 05 14:50:26 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:26.023] Aborting state snapshot generation       root=564b44..d9386b at=e5ec95..872f2e accounts=204,122,888          slots=961,013,337             storage=78.53GiB   dangling=0 elapse\r\nDec 05 14:50:26 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:26.037] Resuming state snapshot generation       root=07f35f..e11ffe at=e5ec95..872f2e accounts=204,122,888          slots=961,013,337             storage=78.53GiB   dangling=0 elapse\r\nDec 05 14:50:26 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:26.055] Imported new potential chain segment     number=18,720,846 hash=e620c1..081783 blocks=1          txs=171        mgas=10.985  elapsed=189.556ms    mgasps=57.951 snapdiffs=324.3\r\nDec 05 14:50:26 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:26.654] Chain head was updated                   number=18,720,846 hash=e620c1..081783 root=8a3782..e3d9d9 elapsed=6.123952ms\r\nDec 05 14:50:34 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:34.038] Generating state snapshot                root=07f35f..e11ffe in=e60d51..e3386e at=3d633d..f75360 accounts=204,236,501          slots=961,249,903             storage=78.55GiB  \r\nDec 05 14:50:37 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:37.333] Aborting state snapshot generation       root=07f35f..e11ffe at=e621ac..94e789 accounts=204,307,098          slots=961,408,852             storage=78.56GiB   dangling=0 elapse\r\nDec 05 14:50:37 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:37.336] Resuming state snapshot generation       root=2789c9..f40030 at=e621ac..94e789 accounts=204,307,098          slots=961,408,852             storage=78.56GiB   dangling=0 elapse\r\nDec 05 14:50:37 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:37.360] Imported new potential chain segment     number=18,720,847 hash=3b2d7d..68db1b blocks=1          txs=226        mgas=15.334  elapsed=364.845ms    mgasps=42.029 snapdiffs=309.6\r\nDec 05 14:50:38 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:38.078] Chain head was updated                   number=18,720,847 hash=3b2d7d..68db1b root=83883d..291bce elapsed=81.721173ms\r\nDec 05 14:50:45 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:45.363] Generating state snapshot                root=2789c9..f40030 in=e6421a..803c38 at=416eda..fd9223 accounts=204,419,821          slots=961,817,408             storage=78.60GiB  \r\nDec 05 14:50:50 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:50.443] Aborting state snapshot generation       root=2789c9..f40030 at=e64e56..c25555 accounts=204,462,379          slots=962,136,990             storage=78.62GiB   dangling=0 elapse\r\nDec 05 14:50:50 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:50.456] Resuming state snapshot generation       root=fc875d..ed3cd6 at=e64e56..c25555 accounts=204,462,379          slots=962,136,990             storage=78.62GiB   dangling=0 elapse\r\nDec 05 14:50:51 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:51.606] Imported new potential chain segment     number=18,720,848 hash=5aff53..ecec37 blocks=1          txs=122        mgas=7.771   elapsed=1.385s       mgasps=5.610  snapdiffs=289.3\r\nDec 05 14:50:52 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:52.134] Chain head was updated                   number=18,720,848 hash=5aff53..ecec37 root=ef42f9..2b92fb elapsed=3.270121ms\r\nDec 05 14:50:58 lighthouse-mainnet geth[6666]: INFO [12-05|14:50:58.456] Generating state snapshot                root=fc875d..ed3cd6 in=e66cb6..2b8009 at=a16cd3..2acbf3 accounts=204,567,733          slots=962,378,291             storage=78.64GiB  \r\nDec 05 14:51:01 lighthouse-mainnet geth[6666]: INFO [12-05|14:51:01.029] Aborting state snapshot generation       root=fc875d..ed3cd6 at=e67a66..903a7c accounts=204,614,850          slots=962,439,401             storage=78.65GiB   dangling=0 elapse\r\nDec 05 14:51:01 lighthouse-mainnet geth[6666]: INFO [12-05|14:51:01.033] Resuming state snapshot generation       root=613a10..e87186 at=e67a66..903a7c accounts=204,614,850          slots=962,439,401             storage=78.65GiB   dangling=0 elapse\r\nDec 05 14:51:01 lighthouse-mainnet geth[6666]: INFO [12-05|14:51:01.061] Imported new potential chain segment     number=18,720,849 hash=fa3077..0f6a76 blocks=1          txs=135        mgas=14.521  elapsed=296.608ms    mgasps=48.955 snapdiffs=267.1\r\nDec 05 14:51:01 lighthouse-mainnet geth[6666]: INFO [12-05|14:51:01.675] Chain head was updated                   number=18,720,849 hash=fa3077..0f6a76 root=ea2aa8..25ff58 elapsed=13.912528ms\r\n````\r\n\r\nWhen submitting logs: please submit them as text and not screenshots.\r\n",
  "closed_by": {
    "login": "MariusVanDerWijden",
    "id": 16664698,
    "node_id": "MDQ6VXNlcjE2NjY0Njk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MariusVanDerWijden",
    "html_url": "https://github.com/MariusVanDerWijden",
    "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
    "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
    "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
    "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
    "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
    "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28645/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28645/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1841156314",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28645#issuecomment-1841156314",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28645",
    "id": 1841156314,
    "node_id": "IC_kwDOAOvK985tvdDa",
    "user": {
      "login": "vogelito",
      "id": 1325863,
      "node_id": "MDQ6VXNlcjEzMjU4NjM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1325863?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vogelito",
      "html_url": "https://github.com/vogelito",
      "followers_url": "https://api.github.com/users/vogelito/followers",
      "following_url": "https://api.github.com/users/vogelito/following{/other_user}",
      "gists_url": "https://api.github.com/users/vogelito/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vogelito/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vogelito/subscriptions",
      "organizations_url": "https://api.github.com/users/vogelito/orgs",
      "repos_url": "https://api.github.com/users/vogelito/repos",
      "events_url": "https://api.github.com/users/vogelito/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vogelito/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-05T16:32:29Z",
    "updated_at": "2023-12-05T16:32:29Z",
    "author_association": "NONE",
    "body": "Well, of course right after posting that, CPU usage went back to normal and things are nice again (no missed attestations anymore):\r\n\r\n<img width=\"666\" alt=\"image\" src=\"https://github.com/ethereum/go-ethereum/assets/1325863/530aca64-21ea-4536-ab5c-e9b00378553c\">\r\n\r\nAnd yes, the CPU decrease matches the time the `Generated state snapshot` log line appears:\r\n\r\n```\r\nDec 05 15:25:57 lighthouse-mainnet geth[6666]: INFO [12-05|15:25:57.548] Generating state snapshot                root=025da5..9bddd4 at=fefb8b..9b9414 accounts=226,371,130          slots=1,080,751,648           \r\nDec 05 15:26:01 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:01.871] Aborting state snapshot generation       root=025da5..9bddd4 at=ff170f..edf0af accounts=226,466,750          slots=1,080,962,249           \r\nDec 05 15:26:01 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:01.886] Resuming state snapshot generation       root=5db813..34d122 at=ff170f..edf0af accounts=226,466,750          slots=1,080,962,249           \r\nDec 05 15:26:01 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:01.922] Imported new potential chain segment     number=18,721,024 hash=4feab4..13e504 blocks=1          txs=154        mgas=11.383  elapsed=556.99\r\nDec 05 15:26:02 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:02.468] Chain head was updated                   number=18,721,024 hash=4feab4..13e504 root=f65a3a..54ade9 elapsed=22.346594ms\r\nDec 05 15:26:09 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:09.904] Generating state snapshot                root=5db813..34d122 in=ff2983..675da4 at=e54c0b..6eade6 accounts=226,531,449          slots=1,081,\r\nDec 05 15:26:13 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:13.903] Aborting state snapshot generation       root=5db813..34d122 at=ff3e0b..f2ac7e accounts=226,602,576          slots=1,081,581,479           \r\nDec 05 15:26:13 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:13.909] Resuming state snapshot generation       root=cc9784..e9adb4 at=ff3e0b..f2ac7e accounts=226,602,576          slots=1,081,581,479           \r\nDec 05 15:26:13 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:13.935] Imported new potential chain segment     number=18,721,025 hash=53079d..96cc4d blocks=1          txs=201        mgas=15.831  elapsed=461.19\r\nDec 05 15:26:14 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:14.534] Chain head was updated                   number=18,721,025 hash=53079d..96cc4d root=53aa4d..7400d5 elapsed=8.107828ms\r\nDec 05 15:26:21 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:21.910] Generating state snapshot                root=cc9784..e9adb4 at=ff590e..2513cc accounts=226,696,545          slots=1,082,022,497           \r\nDec 05 15:26:25 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:25.575] Aborting state snapshot generation       root=cc9784..e9adb4 in=ff6db6..42d1f6 at=43ae24..5265d7 accounts=226,768,591          slots=1,082,\r\nDec 05 15:26:25 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:25.586] Resuming state snapshot generation       root=b3db05..960bd0 in=ff6db6..42d1f6 at=43ae24..5265d7 accounts=226,768,591          slots=1,082,\r\nDec 05 15:26:25 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:25.607] Imported new potential chain segment     number=18,721,026 hash=0054bb..e9a893 blocks=1          txs=166        mgas=12.462  elapsed=365.44\r\nDec 05 15:26:26 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:26.196] Chain head was updated                   number=18,721,026 hash=0054bb..e9a893 root=cd4588..267953 elapsed=10.364218ms\r\nDec 05 15:26:33 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:33.586] Generating state snapshot                root=b3db05..960bd0 at=ff90d7..ff2268 accounts=226,890,091          slots=1,082,633,422           \r\nDec 05 15:26:37 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:37.379] Aborting state snapshot generation       root=b3db05..960bd0 at=ffa1d3..3e0ae6 accounts=226,948,964          slots=1,082,815,706           \r\nDec 05 15:26:37 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:37.386] Resuming state snapshot generation       root=b3bbb1..826f1b at=ffa1d3..3e0ae6 accounts=226,948,964          slots=1,082,815,706           \r\nDec 05 15:26:37 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:37.408] Imported new potential chain segment     number=18,721,027 hash=f899e3..9428f6 blocks=1          txs=147        mgas=18.380  elapsed=353.12\r\nDec 05 15:26:38 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:38.075] Chain head was updated                   number=18,721,027 hash=f899e3..9428f6 root=a3a352..56fa4a elapsed=19.293732ms\r\nDec 05 15:26:45 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:45.390] Generating state snapshot                root=b3bbb1..826f1b in=ffc856..6b9af9 at=ce9ea2..65b112 accounts=227,082,515          slots=1,083,\r\nDec 05 15:26:49 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:49.867] Aborting state snapshot generation       root=b3bbb1..826f1b at=ffd810..7edbac accounts=227,136,888          slots=1,083,526,207           \r\nDec 05 15:26:49 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:49.872] Resuming state snapshot generation       root=5b7f94..c627e4 at=ffd810..7edbac accounts=227,136,888          slots=1,083,526,207           \r\nDec 05 15:26:49 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:49.892] Imported new potential chain segment     number=18,721,028 hash=6aec4b..06aa74 blocks=1          txs=134        mgas=12.177  elapsed=301.35\r\nDec 05 15:26:50 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:50.488] Chain head was updated                   number=18,721,028 hash=6aec4b..06aa74 root=ba1f1b..0aa4c5 elapsed=11.977663ms\r\nDec 05 15:26:57 lighthouse-mainnet geth[6666]: INFO [12-05|15:26:57.874] Generating state snapshot                root=5b7f94..c627e4 in=ffeb92..4e53dc at=9574fd..4b954f accounts=227,204,647          slots=1,084,\r\nDec 05 15:27:01 lighthouse-mainnet geth[6666]: INFO [12-05|15:27:01.100] Aborting state snapshot generation       root=5b7f94..c627e4 in=ffecdf..d83e4b at=88b252..88b205 accounts=227,209,192          slots=1,084,\r\nDec 05 15:27:01 lighthouse-mainnet geth[6666]: INFO [12-05|15:27:01.118] Resuming state snapshot generation       root=6f10e3..8784b0 in=ffecdf..d83e4b at=88b252..88b205 accounts=227,209,192          slots=1,084,\r\nDec 05 15:27:01 lighthouse-mainnet geth[6666]: INFO [12-05|15:27:01.131] Imported new potential chain segment     number=18,721,029 hash=8c6183..cf4546 blocks=1          txs=168        mgas=11.370  elapsed=447.34\r\nDec 05 15:27:01 lighthouse-mainnet geth[6666]: INFO [12-05|15:27:01.626] Chain head was updated                   number=18,721,029 hash=8c6183..cf4546 root=ca6a50..55fc1f elapsed=4.914114ms\r\nDec 05 15:27:05 lighthouse-mainnet geth[6666]: INFO [12-05|15:27:05.936] Generated state snapshot                 accounts=227,275,652          slots=1,084,568,288           storage=88.48GiB   dangling=0 elapsed=\r\nDec 05 15:27:13 lighthouse-mainnet geth[6666]: INFO [12-05|15:27:13.826] Imported new potential chain segment     number=18,721,030 hash=f4d4e1..05823e blocks=1          txs=291        mgas=22.158  elapsed=238.01\r\nDec 05 15:27:14 lighthouse-mainnet geth[6666]: INFO [12-05|15:27:14.232] Chain head was updated                   number=18,721,030 hash=f4d4e1..05823e root=cb73ab..44d814 elapsed=9.361688ms\r\nDec 05 15:27:25 lighthouse-mainnet geth[6666]: INFO [12-05|15:27:25.104] Imported new potential chain segment     number=18,721,031 hash=5850c9..a7e012 blocks=1          txs=134        mgas=10.249  elapsed=146.95\r\nDec 05 15:27:25 lighthouse-mainnet geth[6666]: INFO [12-05|15:27:25.454] Chain head was updated                   number=18,721,031 hash=5850c9..a7e012 root=cf1f5f..872eb6 elapsed=12.20023ms\r\nDec 05 15:27:37 lighthouse-mainnet geth[6666]: INFO [12-05|15:27:37.474] Imported new potential chain segment     number=18,721,032 hash=c788b5..c8f1d3 blocks=1          txs=169        mgas=13.746  elapsed=198.35\r\nDec 05 15:27:37 lighthouse-mainnet geth[6666]: INFO [12-05|15:27:37.854] Chain head was updated                   number=18,721,032 hash=c788b5..c8f1d3 root=4245ea..421a69 elapsed=5.848232ms\r\nDec 05 15:27:49 lighthouse-mainnet geth[6666]: INFO [12-05|15:27:49.674] Imported new potential chain segment     number=18,721,033 hash=f584ca..3f6e8a blocks=1          txs=154        mgas=15.046  elapsed=167.77\r\nDec 05 15:27:50 lighthouse-mainnet geth[6666]: INFO [12-05|15:27:50.028] Chain head was updated                   number=18,721,033 hash=f584ca..3f6e8a root=76624d..8761cf elapsed=3.752735ms\r\nDec 05 15:28:02 lighthouse-mainnet geth[6666]: INFO [12-05|15:28:02.071] Imported new potential chain segment     number=18,721,034 hash=13d3b5..ea7ed3 blocks=1          txs=139        mgas=14.081  elapsed=195.84\r\nDec 05 15:28:02 lighthouse-mainnet geth[6666]: INFO [12-05|15:28:02.475] Chain head was updated                   number=18,721,034 hash=13d3b5..ea7ed3 root=95dab4..7e16a2 elapsed=6.431138ms\r\nDec 05 15:28:12 lighthouse-mainnet geth[6666]: INFO [12-05|15:28:12.754] Imported new potential chain segment     number=18,721,035 hash=d3a97e..9dfead blocks=1          txs=196        mgas=13.766  elapsed=172.30\r\nDec 05 15:28:13 lighthouse-mainnet geth[6666]: INFO [12-05|15:28:13.369] Chain head was updated                   number=18,721,035 hash=d3a97e..9dfead root=d36be0..3934f8 elapsed=6.068884ms\r\nDec 05 15:28:25 lighthouse-mainnet geth[6666]: INFO [12-05|15:28:25.152] Imported new potential chain segment     number=18,721,036 hash=e51401..194210 blocks=1          txs=210        mgas=14.021  elapsed=212.28\r\nDec 05 15:28:25 lighthouse-mainnet geth[6666]: INFO [12-05|15:28:25.572] Chain head was updated                   number=18,721,036 hash=e51401..194210 root=d4766f..ecfb20 elapsed=6.346125ms\r\nDec 05 15:28:38 lighthouse-mainnet geth[6666]: INFO [12-05|15:28:38.964] Imported new potential chain segment     number=18,721,037 hash=c80870..de7993 blocks=1          txs=169        mgas=16.217  elapsed=173.34\r\nDec 05 15:28:39 lighthouse-mainnet geth[6666]: INFO [12-05|15:28:39.348] Chain head was updated                   number=18,721,037 hash=c80870..de7993 root=cdff5d..475988 elapsed=11.033216ms\r\nDec 05 15:28:48 lighthouse-mainnet geth[6666]: INFO [12-05|15:28:48.961] Imported new potential chain segment     number=18,721,038 hash=5e15d7..79f4a6 blocks=1          txs=137        mgas=11.611  elapsed=323.21\r\nDec 05 15:28:49 lighthouse-mainnet geth[6666]: INFO [12-05|15:28:49.322] Chain head was updated                   number=18,721,038 hash=5e15d7..79f4a6 root=c80c8f..e1c4be elapsed=4.852648ms\r\nDec 05 15:29:01 lighthouse-mainnet geth[6666]: INFO [12-05|15:29:01.158] Imported new potential chain segment     number=18,721,039 hash=551556..f65287 blocks=1          txs=171        mgas=15.198  elapsed=246.84\r\nDec 05 15:29:01 lighthouse-mainnet geth[6666]: INFO [12-05|15:29:01.514] Chain head was updated                   number=18,721,039 hash=551556..f65287 root=e3fa94..9c15ad elapsed=5.648096ms\r\nDec 05 15:29:13 lighthouse-mainnet geth[6666]: INFO [12-05|15:29:13.492] Imported new potential chain segment     number=18,721,040 hash=84377f..f7c276 blocks=1          txs=218        mgas=20.891  elapsed=402.91\r\nDec 05 15:29:13 lighthouse-mainnet geth[6666]: INFO [12-05|15:29:13.865] Chain head was updated                   number=18,721,040 hash=84377f..f7c276 root=ad56a0..63fa11 elapsed=6.774385ms\r\nDec 05 15:29:24 lighthouse-mainnet geth[6666]: INFO [12-05|15:29:24.232] Imported new potential chain segment     number=18,721,041 hash=990472..f34a28 blocks=1          txs=91         mgas=7.257   elapsed=86.601\r\nDec 05 15:29:24 lighthouse-mainnet geth[6666]: INFO [12-05|15:29:24.593] Chain head was updated                   number=18,721,041 hash=990472..f34a28 root=1cfec4..e38b67 elapsed=3.615271ms\r\nDec 05 15:29:37 lighthouse-mainnet geth[6666]: INFO [12-05|15:29:37.392] Imported new potential chain segment     number=18,721,042 hash=9594f4..06c62d blocks=1          txs=208        mgas=18.586  elapsed=372.38\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1841156314/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1841162488",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28645#issuecomment-1841162488",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28645",
    "id": 1841162488,
    "node_id": "IC_kwDOAOvK985tvej4",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-05T16:35:20Z",
    "updated_at": "2023-12-05T16:35:20Z",
    "author_association": "MEMBER",
    "body": "Your node is telling you exactly what its doing :D its generating the snapshot. This is needed after a resync. The snapshot is a data structure that we need to execute blocks faster. This is a one time cost that you have to pay for resyncing, afterwards the cpu usage will go back to normal",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1841162488/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 1,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1841175415",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/28645#issuecomment-1841175415",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/28645",
    "id": 1841175415,
    "node_id": "IC_kwDOAOvK985tvht3",
    "user": {
      "login": "vogelito",
      "id": 1325863,
      "node_id": "MDQ6VXNlcjEzMjU4NjM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1325863?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vogelito",
      "html_url": "https://github.com/vogelito",
      "followers_url": "https://api.github.com/users/vogelito/followers",
      "following_url": "https://api.github.com/users/vogelito/following{/other_user}",
      "gists_url": "https://api.github.com/users/vogelito/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vogelito/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vogelito/subscriptions",
      "organizations_url": "https://api.github.com/users/vogelito/orgs",
      "repos_url": "https://api.github.com/users/vogelito/repos",
      "events_url": "https://api.github.com/users/vogelito/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vogelito/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-05T16:39:54Z",
    "updated_at": "2023-12-05T16:39:54Z",
    "author_association": "NONE",
    "body": "Sorry about the noise. I guess the repeats of `Generating/Aborting/Resuming` was making me think the node was spinning.\r\n\r\nAppreciate your help with this.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1841175415/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
