{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26018",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26018/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26018/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26018/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/26018",
  "id": 1417192135,
  "node_id": "I_kwDOAOvK985UeKLH",
  "number": 26018,
  "title": "gasUsed incorrect when using `debug_traceBlockByHash`",
  "user": {
    "login": "imnotanoob",
    "id": 8355893,
    "node_id": "MDQ6VXNlcjgzNTU4OTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8355893?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/imnotanoob",
    "html_url": "https://github.com/imnotanoob",
    "followers_url": "https://api.github.com/users/imnotanoob/followers",
    "following_url": "https://api.github.com/users/imnotanoob/following{/other_user}",
    "gists_url": "https://api.github.com/users/imnotanoob/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/imnotanoob/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/imnotanoob/subscriptions",
    "organizations_url": "https://api.github.com/users/imnotanoob/orgs",
    "repos_url": "https://api.github.com/users/imnotanoob/repos",
    "events_url": "https://api.github.com/users/imnotanoob/events{/privacy}",
    "received_events_url": "https://api.github.com/users/imnotanoob/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "s1na",
    "id": 1591639,
    "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/s1na",
    "html_url": "https://github.com/s1na",
    "followers_url": "https://api.github.com/users/s1na/followers",
    "following_url": "https://api.github.com/users/s1na/following{/other_user}",
    "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
    "organizations_url": "https://api.github.com/users/s1na/orgs",
    "repos_url": "https://api.github.com/users/s1na/repos",
    "events_url": "https://api.github.com/users/s1na/events{/privacy}",
    "received_events_url": "https://api.github.com/users/s1na/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-10-20T20:05:06Z",
  "updated_at": "2022-10-25T11:36:57Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `Geth 1.10.24`\r\nCL client & version: prysm:3.1.1\r\nOS & Version: Linux\r\nCommit hash : 1.10.24 release branch\r\n\r\n#### Expected behaviour\r\nWhen using `debug_traceBlockByHash` with `callTracer` I expect the `gasUsed` to be the `gasUsed` by the transaction. (https://geth.ethereum.org/docs/dapp/builtin-tracers#calltracer) documentation\r\n\r\ni.e. on `Goerli Testnet` \r\n\r\n```\r\ncurl --request POST \\\r\n  --url http://127.0.0.1:8546/ \\\r\n  --header 'content-type: application/json' \\\r\n  --data '{\"method\":\"debug_traceBlockByHash\",\"params\":[\"0x436ec05f6768296d48150241a1217000f2d7a4cfd8e36803150f2d5219ebab7b\", {\r\n\t\"tracer\": \"callTracer\"\r\n}], \"jsonrpc\":\"2.0\", \"id\": 0}'\r\n```\r\n(https://goerli.etherscan.io/tx/0x5bd8217569235b62252bc5c5063d1e6e9ee9e450ae7370c2d9c349ca1692ef8a) is an example\r\n\r\n#### Actual behaviour\r\nIt outputs the wrong gasUsed. For that specific txn: gas used is: `0x24ca6`\r\nOut put is:\r\n\r\n```\r\n\t\t{\r\n\t\t\t\"result\": {\r\n\t\t\t\t\"type\": \"CALL\",\r\n\t\t\t\t\"from\": \"0x7afe817effeaffd965f6336137c027a15dbde4c7\",\r\n\t\t\t\t\"to\": \"0x120b1b0a44d680524419f76e1a41976b6ea0add5\",\r\n\t\t\t\t\"value\": \"0x11c37937e080000\",\r\n\t\t\t\t\"gas\": \"0x46790\",\r\n\t\t\t\t\"gasUsed\": \"0x24ca6\",\r\n\t\t\t\t\"input\": \"0xcf11d58d00000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000001\",\r\n\t\t\t\t\"output\": \"0x\",\r\n\t\t\t\t\"calls\": [\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\t\"type\": \"CALL\",\r\n\t\t\t\t\t\t\"from\": \"0x120b1b0a44d680524419f76e1a41976b6ea0add5\",\r\n\t\t\t\t\t\t\"to\": \"0x727b51b3cebe69eaabdcfd5a2db0c521ba308112\",\r\n\t\t\t\t\t\t\"value\": \"0x11c37937e080000\",\r\n\t\t\t\t\t\t\"gas\": \"0x8fc\",\r\n\t\t\t\t\t\t\"gasUsed\": \"0x0\",\r\n\t\t\t\t\t\t\"input\": \"0x\",\r\n\t\t\t\t\t\t\"output\": \"0x\"\r\n\t\t\t\t\t}\r\n\t\t\t\t]\r\n\t\t\t}\r\n\t\t}\r\n```\r\n\r\nif you run `eth_getTransactionReceipt` on the same tx hash: `0x5bd8217569235b62252bc5c5063d1e6e9ee9e450ae7370c2d9c349ca1692ef8a` \r\ngas used is: `0x2a006` \r\n```\r\n\r\n{\r\n\t\"jsonrpc\": \"2.0\",\r\n\t\"id\": 0,\r\n\t\"result\": {\r\n\t\t\"blockHash\": \"0x8b973f65653ba08a81fe728ede379cc748ae5ee959b8925ef637a35162bdb0ca\",\r\n\t\t\"blockNumber\": \"0x764710\",\r\n\t\t\"contractAddress\": null,\r\n\t\t\"cumulativeGasUsed\": \"0x2f20e\",\r\n\t\t\"effectiveGasPrice\": \"0x113abe6400\",\r\n\t\t\"from\": \"0x7afe817effeaffd965f6336137c027a15dbde4c7\",\r\n\t\t\"gasUsed\": \"0x2a006\",\r\n\t\t\"logs\": [\r\n\t\t\t{\r\n\t\t\t\t\"address\": \"0x120b1b0a44d680524419f76e1a41976b6ea0add5\",\r\n\t\t\t\t\"topics\": [\r\n\t\t\t\t\t\"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef\",\r\n\t\t\t\t\t\"0x0000000000000000000000000000000000000000000000000000000000000000\",\r\n\t\t\t\t\t\"0x0000000000000000000000007afe817effeaffd965f6336137c027a15dbde4c7\",\r\n\t\t\t\t\t\"0x000000000000000000000000000000000000000000000000000000000000002b\"\r\n\t\t\t\t],\r\n\t\t\t\t\"data\": \"0x\",\r\n\t\t\t\t\"blockNumber\": \"0x764710\",\r\n\t\t\t\t\"transactionHash\": \"0x5bd8217569235b62252bc5c5063d1e6e9ee9e450ae7370c2d9c349ca1692ef8a\",\r\n\t\t\t\t\"transactionIndex\": \"0x1\",\r\n\t\t\t\t\"blockHash\": \"0x8b973f65653ba08a81fe728ede379cc748ae5ee959b8925ef637a35162bdb0ca\",\r\n\t\t\t\t\"logIndex\": \"0x0\",\r\n\t\t\t\t\"removed\": false\r\n\t\t\t}\r\n\t\t],\r\n\t\t\"logsBloom\": \"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001000000000000000000000000000000000000800008000000000000000000000000000000000000000000000000020000000000000000000800000000000000080000000010002000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000200000000000000000000000000000000002000000100000000000000000000000000000000000000000000020000000000000000000000008000000000000000000000000000000000000000002\",\r\n\t\t\"status\": \"0x1\",\r\n\t\t\"to\": \"0x120b1b0a44d680524419f76e1a41976b6ea0add5\",\r\n\t\t\"transactionHash\": \"0x5bd8217569235b62252bc5c5063d1e6e9ee9e450ae7370c2d9c349ca1692ef8a\",\r\n\t\t\"transactionIndex\": \"0x1\",\r\n\t\t\"type\": \"0x2\"\r\n\t}\r\n}\r\n```\r\n#### Steps to reproduce the behaviour\r\n1. Pick any block hash you want on the network. In this example I'm using goerli with: `0x436ec05f6768296d48150241a1217000f2d7a4cfd8e36803150f2d5219ebab7b`\r\n2. Run debug command:\r\n\r\n```\r\n{\"method\":\"debug_traceBlockByHash\",\"params\":[\"0x436ec05f6768296d48150241a1217000f2d7a4cfd8e36803150f2d5219ebab7b\", {\r\n\t\"tracer\": \"callTracer\"\r\n}], \"jsonrpc\":\"2.0\", \"id\": 0}\r\n```\r\n\r\n3. The gasUsed is incorrect for every transaction. If you look at the second one, you will see. \r\n```\r\n\t\t\t\t\"gasUsed\": \"0x24ca6\",\r\n\r\n```\r\n4. Now if you run \r\n```\r\ncurl --request POST \\\r\n  --url http://0.0.0.0:8546/ \\\r\n  --header 'Authorization: Bearer 0xc9cdf7d459216ebd1218521b7df4946f28bf547d6d97effb6e79ab1550ca2dd3' \\\r\n  --header 'Content-Type: application/json' \\\r\n  --data '{\r\n  \"jsonrpc\" : \"2.0\",\r\n  \"method\" : \"eth_getTransactionReceipt\",\r\n  \"params\" : [\"0x5bd8217569235b62252bc5c5063d1e6e9ee9e450ae7370c2d9c349ca1692ef8a\"],\r\n  \"id\" : 0\r\n}\r\n'\r\n```\r\nthe gas used is different.\r\n\r\n#### Backtrace\r\n\r\n````\r\n[backtrace]\r\n````\r\n\r\nWhen submitting logs: please submit them as text and not screenshots.\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26018/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26018/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1287164350",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26018#issuecomment-1287164350",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26018",
    "id": 1287164350,
    "node_id": "IC_kwDOAOvK985MuJG-",
    "user": {
      "login": "imnotanoob",
      "id": 8355893,
      "node_id": "MDQ6VXNlcjgzNTU4OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8355893?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/imnotanoob",
      "html_url": "https://github.com/imnotanoob",
      "followers_url": "https://api.github.com/users/imnotanoob/followers",
      "following_url": "https://api.github.com/users/imnotanoob/following{/other_user}",
      "gists_url": "https://api.github.com/users/imnotanoob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/imnotanoob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/imnotanoob/subscriptions",
      "organizations_url": "https://api.github.com/users/imnotanoob/orgs",
      "repos_url": "https://api.github.com/users/imnotanoob/repos",
      "events_url": "https://api.github.com/users/imnotanoob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/imnotanoob/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-21T16:06:17Z",
    "updated_at": "2022-10-21T16:06:17Z",
    "author_association": "NONE",
    "body": "I also verified this on mainnet. Same issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1287164350/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1288311920",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26018#issuecomment-1288311920",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26018",
    "id": 1288311920,
    "node_id": "IC_kwDOAOvK985MyhRw",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-24T02:11:17Z",
    "updated_at": "2022-10-24T02:11:17Z",
    "author_association": "MEMBER",
    "body": "I can reproduce the issue, thanks for reporting. Will look into it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1288311920/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
