{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27456",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27456/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27456/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27456/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/27456",
  "id": 1752114353,
  "node_id": "I_kwDOAOvK985obySx",
  "number": 27456,
  "title": "Why not use the block hash returned by backend of ethclient but recalculate it?",
  "user": {
    "login": "jongrun",
    "id": 31625057,
    "node_id": "MDQ6VXNlcjMxNjI1MDU3",
    "avatar_url": "https://avatars.githubusercontent.com/u/31625057?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jongrun",
    "html_url": "https://github.com/jongrun",
    "followers_url": "https://api.github.com/users/jongrun/followers",
    "following_url": "https://api.github.com/users/jongrun/following{/other_user}",
    "gists_url": "https://api.github.com/users/jongrun/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jongrun/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jongrun/subscriptions",
    "organizations_url": "https://api.github.com/users/jongrun/orgs",
    "repos_url": "https://api.github.com/users/jongrun/repos",
    "events_url": "https://api.github.com/users/jongrun/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jongrun/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2023-06-12T07:41:32Z",
  "updated_at": "2023-06-12T09:31:50Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "https://github.com/ethereum/go-ethereum/blob/281e8cd5abaac86ed3f37f98250ff147b3c9fe62/ethclient/ethclient.go#L184\r\nThe block hash returned from backend is ignored here. When we call block.Hash(), the block hash is recalculated.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27456/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27456/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1586778823",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27456#issuecomment-1586778823",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27456",
    "id": 1586778823,
    "node_id": "IC_kwDOAOvK985elFLH",
    "user": {
      "login": "lightclient",
      "id": 14004106,
      "node_id": "MDQ6VXNlcjE0MDA0MTA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14004106?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lightclient",
      "html_url": "https://github.com/lightclient",
      "followers_url": "https://api.github.com/users/lightclient/followers",
      "following_url": "https://api.github.com/users/lightclient/following{/other_user}",
      "gists_url": "https://api.github.com/users/lightclient/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lightclient/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lightclient/subscriptions",
      "organizations_url": "https://api.github.com/users/lightclient/orgs",
      "repos_url": "https://api.github.com/users/lightclient/repos",
      "events_url": "https://api.github.com/users/lightclient/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lightclient/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-12T07:54:20Z",
    "updated_at": "2023-06-12T07:54:20Z",
    "author_association": "MEMBER",
    "body": "The cache isn't accessible outside the package, so we can't really set it from `ethclient`. It isn't too expensive to compute the hash, so it doesn't seem necessary to change the interface so it can be loaded.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1586778823/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1586822860",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27456#issuecomment-1586822860",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27456",
    "id": 1586822860,
    "node_id": "IC_kwDOAOvK985elP7M",
    "user": {
      "login": "jongrun",
      "id": 31625057,
      "node_id": "MDQ6VXNlcjMxNjI1MDU3",
      "avatar_url": "https://avatars.githubusercontent.com/u/31625057?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jongrun",
      "html_url": "https://github.com/jongrun",
      "followers_url": "https://api.github.com/users/jongrun/followers",
      "following_url": "https://api.github.com/users/jongrun/following{/other_user}",
      "gists_url": "https://api.github.com/users/jongrun/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jongrun/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jongrun/subscriptions",
      "organizations_url": "https://api.github.com/users/jongrun/orgs",
      "repos_url": "https://api.github.com/users/jongrun/repos",
      "events_url": "https://api.github.com/users/jongrun/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jongrun/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-12T08:19:17Z",
    "updated_at": "2023-06-12T08:19:17Z",
    "author_association": "NONE",
    "body": "> The cache isn't accessible outside the package, so we can't really set it from `ethclient`. It isn't too expensive to compute the hash, so it doesn't seem necessary to change the interface so it can be loaded.\r\n\r\nThis also happens in HeaderByHash/HeaderByNumber/eth_subscribe(newHead) because there is no Hash field in Header and the Header.Hash() recalculate it every time.\r\nBesides the consideration of cost to compute the hash, there is another compatibility issue in my project. When I implement ethereum client JSON RPC in my project where the block structure is not totally the same as ethereum, I convert(copy) the fields in my block to the ones in ethereum block, including the block hash. But algorithm of the block hash is not the same as ethereum, so when user uses ethclient to access my chain, the block hash is always wrong.\r\nIs it possible to use the block hash returned by backend?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1586822860/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1586854542",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27456#issuecomment-1586854542",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27456",
    "id": 1586854542,
    "node_id": "IC_kwDOAOvK985elXqO",
    "user": {
      "login": "lightclient",
      "id": 14004106,
      "node_id": "MDQ6VXNlcjE0MDA0MTA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14004106?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lightclient",
      "html_url": "https://github.com/lightclient",
      "followers_url": "https://api.github.com/users/lightclient/followers",
      "following_url": "https://api.github.com/users/lightclient/following{/other_user}",
      "gists_url": "https://api.github.com/users/lightclient/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lightclient/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lightclient/subscriptions",
      "organizations_url": "https://api.github.com/users/lightclient/orgs",
      "repos_url": "https://api.github.com/users/lightclient/repos",
      "events_url": "https://api.github.com/users/lightclient/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lightclient/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-12T08:36:44Z",
    "updated_at": "2023-06-12T08:36:53Z",
    "author_association": "MEMBER",
    "body": "The `ethclient` is designed to be an Ethereum RPC client, so again I'm not sure we should be modifying the interface to support non-Ethereum-based interactions. If you've modified the block structure, you should also modify `ethclient` in your project or rely on a lower level interface like straight JSON-RPC.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1586854542/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1586889835",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27456#issuecomment-1586889835",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27456",
    "id": 1586889835,
    "node_id": "IC_kwDOAOvK985elgRr",
    "user": {
      "login": "jongrun",
      "id": 31625057,
      "node_id": "MDQ6VXNlcjMxNjI1MDU3",
      "avatar_url": "https://avatars.githubusercontent.com/u/31625057?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jongrun",
      "html_url": "https://github.com/jongrun",
      "followers_url": "https://api.github.com/users/jongrun/followers",
      "following_url": "https://api.github.com/users/jongrun/following{/other_user}",
      "gists_url": "https://api.github.com/users/jongrun/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jongrun/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jongrun/subscriptions",
      "organizations_url": "https://api.github.com/users/jongrun/orgs",
      "repos_url": "https://api.github.com/users/jongrun/repos",
      "events_url": "https://api.github.com/users/jongrun/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jongrun/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-12T08:58:29Z",
    "updated_at": "2023-06-12T08:58:29Z",
    "author_association": "NONE",
    "body": "It's a optional solution modifying ethclient in my project, but followings are some reasons to modify the ethclient in go-ethereum.\r\n- The ethclient should get origin block hash from backend because the ethclient may calculate the hash incorrectly. If a user wants to verify the block hash, a method like CalculateHash can be provided(may also be incorrect).\r\n- The goal of an EVM-compatible project is to make developers more convenient to clone their project in etherem to a new environment. Therefore, if the developers has used ethclient as their sdk, they had better not be required to use a new sdk customized to the new environment. \r\n- By the way, this problem does not occur in the web3.js or web3.py.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1586889835/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1586912196",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27456#issuecomment-1586912196",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27456",
    "id": 1586912196,
    "node_id": "IC_kwDOAOvK985ellvE",
    "user": {
      "login": "lightclient",
      "id": 14004106,
      "node_id": "MDQ6VXNlcjE0MDA0MTA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14004106?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lightclient",
      "html_url": "https://github.com/lightclient",
      "followers_url": "https://api.github.com/users/lightclient/followers",
      "following_url": "https://api.github.com/users/lightclient/following{/other_user}",
      "gists_url": "https://api.github.com/users/lightclient/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lightclient/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lightclient/subscriptions",
      "organizations_url": "https://api.github.com/users/lightclient/orgs",
      "repos_url": "https://api.github.com/users/lightclient/repos",
      "events_url": "https://api.github.com/users/lightclient/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lightclient/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-12T09:08:12Z",
    "updated_at": "2023-06-12T09:08:12Z",
    "author_association": "MEMBER",
    "body": ">  ethclient should get origin block hash from backend because the ethclient may calculate the hash incorrectly\r\n\r\nThe failure model for the backend does not allow it to return incorrect information. The ethclient _trusts_ the backend to return correct information. This is why users should run nodes - so that they don't need external trust assumptions. For that reason, we do not need to check the integrity of the response. Therefore, the only reason to use the block hash from the backend is to avoid a small amount of additional computation, which I'm not sure is worth it here.\r\n\r\n> The goal of an EVM-compatible project is to make developers more convenient to clone their project in etherem to a new environment\r\n\r\nAgree with this, but as you've said, you have a different block structure than Ethereum. So I would say this is no longer \"EVM compatible\".",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1586912196/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1586956610",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/27456#issuecomment-1586956610",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27456",
    "id": 1586956610,
    "node_id": "IC_kwDOAOvK985elwlC",
    "user": {
      "login": "jongrun",
      "id": 31625057,
      "node_id": "MDQ6VXNlcjMxNjI1MDU3",
      "avatar_url": "https://avatars.githubusercontent.com/u/31625057?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jongrun",
      "html_url": "https://github.com/jongrun",
      "followers_url": "https://api.github.com/users/jongrun/followers",
      "following_url": "https://api.github.com/users/jongrun/following{/other_user}",
      "gists_url": "https://api.github.com/users/jongrun/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jongrun/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jongrun/subscriptions",
      "organizations_url": "https://api.github.com/users/jongrun/orgs",
      "repos_url": "https://api.github.com/users/jongrun/repos",
      "events_url": "https://api.github.com/users/jongrun/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jongrun/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-12T09:31:49Z",
    "updated_at": "2023-06-12T09:31:49Z",
    "author_association": "NONE",
    "body": "> The ethclient _trusts_ the backend to return correct information. This is why users should run nodes - so that they don't need external trust assumptions.\r\n\r\nAs you say, the ethclient trusts the backend, so it's uneccesary to recalculate the hash, which may even get a wrong hash that inconsistent with the backend.\r\n\r\n> Agree with this, but as you've said, you have a different block structure than Ethereum. So I would say this is no longer \"EVM compatible\".\r\n\r\nWe try our best to make all the RPCs are compatible, but the block structure can't because of some historical reasons. Even so, the data format returned by eth_getBlockxxx is also the same as ethereum, only some hashes in it can't be verified.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1586956610/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
