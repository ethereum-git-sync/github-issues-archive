{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27990",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27990/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27990/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27990/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/27990",
  "id": 1863353646,
  "node_id": "I_kwDOAOvK985vEIUu",
  "number": 27990,
  "title": "Calling debug_setHead crashes geth with SIGSEGV in dev mode.",
  "user": {
    "login": "ankurdubey521",
    "id": 16562513,
    "node_id": "MDQ6VXNlcjE2NTYyNTEz",
    "avatar_url": "https://avatars.githubusercontent.com/u/16562513?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ankurdubey521",
    "html_url": "https://github.com/ankurdubey521",
    "followers_url": "https://api.github.com/users/ankurdubey521/followers",
    "following_url": "https://api.github.com/users/ankurdubey521/following{/other_user}",
    "gists_url": "https://api.github.com/users/ankurdubey521/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ankurdubey521/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ankurdubey521/subscriptions",
    "organizations_url": "https://api.github.com/users/ankurdubey521/orgs",
    "repos_url": "https://api.github.com/users/ankurdubey521/repos",
    "events_url": "https://api.github.com/users/ankurdubey521/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ankurdubey521/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-08-23T13:34:42Z",
  "updated_at": "2023-08-23T13:36:19Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I have been using the debug_setHead RPC call as a part of my test suites to reset the geth node to a known block after every test. The geth node is run as a docker container.\r\nOn Apple Silicon (m1) hosts, the RPC works fine. However, on Linux hosts the node crashes after calling the RPC\r\n\r\n\r\n#### System information\r\nGeth version: `1.12.2`\r\nCL client & version: NA (node is run in --dev mode)\r\nOS & Version: `Debian 6.1.38-4 (2023-08-08) x86_64 GNU/Linux`\r\n\r\n#### Expected behaviour\r\nThe node should not crash.\r\n\r\n#### Actual behaviour\r\nThe node crashes once the RPC is called.\r\n\r\n#### Steps to reproduce the behaviour\r\nDockerfile used:\r\n```\r\nFROM ethereum/client-go:1.12.2\r\nENTRYPOINT geth \\\r\n      --http.vhosts '*,localhost,host.docker.internal' \\\r\n      --http \\\r\n      --http.api personal,eth,net,web3,debug \\\r\n      --http.corsdomain '*' \\\r\n      --http.addr \"0.0.0.0\" \\\r\n      --nodiscover --maxpeers 0 --mine \\\r\n      --networkid 1337 \\\r\n      --dev \\\r\n      --allow-insecure-unlock \\\r\n      --rpc.allow-unprotected-txs \\\r\n      --dev.gaslimit 200000000 \\\r\n```\r\n#### Backtrace\r\nPlease ignore logs starting with `environment-bundler-1`\r\n\r\n````\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.581] Chain head was updated                   number=20 hash=6b2bd7..123dca root=026723..5d8ca0 elapsed=\"117.446µs\"\r\nenvironment-geth-dev-1  | WARN [08-23|12:33:58.680] Caller gas above allowance, capping      requested=196,129,809 cap=50,000,000\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.691] Submitted contract creation              hash=0xae61f5716271f4d4f90f021cbb5fcdee047d171339949eea5208bd619fb16526 from=0x9d25Be6C0137D54Efb4d56e54EAC54B8019a4BD6 nonce=14 contract=0xa390F5b14C839cfE1369D73384065BE62A7F4EEd value=0\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.692] Starting work on payload                 id=0x5cefe4b6e5fc8213\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.692] Updated payload                          id=0x5cefe4b6e5fc8213 number=21 hash=b742b3..71abcc txs=1  withdrawals=0 gas=1,201,365 fees=0.00112687417   root=efb548..23223f elapsed=\"592.165µs\"\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.693] Stopping work on payload                 id=0x5cefe4b6e5fc8213 reason=delivery\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.694] Imported new potential chain segment     number=21 hash=b742b3..71abcc blocks=1 txs=1  mgas=1.201 elapsed=1.200ms     mgasps=1000.645 dirty=66.02KiB\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.695] Chain head was updated                   number=21 hash=b742b3..71abcc root=efb548..23223f elapsed=\"403.992µs\"\r\nenvironment-geth-dev-1  | WARN [08-23|12:33:58.715] Caller gas above allowance, capping      requested=195,938,277 cap=50,000,000\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.731] Starting work on payload                 id=0xa4d242c151b4c676\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.731] Submitted transaction                    hash=0xd9a8f628e641ae2f344999c45a102154a55ed10846c763814b3b287e3a8a6c2a from=0x9d25Be6C0137D54Efb4d56e54EAC54B8019a4BD6 nonce=15 recipient=0xa390F5b14C839cfE1369D73384065BE62A7F4EEd value=2,000,000,000,000,000,000\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.733] Updated payload                          id=0xa4d242c151b4c676 number=22 hash=becca8..46f03d txs=1  withdrawals=0 gas=81075     fees=7.666860942e-05 root=821265..f357b8 elapsed=1.103ms\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.733] Stopping work on payload                 id=0xa4d242c151b4c676 reason=delivery\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.734] Imported new potential chain segment     number=22 hash=becca8..46f03d blocks=1 txs=1  mgas=0.081 elapsed=1.062ms     mgasps=76.303   dirty=69.02KiB\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.735] Chain head was updated                   number=22 hash=becca8..46f03d root=821265..f357b8 elapsed=\"77.164µs\"\r\nenvironment-geth-dev-1  | WARN [08-23|12:33:58.754] Caller gas above allowance, capping      requested=195,746,933 cap=50,000,000\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.766] Submitted transaction                    hash=0x7a35d172953f335d3563c22b8f426c4097a7b40f41cfb289b689c425207a49be from=0x9d25Be6C0137D54Efb4d56e54EAC54B8019a4BD6 nonce=16 recipient=0xa390F5b14C839cfE1369D73384065BE62A7F4EEd value=1,000,000,000,000,000,000\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.767] Starting work on payload                 id=0xfbaf70ca30380445\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.769] Updated payload                          id=0xfbaf70ca30380445 number=23 hash=b6066e..78a366 txs=1  withdrawals=0 gas=65191     fees=6.209041871e-05 root=74c548..caa829 elapsed=1.346ms\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.769] Stopping work on payload                 id=0xfbaf70ca30380445 reason=delivery\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.771] Imported new potential chain segment     number=23 hash=b6066e..78a366 blocks=1 txs=1  mgas=0.065 elapsed=1.593ms     mgasps=40.907   dirty=72.85KiB\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.772] Chain head was updated                   number=23 hash=b6066e..78a366 root=74c548..caa829 elapsed=\"135.84µs\"\r\nenvironment-geth-dev-1  | WARN [08-23|12:33:58.784] Caller gas above allowance, capping      requested=195,555,775 cap=50,000,000\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.794] Submitted transaction                    hash=0x2e2ae36e3b83ed214683e350dcbb850c6b09a5184b5f75f8bfc6e6161a2a8bfd from=0x9d25Be6C0137D54Efb4d56e54EAC54B8019a4BD6 nonce=17 recipient=0x614A3e73498089e84D05f583a0264AB9c1D99EAa value=10,000,000,000,000,000,000\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.794] Starting work on payload                 id=0xa11903c151b6502b\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.795] Updated payload                          id=0xa11903c151b6502b number=24 hash=20cc23..806361 txs=1  withdrawals=0 gas=28928     fees=2.77240088e-05  root=2fb5d0..00bec7 elapsed=\"613.905µs\"\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.795] Stopping work on payload                 id=0xa11903c151b6502b reason=delivery\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.797] Imported new potential chain segment     number=24 hash=20cc23..806361 blocks=1 txs=1  mgas=0.029 elapsed=1.825ms     mgasps=15.850   dirty=75.69KiB\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:58.797] Chain head was updated                   number=24 hash=20cc23..806361 root=2fb5d0..00bec7 elapsed=\"94.384µs\"\r\nenvironment-geth-dev-1  | WARN [08-23|12:33:58.805] Served evm_snapshot                      conn=172.24.0.1:52420 reqid=112 duration=\"8.764µs\"   err=\"the method evm_snapshot does not exist/is not available\"\r\nenvironment-geth-dev-1  | WARN [08-23|12:33:58.837] Caller gas above allowance, capping      requested=195,364,804 cap=50,000,000\r\nenvironment-bundler-1   | UserOperation: Sender=0x1748591b30f0f3c92B66CD88F4de4AA7fCe82bF6  Nonce=2 EntryPoint=0x614A3e73498089e84D05f583a0264AB9c1D99EAa Paymaster=undefined\r\nenvironment-geth-dev-1  | WARN [08-23|12:33:59.088] Served eth_call                          conn=172.24.0.3:57784 reqid=88  duration=\"531.109µs\" err=\"execution reverted\"            errdata=0x091cd00558bf5255edb760740386438ab4fb9a57248c9192f043386ae2f3a744f05ad53c\r\nenvironment-bundler-1   | until 281474976710655 now= 1692794039\r\nenvironment-geth-dev-1  | WARN [08-23|12:33:59.139] Served eth_call                          conn=172.24.0.3:57850 reqid=96  duration=\"469.601µs\" err=\"execution reverted\"            errdata=0x091cd00558bf5255edb760740386438ab4fb9a57248c9192f043386ae2f3a744f05ad53c\r\nenvironment-bundler-1   | until 281474976710655 now= 1692794039\r\nenvironment-bundler-1   | low balance. using  0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 as beneficiary instead of  0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:59.313] Setting new local account                address=0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:59.313] Submitted transaction                    hash=0xd5f24d60d1cca55500ae59a57b6bf2fd83a90affd8021bf98ab32c0b71fdf236 from=0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266 nonce=0  recipient=0x614A3e73498089e84D05f583a0264AB9c1D99EAa value=0\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:59.315] Starting work on payload                 id=0x73924a6567e4e98f\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:59.317] Updated payload                          id=0x73924a6567e4e98f number=25 hash=396272..8bc944 txs=1  withdrawals=0 gas=143,580   fees=0.00021537      root=0ccffa..a700d3 elapsed=1.822ms\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:59.318] Stopping work on payload                 id=0x73924a6567e4e98f reason=delivery\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:59.321] Imported new potential chain segment     number=25 hash=396272..8bc944 blocks=1 txs=1  mgas=0.144 elapsed=2.125ms     mgasps=67.535   dirty=80.72KiB\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:59.322] Chain head was updated                   number=25 hash=396272..8bc944 root=0ccffa..a700d3 elapsed=\"119.412µs\"\r\nenvironment-geth-dev-1  | WARN [08-23|12:33:59.336] Served eth_call                          conn=172.24.0.3:57970 reqid=107 duration=\"859.218µs\" err=\"execution reverted\"            errdata=0x11e6f5a000000000000000000000000000000000000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000001944b2e739de080a879de2eec07350db662de84839d0e7f22dc65b8577e1f2e3e\r\nenvironment-bundler-1   | sent eth_sendUserOperation - 0x944b2e739de080a879de2eec07350db662de84839d0e7f22dc65b8577e1f2e3e\r\nenvironment-geth-dev-1  | WARN [08-23|12:33:59.383] Rewinding blockchain to block            target=13\r\nenvironment-geth-dev-1  | WARN [08-23|12:33:59.384] SetHead invalidated safe block\r\nenvironment-geth-dev-1  | ERROR[08-23|12:33:59.385] SetHead invalidated finalized block\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:59.385] Loaded most recent local block           number=13 hash=8e1bd1..621cc1 td=0 age=2s\r\nenvironment-bundler-1   | sent debug_bundler_clearState - ok\r\nenvironment-geth-dev-1  | WARN [08-23|12:33:59.686] Served evm_snapshot                      conn=172.24.0.1:52420 reqid=139 duration=\"7.937µs\"   err=\"the method evm_snapshot does not exist/is not available\"\r\nenvironment-geth-dev-1  | WARN [08-23|12:33:59.744] Caller gas above allowance, capping      requested=197,475,783 cap=50,000,000\r\nenvironment-geth-dev-1  | INFO [08-23|12:33:59.756] Submitted transaction                    hash=0xf184cf726f4990349d37734d69f2e4c4f0252f18a3e8b2b12ee50457d7c1db65 from=0x9d25Be6C0137D54Efb4d56e54EAC54B8019a4BD6 nonce=7  recipient=0xDB8616b7b5c506bc24eBEB0A8b6475B8687e3078 value=10,000,000,000,000,000,000\r\nenvironment-geth-dev-1  | WARN [08-23|12:33:59.756] Forkchoice requested unknown head        hash=396272..8bc944\r\nenvironment-geth-dev-1  | panic: runtime error: invalid memory address or nil pointer dereference\r\nenvironment-geth-dev-1  | [signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x100fc09]\r\nenvironment-geth-dev-1  |\r\nenvironment-geth-dev-1  |\r\nenvironment-geth-dev-1  | goroutine 4253 [running]:\r\nenvironment-geth-dev-1  | github.com/ethereum/go-ethereum/eth/catalyst.(*SimulatedBeacon).sealBlock(0xc000245ad0, {0x2cef4c8, 0x0, 0x0})\r\nenvironment-geth-dev-1  | \tgithub.com/ethereum/go-ethereum/eth/catalyst/simulated_beacon.go:154 +0x2e9\r\nenvironment-geth-dev-1  | github.com/ethereum/go-ethereum/eth/catalyst.(*SimulatedBeacon).loopOnDemand(0xc000245ad0)\r\nenvironment-geth-dev-1  | \tgithub.com/ethereum/go-ethereum/eth/catalyst/simulated_beacon.go:197 +0x45c\r\nenvironment-geth-dev-1  | created by github.com/ethereum/go-ethereum/eth/catalyst.(*SimulatedBeacon).Start\r\nenvironment-geth-dev-1  | \tgithub.com/ethereum/go-ethereum/eth/catalyst/simulated_beacon.go:121 +0x65\r\nenvironment-geth-dev-1 exited with code 2\r\n````",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27990/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/27990/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
