{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2475",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2475/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2475/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2475/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/2475",
  "id": 149742918,
  "node_id": "MDU6SXNzdWUxNDk3NDI5MTg=",
  "number": 2475,
  "title": "Too many open files",
  "user": {
    "login": "wawrzek",
    "id": 968748,
    "node_id": "MDQ6VXNlcjk2ODc0OA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/968748?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wawrzek",
    "html_url": "https://github.com/wawrzek",
    "followers_url": "https://api.github.com/users/wawrzek/followers",
    "following_url": "https://api.github.com/users/wawrzek/following{/other_user}",
    "gists_url": "https://api.github.com/users/wawrzek/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wawrzek/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wawrzek/subscriptions",
    "organizations_url": "https://api.github.com/users/wawrzek/orgs",
    "repos_url": "https://api.github.com/users/wawrzek/repos",
    "events_url": "https://api.github.com/users/wawrzek/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wawrzek/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2016-04-20T11:36:56Z",
  "updated_at": "2017-11-17T12:19:18Z",
  "closed_at": "2016-04-20T13:08:51Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\n\n```\n> geth version:\nVersion: 1.3.5\nProtocol Versions: [63 62 61]\nNetwork Id: 1\nGo Version: go1.5.1\nOS: linux\nGOPATH=\nGOROOT=/usr/lib/go\n```\n\nOS & Version: Linux - Ubuntu 14.04 @ Azure. Default settings. For example ulimit:\n\n```\n> ulimit -a\ncore file size          (blocks, -c) 0\ndata seg size           (kbytes, -d) unlimited\nscheduling priority             (-e) 0\nfile size               (blocks, -f) unlimited\npending signals                 (-i) 27836\nmax locked memory       (kbytes, -l) 64\nmax memory size         (kbytes, -m) unlimited\nopen files                      (-n) 1024\npipe size            (512 bytes, -p) 8\nPOSIX message queues     (bytes, -q) 819200\nreal-time priority              (-r) 0\nstack size              (kbytes, -s) 8192\ncpu time               (seconds, -t) unlimited\nmax user processes              (-u) 27836\nvirtual memory          (kbytes, -v) unlimited\nfile locks                      (-x) unlimited\n```\n\nThis is private network.\n#### Expected behaviour\n\nGeth runs uninterrupted\n#### Actual behaviour\n\nGeth stops\n\n```\nI0414 00:45:34.218944   42448 server.go:1934] http: Accept error: accept tcp [::]:8080: accept4: too many open files; retrying in 1s\nI0414 00:45:34.773783   42448 worker.go:348] ðŸ”¨  Mined stale block (#28839 / 1b5d0af0).\nI0414 00:45:34.774072   42448 worker.go:569] commit new work on block 28849 with 0 txs & 0 uncles. Took 262.511Âµs\nI0414 00:45:34.774104   42448 worker.go:447] ðŸ”¨ ðŸ”—  Mined 5 blocks back: block #28835\nI0414 00:45:34.779953   42448 worker.go:447] ðŸ”¨ ðŸ”—  Mined 5 blocks back: block #28836\nI0414 00:45:35.221262   42448 server.go:1934] http: Accept error: accept tcp [::]:8080: accept4: too many open files; retrying in 1s\nI0414 00:45:35.323242   42448 blockchain.go:1251] imported 1 block(s) (0 queued 0 ignored) including 0 txs in 8.447061ms. #28849 [e4f86988 / e4f86988]\nI0414 00:45:36.221549   42448 server.go:1934] http: Accept error: accept tcp [::]:8080: accept4: too many open files; retrying in 1s\nI0414 00:45:37.221909   42448 server.go:1934] http: Accept error: accept tcp [::]:8080: accept4: too many open files; retrying in 1s\nI0414 00:45:38.222275   42448 server.go:1934] http: Accept error: accept tcp [::]:8080: accept4: too many open files; retrying in 1s\nI0414 00:45:39.102641   42448 blockchain.go:1251] imported 1 block(s) (0 queued 0 ignored) including 0 txs in 2.920125ms. #28850 [253abd01 / 253abd01]\nI0414 00:45:39.222639   42448 server.go:1934] http: Accept error: accept tcp [::]:8080: accept4: too many open files; retrying in 1s\nF0414 00:45:39.293489   42448 database_util.go:308] failed to store block total difficulty into database: open /opt/chain/chaindata/000295.log: too many open files\n```\n#### Steps to reproduce the behaviour\n\nStart geth and wait\n",
  "closed_by": {
    "login": "wawrzek",
    "id": 968748,
    "node_id": "MDQ6VXNlcjk2ODc0OA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/968748?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wawrzek",
    "html_url": "https://github.com/wawrzek",
    "followers_url": "https://api.github.com/users/wawrzek/followers",
    "following_url": "https://api.github.com/users/wawrzek/following{/other_user}",
    "gists_url": "https://api.github.com/users/wawrzek/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wawrzek/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wawrzek/subscriptions",
    "organizations_url": "https://api.github.com/users/wawrzek/orgs",
    "repos_url": "https://api.github.com/users/wawrzek/repos",
    "events_url": "https://api.github.com/users/wawrzek/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wawrzek/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2475/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2475/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/212392474",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2475#issuecomment-212392474",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2475",
    "id": 212392474,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxMjM5MjQ3NA==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-04-20T11:43:38Z",
    "updated_at": "2016-04-20T11:45:58Z",
    "author_association": "MEMBER",
    "body": "Please try the [1.4 RC release](https://github.com/ethereum/go-ethereum/releases/tag/v1.4.0). It might help because the HTTP RPC listener has been rewritten.\nCan you provide some info on the HTTP traffic you're throwing at it (requests/s, number of connections, which calls, etc.)?\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/212392474/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/212405167",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2475#issuecomment-212405167",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2475",
    "id": 212405167,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxMjQwNTE2Nw==",
    "user": {
      "login": "wawrzek",
      "id": 968748,
      "node_id": "MDQ6VXNlcjk2ODc0OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/968748?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wawrzek",
      "html_url": "https://github.com/wawrzek",
      "followers_url": "https://api.github.com/users/wawrzek/followers",
      "following_url": "https://api.github.com/users/wawrzek/following{/other_user}",
      "gists_url": "https://api.github.com/users/wawrzek/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wawrzek/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wawrzek/subscriptions",
      "organizations_url": "https://api.github.com/users/wawrzek/orgs",
      "repos_url": "https://api.github.com/users/wawrzek/repos",
      "events_url": "https://api.github.com/users/wawrzek/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wawrzek/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-04-20T12:31:39Z",
    "updated_at": "2016-04-20T12:31:39Z",
    "author_association": "NONE",
    "body": "@fjl I don't expect big traffic of any kind. Our private network is not under big stress yet. To be honest is nearly all time idling.\n\nIs there anything in geth directly what can help me to collect additional metrics you mentioned?\n\nAlso I don't remember seeing similar issue with previous release (priori to homestead).\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/212405167/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/212407424",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2475#issuecomment-212407424",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2475",
    "id": 212407424,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxMjQwNzQyNA==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-04-20T12:39:50Z",
    "updated_at": "2016-04-20T12:40:58Z",
    "author_association": "MEMBER",
    "body": "Geth does collect metrics (see `--metrics`, `geth monitor`), but not for HTTP server usage at this time.\nInfo you can maybe supply immediately is `--maxpeers` setting and number of peers that your node has.\nFor HTTP usage, you can either track it on the client side or run it through a proxy. If you have lots of time you can also add metrics for the HTTP server in geth.\n\nI am asking these questions because I cannot reproduce the issue. \nYour system fd limit is 1024, that should be plenty.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/212407424/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/212416987",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2475#issuecomment-212416987",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2475",
    "id": 212416987,
    "node_id": "MDEyOklzc3VlQ29tbWVudDIxMjQxNjk4Nw==",
    "user": {
      "login": "wawrzek",
      "id": 968748,
      "node_id": "MDQ6VXNlcjk2ODc0OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/968748?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wawrzek",
      "html_url": "https://github.com/wawrzek",
      "followers_url": "https://api.github.com/users/wawrzek/followers",
      "following_url": "https://api.github.com/users/wawrzek/following{/other_user}",
      "gists_url": "https://api.github.com/users/wawrzek/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wawrzek/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wawrzek/subscriptions",
      "organizations_url": "https://api.github.com/users/wawrzek/orgs",
      "repos_url": "https://api.github.com/users/wawrzek/repos",
      "events_url": "https://api.github.com/users/wawrzek/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wawrzek/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2016-04-20T13:08:51Z",
    "updated_at": "2016-04-20T13:08:51Z",
    "author_association": "NONE",
    "body": "@fjl Thanks for update. I'll keep an eye on the systems. I'm going to close the ticket for now and reopen if the situation repeats and I have more information.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/212416987/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/345229527",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/2475#issuecomment-345229527",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/2475",
    "id": 345229527,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM0NTIyOTUyNw==",
    "user": {
      "login": "baskinsy",
      "id": 1850894,
      "node_id": "MDQ6VXNlcjE4NTA4OTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1850894?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/baskinsy",
      "html_url": "https://github.com/baskinsy",
      "followers_url": "https://api.github.com/users/baskinsy/followers",
      "following_url": "https://api.github.com/users/baskinsy/following{/other_user}",
      "gists_url": "https://api.github.com/users/baskinsy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/baskinsy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/baskinsy/subscriptions",
      "organizations_url": "https://api.github.com/users/baskinsy/orgs",
      "repos_url": "https://api.github.com/users/baskinsy/repos",
      "events_url": "https://api.github.com/users/baskinsy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/baskinsy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-11-17T12:19:02Z",
    "updated_at": "2017-11-17T12:19:18Z",
    "author_association": "NONE",
    "body": "Hello, I'm experiencing the same issue. I gradually have increased max open files for my user account with no luck. Geth starts to sync but after some time fails with \"too many open files\". My system is Opensuse Tumbleweed.\r\n\r\nMy limits are:\r\n```ulimit -a\r\ncore file size          (blocks, -c) 0\r\ndata seg size           (kbytes, -d) unlimited\r\nscheduling priority             (-e) 0\r\nfile size               (blocks, -f) unlimited\r\npending signals                 (-i) 63231\r\nmax locked memory       (kbytes, -l) 262144\r\nmax memory size         (kbytes, -m) unlimited\r\nopen files                      (-n) 32768\r\npipe size            (512 bytes, -p) 8\r\nPOSIX message queues     (bytes, -q) 819200\r\nreal-time priority              (-r) 0\r\nstack size              (kbytes, -s) 8192\r\ncpu time               (seconds, -t) unlimited\r\nmax user processes              (-u) 4096\r\nvirtual memory          (kbytes, -v) unlimited\r\nfile locks                      (-x) unlimited\r\n```\r\nI'm doubling the open files limit every day (one boot per day ;) ) from the default 1024. Although I have reached 32768, geth still fails with the same error... I'll double again tomorrow and retry....\r\n\r\n```\r\nINFO [11-17|14:10:33] Imported new state entries               count=684  elapsed=5.032ms   processed=5774 pending=396 retry=0  duplicate=0 unexpected=0\r\nINFO [11-17|14:10:34] Imported new block receipts              count=117  elapsed=81.802ms  bytes=674306  number=3317210 hash=0589c6â€¦a265e6 ignored=0\r\nINFO [11-17|14:10:36] Imported new block headers               count=960  elapsed=6.775s    number=3319670 hash=cb8b29â€¦556922 ignored=0\r\nINFO [11-17|14:10:37] Imported new block receipts              count=634  elapsed=497.128ms bytes=5596000 number=3317844 hash=7bc244â€¦b038f2 ignored=0\r\nWARN [11-17|14:10:37] Stalling state sync, dropping peer       peer=a4fe3cff550ae9ce\r\nINFO [11-17|14:10:40] Imported new block receipts              count=207  elapsed=133.458ms bytes=1016056 number=3318051 hash=da78edâ€¦ce41e9 ignored=0\r\nINFO [11-17|14:10:44] Imported new block receipts              count=525  elapsed=519.126ms bytes=5673347 number=3318576 hash=7f0d37â€¦54712d ignored=0\r\nINFO [11-17|14:10:45] Imported new block receipts              count=74   elapsed=62.598ms  bytes=473578  number=3318650 hash=bdd5e7â€¦958b03 ignored=0\r\nCRIT [11-17|14:10:47] Failed to store header                   err=\"open /home/stratos/.ethereum/geth/chaindata/008963.ldb: too many open files\"\r\n```\r\nThanks.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/345229527/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
