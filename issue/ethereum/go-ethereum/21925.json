{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21925",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21925/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21925/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21925/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/21925",
  "id": 753507465,
  "node_id": "MDU6SXNzdWU3NTM1MDc0NjU=",
  "number": 21925,
  "title": "SIGINT never gets around to shutting down node",
  "user": {
    "login": "saurik",
    "id": 36743,
    "node_id": "MDQ6VXNlcjM2NzQz",
    "avatar_url": "https://avatars.githubusercontent.com/u/36743?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/saurik",
    "html_url": "https://github.com/saurik",
    "followers_url": "https://api.github.com/users/saurik/followers",
    "following_url": "https://api.github.com/users/saurik/following{/other_user}",
    "gists_url": "https://api.github.com/users/saurik/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/saurik/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/saurik/subscriptions",
    "organizations_url": "https://api.github.com/users/saurik/orgs",
    "repos_url": "https://api.github.com/users/saurik/repos",
    "events_url": "https://api.github.com/users/saurik/events{/privacy}",
    "received_events_url": "https://api.github.com/users/saurik/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2020-11-30T14:06:48Z",
  "updated_at": "2020-11-30T18:10:00Z",
  "closed_at": "2020-11-30T17:58:47Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 1.9.24-stable\r\nOS & Version: Linux\r\nCommit hash : cc05b050df5f88e80bb26aaf6d2f339c49c2d702\r\n\r\n#### Expected behaviour\r\n\r\nSIGINT causes node to shut down in a reasonable amount of time.\r\n\r\n#### Actual behaviour\r\n\r\nOver ten minutes later I'm still waiting for the node to shut down.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nAttempt to shut down a running node using SIGINT.\r\n\r\n#### Backtrace\r\n\r\nI saw #1379 had been asked for the log after you just panic it, so:\r\n\r\n[sigint.log](https://github.com/ethereum/go-ethereum/files/5616355/sigint.log)",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21925/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21925/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/735816427",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21925#issuecomment-735816427",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21925",
    "id": 735816427,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNTgxNjQyNw==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-30T14:24:21Z",
    "updated_at": "2020-11-30T14:24:21Z",
    "author_association": "MEMBER",
    "body": "Interesting. @zsfelfoldi the stack has a ton of these: \r\n```\r\ngoroutine 33251500 [sync.Cond.Wait, 12 minutes]:\r\nruntime.goparkunlock(...)\r\n        runtime/proc.go:312\r\nsync.runtime_notifyListWait(0xc0fd57ca10, 0x7b)\r\n        runtime/sema.go:513 +0xf8\r\nsync.(*Cond).Wait(0xc0fd57ca00)\r\n        sync/cond.go:56 +0x9d\r\ngithub.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).opStart(0xc0fd5d81c0, 0x35)\r\n        github.com/ethereum/go-ethereum/p2p/nodestate/nodestate.go:703 +0x2c\r\ngithub.com/ethereum/go-ethereum/p2p/nodestate.(*NodeStateMachine).SetField(0xc0fd5d81c0, 0xc119f781c0, 0x2, 0x1e6ea40, 0x0, 0x0, 0x0, 0x0)\r\n        github.com/ethereum/go-ethereum/p2p/nodestate/nodestate.go:865 +0x7b\r\ngithub.com/ethereum/go-ethereum/les.(*clientPool).disconnectNode(0xc109244420, 0xc119f781c0)\r\n        github.com/ethereum/go-ethereum/les/clientpool.go:264 +0x65\r\ngithub.com/ethereum/go-ethereum/les.(*clientPool).disconnect(0xc109244420, 0x1555560, 0xc188ef99e0)\r\n        github.com/ethereum/go-ethereum/les/clientpool.go:259 +0x3f\r\ngithub.com/ethereum/go-ethereum/les.(*serverHandler).handle.func3(0xc115b93790, 0xc0fc8e94a0, 0xc188ef99e0, 0x4cd377491a824)\r\n        github.com/ethereum/go-ethereum/les/server_handler.go:180 +0x5e\r\ngithub.com/ethereum/go-ethereum/les.(*serverHandler).handle(0xc0fc8e94a0, 0xc188ef99e0, 0x15349c0, 0xc00006a060)\r\n        github.com/ethereum/go-ethereum/les/server_handler.go:200 +0xa40\r\ngithub.com/ethereum/go-ethereum/les.(*serverHandler).runPeer(0xc0fc8e94a0, 0x3, 0xc1fed021e0, 0x15438a0, 0xc1c27d2a00, 0x0, 0x0)\r\n        github.com/ethereum/go-ethereum/les/server_handler.go:112 +0x10e\r\ngithub.com/ethereum/go-ethereum/les.(*lesCommons).makeProtocols.func1(0xc1fed021e0, 0x15438a0, 0xc1c27d2a00, 0xf8ae76f84067e5d4, 0x67f5d5406ab810c0)\r\n        github.com/ethereum/go-ethereum/les/commons.go:97 +0x4c\r\ngithub.com/ethereum/go-ethereum/p2p.(*Peer).startProtocols.func1(0xc1fed021e0, 0xc1c27d2a00, 0x15438a0, 0xc1c27d2a00)\r\n        github.com/ethereum/go-ethereum/p2p/peer.go:379 +0x98\r\ncreated by github.com/ethereum/go-ethereum/p2p.(*Peer).startProtocols\r\n        github.com/ethereum/go-ethereum/p2p/peer.go:377 +0x205\r\n```\r\nWhere looks like we're trying to disconnect a node `les.(*clientPool).disconnectNode(`, but get stuck on some `sync.Cond`. PTAL\r\n\r\n@saurik what's was the command line that started it? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/735816427/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/735822181",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21925#issuecomment-735822181",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21925",
    "id": 735822181,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNTgyMjE4MQ==",
    "user": {
      "login": "saurik",
      "id": 36743,
      "node_id": "MDQ6VXNlcjM2NzQz",
      "avatar_url": "https://avatars.githubusercontent.com/u/36743?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/saurik",
      "html_url": "https://github.com/saurik",
      "followers_url": "https://api.github.com/users/saurik/followers",
      "following_url": "https://api.github.com/users/saurik/following{/other_user}",
      "gists_url": "https://api.github.com/users/saurik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/saurik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/saurik/subscriptions",
      "organizations_url": "https://api.github.com/users/saurik/orgs",
      "repos_url": "https://api.github.com/users/saurik/repos",
      "events_url": "https://api.github.com/users/saurik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/saurik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-30T14:33:54Z",
    "updated_at": "2020-11-30T14:37:55Z",
    "author_association": "NONE",
    "body": "@holiman Here is the script I use to start the node. (I have a firewall set up external to this box to prevent anyone from accessing those 0.0.0.0 bound endpoints.)\r\n\r\n```bash\r\n#!/bin/bash\r\nulimit -n 65535\r\nexec geth \\\r\n    --cache $((24*1024)) \\\r\n    --http --http.addr 0.0.0.0 --http.api eth,web3,net --http.vhosts '*' \\\r\n    --ws --ws.addr 0.0.0.0 \\\r\n    --graphql --graphql.vhosts '*' \\\r\n    --nousb --light.serve 50\r\n```\r\n\r\nOne thing I also noticed (which I explicitly looked for due to that linked issue) is that there was, in fact, some kind of long-running leveldb compaction happening?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/735822181/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/735857664",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21925#issuecomment-735857664",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21925",
    "id": 735857664,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNTg1NzY2NA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-30T15:30:43Z",
    "updated_at": "2020-11-30T15:30:43Z",
    "author_association": "MEMBER",
    "body": "> some kind of long-running leveldb compaction happening? \r\n\r\nYes, it's a background compaction in leveldb",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/735857664/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/735951481",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21925#issuecomment-735951481",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21925",
    "id": 735951481,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNTk1MTQ4MQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-30T18:10:00Z",
    "updated_at": "2020-11-30T18:10:00Z",
    "author_association": "MEMBER",
    "body": "Thanks for the detailed report!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/735951481/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
