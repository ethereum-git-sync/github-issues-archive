{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23128",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23128/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23128/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23128/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/23128",
  "id": 932686522,
  "node_id": "MDU6SXNzdWU5MzI2ODY1MjI=",
  "number": 23128,
  "title": "Contract-internal transaction tracing APIs return error frequently",
  "user": {
    "login": "yuga-cb",
    "id": 82042350,
    "node_id": "MDQ6VXNlcjgyMDQyMzUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/82042350?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yuga-cb",
    "html_url": "https://github.com/yuga-cb",
    "followers_url": "https://api.github.com/users/yuga-cb/followers",
    "following_url": "https://api.github.com/users/yuga-cb/following{/other_user}",
    "gists_url": "https://api.github.com/users/yuga-cb/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yuga-cb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yuga-cb/subscriptions",
    "organizations_url": "https://api.github.com/users/yuga-cb/orgs",
    "repos_url": "https://api.github.com/users/yuga-cb/repos",
    "events_url": "https://api.github.com/users/yuga-cb/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yuga-cb/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-06-29T13:40:00Z",
  "updated_at": "2021-07-01T08:56:07Z",
  "closed_at": "2021-07-01T08:56:07Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 1.10.4\r\nOS & Version: Linux\r\n\r\n#### Expected behaviour\r\n\r\nThe JSON RPC APIs for contract-internal transaction tracing are important for auditing block processing, and include `debug_traceTransaction` and `debug_traceBlockByNumber`. They should return correct values with reasonable latency a very high percentage of the time.\r\n\r\n#### Actual behaviour\r\n\r\nPost-London fork on Ropsten, these APIs return errors with significantly greater frequency (i.e. 2-3 blocks / transactions per day). These errors are often timeouts, and happen regardless of what you set the timeout value to (e.g. 60s, 2m, 3m, etc.). This means that retries after the timeouts don't work - i.e., some blocks/transactions don't return a value no matter how many times the client retries.\r\n\r\nFor clients for whom these APIs are on the critical path for block processing, this bug is a blocker for London.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nRun against a Ropsten Geth node, e.g.:\r\n\r\n```\r\ncurl --header 'Content-Type: application/json' \\\r\n--data '{\"jsonrpc\":\"2.0\",\"method\":\"debug_traceTransaction\",\"params\":[\"0xe77aed4d4cc7c124c8166539407ae4311cfe0b816096bfa962daaa488501d098\"],\"id\":1}' \\\r\n<nodeUrl>\r\n```\r\n\r\nAlso reproduceable for the following transactions:\r\n\r\n```\r\n0x5a3b240e6cec91a9a1670954092ee599dd1fc62f3bdf573564eb21706b225ea4\r\n0xd830832a19b9a7f68a1aeb8510f2986f1811cac4e68ff290abbcde873158d327\r\n```\r\n\r\nFor block tracing:\r\n\r\n```\r\ncurl --header 'Content-Type: application/json' \\\r\n--data '{\"jsonrpc\":\"2.0\",\"method\":\"debug_traceBlockByNumber\",\"params\":[\"0xa09067\"],\"id\":1}' \\\r\n<nodeUrl>\r\n```\r\n\r\nAlso reproduceable for the following blocks:\r\n\r\n```\r\n0xa069ec\r\n0xa0b4c6\r\n```\r\n\r\n#### Backtrace\r\n\r\n````\r\nAn invalid response was received from the upstream server\r\n````\r\n\r\nWhen submitting logs: please submit them as text and not screenshots.",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23128/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23128/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/871996521",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23128#issuecomment-871996521",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23128",
    "id": 871996521,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MTk5NjUyMQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-01T07:26:29Z",
    "updated_at": "2021-07-01T07:26:29Z",
    "author_association": "MEMBER",
    "body": "0x5a3b240e6cec91a9a1670954092ee599dd1fc62f3bdf573564eb21706b225ea4 - 10,8 M gas. That might hit some timeout, I can imagine. \r\n0xd830832a19b9a7f68a1aeb8510f2986f1811cac4e68ff290abbcde873158d327 - only 34K gas, a legacy transaction. That should not error, and would be simpler to investigate than the first one",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/871996521/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/872059803",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/23128#issuecomment-872059803",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/23128",
    "id": 872059803,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MjA1OTgwMw==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-01T08:56:07Z",
    "updated_at": "2021-07-01T08:56:07Z",
    "author_association": "MEMBER",
    "body": "It seems that this is fixed by https://github.com/ethereum/go-ethereum/pull/23016 . Please reopen if you're still having problems. Also, for large-scale opcode-style dumping of transactions, it's better to use `debug_standardTraceBlockToFile`, which streams json-lines to disk, instead of sending a (several Gb) json blob over RPC  ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/872059803/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
