{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22571",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22571/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22571/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22571/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/22571",
  "id": 840732610,
  "node_id": "MDU6SXNzdWU4NDA3MzI2MTA=",
  "number": 22571,
  "title": "Snapshots cannot be disabled via TOML, only via CLI arguments",
  "user": {
    "login": "du2zy",
    "id": 46239138,
    "node_id": "MDQ6VXNlcjQ2MjM5MTM4",
    "avatar_url": "https://avatars.githubusercontent.com/u/46239138?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/du2zy",
    "html_url": "https://github.com/du2zy",
    "followers_url": "https://api.github.com/users/du2zy/followers",
    "following_url": "https://api.github.com/users/du2zy/following{/other_user}",
    "gists_url": "https://api.github.com/users/du2zy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/du2zy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/du2zy/subscriptions",
    "organizations_url": "https://api.github.com/users/du2zy/orgs",
    "repos_url": "https://api.github.com/users/du2zy/repos",
    "events_url": "https://api.github.com/users/du2zy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/du2zy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    },
    {
      "id": 1132689577,
      "node_id": "MDU6TGFiZWwxMTMyNjg5NTc3",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:triage",
      "name": "status:triage",
      "color": "6be514",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "MariusVanDerWijden",
    "id": 16664698,
    "node_id": "MDQ6VXNlcjE2NjY0Njk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MariusVanDerWijden",
    "html_url": "https://github.com/MariusVanDerWijden",
    "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
    "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
    "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
    "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
    "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
    "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-03-25T09:25:18Z",
  "updated_at": "2021-04-07T06:41:06Z",
  "closed_at": "2021-04-07T06:41:06Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I use geth.toml to configure the node.\r\n\r\nAfter updating to 1.10.1 version I executed command:\r\n\r\n```\r\ngeth --snapshot=false ... dumpconfig > geth.toml\r\n```\r\n\r\nAfter that I started the node.\r\n\r\nFlag `--snapshot=false` affects one line in config, I didn't notice any other changes:\r\n\r\n```\r\nSnapshotCache = 0\r\n```\r\n\r\nAfter yesterday's fork (Berlin), my node is not available and I see the following:\r\n\r\n```\r\nINFO [03-25|08:20:25.693] Generating state snapshot                root=\"8fb9ce…b7b2aa\" in=\"5e3c85…cedbc9\" at=\"aa0694…11cc66\" accounts=1929027 slots=46069585 storage=3.54GiB    elapsed=185h26m16.681s eta=318h19m3.436s\r\n```\r\n\r\nThis brought me to a thought that my node generates snapshots now despite that I've disabled it earlier. I don't want to use this feature untill it starts to work correctly.\r\n\r\nSnapshot generating will take many hours.\r\n\r\nWhat did I do wrong? How can I guarantee myself not to face such problems using production node?",
  "closed_by": {
    "login": "MariusVanDerWijden",
    "id": 16664698,
    "node_id": "MDQ6VXNlcjE2NjY0Njk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MariusVanDerWijden",
    "html_url": "https://github.com/MariusVanDerWijden",
    "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
    "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
    "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
    "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
    "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
    "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22571/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22571/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/806566183",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22571#issuecomment-806566183",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22571",
    "id": 806566183,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwNjU2NjE4Mw==",
    "user": {
      "login": "du2zy",
      "id": 46239138,
      "node_id": "MDQ6VXNlcjQ2MjM5MTM4",
      "avatar_url": "https://avatars.githubusercontent.com/u/46239138?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/du2zy",
      "html_url": "https://github.com/du2zy",
      "followers_url": "https://api.github.com/users/du2zy/followers",
      "following_url": "https://api.github.com/users/du2zy/following{/other_user}",
      "gists_url": "https://api.github.com/users/du2zy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/du2zy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/du2zy/subscriptions",
      "organizations_url": "https://api.github.com/users/du2zy/orgs",
      "repos_url": "https://api.github.com/users/du2zy/repos",
      "events_url": "https://api.github.com/users/du2zy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/du2zy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-25T11:13:23Z",
    "updated_at": "2021-03-25T11:13:23Z",
    "author_association": "NONE",
    "body": "I started the node like this (listed arguments of a command line without using configuration file):\r\n\r\n```\r\ngeth --snapshot=false --rinkeby ...\r\n```\r\n\r\nIt seems that it worked. Anyway, I don't see any messages on snapshot generating.\r\n\r\nThere's some error in geth code or do I do something wrong?\r\n\r\nWhat should I do next? I am wary of that after mainnet fork, I'll get my node stopped. Should I reject using configuration file but use command line arguments instead?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/806566183/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/806845633",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22571#issuecomment-806845633",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22571",
    "id": 806845633,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwNjg0NTYzMw==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-25T14:24:22Z",
    "updated_at": "2021-03-25T14:24:22Z",
    "author_association": "MEMBER",
    "body": "You'll need to provide some more logs. Generating state snapshot isn't something bad, it takes a while. Your node should still be functional in the mean time.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/806845633/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/808055399",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22571#issuecomment-808055399",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22571",
    "id": 808055399,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwODA1NTM5OQ==",
    "user": {
      "login": "du2zy",
      "id": 46239138,
      "node_id": "MDQ6VXNlcjQ2MjM5MTM4",
      "avatar_url": "https://avatars.githubusercontent.com/u/46239138?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/du2zy",
      "html_url": "https://github.com/du2zy",
      "followers_url": "https://api.github.com/users/du2zy/followers",
      "following_url": "https://api.github.com/users/du2zy/following{/other_user}",
      "gists_url": "https://api.github.com/users/du2zy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/du2zy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/du2zy/subscriptions",
      "organizations_url": "https://api.github.com/users/du2zy/orgs",
      "repos_url": "https://api.github.com/users/du2zy/repos",
      "events_url": "https://api.github.com/users/du2zy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/du2zy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-26T09:05:43Z",
    "updated_at": "2021-03-26T09:05:43Z",
    "author_association": "NONE",
    "body": "RPC was available, but the transactions were not sent to the network until I turned off snapshot generation.\r\n\r\nThe problem I want to report is that it is impossible to disable snapshots in the configuration file.\r\n\r\nWhat additional logs do I need to attach?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/808055399/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/814647127",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22571#issuecomment-814647127",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22571",
    "id": 814647127,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNDY0NzEyNw==",
    "user": {
      "login": "MariusVanDerWijden",
      "id": 16664698,
      "node_id": "MDQ6VXNlcjE2NjY0Njk4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MariusVanDerWijden",
      "html_url": "https://github.com/MariusVanDerWijden",
      "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
      "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
      "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
      "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
      "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
      "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-07T06:41:06Z",
    "updated_at": "2021-04-07T06:41:06Z",
    "author_association": "MEMBER",
    "body": "Yeah, I can't reproduce this issue. The dumpconfig correctly sets `SnapshotCache = 0` which disables snapshot generation. \r\n```\r\n./build/bin/geth --snapshot=false dumpconfig  2>/dev/null  > test.conf && ./build/bin/geth --config test.conf dumpconfig 2>/dev/null | grep \"Snap\"\r\nSnapDiscoveryURLs = []\r\nSnapshotCache = 0\r\n```\r\nIt's a bit unfortunate that the SnapshotCache flag has two different responsibilities, but afaict the logic is correct.\r\nThe flag gets read normally and it disables snapshot generation on my node. Maybe it was a fluke, or the node was started with some half generated snapshot in memory. \r\nI'll close the issue for now, If you @du2zy, or someone else can reproduce it, feel free to reopen!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/814647127/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
