{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18977",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18977/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18977/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18977/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/18977",
  "id": 405500184,
  "node_id": "MDU6SXNzdWU0MDU1MDAxODQ=",
  "number": 18977,
  "title": "panic in WriteBlockWithState for very long low-td sidechain eventually beating canon chain",
  "user": {
    "login": "ryanschneider",
    "id": 53520,
    "node_id": "MDQ6VXNlcjUzNTIw",
    "avatar_url": "https://avatars.githubusercontent.com/u/53520?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ryanschneider",
    "html_url": "https://github.com/ryanschneider",
    "followers_url": "https://api.github.com/users/ryanschneider/followers",
    "following_url": "https://api.github.com/users/ryanschneider/following{/other_user}",
    "gists_url": "https://api.github.com/users/ryanschneider/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ryanschneider/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ryanschneider/subscriptions",
    "organizations_url": "https://api.github.com/users/ryanschneider/orgs",
    "repos_url": "https://api.github.com/users/ryanschneider/repos",
    "events_url": "https://api.github.com/users/ryanschneider/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ryanschneider/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2019-02-01T00:25:31Z",
  "updated_at": "2019-02-08T10:27:41Z",
  "closed_at": "2019-02-08T10:27:41Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "\r\n#### System information\r\n\r\nGeth version: `1.8.22`\r\nOS & Version: Linux\r\n\r\n#### Backtrace\r\n\r\n````\r\nINFO [01-31|20:34:43.732] Imported new chain segment               blocks=2048 txs=88    mgas=18.425   elapsed=819.636ms mgasps=22.480  number=819200 hash=341128â€¦\r\nINFO [01-31|20:34:43.815] Importing heavy sidechain segment        blocks=2048 start=819201 end=821248\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x1c0 pc=0x89e95a]\r\ngoroutine 359309 [running]:\r\ngithub.com/ethereum/go-ethereum/core.(*BlockChain).WriteBlockWithState(0xc010364000, 0xc0f02a4090, 0x0, 0x0, 0x0, 0xc06916a0d0, 0x0, 0x0, 0x0)\r\n        /ext-go/1/src/github.com/ethereum/go-ethereum/core/blockchain.go:976 +0xe7a\r\ngithub.com/ethereum/go-ethereum/core.(*BlockChain).insertChain(0xc010364000, 0xc060afc000, 0x800, 0x900, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, ...)\r\n        /ext-go/1/src/github.com/ethereum/go-ethereum/core/blockchain.go:1215 +0xcf7\r\ngithub.com/ethereum/go-ethereum/core.(*BlockChain).insertSidechain(0xc010364000, 0xc06d5136a0, 0xc0000c30b0, 0xc0000c3001, 0x800, 0x800, 0xc0622aa000, 0x800, 0x80\r\n        /ext-go/1/src/github.com/ethereum/go-ethereum/core/blockchain.go:1369 +0x1a3f\r\ngithub.com/ethereum/go-ethereum/core.(*BlockChain).insertChain(0xc010364000, 0xc06b0b0000, 0x800, 0x800, 0x45beb41b51182401, 0x0, 0x0, 0x0, 0x0, 0x0, ...)\r\n        /ext-go/1/src/github.com/ethereum/go-ethereum/core/blockchain.go:1139 +0x2e15\r\ngithub.com/ethereum/go-ethereum/core.(*BlockChain).InsertChain(0xc010364000, 0xc06b0b0000, 0x800, 0x800, 0x0, 0x0, 0x0)\r\n        /ext-go/1/src/github.com/ethereum/go-ethereum/core/blockchain.go:1088 +0xb89\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).importBlockResults(0xc00020a820, 0xc06c0d6000, 0x800, 0x800, 0x800, 0x0)\r\n        /ext-go/1/src/github.com/ethereum/go-ethereum/eth/downloader/downloader.go:1490 +0x40e\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).processFullSyncContent(0xc00020a820, 0x0, 0xc000051798)\r\n        /ext-go/1/src/github.com/ethereum/go-ethereum/eth/downloader/downloader.go:1464 +0x79\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).processFullSyncContent-fm(0xc000000008, 0x1027608)\r\n        /ext-go/1/src/github.com/ethereum/go-ethereum/eth/downloader/downloader.go:479 +0x2a\r\ngithub.com/ethereum/go-ethereum/eth/downloader.(*Downloader).spawnSync.func1(0xc00020a820, 0xc034737620, 0xc01073fe60)\r\n        /ext-go/1/src/github.com/ethereum/go-ethereum/eth/downloader/downloader.go:491 +0x59\r\ncreated by github.com/ethereum/go-ethereum/eth/downloader.(*Downloader).spawnSync\r\n        /ext-go/1/src/github.com/ethereum/go-ethereum/eth/downloader/downloader.go:491 +0xaf\r\n````\r\n\r\nThe implication is that `header` is nil, which seems possible `GetHeaderByNumber() returns nil if `rawdb.ReadCanonicalHash()` returns an empty hash.\r\n\r\n```\r\n\t\t\t// Find the next state trie we need to commit\r\n\t\t\theader := bc.GetHeaderByNumber(current - triesInMemory)\r\n\t\t\tchosen := header.Number.Uint64()  //header can be nil here\r\n```\r\n\r\nBut, I'm not sure what err would be best to return in that case.\r\n",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18977/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18977/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/459668284",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18977#issuecomment-459668284",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18977",
    "id": 459668284,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1OTY2ODI4NA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-01T09:56:11Z",
    "updated_at": "2019-02-01T10:44:30Z",
    "author_association": "MEMBER",
    "body": "Seems like when importing a large sidechain, it tries to do pruning, and goes to collect the canonical head at block `N-128`. If `N` is way ahead of the canon chain, it becomes `nil`. So it seems that the sidechain has not (yet) switched over as the canonical chain. Still investigating ...  ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/459668284/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/459669721",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18977#issuecomment-459669721",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18977",
    "id": 459669721,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1OTY2OTcyMQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-01T10:01:01Z",
    "updated_at": "2019-02-01T10:01:01Z",
    "author_association": "MEMBER",
    "body": "@ryanschneider do you have any more logs _preceding_ the lines in the report? Would be interesting to see where the canon chain was at when this happened",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/459669721/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/459803153",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18977#issuecomment-459803153",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18977",
    "id": 459803153,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1OTgwMzE1Mw==",
    "user": {
      "login": "ryanschneider",
      "id": 53520,
      "node_id": "MDQ6VXNlcjUzNTIw",
      "avatar_url": "https://avatars.githubusercontent.com/u/53520?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanschneider",
      "html_url": "https://github.com/ryanschneider",
      "followers_url": "https://api.github.com/users/ryanschneider/followers",
      "following_url": "https://api.github.com/users/ryanschneider/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanschneider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanschneider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanschneider/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanschneider/orgs",
      "repos_url": "https://api.github.com/users/ryanschneider/repos",
      "events_url": "https://api.github.com/users/ryanschneider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanschneider/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-01T17:35:36Z",
    "updated_at": "2019-02-01T17:35:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'll try to grab some logs today, should still have them.  BTW I only saw this on one or two nodes, so doesn't seem too pervasive but wanted to get the stack trace down in case it hints to a bigger underlaying issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/459803153/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/459807562",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18977#issuecomment-459807562",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18977",
    "id": 459807562,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1OTgwNzU2Mg==",
    "user": {
      "login": "ryanschneider",
      "id": 53520,
      "node_id": "MDQ6VXNlcjUzNTIw",
      "avatar_url": "https://avatars.githubusercontent.com/u/53520?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanschneider",
      "html_url": "https://github.com/ryanschneider",
      "followers_url": "https://api.github.com/users/ryanschneider/followers",
      "following_url": "https://api.github.com/users/ryanschneider/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanschneider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanschneider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanschneider/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanschneider/orgs",
      "repos_url": "https://api.github.com/users/ryanschneider/repos",
      "events_url": "https://api.github.com/users/ryanschneider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanschneider/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-01T17:49:38Z",
    "updated_at": "2019-02-01T17:49:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok here's the parts of systemd journal leading up to the SIGSEGV: \r\n[ropsten-nil.log](https://github.com/ethereum/go-ethereum/files/2822696/ropsten-nil.log)\r\n\r\nI also kept some of the log lines of after the restart, since afterwards the node kept hitting this error during syncing, which slowed it down considerably:\r\n\r\n```\r\nJan 31 20:35:55 ip-10-0-25-83 geth[26789]: WARN [01-31|20:35:55.108] Synchronisation failed, dropping peer    peer=4e011cb2992bd7b5 err=\"retrieved ancestor is invalid\"\r\nJan 31 20:35:58 ip-10-0-25-83 geth[26789]: WARN [01-31|20:35:58.413] Synchronisation failed, dropping peer    peer=c7e7675577416d6b err=\"action from bad peer ignored\"\r\nJan 31 20:36:51 ip-10-0-25-83 geth[26789]: WARN [01-31|20:36:51.717] Ancestor below allowance                 peer=4e011cb2992bd7b5 number=730841 hash=000000â€¦000000 allowance=730841\r\n```\r\n\r\nI don't think it's related, but wanted to include it just in case.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/459807562/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/459859055",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18977#issuecomment-459859055",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18977",
    "id": 459859055,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ1OTg1OTA1NQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-01T20:34:43Z",
    "updated_at": "2019-02-01T20:34:43Z",
    "author_association": "MEMBER",
    "body": "Thanks, that really helps!\r\n\r\nSnippets from the logs\r\n\r\n```\r\nJan 31 19:46:26  geth[9939]: INFO [01-31|19:46:26.187] Imported new state entries               count=1616 elapsed=7.919ms   processed=4575299 pending=2918  retry=0   duplicate=8 unexpected=922\r\nJan 31 19:46:26  geth[9939]: INFO [01-31|19:46:26.870] Imported new state entries               count=2303 elapsed=14.745ms  processed=4577602 pending=80    retry=2   duplicate=8 unexpected=922\r\nJan 31 19:46:28  geth[9939]: INFO [01-31|19:46:28.347] Imported new state entries               count=126  elapsed=1.269ms   processed=4577728 pending=0     retry=0   duplicate=8 unexpected=922\r\nJan 31 19:46:28  geth[9939]: INFO [01-31|19:46:28.347] Imported new block receipts              count=1    elapsed=128.03Âµs  number=820714 hash=effcbdâ€¦45a957 age=28m17s    size=4.00B\r\nJan 31 19:46:28  geth[9939]: INFO [01-31|19:46:28.348] Committed new head block                 number=820714 hash=effcbdâ€¦45a957\r\nJan 31 19:46:28  geth[9939]: INFO [01-31|19:46:28.384] Imported new chain segment               blocks=108 txs=0 mgas=0.000 elapsed=35.551ms  mgasps=0.000 number=820822 hash=83e767â€¦e42d1d cache=363.96kB\r\nJan 31 19:46:28  geth[9939]: INFO [01-31|19:46:28.392] Upgrading chain index                    type=bloombits percentage=36\r\nJan 31 19:46:29  geth[9939]: INFO [01-31|19:46:29.258] Imported new block headers               count=2    elapsed=5.459ms   number=820824 hash=2de5fbâ€¦9551fb\r\nJan 31 19:46:29  geth[9939]: INFO [01-31|19:46:29.260] Imported new chain segment               blocks=2   txs=0 mgas=0.000 elapsed=1.221ms   mgasps=0.000 number=820824 hash=2de5fbâ€¦9551fb cache=370.70kB\r\nJan 31 19:46:29  geth[9939]: INFO [01-31|19:46:29.341] Fast sync complete, auto disabling\r\nJan 31 19:46:36  geth[9939]: INFO [01-31|19:46:36.509] Upgrading chain index                    type=bloombits percentage=52\r\nJan 31 19:46:36  geth[9939]: WARN [01-31|19:46:36.616] Ancestor below allowance                 peer=9984fe203477fcfa number=730824 hash=000000â€¦000000 allowance=730824\r\n\r\n... then some sidechain action\r\n\r\nJan 31 19:47:33  geth[9939]: WARN [01-31|19:47:33.065] Synchronisation failed, dropping peer    peer=f7bc214b51231edf err=\"retrieved ancestor is invalid\"\r\nJan 31 19:47:33  geth[9939]: INFO [01-31|19:47:33.531] Imported new chain segment               blocks=1   txs=0 mgas=0.000 elapsed=2.834ms   mgasps=0.000 number=820828 hash=3c2d45â€¦b8c13a cache=384.18kB\r\nJan 31 19:47:45  geth[9939]: INFO [01-31|19:47:45.485] Sidechain written to disk                start=772919 end=772933 sidetd=201388721547440 localtd=201496947937404\r\nJan 31 19:47:46  geth[9939]: INFO [01-31|19:47:46.129] Sidechain written to disk                start=772934 end=773297 sidetd=201388945000623 localtd=201496947937404\r\nJan 31 19:47:46  geth[9939]: INFO [01-31|19:47:46.692] Sidechain written to disk                start=773298 end=773551 sidetd=201389101624214 localtd=201496947937404\r\nJan 31 19:47:48  geth[9939]: INFO [01-31|19:47:48.995] Sidechain written to disk                start=773552 end=775599 sidetd=201390473790436 localtd=201496947937404\r\nJan 31 19:47:49  geth[9939]: INFO [01-31|19:47:49.000] Imported new chain segment               blocks=1   txs=0 mgas=0.000 elapsed=4.786ms   mgasps=0.000 number=820829 hash=1448caâ€¦becbfb cache=387.55kB\r\nJan 31 19:47:50  geth[9939]: INFO [01-31|19:47:50.996] Sidechain written to disk                start=775600 end=777647 sidetd=201392233224704 localtd=201496951542984\r\n...\r\nJan 31 19:49:47  geth[9939]: INFO [01-31|19:49:47.372] Sidechain written to disk                start=894384 end=896431 sidetd=201490982681086 localtd=201496994897760\r\nJan 31 19:49:49  geth[9939]: INFO [01-31|19:49:49.484] Sidechain written to disk                start=896432 end=898479 sidetd=201494002149870 localtd=201496994897760\r\nJan 31 19:50:22  geth[9939]: INFO [01-31|19:50:22.493] Importing heavy sidechain segment        blocks=2048 start=1      end=2048\r\nJan 31 19:50:23  geth[9939]: INFO [01-31|19:50:23.993] Imported new chain segment               blocks=2048 txs=22 mgas=1.258 elapsed=1.499s    mgasps=0.839 number=2048   hash=6708aaâ€¦742bab age=2y2mo3w   cache=611.95kB\r\nJan 31 19:50:24  geth[9939]: INFO [01-31|19:50:24.062] Importing heavy sidechain segment        blocks=2048 start=2049   end=4096\r\nJan 31 19:50:25  geth[9939]: INFO [01-31|19:50:25.010] Imported new chain segment               blocks=2048 txs=3  mgas=2.351 elapsed=948.191ms mgasps=2.480 number=4096   hash=769903â€¦c570f8 age=2y2mo3w   cache=658.88kB\r\nJan 31 19:50:25  geth[9939]: INFO [01-31|19:50:25.081] Importing heavy sidechain segment        blocks=2048 start=4097   end=6144\r\n\r\n... and finally\r\n\r\nJan 31 20:34:43  geth[9939]: INFO [01-31|20:34:43.732] Imported new chain segment               blocks=2048 txs=88    mgas=18.425   elapsed=819.636ms mgasps=22.480  number=819200 hash=341128â€¦8218d7 age=1y6mo3w   cache=533.17mB\r\nJan 31 20:34:43  geth[9939]: INFO [01-31|20:34:43.815] Importing heavy sidechain segment        blocks=2048 start=819201 end=821248\r\nJan 31 20:34:44  geth[9939]: panic: runtime error: invalid memory address or nil pointer dereference\r\nJan 31 20:34:44  geth[9939]: [signal SIGSEGV: segmentation violation code=0x1 addr=0x1c0 pc=0x89e95a]\r\nJan 31 20:34:44  geth[9939]: goroutine 359309 [running]:\r\nJan 31 20:34:44  geth[9939]: github.com/ethereum/go-ethereum/core.(*BlockChain).WriteBlockWithState(0xc010364000, 0xc0f02a4090, 0x0, 0x0, 0x0, 0xc06916a0d0, 0x0, 0x0, 0x0)\r\nJan 31 20:34:44  geth[9939]:         /ext-go/1/src/github.com/ethereum/go-ethereum/core/blockchain.go:976 +0xe7a\r\nJan 31 20:34:44  geth[9939]: github.com/ethereum/go-ethereum/core.(*BlockChain).insertChain(0xc010364000, 0xc060afc000,\r\n```\r\n\r\nI think it first fast-synced to a 'bad' destination.\r\n\r\n```\r\nCommitted new head block                 number=820714 hash=effcbdâ€¦45a957\r\n```\r\nHere's canon `820714`: https://ropsten.etherscan.io/block/820714 : 0xa3ea2545b163e845e2c205681100a58954448f9b0fab8b120b28b38d68118a47\r\n\r\nThe block `820714` is almost two years old: `646 days 4 hrs ago (Apr-26-2017 03:56:52 PM +UTC)`, and a totally different hash. \r\nSo you fast-synced to some stale sidechain, and then basially did a full-sync during sidechain import. I'm still not really sure why there is not a reorg earlier, before we pass `128` blocks into the better chain and thus wind up where we get a `nil` for the canon block `block - 128`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/459859055/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/460189782",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18977#issuecomment-460189782",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18977",
    "id": 460189782,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MDE4OTc4Mg==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-04T09:59:57Z",
    "updated_at": "2019-02-04T09:59:57Z",
    "author_association": "MEMBER",
    "body": "In the first case, @ryanschneider , here's a theory. \r\n1. Someone mined a new chain `A` from ropsten genesis, with pretty low difficulty all the way\r\n2. You fast-synced to that chain. \r\n3. You then heard about a chain with even higher td, `B` , and started importing that\r\n4. However, `B`, had even lower difficulty per block, and did not overtake `A` until more than `128` blocks after than `A` chain tip. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/460189782/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/461758345",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18977#issuecomment-461758345",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18977",
    "id": 461758345,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ2MTc1ODM0NQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-02-08T10:27:41Z",
    "updated_at": "2019-02-08T10:27:41Z",
    "author_association": "MEMBER",
    "body": "Fixed by https://github.com/ethereum/go-ethereum/pull/18988",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/461758345/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
