{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16761",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16761/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16761/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16761/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/16761",
  "id": 324674783,
  "node_id": "MDU6SXNzdWUzMjQ2NzQ3ODM=",
  "number": 16761,
  "title": "I think i found the reason why 'insufficient funds for gas * price + value'",
  "user": {
    "login": "qq940043871",
    "id": 3883919,
    "node_id": "MDQ6VXNlcjM4ODM5MTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3883919?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/qq940043871",
    "html_url": "https://github.com/qq940043871",
    "followers_url": "https://api.github.com/users/qq940043871/followers",
    "following_url": "https://api.github.com/users/qq940043871/following{/other_user}",
    "gists_url": "https://api.github.com/users/qq940043871/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/qq940043871/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/qq940043871/subscriptions",
    "organizations_url": "https://api.github.com/users/qq940043871/orgs",
    "repos_url": "https://api.github.com/users/qq940043871/repos",
    "events_url": "https://api.github.com/users/qq940043871/events{/privacy}",
    "received_events_url": "https://api.github.com/users/qq940043871/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2018-05-20T01:23:05Z",
  "updated_at": "2018-05-21T09:27:32Z",
  "closed_at": "2018-05-21T09:27:32Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi there,\r\n\r\nplease note that this is an issue tracker reserved for bug reports and feature requests.\r\n\r\nFor general questions please use the gitter channel or the Ethereum stack exchange at https://ethereum.stackexchange.com.\r\n\r\n#### System information\r\n\r\nGeth version: `geth 1.8.3`\r\nOS & Version: Windows\r\nCommit hash : (if `develop`)\r\n\r\n#### Expected behaviour\r\n\r\n\r\n#### Actual behaviour\r\n\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n\r\n#### Backtrace\r\n\r\n````\r\n[backtrace]\r\n````\r\n",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16761/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16761/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/390451287",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16761#issuecomment-390451287",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16761",
    "id": 390451287,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MDQ1MTI4Nw==",
    "user": {
      "login": "qq940043871",
      "id": 3883919,
      "node_id": "MDQ6VXNlcjM4ODM5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3883919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/qq940043871",
      "html_url": "https://github.com/qq940043871",
      "followers_url": "https://api.github.com/users/qq940043871/followers",
      "following_url": "https://api.github.com/users/qq940043871/following{/other_user}",
      "gists_url": "https://api.github.com/users/qq940043871/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/qq940043871/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/qq940043871/subscriptions",
      "organizations_url": "https://api.github.com/users/qq940043871/orgs",
      "repos_url": "https://api.github.com/users/qq940043871/repos",
      "events_url": "https://api.github.com/users/qq940043871/events{/privacy}",
      "received_events_url": "https://api.github.com/users/qq940043871/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-20T01:36:59Z",
    "updated_at": "2018-05-20T01:41:52Z",
    "author_association": "NONE",
    "body": "1. when  eth_sign **the signdata is  msg := fmt.Sprintf(\"\\x19Ethereum Signed Message:\\n%d%s\",** len(data), data)\r\n```go\r\nfunc (s *PublicTransactionPoolAPI) Sign(addr common.Address, data hexutil.Bytes) (hexutil.Bytes, error) {\r\n\t// Look up the wallet containing the requested signer\r\n\taccount := accounts.Account{Address: addr}\r\n\twallet, err := s.b.AccountManager().Find(account)\r\n\tif err != nil {\r\n\t\treturn nil, err\r\n\t}\r\n\t// Sign the requested hash with the wallet\r\n\tsignature, err := wallet.SignHash(account, signHash(data))\r\n\tif err == nil {\r\n\t\tsignature[64] += 27 // Transform V from 0/1 to 27/28 according to the yellow paper\r\n\t}\r\n\treturn signature, err\r\n}\r\n```\r\n\r\n```go\r\nfunc signHash(data []byte) []byte {\r\n\tmsg := fmt.Sprintf(\"\\x19Ethereum Signed Message:\\n%d%s\", len(data), data)\r\n\treturn crypto.Keccak256([]byte(msg))\r\n}\r\n```\r\n\r\n2. but when  send_rawTransaciton----src/core/types/transaciton_signing.go,**the signdata is only the tx**\r\n```go\r\nfunc (hs HomesteadSigner) Sender(tx *Transaction) (common.Address, error) {\r\n\treturn recoverPlain(hs.Hash(tx), tx.data.R, tx.data.S, tx.data.V, true)\r\n}\r\n```\r\n\r\n```go\r\n// Hash returns the hash to be signed by the sender.\r\n// It does not uniquely identify the transaction.\r\nfunc (fs FrontierSigner) Hash(tx *Transaction) common.Hash {\r\n\tfmt.Printf(\"Hash:\")\r\n\tfmt.Printf(\"%+v\\n\", tx)\r\n\treturn rlpHash([]interface{}{\r\n\t\ttx.data.AccountNonce,\r\n\t\ttx.data.Price,\r\n\t\ttx.data.GasLimit,\r\n\t\ttx.data.Recipient,\r\n\t\ttx.data.Amount,\r\n\t\ttx.data.Payload,\r\n\t})\r\n}\r\n```\r\n\r\n3. because the signdata is different,so geth can't recover the corrent address through \r\n````go\r\nfunc recoverPlain(sighash common.Hash, R, S, Vb *big.Int, homestead bool) (common.Address, error) {\r\n\tif Vb.BitLen() > 8 {\r\n\t\treturn common.Address{}, ErrInvalidSig\r\n\t}\r\n\tV := byte(Vb.Uint64() - 27)\r\n\t//edit by zf 2018-05-19\r\n\t//V := byte(Vb.Uint64())\r\n\tif !crypto.ValidateSignatureValues(V, R, S, homestead) {\r\n\t\treturn common.Address{}, ErrInvalidSig\r\n\t}\r\n\t// encode the snature in uncompressed format\r\n\tr, s := R.Bytes(), S.Bytes()\r\n\tsig := make([]byte, 65)\r\n\tcopy(sig[32-len(r):32], r)\r\n\tcopy(sig[64-len(s):64], s)\r\n\tsig[64] = V\r\n\r\n\tfmt.Print(\"sighash:\")\r\n\tfmt.Printf(\"%x\\n\", sighash)\r\n\r\n\tfmt.Print(\"sig:\")\r\n\tfmt.Printf(\"%x\\n\", sig)\r\n\r\n\t// recover the public key from the snature\r\n\tpub, err := crypto.Ecrecover(sighash[:], sig)\r\n\tif err != nil {\r\n\t\treturn common.Address{}, err\r\n\t}\r\n\tif len(pub) == 0 || pub[0] != 4 {\r\n\t\treturn common.Address{}, errors.New(\"invalid public key\")\r\n\t}\r\n\tvar addr common.Address\r\n\tcopy(addr[:], crypto.Keccak256(pub[1:])[12:])\r\n\tfmt.Printf(\"%x\\n\", addr)\r\n\treturn addr, nil\r\n}\r\n````\r\n\r\n4. I need help，please，thank you @karalabe  @ligi \r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/390451287/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/390483941",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16761#issuecomment-390483941",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16761",
    "id": 390483941,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MDQ4Mzk0MQ==",
    "user": {
      "login": "ligi",
      "id": 111600,
      "node_id": "MDQ6VXNlcjExMTYwMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ligi",
      "html_url": "https://github.com/ligi",
      "followers_url": "https://api.github.com/users/ligi/followers",
      "following_url": "https://api.github.com/users/ligi/following{/other_user}",
      "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
      "organizations_url": "https://api.github.com/users/ligi/orgs",
      "repos_url": "https://api.github.com/users/ligi/repos",
      "events_url": "https://api.github.com/users/ligi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ligi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-20T13:38:46Z",
    "updated_at": "2018-05-20T13:38:46Z",
    "author_association": "MEMBER",
    "body": "I think you are mixing up a lot of things here - e.g. using \"Ethereum Signed Message:\" should not be used for transactions. Also I am not really sure what exactly you want to do. E.g. why you are doing EIP155 signing by hand. Please let us know what exactly is your goal",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/390483941/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/390522570",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16761#issuecomment-390522570",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16761",
    "id": 390522570,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MDUyMjU3MA==",
    "user": {
      "login": "qq940043871",
      "id": 3883919,
      "node_id": "MDQ6VXNlcjM4ODM5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3883919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/qq940043871",
      "html_url": "https://github.com/qq940043871",
      "followers_url": "https://api.github.com/users/qq940043871/followers",
      "following_url": "https://api.github.com/users/qq940043871/following{/other_user}",
      "gists_url": "https://api.github.com/users/qq940043871/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/qq940043871/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/qq940043871/subscriptions",
      "organizations_url": "https://api.github.com/users/qq940043871/orgs",
      "repos_url": "https://api.github.com/users/qq940043871/repos",
      "events_url": "https://api.github.com/users/qq940043871/events{/privacy}",
      "received_events_url": "https://api.github.com/users/qq940043871/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-20T23:55:54Z",
    "updated_at": "2018-05-20T23:55:54Z",
    "author_association": "NONE",
    "body": "**I want to create a transaction, then sign it, and finally broadcast it.** \r\nI want the cold and the hot wallet to separate, the cold wallet to keep the private key and signature, the hot wallet to create the transaction and the broadcast transaction.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/390522570/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/390602498",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/16761#issuecomment-390602498",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/16761",
    "id": 390602498,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5MDYwMjQ5OA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-05-21T09:27:30Z",
    "updated_at": "2018-05-21T09:27:30Z",
    "author_association": "MEMBER",
    "body": "There are separate methods for signing  arbitrary data `eth_sign` and signing a transactions `eth_signTransaction`. Signing arbitrary data can be dangerous, hence why it dumps that junk in front. If you want to sign transactions, please use the correct API calls.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/390602498/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
