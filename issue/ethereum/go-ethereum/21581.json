{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21581",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21581/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21581/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21581/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/21581",
  "id": 704329792,
  "node_id": "MDU6SXNzdWU3MDQzMjk3OTI=",
  "number": 21581,
  "title": "Transaction dropped and replaced after geth restart with different transfer from pending list",
  "user": {
    "login": "bogdangainusa",
    "id": 13803843,
    "node_id": "MDQ6VXNlcjEzODAzODQz",
    "avatar_url": "https://avatars.githubusercontent.com/u/13803843?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bogdangainusa",
    "html_url": "https://github.com/bogdangainusa",
    "followers_url": "https://api.github.com/users/bogdangainusa/followers",
    "following_url": "https://api.github.com/users/bogdangainusa/following{/other_user}",
    "gists_url": "https://api.github.com/users/bogdangainusa/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bogdangainusa/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bogdangainusa/subscriptions",
    "organizations_url": "https://api.github.com/users/bogdangainusa/orgs",
    "repos_url": "https://api.github.com/users/bogdangainusa/repos",
    "events_url": "https://api.github.com/users/bogdangainusa/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bogdangainusa/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1132689577,
      "node_id": "MDU6TGFiZWwxMTMyNjg5NTc3",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:triage",
      "name": "status:triage",
      "color": "6be514",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2020-09-18T12:11:08Z",
  "updated_at": "2020-10-09T08:19:09Z",
  "closed_at": "2020-10-09T08:19:09Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\nGeth version: instance: Geth/v1.9.15-stable-0f77f34b/linux-amd64/go1.14.4\r\nOS & Version:  Debian GNU/Linux 9\r\n\r\n#### Expected behaviour\r\nAfter geth restart previous pending transfers should be  processed into network and not replace transfer nonce with another transfer which had higher nonce and it was still in pending state. \r\nFirst transfer should've been sent to network with nonce 1075 which was his original value, second transfer nonce shouldn't be replaced with the nonce of first transfer\r\n\r\n\r\n#### Actual behaviour\r\ngeth was keeping transfers in pending state and won't sent them out until we restart geth (txid was invalid in block explorer) \r\neth.pendingTransactions - got some transfers in pending state because gasPrice used was below network average price. \r\nGeth keeping this transfers in pending state even when network average was more below than our transfers gas price.\r\nRestarted geth and after this restart transfers were processed but for some of them geth updated wrong the nonce and somehow initial transfer **was replaced with another transfer with different receiver and amount** \r\nHere is initial transfer which was in pending state before geth restart: (nonce was 1075)\r\nhttps://etherscan.io/tx/0x37bc32d205bd29a855ab832ba7bfd629e3cce738bfdd6c9e35fa43b960271bff\r\n\r\nAfter geth restart transfer was automatically replaced with another transaction which had different nonce before geth restart:\r\nhttps://etherscan.io/tx/0xa53fe0ef5838676d2b50285cd0e71c32230fac73b2a3ca7c094093109f647e1d\r\n\r\nHere is  output from pendingTransactions list with initial transfer nonce and  data: \r\n\r\n    blockHash: null,\r\n    blockNumber: null,\r\n    from: \"0x7f80c92ec851109aa0fbd10012ce43a0ece057ee\",\r\n    gas: 21000,\r\n    gasPrice: 405000000000,\r\n    hash: \"0x37bc32d205bd29a855ab832ba7bfd629e3cce738bfdd6c9e35fa43b960271bff\",\r\n    input: \"0x\",\r\n    nonce: 1075,\r\n    r: \"0x897004c16ec6007548a4bb04b47a2be52adbc81969c175664c4f7862a46c898d\",\r\n    s: \"0x33a6d90944f960d3b6fa941c5fb045822744a7c02a6166aabea38a51edd8eb6d\",\r\n    to: \"0x5d778a67c7377ec96c7cadb77d80e3b6233994ad\",\r\n    transactionIndex: null,\r\n    v: \"0x25\",\r\n    value: 12586690830000000000\r\n\r\n\r\n#### Steps to reproduce the behaviour\r\nTried to replicate on test env same behaviour but without success.\r\n\r\nPlease let me know what else is needed in order to figure out this issue. We have multiple transfers dropped and replaced with huge values and funds seems are not anymore on any of addresses (neither on sender/receiver for initial transfer and replaced transfer). \r\n",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21581/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21581/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/701980561",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21581#issuecomment-701980561",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21581",
    "id": 701980561,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMTk4MDU2MQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-01T08:33:10Z",
    "updated_at": "2020-10-01T08:33:10Z",
    "author_association": "MEMBER",
    "body": "More info: https://info.etherscan.com/transaction-dropped-replaced/ \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/701980561/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/701981037",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21581#issuecomment-701981037",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21581",
    "id": 701981037,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMTk4MTAzNw==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-01T08:33:59Z",
    "updated_at": "2020-10-01T08:34:09Z",
    "author_association": "MEMBER",
    "body": "The first tx had `405Gwei` gasPrice, and the second had `420Gwei`. https://etherscan.io/tx/0xa53fe0ef5838676d2b50285cd0e71c32230fac73b2a3ca7c094093109f647e1d",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/701981037/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/701982364",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21581#issuecomment-701982364",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21581",
    "id": 701982364,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMTk4MjM2NA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-01T08:36:24Z",
    "updated_at": "2020-10-01T08:36:24Z",
    "author_association": "MEMBER",
    "body": "If the original transaction appears on etherscan, it means it was correctly pushed out into the network. If it wasn't mined, it was probably underpriced compared to others in the network. Geth does not auto resend or replace any transactions, so you or some wallet you are using sent it a new one with the same nonce.\r\n\r\nAre you using some script to automatically sign and submit transactions?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/701982364/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/701983646",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21581#issuecomment-701983646",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21581",
    "id": 701983646,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMTk4MzY0Ng==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-01T08:38:45Z",
    "updated_at": "2020-10-01T08:39:49Z",
    "author_association": "MEMBER",
    "body": "There might be an issue with geth here, but we need to know more about how you are using the API to pinpoint exactly what the problem is. Does your application use `eth_sendTransaction` or `eth_sendRawTransaction`?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/701983646/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/701988152",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21581#issuecomment-701988152",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21581",
    "id": 701988152,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMTk4ODE1Mg==",
    "user": {
      "login": "bogdangainusa",
      "id": 13803843,
      "node_id": "MDQ6VXNlcjEzODAzODQz",
      "avatar_url": "https://avatars.githubusercontent.com/u/13803843?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bogdangainusa",
      "html_url": "https://github.com/bogdangainusa",
      "followers_url": "https://api.github.com/users/bogdangainusa/followers",
      "following_url": "https://api.github.com/users/bogdangainusa/following{/other_user}",
      "gists_url": "https://api.github.com/users/bogdangainusa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bogdangainusa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bogdangainusa/subscriptions",
      "organizations_url": "https://api.github.com/users/bogdangainusa/orgs",
      "repos_url": "https://api.github.com/users/bogdangainusa/repos",
      "events_url": "https://api.github.com/users/bogdangainusa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bogdangainusa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-01T08:47:25Z",
    "updated_at": "2020-10-01T08:47:25Z",
    "author_association": "NONE",
    "body": "@fjl I am using **eth_sendTransaction** \r\nThis geth problem seems to be also confirmed by other users and there are no certain steps to replicate it.\r\n\r\nIf we're looing into txpool/pending transactions list is empty but after geth restart there are a lot of transfers in pending state. It seems geth is not processing transfers as expected and only after restart transfers and nonce is applied correct. \r\n\r\nPlease notice that we're using same code to send transfers out using geth on multiple environments(~ 15 -20) for 3-4 years and only on one server we got this geth issue and it looks only geth restart is fixing temporary. After some time geth won't show anything in pending list/txpool and transfer nonce number for previous transfers are applied properly. \r\n\r\nhttps://github.com/ethereum/go-ethereum/issues/21385\r\nhttps://github.com/ethereum/go-ethereum/issues/21459",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/701988152/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/705433948",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21581#issuecomment-705433948",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21581",
    "id": 705433948,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTQzMzk0OA==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-08T09:02:01Z",
    "updated_at": "2020-10-08T09:02:01Z",
    "author_association": "MEMBER",
    "body": "We've seen it rarely on a few nodes that the txpool got full of non-executable transactions and for some reason didn't manage to build up the executable (pending) list correctly. That might explain this issue. We'll look into it, just not sure how to repro reliably.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/705433948/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/706042483",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/21581#issuecomment-706042483",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/21581",
    "id": 706042483,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNjA0MjQ4Mw==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-09T08:19:09Z",
    "updated_at": "2020-10-09T08:19:09Z",
    "author_association": "MEMBER",
    "body": "Ah, so this was fixed in Geth v1.9.16 https://github.com/ethereum/go-ethereum/pull/21255",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/706042483/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
