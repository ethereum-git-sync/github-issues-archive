{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22131",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22131/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22131/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22131/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/22131",
  "id": 780995062,
  "node_id": "MDU6SXNzdWU3ODA5OTUwNjI=",
  "number": 22131,
  "title": "A potential dead lock of client which result in block syncing halt",
  "user": {
    "login": "guagualvcha",
    "id": 7310198,
    "node_id": "MDQ6VXNlcjczMTAxOTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7310198?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/guagualvcha",
    "html_url": "https://github.com/guagualvcha",
    "followers_url": "https://api.github.com/users/guagualvcha/followers",
    "following_url": "https://api.github.com/users/guagualvcha/following{/other_user}",
    "gists_url": "https://api.github.com/users/guagualvcha/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/guagualvcha/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/guagualvcha/subscriptions",
    "organizations_url": "https://api.github.com/users/guagualvcha/orgs",
    "repos_url": "https://api.github.com/users/guagualvcha/repos",
    "events_url": "https://api.github.com/users/guagualvcha/events{/privacy}",
    "received_events_url": "https://api.github.com/users/guagualvcha/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "s1na",
    "id": 1591639,
    "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/s1na",
    "html_url": "https://github.com/s1na",
    "followers_url": "https://api.github.com/users/s1na/followers",
    "following_url": "https://api.github.com/users/s1na/following{/other_user}",
    "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
    "organizations_url": "https://api.github.com/users/s1na/orgs",
    "repos_url": "https://api.github.com/users/s1na/repos",
    "events_url": "https://api.github.com/users/s1na/events{/privacy}",
    "received_events_url": "https://api.github.com/users/s1na/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2021-01-07T03:19:23Z",
  "updated_at": "2021-01-21T11:17:22Z",
  "closed_at": "2021-01-21T11:17:22Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: 1.9.13\r\nOS & Version: Linux\r\n\r\n#### Expected behaviour\r\nClient sync block normal\r\n\r\n#### Actual behaviour\r\nClient failed to sync block.\r\n\r\n#### Steps to reproduce the behaviour\r\nFirst change the code to make it easier to reproduce:\r\n```\r\nfunc (sub *Subscription) Unsubscribe() {\r\n\tsub.unsubOnce.Do(func() {\r\n\tuninstallLoop:\r\n\t\tfor {\r\n\t\t\tselect {\r\n\t\t\tcase sub.es.uninstall <- sub.f:\r\n                                // newly added line\r\n\t\t\t\ttime.Sleep(3 * time.Second)\r\n\t\t\t\tbreak uninstallLoop\r\n                        case ...\r\n\t\t\t}\r\n\t\t}\r\n\t\t<-sub.Err()\r\n\t})\r\n}\r\n```\r\n\r\nDo request for multi times:\r\n```\r\ncurl -X POST --data '{\"jsonrpc\":\"2.0\",\"method\":\"eth_newPendingTransactionFilter\",\"params\":[],\"id\":73}'\r\n```\r\n\r\n#### Backtrace\r\nHere is the pprof of go routine:\r\n[goroutine.txt](https://github.com/binance-chain/bsc/files/5752962/goroutine.txt)\r\n\r\n1.  The lock here is not released:\r\n![image](https://user-images.githubusercontent.com/7310198/103176273-5bb30b00-48ab-11eb-9608-119b0f5260d8.png)\r\n\r\nAccording to the pprof, the code is blocked on   `/server/bsc/event/feed.go:170`.\r\n```\r\n1 @ 0x447b10 0x4573db 0x457eda 0x4b5630 0x6e90a4 0xcf0a5f 0xcf3800 0xcf2544 0xf68a60 0xf3aba5 0x475d61\r\n#       0x457ed9        reflect.rselect+0x389                                                           /usr/lib/golang/src/runtime/select.go:542\r\n#       0x4b562f        reflect.Select+0x16f                                                            /usr/lib/golang/src/reflect/value.go:2229\r\n#       0x6e90a3        github.com/ethereum/go-ethereum/event.(*Feed).Send+0x593                        /server/bsc/event/feed.go:170\r\n#       0xcf0a5e        github.com/ethereum/go-ethereum/core.(*BlockChain).writeBlockWithState+0xe2e    /server/bsc/core/blockchain.go:1470\r\n#       0xcf37ff        github.com/ethereum/go-ethereum/core.(*BlockChain).insertChain+0x118f           /server/bsc/core/blockchain.go:1757\r\n```\r\n2. The subscription may consume the channel so that block above `select`.\r\nAs we checked, new `NewPendingTransactionFilter` calls are pending on fetching `filtersMu`  lock.\r\n\r\n```\r\n#\t0x4580a6\tsync.runtime_SemacquireMutex+0x46\t\t\t\t\t\t\t\t\t/usr/lib/golang/src/runtime/sema.go:71\r\n#\t0x49408b\tsync.(*Mutex).lockSlow+0xfb\t\t\t\t\t\t\t\t\t\t/usr/lib/golang/src/sync/mutex.go:138\r\n#\t0xf13256\tsync.(*Mutex).Lock+0x296\t\t\t\t\t\t\t\t\t\t/usr/lib/golang/src/sync/mutex.go:81\r\n#\t0xf130e1\tgithub.com/ethereum/go-ethereum/eth/filters.(*PublicFilterAPI).NewPendingTransactionFilter.func1+0x121\t/server/bsc/eth/filters/api.go:119\r\n```\r\n\r\n3. The routine that holds `filtersMu`  lock is `timeoutLoop`:\r\n\r\n```\r\n#\t0xf142b3\tgithub.com/ethereum/go-ethereum/eth/filters.(*Subscription).Unsubscribe.func1+0xf3\t/server/bsc/eth/filters/filter_system.go:164\r\n#\t0x4944d2\tsync.(*Once).doSlow+0xe2\t\t\t\t\t\t\t\t/usr/lib/golang/src/sync/once.go:66\r\n#\t0xf0f704\tsync.(*Once).Do+0x64\t\t\t\t\t\t\t\t\t/usr/lib/golang/src/sync/once.go:57\r\n#\t0xf0f6bd\tgithub.com/ethereum/go-ethereum/eth/filters.(*Subscription).Unsubscribe+0x1d\t\t/server/bsc/eth/filters/filter_system.go:157\r\n#\t0xf09d47\tgithub.com/ethereum/go-ethereum/eth/filters.(*PublicFilterAPI).timeoutLoop+0xf7\t\t/server/bsc/eth/filters/api.go:88\r\n```\r\n\r\nThe code is:\r\n```\r\nfunc (sub *Subscription) Unsubscribe() {\r\n\tsub.unsubOnce.Do(func() {\r\n\tuninstallLoop:\r\n\t\tfor {\r\n\t\t\t// write uninstall request and consume logs/hashes. This prevents\r\n\t\t\t// the eventLoop broadcast method to deadlock when writing to the\r\n\t\t\t// filter event channel while the subscription loop is waiting for\r\n\t\t\t// this method to return (and thus not reading these events).\r\n\t\t\tselect {\r\n\t\t\tcase sub.es.uninstall <- sub.f:\r\n\t\t\t\tbreak uninstallLoop\r\n\t\t\tcase <-sub.f.logs:\r\n\t\t\tcase <-sub.f.hashes:\r\n\t\t\tcase <-sub.f.headers:\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// wait for filter to be uninstalled in work loop before returning\r\n\t\t// this ensures that the manager won't use the event channel which\r\n\t\t// will probably be closed by the client asap after this method returns.\r\n\t\t<-sub.Err()\r\n\t})\r\n}\r\n```\r\n\r\nObvious it failed to do `sub.es.uninstall <- sub.f`.\r\n\r\n4. `eventLoop` is responsible for consuming the `sub.es.uninstall` channel.\r\nThe routine is busy doing `handleTxsEvent`:\r\n\r\n```\r\n#\t0xf1128b\tgithub.com/ethereum/go-ethereum/eth/filters.(*EventSystem).handleTxsEvent+0x20b\t/server/bsc/eth/filters/filter_system.go:350\r\n#\t0xf12f90\tgithub.com/ethereum/go-ethereum/eth/filters.(*EventSystem).eventLoop+0xa60\t/server/bsc/eth/filters/filter_system.go:461\r\n```\r\nIt will push  `hashes` to `f.hashes` channel, and now it is blocking by that channel.\r\n```\r\nfunc (es *EventSystem) handleTxsEvent(filters filterIndex, ev core.NewTxsEvent) {\r\n\thashes := make([]common.Hash, 0, len(ev.Txs))\r\n\tfor _, tx := range ev.Txs {\r\n\t\thashes = append(hashes, tx.Hash())\r\n\t}\r\n\tfor _, f := range filters[PendingTransactionsSubscription] {\r\n\t\tf.hashes <- hashes\r\n\t}\r\n}\r\n```\r\n\r\n5. What happened to `f.hashes`  channel?\r\nThat is because, in the above step 3, the `Unsubscribe` may not consume all the `hashes` and break out so that step4 stucked. \r\n\r\nThe deadlock dependency is:\r\n\r\nRoutine A:`NewPendingTransactionFilter` want to lock `filtersMu` to consume `hashes`;\r\nRoutine B: `eventLoop` is waiting Routine A to consume `hashes` so that it can push new hash to channel.\r\nRoutine C: `Unsubscribe` is holding lock  `filtersMu`, but it is waiting for Routine B to consume `uninstall` channel. \r\n\r\n",
  "closed_by": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22131/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22131/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/755929969",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22131#issuecomment-755929969",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22131",
    "id": 755929969,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NTkyOTk2OQ==",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-07T07:05:46Z",
    "updated_at": "2021-01-07T07:05:46Z",
    "author_association": "MEMBER",
    "body": "> That is because, in the above step 3, the Unsubscribe may not consume all the hashes and break out so that step4 stucked.\r\n\r\nI still don't get it, if the subscription is uninstalled sucessfully, no more following events will be sent to this filter.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/755929969/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/755931486",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22131#issuecomment-755931486",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22131",
    "id": 755931486,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NTkzMTQ4Ng==",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-07T07:09:33Z",
    "updated_at": "2021-01-07T07:09:33Z",
    "author_association": "MEMBER",
    "body": "And regarding the deadlock. Before uninstall request get processed, all the queued events can be processed by the Unsubscribe function too, so I don't think the eventLoop will be blocked.\r\n\r\nMaybe I miss something here?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/755931486/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/755957697",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22131#issuecomment-755957697",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22131",
    "id": 755957697,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NTk1NzY5Nw==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-07T08:10:32Z",
    "updated_at": "2021-01-07T08:10:32Z",
    "author_association": "MEMBER",
    "body": "@guagualvcha did you also send this as a bounty? I tried the repro earlier, and was never able to repro it. I'll give it another go later",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/755957697/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/756013795",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22131#issuecomment-756013795",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22131",
    "id": 756013795,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NjAxMzc5NQ==",
    "user": {
      "login": "ligi",
      "id": 111600,
      "node_id": "MDQ6VXNlcjExMTYwMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/111600?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ligi",
      "html_url": "https://github.com/ligi",
      "followers_url": "https://api.github.com/users/ligi/followers",
      "following_url": "https://api.github.com/users/ligi/following{/other_user}",
      "gists_url": "https://api.github.com/users/ligi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ligi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ligi/subscriptions",
      "organizations_url": "https://api.github.com/users/ligi/orgs",
      "repos_url": "https://api.github.com/users/ligi/repos",
      "events_url": "https://api.github.com/users/ligi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ligi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-07T09:59:09Z",
    "updated_at": "2021-01-07T09:59:09Z",
    "author_association": "MEMBER",
    "body": "@s1na will try to reproduce the issue",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/756013795/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/756159470",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22131#issuecomment-756159470",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22131",
    "id": 756159470,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NjE1OTQ3MA==",
    "user": {
      "login": "guagualvcha",
      "id": 7310198,
      "node_id": "MDQ6VXNlcjczMTAxOTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7310198?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/guagualvcha",
      "html_url": "https://github.com/guagualvcha",
      "followers_url": "https://api.github.com/users/guagualvcha/followers",
      "following_url": "https://api.github.com/users/guagualvcha/following{/other_user}",
      "gists_url": "https://api.github.com/users/guagualvcha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/guagualvcha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/guagualvcha/subscriptions",
      "organizations_url": "https://api.github.com/users/guagualvcha/orgs",
      "repos_url": "https://api.github.com/users/guagualvcha/repos",
      "events_url": "https://api.github.com/users/guagualvcha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/guagualvcha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-07T14:44:58Z",
    "updated_at": "2021-01-07T14:46:08Z",
    "author_association": "NONE",
    "body": "Hi, teams. Thanks for all the timely responses.  @s1na @holiman To easily reproduce the issue,  you will need 1. the block chain should have some new transactions, empty block can not reproduce the issue. 2. change the code a bit, in the above case, I did sleep 3 seconds when `break uninstallLoop`,  you can increase the sleeping time to 15 seconds or longer.  \r\nAfter that, you can reproduce this issue stably.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/756159470/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/760291572",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22131#issuecomment-760291572",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22131",
    "id": 760291572,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MDI5MTU3Mg==",
    "user": {
      "login": "s1na",
      "id": 1591639,
      "node_id": "MDQ6VXNlcjE1OTE2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1591639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s1na",
      "html_url": "https://github.com/s1na",
      "followers_url": "https://api.github.com/users/s1na/followers",
      "following_url": "https://api.github.com/users/s1na/following{/other_user}",
      "gists_url": "https://api.github.com/users/s1na/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s1na/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s1na/subscriptions",
      "organizations_url": "https://api.github.com/users/s1na/orgs",
      "repos_url": "https://api.github.com/users/s1na/repos",
      "events_url": "https://api.github.com/users/s1na/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s1na/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-14T16:02:34Z",
    "updated_at": "2021-01-14T16:02:34Z",
    "author_association": "MEMBER",
    "body": "I could reproduce the issue (thanks for the pointers).\r\n\r\n> I still don't get it, if the subscription is uninstalled sucessfully, no more following events will be sent to this filter.\r\n> And regarding the deadlock. Before uninstall request get processed, all the queued events can be processed by the Unsubscribe function too, so I don't think the eventLoop will be blocked.\r\n\r\n@rjl493456442 I think the problem is when there are multiple filters. Filter `A` times out, locks `filtersMu` and goes to `Unsubscribe`. At the same time a new txhash arrives. Now broadcasting the hash to filter `A` should work (because `Unsubscribe` would consume it), but broadcasting it to any other active filter would block because it can't acquire `filtersMu`.\r\n\r\nI'm now going to think about a fix.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/760291572/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/760774260",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/22131#issuecomment-760774260",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/22131",
    "id": 760774260,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MDc3NDI2MA==",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-15T09:18:56Z",
    "updated_at": "2021-01-15T09:19:05Z",
    "author_association": "MEMBER",
    "body": "Yeah, I get it. Multiple filters explain the reason!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/760774260/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
