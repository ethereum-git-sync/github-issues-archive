{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15379",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15379/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15379/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15379/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/15379",
  "id": 268631838,
  "node_id": "MDU6SXNzdWUyNjg2MzE4Mzg=",
  "number": 15379,
  "title": "geth crashes with SIGBUS in ethash.(*cache).generate.func1() during fast-sync",
  "user": {
    "login": "cwajh",
    "id": 8681666,
    "node_id": "MDQ6VXNlcjg2ODE2NjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8681666?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cwajh",
    "html_url": "https://github.com/cwajh",
    "followers_url": "https://api.github.com/users/cwajh/followers",
    "following_url": "https://api.github.com/users/cwajh/following{/other_user}",
    "gists_url": "https://api.github.com/users/cwajh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cwajh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cwajh/subscriptions",
    "organizations_url": "https://api.github.com/users/cwajh/orgs",
    "repos_url": "https://api.github.com/users/cwajh/repos",
    "events_url": "https://api.github.com/users/cwajh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cwajh/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2017-10-26T05:12:17Z",
  "updated_at": "2018-11-20T09:28:05Z",
  "closed_at": "2018-11-20T09:27:49Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "This has happened to me twice. I completely cleared the DB and started over, only to encounter it again.\r\n\r\nI suspect the bug is in block header validation somehow. When I run geth in a loop, I see \"most recent local fast block\" slowly advance, but \"most recent local header\" seems stuck at 3521652.\r\n\r\n#### System information\r\n\r\nGeth version: `1.7.2-stable`\r\nOS & Version: Linux\r\nCommit hash : 1db4ecdc0b9e828ff65777fb466fc7c1d04e0de9\r\n\r\n#### Expected behaviour\r\n\r\ngeth should correctly handle received block info during sync, or at least not crash.\r\n\r\n#### Actual behaviour\r\n\r\ngeth dies to a bus error.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n1. Unpack the \"Ethereum Wallet\" package.\r\n2. Run geth with fastsync params (`./geth --syncmode \"fast\" --cache 1024 console`)\r\n3. Restart it from time to time if it gets stuck finding peers.\r\n4. Wait.\r\n\r\n#### Backtrace\r\n\r\n````\r\ngoroutine 1844 [running]:\r\nruntime.throw(0xf26f26, 0x5)\r\n        /home/travis/.gimme/versions/go1.9.linux.amd64/src/runtime/panic.go:605 +0x95 fp=0xc4238b4bb0 sp=0xc4238b4b90 pc=0x431f75\r\nruntime.sigpanic()\r\n        /home/travis/.gimme/versions/go1.9.linux.amd64/src/runtime/signal_unix.go:364 +0x29d fp=0xc4238b4c00 sp=0xc4238b4bb0 pc=0x44902d\r\ngithub.com/ethereum/go-ethereum/consensus/ethash.memoryMap(0xc42b1b4d40, 0x3e, 0x2, 0x182e6a0, 0xc42b28b280, 0xc42b5ae440, 0x1a, 0xc428e34d80, 0x199, 0xfdcb18, ...)\r\n        /home/travis/gopath/src/github.com/ethereum/go-ethereum/consensus/ethash/ethash.go:76 +0xf8 fp=0xc4238b4c90 sp=0xc4238b4c00 pc=0x882658\r\ngithub.com/ethereum/go-ethereum/consensus/ethash.(*cache).generate.func1()\r\n        /home/travis/gopath/src/github.com/ethereum/go-ethereum/consensus/ethash/ethash.go:186 +0x4a8 fp=0xc4238b4f30 sp=0xc4238b4c90 pc=0x8881c8\r\nsync.(*Once).Do(0xc42a1843d8, 0xc421335f78)\r\n        /home/travis/.gimme/versions/go1.9.linux.amd64/src/sync/once.go:44 +0xbe fp=0xc4238b4f68 sp=0xc4238b4f30 pc=0x47aa5e\r\ngithub.com/ethereum/go-ethereum/consensus/ethash.(*cache).generate(0xc42a184380, 0xc420360810, 0x23, 0x3, 0xc42abd2d00)\r\n        /home/travis/gopath/src/github.com/ethereum/go-ethereum/consensus/ethash/ethash.go:160 +0x96 fp=0xc4238b4fb8 sp=0xc4238b4f68 pc=0x8831f6\r\nruntime.goexit()\r\n        /home/travis/.gimme/versions/go1.9.linux.amd64/src/runtime/asm_amd64.s:2337 +0x1 fp=0xc4238b4fc0 sp=0xc4238b4fb8 pc=0x4634e1\r\ncreated by github.com/ethereum/go-ethereum/consensus/ethash.(*Ethash).cache\r\n        /home/travis/gopath/src/github.com/ethereum/go-ethereum/consensus/ethash/ethash.go:484 +0x6fc\r\n````\r\n\r\nFull log of the sync attempt can be inspected [here](http://www.rodl16.com/_tmp_sync.log)",
  "closed_by": {
    "login": "fjl",
    "id": 6915,
    "node_id": "MDQ6VXNlcjY5MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fjl",
    "html_url": "https://github.com/fjl",
    "followers_url": "https://api.github.com/users/fjl/followers",
    "following_url": "https://api.github.com/users/fjl/following{/other_user}",
    "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
    "organizations_url": "https://api.github.com/users/fjl/orgs",
    "repos_url": "https://api.github.com/users/fjl/repos",
    "events_url": "https://api.github.com/users/fjl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fjl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15379/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15379/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/339555445",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15379#issuecomment-339555445",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15379",
    "id": 339555445,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzOTU1NTQ0NQ==",
    "user": {
      "login": "cwajh",
      "id": 8681666,
      "node_id": "MDQ6VXNlcjg2ODE2NjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8681666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cwajh",
      "html_url": "https://github.com/cwajh",
      "followers_url": "https://api.github.com/users/cwajh/followers",
      "following_url": "https://api.github.com/users/cwajh/following{/other_user}",
      "gists_url": "https://api.github.com/users/cwajh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cwajh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cwajh/subscriptions",
      "organizations_url": "https://api.github.com/users/cwajh/orgs",
      "repos_url": "https://api.github.com/users/cwajh/repos",
      "events_url": "https://api.github.com/users/cwajh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cwajh/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-26T05:28:02Z",
    "updated_at": "2017-10-26T05:28:02Z",
    "author_association": "NONE",
    "body": "...I'm using a kind of unusual FUSE filesystem. It occurs to me that memoryMapFile might be failing somehow because of that. I'm gonna double check that.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/339555445/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/339557093",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15379#issuecomment-339557093",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15379",
    "id": 339557093,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzOTU1NzA5Mw==",
    "user": {
      "login": "cwajh",
      "id": 8681666,
      "node_id": "MDQ6VXNlcjg2ODE2NjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8681666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cwajh",
      "html_url": "https://github.com/cwajh",
      "followers_url": "https://api.github.com/users/cwajh/followers",
      "following_url": "https://api.github.com/users/cwajh/following{/other_user}",
      "gists_url": "https://api.github.com/users/cwajh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cwajh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cwajh/subscriptions",
      "organizations_url": "https://api.github.com/users/cwajh/orgs",
      "repos_url": "https://api.github.com/users/cwajh/repos",
      "events_url": "https://api.github.com/users/cwajh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cwajh/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-26T05:38:46Z",
    "updated_at": "2017-10-26T05:38:46Z",
    "author_association": "NONE",
    "body": "Okay, I can definitely mmap files on this FS in general.\r\n\r\n```\r\nPython 2.7.10 (default, Feb 15 2016, 15:13:16) \r\n[GCC 4.7.3] on linux2\r\nType \"help\", \"copyright\", \"credits\" or \"license\" for more information.\r\n>>> import mmap\r\n>>> qq = open('_tmp.lst','rb')\r\n>>> q = mmap.mmap(qq.fileno(),0,mmap.MAP_SHARED,mmap.PROT_READ)\r\n>>> q[2:4]\r\n'23'\r\n```\r\n\r\nLooking back in the log, the original trigger seems to be a crash with this error message:\r\n\r\n```\r\nCRIT [10-25|10:16:44] Failed to store header                   err=\"open /home/garnett/.ethereum/geth/chaindata/018669.ldb: too many open files\"\r\n```\r\n\r\nI'm guessing this leaves the cache file in an inconsistent state, thus dooming subsequent launches.\r\n\r\nI'll try to work around and report back.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/339557093/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/339558949",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15379#issuecomment-339558949",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15379",
    "id": 339558949,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzOTU1ODk0OQ==",
    "user": {
      "login": "cwajh",
      "id": 8681666,
      "node_id": "MDQ6VXNlcjg2ODE2NjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8681666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cwajh",
      "html_url": "https://github.com/cwajh",
      "followers_url": "https://api.github.com/users/cwajh/followers",
      "following_url": "https://api.github.com/users/cwajh/following{/other_user}",
      "gists_url": "https://api.github.com/users/cwajh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cwajh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cwajh/subscriptions",
      "organizations_url": "https://api.github.com/users/cwajh/orgs",
      "repos_url": "https://api.github.com/users/cwajh/repos",
      "events_url": "https://api.github.com/users/cwajh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cwajh/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-26T05:52:02Z",
    "updated_at": "2017-10-26T05:52:02Z",
    "author_association": "NONE",
    "body": "Removed most recent cache file and seem to be making progress again.\r\n\r\nI don't know Go, so I'm not sure I should be the one to write a patch. But shouldn't this be prevented by a check in [the cache mmap code](https://github.com/ethereum/go-ethereum/blob/0095531a58772b1f5bd1547169790dbde84ec78a/consensus/ethash/ethash.go#L75) that the file is big enough?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/339558949/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/339599466",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15379#issuecomment-339599466",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15379",
    "id": 339599466,
    "node_id": "MDEyOklzc3VlQ29tbWVudDMzOTU5OTQ2Ng==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2017-10-26T08:59:01Z",
    "updated_at": "2017-10-26T08:59:01Z",
    "author_association": "MEMBER",
    "body": "Oh, sweet, I've seen this error a few times but never could figure out where it originates from. I'm still unsure if the crash is due to the file size or not, but that buffer there should definitely be checked to make sure it's large enough! ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/339599466/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/433605595",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15379#issuecomment-433605595",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15379",
    "id": 433605595,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQzMzYwNTU5NQ==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2018-10-27T09:30:08Z",
    "updated_at": "2018-10-27T09:30:08Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/433605595/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/440203405",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/15379#issuecomment-440203405",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/15379",
    "id": 440203405,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0MDIwMzQwNQ==",
    "user": {
      "login": "fjl",
      "id": 6915,
      "node_id": "MDQ6VXNlcjY5MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6915?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fjl",
      "html_url": "https://github.com/fjl",
      "followers_url": "https://api.github.com/users/fjl/followers",
      "following_url": "https://api.github.com/users/fjl/following{/other_user}",
      "gists_url": "https://api.github.com/users/fjl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fjl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fjl/subscriptions",
      "organizations_url": "https://api.github.com/users/fjl/orgs",
      "repos_url": "https://api.github.com/users/fjl/repos",
      "events_url": "https://api.github.com/users/fjl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fjl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-11-20T09:27:49Z",
    "updated_at": "2018-11-20T09:27:49Z",
    "author_association": "MEMBER",
    "body": "Fixed in #15864",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/440203405/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
