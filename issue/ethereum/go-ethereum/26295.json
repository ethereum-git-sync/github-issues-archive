{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26295",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26295/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26295/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26295/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/26295",
  "id": 1474166828,
  "node_id": "I_kwDOAOvK985X3gAs",
  "number": 26295,
  "title": "State healing never finishes",
  "user": {
    "login": "jannikluhn",
    "id": 29854669,
    "node_id": "MDQ6VXNlcjI5ODU0NjY5",
    "avatar_url": "https://avatars.githubusercontent.com/u/29854669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jannikluhn",
    "html_url": "https://github.com/jannikluhn",
    "followers_url": "https://api.github.com/users/jannikluhn/followers",
    "following_url": "https://api.github.com/users/jannikluhn/following{/other_user}",
    "gists_url": "https://api.github.com/users/jannikluhn/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jannikluhn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jannikluhn/subscriptions",
    "organizations_url": "https://api.github.com/users/jannikluhn/orgs",
    "repos_url": "https://api.github.com/users/jannikluhn/repos",
    "events_url": "https://api.github.com/users/jannikluhn/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jannikluhn/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2022-12-03T17:39:21Z",
  "updated_at": "2022-12-07T13:02:16Z",
  "closed_at": "2022-12-07T13:02:16Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version:\r\n```\r\nVersion: 1.11.0-unstable\r\nGit Commit: 1b8a392153b39fbbde17536c730d96510e57341f\r\nGit Commit Date: 20221128\r\n```\r\nCL client & version: `Lighthouse v3.2.1-6d5a2b5`\r\nOS & Version: Ubuntu 22.10\r\n\r\nI got the same issue on version `1.10.26`.\r\n\r\n#### Expected behaviour\r\n\r\nThe state healing phase during mainnet sync should finish after some time, according to [this message](https://discord.com/channels/595666850260713488/1014177210560696330/1016594796854382652) on Discord from half a year ago in ~3h.\r\n\r\n#### Actual behaviour\r\n\r\nState healing has been going on for ~36h, regularly logging the following message:\r\n\r\n```\r\nSyncing: state healing in progress       accounts=1,215,001@63.58MiB   slots=6,202,681@449.59MiB   codes=1501@11.21MiB   nodes=19,827,850@4.31GiB   pending=19955\r\n```\r\n\r\nCPU load is at 25%, memory usage at 70% of 8GB. This is a mainnet sync starting from an empty database.",
  "closed_by": {
    "login": "jannikluhn",
    "id": 29854669,
    "node_id": "MDQ6VXNlcjI5ODU0NjY5",
    "avatar_url": "https://avatars.githubusercontent.com/u/29854669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jannikluhn",
    "html_url": "https://github.com/jannikluhn",
    "followers_url": "https://api.github.com/users/jannikluhn/followers",
    "following_url": "https://api.github.com/users/jannikluhn/following{/other_user}",
    "gists_url": "https://api.github.com/users/jannikluhn/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jannikluhn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jannikluhn/subscriptions",
    "organizations_url": "https://api.github.com/users/jannikluhn/orgs",
    "repos_url": "https://api.github.com/users/jannikluhn/repos",
    "events_url": "https://api.github.com/users/jannikluhn/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jannikluhn/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26295/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26295/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1336309935",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26295#issuecomment-1336309935",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26295",
    "id": 1336309935,
    "node_id": "IC_kwDOAOvK985Ppniv",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-04T03:13:24Z",
    "updated_at": "2022-12-04T03:13:24Z",
    "author_association": "NONE",
    "body": "That's not a bug. This may be a lack of IOPS in the storage. Take a look at the storage you have and, if possible, improve IOPS - allocate more if cloud or get a better model if hardware.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1336309935/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1339376674",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26295#issuecomment-1339376674",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26295",
    "id": 1339376674,
    "node_id": "IC_kwDOAOvK985P1UQi",
    "user": {
      "login": "jannikluhn",
      "id": 29854669,
      "node_id": "MDQ6VXNlcjI5ODU0NjY5",
      "avatar_url": "https://avatars.githubusercontent.com/u/29854669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jannikluhn",
      "html_url": "https://github.com/jannikluhn",
      "followers_url": "https://api.github.com/users/jannikluhn/followers",
      "following_url": "https://api.github.com/users/jannikluhn/following{/other_user}",
      "gists_url": "https://api.github.com/users/jannikluhn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jannikluhn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jannikluhn/subscriptions",
      "organizations_url": "https://api.github.com/users/jannikluhn/orgs",
      "repos_url": "https://api.github.com/users/jannikluhn/repos",
      "events_url": "https://api.github.com/users/jannikluhn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jannikluhn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-06T13:19:10Z",
    "updated_at": "2022-12-06T13:19:10Z",
    "author_association": "MEMBER",
    "body": "Thanks @yorickdowne, quite possible that this is the issue. Here's a benchmark on my machine ([using this script](https://github.com/masonr/yet-another-bench-script)):\r\n\r\n```\r\nfio Disk Speed Tests (Mixed R/W 50/50):\r\n---------------------------------\r\nBlock Size | 4k            (IOPS) | 64k           (IOPS)\r\n  ------   | ---            ----  | ----           ----\r\nRead       | 119.54 MB/s  (29.8k) | 463.88 MB/s   (7.2k)\r\nWrite      | 119.85 MB/s  (29.9k) | 466.32 MB/s   (7.2k)\r\nTotal      | 239.40 MB/s  (59.8k) | 930.20 MB/s  (14.5k)\r\n           |                      |\r\nBlock Size | 512k          (IOPS) | 1m            (IOPS)\r\n  ------   | ---            ----  | ----           ----\r\nRead       | 626.45 MB/s   (1.2k) | 645.33 MB/s    (630)\r\nWrite      | 659.74 MB/s   (1.2k) | 688.31 MB/s    (672)\r\nTotal      | 1.28 GB/s     (2.5k) | 1.33 GB/s     (1.3k)\r\n```\r\n\r\nHow many IOPS are typically required?\r\n\r\nIrrespective of the reason, from a user perspective it would be helpful if the state healing would show a time estimate, similar to what is shown during sync. I was also confused by the `slots` metric, which does not seem to correspond to beacon chain slots.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1339376674/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1339409419",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26295#issuecomment-1339409419",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26295",
    "id": 1339409419,
    "node_id": "IC_kwDOAOvK985P1cQL",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-06T13:44:22Z",
    "updated_at": "2022-12-06T13:44:22Z",
    "author_association": "NONE",
    "body": "What's the make/model of that drive?\r\n\r\nAn ETA can't be given because state is a moving target. Geth had an ETA at one point and it was wildly inaccurate, so they removed it.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1339409419/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1339424604",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26295#issuecomment-1339424604",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26295",
    "id": 1339424604,
    "node_id": "IC_kwDOAOvK985P1f9c",
    "user": {
      "login": "jannikluhn",
      "id": 29854669,
      "node_id": "MDQ6VXNlcjI5ODU0NjY5",
      "avatar_url": "https://avatars.githubusercontent.com/u/29854669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jannikluhn",
      "html_url": "https://github.com/jannikluhn",
      "followers_url": "https://api.github.com/users/jannikluhn/followers",
      "following_url": "https://api.github.com/users/jannikluhn/following{/other_user}",
      "gists_url": "https://api.github.com/users/jannikluhn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jannikluhn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jannikluhn/subscriptions",
      "organizations_url": "https://api.github.com/users/jannikluhn/orgs",
      "repos_url": "https://api.github.com/users/jannikluhn/repos",
      "events_url": "https://api.github.com/users/jannikluhn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jannikluhn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-06T13:53:36Z",
    "updated_at": "2022-12-06T13:53:36Z",
    "author_association": "MEMBER",
    "body": "I don't know, it's a VPS (Digital Ocean, shared CPU plan with attached block storage) -- don't worry, I'm not planning to run a validator there 😝. I upgraded now to a \"CPU optimized\" plan with dedicated CPU which supposedly has higher SSD throughput. Benchmark:\r\n\r\n```\r\nfio Disk Speed Tests (Mixed R/W 50/50):\r\n---------------------------------\r\nBlock Size | 4k            (IOPS) | 64k           (IOPS)\r\n  ------   | ---            ----  | ----           ----\r\nRead       | 245.87 MB/s  (61.4k) | 1.47 GB/s    (22.9k)\r\nWrite      | 246.52 MB/s  (61.6k) | 1.47 GB/s    (23.1k)\r\nTotal      | 492.40 MB/s (123.1k) | 2.95 GB/s    (46.1k)\r\n           |                      |\r\nBlock Size | 512k          (IOPS) | 1m            (IOPS)\r\n  ------   | ---            ----  | ----           ----\r\nRead       | 1.57 GB/s     (3.0k) | 1.59 GB/s     (1.5k)\r\nWrite      | 1.65 GB/s     (3.2k) | 1.69 GB/s     (1.6k)\r\nTotal      | 3.22 GB/s     (6.3k) | 3.29 GB/s     (3.2k)\r\n```\r\n\r\nWill report back if state heal succeeds there or not.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1339424604/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1339436096",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26295#issuecomment-1339436096",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26295",
    "id": 1339436096,
    "node_id": "IC_kwDOAOvK985P1ixA",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-06T14:02:49Z",
    "updated_at": "2022-12-06T14:02:49Z",
    "author_association": "NONE",
    "body": "Got it. Yeah a lot of cloud block storage isn't quite fast enough. On AWS the received wisdom is to use gp3 and 16k IOPS, and 10k once state heal is done. That's sustained, 4k, QD1, with a r/w mix. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1339436096/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1340933749",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26295#issuecomment-1340933749",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26295",
    "id": 1340933749,
    "node_id": "IC_kwDOAOvK985P7QZ1",
    "user": {
      "login": "jannikluhn",
      "id": 29854669,
      "node_id": "MDQ6VXNlcjI5ODU0NjY5",
      "avatar_url": "https://avatars.githubusercontent.com/u/29854669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jannikluhn",
      "html_url": "https://github.com/jannikluhn",
      "followers_url": "https://api.github.com/users/jannikluhn/followers",
      "following_url": "https://api.github.com/users/jannikluhn/following{/other_user}",
      "gists_url": "https://api.github.com/users/jannikluhn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jannikluhn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jannikluhn/subscriptions",
      "organizations_url": "https://api.github.com/users/jannikluhn/orgs",
      "repos_url": "https://api.github.com/users/jannikluhn/repos",
      "events_url": "https://api.github.com/users/jannikluhn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jannikluhn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-07T13:02:16Z",
    "updated_at": "2022-12-07T13:02:16Z",
    "author_association": "MEMBER",
    "body": "Sync has succeeded now! Took about 12h since moving to the upgraded system (but it didn't have to start from zero there, so not sure how much it would have taken for a full sync). Still doesn't seem to be very stable since it had to do two catch up syncs since then which took considerable time, but I guess that's just how it is on this machine. Thanks again for your help @yorickdowne !",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1340933749/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
