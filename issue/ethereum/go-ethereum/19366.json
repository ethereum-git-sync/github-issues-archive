{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19366",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19366/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19366/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19366/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/19366",
  "id": 427986267,
  "node_id": "MDU6SXNzdWU0Mjc5ODYyNjc=",
  "number": 19366,
  "title": "Gas fees are not deducted from balance in dev mode",
  "user": {
    "login": "spalladino",
    "id": 429604,
    "node_id": "MDQ6VXNlcjQyOTYwNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/429604?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/spalladino",
    "html_url": "https://github.com/spalladino",
    "followers_url": "https://api.github.com/users/spalladino/followers",
    "following_url": "https://api.github.com/users/spalladino/following{/other_user}",
    "gists_url": "https://api.github.com/users/spalladino/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/spalladino/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/spalladino/subscriptions",
    "organizations_url": "https://api.github.com/users/spalladino/orgs",
    "repos_url": "https://api.github.com/users/spalladino/repos",
    "events_url": "https://api.github.com/users/spalladino/events{/privacy}",
    "received_events_url": "https://api.github.com/users/spalladino/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-04-02T01:53:52Z",
  "updated_at": "2019-04-02T14:20:31Z",
  "closed_at": "2019-04-02T07:35:21Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "When running geth in `--dev` mode, no gas fees are deducted from the sender's account, even after explicitly setting a gas price. Same happens when specifying `--dev.period=1`.\r\n\r\n#### System information\r\n\r\nUbuntu 18.10\r\n\r\n```\r\nVersion: 1.8.23-stable\r\nGit Commit: c942700427557e3ff6de3aaf6b916e2f056c1ec2\r\nArchitecture: amd64\r\nProtocol Versions: [63 62]\r\nNetwork Id: 1\r\nGo Version: go1.10.4\r\nOperating System: linux\r\nGOPATH=\r\nGOROOT=/usr/lib/go-1.10\r\n```\r\n\r\n#### Expected behaviour\r\n\r\nExecuting a transaction should reduce the sender's balance in `gasUsed * gasPrice`.\r\n\r\n#### Actual behaviour\r\n\r\nBalance stays the same.\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\n```js\r\nconst Web3 = require('web3'); // 1.0.0-beta.37\r\nconst BN = require('bignumber.js');\r\n\r\nconst web3 = new Web3('http://127.0.0.1:8545');\r\nconst [account] = await web3.eth.getAccounts();\r\n\r\nconst oldBalance = await web3.eth.getBalance(account);  \r\nconsole.log(`Block is ${await web3.eth.getBlockNumber()}`)\r\nconst receipt = await web3.eth.sendTransaction({ from: account, to: '0xaca94ef8bd5ffee41947b4585a84bda5a3d3da6e', gasPrice: 1e9, value: 0 });\r\nconst tx = await web3.eth.getTransaction(receipt.transactionHash);\r\nconsole.log(`Block is ${await web3.eth.getBlockNumber()}`)\r\nconst newBalance = await web3.eth.getBalance(account);\r\n\r\nconsole.log(`Old balance:  ${oldBalance}`)\r\nconsole.log(`New balance:  ${newBalance}`)\r\nconsole.log(`Balance diff: ${BN(newBalance).minus(oldBalance).toPrecision(20)}`);\r\nconsole.log(`Gas used:     ${receipt.gasUsed}`);\r\nconsole.log(`Gas price:    ${tx.gasPrice}`);\r\n```\r\n\r\n```\r\nBlock is 0\r\nBlock is 1\r\nOld balance:  115792089237316195423570985008687907853269984665640564039457584007913129639927\r\nNew balance:  115792089237316195423570985008687907853269984665640564039457584007913129639927\r\nBalance diff: 0.0000000000000000000\r\nGas used:     21000\r\nGas price:    1000000000\r\n```\r\n\r\n#### Backtrace\r\n\r\n````\r\nINFO [04-01|22:52:06.144] Maximum peer count                       ETH=25 LES=0 total=25\r\nINFO [04-01|22:52:08.127] Using developer account                  address=0xF579813997A2ecFbCcA3A19A92de7a74a46f5A4D\r\nINFO [04-01|22:52:08.129] Starting peer-to-peer node               instance=Geth/v1.8.23-stable-c9427004/linux-amd64/go1.10.4\r\nINFO [04-01|22:52:08.129] Allocated cache and file handles         database=/home/spalladino/Projects/samples/sample-meta-txs/.geth/geth/chaindata cache=512 handles=524288\r\nINFO [04-01|22:52:08.158] Writing custom genesis block \r\nINFO [04-01|22:52:08.159] Persisted trie from memory database      nodes=11 size=1.71kB time=135.968Âµs gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=0.00B\r\nINFO [04-01|22:52:08.159] Initialised chain configuration          config=\"{ChainID: 1337 Homestead: 0 DAO: <nil> DAOSupport: false EIP150: 0 EIP155: 0 EIP158: 0 Byzantium: 0 Constantinople: 0  ConstantinopleFix: 0 Engine: clique}\"\r\nINFO [04-01|22:52:08.160] Initialising Ethereum protocol           versions=\"[63 62]\" network=1337\r\nINFO [04-01|22:52:08.177] Loaded most recent local header          number=0 hash=d752c9â€¦099517 td=1 age=49y11mo2w\r\nINFO [04-01|22:52:08.178] Loaded most recent local full block      number=0 hash=d752c9â€¦099517 td=1 age=49y11mo2w\r\nINFO [04-01|22:52:08.178] Loaded most recent local fast block      number=0 hash=d752c9â€¦099517 td=1 age=49y11mo2w\r\nINFO [04-01|22:52:08.178] Regenerated local transaction journal    transactions=0 accounts=0\r\nINFO [04-01|22:52:08.178] Stored checkpoint snapshot to disk       number=0 hash=d752c9â€¦099517\r\nINFO [04-01|22:52:08.197] started whisper v.6.0 \r\nINFO [04-01|22:52:08.197] New local node record                    seq=1 id=a0d810f946f0c669 ip=127.0.0.1 udp=0 tcp=44237\r\nINFO [04-01|22:52:08.197] Started P2P networking                   self=\"enode://5155d7ff1d776f9de67d06e7d168bbec41164b53f326831a2a11b23b0abd72a6a96cd06dfad7a84d5fe1bce7f14a7656283faa171a45f66234839476d125af23@127.0.0.1:44237?discport=0\"\r\nINFO [04-01|22:52:08.198] IPC endpoint opened                      url=/home/spalladino/Projects/samples/sample-meta-txs/.geth/geth.ipc\r\nINFO [04-01|22:52:08.198] HTTP endpoint opened                     url=http://127.0.0.1:8545                                            cors= vhosts=localhost\r\nINFO [04-01|22:52:08.198] Transaction pool price threshold updated price=1000000000\r\nINFO [04-01|22:52:08.198] Transaction pool price threshold updated price=1\r\nINFO [04-01|22:52:08.198] Etherbase automatically configured       address=0xF579813997A2ecFbCcA3A19A92de7a74a46f5A4D\r\nINFO [04-01|22:52:08.198] Commit new mining work                   number=1 sealhash=6492a0â€¦cf3e36 uncles=0 txs=0 gas=0 fees=0 elapsed=70.62Âµs\r\nINFO [04-01|22:52:08.198] Sealing paused, waiting for transactions \r\nINFO [04-01|22:52:09.153] Setting new local account                address=0xF579813997A2ecFbCcA3A19A92de7a74a46f5A4D\r\nINFO [04-01|22:52:09.153] Submitted transaction                    fullhash=0x6ba80d9055474d61e043d5a716e5298714a33cf5cca6c7b4694c00815cb926ef recipient=0xACa94ef8bD5ffEE41947b4585a84BdA5a3d3DA6E\r\nINFO [04-01|22:52:09.154] Commit new mining work                   number=1 sealhash=3504f0â€¦c65bd7 uncles=0 txs=0 gas=0 fees=0 elapsed=117.77Âµs\r\nINFO [04-01|22:52:09.154] Sealing paused, waiting for transactions \r\nINFO [04-01|22:52:09.154] Commit new mining work                   number=1 sealhash=668118â€¦32f073 uncles=0 txs=1 gas=21000 fees=2.1e-05 elapsed=372.277Âµs\r\nINFO [04-01|22:52:09.154] Successfully sealed new block            number=1 sealhash=668118â€¦32f073 hash=1ba531â€¦80f3a5 elapsed=531.953Âµs\r\nINFO [04-01|22:52:09.154] ðŸ”¨ mined potential block                  number=1 hash=1ba531â€¦80f3a5\r\nINFO [04-01|22:52:09.155] Commit new mining work                   number=2 sealhash=498fdeâ€¦518e69 uncles=0 txs=0 gas=0     fees=0       elapsed=305.746Âµs\r\nINFO [04-01|22:52:09.155] Sealing paused, waiting for transactions \r\nINFO [04-01|22:52:11.568] Mapped network port                      proto=tcp extport=44237 intport=44237 interface=\"UPNP IGDv1-IP1\"\r\n````\r\n",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19366/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19366/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/478879845",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19366#issuecomment-478879845",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19366",
    "id": 478879845,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODg3OTg0NQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-02T07:34:09Z",
    "updated_at": "2019-04-02T07:34:09Z",
    "author_association": "MEMBER",
    "body": "Hehe :) In dev mode, the account that is created for you to play with is also the signer. In essence, the fees **are** deducted, but then they are **added** back since the same account mined the block.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/478879845/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/478880225",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19366#issuecomment-478880225",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19366",
    "id": 478880225,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3ODg4MDIyNQ==",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-02T07:35:21Z",
    "updated_at": "2019-04-02T07:35:21Z",
    "author_association": "MEMBER",
    "body": "If it's important for your use case that the accounts are separate, you can start your tests/chain by sending a \"funding\" transaction to some other account than the signer and use that instead. Then the balances will correctly reflect the fees too.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/478880225/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/479018763",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/19366#issuecomment-479018763",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/19366",
    "id": 479018763,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3OTAxODc2Mw==",
    "user": {
      "login": "spalladino",
      "id": 429604,
      "node_id": "MDQ6VXNlcjQyOTYwNA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/429604?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/spalladino",
      "html_url": "https://github.com/spalladino",
      "followers_url": "https://api.github.com/users/spalladino/followers",
      "following_url": "https://api.github.com/users/spalladino/following{/other_user}",
      "gists_url": "https://api.github.com/users/spalladino/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/spalladino/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/spalladino/subscriptions",
      "organizations_url": "https://api.github.com/users/spalladino/orgs",
      "repos_url": "https://api.github.com/users/spalladino/repos",
      "events_url": "https://api.github.com/users/spalladino/events{/privacy}",
      "received_events_url": "https://api.github.com/users/spalladino/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-02T14:20:31Z",
    "updated_at": "2019-04-02T14:20:31Z",
    "author_association": "NONE",
    "body": "Damn, never took that into account. Thanks so much for the clarification @karalabe, and apologies for the noise!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/479018763/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
