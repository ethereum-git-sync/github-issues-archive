{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17729",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17729/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17729/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17729/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/17729",
  "id": 362486603,
  "node_id": "MDU6SXNzdWUzNjI0ODY2MDM=",
  "number": 17729,
  "title": "Possible bug with tx fees inclusion",
  "user": {
    "login": "drhashes",
    "id": 43464549,
    "node_id": "MDQ6VXNlcjQzNDY0NTQ5",
    "avatar_url": "https://avatars.githubusercontent.com/u/43464549?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/drhashes",
    "html_url": "https://github.com/drhashes",
    "followers_url": "https://api.github.com/users/drhashes/followers",
    "following_url": "https://api.github.com/users/drhashes/following{/other_user}",
    "gists_url": "https://api.github.com/users/drhashes/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/drhashes/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/drhashes/subscriptions",
    "organizations_url": "https://api.github.com/users/drhashes/orgs",
    "repos_url": "https://api.github.com/users/drhashes/repos",
    "events_url": "https://api.github.com/users/drhashes/events{/privacy}",
    "received_events_url": "https://api.github.com/users/drhashes/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 856638432,
      "node_id": "MDU6TGFiZWw4NTY2Mzg0MzI=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/status:inactive",
      "name": "status:inactive",
      "color": "ffffff",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2018-09-21T07:18:56Z",
  "updated_at": "2019-11-03T12:05:17Z",
  "closed_at": "2019-11-03T11:53:11Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "\r\n#### System information\r\n\r\nGeth version: geth 1.8.15 stable\r\nOS & Version: Ubuntu 16.04\r\n\r\n#### Expected behaviour\r\nMaximize included fees in block.\r\n\r\n#### Actual behaviour\r\nSeems that under certain conditions fees is reset to zero.\r\n\r\n#### Steps to reproduce the behaviour\r\nStart geth for pool mining.\r\n\r\n#### Backtrace\r\nAn example (readable log below):\r\nBlock 6370533 is imported at 00:47:27.877. The next round of work starts on 6370534. Then 6370533 is again imported (first 6370533 probably became an uncle).\r\nHere it comes! Watch the fees for the round 6370534: 0, 0.1600905232, 0. It would seem that as soon as 6370533 is imported in the middle of round 6370534 the fees is reset to 0! Block 6370534 was then found and no fees included..\r\n\r\n[backtrace]\r\nINFO [09-21|00:47:21.794] Commit new mining work                   number=6370533 uncles=0 txs=132 gas=7991403 fees=0.2046197766\r\nINFO [09-21|00:47:27.789] Commit new mining work                   number=6370533 uncles=0 txs=132 gas=7996634 fees=0.2074531949\r\n\r\nINFO [09-21|00:47:27.877] Imported new chain segment               blocks=1 txs=75  mgas=7.982  elapsed=167.579ms mgasps=47.633  number=6370533\r\n\r\nINFO [09-21|00:47:27.892] Commit new mining work                   number=6370534 uncles=0 txs=0   gas=0       fees=0\r\nINFO [09-21|00:47:28.861] Commit new mining work                   number=6370534 uncles=0 txs=141 gas=7995851 fees=0.1600905232\r\n\r\nINFO [09-21|00:47:30.406] Imported new chain segment               blocks=1 txs=49  mgas=7.976  elapsed=190.518ms mgasps=41.864  number=6370533\r\n\r\nINFO [09-21|00:47:30.407] Commit new mining work                   number=6370534 uncles=1 txs=0   gas=0       fees=0\r\n\r\nINFO [09-21|00:47:30.922] Successfully sealed new block            number=6370534 \r\nINFO [09-21|00:47:30.922] mined potential block                    number=6370534\r\n\r\nINFO [09-21|00:47:31.132] Commit new mining work                   number=6370535 uncles=0 txs=0   gas=0       fees=0\r\nINFO [09-21|00:47:31.873] Commit new mining work                   number=6370535 uncles=0 txs=134 gas=7992083 fees=0.2123682669\r\n",
  "closed_by": {
    "login": "stale[bot]",
    "id": 26384082,
    "node_id": "MDM6Qm90MjYzODQwODI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stale%5Bbot%5D",
    "html_url": "https://github.com/apps/stale",
    "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17729/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17729/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/423461496",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/17729#issuecomment-423461496",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17729",
    "id": 423461496,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMzQ2MTQ5Ng==",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-21T08:47:12Z",
    "updated_at": "2018-09-21T08:51:43Z",
    "author_association": "MEMBER",
    "body": "@drhashes Thanks for the report! \r\n\r\nThe mining mechanism in the geth is: we will maintain a batch of mining works in the single mining round and we will always try to push the new mining work to the mining pool. So actually for which block is mined in this round is totally depends on the miner itself.\r\n\r\nSo why do we need to maintain a batch of mining works?\r\nFor example, when we receive a new head block from the network, we will create an empty block and throw it to mining pool immediately since the transaction execution can last 200ms, we want to save this part of the time.\r\n\r\nAnd during the long mining procedure(about 15s), a lot of new transactions will arrive, some of them may have a very high gas price. So we will recreate the mining block every once in a while to include more transactions or transactions with a higher price.\r\n\r\nBesides, We will also try to recreate a new mining block when we receive an uncle if the current mining block contains less than 2 uncles\r\n\r\nAll in all, we want to create the mining block flexibly to increase the average block reward.\r\n\r\nAnd more specific, when geth imports the second 6370533(new head block), it recreates a new empty block first `INFO [09-21|00:47:30.407] Commit new mining work number=6370534 uncles=1 txs=0 gas=0 fees=0`. And i guess at that time, miner found the empty block 6370534 which generated here `Commit new mining work number=6370534 uncles=0 txs=0 gas=0 fees=0`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/423461496/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/423476545",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/17729#issuecomment-423476545",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17729",
    "id": 423476545,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMzQ3NjU0NQ==",
    "user": {
      "login": "drhashes",
      "id": 43464549,
      "node_id": "MDQ6VXNlcjQzNDY0NTQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/43464549?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/drhashes",
      "html_url": "https://github.com/drhashes",
      "followers_url": "https://api.github.com/users/drhashes/followers",
      "following_url": "https://api.github.com/users/drhashes/following{/other_user}",
      "gists_url": "https://api.github.com/users/drhashes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/drhashes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/drhashes/subscriptions",
      "organizations_url": "https://api.github.com/users/drhashes/orgs",
      "repos_url": "https://api.github.com/users/drhashes/repos",
      "events_url": "https://api.github.com/users/drhashes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/drhashes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-21T09:42:56Z",
    "updated_at": "2018-09-21T09:42:56Z",
    "author_association": "NONE",
    "body": "Thanks for the reply.\r\nSo you are saying that this special situation (which will not occur very often) is not easy to avoid (or perhaps should not be avoided).\r\nAtm I'm wondering if it could be worth to pay the price of 200 ms given the special case when importing in the middle of the round?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/423476545/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/423490951",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/17729#issuecomment-423490951",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17729",
    "id": 423490951,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQyMzQ5MDk1MQ==",
    "user": {
      "login": "rjl493456442",
      "id": 5959481,
      "node_id": "MDQ6VXNlcjU5NTk0ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5959481?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rjl493456442",
      "html_url": "https://github.com/rjl493456442",
      "followers_url": "https://api.github.com/users/rjl493456442/followers",
      "following_url": "https://api.github.com/users/rjl493456442/following{/other_user}",
      "gists_url": "https://api.github.com/users/rjl493456442/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rjl493456442/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rjl493456442/subscriptions",
      "organizations_url": "https://api.github.com/users/rjl493456442/orgs",
      "repos_url": "https://api.github.com/users/rjl493456442/repos",
      "events_url": "https://api.github.com/users/rjl493456442/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rjl493456442/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-09-21T10:42:04Z",
    "updated_at": "2018-09-21T10:42:04Z",
    "author_association": "MEMBER",
    "body": "@drhashes Actually we assume miner will switch from the old work to new work asap once new mining work is pushed. But yes, there is always a delay, so the miner could still working on the old one.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/423490951/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/533874259",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/17729#issuecomment-533874259",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/17729",
    "id": 533874259,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzMzg3NDI1OQ==",
    "user": {
      "login": "stale[bot]",
      "id": 26384082,
      "node_id": "MDM6Qm90MjYzODQwODI=",
      "avatar_url": "https://avatars.githubusercontent.com/in/1724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stale%5Bbot%5D",
      "html_url": "https://github.com/apps/stale",
      "followers_url": "https://api.github.com/users/stale%5Bbot%5D/followers",
      "following_url": "https://api.github.com/users/stale%5Bbot%5D/following{/other_user}",
      "gists_url": "https://api.github.com/users/stale%5Bbot%5D/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stale%5Bbot%5D/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stale%5Bbot%5D/subscriptions",
      "organizations_url": "https://api.github.com/users/stale%5Bbot%5D/orgs",
      "repos_url": "https://api.github.com/users/stale%5Bbot%5D/repos",
      "events_url": "https://api.github.com/users/stale%5Bbot%5D/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stale%5Bbot%5D/received_events",
      "type": "Bot",
      "site_admin": false
    },
    "created_at": "2019-09-22T11:39:51Z",
    "updated_at": "2019-09-22T11:39:51Z",
    "author_association": "NONE",
    "body": "This issue has been automatically marked as stale because it has not had recent activity. It will be closed if no further activity occurs. Thank you for your contributions.\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/533874259/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
