{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26368",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26368/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26368/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26368/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/26368",
  "id": 1500811450,
  "node_id": "I_kwDOAOvK985ZdJC6",
  "number": 26368,
  "title": "Geth produced a block without transactions in mainnet",
  "user": {
    "login": "joaocenoura",
    "id": 5530392,
    "node_id": "MDQ6VXNlcjU1MzAzOTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5530392?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/joaocenoura",
    "html_url": "https://github.com/joaocenoura",
    "followers_url": "https://api.github.com/users/joaocenoura/followers",
    "following_url": "https://api.github.com/users/joaocenoura/following{/other_user}",
    "gists_url": "https://api.github.com/users/joaocenoura/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/joaocenoura/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/joaocenoura/subscriptions",
    "organizations_url": "https://api.github.com/users/joaocenoura/orgs",
    "repos_url": "https://api.github.com/users/joaocenoura/repos",
    "events_url": "https://api.github.com/users/joaocenoura/events{/privacy}",
    "received_events_url": "https://api.github.com/users/joaocenoura/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-12-16T20:20:12Z",
  "updated_at": "2022-12-20T10:36:03Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `v1.10.23`\r\nCL client & version: teku/v22.11.0\r\nOS & Version: Linux\r\nCommit hash : N/A\r\n\r\n#### Context\r\n\r\nOur setup in mainnet is a Teku CL + MEV boost (single relay) + Geth EL. We've experienced mev-boost failures which made Teku to use Geth as fallback block builder. During a 7 day period, Geth was used as a fallback block builder 124 times, of which it produced 4 blocks without transactions.\r\n\r\n#### Expected behaviour\r\n\r\nGeth should always produce blocks with transactions.\r\n\r\n#### Actual behaviour\r\n\r\nGeth produced ~3% of blocks without transactions\r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nWe're not able to reproduce this issue consistently on mainnet. From our sample, ~3% percent of the blocks were affected during normal operation of our nodes.\r\n\r\n#### Backtrace\r\n\r\nThere were no errors or warning in Geth that could help troubleshoot the root cause of this issue. We only saw in Teku:\r\n```\r\n2022-12-12 06:28:51.001 INFO  - Slot Event  *** Slot: 5333542, Block: 257eff64f8de68d9102de90f3a820bffa8180dea33d5de6ae0dbe737f668d403, Justified: 166672, Finalized: 166671, Peers: 100\r\n2022-12-12 06:28:39.001 INFO  - Slot Event  *** Slot: 5333541, Block: 14ea43cce448b280c3765ad8370c2f07c7b00424ad164e11696d021258cdb0ca, Justified: 166672, Finalized: 166671, Peers: 100\r\n2022-12-12 06:28:27.000 INFO  - Slot Event  *** Slot: 5333540, Block: 9dc64b6e664cab7c526d2988207f22a7498323a4e26f2ee53ac0c7d350eb75b3, Justified: 166672, Finalized: 166671, Peers: 100\r\n2022-12-12 06:28:15.001 INFO  - Slot Event  *** Slot: 5333539, Block: ec4a33c9f8f9212d425f650659f66d3f60d0dd40a9a9c1f97585b21495b67fbc, Justified: 166672, Finalized: 166671, Peers: 100\r\n2022-12-12 06:28:03.071 INFO  - Slot Event  *** Slot: 5333538, Block: 068a54bcd6a8c05b9b5ae568bce6f39dcd0afafd3235f2741bcc2afd6c050014, Justified: 166672, Finalized: 166671, Peers: 101\r\n2022-12-12 06:27:51.000 INFO  - Slot Event  *** Slot: 5333537, Block: 947f8b8356b7a455de621568e59489d24ed42fb55874b8da454cde3a433f6271, Justified: 166672, Finalized: 166671, Peers: 100\r\n2022-12-12 06:27:39.001 INFO  - Slot Event  *** Slot: 5333536, Block: 7860622b5e7a027f335d7d8903c95974ea04ef7891ad328bce365ff72ce0440b, Justified: 166672, Finalized: 166671, Peers: 101\r\n2022-12-12 06:27:36.957 INFO  - Falling back to locally produced execution payload (Block Number 16166836, Block Hash = 0x74273878c39a508cf6f8eb5db3525c011c65ee7d6857e5433c83f021f203cf88, Fallback Reason = validator_not_registered)\r\n2022-12-12 06:27:36.699 INFO  - Sync committee performance: epoch 166672, <redacted>\r\n2022-12-12 06:27:36.699 INFO  - Attestation performance: epoch 166671, <redacted>\r\n2022-12-12 06:27:35.001 INFO  - Epoch Event *** Epoch: 166673, Justified checkpoint: 166672, Finalized checkpoint: 166671, Finalized root: 2fd661a3dcbdbddb041d1409093ff8ebe83da2764f432ca092af74aca02064d7\r\n2022-12-12 06:27:27.000 INFO  - Slot Event  *** Slot: 5333535, Block: 3609c35e5dd616ddb03cdffbfbfba4cd1981ee3421cb2b9e4336c43eb7940f5f, Justified: 166671, Finalized: 166670, Peers: 100\r\n2022-12-12 06:27:15.000 INFO  - Slot Event  *** Slot: 5333534, Block: ab2c9c141d102589502e8f8bbb1a5deeefc1f5a048cf399bc95a8cc1b54f7f05, Justified: 166671, Finalized: 166670, Peers: 100\r\n2022-12-12 06:27:03.001 INFO  - Slot Event  *** Slot: 5333533, Block: d22074a32946e03ae9ef19dace47bb14c09d3b54f83c3a9ea4d48cb2c494ddcc, Justified: 166671, Finalized: 166670, Peers: 100\r\n```\r\nAnd in Geth:\r\n```\r\nINFO [12-12|06:28:11.696] Unindexed transactions                   blocks=1    txs=317     tail=13,816,840 elapsed=3.732ms\r\nINFO [12-12|06:28:11.692] Chain head was updated                   number=16,166,839 hash=a2949a..252590 root=7e02b0..91af93 elapsed=\"520.503µs\"\r\nINFO [12-12|06:28:11.562] Imported new potential chain segment     blocks=1    txs=13      mgas=3.625   elapsed=41.097ms     mgasps=88.194   number=16,166,839 hash=a2949a..252590 dirty=1020.16MiB\r\nINFO [12-12|06:28:00.585] Unindexed transactions                   blocks=1    txs=24      tail=13,816,839 elapsed=\"464.303µs\"\r\nINFO [12-12|06:28:00.584] Chain head was updated                   number=16,166,838 hash=1a74a1..7accc7 root=089974..af0250 elapsed=8.548253ms\r\nINFO [12-12|06:28:00.567] Imported new potential chain segment     blocks=1    txs=201     mgas=29.209  elapsed=1.001s       mgasps=29.172   number=16,166,838 hash=1a74a1..7accc7 dirty=1021.93MiB\r\nINFO [12-12|06:27:48.046] Unindexed transactions                   blocks=1    txs=53      tail=13,816,838 elapsed=\"923.105µs\"\r\nINFO [12-12|06:27:48.045] Chain head was updated                   number=16,166,837 hash=3f8f41..2cffe8 root=aff1f3..4b8d5c elapsed=2.606915ms\r\nINFO [12-12|06:27:48.027] Imported new potential chain segment     blocks=1    txs=109     mgas=29.999  elapsed=142.018ms    mgasps=211.232  number=16,166,837 hash=3f8f41..2cffe8 dirty=1023.30MiB\r\nINFO [12-12|06:27:37.117] Unindexed transactions                   blocks=1    txs=50      tail=13,816,837 elapsed=1.050ms\r\nINFO [12-12|06:27:37.115] Chain head was updated                   number=16,166,836 hash=742738..03cf88 root=4e0a52..3e12d3 elapsed=\"100.901µs\"\r\nINFO [12-12|06:27:36.965] Imported new potential chain segment     blocks=1    txs=0       mgas=0.000   elapsed=10.297ms     mgasps=0.000    number=16,166,836 hash=742738..03cf88 dirty=1021.78MiB\r\nINFO [12-12|06:27:24.427] Unindexed transactions                   blocks=1    txs=336     tail=13,816,836 elapsed=4.530ms\r\nINFO [12-12|06:27:24.423] Chain head was updated                   number=16,166,835 hash=c5fb9e..1153cc root=4e0a52..3e12d3 elapsed=5.477731ms\r\nINFO [12-12|06:27:24.408] Imported new potential chain segment     blocks=1    txs=106     mgas=15.415  elapsed=448.053ms    mgasps=34.405   number=16,166,835 hash=c5fb9e..1153cc dirty=1022.58MiB\r\nINFO [12-12|06:27:11.996] Unindexed transactions                   blocks=1    txs=129     tail=13,816,835 elapsed=1.755ms\r\nINFO [12-12|06:27:11.994] Chain head was updated                   number=16,166,834 hash=45985e..f7a64b root=01bb95..d53e68 elapsed=3.171018ms\r\nINFO [12-12|06:27:11.983] Imported new potential chain segment     blocks=1    txs=113     mgas=10.523  elapsed=110.206ms    mgasps=95.480   number=16,166,834 hash=45985e..f7a64b dirty=1022.19MiB\r\n```\r\n\r\nWe're using default settings for logging. Unfortunately there's no warnings or errors in CL or EL. The only relevant line in CL is:\r\n```\r\n2022-12-12 06:27:36.957 INFO  - Falling back to locally produced execution payload (Block Number 16166836, Block Hash = 0x74273878c39a508cf6f8eb5db3525c011c65ee7d6857e5433c83f021f203cf88, Fallback Reason = validator_not_registered)\r\n```\r\nand from EL we're just seeing it importing the produced block w/out transactions:\r\n```\r\nINFO [12-12|06:27:36.965] Imported new potential chain segment     blocks=1    txs=0       mgas=0.000   elapsed=10.297ms     mgasps=0.000    number=16,166,836 hash=742738..03cf88 dirty=1021.78MiB\r\n```\r\n\r\n#### Final note\r\n\r\nWe've mitigated this issue by adding more relays which should improve mev-boost resilience and decrease the probability of fallback to Geth's block production. However we're just hiding a real issue here and, because of that, it would be valuable to understand under what circumstances Geth provides a block without transactions in mainnet.\r\nWould also be worth knowing if is there any logging we could enable specifically for block production or any other flag that could improve block production process.\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26368/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26368/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1355561213",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26368#issuecomment-1355561213",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26368",
    "id": 1355561213,
    "node_id": "IC_kwDOAOvK985QzDj9",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-16T20:29:56Z",
    "updated_at": "2022-12-16T20:29:56Z",
    "author_association": "MEMBER",
    "body": "> Geth version: v1.10.23\r\n\r\nUse latest `master`, a.k.a `unstable` for prebuilt binaries or `latest` on docker. We shipped some improvements to block building, which have not made it into stable release yet, it seems. \r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1355561213/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1355562317",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26368#issuecomment-1355562317",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26368",
    "id": 1355562317,
    "node_id": "IC_kwDOAOvK985QzD1N",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-16T20:30:42Z",
    "updated_at": "2022-12-16T20:30:42Z",
    "author_association": "MEMBER",
    "body": "More specifically: https://github.com/ethereum/go-ethereum/pull/25836 ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1355562317/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1355577046",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26368#issuecomment-1355577046",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26368",
    "id": 1355577046,
    "node_id": "IC_kwDOAOvK985QzHbW",
    "user": {
      "login": "joaocenoura",
      "id": 5530392,
      "node_id": "MDQ6VXNlcjU1MzAzOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5530392?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/joaocenoura",
      "html_url": "https://github.com/joaocenoura",
      "followers_url": "https://api.github.com/users/joaocenoura/followers",
      "following_url": "https://api.github.com/users/joaocenoura/following{/other_user}",
      "gists_url": "https://api.github.com/users/joaocenoura/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/joaocenoura/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/joaocenoura/subscriptions",
      "organizations_url": "https://api.github.com/users/joaocenoura/orgs",
      "repos_url": "https://api.github.com/users/joaocenoura/repos",
      "events_url": "https://api.github.com/users/joaocenoura/events{/privacy}",
      "received_events_url": "https://api.github.com/users/joaocenoura/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-16T20:41:47Z",
    "updated_at": "2022-12-16T20:41:47Z",
    "author_association": "NONE",
    "body": "many thanks for the fast reply @holiman. Any ETA for it to hit stable? Would you know if there's any logging improvements related to block production we could enable? Many thanks for your work :raised_hands: ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1355577046/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1359154897",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/26368#issuecomment-1359154897",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/26368",
    "id": 1359154897,
    "node_id": "IC_kwDOAOvK985RAw7R",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-20T10:36:02Z",
    "updated_at": "2022-12-20T10:36:02Z",
    "author_association": "MEMBER",
    "body": "I don't know the ETA for it to hit stable. We won't ship 1.11 for a while yet, so the question is if we will include it in a backport release any time soon.... We'll discusss it, we haven't scheduled it yet.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1359154897/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
