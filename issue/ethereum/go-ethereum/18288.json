{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18288",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18288/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18288/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18288/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/18288",
  "id": 390050151,
  "node_id": "MDU6SXNzdWUzOTAwNTAxNTE=",
  "number": 18288,
  "title": "Transaction pool DoS attack",
  "user": {
    "login": "hadg",
    "id": 4592450,
    "node_id": "MDQ6VXNlcjQ1OTI0NTA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4592450?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hadg",
    "html_url": "https://github.com/hadg",
    "followers_url": "https://api.github.com/users/hadg/followers",
    "following_url": "https://api.github.com/users/hadg/following{/other_user}",
    "gists_url": "https://api.github.com/users/hadg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hadg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hadg/subscriptions",
    "organizations_url": "https://api.github.com/users/hadg/orgs",
    "repos_url": "https://api.github.com/users/hadg/repos",
    "events_url": "https://api.github.com/users/hadg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hadg/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2018-12-12T03:29:13Z",
  "updated_at": "2018-12-12T07:10:21Z",
  "closed_at": "2018-12-12T07:10:21Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### System information\r\n\r\nGeth version: `1.8.19-stable`\r\nOS & Version: OSX\r\n\r\n#### Expected behaviour\r\nNodes should not accept transactions with low GAS prices by default.\r\n\r\n#### Actual behaviour\r\nThe node can accept any number of transactions with a gas price of 0 through RPC.\r\n\r\n#### Steps to reproduce the behaviour\r\n1. Create nodes with\r\n\r\n````\r\n{\r\n    \"config\": {\r\n        \"chainId\": 15,\r\n        \"homesteadBlock\": 0,\r\n        \"eip155Block\": 0,\r\n        \"eip158Block\": 0\r\n    },\r\n    \"difficulty\": \"2000\",\r\n    \"gasLimit\": \"2100000\",\r\n    \"alloc\": {\r\n        \"7df9a875a174b3bc565e6424a0050ebc1b2d1d82\": { \"balance\": \"300000\" },\r\n        \"b0d74e9f9Ba20eEa9429649563bc745261e02De7\": { \"balance\": \"400000000\" }\r\n    }\r\n}\r\n````\r\n2. Boot node\r\n\r\n````\r\ngeth --datadir ./data --networkid 15 --rpc --verity 6 --nodiscover console\r\n````\r\n\r\n3. Send a lot of transaction with a gas price of 0 to the node RPC through a script\r\n````\r\nconst Web3 = require('web3');\r\nconst Tx = require('ethereumjs-tx');\r\nconst web3 = new Web3(new Web3.providers.HttpProvider('http://127.0.0.1:8545'));\r\n\r\nconst GAS_PRICE = 1;\r\nconst GAS_LIMIT = 2100000;\r\nlet myAddress = '0xb0d74e9f9Ba20eEa9429649563bc745261e02De7';\r\nlet toAddress = '0xb346442ebd889F0639eea0ADC5e031c40da32A22';\r\nweb3.eth.getBalance(myAddress).then(d=>{\r\n    console.log(web3.utils.fromWei(d));\r\n})\r\nlet test = async function() {\r\n    let count = await web3.eth.getTransactionCount(myAddress);\r\n    let batch = new web3.BatchRequest();\r\n    for(let i = count; i < count + 1; i++){\r\n        let rawTransaction = {\r\n            \"from\": myAddress,\r\n            \"nonce\": \"0x\" + i.toString(16),\r\n            \"gasPrice\": web3.utils.toHex(GAS_PRICE),\r\n            \"gasLimit\": web3.utils.toHex(GAS_LIMIT),\r\n            \"to\": toAddress,\r\n            \"value\": \"0x0\",\r\n            \"data\": \"0x0\",\r\n            \"chainId\": 15\r\n        };\r\n        let privKey = new Buffer('private key', 'hex');\r\n        let tx = new Tx(rawTransaction);\r\n        tx.sign(privKey);\r\n        let serializedTx = tx.serialize();\r\n        console.log(`Attempting to send signed tx:  ${serializedTx.toString('hex')}`);\r\n        batch.add(web3.eth.sendSignedTransaction.request('0x' + serializedTx.toString('hex'),(err,data)=>{\r\n            if(err){\r\n                console.log(err)\r\n            }else{\r\n                console.log('success')\r\n            }\r\n        }))\r\n    }\r\n    batch.execute();\r\n}\r\ntest();\r\n````\r\n#### Backtrace\r\n\r\nI added 11,000 transactions through the script. During the process of adding, the geth process consumes a lot of cpu resources, and when I restart the node, the geth needs to spend a lot of time to reload the transactions in the transaction pool from the hard disk.\r\n\r\n![image](https://user-images.githubusercontent.com/4592450/49845189-a8c8ff00-fe00-11e8-84ef-3df5f490f134.png)\r\n![image](https://user-images.githubusercontent.com/4592450/49845232-d9109d80-fe00-11e8-8717-4b39af519b5d.png)\r\n\r\n",
  "closed_by": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18288/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18288/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/446485401",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/18288#issuecomment-446485401",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/18288",
    "id": 446485401,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ0NjQ4NTQwMQ==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-12-12T07:10:09Z",
    "updated_at": "2018-12-12T07:10:09Z",
    "author_association": "MEMBER",
    "body": "It considers txs added through rpc to be 'locals', that you (node operator) want to treat without the normal caps and rules.\n\nUse '--nolocals' to disable special treatment of locals. \n\nAs it is,. works as designed",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/446485401/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
