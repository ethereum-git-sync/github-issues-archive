{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24272",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24272/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24272/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24272/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/24272",
  "id": 1111744015,
  "node_id": "I_kwDOAOvK985CQ94P",
  "number": 24272,
  "title": "Ask about Snap sync!",
  "user": {
    "login": "junha-ahn",
    "id": 41976906,
    "node_id": "MDQ6VXNlcjQxOTc2OTA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/41976906?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/junha-ahn",
    "html_url": "https://github.com/junha-ahn",
    "followers_url": "https://api.github.com/users/junha-ahn/followers",
    "following_url": "https://api.github.com/users/junha-ahn/following{/other_user}",
    "gists_url": "https://api.github.com/users/junha-ahn/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/junha-ahn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/junha-ahn/subscriptions",
    "organizations_url": "https://api.github.com/users/junha-ahn/orgs",
    "repos_url": "https://api.github.com/users/junha-ahn/repos",
    "events_url": "https://api.github.com/users/junha-ahn/events{/privacy}",
    "received_events_url": "https://api.github.com/users/junha-ahn/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 268304226,
      "node_id": "MDU6TGFiZWwyNjgzMDQyMjY=",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:docs",
      "name": "type:docs",
      "color": "fef2c0",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-01-23T01:44:05Z",
  "updated_at": "2022-01-24T04:40:53Z",
  "closed_at": "2022-01-24T04:40:53Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "\r\nI understood that \"Snap sync\" downloads the \"Snapshot Acceleration Structure\" from another node on the network, effectively downloading the latest State (flat key-value store).\r\n\r\nSo, what happens to the memory structure of the existing Full Sync mode and the MPT State structure stored on the disk?\r\n\r\n(1) The State structure of Full/Fast Sync mode stored in memory is **replaced** by the Snapshot In-memory layer.\r\n\r\n(2) The existing MPT structure **disappears** in Level DB, and the snapshot persistent disk layer is stored.\r\n\r\n(3) I heard that when Snap Sync Mode is completed, it switches to Full Sync mode, but will only the snapshot data structure continue to be stored (push)?\r\n\r\nIs it right that I understood? ",
  "closed_by": {
    "login": "karalabe",
    "id": 129561,
    "node_id": "MDQ6VXNlcjEyOTU2MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karalabe",
    "html_url": "https://github.com/karalabe",
    "followers_url": "https://api.github.com/users/karalabe/followers",
    "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
    "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
    "organizations_url": "https://api.github.com/users/karalabe/orgs",
    "repos_url": "https://api.github.com/users/karalabe/repos",
    "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karalabe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24272/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24272/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1019714172",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/24272#issuecomment-1019714172",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/24272",
    "id": 1019714172,
    "node_id": "IC_kwDOAOvK9848x5p8",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-24T04:40:52Z",
    "updated_at": "2022-01-24T04:40:52Z",
    "author_association": "MEMBER",
    "body": "(1, 2) Snap sync downloads the flat state and reconstructs the trie from that. Any existing trie data is left on disk as there's no harm (trie nodes are just hash-mapped data blobs, so having a few more entries doesn't matter).\r\n\r\nThe flat data chunks are also saved to disk (overwriting or extending whatever is already there; but generally snap is only used for initial sync, so there shouldn't be any previous leftover). In either case, once snap sync is done, the flat snapshot format is iterated and any errors fixed (it compares the content to the MPT, and if there's a mismatch, it regenerates that part of the snapshot). Thus after sync and snapshot fixup, both MPT and flat snapshot are correct.\r\n\r\n(3) No, both MPT and snapshot will be maintained. The snapshot is used as an accelerator + serving to other nodes. The MPT is needed to calculate and verify the root hashes of the blocks.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1019714172/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
