{
  "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25028",
  "repository_url": "https://api.github.com/repos/ethereum/go-ethereum",
  "labels_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25028/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25028/comments",
  "events_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25028/events",
  "html_url": "https://github.com/ethereum/go-ethereum/issues/25028",
  "id": 1260894023,
  "node_id": "I_kwDOAOvK985LJ7dH",
  "number": 25028,
  "title": "Geth running OOM on a 16GB virtual machine",
  "user": {
    "login": "connectnorganize",
    "id": 106855990,
    "node_id": "U_kgDOBl5-Ng",
    "avatar_url": "https://avatars.githubusercontent.com/u/106855990?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/connectnorganize",
    "html_url": "https://github.com/connectnorganize",
    "followers_url": "https://api.github.com/users/connectnorganize/followers",
    "following_url": "https://api.github.com/users/connectnorganize/following{/other_user}",
    "gists_url": "https://api.github.com/users/connectnorganize/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/connectnorganize/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/connectnorganize/subscriptions",
    "organizations_url": "https://api.github.com/users/connectnorganize/orgs",
    "repos_url": "https://api.github.com/users/connectnorganize/repos",
    "events_url": "https://api.github.com/users/connectnorganize/events{/privacy}",
    "received_events_url": "https://api.github.com/users/connectnorganize/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 72233650,
      "node_id": "MDU6TGFiZWw3MjIzMzY1MA==",
      "url": "https://api.github.com/repos/ethereum/go-ethereum/labels/type:bug",
      "name": "type:bug",
      "color": "FF5E5E",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-06-04T21:18:21Z",
  "updated_at": "2022-07-11T19:19:55Z",
  "closed_at": "2022-07-11T19:19:55Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "#### Introduction\r\nI noticed there are some similar issues to mine where the user has not responded in a while, but here is my complaint of sorts. I am running into the OOM reaper every time I try to run Geth in my custom setup over Tor.\r\n\r\n#### System information\r\n\r\nGeth version: 1.10.18-stable\r\nOS & Version: Whonix 16.0.4.2 (based on Debian Bullseye) running in a Qubes 4.1 VM\r\nHarware: 15.5GB RAM allocated from a 16GB system, 1TB SSD\r\n\r\n#### Expected behaviour\r\n\r\nI am running Geth on Whonix, an anonymity-focused OS that routes all its traffic through Tor, as a POC to learn how to run an Ethereum node anonymously. It works well except peers have to be added manually. I would expect it to keep running semi-normally because it has been running well for over a month before a few days ago.\r\n\r\n#### Actual behaviour\r\n\r\nUntil a few days ago Geth ran and syncs normally, although peers have to be added through the config file and Geth has to be run with --nodiscover (Tor can't handle the UDP Geth uses for discovery). However a couple of days ago my system ran out of storage and crashed Geth with a \"nil pointer reference\" error. Ever since then, Geth quickly fills my memory up to 95% and is killed by the OOM reaper every time I run it, as soon as peer discovery is done and block bodies start to be imported. \r\n\r\nOne thing I have noticed is a \"[INFO] Importing heavy sidechain segment\" log outputting that I don't recognize from before, that is outputted around the time when the memory usage begins to explode. \r\n\r\n#### Steps to reproduce the behaviour\r\n\r\nRunning the command \"geth --nodiscover --verbosity 5 --config config.toml\"\r\n\r\n#### Backtrace\r\n\r\nI'm sorry, I'm not sure If I did this right, gdb gives me some useless information from the pre-built Geth distribution I use and then crashed with a broken pipe.\r\n\r\nsee attached [gdb-geth.txt](https://github.com/ethereum/go-ethereum/files/8838709/gdb-geth.txt)\r\n\r\n#### Geth logs\r\n\r\nHere are some Geth logs from a separate crash yesterday under the same situation, in glorious verbosity 5:\r\n\r\nsee attached [geth-oom-console-logs.txt](https://github.com/ethereum/go-ethereum/files/8838748/geth-oom-console-logs.txt)\r\n\r\n\r\n#### Geth config\r\n\r\nHere is the config.toml I am using, full of static nodes:\r\n\r\nsee attached [geth-config.txt](https://github.com/ethereum/go-ethereum/files/8838792/geth-config.txt)\r\n\r\n\r\n#### Epilogue\r\n\r\nPlease feel free to ask me for any more logs or if there is a better way to capture backtrace from Geth, I appreciate all info!",
  "closed_by": {
    "login": "connectnorganize",
    "id": 106855990,
    "node_id": "U_kgDOBl5-Ng",
    "avatar_url": "https://avatars.githubusercontent.com/u/106855990?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/connectnorganize",
    "html_url": "https://github.com/connectnorganize",
    "followers_url": "https://api.github.com/users/connectnorganize/followers",
    "following_url": "https://api.github.com/users/connectnorganize/following{/other_user}",
    "gists_url": "https://api.github.com/users/connectnorganize/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/connectnorganize/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/connectnorganize/subscriptions",
    "organizations_url": "https://api.github.com/users/connectnorganize/orgs",
    "repos_url": "https://api.github.com/users/connectnorganize/repos",
    "events_url": "https://api.github.com/users/connectnorganize/events{/privacy}",
    "received_events_url": "https://api.github.com/users/connectnorganize/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25028/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 1,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25028/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1146733083",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25028#issuecomment-1146733083",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25028",
    "id": 1146733083,
    "node_id": "IC_kwDOAOvK985EWcIb",
    "user": {
      "login": "connectnorganize",
      "id": 106855990,
      "node_id": "U_kgDOBl5-Ng",
      "avatar_url": "https://avatars.githubusercontent.com/u/106855990?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/connectnorganize",
      "html_url": "https://github.com/connectnorganize",
      "followers_url": "https://api.github.com/users/connectnorganize/followers",
      "following_url": "https://api.github.com/users/connectnorganize/following{/other_user}",
      "gists_url": "https://api.github.com/users/connectnorganize/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/connectnorganize/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/connectnorganize/subscriptions",
      "organizations_url": "https://api.github.com/users/connectnorganize/orgs",
      "repos_url": "https://api.github.com/users/connectnorganize/repos",
      "events_url": "https://api.github.com/users/connectnorganize/events{/privacy}",
      "received_events_url": "https://api.github.com/users/connectnorganize/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-05T03:21:57Z",
    "updated_at": "2022-06-05T03:21:57Z",
    "author_association": "NONE",
    "body": "##### Update\r\n\r\nThe problem does not persist if I start a new \"chaindata\" directory and start syncing again from the beginning - obviously I'd rather not to but I will if I have to!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1146733083/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1148519925",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25028#issuecomment-1148519925",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25028",
    "id": 1148519925,
    "node_id": "IC_kwDOAOvK985EdQX1",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-07T11:06:19Z",
    "updated_at": "2022-06-07T11:06:19Z",
    "author_association": "MEMBER",
    "body": "Geth says your machine doesn't have 16GB RAM:\r\n\r\n`WARN [06-04|03:37:38.191] Sanitizing cache to Go's GC limits       provided=4096 updated=1391`\r\n\r\nGeth self-limits to 1/3rd max memory usage (since Go likes to go over this limit by 2x). Given that the self imposed limit is 1391MB, it means Geth sees only 4GB of available RAM.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1148519925/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1148799150",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25028#issuecomment-1148799150",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25028",
    "id": 1148799150,
    "node_id": "IC_kwDOAOvK985EeUiu",
    "user": {
      "login": "connectnorganize",
      "id": 106855990,
      "node_id": "U_kgDOBl5-Ng",
      "avatar_url": "https://avatars.githubusercontent.com/u/106855990?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/connectnorganize",
      "html_url": "https://github.com/connectnorganize",
      "followers_url": "https://api.github.com/users/connectnorganize/followers",
      "following_url": "https://api.github.com/users/connectnorganize/following{/other_user}",
      "gists_url": "https://api.github.com/users/connectnorganize/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/connectnorganize/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/connectnorganize/subscriptions",
      "organizations_url": "https://api.github.com/users/connectnorganize/orgs",
      "repos_url": "https://api.github.com/users/connectnorganize/repos",
      "events_url": "https://api.github.com/users/connectnorganize/events{/privacy}",
      "received_events_url": "https://api.github.com/users/connectnorganize/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-07T15:05:12Z",
    "updated_at": "2022-06-07T15:08:22Z",
    "author_association": "NONE",
    "body": "I think this is part of Qubes's memory management system as my available memory raises as Geth runs. You can see here I start the session with 5G but it ends with 11G as Geth takes up more memory, more memory gets allotted to the VM by the Qubes manager:\r\n\r\n(I've tried turning this off and running the VM with a static amount of memory but I got the same result)\r\n\r\nAt the start of \"geth --config config.toml --verbosty 5 --nodiscover\":\r\n![Screenshot_2022-06-07_10-09-52](https://user-images.githubusercontent.com/106855990/172414380-d5e6e96a-3335-4677-925c-f79a1c734135.png)\r\n\r\n\r\n3 minutes later:\r\n![Screenshot_2022-06-07_10-12-41](https://user-images.githubusercontent.com/106855990/172414463-6c74c931-2040-4838-9565-33c0af6a8cd2.png)\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1148799150/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1148825413",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25028#issuecomment-1148825413",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25028",
    "id": 1148825413,
    "node_id": "IC_kwDOAOvK985Eea9F",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-07T15:27:14Z",
    "updated_at": "2022-06-07T15:27:14Z",
    "author_association": "MEMBER",
    "body": "> (I've tried turning this off and running the VM with a static amount of memory but I got the same result)\r\n\r\nUse the Qube Manager, Qube Settings, Memory/CPU and there you can modify Initial memory and Max memory. \r\n\r\nBut I don't really think it's a qubes-related problem. Rather the opposite: geth tries to limit itself to 1.3Gb, but still blows up at 11GB? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1148825413/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1180774548",
    "html_url": "https://github.com/ethereum/go-ethereum/issues/25028#issuecomment-1180774548",
    "issue_url": "https://api.github.com/repos/ethereum/go-ethereum/issues/25028",
    "id": 1180774548,
    "node_id": "IC_kwDOAOvK985GYTCU",
    "user": {
      "login": "connectnorganize",
      "id": 106855990,
      "node_id": "U_kgDOBl5-Ng",
      "avatar_url": "https://avatars.githubusercontent.com/u/106855990?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/connectnorganize",
      "html_url": "https://github.com/connectnorganize",
      "followers_url": "https://api.github.com/users/connectnorganize/followers",
      "following_url": "https://api.github.com/users/connectnorganize/following{/other_user}",
      "gists_url": "https://api.github.com/users/connectnorganize/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/connectnorganize/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/connectnorganize/subscriptions",
      "organizations_url": "https://api.github.com/users/connectnorganize/orgs",
      "repos_url": "https://api.github.com/users/connectnorganize/repos",
      "events_url": "https://api.github.com/users/connectnorganize/events{/privacy}",
      "received_events_url": "https://api.github.com/users/connectnorganize/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-11T19:19:55Z",
    "updated_at": "2022-07-11T19:19:55Z",
    "author_association": "NONE",
    "body": "I did delete my chaindata folder and was able to re-sync with no issues so I will close this. There is probably a bug here, but not a big one. Thank you for helping me!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum/go-ethereum/issues/comments/1180774548/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
