{
  "url": "https://api.github.com/repos/flashbots/mev-boost/issues/116",
  "repository_url": "https://api.github.com/repos/flashbots/mev-boost",
  "labels_url": "https://api.github.com/repos/flashbots/mev-boost/issues/116/labels{/name}",
  "comments_url": "https://api.github.com/repos/flashbots/mev-boost/issues/116/comments",
  "events_url": "https://api.github.com/repos/flashbots/mev-boost/issues/116/events",
  "html_url": "https://github.com/flashbots/mev-boost/issues/116",
  "id": 1223389381,
  "node_id": "I_kwDOGZSKs85I63DF",
  "number": 116,
  "title": "Data races in GetHeaderV1 and RegisterValidatorV1",
  "user": {
    "login": "0xpanoramix",
    "id": 61348595,
    "node_id": "MDQ6VXNlcjYxMzQ4NTk1",
    "avatar_url": "https://avatars.githubusercontent.com/u/61348595?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0xpanoramix",
    "html_url": "https://github.com/0xpanoramix",
    "followers_url": "https://api.github.com/users/0xpanoramix/followers",
    "following_url": "https://api.github.com/users/0xpanoramix/following{/other_user}",
    "gists_url": "https://api.github.com/users/0xpanoramix/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0xpanoramix/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0xpanoramix/subscriptions",
    "organizations_url": "https://api.github.com/users/0xpanoramix/orgs",
    "repos_url": "https://api.github.com/users/0xpanoramix/repos",
    "events_url": "https://api.github.com/users/0xpanoramix/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0xpanoramix/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-05-02T21:38:04Z",
  "updated_at": "2022-05-03T11:34:42Z",
  "closed_at": "2022-05-03T11:34:42Z",
  "author_association": "COLLABORATOR",
  "active_lock_reason": null,
  "body": "## The GetHeaderV1 and RegisterValidatorV1 methods reports data races when running tests\r\n\r\n### Description\r\n\r\nI was running the tests and having a look at the code in the `service.go` file while I discovered something strange.\r\nIt appeared that there was some pieces of the code where a data race could occur, so I decided to run the tests using the `-race` flag and I found a few of them.\r\n\r\n### Your environment\r\n\r\n* **OS and version**: macOS Monterey v12.3.1\r\n* **branch/commit hash that causes this issue**: 79f11e0712e9e2b895133c4600d0b922cfbecebd\r\n\r\n### Steps to reproduce\r\n\r\n* How to reproduce this issue ?<br />\r\nI ran the tests using the following command :\r\n```shell\r\ngo test ./... -v -race\r\n```\r\n\r\n* Where the issue is ?<br />\r\nThere are actually several sub-issues causing the data races :\r\n1. When spawning goroutines to query the relayers in both `GetHeaderV1` and `RegisterValidatorV1`, some values can be written at the same time by multiple goroutines\r\n2. The mockserver does not have a data race protection for its `RequestCounter`\r\n\r\n### Expected behaviour\r\nThe tests should pass without any data race.\r\n\r\n### Actual behaviour\r\nThere were several data races. More below.\r\n\r\n### Logs\r\n\r\n```shell\r\n?       github.com/flashbots/mev-boost/cmd/mev-boost    [no test files]\r\n=== RUN   TestE2E_RegisterValidator\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c0002eb63f by goroutine 21:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).RegisterValidatorV1.func1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:141 +0x7ac\r\n  github.com/flashbots/mev-boost/server.(*BoostService).RegisterValidatorV1.func2()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:142 +0x58\r\n\r\nPrevious write at 0x00c0002eb63f by goroutine 22:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).RegisterValidatorV1.func1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:141 +0x85c\r\n  github.com/flashbots/mev-boost/server.(*BoostService).RegisterValidatorV1.func2()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:142 +0x58\r\n\r\nGoroutine 21 (running) created at:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).RegisterValidatorV1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:117 +0x6b4\r\n  runtime.call128()\r\n      /Users/ptitluca/go/go1.18.1/src/runtime/asm_arm64.s:510 +0x78\r\n  reflect.Value.Call()\r\n      /Users/ptitluca/go/go1.18.1/src/reflect/value.go:339 +0x94\r\n  github.com/ethereum/go-ethereum/rpc.(*callback).call()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/service.go:206 +0x510\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).runMethod()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:389 +0x74\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCall()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:337 +0x2c0\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:298 +0x2c4\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleMsg.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:139 +0x44\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:226 +0x148\r\n\r\nGoroutine 22 (finished) created at:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).RegisterValidatorV1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:117 +0x6b4\r\n  runtime.call128()\r\n      /Users/ptitluca/go/go1.18.1/src/runtime/asm_arm64.s:510 +0x78\r\n  reflect.Value.Call()\r\n      /Users/ptitluca/go/go1.18.1/src/reflect/value.go:339 +0x94\r\n  github.com/ethereum/go-ethereum/rpc.(*callback).call()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/service.go:206 +0x510\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).runMethod()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:389 +0x74\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCall()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:337 +0x2c0\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:298 +0x2c4\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleMsg.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:139 +0x44\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:226 +0x148\r\n==================\r\ntime=\"2022-05-02T23:34:48+02:00\" level=error msg=\"error unmarshalling response from relay\" error=\"json: cannot unmarshal bool into Go value of type string\" method=builder_registerValidatorV1 prefix=service testing=true url=\"http://127.0.0.1:54905\"\r\ntime=\"2022-05-02T23:34:48+02:00\" level=error msg=\"error unmarshalling response from relay\" error=\"json: cannot unmarshal bool into Go value of type string\" method=builder_registerValidatorV1 prefix=service testing=true url=\"http://127.0.0.1:54905\"\r\ntime=\"2022-05-02T23:34:48+02:00\" level=error msg=\"error unmarshalling response from relay\" error=\"json: cannot unmarshal bool into Go value of type string\" method=builder_registerValidatorV1 prefix=service testing=true url=\"http://127.0.0.1:54906\"\r\nWARN [05-02|23:34:48.773] Served builder_registerValidatorV1       reqid=3 t=\"738.375µs\" err=\"no relay responded true\"\r\n    testing.go:1312: race detected during execution of test\r\n--- FAIL: TestE2E_RegisterValidator (0.01s)\r\n=== RUN   TestE2E_RegisterValidator_Error\r\nWARN [05-02|23:34:48.774] Served builder_registerValidatorV1       reqid=1 t=\"49.167µs\"  err=\"invalid argument 0: json: cannot unmarshal string into Go value of type types.RegisterValidatorRequestMessage\"\r\nWARN [05-02|23:34:48.774] Served builder_registerValidatorV1       reqid=2 t=\"27.666µs\"  err=\"invalid argument 0: json: cannot unmarshal string into Go value of type types.RegisterValidatorRequestMessage\"\r\nWARN [05-02|23:34:48.775] Served builder_registerValidatorV1       reqid=3 t=\"24.208µs\"  err=\"invalid argument 0: json: cannot unmarshal string into Go value of type types.RegisterValidatorRequestMessage\"\r\nWARN [05-02|23:34:48.775] Served builder_registerValidatorV1       reqid=4 t=\"84.042µs\"  err=\"invalid signature\"\r\ntime=\"2022-05-02T23:34:48+02:00\" level=warning msg=\"error reply from relay\" error=\"test error\" method=builder_registerValidatorV1 prefix=service testing=true url=\"http://127.0.0.1:54909\"\r\nWARN [05-02|23:34:48.777] Served builder_registerValidatorV1       reqid=5 t=\"955.459µs\" err=\"test error\"\r\n--- PASS: TestE2E_RegisterValidator_Error (0.00s)\r\n=== RUN   Test_RelayErrorCodePassthrough\r\ntime=\"2022-05-02T23:34:48+02:00\" level=warning msg=\"error reply from relay\" error=\"test error\" method=builder_registerValidatorV1 prefix=service testing=true url=\"http://127.0.0.1:54911\"\r\nWARN [05-02|23:34:48.778] Served builder_registerValidatorV1       reqid=1 t=1.050875ms  err=\"test error\"\r\n--- PASS: Test_RelayErrorCodePassthrough (0.00s)\r\n=== RUN   TestE2E_RegisterValidator_RelayError\r\ntime=\"2022-05-02T23:34:48+02:00\" level=warning msg=\"error reply from relay\" error=\"test error\" method=builder_registerValidatorV1 prefix=service testing=true url=\"http://127.0.0.1:54914\"\r\ntime=\"2022-05-02T23:34:48+02:00\" level=warning msg=\"error reply from relay\" error=\"test error\" method=builder_registerValidatorV1 prefix=service testing=true url=\"http://127.0.0.1:54913\"\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c0001f01f0 by goroutine 88:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).RegisterValidatorV1.func1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:128 +0x55c\r\n  github.com/flashbots/mev-boost/server.(*BoostService).RegisterValidatorV1.func2()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:142 +0x58\r\n\r\nPrevious write at 0x00c0001f01f0 by goroutine 89:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).RegisterValidatorV1.func1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:128 +0x55c\r\n  github.com/flashbots/mev-boost/server.(*BoostService).RegisterValidatorV1.func2()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:142 +0x58\r\n\r\nGoroutine 88 (running) created at:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).RegisterValidatorV1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:117 +0x6b4\r\n  runtime.call128()\r\n      /Users/ptitluca/go/go1.18.1/src/runtime/asm_arm64.s:510 +0x78\r\n  reflect.Value.Call()\r\n      /Users/ptitluca/go/go1.18.1/src/reflect/value.go:339 +0x94\r\n  github.com/ethereum/go-ethereum/rpc.(*callback).call()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/service.go:206 +0x510\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).runMethod()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:389 +0x74\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCall()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:337 +0x2c0\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:298 +0x2c4\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleMsg.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:139 +0x44\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:226 +0x148\r\n\r\nGoroutine 89 (finished) created at:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).RegisterValidatorV1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:117 +0x6b4\r\n  runtime.call128()\r\n      /Users/ptitluca/go/go1.18.1/src/runtime/asm_arm64.s:510 +0x78\r\n  reflect.Value.Call()\r\n      /Users/ptitluca/go/go1.18.1/src/reflect/value.go:339 +0x94\r\n  github.com/ethereum/go-ethereum/rpc.(*callback).call()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/service.go:206 +0x510\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).runMethod()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:389 +0x74\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCall()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:337 +0x2c0\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:298 +0x2c4\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleMsg.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:139 +0x44\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:226 +0x148\r\n==================\r\nWARN [05-02|23:34:48.781] Served builder_registerValidatorV1       reqid=1 t=1.319541ms  err=\"test error\"\r\n    testing.go:1312: race detected during execution of test\r\n--- FAIL: TestE2E_RegisterValidator_RelayError (0.00s)\r\n=== RUN   TestE2E_GetHeader\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c0000a4188 by goroutine 104:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:199 +0x664\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func2()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:212 +0x58\r\n\r\nPrevious write at 0x00c0000a4188 by goroutine 105:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:204 +0x70c\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func2()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:212 +0x58\r\n\r\nGoroutine 104 (running) created at:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:175 +0x810\r\n  runtime.call128()\r\n      /Users/ptitluca/go/go1.18.1/src/runtime/asm_arm64.s:510 +0x78\r\n  reflect.Value.Call()\r\n      /Users/ptitluca/go/go1.18.1/src/reflect/value.go:339 +0x94\r\n  github.com/ethereum/go-ethereum/rpc.(*callback).call()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/service.go:206 +0x510\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).runMethod()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:389 +0x74\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCall()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:337 +0x2c0\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:298 +0x2c4\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleMsg.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:139 +0x44\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:226 +0x148\r\n\r\nGoroutine 105 (running) created at:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:175 +0x810\r\n  runtime.call128()\r\n      /Users/ptitluca/go/go1.18.1/src/runtime/asm_arm64.s:510 +0x78\r\n  reflect.Value.Call()\r\n      /Users/ptitluca/go/go1.18.1/src/reflect/value.go:339 +0x94\r\n  github.com/ethereum/go-ethereum/rpc.(*callback).call()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/service.go:206 +0x510\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).runMethod()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:389 +0x74\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCall()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:337 +0x2c0\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:298 +0x2c4\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleMsg.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:139 +0x44\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:226 +0x148\r\n==================\r\ntime=\"2022-05-02T23:34:48+02:00\" level=info msg=\"GetPayloadHeaderV1: successfully got more valuable payload header\" blockHash=0x0000000000000000000000000000000000000000000000000000000000000001 blockNumber=0 method=builder_getHeaderV1 prefix=service testing=true txRoot=0x0000000000000000000000000000000000000000000000000000000000000000 url=\"http://127.0.0.1:54918\" value=0xbc614e\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c0001a8430 by goroutine 104:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:199 +0x67c\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func2()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:212 +0x58\r\n\r\nPrevious write at 0x00c0001a8430 by goroutine 105:\r\n  reflect.Value.Set()\r\n      /Users/ptitluca/go/go1.18.1/src/reflect/value.go:2096 +0x110\r\n  encoding/json.indirect()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:475 +0x37c\r\n  encoding/json.(*decodeState).literalStore()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:869 +0x1ac\r\n  encoding/json.(*decodeState).value()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:387 +0x1a0\r\n  encoding/json.(*decodeState).object()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:774 +0xe00\r\n  encoding/json.(*decodeState).value()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:373 +0x78\r\n  encoding/json.(*decodeState).object()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:774 +0xe00\r\n  encoding/json.(*decodeState).value()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:373 +0x78\r\n  encoding/json.(*decodeState).unmarshal()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:180 +0x358\r\n  encoding/json.Unmarshal()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:107 +0x1e8\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:192 +0x658\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func2()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:212 +0x58\r\n\r\nGoroutine 104 (running) created at:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:175 +0x810\r\n  runtime.call128()\r\n      /Users/ptitluca/go/go1.18.1/src/runtime/asm_arm64.s:510 +0x78\r\n  reflect.Value.Call()\r\n      /Users/ptitluca/go/go1.18.1/src/reflect/value.go:339 +0x94\r\n  github.com/ethereum/go-ethereum/rpc.(*callback).call()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/service.go:206 +0x510\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).runMethod()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:389 +0x74\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCall()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:337 +0x2c0\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:298 +0x2c4\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleMsg.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:139 +0x44\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:226 +0x148\r\n\r\nGoroutine 105 (finished) created at:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:175 +0x810\r\n  runtime.call128()\r\n      /Users/ptitluca/go/go1.18.1/src/runtime/asm_arm64.s:510 +0x78\r\n  reflect.Value.Call()\r\n      /Users/ptitluca/go/go1.18.1/src/reflect/value.go:339 +0x94\r\n  github.com/ethereum/go-ethereum/rpc.(*callback).call()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/service.go:206 +0x510\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).runMethod()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:389 +0x74\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCall()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:337 +0x2c0\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:298 +0x2c4\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleMsg.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:139 +0x44\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:226 +0x148\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c00016d880 by goroutine 104:\r\n  math/big.(*Int).Cmp()\r\n      /Users/ptitluca/go/go1.18.1/src/math/big/int.go:328 +0x60\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:199 +0x6f0\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func2()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:212 +0x58\r\n\r\nPrevious write at 0x00c00016d880 by goroutine 105:\r\n  github.com/ethereum/go-ethereum/common/hexutil.(*Big).UnmarshalText()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/common/hexutil/json.go:195 +0x3d8\r\n  github.com/ethereum/go-ethereum/common/hexutil.(*Big).UnmarshalJSON()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/common/hexutil/json.go:164 +0xc0\r\n  encoding/json.(*decodeState).literalStore()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:871 +0x2850\r\n  encoding/json.(*decodeState).value()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:387 +0x1a0\r\n  encoding/json.(*decodeState).object()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:774 +0xe00\r\n  encoding/json.(*decodeState).value()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:373 +0x78\r\n  encoding/json.(*decodeState).object()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:774 +0xe00\r\n  encoding/json.(*decodeState).value()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:373 +0x78\r\n  encoding/json.(*decodeState).unmarshal()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:180 +0x358\r\n  encoding/json.Unmarshal()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:107 +0x1e8\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:192 +0x658\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func2()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:212 +0x58\r\n\r\nGoroutine 104 (running) created at:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:175 +0x810\r\n  runtime.call128()\r\n      /Users/ptitluca/go/go1.18.1/src/runtime/asm_arm64.s:510 +0x78\r\n  reflect.Value.Call()\r\n      /Users/ptitluca/go/go1.18.1/src/reflect/value.go:339 +0x94\r\n  github.com/ethereum/go-ethereum/rpc.(*callback).call()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/service.go:206 +0x510\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).runMethod()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:389 +0x74\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCall()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:337 +0x2c0\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:298 +0x2c4\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleMsg.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:139 +0x44\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:226 +0x148\r\n\r\nGoroutine 105 (finished) created at:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:175 +0x810\r\n  runtime.call128()\r\n      /Users/ptitluca/go/go1.18.1/src/runtime/asm_arm64.s:510 +0x78\r\n  reflect.Value.Call()\r\n      /Users/ptitluca/go/go1.18.1/src/reflect/value.go:339 +0x94\r\n  github.com/ethereum/go-ethereum/rpc.(*callback).call()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/service.go:206 +0x510\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).runMethod()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:389 +0x74\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCall()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:337 +0x2c0\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:298 +0x2c4\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleMsg.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:139 +0x44\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:226 +0x148\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c00016d888 by goroutine 104:\r\n  math/big.(*Int).Cmp()\r\n      /Users/ptitluca/go/go1.18.1/src/math/big/int.go:329 +0xac\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:199 +0x6f0\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func2()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:212 +0x58\r\n\r\nPrevious write at 0x00c00016d888 by goroutine 105:\r\n  github.com/ethereum/go-ethereum/common/hexutil.(*Big).UnmarshalText()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/common/hexutil/json.go:195 +0x3d8\r\n  github.com/ethereum/go-ethereum/common/hexutil.(*Big).UnmarshalJSON()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/common/hexutil/json.go:164 +0xc0\r\n  encoding/json.(*decodeState).literalStore()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:871 +0x2850\r\n  encoding/json.(*decodeState).value()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:387 +0x1a0\r\n  encoding/json.(*decodeState).object()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:774 +0xe00\r\n  encoding/json.(*decodeState).value()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:373 +0x78\r\n  encoding/json.(*decodeState).object()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:774 +0xe00\r\n  encoding/json.(*decodeState).value()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:373 +0x78\r\n  encoding/json.(*decodeState).unmarshal()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:180 +0x358\r\n  encoding/json.Unmarshal()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:107 +0x1e8\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:192 +0x658\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func2()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:212 +0x58\r\n\r\nGoroutine 104 (running) created at:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:175 +0x810\r\n  runtime.call128()\r\n      /Users/ptitluca/go/go1.18.1/src/runtime/asm_arm64.s:510 +0x78\r\n  reflect.Value.Call()\r\n      /Users/ptitluca/go/go1.18.1/src/reflect/value.go:339 +0x94\r\n  github.com/ethereum/go-ethereum/rpc.(*callback).call()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/service.go:206 +0x510\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).runMethod()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:389 +0x74\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCall()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:337 +0x2c0\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:298 +0x2c4\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleMsg.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:139 +0x44\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:226 +0x148\r\n\r\nGoroutine 105 (finished) created at:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:175 +0x810\r\n  runtime.call128()\r\n      /Users/ptitluca/go/go1.18.1/src/runtime/asm_arm64.s:510 +0x78\r\n  reflect.Value.Call()\r\n      /Users/ptitluca/go/go1.18.1/src/reflect/value.go:339 +0x94\r\n  github.com/ethereum/go-ethereum/rpc.(*callback).call()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/service.go:206 +0x510\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).runMethod()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:389 +0x74\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCall()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:337 +0x2c0\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:298 +0x2c4\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleMsg.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:139 +0x44\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:226 +0x148\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c00058ad58 by goroutine 104:\r\n  math/big.nat.cmp()\r\n      /Users/ptitluca/go/go1.18.1/src/math/big/nat.go:172 +0x128\r\n  math/big.(*Int).Cmp()\r\n      /Users/ptitluca/go/go1.18.1/src/math/big/int.go:329 +0xcc\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:199 +0x6f0\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func2()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:212 +0x58\r\n\r\nPrevious write at 0x00c00058ad58 by goroutine 105:\r\n  github.com/ethereum/go-ethereum/common/hexutil.(*Big).UnmarshalText()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/common/hexutil/json.go:188 +0x474\r\n  github.com/ethereum/go-ethereum/common/hexutil.(*Big).UnmarshalJSON()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/common/hexutil/json.go:164 +0xc0\r\n  encoding/json.(*decodeState).literalStore()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:871 +0x2850\r\n  encoding/json.(*decodeState).value()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:387 +0x1a0\r\n  encoding/json.(*decodeState).object()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:774 +0xe00\r\n  encoding/json.(*decodeState).value()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:373 +0x78\r\n  encoding/json.(*decodeState).object()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:774 +0xe00\r\n  encoding/json.(*decodeState).value()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:373 +0x78\r\n  encoding/json.(*decodeState).unmarshal()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:180 +0x358\r\n  encoding/json.Unmarshal()\r\n      /Users/ptitluca/go/go1.18.1/src/encoding/json/decode.go:107 +0x1e8\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:192 +0x658\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1.func2()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:212 +0x58\r\n\r\nGoroutine 104 (running) created at:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:175 +0x810\r\n  runtime.call128()\r\n      /Users/ptitluca/go/go1.18.1/src/runtime/asm_arm64.s:510 +0x78\r\n  reflect.Value.Call()\r\n      /Users/ptitluca/go/go1.18.1/src/reflect/value.go:339 +0x94\r\n  github.com/ethereum/go-ethereum/rpc.(*callback).call()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/service.go:206 +0x510\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).runMethod()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:389 +0x74\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCall()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:337 +0x2c0\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:298 +0x2c4\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleMsg.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:139 +0x44\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:226 +0x148\r\n\r\nGoroutine 105 (finished) created at:\r\n  github.com/flashbots/mev-boost/server.(*BoostService).GetHeaderV1()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/service.go:175 +0x810\r\n  runtime.call128()\r\n      /Users/ptitluca/go/go1.18.1/src/runtime/asm_arm64.s:510 +0x78\r\n  reflect.Value.Call()\r\n      /Users/ptitluca/go/go1.18.1/src/reflect/value.go:339 +0x94\r\n  github.com/ethereum/go-ethereum/rpc.(*callback).call()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/service.go:206 +0x510\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).runMethod()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:389 +0x74\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCall()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:337 +0x2c0\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:298 +0x2c4\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).handleMsg.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:139 +0x44\r\n  github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1()\r\n      /Users/ptitluca/go/pkg/mod/github.com/!marius!van!der!wijden/go-ethereum@v1.8.22-0.20211208130742-dd90624af970/rpc/handler.go:226 +0x148\r\n==================\r\ntime=\"2022-05-02T23:34:48+02:00\" level=info msg=\"GetPayloadHeaderV1: successfully got more valuable payload header\" blockHash=0x0000000000000000000000000000000000000000000000000000000000000001 blockNumber=0 method=builder_getHeaderV1 prefix=service testing=true txRoot=0x0000000000000000000000000000000000000000000000000000000000000000 url=\"http://127.0.0.1:54917\" value=0x3039\r\ntime=\"2022-05-02T23:34:48+02:00\" level=warning msg=\"error making request to relay\" error=\"Post \\\"http://127.0.0.1:54918\\\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\" method=builder_getHeaderV1 prefix=service testing=true url=\"http://127.0.0.1:54918\"\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c00048a060 by goroutine 7:\r\n  runtime.evacuate_fast64()\r\n      /Users/ptitluca/go/go1.18.1/src/runtime/map_fast64.go:376 +0x3fc\r\n  github.com/flashbots/mev-boost/server.TestE2E_GetHeader()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/e2e_test.go:317 +0xdc8\r\n  testing.tRunner()\r\n      /Users/ptitluca/go/go1.18.1/src/testing/testing.go:1439 +0x18c\r\n  testing.(*T).Run.func1()\r\n      /Users/ptitluca/go/go1.18.1/src/testing/testing.go:1486 +0x44\r\n\r\nPrevious write at 0x00c00048a060 by goroutine 24:\r\n  runtime.mapaccess2_faststr()\r\n      /Users/ptitluca/go/go1.18.1/src/runtime/map_faststr.go:108 +0x43c\r\n  github.com/flashbots/go-utils/jsonrpc.(*MockJSONRPCServer).handleHTTPRequest()\r\n      /Users/ptitluca/go/pkg/mod/github.com/flashbots/go-utils@v0.4.1-0.20220413084516-2fd58ecf7ff9/jsonrpc/mockserver.go:64 +0x4d4\r\n  github.com/flashbots/go-utils/jsonrpc.(*MockJSONRPCServer).handleHTTPRequest-fm()\r\n      <autogenerated>:1 +0x50\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /Users/ptitluca/go/go1.18.1/src/net/http/server.go:2084 +0x4c\r\n  net/http.serverHandler.ServeHTTP()\r\n      /Users/ptitluca/go/go1.18.1/src/net/http/server.go:2916 +0x6cc\r\n  net/http.(*conn).serve()\r\n      /Users/ptitluca/go/go1.18.1/src/net/http/server.go:1966 +0x8e0\r\n  net/http.(*Server).Serve.func3()\r\n      /Users/ptitluca/go/go1.18.1/src/net/http/server.go:3071 +0x50\r\n\r\nGoroutine 7 (running) created at:\r\n  testing.(*T).Run()\r\n      /Users/ptitluca/go/go1.18.1/src/testing/testing.go:1486 +0x560\r\n  testing.runTests.func1()\r\n      /Users/ptitluca/go/go1.18.1/src/testing/testing.go:1839 +0x94\r\n  testing.tRunner()\r\n      /Users/ptitluca/go/go1.18.1/src/testing/testing.go:1439 +0x18c\r\n  testing.runTests()\r\n      /Users/ptitluca/go/go1.18.1/src/testing/testing.go:1837 +0x6c8\r\n  testing.(*M).Run()\r\n      /Users/ptitluca/go/go1.18.1/src/testing/testing.go:1719 +0x878\r\n  main.main()\r\n      _testmain.go:61 +0x2fc\r\n\r\nGoroutine 24 (running) created at:\r\n  net/http.(*Server).Serve()\r\n      /Users/ptitluca/go/go1.18.1/src/net/http/server.go:3071 +0x63c\r\n  net/http/httptest.(*Server).goServe.func1()\r\n      /Users/ptitluca/go/go1.18.1/src/net/http/httptest/server.go:308 +0xa0\r\n==================\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c00020aff8 by goroutine 7:\r\n  github.com/flashbots/mev-boost/server.TestE2E_GetHeader()\r\n      /Users/ptitluca/GolandProjects/mev-boost/server/e2e_test.go:317 +0xdd0\r\n  testing.tRunner()\r\n      /Users/ptitluca/go/go1.18.1/src/testing/testing.go:1439 +0x18c\r\n  testing.(*T).Run.func1()\r\n      /Users/ptitluca/go/go1.18.1/src/testing/testing.go:1486 +0x44\r\n\r\nPrevious write at 0x00c00020aff8 by goroutine 24:\r\n  github.com/flashbots/go-utils/jsonrpc.(*MockJSONRPCServer).handleHTTPRequest()\r\n      /Users/ptitluca/go/pkg/mod/github.com/flashbots/go-utils@v0.4.1-0.20220413084516-2fd58ecf7ff9/jsonrpc/mockserver.go:64 +0x4e0\r\n  github.com/flashbots/go-utils/jsonrpc.(*MockJSONRPCServer).handleHTTPRequest-fm()\r\n      <autogenerated>:1 +0x50\r\n  net/http.HandlerFunc.ServeHTTP()\r\n      /Users/ptitluca/go/go1.18.1/src/net/http/server.go:2084 +0x4c\r\n  net/http.serverHandler.ServeHTTP()\r\n      /Users/ptitluca/go/go1.18.1/src/net/http/server.go:2916 +0x6cc\r\n  net/http.(*conn).serve()\r\n      /Users/ptitluca/go/go1.18.1/src/net/http/server.go:1966 +0x8e0\r\n  net/http.(*Server).Serve.func3()\r\n      /Users/ptitluca/go/go1.18.1/src/net/http/server.go:3071 +0x50\r\n\r\nGoroutine 7 (running) created at:\r\n  testing.(*T).Run()\r\n      /Users/ptitluca/go/go1.18.1/src/testing/testing.go:1486 +0x560\r\n  testing.runTests.func1()\r\n      /Users/ptitluca/go/go1.18.1/src/testing/testing.go:1839 +0x94\r\n  testing.tRunner()\r\n      /Users/ptitluca/go/go1.18.1/src/testing/testing.go:1439 +0x18c\r\n  testing.runTests()\r\n      /Users/ptitluca/go/go1.18.1/src/testing/testing.go:1837 +0x6c8\r\n  testing.(*M).Run()\r\n      /Users/ptitluca/go/go1.18.1/src/testing/testing.go:1719 +0x878\r\n  main.main()\r\n      _testmain.go:61 +0x2fc\r\n\r\nGoroutine 24 (running) created at:\r\n  net/http.(*Server).Serve()\r\n      /Users/ptitluca/go/go1.18.1/src/net/http/server.go:3071 +0x63c\r\n  net/http/httptest.(*Server).goServe.func1()\r\n      /Users/ptitluca/go/go1.18.1/src/net/http/httptest/server.go:308 +0xa0\r\n==================\r\n    testing.go:1312: race detected during execution of test\r\n--- FAIL: TestE2E_GetHeader (0.11s)\r\n=== RUN   TestE2E_GetHeaderError\r\nWARN [05-02|23:34:48.890] Served builder_getHeaderV1               reqid=1 t=\"104µs\"     err=\"invalid pubkey\"\r\n--- PASS: TestE2E_GetHeaderError (0.00s)\r\n=== RUN   TestE2E_GetPayload\r\ntime=\"2022-05-02T23:34:48+02:00\" level=info msg=\"GetPayloadV1: received payload from relay\" blockHash=0x0000000000000000000000000000000000000000000000000000000000000001 method=builder_getPayloadV1 number=0 prefix=service testing=true url=\"http://127.0.0.1:54922\"\r\n--- PASS: TestE2E_GetPayload (0.01s)\r\n=== RUN   TestE2E_Status\r\n--- PASS: TestE2E_Status (0.00s)\r\n=== CONT  \r\n    testing.go:1312: race detected during execution of test\r\nFAIL\r\nFAIL    github.com/flashbots/mev-boost/server   0.371s\r\n?       github.com/flashbots/mev-boost/types    [no test files]\r\nFAIL\r\n\r\n```\r\n\r\n### Proposed solution\r\n\r\nReading and writing to `lastRelayError` and `ok` in `RegisterValidatorV1` should be protected by a mutex.\r\nSame for `lastRelayError` and `result` in `GetHeaderV1`.\r\n\r\nI've created a PR to fix these issues in #117 .\r\nI also have created a PR in the go-utils repository to prevent concurrent read/write in the request counter. Available [here](https://github.com/flashbots/go-utils/pull/10)",
  "closed_by": {
    "login": "metachris",
    "id": 116939,
    "node_id": "MDQ6VXNlcjExNjkzOQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/116939?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/metachris",
    "html_url": "https://github.com/metachris",
    "followers_url": "https://api.github.com/users/metachris/followers",
    "following_url": "https://api.github.com/users/metachris/following{/other_user}",
    "gists_url": "https://api.github.com/users/metachris/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/metachris/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/metachris/subscriptions",
    "organizations_url": "https://api.github.com/users/metachris/orgs",
    "repos_url": "https://api.github.com/users/metachris/repos",
    "events_url": "https://api.github.com/users/metachris/events{/privacy}",
    "received_events_url": "https://api.github.com/users/metachris/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/flashbots/mev-boost/issues/116/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/flashbots/mev-boost/issues/116/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/flashbots/mev-boost/issues/comments/1115997627",
    "html_url": "https://github.com/flashbots/mev-boost/issues/116#issuecomment-1115997627",
    "issue_url": "https://api.github.com/repos/flashbots/mev-boost/issues/116",
    "id": 1115997627,
    "node_id": "IC_kwDOGZSKs85ChMW7",
    "user": {
      "login": "metachris",
      "id": 116939,
      "node_id": "MDQ6VXNlcjExNjkzOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/116939?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/metachris",
      "html_url": "https://github.com/metachris",
      "followers_url": "https://api.github.com/users/metachris/followers",
      "following_url": "https://api.github.com/users/metachris/following{/other_user}",
      "gists_url": "https://api.github.com/users/metachris/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/metachris/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/metachris/subscriptions",
      "organizations_url": "https://api.github.com/users/metachris/orgs",
      "repos_url": "https://api.github.com/users/metachris/repos",
      "events_url": "https://api.github.com/users/metachris/events{/privacy}",
      "received_events_url": "https://api.github.com/users/metachris/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-03T11:34:41Z",
    "updated_at": "2022-05-03T11:34:41Z",
    "author_association": "COLLABORATOR",
    "body": "Fixed by #117 ",
    "reactions": {
      "url": "https://api.github.com/repos/flashbots/mev-boost/issues/comments/1115997627/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
