{
  "url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/412",
  "repository_url": "https://api.github.com/repos/flashbots/mev-boost-relay",
  "labels_url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/412/labels{/name}",
  "comments_url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/412/comments",
  "events_url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/412/events",
  "html_url": "https://github.com/flashbots/mev-boost-relay/issues/412",
  "id": 1714133662,
  "node_id": "I_kwDOHXha9s5mK5qe",
  "number": 412,
  "title": "Housekeeper failed to fetch validators, timeout",
  "user": {
    "login": "austonst",
    "id": 1329703,
    "node_id": "MDQ6VXNlcjEzMjk3MDM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1329703?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/austonst",
    "html_url": "https://github.com/austonst",
    "followers_url": "https://api.github.com/users/austonst/followers",
    "following_url": "https://api.github.com/users/austonst/following{/other_user}",
    "gists_url": "https://api.github.com/users/austonst/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/austonst/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/austonst/subscriptions",
    "organizations_url": "https://api.github.com/users/austonst/orgs",
    "repos_url": "https://api.github.com/users/austonst/repos",
    "events_url": "https://api.github.com/users/austonst/events{/privacy}",
    "received_events_url": "https://api.github.com/users/austonst/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4150750264,
      "node_id": "LA_kwDOHXha9s73Z2w4",
      "url": "https://api.github.com/repos/flashbots/mev-boost-relay/labels/%F0%9F%90%9B%20bug",
      "name": "üêõ bug",
      "color": "d73a4a",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 5515158001,
      "node_id": "LA_kwDOHXha9s8AAAABSLqh8Q",
      "url": "https://api.github.com/repos/flashbots/mev-boost-relay/labels/%E2%9C%85%20fixed",
      "name": "‚úÖ fixed",
      "color": "2D0984",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-05-17T15:13:36Z",
  "updated_at": "2023-05-17T20:21:31Z",
  "closed_at": "2023-05-17T20:21:31Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\nAfter merging commits 273706c4b271796f90f36ad4c4f0f0b1f9c7642c to 6e47cf78a819ceef8367bf609138fd73f897e8ca (inclusive) to our branch and starting to test on Goerli, we encountered the following error on our housekeeper instance (an excerpt, showing two of our beacon nodes):\r\n```time=\"2023-05-17T14:33:06Z\" level=info msg=\"Querying validators from beacon node... (this may take a while)\" headSlot=5652165 headSlotPos=6 lastUpdateSlot=0 method=updateKnownValidators service=relay/housekeeper version=\r\ntime=\"2023-05-17T14:33:11Z\" level=error msg=\"failed to fetch validators\" component=beaconClient error=\"client refused for http://geth-prysm-0.geth-prysm.goerli.svc.cluster.local:3500/eth/v1/beacon/states/head/validators?status=active,pending: Get \\\"http://geth-prysm-0.geth-prysm.goerli.svc.cluster.local:3500/eth/v1/beacon/states/head/validators?status=active,pending\\\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\" service=relay/housekeeper uri=\"http://geth-prysm-0.geth-prysm.goerli.svc.cluster.local:3500\" version=\r\ntime=\"2023-05-17T14:33:16Z\" level=error msg=\"failed to fetch validators\" component=beaconClient error=\"client refused for http://10.108.0.12:3500/eth/v1/beacon/states/head/validators?status=active,pending: Get \\\"http://10.108.0.12:3500/eth/v1/beacon/states/head/validators?status=active,pending\\\": context deadline exceeded (Client.Timeout exceeded while awaiting headers)\" service=relay/housekeeper uri=\"http://10.108.0.12:3500\" version=\r\ntime=\"2023-05-17T14:33:16Z\" level=error msg=\"failed to fetch validators from all beacon nodes\" error=\"all beacon nodes responded with error\" headSlot=5652165 headSlotPos=6 lastUpdateSlot=0 method=updateKnownValidators service=relay/housekeeper version=\r\n```\r\n\r\nRunning on an image whose most recent upstream commit is e6387e5cf7303a40ca999ab2515599c4b7f3c89e (older), we are able to successfully retrieve validators, e.g.:\r\n`time=\"2023-05-17T14:49:21Z\" level=info msg=\"received validators from beacon-node\" durationFetchValidatorsMs=16121 headSlot=5652244 headSlotPos=21 lastUpdateSlot=0 method=updateKnownValidators numKnownValidators=457864 service=relay/housekeeper version=`\r\n\r\nFetching the full validator set on Goerli takes us 16-20s. About 32s on mainnet.\r\n\r\n**Analysis**\r\n273706c4b271796f90f36ad4c4f0f0b1f9c7642c implements a 5-second timeout for beacon client requests ([here](https://github.com/flashbots/mev-boost-relay/blob/273706c4b271796f90f36ad4c4f0f0b1f9c7642c/beaconclient/util.go#L22)). This seems to be the source of the issue: a recompiled version with this timeout set to 60s is able to fetch validators correctly as usual.\r\n\r\nIs there a particular reason why this timeout was implemented, and does it need to be so short? Have other relays updated to run this code, and have they run into similar issues?\r\n\r\nIf a 5-second timeout is desirable in general, perhaps the housekeeper could override it (or use a different http.Client) for fetching validators.\r\n\r\n**Which version are you using:**\r\n- OS: Kubernetes/Docker\r\n- Relay: Commits in question are described above, though note [our changes running on top](https://github.com/aestus-relay/mev-boost-relay/tree/redis-cluster). Config can be found [on our repo here](https://github.com/aestus-relay/kubernetes-config/blob/main/goerli/relay/housekeeper.yml).\r\n",
  "closed_by": {
    "login": "metachris",
    "id": 116939,
    "node_id": "MDQ6VXNlcjExNjkzOQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/116939?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/metachris",
    "html_url": "https://github.com/metachris",
    "followers_url": "https://api.github.com/users/metachris/followers",
    "following_url": "https://api.github.com/users/metachris/following{/other_user}",
    "gists_url": "https://api.github.com/users/metachris/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/metachris/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/metachris/subscriptions",
    "organizations_url": "https://api.github.com/users/metachris/orgs",
    "repos_url": "https://api.github.com/users/metachris/repos",
    "events_url": "https://api.github.com/users/metachris/events{/privacy}",
    "received_events_url": "https://api.github.com/users/metachris/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/412/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/412/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/comments/1551887505",
    "html_url": "https://github.com/flashbots/mev-boost-relay/issues/412#issuecomment-1551887505",
    "issue_url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/412",
    "id": 1551887505,
    "node_id": "IC_kwDOHXha9s5cf-yR",
    "user": {
      "login": "metachris",
      "id": 116939,
      "node_id": "MDQ6VXNlcjExNjkzOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/116939?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/metachris",
      "html_url": "https://github.com/metachris",
      "followers_url": "https://api.github.com/users/metachris/followers",
      "following_url": "https://api.github.com/users/metachris/following{/other_user}",
      "gists_url": "https://api.github.com/users/metachris/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/metachris/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/metachris/subscriptions",
      "organizations_url": "https://api.github.com/users/metachris/orgs",
      "repos_url": "https://api.github.com/users/metachris/repos",
      "events_url": "https://api.github.com/users/metachris/events{/privacy}",
      "received_events_url": "https://api.github.com/users/metachris/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-17T18:43:09Z",
    "updated_at": "2023-05-17T18:43:09Z",
    "author_association": "COLLABORATOR",
    "body": "oh, thanks for the comment, looking into it!",
    "reactions": {
      "url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/comments/1551887505/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/comments/1551904733",
    "html_url": "https://github.com/flashbots/mev-boost-relay/issues/412#issuecomment-1551904733",
    "issue_url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/412",
    "id": 1551904733,
    "node_id": "IC_kwDOHXha9s5cgC_d",
    "user": {
      "login": "metachris",
      "id": 116939,
      "node_id": "MDQ6VXNlcjExNjkzOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/116939?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/metachris",
      "html_url": "https://github.com/metachris",
      "followers_url": "https://api.github.com/users/metachris/followers",
      "following_url": "https://api.github.com/users/metachris/following{/other_user}",
      "gists_url": "https://api.github.com/users/metachris/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/metachris/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/metachris/subscriptions",
      "organizations_url": "https://api.github.com/users/metachris/orgs",
      "repos_url": "https://api.github.com/users/metachris/repos",
      "events_url": "https://api.github.com/users/metachris/events{/privacy}",
      "received_events_url": "https://api.github.com/users/metachris/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-17T18:58:34Z",
    "updated_at": "2023-05-17T18:58:34Z",
    "author_association": "COLLABORATOR",
    "body": "Testing https://github.com/flashbots/mev-boost-relay/pull/414/files in Goerli and Sepolia",
    "reactions": {
      "url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/comments/1551904733/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/comments/1551915385",
    "html_url": "https://github.com/flashbots/mev-boost-relay/issues/412#issuecomment-1551915385",
    "issue_url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/412",
    "id": 1551915385,
    "node_id": "IC_kwDOHXha9s5cgFl5",
    "user": {
      "login": "metachris",
      "id": 116939,
      "node_id": "MDQ6VXNlcjExNjkzOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/116939?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/metachris",
      "html_url": "https://github.com/metachris",
      "followers_url": "https://api.github.com/users/metachris/followers",
      "following_url": "https://api.github.com/users/metachris/following{/other_user}",
      "gists_url": "https://api.github.com/users/metachris/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/metachris/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/metachris/subscriptions",
      "organizations_url": "https://api.github.com/users/metachris/orgs",
      "repos_url": "https://api.github.com/users/metachris/repos",
      "events_url": "https://api.github.com/users/metachris/events{/privacy}",
      "received_events_url": "https://api.github.com/users/metachris/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-17T19:06:32Z",
    "updated_at": "2023-05-17T19:06:32Z",
    "author_association": "COLLABORATOR",
    "body": "Bundling into release v0.23, which also includes the fast validation change (which reduces validation load by ~50% - through ignoring submissions below the floor bid).",
    "reactions": {
      "url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/comments/1551915385/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/comments/1551941167",
    "html_url": "https://github.com/flashbots/mev-boost-relay/issues/412#issuecomment-1551941167",
    "issue_url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/412",
    "id": 1551941167,
    "node_id": "IC_kwDOHXha9s5cgL4v",
    "user": {
      "login": "metachris",
      "id": 116939,
      "node_id": "MDQ6VXNlcjExNjkzOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/116939?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/metachris",
      "html_url": "https://github.com/metachris",
      "followers_url": "https://api.github.com/users/metachris/followers",
      "following_url": "https://api.github.com/users/metachris/following{/other_user}",
      "gists_url": "https://api.github.com/users/metachris/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/metachris/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/metachris/subscriptions",
      "organizations_url": "https://api.github.com/users/metachris/orgs",
      "repos_url": "https://api.github.com/users/metachris/repos",
      "events_url": "https://api.github.com/users/metachris/events{/privacy}",
      "received_events_url": "https://api.github.com/users/metachris/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-17T19:30:18Z",
    "updated_at": "2023-05-17T19:30:18Z",
    "author_association": "COLLABORATOR",
    "body": "Fixed in https://github.com/flashbots/mev-boost-relay/releases/tag/v0.23\r\n\r\n(also deployed to all Flashbots relays)",
    "reactions": {
      "url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/comments/1551941167/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
