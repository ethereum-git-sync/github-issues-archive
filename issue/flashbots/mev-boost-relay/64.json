{
  "url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/64",
  "repository_url": "https://api.github.com/repos/flashbots/mev-boost-relay",
  "labels_url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/64/labels{/name}",
  "comments_url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/64/comments",
  "events_url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/64/events",
  "html_url": "https://github.com/flashbots/mev-boost-relay/issues/64",
  "id": 1340755530,
  "node_id": "I_kwDOHXha9s5P6k5K",
  "number": 64,
  "title": "Possible race condition due to memory aliasing of variable",
  "user": {
    "login": "jtraglia",
    "id": 95511699,
    "node_id": "U_kgDOBbFkkw",
    "avatar_url": "https://avatars.githubusercontent.com/u/95511699?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jtraglia",
    "html_url": "https://github.com/jtraglia",
    "followers_url": "https://api.github.com/users/jtraglia/followers",
    "following_url": "https://api.github.com/users/jtraglia/following{/other_user}",
    "gists_url": "https://api.github.com/users/jtraglia/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jtraglia/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jtraglia/subscriptions",
    "organizations_url": "https://api.github.com/users/jtraglia/orgs",
    "repos_url": "https://api.github.com/users/jtraglia/repos",
    "events_url": "https://api.github.com/users/jtraglia/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jtraglia/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-08-16T18:58:50Z",
  "updated_at": "2022-08-16T22:47:39Z",
  "closed_at": "2022-08-16T22:47:39Z",
  "author_association": "COLLABORATOR",
  "active_lock_reason": null,
  "body": "## üìù Summary\r\n\r\nI ran semgrep (static analysis tool) on the relay and it pointed out one thing that I think is a valid issue:\r\n\r\n```go\r\nservices/api/service.go\r\n  trailofbits.go.anonymous-race-condition.anonymous-race-condition\r\n     Possible race condition due to memory aliasing of variable `registration`\r\n     Details: https://sg.run/BL22\r\n\r\n     458‚îÜ for _, registration := range payload {\r\n     459‚îÜ \tif registration.Message == nil {\r\n     460‚îÜ \t\trespondError(http.StatusBadRequest, \"registration without message\")\r\n     461‚îÜ \t\treturn\r\n     462‚îÜ \t}\r\n     463‚îÜ\r\n     464‚îÜ \tpubkey := registration.Message.Pubkey.PubkeyHex()\r\n     465‚îÜ \tregLog := api.log.WithFields(logrus.Fields{\r\n     466‚îÜ \t\t\"pubkey\": pubkey,\r\n     467‚îÜ \t})\r\n        [hid 54 additional lines, adjust with --max-lines-per-finding]\r\n```\r\n\r\nThis is a big loop, but this is the important section of the loop:\r\n\r\nhttps://github.com/flashbots/mev-boost-relay/blob/39c943dea695c89f96bff299678407ea79c655dd/services/api/service.go#L508-L513\r\n\r\nThis is in a `go func` and we're referencing the aliased variable, it may not be saving the `registration` that we think it is.\r\n\r\n## üìö References\r\n\r\n* https://semgrep.dev\r\n* https://husni.dev/beware-of-implicit-memory-aliasing-in-go-foor-loop/\r\n* https://github.com/trailofbits/semgrep-rules/blob/main/go/anonymous-race-condition.yml",
  "closed_by": {
    "login": "jtraglia",
    "id": 95511699,
    "node_id": "U_kgDOBbFkkw",
    "avatar_url": "https://avatars.githubusercontent.com/u/95511699?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jtraglia",
    "html_url": "https://github.com/jtraglia",
    "followers_url": "https://api.github.com/users/jtraglia/followers",
    "following_url": "https://api.github.com/users/jtraglia/following{/other_user}",
    "gists_url": "https://api.github.com/users/jtraglia/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jtraglia/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jtraglia/subscriptions",
    "organizations_url": "https://api.github.com/users/jtraglia/orgs",
    "repos_url": "https://api.github.com/users/jtraglia/repos",
    "events_url": "https://api.github.com/users/jtraglia/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jtraglia/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/64/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/64/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/comments/1217080343",
    "html_url": "https://github.com/flashbots/mev-boost-relay/issues/64#issuecomment-1217080343",
    "issue_url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/64",
    "id": 1217080343,
    "node_id": "IC_kwDOHXha9s5IiywX",
    "user": {
      "login": "metachris",
      "id": 116939,
      "node_id": "MDQ6VXNlcjExNjkzOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/116939?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/metachris",
      "html_url": "https://github.com/metachris",
      "followers_url": "https://api.github.com/users/metachris/followers",
      "following_url": "https://api.github.com/users/metachris/following{/other_user}",
      "gists_url": "https://api.github.com/users/metachris/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/metachris/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/metachris/subscriptions",
      "organizations_url": "https://api.github.com/users/metachris/orgs",
      "repos_url": "https://api.github.com/users/metachris/repos",
      "events_url": "https://api.github.com/users/metachris/events{/privacy}",
      "received_events_url": "https://api.github.com/users/metachris/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-16T19:36:35Z",
    "updated_at": "2022-08-16T19:36:35Z",
    "author_association": "COLLABORATOR",
    "body": "Would love semgrep as part of CI",
    "reactions": {
      "url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/comments/1217080343/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/comments/1217080809",
    "html_url": "https://github.com/flashbots/mev-boost-relay/issues/64#issuecomment-1217080809",
    "issue_url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/64",
    "id": 1217080809,
    "node_id": "IC_kwDOHXha9s5Iiy3p",
    "user": {
      "login": "jtraglia",
      "id": 95511699,
      "node_id": "U_kgDOBbFkkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/95511699?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtraglia",
      "html_url": "https://github.com/jtraglia",
      "followers_url": "https://api.github.com/users/jtraglia/followers",
      "following_url": "https://api.github.com/users/jtraglia/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtraglia/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtraglia/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtraglia/subscriptions",
      "organizations_url": "https://api.github.com/users/jtraglia/orgs",
      "repos_url": "https://api.github.com/users/jtraglia/repos",
      "events_url": "https://api.github.com/users/jtraglia/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtraglia/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-16T19:37:05Z",
    "updated_at": "2022-08-16T19:37:05Z",
    "author_association": "COLLABORATOR",
    "body": "I'll see what I can do!",
    "reactions": {
      "url": "https://api.github.com/repos/flashbots/mev-boost-relay/issues/comments/1217080809/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
