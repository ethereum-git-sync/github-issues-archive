{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5161",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5161/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5161/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5161/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/5161",
  "id": 1537205724,
  "node_id": "I_kwDOBggaLc5bn-Xc",
  "number": 5161,
  "title": "Inconsistent data in eth_getBlockByHash and eth_getBlockByNumber",
  "user": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1124483401,
      "node_id": "MDU6TGFiZWwxMTI0NDgzNDAx",
      "url": "https://api.github.com/repos/NethermindEth/nethermind/labels/rpc",
      "name": "rpc",
      "color": "efe37a",
      "default": false,
      "description": ""
    },
    {
      "id": 1145016563,
      "node_id": "MDU6TGFiZWwxMTQ1MDE2NTYz",
      "url": "https://api.github.com/repos/NethermindEth/nethermind/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "8731e2",
      "default": true,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "emlautarom1",
    "id": 31224949,
    "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
    "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/emlautarom1",
    "html_url": "https://github.com/emlautarom1",
    "followers_url": "https://api.github.com/users/emlautarom1/followers",
    "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
    "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
    "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
    "repos_url": "https://api.github.com/users/emlautarom1/repos",
    "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "emlautarom1",
      "id": 31224949,
      "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emlautarom1",
      "html_url": "https://github.com/emlautarom1",
      "followers_url": "https://api.github.com/users/emlautarom1/followers",
      "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
      "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
      "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
      "repos_url": "https://api.github.com/users/emlautarom1/repos",
      "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
      "type": "User",
      "site_admin": false
    },
    {
      "login": "smartprogrammer93",
      "id": 33181301,
      "node_id": "MDQ6VXNlcjMzMTgxMzAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33181301?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartprogrammer93",
      "html_url": "https://github.com/smartprogrammer93",
      "followers_url": "https://api.github.com/users/smartprogrammer93/followers",
      "following_url": "https://api.github.com/users/smartprogrammer93/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartprogrammer93/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartprogrammer93/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartprogrammer93/subscriptions",
      "organizations_url": "https://api.github.com/users/smartprogrammer93/orgs",
      "repos_url": "https://api.github.com/users/smartprogrammer93/repos",
      "events_url": "https://api.github.com/users/smartprogrammer93/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartprogrammer93/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-01-18T00:13:52Z",
  "updated_at": "2023-08-16T14:16:32Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nThere is an inconsistency in the data returned by Nethermind for `eth_getBlockByHash` compared to Geth and Besu. A Lighthouse user reported this for block [16352147](https://beaconcha.in/block/16352147) at slot [5519765](https://beaconcha.in/slot/5519765).\r\n\r\nI've collected the output from the 3 clients here: https://gist.github.com/michaelsproul/40760b5e7f9ae3bc0e6efba2bcbc510a.\r\n\r\nIt has been processed with `jq --sorted-keys` to facilitate easy diffing. At a quick glance it looks like there is some disagreement on the `accessList`s of a few transactions, along with some cosmetic differences. The responses of Geth and Besu are exactly identical, and the byNumber/byHash responses of Nethermind are also identical.\r\n\r\nNethermind processed the block correctly without a chain split, so **there is no consensus risk as a result of this bug**. I think it must be an issue in the post-processing for the API, or maybe the database storage (speculating wildly).\r\n\r\n**To Reproduce**\r\n\r\nCan be reproduced by calling `eth_getBlockByHash` directly on a Nethermind node for the block hash `0x0339d7de69b88225973e1aada3fdf9bb745b817fda9ae1d4cc6034ce57800ff0`.\r\n\r\nCan also be reproduced indirectly by calling Lighthouse's HTTP API at slot 5519765 on a node using Nethermind:\r\n\r\n```bash\r\ncurl -s \"http://localhost:5052/eth/v2/beacon/blocks/5519765\" | jq\r\n```\r\n\r\n```json\r\n{\r\n  \"code\": 500,\r\n  \"message\": \"UNHANDLED_ERROR: InconsistentPayloadReconstructed { slot: Slot(5519765), exec_block_hash: 0x0339d7de69b88225973e1aada3fdf9bb745b817fda9ae1d4cc6034ce57800ff0, canonical_payload_root: 0xbbee3ca0aab5d79be087055701494d590b839e85ba3c77fcc189facbf1d44397, reconstructed_payload_root: 0xca254e695e0120443020bb41d9d95697ce0c62edd09716a568a3d6fefd0c30c7, canonical_transactions_root: 0x71aa57644eab6c4baa3cdda12d591bedc5d00a70e38bcfcdb85c2aec58ff4234, reconstructed_transactions_root: 0xccac7ed2f7fc531c2b59e3a095adea526d63895b889b2ec7f219a16878a653ee }\",\r\n  \"stacktraces\": []\r\n}\r\n```\r\n\r\n(NB: once Capella arrives Lighthouse will no longer use `eth_getBlockByHash` in this way)\r\n\r\n**Version Info**\r\n\r\nThe Ligthouse user reported this issue with `Nethermind/v1.14.1-0-1a32d4541-20221014/X64-Linux/6.0.8`. I successfully reproduced it with 1.15.0:\r\n\r\n```\r\nVersion: 1.15.0+2b708761\r\nCommit: 2b7087613a6fde63a9d1173ca6e4e5b8f669e6f5\r\nBuild Date: 2022-12-28 12:42:33Z\r\nOS: Linux x64\r\nRuntime: .NET 6.0.12\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5161/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5161/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1403103194",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/5161#issuecomment-1403103194",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5161",
    "id": 1403103194,
    "node_id": "IC_kwDOBggaLc5Toafa",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-25T05:07:30Z",
    "updated_at": "2023-01-25T05:07:30Z",
    "author_association": "NONE",
    "body": "Just upgraded my node to `Nethermind/v1.16.1+644fe89f/linux-x64/dotnet7.0.2` and can confirm this is still an issue.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1403103194/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1403287334",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/5161#issuecomment-1403287334",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5161",
    "id": 1403287334,
    "node_id": "IC_kwDOBggaLc5TpHcm",
    "user": {
      "login": "kamilchodola",
      "id": 43241881,
      "node_id": "MDQ6VXNlcjQzMjQxODgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/43241881?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kamilchodola",
      "html_url": "https://github.com/kamilchodola",
      "followers_url": "https://api.github.com/users/kamilchodola/followers",
      "following_url": "https://api.github.com/users/kamilchodola/following{/other_user}",
      "gists_url": "https://api.github.com/users/kamilchodola/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kamilchodola/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kamilchodola/subscriptions",
      "organizations_url": "https://api.github.com/users/kamilchodola/orgs",
      "repos_url": "https://api.github.com/users/kamilchodola/repos",
      "events_url": "https://api.github.com/users/kamilchodola/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kamilchodola/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-25T09:02:51Z",
    "updated_at": "2023-01-25T09:02:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "Differences (Left is Besu, right is Nethermind):\r\n<img width=\"1078\" alt=\"image\" src=\"https://user-images.githubusercontent.com/43241881/214521370-beb5cb3c-10fe-4453-97df-fc7f6110f84d.png\">\r\n<img width=\"1091\" alt=\"image\" src=\"https://user-images.githubusercontent.com/43241881/214521430-1f7e162b-cc73-42aa-bb46-0b8b358b2bcd.png\">\r\n<img width=\"1111\" alt=\"image\" src=\"https://user-images.githubusercontent.com/43241881/214521468-52b90799-80f1-4be6-b83a-4a34c7e56564.png\">\r\n<img width=\"1125\" alt=\"image\" src=\"https://user-images.githubusercontent.com/43241881/214521516-dfd98401-78bc-45be-a7e3-39f3ce07525b.png\">\r\n<img width=\"1123\" alt=\"image\" src=\"https://user-images.githubusercontent.com/43241881/214521544-daab0962-9d4a-4f0e-b619-e5b8dd67aa50.png\">\r\n\r\nThose are just few ones but looking now through it is way much different in Besu vs Nethermind.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1403287334/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1403289862",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/5161#issuecomment-1403289862",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5161",
    "id": 1403289862,
    "node_id": "IC_kwDOBggaLc5TpIEG",
    "user": {
      "login": "kamilchodola",
      "id": 43241881,
      "node_id": "MDQ6VXNlcjQzMjQxODgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/43241881?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kamilchodola",
      "html_url": "https://github.com/kamilchodola",
      "followers_url": "https://api.github.com/users/kamilchodola/followers",
      "following_url": "https://api.github.com/users/kamilchodola/following{/other_user}",
      "gists_url": "https://api.github.com/users/kamilchodola/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kamilchodola/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kamilchodola/subscriptions",
      "organizations_url": "https://api.github.com/users/kamilchodola/orgs",
      "repos_url": "https://api.github.com/users/kamilchodola/repos",
      "events_url": "https://api.github.com/users/kamilchodola/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kamilchodola/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-25T09:04:51Z",
    "updated_at": "2023-01-25T09:04:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "Besu and Geth are having identical outputs looking now and files provided.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1403289862/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
