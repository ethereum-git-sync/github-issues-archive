{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3350",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3350/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3350/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3350/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/3350",
  "id": 981701759,
  "node_id": "MDU6SXNzdWU5ODE3MDE3NTk=",
  "number": 3350,
  "title": "Major Issue: Break in Harmonious Coding AuRa Block Reward Contracts re: OpenEthereum's AuRa implementation.",
  "user": {
    "login": "chris-shyft",
    "id": 34154131,
    "node_id": "MDQ6VXNlcjM0MTU0MTMx",
    "avatar_url": "https://avatars.githubusercontent.com/u/34154131?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chris-shyft",
    "html_url": "https://github.com/chris-shyft",
    "followers_url": "https://api.github.com/users/chris-shyft/followers",
    "following_url": "https://api.github.com/users/chris-shyft/following{/other_user}",
    "gists_url": "https://api.github.com/users/chris-shyft/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chris-shyft/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chris-shyft/subscriptions",
    "organizations_url": "https://api.github.com/users/chris-shyft/orgs",
    "repos_url": "https://api.github.com/users/chris-shyft/repos",
    "events_url": "https://api.github.com/users/chris-shyft/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chris-shyft/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "LukaszRozmej",
    "id": 12445221,
    "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LukaszRozmej",
    "html_url": "https://github.com/LukaszRozmej",
    "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
    "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
    "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
    "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
    "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
    "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "LukaszRozmej",
      "id": 12445221,
      "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LukaszRozmej",
      "html_url": "https://github.com/LukaszRozmej",
      "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
      "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
      "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
      "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
      "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
      "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-08-28T02:27:35Z",
  "updated_at": "2021-08-30T22:14:42Z",
  "closed_at": "2021-08-30T22:14:42Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\nNethermind does not have an identical implementation for account \"kinds\" in block rewards.\r\n\"EmptyStep\" and \"External\" have been switched, while the the \"system address\" remains consistent across implementations of OE and NM.\r\n\r\nThis results in, when coding for the implementations in *any* google-searchable documentation, finding, and only finding, the OpenEthereum implementation:\r\nhttps://openethereum.github.io/Block-Reward-Contract\r\n\r\n<img width=\"643\" alt=\"Screen Shot 2021-08-27 at 10 11 23 PM\" src=\"https://user-images.githubusercontent.com/34154131/131203006-f64539b8-d10c-498a-a489-2c8b43a10bf3.png\">\r\n\r\n\r\nThis indicates a mistake, and gravely, the smart contracts behaving at this level do not know about any other implementations.\r\n\r\nour network (mainnet) was affected -  ending up, in a mainnet situation, as having our assets incorrectly burned at each step, with our \"external\" configuration being OE's documented example:\r\n\r\n<img width=\"687\" alt=\"Screen Shot 2021-08-27 at 10 23 24 PM\" src=\"https://user-images.githubusercontent.com/34154131/131203274-51d8abd7-aa97-49a7-b4f7-56df09c07dc1.png\">\r\n\r\n\r\nhttps://bx.shyft.network/address/0x9f2Ad39F951a810A52b3838749779B90E9eb66d4/coin-balances\r\nwas supposed to receive double this amount, based on the the configuration:\r\n\r\n<img width=\"696\" alt=\"Screen Shot 2021-08-27 at 10 30 15 PM\" src=\"https://user-images.githubusercontent.com/34154131/131203454-02ed013a-7ac6-44ff-aa8a-285d95bae99c.png\">\r\n\r\n\r\n**Expected behavior**\r\nNethermind and OpenEthereum have identical implementations for the behaviour relating to block reward contracts, **or** the system address is not identical (visually as well, preferably, using aBBaB etc instead of FeeFFe etc) to OpenEthereum's, so that the block reward contract could detect the implementation.\r\n\r\nHowever, this latter solution would be almost impossible to properly code to unless there was **significantly** more documentation and code examples, to the level (at least) of OpenEthereum's documentation and relative SEO to get it to the 1st google page.\r\n\r\nIn this, I'd expect it's actually simpler to change it up locally, and hopefully there are no deployed projects that are dependent on this non-matching implementation on Nethermind clients.\r\n\r\n**Screenshots**\r\n<img width=\"315\" alt=\"Screen Shot 2021-08-27 at 10 08 23 PM\" src=\"https://user-images.githubusercontent.com/34154131/131202939-a3d66b5a-81d4-4dce-b412-2b55c106a4ed.png\">\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: OSX\r\n\r\n**Additional context**\r\n\r\n",
  "closed_by": {
    "login": "LukaszRozmej",
    "id": 12445221,
    "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LukaszRozmej",
    "html_url": "https://github.com/LukaszRozmej",
    "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
    "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
    "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
    "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
    "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
    "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3350/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3350/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/907700298",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/3350#issuecomment-907700298",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3350",
    "id": 907700298,
    "node_id": "IC_kwDOBggaLc42GmhK",
    "user": {
      "login": "LukaszRozmej",
      "id": 12445221,
      "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LukaszRozmej",
      "html_url": "https://github.com/LukaszRozmej",
      "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
      "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
      "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
      "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
      "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
      "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-28T23:00:14Z",
    "updated_at": "2021-08-28T23:01:12Z",
    "author_association": "MEMBER",
    "body": "Hi @chris-shyft, I am developer who coded AuRa in Nethermind. While I see that you are right in that the values in our enum are flipped, I fail to see how it would affect your networks rewards.\r\n\r\nExplanation:\r\n1. Nethermind currently doesn't support empty steps. I think your network doesn't use empty steps.\r\n2. Based on docs, that you also linked ( https://openethereum.github.io/Block-Reward-Contract ) :\r\n\r\n\"Currently the engine supports the following types of rewards:\r\n0 - Author - Reward attributed to the block author\r\n2 - Empty step - Reward attributed to the author(s) of empty step(s) included in the block (AuthorityRound engine)\r\n3 - External - Reward attributed by an external protocol (e.g. block reward contract)\r\n101-106 - Uncle - Reward attributed to uncles, with distance 1 to 6 (Ethash engine)\r\nThe reward contract will receive as input reward types of 0, 2 or 101-106, and any reward attributed by it will be labelled as external (this is visible when tracing rewards).\"\r\n\r\nSo input kinds that contract can get are 0 - Author, 2 - EmptyStep (out of scope for Nethermind and probably your network), 101-106 Uncles. Your contract will output rewards that will be marked as External. Those rewards will override input rewards. So when your contract doesn't return a reward for authors address for example, then authors address won't be rewarded. This works like this in both OE and Nethermind.\r\n\r\nNethermind works like this with reward contracts on multiple networks that both use OE and Nethermind. If Nethermind would calculate rewards incorrectly on any of them, we would have consensus issue and the network would split.\r\n\r\nThe reward type (external) is later only used in tracing, but its used there by name (string), not value 3, so even this issue in enum isn't a bug in Nethermind at current time (not supporting empty steps), but its confusing and we will change it.\r\n\r\nCan you then clarify what is your issue? Maybe I am missing something.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/907700298/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/908256669",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/3350#issuecomment-908256669",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3350",
    "id": 908256669,
    "node_id": "IC_kwDOBggaLc42IuWd",
    "user": {
      "login": "LukaszRozmej",
      "id": 12445221,
      "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LukaszRozmej",
      "html_url": "https://github.com/LukaszRozmej",
      "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
      "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
      "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
      "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
      "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
      "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-30T11:14:47Z",
    "updated_at": "2021-08-30T11:14:47Z",
    "author_association": "MEMBER",
    "body": "For calculating parameters, this correct value are used: https://github.com/NethermindEth/nethermind/blob/169b4318b410c87ca7de020dfa045e10e41d744a/src/Nethermind/Nethermind.Consensus.AuRa/Rewards/AuRaRewardCalculator.cs#L140-L142",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/908256669/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/908740889",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/3350#issuecomment-908740889",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3350",
    "id": 908740889,
    "node_id": "IC_kwDOBggaLc42KkkZ",
    "user": {
      "login": "LukaszRozmej",
      "id": 12445221,
      "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LukaszRozmej",
      "html_url": "https://github.com/LukaszRozmej",
      "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
      "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
      "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
      "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
      "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
      "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-30T22:14:42Z",
    "updated_at": "2021-08-30T22:14:42Z",
    "author_association": "MEMBER",
    "body": "Interaction with contract is as designed, there was confusion on what exact input will go into it.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/908740889/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
