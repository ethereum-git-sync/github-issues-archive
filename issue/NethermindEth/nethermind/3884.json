{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3884",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3884/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3884/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3884/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/3884",
  "id": 1172199935,
  "node_id": "I_kwDOBggaLc5F3ln_",
  "number": 3884,
  "title": "Missing Tree node",
  "user": {
    "login": "nicexe",
    "id": 867535,
    "node_id": "MDQ6VXNlcjg2NzUzNQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/867535?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nicexe",
    "html_url": "https://github.com/nicexe",
    "followers_url": "https://api.github.com/users/nicexe/followers",
    "following_url": "https://api.github.com/users/nicexe/following{/other_user}",
    "gists_url": "https://api.github.com/users/nicexe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nicexe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nicexe/subscriptions",
    "organizations_url": "https://api.github.com/users/nicexe/orgs",
    "repos_url": "https://api.github.com/users/nicexe/repos",
    "events_url": "https://api.github.com/users/nicexe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nicexe/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "LukaszRozmej",
    "id": 12445221,
    "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LukaszRozmej",
    "html_url": "https://github.com/LukaszRozmej",
    "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
    "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
    "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
    "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
    "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
    "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "LukaszRozmej",
      "id": 12445221,
      "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LukaszRozmej",
      "html_url": "https://github.com/LukaszRozmej",
      "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
      "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
      "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
      "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
      "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
      "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-03-17T10:31:22Z",
  "updated_at": "2022-08-22T14:00:30Z",
  "closed_at": "2022-08-22T14:00:29Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "AuRa validator node cannot sync more blocks due to error.\r\n\r\nAt some point, validator nodes started disconnecting/reporting other validating nodes until each validator node had no more peers to connect to.\r\nI tried to remedy the situation by restarting the nodes in hopes that they connect to each other, reorganize some blocks and continue producing blocks each on their time slot. This worked for a while but then the validator nodes started disconnecting/reporting other validators again.\r\nAfter a few node restarts I started getting errors like the one shown below.\r\n\r\n```\r\n2022-03-17 10:02:03.5812|ERROR|62|BlockchainProcessor encountered an exception. Nethermind.Abi.AbiException: System call to RewardContract.Reward returned an exception 'Failed to load key fcbd49b3a106f7e49c6e147b76ca4682aefd4fe6d07f4368f542751aaf85d596 from root hash 0x51360a56cb5a4d26f340ddb1615eeeb91280f09054e1bce25aa4163c671cdbf7.' at block 257412.\r\n ---> Nethermind.Trie.TrieException: Failed to load key fcbd49b3a106f7e49c6e147b76ca4682aefd4fe6d07f4368f542751aaf85d596 from root hash 0x51360a56cb5a4d26f340ddb1615eeeb91280f09054e1bce25aa4163c671cdbf7.\r\n ---> Nethermind.Trie.TrieException: Node 0x51360a56cb5a4d26f340ddb1615eeeb91280f09054e1bce25aa4163c671cdbf7 is missing from the DB\r\n   at Nethermind.Trie.Pruning.TrieStore.LoadRlp(Keccak keccak, IKeyValueStore keyValueStore) in /src/Nethermind/Nethermind.Trie/Pruning/TrieStore.cs:line 331\r\n   at Nethermind.Trie.Pruning.TrieStore.LoadRlp(Keccak keccak) in /src/Nethermind/Nethermind.Trie/Pruning/TrieStore.cs:line 339\r\n   at Nethermind.Trie.TrieNode.ResolveNode(ITrieNodeResolver tree) in /src/Nethermind/Nethermind.Trie/TrieNode.cs:line 255\r\n   at Nethermind.Trie.PatriciaTree.Run(Span`1 updatePath, Int32 nibblesCount, Byte[] updateValue, Boolean isUpdate, Boolean ignoreMissingDelete, Keccak startRootHash) in /src/Nethermind/Nethermind.Trie/PatriciaTree.cs:line 408\r\n   at Nethermind.Trie.PatriciaTree.Get(Span`1 rawKey, Keccak rootHash) in /src/Nethermind/Nethermind.Trie/PatriciaTree.cs:line 321\r\n   --- End of inner exception stack trace ---\r\n   at Nethermind.Trie.PatriciaTree.Get(Span`1 rawKey, Keccak rootHash) in /src/Nethermind/Nethermind.Trie/PatriciaTree.cs:line 328\r\n   at Nethermind.State.StateTree.Get(Address address, Keccak rootHash) in /src/Nethermind/Nethermind.State/StateTree.cs:line 51\r\n   at Nethermind.State.StateProvider.GetState(Address address) in /src/Nethermind/Nethermind.State/StateProvider.cs:line 659\r\n   at Nethermind.State.StateProvider.GetAndAddToCache(Address address) in /src/Nethermind/Nethermind.State/StateProvider.cs:line 674\r\n   at Nethermind.State.StateProvider.GetThroughCache(Address address) in /src/Nethermind/Nethermind.State/StateProvider.cs:line 695\r\n   at Nethermind.State.StateProvider.GetAccount(Address address) in /src/Nethermind/Nethermind.State/StateProvider.cs:line 120\r\n   at Nethermind.Evm.TransactionProcessing.TransactionProcessor.Execute(Transaction transaction, BlockHeader block, ITxTracer txTracer, ExecutionOptions executionOptions) in /src/Nethermind/Nethermind.Evm/TransactionProcessing/TransactionProcessor.cs:line 188\r\n   at Nethermind.Evm.TransactionProcessing.TransactionProcessor.Execute(Transaction transaction, BlockHeader block, ITxTracer txTracer) in /src/Nethermind/Nethermind.Evm/TransactionProcessing/TransactionProcessor.cs:line 111\r\n   at Nethermind.Blockchain.Contracts.Contract.CallCore(ITransactionProcessor transactionProcessor, BlockHeader header, String functionName, Transaction transaction, Boolean callAndRestore) in /src/Nethermind/Nethermind.Blockchain/Contracts/Contract.cs:line 198\r\n   --- End of inner exception stack trace ---\r\n   at Nethermind.Blockchain.Contracts.Contract.CallCore(ITransactionProcessor transactionProcessor, BlockHeader header, String functionName, Transaction transaction, Boolean callAndRestore) in /src/Nethermind/Nethermind.Blockchain/Contracts/Contract.cs:line 205\r\n   at Nethermind.Blockchain.Contracts.CallableContract.Call(BlockHeader header, String functionName, Transaction transaction) in /src/Nethermind/Nethermind.Blockchain/Contracts/CallableContract.cs:line 46\r\n   at Nethermind.Blockchain.Contracts.CallableContract.Call(BlockHeader header, String functionName, Address sender, Int64 gasLimit, Object[] arguments) in /src/Nethermind/Nethermind.Blockchain/Contracts/CallableContract.cs:line 72\r\n   at Nethermind.Consensus.AuRa.Contracts.RewardContract.Reward(BlockHeader blockHeader, Address[] benefactors, UInt16[] kind) in /src/Nethermind/Nethermind.Consensus.AuRa/Contracts/RewardContract.cs:line 79\r\n   at Nethermind.Consensus.AuRa.Rewards.AuRaRewardCalculator.CalculateRewardsWithContract(Block block, IRewardContract contract) in /src/Nethermind/Nethermind.Consensus.AuRa/Rewards/AuRaRewardCalculator.cs:line 110\r\n   at Nethermind.Consensus.AuRa.Rewards.AuRaRewardCalculator.CalculateRewards(Block block) in /src/Nethermind/Nethermind.Consensus.AuRa/Rewards/AuRaRewardCalculator.cs:line 79\r\n   at Nethermind.Blockchain.Processing.BlockProcessor.ApplyMinerRewards(Block block, IBlockTracer tracer, IReleaseSpec spec) in /src/Nethermind/Nethermind.Blockchain/Processing/BlockProcessor.cs:line 310\r\n   at Nethermind.Blockchain.Processing.BlockProcessor.ProcessBlock(Block block, IBlockTracer blockTracer, ProcessingOptions options) in /src/Nethermind/Nethermind.Blockchain/Processing/BlockProcessor.cs:line 258\r\n   at Nethermind.Consensus.AuRa.AuRaBlockProcessor.ProcessBlock(Block block, IBlockTracer blockTracer, ProcessingOptions options) in /src/Nethermind/Nethermind.Consensus.AuRa/AuRaBlockProcessor.cs:line 91\r\n   at Nethermind.Blockchain.Processing.BlockProcessor.ProcessOne(Block suggestedBlock, ProcessingOptions options, IBlockTracer blockTracer) in /src/Nethermind/Nethermind.Blockchain/Processing/BlockProcessor.cs:line 224\r\n   at Nethermind.Blockchain.Processing.BlockProcessor.Process(Keccak newBranchStateRoot, List`1 suggestedBlocks, ProcessingOptions options, IBlockTracer blockTracer) in /src/Nethermind/Nethermind.Blockchain/Processing/BlockProcessor.cs:line 119\r\n   at Nethermind.Blockchain.Processing.BlockchainProcessor.ProcessBranch(ProcessingBranch processingBranch, ProcessingOptions options, IBlockTracer tracer) in /src/Nethermind/Nethermind.Blockchain/Processing/BlockchainProcessor.cs:line 383\r\n   at Nethermind.Blockchain.Processing.BlockchainProcessor.Process(Block suggestedBlock, ProcessingOptions options, IBlockTracer tracer) in /src/Nethermind/Nethermind.Blockchain/Processing/BlockchainProcessor.cs:line 295\r\n   at Nethermind.Blockchain.Processing.BlockchainProcessor.RunProcessingLoop() in /src/Nethermind/Nethermind.Blockchain/Processing/BlockchainProcessor.cs:line 238\r\n   at System.Threading.Tasks.Task.InnerInvoke()\r\n   at System.Threading.Tasks.Task.<>c.<.cctor>b__272_0(Object obj)\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n--- End of stack trace from previous location ---\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)\r\n```\r\n\r\nI took a backup of nethermind_db directory and tried the suggestion found here https://github.com/NethermindEth/nethermind/issues/3869#issuecomment-1065067908_ by resetting head to an older block but this didn't work\r\n\r\nI restored the backup and tried again but this time using debug_deleteChainSlicem. This also didn't work\r\n\r\nIf you need the logs for the debug methods I can restore from the backup and try using them again.\r\n\r\n**Environment:**\r\n - Docker host: Ubuntu 20.04\r\n - Docker container images: [nethermind/nethermind:1.12.5](https://hub.docker.com/layers/nethermind/nethermind/1.12.5/images/sha256-ef0f6e0469425b072a880638b15157730e5fb31f288b0839dedea77dd3fb0533) and [nethermindeth/nethermind:debug_resetHead](https://hub.docker.com/layers/nethermindeth/nethermind/debug_resetHead/images/sha256-5a62c43ed973876ae0d3fcf54cc86cc67aaed18739495d5a11f4f3459d994598)",
  "closed_by": {
    "login": "LukaszRozmej",
    "id": 12445221,
    "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LukaszRozmej",
    "html_url": "https://github.com/LukaszRozmej",
    "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
    "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
    "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
    "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
    "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
    "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3884/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3884/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1070788115",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/3884#issuecomment-1070788115",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3884",
    "id": 1070788115,
    "node_id": "IC_kwDOBggaLc4_0u4T",
    "user": {
      "login": "LukaszRozmej",
      "id": 12445221,
      "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LukaszRozmej",
      "html_url": "https://github.com/LukaszRozmej",
      "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
      "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
      "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
      "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
      "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
      "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-17T10:56:02Z",
    "updated_at": "2022-03-17T10:56:02Z",
    "author_association": "MEMBER",
    "body": "Hi @nicexe, at this point of time the best thing is  to resync the node. As this DB/Tree corruption can s ometimes happen, especially on hard restarts we are looking into potential fixes or some healing mechanism.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1070788115/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1070791379",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/3884#issuecomment-1070791379",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3884",
    "id": 1070791379,
    "node_id": "IC_kwDOBggaLc4_0vrT",
    "user": {
      "login": "LukaszRozmej",
      "id": 12445221,
      "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LukaszRozmej",
      "html_url": "https://github.com/LukaszRozmej",
      "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
      "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
      "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
      "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
      "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
      "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-17T10:59:55Z",
    "updated_at": "2022-03-17T10:59:55Z",
    "author_association": "MEMBER",
    "body": "One thing you could try, but its not guaranteed to work is setting FastSyncCatchUpHeightDelta in sync module https://docs.nethermind.io/nethermind/ethereum-client/configuration/sync to some low value (like ~100 for example) to trigger FastSync to catch up to chain head.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1070791379/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1222404451",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/3884#issuecomment-1222404451",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3884",
    "id": 1222404451,
    "node_id": "IC_kwDOBggaLc5I3Glj",
    "user": {
      "login": "LukaszRozmej",
      "id": 12445221,
      "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LukaszRozmej",
      "html_url": "https://github.com/LukaszRozmej",
      "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
      "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
      "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
      "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
      "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
      "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-22T14:00:29Z",
    "updated_at": "2022-08-22T14:00:29Z",
    "author_association": "MEMBER",
    "body": "Expected to fix in #4341, #4381",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1222404451/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
