{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6115",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6115/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6115/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6115/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/6115",
  "id": 1906005140,
  "node_id": "I_kwDOBggaLc5xm1SU",
  "number": 6115,
  "title": "Spec non compliance issues on the Ping Packet of Discv4",
  "user": {
    "login": "mohasdev",
    "id": 120682395,
    "node_id": "U_kgDOBzF3mw",
    "avatar_url": "https://avatars.githubusercontent.com/u/120682395?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mohasdev",
    "html_url": "https://github.com/mohasdev",
    "followers_url": "https://api.github.com/users/mohasdev/followers",
    "following_url": "https://api.github.com/users/mohasdev/following{/other_user}",
    "gists_url": "https://api.github.com/users/mohasdev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mohasdev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mohasdev/subscriptions",
    "organizations_url": "https://api.github.com/users/mohasdev/orgs",
    "repos_url": "https://api.github.com/users/mohasdev/repos",
    "events_url": "https://api.github.com/users/mohasdev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mohasdev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "asdacap",
    "id": 1841324,
    "node_id": "MDQ6VXNlcjE4NDEzMjQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1841324?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/asdacap",
    "html_url": "https://github.com/asdacap",
    "followers_url": "https://api.github.com/users/asdacap/followers",
    "following_url": "https://api.github.com/users/asdacap/following{/other_user}",
    "gists_url": "https://api.github.com/users/asdacap/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/asdacap/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/asdacap/subscriptions",
    "organizations_url": "https://api.github.com/users/asdacap/orgs",
    "repos_url": "https://api.github.com/users/asdacap/repos",
    "events_url": "https://api.github.com/users/asdacap/events{/privacy}",
    "received_events_url": "https://api.github.com/users/asdacap/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "asdacap",
      "id": 1841324,
      "node_id": "MDQ6VXNlcjE4NDEzMjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841324?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/asdacap",
      "html_url": "https://github.com/asdacap",
      "followers_url": "https://api.github.com/users/asdacap/followers",
      "following_url": "https://api.github.com/users/asdacap/following{/other_user}",
      "gists_url": "https://api.github.com/users/asdacap/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/asdacap/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/asdacap/subscriptions",
      "organizations_url": "https://api.github.com/users/asdacap/orgs",
      "repos_url": "https://api.github.com/users/asdacap/repos",
      "events_url": "https://api.github.com/users/asdacap/events{/privacy}",
      "received_events_url": "https://api.github.com/users/asdacap/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-09-21T03:07:45Z",
  "updated_at": "2023-10-11T11:59:57Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\nThere is 4 issues on the [ping packet from discv4](https://github.com/ethereum/devp2p/blob/master/discv4.md#ping-packet-0x01) when Nethermind don't respond to a ping, the issues are spec non compliance issues .\r\n\r\n1/ Wrong Version field\r\n\r\nAccording to the devp2p specs, if a node send a ping with a wrong version field in the Ping packet node should respond with a Pong .\r\n\r\nIf i send a ping packet with the string : ++,,0$'9#)#=;:2@5+6 in the version field , Nethermind don't respond.\r\n\r\n2/ Wrong To field\r\n\r\nAccording to the devp2p specs and hive test, if a node send a ping with a wrong To field in the Ping packet node should respond with a Pong .\r\n\r\nIf i send a ping packet with the string : 7.?*!&#9##56:>5:$@6$ in the To field , Nethermind don't respond.\r\n\r\n3/ Wrong From field\r\n\r\nAccording to the devp2p specs and hive test, if a node send a ping with a wrong From field in the Ping packet node should respond with a Pong .\r\n\r\nIf i send a ping packet with the string : &85 3//:.6.#( in the From field , Nethermind don't respond.\r\n\r\n4/ Extra data\r\n\r\nAccording to the devp2p specs and hive test, if a node send a ping with extra data field in the Ping packet node should respond with a Pong .\r\n\r\nIf i send a ping packet with two additional fields with contains the string );/2/!:\"%@95.=@5-)!% , Nethermind don't respond.\r\n\r\n### Steps to reproduce\r\n\r\nYou can use the implementation of your choice and send a ping message to a Nethermind node, or using the devp2p binaries from geth and edit the ping message .\r\n\r\nOr you can use [D4C](https://github.com/mohasdev/D4C), a modified version of geth that send fuzzed message , just clone the repo and use this command (you need to have go in your computer) :\r\n`make all`\r\n\r\nthen use the corresponding commands that send a ping message :\r\n\r\n./build/bin/devp2p discv4 wrong-version-ping < enode address > random-fuzzer 1\r\n./build/bin/devp2p discv4 wrong-to-ping < enode address > random-fuzzer 1\r\n./build/bin/devp2p discv4 wrong-from-ping < enode address > random-fuzzer 1\r\n./build/bin/devp2p discv4 extra-data-ping < enode address > random-fuzzer 1\r\n\r\n### Ressources\r\nThe expected behaviors come from :\r\n\r\n[Devp2p specifications](https://github.com/ethereum/devp2p/blob/master/discv4.md)\r\n[Hive tests](https://github.com/ethereum/go-ethereum/blob/master/cmd/devp2p/internal/v4test/discv4tests.go) (check the existing unit test and the comments )\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6115/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6115/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1757260248",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6115#issuecomment-1757260248",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6115",
    "id": 1757260248,
    "node_id": "IC_kwDOBggaLc5ovanY",
    "user": {
      "login": "asdacap",
      "id": 1841324,
      "node_id": "MDQ6VXNlcjE4NDEzMjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841324?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/asdacap",
      "html_url": "https://github.com/asdacap",
      "followers_url": "https://api.github.com/users/asdacap/followers",
      "following_url": "https://api.github.com/users/asdacap/following{/other_user}",
      "gists_url": "https://api.github.com/users/asdacap/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/asdacap/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/asdacap/subscriptions",
      "organizations_url": "https://api.github.com/users/asdacap/orgs",
      "repos_url": "https://api.github.com/users/asdacap/repos",
      "events_url": "https://api.github.com/users/asdacap/events{/privacy}",
      "received_events_url": "https://api.github.com/users/asdacap/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-11T09:31:51Z",
    "updated_at": "2023-10-11T09:31:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "The first and last case is understandable. The first one, we always interpret it as a number, but a string is still somewhat valid structure wise. Same case as last one as we assume its the EnrSequence which is a number. \r\n\r\nThe second and third case however, changes the datatype from a sequence to a bytestring which is more of a structural change then a value change. I'm not sure if that is part of spec. Can you provide link that allow changing this field? The spec mentions `ignore mismatches in Ping version and any additional list elements in packet-data`",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1757260248/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1757460497",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6115#issuecomment-1757460497",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6115",
    "id": 1757460497,
    "node_id": "IC_kwDOBggaLc5owLgR",
    "user": {
      "login": "mohasdev",
      "id": 120682395,
      "node_id": "U_kgDOBzF3mw",
      "avatar_url": "https://avatars.githubusercontent.com/u/120682395?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mohasdev",
      "html_url": "https://github.com/mohasdev",
      "followers_url": "https://api.github.com/users/mohasdev/followers",
      "following_url": "https://api.github.com/users/mohasdev/following{/other_user}",
      "gists_url": "https://api.github.com/users/mohasdev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mohasdev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mohasdev/subscriptions",
      "organizations_url": "https://api.github.com/users/mohasdev/orgs",
      "repos_url": "https://api.github.com/users/mohasdev/repos",
      "events_url": "https://api.github.com/users/mohasdev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mohasdev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-11T11:19:28Z",
    "updated_at": "2023-10-11T11:19:28Z",
    "author_association": "NONE",
    "body": "> The first and last case is understandable. The first one, we always interpret it as a number, but a string is still somewhat valid structure wise. Same case as last one as we assume its the EnrSequence which is a number.\r\n> \r\n> The second and third case however, changes the datatype from a sequence to a bytestring which is more of a structural change then a value change. I'm not sure if that is part of spec. Can you provide link that allow changing this field? The spec mentions `ignore mismatches in Ping version and any additional list elements in packet-data`\r\n\r\nHi @asdacap ,\r\nThe excepted behaviour come from the hive test (here : https://github.com/ethereum/go-ethereum/blob/master/cmd/devp2p/internal/v4test/discv4tests.go#L158), i didn't find this in the specs.\r\n\r\nNow i'm not 100% sure if it's allowed to completly change the field and the specs don't mention about wrong From and To field, only hive tests does .\r\nHive test were written by felix, the same person who written the specs, maybe we need to ask him his opinion on that.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1757460497/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1757538744",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6115#issuecomment-1757538744",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6115",
    "id": 1757538744,
    "node_id": "IC_kwDOBggaLc5owem4",
    "user": {
      "login": "asdacap",
      "id": 1841324,
      "node_id": "MDQ6VXNlcjE4NDEzMjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841324?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/asdacap",
      "html_url": "https://github.com/asdacap",
      "followers_url": "https://api.github.com/users/asdacap/followers",
      "following_url": "https://api.github.com/users/asdacap/following{/other_user}",
      "gists_url": "https://api.github.com/users/asdacap/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/asdacap/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/asdacap/subscriptions",
      "organizations_url": "https://api.github.com/users/asdacap/orgs",
      "repos_url": "https://api.github.com/users/asdacap/repos",
      "events_url": "https://api.github.com/users/asdacap/events{/privacy}",
      "received_events_url": "https://api.github.com/users/asdacap/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-11T11:59:56Z",
    "updated_at": "2023-10-11T11:59:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "@fjl, can you comment on this?",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1757538744/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
