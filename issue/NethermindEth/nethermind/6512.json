{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6512",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6512/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6512/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6512/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/6512",
  "id": 2078262793,
  "node_id": "I_kwDOBggaLc5738YJ",
  "number": 6512,
  "title": "`health` endpoint states *syncing* even if synced",
  "user": {
    "login": "kkokosa",
    "id": 11159779,
    "node_id": "MDQ6VXNlcjExMTU5Nzc5",
    "avatar_url": "https://avatars.githubusercontent.com/u/11159779?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kkokosa",
    "html_url": "https://github.com/kkokosa",
    "followers_url": "https://api.github.com/users/kkokosa/followers",
    "following_url": "https://api.github.com/users/kkokosa/following{/other_user}",
    "gists_url": "https://api.github.com/users/kkokosa/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kkokosa/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kkokosa/subscriptions",
    "organizations_url": "https://api.github.com/users/kkokosa/orgs",
    "repos_url": "https://api.github.com/users/kkokosa/repos",
    "events_url": "https://api.github.com/users/kkokosa/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kkokosa/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2024-01-12T07:50:39Z",
  "updated_at": "2024-01-12T10:30:51Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Description**\r\nThe `health` endpoint answers with `\"IsSyncing\": true` and `\"description\": \"The node is still syncing, CurrentBlock: 18989326, HighestBlock: 18989327. Peers: 100.\",` but the node is synced - for many hours the logs contain only repeating messages:\r\n\r\n```\r\n12 Jan 08:45:24 | Received new block:  18989411 (0x230a30...662a9d)\r\n12 Jan 08:45:25 | Processed            18989411     |    537.37 ms  |  slot     11,729 ms | Gas gwei: 22.15 .. 22.36 (23.79) .. 57.66\r\n12 Jan 08:45:25 | - Block              10.91 MGas   |    177    txs |  calls    517 ( 18) | sload   1,816 | sstore    541 | create   0\r\n12 Jan 08:45:25 | - Block throughput   20.30 MGas/s |    329.39 t/s |          1.86 Blk/s | recv        0 | proc        0\r\n12 Jan 08:45:25 | Received ForkChoice: Head: 18989411 (0x230a30...662a9d), Safe: 18989374 (0x4ea83d...cc330b), Finalized: 18989343 (0x30dcd8...d6fc59)\r\n12 Jan 08:45:25 | Synced chain Head to 18989411 (0x230a30...662a9d)\r\n```\r\n\r\n**Steps to Reproduce**\r\nJust run the non-validator mainnet or gearly fully-synced node and hit `health` JSON RPC endpoint.\r\n\r\n**Screenshots**\r\nDebugging shows it is \"downloading receipts\":\r\n![image](https://github.com/NethermindEth/nethermind/assets/11159779/4d437170-b7ac-4b51-a9ea-248bcdfb9d08)\r\nwhile it is not visible in logs etc.\r\n\r\n**Configuration:**\r\n- Windows, non-validator node, v1.25.0, Lighthouse  v4.5.0-441fc16",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6512/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6512/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1888823031",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6512#issuecomment-1888823031",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6512",
    "id": 1888823031,
    "node_id": "IC_kwDOBggaLc5wlSb3",
    "user": {
      "login": "marcindsobczak",
      "id": 77129288,
      "node_id": "MDQ6VXNlcjc3MTI5Mjg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/77129288?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marcindsobczak",
      "html_url": "https://github.com/marcindsobczak",
      "followers_url": "https://api.github.com/users/marcindsobczak/followers",
      "following_url": "https://api.github.com/users/marcindsobczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/marcindsobczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marcindsobczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marcindsobczak/subscriptions",
      "organizations_url": "https://api.github.com/users/marcindsobczak/orgs",
      "repos_url": "https://api.github.com/users/marcindsobczak/repos",
      "events_url": "https://api.github.com/users/marcindsobczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marcindsobczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-12T10:21:05Z",
    "updated_at": "2024-01-12T10:21:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "Was it synced on older version and then updated to 1.25.0?",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1888823031/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1888827558",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6512#issuecomment-1888827558",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6512",
    "id": 1888827558,
    "node_id": "IC_kwDOBggaLc5wlTim",
    "user": {
      "login": "kkokosa",
      "id": 11159779,
      "node_id": "MDQ6VXNlcjExMTU5Nzc5",
      "avatar_url": "https://avatars.githubusercontent.com/u/11159779?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kkokosa",
      "html_url": "https://github.com/kkokosa",
      "followers_url": "https://api.github.com/users/kkokosa/followers",
      "following_url": "https://api.github.com/users/kkokosa/following{/other_user}",
      "gists_url": "https://api.github.com/users/kkokosa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kkokosa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kkokosa/subscriptions",
      "organizations_url": "https://api.github.com/users/kkokosa/orgs",
      "repos_url": "https://api.github.com/users/kkokosa/repos",
      "events_url": "https://api.github.com/users/kkokosa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kkokosa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-12T10:24:10Z",
    "updated_at": "2024-01-12T10:24:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yes, from fully synced 1.21.0 that was then not running for a month or so.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1888827558/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1888833630",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6512#issuecomment-1888833630",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6512",
    "id": 1888833630,
    "node_id": "IC_kwDOBggaLc5wlVBe",
    "user": {
      "login": "marcindsobczak",
      "id": 77129288,
      "node_id": "MDQ6VXNlcjc3MTI5Mjg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/77129288?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marcindsobczak",
      "html_url": "https://github.com/marcindsobczak",
      "followers_url": "https://api.github.com/users/marcindsobczak/followers",
      "following_url": "https://api.github.com/users/marcindsobczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/marcindsobczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marcindsobczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marcindsobczak/subscriptions",
      "organizations_url": "https://api.github.com/users/marcindsobczak/orgs",
      "repos_url": "https://api.github.com/users/marcindsobczak/repos",
      "events_url": "https://api.github.com/users/marcindsobczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marcindsobczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-12T10:28:17Z",
    "updated_at": "2024-01-12T10:30:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "up to 1.24.0 we used to have ancient barriers in syncing bodies and receipts. In 1.25.0 we removed ancient barriers, freshly synced nodes should download all bodies/receipts, but there is also a blockade to not download additional bodies/receipts on already synced and only updated to 1.25.0 nodes. This way in the line https://github.com/NethermindEth/nethermind/blob/master/src/Nethermind/Nethermind.Facade/Eth/EthSyncingInfo.cs#L66\r\n_blockTree.LowestInsertedBodyNumber = 11052984 (ancient barrier)\r\n_syncConfig.AncientBodiesBarrierCalc = 1 (new barrier from config)\r\n\r\nThis way it is `true` and it will never change, as any bodies/recipts will not be downloaded. We will include fix for it in hotfix to 1.25.0\r\n\r\nFor now there is workaround for it to not receive `syncing` - you need to add ancient barriers back to `mainnet.cfg`\r\n\r\n```\r\n\"Sync\": {\r\n  \"AncientBodiesBarrier\": 11052984,\r\n  \"AncientReceiptsBarrier\": 11052984\r\n}\r\n```\r\n\r\nor as running arguments `--Sync.AncientBodiesBarrier=11052984 --Sync.AncientReceiptsBarrier=11052984`",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1888833630/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
