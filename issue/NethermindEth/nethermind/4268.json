{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4268",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4268/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4268/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4268/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/4268",
  "id": 1300872511,
  "node_id": "I_kwDOBggaLc5Nib0_",
  "number": 4268,
  "title": "WebSocket subscription returns a confirmation but no subsequent data",
  "user": {
    "login": "SpeakinTelnet",
    "id": 105018871,
    "node_id": "U_kgDOBkJ19w",
    "avatar_url": "https://avatars.githubusercontent.com/u/105018871?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/SpeakinTelnet",
    "html_url": "https://github.com/SpeakinTelnet",
    "followers_url": "https://api.github.com/users/SpeakinTelnet/followers",
    "following_url": "https://api.github.com/users/SpeakinTelnet/following{/other_user}",
    "gists_url": "https://api.github.com/users/SpeakinTelnet/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/SpeakinTelnet/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/SpeakinTelnet/subscriptions",
    "organizations_url": "https://api.github.com/users/SpeakinTelnet/orgs",
    "repos_url": "https://api.github.com/users/SpeakinTelnet/repos",
    "events_url": "https://api.github.com/users/SpeakinTelnet/events{/privacy}",
    "received_events_url": "https://api.github.com/users/SpeakinTelnet/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "rubo",
    "id": 337518,
    "node_id": "MDQ6VXNlcjMzNzUxOA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/337518?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rubo",
    "html_url": "https://github.com/rubo",
    "followers_url": "https://api.github.com/users/rubo/followers",
    "following_url": "https://api.github.com/users/rubo/following{/other_user}",
    "gists_url": "https://api.github.com/users/rubo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rubo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rubo/subscriptions",
    "organizations_url": "https://api.github.com/users/rubo/orgs",
    "repos_url": "https://api.github.com/users/rubo/repos",
    "events_url": "https://api.github.com/users/rubo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rubo/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "rubo",
      "id": 337518,
      "node_id": "MDQ6VXNlcjMzNzUxOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/337518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rubo",
      "html_url": "https://github.com/rubo",
      "followers_url": "https://api.github.com/users/rubo/followers",
      "following_url": "https://api.github.com/users/rubo/following{/other_user}",
      "gists_url": "https://api.github.com/users/rubo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rubo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rubo/subscriptions",
      "organizations_url": "https://api.github.com/users/rubo/orgs",
      "repos_url": "https://api.github.com/users/rubo/repos",
      "events_url": "https://api.github.com/users/rubo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rubo/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-07-11T15:24:58Z",
  "updated_at": "2022-07-14T14:23:29Z",
  "closed_at": "2022-07-14T14:23:28Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\n\r\nWhen I make a webSocket subscription to my nethermind node I receive a confirmation that the subscription was properly registered but I don't receive any subsequent data.\r\n\r\n**Versions**\r\n - OS:  Ubuntu 20.04 server\r\n - Nethermind Version : Nethermind/v1.13.4-0-3e5972c24-20220711/X64-Linux/6.0.6\r\n\r\n**Relevent log and code**\r\nHere's the RPC call I'm trying to make:\r\n```\r\n{'jsonrpc': '2.0',\r\n 'id': '1',\r\n 'method': 'eth_subscribe',\r\n 'params': ['newPendingTransactions']}\r\n```\r\nURL:  `ws://127.0.0.1:8546`\r\n\r\nfollowing the call I receive this confirmation:\r\n\r\n```\r\nINFO     connected\r\nINFO     {\"jsonrpc\":\"2.0\",\"result\":\"0x8523535fb20347dead97f1eeed36baec\",\"id\":1}\r\n```\r\nAnd on the Nethermind side:\r\n\r\n```\r\nNethermind.Runner[137]: 2022-07-11 15:02:21.1195|Executing JSON RPC call eth_subscribe with params [newPendingTransactions]\r\n```\r\n\r\nAfter that I receive nothing and I hit my timeout at 60 sec.\r\n\r\n**Additional relevent data**\r\n\r\nmy .env parameters:\r\n\r\n```\r\nNETHERMIND_CONFIG=xdai_validator\r\n\r\nNETHERMIND_LOG_LEVEL=DEBUG\r\n\r\nNETHERMIND_INITCONFIG_WEBSOCKETSENABLED=true\r\nNETHERMIND_INITCONFIG_DISCOVERYENABLED=true\r\n\r\nNETHERMIND_NETWORKCONFIG_MAXACTIVEPEERS=600\r\nNETHERMIND_NETWORKCONFIG_DISCOVERYPORT=30304\r\nNETHERMIND_NETWORKCONFIG_P2PPORT=30304\r\n\r\nNETHERMIND_JSONRPCCONFIG_ADDITIONALRPCURLS=[\"http://localhost:8551|http;ws|net;eth;subscribe;engine;web3;client\"]\r\nNETHERMIND_JSONRPCCONFIG_ENABLED=true\r\nNETHERMIND_JSONRPCCONFIG_ENABLEDMODULES=[Admin,Eth,Subscribe,Trace,TxPool,Web3,Net]\r\nNETHERMIND_JSONRPCCONFIG_HOST=\"0.0.0.0\"\r\nNETHERMIND_JSONRPCCONFIG_PORT=8545\r\nNETHERMIND_JSONRPCCONFIG_WEBSOCKETSPORT=8546\r\n\r\nNETHERMIND_HEALTHCHECKSCONFIG_ENABLED=true\r\nNETHERMIND_HEALTHCHECKSCONFIG_UIENABLED=true\r\n\r\nNETHERMIND_PRUNINGCONFIG_CACHEMB=2048\r\n```\r\n\r\nI use the standard `xdai_validator.cfg` with the MEV module added\r\n\r\nThe same subscription method works for geth, avalanchego and matic Bor\r\n\r\nThe only error I can find is while checking the health it returns this:\r\n\r\n```\r\n{\"status\":\"Unhealthy\",\"totalDuration\":\"00:00:00.0002273\",\"entries\":{\"node-health\":{\"data\":{},\"description\":\"The node is now fully synced with a network. Peers: 235. The node stopped processing blocks. The node stopped producing blocks.\",\"duration\":\"00:00:00.0000274\",\"status\":\"Unhealthy\",\"tags\":[]}}}\r\n```\r\n\r\nAnd while it returns as unhealthy my validator has no connection issue and doing http RPC calls returns the right values\r\n\r\n",
  "closed_by": {
    "login": "rubo",
    "id": 337518,
    "node_id": "MDQ6VXNlcjMzNzUxOA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/337518?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rubo",
    "html_url": "https://github.com/rubo",
    "followers_url": "https://api.github.com/users/rubo/followers",
    "following_url": "https://api.github.com/users/rubo/following{/other_user}",
    "gists_url": "https://api.github.com/users/rubo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rubo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rubo/subscriptions",
    "organizations_url": "https://api.github.com/users/rubo/orgs",
    "repos_url": "https://api.github.com/users/rubo/repos",
    "events_url": "https://api.github.com/users/rubo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rubo/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4268/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4268/timeline",
  "performed_via_github_app": null,
  "state_reason": "not_planned"
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1180551220",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/4268#issuecomment-1180551220",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4268",
    "id": 1180551220,
    "node_id": "IC_kwDOBggaLc5GXcg0",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-11T15:25:49Z",
    "updated_at": "2022-07-11T15:25:49Z",
    "author_association": "MEMBER",
    "body": "@dceleda ?",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1180551220/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1183207659",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/4268#issuecomment-1183207659",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4268",
    "id": 1183207659,
    "node_id": "IC_kwDOBggaLc5GhlDr",
    "user": {
      "login": "rubo",
      "id": 337518,
      "node_id": "MDQ6VXNlcjMzNzUxOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/337518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rubo",
      "html_url": "https://github.com/rubo",
      "followers_url": "https://api.github.com/users/rubo/followers",
      "following_url": "https://api.github.com/users/rubo/following{/other_user}",
      "gists_url": "https://api.github.com/users/rubo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rubo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rubo/subscriptions",
      "organizations_url": "https://api.github.com/users/rubo/orgs",
      "repos_url": "https://api.github.com/users/rubo/repos",
      "events_url": "https://api.github.com/users/rubo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rubo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-13T13:12:59Z",
    "updated_at": "2022-07-13T13:24:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "@SpeakinTelnet We were unable to reproduce the issue on our end even with the configuration you provided. Is there anything else more specific we need to know? Are you able to constantly reproduce this issue?\r\n\r\nAs per your report, the node was unhealthy, any weirdness could happen. Please ensure it's always healthy.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1183207659/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1183282250",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/4268#issuecomment-1183282250",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4268",
    "id": 1183282250,
    "node_id": "IC_kwDOBggaLc5Gh3RK",
    "user": {
      "login": "SpeakinTelnet",
      "id": 105018871,
      "node_id": "U_kgDOBkJ19w",
      "avatar_url": "https://avatars.githubusercontent.com/u/105018871?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SpeakinTelnet",
      "html_url": "https://github.com/SpeakinTelnet",
      "followers_url": "https://api.github.com/users/SpeakinTelnet/followers",
      "following_url": "https://api.github.com/users/SpeakinTelnet/following{/other_user}",
      "gists_url": "https://api.github.com/users/SpeakinTelnet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SpeakinTelnet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SpeakinTelnet/subscriptions",
      "organizations_url": "https://api.github.com/users/SpeakinTelnet/orgs",
      "repos_url": "https://api.github.com/users/SpeakinTelnet/repos",
      "events_url": "https://api.github.com/users/SpeakinTelnet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SpeakinTelnet/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-13T14:15:39Z",
    "updated_at": "2022-07-13T14:15:39Z",
    "author_association": "NONE",
    "body": "Thank you for taking the time. I tried looking at why the node came out as unhealty but there wasn't much in the log except for  ``Could not find common ancestor with [HBR   ]`` which I couldn't find information on why it'd throw this error. \r\n\r\nThe node is currently running in a LXC container so I've cloned it and started it exactly as-is but on a new database and it seems to work. I receive the websocket data on newHeads while it's syncing. I'll just wait until it is fully synced but it seems to indicate an issue with the db might be the culprit.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1183282250/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1183865025",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/4268#issuecomment-1183865025",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4268",
    "id": 1183865025,
    "node_id": "IC_kwDOBggaLc5GkFjB",
    "user": {
      "login": "SpeakinTelnet",
      "id": 105018871,
      "node_id": "U_kgDOBkJ19w",
      "avatar_url": "https://avatars.githubusercontent.com/u/105018871?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SpeakinTelnet",
      "html_url": "https://github.com/SpeakinTelnet",
      "followers_url": "https://api.github.com/users/SpeakinTelnet/followers",
      "following_url": "https://api.github.com/users/SpeakinTelnet/following{/other_user}",
      "gists_url": "https://api.github.com/users/SpeakinTelnet/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SpeakinTelnet/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SpeakinTelnet/subscriptions",
      "organizations_url": "https://api.github.com/users/SpeakinTelnet/orgs",
      "repos_url": "https://api.github.com/users/SpeakinTelnet/repos",
      "events_url": "https://api.github.com/users/SpeakinTelnet/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SpeakinTelnet/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-14T01:50:15Z",
    "updated_at": "2022-07-14T01:50:15Z",
    "author_association": "NONE",
    "body": "Ok so here's the end result in case someone ends up with a similar situation.\r\n\r\nThe database was definitely the culprit. It wasn't bad enough to make http calls unsuccessful neither did it cause any issue for my validators. It just threw off the websockets for some reason. \r\n\r\nI've sync the db on another node, everything was working. I did an nfs mount to the first node with the new database and it was also working. I still don't know how the db became in that state but it seems to be a really isolated issue.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1183865025/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1184511426",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/4268#issuecomment-1184511426",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4268",
    "id": 1184511426,
    "node_id": "IC_kwDOBggaLc5GmjXC",
    "user": {
      "login": "rubo",
      "id": 337518,
      "node_id": "MDQ6VXNlcjMzNzUxOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/337518?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rubo",
      "html_url": "https://github.com/rubo",
      "followers_url": "https://api.github.com/users/rubo/followers",
      "following_url": "https://api.github.com/users/rubo/following{/other_user}",
      "gists_url": "https://api.github.com/users/rubo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rubo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rubo/subscriptions",
      "organizations_url": "https://api.github.com/users/rubo/orgs",
      "repos_url": "https://api.github.com/users/rubo/repos",
      "events_url": "https://api.github.com/users/rubo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rubo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-14T14:23:28Z",
    "updated_at": "2022-07-14T14:23:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "@SpeakinTelnet Thanks for the update. For now, I'm closing the issue. Feel free to reopen it if you encounter the issue again.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1184511426/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
