{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2375",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2375/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2375/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2375/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/2375",
  "id": 719427175,
  "node_id": "MDU6SXNzdWU3MTk0MjcxNzU=",
  "number": 2375,
  "title": "Set default TX gas limit to TargetBlockGasLimit/5 like in OpenEthereum",
  "user": {
    "login": "varasev",
    "id": 33550681,
    "node_id": "MDQ6VXNlcjMzNTUwNjgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/33550681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/varasev",
    "html_url": "https://github.com/varasev",
    "followers_url": "https://api.github.com/users/varasev/followers",
    "following_url": "https://api.github.com/users/varasev/following{/other_user}",
    "gists_url": "https://api.github.com/users/varasev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/varasev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/varasev/subscriptions",
    "organizations_url": "https://api.github.com/users/varasev/orgs",
    "repos_url": "https://api.github.com/users/varasev/repos",
    "events_url": "https://api.github.com/users/varasev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/varasev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "LukaszRozmej",
    "id": 12445221,
    "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LukaszRozmej",
    "html_url": "https://github.com/LukaszRozmej",
    "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
    "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
    "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
    "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
    "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
    "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "LukaszRozmej",
      "id": 12445221,
      "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LukaszRozmej",
      "html_url": "https://github.com/LukaszRozmej",
      "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
      "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
      "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
      "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
      "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
      "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-10-12T14:30:46Z",
  "updated_at": "2021-07-14T12:29:49Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "I'm trying to run TxPriority tests with the latest Nethermind version (built manually from the `master` branch, commit [`87c7d0`](https://github.com/NethermindEth/nethermind/tree/87c7d04df7e95a41f5016dc09b4b56f6e3698bc0)).\r\n\r\nI'm using this branch for that: https://github.com/poanetwork/posdao-test-setup/tree/tx-priority-tests - to see the error, you need to perform `npm run all-nethermind` command.\r\n\r\nAt the beginning of the tests, there are three transactions sent in batch mode: https://github.com/poanetwork/posdao-test-setup/blob/38f7e6c826bf1c9aba6d9494bdda74927d253380/test/00_tx_priority.js#L33-L55\r\n\r\nThe first one (to call `setErcToNativeBridgesAllowed`) is successful, but the other two (to call `addExtraReceiver`) revert. That's pretty weird because the first one allows performing the other two. I don't see the same issue with OpenEthereum (all three transactions are mined successfully as they should).\r\n\r\nI tried to `console.log(results)` after [this line](https://github.com/poanetwork/posdao-test-setup/blob/38f7e6c826bf1c9aba6d9494bdda74927d253380/test/00_tx_priority.js#L53) and saw that all three transactions are mined in the same block (as expected), but only the first one is successful.\r\n\r\nPlease, figure out this as the issue doesn't let me test TxPriority.\r\n\r\nThe [`addExtraReceiver`](https://github.com/poanetwork/posdao-contracts/blob/e19a374d8cc5d5279a1da5bc5185126f7ce50ca2/contracts/base/BlockRewardAuRaBase.sol#L190) can only revert if its `_amount` param is zero or the transaction sender is not defined by the [`setErcToNativeBridgesAllowed`](https://github.com/poanetwork/posdao-contracts/blob/e19a374d8cc5d5279a1da5bc5185126f7ce50ca2/contracts/base/BlockRewardAuRaBase.sol#L331) (for example, when an empty array passed to its function).\r\n\r\nBut other code which calls `setErcToNativeBridgesAllowed` and `addExtraReceiver` works fine with Nethermind: https://github.com/poanetwork/posdao-test-setup/blob/38f7e6c826bf1c9aba6d9494bdda74927d253380/utils/mintCoins.js#L15-L36 - this code works before TxPriority tests.\r\n\r\nI guess, the reason can be in batch requests handling in Nethermind.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2375/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2375/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/707712771",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2375#issuecomment-707712771",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2375",
    "id": 707712771,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNzcxMjc3MQ==",
    "user": {
      "login": "varasev",
      "id": 33550681,
      "node_id": "MDQ6VXNlcjMzNTUwNjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33550681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/varasev",
      "html_url": "https://github.com/varasev",
      "followers_url": "https://api.github.com/users/varasev/followers",
      "following_url": "https://api.github.com/users/varasev/following{/other_user}",
      "gists_url": "https://api.github.com/users/varasev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/varasev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/varasev/subscriptions",
      "organizations_url": "https://api.github.com/users/varasev/orgs",
      "repos_url": "https://api.github.com/users/varasev/repos",
      "events_url": "https://api.github.com/users/varasev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/varasev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-13T12:43:40Z",
    "updated_at": "2020-10-22T09:14:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "That was due to implicit gasLimit. Let's set default TX gas limit to `TargetBlockGasLimit / 5` like in OpenEthereum.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/707712771/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/714354317",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2375#issuecomment-714354317",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2375",
    "id": 714354317,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxNDM1NDMxNw==",
    "user": {
      "login": "varasev",
      "id": 33550681,
      "node_id": "MDQ6VXNlcjMzNTUwNjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33550681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/varasev",
      "html_url": "https://github.com/varasev",
      "followers_url": "https://api.github.com/users/varasev/followers",
      "following_url": "https://api.github.com/users/varasev/following{/other_user}",
      "gists_url": "https://api.github.com/users/varasev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/varasev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/varasev/subscriptions",
      "organizations_url": "https://api.github.com/users/varasev/orgs",
      "repos_url": "https://api.github.com/users/varasev/repos",
      "events_url": "https://api.github.com/users/varasev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/varasev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-22T09:16:00Z",
    "updated_at": "2020-10-22T09:16:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "I renamed this to `Set default TX gas limit to TargetBlockGasLimit/5 like in OpenEthereum`.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/714354317/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/879849623",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2375#issuecomment-879849623",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2375",
    "id": 879849623,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3OTg0OTYyMw==",
    "user": {
      "login": "varasev",
      "id": 33550681,
      "node_id": "MDQ6VXNlcjMzNTUwNjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33550681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/varasev",
      "html_url": "https://github.com/varasev",
      "followers_url": "https://api.github.com/users/varasev/followers",
      "following_url": "https://api.github.com/users/varasev/following{/other_user}",
      "gists_url": "https://api.github.com/users/varasev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/varasev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/varasev/subscriptions",
      "organizations_url": "https://api.github.com/users/varasev/orgs",
      "repos_url": "https://api.github.com/users/varasev/repos",
      "events_url": "https://api.github.com/users/varasev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/varasev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-14T12:29:48Z",
    "updated_at": "2021-07-14T12:29:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "In OpenEthereum it is implemented here https://github.com/openethereum/openethereum/blob/fdaee51ca07710081d27722449478b20dfbf72c9/crates/ethcore/src/miner/miner.rs#L1009-L1011 and used here https://github.com/openethereum/openethereum/blob/fdaee51ca07710081d27722449478b20dfbf72c9/crates/ethcore/src/client/client.rs#L2754\r\n\r\nSo, it is not only for service transactions, but for all transactions created by the node in OpenEthereum's code (e.g. posdao's randomness transactions and so on).\r\n\r\nExamples of where it is used in OE's code:\r\n\r\n- https://github.com/openethereum/openethereum/blob/fdaee51ca07710081d27722449478b20dfbf72c9/crates/ethcore/src/client/client.rs#L2770\r\n- https://github.com/openethereum/openethereum/blob/fdaee51ca07710081d27722449478b20dfbf72c9/crates/ethcore/src/engines/authority_round/mod.rs#L1329\r\n- https://github.com/openethereum/openethereum/blob/fdaee51ca07710081d27722449478b20dfbf72c9/crates/ethcore/src/engines/authority_round/mod.rs#L1398\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/879849623/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
