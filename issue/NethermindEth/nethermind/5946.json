{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5946",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5946/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5946/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5946/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/5946",
  "id": 1812031335,
  "node_id": "I_kwDOBggaLc5sAWdn",
  "number": 5946,
  "title": "`eth_estimateGas` returns too low gas estimate when sending ETH to fallback method",
  "user": {
    "login": "KillariDev",
    "id": 13102010,
    "node_id": "MDQ6VXNlcjEzMTAyMDEw",
    "avatar_url": "https://avatars.githubusercontent.com/u/13102010?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/KillariDev",
    "html_url": "https://github.com/KillariDev",
    "followers_url": "https://api.github.com/users/KillariDev/followers",
    "following_url": "https://api.github.com/users/KillariDev/following{/other_user}",
    "gists_url": "https://api.github.com/users/KillariDev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/KillariDev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/KillariDev/subscriptions",
    "organizations_url": "https://api.github.com/users/KillariDev/orgs",
    "repos_url": "https://api.github.com/users/KillariDev/repos",
    "events_url": "https://api.github.com/users/KillariDev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/KillariDev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1124483401,
      "node_id": "MDU6TGFiZWwxMTI0NDgzNDAx",
      "url": "https://api.github.com/repos/NethermindEth/nethermind/labels/rpc",
      "name": "rpc",
      "color": "efe37a",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "OlegJakushkin",
    "id": 2915361,
    "node_id": "MDQ6VXNlcjI5MTUzNjE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2915361?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/OlegJakushkin",
    "html_url": "https://github.com/OlegJakushkin",
    "followers_url": "https://api.github.com/users/OlegJakushkin/followers",
    "following_url": "https://api.github.com/users/OlegJakushkin/following{/other_user}",
    "gists_url": "https://api.github.com/users/OlegJakushkin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/OlegJakushkin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/OlegJakushkin/subscriptions",
    "organizations_url": "https://api.github.com/users/OlegJakushkin/orgs",
    "repos_url": "https://api.github.com/users/OlegJakushkin/repos",
    "events_url": "https://api.github.com/users/OlegJakushkin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/OlegJakushkin/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "OlegJakushkin",
      "id": 2915361,
      "node_id": "MDQ6VXNlcjI5MTUzNjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2915361?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/OlegJakushkin",
      "html_url": "https://github.com/OlegJakushkin",
      "followers_url": "https://api.github.com/users/OlegJakushkin/followers",
      "following_url": "https://api.github.com/users/OlegJakushkin/following{/other_user}",
      "gists_url": "https://api.github.com/users/OlegJakushkin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/OlegJakushkin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/OlegJakushkin/subscriptions",
      "organizations_url": "https://api.github.com/users/OlegJakushkin/orgs",
      "repos_url": "https://api.github.com/users/OlegJakushkin/repos",
      "events_url": "https://api.github.com/users/OlegJakushkin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/OlegJakushkin/received_events",
      "type": "User",
      "site_admin": false
    },
    {
      "login": "emlautarom1",
      "id": 31224949,
      "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emlautarom1",
      "html_url": "https://github.com/emlautarom1",
      "followers_url": "https://api.github.com/users/emlautarom1/followers",
      "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
      "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
      "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
      "repos_url": "https://api.github.com/users/emlautarom1/repos",
      "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-07-19T14:04:03Z",
  "updated_at": "2023-08-03T13:52:45Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Description**\r\nWhen trying to estimate gas for sending ETH to fallback method, the estimate is too low. Here's the estimate gas RPC query:\r\n```json\r\n{\r\n    \"jsonrpc\": \"2.0\",\r\n    \"id\": 1,\r\n    \"method\":\"eth_estimateGas\",\r\n    \"params\":[{\r\n        \"from\": \"0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045\",\r\n        \"to\": \"0x6978a05bbb01fcc27a41ff34f60472652bb04cfc\",\r\n        \"value\": \"0xde0b6b3a7640000\"\r\n    }]\r\n}\r\n```\r\n\r\nThis returns `0xbef9` which is 48889. For the same query Geth gives 54036. When executing the call itself, it consumes `41173` gas, which is less than the estimates, but the contract probably gets some discounts and might be doing some weird stuff with GAS opcode. Geths estimate is enough to make the call work, but Netherminds is not.\r\n\r\nNethermind version: 1.17.3 and <https://github.com/NethermindEth/nethermind/tree/feature/eth_multicall>\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5946/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5946/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1663874910",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/5946#issuecomment-1663874910",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5946",
    "id": 1663874910,
    "node_id": "IC_kwDOBggaLc5jLLde",
    "user": {
      "login": "emlautarom1",
      "id": 31224949,
      "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emlautarom1",
      "html_url": "https://github.com/emlautarom1",
      "followers_url": "https://api.github.com/users/emlautarom1/followers",
      "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
      "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
      "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
      "repos_url": "https://api.github.com/users/emlautarom1/repos",
      "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-03T12:15:26Z",
    "updated_at": "2023-08-03T12:15:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "Could you try making the RPC call with the following params:\r\n\r\n```json\r\n\"params\": [{\r\n        \"from\": \"0xd8dA6BF26964aF9D7eEd9e03E53415D37aA96045\",\r\n        \"to\": \"0x6978a05bbb01fcc27a41ff34f60472652bb04cfc\",\r\n        \"value\": \"0xde0b6b3a7640000\",\r\n        \"gas\": \"0x1c9c380\"\r\n}]\r\n```\r\n\r\nNote the additional `\"gas\": \"0x1c9c380\"` field. With this extra field, you should might get the correct estimation.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1663874910/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1664025199",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/5946#issuecomment-1664025199",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5946",
    "id": 1664025199,
    "node_id": "IC_kwDOBggaLc5jLwJv",
    "user": {
      "login": "MicahZoltu",
      "id": 886059,
      "node_id": "MDQ6VXNlcjg4NjA1OQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/886059?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MicahZoltu",
      "html_url": "https://github.com/MicahZoltu",
      "followers_url": "https://api.github.com/users/MicahZoltu/followers",
      "following_url": "https://api.github.com/users/MicahZoltu/following{/other_user}",
      "gists_url": "https://api.github.com/users/MicahZoltu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MicahZoltu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MicahZoltu/subscriptions",
      "organizations_url": "https://api.github.com/users/MicahZoltu/orgs",
      "repos_url": "https://api.github.com/users/MicahZoltu/repos",
      "events_url": "https://api.github.com/users/MicahZoltu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MicahZoltu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-03T13:52:45Z",
    "updated_at": "2023-08-03T13:52:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "Is this just for testing and/or as a workaround, or is the expectation that all callers set a gas limit when doing estimate gas?",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1664025199/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
