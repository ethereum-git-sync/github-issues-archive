{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6199",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6199/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6199/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6199/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/6199",
  "id": 1947846714,
  "node_id": "I_kwDOBggaLc50Gcg6",
  "number": 6199,
  "title": "Auto-Pruning issue when datadir is placed in different filesystem then root",
  "user": {
    "login": "olisovyi-everstake",
    "id": 105422533,
    "node_id": "U_kgDOBkiexQ",
    "avatar_url": "https://avatars.githubusercontent.com/u/105422533?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/olisovyi-everstake",
    "html_url": "https://github.com/olisovyi-everstake",
    "followers_url": "https://api.github.com/users/olisovyi-everstake/followers",
    "following_url": "https://api.github.com/users/olisovyi-everstake/following{/other_user}",
    "gists_url": "https://api.github.com/users/olisovyi-everstake/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/olisovyi-everstake/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/olisovyi-everstake/subscriptions",
    "organizations_url": "https://api.github.com/users/olisovyi-everstake/orgs",
    "repos_url": "https://api.github.com/users/olisovyi-everstake/repos",
    "events_url": "https://api.github.com/users/olisovyi-everstake/events{/privacy}",
    "received_events_url": "https://api.github.com/users/olisovyi-everstake/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-10-17T16:47:38Z",
  "updated_at": "2023-11-06T20:00:34Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I am encountering an issue with Nethermind’s auto-pruning functionality when the server has an LVM (Logical Volume Manager). According to my configuration, Nethermind should be activated when the available space on the filesystem that contains Nethermind datadir falls below 350 GB.\r\nHowever, in reality, it appears to be checking the root filesystem (“/”) instead, which results in incorrect behavior. Below is the output of the df -h command for reference:\r\n```\r\nFilesystem            Size  Used Avail Use% Mounted on\r\ntmpfs                 6.3G  2.0M  6.3G   1% /run\r\n/dev/mapper/vg0-root   98G   23G   71G  24% /\r\ntmpfs                  32G     0   32G   0% /dev/shm\r\ntmpfs                 5.0M     0  5.0M   0% /run/lock\r\n/dev/nvme0n1p2        2.0G  405M  1.4G  23% /boot\r\n/dev/nvme0n1p1        1.1G  6.1M  1.1G   1% /boot/efi\r\n/dev/mapper/vg0-home   40G  1.1G   36G   3% /home\r\n/dev/mapper/vg0-node  3.5T  652G  2.7T  20% /mnt/operational\r\ntmpfs                 6.3G  4.0K  6.3G   1% /run/user/1000\r\n```\r\nAs per the configuration, Nethermind should focus on the /mnt/operational filesystem, where the Nethermind datadir is located, and trigger when the available space reaches or falls below 350 GB. However, it currently appears to monitor the root filesystem (“/”) instead.\r\nConfiguration:\r\n```\r\nExecStart=/usr/bin/nethermind --config=mainnet --datadir=/mnt/operational/nethermind --Sync.AncientBodiesBarrier 11052984 --Sync.AncientReceiptsBarrier 11052984 --JsonRpc.JwtSecretFile=/mnt/operational/jwt/jwt.hex --JsonRpc.AdditionalRpcUrls http://127.0.0.1:1337/|http|admin --JsonRpc.EnginePort 8551  --JsonRpc.Enabled=true --JsonRpc.EngineHost=0.0.0.0 --JsonRpc.Host=0.0.0.0 --Metrics.Enabled=true --Metrics.ExposePort=7070 --EthStats.Server=0.0.0.0 --Pruning.FullPruningCompletionBehavior AlwaysShutdown --Pruning.FullPruningTrigger=VolumeFreeSpace --Pruning.FullPruningThresholdMb=375810 --Pruning.FullPruningMaxDegreeOfParallelism 4 --Pruning.FullPruningMemoryBudgetMb=16384\r\n```\r\nVersions:\r\n```\r\nUbuntu 22.04.3 LTS\r\nNethermind Version: 1.20.4+d06ec791\r\n```\r\nThis issue is impacting the correct operation of Nethermind’s auto-pruning functionality. Any assistance in resolving this issue would be greatly appreciated.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6199/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6199/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1796292770",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6199#issuecomment-1796292770",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6199",
    "id": 1796292770,
    "node_id": "IC_kwDOBggaLc5rEUCi",
    "user": {
      "login": "milindbl",
      "id": 1390748,
      "node_id": "MDQ6VXNlcjEzOTA3NDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1390748?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/milindbl",
      "html_url": "https://github.com/milindbl",
      "followers_url": "https://api.github.com/users/milindbl/followers",
      "following_url": "https://api.github.com/users/milindbl/following{/other_user}",
      "gists_url": "https://api.github.com/users/milindbl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/milindbl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/milindbl/subscriptions",
      "organizations_url": "https://api.github.com/users/milindbl/orgs",
      "repos_url": "https://api.github.com/users/milindbl/repos",
      "events_url": "https://api.github.com/users/milindbl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/milindbl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-06T20:00:33Z",
    "updated_at": "2023-11-06T20:00:33Z",
    "author_association": "NONE",
    "body": "Just discovered the same issue\r\n\r\nMeanwhile I'm using a script that will trigger pruning manually if disk-space is below a certain threshold (on the correct drive). A cronjob runs the script periodically.\r\n\r\nHere is the script if anyone wants to be inspired by it:\r\nhttps://gist.github.com/milindbl/8765dbbb9799fc8b64fc3e890d046d51",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1796292770/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
