{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/1127",
  "id": 537541581,
  "node_id": "MDU6SXNzdWU1Mzc1NDE1ODE=",
  "number": 1127,
  "title": "Rethink Rpl encoding design",
  "user": {
    "login": "Scooletz",
    "id": 519707,
    "node_id": "MDQ6VXNlcjUxOTcwNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/519707?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Scooletz",
    "html_url": "https://github.com/Scooletz",
    "followers_url": "https://api.github.com/users/Scooletz/followers",
    "following_url": "https://api.github.com/users/Scooletz/following{/other_user}",
    "gists_url": "https://api.github.com/users/Scooletz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Scooletz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Scooletz/subscriptions",
    "organizations_url": "https://api.github.com/users/Scooletz/orgs",
    "repos_url": "https://api.github.com/users/Scooletz/repos",
    "events_url": "https://api.github.com/users/Scooletz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Scooletz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1023953465,
      "node_id": "MDU6TGFiZWwxMDIzOTUzNDY1",
      "url": "https://api.github.com/repos/NethermindEth/nethermind/labels/refactoring",
      "name": "refactoring",
      "color": "56cbd3",
      "default": false,
      "description": ""
    },
    {
      "id": 1117819507,
      "node_id": "MDU6TGFiZWwxMTE3ODE5NTA3",
      "url": "https://api.github.com/repos/NethermindEth/nethermind/labels/performance",
      "name": "performance",
      "color": "ee2bf2",
      "default": false,
      "description": ""
    },
    {
      "id": 1217673486,
      "node_id": "MDU6TGFiZWwxMjE3NjczNDg2",
      "url": "https://api.github.com/repos/NethermindEth/nethermind/labels/difficult",
      "name": "difficult",
      "color": "d4c5f9",
      "default": false,
      "description": "It requires detailed knowledge of the codebase and changes can easily lead to severe issues. a"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 13,
  "created_at": "2019-12-13T13:09:14Z",
  "updated_at": "2020-04-26T21:30:42Z",
  "closed_at": "2020-04-26T21:30:42Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Currently, Rpl encoding is based on a common interface that might fit some scenarios but make the evolution of the encoding a bit hard to change. It requires a common denominator, which in various cases might be harmful or time-consuming to implement. Below, you can find a draft of the change\r\n\r\n### Current state\r\n\r\nCurrently, Rpl encoding is based on a the following interface.\r\n\r\nhttps://github.com/NethermindEth/nethermind/blob/062d52d0e4adeb332fafb8635899bbd985af86b3/src/Nethermind/Nethermind.Core/Encoding/IRlpDecoder.cs#L27-L33\r\n\r\nand a method dispatching the call to the specific implementation\r\n\r\nhttps://github.com/NethermindEth/nethermind/blob/062d52d0e4adeb332fafb8635899bbd985af86b3/src/Nethermind/Nethermind.Core/Encoding/Rlp.cs#L154-L166\r\n\r\nThe interface specifies the way to encode and decode a value of a specific type to various formats. According to my understanding:\r\n\r\n1. all of the types (or majority of them) are known when encoding/decoding happens \r\n1. there's no need for dynamic dispatch\r\n1. there might be various needs when encoding/decoding specific values\r\n1. specific values might be decodable/encodable to different payload formats (some for instance might be able to use `Span<byte>` etc).\r\n1. a large part of encoding goes through the mentioned `Encode<T>` when the type is already known.\r\n\r\n### Design Proposition\r\n\r\nMy proposition is to move majority/all `Encode` and `Decode` method to the types themselves, or implement them as extension methods. Extensions methods can handle `null` value of `this` so it might be even better. This would allow much easier evolution and implementing the needed approach for a specific case.\r\n\r\nFor every type that is currently encoded decoded, it would make it much easier to dispatch the operation, as the following call\r\n\r\n```csharp\r\nRpl.Encode<Address> (address);\r\n```\r\n\r\nwould become a direct call on the address\r\n\r\n```csharp\r\naddress.Encode();\r\n```\r\n\r\nThis would allow different types of outputs and addressing different needs for different items.\r\n\r\nAdditionally, it could possibly support a better chaining of `Rpl`s which is currently done by nested copying like in the following example.\r\n\r\nhttps://github.com/NethermindEth/nethermind/blob/062d52d0e4adeb332fafb8635899bbd985af86b3/src/Nethermind/Nethermind.Network/Discovery/Serializers/PongMessageSerializer.cs#L35-L39\r\n\r\n### Expected results\r\n\r\nLess allocations, more performance. This requires some serious thinking though and understanding of Rpl format and its needs",
  "closed_by": {
    "login": "tkstanczak",
    "id": 498913,
    "node_id": "MDQ6VXNlcjQ5ODkxMw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tkstanczak",
    "html_url": "https://github.com/tkstanczak",
    "followers_url": "https://api.github.com/users/tkstanczak/followers",
    "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
    "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
    "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
    "repos_url": "https://api.github.com/users/tkstanczak/repos",
    "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565436130",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/1127#issuecomment-565436130",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127",
    "id": 565436130,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NTQzNjEzMA==",
    "user": {
      "login": "Scooletz",
      "id": 519707,
      "node_id": "MDQ6VXNlcjUxOTcwNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/519707?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Scooletz",
      "html_url": "https://github.com/Scooletz",
      "followers_url": "https://api.github.com/users/Scooletz/followers",
      "following_url": "https://api.github.com/users/Scooletz/following{/other_user}",
      "gists_url": "https://api.github.com/users/Scooletz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Scooletz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Scooletz/subscriptions",
      "organizations_url": "https://api.github.com/users/Scooletz/orgs",
      "repos_url": "https://api.github.com/users/Scooletz/repos",
      "events_url": "https://api.github.com/users/Scooletz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Scooletz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-13T13:11:38Z",
    "updated_at": "2019-12-13T13:13:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "This is a rough description of the design change that I mentioned @tkstanczak It's for sure exploratory but maybe it's worth it to consider. I applied labels according to my understanding of their meaning.\r\n\r\nI'd like to be a part of its implementation if we consider it a valid proposal.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565436130/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565460065",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/1127#issuecomment-565460065",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127",
    "id": 565460065,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NTQ2MDA2NQ==",
    "user": {
      "login": "Scooletz",
      "id": 519707,
      "node_id": "MDQ6VXNlcjUxOTcwNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/519707?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Scooletz",
      "html_url": "https://github.com/Scooletz",
      "followers_url": "https://api.github.com/users/Scooletz/followers",
      "following_url": "https://api.github.com/users/Scooletz/following{/other_user}",
      "gists_url": "https://api.github.com/users/Scooletz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Scooletz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Scooletz/subscriptions",
      "organizations_url": "https://api.github.com/users/Scooletz/orgs",
      "repos_url": "https://api.github.com/users/Scooletz/repos",
      "events_url": "https://api.github.com/users/Scooletz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Scooletz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-13T14:27:25Z",
    "updated_at": "2019-12-13T14:27:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "Note to a reviewer: There's `ValueDecoderContext` for span based decoding and its counterpart `IRlpValueDecoder` but there's no support for writing for example to `IBufferWriter<T>`. Again, this requires revisiting when thinking about the issue.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565460065/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565460495",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/1127#issuecomment-565460495",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127",
    "id": 565460495,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NTQ2MDQ5NQ==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-13T14:28:44Z",
    "updated_at": "2019-12-13T14:28:44Z",
    "author_association": "MEMBER",
    "body": "There is much more to it:\r\n\r\n```\r\n        public void Serialize(IByteBuffer byteBuffer, BlockHeadersMessage message)\r\n        {\r\n            int contentLength = 0;\r\n            for (int i = 0; i < message.BlockHeaders.Length; i++)\r\n            {\r\n                contentLength += _headerDecoder.GetLength(message.BlockHeaders[i], RlpBehaviors.None);\r\n            }\r\n            \r\n            int length = Rlp.LengthOfSequence(contentLength);\r\n            byteBuffer.EnsureWritable(length, true);\r\n            \r\n            RlpStream rlpStream = new NettyRlpStream(byteBuffer);\r\n            rlpStream.StartSequence(contentLength);\r\n            for (int i = 0; i < message.BlockHeaders.Length; i++)\r\n            {\r\n                rlpStream.Encode(message.BlockHeaders[i]);\r\n            }\r\n        }\r\n\r\n        public BlockHeadersMessage Deserialize(IByteBuffer byteBuffer)\r\n        {\r\n            RlpStream rlpStream = new NettyRlpStream(byteBuffer);\r\n            return Deserialize(rlpStream);\r\n        }\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565460495/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565460790",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/1127#issuecomment-565460790",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127",
    "id": 565460790,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NTQ2MDc5MA==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-13T14:29:38Z",
    "updated_at": "2019-12-13T14:29:38Z",
    "author_association": "MEMBER",
    "body": "Most of the projects include RLP serilization in types but I preferred to keep them POCO and not pollute with serialization.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565460790/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565460968",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/1127#issuecomment-565460968",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127",
    "id": 565460968,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NTQ2MDk2OA==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-13T14:30:09Z",
    "updated_at": "2019-12-13T14:30:09Z",
    "author_association": "MEMBER",
    "body": "network Discovery classes are some of the oldest unfixed classes so RLP there is also very old style",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565460968/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565461195",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/1127#issuecomment-565461195",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127",
    "id": 565461195,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NTQ2MTE5NQ==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-13T14:30:42Z",
    "updated_at": "2019-12-13T14:30:42Z",
    "author_association": "MEMBER",
    "body": "nesting is inefficient and was replaced by better approches in wherever it was the most significant in the perf tests",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565461195/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565461501",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/1127#issuecomment-565461501",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127",
    "id": 565461501,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NTQ2MTUwMQ==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-13T14:31:33Z",
    "updated_at": "2019-12-13T14:31:33Z",
    "author_association": "MEMBER",
    "body": "Encoding address for example was optimized in RlpStream to:\r\n```\r\npublic void Encode(Address address)\r\n        {\r\n            if (address == null)\r\n            {\r\n                WriteByte(EmptyArrayByte);\r\n            }\r\n            else\r\n            {\r\n                WriteByte(148);\r\n                Write(address.Bytes);\r\n            }\r\n        }\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565461501/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565461885",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/1127#issuecomment-565461885",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127",
    "id": 565461885,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NTQ2MTg4NQ==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-13T14:32:32Z",
    "updated_at": "2019-12-13T14:32:32Z",
    "author_association": "MEMBER",
    "body": "and the RlpStream has two implementations:\r\n\r\n```\r\n```\r\n        protected virtual void WriteByte(byte byteToWrite)\r\n        {\r\n            Data[Position++] = byteToWrite;\r\n        }\r\n```\r\n\r\nand\r\n\r\n        protected override void WriteByte(byte byteToWrite)\r\n        {\r\n            _byteBuffer.EnsureWritable(1, true);\r\n            _byteBuffer.WriteByte(byteToWrite);\r\n        }\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565461885/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565462493",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/1127#issuecomment-565462493",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127",
    "id": 565462493,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NTQ2MjQ5Mw==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-13T14:34:00Z",
    "updated_at": "2019-12-13T14:34:00Z",
    "author_association": "MEMBER",
    "body": "generally I agree with many of the points and you probably analyzed mostly the old classes that I would like to replace too with the RlpStream approach wherever possible - given time to implement which may be significant",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565462493/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565464776",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/1127#issuecomment-565464776",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127",
    "id": 565464776,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NTQ2NDc3Ng==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-13T14:40:12Z",
    "updated_at": "2019-12-13T14:42:41Z",
    "author_association": "MEMBER",
    "body": "> Note to a reviewer: There's `ValueDecoderContext` for span based decoding and its counterpart `IRlpValueDecoder` but there's no support for writing for example to `IBufferWriter<T>`. Again, this requires revisiting when thinking about the issue.\r\n\r\nThis has been implemented by Konrad for a very specific use case which accounts for a huge percentage of RLP encoding - ValueKeccak in Patricia Tree:\r\n\r\n```\r\n        public byte[] Get(UInt256 index)\r\n        {\r\n            Span<byte> key = GetKey(index);\r\n            byte[] value = Get(key);\r\n            if (value == null)\r\n            {\r\n                return new byte[] {0};\r\n            }\r\n\r\n            Rlp.ValueDecoderContext rlp = value.AsRlpValueContext();\r\n            return rlp.DecodeByteArray();\r\n        }\r\n```\r\n\r\nIt was also later used by me during the zero-alloc networking layer rewrite in the frame header decoder:\r\n\r\n```\r\n        public FrameInfo ReadFrameHeader(IByteBuffer input)\r\n        {\r\n            input.ReadBytes(HeaderBytes);\r\n            int frameSize = HeaderBytes[0] & 0xFF;\r\n            frameSize = (frameSize << 8) + (HeaderBytes[1] & 0xFF);\r\n            frameSize = (frameSize << 8) + (HeaderBytes[2] & 0xFF);\r\n\r\n            Rlp.ValueDecoderContext headerBodyItems = HeaderBytes.AsSpan(3, 13).AsRlpValueContext();\r\n            int headerDataEnd = headerBodyItems.ReadSequenceLength() + headerBodyItems.Position;\r\n            int numberOfItems = headerBodyItems.ReadNumberOfItemsRemaining(headerDataEnd);\r\n            headerBodyItems.DecodeInt(); // not needed - adaptive IDs - DO NOT COMMENT OUT!!! - decode takes int of the RLP sequence and moves the position\r\n            int? contextId = numberOfItems > 1 ? headerBodyItems.DecodeInt() : (int?) null;\r\n            _currentContextId = contextId;\r\n            int? totalPacketSize = numberOfItems > 2 ? headerBodyItems.DecodeInt() : (int?) null;\r\n\r\n            bool isChunked = totalPacketSize.HasValue || contextId.HasValue && _currentContextId == contextId && contextId != 0;\r\n            bool isFirst = totalPacketSize.HasValue || !isChunked;\r\n            return new FrameInfo(isChunked, isFirst, frameSize, totalPacketSize ?? frameSize);\r\n        }\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565464776/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565466294",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/1127#issuecomment-565466294",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127",
    "id": 565466294,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NTQ2NjI5NA==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-13T14:44:18Z",
    "updated_at": "2019-12-13T14:44:18Z",
    "author_association": "MEMBER",
    "body": "so the RLP code has multiple duplications dependening on whether we upgraded all the depending code to the new methods while transitioning from:\r\nobject-based RLP -> byte[] RLP -> MemoryStreamRLP -> RecyclableMemoryStreamRLP -> RlpStream RLP",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565466294/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565466522",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/1127#issuecomment-565466522",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127",
    "id": 565466522,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NTQ2NjUyMg==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-13T14:44:54Z",
    "updated_at": "2019-12-13T14:44:54Z",
    "author_association": "MEMBER",
    "body": "the new model is: use RlpStream for storage and use NettyRlpStream for network, use some ultra optimizations in PatriciaTree independently",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565466522/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565467113",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/1127#issuecomment-565467113",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1127",
    "id": 565467113,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NTQ2NzExMw==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-13T14:46:32Z",
    "updated_at": "2019-12-13T14:46:32Z",
    "author_association": "MEMBER",
    "body": "look at the TreeNode class to find the most convoluted optimizations for the PatriciaTree - they are extremely important for the general performance - if you can improve the code there we would immediately see a boost in the Nethermind perf @Scooletz ",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/565467113/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
