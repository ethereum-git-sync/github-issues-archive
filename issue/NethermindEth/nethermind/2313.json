{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2313",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2313/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2313/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2313/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/2313",
  "id": 701355758,
  "node_id": "MDU6SXNzdWU3MDEzNTU3NTg=",
  "number": 2313,
  "title": "Corruption during shutdown",
  "user": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "tkstanczak",
    "id": 498913,
    "node_id": "MDQ6VXNlcjQ5ODkxMw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tkstanczak",
    "html_url": "https://github.com/tkstanczak",
    "followers_url": "https://api.github.com/users/tkstanczak/followers",
    "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
    "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
    "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
    "repos_url": "https://api.github.com/users/tkstanczak/repos",
    "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-09-14T19:10:59Z",
  "updated_at": "2021-02-07T15:17:18Z",
  "closed_at": "2021-02-07T15:17:18Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Ran via docker. Version: `Nethermind/v1.8.102-0-9bacd3300-20200911/X64-Linux/Core3.1.8`\r\n\r\nShutdown sequence:;\r\n```\r\n Sept 14 21:06:32 nethermind.ethdevops.io node 2020-09-14 19:06:32.8997|Peers | with known best block: 100 | all: 101 |\r\nSept 14 21:06:33 nethermind.ethdevops.io node 2020-09-14 19:06:33.7097|Local peer shutdown complete.. please wait for all components to close\r\nSept 14 21:06:33 nethermind.ethdevops.io node 2020-09-14 19:06:33.7168|Closing DBs...\r\nSept 14 21:06:33 nethermind.ethdevops.io node Press RETURN to exit.\r\nSept 14 21:06:33 nethermind.ethdevops.io node 2020-09-14 19:06:33.7283|Failure RocksDbSharp.RocksDbException: Corruption: unknown WriteBatch tag\r\nSept 14 21:06:33 nethermind.ethdevops.io node at RocksDbSharp.Native.rocksdb_flush(IntPtr db, IntPtr options) in /src/rocksdb-sharp/RocksDbSharp/Native.cs:line 1562\r\nSept 14 21:06:33 nethermind.ethdevops.io node at Nethermind.Db.Rocks.DbOnTheRocks.Flush() in /src/Nethermind/Nethermind.Db.Rocks/DbOnTheRocks.cs:line 365\r\nSept 14 21:06:33 nethermind.ethdevops.io node at Nethermind.Db.Rocks.DbOnTheRocks.Dispose(Boolean disposing) in /src/Nethermind/Nethermind.Db.Rocks/DbOnTheRocks.cs:line 413\r\nSept 14 21:06:33 nethermind.ethdevops.io node at Nethermind.Db.Rocks.DbOnTheRocks.Dispose() in /src/Nethermind/Nethermind.Db.Rocks/DbOnTheRocks.cs:line 425\r\nSept 14 21:06:33 nethermind.ethdevops.io node at Nethermind.Db.StateDb.Dispose() in /src/Nethermind/Nethermind.Db/StateDb.cs:line 147\r\nSept 14 21:06:33 nethermind.ethdevops.io node at Nethermind.Db.Rocks.RocksDbProvider.Dispose() in /src/Nethermind/Nethermind.Db.Rocks/RocksDbProvider.cs:line 82\r\nSept 14 21:06:33 nethermind.ethdevops.io node at Nethermind.Runner.Ethereum.EthereumRunner.StopAsync() in /src/Nethermind/Nethermind.Runner/Ethereum/EthereumRunner.cs:line 127\r\nSept 14 21:06:33 nethermind.ethdevops.io node at Nethermind.Runner.RunnerAppBase.StopAsync() in /src/Nethermind/Nethermind.Runner/RunnerAppBase.cs:line 313\r\nSept 14 21:06:35 nethermind.ethdevops.io node Loading standard NLog.config file from /nethermind/NLog.config.\r\nSept 14 21:06:36 nethermind.ethdevops.io node Reading config file from /nethermind/configs/mainnet.cfg \r\n```\r\n\r\nDuring reboot, there was a _wal_ of these: \r\n```\r\n Sept 14 21:07:03 nethermind.ethdevops.io node 2020-09-14 19:07:03.6873|Found a gap in blocks after last shutdown at level 10861809. The node will attempt to continue (the problem may be auto-corrected).\r\nSept 14 21:07:03 nethermind.ethdevops.io node 2020-09-14 19:07:03.6873|Found a gap in blocks after last shutdown at level 10861837. The node will attempt to continue (the problem may be auto-corrected).\r\nSept 14 21:07:03 nethermind.ethdevops.io node 2020-09-14 19:07:03.6873|Found a gap in blocks after last shutdown at level 10861838. The node will attempt to continue (the problem may be auto-corrected). \r\n```\r\n\r\nWhich eventually ended, and it looked good: \r\n```\r\nSept 14 21:07:03 nethermind.ethdevops.io node 2020-09-14 19:07:03.6873|Found a gap in blocks after last shutdown at level 10861900. The node will attempt to continue (the problem may be auto-corrected).\r\nSept 14 21:07:03 nethermind.ethdevops.io node 2020-09-14 19:07:03.6873|Found a gap in blocks after last shutdown at level 10861901. The node will attempt to continue (the problem may be auto-corrected).\r\nSept 14 21:07:03 nethermind.ethdevops.io node 2020-09-14 19:07:03.9300|Now syncing nodes starting from root of block 0\r\nSept 14 21:07:03 nethermind.ethdevops.io node 2020-09-14 19:07:03.9379|HeadersSyncDispatcher has finished work.\r\nSept 14 21:07:03 nethermind.ethdevops.io node 2020-09-14 19:07:03.9379|Fast blocks headers task completed.\r\nSept 14 21:07:04 nethermind.ethdevops.io node 2020-09-14 19:07:04.0000|Initializing ETH Stats for the instance: Foundation Monitoring(nethermind)-0x0138db9d26fd181fb9ef137adc1a4bd277a5a238db64a8422253dd6b4a0c65c3, server: wss://ethstats.net/api/\r\nSept 14 21:07:04 nethermind.ethdevops.io node 2020-09-14 19:07:04.0119|Starting ETH stats [wss://ethstats.net/api/]...\r\nSept 14 21:07:04 nethermind.ethdevops.io node 2020-09-14 19:07:04.1273|\r\nSept 14 21:07:04 nethermind.ethdevops.io node ======================== Nethermind initialization completed ========================\r\nSept 14 21:07:04 nethermind.ethdevops.io node Version : 1.8.102-0-9bacd3300-20200914/X64-Linux/Core3.1.8\r\nSept 14 21:07:04 nethermind.ethdevops.io node This node : enode://a76e051931262494c3f425c878863b2204abb74202f3ba517e2a4de38d8613967b4e2182f1aaa93b7102924bd867d95b2314e50758d248cf34c78e9d8a10d471@18.133.224.49:30303\r\nSept 14 21:07:04 nethermind.ethdevops.io node Node address : 0xd6e56331cf5f2f48941400bf36422a98caa1270c (do not use as an account)\r\nSept 14 21:07:04 nethermind.ethdevops.io node Mem est tx : 82MB\r\nSept 14 21:07:04 nethermind.ethdevops.io node Mem est DB : 301MB\r\nSept 14 21:07:04 nethermind.ethdevops.io node Genesis hash : 0xd4e56740f876aef8c010b86a40d5f56745a118d0906a34e69aec8c0db1cb8fa3\r\nSept 14 21:07:04 nethermind.ethdevops.io node External IP : 18.133.224.49\r\nSept 14 21:07:04 nethermind.ethdevops.io node Ethereum : tcp://18.133.224.49:30303\r\nSept 14 21:07:04 nethermind.ethdevops.io node Discovery : udp://18.133.224.49:30303\r\nSept 14 21:07:04 nethermind.ethdevops.io node DB location : /datadir/ddir\r\nSept 14 21:07:04 nethermind.ethdevops.io node Chainspec : chainspec/foundation.json\r\nSept 14 21:07:04 nethermind.ethdevops.io node Chain ID : Mainnet\r\nSept 14 21:07:04 nethermind.ethdevops.io node Chain head : 10842728 (0x8b4fed...dfcca6)\r\nSept 14 21:07:04 nethermind.ethdevops.io node =====================================================================================\r\nSept 14 21:07:04 nethermind.ethdevops.io node 2020-09-14 19:07:04.6688|Connected to 1 bootnodes, 1030 trusted/persisted nodes\r\nSept 14 21:07:04 nethermind.ethdevops.io node 2020-09-14 19:07:04.7139|Sync peers - Initialized: 2 | All: 3 | Max: 100\r\nSept 14 21:07:04 nethermind.ethdevops.io node [ ][ ][Peer|eth64|10861925|Geth/v1.9.9-stable-01744997/windows-amd64/go1.13.4|78.132.61.170:30303][0|3|0|0|0]\r\nSept 14 21:07:04 nethermind.ethdevops.io node [ ][ ][Peer|eth65|384|Geth/v1.9.13-stable-cbc4ac26/linux-amd64/go1.13|199.247.9.234:30303][0|54|0|0|0]\r\nSept 14 21:07:04 nethermind.ethdevops.io node 2020-09-14 19:07:04.7191|Changing state None to FastSync at processed:10842728|state:10842728|block:10850920|header:10850921|peer block:10861925\r\nSept 14 21:07:04 nethermind.ethdevops.io node 2020-09-14 19:07:04.7195|Sync mode changed from None to FastSync\r\nSept 14 21:07:04 nethermind.ethdevops.io node 2020-09-14 19:07:04.7473|Building ethash cache for epoch 361\r\nSept 14 21:07:04 nethermind.ethdevops.io node 2020-09-14 19:07:04.7473|Building ethash cache for epoch 362\r\nSept 14 21:07:04 nethermind.ethdevops.io node 2020-09-14 19:07:04.7781|Initial connection, sending 'hello' message...\r\nSept 14 21:07:05 nethermind.ethdevops.io node 2020-09-14 19:07:05.7119|Peers | with known best block: 3 | all: 6 |\r\nSept 14 21:07:06 nethermind.ethdevops.io node 2020-09-14 19:07:06.7126|Peers | with known best block: 8 | all: 11 |\r\n```\r\n... when all of a sudden\r\n```\r\nSept 14 21:07:07 nethermind.ethdevops.io node 2020-09-14 19:07:07.7132|Peers | with known best block: 11 | all: 14 |\r\nSept 14 21:07:07 nethermind.ethdevops.io node Stack overflow. \r\n```\r\nAnd then silence. ",
  "closed_by": {
    "login": "tkstanczak",
    "id": 498913,
    "node_id": "MDQ6VXNlcjQ5ODkxMw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tkstanczak",
    "html_url": "https://github.com/tkstanczak",
    "followers_url": "https://api.github.com/users/tkstanczak/followers",
    "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
    "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
    "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
    "repos_url": "https://api.github.com/users/tkstanczak/repos",
    "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2313/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2313/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/692270078",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2313#issuecomment-692270078",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2313",
    "id": 692270078,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MjI3MDA3OA==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-14T19:38:03Z",
    "updated_at": "2020-09-14T19:38:03Z",
    "author_association": "MEMBER",
    "body": "ah, so not yet fixed. We had a fix attempt in 102. There is a big chance that it will start just fine after a few more restarts (up to 30 :/)",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/692270078/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/692270188",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2313#issuecomment-692270188",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2313",
    "id": 692270188,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MjI3MDE4OA==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-14T19:38:19Z",
    "updated_at": "2020-09-14T19:38:19Z",
    "author_association": "MEMBER",
    "body": "only see it on Docker somehow",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/692270188/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/774691291",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2313#issuecomment-774691291",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2313",
    "id": 774691291,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NDY5MTI5MQ==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-07T15:17:18Z",
    "updated_at": "2021-02-07T15:17:18Z",
    "author_association": "MEMBER",
    "body": "This has been reworked now. I believe it should no longer cause the same issues.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/774691291/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
