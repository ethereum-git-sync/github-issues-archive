{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3618",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3618/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3618/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3618/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/3618",
  "id": 1057278465,
  "node_id": "I_kwDOBggaLc4_BMoB",
  "number": 3618,
  "title": "Tx root validation flaw",
  "user": {
    "login": "holiman",
    "id": 142290,
    "node_id": "MDQ6VXNlcjE0MjI5MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/holiman",
    "html_url": "https://github.com/holiman",
    "followers_url": "https://api.github.com/users/holiman/followers",
    "following_url": "https://api.github.com/users/holiman/following{/other_user}",
    "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
    "organizations_url": "https://api.github.com/users/holiman/orgs",
    "repos_url": "https://api.github.com/users/holiman/repos",
    "events_url": "https://api.github.com/users/holiman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/holiman/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "LukaszRozmej",
    "id": 12445221,
    "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LukaszRozmej",
    "html_url": "https://github.com/LukaszRozmej",
    "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
    "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
    "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
    "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
    "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
    "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "LukaszRozmej",
      "id": 12445221,
      "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LukaszRozmej",
      "html_url": "https://github.com/LukaszRozmej",
      "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
      "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
      "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
      "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
      "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
      "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
      "type": "User",
      "site_admin": false
    },
    {
      "login": "marcindsobczak",
      "id": 77129288,
      "node_id": "MDQ6VXNlcjc3MTI5Mjg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/77129288?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marcindsobczak",
      "html_url": "https://github.com/marcindsobczak",
      "followers_url": "https://api.github.com/users/marcindsobczak/followers",
      "following_url": "https://api.github.com/users/marcindsobczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/marcindsobczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marcindsobczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marcindsobczak/subscriptions",
      "organizations_url": "https://api.github.com/users/marcindsobczak/orgs",
      "repos_url": "https://api.github.com/users/marcindsobczak/repos",
      "events_url": "https://api.github.com/users/marcindsobczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marcindsobczak/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-11-18T12:05:11Z",
  "updated_at": "2021-11-22T17:49:02Z",
  "closed_at": "2021-11-22T17:48:18Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "In the hive consensus tests, one of the failures are `wrongTransactionsTrie_Berlin` (although all networks are affected). \r\n\r\nThis rlp is imported as block `1`: https://github.com/ethereum/tests/blob/develop/BlockchainTests/InvalidBlocks/bcInvalidHeaderTest/wrongTransactionsTrie.json#L17 . \r\n\r\nAn rlpdump shows the tx root: \r\n```\r\n[\r\n  [\r\n    aa6c733b954fb03814267ff4e698d18b5dd210aa85e7457d856718c43fa4d5f9,\r\n    1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347,\r\n    8888f1f195afa192cfee860698584c030f4c9db1,\r\n    edf42f78d05a438f6408aef357002a7380f4aca2587645d674498efc64705bd4,\r\n    55e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421,\r\n    21f4ebc5b0fb1ad80a00f78d04e67d1b30af68cecb3a8a2bf55247f11df1e3ed,\r\n```\r\nThe nethermind hive log: https://hivetests.ethdevops.io/viewer.html?file=results/nethermind/client-da87c1f4e208a929449f99b8e938ee8f2b725b4305e1eac8c6490688efb09ed9.log show that the txroot `0x55e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421` is accepted: \r\n\r\n```\r\n\r\n\r\n  | 2021-11-17 09:11:28.1219\\|HIVE suggested 1 (0xe12ca3...f819fd), now best suggested header Hash: 0xe12ca37219a6b8b0103d1a479bedb9ce1e52b09c5b8eb4a822c9c984b5f819fd\r\n-- | --\r\n  | Number: 1\r\n  | Parent: 0xaa6c733b954fb03814267ff4e698d18b5dd210aa85e7457d856718c43fa4d5f9\r\n  | Beneficiary: 0x8888f1f195afa192cfee860698584c030f4c9db1\r\n  | Gas Limit: 3141592\r\n  | Gas Used: 22027\r\n  | Timestamp: 1422495849\r\n  | Extra Data: 42\r\n  | Difficulty: 131072\r\n  | Mix Hash: 0x0000000000000000000000000000000000000000000000000000000000000000\r\n  | Nonce: 0\r\n  | Uncles Hash: 0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347\r\n  | Tx Root: 0x55e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421\r\n  | Receipts Root: 0x21f4ebc5b0fb1ad80a00f78d04e67d1b30af68cecb3a8a2bf55247f11df1e3ed\r\n  | State Root: 0xedf42f78d05a438f6408aef357002a7380f4aca2587645d674498efc64705bd4\r\n  | BaseFeePerGas: 0\r\n  | , head 1 (0xe12ca3...f819fd)\r\n\r\n```\r\nIf we check the geth-log for the same case (https://hivetests.ethdevops.io/viewer.html?file=results/go-ethereum/client-b6a15cd5f1ee5d6cde761eb677a9d7858ac7491967394fdddbdb6803bfe948b2.log), we see the expected error: \r\n```\r\n\r\n\r\n  | ########## BAD BLOCK #########\r\n-- | --\r\n  | Chain config: {ChainID: 1 Homestead: 0 DAO: <nil> DAOSupport: true EIP150: 0 EIP155: 0 EIP158: 0 Byzantium: 0 Constantinople: 0 Petersburg: 0 Istanbul: 0, Muir Glacier: <nil>, Berlin: 0, London: 2000, Arrow Glacier: <nil>, Engine: ethash}\r\n  |  \r\n  | Number: 1\r\n  | Hash: 0xe12ca37219a6b8b0103d1a479bedb9ce1e52b09c5b8eb4a822c9c984b5f819fd\r\n  |  \r\n  |  \r\n  | Error: transaction root hash mismatch: have e7e93016861d480e9fd60fc3dfd935eff097aa94c7380ed8df2ca7ec5b578214, want 55e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421\r\n  | ##############################\r\n\r\n```\r\nGeth thinks that the txroot should be `0xe7e93016861d480e9fd60fc3dfd935eff097aa94c7380ed8df2ca7ec5b578214` and rejects the block. \r\n\r\nThis should be \"easy\" to reproduce without running hive, simply parse the block [here](https://github.com/ethereum/tests/blob/develop/BlockchainTests/InvalidBlocks/bcInvalidHeaderTest/wrongTransactionsTrie.json#L17 ), and check if the _calculated_ tx root matches with the header-declared tx root. If it does not, which it shouldn't, then figure out why this isn't validated during block import. \r\n\r\n",
  "closed_by": {
    "login": "LukaszRozmej",
    "id": 12445221,
    "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LukaszRozmej",
    "html_url": "https://github.com/LukaszRozmej",
    "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
    "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
    "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
    "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
    "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
    "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3618/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3618/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/975766345",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/3618#issuecomment-975766345",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3618",
    "id": 975766345,
    "node_id": "IC_kwDOBggaLc46KQNJ",
    "user": {
      "login": "LukaszRozmej",
      "id": 12445221,
      "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LukaszRozmej",
      "html_url": "https://github.com/LukaszRozmej",
      "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
      "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
      "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
      "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
      "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
      "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-22T17:40:14Z",
    "updated_at": "2021-11-22T17:49:02Z",
    "author_association": "MEMBER",
    "body": "This turned out to be an issue with our hive integration code: https://github.com/NethermindEth/nethermind/commit/481a475f173c8562672b5faa4bee53f49c569485 no issue in Nethermind node.\r\n\r\n1 liner fixing 6 hive tests :)",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/975766345/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
