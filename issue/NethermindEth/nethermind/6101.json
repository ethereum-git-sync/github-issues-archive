{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6101",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6101/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6101/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6101/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/6101",
  "id": 1901159470,
  "node_id": "I_kwDOBggaLc5xUWQu",
  "number": 6101,
  "title": "Redesign logging configuration",
  "user": {
    "login": "emlautarom1",
    "id": 31224949,
    "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
    "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/emlautarom1",
    "html_url": "https://github.com/emlautarom1",
    "followers_url": "https://api.github.com/users/emlautarom1/followers",
    "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
    "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
    "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
    "repos_url": "https://api.github.com/users/emlautarom1/repos",
    "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1370999106,
      "node_id": "MDU6TGFiZWwxMzcwOTk5MTA2",
      "url": "https://api.github.com/repos/NethermindEth/nethermind/labels/logging",
      "name": "logging",
      "color": "efe386",
      "default": false,
      "description": ""
    },
    {
      "id": 2019353920,
      "node_id": "MDU6TGFiZWwyMDE5MzUzOTIw",
      "url": "https://api.github.com/repos/NethermindEth/nethermind/labels/low%20priority",
      "name": "low priority",
      "color": "C2E0C6",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-09-18T15:11:31Z",
  "updated_at": "2023-09-18T20:06:11Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Description**\r\n\r\nAs of today, we are using [NLog](https://nlog-project.org/) to handle logging to multiple targets: Seq, File and Stdout. In order to allow the user to configure the logging behavior, we provide an `NLog.config` file (see https://github.com/NethermindEth/nethermind/blob/master/src/Nethermind/Nethermind.Runner/NLog.config), and we accept CLI flags (ex. `--log INFO`).\r\n\r\nOn startup, NLog will read the config from the `.config` file, and then, our C# code will override some values based on the provided CLI flags. This design has a couple of flaws:\r\n\r\n- If the user changes the config file at runtime, NLog will reload the config with a high chance of ignoring values provided in CLI flags. A fix is to rerun the override when the file changes (see: https://github.com/NethermindEth/nethermind/pull/6051).\r\n- The C# code that overrides the config can inadvertently modify things that it should not, like log levels of third-party libraries. A fix is to ensure that this does not happen (https://github.com/NethermindEth/nethermind/pull/6097).\r\n\r\nDue to this design, I'm sure more issues will pop up with time, and we will need to add more and more workarounds.\r\n\r\n**Steps to Reproduce**\r\nCurrently, there is no known issue since fixes have already been provided as PRs.\r\n\r\n**Expected behavior**\r\n\r\nIt would be desirable that:\r\n- From lowest to highest priority, we should pick config values from: `NLog.config` file, Environment, CLI flags.\r\n- The user should be able to modify the `NLog.config` file and see the changes reflected during runtime.\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6101/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6101/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1723698851",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6101#issuecomment-1723698851",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6101",
    "id": 1723698851,
    "node_id": "IC_kwDOBggaLc5mvY6j",
    "user": {
      "login": "emlautarom1",
      "id": 31224949,
      "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emlautarom1",
      "html_url": "https://github.com/emlautarom1",
      "followers_url": "https://api.github.com/users/emlautarom1/followers",
      "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
      "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
      "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
      "repos_url": "https://api.github.com/users/emlautarom1/repos",
      "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-18T15:23:26Z",
    "updated_at": "2023-09-18T15:23:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "A suggested redesign is the usage of [Configuration Variables](https://github.com/NLog/NLog/wiki/Var-Layout-Renderer) on NLog as suggested on https://github.com/NethermindEth/nethermind/pull/6051#issuecomment-1699541230.\r\n\r\nBy leveraging variables, we can:\r\n- Ensure that we properly define what could be modified (ex. log levels, file paths, etc) and what should not (ex. target names).\r\n- Support changing config during runtime, without requiring triggering of C# code to override values.\r\n- Reduce considerably all C# code responsible for dealing with NLog config.\r\n\r\nSome downsides of making this change include:\r\n- Introduce more noise to the config file due to the definition and usage of variables.\r\n- Our current C# test suite for NLog config code would be rendered useless since the code that is testing would be no longer around.\r\n- Since the tests would be gone, we would need to manually ensure that logging behaves the same. This is the biggest risk factor and should be considered carefully given that logs are our main tool to debug user reported errors.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1723698851/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1724155450",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6101#issuecomment-1724155450",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6101",
    "id": 1724155450,
    "node_id": "IC_kwDOBggaLc5mxIY6",
    "user": {
      "login": "Scooletz",
      "id": 519707,
      "node_id": "MDQ6VXNlcjUxOTcwNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/519707?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Scooletz",
      "html_url": "https://github.com/Scooletz",
      "followers_url": "https://api.github.com/users/Scooletz/followers",
      "following_url": "https://api.github.com/users/Scooletz/following{/other_user}",
      "gists_url": "https://api.github.com/users/Scooletz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Scooletz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Scooletz/subscriptions",
      "organizations_url": "https://api.github.com/users/Scooletz/orgs",
      "repos_url": "https://api.github.com/users/Scooletz/repos",
      "events_url": "https://api.github.com/users/Scooletz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Scooletz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-18T18:29:21Z",
    "updated_at": "2023-09-18T18:29:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "My take with logging nowadays is:\r\n\r\n1. Ditch `NLog` as an API\r\n2. Use `Extensions.Logging` & its [config](https://learn.microsoft.com/en-us/dotnet/core/extensions/logging?tabs=command-line#configure-logging)\r\n3. Use [high performance logging](https://learn.microsoft.com/en-us/dotnet/core/extensions/logging?tabs=command-line#configure-logging) for all the places (especially as they can use generators now).",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1724155450/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
