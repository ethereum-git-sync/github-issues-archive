{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1980",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1980/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1980/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1980/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/1980",
  "id": 627322966,
  "node_id": "MDU6SXNzdWU2MjczMjI5NjY=",
  "number": 1980,
  "title": "`eth_getLogs` returns different number of logs for different ranges",
  "user": {
    "login": "pawanjay176",
    "id": 9890508,
    "node_id": "MDQ6VXNlcjk4OTA1MDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pawanjay176",
    "html_url": "https://github.com/pawanjay176",
    "followers_url": "https://api.github.com/users/pawanjay176/followers",
    "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
    "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
    "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
    "repos_url": "https://api.github.com/users/pawanjay176/repos",
    "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 674950059,
      "node_id": "MDU6TGFiZWw2NzQ5NTAwNTk=",
      "url": "https://api.github.com/repos/NethermindEth/nethermind/labels/bug",
      "name": "bug",
      "color": "ee0701",
      "default": true,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "LukaszRozmej",
    "id": 12445221,
    "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LukaszRozmej",
    "html_url": "https://github.com/LukaszRozmej",
    "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
    "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
    "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
    "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
    "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
    "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "LukaszRozmej",
      "id": 12445221,
      "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LukaszRozmej",
      "html_url": "https://github.com/LukaszRozmej",
      "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
      "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
      "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
      "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
      "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
      "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-05-29T14:45:00Z",
  "updated_at": "2020-06-01T15:22:09Z",
  "closed_at": "2020-06-01T15:14:17Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I am running a Lighthouse eth2 beacon node with a Nethermind client as my eth1 node on the Witti eth2 multiclient testnet which runs on the Goerli testnet (Contract address 0x42cc0FcEB02015F145105Cf6f19F90e9BEa76558). \r\n\r\nThe deposit contract emits a log every time someone sends a deposit. We use these logs to construct the deposit merkle tree. For the purposes of constructing the deposit tree, it's important that we get all the deposit logs without any missing logs in between.\r\n\r\nHowever, it seems like Nethermind gives different results when queried with different ranges using the `eth_getLogs` query.\r\n\r\nOn querying with 10 separate queries for the 1000 block range, I get the following\r\n```\r\nFound 0 logs in range 2777066 to 2777166\r\nFound 0 logs in range 2777166 to 2777266\r\nFound 0 logs in range 2777266 to 2777366\r\nFound 1 logs in range 2777366 to 2777466\r\nFound 0 logs in range 2777466 to 2777566\r\nFound 0 logs in range 2777566 to 2777666\r\nFound 2 logs in range 2777666 to 2777766\r\nFound 0 logs in range 2777766 to 2777866\r\nFound 6 logs in range 2777866 to 2777966\r\nFound 0 logs in range 2777966 to 2778066\r\n```\r\nOn running a single query for the entire 1000 block range, I get \r\n```\r\nFound 7 logs in range 2777066 to 2778066\r\n```\r\nRan into this issue on a `Nethermind/v1.8.41-0-8452b7da9-20200529/X64-Linux 5.4.0-33-generic/Core3.1.3`.\r\n\r\nNote, that I don't always hit this issue. Synced another nethermind node and the 1000 range query returned 9 as it should.",
  "closed_by": {
    "login": "LukaszRozmej",
    "id": 12445221,
    "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LukaszRozmej",
    "html_url": "https://github.com/LukaszRozmej",
    "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
    "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
    "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
    "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
    "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
    "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1980/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1980/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/636400184",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/1980#issuecomment-636400184",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1980",
    "id": 636400184,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNjQwMDE4NA==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-31T00:01:08Z",
    "updated_at": "2020-05-31T00:01:08Z",
    "author_association": "MEMBER",
    "body": "This is being looked at, we were able to reproduce it and tested the first fixes and need a bit more time.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/636400184/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 2,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/636920262",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/1980#issuecomment-636920262",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1980",
    "id": 636920262,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNjkyMDI2Mg==",
    "user": {
      "login": "LukaszRozmej",
      "id": 12445221,
      "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LukaszRozmej",
      "html_url": "https://github.com/LukaszRozmej",
      "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
      "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
      "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
      "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
      "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
      "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-01T15:22:09Z",
    "updated_at": "2020-06-01T15:22:09Z",
    "author_association": "MEMBER",
    "body": "Hi @pawanjay176 great catch! There was in some rare circumstances one reused buffer leaking to a cache were it could corrupt high level bloom indexes we create for block ranges in order to speed up get_logs for wide range searches. This issue had extremely low chance of occurring on chain with dense blooms like mainnet. But only low chance on chain with sparse blooms like goerli.\r\n\r\nManaged to fix it and will go in v1.8.44 and later.\r\n\r\nWe recommend resync. But if you want to keep DB, you can just remove 'bloom' folder in DB and put \"Migrate\":true under \"Bloom\" part of the config (see https://nethermind.readthedocs.io/en/latest/configuration.html#bloomconfig ). ",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/636920262/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
