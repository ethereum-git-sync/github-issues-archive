{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5996",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5996/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5996/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5996/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/5996",
  "id": 1846464547,
  "node_id": "I_kwDOBggaLc5uDtAj",
  "number": 5996,
  "title": "On restart during OldBodies goerli node crashed with \"Attempted to process a blockchain without having starting state\"",
  "user": {
    "login": "kamilchodola",
    "id": 43241881,
    "node_id": "MDQ6VXNlcjQzMjQxODgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/43241881?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kamilchodola",
    "html_url": "https://github.com/kamilchodola",
    "followers_url": "https://api.github.com/users/kamilchodola/followers",
    "following_url": "https://api.github.com/users/kamilchodola/following{/other_user}",
    "gists_url": "https://api.github.com/users/kamilchodola/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kamilchodola/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kamilchodola/subscriptions",
    "organizations_url": "https://api.github.com/users/kamilchodola/orgs",
    "repos_url": "https://api.github.com/users/kamilchodola/repos",
    "events_url": "https://api.github.com/users/kamilchodola/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kamilchodola/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 5772676780,
      "node_id": "LA_kwDOBggaLc8AAAABWBQOrA",
      "url": "https://api.github.com/repos/NethermindEth/nethermind/labels/needed%20in%201.21.0",
      "name": "needed in 1.21.0",
      "color": "186EE0",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "asdacap",
    "id": 1841324,
    "node_id": "MDQ6VXNlcjE4NDEzMjQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1841324?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/asdacap",
    "html_url": "https://github.com/asdacap",
    "followers_url": "https://api.github.com/users/asdacap/followers",
    "following_url": "https://api.github.com/users/asdacap/following{/other_user}",
    "gists_url": "https://api.github.com/users/asdacap/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/asdacap/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/asdacap/subscriptions",
    "organizations_url": "https://api.github.com/users/asdacap/orgs",
    "repos_url": "https://api.github.com/users/asdacap/repos",
    "events_url": "https://api.github.com/users/asdacap/events{/privacy}",
    "received_events_url": "https://api.github.com/users/asdacap/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "asdacap",
      "id": 1841324,
      "node_id": "MDQ6VXNlcjE4NDEzMjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841324?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/asdacap",
      "html_url": "https://github.com/asdacap",
      "followers_url": "https://api.github.com/users/asdacap/followers",
      "following_url": "https://api.github.com/users/asdacap/following{/other_user}",
      "gists_url": "https://api.github.com/users/asdacap/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/asdacap/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/asdacap/subscriptions",
      "organizations_url": "https://api.github.com/users/asdacap/orgs",
      "repos_url": "https://api.github.com/users/asdacap/repos",
      "events_url": "https://api.github.com/users/asdacap/events{/privacy}",
      "received_events_url": "https://api.github.com/users/asdacap/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-08-11T09:03:12Z",
  "updated_at": "2023-08-29T10:15:53Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Description**\r\nOn my node i have quite a few restarts (mixed graceful shutdowns and killed docker containers).\r\nDuring one of the restarts on OldBodies stage i got an exception:\r\n```\r\nProcessing loop threw an exception. Block: 9495485 (0x5a336a...b06939), Exception: System.InvalidOperationException: Attempted to process a blockchain without having starting state\r\n   at Nethermind.Consensus.Processing.BlockchainProcessor.PrepareBlocksToProcess(Block suggestedBlock, ProcessingOptions options, ProcessingBranch processingBranch) in /src/Nethermind/Nethermind.Consensus/Processing/BlockchainProcessor.cs:line 565\r\n   at Nethermind.Consensus.Processing.BlockchainProcessor.Process(Block suggestedBlock, ProcessingOptions options, IBlockTracer tracer) in /src/Nethermind/Nethermind.Consensus/Processing/BlockchainProcessor.cs:line 383\r\n   at Nethermind.Consensus.Processing.BlockchainProcessor.RunProcessingLoop() in /src/Nethermind/Nethermind.Consensus/Processing/BlockchainProcessor.cs:line 316\r\n```\r\nAfter following restarts it did not get back to life - it just synced bodies and receipts further but block processing stopped.\r\nBelow are DEBUG logs from the moment it happened + CL Logs\r\n[cl_logs.txt](https://github.com/NethermindEth/nethermind/files/12319976/cl_logs.txt)\r\n[goerli_debug_logs_greped.zip](https://github.com/NethermindEth/nethermind/files/12319977/goerli_debug_logs_greped.zip)\r\n\r\n**Desktop (please complete the following information):**\r\nPlease provide the following information regarding your setup:\r\n - Operating System: Ubuntu\r\n - Version: master 1.21.0-unstable\r\n - Installation Method: Sedge\r\n - Consensus Client: Teku\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5996/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5996/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1689451551",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/5996#issuecomment-1689451551",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5996",
    "id": 1689451551,
    "node_id": "IC_kwDOBggaLc5ksvwf",
    "user": {
      "login": "kamilchodola",
      "id": 43241881,
      "node_id": "MDQ6VXNlcjQzMjQxODgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/43241881?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kamilchodola",
      "html_url": "https://github.com/kamilchodola",
      "followers_url": "https://api.github.com/users/kamilchodola/followers",
      "following_url": "https://api.github.com/users/kamilchodola/following{/other_user}",
      "gists_url": "https://api.github.com/users/kamilchodola/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kamilchodola/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kamilchodola/subscriptions",
      "organizations_url": "https://api.github.com/users/kamilchodola/orgs",
      "repos_url": "https://api.github.com/users/kamilchodola/repos",
      "events_url": "https://api.github.com/users/kamilchodola/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kamilchodola/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-23T07:43:09Z",
    "updated_at": "2023-08-23T07:43:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "It happened again now on gnosis chain.\r\nIssue occurred again right after state sync on very beginning of OldBodies.\r\n\r\nDebug logs for that:\r\n[Gnosis_exception.zip](https://github.com/NethermindEth/nethermind/files/12416542/Gnosis_exception.zip)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1689451551/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1689813831",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/5996#issuecomment-1689813831",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5996",
    "id": 1689813831,
    "node_id": "IC_kwDOBggaLc5kuINH",
    "user": {
      "login": "asdacap",
      "id": 1841324,
      "node_id": "MDQ6VXNlcjE4NDEzMjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841324?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/asdacap",
      "html_url": "https://github.com/asdacap",
      "followers_url": "https://api.github.com/users/asdacap/followers",
      "following_url": "https://api.github.com/users/asdacap/following{/other_user}",
      "gists_url": "https://api.github.com/users/asdacap/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/asdacap/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/asdacap/subscriptions",
      "organizations_url": "https://api.github.com/users/asdacap/orgs",
      "repos_url": "https://api.github.com/users/asdacap/repos",
      "events_url": "https://api.github.com/users/asdacap/events{/privacy}",
      "received_events_url": "https://api.github.com/users/asdacap/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-23T11:44:57Z",
    "updated_at": "2023-08-23T11:44:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "The gnosis one seems to store a different reorg boundary (off by one).\r\nThe goerli one to be setting head to an unexpected block, likely due to the block fixer. \r\nIts likely of different cause.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1689813831/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1689859015",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/5996#issuecomment-1689859015",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5996",
    "id": 1689859015,
    "node_id": "IC_kwDOBggaLc5kuTPH",
    "user": {
      "login": "asdacap",
      "id": 1841324,
      "node_id": "MDQ6VXNlcjE4NDEzMjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841324?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/asdacap",
      "html_url": "https://github.com/asdacap",
      "followers_url": "https://api.github.com/users/asdacap/followers",
      "following_url": "https://api.github.com/users/asdacap/following{/other_user}",
      "gists_url": "https://api.github.com/users/asdacap/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/asdacap/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/asdacap/subscriptions",
      "organizations_url": "https://api.github.com/users/asdacap/orgs",
      "repos_url": "https://api.github.com/users/asdacap/repos",
      "events_url": "https://api.github.com/users/asdacap/events{/privacy}",
      "received_events_url": "https://api.github.com/users/asdacap/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-23T12:17:33Z",
    "updated_at": "2023-08-23T12:17:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "For gnosis, the missing state is the last state root of statesync/healing. Its clearly downloaded.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1689859015/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1697157577",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/5996#issuecomment-1697157577",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/5996",
    "id": 1697157577,
    "node_id": "IC_kwDOBggaLc5lKJHJ",
    "user": {
      "login": "asdacap",
      "id": 1841324,
      "node_id": "MDQ6VXNlcjE4NDEzMjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841324?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/asdacap",
      "html_url": "https://github.com/asdacap",
      "followers_url": "https://api.github.com/users/asdacap/followers",
      "following_url": "https://api.github.com/users/asdacap/following{/other_user}",
      "gists_url": "https://api.github.com/users/asdacap/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/asdacap/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/asdacap/subscriptions",
      "organizations_url": "https://api.github.com/users/asdacap/orgs",
      "repos_url": "https://api.github.com/users/asdacap/repos",
      "events_url": "https://api.github.com/users/asdacap/events{/privacy}",
      "received_events_url": "https://api.github.com/users/asdacap/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-29T10:15:53Z",
    "updated_at": "2023-08-29T10:15:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "For goerli, blocktree initializer detected a corruption of some sort and attempted to set the head to the best suggested head. Unfortunately because of in memory pruning, the state for that block was not saved yet because of reorg depth.\r\n\r\n```\r\n2023-08-10 18:09:48.9876|DEBUG|19|Saving reorg boundary 9495427 \r\n\r\n2023-08-10 18:10:24.6890|INFO|19|Processed             9495447     | 40,006.56 ms  |  slot     41,531 ms | Gas gwei: 0.14 .. 0.19 (2.69) .. 100.00 \r\n2023-08-10 18:10:24.6890|INFO|19|- Block              12.87 MGas   |     68    txs |  calls  9,750 (143) | sload  35,982 | sstore  8,210 | create   7 \r\n2023-08-10 18:10:24.6890|INFO|19|- Block throughput    0.32 MGas/s |      1.70 t/s |          0.00 Blk/s | recv        0 | proc       34 \r\n2023-08-10 18:10:24.6890|DEBUG|19|- Total throughput    0.31 MGas/s |      1.64 t/s |          0.00 Blk/s | Gas gwei: 0.13 .. 0.15 (2.90) .. 100.00 \r\n2023-08-10 18:11:16.8818|INFO|19|Processed     9495483...  9495484 |  4,800.23 ms  |  slot      8,779 ms | Gas gwei: 0.11 .. 0.11 (2.75) .. 100.00 \r\n2023-08-10 18:11:16.8818|INFO|19|- Blocks 2           27.73 MGas   |    166    txs |  calls  1,119 ( 17) | sload   4,017 | sstore    932 | create   4 \r\n2023-08-10 18:11:16.8818|INFO|19|- Block throughput    5.78 MGas/s |     34.58 t/s |          0.42 Blk/s | recv        0 | proc        0 \r\n2023-08-10 18:11:16.8818|DEBUG|19|- Total throughput    6.10 MGas/s |     30.62 t/s |          0.41 Blk/s | Gas gwei: 0.10 .. 0.28 (2.85) .. 130.00 \r\n\r\n2023-08-10 18:11:16.9907|DEBUG|61|Valid. Request: ForkChoice: Head: 9495484 (0xd51dc5...f1813f), Safe: 9495453 (0x97cf9c...9d1fca), Finalized: 9495425 (0xf3d257...a304bc). \r\n\r\n2023-08-10 18:11:22.2487|DEBUG|15|Executing step: InitializeBlockTree : InitializeBlockTree (WaitingForExecution) \r\n2023-08-10 18:11:22.3732|INFO|15|Start block loaded from reorg boundary - 9495427 - 9495427 (0x2611fc...ece740) \r\n2023-08-10 18:11:22.5170|INFO|15|Numbers resolved, level = Max(9495427, 9495484), header = Max(9495427, 9495484), body = Max(0, 9495484) \r\n2023-08-10 18:11:22.5780|INFO|15|Beacon Numbers resolved, level = 9495426, header = 0, body = 9495426 \r\n2023-08-10 18:11:22.5780|WARN|15|Detected corrupted block tree data (0 < 9495426) (possibly due to an unexpected shutdown). Attempting to fix by moving head backwards. This may fail and you may need to resync the node. \r\n2023-08-10 18:11:22.5994|INFO|15|Block tree initialized, last processed is 9495484 (0xd51dc5...f1813f), best queued is 9495484, best known is 9495484, lowest inserted header 1, body 9469168, lowest sync inserted block number 9494583 \r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1697157577/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
