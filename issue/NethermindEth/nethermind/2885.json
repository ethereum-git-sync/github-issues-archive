{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2885",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2885/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2885/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2885/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/2885",
  "id": 829566292,
  "node_id": "MDU6SXNzdWU4Mjk1NjYyOTI=",
  "number": 2885,
  "title": "[Bug] [1.10.41] [Archive Sync] Utilizing High DB Memory Caching",
  "user": {
    "login": "Texnomic",
    "id": 1648586,
    "node_id": "MDQ6VXNlcjE2NDg1ODY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1648586?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Texnomic",
    "html_url": "https://github.com/Texnomic",
    "followers_url": "https://api.github.com/users/Texnomic/followers",
    "following_url": "https://api.github.com/users/Texnomic/following{/other_user}",
    "gists_url": "https://api.github.com/users/Texnomic/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Texnomic/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Texnomic/subscriptions",
    "organizations_url": "https://api.github.com/users/Texnomic/orgs",
    "repos_url": "https://api.github.com/users/Texnomic/repos",
    "events_url": "https://api.github.com/users/Texnomic/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Texnomic/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1217680451,
      "node_id": "MDU6TGFiZWwxMjE3NjgwNDUx",
      "url": "https://api.github.com/repos/NethermindEth/nethermind/labels/rocksdb",
      "name": "rocksdb",
      "color": "1b4987",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "theoanab",
    "id": 1201851,
    "node_id": "MDQ6VXNlcjEyMDE4NTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1201851?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/theoanab",
    "html_url": "https://github.com/theoanab",
    "followers_url": "https://api.github.com/users/theoanab/followers",
    "following_url": "https://api.github.com/users/theoanab/following{/other_user}",
    "gists_url": "https://api.github.com/users/theoanab/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/theoanab/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/theoanab/subscriptions",
    "organizations_url": "https://api.github.com/users/theoanab/orgs",
    "repos_url": "https://api.github.com/users/theoanab/repos",
    "events_url": "https://api.github.com/users/theoanab/events{/privacy}",
    "received_events_url": "https://api.github.com/users/theoanab/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "theoanab",
      "id": 1201851,
      "node_id": "MDQ6VXNlcjEyMDE4NTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1201851?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/theoanab",
      "html_url": "https://github.com/theoanab",
      "followers_url": "https://api.github.com/users/theoanab/followers",
      "following_url": "https://api.github.com/users/theoanab/following{/other_user}",
      "gists_url": "https://api.github.com/users/theoanab/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/theoanab/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/theoanab/subscriptions",
      "organizations_url": "https://api.github.com/users/theoanab/orgs",
      "repos_url": "https://api.github.com/users/theoanab/repos",
      "events_url": "https://api.github.com/users/theoanab/events{/privacy}",
      "received_events_url": "https://api.github.com/users/theoanab/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 8,
  "created_at": "2021-03-11T22:17:43Z",
  "updated_at": "2023-03-19T06:40:51Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I'm trying to find the sweet spot to achieve peak bps performance by utilizing `RockDB Memory Caches & Buffers` configurations. \r\n\r\nTargets:\r\n1.  Lower the number of Random Disk IOs\r\n2.  Increase the number of Sequential Disk IOs\r\n3.  Decouple Block Processing Speed from Disk IOPs Speed\r\n4.  Utilizing RAM for *All* Hot Db Records \r\n\r\nHere is an example of my config file:\r\n```json\r\n  \"Db\": {\r\n    \"BlockCacheSize\": 4096000000,\r\n    \"ReceiptsDbBlockCacheSize\": 4096000000,\r\n    \"BlocksDbBlockCacheSize\": 4096000000,\r\n    \"HeadersDbBlockCacheSize\": 4096000000,\r\n    \"BlockInfosDbBlockCacheSize\": 4096000000,\r\n    \"PendingTxsDbBlockCacheSize\": 4096000000,\r\n    \"CodeDbBlockCacheSize\": 4096000000,\r\n    \"BloomDbBlockCacheSize\": 4096000000,\r\n    \"WitnessDbBlockCacheSize\": 4096000000,\r\n    \"CanonicalHashTrieDbBlockCacheSize\": 4096000000,\r\n\r\n    \"WriteBufferSize\": 2048000000,\r\n    \"ReceiptsDbWriteBufferSize\": 2048000000,\r\n    \"BlocksDbWriteBufferSize\": 2048000000,\r\n    \"HeadersDbWriteBufferSize\": 2048000000,\r\n    \"BlockInfosDbWriteBufferSize\": 2048000000,\r\n    \"PendingTxsDbWriteBufferSize\": 2048000000,\r\n    \"CodeDbWriteBufferSize\": 2048000000,\r\n    \"BloomDbWriteBufferSize\": 2048000000,\r\n    \"WitnessDbWriteBufferSize\": 2048000000,\r\n    \"CanonicalHashTrieDbWriteBufferSize\": 2048000000,\r\n\r\n    \"WriteBufferNumber\": 4,\r\n    \"ReceiptsDbWriteBufferNumber\": 4,\r\n    \"BlocksDbWriteBufferNumber\": 4,\r\n    \"HeadersDbWriteBufferNumber\": 4,\r\n    \"BlockInfosDbWriteBufferNumber\": 4,\r\n    \"PendingTxsDbWriteBufferNumber\": 4,\r\n    \"CodeDbWriteBufferNumber\": 4,\r\n    \"BloomDbWriteBufferNumber\": 4,\r\n    \"WitnessDbWriteBufferNumber\": 4,\r\n    \"CanonicalHashTrieDbWriteBufferNumber\": 4,\r\n\r\n    \"CacheIndexAndFilterBlocks\": true,\r\n    \"ReceiptsDbCacheIndexAndFilterBlocks\": true,\r\n    \"BlocksDbCacheIndexAndFilterBlocks\": true,\r\n    \"HeadersDbCacheIndexAndFilterBlocks\": true,\r\n    \"BlockInfosDbCacheIndexAndFilterBlocks\": true,\r\n    \"PendingTxsDbCacheIndexAndFilterBlocks\": true,\r\n    \"CodeDbCacheIndexAndFilterBlocks\": true,\r\n    \"BloomDbCacheIndexAndFilterBlocks\": true,\r\n    \"WitnessDbCacheIndexAndFilterBlocks\": true,\r\n    \"CanonicalHashTrieDbCacheIndexAndFilterBlocks\": true\r\n  },\r\n```\r\n\r\nI've already achieved 5x increase in bps performance by replacing default values. but I guess we can achieve higher performance if we have better understanding of these settings and how they correlate together.   ",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2885/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2885/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/797094286",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2885#issuecomment-797094286",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2885",
    "id": 797094286,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5NzA5NDI4Ng==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-11T22:32:43Z",
    "updated_at": "2021-03-11T22:34:00Z",
    "author_association": "MEMBER",
    "body": "We used to set these and used to leave it in config, then we realized it is simply too hard to understand and replaced it with the MemoryHintMan.\r\n\r\nMore or less when you use --Init.MemoryHint then all these values are replaced with different values.\r\nThe only settings that are relevant (are not replaced) are these:\r\n\r\n    \"CacheIndexAndFilterBlocks\": true,\r\n    \"ReceiptsDbCacheIndexAndFilterBlocks\": true,\r\n    \"BlocksDbCacheIndexAndFilterBlocks\": true,\r\n    \"HeadersDbCacheIndexAndFilterBlocks\": true,\r\n    \"BlockInfosDbCacheIndexAndFilterBlocks\": true,\r\n    \"PendingTxsDbCacheIndexAndFilterBlocks\": true,\r\n    \"CodeDbCacheIndexAndFilterBlocks\": true,\r\n    \"BloomDbCacheIndexAndFilterBlocks\": true,\r\n    \"WitnessDbCacheIndexAndFilterBlocks\": true,\r\n    \"CanonicalHashTrieDbCacheIndexAndFilterBlocks\": true\r\n\r\nand these setting indeed can improve a lot the speed of the node but can also cause it to stop limiting memory in some circumstance.\r\n\r\nIt makes perfect sense to adjust them to your scenario.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/797094286/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/797099492",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2885#issuecomment-797099492",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2885",
    "id": 797099492,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5NzA5OTQ5Mg==",
    "user": {
      "login": "Texnomic",
      "id": 1648586,
      "node_id": "MDQ6VXNlcjE2NDg1ODY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1648586?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Texnomic",
      "html_url": "https://github.com/Texnomic",
      "followers_url": "https://api.github.com/users/Texnomic/followers",
      "following_url": "https://api.github.com/users/Texnomic/following{/other_user}",
      "gists_url": "https://api.github.com/users/Texnomic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Texnomic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Texnomic/subscriptions",
      "organizations_url": "https://api.github.com/users/Texnomic/orgs",
      "repos_url": "https://api.github.com/users/Texnomic/repos",
      "events_url": "https://api.github.com/users/Texnomic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Texnomic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-11T22:44:30Z",
    "updated_at": "2021-03-11T22:44:30Z",
    "author_association": "NONE",
    "body": "Thank you @tkstanczak for your fast response.\r\n\r\nI'm already using `MemoryHint` and setting it to `32 GB`, but unfortunately, it was using around `2 GB` overall memory.\r\n\r\nWhen I started setting the other `Db` options, now it uses up to `7 GB` but it is still far cry from my target.\r\n\r\nNow I have one important question: is MemoryHintMan overriding my settings ? and if yes, how to disable it.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/797099492/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/797105976",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2885#issuecomment-797105976",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2885",
    "id": 797105976,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5NzEwNTk3Ng==",
    "user": {
      "login": "Texnomic",
      "id": 1648586,
      "node_id": "MDQ6VXNlcjE2NDg1ODY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1648586?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Texnomic",
      "html_url": "https://github.com/Texnomic",
      "followers_url": "https://api.github.com/users/Texnomic/followers",
      "following_url": "https://api.github.com/users/Texnomic/following{/other_user}",
      "gists_url": "https://api.github.com/users/Texnomic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Texnomic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Texnomic/subscriptions",
      "organizations_url": "https://api.github.com/users/Texnomic/orgs",
      "repos_url": "https://api.github.com/users/Texnomic/repos",
      "events_url": "https://api.github.com/users/Texnomic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Texnomic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-11T22:58:38Z",
    "updated_at": "2021-03-11T23:00:21Z",
    "author_association": "NONE",
    "body": "Ok, I figured out how to disable `MemoryHint` but still I can't exceed `7 GB` overall usage.\r\n\r\nAlso, my bps still looks bad (it was worse at 0.5 bps)\r\n\r\n`2021-03-12 00:56:34.4763|Processed    4327357 |    1,040ms, mgasps   38.84 total   30.34, tps  827.87 total  600.67, bps    2.88 total    2.94, recv queue 5252, proc queue 2000`\r\n\r\nNote: I'm running on HPE Server with RAID-0 8x 1 TB Samsung EVO SATA SSDs.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/797105976/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/799588074",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2885#issuecomment-799588074",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2885",
    "id": 799588074,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5OTU4ODA3NA==",
    "user": {
      "login": "Texnomic",
      "id": 1648586,
      "node_id": "MDQ6VXNlcjE2NDg1ODY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1648586?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Texnomic",
      "html_url": "https://github.com/Texnomic",
      "followers_url": "https://api.github.com/users/Texnomic/followers",
      "following_url": "https://api.github.com/users/Texnomic/following{/other_user}",
      "gists_url": "https://api.github.com/users/Texnomic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Texnomic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Texnomic/subscriptions",
      "organizations_url": "https://api.github.com/users/Texnomic/orgs",
      "repos_url": "https://api.github.com/users/Texnomic/repos",
      "events_url": "https://api.github.com/users/Texnomic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Texnomic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-15T17:07:53Z",
    "updated_at": "2021-03-15T17:07:53Z",
    "author_association": "NONE",
    "body": "@tkstanczak I can now confirm we have an issue with `MemoryHint`. \r\n\r\nSetting `MemoryHint` to `25 GB` while having the following DB Config, leads to `0.5 bps` maximum.\r\n\r\n```json\r\n  \"Db\": {\r\n    \"CacheIndexAndFilterBlocks\": true,\r\n    \"ReceiptsDbCacheIndexAndFilterBlocks\": true,\r\n    \"BlocksDbCacheIndexAndFilterBlocks\": true,\r\n    \"HeadersDbCacheIndexAndFilterBlocks\": true,\r\n    \"BlockInfosDbCacheIndexAndFilterBlocks\": true,\r\n    \"PendingTxsDbCacheIndexAndFilterBlocks\": true,\r\n    \"CodeDbCacheIndexAndFilterBlocks\": true,\r\n    \"BloomDbCacheIndexAndFilterBlocks\": true,\r\n    \"WitnessDbCacheIndexAndFilterBlocks\": true,\r\n    \"CanonicalHashTrieDbCacheIndexAndFilterBlocks\": true\r\n  },\r\n```\r\n\r\nWhile removing `MemoryHint` from config and depending on the following DB Config increases performance to `2.0 bps` maximum.\r\n\r\n```json\r\n  \"Db\": {\r\n\r\n    \"BlockCacheSize\": 25600000000,\r\n    \"ReceiptsDbBlockCacheSize\": 25600000000,\r\n    \"BlocksDbBlockCacheSize\": 25600000000,\r\n    \"HeadersDbBlockCacheSize\": 25600000000,\r\n    \"BlockInfosDbBlockCacheSize\": 25600000000,\r\n    \"PendingTxsDbBlockCacheSize\": 25600000000,\r\n    \"CodeDbBlockCacheSize\": 25600000000,\r\n    \"BloomDbBlockCacheSize\": 25600000000,\r\n    \"WitnessDbBlockCacheSize\": 25600000000,\r\n    \"CanonicalHashTrieDbBlockCacheSize\": 25600000000,\r\n\r\n    \"CacheIndexAndFilterBlocks\": true,\r\n    \"ReceiptsDbCacheIndexAndFilterBlocks\": true,\r\n    \"BlocksDbCacheIndexAndFilterBlocks\": true,\r\n    \"HeadersDbCacheIndexAndFilterBlocks\": true,\r\n    \"BlockInfosDbCacheIndexAndFilterBlocks\": true,\r\n    \"PendingTxsDbCacheIndexAndFilterBlocks\": true,\r\n    \"CodeDbCacheIndexAndFilterBlocks\": true,\r\n    \"BloomDbCacheIndexAndFilterBlocks\": true,\r\n    \"WitnessDbCacheIndexAndFilterBlocks\": true,\r\n    \"CanonicalHashTrieDbCacheIndexAndFilterBlocks\": true\r\n  },\r\n```\r\n\r\nThat's `4x` performance increase which can't be understated.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/799588074/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/864567345",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2885#issuecomment-864567345",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2885",
    "id": 864567345,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NDU2NzM0NQ==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-20T14:59:19Z",
    "updated_at": "2021-06-20T14:59:19Z",
    "author_association": "MEMBER",
    "body": "@theoanab -> would you review these suggestions from @Texnomic \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/864567345/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/919310460",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2885#issuecomment-919310460",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2885",
    "id": 919310460,
    "node_id": "IC_kwDOBggaLc42y5B8",
    "user": {
      "login": "Texnomic",
      "id": 1648586,
      "node_id": "MDQ6VXNlcjE2NDg1ODY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1648586?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Texnomic",
      "html_url": "https://github.com/Texnomic",
      "followers_url": "https://api.github.com/users/Texnomic/followers",
      "following_url": "https://api.github.com/users/Texnomic/following{/other_user}",
      "gists_url": "https://api.github.com/users/Texnomic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Texnomic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Texnomic/subscriptions",
      "organizations_url": "https://api.github.com/users/Texnomic/orgs",
      "repos_url": "https://api.github.com/users/Texnomic/repos",
      "events_url": "https://api.github.com/users/Texnomic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Texnomic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-14T16:24:15Z",
    "updated_at": "2021-09-14T16:24:15Z",
    "author_association": "NONE",
    "body": "@theoanab & @tkstanczak It appears that all of the above `Db` options has been removed and the following is what's left from it:\r\n\r\n```json\r\n\"Db\": {\r\n    \"CacheIndexAndFilterBlocks\": true,\r\n    \"BlockCacheSize\": 81920000000,\r\n    \"WriteBufferSize\": 51920000000,\r\n    \"WriteBufferNumber\": 1\r\n  }\r\n```\r\n\r\nKindly confirm if I'm correct.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/919310460/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1259289184",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2885#issuecomment-1259289184",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2885",
    "id": 1259289184,
    "node_id": "IC_kwDOBggaLc5LDzpg",
    "user": {
      "login": "McSim85",
      "id": 32900310,
      "node_id": "MDQ6VXNlcjMyOTAwMzEw",
      "avatar_url": "https://avatars.githubusercontent.com/u/32900310?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/McSim85",
      "html_url": "https://github.com/McSim85",
      "followers_url": "https://api.github.com/users/McSim85/followers",
      "following_url": "https://api.github.com/users/McSim85/following{/other_user}",
      "gists_url": "https://api.github.com/users/McSim85/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/McSim85/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/McSim85/subscriptions",
      "organizations_url": "https://api.github.com/users/McSim85/orgs",
      "repos_url": "https://api.github.com/users/McSim85/repos",
      "events_url": "https://api.github.com/users/McSim85/events{/privacy}",
      "received_events_url": "https://api.github.com/users/McSim85/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-27T10:15:25Z",
    "updated_at": "2022-09-27T10:41:36Z",
    "author_association": "NONE",
    "body": "@Texnomic \r\nWe have the same issue. And thank you for sharing the details.\r\n\r\nDo you know if these numbers sum?\r\nI mean in your case when you set \r\n```\r\n   \"BlockCacheSize\": 81920000000,\r\n    \"WriteBufferSize\": 51920000000,\r\n```\r\nDoes that mean, the process consumes 133840000000 (133G) total?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1259289184/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1475125260",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2885#issuecomment-1475125260",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2885",
    "id": 1475125260,
    "node_id": "IC_kwDOBggaLc5X7KAM",
    "user": {
      "login": "asdacap",
      "id": 1841324,
      "node_id": "MDQ6VXNlcjE4NDEzMjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1841324?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/asdacap",
      "html_url": "https://github.com/asdacap",
      "followers_url": "https://api.github.com/users/asdacap/followers",
      "following_url": "https://api.github.com/users/asdacap/following{/other_user}",
      "gists_url": "https://api.github.com/users/asdacap/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/asdacap/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/asdacap/subscriptions",
      "organizations_url": "https://api.github.com/users/asdacap/orgs",
      "repos_url": "https://api.github.com/users/asdacap/repos",
      "events_url": "https://api.github.com/users/asdacap/events{/privacy}",
      "received_events_url": "https://api.github.com/users/asdacap/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-19T06:40:51Z",
    "updated_at": "2023-03-19T06:40:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "There is a problem with nethermind's cache setting where all db is using the same cache. That alone is not a problem, but the cache probably is too low considering the size of the DB. We also turn on `CacheIndexAndFilterBlocks` meaning the blocks's index is stored within the same cache also, which reduces memory, at expense of throughput. On goerli with default memory hint its 64MB. Not sure on mainnet. `Db.BlockCacheSize` is the config. So setting that to very high probably will help. Other db's BlockCacheSize actually does not take into effect as the `OptimizeForPointLookup`'s block option is not applied. If you have very high RAM in the first place you might not notice this problem. The `WriteBufferSize` will probably help with blocks db, as blocks are large, it will probably trigger compaction all the time.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1475125260/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
