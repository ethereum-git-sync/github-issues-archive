{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4989",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4989/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4989/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4989/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/4989",
  "id": 1484879817,
  "node_id": "I_kwDOBggaLc5YgXfJ",
  "number": 4989,
  "title": "[Graceful shutdown] When node stopped on OldBodies, exception occurs",
  "user": {
    "login": "kamilchodola",
    "id": 43241881,
    "node_id": "MDQ6VXNlcjQzMjQxODgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/43241881?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kamilchodola",
    "html_url": "https://github.com/kamilchodola",
    "followers_url": "https://api.github.com/users/kamilchodola/followers",
    "following_url": "https://api.github.com/users/kamilchodola/following{/other_user}",
    "gists_url": "https://api.github.com/users/kamilchodola/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kamilchodola/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kamilchodola/subscriptions",
    "organizations_url": "https://api.github.com/users/kamilchodola/orgs",
    "repos_url": "https://api.github.com/users/kamilchodola/repos",
    "events_url": "https://api.github.com/users/kamilchodola/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kamilchodola/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "smartprogrammer93",
    "id": 33181301,
    "node_id": "MDQ6VXNlcjMzMTgxMzAx",
    "avatar_url": "https://avatars.githubusercontent.com/u/33181301?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/smartprogrammer93",
    "html_url": "https://github.com/smartprogrammer93",
    "followers_url": "https://api.github.com/users/smartprogrammer93/followers",
    "following_url": "https://api.github.com/users/smartprogrammer93/following{/other_user}",
    "gists_url": "https://api.github.com/users/smartprogrammer93/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/smartprogrammer93/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/smartprogrammer93/subscriptions",
    "organizations_url": "https://api.github.com/users/smartprogrammer93/orgs",
    "repos_url": "https://api.github.com/users/smartprogrammer93/repos",
    "events_url": "https://api.github.com/users/smartprogrammer93/events{/privacy}",
    "received_events_url": "https://api.github.com/users/smartprogrammer93/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "smartprogrammer93",
      "id": 33181301,
      "node_id": "MDQ6VXNlcjMzMTgxMzAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33181301?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartprogrammer93",
      "html_url": "https://github.com/smartprogrammer93",
      "followers_url": "https://api.github.com/users/smartprogrammer93/followers",
      "following_url": "https://api.github.com/users/smartprogrammer93/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartprogrammer93/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartprogrammer93/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartprogrammer93/subscriptions",
      "organizations_url": "https://api.github.com/users/smartprogrammer93/orgs",
      "repos_url": "https://api.github.com/users/smartprogrammer93/repos",
      "events_url": "https://api.github.com/users/smartprogrammer93/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartprogrammer93/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-12-08T15:27:56Z",
  "updated_at": "2023-01-18T23:18:04Z",
  "closed_at": "2023-01-18T23:18:04Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Start syncing Mainnet\r\n2. When node reach OldBodies stage stop a node using CTRL+C\r\n\r\n**Actual behavior**\r\nException visible:\r\n```\r\n2022-12-08 15:18:36.1745|INFO|220|Peer Manager shutdown complete.. please wait for all components to close\r\n2022-12-08 15:18:36.1745|INFO|220|Stopping synchronizer...\r\n2022-12-08 15:18:36.1774|WARN|220|Failure when executing request System.OperationCanceledException: The operation was canceled.\r\n   at System.Threading.CancellationToken.ThrowOperationCanceledException()\r\n   at Nethermind.Network.P2P.ProtocolHandlers.ZeroProtocolHandlerBase.HandleResponse[TRequest,TResponse](Request`2 request, TransferSpeedType speedType, Func`2 describeRequestFunc, CancellationToken token) in /root/src/nethermind/src/Nethermind/Nethermind.Network/P2P/ProtocolHandlers/ZeroProtocolHandlerBase.cs:line 82\r\n   at Nethermind.Network.P2P.Subprotocols.Eth.V66.Eth66ProtocolHandler.SendRequestGenericEth66[T66,TRequest,TResponse](MessageDictionary`3 messageQueue, T66 message, TransferSpeedType speedType, Func`2 describeRequestFunc, CancellationToken token) in /root/src/nethermind/src/Nethermind/Nethermind.Network/P2P/Subprotocols/Eth/V66/Eth66ProtocolHandler.cs:line 288\r\n   at Nethermind.Network.P2P.Subprotocols.Eth.V66.Eth66ProtocolHandler.SendRequest(GetBlockBodiesMessage message, CancellationToken token) in /root/src/nethermind/src/Nethermind/Nethermind.Network/P2P/Subprotocols/Eth/V66/Eth66ProtocolHandler.cs:line 238\r\n   at Nethermind.Network.P2P.ProtocolHandlers.SyncPeerProtocolHandlerBase.Nethermind.Blockchain.Synchronization.ISyncPeer.GetBlockBodies(IReadOnlyList`1 blockHashes, CancellationToken token) in /root/src/nethermind/src/Nethermind/Nethermind.Network/P2P/ProtocolHandlers/SyncPeerProtocolHandlerBase.cs:line 84\r\n   at Nethermind.Synchronization.FastBlocks.BodiesSyncDispatcher.Dispatch(PeerInfo peerInfo, BodiesSyncBatch batch, CancellationToken cancellationToken) in /root/src/nethermind/src/Nethermind/Nethermind.Synchronization/FastBlocks/BodiesSyncDispatcher.cs:line 54\r\n   at Nethermind.Synchronization.ParallelSync.SyncDispatcher`1.DoDispatch(CancellationToken cancellationToken, PeerInfo allocatedPeer, T request, SyncPeerAllocation allocation) in /root/src/nethermind/src/Nethermind/Nethermind.Synchronization/ParallelSync/SyncDispatcher.cs:line 159\r\n2022-12-08 15:18:36.1774|WARN|220|Failure when executing request System.OperationCanceledException: The operation was canceled.\r\n   at System.Threading.CancellationToken.ThrowOperationCanceledException()\r\n   at Nethermind.Network.P2P.ProtocolHandlers.ZeroProtocolHandlerBase.HandleResponse[TRequest,TResponse](Request`2 request, TransferSpeedType speedType, Func`2 describeRequestFunc, CancellationToken token) in /root/src/nethermind/src/Nethermind/Nethermind.Network/P2P/ProtocolHandlers/ZeroProtocolHandlerBase.cs:line 82\r\n   at Nethermind.Network.P2P.Subprotocols.Eth.V66.Eth66ProtocolHandler.SendRequestGenericEth66[T66,TRequest,TResponse](MessageDictionary`3 messageQueue, T66 message, TransferSpeedType speedType, Func`2 describeRequestFunc, CancellationToken token) in /root/src/nethermind/src/Nethermind/Nethermind.Network/P2P/Subprotocols/Eth/V66/Eth66ProtocolHandler.cs:line 288\r\n   at Nethermind.Network.P2P.Subprotocols.Eth.V66.Eth66ProtocolHandler.SendRequest(GetBlockBodiesMessage message, CancellationToken token) in /root/src/nethermind/src/Nethermind/Nethermind.Network/P2P/Subprotocols/Eth/V66/Eth66ProtocolHandler.cs:line 238\r\n   at Nethermind.Network.P2P.ProtocolHandlers.SyncPeerProtocolHandlerBase.Nethermind.Blockchain.Synchronization.ISyncPeer.GetBlockBodies(IReadOnlyList`1 blockHashes, CancellationToken token) in\r\n```\r\n\r\n**Expected behavior**\r\nNode should be stopped without any issue - to be investigated why is this happening on this stage\r\n\r\n**Desktop (please complete the following information):**\r\n - OS: Ubuntu\r\n - Version: Nethermind master",
  "closed_by": {
    "login": "LukaszRozmej",
    "id": 12445221,
    "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LukaszRozmej",
    "html_url": "https://github.com/LukaszRozmej",
    "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
    "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
    "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
    "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
    "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
    "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4989/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4989/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1349607412",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/4989#issuecomment-1349607412",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4989",
    "id": 1349607412,
    "node_id": "IC_kwDOBggaLc5QcV_0",
    "user": {
      "login": "kamilchodola",
      "id": 43241881,
      "node_id": "MDQ6VXNlcjQzMjQxODgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/43241881?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kamilchodola",
      "html_url": "https://github.com/kamilchodola",
      "followers_url": "https://api.github.com/users/kamilchodola/followers",
      "following_url": "https://api.github.com/users/kamilchodola/following{/other_user}",
      "gists_url": "https://api.github.com/users/kamilchodola/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kamilchodola/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kamilchodola/subscriptions",
      "organizations_url": "https://api.github.com/users/kamilchodola/orgs",
      "repos_url": "https://api.github.com/users/kamilchodola/repos",
      "events_url": "https://api.github.com/users/kamilchodola/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kamilchodola/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-13T19:55:17Z",
    "updated_at": "2022-12-13T19:55:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "Got the same exceptions now on ForwardSync ",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1349607412/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1349666492",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/4989#issuecomment-1349666492",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4989",
    "id": 1349666492,
    "node_id": "IC_kwDOBggaLc5Qcka8",
    "user": {
      "login": "smartprogrammer93",
      "id": 33181301,
      "node_id": "MDQ6VXNlcjMzMTgxMzAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33181301?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartprogrammer93",
      "html_url": "https://github.com/smartprogrammer93",
      "followers_url": "https://api.github.com/users/smartprogrammer93/followers",
      "following_url": "https://api.github.com/users/smartprogrammer93/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartprogrammer93/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartprogrammer93/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartprogrammer93/subscriptions",
      "organizations_url": "https://api.github.com/users/smartprogrammer93/orgs",
      "repos_url": "https://api.github.com/users/smartprogrammer93/repos",
      "events_url": "https://api.github.com/users/smartprogrammer93/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartprogrammer93/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-13T20:44:22Z",
    "updated_at": "2022-12-13T20:44:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "This does not pose an issue, only needed to handle the exception so it does not produce this ugly message in logs as far as i know",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1349666492/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1356760162",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/4989#issuecomment-1356760162",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4989",
    "id": 1356760162,
    "node_id": "IC_kwDOBggaLc5Q3oRi",
    "user": {
      "login": "smartprogrammer93",
      "id": 33181301,
      "node_id": "MDQ6VXNlcjMzMTgxMzAx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33181301?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartprogrammer93",
      "html_url": "https://github.com/smartprogrammer93",
      "followers_url": "https://api.github.com/users/smartprogrammer93/followers",
      "following_url": "https://api.github.com/users/smartprogrammer93/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartprogrammer93/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartprogrammer93/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartprogrammer93/subscriptions",
      "organizations_url": "https://api.github.com/users/smartprogrammer93/orgs",
      "repos_url": "https://api.github.com/users/smartprogrammer93/repos",
      "events_url": "https://api.github.com/users/smartprogrammer93/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartprogrammer93/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-18T09:48:30Z",
    "updated_at": "2022-12-18T09:48:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "There is this one as well?\r\n![image (6)](https://user-images.githubusercontent.com/33181301/208291564-297e20f5-836a-450e-810e-574a6e68607e.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1356760162/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
