{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4502",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4502/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4502/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4502/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/4502",
  "id": 1357270775,
  "node_id": "I_kwDOBggaLc5Q5k73",
  "number": 4502,
  "title": "[Snap Sync] SNAP Phase1 and State Healing are running in the same time",
  "user": {
    "login": "kamilchodola",
    "id": 43241881,
    "node_id": "MDQ6VXNlcjQzMjQxODgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/43241881?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kamilchodola",
    "html_url": "https://github.com/kamilchodola",
    "followers_url": "https://api.github.com/users/kamilchodola/followers",
    "following_url": "https://api.github.com/users/kamilchodola/following{/other_user}",
    "gists_url": "https://api.github.com/users/kamilchodola/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kamilchodola/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kamilchodola/subscriptions",
    "organizations_url": "https://api.github.com/users/kamilchodola/orgs",
    "repos_url": "https://api.github.com/users/kamilchodola/repos",
    "events_url": "https://api.github.com/users/kamilchodola/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kamilchodola/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1381930363,
      "node_id": "MDU6TGFiZWwxMzgxOTMwMzYz",
      "url": "https://api.github.com/repos/NethermindEth/nethermind/labels/sync",
      "name": "sync",
      "color": "3de7f7",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [
    {
      "login": "dceleda",
      "id": 26231116,
      "node_id": "MDQ6VXNlcjI2MjMxMTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/26231116?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dceleda",
      "html_url": "https://github.com/dceleda",
      "followers_url": "https://api.github.com/users/dceleda/followers",
      "following_url": "https://api.github.com/users/dceleda/following{/other_user}",
      "gists_url": "https://api.github.com/users/dceleda/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dceleda/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dceleda/subscriptions",
      "organizations_url": "https://api.github.com/users/dceleda/orgs",
      "repos_url": "https://api.github.com/users/dceleda/repos",
      "events_url": "https://api.github.com/users/dceleda/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dceleda/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-08-31T12:33:00Z",
  "updated_at": "2022-09-25T21:02:20Z",
  "closed_at": "2022-09-25T20:56:31Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\nAfter few attempts of killing Nethermind process on various progress of SNAP Phase1 after following attempt, State healing and Branches started to work in parallel with Snap Phase 1 which should not be possible. \r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior (not quite accurate - hard to get exact scenario for that)\r\n1. Start Nethermind + Teku on Goerli and wait for OldHeaders And Downloading for new blocks to be completed\r\n2. When SNAP Phase 1 is started kill Teku and start it again\r\n3. Also in the same time try to kill Nethermind and start it again but always on Snap Phase 1 (multiple percentage)\r\n\r\n**Expected behavior**\r\nThere should not be a situation when Snap Phase1 and State Healing are running in parallel\r\n\r\n**Actual behavior**\r\nAfter few attempts SNAP and State Healing are running in the same time which may cause db problems.\r\nLogs attached at the end.\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n\r\n**Desktop (please complete the following information):**\r\n - Ubuntu 22\r\n - Nethermind from branch \"blockInfo_fixes\" (14.1 candidate)\r\n - Teku 22.8.1\r\n\r\n**Additional context**\r\n[goerli.logs (1).txt](https://github.com/NethermindEth/nethermind/files/9461513/goerli.logs.1.txt)\r\n",
  "closed_by": {
    "login": "kamilchodola",
    "id": 43241881,
    "node_id": "MDQ6VXNlcjQzMjQxODgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/43241881?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kamilchodola",
    "html_url": "https://github.com/kamilchodola",
    "followers_url": "https://api.github.com/users/kamilchodola/followers",
    "following_url": "https://api.github.com/users/kamilchodola/following{/other_user}",
    "gists_url": "https://api.github.com/users/kamilchodola/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kamilchodola/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kamilchodola/subscriptions",
    "organizations_url": "https://api.github.com/users/kamilchodola/orgs",
    "repos_url": "https://api.github.com/users/kamilchodola/repos",
    "events_url": "https://api.github.com/users/kamilchodola/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kamilchodola/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4502/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4502/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1232895884",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/4502#issuecomment-1232895884",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4502",
    "id": 1232895884,
    "node_id": "IC_kwDOBggaLc5JfH-M",
    "user": {
      "login": "dceleda",
      "id": 26231116,
      "node_id": "MDQ6VXNlcjI2MjMxMTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/26231116?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dceleda",
      "html_url": "https://github.com/dceleda",
      "followers_url": "https://api.github.com/users/dceleda/followers",
      "following_url": "https://api.github.com/users/dceleda/following{/other_user}",
      "gists_url": "https://api.github.com/users/dceleda/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dceleda/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dceleda/subscriptions",
      "organizations_url": "https://api.github.com/users/dceleda/orgs",
      "repos_url": "https://api.github.com/users/dceleda/repos",
      "events_url": "https://api.github.com/users/dceleda/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dceleda/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-31T12:50:01Z",
    "updated_at": "2022-08-31T12:51:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "It shouldn't break the state, so no serious errors are expected. Although running these two state syncs in parallel is always risky and we should avoid it.\r\nUnfortunately it can slow down the state sync.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1232895884/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
