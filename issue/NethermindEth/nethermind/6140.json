{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6140",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6140/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6140/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6140/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/6140",
  "id": 1915788852,
  "node_id": "I_kwDOBggaLc5yMJ40",
  "number": 6140,
  "title": "Mismatch in `accessList` with Geth",
  "user": {
    "login": "emlautarom1",
    "id": 31224949,
    "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
    "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/emlautarom1",
    "html_url": "https://github.com/emlautarom1",
    "followers_url": "https://api.github.com/users/emlautarom1/followers",
    "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
    "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
    "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
    "repos_url": "https://api.github.com/users/emlautarom1/repos",
    "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1124483401,
      "node_id": "MDU6TGFiZWwxMTI0NDgzNDAx",
      "url": "https://api.github.com/repos/NethermindEth/nethermind/labels/rpc",
      "name": "rpc",
      "color": "efe37a",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "emlautarom1",
    "id": 31224949,
    "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
    "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/emlautarom1",
    "html_url": "https://github.com/emlautarom1",
    "followers_url": "https://api.github.com/users/emlautarom1/followers",
    "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
    "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
    "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
    "repos_url": "https://api.github.com/users/emlautarom1/repos",
    "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "emlautarom1",
      "id": 31224949,
      "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emlautarom1",
      "html_url": "https://github.com/emlautarom1",
      "followers_url": "https://api.github.com/users/emlautarom1/followers",
      "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
      "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
      "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
      "repos_url": "https://api.github.com/users/emlautarom1/repos",
      "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-09-27T15:02:29Z",
  "updated_at": "2023-10-03T13:55:41Z",
  "closed_at": "2023-10-03T13:55:41Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Description**\r\nGeth and Nethermind handle `accessList`s (see https://eips.ethereum.org/EIPS/eip-2930) differently, creating difficulties for some users.\r\n\r\n**Steps to Reproduce**\r\n1. Set up a Nethermind and Geth node on mainnet with support for RPC calls\r\n2. Run either of the following requests (using `curl`):\r\n\r\n```bash\r\ncurl --request POST \\\r\n  --url http://localhost:8545/ \\\r\n  --header 'content-type: application/json' \\\r\n  --data '{\"jsonrpc\": \"2.0\",\"method\": \"eth_getTransactionByHash\",\"params\": [\"0x1c022e355aa8f6247f73e556da8b8d4f1fd6e67d4bc3cab070df30cf475769d2\"],\"id\": 1}'\r\n```\r\n\r\nor \r\n\r\n```bash\r\ncurl --request POST \\\r\n  --url http://localhost:8545/ \\\r\n  --header 'content-type: application/json' \\\r\n  --data '{\"jsonrpc\": \"2.0\",\"method\": \"eth_getTransactionByHash\",\"params\": [\"0x1ff162e1b0bb93690e7df1669c6b1807d4d4c7dd0041795a91802af472449b1b\"],\"id\": 1}'\r\n```\r\n\r\n> Note that the only difference is in the `params` field.\r\n\r\nKnown transactions where this difference shows up are:\r\n- `0x1c022e355aa8f6247f73e556da8b8d4f1fd6e67d4bc3cab070df30cf475769d2`\r\n- `0x1ff162e1b0bb93690e7df1669c6b1807d4d4c7dd0041795a91802af472449b1b`\r\n\r\n**Actual behavior**\r\nClients return different results, specifically when taking a look at the `result.accessList` field.\r\n\r\nFor example, consider the result for the hash `0x1c022e355aa8f6247f73e556da8b8d4f1fd6e67d4bc3cab070df30cf475769d2`\r\n\r\n> Nethermind/v1.21.0-unstable+c7526030/linux-x64/dotnet7.0.11\r\n\r\n```json\r\n{\r\n    \"id\": 1,\r\n    \"jsonrpc\": \"2.0\",\r\n    \"result\": {\r\n        \"accessList\": [\r\n            {\r\n                \"address\": \"0x06450dee7fd2fb8e39061434babcfc05599a6fb8\",\r\n                \"storageKeys\": [\r\n                    \"0xa513c5eaef4a6dbb11cf620355bed2f945cd92520e1673ec080cced9718ff5bf\",\r\n                    \"0x0000000000000000000000000000000000000000000000000000000000000002\",\r\n                    \"0x2a6d230697c058b8b814e369a11b29de03014202898e3173de452bae91636177\",\r\n                    \"0xe2a38aa5adcc4da3e7692d2431ac153f917c406a209f26de78d2c7aac0e55ed2\"\r\n                ]\r\n            },\r\n            {\r\n                \"address\": \"0xf5c80c305803280b587f8cabbccdc4d9bf522abd\",\r\n                \"storageKeys\": [\r\n                    \"0x36c1fb6b2c94bf19acd9467b06ccbf7528aac84e16014956893eb645813b2463\",\r\n                    \"0x000000000000000000000000000000000000000000000000000000000000000c\",\r\n                    \"0xa152f959d6c8c696a033e3f3547c058ae6ba28373ff720b68529e5f5b5b9928f\",\r\n                    \"0x9c5a9ed4e5a8150225fa8e67057312dbd734be0c37673d8319da2f1240c3a120\",\r\n                    \"0xe49047bb4533f0bbc17389ba392573136fc26559ca8b125429cb0fa37f226c6f\",\r\n                    \"0xe6644145c3fe2859aed53d73d98d6dab2adc44fd52292a1491e0387a263e1e04\",\r\n                    \"0xcbf25d23fa964ef4087719e3e5b76ce771d548bd80813e08938a65f8691a0f81\"\r\n                ]\r\n            }\r\n        ],\r\n        \"blockHash\": \"0x55264afae9b3b4d44cebc25b9b9568e886d623b3ed2348997b82001f8849159a\",\r\n        \"blockNumber\": \"0x1156f2b\",\r\n        \"chainId\": \"0x1\",\r\n        \"from\": \"0x1ebc908656da1e389dee024ce32595fa49a2d8aa\",\r\n        \"gas\": \"0x3d090\",\r\n        \"gasPrice\": \"0x1aef10b80\",\r\n        \"hash\": \"0x1c022e355aa8f6247f73e556da8b8d4f1fd6e67d4bc3cab070df30cf475769d2\",\r\n        \"input\": \"0x937c54140000000000000000000000000000000000000000000000000000000000000578\",\r\n        \"nonce\": \"0x621\",\r\n        \"r\": \"0x3efd66f8d542aea3b76264ee1bb310198935218d3706a7db9c9a355b254ef598\",\r\n        \"s\": \"0x3ec4981e9693fc73eccea41d3ac3cc56f5203bdb01eba81802c78272c0b946f7\",\r\n        \"to\": \"0xf5c80c305803280b587f8cabbccdc4d9bf522abd\",\r\n        \"transactionIndex\": \"0x2e\",\r\n        \"type\": \"0x1\",\r\n        \"v\": \"0x0\",\r\n        \"value\": \"0xe92596fd6290000\",\r\n        \"yParity\": \"0x0\"\r\n    }\r\n}\r\n```\r\n\r\n> Geth/v1.11.6-stable-ea9e62ca/linux-amd64/go1.20.3\r\n\r\n```json\r\n{\r\n    \"id\": 1,\r\n    \"jsonrpc\": \"2.0\",\r\n    \"result\": {\r\n        \"accessList\": [\r\n            {\r\n                \"address\": \"0x06450dee7fd2fb8e39061434babcfc05599a6fb8\",\r\n                \"storageKeys\": [\r\n                    \"0xa513c5eaef4a6dbb11cf620355bed2f945cd92520e1673ec080cced9718ff5bf\",\r\n                    \"0x0000000000000000000000000000000000000000000000000000000000000002\",\r\n                    \"0x2a6d230697c058b8b814e369a11b29de03014202898e3173de452bae91636177\",\r\n                    \"0xe2a38aa5adcc4da3e7692d2431ac153f917c406a209f26de78d2c7aac0e55ed2\"\r\n                ]\r\n            },\r\n            {\r\n                \"address\": \"0xf5c80c305803280b587f8cabbccdc4d9bf522abd\",\r\n                \"storageKeys\": [\r\n                    \"0x36c1fb6b2c94bf19acd9467b06ccbf7528aac84e16014956893eb645813b2463\",\r\n                    \"0x000000000000000000000000000000000000000000000000000000000000000c\",\r\n                    \"0xa152f959d6c8c696a033e3f3547c058ae6ba28373ff720b68529e5f5b5b9928f\",\r\n                    \"0x9c5a9ed4e5a8150225fa8e67057312dbd734be0c37673d8319da2f1240c3a120\",\r\n                    \"0xe49047bb4533f0bbc17389ba392573136fc26559ca8b125429cb0fa37f226c6f\",\r\n                    \"0xe6644145c3fe2859aed53d73d98d6dab2adc44fd52292a1491e0387a263e1e04\",\r\n                    \"0xcbf25d23fa964ef4087719e3e5b76ce771d548bd80813e08938a65f8691a0f81\",\r\n                    \"0xe49047bb4533f0bbc17389ba392573136fc26559ca8b125429cb0fa37f226c6f\"\r\n                ]\r\n            }\r\n        ],\r\n        \"blockHash\": \"0x55264afae9b3b4d44cebc25b9b9568e886d623b3ed2348997b82001f8849159a\",\r\n        \"blockNumber\": \"0x1156f2b\",\r\n        \"chainId\": \"0x1\",\r\n        \"from\": \"0x1ebc908656da1e389dee024ce32595fa49a2d8aa\",\r\n        \"gas\": \"0x3d090\",\r\n        \"gasPrice\": \"0x1aef10b80\",\r\n        \"hash\": \"0x1c022e355aa8f6247f73e556da8b8d4f1fd6e67d4bc3cab070df30cf475769d2\",\r\n        \"input\": \"0x937c54140000000000000000000000000000000000000000000000000000000000000578\",\r\n        \"nonce\": \"0x621\",\r\n        \"r\": \"0x3efd66f8d542aea3b76264ee1bb310198935218d3706a7db9c9a355b254ef598\",\r\n        \"s\": \"0x3ec4981e9693fc73eccea41d3ac3cc56f5203bdb01eba81802c78272c0b946f7\",\r\n        \"to\": \"0xf5c80c305803280b587f8cabbccdc4d9bf522abd\",\r\n        \"transactionIndex\": \"0x2e\",\r\n        \"type\": \"0x1\",\r\n        \"v\": \"0x0\",\r\n        \"value\": \"0xe92596fd6290000\"\r\n    }\r\n}\r\n```\r\n\r\n**Expected behavior**\r\nIt's not clear if the results provided by the clients are semantically equivalent or not. If they are, then this is not a EL issue but an issue on the consumers of these results.\r\n\r\n**Additional context**\r\nThis issue was reported at least 3 times, https://github.com/NethermindEth/nethermind/issues/5161, internally at Nethermind and by an user through our support system.\r\n",
  "closed_by": {
    "login": "emlautarom1",
    "id": 31224949,
    "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
    "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/emlautarom1",
    "html_url": "https://github.com/emlautarom1",
    "followers_url": "https://api.github.com/users/emlautarom1/followers",
    "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
    "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
    "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
    "repos_url": "https://api.github.com/users/emlautarom1/repos",
    "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6140/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6140/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1737625568",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6140#issuecomment-1737625568",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6140",
    "id": 1737625568,
    "node_id": "IC_kwDOBggaLc5nkg_g",
    "user": {
      "login": "emlautarom1",
      "id": 31224949,
      "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emlautarom1",
      "html_url": "https://github.com/emlautarom1",
      "followers_url": "https://api.github.com/users/emlautarom1/followers",
      "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
      "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
      "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
      "repos_url": "https://api.github.com/users/emlautarom1/repos",
      "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-27T15:26:25Z",
    "updated_at": "2023-09-27T15:26:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "Referenced tickets/questions/discussions related to this issue:\r\n- https://ethereum-magicians.org/t/eip-2930-optional-access-lists/4561/38\r\n- https://github.com/ethereum/EIPs/pull/2930#issuecomment-1737607788\r\n- https://ethereum.stackexchange.com/questions/154982/mismatch-in-accesslist-between-geth-and-nethermind",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1737625568/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1737670425",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6140#issuecomment-1737670425",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6140",
    "id": 1737670425,
    "node_id": "IC_kwDOBggaLc5nkr8Z",
    "user": {
      "login": "LukaszRozmej",
      "id": 12445221,
      "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LukaszRozmej",
      "html_url": "https://github.com/LukaszRozmej",
      "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
      "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
      "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
      "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
      "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
      "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-27T15:53:50Z",
    "updated_at": "2023-09-27T15:53:50Z",
    "author_association": "MEMBER",
    "body": "Interesting, so the only difference is that Geth reports duplicates in storage slots in access lists, and Nethermind doesn't? Does the transaction hash correctly evaluate without the duplicate? If it is not then probably Geth style is correct, even though it is stupid as duplicates in access lists mean nothing.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1737670425/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1737710330",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6140#issuecomment-1737710330",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6140",
    "id": 1737710330,
    "node_id": "IC_kwDOBggaLc5nk1r6",
    "user": {
      "login": "emlautarom1",
      "id": 31224949,
      "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emlautarom1",
      "html_url": "https://github.com/emlautarom1",
      "followers_url": "https://api.github.com/users/emlautarom1/followers",
      "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
      "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
      "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
      "repos_url": "https://api.github.com/users/emlautarom1/repos",
      "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-27T16:19:47Z",
    "updated_at": "2023-09-27T16:19:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "Wrote a small test to compare hashes with/without duplicates:\r\n\r\n```C#\r\n[Test]\r\npublic void Duplicate_storage_keys_result_in_same_hash()\r\n{\r\n    Transaction noDuplicates = Build.A.Transaction\r\n        .WithType(TxType.EIP1559)\r\n        .WithChainId(TestBlockchainIds.ChainId)\r\n        .WithAccessList(\r\n            new AccessList(\r\n                new Dictionary<Address, IReadOnlySet<UInt256>>\r\n                {\r\n                    { Address.Zero, new HashSet<UInt256> { UInt256.One } }\r\n                }, new Queue<object>(new List<object> { Address.Zero, UInt256.One })))\r\n        .SignedAndResolved()\r\n        .TestObject;\r\n\r\n    Transaction duplicates = Build.A.Transaction\r\n        .WithType(TxType.EIP1559)\r\n        .WithChainId(TestBlockchainIds.ChainId)\r\n        .WithAccessList(\r\n            new AccessList(\r\n                new Dictionary<Address, IReadOnlySet<UInt256>>\r\n                {\r\n                    { Address.Zero, new HashSet<UInt256> { UInt256.One, UInt256.One } }\r\n                }, new Queue<object>(new List<object> { Address.Zero, UInt256.One, UInt256.One })))\r\n        .SignedAndResolved()\r\n        .TestObject;\r\n\r\n    duplicates.CalculateHash().Should().Be(noDuplicates.CalculateHash());\r\n}\r\n```\r\n\r\nThe test fails since hashes are not equal.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1737710330/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
