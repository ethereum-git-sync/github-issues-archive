{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6614",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6614/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6614/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6614/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/6614",
  "id": 2099131176,
  "node_id": "I_kwDOBggaLc59HjMo",
  "number": 6614,
  "title": "IPC subscriptions intermittently fail with double messages",
  "user": {
    "login": "fselmo",
    "id": 3532824,
    "node_id": "MDQ6VXNlcjM1MzI4MjQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3532824?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fselmo",
    "html_url": "https://github.com/fselmo",
    "followers_url": "https://api.github.com/users/fselmo/followers",
    "following_url": "https://api.github.com/users/fselmo/following{/other_user}",
    "gists_url": "https://api.github.com/users/fselmo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fselmo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fselmo/subscriptions",
    "organizations_url": "https://api.github.com/users/fselmo/orgs",
    "repos_url": "https://api.github.com/users/fselmo/repos",
    "events_url": "https://api.github.com/users/fselmo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fselmo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2024-01-24T21:21:33Z",
  "updated_at": "2024-01-24T23:24:21Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Description**\r\n\r\nI am seeing the same issue [over IPC] that I (and others) previously saw and reported via WebSocket connection in #6169. After subscribing via `eth_subscribe` to a high-throughput subscription like `newPendingTransactions`, after some time a message will come in with two payloads attached. This isn't able to be parsed by json and will error out.\r\n\r\n**Steps to Reproduce**\r\nIn order to replicate the behavior, please provide a detailed list of steps:\r\n1. Connect [via IPC] to a local running instance of Nethermind and a consensus client. I am using Nethermind `1.25.3` and Lighthouse `4.4.1`\r\n2. Subscribe via `eth_subscribe` to `newPendingTransactions` with full transactions `params=(\"newPendingTransactions\", True)` using a library of your choice. \r\n\r\n**Actual behavior**\r\nAfter some time, and turning on debugging, I will get a `JSONDecodeError` and when I inspect the raw message coming back it is the same case as it was in #6169. The payload has two messages inside of it and can't be parsed.\r\n\r\n**Expected behavior**\r\nThe expected behavior is that each payload is consistently one message and it appears to have been fixed [for websockets #6169] in #6210.\r\n\r\n**Screenshots**\r\n![](https://i.imgur.com/EYssn4F.png)\r\n\r\n**Desktop (please complete the following information):**\r\nPlease provide the following information regarding your setup:\r\n - Operating System: Ubuntu 22.04.3 LTS\r\n - Version: `1.25.3`\r\n - Installation Method: download linux-arm64\r\n - Consensus Client: Lighthouse `4.4.1`\r\n\r\n**Additional context**\r\nCurrently, I am a maintainer of `web3.py` and I am working on an implementation of IPC provider which is not available yet when I ran into this issue. The branch for web3.py that the screenshot is using is a WIP branch on my local fork but if it helps I can share it here. It will probably be reproducible on a JS library as the other issue was as well. As mentioned above I think that a very similar issue was happening at one point for websockets.\r\n\r\n**Logs**\r\nN/A\r\n\r\n---\r\nedit: It happens that more than double messages come in sometimes. Sometimes, multiple messages are packed together. I don't see any reason why it should stop at two if it is all running together but figured it could be a useful update to add.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6614/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6614/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
