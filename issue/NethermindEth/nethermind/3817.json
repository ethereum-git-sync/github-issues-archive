{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3817",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3817/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3817/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3817/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/3817",
  "id": 1134614586,
  "node_id": "I_kwDOBggaLc5DoNg6",
  "number": 3817,
  "title": "ArithmeticException when starting mainnet sync",
  "user": {
    "login": "dceleda",
    "id": 26231116,
    "node_id": "MDQ6VXNlcjI2MjMxMTE2",
    "avatar_url": "https://avatars.githubusercontent.com/u/26231116?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dceleda",
    "html_url": "https://github.com/dceleda",
    "followers_url": "https://api.github.com/users/dceleda/followers",
    "following_url": "https://api.github.com/users/dceleda/following{/other_user}",
    "gists_url": "https://api.github.com/users/dceleda/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dceleda/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dceleda/subscriptions",
    "organizations_url": "https://api.github.com/users/dceleda/orgs",
    "repos_url": "https://api.github.com/users/dceleda/repos",
    "events_url": "https://api.github.com/users/dceleda/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dceleda/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2022-02-12T21:08:47Z",
  "updated_at": "2022-02-12T22:12:01Z",
  "closed_at": "2022-02-12T21:56:31Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\nWhen I start a new node sync on mainnet with the Pivot block close to the head (for example 20 blocks behind) I get following exception:\r\n_2022-02-12 20:46:02.8796|ERROR|8|Error when handling response System.ArithmeticException: Underflow in subtraction 0 - 12995535585999491\r\n   at Nethermind.Int256.UInt256.op_Subtraction(UInt256& a, UInt256& b) in /root/src/nethermind/src/int256/src/Nethermind.Int256/UInt256.cs:line 1403\r\n   at Nethermind.Synchronization.FastBlocks.HeadersSyncFeed.InsertHeader(BlockHeader header) in /root/src/nethermind/src/Nethermind/Nethermind.Synchronization/FastBlocks/FastHeadersSyncFeed.cs:line 543\r\n   at Nethermind.Synchronization.FastBlocks.HeadersSyncFeed.InsertHeaders(HeadersSyncBatch batch) in /root/src/nethermind/src/Nethermind/Nethermind.Synchronization/FastBlocks/FastHeadersSyncFeed.cs:line 452\r\n   at Nethermind.Synchronization.FastBlocks.HeadersSyncFeed.HandleResponse(HeadersSyncBatch batch) in /root/src/nethermind/src/Nethermind/Nethermind.Synchronization/FastBlocks/FastHeadersSyncFeed.cs:line 276\r\n   at Nethermind.Synchronization.ParallelSync.SyncDispatcher`1.<>c__DisplayClass18_0.<Start>b__1(Task t) in /root/src/nethermind/src/Nethermind/Nethermind.Synchronization/ParallelSync/SyncDispatcher.cs:line 125_\r\n\r\n\r\n**To Reproduce**\r\n1. Update the pivot block in the mainnet.cfg to a very new one - for example 20 blocks behind. Leave the rest of the settings with the default values.\r\n2. Start the node.\r\n3. When the node switches to Fast Headers sync we will get an exception after just a 2 headers downloaded.\r\n4. header.TotalDifficulty is 0 here:\r\nhttps://github.com/NethermindEth/nethermind/blob/7e61782e42e947598c616f7ed17876d306fdcb0d/src/Nethermind/Nethermind.Synchronization/FastBlocks/FastHeadersSyncFeed.cs#L543\r\n5. The exception kills the fast headers sync.\r\n\r\n",
  "closed_by": {
    "login": "tkstanczak",
    "id": 498913,
    "node_id": "MDQ6VXNlcjQ5ODkxMw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tkstanczak",
    "html_url": "https://github.com/tkstanczak",
    "followers_url": "https://api.github.com/users/tkstanczak/followers",
    "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
    "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
    "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
    "repos_url": "https://api.github.com/users/tkstanczak/repos",
    "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3817/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3817/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
