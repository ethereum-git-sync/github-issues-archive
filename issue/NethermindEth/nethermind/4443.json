{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4443",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4443/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4443/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4443/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/4443",
  "id": 1343802381,
  "node_id": "I_kwDOBggaLc5QGMwN",
  "number": 4443,
  "title": "Nethermind hello message reports wrong version for witness protocol",
  "user": {
    "login": "pinges",
    "id": 16143240,
    "node_id": "MDQ6VXNlcjE2MTQzMjQw",
    "avatar_url": "https://avatars.githubusercontent.com/u/16143240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pinges",
    "html_url": "https://github.com/pinges",
    "followers_url": "https://api.github.com/users/pinges/followers",
    "following_url": "https://api.github.com/users/pinges/following{/other_user}",
    "gists_url": "https://api.github.com/users/pinges/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pinges/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pinges/subscriptions",
    "organizations_url": "https://api.github.com/users/pinges/orgs",
    "repos_url": "https://api.github.com/users/pinges/repos",
    "events_url": "https://api.github.com/users/pinges/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pinges/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-08-19T01:05:19Z",
  "updated_at": "2022-08-24T01:37:12Z",
  "closed_at": "2022-08-19T16:00:36Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\nThe hello message sent by Nethermind contains the capability for the witness protocol. It is RLP encoded as:\r\nc5: list with length 5 \r\n83: String of length 3\r\n776974: “wit”\r\n80: String of length 0 (https://ethereum.org/en/developers/docs/data-structures-and-encoding/rlp/)\r\n\r\nThis can lead to other ethereum clients to fail to decode the hello message, which means that they are not connecting to Nethermind nodes.\r\n\r\nThe 80 here represents the version number of that capability. The current version of the witness protocol is 0 (https://github.com/ethereum/devp2p/blob/master/caps/wit.md)\r\n\r\nThe hello message sent by Nethermind indicates that the version is \r\nNethermind/v1.13.4-0-3e5972c24-20220811/X64-Linux/6.0.6\r\n\r\nFull hello message sent by Nethermind\r\n0xf8\r\nA3\r\n05\r\nB7\r\n4e65746865726d696e642f76312e31332e342d302d3365353937326332342d32303232303831312f5836342d4c696e75782f362e302e36\r\n\r\ne4\r\nc5\r\n83\r\n657468\r\n3e\r\nc5\r\n83\r\n657468\r\n3f\r\nC5\r\n83\r\n657468\r\n40\r\nC5\r\n83\r\n657468\r\n41\r\nC5\r\n83\r\n657468\r\n42\r\nC5\r\n83\r\n776974\r\n80\r\n\r\n82\r\n765d\r\n\r\nB8\r\n40\r\n05c95b2618ba1ca53f0f019d1750d12769267705e46b4dbfb77f73998b21d30973161542a2090bcaa5876e6aed99436009f3f646029bb723b8dff75feec27374\r\n\r\n**To Reproduce**\r\nPrint out he hello message sent by Nethermind\r\n\r\n**Expected behavior**\r\nThe version number for the witness protocol should be 0 (0x00) instead of 0x80\r\n\r\n\r\n",
  "closed_by": {
    "login": "LukaszRozmej",
    "id": 12445221,
    "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LukaszRozmej",
    "html_url": "https://github.com/LukaszRozmej",
    "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
    "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
    "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
    "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
    "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
    "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4443/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4443/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1220227757",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/4443#issuecomment-1220227757",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4443",
    "id": 1220227757,
    "node_id": "IC_kwDOBggaLc5IuzKt",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-19T04:10:11Z",
    "updated_at": "2022-08-19T04:10:11Z",
    "author_association": "MEMBER",
    "body": "Massive thanks for reporting rhis @macfarla",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1220227757/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1220313724",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/4443#issuecomment-1220313724",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4443",
    "id": 1220313724,
    "node_id": "IC_kwDOBggaLc5IvIJ8",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-19T06:47:17Z",
    "updated_at": "2022-08-19T06:51:23Z",
    "author_association": "NONE",
    "body": "credit goes to @pinges ! We have an issue in Besu to accept this format in the short term (our guess is that other clients are accepting this) - on further investigation it may be that Nethermind is actually doing the right thing here \r\n\r\n... making zero a zero length string trimmed to an empty string (spelled out explicitly here https://ethereum.org/en/developers/docs/data-structures-and-encoding/rlp) so c58377697480 is wit/0, rather than c58377697400 - which the latter is incorrect.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1220313724/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1220356378",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/4443#issuecomment-1220356378",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4443",
    "id": 1220356378,
    "node_id": "IC_kwDOBggaLc5IvSka",
    "user": {
      "login": "LukaszRozmej",
      "id": 12445221,
      "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LukaszRozmej",
      "html_url": "https://github.com/LukaszRozmej",
      "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
      "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
      "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
      "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
      "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
      "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-19T07:42:42Z",
    "updated_at": "2022-08-19T07:50:30Z",
    "author_association": "MEMBER",
    "body": "As a workaround maybe we should retroactively just bump the version number to 1? \r\nYou can support wit0 and wit1 for backward compatibility while we will support only wit1.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1220356378/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1221667715",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/4443#issuecomment-1221667715",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4443",
    "id": 1221667715,
    "node_id": "IC_kwDOBggaLc5I0SuD",
    "user": {
      "login": "pinges",
      "id": 16143240,
      "node_id": "MDQ6VXNlcjE2MTQzMjQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/16143240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pinges",
      "html_url": "https://github.com/pinges",
      "followers_url": "https://api.github.com/users/pinges/followers",
      "following_url": "https://api.github.com/users/pinges/following{/other_user}",
      "gists_url": "https://api.github.com/users/pinges/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pinges/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pinges/subscriptions",
      "organizations_url": "https://api.github.com/users/pinges/orgs",
      "repos_url": "https://api.github.com/users/pinges/repos",
      "events_url": "https://api.github.com/users/pinges/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pinges/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-22T00:57:48Z",
    "updated_at": "2022-08-22T00:57:48Z",
    "author_association": "NONE",
    "body": "I have done some more research and I think that encoding an unsigned integer 0 as 0x80 (empty string) is OK, or maybe even common. I tried to find an official document, but failed to find one. \r\nOne example I found is that the boolean value \"false\" is encoded as 0x80, \"true\" is encoded as 0x01.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1221667715/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1225070295",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/4443#issuecomment-1225070295",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4443",
    "id": 1225070295,
    "node_id": "IC_kwDOBggaLc5JBRbX",
    "user": {
      "login": "pinges",
      "id": 16143240,
      "node_id": "MDQ6VXNlcjE2MTQzMjQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/16143240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pinges",
      "html_url": "https://github.com/pinges",
      "followers_url": "https://api.github.com/users/pinges/followers",
      "following_url": "https://api.github.com/users/pinges/following{/other_user}",
      "gists_url": "https://api.github.com/users/pinges/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pinges/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pinges/subscriptions",
      "organizations_url": "https://api.github.com/users/pinges/orgs",
      "repos_url": "https://api.github.com/users/pinges/repos",
      "events_url": "https://api.github.com/users/pinges/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pinges/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-24T01:37:12Z",
    "updated_at": "2022-08-24T01:37:12Z",
    "author_association": "NONE",
    "body": "This problem has been fixed in Besu with https://github.com/hyperledger/besu/pull/4283 \r\nThe fix will be available in the next release.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1225070295/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
