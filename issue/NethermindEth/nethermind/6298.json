{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6298",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6298/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6298/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6298/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/6298",
  "id": 2010548591,
  "node_id": "I_kwDOBggaLc531olv",
  "number": 6298,
  "title": "OP Stack does not work with Nethermind as the L1",
  "user": {
    "login": "yorickdowne",
    "id": 71337066,
    "node_id": "MDQ6VXNlcjcxMzM3MDY2",
    "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yorickdowne",
    "html_url": "https://github.com/yorickdowne",
    "followers_url": "https://api.github.com/users/yorickdowne/followers",
    "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
    "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
    "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
    "repos_url": "https://api.github.com/users/yorickdowne/repos",
    "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "deffrian",
    "id": 19891475,
    "node_id": "MDQ6VXNlcjE5ODkxNDc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/19891475?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/deffrian",
    "html_url": "https://github.com/deffrian",
    "followers_url": "https://api.github.com/users/deffrian/followers",
    "following_url": "https://api.github.com/users/deffrian/following{/other_user}",
    "gists_url": "https://api.github.com/users/deffrian/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/deffrian/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/deffrian/subscriptions",
    "organizations_url": "https://api.github.com/users/deffrian/orgs",
    "repos_url": "https://api.github.com/users/deffrian/repos",
    "events_url": "https://api.github.com/users/deffrian/events{/privacy}",
    "received_events_url": "https://api.github.com/users/deffrian/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "deffrian",
      "id": 19891475,
      "node_id": "MDQ6VXNlcjE5ODkxNDc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/19891475?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/deffrian",
      "html_url": "https://github.com/deffrian",
      "followers_url": "https://api.github.com/users/deffrian/followers",
      "following_url": "https://api.github.com/users/deffrian/following{/other_user}",
      "gists_url": "https://api.github.com/users/deffrian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/deffrian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/deffrian/subscriptions",
      "organizations_url": "https://api.github.com/users/deffrian/orgs",
      "repos_url": "https://api.github.com/users/deffrian/repos",
      "events_url": "https://api.github.com/users/deffrian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/deffrian/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-11-25T09:41:51Z",
  "updated_at": "2023-12-02T11:17:27Z",
  "closed_at": "2023-12-02T11:17:27Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Description**\r\n\r\nWhen running an Optimism node with op-node and op-geth, and using Nethermind as the Ethereum L1 node, sync fails. op-node will print `t=2023-11-25T09:31:07+0000 lvl=warn msg=\"Derivation process temporary error\"     attempts=33928 err=\"temp: failed to fetch receipts of L1 block 0x4c2aeea203fb22ce484cf1ff531aa8bab21722c3dea65b398488061dbafcd7fd:8335466 (parent: 0xc8df9361b793a142a5b67c34398f87109c88666adb068389d2bbd7015466812b:8335465) for L1 sysCfg update: receipt 4 has unexpected tx index 0\"` after a while.\r\n\r\n**Steps to Reproduce**\r\n\r\nRun a Nethermind, using either defaults for TxLookupLimit and Barriers, or `--Receipt.TxLookupLimit=0 --Sync.AncientBodiesBarrier=0 --Sync.AncientReceiptsBarrier=0`\r\n\r\nSet up an Optimism Goerli or Mainnet stack, e.g. with https://github.com/CryptoManufaktur-io/optimism-docker. Configure it to use the Nethermind RPC for its L1.\r\n\r\nLet it sync, and eventually the error will show.\r\n\r\nThe exact same setup using Geth as the L1 RPC works.\r\n\r\n**Desktop (please complete the following information):**\r\n - Version: `1.21.1+9b435ba0` and `1.22.0+ae444a4b`, tested on both\r\n - Consensus Client: Lighthouse 4.5.0\r\n\r\n**Logs**\r\n\r\nop-node, see the \"failed to fetch receipts\"\r\n\r\n```\r\nptimism-docker-op-node-1  | t=2023-11-25T09:38:47+0000 lvl=info msg=\"connected to peer\"                      peer=16Uiu2HAmNjTLavdS8tW5baQUdmvmmiubaTuZL22DwWpjVwk8DTza addr=/ip4/3.219.100.27/tcp/19994\r\noptimism-docker-op-node-1  | t=2023-11-25T09:38:47+0000 lvl=info msg=\"Starting P2P sync client event loop\"    peer=16Uiu2HAmNjTLavdS8tW5baQUdmvmmiubaTuZL22DwWpjVwk8DTza\r\noptimism-docker-op-node-1  | t=2023-11-25T09:38:48+0000 lvl=info msg=\"Received signed execution payload from p2p\" id=0xb16c232227212b22f19a65eca76e6fec85f96cd71af6435ba590089e7cd19fed:17738530 peer=16Uiu2HAkyaAp7nNHg5ZwFgiM6YsWCqyKYQuCz5KmpsziY1V8Sk9N\r\noptimism-docker-op-node-1  | t=2023-11-25T09:38:48+0000 lvl=info msg=\"Optimistically queueing unsafe L2 execution payload\" id=0xb16c232227212b22f19a65eca76e6fec85f96cd71af6435ba590089e7cd19fed:17738530\r\noptimism-docker-op-node-1  | t=2023-11-25T09:38:49+0000 lvl=warn msg=\"Derivation process temporary error\"     attempts=33972 err=\"temp: failed to fetch receipts of L1 block 0x4c2aeea203fb22ce484cf1ff531aa8bab21722c3dea65b398488061dbafcd7fd:8335466 (parent: 0xc8df9361b793a142a5b67c34398f87109c88666adb068389d2bbd7015466812b:8335465) for L1 sysCfg update: receipt 4 has unexpected tx index 0\"\r\noptimism-docker-op-node-1  | t=2023-11-25T09:38:50+0000 lvl=info msg=\"Received signed execution payload from p2p\" id=0x8944f069771898ab561aba0697770b73f3dc2dd9630f2c5151307b20f5c5acd0:17738531 peer=16Uiu2HAmBJAzmNegfG5g99QxeqyzujRtev98SiwZJDgYTrGtjQEd\r\noptimism-docker-op-node-1  | t=2023-11-25T09:38:50+0000 lvl=info msg=\"Optimistically queueing unsafe L2 execution payload\" id=0x8944f069771898ab561aba0697770b73f3dc2dd9630f2c5151307b20f5c5acd0:17738531\r\noptimism-docker-op-node-1  | t=2023-11-25T09:38:52+0000 lvl=info msg=\"Received signed execution payload from p2p\" id=0xb4e26fbe3af953ee1ee1fb389d7e1c5087f8afafcdd51d63d2e3da367355fff5:17738532 peer=16Uiu2HAkyaAp7nNHg5ZwFgiM6YsWCqyKYQuCz5KmpsziY1V8Sk9N\r\noptimism-docker-op-node-1  | t=2023-11-25T09:38:52+0000 lvl=info msg=\"Optimistically queueing unsafe L2 execution payload\" id=0xb4e26fbe3af953ee1ee1fb389d7e1c5087f8afafcdd51d63d2e3da367355fff5:17738532\r\noptimism-docker-op-node-1  | t=2023-11-25T09:38:54+0000 lvl=info msg=\"connected to peer\"                      peer=16Uiu2HAmQDrPvqZqDYyc6Vgwa7vfdupDGFtX9T8EjgcFhst8Z1JP addr=/ip4/3.231.68.59/tcp/16544\r\noptimism-docker-op-node-1  | t=2023-11-25T09:38:54+0000 lvl=info msg=\"Starting P2P sync client event loop\"    peer=16Uiu2HAmQDrPvqZqDYyc6Vgwa7vfdupDGFtX9T8EjgcFhst8Z1JP\r\noptimism-docker-op-node-1  | t=2023-11-25T09:38:54+0000 lvl=info msg=\"Received signed execution payload from p2p\" id=0x85958f5166751df7d985bd30034fe6569213e4de31ba76c1a2f2c7b6651fecc2:17738533 peer=16Uiu2HAmBJAzmNegfG5g99QxeqyzujRtev98SiwZJDgYTrGtjQEd\r\noptimism-docker-op-node-1  | t=2023-11-25T09:38:54+0000 lvl=info msg=\"Optimistically queueing unsafe L2 execution payload\" id=0x85958f5166751df7d985bd30034fe6569213e4de31ba76c1a2f2c7b6651fecc2:17738533\r\n```\r\n\r\nNethermind debug logs attached, see the same 09:38 timestamp. All times UTC.\r\n\r\n[nethermind-debug.logs.gz](https://github.com/NethermindEth/nethermind/files/13463549/nethermind-debug.logs.gz)\r\n\r\n",
  "closed_by": {
    "login": "yorickdowne",
    "id": 71337066,
    "node_id": "MDQ6VXNlcjcxMzM3MDY2",
    "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yorickdowne",
    "html_url": "https://github.com/yorickdowne",
    "followers_url": "https://api.github.com/users/yorickdowne/followers",
    "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
    "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
    "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
    "repos_url": "https://api.github.com/users/yorickdowne/repos",
    "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6298/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6298/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1827947187",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6298#issuecomment-1827947187",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6298",
    "id": 1827947187,
    "node_id": "IC_kwDOBggaLc5s9EKz",
    "user": {
      "login": "emlautarom1",
      "id": 31224949,
      "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emlautarom1",
      "html_url": "https://github.com/emlautarom1",
      "followers_url": "https://api.github.com/users/emlautarom1/followers",
      "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
      "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
      "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
      "repos_url": "https://api.github.com/users/emlautarom1/repos",
      "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-27T14:30:28Z",
    "updated_at": "2023-11-27T14:30:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "Is it possible for op-node to show why `receipt 4 has unexpected tx index 0`? Also, from the Nethermind logs I'm seeing a lot of `initiating disconnect because InvalidNetworkId, details: invalid network id - <some number>`, is this normal behavior? ",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1827947187/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1837123643",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6298#issuecomment-1837123643",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6298",
    "id": 1837123643,
    "node_id": "IC_kwDOBggaLc5tgEg7",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-02T11:17:27Z",
    "updated_at": "2023-12-02T11:17:27Z",
    "author_association": "NONE",
    "body": "This had been tested on `1.21` and a  `1.22` that was upgraded from `1.21`\r\n\r\nResyncing from scratch on `1.22` with `--Receipt.TxLookupLimit=0 --Sync.AncientBodiesBarrier=0 --Sync.AncientReceiptsBarrier=0` appears to have resolved this.\r\n\r\nSync has 10 months to churn through, we don't need to wait for it. Closing, if I run into an issue during sync again we can re-open. ",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1837123643/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
