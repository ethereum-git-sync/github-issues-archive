{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3278",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3278/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3278/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3278/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/3278",
  "id": 960271682,
  "node_id": "MDU6SXNzdWU5NjAyNzE2ODI=",
  "number": 3278,
  "title": "Optimize sockets message buffering",
  "user": {
    "login": "LukaszRozmej",
    "id": 12445221,
    "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LukaszRozmej",
    "html_url": "https://github.com/LukaszRozmej",
    "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
    "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
    "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
    "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
    "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
    "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "dceleda",
    "id": 26231116,
    "node_id": "MDQ6VXNlcjI2MjMxMTE2",
    "avatar_url": "https://avatars.githubusercontent.com/u/26231116?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dceleda",
    "html_url": "https://github.com/dceleda",
    "followers_url": "https://api.github.com/users/dceleda/followers",
    "following_url": "https://api.github.com/users/dceleda/following{/other_user}",
    "gists_url": "https://api.github.com/users/dceleda/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dceleda/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dceleda/subscriptions",
    "organizations_url": "https://api.github.com/users/dceleda/orgs",
    "repos_url": "https://api.github.com/users/dceleda/repos",
    "events_url": "https://api.github.com/users/dceleda/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dceleda/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "dceleda",
      "id": 26231116,
      "node_id": "MDQ6VXNlcjI2MjMxMTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/26231116?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dceleda",
      "html_url": "https://github.com/dceleda",
      "followers_url": "https://api.github.com/users/dceleda/followers",
      "following_url": "https://api.github.com/users/dceleda/following{/other_user}",
      "gists_url": "https://api.github.com/users/dceleda/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dceleda/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dceleda/subscriptions",
      "organizations_url": "https://api.github.com/users/dceleda/orgs",
      "repos_url": "https://api.github.com/users/dceleda/repos",
      "events_url": "https://api.github.com/users/dceleda/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dceleda/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2021-08-04T11:12:27Z",
  "updated_at": "2021-09-17T10:38:07Z",
  "closed_at": "2021-09-17T10:38:07Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "**Is your feature request related to a problem? Please describe.**\r\nSockets message buffering is suboptimal\r\n\r\n**Describe the solution you'd like**\r\nMy idea:\r\n\r\nGet buffer from array pool (4k at start)\r\nRead it (4k) from current offset using AsMemory() instead of [], can use that instead of ArraySegment when reading from sockets\r\nif message not finished, grow it by some size (4k or probably better some multiplication of 4k TBD)\r\nat the end if the buffer is too large, return it to array pool, if its ok in size keep it\r\nBenefits:\r\na) Reduce copying from buffer->message accumulator (we are reading with AsMemory direcly to message accumulator, they are the same)\r\nb) If we are over 4k, we might be A LOT over 4k, we can grow the buffer with some heuristic (x2 every time like List<> for example), this would reduce times we copy the message over itself\r\nc) Should make the code a bit easier to understand\r\n\r\n**Describe alternatives you've considered**\r\nLeave as is.\r\n",
  "closed_by": {
    "login": "LukaszRozmej",
    "id": 12445221,
    "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LukaszRozmej",
    "html_url": "https://github.com/LukaszRozmej",
    "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
    "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
    "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
    "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
    "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
    "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3278/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/3278/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
