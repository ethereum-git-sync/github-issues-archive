{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1258",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1258/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1258/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1258/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/1258",
  "id": 548181317,
  "node_id": "MDU6SXNzdWU1NDgxODEzMTc=",
  "number": 1258,
  "title": "When sync and mining is on on Clique the threading issues appear",
  "user": {
    "login": "tkstanczak",
    "id": 498913,
    "node_id": "MDQ6VXNlcjQ5ODkxMw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tkstanczak",
    "html_url": "https://github.com/tkstanczak",
    "followers_url": "https://api.github.com/users/tkstanczak/followers",
    "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
    "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
    "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
    "repos_url": "https://api.github.com/users/tkstanczak/repos",
    "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 674950059,
      "node_id": "MDU6TGFiZWw2NzQ5NTAwNTk=",
      "url": "https://api.github.com/repos/NethermindEth/nethermind/labels/bug",
      "name": "bug",
      "color": "ee0701",
      "default": true,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "tkstanczak",
    "id": 498913,
    "node_id": "MDQ6VXNlcjQ5ODkxMw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tkstanczak",
    "html_url": "https://github.com/tkstanczak",
    "followers_url": "https://api.github.com/users/tkstanczak/followers",
    "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
    "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
    "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
    "repos_url": "https://api.github.com/users/tkstanczak/repos",
    "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-01-10T16:45:19Z",
  "updated_at": "2020-01-15T18:25:26Z",
  "closed_at": "2020-01-15T18:25:26Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "It was not happening before.\r\nTo reproduce:\r\n\r\nGet a mining goerli validator\r\nStart syncing from 0\r\nIt will try to seal blocks but it will keep crashing every 100 blocks or so.\r\nAfter restart it goes forward.\r\n\r\n2020-01-10 16:44:02.5777|66|Sealed block 1976015 (0x1cc66c...d78b84), diff: 1, tx count: 0\r\n2020-01-10 16:44:02.5777|68|BlockchainProcessor encountered an exception. System.InvalidOperationException: Expected checked value 2 to be equal to 3 - 0\r\n   at Nethermind.Store.StateProvider.Commit(IReleaseSpec releaseSpec, IStateTracer stateTracer) in /root/src/nethermind/src/Nethermind/Nethermind.Store/StateProvider.cs:line 484\r\n   at Nethermind.Evm.TransactionProcessor.Execute(Transaction transaction, BlockHeader block, ITxTracer txTracer, Boolean readOnly) in /root/src/nethermind/src/Nethermind/Nethermind.Evm/TransactionProcessor.cs:line 166\r\n   at Nethermind.Blockchain.BlockProcessor.ProcessTransactions(Block block, ProcessingOptions processingOptions, IBlockTracer blockTracer) in /root/src/nethermind/src/Nethermind/Nethermind.Blockchain/BlockProcessor.cs:line 163\r\n   at Nethermind.Blockchain.BlockProcessor.ProcessOne(Block suggestedBlock, ProcessingOptions options, IBlockTracer blockTracer) in /root/src/nethermind/src/Nethermind/Nethermind.Blockchain/BlockProcessor.cs:line 222\r\n   at Nethermind.Blockchain.BlockProcessor.Process(Keccak branchStateRoot, Block[] suggestedBlocks, ProcessingOptions options, IBlockTracer blockTracer) in /root/src/nethermind/src/Nethermind/Nethermind.Blockchain/BlockProcessor.cs:line 125\r\n   at Nethermind.Blockchain.BlockchainProcessor.Process(Block suggestedBlock, ProcessingOptions options, IBlockTracer blockTracer) in /root/src/nethermind/src/Nethermind/Nethermind.Blockchain/BlockchainProcessor.cs:line 370\r\n   at Nethermind.Blockchain.BlockchainProcessor.RunProcessingLoop() in /root/src/nethermind/src/Nethermind/Nethermind.Blockchain/BlockchainProcessor.cs:line 243\r\n   at System.Threading.Tasks.Task.InnerInvoke()\r\n   at System.Threading.Tasks.Task.<>c.<.cctor>b__274_0(Object obj)\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n--- End of stack trace from previous location where exception was thrown ---\r\n   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)\r\n   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot, Thread threadPoolThread)\r\n",
  "closed_by": {
    "login": "tkstanczak",
    "id": 498913,
    "node_id": "MDQ6VXNlcjQ5ODkxMw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tkstanczak",
    "html_url": "https://github.com/tkstanczak",
    "followers_url": "https://api.github.com/users/tkstanczak/followers",
    "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
    "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
    "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
    "repos_url": "https://api.github.com/users/tkstanczak/repos",
    "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1258/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1258/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/573114055",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/1258#issuecomment-573114055",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1258",
    "id": 573114055,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MzExNDA1NQ==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-10T16:48:41Z",
    "updated_at": "2020-01-10T16:48:41Z",
    "author_association": "MEMBER",
    "body": "Also conflicts on the tree - probably the same StateProvider was added to the miner and BlockchainProcessor:\r\n\r\n2020-01-10 16:47:46.9534|16|Preparing new block on top of 1976729 (0xd177ba...842d75)\r\n2020-01-10 16:47:46.9534|16|Producing out of turn block\r\n2020-01-10 16:47:46.9534|16|Block producer could not produce block on top of 1976729 (0xd177ba...842d75) Nethermind.Store.StateException: Unable to resolve node 0xecbde113c2745de48f40295202f9236c69599ede8088ad30c711a98e58eb092c\r\n ---> Nethermind.Core.Encoding.RlpException: Expected a sequence prefix to be in the range of <192, 255> and got 61 at position 501 in the message of length 532 starting with f90211a0d7c35e276ed752d6cdd37ab1f5b4df045797f7f580f2035521b47f4a7e4af514a0549ee3dece4c58958cfbdcf3d97c85ff6a3a49aa41e12d21fb3cdd3db7dbf442a0efab4789fc9b5840f3ded6a70b6f9b90a4661f01d41d9a9b33dd9bc2b86c885ba00b19513e2ecd2dffab02a48c6407fbf921e18c83197403004136e6097e68fd3ba03cabd62e4945e6cfd0d4783feb11a691a2163e4e61c485f63616b527cde449e6a017e90ef2edca7ea755885267bca5d30d37a0e7146c8bd5490882f154b9f919e5a07ab7f87ed6513b90c98f6a7ed43d50a25a3f33e53551d196079a26a6631846f4a0affabe5711e87e64a30fa0b845dfc3be24ee3c1d34a55d454e5ff5cdabe4ec25a0ffb1e0182714ec3631f462eb056f3463cc30f3626923e1cb590bef84c38ce21aa03a0dddc8c547f192b43ab7c64bbc9ea8c9108c40acca2a01f2472e4b597a89efa0c3d9e5988f103d094b1ab8731c26bfa80b7cba900ab3fd46556159b0281b5529a051b33c938ca6ab191f7c372b37d4201e80a2d86e168867ab0dbe40ee9ab49152a0e4c62d80eeb83cc342c5cfca5c09d5873181d94e5a988336842c2984b5ab64a9a026eecd26b98d13e1a3e869d5f6b0c1224d9723131ca61ac81e3f1eabaf2d054da0e8a068c3469306a84dea02cb5754ef72a7290e2575fda55a42143da69f776abfa08f3d49657ae65ea46dba6347827716e5735b030136ec6ed60f281d8f51e9a63580\r\n   at Nethermind.Core.Encoding.RlpStream.ReadSequenceLength() in /root/src/nethermind/src/Nethermind/Nethermind.Core/Encoding/RlpStream.cs:line 540\r\n   at Nethermind.Store.TrieNode.ResolveNode(PatriciaTree tree, Boolean allowCaching) in /root/src/nethermind/src/Nethermind/Nethermind.Store/TrieNode.cs:line 213\r\n   --- End of inner exception stack trace ---\r\n   at Nethermind.Store.TrieNode.ResolveNode(PatriciaTree tree, Boolean allowCaching) in /root/src/nethermind/src/Nethermind/Nethermind.Store/TrieNode.cs:line 213\r\n   at Nethermind.Store.PatriciaTree.TraverseBranch(TrieNode node, TraverseContext traverseContext) in /root/src/nethermind/src/Nethermind/Nethermind.Store/PatriciaTree.cs:line 436\r\n   at Nethermind.Store.PatriciaTree.TraverseNode(TrieNode node, TraverseContext traverseContext) in /root/src/nethermind/src/Nethermind/Nethermind.Store/PatriciaTree.cs:line 322\r\n   at Nethermind.Store.PatriciaTree.Run(Span`1 updatePath, Int32 nibblesCount, Byte[] updateValue, Boolean isUpdate, Boolean ignoreMissingDelete, Keccak rootHash) in /root/src/nethermind/src/Nethermind/Nethermind.Store/PatriciaTree.cs:line 301\r\n   at Nethermind.Store.PatriciaTree.Get(Span`1 rawKey, Keccak rootHash) in /root/src/nethermind/src/Nethermind/Nethermind.Store/PatriciaTree.cs:line 224\r\n   at Nethermind.Store.StateTree.Get(Address address, Keccak rootHash) in /root/src/nethermind/src/Nethermind/Nethermind.Store/StateTree.cs:line 47\r\n   at Nethermind.Store.StateProvider.GetState(Address address) in /root/src/nethermind/src/Nethermind/Nethermind.Store/StateProvider.cs:line 548\r\n   at Nethermind.Store.StateProvider.GetAndAddToCache(Address address) in /root/src/nethermind/src/Nethermind/Nethermind.Store/StateProvider.cs:line 560\r\n   at Nethermind.Store.StateProvider.GetNonce(Address address) in /root/src/nethermind/src/Nethermind/Nethermind.Store/StateProvider.cs:line 113\r\n   at Nethermind.Blockchain.PendingTransactionSelector.SelectTransactions(Int64 gasLimit) in /root/src/nethermind/src/Nethermind/Nethermind.Blockchain/PendingTransactionSelector.cs:line 82\r\n   at Nethermind.Clique.CliqueBlockProducer.PrepareBlock(Block parentBlock) in /root/src/nethermind/src/Nethermind/Nethermind.Clique/CliqueBlockProducer.cs:line 381\r\n   at Nethermind.Clique.CliqueBlockProducer.ConsumeSignal() in /root/src/nethermind/src/Nethermind/Nethermind.Clique/CliqueBlockProducer.cs:line 227\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/573114055/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/573116618",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/1258#issuecomment-573116618",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/1258",
    "id": 573116618,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MzExNjYxOA==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-10T16:55:14Z",
    "updated_at": "2020-01-10T16:55:14Z",
    "author_association": "MEMBER",
    "body": "found a fix",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/573116618/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
