{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2257",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2257/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2257/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2257/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/2257",
  "id": 687256834,
  "node_id": "MDU6SXNzdWU2ODcyNTY4MzQ=",
  "number": 2257,
  "title": "Consider allowing 0 gas price transactions from local adress (2nd part)",
  "user": {
    "login": "varasev",
    "id": 33550681,
    "node_id": "MDQ6VXNlcjMzNTUwNjgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/33550681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/varasev",
    "html_url": "https://github.com/varasev",
    "followers_url": "https://api.github.com/users/varasev/followers",
    "following_url": "https://api.github.com/users/varasev/following{/other_user}",
    "gists_url": "https://api.github.com/users/varasev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/varasev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/varasev/subscriptions",
    "organizations_url": "https://api.github.com/users/varasev/orgs",
    "repos_url": "https://api.github.com/users/varasev/repos",
    "events_url": "https://api.github.com/users/varasev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/varasev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "LukaszRozmej",
    "id": 12445221,
    "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LukaszRozmej",
    "html_url": "https://github.com/LukaszRozmej",
    "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
    "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
    "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
    "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
    "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
    "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "LukaszRozmej",
      "id": 12445221,
      "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LukaszRozmej",
      "html_url": "https://github.com/LukaszRozmej",
      "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
      "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
      "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
      "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
      "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
      "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2020-08-27T13:46:39Z",
  "updated_at": "2021-02-23T10:07:34Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "I'm trying to test the latest `v1.8.95` with our https://github.com/poanetwork/posdao-test-setup tool but found that the [transaction with zero gas price](https://github.com/poanetwork/posdao-test-setup/blob/4a67875682bb375241397de00373b9f3dbdca82e/scripts/deploy-staking-token.js#L62-L72) is not mined. The script is waiting for a very long time.\r\n\r\nI don't see this bug on `v1.8.77`. Seems the reason is in `v1.8.80` where the `MinGasPrice` config option was added because this is reproducible on `v1.8.80` as well. I guess, now the client ignores the `Certifier` contract that whitelists addresses allowed to use zero gas price.\r\n\r\nSteps to reproduce:\r\n1. Run https://github.com/poanetwork/posdao-test-setup with `Nethermind v1.8.95` following the instructions https://github.com/poanetwork/posdao-test-setup#nethermind (use `npm run all-nethermind` command).\r\n2. After all, you will see the following picture (for a few minutes):\r\n\r\n    ![image](https://user-images.githubusercontent.com/33550681/91450028-813ff180-e884-11ea-847b-ba24c995d97d.png)\r\n\r\nSo, the `StakingToken` contract cannot be deployed (I guess because of [this](https://github.com/poanetwork/posdao-test-setup/blob/4a67875682bb375241397de00373b9f3dbdca82e/scripts/deploy-staking-token.js#L71)).",
  "closed_by": {
    "login": "LukaszRozmej",
    "id": 12445221,
    "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LukaszRozmej",
    "html_url": "https://github.com/LukaszRozmej",
    "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
    "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
    "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
    "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
    "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
    "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2257/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2257/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/681964254",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2257#issuecomment-681964254",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2257",
    "id": 681964254,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MTk2NDI1NA==",
    "user": {
      "login": "varasev",
      "id": 33550681,
      "node_id": "MDQ6VXNlcjMzNTUwNjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33550681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/varasev",
      "html_url": "https://github.com/varasev",
      "followers_url": "https://api.github.com/users/varasev/followers",
      "following_url": "https://api.github.com/users/varasev/following{/other_user}",
      "gists_url": "https://api.github.com/users/varasev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/varasev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/varasev/subscriptions",
      "organizations_url": "https://api.github.com/users/varasev/orgs",
      "repos_url": "https://api.github.com/users/varasev/repos",
      "events_url": "https://api.github.com/users/varasev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/varasev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-27T13:55:06Z",
    "updated_at": "2020-08-27T13:55:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "May be related to https://github.com/NethermindEth/nethermind/pull/2201",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/681964254/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/681985691",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2257#issuecomment-681985691",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2257",
    "id": 681985691,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MTk4NTY5MQ==",
    "user": {
      "login": "varasev",
      "id": 33550681,
      "node_id": "MDQ6VXNlcjMzNTUwNjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33550681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/varasev",
      "html_url": "https://github.com/varasev",
      "followers_url": "https://api.github.com/users/varasev/followers",
      "following_url": "https://api.github.com/users/varasev/following{/other_user}",
      "gists_url": "https://api.github.com/users/varasev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/varasev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/varasev/subscriptions",
      "organizations_url": "https://api.github.com/users/varasev/orgs",
      "repos_url": "https://api.github.com/users/varasev/repos",
      "events_url": "https://api.github.com/users/varasev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/varasev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-27T14:30:06Z",
    "updated_at": "2020-08-27T14:30:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "After all, the timeout error is displayed:\r\n\r\n![image](https://user-images.githubusercontent.com/33550681/91455565-e4cd1d80-e88a-11ea-824a-995f8fe2a29f.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/681985691/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/681986345",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2257#issuecomment-681986345",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2257",
    "id": 681986345,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MTk4NjM0NQ==",
    "user": {
      "login": "tkstanczak",
      "id": 498913,
      "node_id": "MDQ6VXNlcjQ5ODkxMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/498913?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tkstanczak",
      "html_url": "https://github.com/tkstanczak",
      "followers_url": "https://api.github.com/users/tkstanczak/followers",
      "following_url": "https://api.github.com/users/tkstanczak/following{/other_user}",
      "gists_url": "https://api.github.com/users/tkstanczak/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tkstanczak/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tkstanczak/subscriptions",
      "organizations_url": "https://api.github.com/users/tkstanczak/orgs",
      "repos_url": "https://api.github.com/users/tkstanczak/repos",
      "events_url": "https://api.github.com/users/tkstanczak/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tkstanczak/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-27T14:31:11Z",
    "updated_at": "2020-08-27T14:31:11Z",
    "author_association": "MEMBER",
    "body": "@matilote, @SebastianDremo can we make sure that this test is running as part of our DevOps test for each tag?",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/681986345/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/688369096",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2257#issuecomment-688369096",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2257",
    "id": 688369096,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4ODM2OTA5Ng==",
    "user": {
      "login": "varasev",
      "id": 33550681,
      "node_id": "MDQ6VXNlcjMzNTUwNjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33550681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/varasev",
      "html_url": "https://github.com/varasev",
      "followers_url": "https://api.github.com/users/varasev/followers",
      "following_url": "https://api.github.com/users/varasev/following{/other_user}",
      "gists_url": "https://api.github.com/users/varasev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/varasev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/varasev/subscriptions",
      "organizations_url": "https://api.github.com/users/varasev/orgs",
      "repos_url": "https://api.github.com/users/varasev/repos",
      "events_url": "https://api.github.com/users/varasev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/varasev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-07T14:42:57Z",
    "updated_at": "2021-02-23T10:07:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "I successfully tested this with `Nethermind v1.8.98` but found a discrepancy with `OpenEthereum v3.0.1`: actually, in OpenEthereum it seems that ALL local transactions can have zero gas price regardless of whether they are certified by the `Certifier` contract or not.\r\n\r\nMy tests show that even when we remove the `registrar` option (and thus `Certifier` contract) from the spec, the zero gas price transactions in OpenEthereum are still allowed for the address `0x32e4e4c7c5d1cea5db5f9202a9e4d99e56c91a24` defined in the first node: https://github.com/poanetwork/posdao-test-setup/tree/master/data/node1/keys/DPoSChain, but in this case they are ONLY mined by the first node (which has that address keystore JSON in its keystore directory as shown above).\r\n\r\nSo, if OpenEthereum treats some transaction as `local`, it allows zero gas price for it and skips `Certifier` filtering. Not sure, but maybe this is a bug in OpenEthereum.\r\n\r\nI found rules according to which a transaction is treated as local in OpenEthereum: https://openethereum.github.io/Transactions-Queue.html (see `Local transactions` section).\r\n\r\nTo be compatible with OpenEthereum, I think it's better to make Nethermind work according to the same rules. I'd suggest not to introduce `tx-queue-no-unfamiliar-locals` and `tx-queue-no-early-reject` config flags, but only apply rules from the first row of the table below.\r\n\r\nSo, if some transaction is received via RPC `eth_sendTransaction` or `eth_sendRawTransaction`, it is treated as local. If it is received over the network AND the sender is a local account (i.e. account stored in `KeyStoreDirectory`) AND the pool is not full, the transaction is also treated as local. Otherwise, tx must be considered as external.\r\n\r\n![image](https://user-images.githubusercontent.com/33550681/92398542-706b6780-f131-11ea-863b-320221e16aea.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/688369096/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/688398421",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2257#issuecomment-688398421",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2257",
    "id": 688398421,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4ODM5ODQyMQ==",
    "user": {
      "login": "LukaszRozmej",
      "id": 12445221,
      "node_id": "MDQ6VXNlcjEyNDQ1MjIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12445221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/LukaszRozmej",
      "html_url": "https://github.com/LukaszRozmej",
      "followers_url": "https://api.github.com/users/LukaszRozmej/followers",
      "following_url": "https://api.github.com/users/LukaszRozmej/following{/other_user}",
      "gists_url": "https://api.github.com/users/LukaszRozmej/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/LukaszRozmej/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/LukaszRozmej/subscriptions",
      "organizations_url": "https://api.github.com/users/LukaszRozmej/orgs",
      "repos_url": "https://api.github.com/users/LukaszRozmej/repos",
      "events_url": "https://api.github.com/users/LukaszRozmej/events{/privacy}",
      "received_events_url": "https://api.github.com/users/LukaszRozmej/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-07T15:37:43Z",
    "updated_at": "2020-09-07T15:37:43Z",
    "author_association": "MEMBER",
    "body": "Local trasnactions with 0 gas price are allowed only if they are from account that is also local (its unlocked on the node). It won't work for just any local account.\r\n\r\nhttps://github.com/openethereum/openethereum/blob/master/miner/src/pool/verifier.rs#L275-L276\r\n\r\nI expect this would be verifier address/account that is unlocked?\r\n\r\nI am not sure if we currently want to replicate that. \r\n\r\nAs I understand the base issue was resolved and we are planning some more complex changes in mining/txpool in future, I would propose not implementing this now and waiting for proper analysis at that time. Unless it will become crucial earlier then I will pick it up.\r\n\r\nI generally not sure if I like that idea that a validator can include any number of 0 gas transactions by itself bypassing other network rules (like certifier).",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/688398421/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/688645375",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/2257#issuecomment-688645375",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/2257",
    "id": 688645375,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4ODY0NTM3NQ==",
    "user": {
      "login": "varasev",
      "id": 33550681,
      "node_id": "MDQ6VXNlcjMzNTUwNjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33550681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/varasev",
      "html_url": "https://github.com/varasev",
      "followers_url": "https://api.github.com/users/varasev/followers",
      "following_url": "https://api.github.com/users/varasev/following{/other_user}",
      "gists_url": "https://api.github.com/users/varasev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/varasev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/varasev/subscriptions",
      "organizations_url": "https://api.github.com/users/varasev/orgs",
      "repos_url": "https://api.github.com/users/varasev/repos",
      "events_url": "https://api.github.com/users/varasev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/varasev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-08T06:24:34Z",
    "updated_at": "2020-09-08T06:24:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Local trasnactions with 0 gas price are allowed only if they are from account that is also local (its unlocked on the node). It won't work for just any local account.\r\n\r\nI tried to remove `0x32e4e4c7c5d1cea5db5f9202a9e4d99e56c91a24` from `unlock` in the config https://github.com/poanetwork/posdao-test-setup/blob/1e096c0e5e4ffececce754538a83ba8a72e0eb0c/config/node1.openethereum.toml#L32 and repeated the test but the address was still considered as local until I removed it from keystore directory https://github.com/poanetwork/posdao-test-setup/tree/1e096c0e5e4ffececce754538a83ba8a72e0eb0c/data/node1/keys/DPoSChain\r\n\r\nSo, it seems that an address from keystore directory is considered as local even if it is locked.\r\n\r\n> I am not sure if we currently want to replicate that.\r\n\r\nNo problem, let's postpone this (and keep this issue open). It is not crutial for POSDAO, just a proposal to improve compatibility with OpenEthereum.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/688645375/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
