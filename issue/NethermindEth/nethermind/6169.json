{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6169",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6169/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6169/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6169/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/6169",
  "id": 1931050480,
  "node_id": "I_kwDOBggaLc5zGX3w",
  "number": 6169,
  "title": "Websockets failing after upgrade to 1.21.0",
  "user": {
    "login": "coffeexcoin",
    "id": 137969418,
    "node_id": "U_kgDOCDk_Cg",
    "avatar_url": "https://avatars.githubusercontent.com/u/137969418?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/coffeexcoin",
    "html_url": "https://github.com/coffeexcoin",
    "followers_url": "https://api.github.com/users/coffeexcoin/followers",
    "following_url": "https://api.github.com/users/coffeexcoin/following{/other_user}",
    "gists_url": "https://api.github.com/users/coffeexcoin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/coffeexcoin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/coffeexcoin/subscriptions",
    "organizations_url": "https://api.github.com/users/coffeexcoin/orgs",
    "repos_url": "https://api.github.com/users/coffeexcoin/repos",
    "events_url": "https://api.github.com/users/coffeexcoin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/coffeexcoin/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "emlautarom1",
    "id": 31224949,
    "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
    "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/emlautarom1",
    "html_url": "https://github.com/emlautarom1",
    "followers_url": "https://api.github.com/users/emlautarom1/followers",
    "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
    "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
    "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
    "repos_url": "https://api.github.com/users/emlautarom1/repos",
    "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "emlautarom1",
      "id": 31224949,
      "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emlautarom1",
      "html_url": "https://github.com/emlautarom1",
      "followers_url": "https://api.github.com/users/emlautarom1/followers",
      "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
      "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
      "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
      "repos_url": "https://api.github.com/users/emlautarom1/repos",
      "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 9,
  "created_at": "2023-10-06T23:46:10Z",
  "updated_at": "2023-10-20T19:01:26Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Description**\r\nWebsocket connection is completely broken since update to 1.21.0\r\n\r\n**Steps to Reproduce**\r\n\r\nContainerized minimal repro at https://github.com/coffeexcoin/dotnet-nethermind-repro\r\n\r\n```\r\ngit clone https://github.com/coffeexcoin/dotnet-nethermind-repro\r\ncd dotnet-nethermind-repro\r\ndocker build . -t repro\r\ndocker run -e WS_URL=ws://[your_node_ip:port] --network=bridge repro:latest\r\n```\r\n\r\n**Actual behavior**\r\nConnection dies immediately or within one block\r\n```\r\ninfo: default[0]\r\n      Connecting to ws://192.168.3.2:8545\r\nfail: default[0]\r\n      Error in subscription\r\n      Nethereum.JsonRpc.Client.RpcResponseException: Client connection error\r\nfail: default[0]\r\n      Error in subscription\r\n      Nethereum.JsonRpc.Client.RpcResponseException: Client connection error\r\nfail: default[0]\r\n      RPC Exception, RPC Request: RPC Response: \r\n      Newtonsoft.Json.JsonReaderException: After parsing a value an unexpected character was encountered: j. Path 'params.result.transactions[37]', line 1, position 4098.\r\n         at Newtonsoft.Json.JsonTextReader.ParsePostValue(Boolean ignoreComments)\r\n         at Newtonsoft.Json.JsonTextReader.Read()\r\n         at Newtonsoft.Json.JsonWriter.WriteToken(JsonReader reader, Boolean writeChildren, Boolean writeDateConstructorAsDate, Boolean writeComments)\r\n         at Newtonsoft.Json.Linq.JTokenWriter.WriteToken(JsonReader reader, Boolean writeChildren, Boolean writeDateConstructorAsDate, Boolean writeComments)\r\n         at Newtonsoft.Json.JsonWriter.WriteToken(JsonReader reader, Boolean writeChildren)\r\n         at Newtonsoft.Json.JsonWriter.WriteToken(JsonReader reader)\r\n         at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateJToken(JsonReader reader, JsonContract contract)\r\n         at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.SetPropertyValue(JsonProperty property, JsonConverter propertyConverter, JsonContainerContract containerContract, JsonProperty containerProperty, JsonReader reader, Object target)\r\n         at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateObject(Object newObject, JsonReader reader, JsonObjectContract contract, JsonProperty member, String id)\r\n         at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateObject(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)\r\n         at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.SetPropertyValue(JsonProperty property, JsonConverter propertyConverter, JsonContainerContract containerContract, JsonProperty containerProperty, JsonReader reader, Object target)\r\n         at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.PopulateObject(Object newObject, JsonReader reader, JsonObjectContract contract, JsonProperty member, String id)\r\n         at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.CreateObject(JsonReader reader, Type objectType, JsonContract contract, JsonProperty member, JsonContainerContract containerContract, JsonProperty containerMember, Object existingValue)\r\n         at Newtonsoft.Json.Serialization.JsonSerializerInternalReader.Deserialize(JsonReader reader, Type objectType, Boolean checkAdditionalContent)\r\n         at Newtonsoft.Json.JsonSerializer.DeserializeInternal(JsonReader reader, Type objectType)\r\n         at Newtonsoft.Json.JsonSerializer.Deserialize(JsonReader reader, Type objectType)\r\n         at Newtonsoft.Json.JsonSerializer.Deserialize[T](JsonReader reader)\r\n         at Nethereum.JsonRpc.WebSocketStreamingClient.StreamingWebSocketClient.HandleIncomingMessagesAsync()\r\n```\r\n\r\n**Expected behavior**\r\nPersistent websocket connection that does not fail\r\n\r\n**Screenshots**\r\nIf applicable, please include screenshots to help illustrate the problem.\r\n\r\n**Desktop (please complete the following information):**\r\nPlease provide the following information regarding your setup:\r\n - Operating System: debian\r\n - Version: 1.21.0\r\n - Installation Method: Dappnode docker\r\n - Consensus Client: Nimbus 23.5.1\r\n\r\n**Additional context**\r\nIssue appeared immediately after updating Dappnode images from nethermind 1.20.1 to 1.21.0.\r\n\r\nDowngrading my node back to 1.20.1 fixes the issue immediately.\r\n\r\n**Logs**\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6169/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6169/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1751541476",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6169#issuecomment-1751541476",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6169",
    "id": 1751541476,
    "node_id": "IC_kwDOBggaLc5oZmbk",
    "user": {
      "login": "coffeexcoin",
      "id": 137969418,
      "node_id": "U_kgDOCDk_Cg",
      "avatar_url": "https://avatars.githubusercontent.com/u/137969418?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coffeexcoin",
      "html_url": "https://github.com/coffeexcoin",
      "followers_url": "https://api.github.com/users/coffeexcoin/followers",
      "following_url": "https://api.github.com/users/coffeexcoin/following{/other_user}",
      "gists_url": "https://api.github.com/users/coffeexcoin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/coffeexcoin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/coffeexcoin/subscriptions",
      "organizations_url": "https://api.github.com/users/coffeexcoin/orgs",
      "repos_url": "https://api.github.com/users/coffeexcoin/repos",
      "events_url": "https://api.github.com/users/coffeexcoin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/coffeexcoin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-07T01:11:36Z",
    "updated_at": "2023-10-07T01:11:36Z",
    "author_association": "NONE",
    "body": "Ethers js repro here: https://github.com/coffeexcoin/node-nethermind-repro\r\n\r\n### Run\r\n```\r\ngit clone https://github.com/coffeexcoin/node-nethermind-repro\r\ncd node-nethermind-repro\r\nnpm i\r\nexport WS_URL=ws://[your_node_ip:port]\r\nnode .\r\n```\r\n\r\nFails after a few blocks with one of the following two errors:\r\n\r\n### Error 1\r\n```\r\nnode:events:491\r\n      throw er; // Unhandled 'error' event\r\n      ^\r\n\r\nRangeError: Invalid WebSocket frame: invalid opcode 0\r\n    at Receiver.getInfo (/Users/coffee/code/node-nethermind-repro/node_modules/ws/lib/receiver.js:216:16)\r\n    at Receiver.startLoop (/Users/coffee/code/node-nethermind-repro/node_modules/ws/lib/receiver.js:136:22)\r\n    at Receiver._write (/Users/coffee/code/node-nethermind-repro/node_modules/ws/lib/receiver.js:83:10)\r\n    at writeOrBuffer (node:internal/streams/writable:392:12)\r\n    at _write (node:internal/streams/writable:333:10)\r\n    at Writable.write (node:internal/streams/writable:337:10)\r\n    at Socket.socketOnData (/Users/coffee/code/node-nethermind-repro/node_modules/ws/lib/websocket.js:1231:35)\r\n    at Socket.emit (node:events:513:28)\r\n    at addChunk (node:internal/streams/readable:324:12)\r\n    at readableAddChunk (node:internal/streams/readable:297:9)\r\nEmitted 'error' event on WebSocket instance at:\r\n    at Receiver.receiverOnError (/Users/coffee/code/node-nethermind-repro/node_modules/ws/lib/websocket.js:1117:13)\r\n    at Receiver.emit (node:events:513:28)\r\n    at emitErrorNT (node:internal/streams/destroy:151:8)\r\n    at emitErrorCloseNT (node:internal/streams/destroy:116:3)\r\n    at process.processTicksAndRejections (node:internal/process/task_queues:82:21) {\r\n  code: 'WS_ERR_INVALID_OPCODE',\r\n  [Symbol(status-code)]: 1002\r\n}\r\n```\r\n\r\n### Error 2\r\n```\r\nundefined:1\r\n{\"jsonrpc\":\"2.0\",\"method\":\"eth_subscription\",\"params\":{\"subscription\":\"0x60ae20377bb64552beae17bc7642b641\",\"result\":{\"address\":\"0xd29f5f02f5ffcd102faf467f2f236c601830780d\",\"blockHash\":\"0x568b7829b5f322cee9621a7a059e0cbd97ed4a6a1f404415cbfde1cedf5c0112\",\"blockNumber\":\"0x11729c9\",\"data\":\"0x\",\"logIndex\":\"0x44\",\"removed\":false,\"topics\":[\"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef\",\"0x0000000000000000000000003103d824e9862112bba56f8be0d029385de54554\",\"0x000000000000000000000000ef0b56692f78a44cf4034b07f80204757c31bcc9\",\"0x0000000000000000000000000000000000000000000000000000000000001b8f\"],\"transactionHash\":\"0xaff1500d4746cfc43497ccda4f6ace28eb5c55f2e1a00b975158219013121de9\",\"transactionIndex\":\"0x1c\",\"transactionLogIndex\":\"0x0\"}}}{\"jsonrpc\":\"2.0\",\"method\":\"eth_subscription\",\"params\":{\"subscription\":\"0x60ae20377bb64552beae17bc7642b641\",\"result\":{\"address\":\"0xd29f5f02f5ffcd102faf467f2f236c601830780d\",\"blockHash\":\"0x568b7829b5f322cee9621a7a059e0cbd97ed4a6a1f404415cbfde1cedf5c0112\",\"blockNumber\":\"0x11729c9\",\"data\":\"0x\",\"logIndex\":\"0x46\",\"removed\":false,\"topics\":[\"0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef\",\"0x000000000000000000000000ef0b56692f78a44cf4034b07f80204757c31bcc9\",\"0x00000000000000000000000095eab0299f6b29c231a275bd78eeecd0953a0900\",\"0x0000000000000000000000000000000000000000000000000000000000001b8f\"],\"transactionHash\":\"0xaff1500d4746cfc43497ccda4f6ace28eb5c55f2e1a00b975158219013121de9\",\"transactionIndex\":\"0x1c\",\"transactionLogIndex\":\"0x2\"}}}\r\n                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   ^\r\n\r\nSyntaxError: Unexpected token { in JSON at position 755\r\n    at JSON.parse (<anonymous>)\r\n    at WebSocketProvider._processMessage (file:///Users/coffee/code/node-nethermind-repro/node_modules/ethers/lib.esm/providers/provider-socket.js:241:30)\r\n    at WebSocketProvider.websocket.onmessage (file:///Users/coffee/code/node-nethermind-repro/node_modules/ethers/lib.esm/providers/provider-websocket.js:47:18)\r\n    at WebSocket.onMessage (/Users/coffee/code/node-nethermind-repro/node_modules/ws/lib/event-target.js:199:18)\r\n    at WebSocket.emit (node:events:513:28)\r\n    at Receiver.receiverOnMessage (/Users/coffee/code/node-nethermind-repro/node_modules/ws/lib/websocket.js:1137:20)\r\n    at Receiver.emit (node:events:513:28)\r\n    at Receiver.dataMessage (/Users/coffee/code/node-nethermind-repro/node_modules/ws/lib/receiver.js:528:14)\r\n    at Receiver.getData (/Users/coffee/code/node-nethermind-repro/node_modules/ws/lib/receiver.js:446:17)\r\n    at Receiver.startLoop (/Users/coffee/code/node-nethermind-repro/node_modules/ws/lib/receiver.js:148:22)\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1751541476/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1766596875",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6169#issuecomment-1766596875",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6169",
    "id": 1766596875,
    "node_id": "IC_kwDOBggaLc5pTCEL",
    "user": {
      "login": "fselmo",
      "id": 3532824,
      "node_id": "MDQ6VXNlcjM1MzI4MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3532824?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fselmo",
      "html_url": "https://github.com/fselmo",
      "followers_url": "https://api.github.com/users/fselmo/followers",
      "following_url": "https://api.github.com/users/fselmo/following{/other_user}",
      "gists_url": "https://api.github.com/users/fselmo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fselmo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fselmo/subscriptions",
      "organizations_url": "https://api.github.com/users/fselmo/orgs",
      "repos_url": "https://api.github.com/users/fselmo/repos",
      "events_url": "https://api.github.com/users/fselmo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fselmo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T14:58:50Z",
    "updated_at": "2023-10-17T15:03:47Z",
    "author_association": "NONE",
    "body": "web3.py repro here\r\n\r\n```py\r\n--> 238 return json.loads(msg)\r\n\r\nFile ~/.pyenv/versions/3.11.2/lib/python3.11/json/__init__.py:346, in loads(s, cls, object_hook, parse_float, parse_int, parse_constant, object_pairs_hook, **kw)\r\n    341     s = s.decode(detect_encoding(s), 'surrogatepass')\r\n    343 if (cls is None and object_hook is None and\r\n    344         parse_int is None and parse_float is None and\r\n    345         parse_constant is None and object_pairs_hook is None and not kw):\r\n--> 346     return _default_decoder.decode(s)\r\n    347 if cls is None:\r\n    348     cls = JSONDecoder\r\n\r\nFile ~/.pyenv/versions/3.11.2/lib/python3.11/json/decoder.py:340, in JSONDecoder.decode(self, s, _w)\r\n    338 end = _w(s, end).end()\r\n    339 if end != len(s):\r\n--> 340     raise JSONDecodeError(\"Extra data\", s, end)\r\n    341 return obj\r\n\r\nJSONDecodeError: Extra data: line 1 column 1439 (char 1438)\r\n```\r\n\r\nIt seems like every once in a while a subscription message comes in with two messages attached as one object. At the character where the error is it begins again with `{\"jsonrpc\":\"2.0\",...}`\r\n\r\n```python\r\n{\"jsonrpc\":\"2.0\",\"method\":\"eth_subscription\",\"params\":{\"subscription\":\"0x47db02118dda47c0856c1a066e91f783\",\"result\":{\"hash\":\"0x53af3714ff0b025006c2684ecd3e84ff4be81627c3906164e04a2e1c7de93e2e\",\"nonce\":\"0x9b07\",\"blockHash\":null,\"blockNumber\":null,\"transactionIndex\":null,\"from\":\"0xc055a530a444c1a76b654e4d171d99b4d226c990\",\"to\":\"0xa278d7234327bf4a6f2cd0fc46dac3320d484e1f\",\"value\":\"0x0\",\"gasPrice\":\"0x3dfffcb8d7\",\"maxPriorityFeePerGas\":\"0x198ac929\",\"maxFeePerGas\":\"0x3dfffcb8d7\",\"gas\":\"0x67d4\",\"input\":\"0x009019b9ce5501dfac8403ab88e74a0fdc00000000014a78dadac93283f127cb941f3e0be6c7cc8ddab7e9627dfdd5f51bca8e28cfde58c018a555bdbf5b45f4cacb2ce915739a5d4aa416ecedbcf927533063c26689e6b7b29296bb38a7df7edccdfcb9745fff4cd9c6794a1d2da99a3f9c0efc6471fec99cf123fb47c6c70d0c2482af60234096bd6e76293e76b42555f3f38305ec7b593ad72475aed5e15aaed5f565f33f5f39e1e7b316703ebeca2552f0353956a08102cb9c87ad652ef4b4cc959e96b9d1d332f7416e19b95639926a15d93679906a5333eb94a588a249d75ea9de68fd31e6cacc15554bcfbeaae27a37f5d8bedfd2b296d76badad27ad7cdbec5222bd40782ddffc20b58dd9e613e6fed8e4ef334f7ba917ffeb657a27180c6277ab2cf69202bb83f2a2c9839e89c113e4337a59e6454f9f79d1d367def4b4cc879e96f90e72cbe8560a926d931fa99e6a669db216100000ffffb10cc30301\",\"chainId\":\"0xaa36a7\",\"type\":\"0x2\",\"accessList\":[],\"v\":\"0x1\",\"s\":\"0x2173ce07ec36c708a4ccae90a59421f6dd4c3e02b3bc33e08e2b769454ca24fe\",\"r\":\"0xdcef62b87fa03cf6fa24f99ccf2f48ac172869cc08c16ddd78f4e8abf8b8d3c9\",\"yParity\":\"0x1\"}}}\r\n\r\n{\"jsonrpc\":\"2.0\",\"method\":\"eth_subscription\",\"params\":{\"subscription\":\"0x47db02118dda47c0856c1a066e91f783\",\"result\":{\"hash\":\"0xdb4117734d5a9c667d8310f48397b893d6b23374347907b168f823a1852ebf01\",\"nonce\":\"0x1905a\",\"blockHash\":null,\"blockNumber\":null,\"transactionIndex\":null,\"from\":\"0x8f23bb38f531600e5d8fddaaec41f13fab46e98c\",\"to\":\"0xff00000000000000000000000000000011155420\",\"value\":\"0x0\",\"gasPrice\":\"0x3dfffcb8d7\",\"maxPriorityFeePerGas\":\"0x198ac929\",\"maxFeePerGas\":\"0x3dfffcb8d7\",\"gas\":\"0x9658\",\"input\":\"0x0091ef0eeea4d1e47528093a194ce6b41200000000043678da8cd1fb379b0703c0f1861445a97b5189f74551a608a16ed32d13ead6d6ce581bd311cca56ae554dc2a244f555193a6254404b56aa7682a1a4eac514626d16aa8ba36da89ba46b498ba343bce9efdfefc039f73bee7cb09deb719c0149995b21e1bc7394bfb2877d45d740aec5d92553c7bd6c472e27999737db01e09c3f7672af496c73e1a2eb189aaf18c7d78568a38dd99754e4c0d8bf271aabd0a2cdf5c2547db316678ff820acd8215d79ded7cd82d65d2c4441c0f51abcc463aba199dfc986a27c4138490c15910f432500d42034a4746262fdc6d5e819fb6c2690fc6bb4f718e37276918c66d379030fc00a62e7ea53d46ed76e7159e1b8a37fa4d79b7c5c09ba553934181faaf0f4a46fc57f6c03910d4d426c9febf2ecc34c5fd8ace285b14b94c38886a23b0558758492df4b0041264700104114d6e336138fd01fc143cd4c3614500c7d2d8ccf0e564c4edff5954e576c920834b2078ae0d97441aa0104336da22c7c4f2c4f01ae76754468f0e35a0cef8e2e4c5779041290876dc1973d6ba979a2d514cb35ecc556c9f494eebcf534efc9dabd4e9ca9284b6420665200804974f1b551fd04ea9db9264eddebd4f7d397fef9727d702e83fbc3229a6597b43063f80e09c39ba0cadd6b8a9e76d36fc60c416bf3f8da158e3e998138aeaab1c1513f72e0732fffc3ec281ca86d97e00b655c23a4fa07d4d012f59607d2446ed8bf1922cc7f43d700d04ad367e434bf27a05dd0fa49e3fce45b5d7bec7ee2ba47dad4a2e6ab876e9b959366470030423058ed24f85a17ef3066f894eeda890413d2fc28dd62f33d7f9d23391e14918c8e02608ee167e34df982aca50d038b8b148ddc9f1d585612d5d50ee6352ba2dadf5590964700b047fea28b149e74c13b13a42b8af264cd8de9ded5c7904353e34ab795dd451e00719dc01c1ebd4c041a6cf23caf4b279fee198939c9d4c261df5a60f18c5bac7fabbf19c20839fff4b6676859c32eb0774615a233e017c790dedc0c35506b259b181755e5611049030fc20a6757af16a5eebbc72ddb1e2cbfd83bd2686b6f67674b1c052445d62b3867f562447db55ef03c1e3e387c80906f2c29780da30977e3fb7623f7b57df72aa3eff069dcda091d1904105105c5db27847c1c333f047f96343552fd681b5d1bf1915b8d285cbbd3d5704041fc8201c048b52a235e2dba8b5e96fbd915d316a657d5af6dfda6e11221800e5d3cc4d6e2964500904858fa529672d87bf4bf1eadc41a5bed0c478bfb6765c1623db12399bcd8d082464500504ede5c712ae7ee5e7155b07231373a875d5f972d8ab49e32c96b7b8c83d02b800195405414681eb1fe573279a1a8d01c4bc67cbd324426549fcf45fb76c66168466f6461412861fcccc781fd8489d1555b509d471b948b726712c1d2e2161fbf81e2d26898069d11ea80e8267e22a47e1fa9ccf470d4db94f820835872f5919ae8f5b719f6fc53df5e00ef543063578ff040000ffff56247d4d01\",\"chainId\":\"0xaa36a7\",\"type\":\"0x2\",\"accessList\":[],\"v\":\"0x1\",\"s\":\"0x5d5941176cc1d4324d34755c091dac3725a460289b8ab2afadd720bcbb75ea68\",\"r\":\"0x9ebf1f98d4475487cb71692ddb274a7bf0d0630e1f536e58315f5848fd21646d\",\"yParity\":\"0x1\"}}}\r\n```\r\n\r\nI've spaced them out above but these two messages came in as one and so are unable to be parsed by native json libraries.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1766596875/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1767200475",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6169#issuecomment-1767200475",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6169",
    "id": 1767200475,
    "node_id": "IC_kwDOBggaLc5pVVbb",
    "user": {
      "login": "emlautarom1",
      "id": 31224949,
      "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emlautarom1",
      "html_url": "https://github.com/emlautarom1",
      "followers_url": "https://api.github.com/users/emlautarom1/followers",
      "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
      "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
      "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
      "repos_url": "https://api.github.com/users/emlautarom1/repos",
      "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T21:16:40Z",
    "updated_at": "2023-10-17T21:16:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hello, thanks for reporting this issue. Could you please share your Nethermind config (CLI flags/ENV)?",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1767200475/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1768660716",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6169#issuecomment-1768660716",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6169",
    "id": 1768660716,
    "node_id": "IC_kwDOBggaLc5pa57s",
    "user": {
      "login": "coffeexcoin",
      "id": 137969418,
      "node_id": "U_kgDOCDk_Cg",
      "avatar_url": "https://avatars.githubusercontent.com/u/137969418?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/coffeexcoin",
      "html_url": "https://github.com/coffeexcoin",
      "followers_url": "https://api.github.com/users/coffeexcoin/followers",
      "following_url": "https://api.github.com/users/coffeexcoin/following{/other_user}",
      "gists_url": "https://api.github.com/users/coffeexcoin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/coffeexcoin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/coffeexcoin/subscriptions",
      "organizations_url": "https://api.github.com/users/coffeexcoin/orgs",
      "repos_url": "https://api.github.com/users/coffeexcoin/repos",
      "events_url": "https://api.github.com/users/coffeexcoin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/coffeexcoin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-18T15:03:39Z",
    "updated_at": "2023-10-18T15:03:39Z",
    "author_association": "NONE",
    "body": "I am using the DAppNode image (https://github.com/dappnode/DAppNodePackage-nethermind)\r\n\r\nTheir runtime flags are:\r\n```\r\nexec /nethermind/nethermind \\\r\n  --JsonRpc.Enabled=true \\\r\n  --JsonRpc.JwtSecretFile=${JWT_PATH} \\\r\n  --Init.BaseDbPath=/data \\\r\n  --HealthChecks.Enabled true \\\r\n  --Init.LogDirectory=/data/logs \\\r\n  $EXTRA_OPTS\r\n```\r\n\r\nI do not have anything set for EXTRA_OPTS.\r\n\r\nThe following additional ENV variables are set by dappnode:\r\n<img width=\"921\" alt=\"image\" src=\"https://github.com/NethermindEth/nethermind/assets/137969418/7591ca62-02a6-4f54-b295-072623c6f54f\">\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1768660716/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1772913042",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6169#issuecomment-1772913042",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6169",
    "id": 1772913042,
    "node_id": "IC_kwDOBggaLc5prIGS",
    "user": {
      "login": "emlautarom1",
      "id": 31224949,
      "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emlautarom1",
      "html_url": "https://github.com/emlautarom1",
      "followers_url": "https://api.github.com/users/emlautarom1/followers",
      "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
      "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
      "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
      "repos_url": "https://api.github.com/users/emlautarom1/repos",
      "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-20T15:03:56Z",
    "updated_at": "2023-10-20T15:03:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm currently trying to reproduce the issue with the JS app you shared (https://github.com/coffeexcoin/node-nethermind-repro) but I'm not getting any messages at all.\r\n\r\nCould you please elaborate on the steps to trigger this issue?",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1772913042/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1772969991",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6169#issuecomment-1772969991",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6169",
    "id": 1772969991,
    "node_id": "IC_kwDOBggaLc5prWAH",
    "user": {
      "login": "fselmo",
      "id": 3532824,
      "node_id": "MDQ6VXNlcjM1MzI4MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3532824?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fselmo",
      "html_url": "https://github.com/fselmo",
      "followers_url": "https://api.github.com/users/fselmo/followers",
      "following_url": "https://api.github.com/users/fselmo/following{/other_user}",
      "gists_url": "https://api.github.com/users/fselmo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fselmo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fselmo/subscriptions",
      "organizations_url": "https://api.github.com/users/fselmo/orgs",
      "repos_url": "https://api.github.com/users/fselmo/repos",
      "events_url": "https://api.github.com/users/fselmo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fselmo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-20T15:37:21Z",
    "updated_at": "2023-10-20T15:46:02Z",
    "author_association": "NONE",
    "body": "Here is a reproducible example in python with *web3.py* `v6.11.1`\r\n\r\n```py\r\n>>> import asyncio\r\n>>> from web3 import AsyncWeb3\r\n>>> from web3.providers import WebsocketProviderV2\r\n\r\n>>> async def pending_transactions():\r\n...     async with AsyncWeb3.persistent_websocket(\r\n...         WebsocketProviderV2(f\"ws://127.0.0.1:8546\")  # Nethermind and Lighthouse running Sepolia and synced \r\n...     ) as w3:\r\n...         # subscribe to new pending transactions\r\n...         subscription_id = await w3.eth.subscribe(\"newPendingTransactions\", True)\r\n...\r\n...         async for response in w3.ws.listen_to_websocket():\r\n...             print(f\"{response}\\n\")\r\n...             # each response prints here\r\n\r\n>>> asyncio.run(pending_transactions())\r\n```\r\n\r\nI was running Sepolia network with Nethermind + Lighthouse combo locally and running into these issues every ~3 min or so. After downgrading Nethermind to `v1.20.4` the issues went away, all other things were kept the same.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1772969991/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1773103569",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6169#issuecomment-1773103569",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6169",
    "id": 1773103569,
    "node_id": "IC_kwDOBggaLc5pr2nR",
    "user": {
      "login": "emlautarom1",
      "id": 31224949,
      "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emlautarom1",
      "html_url": "https://github.com/emlautarom1",
      "followers_url": "https://api.github.com/users/emlautarom1/followers",
      "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
      "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
      "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
      "repos_url": "https://api.github.com/users/emlautarom1/repos",
      "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-20T17:12:07Z",
    "updated_at": "2023-10-20T17:12:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for the example. Does this issue show up with other methods like `newHeads`, `logs` or `syncing`? (https://docs.nethermind.io/nethermind/ethereum-client/json-rpc/subscribe).",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1773103569/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1773115173",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6169#issuecomment-1773115173",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6169",
    "id": 1773115173,
    "node_id": "IC_kwDOBggaLc5pr5cl",
    "user": {
      "login": "fselmo",
      "id": 3532824,
      "node_id": "MDQ6VXNlcjM1MzI4MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3532824?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fselmo",
      "html_url": "https://github.com/fselmo",
      "followers_url": "https://api.github.com/users/fselmo/followers",
      "following_url": "https://api.github.com/users/fselmo/following{/other_user}",
      "gists_url": "https://api.github.com/users/fselmo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fselmo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fselmo/subscriptions",
      "organizations_url": "https://api.github.com/users/fselmo/orgs",
      "repos_url": "https://api.github.com/users/fselmo/repos",
      "events_url": "https://api.github.com/users/fselmo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fselmo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-20T17:21:27Z",
    "updated_at": "2023-10-20T17:23:25Z",
    "author_association": "NONE",
    "body": "> Does this issue show up with other methods like `newHeads`, `logs` or `syncing`?\r\n\r\nI'm not sure as I have downgraded to `1.20.4` and things are running smoothly. But subscribing to those via *web3.py* to test against would just be a matter of changing this line:\r\n\r\n```py\r\nsubscription_id = await w3.eth.subscribe(\"newPendingTransactions\", True)\r\n```\r\n\r\nto \r\n\r\n```py\r\n# newHeads\r\nsubscription_id = await w3.eth.subscribe(\"newHeads\")\r\n\r\n# or, logs:\r\nsubscription_id = await w3.eth.subscribe(\"logs\", {\"fromBlock\": \"latest\", \"toBlock\": \"latest\", \"address\": \"0xb7705ae4c6f81b66cdb323c65f4e8133690fc099\"})\r\n```\r\n\r\nDepending on your `logs` filter, you could get many results or not that many but `newHeads` might take quite a while to see any error if it does happen since they are slow to come by. `newPendingTransactions` sends many messages so it seems it's way easier to test against and it still takes about ~3 minutes or so to see an error / double message, on average.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1773115173/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1773256953",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/6169#issuecomment-1773256953",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/6169",
    "id": 1773256953,
    "node_id": "IC_kwDOBggaLc5pscD5",
    "user": {
      "login": "emlautarom1",
      "id": 31224949,
      "node_id": "MDQ6VXNlcjMxMjI0OTQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/31224949?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/emlautarom1",
      "html_url": "https://github.com/emlautarom1",
      "followers_url": "https://api.github.com/users/emlautarom1/followers",
      "following_url": "https://api.github.com/users/emlautarom1/following{/other_user}",
      "gists_url": "https://api.github.com/users/emlautarom1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/emlautarom1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/emlautarom1/subscriptions",
      "organizations_url": "https://api.github.com/users/emlautarom1/orgs",
      "repos_url": "https://api.github.com/users/emlautarom1/repos",
      "events_url": "https://api.github.com/users/emlautarom1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/emlautarom1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-20T19:01:26Z",
    "updated_at": "2023-10-20T19:01:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thank you for your help. We were able to reproduce the issue and a fix is available on #6210.",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1773256953/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
