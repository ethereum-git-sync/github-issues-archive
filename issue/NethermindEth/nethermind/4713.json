{
  "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4713",
  "repository_url": "https://api.github.com/repos/NethermindEth/nethermind",
  "labels_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4713/labels{/name}",
  "comments_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4713/comments",
  "events_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4713/events",
  "html_url": "https://github.com/NethermindEth/nethermind/issues/4713",
  "id": 1397934455,
  "node_id": "I_kwDOBggaLc5TUsl3",
  "number": 4713,
  "title": "Can't start RPC host as user with Ubuntu 22.04",
  "user": {
    "login": "mrpez1",
    "id": 112206437,
    "node_id": "U_kgDOBrAiZQ",
    "avatar_url": "https://avatars.githubusercontent.com/u/112206437?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mrpez1",
    "html_url": "https://github.com/mrpez1",
    "followers_url": "https://api.github.com/users/mrpez1/followers",
    "following_url": "https://api.github.com/users/mrpez1/following{/other_user}",
    "gists_url": "https://api.github.com/users/mrpez1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mrpez1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mrpez1/subscriptions",
    "organizations_url": "https://api.github.com/users/mrpez1/orgs",
    "repos_url": "https://api.github.com/users/mrpez1/repos",
    "events_url": "https://api.github.com/users/mrpez1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mrpez1/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4117342111,
      "node_id": "LA_kwDOBggaLc71aaef",
      "url": "https://api.github.com/repos/NethermindEth/nethermind/labels/high%20priority",
      "name": "high priority",
      "color": "D93F0B",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "OlegJakushkin",
    "id": 2915361,
    "node_id": "MDQ6VXNlcjI5MTUzNjE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2915361?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/OlegJakushkin",
    "html_url": "https://github.com/OlegJakushkin",
    "followers_url": "https://api.github.com/users/OlegJakushkin/followers",
    "following_url": "https://api.github.com/users/OlegJakushkin/following{/other_user}",
    "gists_url": "https://api.github.com/users/OlegJakushkin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/OlegJakushkin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/OlegJakushkin/subscriptions",
    "organizations_url": "https://api.github.com/users/OlegJakushkin/orgs",
    "repos_url": "https://api.github.com/users/OlegJakushkin/repos",
    "events_url": "https://api.github.com/users/OlegJakushkin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/OlegJakushkin/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "OlegJakushkin",
      "id": 2915361,
      "node_id": "MDQ6VXNlcjI5MTUzNjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2915361?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/OlegJakushkin",
      "html_url": "https://github.com/OlegJakushkin",
      "followers_url": "https://api.github.com/users/OlegJakushkin/followers",
      "following_url": "https://api.github.com/users/OlegJakushkin/following{/other_user}",
      "gists_url": "https://api.github.com/users/OlegJakushkin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/OlegJakushkin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/OlegJakushkin/subscriptions",
      "organizations_url": "https://api.github.com/users/OlegJakushkin/orgs",
      "repos_url": "https://api.github.com/users/OlegJakushkin/repos",
      "events_url": "https://api.github.com/users/OlegJakushkin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/OlegJakushkin/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-10-05T14:54:24Z",
  "updated_at": "2023-07-27T15:19:46Z",
  "closed_at": "2023-07-27T15:19:45Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I am unable to run the RPC host on Ubuntu 22.04 under a user account. Nethermind starts but errors when it tries to start RPC with a permission denied.  It works fine when Nethermind is run as root but that is undesirable from a security point of view. This first came to light when I upgraded an existing/functional server from 20.04. I've also reproduced the issue with a fresh install of 22.04. Running Nethermind 1.14.3.\r\n\r\n2022-10-04 12:13:36.4298|Step StartRpc                 failed after 144ms System.UnauthorizedAccessException: Access to the path '/proc/1/task/1/fdinfo' is denied. \r\n ---> System.IO.IOException: Permission denied \r\n   --- End of inner exception stack trace --- \r\n   at System.IO.Enumeration.FileSystemEnumerator`1.CreateDirectoryHandle(String path, Boolean ignoreNotFound) \r\n   at System.IO.Enumeration.FileSystemEnumerator`1.Init() \r\n   at System.IO.Enumeration.FileSystemEnumerator`1..ctor(String directory, Boolean isNormalized, EnumerationOptions options) \r\n   at System.IO.Enumeration.FileSystemEnumerable`1..ctor(String directory, FindTransform transform, EnumerationOptions options, Boolean isNormalized) \r\n   at System.IO.Enumeration.FileSystemEnumerableFactory.UserDirectories(String directory, String expression, EnumerationOptions options) \r\n   at System.IO.Directory.InternalEnumeratePaths(String path, String searchPattern, SearchTarget searchTarget, EnumerationOptions options) \r\n   at System.IO.Directory.EnumerateDirectories(String path) \r\n   at System.IO.FileSystemWatcher.RunningInstance.AddDirectoryWatchUnlocked(WatchedDirectory parent, String directoryName) \r\n   at System.IO.FileSystemWatcher.RunningInstance.AddDirectoryWatchUnlocked(WatchedDirectory parent, String directoryName) \r\n   at System.IO.FileSystemWatcher.RunningInstance.AddDirectoryWatchUnlocked(WatchedDirectory parent, String directoryName) \r\n   at System.IO.FileSystemWatcher.RunningInstance.AddDirectoryWatchUnlocked(WatchedDirectory parent, String directoryName) \r\n   at System.IO.FileSystemWatcher.RunningInstance.AddDirectoryWatchUnlocked(WatchedDirectory parent, String directoryName) \r\n   at System.IO.FileSystemWatcher.RunningInstance.AddDirectoryWatchUnlocked(WatchedDirectory parent, String directoryName) \r\n   at System.IO.FileSystemWatcher.RunningInstance..ctor(FileSystemWatcher watcher, SafeFileHandle inotifyHandle, String directoryPath, Boolean includeSubdirectories, NotifyFilters notifyFilters, CancellationToken cancellationToken) \r\n   at System.IO.FileSystemWatcher.StartRaisingEvents() \r\n   at System.IO.FileSystemWatcher.StartRaisingEventsIfNotDisposed() \r\n   at System.IO.FileSystemWatcher.set_EnableRaisingEvents(Boolean value) \r\n   at Microsoft.Extensions.FileProviders.Physical.PhysicalFilesWatcher.TryEnableFileSystemWatcher() \r\n   at Microsoft.Extensions.FileProviders.Physical.PhysicalFilesWatcher.CreateFileChangeToken(String filter) \r\n   at Microsoft.Extensions.FileProviders.PhysicalFileProvider.Watch(String filter) \r\n   at Microsoft.Extensions.Configuration.FileConfigurationProvider.<.ctor>b__1_0() \r\n   at Microsoft.Extensions.Primitives.ChangeToken.OnChange(Func`1 changeTokenProducer, Action changeTokenConsumer) \r\n   at Microsoft.Extensions.Configuration.FileConfigurationProvider..ctor(FileConfigurationSource source) \r\n   at Microsoft.Extensions.Configuration.Json.JsonConfigurationSource.Build(IConfigurationBuilder builder) \r\n   at Microsoft.Extensions.Configuration.ConfigurationBuilder.Build() \r\n   at Microsoft.AspNetCore.Hosting.WebHostBuilder.BuildCommonServices(AggregateException& hostingStartupErrors) \r\n   at Microsoft.AspNetCore.Hosting.WebHostBuilder.Build() \r\n   at Nethermind.Runner.Ethereum.JsonRpcRunner.Start(CancellationToken cancellationToken) \r\n   at Nethermind.Runner.Ethereum.Steps.StartRpc.Execute(CancellationToken cancellationToken) \r\n",
  "closed_by": {
    "login": "OlegJakushkin",
    "id": 2915361,
    "node_id": "MDQ6VXNlcjI5MTUzNjE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2915361?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/OlegJakushkin",
    "html_url": "https://github.com/OlegJakushkin",
    "followers_url": "https://api.github.com/users/OlegJakushkin/followers",
    "following_url": "https://api.github.com/users/OlegJakushkin/following{/other_user}",
    "gists_url": "https://api.github.com/users/OlegJakushkin/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/OlegJakushkin/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/OlegJakushkin/subscriptions",
    "organizations_url": "https://api.github.com/users/OlegJakushkin/orgs",
    "repos_url": "https://api.github.com/users/OlegJakushkin/repos",
    "events_url": "https://api.github.com/users/OlegJakushkin/events{/privacy}",
    "received_events_url": "https://api.github.com/users/OlegJakushkin/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4713/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4713/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1653836948",
    "html_url": "https://github.com/NethermindEth/nethermind/issues/4713#issuecomment-1653836948",
    "issue_url": "https://api.github.com/repos/NethermindEth/nethermind/issues/4713",
    "id": 1653836948,
    "node_id": "IC_kwDOBggaLc5ik4yU",
    "user": {
      "login": "OlegJakushkin",
      "id": 2915361,
      "node_id": "MDQ6VXNlcjI5MTUzNjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2915361?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/OlegJakushkin",
      "html_url": "https://github.com/OlegJakushkin",
      "followers_url": "https://api.github.com/users/OlegJakushkin/followers",
      "following_url": "https://api.github.com/users/OlegJakushkin/following{/other_user}",
      "gists_url": "https://api.github.com/users/OlegJakushkin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/OlegJakushkin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/OlegJakushkin/subscriptions",
      "organizations_url": "https://api.github.com/users/OlegJakushkin/orgs",
      "repos_url": "https://api.github.com/users/OlegJakushkin/repos",
      "events_url": "https://api.github.com/users/OlegJakushkin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/OlegJakushkin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-27T15:19:45Z",
    "updated_at": "2023-07-27T15:19:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "Not an issue on current client.\r\n\r\nProof:\r\nTry this docker file\r\n```\r\n# Specify Ubuntu version\r\nFROM ubuntu:22.04\r\n\r\n# Update system packages and install necessary dependencies\r\nRUN apt update && DEBIAN_FRONTEND=noninteractive apt install -y libicu-dev libsnappy-dev libc6-dev libc6 wget git\r\n\r\n# Download and install .NET\r\nRUN wget https://dot.net/v1/dotnet-install.sh -O dotnet-install.sh \\\r\n    && chmod a+x ./dotnet-install.sh\r\nRUN ./dotnet-install.sh --install-dir /usr/bin/ --channel 7.0 --version latest\r\n\r\n\r\n# Create a new non-root user\r\nRUN useradd -ms /bin/bash myuser\r\nRUN mkdir ethdata consensus\r\nRUN chown -R myuser:myuser /home/myuser\r\n\r\n\r\n# Switch to the new user\r\nUSER myuser\r\n\r\n# Ensure myuser owns all the necessary directories\r\nWORKDIR /home/myuser\r\n\r\n# Clone Nethermind repository\r\nRUN git clone --recursive https://github.com/NethermindEth/nethermind\r\n\r\n# Build Nethermind\r\nRUN cd nethermind && dotnet publish src/Nethermind/Nethermind.Runner -c release -o out -p:Deterministic=true\r\n```\r\n\r\nRun it with:\r\n```\r\ndocker run -v \"$(pwd)/ethdata:/home/myuser/ethdata\" -v \"$(pwd)/consensus:/home/myuser/consensus\" -p 8547:8547 -p 9091:9091 -it nm /bin/bash -c \"dotnet ./nethermind/out/nethermind.dll -c mainnet -dd /home/myuser/ethdata --Metrics.Enabled true --Metrics.ExposePort=9091 --JsonRpc.Enabled true --JsonRpc.Port 8547 --Sync.SnapSync true --JsonRpc.JwtSecretFile /home/myuser/consensus/jwt.hex --JsonRpc.Host 0.0.0.0 --configsDirectory ./nethermind/src/Nethermind/Nethermind.Runner/configs\"\r\n```\r\n\r\nAnd then run:\r\n```python\r\nimport requests\r\nimport json\r\n\r\n# Define the JSON-RPC request payload\r\npayload = {\r\n    \"jsonrpc\": \"2.0\",\r\n    \"id\": 1,\r\n    \"method\": \"web3_clientVersion\",\r\n    \"params\": []\r\n}\r\n\r\nresponse = requests.post(\"http://127.0.0.1:8547\", json=payload)\r\nprint(response.text)\r\n```\r\n\r\nThat would show that NM client ***can*** start RPC host as non root user with Ubuntu 22.04 :\r\n```json\r\n{\"jsonrpc\":\"2.0\",\"result\":\"Nethermind/v1.21.0-unstable+a3029b83/linux-x64/dotnet7.0.9\",\"id\":1}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/NethermindEth/nethermind/issues/comments/1653836948/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
