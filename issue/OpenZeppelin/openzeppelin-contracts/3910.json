{
  "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3910",
  "repository_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts",
  "labels_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3910/labels{/name}",
  "comments_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3910/comments",
  "events_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3910/events",
  "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3910",
  "id": 1515327439,
  "node_id": "I_kwDOA9tCBs5aUg_P",
  "number": 3910,
  "title": "upgradeable proxy add version control",
  "user": {
    "login": "lxhyl",
    "id": 41041503,
    "node_id": "MDQ6VXNlcjQxMDQxNTAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/41041503?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lxhyl",
    "html_url": "https://github.com/lxhyl",
    "followers_url": "https://api.github.com/users/lxhyl/followers",
    "following_url": "https://api.github.com/users/lxhyl/following{/other_user}",
    "gists_url": "https://api.github.com/users/lxhyl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lxhyl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lxhyl/subscriptions",
    "organizations_url": "https://api.github.com/users/lxhyl/orgs",
    "repos_url": "https://api.github.com/users/lxhyl/repos",
    "events_url": "https://api.github.com/users/lxhyl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lxhyl/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-01-01T05:47:34Z",
  "updated_at": "2023-01-02T11:47:15Z",
  "closed_at": "2023-01-02T11:47:15Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**üßê Motivation**\r\n<!-- Is your feature request related to a specific problem? Is it just a crazy idea? Tell us about it! -->\r\nupgradeable contract is great.But maybe confusion when upgrade many times. So we can add implemenation version to better control contract.\r\n\r\n\r\n**üìù Details**\r\n<!-- Please describe your feature request in detail. -->\r\n## storage\r\n- add `version` variable define current implemenation version. This can only increase. `version++` when admin call upgrade. \r\n- add `mapping(version => implemenationAddress) historyImplemenation` record hisory implemenation contract.\r\n\r\n## method\r\n- `backToVersion(version)` can rollback to some implemenation contract.\r\n\r\n\r\n\r\n<!-- Make sure that you have reviewed the OpenZeppelin Contracts Contributor Guidelines. -->\r\n<!-- https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/CONTRIBUTING.md -->\r\n",
  "closed_by": {
    "login": "lxhyl",
    "id": 41041503,
    "node_id": "MDQ6VXNlcjQxMDQxNTAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/41041503?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lxhyl",
    "html_url": "https://github.com/lxhyl",
    "followers_url": "https://api.github.com/users/lxhyl/followers",
    "following_url": "https://api.github.com/users/lxhyl/following{/other_user}",
    "gists_url": "https://api.github.com/users/lxhyl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lxhyl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lxhyl/subscriptions",
    "organizations_url": "https://api.github.com/users/lxhyl/orgs",
    "repos_url": "https://api.github.com/users/lxhyl/repos",
    "events_url": "https://api.github.com/users/lxhyl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lxhyl/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3910/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3910/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1368807827",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3910#issuecomment-1368807827",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3910",
    "id": 1368807827,
    "node_id": "IC_kwDOA9tCBs5RllmT",
    "user": {
      "login": "Amxx",
      "id": 2432299,
      "node_id": "MDQ6VXNlcjI0MzIyOTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2432299?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Amxx",
      "html_url": "https://github.com/Amxx",
      "followers_url": "https://api.github.com/users/Amxx/followers",
      "following_url": "https://api.github.com/users/Amxx/following{/other_user}",
      "gists_url": "https://api.github.com/users/Amxx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Amxx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Amxx/subscriptions",
      "organizations_url": "https://api.github.com/users/Amxx/orgs",
      "repos_url": "https://api.github.com/users/Amxx/repos",
      "events_url": "https://api.github.com/users/Amxx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Amxx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-02T10:16:34Z",
    "updated_at": "2023-01-02T10:16:34Z",
    "author_association": "COLLABORATOR",
    "body": "Hello @lxhyl \r\n\r\nHaving both a version and a mapping would make all calls to the proxy significantly more expensive. Instead of reading the implementation address (1 sload), you would have to:\r\n- read the version (1 sload)\r\n- hash it to get the mapping slot\r\n- read the implementation (1 sload)\r\n\r\nConsidering this would have to be executed for every calls to the contract, it will add up to serious gas fees.\r\n\r\n\r\nI would also argue that, beside the cost, this is not necessary at all. \r\n\r\nThe `backToVersion` function would have to be protected. Imagine an upgrade fixes a bug, you would not want anyone to revert to a previous version that can be exploited. IMO, the `backToVersion` is already possible by using the \"normal\" upgrade process to use an old version. \r\n\r\nAnd you don't really need to store the history of implementations onchain. Ann upgrades should trigger an event, that can be observed off-chain.\r\n\r\nAs an exemple, you can use [this subgraph](https://thegraph.com/hosted-service/subgraph/amxx/access-control) with the following query\r\n```\r\n{\r\n  accounts(where: { erc1967Implementation_not: null}) {\r\n    id\r\n    ERC1967ImplementationUpgraded(orderBy: timestamp) {\r\n      transaction { blockNumber timestamp }\r\n      implementation {\r\n        id\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\nto get a history of all previous versions\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1368807827/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1368809128",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3910#issuecomment-1368809128",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3910",
    "id": 1368809128,
    "node_id": "IC_kwDOA9tCBs5Rll6o",
    "user": {
      "login": "Amxx",
      "id": 2432299,
      "node_id": "MDQ6VXNlcjI0MzIyOTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2432299?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Amxx",
      "html_url": "https://github.com/Amxx",
      "followers_url": "https://api.github.com/users/Amxx/followers",
      "following_url": "https://api.github.com/users/Amxx/following{/other_user}",
      "gists_url": "https://api.github.com/users/Amxx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Amxx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Amxx/subscriptions",
      "organizations_url": "https://api.github.com/users/Amxx/orgs",
      "repos_url": "https://api.github.com/users/Amxx/repos",
      "events_url": "https://api.github.com/users/Amxx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Amxx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-02T10:18:24Z",
    "updated_at": "2023-01-02T10:18:24Z",
    "author_association": "COLLABORATOR",
    "body": "If you really want to have a proxy with an onchain history of versions, it should be easy to expand `contracts/proxy/Proxy.sol` and implement `_implementation()` using the mapping that you have in mind. I'm not sure this is something we want to encourage and provide to our users though.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1368809128/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1368875506",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3910#issuecomment-1368875506",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3910",
    "id": 1368875506,
    "node_id": "IC_kwDOA9tCBs5Rl2Hy",
    "user": {
      "login": "lxhyl",
      "id": 41041503,
      "node_id": "MDQ6VXNlcjQxMDQxNTAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/41041503?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lxhyl",
      "html_url": "https://github.com/lxhyl",
      "followers_url": "https://api.github.com/users/lxhyl/followers",
      "following_url": "https://api.github.com/users/lxhyl/following{/other_user}",
      "gists_url": "https://api.github.com/users/lxhyl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lxhyl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lxhyl/subscriptions",
      "organizations_url": "https://api.github.com/users/lxhyl/orgs",
      "repos_url": "https://api.github.com/users/lxhyl/repos",
      "events_url": "https://api.github.com/users/lxhyl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lxhyl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-02T11:47:15Z",
    "updated_at": "2023-01-02T11:47:15Z",
    "author_association": "NONE",
    "body": "Thank your reply,  I did not think it through.  ",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1368875506/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
