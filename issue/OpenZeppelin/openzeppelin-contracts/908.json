{
  "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/908",
  "repository_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts",
  "labels_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/908/labels{/name}",
  "comments_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/908/comments",
  "events_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/908/events",
  "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/908",
  "id": 316530926,
  "node_id": "MDU6SXNzdWUzMTY1MzA5MjY=",
  "number": 908,
  "title": "checkAndCallSafeTransfer does not act as described",
  "user": {
    "login": "bee-irl",
    "id": 30704742,
    "node_id": "MDQ6VXNlcjMwNzA0NzQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/30704742?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bee-irl",
    "html_url": "https://github.com/bee-irl",
    "followers_url": "https://api.github.com/users/bee-irl/followers",
    "following_url": "https://api.github.com/users/bee-irl/following{/other_user}",
    "gists_url": "https://api.github.com/users/bee-irl/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bee-irl/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bee-irl/subscriptions",
    "organizations_url": "https://api.github.com/users/bee-irl/orgs",
    "repos_url": "https://api.github.com/users/bee-irl/repos",
    "events_url": "https://api.github.com/users/bee-irl/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bee-irl/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2018-04-21T22:31:44Z",
  "updated_at": "2018-05-04T20:39:01Z",
  "closed_at": "2018-05-04T20:39:01Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## checkAndCallSafeTransfer does not act as described\r\n\r\n- [x] 🐛 This is a bug report.\r\n\r\n## 📝 Details\r\n\r\nOn line 273 of ERC721BasicToken.sol (https://github.com/OpenZeppelin/zeppelin-solidity/blob/master/contracts/token/ERC721/ERC721BasicToken.sol#L273) the documentation says:\r\n\r\n> The call is not executed if the target address is not a contract\r\n\r\nHowever, later on, the code reads:\r\n\r\n```\r\n    if (!_to.isContract()) {\r\n      return true;\r\n    }\r\n    bytes4 retval = ERC721Receiver(_to).onERC721Received(_from, _tokenId, _data);\r\n    return (retval == ERC721_RECEIVED);\r\n```\r\nIt seems that if the `_to` address is not a contract the function returns `true`. However the documentation states that the \"call should not be executed\" if the `_to` address is not a contract. What does that mean exactly?\r\n\r\nWhy does this function return `true` when the `_to` address is not a contract?\r\n",
  "closed_by": {
    "login": "frangio",
    "id": 481465,
    "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/frangio",
    "html_url": "https://github.com/frangio",
    "followers_url": "https://api.github.com/users/frangio/followers",
    "following_url": "https://api.github.com/users/frangio/following{/other_user}",
    "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
    "organizations_url": "https://api.github.com/users/frangio/orgs",
    "repos_url": "https://api.github.com/users/frangio/repos",
    "events_url": "https://api.github.com/users/frangio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/frangio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/908/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/908/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/383340045",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/908#issuecomment-383340045",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/908",
    "id": 383340045,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MzM0MDA0NQ==",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-21T23:09:22Z",
    "updated_at": "2018-04-21T23:09:22Z",
    "author_association": "MEMBER",
    "body": "Hi @bee-irl, thanks for bringing this up.\r\n\r\nThe documentation isn't very clear. \"The call should not be executed\" refers to the `onERC721Received` call. As you can see in the snippet you pasted, this is indeed true.\r\n\r\nThe boolean return value is not well documented either, it says it is \"whether the call correctly returned the expected magic value\", but this only applies to the case when `_to` is a contract. As we can see in the use of `checkAndCallSafeTransfer` the boolean return value is used to verify success in both cases and revert otherwise.\r\n\r\nhttps://github.com/OpenZeppelin/zeppelin-solidity/blob/77cc33fc5c4d0b0d03aec1d8bba77edc9a7196ae/contracts/token/ERC721/ERC721BasicToken.sol#L197\r\n\r\nI think the name `checkAndCallSafeTransfer` should be improved. It isn't very good because the actual transfer is not done in this function. What is called is `onERC721Received`.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/383340045/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/383346778",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/908#issuecomment-383346778",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/908",
    "id": 383346778,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MzM0Njc3OA==",
    "user": {
      "login": "bee-irl",
      "id": 30704742,
      "node_id": "MDQ6VXNlcjMwNzA0NzQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/30704742?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bee-irl",
      "html_url": "https://github.com/bee-irl",
      "followers_url": "https://api.github.com/users/bee-irl/followers",
      "following_url": "https://api.github.com/users/bee-irl/following{/other_user}",
      "gists_url": "https://api.github.com/users/bee-irl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bee-irl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bee-irl/subscriptions",
      "organizations_url": "https://api.github.com/users/bee-irl/orgs",
      "repos_url": "https://api.github.com/users/bee-irl/repos",
      "events_url": "https://api.github.com/users/bee-irl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bee-irl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-22T01:09:52Z",
    "updated_at": "2018-04-22T01:29:14Z",
    "author_association": "NONE",
    "body": "@frangio I'm a bit new to this, but, shouldn't `safeTransferFrom` fail if `_to` is not a contract? `safeTransferFrom` is the function that calls `transferFrom` and `require(checkAndCallSafeTransfer())` respectively.\r\n\r\nIf `checkAndCallSafeTransfer` always satisfies the `require` statement because it's not checking whether or not `_to` is a contract then isn't it true that it's possible to send an ERC721 token to a `_to` address that is not a contract and therefore won't be able to interact with it? Please let me know if I've misunderstood this somehow.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/383346778/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/383391254",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/908#issuecomment-383391254",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/908",
    "id": 383391254,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MzM5MTI1NA==",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-22T15:52:18Z",
    "updated_at": "2018-04-22T15:52:18Z",
    "author_association": "MEMBER",
    "body": "@bee-irl We have to refer to the [specification](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-721.md) for `safeTransferFrom`.\r\n\r\n>When transfer is complete, this function checks if `_to` is a smart contract (code size > 0). If so, it calls `onERC721Received` on `_to` and throws if the return value is not `bytes4(keccak256(\"onERC721Received(address,uint256,bytes)\"))`.\r\n\r\nThis means that `safeTransferFrom` should work just fine if `_to` is not a contract.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/383391254/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/383399530",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/908#issuecomment-383399530",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/908",
    "id": 383399530,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MzM5OTUzMA==",
    "user": {
      "login": "bee-irl",
      "id": 30704742,
      "node_id": "MDQ6VXNlcjMwNzA0NzQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/30704742?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bee-irl",
      "html_url": "https://github.com/bee-irl",
      "followers_url": "https://api.github.com/users/bee-irl/followers",
      "following_url": "https://api.github.com/users/bee-irl/following{/other_user}",
      "gists_url": "https://api.github.com/users/bee-irl/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bee-irl/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bee-irl/subscriptions",
      "organizations_url": "https://api.github.com/users/bee-irl/orgs",
      "repos_url": "https://api.github.com/users/bee-irl/repos",
      "events_url": "https://api.github.com/users/bee-irl/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bee-irl/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-22T17:51:09Z",
    "updated_at": "2018-04-22T17:52:10Z",
    "author_association": "NONE",
    "body": "@frangio is it possible for a non-contract address to interact with an ERC721 token? ",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/383399530/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/383403083",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/908#issuecomment-383403083",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/908",
    "id": 383403083,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM4MzQwMzA4Mw==",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-04-22T18:43:27Z",
    "updated_at": "2018-04-22T18:43:27Z",
    "author_association": "MEMBER",
    "body": "Absolutely. A non-contract address can receive and send ERC721 tokens.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/383403083/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
