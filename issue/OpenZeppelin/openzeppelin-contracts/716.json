{
  "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/716",
  "repository_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts",
  "labels_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/716/labels{/name}",
  "comments_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/716/comments",
  "events_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/716/events",
  "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/716",
  "id": 293280006,
  "node_id": "MDU6SXNzdWUyOTMyODAwMDY=",
  "number": 716,
  "title": "SplitPayments not splitting payments correctly",
  "user": {
    "login": "rmujica",
    "id": 187846,
    "node_id": "MDQ6VXNlcjE4Nzg0Ng==",
    "avatar_url": "https://avatars.githubusercontent.com/u/187846?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rmujica",
    "html_url": "https://github.com/rmujica",
    "followers_url": "https://api.github.com/users/rmujica/followers",
    "following_url": "https://api.github.com/users/rmujica/following{/other_user}",
    "gists_url": "https://api.github.com/users/rmujica/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rmujica/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rmujica/subscriptions",
    "organizations_url": "https://api.github.com/users/rmujica/orgs",
    "repos_url": "https://api.github.com/users/rmujica/repos",
    "events_url": "https://api.github.com/users/rmujica/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rmujica/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2018-01-31T19:21:14Z",
  "updated_at": "2018-02-07T16:07:27Z",
  "closed_at": "2018-02-07T02:57:52Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## üéâ Description\r\nWhen running a contract inheriting SplitPayment, some claims being made with the same amount of shares are different by 1.5e15 wei, while other claims being made with the same amount of shares (but smaller than the previous by an order of magnitude) are the same.\r\n<!-- Briefly describe the issue you are experiencing (or the feature you want to see added to OpenZeppelin). Tell us what you were trying to do and what happened instead. **Remember, this is _not_ a place to ask for help debugging code; for that, we welcome you in the [OpenZeppelin Slack Channel](https://slack.openzeppelin.org/).** -->\r\n\r\n- [x] üêõ This is a bug report.\r\n- [ ] üìà This is a feature request.\r\n\r\n<!-- Please check one of the above by placing an x in the box. -->\r\n\r\n## üíª Environment\r\n\r\nNext, we need to know what your environment looks like.\r\n\r\n- Which version of OpenZeppelin are you using? 1.6.0 installed via NPM\r\n- What network are you deploying to? testrpc? Ganache? Ropsten? Ganache, 11 account setup\r\n- How are you deploying your OpenZeppelin-backed contracts? truffle? Remix? Let us know! truffle.\r\n\r\n## üìù Details\r\n\r\nAs told in the description. When instancing the contract, 9 payees are added with the following share structure:\r\npayees 1 and 2: 14 shares\r\npayees 3 through 9: 1 share\r\n\r\nA test is run transfering 1 Ethereum to the contract, then payees 1 through 9 claim in order.\r\n\r\nExpected behaviour: payees 1 and 2 claim 0.4 Ethereum, payees 3 through 9 claim 0.0285714 Ethereum. payees 1 and 2 should claim the same amount, payees 3 through 9 claim the same amount.\r\n\r\nObserved behaviour: payee 1 claims 0.39272 Ethereum, payee 2 claims 0.39422 Ethereum, payees 3 through 9 claim 0.022801 Ethereum. payee 1 and payee 2 claims are different, but payees 3 through 9 effectively claim the same (erroneous) amount.\r\n\r\n## üî¢ Code To Reproduce Issue [ Good To Have ]\r\n\r\nIn order to make it easier to reproduce, I made a test case against the production OpenZeppelin library that is currently failing (basically the same test on the OpenZeppelin repo but with other payee-share structure).\r\n\r\nhttps://gist.github.com/rmujica/71b0e5ce92e9d8e347e3093326b9d838\r\n\r\n<!-- If your code is larger, consider linking us to a repo illustrating your issue. -->\r\n\r\n## üëç Other Information\r\n\r\nDiscussed on slack: https://openzeppelin.slack.com/archives/C4GP7FGM7/p1517423076000499\r\n<!-- List any other information that is relevant to your issue. Error logs, related issues, suggestions on how to fix, Stack Overflow links, forum links, etc. -->\r\n",
  "closed_by": {
    "login": "shrugs",
    "id": 1535001,
    "node_id": "MDQ6VXNlcjE1MzUwMDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1535001?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/shrugs",
    "html_url": "https://github.com/shrugs",
    "followers_url": "https://api.github.com/users/shrugs/followers",
    "following_url": "https://api.github.com/users/shrugs/following{/other_user}",
    "gists_url": "https://api.github.com/users/shrugs/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/shrugs/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/shrugs/subscriptions",
    "organizations_url": "https://api.github.com/users/shrugs/orgs",
    "repos_url": "https://api.github.com/users/shrugs/repos",
    "events_url": "https://api.github.com/users/shrugs/events{/privacy}",
    "received_events_url": "https://api.github.com/users/shrugs/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/716/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/716/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/362041349",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/716#issuecomment-362041349",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/716",
    "id": 362041349,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MjA0MTM0OQ==",
    "user": {
      "login": "rmujica",
      "id": 187846,
      "node_id": "MDQ6VXNlcjE4Nzg0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/187846?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rmujica",
      "html_url": "https://github.com/rmujica",
      "followers_url": "https://api.github.com/users/rmujica/followers",
      "following_url": "https://api.github.com/users/rmujica/following{/other_user}",
      "gists_url": "https://api.github.com/users/rmujica/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rmujica/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rmujica/subscriptions",
      "organizations_url": "https://api.github.com/users/rmujica/orgs",
      "repos_url": "https://api.github.com/users/rmujica/repos",
      "events_url": "https://api.github.com/users/rmujica/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rmujica/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-01-31T19:21:54Z",
    "updated_at": "2018-01-31T19:21:54Z",
    "author_association": "NONE",
    "body": "pinging @Shrugs ",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/362041349/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/363639948",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/716#issuecomment-363639948",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/716",
    "id": 363639948,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzYzOTk0OA==",
    "user": {
      "login": "shrugs",
      "id": 1535001,
      "node_id": "MDQ6VXNlcjE1MzUwMDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1535001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shrugs",
      "html_url": "https://github.com/shrugs",
      "followers_url": "https://api.github.com/users/shrugs/followers",
      "following_url": "https://api.github.com/users/shrugs/following{/other_user}",
      "gists_url": "https://api.github.com/users/shrugs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shrugs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shrugs/subscriptions",
      "organizations_url": "https://api.github.com/users/shrugs/orgs",
      "repos_url": "https://api.github.com/users/shrugs/repos",
      "events_url": "https://api.github.com/users/shrugs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shrugs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-07T02:55:43Z",
    "updated_at": "2018-02-07T02:55:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "Figured it out!\r\n\r\nThe first call to `claim()` requires `72461` gas whereas subsequent calls require `57461` gas. I expect this is probably due to some allocation issue that I don't have the experience to know right away.\r\n\r\nAnyway, the payees are _claiming_ the correct amount, but _spending_ different amounts executing the transaction that claims them. That's why the resulting balances don't add up.\r\n\r\nIf you include the gas price in your calculations, I expect the numbers will add up without the `< 1e16` part.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/363639948/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/363640015",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/716#issuecomment-363640015",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/716",
    "id": 363640015,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzY0MDAxNQ==",
    "user": {
      "login": "shrugs",
      "id": 1535001,
      "node_id": "MDQ6VXNlcjE1MzUwMDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1535001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shrugs",
      "html_url": "https://github.com/shrugs",
      "followers_url": "https://api.github.com/users/shrugs/followers",
      "following_url": "https://api.github.com/users/shrugs/following{/other_user}",
      "gists_url": "https://api.github.com/users/shrugs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shrugs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shrugs/subscriptions",
      "organizations_url": "https://api.github.com/users/shrugs/orgs",
      "repos_url": "https://api.github.com/users/shrugs/repos",
      "events_url": "https://api.github.com/users/shrugs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shrugs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-07T02:56:10Z",
    "updated_at": "2018-02-07T02:56:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "Also, best practices, try to use the bignumber math function when working with wei and whatnot; you never know where you're accidentally rounding something",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/363640015/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/363640285",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/716#issuecomment-363640285",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/716",
    "id": 363640285,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzY0MDI4NQ==",
    "user": {
      "login": "shrugs",
      "id": 1535001,
      "node_id": "MDQ6VXNlcjE1MzUwMDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1535001?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shrugs",
      "html_url": "https://github.com/shrugs",
      "followers_url": "https://api.github.com/users/shrugs/followers",
      "following_url": "https://api.github.com/users/shrugs/following{/other_user}",
      "gists_url": "https://api.github.com/users/shrugs/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shrugs/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shrugs/subscriptions",
      "organizations_url": "https://api.github.com/users/shrugs/orgs",
      "repos_url": "https://api.github.com/users/shrugs/repos",
      "events_url": "https://api.github.com/users/shrugs/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shrugs/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-07T02:57:52Z",
    "updated_at": "2018-02-07T02:57:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "And there's still 3 wei left over in the account because of rounding against `1/35`. if you take `.028571429` times `7` you get `.200000003`, hence the leftover amount.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/363640285/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/363818490",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/716#issuecomment-363818490",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/716",
    "id": 363818490,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM2MzgxODQ5MA==",
    "user": {
      "login": "rmujica",
      "id": 187846,
      "node_id": "MDQ6VXNlcjE4Nzg0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/187846?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rmujica",
      "html_url": "https://github.com/rmujica",
      "followers_url": "https://api.github.com/users/rmujica/followers",
      "following_url": "https://api.github.com/users/rmujica/following{/other_user}",
      "gists_url": "https://api.github.com/users/rmujica/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rmujica/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rmujica/subscriptions",
      "organizations_url": "https://api.github.com/users/rmujica/orgs",
      "repos_url": "https://api.github.com/users/rmujica/repos",
      "events_url": "https://api.github.com/users/rmujica/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rmujica/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-02-07T16:06:45Z",
    "updated_at": "2018-02-07T16:06:45Z",
    "author_association": "NONE",
    "body": "perfect, thanks a lot.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/363818490/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
