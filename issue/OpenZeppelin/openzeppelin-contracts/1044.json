{
  "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1044",
  "repository_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts",
  "labels_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1044/labels{/name}",
  "comments_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1044/comments",
  "events_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1044/events",
  "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/1044",
  "id": 335200386,
  "node_id": "MDU6SXNzdWUzMzUyMDAzODY=",
  "number": 1044,
  "title": "ERC827: abuse of CUSTOM_CALL will cause unexpected result",
  "user": {
    "login": "p0n1",
    "id": 36690236,
    "node_id": "MDQ6VXNlcjM2NjkwMjM2",
    "avatar_url": "https://avatars.githubusercontent.com/u/36690236?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/p0n1",
    "html_url": "https://github.com/p0n1",
    "followers_url": "https://api.github.com/users/p0n1/followers",
    "following_url": "https://api.github.com/users/p0n1/following{/other_user}",
    "gists_url": "https://api.github.com/users/p0n1/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/p0n1/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/p0n1/subscriptions",
    "organizations_url": "https://api.github.com/users/p0n1/orgs",
    "repos_url": "https://api.github.com/users/p0n1/repos",
    "events_url": "https://api.github.com/users/p0n1/events{/privacy}",
    "received_events_url": "https://api.github.com/users/p0n1/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2018-06-24T18:18:45Z",
  "updated_at": "2018-07-21T10:16:10Z",
  "closed_at": "2018-06-28T16:32:07Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## üéâ Description\r\n\r\nDangerous ERC827 implementation about `anythingAndCall`.\r\n\r\nhttps://github.com/OpenZeppelin/openzeppelin-solidity/blob/f18c3bc438b366f9cb3a8613f5be160c2cbced5e/contracts/token/ERC827/ERC827Token.sol#L46\r\n\r\nUsers are allowed to pass arbitrary data, leading to call any function with any data on any contract address.\r\n\r\n- [x] üêõ This is a bug report.\r\n- [ ] üìà This is a feature request.\r\n\r\n## üíª Environment\r\n\r\nAny contract using this ERC827 implementation or with similar CUSTOM_CALL feature will be affected.\r\n\r\n## üìù Details\r\n\r\nIt is a really bad practice to allow the abuse of CUSTOM_CALL in token standard.\r\n\r\n```js\r\n<address>.call.value(msg.value)(_data)\r\n```\r\n\r\nAttackers could call any contract **in the name of vulnerable contract** with CUSTOM_CALL.\r\n\r\nThis vulnerability will make these attacking scenarios possible:\r\n\r\n- Attackers could steal almost each kind of tokens belong to the vulnerable contract [[1]] [[2]]\r\n\r\n- Attackers could steal almost each kind of tokens `approved` to the vulnerable contract\r\n\r\n- Attackers could bypass the auth check in vulnerable contract by proxy of contract itself in special situation [[3]] (**edit**: current openzeppelin implementation is not affected with the help of `require(_to != address(this));`)\r\n\r\n- Attackers could pass fake values as parameter to cheat with receiver contract [[4]]\r\n\r\n\r\nWe ([SECBIT](https://secbit.io)) think that the ERC827 proposal should be discussed further in community **before OpenZeppelin putting the implementation in the repo.** Many developers could use this code without knowledge of hidden danger.\r\n\r\n[1]: https://etherscan.io/tx/0xb72dcc4d04381ccad416b960e95183e94ee13e942743da913cf139c8abe212e7\r\n[2]: https://etherscan.io/tx/0x40a292d74bddaac2690385aee0c366edf31904ef681b547b1baa3190ba568888\r\n[3]: https://medium.com/@atnio/erc223-smart-contract-breach-and-resolution-vulnerability-relating-to-the-concurrent-9a402495f382\r\n[4]: https://github.com/ethereum/EIPs/issues/827#issuecomment-397857455\r\n\r\n\\[1\\] attack 1, https://etherscan.io/tx/0xb72dcc4d04381ccad416b960e95183e94ee13e942743da913cf139c8abe212e7\r\n\r\n\\[2\\] attack 2, https://etherscan.io/tx/0x40a292d74bddaac2690385aee0c366edf31904ef681b547b1baa3190ba568888\r\n\r\n\\[3\\] custom_call related bug, https://medium.com/@atnio/erc223-smart-contract-breach-and-resolution-vulnerability-relating-to-the-concurrent-9a402495f382\r\n\r\n\\[4\\] pass fake values to receiver contract, https://github.com/ethereum/EIPs/issues/827#issuecomment-397857455",
  "closed_by": {
    "login": "frangio",
    "id": 481465,
    "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/frangio",
    "html_url": "https://github.com/frangio",
    "followers_url": "https://api.github.com/users/frangio/followers",
    "following_url": "https://api.github.com/users/frangio/following{/other_user}",
    "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
    "organizations_url": "https://api.github.com/users/frangio/orgs",
    "repos_url": "https://api.github.com/users/frangio/repos",
    "events_url": "https://api.github.com/users/frangio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/frangio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1044/reactions",
    "total_count": 5,
    "+1": 5,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1044/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/399789610",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/1044#issuecomment-399789610",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1044",
    "id": 399789610,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTc4OTYxMA==",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-24T21:40:17Z",
    "updated_at": "2018-06-24T21:40:17Z",
    "author_association": "MEMBER",
    "body": "Thank you for the analysis @p0n1. I agree with your assessment. We will remove this token.\r\n\r\nUnfortunately at the time this was merged we didn't have a clear policy on how to treat early ERC drafts. Since then, we have blocked a couple of ERC implementations that were way too early in the process to have received meaningful feedback, and created a `proposals` directory to put draft ERCs that may still be unstable.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/399789610/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/399991656",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/1044#issuecomment-399991656",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1044",
    "id": 399991656,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTk5MTY1Ng==",
    "user": {
      "login": "p0n1",
      "id": 36690236,
      "node_id": "MDQ6VXNlcjM2NjkwMjM2",
      "avatar_url": "https://avatars.githubusercontent.com/u/36690236?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/p0n1",
      "html_url": "https://github.com/p0n1",
      "followers_url": "https://api.github.com/users/p0n1/followers",
      "following_url": "https://api.github.com/users/p0n1/following{/other_user}",
      "gists_url": "https://api.github.com/users/p0n1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/p0n1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/p0n1/subscriptions",
      "organizations_url": "https://api.github.com/users/p0n1/orgs",
      "repos_url": "https://api.github.com/users/p0n1/repos",
      "events_url": "https://api.github.com/users/p0n1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/p0n1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-25T15:25:09Z",
    "updated_at": "2018-06-25T15:25:09Z",
    "author_association": "NONE",
    "body": "Yes!\r\n\r\nAdd ERC draft implementation to `proposals` directory and tell people that it is just **a unstable draft with issue discussion link provided** is a good choice!",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/399991656/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/400040382",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/1044#issuecomment-400040382",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1044",
    "id": 400040382,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMDA0MDM4Mg==",
    "user": {
      "login": "AugustoL",
      "id": 7763867,
      "node_id": "MDQ6VXNlcjc3NjM4Njc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7763867?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AugustoL",
      "html_url": "https://github.com/AugustoL",
      "followers_url": "https://api.github.com/users/AugustoL/followers",
      "following_url": "https://api.github.com/users/AugustoL/following{/other_user}",
      "gists_url": "https://api.github.com/users/AugustoL/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AugustoL/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AugustoL/subscriptions",
      "organizations_url": "https://api.github.com/users/AugustoL/orgs",
      "repos_url": "https://api.github.com/users/AugustoL/repos",
      "events_url": "https://api.github.com/users/AugustoL/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AugustoL/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-25T17:57:15Z",
    "updated_at": "2018-06-25T17:57:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "@p0n1 @frangio I agree on moving the ERC827 implementation to proposals folder and continue working on this issues there, I would love to find a way to fix this issues here or on the ERC827 eip issue.\r\nIm going to propose a public call for developers that are interested in collaborating on the standard to improve de decision making process.\r\nI think there is a need for tokens be able to execute more calls rather than just transfer value and that we got a draft good enough to work over it as a community.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/400040382/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/400611904",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/1044#issuecomment-400611904",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1044",
    "id": 400611904,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMDYxMTkwNA==",
    "user": {
      "login": "AugustoL",
      "id": 7763867,
      "node_id": "MDQ6VXNlcjc3NjM4Njc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7763867?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AugustoL",
      "html_url": "https://github.com/AugustoL",
      "followers_url": "https://api.github.com/users/AugustoL/followers",
      "following_url": "https://api.github.com/users/AugustoL/following{/other_user}",
      "gists_url": "https://api.github.com/users/AugustoL/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AugustoL/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AugustoL/subscriptions",
      "organizations_url": "https://api.github.com/users/AugustoL/orgs",
      "repos_url": "https://api.github.com/users/AugustoL/repos",
      "events_url": "https://api.github.com/users/AugustoL/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AugustoL/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-27T09:48:10Z",
    "updated_at": "2018-06-27T09:48:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "I created a gitter channel to discuss about ERC827 standard, implementations and governance of the standard. \r\n\r\nhttps://gitter.im/ERC827/Lobby\r\n\r\nI also created a public calendar on google calendar for ERC827 community calls, maybe to happen once every two weeks, where anyone in the community can join. The first call will be 5 of june at 5pm GMT +2.\r\n\r\nLink to the call: https://calendar.google.com/event?action=TEMPLATE&tmeid=NjU5a2VnZmxsaTBycXVxdXQzYmJkcGpzZDkgbjg3bDdvcXVmMTQybmY4MGxlMGtoM3J2cThAZw&tmsrc=n87l7oquf142nf80le0kh3rvq8%40group.calendar.google.com\r\n\r\nLink to the ERC827 calendar: https://calendar.google.com/calendar?cid=bjg3bDdvcXVmMTQybmY4MGxlMGtoM3J2cThAZ3JvdXAuY2FsZW5kYXIuZ29vZ2xlLmNvbQ",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/400611904/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/403029919",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/1044#issuecomment-403029919",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1044",
    "id": 403029919,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMzAyOTkxOQ==",
    "user": {
      "login": "jpitts",
      "id": 509756,
      "node_id": "MDQ6VXNlcjUwOTc1Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/509756?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jpitts",
      "html_url": "https://github.com/jpitts",
      "followers_url": "https://api.github.com/users/jpitts/followers",
      "following_url": "https://api.github.com/users/jpitts/following{/other_user}",
      "gists_url": "https://api.github.com/users/jpitts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jpitts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jpitts/subscriptions",
      "organizations_url": "https://api.github.com/users/jpitts/orgs",
      "repos_url": "https://api.github.com/users/jpitts/repos",
      "events_url": "https://api.github.com/users/jpitts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jpitts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-06T13:11:45Z",
    "updated_at": "2018-07-06T13:11:45Z",
    "author_association": "NONE",
    "body": "FYI, I have posted to the Magicians Forum in order to get more visibility on this issue by the contract security working group. \r\n\r\nhttps://ethereum-magicians.org/t/erc-827-callbacks-transferandcall-et-al-can-lead-to-reentrancy-attack-vectors/660",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/403029919/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/406785777",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/1044#issuecomment-406785777",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1044",
    "id": 406785777,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwNjc4NTc3Nw==",
    "user": {
      "login": "vittominacori",
      "id": 8151143,
      "node_id": "MDQ6VXNlcjgxNTExNDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8151143?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vittominacori",
      "html_url": "https://github.com/vittominacori",
      "followers_url": "https://api.github.com/users/vittominacori/followers",
      "following_url": "https://api.github.com/users/vittominacori/following{/other_user}",
      "gists_url": "https://api.github.com/users/vittominacori/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vittominacori/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vittominacori/subscriptions",
      "organizations_url": "https://api.github.com/users/vittominacori/orgs",
      "repos_url": "https://api.github.com/users/vittominacori/repos",
      "events_url": "https://api.github.com/users/vittominacori/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vittominacori/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-21T10:16:10Z",
    "updated_at": "2018-07-21T10:16:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "And msg.sender of the called function is the contract itself.\r\nSo we are calling other contracts as per the ERC827 contract.\r\n\r\nWhy it was in openzeppelin official release? ü§¶‚Äç‚ôÇÔ∏è",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/406785777/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
