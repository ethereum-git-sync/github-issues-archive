{
  "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1727",
  "repository_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts",
  "labels_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1727/labels{/name}",
  "comments_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1727/comments",
  "events_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1727/events",
  "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/1727",
  "id": 436728451,
  "node_id": "MDU6SXNzdWU0MzY3Mjg0NTE=",
  "number": 1727,
  "title": "Improve revert reason when assuming interface compliance",
  "user": {
    "login": "nventuro",
    "id": 2530770,
    "node_id": "MDQ6VXNlcjI1MzA3NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2530770?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nventuro",
    "html_url": "https://github.com/nventuro",
    "followers_url": "https://api.github.com/users/nventuro/followers",
    "following_url": "https://api.github.com/users/nventuro/following{/other_user}",
    "gists_url": "https://api.github.com/users/nventuro/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nventuro/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nventuro/subscriptions",
    "organizations_url": "https://api.github.com/users/nventuro/orgs",
    "repos_url": "https://api.github.com/users/nventuro/repos",
    "events_url": "https://api.github.com/users/nventuro/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nventuro/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 503650966,
      "node_id": "MDU6TGFiZWw1MDM2NTA5NjY=",
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "0e8a16",
      "default": true,
      "description": "Low hanging fruit for new contributors to get involved!"
    },
    {
      "id": 1000207718,
      "node_id": "MDU6TGFiZWwxMDAwMjA3NzE4",
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/labels/contracts",
      "name": "contracts",
      "color": "1d76db",
      "default": false,
      "description": "Smart contract code."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2019-04-24T14:23:48Z",
  "updated_at": "2020-01-23T19:33:10Z",
  "closed_at": "2020-01-23T19:33:10Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "As discussed in [this review comment](https://github.com/OpenZeppelin/openzeppelin-solidity/pull/1704#discussion_r277462537), it'd be interesting to wrap calls to unknown contracts for which an interface is assumed in a low-level call that returns a custom revert reason on error, to better describe what went wrong.",
  "closed_by": {
    "login": "nventuro",
    "id": 2530770,
    "node_id": "MDQ6VXNlcjI1MzA3NzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2530770?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nventuro",
    "html_url": "https://github.com/nventuro",
    "followers_url": "https://api.github.com/users/nventuro/followers",
    "following_url": "https://api.github.com/users/nventuro/following{/other_user}",
    "gists_url": "https://api.github.com/users/nventuro/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nventuro/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nventuro/subscriptions",
    "organizations_url": "https://api.github.com/users/nventuro/orgs",
    "repos_url": "https://api.github.com/users/nventuro/repos",
    "events_url": "https://api.github.com/users/nventuro/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nventuro/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1727/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1727/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/486732929",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/1727#issuecomment-486732929",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1727",
    "id": 486732929,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4NjczMjkyOQ==",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-25T15:56:52Z",
    "updated_at": "2019-04-25T15:56:52Z",
    "author_association": "MEMBER",
    "body": "A concrete example where whoever works on this should begin is this line in `ERC721`:\r\n\r\nhttps://github.com/OpenZeppelin/openzeppelin-solidity/blob/af55a843e3e2d9c941712788a3e0318988f2bd06/contracts/token/ERC721/ERC721.sol#L284\r\n\r\nThis line can revert if the receiver doesn't implement the `onERC721Received` function. It can also revert if it does implement it but something in the implementation like a `require` causes a revert.\r\n\r\nThis issue is about ensuring there is a nice error message in those cases.\r\n\r\nThe way in we can achieve it is by performing a low-level `call` which allows us to revert with a custom revert reason.\r\n```solidity\r\n(bool success, bytes returndata) = to.call( ... );\r\nif (!success) {\r\n    // revert with custom reason (or use `returndata` if non-empty)\r\n} else ...\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/486732929/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/487946910",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/1727#issuecomment-487946910",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1727",
    "id": 487946910,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4Nzk0NjkxMA==",
    "user": {
      "login": "balajipachai",
      "id": 32358081,
      "node_id": "MDQ6VXNlcjMyMzU4MDgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/32358081?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/balajipachai",
      "html_url": "https://github.com/balajipachai",
      "followers_url": "https://api.github.com/users/balajipachai/followers",
      "following_url": "https://api.github.com/users/balajipachai/following{/other_user}",
      "gists_url": "https://api.github.com/users/balajipachai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/balajipachai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/balajipachai/subscriptions",
      "organizations_url": "https://api.github.com/users/balajipachai/orgs",
      "repos_url": "https://api.github.com/users/balajipachai/repos",
      "events_url": "https://api.github.com/users/balajipachai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/balajipachai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-30T13:13:47Z",
    "updated_at": "2019-04-30T13:13:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "@nventuro I have started to look into it ",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/487946910/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/491477561",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/1727#issuecomment-491477561",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1727",
    "id": 491477561,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5MTQ3NzU2MQ==",
    "user": {
      "login": "balajipachai",
      "id": 32358081,
      "node_id": "MDQ6VXNlcjMyMzU4MDgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/32358081?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/balajipachai",
      "html_url": "https://github.com/balajipachai",
      "followers_url": "https://api.github.com/users/balajipachai/followers",
      "following_url": "https://api.github.com/users/balajipachai/following{/other_user}",
      "gists_url": "https://api.github.com/users/balajipachai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/balajipachai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/balajipachai/subscriptions",
      "organizations_url": "https://api.github.com/users/balajipachai/orgs",
      "repos_url": "https://api.github.com/users/balajipachai/repos",
      "events_url": "https://api.github.com/users/balajipachai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/balajipachai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-11T04:08:22Z",
    "updated_at": "2019-05-11T04:08:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @nventuro @frangio,\r\nI have added below piece of code in ERC721.sol:\r\n```\r\nbytes memory payload = abi.encodeWithSignature(\r\n          \"onERC721Received(address,address,uint256,bytes)\",\r\n          msg.sender,\r\n          from,\r\n          tokenId,\r\n          _data\r\n        );\r\n\r\n(bool success, bytes memory returndata) = to.call(payload);\r\n\r\nif (!success) {\r\n    revert(\"ERC721: to address does not implement ERC721Received interface\");\r\n} else {\r\n          return true;\r\n   }\r\n```\r\n\r\nWhile running the test cases it fails: \r\n![Issue1727](https://user-images.githubusercontent.com/32358081/57564823-6d8f2400-73d0-11e9-91db-b283bf8b0c29.png)\r\n\r\nAny help on this will be much appreciated.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/491477561/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/539846330",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/1727#issuecomment-539846330",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1727",
    "id": 539846330,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUzOTg0NjMzMA==",
    "user": {
      "login": "NoopurShinde",
      "id": 54314296,
      "node_id": "MDQ6VXNlcjU0MzE0Mjk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/54314296?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NoopurShinde",
      "html_url": "https://github.com/NoopurShinde",
      "followers_url": "https://api.github.com/users/NoopurShinde/followers",
      "following_url": "https://api.github.com/users/NoopurShinde/following{/other_user}",
      "gists_url": "https://api.github.com/users/NoopurShinde/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NoopurShinde/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NoopurShinde/subscriptions",
      "organizations_url": "https://api.github.com/users/NoopurShinde/orgs",
      "repos_url": "https://api.github.com/users/NoopurShinde/repos",
      "events_url": "https://api.github.com/users/NoopurShinde/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NoopurShinde/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-09T05:57:28Z",
    "updated_at": "2019-10-09T05:57:28Z",
    "author_association": "NONE",
    "body": "Hi Team,\r\n\r\nI went through the specified issue. I have added the following code in ERC721.sol.\r\n\r\n    bytes memory payload = abi.encodeWithSignature(\r\n            \"onERC721Received(address,address,uint256,bytes)\",\r\n            msg.sender,\r\n            from,\r\n            tokenId,\r\n            _data\r\n            );\r\n\r\n            (bool success, ) = to.call(payload);\r\n\r\n            if (!success) {\r\n                revert(\"ERC721: to address does not implement ERC721Received interface\");\r\n            } else {\r\n                    return true;\r\n            }\r\n\r\nI have created a dummy contract which does not implement the IERC721Receiver interface and have updated test cases for the same in ERC721.behavior.js\r\n\r\nPlease do let me know if this is the correct approach used or do I need to think of some other way to solve the issue.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/539846330/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/540183981",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/1727#issuecomment-540183981",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1727",
    "id": 540183981,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MDE4Mzk4MQ==",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-09T20:39:44Z",
    "updated_at": "2019-10-09T20:39:44Z",
    "author_association": "MEMBER",
    "body": "That's pretty good @NoopurShinde!\r\n\r\nIt's also a possibility that the recipient does implement `ERC721Received` and has reverted to reject the transaction. In that case, we should bubble the revert reason up. We can account for this case by checking in the case of `success == false` whether the length of the returndata is greater than zero, and if so, bubbling that instead up of reverting with our own revert reason.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/540183981/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/540419790",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/1727#issuecomment-540419790",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1727",
    "id": 540419790,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU0MDQxOTc5MA==",
    "user": {
      "login": "NoopurShinde",
      "id": 54314296,
      "node_id": "MDQ6VXNlcjU0MzE0Mjk2",
      "avatar_url": "https://avatars.githubusercontent.com/u/54314296?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NoopurShinde",
      "html_url": "https://github.com/NoopurShinde",
      "followers_url": "https://api.github.com/users/NoopurShinde/followers",
      "following_url": "https://api.github.com/users/NoopurShinde/following{/other_user}",
      "gists_url": "https://api.github.com/users/NoopurShinde/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NoopurShinde/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NoopurShinde/subscriptions",
      "organizations_url": "https://api.github.com/users/NoopurShinde/orgs",
      "repos_url": "https://api.github.com/users/NoopurShinde/repos",
      "events_url": "https://api.github.com/users/NoopurShinde/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NoopurShinde/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-10-10T07:01:09Z",
    "updated_at": "2019-10-10T07:01:09Z",
    "author_association": "NONE",
    "body": "I have updated the code in ERC721.sol and ERC721Behavior.test.js as suggested by @frangio to solve the specified issues.\r\nWhenever I run the test cases for ERC721, all the test cases are passed. But when I try to run the  test suite, test cases result in failure. Is GSN causing the testcases to fail? I tried running test suite using truffle test and npm test. Please do let me know if this scenario is normal or is there something I am missing on.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/540419790/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/562691971",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/1727#issuecomment-562691971",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/1727",
    "id": 562691971,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2MjY5MTk3MQ==",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-06T18:47:02Z",
    "updated_at": "2019-12-06T18:47:02Z",
    "author_association": "MEMBER",
    "body": "Does someone want to pick up https://github.com/OpenZeppelin/openzeppelin-contracts/pull/1943 and continue the work?",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/562691971/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
