{
  "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2999",
  "repository_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts",
  "labels_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2999/labels{/name}",
  "comments_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2999/comments",
  "events_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2999/events",
  "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/2999",
  "id": 1071278720,
  "node_id": "I_kwDOA9tCBs4_2mqA",
  "number": 2999,
  "title": "OpenZeppelin Wizard with `Votes` fails to deploy on Ganache",
  "user": {
    "login": "gnomadic",
    "id": 7825326,
    "node_id": "MDQ6VXNlcjc4MjUzMjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7825326?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gnomadic",
    "html_url": "https://github.com/gnomadic",
    "followers_url": "https://api.github.com/users/gnomadic/followers",
    "following_url": "https://api.github.com/users/gnomadic/following{/other_user}",
    "gists_url": "https://api.github.com/users/gnomadic/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gnomadic/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gnomadic/subscriptions",
    "organizations_url": "https://api.github.com/users/gnomadic/orgs",
    "repos_url": "https://api.github.com/users/gnomadic/repos",
    "events_url": "https://api.github.com/users/gnomadic/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gnomadic/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-12-04T19:28:45Z",
  "updated_at": "2021-12-04T21:36:31Z",
  "closed_at": "2021-12-04T21:36:30Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Trying to deploy an ERC20 with voting on ganache - copy pasted out of the openzeppelin wizard, but using solidity 0.8.10.  Deployment works fine if script doesn't extend `ERC20Permit` and `ERC20Votes`.  \r\n\r\n * This error also occurs when using solidity \"0.8.2, which is what's supplied in the wizard\r\n * This error also occurs with a shorter token name\r\n * This error also occurs with an empty constructor (disabled premint)\r\n\r\n```\r\nError:  *** Deployment Failed ***\r\n\r\n\"MoonDust\" hit an invalid opcode while deploying. Try:\r\n   * Verifying that your constructor params satisfy all assert conditions.\r\n   * Verifying your constructor code doesn't access an array out of bounds.\r\n   * Adding reason strings to your assert statements.\r\n```\r\n\r\n\r\n**üíª Environment**\r\n\r\nWindows 10, linux sub system.\r\n    \"@openzeppelin/contracts\": \"^4.4.0\",\r\n    \"truffle\": \"5.4.23\",\r\n    \"solc\":0.8.10\r\n\r\n\r\n**üìù Details**\r\n\r\nI have to assume the issue is with the constructor of /contracts/utils/cryptography/draft-EIP712.sol - that is the only place I can see where this error is possible?\r\n\r\n\r\n**üî¢ Code to reproduce bug**\r\n\r\n```\r\n// SPDX-License-Identifier: MIT\r\npragma solidity 0.8.10;\r\n\r\nimport \"@openzeppelin/contracts/token/ERC20/ERC20.sol\";\r\nimport \"@openzeppelin/contracts/access/Ownable.sol\";\r\nimport \"@openzeppelin/contracts/token/ERC20/extensions/draft-ERC20Permit.sol\";\r\nimport \"@openzeppelin/contracts/token/ERC20/extensions/ERC20Votes.sol\";\r\n\r\ncontract MoonDust is ERC20, Ownable, ERC20Permit, ERC20Votes {\r\n    constructor() ERC20(\"MoonDust\", \"DUST\") ERC20Permit(\"MoonDust\") {\r\n        _mint(msg.sender, 200000000 * 10 ** decimals());\r\n    }\r\n\r\n    function mint(address to, uint256 amount) public onlyOwner {\r\n        _mint(to, amount);\r\n    }\r\n\r\n    // The following functions are overrides required by Solidity.\r\n\r\n    function _afterTokenTransfer(address from, address to, uint256 amount)\r\n        internal\r\n        override(ERC20, ERC20Votes)\r\n    {\r\n        super._afterTokenTransfer(from, to, amount);\r\n    }\r\n\r\n    function _mint(address to, uint256 amount)\r\n        internal\r\n        override(ERC20, ERC20Votes)\r\n    {\r\n        super._mint(to, amount);\r\n    }\r\n\r\n    function _burn(address account, uint256 amount)\r\n        internal\r\n        override(ERC20, ERC20Votes)\r\n    {\r\n        super._burn(account, amount);\r\n    }\r\n}\r\n```",
  "closed_by": {
    "login": "gnomadic",
    "id": 7825326,
    "node_id": "MDQ6VXNlcjc4MjUzMjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7825326?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gnomadic",
    "html_url": "https://github.com/gnomadic",
    "followers_url": "https://api.github.com/users/gnomadic/followers",
    "following_url": "https://api.github.com/users/gnomadic/following{/other_user}",
    "gists_url": "https://api.github.com/users/gnomadic/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gnomadic/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gnomadic/subscriptions",
    "organizations_url": "https://api.github.com/users/gnomadic/orgs",
    "repos_url": "https://api.github.com/users/gnomadic/repos",
    "events_url": "https://api.github.com/users/gnomadic/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gnomadic/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2999/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2999/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/986088702",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/2999#issuecomment-986088702",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2999",
    "id": 986088702,
    "node_id": "IC_kwDOA9tCBs46xoT-",
    "user": {
      "login": "Amxx",
      "id": 2432299,
      "node_id": "MDQ6VXNlcjI0MzIyOTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2432299?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Amxx",
      "html_url": "https://github.com/Amxx",
      "followers_url": "https://api.github.com/users/Amxx/followers",
      "following_url": "https://api.github.com/users/Amxx/following{/other_user}",
      "gists_url": "https://api.github.com/users/Amxx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Amxx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Amxx/subscriptions",
      "organizations_url": "https://api.github.com/users/Amxx/orgs",
      "repos_url": "https://api.github.com/users/Amxx/repos",
      "events_url": "https://api.github.com/users/Amxx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Amxx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-04T20:32:22Z",
    "updated_at": "2021-12-04T20:32:22Z",
    "author_association": "COLLABORATOR",
    "body": "Hello @gnomadic \r\n\r\nI'm able to deploy the code you provide, without any modification whatsoever, on remix. \r\n\r\nWhat version of ganache are you using? \r\n```Ganache CLI v6.12.2 (ganache-core: 2.13.2)```\r\n\r\nIs it configured to use an older version of the EVM?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/986088702/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/986089126",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/2999#issuecomment-986089126",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2999",
    "id": 986089126,
    "node_id": "IC_kwDOA9tCBs46xoam",
    "user": {
      "login": "Amxx",
      "id": 2432299,
      "node_id": "MDQ6VXNlcjI0MzIyOTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2432299?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Amxx",
      "html_url": "https://github.com/Amxx",
      "followers_url": "https://api.github.com/users/Amxx/followers",
      "following_url": "https://api.github.com/users/Amxx/following{/other_user}",
      "gists_url": "https://api.github.com/users/Amxx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Amxx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Amxx/subscriptions",
      "organizations_url": "https://api.github.com/users/Amxx/orgs",
      "repos_url": "https://api.github.com/users/Amxx/repos",
      "events_url": "https://api.github.com/users/Amxx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Amxx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-04T20:35:56Z",
    "updated_at": "2021-12-04T20:35:56Z",
    "author_association": "COLLABORATOR",
    "body": "Not that `ERC20Votes` depends on `ERC20Permit` which depends on `EIP712` which computes the domain separator during construction.\r\n\r\nThis domain separator depends on the chainId oppcode which was introduced by EIP1344. This EIP was part of the Istanbul hard fork that hit mainnet in December 2019.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/986089126/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/986096516",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/2999#issuecomment-986096516",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2999",
    "id": 986096516,
    "node_id": "IC_kwDOA9tCBs46xqOE",
    "user": {
      "login": "gnomadic",
      "id": 7825326,
      "node_id": "MDQ6VXNlcjc4MjUzMjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7825326?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gnomadic",
      "html_url": "https://github.com/gnomadic",
      "followers_url": "https://api.github.com/users/gnomadic/followers",
      "following_url": "https://api.github.com/users/gnomadic/following{/other_user}",
      "gists_url": "https://api.github.com/users/gnomadic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gnomadic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gnomadic/subscriptions",
      "organizations_url": "https://api.github.com/users/gnomadic/orgs",
      "repos_url": "https://api.github.com/users/gnomadic/repos",
      "events_url": "https://api.github.com/users/gnomadic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gnomadic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-04T21:36:30Z",
    "updated_at": "2021-12-04T21:36:30Z",
    "author_association": "NONE",
    "body": "Wow, thank you.  I'm using the Ganache UI, and it was set to the Petersburg hard fork.  I changed that to Istanbul, and now it works.  üíØ I appreciate your time, sorry for the rookie mistake!",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/986096516/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
