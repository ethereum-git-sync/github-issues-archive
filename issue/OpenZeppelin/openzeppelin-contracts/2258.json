{
  "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2258",
  "repository_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts",
  "labels_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2258/labels{/name}",
  "comments_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2258/comments",
  "events_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2258/events",
  "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/2258",
  "id": 628617479,
  "node_id": "MDU6SXNzdWU2Mjg2MTc0Nzk=",
  "number": 2258,
  "title": "GSNv2 support",
  "user": {
    "login": "spalladino",
    "id": 429604,
    "node_id": "MDQ6VXNlcjQyOTYwNA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/429604?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/spalladino",
    "html_url": "https://github.com/spalladino",
    "followers_url": "https://api.github.com/users/spalladino/followers",
    "following_url": "https://api.github.com/users/spalladino/following{/other_user}",
    "gists_url": "https://api.github.com/users/spalladino/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/spalladino/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/spalladino/subscriptions",
    "organizations_url": "https://api.github.com/users/spalladino/orgs",
    "repos_url": "https://api.github.com/users/spalladino/repos",
    "events_url": "https://api.github.com/users/spalladino/events{/privacy}",
    "received_events_url": "https://api.github.com/users/spalladino/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-06-01T17:49:49Z",
  "updated_at": "2021-02-19T18:36:48Z",
  "closed_at": "2021-02-19T18:36:48Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**üßê Motivation**\r\n[GSNv2](https://docs.opengsn.org/learn/index.html) is under development by the OpenGSN team, and it's very similar to GSNv1 regarding recipient contract implementation. We could add support for both v2 and v1 with some minor changes.\r\n\r\n**üìù Details**\r\nGSNv2 moves the responsibility of deciding whether to pay for a meta-tx (ie `acceptRelayedCall`, along with `pre/post`) out of the Recipient into a [Paymaster contract](https://docs.opengsn.org/contracts/index.html#paymaster). The Recipient now only needs to implement the base `_msgSender` and `_msgData` helpers, which should use the injected address at the end of the CALLDATA (instead of msg.sender) if the call [comes from a **TrustedForwarder**](https://docs.opengsn.org/contracts/index.html#trusted_forwarder).\r\n\r\nThe TrustedForwarder has the responsibilities of validating the user signature, managing its nonce, appending the signer address to the CALLDATA, and forwarding the call. As with the RelayHub in GSNv1, the Recipient should assume they are receiving a meta-tx if it's sent by the TrustedForwarder. And as with the RelayHub, the TrustedForwarder can be a singleton, since it has no app-specific logic.\r\n\r\nThis approach is described in detail in [this ERC to be published](https://docs.google.com/document/d/1EnLof0KCtdnrqp07MN6m3TQWDKVrjYMKttL9yNW2pY4/edit?usp=sharing). Note that `getHubAddr` was changed to [`isTrustedForwarder`](https://github.com/opengsn/gsn/blob/master/contracts/interfaces/IRelayRecipient.sol#L15) in the Recipient internal interface.\r\n\r\nTo sum up, we need to:\r\n- Refactor the _msgSender and _msgData methods out of [GSNRecipient](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/GSN/GSNRecipient.sol) into a MetaTransactionRecipient (preferrably including the ERC number once published).\r\n- Add a TrustedForwarder implementation to Contracts so devs can easily set up a local meta-tx setup, and optionally include addresses to the singleton deployments.\r\n- Clarify that GSNRecipient is only valid for GSNv1, since the [Paymaster interface](https://github.com/opengsn/gsn/blob/master/contracts/interfaces/IPaymaster.sol) has changed in v2.",
  "closed_by": {
    "login": "frangio",
    "id": 481465,
    "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/frangio",
    "html_url": "https://github.com/frangio",
    "followers_url": "https://api.github.com/users/frangio/followers",
    "following_url": "https://api.github.com/users/frangio/following{/other_user}",
    "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
    "organizations_url": "https://api.github.com/users/frangio/orgs",
    "repos_url": "https://api.github.com/users/frangio/repos",
    "events_url": "https://api.github.com/users/frangio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/frangio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2258/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2258/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/637075841",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/2258#issuecomment-637075841",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2258",
    "id": 637075841,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNzA3NTg0MQ==",
    "user": {
      "login": "nventuro",
      "id": 2530770,
      "node_id": "MDQ6VXNlcjI1MzA3NzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2530770?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nventuro",
      "html_url": "https://github.com/nventuro",
      "followers_url": "https://api.github.com/users/nventuro/followers",
      "following_url": "https://api.github.com/users/nventuro/following{/other_user}",
      "gists_url": "https://api.github.com/users/nventuro/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nventuro/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nventuro/subscriptions",
      "organizations_url": "https://api.github.com/users/nventuro/orgs",
      "repos_url": "https://api.github.com/users/nventuro/repos",
      "events_url": "https://api.github.com/users/nventuro/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nventuro/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-01T20:09:02Z",
    "updated_at": "2020-06-01T20:09:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "Great, thanks for the summary! It looks like we'll be able to leave our `Context` contract untouched, and therefore not modify any non-GSN code. The 'issue' introduced by diamond inheritance that requires doing a manual override of ``Context``'s methods will remain though.\r\n\r\nWe may also want to update our docs to guide users to the OpenGSN docs, removing the references we have (which are anyway replicated there).",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/637075841/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/705183888",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/2258#issuecomment-705183888",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2258",
    "id": 705183888,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTE4Mzg4OA==",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-07T20:45:16Z",
    "updated_at": "2020-10-07T20:45:16Z",
    "author_association": "MEMBER",
    "body": "@naszam For testing please open an issue in [OpenZeppelin/openzeppelin-test-environment](https://github.com/OpenZeppelin/openzeppelin-test-environment).",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/705183888/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/706433644",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/2258#issuecomment-706433644",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2258",
    "id": 706433644,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNjQzMzY0NA==",
    "user": {
      "login": "naszam",
      "id": 23325228,
      "node_id": "MDQ6VXNlcjIzMzI1MjI4",
      "avatar_url": "https://avatars.githubusercontent.com/u/23325228?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/naszam",
      "html_url": "https://github.com/naszam",
      "followers_url": "https://api.github.com/users/naszam/followers",
      "following_url": "https://api.github.com/users/naszam/following{/other_user}",
      "gists_url": "https://api.github.com/users/naszam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/naszam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/naszam/subscriptions",
      "organizations_url": "https://api.github.com/users/naszam/orgs",
      "repos_url": "https://api.github.com/users/naszam/repos",
      "events_url": "https://api.github.com/users/naszam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/naszam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-09T22:49:22Z",
    "updated_at": "2020-10-09T22:49:22Z",
    "author_association": "NONE",
    "body": "@frangio Ok, Thanks! I've removed my post",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/706433644/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
