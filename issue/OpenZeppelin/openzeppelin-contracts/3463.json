{
  "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3463",
  "repository_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts",
  "labels_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3463/labels{/name}",
  "comments_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3463/comments",
  "events_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3463/events",
  "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3463",
  "id": 1268212059,
  "node_id": "I_kwDOA9tCBs5Ll2Fb",
  "number": 3463,
  "title": "ERC777.sol: _callTokensToSend should be called after _move, not before, to follow Checks-Effects-Interactions",
  "user": {
    "login": "lukehutch",
    "id": 811305,
    "node_id": "MDQ6VXNlcjgxMTMwNQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/811305?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lukehutch",
    "html_url": "https://github.com/lukehutch",
    "followers_url": "https://api.github.com/users/lukehutch/followers",
    "following_url": "https://api.github.com/users/lukehutch/following{/other_user}",
    "gists_url": "https://api.github.com/users/lukehutch/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lukehutch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lukehutch/subscriptions",
    "organizations_url": "https://api.github.com/users/lukehutch/orgs",
    "repos_url": "https://api.github.com/users/lukehutch/repos",
    "events_url": "https://api.github.com/users/lukehutch/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lukehutch/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-06-11T08:58:30Z",
  "updated_at": "2022-06-15T07:47:45Z",
  "closed_at": "2022-06-15T07:47:45Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "[EIP-777 says](https://eips.ethereum.org/EIPS/eip-777) \"The `tokensToSend` hook MUST be called before the state is updatedâ€”i.e. before the balance is decremented.\"\r\n\r\nHowever, this violates [Checks-Effects-Interactions](https://blog.openzeppelin.com/reentrancy-after-istanbul/), and introduces a very real risk of vulnerability for any contract that implements ERC777.\r\n\r\nIn [this (now-closed) OpenZeppelin kitchen-sink security issue](https://github.com/OpenZeppelin/openzeppelin-contracts/issues/1749), this potential vulnerability is discussed, and it was agreed that probably the ERC777 standard should not be followed in this instance: @frangio says, agreeing with @guylando and @nventuro:\r\n\r\nhttps://github.com/OpenZeppelin/openzeppelin-contracts/issues/1749#issuecomment-491925747\r\n> Yes, I agree, we're gonna have to change our implementation to update allowances before calling `tokensReceived.`\r\n\r\nHowever this was never actually changed in the OpenZeppelin implementation of ERC777:\r\n\r\nhttps://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC777/ERC777.sol#L376\r\nhttps://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC777/ERC777.sol#L400\r\n\r\nThis leaves any contract overriding OpenZeppelin's ERC777 implementation potentially vulnerable to exploitation via sender hook.",
  "closed_by": {
    "login": "lukehutch",
    "id": 811305,
    "node_id": "MDQ6VXNlcjgxMTMwNQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/811305?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lukehutch",
    "html_url": "https://github.com/lukehutch",
    "followers_url": "https://api.github.com/users/lukehutch/followers",
    "following_url": "https://api.github.com/users/lukehutch/following{/other_user}",
    "gists_url": "https://api.github.com/users/lukehutch/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lukehutch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lukehutch/subscriptions",
    "organizations_url": "https://api.github.com/users/lukehutch/orgs",
    "repos_url": "https://api.github.com/users/lukehutch/repos",
    "events_url": "https://api.github.com/users/lukehutch/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lukehutch/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3463/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3463/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1152961606",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3463#issuecomment-1152961606",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3463",
    "id": 1152961606,
    "node_id": "IC_kwDOA9tCBs5EuMxG",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-11T16:41:41Z",
    "updated_at": "2022-06-11T16:41:41Z",
    "author_association": "MEMBER",
    "body": "I'm not sure there is anything we can do about this. The EIP is very clear about the order in which things should be done. And other smart contracts are written with this assumption in mind, e.g.:\r\n\r\nhttps://github.com/OpenZeppelin/openzeppelin-contracts/blob/4135bf970744231a57872586b966385cd286dd88/contracts/token/ERC20/extensions/ERC20TokenizedVault.sol#L175-L180\r\n\r\nHonestly at this point the best option might be #2620.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1152961606/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1152980940",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3463#issuecomment-1152980940",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3463",
    "id": 1152980940,
    "node_id": "IC_kwDOA9tCBs5EuRfM",
    "user": {
      "login": "mpereiraesaa",
      "id": 16945965,
      "node_id": "MDQ6VXNlcjE2OTQ1OTY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/16945965?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mpereiraesaa",
      "html_url": "https://github.com/mpereiraesaa",
      "followers_url": "https://api.github.com/users/mpereiraesaa/followers",
      "following_url": "https://api.github.com/users/mpereiraesaa/following{/other_user}",
      "gists_url": "https://api.github.com/users/mpereiraesaa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mpereiraesaa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mpereiraesaa/subscriptions",
      "organizations_url": "https://api.github.com/users/mpereiraesaa/orgs",
      "repos_url": "https://api.github.com/users/mpereiraesaa/repos",
      "events_url": "https://api.github.com/users/mpereiraesaa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mpereiraesaa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-11T18:52:59Z",
    "updated_at": "2022-06-11T18:55:37Z",
    "author_association": "NONE",
    "body": "Modifying the implementation of an EIP basically breaking some standard is never the way to go even if that way we might fix some bad behavior. In any case it can be avoided or deprecated like suggested by @frangio .\r\n\r\nWe should always write smart contracts understanding the risks of some standards while trying to integrate a token.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1152980940/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1155858809",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3463#issuecomment-1155858809",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3463",
    "id": 1155858809,
    "node_id": "IC_kwDOA9tCBs5E5QF5",
    "user": {
      "login": "yashdeharia",
      "id": 67191325,
      "node_id": "MDQ6VXNlcjY3MTkxMzI1",
      "avatar_url": "https://avatars.githubusercontent.com/u/67191325?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yashdeharia",
      "html_url": "https://github.com/yashdeharia",
      "followers_url": "https://api.github.com/users/yashdeharia/followers",
      "following_url": "https://api.github.com/users/yashdeharia/following{/other_user}",
      "gists_url": "https://api.github.com/users/yashdeharia/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yashdeharia/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yashdeharia/subscriptions",
      "organizations_url": "https://api.github.com/users/yashdeharia/orgs",
      "repos_url": "https://api.github.com/users/yashdeharia/repos",
      "events_url": "https://api.github.com/users/yashdeharia/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yashdeharia/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-15T00:52:58Z",
    "updated_at": "2022-06-15T00:53:12Z",
    "author_association": "NONE",
    "body": "@mpereiraesaa ... you are right",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1155858809/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1156112698",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3463#issuecomment-1156112698",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3463",
    "id": 1156112698,
    "node_id": "IC_kwDOA9tCBs5E6OE6",
    "user": {
      "login": "lukehutch",
      "id": 811305,
      "node_id": "MDQ6VXNlcjgxMTMwNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/811305?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lukehutch",
      "html_url": "https://github.com/lukehutch",
      "followers_url": "https://api.github.com/users/lukehutch/followers",
      "following_url": "https://api.github.com/users/lukehutch/following{/other_user}",
      "gists_url": "https://api.github.com/users/lukehutch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lukehutch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lukehutch/subscriptions",
      "organizations_url": "https://api.github.com/users/lukehutch/orgs",
      "repos_url": "https://api.github.com/users/lukehutch/repos",
      "events_url": "https://api.github.com/users/lukehutch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lukehutch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-15T07:46:09Z",
    "updated_at": "2022-06-15T07:47:07Z",
    "author_association": "NONE",
    "body": "@mpereiraesaa @frangio It looks to me that ERC1363 and ERC4524 are much better (simpler and more robust) standards. Maybe OpenZeppelin should replace the ERC777 implementation with those? I'll close this bug and move the discussion to #2620, thanks.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1156112698/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
