{
  "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4071",
  "repository_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts",
  "labels_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4071/labels{/name}",
  "comments_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4071/comments",
  "events_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4071/events",
  "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/4071",
  "id": 1596717265,
  "node_id": "I_kwDOA9tCBs5fK_jR",
  "number": 4071,
  "title": "check zero weight before execute _castVote",
  "user": {
    "login": "hyunkicho",
    "id": 35443121,
    "node_id": "MDQ6VXNlcjM1NDQzMTIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35443121?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hyunkicho",
    "html_url": "https://github.com/hyunkicho",
    "followers_url": "https://api.github.com/users/hyunkicho/followers",
    "following_url": "https://api.github.com/users/hyunkicho/following{/other_user}",
    "gists_url": "https://api.github.com/users/hyunkicho/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hyunkicho/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hyunkicho/subscriptions",
    "organizations_url": "https://api.github.com/users/hyunkicho/orgs",
    "repos_url": "https://api.github.com/users/hyunkicho/repos",
    "events_url": "https://api.github.com/users/hyunkicho/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hyunkicho/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-02-23T11:50:53Z",
  "updated_at": "2023-02-23T12:19:48Z",
  "closed_at": "2023-02-23T12:19:48Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!-- Briefly describe the issue you're experiencing. Tell us what you were trying to do and what happened instead. -->\r\nI was making dapp tutorial and I tried to make a dao contract using ERC721 vote and governor\r\nAnd when I wrote a test code I found out that if address have NFT after snapshot duartion It can castVote with zero weight but nothing happend.\r\n<!-- Remember, this is not a place to ask for help debugging code. For that, we welcome you in the OpenZeppelin Community Forum: https://forum.openzeppelin.com/. -->\r\n\r\n**üíª Environment**\r\n\r\nthis is the contract that I made (governor + erc721vote)\r\nhttps://github.com/hyunkicho/blockchain101/tree/main/governance/tutorial_hardhat/contracts\r\n\r\n<!-- Tell us what version of OpenZeppelin Contracts you're using, and how you're using it: Truffle, Remix, etc. -->\r\n\r\n**üìù Details**\r\n\r\nthe case I tested was\r\n\r\n1. don't have NFT before snaphot (before propse)\r\n2. have NFT after snapshot\r\n3. Vote with NFT (success cast Vote)\r\n4. but weitght was count as 0\r\n5. so eventhough vote was succed it didn' effect the vote\r\n6. People might confuse if castVote is suceess and didn't effect the result\r\n\r\n<!-- Describe the problem you have been experiencing in more detail. Include as much information as you think is relevant. Keep in mind that transactions can fail for many reasons; context is key here. -->\r\n\r\n**üî¢ Code to reproduce bug**\r\nto prevent this we need  in Governor Sol\r\n```\r\n        require(weight == 0, \"Governor: weight is zero\")\r\n\r\n````\r\n\r\n```\r\n    function _castVote(\r\n        uint256 proposalId,\r\n        address account,\r\n        uint8 support,\r\n        string memory reason,\r\n        bytes memory params\r\n    ) internal virtual returns (uint256) {\r\n        ProposalCore storage proposal = _proposals[proposalId];\r\n        require(state(proposalId) == ProposalState.Active, \"Governor: vote not currently active\");\r\n\r\n        uint256 weight = _getVotes(account, proposal.voteStart, params);\r\n        require(weight == 0, \"Governor: weight is zero\")\r\n        _countVote(proposalId, account, support, weight, params);\r\n\r\n        if (params.length == 0) {\r\n            emit VoteCast(account, proposalId, support, weight, reason);\r\n        } else {\r\n            emit VoteCastWithParams(account, proposalId, support, weight, reason, params);\r\n        }\r\n\r\n        return weight;\r\n    }\r\n\r\n```\r\n<!-- We will be able to better help if you provide a minimal example that triggers the bug. -->\r\n",
  "closed_by": {
    "login": "hyunkicho",
    "id": 35443121,
    "node_id": "MDQ6VXNlcjM1NDQzMTIx",
    "avatar_url": "https://avatars.githubusercontent.com/u/35443121?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hyunkicho",
    "html_url": "https://github.com/hyunkicho",
    "followers_url": "https://api.github.com/users/hyunkicho/followers",
    "following_url": "https://api.github.com/users/hyunkicho/following{/other_user}",
    "gists_url": "https://api.github.com/users/hyunkicho/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hyunkicho/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hyunkicho/subscriptions",
    "organizations_url": "https://api.github.com/users/hyunkicho/orgs",
    "repos_url": "https://api.github.com/users/hyunkicho/repos",
    "events_url": "https://api.github.com/users/hyunkicho/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hyunkicho/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4071/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4071/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1441635411",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/4071#issuecomment-1441635411",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4071",
    "id": 1441635411,
    "node_id": "IC_kwDOA9tCBs5V7ZxT",
    "user": {
      "login": "Amxx",
      "id": 2432299,
      "node_id": "MDQ6VXNlcjI0MzIyOTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2432299?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Amxx",
      "html_url": "https://github.com/Amxx",
      "followers_url": "https://api.github.com/users/Amxx/followers",
      "following_url": "https://api.github.com/users/Amxx/following{/other_user}",
      "gists_url": "https://api.github.com/users/Amxx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Amxx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Amxx/subscriptions",
      "organizations_url": "https://api.github.com/users/Amxx/orgs",
      "repos_url": "https://api.github.com/users/Amxx/repos",
      "events_url": "https://api.github.com/users/Amxx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Amxx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-23T11:57:01Z",
    "updated_at": "2023-02-23T11:57:01Z",
    "author_association": "COLLABORATOR",
    "body": "Hello @hyunkicho \r\n\r\nSimilarly to doing token transfers with `amount = 0`, we believe that voting with weight 0 is a valid no-op.\r\n\r\nWe tend to accept no-ops and not revert to improve contract composition. Reverting could cause issues if this is a subcall. The voting weight is returned so a contract calling this can see the weight was 0 and revert.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1441635411/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1441665514",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/4071#issuecomment-1441665514",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4071",
    "id": 1441665514,
    "node_id": "IC_kwDOA9tCBs5V7hHq",
    "user": {
      "login": "hyunkicho",
      "id": 35443121,
      "node_id": "MDQ6VXNlcjM1NDQzMTIx",
      "avatar_url": "https://avatars.githubusercontent.com/u/35443121?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hyunkicho",
      "html_url": "https://github.com/hyunkicho",
      "followers_url": "https://api.github.com/users/hyunkicho/followers",
      "following_url": "https://api.github.com/users/hyunkicho/following{/other_user}",
      "gists_url": "https://api.github.com/users/hyunkicho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hyunkicho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hyunkicho/subscriptions",
      "organizations_url": "https://api.github.com/users/hyunkicho/orgs",
      "repos_url": "https://api.github.com/users/hyunkicho/repos",
      "events_url": "https://api.github.com/users/hyunkicho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hyunkicho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-23T12:19:40Z",
    "updated_at": "2023-02-23T12:19:40Z",
    "author_association": "NONE",
    "body": "Oh I got it. Thanks for the reply :)",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1441665514/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
