{
  "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4698",
  "repository_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts",
  "labels_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4698/labels{/name}",
  "comments_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4698/comments",
  "events_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4698/events",
  "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/4698",
  "id": 1956019792,
  "node_id": "I_kwDOA9tCBs50ln5Q",
  "number": 4698,
  "title": "ERC2771Forwarder Type Hash Inconsistency",
  "user": {
    "login": "JaredBorders",
    "id": 44350516,
    "node_id": "MDQ6VXNlcjQ0MzUwNTE2",
    "avatar_url": "https://avatars.githubusercontent.com/u/44350516?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/JaredBorders",
    "html_url": "https://github.com/JaredBorders",
    "followers_url": "https://api.github.com/users/JaredBorders/followers",
    "following_url": "https://api.github.com/users/JaredBorders/following{/other_user}",
    "gists_url": "https://api.github.com/users/JaredBorders/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/JaredBorders/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/JaredBorders/subscriptions",
    "organizations_url": "https://api.github.com/users/JaredBorders/orgs",
    "repos_url": "https://api.github.com/users/JaredBorders/repos",
    "events_url": "https://api.github.com/users/JaredBorders/events{/privacy}",
    "received_events_url": "https://api.github.com/users/JaredBorders/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-10-22T19:10:39Z",
  "updated_at": "2023-10-22T20:45:26Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Summary \r\n\r\n`ERC2771Forwarder.ForwardRequestData` struct does not match `_FORWARD_REQUEST_TYPEHASH`\r\n\r\nhttps://github.com/OpenZeppelin/openzeppelin-contracts/blob/149e1b79fecb9db32f732c8c9f05ac2d8fa97471/contracts/metatx/ERC2771Forwarder.sol#L65\r\n\r\n## 💻 Environment\r\n\r\nv5.0.0\r\n\r\n## 📝 Details\r\n\r\nThe struct is defined as:\r\n\r\n```\r\nstruct ForwardRequestData {\r\n        address from;\r\n        address to;\r\n        uint256 value;\r\n        uint256 gas;\r\n        uint48 deadline;\r\n        bytes data;\r\n        bytes signature;\r\n}\r\n```\r\n\r\nand the type hash is defined as:\r\n\r\n```\r\nbytes32 internal constant _FORWARD_REQUEST_TYPEHASH =\r\n    keccak256(\r\n        \"ForwardRequest(address from,address to,uint256 value,uint256 gas,uint256 nonce,uint48 deadline,bytes data)\"\r\n    );\r\n```\r\n\r\nThe type hash parameters should match the fields found in the struct.\r\n\r\n## 🔢 Code to reproduce bug\r\n\r\nN/A\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4698/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4698/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1774194577",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/4698#issuecomment-1774194577",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4698",
    "id": 1774194577,
    "node_id": "IC_kwDOA9tCBs5pwA-R",
    "user": {
      "login": "ernestognw",
      "id": 33379285,
      "node_id": "MDQ6VXNlcjMzMzc5Mjg1",
      "avatar_url": "https://avatars.githubusercontent.com/u/33379285?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ernestognw",
      "html_url": "https://github.com/ernestognw",
      "followers_url": "https://api.github.com/users/ernestognw/followers",
      "following_url": "https://api.github.com/users/ernestognw/following{/other_user}",
      "gists_url": "https://api.github.com/users/ernestognw/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ernestognw/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ernestognw/subscriptions",
      "organizations_url": "https://api.github.com/users/ernestognw/orgs",
      "repos_url": "https://api.github.com/users/ernestognw/repos",
      "events_url": "https://api.github.com/users/ernestognw/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ernestognw/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-22T20:45:26Z",
    "updated_at": "2023-10-22T20:45:26Z",
    "author_association": "MEMBER",
    "body": "Hey @JaredBorders, thanks for reporting. However, we don't see this mismatch as an issue. The `signature` value is not included because you'd require the signature to sign a message. And regarding the `nonce`, we discussed it during the 5.0 development and reached the following conclusions:\r\n\r\n1.  Including `nonce` in `ForwardRequestData` is redundant information because the nonce is a 1:1 relationship with the address.\r\n2. Removing `nonce` from `ForwardRequestData` reduced the calldata size, which is especially important for the `executeBatch` function.\r\n3. Given meta transactions are sponsored by an entity, it's in its best interest to save in calldata costs.\r\n4. The nonce can't be spoofed anyway because it needs to be included in the signed message (what the end user will see in metamask)\r\n\r\n> The type hash parameters should match the fields found in the struct.\r\n\r\nCan you elaborate on why they should? I'd be happy to hear if we're missing something with the design of the forwarder",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1774194577/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
