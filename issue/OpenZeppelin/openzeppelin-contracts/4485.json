{
  "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4485",
  "repository_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts",
  "labels_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4485/labels{/name}",
  "comments_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4485/comments",
  "events_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4485/events",
  "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/4485",
  "id": 1826027194,
  "node_id": "I_kwDOA9tCBs5s1va6",
  "number": 4485,
  "title": "Implement Twisted and Milestone Vesting",
  "user": {
    "login": "gregzaitsev",
    "id": 2152909,
    "node_id": "MDQ6VXNlcjIxNTI5MDk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2152909?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gregzaitsev",
    "html_url": "https://github.com/gregzaitsev",
    "followers_url": "https://api.github.com/users/gregzaitsev/followers",
    "following_url": "https://api.github.com/users/gregzaitsev/following{/other_user}",
    "gists_url": "https://api.github.com/users/gregzaitsev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gregzaitsev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gregzaitsev/subscriptions",
    "organizations_url": "https://api.github.com/users/gregzaitsev/orgs",
    "repos_url": "https://api.github.com/users/gregzaitsev/repos",
    "events_url": "https://api.github.com/users/gregzaitsev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gregzaitsev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-07-28T09:04:36Z",
  "updated_at": "2023-08-26T05:28:17Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**üßê Motivation**\r\n\r\nThe most basic type of vesting is linear when after the cliff period the fixed portions of token are released to the beneficiary on every time interval. It is already implemented in [VestingWallet](https://github.com/gregzaitsev/openzeppelin-contracts/blob/master/contracts/finance/VestingWallet.sol) contract. Nonetheless, there are more types of vesting that are more helpful for tier 1 projects, advisors, VCs, and capitals: **Twisted** and **Milestone** vesting. More details below.\r\n\r\n**üìù Details**\r\n\r\nTo convey the ideas in a very basic form, the twisted vesting consists of a combination of linear vesting schedules following one after another. Milestone vesting is the corner case of twisted vesting that only uses cliffs with zero length linear part (immediate vesting after a cliff). With twisted and milestone vesting it is possible to create complex non-linear vesting schedules in a gas optimized way. Hence, the benefits of the suggested vesting models are: (1) creating arbitrary non-linear schedules, (2) gas optimization, (3) having a single vesting account that shows the full balance in vesting for all schedules (especially helpful for complex non-linear cases).\r\n\r\nThere are two articles that describe Twisted and Milestone vesting and their use cases in detail: \r\n\r\n1. [Token Vesting: The Complete Guide to Creating Vesting in Tokenomics](https://medium.com/coinmonks/token-vesting-the-complete-guide-to-creating-vesting-in-tokenomics-bf211b999f2f)\r\n2. [TOKEN VESTING ‚Äì EVERYTHING YOU NEED TO KNOW](https://eqvista.com/company-valuation/valuation-crypto-assets/token-vesting/)\r\n\r\nI am open to contributing to this issue.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4485/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4485/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1655562777",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/4485#issuecomment-1655562777",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4485",
    "id": 1655562777,
    "node_id": "IC_kwDOA9tCBs5ireIZ",
    "user": {
      "login": "gregzaitsev",
      "id": 2152909,
      "node_id": "MDQ6VXNlcjIxNTI5MDk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2152909?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gregzaitsev",
      "html_url": "https://github.com/gregzaitsev",
      "followers_url": "https://api.github.com/users/gregzaitsev/followers",
      "following_url": "https://api.github.com/users/gregzaitsev/following{/other_user}",
      "gists_url": "https://api.github.com/users/gregzaitsev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gregzaitsev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gregzaitsev/subscriptions",
      "organizations_url": "https://api.github.com/users/gregzaitsev/orgs",
      "repos_url": "https://api.github.com/users/gregzaitsev/repos",
      "events_url": "https://api.github.com/users/gregzaitsev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gregzaitsev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-28T12:01:50Z",
    "updated_at": "2023-07-28T12:01:50Z",
    "author_association": "NONE",
    "body": "Ready to work with [Keref](https://github.com/Keref) merging with issue #4441 and/or with [MerlinEgalite](https://github.com/MerlinEgalite) on issue #4131 ",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1655562777/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1694173732",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/4485#issuecomment-1694173732",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4485",
    "id": 1694173732,
    "node_id": "IC_kwDOA9tCBs5k-wok",
    "user": {
      "login": "Keref",
      "id": 10669019,
      "node_id": "MDQ6VXNlcjEwNjY5MDE5",
      "avatar_url": "https://avatars.githubusercontent.com/u/10669019?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Keref",
      "html_url": "https://github.com/Keref",
      "followers_url": "https://api.github.com/users/Keref/followers",
      "following_url": "https://api.github.com/users/Keref/following{/other_user}",
      "gists_url": "https://api.github.com/users/Keref/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Keref/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Keref/subscriptions",
      "organizations_url": "https://api.github.com/users/Keref/orgs",
      "repos_url": "https://api.github.com/users/Keref/repos",
      "events_url": "https://api.github.com/users/Keref/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Keref/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-26T05:28:17Z",
    "updated_at": "2023-08-26T05:28:17Z",
    "author_association": "NONE",
    "body": "Hi, to integrate a difference vesting schedule in my proposal is pretty simple, it is possible to override the _vestingStatus function to implement a different vesting schedule.\r\n\r\nHere for our project we have an exponential decaying function.\r\n```\r\n  /// @notice Calculates the lockedAmount/unlockedAmount amounts according to reverse exponential unlock\r\n  function _vestingStatus(uint256 vestedAmount, uint64 startTime) \r\n    internal view override returns (uint256 unlockedAmount, uint256 lockedAmount) \r\n  {\r\n    // penalty function is (x^1.4 = e^(1.4*ln(x)), with x = 1 - elapsed / vestingDuration\r\n    int128 elapsedRatio = ABDKMath64x64.divu(block.timestamp - startTime, vestingDuration());\r\n    int128 lnElapsedRatio = ABDKMath64x64.ln(ABDKMath64x64.sub(1 << 64, elapsedRatio));\r\n    int128 expo14 = int128(uint128(0x16666666666666666)); // 1.4 * 2**64\r\n    int128 penaltyExponent = ABDKMath64x64.mul(expo14, lnElapsedRatio);\r\n    int128 penaltyRatio = ABDKMath64x64.exp(penaltyExponent);\r\n    lockedAmount = ABDKMath64x64.mulu(penaltyRatio, vestedAmount);\r\n    unlockedAmount = vestedAmount - lockedAmount;\r\n  }\r\n```\r\n\r\nIt's quite trivial to implement linear vesting with cliff.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1694173732/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
