{
  "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4496",
  "repository_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts",
  "labels_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4496/labels{/name}",
  "comments_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4496/comments",
  "events_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4496/events",
  "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/4496",
  "id": 1829841502,
  "node_id": "I_kwDOA9tCBs5tESpe",
  "number": 4496,
  "title": "ERC4626 does not check the amount of tokens received during the deposit",
  "user": {
    "login": "vladyan18",
    "id": 13525908,
    "node_id": "MDQ6VXNlcjEzNTI1OTA4",
    "avatar_url": "https://avatars.githubusercontent.com/u/13525908?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vladyan18",
    "html_url": "https://github.com/vladyan18",
    "followers_url": "https://api.github.com/users/vladyan18/followers",
    "following_url": "https://api.github.com/users/vladyan18/following{/other_user}",
    "gists_url": "https://api.github.com/users/vladyan18/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vladyan18/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vladyan18/subscriptions",
    "organizations_url": "https://api.github.com/users/vladyan18/orgs",
    "repos_url": "https://api.github.com/users/vladyan18/repos",
    "events_url": "https://api.github.com/users/vladyan18/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vladyan18/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-07-31T19:01:45Z",
  "updated_at": "2023-07-31T22:16:36Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "ðŸ“ Details\r\n\r\nThe deposit method assumes that as a result of transferFrom, the pool will receive exactly the number of tokens it expects.\r\n\r\nhttps://github.com/OpenZeppelin/openzeppelin-contracts/blob/d6b63a48ba440ad8d551383697db6e5b0ef84137/contracts/token/ERC20/extensions/ERC4626.sol#L251-L252\r\n\r\n\r\nHowever, there are implementations of tokens that may violate this assumption (for example, tokens with transfer fees). In this case, the vault may end up in an inconsistent state.\r\n\r\nIf this is expected behavior, based on the ERC20 standard, for example, then it might be worth mentioning such requirements for underlying assets?\r\n\r\nSimilar situation in ERC20Wrapper.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4496/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4496/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1659049848",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/4496#issuecomment-1659049848",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4496",
    "id": 1659049848,
    "node_id": "IC_kwDOA9tCBs5i4xd4",
    "user": {
      "login": "Amxx",
      "id": 2432299,
      "node_id": "MDQ6VXNlcjI0MzIyOTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2432299?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Amxx",
      "html_url": "https://github.com/Amxx",
      "followers_url": "https://api.github.com/users/Amxx/followers",
      "following_url": "https://api.github.com/users/Amxx/following{/other_user}",
      "gists_url": "https://api.github.com/users/Amxx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Amxx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Amxx/subscriptions",
      "organizations_url": "https://api.github.com/users/Amxx/orgs",
      "repos_url": "https://api.github.com/users/Amxx/repos",
      "events_url": "https://api.github.com/users/Amxx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Amxx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-31T20:00:03Z",
    "updated_at": "2023-07-31T20:00:03Z",
    "author_association": "COLLABORATOR",
    "body": "Yes, this is expected behavior. It would be worth at least mentionning it. \r\n\r\nFor the wrapper it really is a strong requirement IMO, but it would also be interresting to try an build a vault that support such tokens.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1659049848/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1659062001",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/4496#issuecomment-1659062001",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4496",
    "id": 1659062001,
    "node_id": "IC_kwDOA9tCBs5i40bx",
    "user": {
      "login": "vladyan18",
      "id": 13525908,
      "node_id": "MDQ6VXNlcjEzNTI1OTA4",
      "avatar_url": "https://avatars.githubusercontent.com/u/13525908?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vladyan18",
      "html_url": "https://github.com/vladyan18",
      "followers_url": "https://api.github.com/users/vladyan18/followers",
      "following_url": "https://api.github.com/users/vladyan18/following{/other_user}",
      "gists_url": "https://api.github.com/users/vladyan18/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vladyan18/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vladyan18/subscriptions",
      "organizations_url": "https://api.github.com/users/vladyan18/orgs",
      "repos_url": "https://api.github.com/users/vladyan18/repos",
      "events_url": "https://api.github.com/users/vladyan18/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vladyan18/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-31T20:10:41Z",
    "updated_at": "2023-07-31T20:16:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "> For the wrapper it really is a strong requirement IMO\r\n\r\nIf I understand correctly, in a wrapper, the user can also get more wrapper token than it should be. Then there will eventually be problems with the burn.\r\nUPD: looks like I misread the comment\r\n\r\nhttps://github.com/OpenZeppelin/openzeppelin-contracts/blob/d6b63a48ba440ad8d551383697db6e5b0ef84137/contracts/token/ERC20/extensions/ERC20Wrapper.sol#L60-L61\r\n\r\n\r\n> but it would also be interresting to try an build a vault that support such tokens\r\n\r\nUsually, balances before and after the transfer are compared for this. But then there may be a problem with potential reentrancy...",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1659062001/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1659185500",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/4496#issuecomment-1659185500",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4496",
    "id": 1659185500,
    "node_id": "IC_kwDOA9tCBs5i5Slc",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-31T21:26:45Z",
    "updated_at": "2023-07-31T21:26:45Z",
    "author_association": "MEMBER",
    "body": "Is there any write-up on best practices for DeFi protocols on handling these kinds of tokens? Should they even be handled? ",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1659185500/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1659258144",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/4496#issuecomment-1659258144",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4496",
    "id": 1659258144,
    "node_id": "IC_kwDOA9tCBs5i5kUg",
    "user": {
      "login": "vladyan18",
      "id": 13525908,
      "node_id": "MDQ6VXNlcjEzNTI1OTA4",
      "avatar_url": "https://avatars.githubusercontent.com/u/13525908?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vladyan18",
      "html_url": "https://github.com/vladyan18",
      "followers_url": "https://api.github.com/users/vladyan18/followers",
      "following_url": "https://api.github.com/users/vladyan18/following{/other_user}",
      "gists_url": "https://api.github.com/users/vladyan18/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vladyan18/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vladyan18/subscriptions",
      "organizations_url": "https://api.github.com/users/vladyan18/orgs",
      "repos_url": "https://api.github.com/users/vladyan18/repos",
      "events_url": "https://api.github.com/users/vladyan18/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vladyan18/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-31T22:10:30Z",
    "updated_at": "2023-07-31T22:10:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Should they even be handled?\r\n\r\nMany protocols, such as UniswapV3, [deliberately refuse to support such tokens](https://docs.uniswap.org/concepts/protocol/integration-issues).  But in the case of a UniswapV3, the number of received tokens is still controlled.\r\n\r\nSome, like UniswapV2 or Algebra, [have separate support for these tokens](https://github.com/Uniswap/v2-periphery/blob/0335e8f7e1bd1e8d8329fd300aea2ef2f36dd19f/contracts/UniswapV2Router02.sol#L172).\r\n\r\nI think that these types of tokens are not very actively used now.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1659258144/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1659263865",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/4496#issuecomment-1659263865",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/4496",
    "id": 1659263865,
    "node_id": "IC_kwDOA9tCBs5i5lt5",
    "user": {
      "login": "vladyan18",
      "id": 13525908,
      "node_id": "MDQ6VXNlcjEzNTI1OTA4",
      "avatar_url": "https://avatars.githubusercontent.com/u/13525908?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vladyan18",
      "html_url": "https://github.com/vladyan18",
      "followers_url": "https://api.github.com/users/vladyan18/followers",
      "following_url": "https://api.github.com/users/vladyan18/following{/other_user}",
      "gists_url": "https://api.github.com/users/vladyan18/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vladyan18/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vladyan18/subscriptions",
      "organizations_url": "https://api.github.com/users/vladyan18/orgs",
      "repos_url": "https://api.github.com/users/vladyan18/repos",
      "events_url": "https://api.github.com/users/vladyan18/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vladyan18/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-31T22:16:36Z",
    "updated_at": "2023-07-31T22:16:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Is there any write-up on best practices for DeFi protocols on handling these kinds of tokens?\r\n\r\nI don't recall such a document or post, but here's a mention on the OpenZeppelin blog: [Tokens that take fees on transfers](https://blog.openzeppelin.com/workshop-recap-secure-development-workshop-1)",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1659263865/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
