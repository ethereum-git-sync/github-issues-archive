{
  "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3772",
  "repository_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts",
  "labels_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3772/labels{/name}",
  "comments_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3772/comments",
  "events_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3772/events",
  "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3772",
  "id": 1415475669,
  "node_id": "I_kwDOA9tCBs5UXnHV",
  "number": 3772,
  "title": "Implement `0x00` version of EIP191 in ECDSA Library ",
  "user": {
    "login": "YamenMerhi",
    "id": 86341666,
    "node_id": "MDQ6VXNlcjg2MzQxNjY2",
    "avatar_url": "https://avatars.githubusercontent.com/u/86341666?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/YamenMerhi",
    "html_url": "https://github.com/YamenMerhi",
    "followers_url": "https://api.github.com/users/YamenMerhi/followers",
    "following_url": "https://api.github.com/users/YamenMerhi/following{/other_user}",
    "gists_url": "https://api.github.com/users/YamenMerhi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/YamenMerhi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/YamenMerhi/subscriptions",
    "organizations_url": "https://api.github.com/users/YamenMerhi/orgs",
    "repos_url": "https://api.github.com/users/YamenMerhi/repos",
    "events_url": "https://api.github.com/users/YamenMerhi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/YamenMerhi/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2022-10-19T19:26:33Z",
  "updated_at": "2023-02-22T14:22:53Z",
  "closed_at": "2023-02-22T14:22:53Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### üßê Motivation\r\nIn the current `ECDSA` library, there is support to construct a message to sign according to the EIP191 Standard with the following:\r\n- The version `0x45` (E) with `toEthSignedMessage(..)` function \r\n- The version `0x01` with the `toTypedDataHash(..)` function. \r\nBut we are missing the `0x00` version.\r\n\r\n<img width=\"1460\" alt=\"Screen Shot 2022-10-19 at 10 17 27 PM\" src=\"https://user-images.githubusercontent.com/86341666/196783740-8280e393-8449-4601-ab54-8a31e616531e.png\">\r\n\r\n\r\n### üìù Details\r\nAfter looking at [this closed issue](https://github.com/OpenZeppelin/openzeppelin-contracts/issues/1810), saw a comment from @frangio  stating that `0x00` version is not that used, which is true because people are misusing the standard, they are using the `0x45` version for everything: signing message for offchain verification, for smart contract execution based on signatures, which is dangerous.\r\n\r\nAs people could be easily tricked to sign a normal message, we should have a different mechanism, then different handling for execution based on signatures, and that's why we should make people use the `0x00` version for this case. + some projects are starting to use it like [xenium](https://github.com/Arachnid/xenium) and the [lsp-smart-contracts](https://github.com/lukso-network/lsp-smart-contracts) (planning to use it). \r\n\r\nI am suggesting to add a new function `toDataWithIntendedValidator(...)` to be compatible with the version `0x00` taking 2 parameters, `<address validator>` and `<bytes dataToSign>`.\r\n\r\nThe function would be:\r\n\r\n```solidity\r\nfunction toDataWithIntendedValidator(address validator, bytes memory dataToSign) internal pure returns (bytes32) {\r\n        return keccak256(abi.encodePacked(\"\\x19\\x00\", validator, dataToSign));\r\n}\r\n```\r\n\r\nIf you're okay with it I am happy to open the PR, otherwise you can close the issue üòÑ  \r\n\r\n\r\n\r\n",
  "closed_by": {
    "login": "Amxx",
    "id": 2432299,
    "node_id": "MDQ6VXNlcjI0MzIyOTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2432299?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Amxx",
    "html_url": "https://github.com/Amxx",
    "followers_url": "https://api.github.com/users/Amxx/followers",
    "following_url": "https://api.github.com/users/Amxx/following{/other_user}",
    "gists_url": "https://api.github.com/users/Amxx/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Amxx/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Amxx/subscriptions",
    "organizations_url": "https://api.github.com/users/Amxx/orgs",
    "repos_url": "https://api.github.com/users/Amxx/repos",
    "events_url": "https://api.github.com/users/Amxx/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Amxx/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3772/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3772/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1286722856",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3772#issuecomment-1286722856",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3772",
    "id": 1286722856,
    "node_id": "IC_kwDOA9tCBs5MsdUo",
    "user": {
      "login": "Amxx",
      "id": 2432299,
      "node_id": "MDQ6VXNlcjI0MzIyOTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2432299?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Amxx",
      "html_url": "https://github.com/Amxx",
      "followers_url": "https://api.github.com/users/Amxx/followers",
      "following_url": "https://api.github.com/users/Amxx/following{/other_user}",
      "gists_url": "https://api.github.com/users/Amxx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Amxx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Amxx/subscriptions",
      "organizations_url": "https://api.github.com/users/Amxx/orgs",
      "repos_url": "https://api.github.com/users/Amxx/repos",
      "events_url": "https://api.github.com/users/Amxx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Amxx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-21T09:49:38Z",
    "updated_at": "2022-10-21T09:49:38Z",
    "author_association": "COLLABORATOR",
    "body": "Hello @YamenMerhi \r\n\r\nThat is an interesting proposal. Do you know any wallet that include support for version `0x00` signing ?",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1286722856/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1287132072",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3772#issuecomment-1287132072",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3772",
    "id": 1287132072,
    "node_id": "IC_kwDOA9tCBs5MuBOo",
    "user": {
      "login": "YamenMerhi",
      "id": 86341666,
      "node_id": "MDQ6VXNlcjg2MzQxNjY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/86341666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YamenMerhi",
      "html_url": "https://github.com/YamenMerhi",
      "followers_url": "https://api.github.com/users/YamenMerhi/followers",
      "following_url": "https://api.github.com/users/YamenMerhi/following{/other_user}",
      "gists_url": "https://api.github.com/users/YamenMerhi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YamenMerhi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YamenMerhi/subscriptions",
      "organizations_url": "https://api.github.com/users/YamenMerhi/orgs",
      "repos_url": "https://api.github.com/users/YamenMerhi/repos",
      "events_url": "https://api.github.com/users/YamenMerhi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YamenMerhi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-21T15:36:30Z",
    "updated_at": "2022-10-21T15:36:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey @Amxx \r\n\r\nAs I stated in my message, we are planning to use it in the [LSP6KeyManager](https://github.com/lukso-network/lsp-smart-contracts/blob/develop/contracts/LSP6KeyManager/LSP6KeyManagerCore.sol#L109) contract, also when I met nick.eth in DevCon he mentioned that he uses it for [xenium](https://github.com/Arachnid/xenium/blob/main/packages/validator/contracts/ValidatorLib.sol#L16). Also when I checked argent, their old [multisig](https://github.com/argentlabs/argent-contracts/blob/develop/contracts/infrastructure_0.5/MultiSigWallet.sol#L83) use it with a weird combination of `0x45` version.\r\n\r\nWith the rise of smart contract-based accounts and wallets, I think it will start to be used more and more, and we should push to have it as anyone could be tricked to sign a `0x45` message and end up having a smart contract execution based on this signature where people thinks its just for offchain or SIWE purposes.\r\n\r\nI made a [PR to the EIP191 standard](https://github.com/ethereum/EIPs/pull/5804 ) to make it more comprehensible and the LUKSO team is also developing a library [EIP191-Signer](https://github.com/lukso-network/tools-eip191-signer) that allows signing different versions of EIP191 messages (`0x45` and `0x00`). Hopefully these steps and tools will make `0x00` version more adopted.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1287132072/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1288945433",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3772#issuecomment-1288945433",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3772",
    "id": 1288945433,
    "node_id": "IC_kwDOA9tCBs5M078Z",
    "user": {
      "login": "Amxx",
      "id": 2432299,
      "node_id": "MDQ6VXNlcjI0MzIyOTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2432299?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Amxx",
      "html_url": "https://github.com/Amxx",
      "followers_url": "https://api.github.com/users/Amxx/followers",
      "following_url": "https://api.github.com/users/Amxx/following{/other_user}",
      "gists_url": "https://api.github.com/users/Amxx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Amxx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Amxx/subscriptions",
      "organizations_url": "https://api.github.com/users/Amxx/orgs",
      "repos_url": "https://api.github.com/users/Amxx/repos",
      "events_url": "https://api.github.com/users/Amxx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Amxx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-24T12:15:28Z",
    "updated_at": "2022-10-24T12:15:28Z",
    "author_association": "COLLABORATOR",
    "body": "Thanks for all this information!\r\n\r\nI was only saying that because many devs still make the error of not using the \"preparation\" function, and not understanding the difference between rawsign and personalsign. I hope adding this new function doesn't add to the confusion. \r\n\r\nAlso, I want us to test it, and for that we'll need to produce the corresponding signature, hopefully without using some low level rawsign.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1288945433/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1290434722",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3772#issuecomment-1290434722",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3772",
    "id": 1290434722,
    "node_id": "IC_kwDOA9tCBs5M6nii",
    "user": {
      "login": "YamenMerhi",
      "id": 86341666,
      "node_id": "MDQ6VXNlcjg2MzQxNjY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/86341666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YamenMerhi",
      "html_url": "https://github.com/YamenMerhi",
      "followers_url": "https://api.github.com/users/YamenMerhi/followers",
      "following_url": "https://api.github.com/users/YamenMerhi/following{/other_user}",
      "gists_url": "https://api.github.com/users/YamenMerhi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YamenMerhi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YamenMerhi/subscriptions",
      "organizations_url": "https://api.github.com/users/YamenMerhi/orgs",
      "repos_url": "https://api.github.com/users/YamenMerhi/repos",
      "events_url": "https://api.github.com/users/YamenMerhi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YamenMerhi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-25T12:01:20Z",
    "updated_at": "2022-10-25T12:01:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "@Amxx Definitely we want to avoid confusion as much as possible. If you want to create a list of things to test, change, do please do, and let's sync on it  üòÄ ",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1290434722/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1368946918",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3772#issuecomment-1368946918",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3772",
    "id": 1368946918,
    "node_id": "IC_kwDOA9tCBs5RmHjm",
    "user": {
      "login": "YamenMerhi",
      "id": 86341666,
      "node_id": "MDQ6VXNlcjg2MzQxNjY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/86341666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YamenMerhi",
      "html_url": "https://github.com/YamenMerhi",
      "followers_url": "https://api.github.com/users/YamenMerhi/followers",
      "following_url": "https://api.github.com/users/YamenMerhi/following{/other_user}",
      "gists_url": "https://api.github.com/users/YamenMerhi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YamenMerhi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YamenMerhi/subscriptions",
      "organizations_url": "https://api.github.com/users/YamenMerhi/orgs",
      "repos_url": "https://api.github.com/users/YamenMerhi/repos",
      "events_url": "https://api.github.com/users/YamenMerhi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YamenMerhi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-02T13:27:18Z",
    "updated_at": "2023-01-02T13:27:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "Any updates @Amxx @frangio üôè ",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1368946918/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1438663787",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3772#issuecomment-1438663787",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3772",
    "id": 1438663787,
    "node_id": "IC_kwDOA9tCBs5VwERr",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-21T15:19:57Z",
    "updated_at": "2023-02-21T15:19:57Z",
    "author_association": "MEMBER",
    "body": "Sorry for the silence. This is simple enough, I'm not opposed to a PR implementing it.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1438663787/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1438687810",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3772#issuecomment-1438687810",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3772",
    "id": 1438687810,
    "node_id": "IC_kwDOA9tCBs5VwKJC",
    "user": {
      "login": "YamenMerhi",
      "id": 86341666,
      "node_id": "MDQ6VXNlcjg2MzQxNjY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/86341666?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YamenMerhi",
      "html_url": "https://github.com/YamenMerhi",
      "followers_url": "https://api.github.com/users/YamenMerhi/followers",
      "following_url": "https://api.github.com/users/YamenMerhi/following{/other_user}",
      "gists_url": "https://api.github.com/users/YamenMerhi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YamenMerhi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YamenMerhi/subscriptions",
      "organizations_url": "https://api.github.com/users/YamenMerhi/orgs",
      "repos_url": "https://api.github.com/users/YamenMerhi/repos",
      "events_url": "https://api.github.com/users/YamenMerhi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YamenMerhi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-21T15:35:50Z",
    "updated_at": "2023-02-21T15:35:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "Okay will do a PR, thanks! @frangio",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1438687810/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
