{
  "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2674",
  "repository_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts",
  "labels_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2674/labels{/name}",
  "comments_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2674/comments",
  "events_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2674/events",
  "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/2674",
  "id": 892435483,
  "node_id": "MDU6SXNzdWU4OTI0MzU0ODM=",
  "number": 2674,
  "title": "Adding new hooks",
  "user": {
    "login": "aress31",
    "id": 11601622,
    "node_id": "MDQ6VXNlcjExNjAxNjIy",
    "avatar_url": "https://avatars.githubusercontent.com/u/11601622?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/aress31",
    "html_url": "https://github.com/aress31",
    "followers_url": "https://api.github.com/users/aress31/followers",
    "following_url": "https://api.github.com/users/aress31/following{/other_user}",
    "gists_url": "https://api.github.com/users/aress31/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/aress31/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/aress31/subscriptions",
    "organizations_url": "https://api.github.com/users/aress31/orgs",
    "repos_url": "https://api.github.com/users/aress31/repos",
    "events_url": "https://api.github.com/users/aress31/events{/privacy}",
    "received_events_url": "https://api.github.com/users/aress31/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-05-15T12:40:54Z",
  "updated_at": "2021-05-19T20:07:57Z",
  "closed_at": "2021-05-19T19:06:49Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "The `beforeTokenTransfer` hook is super useful and make it easy to extend `ERC20` core functionalities. However, using this same hook in many different functions breaks the code flexibility - as different functions may need different logic - therefore, what I suggest is that instead of exporting only `beforeTokenTransfer`, you could expose:\r\n- `beforeMint`: for `_mint`\r\n- `beforeBurn`: for `_burn`\r\n- `beforeTokenTransfer`: for `_transfer`\r\n\r\nAlso having a way to update  `_balances` directly from children contracts without having to redefine all relevant functions:\r\n- `balanceOf`\r\n- `_mint`\r\n- `_burn`\r\n- `_transfer`\r\n\r\nWould help avoiding code repetition and save in gas fees for deployment.",
  "closed_by": {
    "login": "frangio",
    "id": 481465,
    "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/frangio",
    "html_url": "https://github.com/frangio",
    "followers_url": "https://api.github.com/users/frangio/followers",
    "following_url": "https://api.github.com/users/frangio/following{/other_user}",
    "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
    "organizations_url": "https://api.github.com/users/frangio/orgs",
    "repos_url": "https://api.github.com/users/frangio/repos",
    "events_url": "https://api.github.com/users/frangio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/frangio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2674/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2674/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/841662919",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/2674#issuecomment-841662919",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2674",
    "id": 841662919,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MTY2MjkxOQ==",
    "user": {
      "login": "Amxx",
      "id": 2432299,
      "node_id": "MDQ6VXNlcjI0MzIyOTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2432299?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Amxx",
      "html_url": "https://github.com/Amxx",
      "followers_url": "https://api.github.com/users/Amxx/followers",
      "following_url": "https://api.github.com/users/Amxx/following{/other_user}",
      "gists_url": "https://api.github.com/users/Amxx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Amxx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Amxx/subscriptions",
      "organizations_url": "https://api.github.com/users/Amxx/orgs",
      "repos_url": "https://api.github.com/users/Amxx/repos",
      "events_url": "https://api.github.com/users/Amxx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Amxx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-15T13:57:31Z",
    "updated_at": "2021-05-15T13:57:31Z",
    "author_association": "COLLABORATOR",
    "body": "Hello @aress31,\r\n\r\nThe common thing with mint, burn and transfer, is that they all affect the balances of the wallet, either by adding of removing tokens. This is what dev most often want to catch using the `_beforeTransfer` hook.\r\n\r\nHaving three differents hook will likely cause code duplication, which is not a good thing. Also, from within a `_beforeTransfer` hook, you can check if `from` or `to` is `address(0)`. \r\n\r\nFor gas saving purposes (avoid the check in `_beforeTransfer`) you can also, as you stated, override `_mint`. This is what we do in the [ERC20Capped](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/token/ERC20/extensions/ERC20Capped.sol) contract.\r\n\r\nIn conclusion, I do believe that our current hook system is powerful enough for most cases. I have never found a case where I needed more granular hooks, and the ability to build ERC20 extensions is giving me confidence.\r\n\r\nI'd love to know more about your usecases, and the gas savings you would get from such hooks.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/841662919/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/843636417",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/2674#issuecomment-843636417",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2674",
    "id": 843636417,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MzYzNjQxNw==",
    "user": {
      "login": "aress31",
      "id": 11601622,
      "node_id": "MDQ6VXNlcjExNjAxNjIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/11601622?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aress31",
      "html_url": "https://github.com/aress31",
      "followers_url": "https://api.github.com/users/aress31/followers",
      "following_url": "https://api.github.com/users/aress31/following{/other_user}",
      "gists_url": "https://api.github.com/users/aress31/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aress31/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aress31/subscriptions",
      "organizations_url": "https://api.github.com/users/aress31/orgs",
      "repos_url": "https://api.github.com/users/aress31/repos",
      "events_url": "https://api.github.com/users/aress31/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aress31/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-18T23:37:47Z",
    "updated_at": "2021-05-18T23:37:47Z",
    "author_association": "NONE",
    "body": "@Amxx then similarly to the `allowance` an `increaseBalance` and `decreaseBalance` functions should be expose so that in my own contract, I do not have to redefine the `_balances` array and rewrite the relevant functions (`mint`, `transfer` and `burn`) whenever wanting to do something with balances in my custom contract!",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/843636417/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/844388773",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/2674#issuecomment-844388773",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2674",
    "id": 844388773,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NDM4ODc3Mw==",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-19T19:06:49Z",
    "updated_at": "2021-05-19T19:07:32Z",
    "author_association": "MEMBER",
    "body": "@aress31 `increaseBalance` and `decreaseBalance` are already available, in the form of `_mint` and `_burn` respectively. These, together with `_transfer`, are the only way to update the balances mapping. The reason it's done this way is that it's important to also emit a `Transfer` event whenever the mapping is changed, which is done by all three functions.\r\n\r\nAs @Amxx said, you should be able to do everything you want with `_beforeTokenTransfer`, and in some cases you may want to override `_mint` or `_burn` directly.\r\n\r\nIf you have an ERC20 extension that you believe you're not able to write using the hooks that are already provided, please share the details so we can help figure it out.",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/844388773/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/844432055",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/2674#issuecomment-844432055",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/2674",
    "id": 844432055,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NDQzMjA1NQ==",
    "user": {
      "login": "aress31",
      "id": 11601622,
      "node_id": "MDQ6VXNlcjExNjAxNjIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/11601622?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aress31",
      "html_url": "https://github.com/aress31",
      "followers_url": "https://api.github.com/users/aress31/followers",
      "following_url": "https://api.github.com/users/aress31/following{/other_user}",
      "gists_url": "https://api.github.com/users/aress31/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aress31/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aress31/subscriptions",
      "organizations_url": "https://api.github.com/users/aress31/orgs",
      "repos_url": "https://api.github.com/users/aress31/repos",
      "events_url": "https://api.github.com/users/aress31/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aress31/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-19T20:07:57Z",
    "updated_at": "2021-05-19T20:07:57Z",
    "author_association": "NONE",
    "body": "True haven't thought of mint and burn as a way to alter the balance in the\nsame way than the increase/decrease allowances. Thanks!\n\nOn Wed, 19 May 2021, 20:07 Francisco Giordano, ***@***.***>\nwrote:\n\n> @aress31 <https://github.com/aress31> increaseBalance and decreaseBalance\n> are already available, in the form of _mint and _burn respectively.\n> These, together with _transfer, are the only way to update the balances\n> mapping. The reason it's done this way is that it's important to also emit\n> a Transfer event whenever the mapping is changed, which is done by all\n> three functions.\n>\n> As @Amxx <https://github.com/Amxx> said, you should be able to do\n> everything you want with _beforeTokenTransfer, and in some cases you may\n> want to override _mint or _burn directly.\n>\n> —\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/OpenZeppelin/openzeppelin-contracts/issues/2674#issuecomment-844388773>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/ACYQNVTRXKM3BZHDSQNPTDDTOQD53ANCNFSM4453KQVA>\n> .\n>\n",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/844432055/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
