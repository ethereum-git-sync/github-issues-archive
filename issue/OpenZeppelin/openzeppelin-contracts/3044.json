{
  "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3044",
  "repository_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts",
  "labels_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3044/labels{/name}",
  "comments_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3044/comments",
  "events_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3044/events",
  "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3044",
  "id": 1086316558,
  "node_id": "I_kwDOA9tCBs5Av-AO",
  "number": 3044,
  "title": "Change default owner/admin accounts to `tx.origin` rather than `msg.sender`",
  "user": {
    "login": "pcaversaccio",
    "id": 25297591,
    "node_id": "MDQ6VXNlcjI1Mjk3NTkx",
    "avatar_url": "https://avatars.githubusercontent.com/u/25297591?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pcaversaccio",
    "html_url": "https://github.com/pcaversaccio",
    "followers_url": "https://api.github.com/users/pcaversaccio/followers",
    "following_url": "https://api.github.com/users/pcaversaccio/following{/other_user}",
    "gists_url": "https://api.github.com/users/pcaversaccio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pcaversaccio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pcaversaccio/subscriptions",
    "organizations_url": "https://api.github.com/users/pcaversaccio/orgs",
    "repos_url": "https://api.github.com/users/pcaversaccio/repos",
    "events_url": "https://api.github.com/users/pcaversaccio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pcaversaccio/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-12-21T23:50:21Z",
  "updated_at": "2022-02-13T00:40:28Z",
  "closed_at": "2021-12-22T14:54:18Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**ðŸ§ Motivation**\r\n_Some background:_ I'm the author of the Hardhat plugin [`xdeployer`](https://github.com/pcaversaccio/xdeployer) that helps to deploy smart contracts across multiple EVM chains with the same deterministic address (keyword `CREATE2` opcode). Since opcodes can only be called via smart contracts, the default owner of a deployed contract with `CREATE2` (and my plugin) will be a contract address (using your default `npm` package as dependency) which is obviously not good. How about setting the default owner to `tx.origin` and make everything more agnostic? Like that it can be ensured that the original EOA user will always be the owner. The same applies to the default roles in your OpenZeppelin Wizard for `DEFAULT_ADMIN_ROLE`, `PAUSER_ROLE`, `MINTER_ROLE`:\r\n```solidity\r\n    constructor() ERC20(\"MyToken\", \"MTK\") {\r\n        _grantRole(DEFAULT_ADMIN_ROLE, msg.sender);\r\n        _grantRole(PAUSER_ROLE, msg.sender);\r\n        _grantRole(MINTER_ROLE, msg.sender);\r\n    }\r\n```\r\n\r\nI'm fully aware of the security considerations re `tx.origin` (https://docs.soliditylang.org/en/v0.8.11/security-considerations.html?highlight=tx.origin#tx-origin), however, in this case, we would not touch the authorization but rather \"only\" the constructor argument.",
  "closed_by": {
    "login": "frangio",
    "id": 481465,
    "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/frangio",
    "html_url": "https://github.com/frangio",
    "followers_url": "https://api.github.com/users/frangio/followers",
    "following_url": "https://api.github.com/users/frangio/following{/other_user}",
    "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
    "organizations_url": "https://api.github.com/users/frangio/orgs",
    "repos_url": "https://api.github.com/users/frangio/repos",
    "events_url": "https://api.github.com/users/frangio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/frangio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3044/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3044/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/999176881",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3044#issuecomment-999176881",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3044",
    "id": 999176881,
    "node_id": "IC_kwDOA9tCBs47jjqx",
    "user": {
      "login": "panpansh",
      "id": 790586,
      "node_id": "MDQ6VXNlcjc5MDU4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/790586?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/panpansh",
      "html_url": "https://github.com/panpansh",
      "followers_url": "https://api.github.com/users/panpansh/followers",
      "following_url": "https://api.github.com/users/panpansh/following{/other_user}",
      "gists_url": "https://api.github.com/users/panpansh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/panpansh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/panpansh/subscriptions",
      "organizations_url": "https://api.github.com/users/panpansh/orgs",
      "repos_url": "https://api.github.com/users/panpansh/repos",
      "events_url": "https://api.github.com/users/panpansh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/panpansh/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-22T00:05:12Z",
    "updated_at": "2021-12-22T00:05:12Z",
    "author_association": "NONE",
    "body": "yes using tx.origin for constructor only seems ok",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/999176881/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/999380452",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3044#issuecomment-999380452",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3044",
    "id": 999380452,
    "node_id": "IC_kwDOA9tCBs47kVXk",
    "user": {
      "login": "Amxx",
      "id": 2432299,
      "node_id": "MDQ6VXNlcjI0MzIyOTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2432299?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Amxx",
      "html_url": "https://github.com/Amxx",
      "followers_url": "https://api.github.com/users/Amxx/followers",
      "following_url": "https://api.github.com/users/Amxx/following{/other_user}",
      "gists_url": "https://api.github.com/users/Amxx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Amxx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Amxx/subscriptions",
      "organizations_url": "https://api.github.com/users/Amxx/orgs",
      "repos_url": "https://api.github.com/users/Amxx/repos",
      "events_url": "https://api.github.com/users/Amxx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Amxx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-22T08:28:03Z",
    "updated_at": "2021-12-22T08:28:11Z",
    "author_association": "COLLABORATOR",
    "body": "Hello @pcaversaccio \r\n\r\nThe wizard's role is to produce templates / first draft, that users can modify depending on their needs. In this case, it would be easy to do any of the following:\r\n- replace `msg.sender` for `tx.origin`\r\n- add a argument to the constructor, that is the admin to use\r\n\r\n@frangio: In the wizard when access control is enabled, maybe we want to add an optional field \"admin\" that would replace msg.sender ?",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/999380452/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/999402324",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3044#issuecomment-999402324",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3044",
    "id": 999402324,
    "node_id": "IC_kwDOA9tCBs47katU",
    "user": {
      "login": "pcaversaccio",
      "id": 25297591,
      "node_id": "MDQ6VXNlcjI1Mjk3NTkx",
      "avatar_url": "https://avatars.githubusercontent.com/u/25297591?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pcaversaccio",
      "html_url": "https://github.com/pcaversaccio",
      "followers_url": "https://api.github.com/users/pcaversaccio/followers",
      "following_url": "https://api.github.com/users/pcaversaccio/following{/other_user}",
      "gists_url": "https://api.github.com/users/pcaversaccio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pcaversaccio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pcaversaccio/subscriptions",
      "organizations_url": "https://api.github.com/users/pcaversaccio/orgs",
      "repos_url": "https://api.github.com/users/pcaversaccio/repos",
      "events_url": "https://api.github.com/users/pcaversaccio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pcaversaccio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-22T08:59:15Z",
    "updated_at": "2021-12-22T08:59:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "@Amxx yes agreed - but a template / first draft should be generic as much as possible (same goes for the default `npm` package) and my proposal would make everything more generic so that contracts can't be owners by default (contracts can never be the `tx.origin`). \r\n\r\nFor `Ownable.sol` I would suggest the following change (happy to submit a PR later):\r\n\r\n```solidity\r\n    /**\r\n     * @dev Initializes the contract setting the deployer as the initial owner.\r\n     */\r\n    constructor() {\r\n        _transferOwnership(tx.origin);\r\n    }\r\n```\r\n\r\nAs far as I've seen, there is no need to change `Context.sol`, since for meta-transactions `msgSender()` is only used. If however it is accessed via other inheritances at some places, we could simply add the following line as well to `Context.sol`:\r\n```solidity\r\n    function _txOrigin() internal view virtual returns (address) {\r\n        return tx.origin;\r\n    }\r\n```\r\nThis would change the first snippet in the following way:\r\n```solidity\r\n    /**\r\n     * @dev Initializes the contract setting the deployer as the initial owner.\r\n     */\r\n    constructor() {\r\n        _transferOwnership(_txOrigin());\r\n    }\r\n```\r\n\r\nI've thought through all `tx.origin` vulnerabilities and I don't think we introduce one here, but any other opinion on this matter is highly appreciated.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/999402324/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/999634702",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3044#issuecomment-999634702",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3044",
    "id": 999634702,
    "node_id": "IC_kwDOA9tCBs47lTcO",
    "user": {
      "login": "frangio",
      "id": 481465,
      "node_id": "MDQ6VXNlcjQ4MTQ2NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/481465?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frangio",
      "html_url": "https://github.com/frangio",
      "followers_url": "https://api.github.com/users/frangio/followers",
      "following_url": "https://api.github.com/users/frangio/following{/other_user}",
      "gists_url": "https://api.github.com/users/frangio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frangio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frangio/subscriptions",
      "organizations_url": "https://api.github.com/users/frangio/orgs",
      "repos_url": "https://api.github.com/users/frangio/repos",
      "events_url": "https://api.github.com/users/frangio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frangio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-22T14:54:18Z",
    "updated_at": "2021-12-22T14:54:18Z",
    "author_association": "MEMBER",
    "body": "We disagree that it's okay to use `tx.origin` in the constructor, at least in general. What you really want for the scenario you describe is to use the address of the caller to the factory contract, but this is not the same as `tx.origin`, because the caller to the factory contract may be another smart contract that should become the owner of the newly created contract.\r\n\r\nThis is always going to be a problem with factories and the factory created contract needs to be aware of that and/or offer a way to initialize it to the right values. For example, with an `Ownable` contract you can initialize the contract with a call to `transferOwnership`.\r\n\r\nThis is a proposal for a more general solution for the Wizard:\r\n- https://github.com/OpenZeppelin/contracts-wizard/issues/73",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/999634702/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/999635792",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3044#issuecomment-999635792",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3044",
    "id": 999635792,
    "node_id": "IC_kwDOA9tCBs47lTtQ",
    "user": {
      "login": "Amxx",
      "id": 2432299,
      "node_id": "MDQ6VXNlcjI0MzIyOTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2432299?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Amxx",
      "html_url": "https://github.com/Amxx",
      "followers_url": "https://api.github.com/users/Amxx/followers",
      "following_url": "https://api.github.com/users/Amxx/following{/other_user}",
      "gists_url": "https://api.github.com/users/Amxx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Amxx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Amxx/subscriptions",
      "organizations_url": "https://api.github.com/users/Amxx/orgs",
      "repos_url": "https://api.github.com/users/Amxx/repos",
      "events_url": "https://api.github.com/users/Amxx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Amxx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-22T14:55:46Z",
    "updated_at": "2021-12-22T14:56:19Z",
    "author_association": "COLLABORATOR",
    "body": "We already had some request to change the `Ownable` constructor to \r\n```\r\nconstructor(address admin) {\r\n        _transferOwnership(admin);\r\n}\r\n```\r\n\r\nIMO this would be much better then using tx.origin, yet we rejected this proposition because it would be a breaking change. We are VERY careful about any breaking change, which you proposal would be. Also we are, like most of the community, against using tx.origin. This has been the source of a lot of bugs.\r\n\r\nIf you really want to set tx.origin has the original owner (I would advice against it) you always have the possibility to do.\r\n```\r\ncontract YourContract is Ownable {\r\n    constructor() {\r\n        transferOwnership(tx.origin);\r\n    }\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/999635792/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1037600929",
    "html_url": "https://github.com/OpenZeppelin/openzeppelin-contracts/issues/3044#issuecomment-1037600929",
    "issue_url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/3044",
    "id": 1037600929,
    "node_id": "IC_kwDOA9tCBs492Iih",
    "user": {
      "login": "defido",
      "id": 95591037,
      "node_id": "U_kgDOBbKafQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/95591037?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/defido",
      "html_url": "https://github.com/defido",
      "followers_url": "https://api.github.com/users/defido/followers",
      "following_url": "https://api.github.com/users/defido/following{/other_user}",
      "gists_url": "https://api.github.com/users/defido/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/defido/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/defido/subscriptions",
      "organizations_url": "https://api.github.com/users/defido/orgs",
      "repos_url": "https://api.github.com/users/defido/repos",
      "events_url": "https://api.github.com/users/defido/events{/privacy}",
      "received_events_url": "https://api.github.com/users/defido/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-13T00:12:48Z",
    "updated_at": "2022-02-13T00:40:28Z",
    "author_association": "NONE",
    "body": "> IMO this would be much better then using tx.origin, yet we rejected this proposition because it would be a breaking change. We are VERY careful about any breaking change, which you proposal would be. Also we are, like most of the community, against using tx.origin. This has been the source of a lot of bugs.\r\n\r\n\r\nThink OP has a good proposal. Think it would be worth the change. +1 Setting owner should be simpler. Setting tx.origin as owner for factories is a must.\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/OpenZeppelin/openzeppelin-contracts/issues/comments/1037600929/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
