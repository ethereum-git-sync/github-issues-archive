{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3007",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3007/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3007/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3007/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/3007",
  "id": 470731832,
  "node_id": "MDU6SXNzdWU0NzA3MzE4MzI=",
  "number": 3007,
  "title": "\"Failed to sync with peer, trying next best peer\" error=\"context deadline exceeded\" ",
  "user": {
    "login": "prestonvanloon",
    "id": 7246818,
    "node_id": "MDQ6VXNlcjcyNDY4MTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prestonvanloon",
    "html_url": "https://github.com/prestonvanloon",
    "followers_url": "https://api.github.com/users/prestonvanloon/followers",
    "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
    "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
    "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
    "repos_url": "https://api.github.com/users/prestonvanloon/repos",
    "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129904,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDQ=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Bug",
      "name": "Bug",
      "color": "ee0701",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1085358164,
      "node_id": "MDU6TGFiZWwxMDg1MzU4MTY0",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Priority:%20Critical",
      "name": "Priority: Critical",
      "color": "f7262f",
      "default": false,
      "description": "Highest, immediate priority item"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "prestonvanloon",
    "id": 7246818,
    "node_id": "MDQ6VXNlcjcyNDY4MTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prestonvanloon",
    "html_url": "https://github.com/prestonvanloon",
    "followers_url": "https://api.github.com/users/prestonvanloon/followers",
    "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
    "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
    "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
    "repos_url": "https://api.github.com/users/prestonvanloon/repos",
    "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    {
      "login": "nisdas",
      "id": 33201827,
      "node_id": "MDQ6VXNlcjMzMjAxODI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/33201827?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nisdas",
      "html_url": "https://github.com/nisdas",
      "followers_url": "https://api.github.com/users/nisdas/followers",
      "following_url": "https://api.github.com/users/nisdas/following{/other_user}",
      "gists_url": "https://api.github.com/users/nisdas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nisdas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nisdas/subscriptions",
      "organizations_url": "https://api.github.com/users/nisdas/orgs",
      "repos_url": "https://api.github.com/users/nisdas/repos",
      "events_url": "https://api.github.com/users/nisdas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nisdas/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2019-07-21T01:39:00Z",
  "updated_at": "2019-07-24T14:53:39Z",
  "closed_at": "2019-07-24T14:53:39Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Attempting to sync with 3 healthy peers. \r\n```\r\ntime=\"2019-07-21 01:34:12\" level=info msg=\"Peer with highest canonical head\" peerID=QmPWP3SDeqzuN9AFxeWpBzzPgbLBDRtcWdRBZZ4GR1wqR1 prefix=syncQuerier\r\ntime=\"2019-07-21 01:34:12\" level=info msg=\"Latest chain head is at slot: 295 and state root: 0x11e4fa8139b6ccb11dc3c8f2b0c96db791a4e4f7e753f57b51efdfede3e33678\" prefix=syncQuerier\r\ntime=\"2019-07-21 01:34:12\" level=info msg=\"Finished querying state of the network, importing blocks...\" prefix=syncQuerier\r\ntime=\"2019-07-21 01:34:12\" level=info msg=\"Requesting state from peer\" canonicalSlot=294 peer=QmPWP3SDeqzuN9AFxeWpBzzPgbLBDRtcWdRBZZ4GR1wqR1 prefix=initial-sync\r\ntime=\"2019-07-21 01:34:32\" level=warning msg=\"Failed to sync with peer, trying next best peer\" error=\"context deadline exceeded\" peer=QmPWP3SDeqzuN9AFxeWpBzzPgbLBDRtcWdRBZZ4GR1wqR1 prefix=initial-sync\r\ntime=\"2019-07-21 01:34:32\" level=info msg=\"Requesting state from peer\" canonicalSlot=3 peer=QmZmJrWs56ASkY2H13Se46D4NCvtSe7Qp2K5xWZ1mxsfLi prefix=initial-sync\r\ntime=\"2019-07-21 01:34:32\" level=info msg=\"Received state resp from peer\" canonicalSlot=3 peer=QmZmJrWs56ASkY2H13Se46D4NCvtSe7Qp2K5xWZ1mxsfLi prefix=initial-sync\r\ntime=\"2019-07-21 01:34:32\" level=info msg=\"Requesting batch blocks from peer\" peer=QmZmJrWs56ASkY2H13Se46D4NCvtSe7Qp2K5xWZ1mxsfLi prefix=initial-sync\r\ntime=\"2019-07-21 01:34:52\" level=warning msg=\"Failed to sync with peer, trying next best peer\" error=\"context deadline exceeded\" peer=QmZmJrWs56ASkY2H13Se46D4NCvtSe7Qp2K5xWZ1mxsfLi prefix=initial-sync\r\ntime=\"2019-07-21 01:34:52\" level=info msg=\"Requesting state from peer\" canonicalSlot=3 peer=QmTQuyuZavSESkiSd9tPFGD3zkHKpMeB6jj5auWn6yJNH4 prefix=initial-sync\r\ntime=\"2019-07-21 01:34:52\" level=info msg=\"Received state resp from peer\" canonicalSlot=3 peer=QmTQuyuZavSESkiSd9tPFGD3zkHKpMeB6jj5auWn6yJNH4 prefix=initial-sync\r\ntime=\"2019-07-21 01:34:52\" level=info msg=\"Requesting batch blocks from peer\" peer=QmZmJrWs56ASkY2H13Se46D4NCvtSe7Qp2K5xWZ1mxsfLi prefix=initial-sync\r\ntime=\"2019-07-21 01:35:12\" level=warning msg=\"Failed to sync with peer, trying next best peer\" error=\"context deadline exceeded\" peer=QmTQuyuZavSESkiSd9tPFGD3zkHKpMeB6jj5auWn6yJNH4 prefix=initial-sync\r\ntime=\"2019-07-21 01:35:12\" level=fatal msg=\"Failed to sync with anyone...\" prefix=initial-sync\r\n```\r\n\r\n[logs-from-beacon-chain-in-beacon-chain-0.txt](https://github.com/prysmaticlabs/prysm/files/3414155/logs-from-beacon-chain-in-beacon-chain-0.txt)\r\n",
  "closed_by": {
    "login": "terencechain",
    "id": 21316537,
    "node_id": "MDQ6VXNlcjIxMzE2NTM3",
    "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/terencechain",
    "html_url": "https://github.com/terencechain",
    "followers_url": "https://api.github.com/users/terencechain/followers",
    "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
    "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
    "organizations_url": "https://api.github.com/users/terencechain/orgs",
    "repos_url": "https://api.github.com/users/terencechain/repos",
    "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/terencechain/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3007/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3007/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/513511973",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/3007#issuecomment-513511973",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3007",
    "id": 513511973,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMzUxMTk3Mw==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-21T01:43:01Z",
    "updated_at": "2019-07-21T01:43:01Z",
    "author_association": "MEMBER",
    "body": "With debug log, it looks like the node responds to requests, but the request for batch blocks never returns or fails to return before the deadline is exceeded.\r\n\r\n```\r\ntime=\"2019-07-21 01:38:54\" level=info msg=\"Peer with highest canonical head\" peerID=QmPWP3SDeqzuN9AFxeWpBzzPgbLBDRtcWdRBZZ4GR1wqR1 prefix=syncQuerier\r\ntime=\"2019-07-21 01:38:54\" level=info msg=\"Latest chain head is at slot: 342 and state root: 0xa43f7612ebabbb6dd8efd61ef7870721a95a5458d9c0d165e740ae9d72325b13\" prefix=syncQuerier\r\ntime=\"2019-07-21 01:38:54\" level=info msg=\"Finished querying state of the network, importing blocks...\" prefix=syncQuerier\r\ntime=\"2019-07-21 01:38:54\" level=info msg=\"Requesting state from peer\" canonicalSlot=341 peer=QmPWP3SDeqzuN9AFxeWpBzzPgbLBDRtcWdRBZZ4GR1wqR1 prefix=initial-sync\r\ntime=\"2019-07-21 01:38:54\" level=debug msg=\"Received new stream\" prefix=p2p topic=\"CHAIN_HEAD_RESPONSE\"\r\ntime=\"2019-07-21 01:38:54\" level=debug msg=\"Processing incoming message\" prefix=p2p topic=\"CHAIN_HEAD_RESPONSE\"\r\ntime=\"2019-07-21 01:38:54\" level=debug msg=\"Emit p2p message to feed subscribers\" msgName=ethereum.beacon.p2p.v1.ChainHeadResponse msgType=\"*ethereum_beacon_p2p_v1.ChainHeadResponse\" nu\r\nmSubs=0 prefix=p2p\r\ntime=\"2019-07-21 01:38:54\" level=debug msg=\"Received new stream\" prefix=p2p topic=\"BEACON_STATE_RESPONSE\"\r\ntime=\"2019-07-21 01:38:54\" level=debug msg=\"Processing incoming message\" prefix=p2p topic=\"BEACON_STATE_RESPONSE\"\r\ntime=\"2019-07-21 01:38:54\" level=debug msg=\"Emit p2p message to feed subscribers\" msgName=ethereum.beacon.p2p.v1.BeaconStateResponse msgType=\"*ethereum_beacon_p2p_v1.BeaconStateResponse\r\n\" numSubs=1 prefix=p2p\r\ntime=\"2019-07-21 01:38:54\" level=info msg=\"Received state resp from peer\" canonicalSlot=341 peer=QmPWP3SDeqzuN9AFxeWpBzzPgbLBDRtcWdRBZZ4GR1wqR1 prefix=initial-sync\r\ntime=\"2019-07-21 01:38:54\" level=debug msg=\"Successfully saved beacon state with the last finalized slot: 312\" prefix=initial-sync\r\ntime=\"2019-07-21 01:38:54\" level=info msg=\"Requesting batch blocks from peer\" peer=QmPWP3SDeqzuN9AFxeWpBzzPgbLBDRtcWdRBZZ4GR1wqR1 prefix=initial-sync\r\ntime=\"2019-07-21 01:38:54\" level=debug msg=\"Requesting batched blocks\" finalizedBlkRoot=0x74007f2e625a8c251fd8d4aa headBlkRoot=0xec15584a3f6f735207aec673 prefix=initial-sync\r\n...\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/513511973/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/513539945",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/3007#issuecomment-513539945",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3007",
    "id": 513539945,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMzUzOTk0NQ==",
    "user": {
      "login": "hadv",
      "id": 941411,
      "node_id": "MDQ6VXNlcjk0MTQxMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/941411?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hadv",
      "html_url": "https://github.com/hadv",
      "followers_url": "https://api.github.com/users/hadv/followers",
      "following_url": "https://api.github.com/users/hadv/following{/other_user}",
      "gists_url": "https://api.github.com/users/hadv/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hadv/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hadv/subscriptions",
      "organizations_url": "https://api.github.com/users/hadv/orgs",
      "repos_url": "https://api.github.com/users/hadv/repos",
      "events_url": "https://api.github.com/users/hadv/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hadv/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-21T09:56:56Z",
    "updated_at": "2019-07-21T09:56:56Z",
    "author_association": "NONE",
    "body": "+1\r\n\r\n```\r\n[2019-07-21 07:51:08]  WARN initial-sync: Failed to sync with peer, trying next best peer error=context deadline exceeded peer=QmZnDZgGzPZnM8dEimnhfGE7PugAZjBEpRvhR2ghhvNDWp\r\n[2019-07-21 07:51:08] FATAL initial-sync: Failed to sync with anyone...\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/513539945/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/513583234",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/3007#issuecomment-513583234",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3007",
    "id": 513583234,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMzU4MzIzNA==",
    "user": {
      "login": "nisdas",
      "id": 33201827,
      "node_id": "MDQ6VXNlcjMzMjAxODI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/33201827?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nisdas",
      "html_url": "https://github.com/nisdas",
      "followers_url": "https://api.github.com/users/nisdas/followers",
      "following_url": "https://api.github.com/users/nisdas/following{/other_user}",
      "gists_url": "https://api.github.com/users/nisdas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nisdas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nisdas/subscriptions",
      "organizations_url": "https://api.github.com/users/nisdas/orgs",
      "repos_url": "https://api.github.com/users/nisdas/repos",
      "events_url": "https://api.github.com/users/nisdas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nisdas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-21T20:01:55Z",
    "updated_at": "2019-07-21T20:01:55Z",
    "author_association": "MEMBER",
    "body": "The main reason batched responses are failing are because the finalized block root sent by the syncing peer is incorrect. How it gets the block root is basically by finding the signing root of the block header in the finalized state. Unfortunately this is incorrect, as the block header has a zeroed out state root to prevent circular dependencies. This would lead to different signing roots between the finalized block and the finalized block header in the state. \r\n\r\nThe solution to fix it would be to send in the finalized blocks with the finalized state in the state response.\r\nthis is being worked on over here: #3012 ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/513583234/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
