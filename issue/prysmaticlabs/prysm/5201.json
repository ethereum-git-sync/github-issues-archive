{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5201",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5201/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5201/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5201/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/5201",
  "id": 587441166,
  "node_id": "MDU6SXNzdWU1ODc0NDExNjY=",
  "number": 5201,
  "title": "\"Could not ssz marshal the genesis beacon state\" when generating a genesis state",
  "user": {
    "login": "Leibniz137",
    "id": 2193797,
    "node_id": "MDQ6VXNlcjIxOTM3OTc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2193797?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Leibniz137",
    "html_url": "https://github.com/Leibniz137",
    "followers_url": "https://api.github.com/users/Leibniz137/followers",
    "following_url": "https://api.github.com/users/Leibniz137/following{/other_user}",
    "gists_url": "https://api.github.com/users/Leibniz137/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Leibniz137/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Leibniz137/subscriptions",
    "organizations_url": "https://api.github.com/users/Leibniz137/orgs",
    "repos_url": "https://api.github.com/users/Leibniz137/repos",
    "events_url": "https://api.github.com/users/Leibniz137/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Leibniz137/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-03-25T04:53:02Z",
  "updated_at": "2020-03-25T16:41:27Z",
  "closed_at": "2020-03-25T16:41:27Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Problem Description:\r\nI use the following script to (attempt to) generate a genesis state in ssz format:\r\n```sh\r\n#!/bin/bash\r\n\r\n# run this in the root dir of this repo\r\nset -e\r\n\r\ndocker run \\\r\n  --rm \\\r\n  -it \\\r\n  --entrypoint bazel \\\r\n  --workdir /src \\\r\n  -v $(pwd):/src \\\r\n  -v bazel:/root/.cache/bazel \\\r\n  gcr.io/prysmaticlabs/build-agent \\\r\n    run //tools/genesis-state-gen -- --output-ssz /src/genesis.ssz --num-validators 64 --genesis-time 1567542540\r\n```\r\n\r\nWhich produces the following output:\r\n```\r\nDownloading https://releases.bazel.build/2.1.1/release/bazel-2.1.1-linux-x86_64...\r\nExtracting Bazel installation...\r\nStarting local Bazel server and connecting to it...\r\nDEBUG: Rule 'com_google_protobuf' indicated that a canonical reproducible form can be obtained by modifying arguments shallow_since = \"1580418511 -0800\"\r\nDEBUG: Call stack for the definition of repository 'com_google_protobuf' which is a git_repository (rule definition at /root/.cache/bazel/_bazel_root/f8087e59fd95af1ae29e8fcb7ff1a3dc/external/bazel_tools/tools/bu\r\nild_defs/repo/git.bzl:195:18):\r\n - /src/WORKSPACE:241:1\r\n - /src/WORKSPACE:241:1\r\nDEBUG: /root/.cache/bazel/_bazel_root/f8087e59fd95af1ae29e8fcb7ff1a3dc/external/bazel_toolchains/rules/rbe_repo/checked_in.bzl:100:9: rbe_ubuntu_clang_gen not using checked in configs as user set attr to 'False'\r\nDEBUG: /root/.cache/bazel/_bazel_root/f8087e59fd95af1ae29e8fcb7ff1a3dc/external/bazel_toolchains/rules/rbe_repo/checked_in.bzl:100:9: rbe_ubuntu_gcc_gen not using checked in configs as user set attr to 'False'\r\nDEBUG: /root/.cache/bazel/_bazel_root/f8087e59fd95af1ae29e8fcb7ff1a3dc/external/bazel_gazelle/internal/go_repository.bzl:184:13: com_googlesource_roughtime_roughtime_git: gazelle: unrecognized import path \"rought\r\nime.googlesource.com/go/client/monotime\"\r\ngazelle: unrecognized import path \"roughtime.googlesource.com/go/config\"\r\ngazelle: unrecognized import path \"roughtime.googlesource.com/go/protocol\"\r\ngazelle: unrecognized import path \"roughtime.googlesource.com/go/config\"\r\ngazelle: unrecognized import path \"roughtime.googlesource.com/go/protocol\"\r\ngazelle: unrecognized import path \"roughtime.googlesource.com/go/config\"\r\ngazelle: unrecognized import path \"roughtime.googlesource.com/go/protocol\"\r\nINFO: Analyzed target //tools/genesis-state-gen:genesis-state-gen (312 packages loaded, 9441 targets configured).\r\nINFO: Found 1 target...\r\nINFO: From Generating Descriptor Set proto_library @com_github_prysmaticlabs_ethereumapis//eth/v1alpha1:proto:\r\neth/v1alpha1/beacon_chain.proto:21:1: warning: Import google/protobuf/any.proto is unused.\r\nINFO: From Generating into bazel-out/k8-fastbuild/bin/external/com_github_prysmaticlabs_ethereumapis/eth/v1alpha1/linux_amd64_stripped/go_proto%/github.com/prysmaticlabs/ethereumapis/eth/v1alpha1:\r\neth/v1alpha1/beacon_chain.proto: warning: Import google/protobuf/any.proto is unused.\r\nTarget //tools/genesis-state-gen:genesis-state-gen up-to-date:\r\n  bazel-bin/tools/genesis-state-gen/linux_amd64_stripped/genesis-state-gen\r\nINFO: Elapsed time: 686.183s, Critical Path: 19.30s\r\nINFO: 734 processes: 734 processwrapper-sandbox.\r\nINFO: Build completed successfully, 762 total actions\r\nINFO: Build completed successfully, 762 total actions\r\n2020/03/25 04:04:17 Could not ssz marshal the genesis beacon state: incorrect vector marshalling\r\n```\r\n\r\n## YAML works fine!\r\nInterestingly, I am able to produce yaml genesis state:\r\n```\r\n#!/bin/bash\r\n\r\n# this works fine!\r\nset -e\r\n\r\ndocker run \\\r\n  --rm \\\r\n  -it \\\r\n  --entrypoint bazel \\\r\n  --workdir /src \\\r\n  -v $(pwd):/src \\\r\n  -v bazel:/root/.cache/bazel \\\r\n  gcr.io/prysmaticlabs/build-agent \\\r\n    run //tools/genesis-state-gen -- --output-yaml /src/genesis.yaml --num-validators 64 --genesis-time 1567542540\r\n```\r\n\r\n## Looking at the source\r\nIt appears that the ssz.Marshal function doesn't like the genesis state that is produced:\r\n```\r\nencodedState, err := ssz.Marshal(genesisState)\r\nif err != nil {\r\n\tlog.Fatalf(\"Could not ssz marshal the genesis beacon state: %v\", err)\r\n}\r\n```\r\nhttps://github.com/prysmaticlabs/prysm/blob/master/tools/genesis-state-gen/main.go#L44\r\n\r\n\r\nA temporary workaround would be great too. I hit this issue in the process of trying to create a genesis state for use in a toy-sized, standalone testnet (no eth1 chain).\r\n\r\nüôè",
  "closed_by": {
    "login": "Leibniz137",
    "id": 2193797,
    "node_id": "MDQ6VXNlcjIxOTM3OTc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2193797?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Leibniz137",
    "html_url": "https://github.com/Leibniz137",
    "followers_url": "https://api.github.com/users/Leibniz137/followers",
    "following_url": "https://api.github.com/users/Leibniz137/following{/other_user}",
    "gists_url": "https://api.github.com/users/Leibniz137/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Leibniz137/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Leibniz137/subscriptions",
    "organizations_url": "https://api.github.com/users/Leibniz137/orgs",
    "repos_url": "https://api.github.com/users/Leibniz137/repos",
    "events_url": "https://api.github.com/users/Leibniz137/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Leibniz137/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5201/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5201/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/603852933",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5201#issuecomment-603852933",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5201",
    "id": 603852933,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMzg1MjkzMw==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-25T13:55:21Z",
    "updated_at": "2020-03-25T13:56:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @Leibniz137 was able to reproduce and was able to fix by using the following flags:\r\n```\r\nbazel run //tools/genesis-state-gen --define=ssz=mainnet -- \\\r\n  --output-ssz /tmp/genesis.ssz \\\r\n  --num-validators 64 \\\r\n  --genesis-time 1567542540 \\\r\n  --mainnet-config\r\n```\r\ncould you try that out?",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/603852933/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/603950749",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5201#issuecomment-603950749",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5201",
    "id": 603950749,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMzk1MDc0OQ==",
    "user": {
      "login": "Leibniz137",
      "id": 2193797,
      "node_id": "MDQ6VXNlcjIxOTM3OTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2193797?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Leibniz137",
      "html_url": "https://github.com/Leibniz137",
      "followers_url": "https://api.github.com/users/Leibniz137/followers",
      "following_url": "https://api.github.com/users/Leibniz137/following{/other_user}",
      "gists_url": "https://api.github.com/users/Leibniz137/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Leibniz137/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Leibniz137/subscriptions",
      "organizations_url": "https://api.github.com/users/Leibniz137/orgs",
      "repos_url": "https://api.github.com/users/Leibniz137/repos",
      "events_url": "https://api.github.com/users/Leibniz137/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Leibniz137/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-25T16:41:27Z",
    "updated_at": "2020-03-25T16:41:27Z",
    "author_association": "NONE",
    "body": "yes that worked, thank you!",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/603950749/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
