{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10197",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10197/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10197/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10197/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/10197",
  "id": 1126675732,
  "node_id": "I_kwDOBvuov85DJ7UU",
  "number": 10197,
  "title": "Abstracting Time and Tickers from Prysm's Core Implementation",
  "user": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129906,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDY=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Enhancement",
      "name": "Enhancement",
      "color": "84b6eb",
      "default": false,
      "description": "New feature or request"
    },
    {
      "id": 934596141,
      "node_id": "MDU6TGFiZWw5MzQ1OTYxNDE=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Discussion",
      "name": "Discussion",
      "color": "f9d0c4",
      "default": false,
      "description": "Simply a thread for talking about stuff"
    },
    {
      "id": 1085357783,
      "node_id": "MDU6TGFiZWwxMDg1MzU3Nzgz",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Priority:%20Low",
      "name": "Priority: Low",
      "color": "26f7bd",
      "default": false,
      "description": "Low priority item"
    },
    {
      "id": 2061040048,
      "node_id": "MDU6TGFiZWwyMDYxMDQwMDQ4",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Sync",
      "name": "Sync",
      "color": "5967ba",
      "default": false,
      "description": "Sync (regular, initial, checkpoint) related issues"
    },
    {
      "id": 3126461723,
      "node_id": "MDU6TGFiZWwzMTI2NDYxNzIz",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/E2E%20Tests",
      "name": "E2E Tests",
      "color": "1C4D5E",
      "default": false,
      "description": "End-To-End testing"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-02-08T01:10:28Z",
  "updated_at": "2022-08-15T21:17:08Z",
  "closed_at": "2022-08-15T21:17:08Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# ðŸ’Ž Issue\r\n\r\nThanks @kasey for bringing this up in our conversations.\r\n\r\n### Background\r\n\r\nEthereum's consensus protocol, [Gasper](https://arxiv.org/abs/2003.03052), is a synchronous one. This means time is a critical part of its functionality and security. As Prysm implements the [specification](https://github.com/ethereum/consensus-specs), we use time quite a lot. Unfortunately, using the actual `time` package from the standard library, dealing with timestamps and tickers becomes tricky when writing tests and simulating a blockchain environment. Today, we use the standard library for a lot of our tests. **However**, the consensus protocol at a high-level only has the concept of time ticks, which are abstract intervals, and not specific periods of seconds/milliseconds/etc. Even in places where the specification mentions the concept of seconds, it is in the context of intervals, which can be abstracted.\r\n\r\nThe goal of this issue is to consider a revamp in Prysm where we abstract the concept of time as much as possible from the chain, such that we can have full, programmatic control of \"ticks\". This allows us to do really interesting things, such as:\r\n\r\n1. Warp debugging: we could easily advance through a chain in the future using programmatic ticks in our unit tests\r\n2. Lightning-fast, integration tests and chain simulations: today, our end-to-end test suite uses actual slot ticks from a ticker in the standard library to advance a chain state. We could instead advance through e2e tests as fast as our machines will allow if we have abstract time tickers\r\n3. Unit tests become easier to write: today, many tests in Prysm do manual operations with time, such as adding, subtracting, dealing with milliseconds/seconds, etc. This detracts from the main logic we care about testing.\r\n\r\n### Description\r\n\r\nA deliverable that resolves this is a design document which analyzes all places where Prysm relies on the actual `time` package from the standard library, and understand how that code could be refactored to abstract the concept of time. We do this today in many places, as we define our own `SlotTicker` inside of the `slots` package in [github.com/prysmaticlabs/prysm/time/slots](https://github.com/prysmaticlabs/prysm/time/slots). However, its usage is not uniform. There are many place we perform concrete time operations, especially in unit tests, in the validator client, and parts of the runtime such as the `powchain`, `blockchain`, `operations` packages and even in places such as caches.\r\n\r\nMessing with time in Prysm is [risky business](https://medium.com/prysmatic-labs/eth2-medalla-testnet-incident-f7fbc3cc934a). This issue is non-trivial, and requires significant risk analysis (it is possible this is not worth the time and effort). At the very least, making use of our slot ticker more uniform would be a good time investment, as it could allow us to write integration tests and simulations where we can advance a chain as fast as a machine could go.\r\n\r\nThis issue is open for discussion.\r\n",
  "closed_by": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10197/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10197/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1215833713",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/10197#issuecomment-1215833713",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10197",
    "id": 1215833713,
    "node_id": "IC_kwDOBvuov85IeCZx",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-15T21:17:08Z",
    "updated_at": "2022-08-15T21:17:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think the risk-reward ratio of doing this is too high, and don't see major benefits aside from easier testing. However, we are not really constrained on testing due to time and there are far too many things to build that I would rather close this idea",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1215833713/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
