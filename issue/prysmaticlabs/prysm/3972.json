{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3972",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3972/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3972/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3972/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/3972",
  "id": 521190793,
  "node_id": "MDU6SXNzdWU1MjExOTA3OTM=",
  "number": 3972,
  "title": "confused about epoch boundries and their respective blocks",
  "user": {
    "login": "tzapu",
    "id": 2983312,
    "node_id": "MDQ6VXNlcjI5ODMzMTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2983312?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tzapu",
    "html_url": "https://github.com/tzapu",
    "followers_url": "https://api.github.com/users/tzapu/followers",
    "following_url": "https://api.github.com/users/tzapu/following{/other_user}",
    "gists_url": "https://api.github.com/users/tzapu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tzapu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tzapu/subscriptions",
    "organizations_url": "https://api.github.com/users/tzapu/orgs",
    "repos_url": "https://api.github.com/users/tzapu/repos",
    "events_url": "https://api.github.com/users/tzapu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tzapu/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2019-11-11T21:14:51Z",
  "updated_at": "2019-11-19T19:33:14Z",
  "closed_at": "2019-11-19T19:33:14Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "hi guys,\r\n\r\nthe issue i have is from the point of view of an api user.\r\n\r\nfor some stuff it's a whole lot easier to reason in epochs rather than slots, like finalized and justified epochs, yet the api does not have a way of getting the current/justified/finalized epochs, just slots via `beacon/chainhead`. \r\nas i understand it, if we consider the number of slots in an epoch to be 8, epoch 0 would be slots 0-7, epoch 1 8-15 and so on. if we consider epoch 0 to be finalized, then `beacon/chainhead` seems to return end of epoch + 1 as the finalizedSlot, in the example above that would be 8, which increases confusion (for me at least). \r\n\r\nWhy is the finalized slot not the end slot of the epoch if that is when the transition happens? Could the api docs mention anything on how to compute the epochs properly or, even better, could the api return epochs as well in chainhead to ease the  confusion?\r\n\r\nthanks guys for all your hard work",
  "closed_by": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3972/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3972/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/553364664",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/3972#issuecomment-553364664",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3972",
    "id": 553364664,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1MzM2NDY2NA==",
    "user": {
      "login": "tzapu",
      "id": 2983312,
      "node_id": "MDQ6VXNlcjI5ODMzMTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2983312?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tzapu",
      "html_url": "https://github.com/tzapu",
      "followers_url": "https://api.github.com/users/tzapu/followers",
      "following_url": "https://api.github.com/users/tzapu/following{/other_user}",
      "gists_url": "https://api.github.com/users/tzapu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tzapu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tzapu/subscriptions",
      "organizations_url": "https://api.github.com/users/tzapu/orgs",
      "repos_url": "https://api.github.com/users/tzapu/repos",
      "events_url": "https://api.github.com/users/tzapu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tzapu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-13T11:35:21Z",
    "updated_at": "2019-11-13T11:35:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "hey @prestonvanloon @terencechain maybe you could shed some light for me on the above. \r\nmostly looking into confirmation if epoch 0 would contain slots 0-7 and if that is the case, why does `beacon/chainhead` return as justifiedSlot/finalizedSlot the end of epoch + 1 (in case of epoch 0 it would return 8), should it not return the actual end of the epoch?\r\nthanks",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/553364664/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/555129027",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/3972#issuecomment-555129027",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3972",
    "id": 555129027,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NTEyOTAyNw==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-18T17:46:09Z",
    "updated_at": "2019-11-18T17:46:09Z",
    "author_association": "MEMBER",
    "body": "Hey @tzapu, sorry for the delay here!\r\n\r\nWhen we finalize an epoch, the state's [finalized checkpoint](https://github.com/prysmaticlabs/prysm/blob/f43a7c67f222ac1325fc4a205cff8cb70faf1f25/proto/beacon/p2p/v1/types.proto#L45)  is updated. \r\n\r\nhttps://github.com/prysmaticlabs/prysm/blob/f43a7c67f222ac1325fc4a205cff8cb70faf1f25/proto/eth/v1alpha1/attestation.proto#L48-L56\r\n\r\nIf we finalized epoch 10, the checkpoint would have epoch=10 and a block root of the highest slot block in the finalized chain, up to slot 80 (start slot of epoch 10). If there were no block produced at slot 80, the root would point to 79 unless that were a skip slot, then it would point to 78 and so on.\r\n\r\nLooking at the GetChainHead implementation:\r\n\r\nhttps://github.com/prysmaticlabs/prysm/blob/199ddc6cdb2f8655743845ab33abdcc178d790ae/beacon-chain/rpc/beacon/blocks.go#L136-L151\r\n\r\nWe are setting \"finalizedSlot\" field to naively be epoch*SLOTS_PER_EPOCH which is not always correct based on the information I just described.\r\n\r\nHere are a few suggestions:\r\n- Look up the block root in the database, set the finalized / justified slots to the slot that the block actually represents\r\n- Also return the epoch number for head / finalized / justified, etc\r\n\r\nHere's my proposal response for GetChainHead:\r\n```protobuf\r\nmessage ChainHead {\r\n    bytes head_block_root = 1 [(gogoproto.moretags) = \"ssz-size:\\\"32\\\"\"];\r\n    uint64 head_block_slot = 2;\r\n    uint64 head_block_epoch = 3;\r\n\r\n    uint64 finalized_slot = 4; // Not always equal to finalized_epoch * SLOTS_PER_EPOCH\r\n    uint64 finalized_epoch = 5;\r\n    bytes finalized_block_root = 6 [(gogoproto.moretags) = \"ssz-size:\\\"32\\\"\"];\r\n\r\n    uint64 justified_slot = 7;\r\n    uint64 justified_epoch = 8;\r\n    bytes justified_block_root = 9 [(gogoproto.moretags) = \"ssz-size:\\\"32\\\"\"];\r\n\r\n    uint64 previous_justified_slot = 10;\r\n    uint64 previous_justified_epoch = 11;\r\n    bytes previous_justified_block_root = 12 [(gogoproto.moretags) = \"ssz-size:\\\"32\\\"\"];\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/555129027/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/555187592",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/3972#issuecomment-555187592",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3972",
    "id": 555187592,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NTE4NzU5Mg==",
    "user": {
      "login": "terencechain",
      "id": 21316537,
      "node_id": "MDQ6VXNlcjIxMzE2NTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/terencechain",
      "html_url": "https://github.com/terencechain",
      "followers_url": "https://api.github.com/users/terencechain/followers",
      "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
      "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
      "organizations_url": "https://api.github.com/users/terencechain/orgs",
      "repos_url": "https://api.github.com/users/terencechain/repos",
      "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/terencechain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-18T20:08:39Z",
    "updated_at": "2019-11-18T20:08:50Z",
    "author_association": "MEMBER",
    "body": "Suggesting to use `block_slot` instead of `slot`:\r\n\r\n```proto\r\nmessage ChainHead {\r\n    bytes head_block_root = 1 [(gogoproto.moretags) = \"ssz-size:\\\"32\\\"\"];\r\n    uint64 head_block_slot = 2;\r\n    uint64 head_block_epoch = 3;\r\n\r\n    uint64 finalized_block_slot = 4; // Not always equal to finalized_epoch * SLOTS_PER_EPOCH\r\n    uint64 finalized_epoch = 5;\r\n    bytes finalized_block_root = 6 [(gogoproto.moretags) = \"ssz-size:\\\"32\\\"\"];\r\n\r\n    uint64 justified_block_slot = 7;\r\n    uint64 justified_epoch = 8;\r\n    bytes justified_block_root = 9 [(gogoproto.moretags) = \"ssz-size:\\\"32\\\"\"];\r\n\r\n    uint64 previous_justified_block_slot = 10;\r\n    uint64 previous_justified_epoch = 11;\r\n    bytes previous_justified_block_root = 12 [(gogoproto.moretags) = \"ssz-size:\\\"32\\\"\"];\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/555187592/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/555424929",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/3972#issuecomment-555424929",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/3972",
    "id": 555424929,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NTQyNDkyOQ==",
    "user": {
      "login": "tzapu",
      "id": 2983312,
      "node_id": "MDQ6VXNlcjI5ODMzMTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2983312?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tzapu",
      "html_url": "https://github.com/tzapu",
      "followers_url": "https://api.github.com/users/tzapu/followers",
      "following_url": "https://api.github.com/users/tzapu/following{/other_user}",
      "gists_url": "https://api.github.com/users/tzapu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tzapu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tzapu/subscriptions",
      "organizations_url": "https://api.github.com/users/tzapu/orgs",
      "repos_url": "https://api.github.com/users/tzapu/repos",
      "events_url": "https://api.github.com/users/tzapu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tzapu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-19T09:54:07Z",
    "updated_at": "2019-11-19T09:55:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "hey guys, thanks for this, the above reponse changes seem great. at first look they sort out all the issues without having to do any other lookups (on the api consuming side)\r\ncheers",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/555424929/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
