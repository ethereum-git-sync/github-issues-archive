{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7296",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7296/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7296/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7296/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/7296",
  "id": 706045214,
  "node_id": "MDU6SXNzdWU3MDYwNDUyMTQ=",
  "number": 7296,
  "title": "Multiple Ctrl-C 's required to stop beacon chain.",
  "user": {
    "login": "Domintek",
    "id": 26261012,
    "node_id": "MDQ6VXNlcjI2MjYxMDEy",
    "avatar_url": "https://avatars.githubusercontent.com/u/26261012?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Domintek",
    "html_url": "https://github.com/Domintek",
    "followers_url": "https://api.github.com/users/Domintek/followers",
    "following_url": "https://api.github.com/users/Domintek/following{/other_user}",
    "gists_url": "https://api.github.com/users/Domintek/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Domintek/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Domintek/subscriptions",
    "organizations_url": "https://api.github.com/users/Domintek/orgs",
    "repos_url": "https://api.github.com/users/Domintek/repos",
    "events_url": "https://api.github.com/users/Domintek/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Domintek/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129904,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDQ=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Bug",
      "name": "Bug",
      "color": "ee0701",
      "default": false,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "farazdagi",
    "id": 188194,
    "node_id": "MDQ6VXNlcjE4ODE5NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/188194?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/farazdagi",
    "html_url": "https://github.com/farazdagi",
    "followers_url": "https://api.github.com/users/farazdagi/followers",
    "following_url": "https://api.github.com/users/farazdagi/following{/other_user}",
    "gists_url": "https://api.github.com/users/farazdagi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/farazdagi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/farazdagi/subscriptions",
    "organizations_url": "https://api.github.com/users/farazdagi/orgs",
    "repos_url": "https://api.github.com/users/farazdagi/repos",
    "events_url": "https://api.github.com/users/farazdagi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/farazdagi/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "farazdagi",
      "id": 188194,
      "node_id": "MDQ6VXNlcjE4ODE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/188194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/farazdagi",
      "html_url": "https://github.com/farazdagi",
      "followers_url": "https://api.github.com/users/farazdagi/followers",
      "following_url": "https://api.github.com/users/farazdagi/following{/other_user}",
      "gists_url": "https://api.github.com/users/farazdagi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/farazdagi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/farazdagi/subscriptions",
      "organizations_url": "https://api.github.com/users/farazdagi/orgs",
      "repos_url": "https://api.github.com/users/farazdagi/repos",
      "events_url": "https://api.github.com/users/farazdagi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/farazdagi/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-09-22T03:09:12Z",
  "updated_at": "2020-10-08T15:16:13Z",
  "closed_at": "2020-10-08T15:02:19Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<\r\n!--üíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé\r\n\r\nHellooo! üòÑ \r\n\r\nTo help us tend to your issue faster, please search our currently open issues before submitting a new one.\r\nExisting issues often contain information about workarounds, resolution, or progress updates.\r\n\r\nüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé-->\r\n\r\n# üêû Bug Report\r\n\r\n### Description\r\n\r\n\r\nWhen I use Ctrl-C to stop my prysm.sh script, I have had to do multiple Ctrl-C's, 10 to 11 instances before the script stops.\r\n\r\n\r\n### Has this worked before in a previous version? I never experienced this prior to the 9th of Sept 2020 and have been running Prysm consistently through all versions since January so have had experience with multiple hardware and Prysm versions.\r\n\r\n<!-- Did this behavior use to work in the previous version? --> I first noticed it on the 9th of September 2020 with the latest version at the time.\r\n\r\n\r\n## üî¨ Minimal Reproduction\r\n\r\n<!--\r\nPlease let us know how we can reproduce this issue. Include the exact method you used to run Prysm along with any flags used in your beacon chain and/or validator. Make sure you don't upload any confidential files or private keys.\r\n--> Starting script:   ./prysm.sh beacon-chain --http-web3provider=https://goerli.prylabs.net --p2p-max-peers=30 --clear-db\r\n\r\n## üî• Error\r\n\r\n<pre><code>\r\n<!-- If the issue is accompanied by an error, please share the error logs with us below. If you have a lot of logs, place make a paste bin with your logs and share the link with us here: -->\r\n<!-- ‚úçÔ∏è-->\r\n\r\n</code></pre>  \r\n[2020-09-08 13:48:35]  INFO blockchain: Synced new block block=0x33b0c12e... epoch=7920 finalizedEpoch=7918 finalizedRoot=0xc0079c1a... slot=253442 slotInEpoch=2\r\n[2020-09-08 13:48:35]  INFO blockchain: Finished applying state transition attestations=124 attesterSlashings=0 deposits=0 proposerSlashings=0 voluntaryExits=0\r\n[2020-09-08 13:48:57]  INFO blockchain: Synced new block block=0xe71b4d0e... epoch=7920 finalizedEpoch=7918 finalizedRoot=0xc0079c1a... slot=253444 slotInEpoch=4\r\n[2020-09-08 13:48:57]  INFO blockchain: Finished applying state transition attestations=54 attesterSlashings=0 deposits=0 proposerSlashings=0 voluntaryExits=0\r\n^C[2020-09-08 13:49:07]  INFO node: Got interrupt, shutting down...\r\n[2020-09-08 13:49:07]  INFO node: Stopping beacon node\r\n[2020-09-08 13:49:07]  WARN sync: Subscription next failed error=context canceled topic=/eth2/e7a75d5a/beacon_block/ssz_snappy\r\n[2020-09-08 13:49:07]  WARN sync: Subscription next failed error=context canceled topic=/eth2/e7a75d5a/beacon_aggregate_and_proof/ssz_snappy\r\n[2020-09-08 13:49:07]  WARN sync: Subscription next failed error=context canceled topic=/eth2/e7a75d5a/proposer_slashing/ssz_snappy\r\n[2020-09-08 13:49:07]  WARN sync: Subscription next failed error=context canceled topic=/eth2/e7a75d5a/attester_slashing/ssz_snappy\r\n[2020-09-08 13:49:07]  WARN sync: Subscription next failed error=context canceled topic=/eth2/e7a75d5a/voluntary_exit/ssz_snappy\r\n[2020-09-08 13:49:32]  INFO p2p: Peer disconnected activePeers=28 multiAddr=/ip4/3.14.66.221/tcp/9000/p2p/16Uiu2HAm8iWjrgA5GMGYx5jTJYcwGW8wkXu74J6tpkhmtPtSfqBn\r\n[2020-09-08 13:49:37]  INFO p2p: Peer disconnected activePeers=27 multiAddr=/ip4/149.28.11.98/tcp/9000/p2p/16Uiu2HAmCvH5sWvpUeZywi8FitDtr5QJ7doYo8vGTS2sJKZkUj15\r\n^C[2020-09-08 13:51:11]  INFO node: Already shutting down, interrupt more to panic times=9\r\n^C[2020-09-08 13:51:27]  INFO node: Already shutting down, interrupt more to panic times=8\r\n^C[2020-09-08 13:51:28]  INFO node: Already shutting down, interrupt more to panic times=7\r\n^C[2020-09-08 13:51:28]  INFO node: Already shutting down, interrupt more to panic times=6\r\n^C[2020-09-08 13:51:28]  INFO node: Already shutting down, interrupt more to panic times=5\r\n^C[2020-09-08 13:51:29]  INFO node: Already shutting down, interrupt more to panic times=4\r\n^C[2020-09-08 13:51:30]  INFO node: Already shutting down, interrupt more to panic times=3\r\n^C[2020-09-08 13:51:31]  INFO node: Already shutting down, interrupt more to panic times=2\r\n^C[2020-09-08 13:51:31]  INFO node: Already shutting down, interrupt more to panic times=1\r\n^Cpanic: Panic closing the beacon node\r\n\r\ngoroutine 230 [running]:\r\ngithub.com/prysmaticlabs/prysm/beacon-chain/node.(*BeaconNode).Start.func1(0x40003080c0)\r\n        beacon-chain/node/node.go:265 +0x2b0\r\ncreated by github.com/prysmaticlabs/prysm/beacon-chain/node.(*BeaconNode).Start\r\n        beacon-chain/node/node.go:251 +0x180\r\n\r\n\r\n## üåç  Your Environment\r\n\r\n**Operating System:**  Raspberry Pi4 w/8gb ram with beacon node running on linux arm64. I had the same problem on a Win10 machine with 32 Gb ram running inside docker. The only change in the Win 10 set up is that max-peers=100. Eth2stats is running in docker on both machines which is where I noticed the declining peer numbers.\r\n\r\n<pre>\r\n  <code>\r\n\r\n  </code>\r\n</pre>\r\n\r\n**What version of Prysm are you running? (Which release)** Latest as of 9 September up to including Alpha 25\r\n\r\n<pre>\r\n  <code>\r\n\r\n  </code>\r\n</pre>\r\n\r\n**Anything else relevant (validator index / public key)?** This problem seems to manifest itself when the beacon nodes peer count begins to decrease after running well for several days. It seems that the beacon node begins to lose peers, more than it picks up the loss out weighs the gain in peers. Usually when that happens, within 36 to 48 hours the peer count will drop about 70%, That is the point at which I restart the beacon node and noticed the multiple Ctrl-Cs required to stop the script. This spamming only seems to occur during the process of losing peers which may or not be related. This Ctrl-C spamming has happened three times since the 9th of September both on the Pi4 and the Win 10 nodes.\r\n\r\n",
  "closed_by": {
    "login": "farazdagi",
    "id": 188194,
    "node_id": "MDQ6VXNlcjE4ODE5NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/188194?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/farazdagi",
    "html_url": "https://github.com/farazdagi",
    "followers_url": "https://api.github.com/users/farazdagi/followers",
    "following_url": "https://api.github.com/users/farazdagi/following{/other_user}",
    "gists_url": "https://api.github.com/users/farazdagi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/farazdagi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/farazdagi/subscriptions",
    "organizations_url": "https://api.github.com/users/farazdagi/orgs",
    "repos_url": "https://api.github.com/users/farazdagi/repos",
    "events_url": "https://api.github.com/users/farazdagi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/farazdagi/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7296/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7296/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/696627720",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/7296#issuecomment-696627720",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7296",
    "id": 696627720,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5NjYyNzcyMA==",
    "user": {
      "login": "shayzluf",
      "id": 5848741,
      "node_id": "MDQ6VXNlcjU4NDg3NDE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5848741?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shayzluf",
      "html_url": "https://github.com/shayzluf",
      "followers_url": "https://api.github.com/users/shayzluf/followers",
      "following_url": "https://api.github.com/users/shayzluf/following{/other_user}",
      "gists_url": "https://api.github.com/users/shayzluf/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shayzluf/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shayzluf/subscriptions",
      "organizations_url": "https://api.github.com/users/shayzluf/orgs",
      "repos_url": "https://api.github.com/users/shayzluf/repos",
      "events_url": "https://api.github.com/users/shayzluf/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shayzluf/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-22T10:07:09Z",
    "updated_at": "2020-09-22T10:07:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "@farazdagi seems related to p2p , please reassign to me if you think its inappropriate ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/696627720/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/705630890",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/7296#issuecomment-705630890",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7296",
    "id": 705630890,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTYzMDg5MA==",
    "user": {
      "login": "farazdagi",
      "id": 188194,
      "node_id": "MDQ6VXNlcjE4ODE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/188194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/farazdagi",
      "html_url": "https://github.com/farazdagi",
      "followers_url": "https://api.github.com/users/farazdagi/followers",
      "following_url": "https://api.github.com/users/farazdagi/following{/other_user}",
      "gists_url": "https://api.github.com/users/farazdagi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/farazdagi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/farazdagi/subscriptions",
      "organizations_url": "https://api.github.com/users/farazdagi/orgs",
      "repos_url": "https://api.github.com/users/farazdagi/repos",
      "events_url": "https://api.github.com/users/farazdagi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/farazdagi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-08T15:02:19Z",
    "updated_at": "2020-10-08T15:02:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "I've reviewed the code behind the functionality. This is how it was implemented:\r\n- With termination signal (`Ctrl+C`) one is able to interrupt the program.\r\n- Once interrupted, node starts to close all its services, sometimes it takes some time to close all routines (depending on the system load, and load within the application i.e. what app is doing at the moment).\r\n- One is still able to force node's immediate shut down without any grace period, by repeatedly sending signals (x10 `Ctrl + C`).\r\n\r\nSo, the above-mentioned design is there intentionally: to allow graceful node shutdowns of all the services.\r\n\r\nClosing this issue, as there's nothing actionable, atm. If it happens that node (on SIGTERM) never shuts down w/o multiple `Ctrl + C` (but give it several seconds, pls), feel free to reopen.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/705630890/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/705639741",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/7296#issuecomment-705639741",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7296",
    "id": 705639741,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNTYzOTc0MQ==",
    "user": {
      "login": "farazdagi",
      "id": 188194,
      "node_id": "MDQ6VXNlcjE4ODE5NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/188194?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/farazdagi",
      "html_url": "https://github.com/farazdagi",
      "followers_url": "https://api.github.com/users/farazdagi/followers",
      "following_url": "https://api.github.com/users/farazdagi/following{/other_user}",
      "gists_url": "https://api.github.com/users/farazdagi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/farazdagi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/farazdagi/subscriptions",
      "organizations_url": "https://api.github.com/users/farazdagi/orgs",
      "repos_url": "https://api.github.com/users/farazdagi/repos",
      "events_url": "https://api.github.com/users/farazdagi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/farazdagi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-08T15:16:12Z",
    "updated_at": "2020-10-08T15:16:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "Further update: the issue with peer discovery should be solved in https://github.com/prysmaticlabs/prysm/pull/7434",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/705639741/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
