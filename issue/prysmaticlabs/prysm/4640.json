{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4640",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4640/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4640/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4640/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/4640",
  "id": 554496950,
  "node_id": "MDU6SXNzdWU1NTQ0OTY5NTA=",
  "number": 4640,
  "title": "Slashing Prevention Solutions: Prevent validator from running twice in 4 different situations",
  "user": {
    "login": "ghost",
    "id": 10137,
    "node_id": "MDQ6VXNlcjEwMTM3",
    "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ghost",
    "html_url": "https://github.com/ghost",
    "followers_url": "https://api.github.com/users/ghost/followers",
    "following_url": "https://api.github.com/users/ghost/following{/other_user}",
    "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
    "organizations_url": "https://api.github.com/users/ghost/orgs",
    "repos_url": "https://api.github.com/users/ghost/repos",
    "events_url": "https://api.github.com/users/ghost/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ghost/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2020-01-24T01:16:21Z",
  "updated_at": "2020-03-16T15:37:13Z",
  "closed_at": "2020-03-16T15:37:13Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Here are some thoughts on how to prevent validator from running twice in same machine, or 2 machines on LAN, or 2 sites over internet, and hacking\r\n\r\nRunning 2 instances of validator against same set of key pairs will lead to slashing.\r\n\r\nIt actually happened, see Cosmos incident report at https://twitter.com/zmanian/status/1145072296723275776\r\n\r\nPreventing that from happening is critical.\r\n\r\nPrevention should be and can be done from the combination of two fronts: coding and operation, both with best practice.\r\n\r\nPr-conditions\r\n\r\n    A machine could have multi-clients running.\r\n    Key stores should be in unify format across client implementations, created once and shared in all clients.\r\n\r\nCase 1 - same machine\r\n\r\nOperation side: Only keep one copy of key stores in the machine. Only keep one copy of binary executable in the machine. Backup copy stays offline.\r\n\r\nCoding side: At startup, validator process put an exclusive lock on db. Prysm has already implemented this feature. lighthouse has not.\r\n\r\n\t\t\t Validator could also check process name, make sure only one instance of process is running.\r\n\t\t\t However, multi-client's validators could have different process name.\r\n\r\nCase 2 - 2 machine on LAN\r\n\r\nOperation side: 2 machines as main & backup\r\n\r\nSame set of key pairs on each machine, still one copy on a machine.\r\nBackup is active but not load balancing, not cluster, i.e., \r\nboth run a beacon node to keep chain data current for quick switch over,\r\nbut only one validator instance, only one machine runs validator. \r\n\r\nSwitch over is manual - stop the running validator, and start validator on another machine.\r\n\r\nCoding side: lock a flag file on network share, similar to local db locking Flag file is pre-configed. When validator starts, check and lock flag file. If it can't be locked, that means another machine locks it, then report the problem and quit.\r\nCase 3 - 2 sites over internet\r\n\r\nOperation side: 2 sites as main & backup Same set of key pairs on each site, only one site runs validator\r\n\r\nCoding side: do a handshake, or similar communication, between 2 sites\r\nCase 4 - hacking\r\n\r\nOnce hacker get access to key store and password, they could just run another validator on their machine, causing great harm to mainnet and the staker.\r\n\r\nTo fight hacking, advance prevention mechanism is needed.\r\n\r\nPolkadot has done something, see a twit at https://twitter.com/jeffburdges/status/1146078447514587138\r\n\r\nIt is better to stop the attack from happening, than find out and remediate it after the fact.\r\n\r\nThe ultimate prevention mechanism maybe this: when validator process starts, check the network, see if a stake or key store is already in use / being used / performing, if not go ahead and use it; if it is in use but being idle for long time, forcefully go ahead.\r\n\r\nThe goal is to make hacking harder, to the point of not worth of the effort.",
  "closed_by": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4640/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4640/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/580337133",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4640#issuecomment-580337133",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4640",
    "id": 580337133,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4MDMzNzEzMw==",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-30T16:28:50Z",
    "updated_at": "2020-01-30T16:28:50Z",
    "author_association": "NONE",
    "body": "to deter hacking, I think activation mechanism could be used. when deploying key files to a machine, those files need to be signed by a person with private key / serial number like Microsoft software. so hacker cannot simply copy the key files over to their machine and launch attack.\r\n\r\nsigning is against CPU serial number or cloud service instance#, similar to Microsoft Windows activation.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/580337133/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/580366290",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4640#issuecomment-580366290",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4640",
    "id": 580366290,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4MDM2NjI5MA==",
    "user": {
      "login": "garyschulteog",
      "id": 30323939,
      "node_id": "MDQ6VXNlcjMwMzIzOTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/30323939?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/garyschulteog",
      "html_url": "https://github.com/garyschulteog",
      "followers_url": "https://api.github.com/users/garyschulteog/followers",
      "following_url": "https://api.github.com/users/garyschulteog/following{/other_user}",
      "gists_url": "https://api.github.com/users/garyschulteog/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/garyschulteog/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/garyschulteog/subscriptions",
      "organizations_url": "https://api.github.com/users/garyschulteog/orgs",
      "repos_url": "https://api.github.com/users/garyschulteog/repos",
      "events_url": "https://api.github.com/users/garyschulteog/events{/privacy}",
      "received_events_url": "https://api.github.com/users/garyschulteog/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-30T17:31:25Z",
    "updated_at": "2020-01-30T17:31:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "An interesting idea would be to have validator clients tightly integrate with a keymanager solution which not only does key management but also is responsible for consensus around which validator is currently validating for what keys.\r\n\r\nideally the keymanager solution would be fault tolerant, allow for degraded operation modes, be robust enough to be offered as a service and light enough to be run privately on a single node.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/580366290/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/581145781",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4640#issuecomment-581145781",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4640",
    "id": 581145781,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4MTE0NTc4MQ==",
    "user": {
      "login": "ghost",
      "id": 10137,
      "node_id": "MDQ6VXNlcjEwMTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/10137?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ghost",
      "html_url": "https://github.com/ghost",
      "followers_url": "https://api.github.com/users/ghost/followers",
      "following_url": "https://api.github.com/users/ghost/following{/other_user}",
      "gists_url": "https://api.github.com/users/ghost/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ghost/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ghost/subscriptions",
      "organizations_url": "https://api.github.com/users/ghost/orgs",
      "repos_url": "https://api.github.com/users/ghost/repos",
      "events_url": "https://api.github.com/users/ghost/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ghost/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-02T15:22:58Z",
    "updated_at": "2020-02-02T15:22:58Z",
    "author_association": "NONE",
    "body": "add second --datadir to validator would be useful for 2 sites failover. when one site goes down, the other site could take over the job, by simply adding --datadir=firstSiteKeyFiles in its validator process. ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/581145781/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/596009161",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4640#issuecomment-596009161",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4640",
    "id": 596009161,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5NjAwOTE2MQ==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-06T23:36:23Z",
    "updated_at": "2020-03-06T23:36:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "@somuchid take a look at the project done at ethlondon that aims to solve this problem: https://devpost.com/software/eth-2-0-validator-protection. Also @mcdee has been working on an awesome key manager which protects the validator. It can connect to our slasher detector as a middleware and prevent validators from being slashed even if running in remote, failover modes. Let us know if this is good enough information to close this open issue.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/596009161/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/599604374",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4640#issuecomment-599604374",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4640",
    "id": 599604374,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU5OTYwNDM3NA==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-16T15:37:13Z",
    "updated_at": "2020-03-16T15:37:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing due to inactivity",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/599604374/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
