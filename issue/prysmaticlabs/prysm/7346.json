{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7346",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7346/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7346/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7346/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/7346",
  "id": 708897347,
  "node_id": "MDU6SXNzdWU3MDg4OTczNDc=",
  "number": 7346,
  "title": "Discovery V5 half handshake bug",
  "user": {
    "login": "zilm13",
    "id": 6196452,
    "node_id": "MDQ6VXNlcjYxOTY0NTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6196452?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zilm13",
    "html_url": "https://github.com/zilm13",
    "followers_url": "https://api.github.com/users/zilm13/followers",
    "following_url": "https://api.github.com/users/zilm13/following{/other_user}",
    "gists_url": "https://api.github.com/users/zilm13/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zilm13/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zilm13/subscriptions",
    "organizations_url": "https://api.github.com/users/zilm13/orgs",
    "repos_url": "https://api.github.com/users/zilm13/repos",
    "events_url": "https://api.github.com/users/zilm13/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zilm13/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129904,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDQ=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Bug",
      "name": "Bug",
      "color": "ee0701",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1500585773,
      "node_id": "MDU6TGFiZWwxNTAwNTg1Nzcz",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Networking",
      "name": "Networking",
      "color": "c7a5f7",
      "default": false,
      "description": "P2P related items"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "nisdas",
    "id": 33201827,
    "node_id": "MDQ6VXNlcjMzMjAxODI3",
    "avatar_url": "https://avatars.githubusercontent.com/u/33201827?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nisdas",
    "html_url": "https://github.com/nisdas",
    "followers_url": "https://api.github.com/users/nisdas/followers",
    "following_url": "https://api.github.com/users/nisdas/following{/other_user}",
    "gists_url": "https://api.github.com/users/nisdas/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nisdas/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nisdas/subscriptions",
    "organizations_url": "https://api.github.com/users/nisdas/orgs",
    "repos_url": "https://api.github.com/users/nisdas/repos",
    "events_url": "https://api.github.com/users/nisdas/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nisdas/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "nisdas",
      "id": 33201827,
      "node_id": "MDQ6VXNlcjMzMjAxODI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/33201827?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nisdas",
      "html_url": "https://github.com/nisdas",
      "followers_url": "https://api.github.com/users/nisdas/followers",
      "following_url": "https://api.github.com/users/nisdas/following{/other_user}",
      "gists_url": "https://api.github.com/users/nisdas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nisdas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nisdas/subscriptions",
      "organizations_url": "https://api.github.com/users/nisdas/orgs",
      "repos_url": "https://api.github.com/users/nisdas/repos",
      "events_url": "https://api.github.com/users/nisdas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nisdas/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-09-25T12:29:05Z",
  "updated_at": "2020-10-22T17:09:51Z",
  "closed_at": "2020-10-22T17:09:51Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!--üíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé\r\n\r\nHellooo! üòÑ \r\n\r\nTo help us tend to your issue faster, please search our currently open issues before submitting a new one.\r\nExisting issues often contain information about workarounds, resolution, or progress updates.\r\n\r\nüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé-->\r\n\r\n# üêû Bug Report\r\n\r\n### Description\r\nSequence\r\n<pre><code>\r\nrandom packet ->\r\n<- whoareyou\r\nmalformed authheadermessage packet ->\r\nmalformed authheadermessage packet (same) ->\r\nmalformed authheadermessage packet (same) ->\r\nmalformed authheadermessage packet (same) ->\r\ncorrect authheadermessage packet ->\r\n</code></pre>\r\npasses the authorization. You could send any number of malformed AuthHeaderMessages until timeout from my tests.\r\n\r\n### Has this worked before in a previous version?\r\nDiscovery V5 implementation in Prysm is affected. Probably V5.1 doesn't fix the issue as it adds only cheap AES on top, but expensive EC Curve is still in the place.\r\n\r\n## üî¨ Minimal Reproduction\r\n\r\nI've created a test for Go implementation of discovery, as you are using it, it passes:\r\n\r\n<pre><code>\r\nfunc TestHandshake_attack(t *testing.T) {\r\n\tt.Parallel()\r\n\tnet := newHandshakeTest()\r\n\tdefer net.close()\r\n\r\n\t// A -> B   RANDOM PACKET\r\n\tpacket, _ := net.nodeA.encode(t, net.nodeB, &findnodeV5{})\r\n\tresp := net.nodeB.expectDecode(t, p_unknownV5, packet)\r\n\r\n\t// A <- B   WHOAREYOU\r\n\tchallenge := &whoareyouV5{\r\n\t\tAuthTag:   resp.(*unknownV5).AuthTag,\r\n\t\tIDNonce:   testIDnonce,\r\n\t\tRecordSeq: 0,\r\n\t}\r\n\twhoareyou, _ := net.nodeB.encode(t, net.nodeA, challenge)\r\n\tnet.nodeA.expectDecode(t, p_whoareyouV5, whoareyou)\r\n\r\n\t// A -> B   FINDNODE after timeout\r\n\t//net.clock.Run(handshakeTimeout + 1)\r\n\r\n\tincorrect_challenge := &whoareyouV5{\r\n\t\tAuthTag: challenge.AuthTag,\r\n\t\tIDNonce: [32]byte{5, 6, 7, 8, 9, 6, 11, 12},\r\n\t\tRecordSeq: challenge.RecordSeq,\r\n\t\tnode: challenge.node,\r\n\t\tsent: challenge.sent,\r\n\t}\r\n\tincorrect_findnode, _ := net.nodeA.encodeWithChallenge(t, net.nodeB, incorrect_challenge, &findnodeV5{})\r\n\tincorrect_findnode2 := make([]byte, len(incorrect_findnode))\r\n\tcopy(incorrect_findnode2, incorrect_findnode)\r\n\tnet.nodeB.expectDecodeErr(t, errInvalidNonceSig, incorrect_findnode)\r\n\tnet.nodeB.expectDecodeErr(t, errInvalidNonceSig, incorrect_findnode2)\r\n\tfindnode, _ := net.nodeA.encodeWithChallenge(t, net.nodeB, challenge, &findnodeV5{})\r\n\tnet.nodeB.expectDecode(t, p_findnodeV5, findnode)\r\n}\r\n</code></pre>\r\n\r\n<!--\r\nPlease let us know how we can reproduce this issue. Include the exact method you used to run Prysm along with any flags used in your beacon chain and/or validator. Make sure you don't upload any confidential files or private keys.\r\n-->\r\n\r\n## üî• Error\r\n\r\n**Expected behaviour**\r\nSession should be dropped on first malformed AuthHeaderMessage\r\n\r\n",
  "closed_by": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7346/reactions",
    "total_count": 3,
    "+1": 3,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7346/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/708294735",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/7346#issuecomment-708294735",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7346",
    "id": 708294735,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwODI5NDczNQ==",
    "user": {
      "login": "nisdas",
      "id": 33201827,
      "node_id": "MDQ6VXNlcjMzMjAxODI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/33201827?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nisdas",
      "html_url": "https://github.com/nisdas",
      "followers_url": "https://api.github.com/users/nisdas/followers",
      "following_url": "https://api.github.com/users/nisdas/following{/other_user}",
      "gists_url": "https://api.github.com/users/nisdas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nisdas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nisdas/subscriptions",
      "organizations_url": "https://api.github.com/users/nisdas/orgs",
      "repos_url": "https://api.github.com/users/nisdas/repos",
      "events_url": "https://api.github.com/users/nisdas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nisdas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-14T09:54:31Z",
    "updated_at": "2020-10-14T09:54:31Z",
    "author_association": "MEMBER",
    "body": "This has been added in to the v5.1 branch as of this commit:\r\nhttps://github.com/ethereum/go-ethereum/pull/21647/commits/59b11fa55e228a3ec299a75590a04252a48b43e0 \r\n\r\nSo this should be resolved once v5.1 is merged in to geth's master. ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/708294735/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/714634912",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/7346#issuecomment-714634912",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7346",
    "id": 714634912,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxNDYzNDkxMg==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-22T17:09:51Z",
    "updated_at": "2020-10-22T17:09:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "Resolved now that discv5.1 is merged",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/714634912/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
