{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12142",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12142/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12142/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12142/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/12142",
  "id": 1627433758,
  "node_id": "I_kwDOBvuov85hAKse",
  "number": 12142,
  "title": "`beacon-chain`  fails to parse `genesis.ssz` generated with `minimal` preset",
  "user": {
    "login": "0x416e746f6e",
    "id": 83900239,
    "node_id": "MDQ6VXNlcjgzOTAwMjM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/83900239?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0x416e746f6e",
    "html_url": "https://github.com/0x416e746f6e",
    "followers_url": "https://api.github.com/users/0x416e746f6e/followers",
    "following_url": "https://api.github.com/users/0x416e746f6e/following{/other_user}",
    "gists_url": "https://api.github.com/users/0x416e746f6e/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0x416e746f6e/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0x416e746f6e/subscriptions",
    "organizations_url": "https://api.github.com/users/0x416e746f6e/orgs",
    "repos_url": "https://api.github.com/users/0x416e746f6e/repos",
    "events_url": "https://api.github.com/users/0x416e746f6e/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0x416e746f6e/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-03-16T13:03:48Z",
  "updated_at": "2023-03-16T15:36:18Z",
  "closed_at": "2023-03-16T15:36:18Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "# 🐞 Bug Report\r\n\r\n### `beacon-chain`  fails to parse genesis.ssz generated with `minimal` preset\r\n\r\nWhen I try to plug prysm beacon into a local privatenet (for testing) that runs on top of `minimal` preset, it fails with error:\r\n\r\n> could not load genesis from file: failed to unmarshal state, detected fork=phase0: incorrect size\r\n\r\n### Has this worked before in a previous version?\r\n\r\nI don't think so.  Looking at the code in `proto/prysm/v1alpha1/generated.ssz.go` I see that it hardcodes the value of `8192` for `SLOTS_PER_HISTORICAL_ROOT` while in case of `minimal` it's `64`.\r\n\r\n## 🔬 Minimal Reproduction\r\n\r\n```bash\r\necho 0 > deploy_block.txt\r\n\r\ncurl https://raw.githubusercontent.com/ethereum/consensus-specs/v1.2.0/configs/minimal.yaml > config.yaml\r\n\r\ndocker run --rm -v \"$(pwd):/data\" sigp/lcli:v3.4.0 \\\r\n  lcli interop-genesis \\\r\n    --genesis-time 1678954188 \\\r\n    --spec minimal \\\r\n    --testnet-dir /data\r\n\r\ncurl https://raw.githubusercontent.com/ethereum/consensus-specs/v1.2.0/configs/minimal.yaml > config.yaml\r\n\r\ndocker run --rm -v \"$(pwd):/data\" gcr.io/prysmaticlabs/prysm/beacon-chain:v3.2.2 \\\r\n  --accept-terms-of-use \\\r\n  --chain-config-file /data/config.yaml  \\\r\n  --genesis-state /data/genesis.ssz\r\n```\r\n\r\n## 🔥 Error\r\n\r\n<pre><code>\r\ntime=\"2023-03-16 12:55:39\" level=warning msg=\"Running on Ethereum Mainnet\" prefix=flags\r\ntime=\"2023-03-16 12:55:39\" level=warning msg=\"In order to receive transaction fees from proposing blocks, you must provide flag --suggested-fee-recipient with a valid ethereum address when starting your beacon node. Please see our documentation for more information on this requirement (https://docs.prylabs.network/docs/execution-node/fee-recipient).\" prefix=node\r\ntime=\"2023-03-16 12:55:39\" level=info msg=\"Checking DB\" database-path=\"/home/.eth2/beaconchaindata\" prefix=node\r\ntime=\"2023-03-16 12:55:39\" level=info msg=\"Opening Bolt DB at /home/.eth2/beaconchaindata/beaconchain.db\" prefix=db\r\ncould not load genesis from file: failed to unmarshal state, detected fork=phase0: incorrect size\r\n</code></pre>\r\n\r\n\r\n## 🌍  Your Environment\r\n\r\n**Operating System:**\r\n\r\nI use MacOS, but this also happens (obviously) on Linux.\r\n\r\n**What version of Prysm are you running? (Which release)**\r\n\r\n`v3.2.2`\r\n",
  "closed_by": {
    "login": "0x416e746f6e",
    "id": 83900239,
    "node_id": "MDQ6VXNlcjgzOTAwMjM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/83900239?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0x416e746f6e",
    "html_url": "https://github.com/0x416e746f6e",
    "followers_url": "https://api.github.com/users/0x416e746f6e/followers",
    "following_url": "https://api.github.com/users/0x416e746f6e/following{/other_user}",
    "gists_url": "https://api.github.com/users/0x416e746f6e/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0x416e746f6e/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0x416e746f6e/subscriptions",
    "organizations_url": "https://api.github.com/users/0x416e746f6e/orgs",
    "repos_url": "https://api.github.com/users/0x416e746f6e/repos",
    "events_url": "https://api.github.com/users/0x416e746f6e/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0x416e746f6e/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12142/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12142/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1471940709",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/12142#issuecomment-1471940709",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12142",
    "id": 1471940709,
    "node_id": "IC_kwDOBvuov85XvAhl",
    "user": {
      "login": "nisdas",
      "id": 33201827,
      "node_id": "MDQ6VXNlcjMzMjAxODI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/33201827?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nisdas",
      "html_url": "https://github.com/nisdas",
      "followers_url": "https://api.github.com/users/nisdas/followers",
      "following_url": "https://api.github.com/users/nisdas/following{/other_user}",
      "gists_url": "https://api.github.com/users/nisdas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nisdas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nisdas/subscriptions",
      "organizations_url": "https://api.github.com/users/nisdas/orgs",
      "repos_url": "https://api.github.com/users/nisdas/repos",
      "events_url": "https://api.github.com/users/nisdas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nisdas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-16T13:19:13Z",
    "updated_at": "2023-03-16T13:19:13Z",
    "author_association": "MEMBER",
    "body": "Prysm running with mainnet/minimal is a compile time parameter. Our docker images by default only come loaded with the mainnet presets. If you want to run prysm in minimal config, you will have to compile it yourself. ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1471940709/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1472079302",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/12142#issuecomment-1472079302",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12142",
    "id": 1472079302,
    "node_id": "IC_kwDOBvuov85XviXG",
    "user": {
      "login": "0x416e746f6e",
      "id": 83900239,
      "node_id": "MDQ6VXNlcjgzOTAwMjM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/83900239?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0x416e746f6e",
      "html_url": "https://github.com/0x416e746f6e",
      "followers_url": "https://api.github.com/users/0x416e746f6e/followers",
      "following_url": "https://api.github.com/users/0x416e746f6e/following{/other_user}",
      "gists_url": "https://api.github.com/users/0x416e746f6e/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0x416e746f6e/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0x416e746f6e/subscriptions",
      "organizations_url": "https://api.github.com/users/0x416e746f6e/orgs",
      "repos_url": "https://api.github.com/users/0x416e746f6e/repos",
      "events_url": "https://api.github.com/users/0x416e746f6e/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0x416e746f6e/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-16T14:23:57Z",
    "updated_at": "2023-03-16T14:23:57Z",
    "author_association": "NONE",
    "body": "Do you mean something like?\r\n\r\n> bazelisk build --config=minimal --remote_cache= //beacon-chain",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1472079302/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1472136652",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/12142#issuecomment-1472136652",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12142",
    "id": 1472136652,
    "node_id": "IC_kwDOBvuov85XvwXM",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-16T14:55:23Z",
    "updated_at": "2023-03-16T15:01:53Z",
    "author_association": "MEMBER",
    "body": "@0x416e746f6e yes -- the provided docker images are built with compile time configuration for mainnet state size config. If you wish to run a minimal state, you must build with minimal config. Using `--config=minimal` and building with bazel is the recommended approach. Alternatively, you can do the following to use go tooling:\r\n\r\n```sh\r\n# regenerate the generated files with hardcoded values\r\n# bazel is required for this step\r\n./hack/update-go-ssz.sh --config=minimal\r\n\r\n# build with go \r\ngo build ./cmd/beacon-chain -tags minimal -o prysm-beacon-chain\r\n\r\n# run it\r\n./prysm-beacon-chain --accept-terms-of-use --chain-config-file /data/config.yaml --genesis-state /data/genesis.ssz\r\n```\r\n\r\nedit: If you want to use docker you can build it on some machine then load it on another\r\n\r\n```sh\r\nbazel build //cmd/beacon-chain:image.tar --config=minimal\r\n\r\n# Locate the generated tarball\r\nTARBALL_LOCATION=$(bazel cquery //cmd/beacon-chain:image.tar \\\r\n    --output starlark \\\r\n    --starlark:expr=\"target.files.to_list()[0].path\")\r\n\r\n# Load it on this machine or copy it to the desired machine\r\ndocker load -i $TARBALL_LOCATION\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1472136652/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1472212881",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/12142#issuecomment-1472212881",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12142",
    "id": 1472212881,
    "node_id": "IC_kwDOBvuov85XwC-R",
    "user": {
      "login": "0x416e746f6e",
      "id": 83900239,
      "node_id": "MDQ6VXNlcjgzOTAwMjM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/83900239?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0x416e746f6e",
      "html_url": "https://github.com/0x416e746f6e",
      "followers_url": "https://api.github.com/users/0x416e746f6e/followers",
      "following_url": "https://api.github.com/users/0x416e746f6e/following{/other_user}",
      "gists_url": "https://api.github.com/users/0x416e746f6e/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0x416e746f6e/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0x416e746f6e/subscriptions",
      "organizations_url": "https://api.github.com/users/0x416e746f6e/orgs",
      "repos_url": "https://api.github.com/users/0x416e746f6e/repos",
      "events_url": "https://api.github.com/users/0x416e746f6e/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0x416e746f6e/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-16T15:36:18Z",
    "updated_at": "2023-03-16T15:36:18Z",
    "author_association": "NONE",
    "body": "\\o/\r\n\r\nthanks @prestonvanloon - that helped!",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1472212881/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
