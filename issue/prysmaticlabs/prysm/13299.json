{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/13299",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/13299/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/13299/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/13299/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/13299",
  "id": 2031645591,
  "node_id": "I_kwDOBvuov855GHOX",
  "number": 13299,
  "title": "Validator proposed block with null fee-recipient while it's exiting",
  "user": {
    "login": "zixuanz-eth",
    "id": 101146909,
    "node_id": "U_kgDOBgdhHQ",
    "avatar_url": "https://avatars.githubusercontent.com/u/101146909?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zixuanz-eth",
    "html_url": "https://github.com/zixuanz-eth",
    "followers_url": "https://api.github.com/users/zixuanz-eth/followers",
    "following_url": "https://api.github.com/users/zixuanz-eth/following{/other_user}",
    "gists_url": "https://api.github.com/users/zixuanz-eth/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zixuanz-eth/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zixuanz-eth/subscriptions",
    "organizations_url": "https://api.github.com/users/zixuanz-eth/orgs",
    "repos_url": "https://api.github.com/users/zixuanz-eth/repos",
    "events_url": "https://api.github.com/users/zixuanz-eth/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zixuanz-eth/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129904,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDQ=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Bug",
      "name": "Bug",
      "color": "ee0701",
      "default": false,
      "description": "Something isn't working"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-12-07T22:46:09Z",
  "updated_at": "2023-12-08T01:26:00Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Describe the bug\n\nFor this validator https://beaconcha.in/slot/64f73dd16b5f4bf0d807c58843f2b46774e35276ae8495df6c1545afe8482a64 - it's chosen to propose a block while it's in `exiting` status. We noticed that the block had null address as its fee recipient.\n\n### Has this worked before in a previous version?\n\n_No response_\n\n### ðŸ”¬ Minimal Reproduction\n\nGeth for EL, Prysm for both BN and VC. \r\n* Command for beacon node:\r\n```\r\nbeacon-chain \\\r\n        --http-mev-relay http://localhost:18550 \\\r\n        --datadir=/data \\\r\n        --rpc-host=0.0.0.0 \\\r\n        --p2p-tcp-port=3919 \\\r\n        --p2p-udp-port=3303 \\\r\n        --verbosity=info \\\r\n        --monitoring-host=0.0.0.0 \\\r\n        --monitoring-port=8080 \\\r\n        --execution-endpoint=http://eth2-engine:8551 \\\r\n        --jwt-secret=/genesis/jwtsecret \\\r\n        --grpc-gateway-host=0.0.0.0 \\\r\n        --accept-terms-of-use \\\r\n        --mainnet\r\n```\r\n* Command for validator client:\r\n```\r\nvalidator \\\r\n        --datadir=/data \\\r\n        --monitoring-port=8081 \\\r\n        --monitoring-host=0.0.0.0 \\\r\n        --verbosity=info \\\r\n        --graffiti=\"\" \\\r\n        --wallet-dir=\"/keystore/prysm/wallet\" \\\r\n        --wallet-password-file=\"/keystore/prysm/passwords/wallet.pass\" \\\r\n        --enable-slashing-protection-history-pruning \\\r\n        --validators-external-signer-url=\"http://localhost:9000\" \\\r\n        --validators-external-signer-public-keys=\"http://localhost:9000/api/v1/eth2/publicKeys\" \\\r\n        --mainnet \\\r\n        --beacon-rpc-provider=â€œrpc-1:4000,rpc-2:4000\" \\\r\n        --dynamic-key-reload-debounce-interval=10s \\\r\n        --attest-timely \\\r\n        --proposer-settings-file=\"/keystore/prysm/proposer-settings.json\" \\\r\n        --enable-builder \\\r\n        --web \\\r\n        --accept-terms-of-us\r\n ```\r\n Proposer-setting.json\r\n ```\r\n{\"default_config\":{\"fee_recipient\":\"0x0000000000000000000000000000000000000000\",\"builder\":{\"enabled\":true}},\"proposer_config\":{\"<pubkey>\":{\"fee_recipient\":\"<non-null-address>\"}, ...}\r\n```\r\n\r\nNot using webUI or key-manager API to configure fee-recipient\n\n### Error\n\n_No response_\n\n### Platform(s)\n\n_No response_\n\n### What version of Prysm are you running? (Which release)\n\n4.1.1\n\n### Anything else relevant (validator index / public key)?\n\n668690",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/13299/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/13299/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1846255212",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/13299#issuecomment-1846255212",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/13299",
    "id": 1846255212,
    "node_id": "IC_kwDOBvuov85uC55s",
    "user": {
      "login": "nalepae",
      "id": 4943830,
      "node_id": "MDQ6VXNlcjQ5NDM4MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4943830?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nalepae",
      "html_url": "https://github.com/nalepae",
      "followers_url": "https://api.github.com/users/nalepae/followers",
      "following_url": "https://api.github.com/users/nalepae/following{/other_user}",
      "gists_url": "https://api.github.com/users/nalepae/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nalepae/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nalepae/subscriptions",
      "organizations_url": "https://api.github.com/users/nalepae/orgs",
      "repos_url": "https://api.github.com/users/nalepae/repos",
      "events_url": "https://api.github.com/users/nalepae/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nalepae/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-07T23:20:43Z",
    "updated_at": "2023-12-07T23:20:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi.\r\n\r\nThank you very much for your bug report.\r\n\r\nFrom your initial ticket, let me rewrite the content of `proposer-config.json` with some indentations, to ease readability:\r\n```json\r\n{\r\n    \"default_config\": {\r\n        \"fee_recipient\": \"0x0000000000000000000000000000000000000000\",\r\n        \"builder\": {\r\n            \"enabled\": true\r\n        }\r\n    },\r\n    \"proposer_config\": {\r\n        \"<pubkey>\": {\r\n            \"fee_recipient\": \"<non-null-address>\"\r\n        }, ...\r\n    }\r\n}\r\n```\r\n\r\nI assume `\"<pubkey>\"` and ` \"<non-null-address>\"` are placeholders containing real pubkeys and addresses in your configuration. Could you please confirm me that ?\r\n\r\nCould you also please confirm that one of your item in `proposer_config` contains the pubkey corresponding to the validator index `668690`?\r\n\r\nSomething like:\r\n\r\n```json\r\n    \"proposer_config\": {\r\n        \"0xae5aaae0cf49b5ac0d9621c692983b61a970bfcdbd0fcbd864883c6402479f8f32a800c8aaef2c8dcd85cf81b465632e\": {\r\n            \"fee_recipient\": \"<non-null-address>\"\r\n        }, \r\n```\r\n\r\n**Side notes:**\r\n\r\nBecause `\"fee_recipient\": \"0x0000000000000000000000000000000000000000\"` is defined in `default_config`, then all keys not specifically defined in `proposer_config` will set their fee recipient according to the `default_config` one. In this case, the burn address `0x0000...`.\r\n\r\nIt is considered safer not to use an ETH address you own as a default fee recipient, instead of the burn addresss `0x000...`.\r\n\r\nAs an additional safety net, you can also define the option\r\n```\r\n--suggested-fee-recipient value             Post bellatrix, this address will receive the transaction fees produced by any blocks from this node. Default to junk whilst bellatrix is in development state. Validator client can override this value through the preparebeaconproposer api. (default: \"0x0000000000000000000000000000000000000000\")\r\n```\r\n\r\non your Beacon Node. If a Validator Client connected to your beacon node does not specify any fee recipient, then the beacon node will use the one defined in the `--suggested-fee-recipient`option.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1846255212/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1846412293",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/13299#issuecomment-1846412293",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/13299",
    "id": 1846412293,
    "node_id": "IC_kwDOBvuov85uDgQF",
    "user": {
      "login": "james-prysm",
      "id": 90280386,
      "node_id": "MDQ6VXNlcjkwMjgwMzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/90280386?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/james-prysm",
      "html_url": "https://github.com/james-prysm",
      "followers_url": "https://api.github.com/users/james-prysm/followers",
      "following_url": "https://api.github.com/users/james-prysm/following{/other_user}",
      "gists_url": "https://api.github.com/users/james-prysm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/james-prysm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/james-prysm/subscriptions",
      "organizations_url": "https://api.github.com/users/james-prysm/orgs",
      "repos_url": "https://api.github.com/users/james-prysm/repos",
      "events_url": "https://api.github.com/users/james-prysm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/james-prysm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-08T01:25:58Z",
    "updated_at": "2023-12-08T01:25:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "Some additional thoughts on this\r\n\r\nwe are checking if the validator is active + pending but activating in the epoch but not checking if it's `exiting` when periodically ( each epoch) registering validators. This hasn't been anything special we changed recently, but maybe a combination of things happened.\r\n\r\nto help confirm I want to ask whether that beacon node with the exiting validator that was proposing, did it happen to get restarted? we don't persistently save validator registrations to a DB anymore and it's just stored in memory by default.\r\nIf you restart the beacon node it will wipe out all the validator registrations on it, usually, this isn't a problem because you would just reregister at the start of the epoch before the duties are activated upon, but in this case it was exiting status so maybe it skipped registration? \r\n\r\nLet us know if you experienced anything like that.\r\n\r\nalso perhaps one way to avoid this in the future is to skip the validator registrations all together and use the proposer settings only on the beacon node side ( would need to discuss with others) but maybe we can just have those settings set there if you are using a validator -> beacon node one to one  ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1846412293/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
