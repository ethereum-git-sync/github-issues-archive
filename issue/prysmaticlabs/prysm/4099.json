{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4099",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4099/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4099/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4099/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/4099",
  "id": 527746419,
  "node_id": "MDU6SXNzdWU1Mjc3NDY0MTk=",
  "number": 4099,
  "title": "Becaon node panic after node restart",
  "user": {
    "login": "peterbitfly",
    "id": 1674920,
    "node_id": "MDQ6VXNlcjE2NzQ5MjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1674920?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/peterbitfly",
    "html_url": "https://github.com/peterbitfly",
    "followers_url": "https://api.github.com/users/peterbitfly/followers",
    "following_url": "https://api.github.com/users/peterbitfly/following{/other_user}",
    "gists_url": "https://api.github.com/users/peterbitfly/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/peterbitfly/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/peterbitfly/subscriptions",
    "organizations_url": "https://api.github.com/users/peterbitfly/orgs",
    "repos_url": "https://api.github.com/users/peterbitfly/repos",
    "events_url": "https://api.github.com/users/peterbitfly/events{/privacy}",
    "received_events_url": "https://api.github.com/users/peterbitfly/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129904,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDQ=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Bug",
      "name": "Bug",
      "color": "ee0701",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1085357069,
      "node_id": "MDU6TGFiZWwxMDg1MzU3MDY5",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Priority:%20High",
      "name": "Priority: High",
      "color": "f7ea26",
      "default": false,
      "description": "High priority item"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "prestonvanloon",
    "id": 7246818,
    "node_id": "MDQ6VXNlcjcyNDY4MTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prestonvanloon",
    "html_url": "https://github.com/prestonvanloon",
    "followers_url": "https://api.github.com/users/prestonvanloon/followers",
    "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
    "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
    "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
    "repos_url": "https://api.github.com/users/prestonvanloon/repos",
    "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2019-11-24T19:44:38Z",
  "updated_at": "2020-01-08T02:30:56Z",
  "closed_at": "2020-01-08T02:30:56Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "After restarting the node it continuously panics with the following error:\r\n```\r\ntime=\"2019-11-24 19:43:12\" level=info msg=\"Minimum number of validators reached for beacon-chain to start\" ChainStartTime=2019-11-11 16:28:02 +0000 UTC prefix=powchain\r\ntime=\"2019-11-24 19:43:14\" level=info msg=\"Waiting for enough peer handshakes before syncing\" handshakes=\"0/1\" prefix=initial-sync\r\ntime=\"2019-11-24 19:43:16\" level=info msg=\"New peer connected\" peer=16Uiu2HAkvznEZLYtSFYqSSDteMvek2RVx3vhw6DRBNs2bymCVyDA prefix=p2p\r\ntime=\"2019-11-24 19:43:20\" level=info msg=\"Processing block 94481/94576 - estimated time remaining 31m40s\" blocksPerSecond=0.1 peers=\"1/1\" prefix=initial-sync\r\ntime=\"2019-11-24 19:43:20\" level=info msg=\"Processing block 94481/94576 - estimated time remaining 15m50s\" blocksPerSecond=0.1 peers=\"1/1\" prefix=initial-sync\r\npanic: could not process blockCopy from fork choice service: pre state of slot 94481 does not exist\r\n\r\ngoroutine 173 [running]:\r\ngithub.com/prysmaticlabs/prysm/beacon-chain/sync/initial-sync.(*InitialSync).Start(0xc000295860)\r\n\tbeacon-chain/sync/initial-sync/service.go:132 +0xf1c\r\ncreated by github.com/prysmaticlabs/prysm/shared.(*ServiceRegistry).StartAll\r\n\tshared/service_registry.go:44 +0x23e\r\n```\r\n\r\nIn order to avoid any unclean shutdown our process manager has a grace period of 5 minutes before killing the process. Unfortunately we don't have any logs prior to the restart.\r\n\r\nIn order to get rid of the panic we had to delete the db and re-sync the node from scratch.",
  "closed_by": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4099/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4099/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/558372584",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4099#issuecomment-558372584",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4099",
    "id": 558372584,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1ODM3MjU4NA==",
    "user": {
      "login": "torfbolt",
      "id": 233423,
      "node_id": "MDQ6VXNlcjIzMzQyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/233423?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/torfbolt",
      "html_url": "https://github.com/torfbolt",
      "followers_url": "https://api.github.com/users/torfbolt/followers",
      "following_url": "https://api.github.com/users/torfbolt/following{/other_user}",
      "gists_url": "https://api.github.com/users/torfbolt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/torfbolt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/torfbolt/subscriptions",
      "organizations_url": "https://api.github.com/users/torfbolt/orgs",
      "repos_url": "https://api.github.com/users/torfbolt/repos",
      "events_url": "https://api.github.com/users/torfbolt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/torfbolt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-25T22:38:31Z",
    "updated_at": "2019-11-26T07:55:22Z",
    "author_association": "NONE",
    "body": "Can confirm, same problem here after node restart.\r\n\r\n~~Possibly relevant:\r\nFor me this happened after updating to the latest beacon node docker image. Removing the DB also fixed it for me. Maybe something changed in the DB format?~~\r\n\r\nI did a full re-sync from scratch, and as soon as the sync was finished the problem occurred again:\r\n\r\n```\r\n[2019-11-26 01:46:30]  INFO initial-sync: Processing block 103582/103592 - estimated time remaining 1s blocksPerSecond=5.2 peers=4/7\r\n[2019-11-26 01:46:30]  INFO initial-sync: Processing block 103583/103592 - estimated time remaining 1s blocksPerSecond=5.2 peers=4/7\r\n[2019-11-26 01:46:30]  INFO initial-sync: Processing block 103586/103592 - estimated time remaining 1s blocksPerSecond=5.3 peers=4/7\r\n[2019-11-26 01:46:30]  INFO initial-sync: Processing block 103587/103592 - estimated time remaining 0s blocksPerSecond=5.3 peers=4/7\r\n[2019-11-26 01:46:30]  INFO initial-sync: Processing block 103564/103592 - estimated time remaining 5s blocksPerSecond=5.4 peers=1/7\r\n[2019-11-26 01:46:30]  INFO forkchoice: Executing state transition on block root=0x641b17e6... slot=103564\r\n[2019-11-26 01:46:30]  INFO blockchain: Finished applying state transition attestations=4 deposits=0 slot=103564\r\n[2019-11-26 01:46:30]  INFO initial-sync: Processing block 103565/103592 - estimated time remaining 4s blocksPerSecond=5.5 peers=1/7\r\n[2019-11-26 01:46:30]  INFO forkchoice: Executing state transition on block root=0xe120150b... slot=103565\r\n[2019-11-26 01:46:30]  INFO blockchain: Finished applying state transition attestations=5 deposits=0 slot=103565\r\n[2019-11-26 01:46:30]  INFO initial-sync: Processing block 103566/103592 - estimated time remaining 4s blocksPerSecond=5.5 peers=1/7\r\n[2019-11-26 01:46:30]  INFO forkchoice: Executing state transition on block root=0x933b9be7... slot=103566\r\n[2019-11-26 01:46:31]  INFO blockchain: Finished applying state transition attestations=4 deposits=0 slot=103566\r\n[2019-11-26 01:46:31]  INFO initial-sync: Processing block 103572/103592 - estimated time remaining 3s blocksPerSecond=5.2 peers=1/7\r\n[2019-11-26 01:46:31]  INFO forkchoice: Executing state transition on block root=0x4d7dfd90... slot=103572\r\n[2019-11-26 01:46:32]  INFO blockchain: Finished applying state transition attestations=24 deposits=0 slot=103572\r\n[2019-11-26 01:46:32]  INFO initial-sync: Processing block 103572/103592 - estimated time remaining 4s blocksPerSecond=5.0 peers=1/7\r\npanic: could not process block from fork choice service: pre state of slot 103572 does not exist\r\n\r\ngoroutine 214 [running]:\r\ngithub.com/prysmaticlabs/prysm/beacon-chain/sync/initial-sync.(*InitialSync).Start(0xc00033a2a0)\r\n        beacon-chain/sync/initial-sync/service.go:132 +0xf1c\r\ncreated by github.com/prysmaticlabs/prysm/shared.(*ServiceRegistry).StartAll\r\n        shared/service_registry.go:44 +0x23e\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/558372584/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/558619758",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4099#issuecomment-558619758",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4099",
    "id": 558619758,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1ODYxOTc1OA==",
    "user": {
      "login": "peterbitfly",
      "id": 1674920,
      "node_id": "MDQ6VXNlcjE2NzQ5MjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1674920?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/peterbitfly",
      "html_url": "https://github.com/peterbitfly",
      "followers_url": "https://api.github.com/users/peterbitfly/followers",
      "following_url": "https://api.github.com/users/peterbitfly/following{/other_user}",
      "gists_url": "https://api.github.com/users/peterbitfly/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/peterbitfly/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/peterbitfly/subscriptions",
      "organizations_url": "https://api.github.com/users/peterbitfly/orgs",
      "repos_url": "https://api.github.com/users/peterbitfly/repos",
      "events_url": "https://api.github.com/users/peterbitfly/events{/privacy}",
      "received_events_url": "https://api.github.com/users/peterbitfly/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-26T13:06:44Z",
    "updated_at": "2019-11-26T13:06:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "Same issue happened today with our node again (latest master).",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/558619758/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/559340287",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4099#issuecomment-559340287",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4099",
    "id": 559340287,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1OTM0MDI4Nw==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-28T04:49:31Z",
    "updated_at": "2019-11-28T04:49:31Z",
    "author_association": "MEMBER",
    "body": "What's interesting about these is that it seems you have two blocks at the same slot. Given that these are close to the head of the chain and some of the finality reversions we have seen this week, I think this might be prevented with #4137. \r\n\r\nHowever, I still think we need a resolution here. I suggest that once we have synced to finality, if there are any issues in syncing blocks after the finalized epoch then we should just jump to regular sync and sync backwards from there as needed.\r\n\r\nI'll submit a fix for this.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/559340287/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/571864025",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4099#issuecomment-571864025",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4099",
    "id": 571864025,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MTg2NDAyNQ==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-08T02:30:55Z",
    "updated_at": "2020-01-08T02:30:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "Duplicate of https://github.com/prysmaticlabs/prysm/issues/4412",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/571864025/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
