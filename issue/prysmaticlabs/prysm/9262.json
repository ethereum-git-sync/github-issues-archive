{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9262",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9262/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9262/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9262/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/9262",
  "id": 951384349,
  "node_id": "MDU6SXNzdWU5NTEzODQzNDk=",
  "number": 9262,
  "title": "Lock the state while populating validators in beacon state",
  "user": {
    "login": "jmozah",
    "id": 940575,
    "node_id": "MDQ6VXNlcjk0MDU3NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/940575?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jmozah",
    "html_url": "https://github.com/jmozah",
    "followers_url": "https://api.github.com/users/jmozah/followers",
    "following_url": "https://api.github.com/users/jmozah/following{/other_user}",
    "gists_url": "https://api.github.com/users/jmozah/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jmozah/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jmozah/subscriptions",
    "organizations_url": "https://api.github.com/users/jmozah/orgs",
    "repos_url": "https://api.github.com/users/jmozah/repos",
    "events_url": "https://api.github.com/users/jmozah/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jmozah/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1241586918,
      "node_id": "MDU6TGFiZWwxMjQxNTg2OTE4",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Tracking",
      "name": "Tracking",
      "color": "d0ff7f",
      "default": false,
      "description": "Gotta Catch 'Em All"
    },
    {
      "id": 2185788365,
      "node_id": "MDU6TGFiZWwyMTg1Nzg4MzY1",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Cleanup",
      "name": "Cleanup",
      "color": "9ffce6",
      "default": false,
      "description": "Code health!"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "jmozah",
    "id": 940575,
    "node_id": "MDQ6VXNlcjk0MDU3NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/940575?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jmozah",
    "html_url": "https://github.com/jmozah",
    "followers_url": "https://api.github.com/users/jmozah/followers",
    "following_url": "https://api.github.com/users/jmozah/following{/other_user}",
    "gists_url": "https://api.github.com/users/jmozah/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jmozah/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jmozah/subscriptions",
    "organizations_url": "https://api.github.com/users/jmozah/orgs",
    "repos_url": "https://api.github.com/users/jmozah/repos",
    "events_url": "https://api.github.com/users/jmozah/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jmozah/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "jmozah",
      "id": 940575,
      "node_id": "MDQ6VXNlcjk0MDU3NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/940575?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jmozah",
      "html_url": "https://github.com/jmozah",
      "followers_url": "https://api.github.com/users/jmozah/followers",
      "following_url": "https://api.github.com/users/jmozah/following{/other_user}",
      "gists_url": "https://api.github.com/users/jmozah/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jmozah/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jmozah/subscriptions",
      "organizations_url": "https://api.github.com/users/jmozah/orgs",
      "repos_url": "https://api.github.com/users/jmozah/repos",
      "events_url": "https://api.github.com/users/jmozah/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jmozah/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-07-23T08:57:03Z",
  "updated_at": "2021-07-28T18:27:28Z",
  "closed_at": "2021-07-28T18:27:28Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "One more thing to be mindful of is that a lot of these states here (`SaveStatesEfficient() `in #9155) are shared by other callers in other threads. This function basically rips out the validator set and then pastes it back in at the end. If any other callers try to access the validator set they might get a panic or unintentionally mutate it while its doing the saving. As a follow up PR, we can have a lock for all the states and unlock at the end of the method.\r\n\r\n_Originally posted by @nisdas in https://github.com/prysmaticlabs/prysm/pull/9155#discussion_r675407037_",
  "closed_by": {
    "login": "prylabs-bulldozer[bot]",
    "id": 58059840,
    "node_id": "MDM6Qm90NTgwNTk4NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/in/47372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D",
    "html_url": "https://github.com/apps/prylabs-bulldozer",
    "followers_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9262/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9262/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/888127390",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9262#issuecomment-888127390",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9262",
    "id": 888127390,
    "node_id": "IC_kwDOBvuov84077-e",
    "user": {
      "login": "jmozah",
      "id": 940575,
      "node_id": "MDQ6VXNlcjk0MDU3NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/940575?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jmozah",
      "html_url": "https://github.com/jmozah",
      "followers_url": "https://api.github.com/users/jmozah/followers",
      "following_url": "https://api.github.com/users/jmozah/following{/other_user}",
      "gists_url": "https://api.github.com/users/jmozah/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jmozah/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jmozah/subscriptions",
      "organizations_url": "https://api.github.com/users/jmozah/orgs",
      "repos_url": "https://api.github.com/users/jmozah/repos",
      "events_url": "https://api.github.com/users/jmozah/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jmozah/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-28T08:41:01Z",
    "updated_at": "2021-07-28T08:41:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "The off-line discussion was  as following\r\n- **Use the state's objects global lock**: This was not possible as the lock is inside` /beacon-node/state` but we needed it inside `/bean-node/db/kv`.\r\n- **reduce the possibility of bug**: The code path was checked and it seems like `there is a very limited risk of multi-threaded acces` in places where the state is saved using `SaveState()`. So for now, PR #9291 was done and it was decided to keep this issue open for future reference.\r\n\r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/888127390/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
