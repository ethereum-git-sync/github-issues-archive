{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4021",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4021/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4021/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4021/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/4021",
  "id": 524046657,
  "node_id": "MDU6SXNzdWU1MjQwNDY2NTc=",
  "number": 4021,
  "title": "Restarting Beacon Node + Validator After a While Leads to UNKNOWN_STATUS in Validator",
  "user": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129904,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDQ=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Bug",
      "name": "Bug",
      "color": "ee0701",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1085358164,
      "node_id": "MDU6TGFiZWwxMDg1MzU4MTY0",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Priority:%20Critical",
      "name": "Priority: Critical",
      "color": "f7262f",
      "default": false,
      "description": "Highest, immediate priority item"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "prestonvanloon",
    "id": 7246818,
    "node_id": "MDQ6VXNlcjcyNDY4MTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prestonvanloon",
    "html_url": "https://github.com/prestonvanloon",
    "followers_url": "https://api.github.com/users/prestonvanloon/followers",
    "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
    "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
    "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
    "repos_url": "https://api.github.com/users/prestonvanloon/repos",
    "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2019-11-17T21:01:47Z",
  "updated_at": "2019-11-19T00:47:03Z",
  "closed_at": "2019-11-19T00:47:03Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "This is a bug raised by some of our testnet users in our discord chat. Unfortunately, when turning off the beacon node + validator and starting them up again after a few hours, users reported seeing `UNKNOWN_STATUS` in their validator that is currently active in the protocol. The suspicion is there is some data stored in-memory regarding a validator's status that is lost upon a restart.\r\n\r\nHave not yet attempted to reproduce, and it is still unknown if the issue manifests after a short restart (users confirm it happens after a long time between turning off the processes and turning them on again).",
  "closed_by": {
    "login": "prestonvanloon",
    "id": 7246818,
    "node_id": "MDQ6VXNlcjcyNDY4MTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prestonvanloon",
    "html_url": "https://github.com/prestonvanloon",
    "followers_url": "https://api.github.com/users/prestonvanloon/followers",
    "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
    "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
    "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
    "repos_url": "https://api.github.com/users/prestonvanloon/repos",
    "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4021/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4021/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/554793876",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4021#issuecomment-554793876",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4021",
    "id": 554793876,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDc5Mzg3Ng==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-17T22:19:37Z",
    "updated_at": "2019-11-17T22:20:25Z",
    "author_association": "MEMBER",
    "body": "Information:\r\n\r\nReported log from user\r\n```\r\n[2019-11-17 20:09:31]  INFO validator: Waiting for validator to be activated in the beacon chain\r\n[2019-11-17 20:09:31]  INFO validator: Waiting to be activated depositInclusionSlot=0 positionInActivationQueue=0 pubKey=0xa66504a1c3a6 status=UNKNOWN_STATUS\r\n```\r\n\r\nAt the time of reporting, they were not ejected\r\n```json\r\n    {\r\n      \"publicKey\": \"pmUEocOmShlMd+kvG/etp1le4NrOi8LXRoqTcNlwaR46k/PtOOw1MfuXQZUPMw+i\",\r\n      \"withdrawalCredentials\": \"ABH3UpQEMXqkrHE7B0q5LyunED2PBoVDet9uh7aVe10=\",\r\n      \"effectiveBalance\": \"3200000000\",\r\n      \"slashed\": false,\r\n      \"activationEligibilityEpoch\": \"4779\",\r\n      \"activationEpoch\": \"4784\",\r\n      \"exitEpoch\": \"18446744073709551615\",\r\n      \"withdrawableEpoch\": \"18446744073709551615\"\r\n    },\r\n```\r\n\r\nAnd they had a positive balance > 3.2 ETH.\r\n\r\n```json\r\n{\r\n  \"epoch\": \"5619\",\r\n  \"balances\": [\r\n    {\r\n      \"publicKey\": \"pmUEocOmShlMd+kvG/etp1le4NrOi8LXRoqTcNlwaR46k/PtOOw1MfuXQZUPMw+i\",\r\n      \"index\": \"352\",\r\n      \"balance\": \"3303092168\"\r\n    }\r\n  ],\r\n  \"nextPageToken\": \"1\",\r\n  \"totalSize\": 1\r\n}\r\n```\r\n\r\nUser reported restart was within a few minutes of shutdown. ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/554793876/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/554794770",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4021#issuecomment-554794770",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4021",
    "id": 554794770,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDc5NDc3MA==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-17T22:28:52Z",
    "updated_at": "2019-11-17T22:28:52Z",
    "author_association": "MEMBER",
    "body": "Confirmed that assignments does not read from any cached or in memory values. Determining assignments reads from the head state, so this could be a symptom of requesting assignments from a beacon chain node that is not in sync.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/554794770/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/554794939",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4021#issuecomment-554794939",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4021",
    "id": 554794939,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDc5NDkzOQ==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-17T22:30:39Z",
    "updated_at": "2019-11-17T22:30:39Z",
    "author_association": "MEMBER",
    "body": "User confirms that the beacon chain node was in sync at the time. \r\n\r\n@terencechain confirms we block gRPC behavior from head state, so fetching assignments from out of sync node should have returned an obvious error if that were the case. https://github.com/prysmaticlabs/prysm/pull/3968",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/554794939/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/554796093",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4021#issuecomment-554796093",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4021",
    "id": 554796093,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDc5NjA5Mw==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-17T22:43:20Z",
    "updated_at": "2019-11-17T22:43:20Z",
    "author_association": "MEMBER",
    "body": "One possible problem area is when the ETH1 deposit fetcher fails to correctly return the deposit block number, an empty response is returned. This looks like the response the users are receiving.\r\n\r\nhttps://github.com/prysmaticlabs/prysm/blob/53c4a26184909a2022e4b200dfb82a81d616a9fc/beacon-chain/rpc/validator/status.go#L83-L88",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/554796093/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/554796743",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4021#issuecomment-554796743",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4021",
    "id": 554796743,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU1NDc5Njc0Mw==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-11-17T22:49:35Z",
    "updated_at": "2019-11-17T22:49:35Z",
    "author_association": "MEMBER",
    "body": "The root cause is somewhere in the deposit cache being cleared, but the immediate resolution is to check the head state for the validator existence before checking the ETH1 chain.\r\n\r\nIf a problem in the deposit cache remains, the consequences are that the ETh1DepositBlockNumber is zero when the validator is activated. This clearly isn't the intended behavior, but it is more tolerable than an empty response when a validator is active in the state.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/554796743/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
