{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11358",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11358/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11358/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11358/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/11358",
  "id": 1356059878,
  "node_id": "I_kwDOBvuov85Q09Tm",
  "number": 11358,
  "title": "Missing timeouts for some builder requests",
  "user": {
    "login": "jtraglia",
    "id": 95511699,
    "node_id": "U_kgDOBbFkkw",
    "avatar_url": "https://avatars.githubusercontent.com/u/95511699?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jtraglia",
    "html_url": "https://github.com/jtraglia",
    "followers_url": "https://api.github.com/users/jtraglia/followers",
    "following_url": "https://api.github.com/users/jtraglia/following{/other_user}",
    "gists_url": "https://api.github.com/users/jtraglia/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jtraglia/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jtraglia/subscriptions",
    "organizations_url": "https://api.github.com/users/jtraglia/orgs",
    "repos_url": "https://api.github.com/users/jtraglia/repos",
    "events_url": "https://api.github.com/users/jtraglia/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jtraglia/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-08-30T17:01:29Z",
  "updated_at": "2022-08-30T17:40:20Z",
  "closed_at": "2022-08-30T17:30:20Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# ðŸ’Ž Issue\r\n\r\n### Background\r\n\r\nI was looking at the builder endpoint in Prysm. Making sure that everything looks right.\r\n\r\n### Description\r\n\r\n[There is a timeout for getting the block header](https://github.com/jtraglia/prysm/blob/436792fe385134611376a54b03bb7e5f6264eaf7/beacon-chain/rpc/prysm/v1alpha1/validator/proposer_bellatrix.go#L390) but I don't see timeouts for the other builder requests:\r\n\r\n* [Getting the builder status](https://github.com/prysmaticlabs/prysm/blob/d077483577bc8fdc658940adf71d8d11dfa5949b/api/client/builder/client.go#L265)\r\n* [Submitting validator registration](https://github.com/prysmaticlabs/prysm/blob/d077483577bc8fdc658940adf71d8d11dfa5949b/api/client/builder/client.go#L218)\r\n* [Getting a payload from the builder](https://github.com/prysmaticlabs/prysm/blob/d077483577bc8fdc658940adf71d8d11dfa5949b/api/client/builder/client.go#L245)\r\n\r\nWhat would happen if the builder/relay keeps the connection open and doesn't return anything?\r\n\r\nThere is a `WithTimeout` wrapper in the builder client, but it is unused:\r\n\r\nhttps://github.com/prysmaticlabs/prysm/blob/d077483577bc8fdc658940adf71d8d11dfa5949b/api/client/builder/client.go#L37-L42\r\n\r\nA while ago, I made [an issue in the builder-specs](https://github.com/ethereum/builder-specs/issues/35) regarding timeouts; wondering if they should be clearly stated in the specs or not. We came to the conclusion that it shouldn't be mandated, but if there is a problem it would be a bug.",
  "closed_by": {
    "login": "jtraglia",
    "id": 95511699,
    "node_id": "U_kgDOBbFkkw",
    "avatar_url": "https://avatars.githubusercontent.com/u/95511699?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jtraglia",
    "html_url": "https://github.com/jtraglia",
    "followers_url": "https://api.github.com/users/jtraglia/followers",
    "following_url": "https://api.github.com/users/jtraglia/following{/other_user}",
    "gists_url": "https://api.github.com/users/jtraglia/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jtraglia/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jtraglia/subscriptions",
    "organizations_url": "https://api.github.com/users/jtraglia/orgs",
    "repos_url": "https://api.github.com/users/jtraglia/repos",
    "events_url": "https://api.github.com/users/jtraglia/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jtraglia/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11358/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11358/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1231938914",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/11358#issuecomment-1231938914",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11358",
    "id": 1231938914,
    "node_id": "IC_kwDOBvuov85JbeVi",
    "user": {
      "login": "terencechain",
      "id": 21316537,
      "node_id": "MDQ6VXNlcjIxMzE2NTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/terencechain",
      "html_url": "https://github.com/terencechain",
      "followers_url": "https://api.github.com/users/terencechain/followers",
      "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
      "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
      "organizations_url": "https://api.github.com/users/terencechain/orgs",
      "repos_url": "https://api.github.com/users/terencechain/repos",
      "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/terencechain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-30T17:09:32Z",
    "updated_at": "2022-08-30T17:09:32Z",
    "author_association": "MEMBER",
    "body": "`Getting the builder status`: we only call this once at start. If the builder status fails, then we mark the builder as unhealthy. We use the default HTTP timeout for this. I don't feel too strongly about aligning with the spec unless someone feels strongly about it \r\n`Submitting validator registration`: the timeout is on the validator client side. It used to timeout quite a lot but ever since then it's been fixed\r\n`Getting a payload from the builder`: we use the default timeout here because eitherway the proposer is missing the block",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1231938914/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1231959820",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/11358#issuecomment-1231959820",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11358",
    "id": 1231959820,
    "node_id": "IC_kwDOBvuov85JbjcM",
    "user": {
      "login": "jtraglia",
      "id": 95511699,
      "node_id": "U_kgDOBbFkkw",
      "avatar_url": "https://avatars.githubusercontent.com/u/95511699?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jtraglia",
      "html_url": "https://github.com/jtraglia",
      "followers_url": "https://api.github.com/users/jtraglia/followers",
      "following_url": "https://api.github.com/users/jtraglia/following{/other_user}",
      "gists_url": "https://api.github.com/users/jtraglia/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jtraglia/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jtraglia/subscriptions",
      "organizations_url": "https://api.github.com/users/jtraglia/orgs",
      "repos_url": "https://api.github.com/users/jtraglia/repos",
      "events_url": "https://api.github.com/users/jtraglia/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jtraglia/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-30T17:30:20Z",
    "updated_at": "2022-08-30T17:30:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thank you, @terencechain. You're right. I needed to go up a few more calls. Sorry, I'm still getting used to Prysm.\r\n\r\nThis is the timeout (deadline) for validator registrations and proposals, right? It has until the end of the slot.\r\n\r\nhttps://github.com/prysmaticlabs/prysm/blob/d077483577bc8fdc658940adf71d8d11dfa5949b/validator/client/runner.go#L107-L110\r\n\r\n> we use the default timeout here because either way the proposer is missing the block\r\n\r\nYes, after submitting the signed header there's no going back.\r\n\r\nSo yeah nevermind, this looks fine. Thanks again!\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1231959820/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1231969449",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/11358#issuecomment-1231969449",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11358",
    "id": 1231969449,
    "node_id": "IC_kwDOBvuov85Jblyp",
    "user": {
      "login": "terencechain",
      "id": 21316537,
      "node_id": "MDQ6VXNlcjIxMzE2NTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/terencechain",
      "html_url": "https://github.com/terencechain",
      "followers_url": "https://api.github.com/users/terencechain/followers",
      "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
      "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
      "organizations_url": "https://api.github.com/users/terencechain/orgs",
      "repos_url": "https://api.github.com/users/terencechain/repos",
      "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/terencechain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-30T17:40:19Z",
    "updated_at": "2022-08-30T17:40:19Z",
    "author_association": "MEMBER",
    "body": "Thanks for the review. Really appreciate it! <3 ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1231969449/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
