{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6957",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6957/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6957/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6957/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/6957",
  "id": 676477434,
  "node_id": "MDU6SXNzdWU2NzY0Nzc0MzQ=",
  "number": 6957,
  "title": "Beacon, Validator, Slasher logs not going to the default log files after logrotate",
  "user": {
    "login": "xuyenvuong",
    "id": 8920883,
    "node_id": "MDQ6VXNlcjg5MjA4ODM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8920883?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/xuyenvuong",
    "html_url": "https://github.com/xuyenvuong",
    "followers_url": "https://api.github.com/users/xuyenvuong/followers",
    "following_url": "https://api.github.com/users/xuyenvuong/following{/other_user}",
    "gists_url": "https://api.github.com/users/xuyenvuong/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/xuyenvuong/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/xuyenvuong/subscriptions",
    "organizations_url": "https://api.github.com/users/xuyenvuong/orgs",
    "repos_url": "https://api.github.com/users/xuyenvuong/repos",
    "events_url": "https://api.github.com/users/xuyenvuong/events{/privacy}",
    "received_events_url": "https://api.github.com/users/xuyenvuong/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-08-10T23:32:02Z",
  "updated_at": "2020-08-12T04:05:38Z",
  "closed_at": "2020-08-12T04:05:38Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!--üíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé\r\n\r\nHellooo! üòÑ \r\n\r\nTo help us tend to your issue faster, please search our currently open issues before submitting a new one.\r\nExisting issues often contain information about workarounds, resolution, or progress updates.\r\n\r\nüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé-->\r\n\r\n# üêû Bug Report\r\n\r\n### Description\r\n\r\n<!-- ‚úçÔ∏è--> Beacon, Validator, Slasher logs not going to the default log files after logrotate. New logs are going to the newly rotated log. Since log rotate won't rotate empty logs, the log files are inflating. Restarting Beacon, Validator, Slasher would help to write to default log files. It would be nice to not restart these processes.\r\n\r\n### Has this worked before in a previous version?\r\n\r\n<!-- Did this behavior use to work in the previous version? -->\r\n<!-- ‚úçÔ∏è--> Not sure. Assuming it's not working ever.\r\n\r\n## üî¨ Minimal Reproduction\r\n\r\nSteps to reproduce:\r\n\r\n1. Setup beacon with \"log-file: /home/ethereum/logs/beacon.log\" (same for validator, and slasher)\r\n2. Setup a new logrotate config file: /etc/logrotate.d/prysm-logs as follow:\r\n/home/ethereum/logs/*.log \r\n{\r\n    rotate 7\r\n    daily\r\n    missingok\r\n    notifempty\r\n    delaycompress\r\n    compress\r\n    postrotate\r\n        systemctl reload prysm-logs\r\n    endscript\r\n}\r\n\r\n## üî• Error\r\n\r\nObserve:\r\n1. Log got rotated from /home/ethereum/logs/beacon.log to /home/ethereum/logs/beacon.log.1\r\n2. New logs are going to /home/ethereum/logs/beacon.log.1\r\n\r\n-rw-rw-r--  1 ethereum ethereum        0 Aug  8 00:00 beacon.log\r\n-rw-rw-r--  1 ethereum ethereum 18743512 Aug 10 23:26 beacon.log.1\r\n-rw-rw-r--  1 ethereum ethereum        0 Aug  8 00:00 slasher.log\r\n-rw-rw-r--  1 ethereum ethereum 12541561 Aug 10 23:26 slasher.log.1\r\n-rw-rw-r--  1 ethereum ethereum        0 Aug  8 00:00 validator.log\r\n-rw-rw-r--  1 ethereum ethereum 35626932 Aug 10 23:26 validator.log.1\r\n\r\n<pre><code>\r\n<!-- If the issue is accompanied by an error, please share the error logs with us below. If you have a lot of logs, place make a paste bin with your logs and share the link with us here: -->\r\n<!-- ‚úçÔ∏è-->\r\n\r\n</code></pre>\r\n\r\n\r\n## üåç  Your Environment\r\n\r\n**Operating System:**\r\n\r\nUbuntu latest on ARM64 (Pi 4 8GB)\r\n\r\n<pre>\r\n  <code>\r\n\r\n  </code>\r\n</pre>\r\n\r\n**What version of Prysm are you running? (Which release)**\r\nalpha.19\r\n\r\n<pre>\r\n  <code>\r\n\r\n  </code>\r\n</pre>\r\n\r\n**Anything else relevant (validator index / public key)?**\r\nNo.\r\n",
  "closed_by": {
    "login": "xuyenvuong",
    "id": 8920883,
    "node_id": "MDQ6VXNlcjg5MjA4ODM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8920883?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/xuyenvuong",
    "html_url": "https://github.com/xuyenvuong",
    "followers_url": "https://api.github.com/users/xuyenvuong/followers",
    "following_url": "https://api.github.com/users/xuyenvuong/following{/other_user}",
    "gists_url": "https://api.github.com/users/xuyenvuong/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/xuyenvuong/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/xuyenvuong/subscriptions",
    "organizations_url": "https://api.github.com/users/xuyenvuong/orgs",
    "repos_url": "https://api.github.com/users/xuyenvuong/repos",
    "events_url": "https://api.github.com/users/xuyenvuong/events{/privacy}",
    "received_events_url": "https://api.github.com/users/xuyenvuong/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6957/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6957/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/671670268",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/6957#issuecomment-671670268",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6957",
    "id": 671670268,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3MTY3MDI2OA==",
    "user": {
      "login": "raphpa",
      "id": 18283997,
      "node_id": "MDQ6VXNlcjE4MjgzOTk3",
      "avatar_url": "https://avatars.githubusercontent.com/u/18283997?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/raphpa",
      "html_url": "https://github.com/raphpa",
      "followers_url": "https://api.github.com/users/raphpa/followers",
      "following_url": "https://api.github.com/users/raphpa/following{/other_user}",
      "gists_url": "https://api.github.com/users/raphpa/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/raphpa/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/raphpa/subscriptions",
      "organizations_url": "https://api.github.com/users/raphpa/orgs",
      "repos_url": "https://api.github.com/users/raphpa/repos",
      "events_url": "https://api.github.com/users/raphpa/events{/privacy}",
      "received_events_url": "https://api.github.com/users/raphpa/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-11T01:23:31Z",
    "updated_at": "2020-08-11T01:23:31Z",
    "author_association": "NONE",
    "body": "That is an expected behaviour of logrotate. You would need an option to signal the processes to write to the new file (like HUP).\r\n\r\nYou can try using the `copytruncate` option of logrotate, which will copy the log to the new file and then truncate the current log to empty it.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/671670268/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/671698839",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/6957#issuecomment-671698839",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6957",
    "id": 671698839,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3MTY5ODgzOQ==",
    "user": {
      "login": "xuyenvuong",
      "id": 8920883,
      "node_id": "MDQ6VXNlcjg5MjA4ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8920883?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/xuyenvuong",
      "html_url": "https://github.com/xuyenvuong",
      "followers_url": "https://api.github.com/users/xuyenvuong/followers",
      "following_url": "https://api.github.com/users/xuyenvuong/following{/other_user}",
      "gists_url": "https://api.github.com/users/xuyenvuong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/xuyenvuong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/xuyenvuong/subscriptions",
      "organizations_url": "https://api.github.com/users/xuyenvuong/orgs",
      "repos_url": "https://api.github.com/users/xuyenvuong/repos",
      "events_url": "https://api.github.com/users/xuyenvuong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/xuyenvuong/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-11T03:11:41Z",
    "updated_at": "2020-08-11T03:11:41Z",
    "author_association": "NONE",
    "body": "@raphpa - I tried `copytruncate` option, but same behavior. I will look into HUP.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/671698839/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/672560044",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/6957#issuecomment-672560044",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6957",
    "id": 672560044,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3MjU2MDA0NA==",
    "user": {
      "login": "xuyenvuong",
      "id": 8920883,
      "node_id": "MDQ6VXNlcjg5MjA4ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8920883?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/xuyenvuong",
      "html_url": "https://github.com/xuyenvuong",
      "followers_url": "https://api.github.com/users/xuyenvuong/followers",
      "following_url": "https://api.github.com/users/xuyenvuong/following{/other_user}",
      "gists_url": "https://api.github.com/users/xuyenvuong/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/xuyenvuong/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/xuyenvuong/subscriptions",
      "organizations_url": "https://api.github.com/users/xuyenvuong/orgs",
      "repos_url": "https://api.github.com/users/xuyenvuong/repos",
      "events_url": "https://api.github.com/users/xuyenvuong/events{/privacy}",
      "received_events_url": "https://api.github.com/users/xuyenvuong/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-12T04:05:38Z",
    "updated_at": "2020-08-12T04:05:38Z",
    "author_association": "NONE",
    "body": "After moving `copytruncate` to the very top of the list, the logrotate seems to work fine. Closing this ticket.\r\n\r\n`/home/ethereum/logs/*.log \r\n{\r\n    rotate 7\r\n    daily\r\n    copytruncate\r\n    missingok\r\n    notifempty\r\n    delaycompress\r\n    compress\r\n    postrotate\r\n        systemctl reload prysm-logs\r\n    endscript\r\n}`",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/672560044/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
