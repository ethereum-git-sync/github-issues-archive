{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12517",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12517/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12517/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12517/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/12517",
  "id": 1753696383,
  "node_id": "I_kwDOBvuov85oh0h_",
  "number": 12517,
  "title": "Seemingly incorrect time series averaging for \"estimated time remaining\" during sync",
  "user": {
    "login": "stoooops",
    "id": 3518037,
    "node_id": "MDQ6VXNlcjM1MTgwMzc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3518037?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/stoooops",
    "html_url": "https://github.com/stoooops",
    "followers_url": "https://api.github.com/users/stoooops/followers",
    "following_url": "https://api.github.com/users/stoooops/following{/other_user}",
    "gists_url": "https://api.github.com/users/stoooops/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/stoooops/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/stoooops/subscriptions",
    "organizations_url": "https://api.github.com/users/stoooops/orgs",
    "repos_url": "https://api.github.com/users/stoooops/repos",
    "events_url": "https://api.github.com/users/stoooops/events{/privacy}",
    "received_events_url": "https://api.github.com/users/stoooops/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-06-12T22:29:01Z",
  "updated_at": "2023-06-12T22:29:01Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!--üíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé\r\n\r\nHellooo! üòÑ \r\n\r\nTo help us tend to your issue faster, please search our currently open issues before submitting a new one.\r\nExisting issues often contain information about workarounds, resolution, or progress updates.\r\n\r\nüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé-->\r\n\r\n# üêû Bug Report\r\n\r\n### Description\r\n\r\nThe initial-sync \"estimated time remaining\" logs oscillates repeatedly, by 15x (e.g. 11-169h), every minute.\r\n\r\n<img width=\"144\" alt=\"image\" src=\"https://github.com/prysmaticlabs/prysm/assets/3518037/e00d481a-697c-42e0-9d3a-41e35ca84292\">\r\n\r\n\r\nI would expect a wobbly estimate but it should mostly decrease over time. What's actually happening is the time series calculation is getting reset over and over and over again leading to the nonsensical situation of reporting \"169h away, then later 11h away, then a few seconds later 169h away\"; repeatedly, every minute, for hours.\r\n\r\nThis would seem to indicate the time series averaging is implemented incorrectly. Cumulative time and cumulative blocks should be tracked outside the batch processor otherwise the estimate is not useful, as shown.\r\n\r\n```\r\n[2023-06-12 22:14:06]  INFO initial-sync: Processing block batch of size 57 starting from  0xefadb23f... 714558/2572870 - estimated time remaining 21h49m35s blocksPerSecond=23.6 peers=44\r\n[2023-06-12 22:14:31]  INFO initial-sync: Processing block batch of size 62 starting from  0x40226470... 714621/2572872 - estimated time remaining 166h30m35s blocksPerSecond=3.1 peers=45\r\n[2023-06-12 22:14:32]  INFO initial-sync: Processing block batch of size 60 starting from  0x95496133... 714685/2572872 - estimated time remaining 84h37m0s blocksPerSecond=6.1 peers=45\r\n[2023-06-12 22:14:33]  INFO initial-sync: Processing block batch of size 57 starting from  0x39766fde... 714749/2572872 - estimated time remaining 57h40m11s blocksPerSecond=8.9 peers=45\r\n[2023-06-12 22:14:34]  INFO initial-sync: Processing block batch of size 60 starting from  0xf943ab10... 714813/2572872 - estimated time remaining 43h11m26s blocksPerSecond=11.9 peers=44\r\n[2023-06-12 22:14:37]  INFO initial-sync: Processing block batch of size 59 starting from  0xfff7af0e... 714878/2572873 - estimated time remaining 34h38m17s blocksPerSecond=14.9 peers=43\r\n[2023-06-12 22:14:39]  INFO initial-sync: Processing block batch of size 61 starting from  0xf06ff537... 714941/2572873 - estimated time remaining 28h45m5s blocksPerSecond=17.9 peers=43\r\n[2023-06-12 22:14:39]  INFO initial-sync: Processing block batch of size 58 starting from  0xee757a08... 715006/2572873 - estimated time remaining 24h45m6s blocksPerSecond=20.9 peers=43\r\n[2023-06-12 22:14:40]  INFO initial-sync: Processing block batch of size 58 starting from  0xef85e3a6... 715069/2572873 - estimated time remaining 21h43m43s blocksPerSecond=23.8 peers=43\r\n[2023-06-12 22:14:41]  INFO initial-sync: Processing block batch of size 59 starting from  0xd745ff58... 715133/2572873 - estimated time remaining 19h19m38s blocksPerSecond=26.7 peers=43\r\n[2023-06-12 22:14:42]  INFO initial-sync: Processing block batch of size 58 starting from  0xd63c3120... 715197/2572873 - estimated time remaining 17h25m59s blocksPerSecond=29.6 peers=43\r\n[2023-06-12 22:14:43]  INFO initial-sync: Processing block batch of size 61 starting from  0xd31d5d02... 715261/2572873 - estimated time remaining 15h48m14s blocksPerSecond=32.6 peers=43\r\n[2023-06-12 22:14:44]  INFO initial-sync: Processing block batch of size 58 starting from  0x3a08d375... 715325/2572873 - estimated time remaining 14h30m51s blocksPerSecond=35.5 peers=43\r\n[2023-06-12 22:14:45]  INFO initial-sync: Processing block batch of size 58 starting from  0x52cfbe18... 715389/2572873 - estimated time remaining 13h25m9s blocksPerSecond=38.5 peers=43\r\n[2023-06-12 22:15:05]  INFO initial-sync: Processing block batch of size 61 starting from  0xc1337f36... 715453/2572875 - estimated time remaining 169h9m50s blocksPerSecond=3.0 peers=43\r\n[2023-06-12 22:15:06]  INFO initial-sync: Processing block batch of size 58 starting from  0x0dce5407... 715517/2572875 - estimated time remaining 86h42m41s blocksPerSecond=6.0 peers=43\r\n[2023-06-12 22:15:07]  INFO initial-sync: Processing block batch of size 63 starting from  0x927019ea... 715581/2572875 - estimated time remaining 56h41m38s blocksPerSecond=9.1 peers=43\r\n[2023-06-12 22:15:08]  INFO initial-sync: Processing block batch of size 61 starting from  0x37635846... 715645/2572875 - estimated time remaining 42h27m38s blocksPerSecond=12.2 peers=43\r\n[2023-06-12 22:15:15]  INFO initial-sync: Processing block batch of size 62 starting from  0xce5437dd... 715709/2572876 - estimated time remaining 33h49m41s blocksPerSecond=15.2 peers=43\r\n[2023-06-12 22:15:15]  INFO initial-sync: Processing block batch of size 58 starting from  0x5b122550... 715773/2572876 - estimated time remaining 28h25m19s blocksPerSecond=18.1 peers=43\r\n[2023-06-12 22:15:17]  INFO initial-sync: Processing block batch of size 57 starting from  0xafdd1fc5... 715839/2572876 - estimated time remaining 24h33m50s blocksPerSecond=21.0 peers=43\r\n[2023-06-12 22:15:17]  INFO initial-sync: Processing block batch of size 57 starting from  0x746e8a6c... 715901/2572876 - estimated time remaining 21h37m40s blocksPerSecond=23.9 peers=43\r\n[2023-06-12 22:15:18]  INFO initial-sync: Processing block batch of size 60 starting from  0xeda47713... 715965/2572876 - estimated time remaining 19h12m38s blocksPerSecond=26.9 peers=43\r\n[2023-06-12 22:15:19]  INFO initial-sync: Processing block batch of size 60 starting from  0xafb58645... 716029/2572876 - estimated time remaining 17h16m45s blocksPerSecond=29.9 peers=43\r\n[2023-06-12 22:15:20]  INFO initial-sync: Processing block batch of size 60 starting from  0x7ecd6655... 716093/2572876 - estimated time remaining 15h42m3s blocksPerSecond=32.9 peers=43\r\n[2023-06-12 22:15:21]  INFO initial-sync: Processing block batch of size 60 starting from  0x04730066... 716157/2572876 - estimated time remaining 14h23m11s blocksPerSecond=35.9 peers=43\r\n[2023-06-12 22:15:22]  INFO initial-sync: Processing block batch of size 58 starting from  0xf8dccda3... 716222/2572876 - estimated time remaining 13h18m33s blocksPerSecond=38.8 peers=43\r\n[2023-06-12 22:15:40]  INFO initial-sync: Processing block batch of size 61 starting from  0x67e36645... 716285/2572878 - estimated time remaining 86h40m32s blocksPerSecond=6.0 peers=43\r\n[2023-06-12 22:15:41]  INFO initial-sync: Processing block batch of size 58 starting from  0x9537bcbf... 716349/2572878 - estimated time remaining 86h40m21s blocksPerSecond=6.0 peers=43\r\n[2023-06-12 22:15:42]  INFO initial-sync: Processing block batch of size 59 starting from  0x7c4ed6b2... 716413/2572878 - estimated time remaining 57h56m31s blocksPerSecond=8.9 peers=43\r\n[2023-06-12 22:15:51]  INFO initial-sync: Processing block batch of size 61 starting from  0xf4b6ea3b... 716477/2572879 - estimated time remaining 43h9m7s blocksPerSecond=11.9 peers=43\r\n[2023-06-12 22:15:54]  INFO initial-sync: Processing block batch of size 59 starting from  0x412dc878... 716541/2572879 - estimated time remaining 34h36m26s blocksPerSecond=14.9 peers=43\r\n[2023-06-12 22:15:55]  INFO initial-sync: Processing block batch of size 62 starting from  0x03c4cf30... 716605/2572879 - estimated time remaining 28h38m46s blocksPerSecond=18.0 peers=43\r\n[2023-06-12 22:15:56]  INFO initial-sync: Processing block batch of size 63 starting from  0xc01a3c7f... 716669/2572879 - estimated time remaining 24h22m44s blocksPerSecond=21.1 peers=43\r\n[2023-06-12 22:15:56]  INFO initial-sync: Processing block batch of size 62 starting from  0x9c2078b9... 716733/2572879 - estimated time remaining 21h15m42s blocksPerSecond=24.2 peers=43\r\n[2023-06-12 22:15:57]  INFO initial-sync: Processing block batch of size 56 starting from  0xc6e7ee87... 716797/2572879 - estimated time remaining 19h3m36s blocksPerSecond=27.1 peers=43\r\n[2023-06-12 22:15:58]  INFO initial-sync: Processing block batch of size 63 starting from  0xe85a5ee2... 716861/2572879 - estimated time remaining 17h4m17s blocksPerSecond=30.2 peers=43\r\n[2023-06-12 22:15:59]  INFO initial-sync: Processing block batch of size 59 starting from  0x84d9dcf9... 716925/2572879 - estimated time remaining 15h33m6s blocksPerSecond=33.1 peers=43\r\n[2023-06-12 22:16:00]  INFO initial-sync: Processing block batch of size 64 starting from  0x51a4e19a... 716989/2572880 - estimated time remaining 15h28m52s blocksPerSecond=33.3 peers=43\r\n[2023-06-12 22:16:01]  INFO initial-sync: Processing block batch of size 61 starting from  0x4d5e0388... 717053/2572880 - estimated time remaining 15h24m40s blocksPerSecond=33.5 peers=43\r\n[2023-06-12 22:16:02]  INFO initial-sync: Processing block batch of size 60 starting from  0x8a58fafd... 717117/2572880 - estimated time remaining 15h23m15s blocksPerSecond=33.5 peers=44\r\n[2023-06-12 22:16:04]  INFO initial-sync: Processing block batch of size 62 starting from  0x24220390... 717181/2572880 - estimated time remaining 14h5m2s blocksPerSecond=36.6 peers=44\r\n[2023-06-12 22:16:14]  INFO initial-sync: Processing block batch of size 60 starting from  0x475b1de0... 717246/2572881 - estimated time remaining 15h20m27s blocksPerSecond=33.6 peers=46\r\n[2023-06-12 22:16:30]  INFO initial-sync: Processing block batch of size 59 starting from  0x66a91d46... 717309/2572882 - estimated time remaining 86h37m41s blocksPerSecond=6.0 peers=46\r\n[2023-06-12 22:16:44]  INFO initial-sync: Processing block batch of size 61 starting from  0x8cb3e815... 717373/2572883 - estimated time remaining 85h54m11s blocksPerSecond=6.0 peers=45\r\n[2023-06-12 22:16:45]  INFO initial-sync: Processing block batch of size 61 starting from  0x90a07c9e... 717437/2572883 - estimated time remaining 56h57m1s blocksPerSecond=9.1 peers=45\r\n[2023-06-12 22:16:45]  INFO initial-sync: Processing block batch of size 62 starting from  0x9ef054e1... 717501/2572883 - estimated time remaining 42h25m6s blocksPerSecond=12.2 peers=44\r\n[2023-06-12 22:16:46]  INFO initial-sync: Processing block batch of size 63 starting from  0xd13f168a... 717565/2572883 - estimated time remaining 33h41m2s blocksPerSecond=15.3 peers=44\r\n[2023-06-12 22:16:51]  INFO initial-sync: Processing block batch of size 59 starting from  0x7f986579... 717629/2572884 - estimated time remaining 33h40m58s blocksPerSecond=15.3 peers=44\r\n[2023-06-12 22:16:52]  INFO initial-sync: Processing block batch of size 62 starting from  0x5f5668a7... 717693/2572884 - estimated time remaining 28h0m25s blocksPerSecond=18.4 peers=44\r\n[2023-06-12 22:16:53]  INFO initial-sync: Processing block batch of size 60 starting from  0x3c1edbd3... 717757/2572884 - estimated time remaining 24h4m48s blocksPerSecond=21.4 peers=44\r\n[2023-06-12 22:16:54]  INFO initial-sync: Processing block batch of size 57 starting from  0x533f4f1b... 717821/2572884 - estimated time remaining 21h14m57s blocksPerSecond=24.2 peers=44\r\n[2023-06-12 22:16:55]  INFO initial-sync: Processing block batch of size 59 starting from  0x8478edb3... 717885/2572884 - estimated time remaining 18h56m38s blocksPerSecond=27.2 peers=44\r\n[2023-06-12 22:17:02]  INFO initial-sync: Processing block batch of size 60 starting from  0xdf65093e... 717949/2572885 - estimated time remaining 17h3m41s blocksPerSecond=30.2 peers=45\r\n[2023-06-12 22:17:03]  INFO initial-sync: Processing block batch of size 59 starting from  0x527f9d43... 718013/2572885 - estimated time remaining 15h32m33s blocksPerSecond=33.1 peers=45\r\n[2023-06-12 22:17:04]  INFO initial-sync: Processing block batch of size 60 starting from  0xb57afba9... 718077/2572885 - estimated time remaining 15h33m56s blocksPerSecond=33.1 peers=45\r\n[2023-06-12 22:17:04]  INFO initial-sync: Processing block batch of size 60 starting from  0x85b8d78f... 718141/2572885 - estimated time remaining 15h35m19s blocksPerSecond=33.0 peers=45\r\n[2023-06-12 22:17:06]  INFO initial-sync: Processing block batch of size 61 starting from  0x8d23bfe1... 718205/2572885 - estimated time remaining 15h36m42s blocksPerSecond=33.0 peers=45\r\n[2023-06-12 22:17:06]  INFO initial-sync: Processing block batch of size 61 starting from  0x95a6e576... 718269/2572885 - estimated time remaining 15h39m31s blocksPerSecond=32.9 peers=45\r\n[2023-06-12 22:17:07]  INFO initial-sync: Processing block batch of size 63 starting from  0xc3603ad5... 718333/2572885 - estimated time remaining 14h17m23s blocksPerSecond=36.0 peers=45\r\n[2023-06-12 22:17:08]  INFO initial-sync: Processing block batch of size 59 starting from  0x69f49e3a... 718398/2572885 - estimated time remaining 13h12m30s blocksPerSecond=39.0 peers=45\r\n[2023-06-12 22:17:09]  INFO initial-sync: Processing block batch of size 59 starting from  0x4ec181f1... 718461/2572885 - estimated time remaining 12h16m45s blocksPerSecond=42.0 peers=45\r\n[2023-06-12 22:17:10]  INFO initial-sync: Processing block batch of size 61 starting from  0xd35abdb0... 718525/2572885 - estimated time remaining 11h26m48s blocksPerSecond=45.0 peers=45\r\n[2023-06-12 22:17:39]  INFO initial-sync: Processing block batch of size 60 starting from  0xd531ea29... 718589/2572888 - estimated time remaining 171h41m39s blocksPerSecond=3.0 peers=45\r\n[2023-06-12 22:17:40]  INFO initial-sync: Processing block batch of size 62 starting from  0x96b4f331... 718653/2572888 - estimated time remaining 84h26m12s blocksPerSecond=6.1 peers=45\r\n[2023-06-12 22:17:41]  INFO initial-sync: Processing block batch of size 61 starting from  0x8606a074... 718717/2572888 - estimated time remaining 56h17m21s blocksPerSecond=9.2 peers=45\r\n[2023-06-12 22:17:42]  INFO initial-sync: Processing block batch of size 58 starting from  0x164801aa... 718781/2572888 - estimated time remaining 42h44m27s blocksPerSecond=12.1 peers=45\r\n[2023-06-12 22:18:09]  INFO initial-sync: Processing block batch of size 58 starting from  0x6809d2ab... 718845/2572890 - estimated time remaining 177h35m25s blocksPerSecond=2.9 peers=45\r\n[2023-06-12 22:18:39]  INFO initial-sync: Processing block batch of size 60 starting from  0x614f473b... 718909/2572893 - estimated time remaining 171h39m54s blocksPerSecond=3.0 peers=45\r\n[2023-06-12 22:18:40]  INFO initial-sync: Processing block batch of size 64 starting from  0x88d43839... 718973/2572893 - estimated time remaining 83h3m39s blocksPerSecond=6.2 peers=45\r\n[2023-06-12 22:18:41]  INFO initial-sync: Processing block batch of size 62 starting from  0x93f598d0... 719037/2572893 - estimated time remaining 55h22m19s blocksPerSecond=9.3 peers=45\r\n[2023-06-12 22:18:42]  INFO initial-sync: Processing block batch of size 60 starting from  0x85bc9b50... 719101/2572893 - estimated time remaining 41h51m54s blocksPerSecond=12.3 peers=45\r\n[2023-06-12 22:18:42]  INFO initial-sync: Processing block batch of size 59 starting from  0xfd8d3995... 719165/2572893 - estimated time remaining 33h45m55s blocksPerSecond=15.2 peers=45\r\n[2023-06-12 22:18:43]  INFO initial-sync: Processing block batch of size 57 starting from  0x2b6db5cf... 719229/2572893 - estimated time remaining 28h26m52s blocksPerSecond=18.1 peers=45\r\n[2023-06-12 22:18:44]  INFO initial-sync: Processing block batch of size 63 starting from  0xd07b0768... 719293/2572893 - estimated time remaining 24h13m48s blocksPerSecond=21.2 peers=45\r\n[2023-06-12 22:18:45]  INFO initial-sync: Processing block batch of size 60 starting from  0xb9250289... 719357/2572893 - estimated time remaining 21h13m54s blocksPerSecond=24.2 peers=45\r\n[2023-06-12 22:18:46]  INFO initial-sync: Processing block batch of size 58 starting from  0x83391694... 719421/2572893 - estimated time remaining 18h57m47s blocksPerSecond=27.1 peers=45\r\n[2023-06-12 22:18:47]  INFO initial-sync: Processing block batch of size 58 starting from  0x3b82e164... 719485/2572893 - estimated time remaining 17h7m57s blocksPerSecond=30.1 peers=45\r\n```\r\n\r\n<!-- ‚úçÔ∏è--> A clear and concise description of the problem...\r\n\r\n### Has this worked before in a previous version?\r\n\r\n<!-- Did this behavior use to work in the previous version? -->\r\n<!-- ‚úçÔ∏è--> Yes, the previous version in which this bug was not present was: ....\r\n\r\n## üî¨ Minimal Reproduction\r\n\r\nSync Sepolia and grep \"initial-sync\" in the logs.\r\n\r\n\r\n**What version of Prysm are you running? (Which release)**\r\n\r\ndocker `gcr.io/prysmaticlabs/prysm/beacon-chain:stable`\r\n```\r\nversion: '3'\r\n\r\nservices:\r\n  prysm:\r\n    container_name: sepolia-prysm${RUN_ID}\r\n    image: gcr.io/prysmaticlabs/prysm/beacon-chain:stable\r\n    user: $UID:$GID\r\n    tty: true\r\n    command:\r\n      - --datadir=/datadir\r\n      - --jwt-secret=/jwt.hex\r\n      - --rpc-host=0.0.0.0\r\n      - --grpc-gateway-host=0.0.0.0\r\n      - --monitoring-host=0.0.0.0\r\n      - --execution-endpoint=http://sepolia-geth:8551\r\n      - --genesis-state=/genesis/genesis.ssz\r\n      - --sepolia\r\n      - --accept-terms-of-use\r\n    volumes:\r\n      - .:/datadir\r\n      - ../genesis.ssz:/genesis/genesis.ssz\r\n      - ../../jwt.hex:/jwt.hex\r\n    environment:\r\n      - GID\r\n      - RUN_ID\r\n      - UID\r\n    ports:\r\n      - 12000:12000\r\n      - 13000:13000\r\n```\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12517/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12517/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
