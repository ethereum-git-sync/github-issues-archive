{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12348",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12348/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12348/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12348/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/12348",
  "id": 1688739158,
  "node_id": "I_kwDOBvuov85kqB1W",
  "number": 12348,
  "title": "Export metric for validator_identity and include index",
  "user": {
    "login": "0xste",
    "id": 16362825,
    "node_id": "MDQ6VXNlcjE2MzYyODI1",
    "avatar_url": "https://avatars.githubusercontent.com/u/16362825?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0xste",
    "html_url": "https://github.com/0xste",
    "followers_url": "https://api.github.com/users/0xste/followers",
    "following_url": "https://api.github.com/users/0xste/following{/other_user}",
    "gists_url": "https://api.github.com/users/0xste/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0xste/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0xste/subscriptions",
    "organizations_url": "https://api.github.com/users/0xste/orgs",
    "repos_url": "https://api.github.com/users/0xste/repos",
    "events_url": "https://api.github.com/users/0xste/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0xste/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129906,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDY=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Enhancement",
      "name": "Enhancement",
      "color": "84b6eb",
      "default": false,
      "description": "New feature or request"
    },
    {
      "id": 802129907,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDc=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Help%20Wanted",
      "name": "Help Wanted",
      "color": "33aa3f",
      "default": false,
      "description": "Extra attention is needed"
    },
    {
      "id": 802129908,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDg=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Good%20First%20Issue",
      "name": "Good First Issue",
      "color": "7057ff",
      "default": false,
      "description": "Good for newcomers"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-04-28T15:19:13Z",
  "updated_at": "2023-07-25T09:22:27Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "# 🚀 Feature Request\r\n\r\n### Description\r\nWe don't currently have a way to retrieve validator index from prometheus, it's useful when joining to other metrics\r\n\r\n### Describe the solution you'd like\r\nIntroduce a metric like:\r\n`validator_identity_info{pubkey=\"0xa8e6154ac3be1246a5a229c8b3d9328dfc2d5da3e73bc1891da0ee9596f345b42e79f3878f879d0fa3df9ea72eb28725\", index=\"469113\"}`\r\n\r\n- Info suffix as per -> https://prometheus.io/docs/practices/naming/\r\n- Other default metrics can be added by the agent i.e. hostname/instance/job",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12348/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12348/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1527731403",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/12348#issuecomment-1527731403",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12348",
    "id": 1527731403,
    "node_id": "IC_kwDOBvuov85bD1TL",
    "user": {
      "login": "0xste",
      "id": 16362825,
      "node_id": "MDQ6VXNlcjE2MzYyODI1",
      "avatar_url": "https://avatars.githubusercontent.com/u/16362825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xste",
      "html_url": "https://github.com/0xste",
      "followers_url": "https://api.github.com/users/0xste/followers",
      "following_url": "https://api.github.com/users/0xste/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xste/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xste/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xste/subscriptions",
      "organizations_url": "https://api.github.com/users/0xste/orgs",
      "repos_url": "https://api.github.com/users/0xste/repos",
      "events_url": "https://api.github.com/users/0xste/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xste/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-28T15:24:37Z",
    "updated_at": "2023-04-28T15:24:37Z",
    "author_association": "NONE",
    "body": "\r\nCode may look something like:\r\n\r\n`prysm/validator/client.go Global Var`\r\n```\r\n\t// ValidatorIdentityGaugeVec used to track validator identity\r\n\tValidatorIdentityGaugeVec = promauto.NewGaugeVec(\r\n\t\tprometheus.GaugeOpts{\r\n\t\t\tNamespace: \"validator\",\r\n\t\t\tName:      \"identity_info\",\r\n\t\t\tHelp:      \"Identifying information for the validator\",\r\n\t\t},\r\n\t\t[]string{\r\n\t\t\t\"pubkey\", \"index\",\r\n\t\t},\r\n\t)\r\n```\r\n\r\n`prysm/validator/client.go logForEachValidator(...)`\r\n```\r\nValidatorIdentityGaugeVec.WithLabelValues(pubKey, index).Set(1) \r\n```\r\n\r\nI'm not sure we'd need to care too much de-registering exited validators too much given this is an info metric",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1527731403/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1537292530",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/12348#issuecomment-1537292530",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12348",
    "id": 1537292530,
    "node_id": "IC_kwDOBvuov85boTjy",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-07T05:05:59Z",
    "updated_at": "2023-05-07T05:05:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @0xSte we've talked about this before but adding the pubkey would increase the [cardinality](https://grafana.com/blog/2022/10/20/how-to-manage-high-cardinality-metrics-in-prometheus-and-kubernetes/) of our metrics significantly. We have tried this and it affects operators that are running a lot of keys",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1537292530/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1539652137",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/12348#issuecomment-1539652137",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12348",
    "id": 1539652137,
    "node_id": "IC_kwDOBvuov85bxTop",
    "user": {
      "login": "0xste",
      "id": 16362825,
      "node_id": "MDQ6VXNlcjE2MzYyODI1",
      "avatar_url": "https://avatars.githubusercontent.com/u/16362825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xste",
      "html_url": "https://github.com/0xste",
      "followers_url": "https://api.github.com/users/0xste/followers",
      "following_url": "https://api.github.com/users/0xste/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xste/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xste/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xste/subscriptions",
      "organizations_url": "https://api.github.com/users/0xste/orgs",
      "repos_url": "https://api.github.com/users/0xste/repos",
      "events_url": "https://api.github.com/users/0xste/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xste/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-09T08:08:28Z",
    "updated_at": "2023-05-09T08:08:28Z",
    "author_association": "NONE",
    "body": "Alternatively @rauljordan, we could add validator index to an existing high-cardinality metric behind the \"emitAccountMetrics\" flag to reduce the need for additional active series, would this approach satisfy the cardinality non-functional requirement?\r\n\r\n\r\nhttps://github.com/prysmaticlabs/prysm/blob/535b38395ec8a47447192cefb283394f839f7e61/validator/client/metrics.go#L20-L29\r\n\r\n\r\nbecomes -> \r\n```\r\n...\r\n\t\t[]string{\r\n\t\t\t\"pubkey\", \"index\"\r\n\t\t},\r\n...\r\n```\r\n---\r\n\r\nhttps://github.com/prysmaticlabs/prysm/blob/535b38395ec8a47447192cefb283394f839f7e61/validator/client/validator.go#L384-L387\r\n\r\nbecomes -> \r\n\r\n```\r\n\t\tif v.emitAccountMetrics {\r\n\t\t\tfmtKey := fmt.Sprintf(\"%#x\", status.publicKey)\r\n\t\t\tValidatorStatusesGaugeVec.WithLabelValues(fmtKey, status.index).Set(float64(status.status.Status))\r\n\t\t}\r\n\r\n```\r\n\r\n---\r\n\r\nhttps://github.com/prysmaticlabs/prysm/blob/535b38395ec8a47447192cefb283394f839f7e61/validator/client/validator.go#L914-L916\r\n\r\n☝️getting index is a bit more involved in this instance\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1539652137/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1539654659",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/12348#issuecomment-1539654659",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12348",
    "id": 1539654659,
    "node_id": "IC_kwDOBvuov85bxUQD",
    "user": {
      "login": "0xste",
      "id": 16362825,
      "node_id": "MDQ6VXNlcjE2MzYyODI1",
      "avatar_url": "https://avatars.githubusercontent.com/u/16362825?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xste",
      "html_url": "https://github.com/0xste",
      "followers_url": "https://api.github.com/users/0xste/followers",
      "following_url": "https://api.github.com/users/0xste/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xste/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xste/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xste/subscriptions",
      "organizations_url": "https://api.github.com/users/0xste/orgs",
      "repos_url": "https://api.github.com/users/0xste/repos",
      "events_url": "https://api.github.com/users/0xste/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xste/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-09T08:10:25Z",
    "updated_at": "2023-05-09T08:11:02Z",
    "author_association": "NONE",
    "body": "My understanding is that there's a 1:1 relationship between pubkey + index and that it's assigned on validator activation? I may be missing some context\r\n\r\n> The validator is then assigned an index number and placed into a queue for activation\r\n\r\nhttps://docs.prylabs.network/docs/how-prysm-works/validator-lifecycle#pending-state",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1539654659/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
