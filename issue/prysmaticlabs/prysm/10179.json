{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10179",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10179/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10179/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10179/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/10179",
  "id": 1122855358,
  "node_id": "I_kwDOBvuov85C7Wm-",
  "number": 10179,
  "title": "Space Efficient Representation of Deposit Trie",
  "user": {
    "login": "nisdas",
    "id": 33201827,
    "node_id": "MDQ6VXNlcjMzMjAxODI3",
    "avatar_url": "https://avatars.githubusercontent.com/u/33201827?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nisdas",
    "html_url": "https://github.com/nisdas",
    "followers_url": "https://api.github.com/users/nisdas/followers",
    "following_url": "https://api.github.com/users/nisdas/following{/other_user}",
    "gists_url": "https://api.github.com/users/nisdas/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nisdas/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nisdas/subscriptions",
    "organizations_url": "https://api.github.com/users/nisdas/orgs",
    "repos_url": "https://api.github.com/users/nisdas/repos",
    "events_url": "https://api.github.com/users/nisdas/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nisdas/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129906,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDY=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Enhancement",
      "name": "Enhancement",
      "color": "84b6eb",
      "default": false,
      "description": "New feature or request"
    },
    {
      "id": 802129907,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDc=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Help%20Wanted",
      "name": "Help Wanted",
      "color": "33aa3f",
      "default": false,
      "description": "Extra attention is needed"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-02-03T09:38:13Z",
  "updated_at": "2023-01-05T00:34:26Z",
  "closed_at": "2023-01-05T00:34:26Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "# ðŸš€ Feature Request\r\n\r\n### Description\r\n\r\nWith the large growth of the validator registry and the constant deposits into the beacon-chain, the size of our in-memory\r\ndeposit trie has been growing to a non-trivial size. Maintaining this in memory will lead to a larger amount of our heap being \r\nallocated to represent our trie. \r\n\r\n### Describe the solution you'd like\r\n\r\nOur deposit trie, has a few properties that allow us to perform a certain set of optimizations on. \r\n-> New deposits into the trie are always inserted into a new index ( last deposit index +1)\r\n-> Old deposits are permanently written into the trie and cannot be overwritten by later deposits.\r\n\r\nGiven that new deposits inserted in will always have a higher deposit number, we can maintain a lot fewer interior nodes than\r\nwe do now. \r\n\r\nCurrently if we have a set of deposits:\r\n```\r\nD_0 , D_1 , D_2 , D_3 ....... D_N-1 \r\n```\r\n\r\nWe would store the parent nodes of roots of those deposit in the level above:\r\n```\r\nR_(0 1) , R_(2 3), R_(4 5) ..... R_(N-2 N-1)\r\n```\r\nThe same reduction applies for the level above in the trie and so on. We would continue\r\ndoing this until we reached `R_Trie` . Currently we persist all these deposit roots and their relevant interior nodes. While this \r\nwasn't an issue when we had a small amount of deposits, with mainnet being as large as it has been, the space taken up by those interior nodes has grown. \r\n\r\nGiven that we only expect to insert new deposits into the trie at a higher index, we can make some simplifications. Instead of storing \r\n\r\n```\r\nR_(0 1) , R_(2 3), R_(4 5) ..... R_(N-2 N-1)\r\n```\r\nand all its interior nodes, we just need to store the last branch. In the above case it would simply be \r\n```\r\nR_Trie\r\n.\r\n.\r\n.\r\nR_(N-2 N-1)\r\n      \\\r\n    R _ N-1\r\n```\r\n\r\nBy simply keeping this branch, you can use it to derive the next branch for a new deposit. Instead of storing `2n` roots , you would only need to store `log n + a` roots, where a is a fixed constant. This would be a very large improvement over the current status-quo and is especially effective for a large number of deposits. \r\n  \r\n### Describe alternatives you've considered\r\n\r\nNone others so far\r\n",
  "closed_by": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10179/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10179/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1128505945",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/10179#issuecomment-1128505945",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10179",
    "id": 1128505945,
    "node_id": "IC_kwDOBvuov85DQ6JZ",
    "user": {
      "login": "potuz",
      "id": 16044918,
      "node_id": "MDQ6VXNlcjE2MDQ0OTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16044918?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/potuz",
      "html_url": "https://github.com/potuz",
      "followers_url": "https://api.github.com/users/potuz/followers",
      "following_url": "https://api.github.com/users/potuz/following{/other_user}",
      "gists_url": "https://api.github.com/users/potuz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/potuz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/potuz/subscriptions",
      "organizations_url": "https://api.github.com/users/potuz/orgs",
      "repos_url": "https://api.github.com/users/potuz/repos",
      "events_url": "https://api.github.com/users/potuz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/potuz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-17T07:20:30Z",
    "updated_at": "2022-05-17T07:20:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "Putting this here for lack of a better place as it's vaguely related if we can prune old deposits\r\n\r\nhttps://eips.ethereum.org/EIPS/eip-4881",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1128505945/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1371585003",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/10179#issuecomment-1371585003",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10179",
    "id": 1371585003,
    "node_id": "IC_kwDOBvuov85RwLnr",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-05T00:34:26Z",
    "updated_at": "2023-01-05T00:34:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing in favor of #11256 ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1371585003/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
