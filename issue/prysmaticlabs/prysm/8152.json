{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8152",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8152/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8152/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8152/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/8152",
  "id": 770313849,
  "node_id": "MDU6SXNzdWU3NzAzMTM4NDk=",
  "number": 8152,
  "title": "Beacon node DB backup not working after first successful backup (Windows 10)",
  "user": {
    "login": "yv989c",
    "id": 3805212,
    "node_id": "MDQ6VXNlcjM4MDUyMTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3805212?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yv989c",
    "html_url": "https://github.com/yv989c",
    "followers_url": "https://api.github.com/users/yv989c/followers",
    "following_url": "https://api.github.com/users/yv989c/following{/other_user}",
    "gists_url": "https://api.github.com/users/yv989c/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yv989c/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yv989c/subscriptions",
    "organizations_url": "https://api.github.com/users/yv989c/orgs",
    "repos_url": "https://api.github.com/users/yv989c/repos",
    "events_url": "https://api.github.com/users/yv989c/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yv989c/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129904,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDQ=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Bug",
      "name": "Bug",
      "color": "ee0701",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1085357069,
      "node_id": "MDU6TGFiZWwxMDg1MzU3MDY5",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Priority:%20High",
      "name": "Priority: High",
      "color": "f7ea26",
      "default": false,
      "description": "High priority item"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-12-17T19:35:43Z",
  "updated_at": "2021-01-04T22:48:43Z",
  "closed_at": "2021-01-04T22:48:43Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!--üíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé\r\n\r\nHellooo! üòÑ \r\n\r\nTo help us tend to your issue faster, please search our currently open issues before submitting a new one.\r\nExisting issues often contain information about workarounds, resolution, or progress updates.\r\n\r\nüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé-->\r\n\r\n# üêû Bug Report\r\n\r\n### Description\r\n\r\nAfter properly setting up the beacon node startup parameters to enable database backups, I'm able to perform an initial backup if the target backup folder does not exist, after it's created then subsequent backup attempts will fail with the following error:\r\n`Failed to create backup error=dir already exists without proper 0700 permissions`\r\n\r\nMy startup script:\r\n`prysm.bat beacon-chain --config-file=config.yaml`\r\n\r\nMy config.yaml content\r\n<pre>\r\n<code>datadir: 'C:\\Apps\\prysm\\data'\r\nhttp-web3provider: 'http://localhost:8545'\r\np2p-max-peers: 5\r\ndb-backup-output-dir: E:\\prysm-data\\backups\r\nenable-db-backup-webhook: true</code></pre>\r\n\r\n### Has this worked before in a previous version?\r\nI don't know. I'm starting with v1.0.5.\r\n\r\n## üî¨ Minimal Reproduction\r\nStart the beacon node with the parameters shown above, let it sync-up and then execute:\r\n`curl -I http://127.0.0.1:8080/db/backup`\r\n\r\nIf the target backup folder does not exists, it will be created and a backup file too, after that, any subsequent attempts will result in the error shown below.\r\n\r\n<!--\r\nPlease let us know how we can reproduce this issue. Include the exact method you used to run Prysm along with any flags used in your beacon chain and/or validator. Make sure you don't upload any confidential files or private keys.\r\n-->\r\n\r\n## üî• Error\r\n\r\n<pre><code>[2020-12-17 14:13:47]  INFO blockchain: Synced new block block=0x9f171744... epoch=3667 finalizedEpoch=3665 finalizedRoot=0xcdfe7715... slot=117367 slotInEpoch=23\r\n[2020-12-17 14:13:47]  INFO blockchain: Finished applying state transition attestations=8 attesterSlashings=0 deposits=0 proposerSlashings=0 voluntaryExits=0\r\n[2020-12-17 14:13:51] ERROR db: Failed to create backup error=dir already exists without proper 0700 permissions\r\ngithub.com/prysmaticlabs/prysm/shared/fileutil.MkdirAll\r\n        shared/fileutil/fileutil.go:50\r\ngithub.com/prysmaticlabs/prysm/beacon-chain/db/kv.(*Store).Backup\r\n        beacon-chain/db/kv/backup.go:42\r\ngithub.com/prysmaticlabs/prysm/shared/backuputil.BackupHandler.func1\r\n        shared/backuputil/http_backup_handler.go:22\r\nnet/http.HandlerFunc.ServeHTTP\r\n        GOROOT/src/net/http/server.go:2042\r\nnet/http.(*ServeMux).ServeHTTP\r\n        GOROOT/src/net/http/server.go:2417\r\nnet/http.serverHandler.ServeHTTP\r\n        GOROOT/src/net/http/server.go:2843\r\nnet/http.(*conn).serve\r\n        GOROOT/src/net/http/server.go:1925\r\nruntime.goexit\r\n        src/runtime/asm_amd64.s:1374\r\n[2020-12-17 14:13:59]  INFO blockchain: Synced new block block=0x13113387... epoch=3667 finalizedEpoch=3665 finalizedRoot=0xcdfe7715... slot=117368 slotInEpoch=24\r\n[2020-12-17 14:13:59]  INFO blockchain: Finished applying state transition attestations=30 attesterSlashings=0 deposits=0 proposerSlashings=0 voluntaryExits=0</code></pre>\r\n\r\n\r\n## üåç  Your Environment\r\n\r\n**Operating System:**\r\n\r\n<pre>\r\n  <code>\r\nWindows 10 Pro (2004)\r\n  </code>\r\n</pre>\r\n\r\n**What version of Prysm are you running? (Which release)**\r\n\r\n<pre>\r\n  <code>\r\nv1.0.5 (beacon-chain-v1.0.5-windows-amd64.exe)\r\n  </code>\r\n</pre>\r\n\r\n**Anything else relevant (validator index / public key)?**\r\n\r\n",
  "closed_by": {
    "login": "prylabs-bulldozer[bot]",
    "id": 58059840,
    "node_id": "MDM6Qm90NTgwNTk4NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/in/47372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D",
    "html_url": "https://github.com/apps/prylabs-bulldozer",
    "followers_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8152/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8152/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/750442508",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/8152#issuecomment-750442508",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8152",
    "id": 750442508,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MDQ0MjUwOA==",
    "user": {
      "login": "yv989c",
      "id": 3805212,
      "node_id": "MDQ6VXNlcjM4MDUyMTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3805212?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yv989c",
      "html_url": "https://github.com/yv989c",
      "followers_url": "https://api.github.com/users/yv989c/followers",
      "following_url": "https://api.github.com/users/yv989c/following{/other_user}",
      "gists_url": "https://api.github.com/users/yv989c/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yv989c/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yv989c/subscriptions",
      "organizations_url": "https://api.github.com/users/yv989c/orgs",
      "repos_url": "https://api.github.com/users/yv989c/repos",
      "events_url": "https://api.github.com/users/yv989c/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yv989c/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-23T19:33:01Z",
    "updated_at": "2020-12-23T19:35:42Z",
    "author_association": "NONE",
    "body": "Hi @Cipioo , I believe https://github.com/prysmaticlabs/prysm/pull/8164 should also fix another permission issue that I'm getting when importing subsequent validator keys.\r\n\r\n> [2020-12-21 20:19:29]  WARN flags: Running on ETH2 Mainnet\r\nEnter the password for your imported accounts:\r\nImporting accounts, this may take a while...\r\nImporting accounts... 100% [==========================================]  [2s:0s]\r\n[2020-12-21 20:20:48] FATAL accounts: Could not import accounts: could not write accounts: file already exists without proper 0600 permissions\r\nERROR FAILED\r\n\r\nThe line throwing this error seems to be:\r\nhttps://github.com/prysmaticlabs/prysm/blob/a0c475671c4e13fd3092ac77c17cf15621820d77/shared/fileutil/fileutil.go#L74\r\n\r\nAnd this PR is introducing new `ReadWritePermissions` flags when running on Windows, that I hope will address this issue.\r\n\r\nIn order to workaround this, I had to delete the wallet and import all the validators at once.\r\n\r\nThanks.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/750442508/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/750481435",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/8152#issuecomment-750481435",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8152",
    "id": 750481435,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MDQ4MTQzNQ==",
    "user": {
      "login": "Cipioo",
      "id": 4355533,
      "node_id": "MDQ6VXNlcjQzNTU1MzM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4355533?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Cipioo",
      "html_url": "https://github.com/Cipioo",
      "followers_url": "https://api.github.com/users/Cipioo/followers",
      "following_url": "https://api.github.com/users/Cipioo/following{/other_user}",
      "gists_url": "https://api.github.com/users/Cipioo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Cipioo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Cipioo/subscriptions",
      "organizations_url": "https://api.github.com/users/Cipioo/orgs",
      "repos_url": "https://api.github.com/users/Cipioo/repos",
      "events_url": "https://api.github.com/users/Cipioo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Cipioo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-23T21:30:26Z",
    "updated_at": "2020-12-23T21:32:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yes, this should fix that issue as well. See issue #7898 ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/750481435/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/751369520",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/8152#issuecomment-751369520",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8152",
    "id": 751369520,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MTM2OTUyMA==",
    "user": {
      "login": "aaqr12",
      "id": 76606520,
      "node_id": "MDQ6VXNlcjc2NjA2NTIw",
      "avatar_url": "https://avatars.githubusercontent.com/u/76606520?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/aaqr12",
      "html_url": "https://github.com/aaqr12",
      "followers_url": "https://api.github.com/users/aaqr12/followers",
      "following_url": "https://api.github.com/users/aaqr12/following{/other_user}",
      "gists_url": "https://api.github.com/users/aaqr12/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/aaqr12/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/aaqr12/subscriptions",
      "organizations_url": "https://api.github.com/users/aaqr12/orgs",
      "repos_url": "https://api.github.com/users/aaqr12/repos",
      "events_url": "https://api.github.com/users/aaqr12/events{/privacy}",
      "received_events_url": "https://api.github.com/users/aaqr12/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-26T16:01:42Z",
    "updated_at": "2020-12-26T16:01:42Z",
    "author_association": "NONE",
    "body": "I'm currently in the process of verifying with one key, and if you import another key after you deposit it, that error will occur.\r\nCan I delete my wallet and call it back in this situation?",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/751369520/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
