{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6891",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6891/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6891/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6891/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/6891",
  "id": 673691353,
  "node_id": "MDU6SXNzdWU2NzM2OTEzNTM=",
  "number": 6891,
  "title": "Replacing deprecated packages and members",
  "user": {
    "login": "rkapka",
    "id": 28876818,
    "node_id": "MDQ6VXNlcjI4ODc2ODE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/28876818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rkapka",
    "html_url": "https://github.com/rkapka",
    "followers_url": "https://api.github.com/users/rkapka/followers",
    "following_url": "https://api.github.com/users/rkapka/following{/other_user}",
    "gists_url": "https://api.github.com/users/rkapka/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rkapka/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rkapka/subscriptions",
    "organizations_url": "https://api.github.com/users/rkapka/orgs",
    "repos_url": "https://api.github.com/users/rkapka/repos",
    "events_url": "https://api.github.com/users/rkapka/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rkapka/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1241586918,
      "node_id": "MDU6TGFiZWwxMjQxNTg2OTE4",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Tracking",
      "name": "Tracking",
      "color": "d0ff7f",
      "default": false,
      "description": "Gotta Catch 'Em All"
    },
    {
      "id": 2185788365,
      "node_id": "MDU6TGFiZWwyMTg1Nzg4MzY1",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Cleanup",
      "name": "Cleanup",
      "color": "9ffce6",
      "default": false,
      "description": "Code health!"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-08-05T16:38:00Z",
  "updated_at": "2021-05-28T06:57:48Z",
  "closed_at": "2021-05-28T06:57:48Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "This is a part of https://github.com/prysmaticlabs/prysm/issues/6747. Replacing deprecated members is not obvious, so let's discuss them one-by-one. The analysis can be found here: https://deepsource.io/gh/rkapka/prysm/issue/SCC-SA1019/occurrences\r\n\r\n---\r\n\r\n**What?**\r\n- [x] package github.com/golang/protobuf/proto is deprecated: Use the \"google.golang.org/protobuf/proto\" package instead.\r\n\r\n**Where?**\r\nhttps://github.com/prysmaticlabs/prysm/blob/master/validator/testing/slasher_mock.go\r\nhttps://github.com/prysmaticlabs/prysm/blob/master/beacon-chain/db/kafka/export_wrapper.go\r\n\r\n**What is the problem?**\r\nSwitching packages as suggested results in compilation errors. Examples:\r\n\r\n`slashingAtt, ok := proto.Clone(in).(*eth.IndexedAttestation)` // Cannot use 'in' (type *eth.IndexedAttestation) as type Message Type does not implement 'Message' as some methods are missing: ProtoReflect() Message\r\n\r\n`if err := marshaler.Marshal(buf, msg); err != nil {` // Cannot use 'msg' (type \"google.golang.org/protobuf/proto\".Message) as type \"github.com/golang/protobuf/proto\".Message Type does not implement 'proto.Message' as some methods are missing: Reset() String() string ProtoMessage()\r\n\r\n---\r\n\r\n**What?**\r\n- [x] ethpb.ChainStartResponse is deprecated: Do not use.\r\n\r\n**Where?**\r\nSeveral places.\r\n\r\n**What is the problem?**\r\nWhat should this struct be replaced with?\r\n```\r\n// Deprecated: Do not use.\r\ntype ChainStartResponse struct {\r\n```\r\nThis was added by @prestonvanloon here: https://github.com/prysmaticlabs/ethereumapis/commit/6607cc86ddb7c78acfe3b1f0dfb115489a96d46d\r\n\r\n---\r\n\r\n**What?**\r\n- [x] log.Finish is deprecated: Stop using go-log for event logging\r\n- [x] log.Start is deprecated: Stop using go-log for event logging\r\n\r\n**Where?**\r\nhttps://github.com/prysmaticlabs/prysm/blob/master/tools/relaynode/relaynode.go\r\n\r\n**What is the problem?**\r\nIs it OK to replace `log = logging.Logger(\"prysm-relaynode\")` with `log = logrus.WithField(\"prefix\", \"prysm-relaynode\")`?\r\nThis also requires changing\r\n```\r\nctx := context.Background()\r\nlog.Start(ctx, \"main\")\r\ndefer log.Finish(ctx)\r\n```\r\nto\r\n```\r\nctx := context.Background()\r\nctx, span := trace.StartSpan(ctx, \"main\")\r\ndefer span.End()\r\n```\r\n---\r\n\r\n**What?**\r\n- [x] grpc.WithDialer is deprecated: use WithContextDialer instead. Will be supported throughout 1.x.\r\n\r\n**Where?**\r\nhttps://github.com/prysmaticlabs/prysm/blob/492944db0116195f8eac23ad86ab070672c1265d/beacon-chain/gateway/gateway.go#L177-L187\r\n\r\n**What is the problem?**\r\n`WithContextDialer` expects a `func(context.Context, string) (net.Conn, error)` as the argument, so `d` should be changed. It can no longer have the `timeout` argument and needs to take in a context instead. How to refactor this?\r\n\r\n---\r\n\r\n**What?**\r\n- [x] interfaceT.Embedded is deprecated: Use EmbeddedType which is not restricted to defined (*Named) types.\r\n\r\n**Where?**\r\nhttps://github.com/prysmaticlabs/prysm/blob/492944db0116195f8eac23ad86ab070672c1265d/tools/analyzers/errcheck/analyzer.go#L402\r\n\r\n**What is the problem?**\r\nChanging the code to `embedded := interfaceT.EmbeddedType(i)` changes the type of `embedded` from `*types.Named` to `types.Type`. The variable is used as a return value, so this does not compile.\r\n\r\n---\r\n\r\n**What?**\r\n- [x] package github.com/libp2p/go-libp2p-crypto is deprecated: use github.com/libp2p/go-libp2p-core/crypto instead.\r\n- [x] package github.com/libp2p/go-libp2p-host is deprecated: use github.com/libp2p/go-libp2p-core/host instead.\r\n- [x] package github.com/libp2p/go-libp2p-net is deprecated: use github.com/libp2p/go-libp2p-core/network instead.\r\n- [x] package github.com/golang/protobuf/jsonpb is deprecated: Use the \"google.golang.org/protobuf/encoding/protojson\" package instead.\r\n\r\n**Where?**\r\nhttps://github.com/prysmaticlabs/prysm/blob/master/tools/relaynode/relaynode.go\r\nhttps://github.com/prysmaticlabs/prysm/blob/master/tools/bootnode-query/main.go\r\nhttps://github.com/prysmaticlabs/prysm/blob/master/beacon-chain/db/kafka/export_wrapper.go\r\n\r\n**What is the problem?**\r\nThere is no problem here. The analysis includes some other warnings related to the old packages but they go away after the update. The last warning needs some small additional refactoring.",
  "closed_by": {
    "login": "rkapka",
    "id": 28876818,
    "node_id": "MDQ6VXNlcjI4ODc2ODE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/28876818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rkapka",
    "html_url": "https://github.com/rkapka",
    "followers_url": "https://api.github.com/users/rkapka/followers",
    "following_url": "https://api.github.com/users/rkapka/following{/other_user}",
    "gists_url": "https://api.github.com/users/rkapka/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rkapka/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rkapka/subscriptions",
    "organizations_url": "https://api.github.com/users/rkapka/orgs",
    "repos_url": "https://api.github.com/users/rkapka/repos",
    "events_url": "https://api.github.com/users/rkapka/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rkapka/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6891/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6891/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/669357512",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/6891#issuecomment-669357512",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6891",
    "id": 669357512,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2OTM1NzUxMg==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-05T18:20:09Z",
    "updated_at": "2020-08-05T18:20:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "For the switch to the new protobuf package, tried to update it a while back but ran into issues. To fix the compilation errors, one has to convert our message types into MessageV2 protobufs: https://godoc.org/github.com/golang/protobuf/proto#MessageV2. However, there is some issue in dependencies that prevented us from doing so. It might be a pain to go through this route.\r\n\r\nRegarding logging, that action item might fall under this open issue https://github.com/prysmaticlabs/prysm/issues/6317.\r\n\r\nNot sure about the WithDialer issue, we might have to look at modern examples to see how they do this, or perhaps their godocs.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/669357512/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/720881636",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/6891#issuecomment-720881636",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6891",
    "id": 720881636,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyMDg4MTYzNg==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-03T03:15:32Z",
    "updated_at": "2020-11-03T03:15:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "hey @rkapka this one is still relevant. My deps update PR #7646 only updates bug fix or security vulnerabilities in dependencies, but we still have to amend the Prysm code in this issue that uses deprecated package members",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/720881636/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/731391182",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/6891#issuecomment-731391182",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6891",
    "id": 731391182,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMTM5MTE4Mg==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-20T20:27:08Z",
    "updated_at": "2020-11-20T20:27:08Z",
    "author_association": "MEMBER",
    "body": "Removing from v1 milestone since it's not a release blocker. ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/731391182/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
