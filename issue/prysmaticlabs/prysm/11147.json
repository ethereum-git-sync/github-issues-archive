{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11147",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11147/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11147/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11147/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/11147",
  "id": 1325307962,
  "node_id": "I_kwDOBvuov85O_pg6",
  "number": 11147,
  "title": "Unable to broadcast sync committee contribution",
  "user": {
    "login": "Inphi",
    "id": 3516807,
    "node_id": "MDQ6VXNlcjM1MTY4MDc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3516807?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Inphi",
    "html_url": "https://github.com/Inphi",
    "followers_url": "https://api.github.com/users/Inphi/followers",
    "following_url": "https://api.github.com/users/Inphi/following{/other_user}",
    "gists_url": "https://api.github.com/users/Inphi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Inphi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Inphi/subscriptions",
    "organizations_url": "https://api.github.com/users/Inphi/orgs",
    "repos_url": "https://api.github.com/users/Inphi/repos",
    "events_url": "https://api.github.com/users/Inphi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Inphi/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-08-02T05:30:54Z",
  "updated_at": "2022-08-04T20:09:13Z",
  "closed_at": "2022-08-04T20:09:13Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!--üíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé\r\n\r\nHellooo! üòÑ \r\n\r\nTo help us tend to your issue faster, please search our currently open issues before submitting a new one.\r\nExisting issues often contain information about workarounds, resolution, or progress updates.\r\n\r\nüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé-->\r\n\r\n# üêû Bug Report\r\n\r\n### Description\r\n\r\nRunning a validator on a local testnet creates a lot of errors because it fails to broadcast sync committee messages. This happens as soon as altair begins and once the beacon node peers with another beacon node. The peer does not subscribe to all sync committee subnets and thus misses certain message broadcasts.\r\n\r\nWhile both beacon nodes are synchronized, with matching block and state roots, I see alot of errors that look like the following:\r\n```\r\ntime=\"2022-08-02 04:46:21\" level=error msg=\"Failed to find peers\" error=\"unable to find requisite number of peers for topic /eth2/de1c6e6d/sync_committee_3/ssz_snappy - only 0 out of 1 peers were able to be found\" prefix=p2p\r\n```\r\n\r\n### Has this worked before in a previous version?\r\n\r\nUnclear. I haven't checked that far back.\r\n\r\n<!-- Did this behavior use to work in the previous version? -->\r\n<!-- ‚úçÔ∏è--> Yes, the previous version in which this bug was not present was: ....\r\n\r\n## üî¨ Minimal Reproduction\r\n\r\n<!--\r\nPlease let us know how we can reproduce this issue. Include the exact method you used to run Prysm along with any flags used in your beacon chain and/or validator. Make sure you don't upload any confidential files or private keys.\r\n-->\r\n\r\nI'm running a 2 beacon node paired with 2 validator client setup.\r\n(here I show how to reproduce using interop testing, but this problem occurs even without any mocking)\r\n\r\n#### Beacon Node\r\n\r\n```\r\nbeacon-node \\\r\n    --accept-terms-of-use \\\r\n    --min-sync-peers 0\\\r\n    --disable-sync\\\r\n    --bootstrap-node=\\\r\n    --datadir /chaindata \\\r\n    --force-clear-db \\\r\n    --interop-eth1data-votes \\\r\n    --http-web3provider=\"$EXECUTION_NODE_URL\" \\\r\n    --deposit-contract $DEPOSIT_CONTRACT \\\r\n    --chain-config-file=$CUSTOM_CHAIN_CONFIG \\ # not noteworthy. Contains mostly defaults.\r\n    --contract-deployment-block $CONTRACT_DEPLOYMENT_BLOCK \\\r\n    --interop-num-validators 4 \\\r\n    --rpc-host 0.0.0.0 \\\r\n    --rpc-port 4000 \\\r\n    --grpc-gateway-host 0.0.0.0 \\\r\n    --grpc-gateway-port 3500 \\\r\n    --enable-debug-rpc-endpoints \\\r\n    --p2p-local-ip 0.0.0.0 \\\r\n    --p2p-host-ip \"$EXTERNAL_IP\"\r\n\r\nvalidator\r\n      --accept-terms-of-use\r\n      --beacon-rpc-provider $BEACON_NODE_RPC\r\n      --interop-num-validators=4\r\n      --interop-start-index=0\r\n      --force-clear-db\r\n      --chain-config-file=/config/prysm-chain-config.yml\r\n      --suggested-fee-recipient $FEE_RECIPIENT\r\n\r\n# on another machine\r\nbeacon-node \\\r\n    --accept-terms-of-use \\\r\n    --verbosity=\"$VERBOSITY\" \\\r\n    --datadir /chaindata \\\r\n    --bootstrap-node $BOOTNODE \\\r\n    --min-sync-peers 1 \\\r\n    --force-clear-db \\\r\n    --interop-eth1data-votes \\\r\n    --interop-genesis-time $INTEROP_GENESIS_TIME \\\r\n    --http-web3provider=\"$EXECUTION_NODE_URL\" \\\r\n    --deposit-contract $DEPOSIT_CONTRACT \\\r\n    --chain-config-file=$CUSTOM_CHAIN_CONFIG \\\r\n    --contract-deployment-block $CONTRACT_DEPLOYMENT_BLOCK \\\r\n    --interop-num-validators 4 \\\r\n    --rpc-host 0.0.0.0 \\\r\n    --rpc-port 4000 \\\r\n    --grpc-gateway-host 0.0.0.0 \\\r\n    --grpc-gateway-port 3500 \\\r\n    --enable-debug-rpc-endpoints \\\r\n    --p2p-local-ip 0.0.0.0 \\\r\n    --p2p-host-ip \"$EXTERNAL_IP\"\r\n```\r\n\r\n## üî• Error\r\nError logs are all similar:\r\n\r\n<pre><code>\r\n20839: time=\"2022-08-02 05:14:39\" level=error msg=\"Failed to find peers\" error=\"unable to find requisite number of peers for topic /eth2/5c5af27d/sync_committee_1/ssz_snappy - only 0 out of 1 peers were able to be found\" prefix=p2p\r\n20841: time=\"2022-08-02 05:14:39\" level=error msg=\"Failed to find peers\" error=\"unable to find requisite number of peers for topic /eth2/5c5af27d/sync_committee_1/ssz_snappy - only 0 out of 1 peers were able to be found\" prefix=p2p\r\n20843: time=\"2022-08-02 05:14:39\" level=error msg=\"Failed to find peers\" error=\"unable to find requisite number of peers for topic /eth2/5c5af27d/beacon_attestation_0/ssz_snappy - only 0 out of 1 peers were able to be found\" prefix=p2p\r\n</code></pre>\r\n\r\n\r\n## üåç  Your Environment\r\n\r\n**Operating System:**\r\n\r\n<pre>\r\n  <code>\r\nLinux (Ubuntu 20)\r\n  </code>\r\n</pre>\r\n\r\n**What version of Prysm are you running? (Which release)**\r\n\r\n<pre>\r\n  <code>\r\nc1f89cc4c8c09494fe0aaa6e095c257a4bae1e16\r\n  </code>\r\n</pre>\r\n\r\n**Anything else relevant (validator index / public key)?**\r\n\r\n\r\ncc: @terencechain ",
  "closed_by": {
    "login": "Inphi",
    "id": 3516807,
    "node_id": "MDQ6VXNlcjM1MTY4MDc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3516807?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Inphi",
    "html_url": "https://github.com/Inphi",
    "followers_url": "https://api.github.com/users/Inphi/followers",
    "following_url": "https://api.github.com/users/Inphi/following{/other_user}",
    "gists_url": "https://api.github.com/users/Inphi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Inphi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Inphi/subscriptions",
    "organizations_url": "https://api.github.com/users/Inphi/orgs",
    "repos_url": "https://api.github.com/users/Inphi/repos",
    "events_url": "https://api.github.com/users/Inphi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Inphi/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11147/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11147/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1204232213",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/11147#issuecomment-1204232213",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11147",
    "id": 1204232213,
    "node_id": "IC_kwDOBvuov85HxyAV",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-03T17:00:08Z",
    "updated_at": "2022-08-03T17:00:08Z",
    "author_association": "MEMBER",
    "body": "It is possible that your one and only peer was not listening for that subnet at the time. Consider running both nodes with `--subscribe-all-subnets`. \n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1204232213/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1205718144",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/11147#issuecomment-1205718144",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11147",
    "id": 1205718144,
    "node_id": "IC_kwDOBvuov85H3cyA",
    "user": {
      "login": "Inphi",
      "id": 3516807,
      "node_id": "MDQ6VXNlcjM1MTY4MDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3516807?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Inphi",
      "html_url": "https://github.com/Inphi",
      "followers_url": "https://api.github.com/users/Inphi/followers",
      "following_url": "https://api.github.com/users/Inphi/following{/other_user}",
      "gists_url": "https://api.github.com/users/Inphi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Inphi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Inphi/subscriptions",
      "organizations_url": "https://api.github.com/users/Inphi/orgs",
      "repos_url": "https://api.github.com/users/Inphi/repos",
      "events_url": "https://api.github.com/users/Inphi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Inphi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-04T20:09:13Z",
    "updated_at": "2022-08-04T20:09:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "That did the trick! Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1205718144/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
