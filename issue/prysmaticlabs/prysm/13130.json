{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/13130",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/13130/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/13130/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/13130/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/13130",
  "id": 1965733226,
  "node_id": "I_kwDOBvuov851KrVq",
  "number": 13130,
  "title": "Zig fetching errors in bazel after upgrading Mac",
  "user": {
    "login": "james-prysm",
    "id": 90280386,
    "node_id": "MDQ6VXNlcjkwMjgwMzg2",
    "avatar_url": "https://avatars.githubusercontent.com/u/90280386?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/james-prysm",
    "html_url": "https://github.com/james-prysm",
    "followers_url": "https://api.github.com/users/james-prysm/followers",
    "following_url": "https://api.github.com/users/james-prysm/following{/other_user}",
    "gists_url": "https://api.github.com/users/james-prysm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/james-prysm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/james-prysm/subscriptions",
    "organizations_url": "https://api.github.com/users/james-prysm/orgs",
    "repos_url": "https://api.github.com/users/james-prysm/repos",
    "events_url": "https://api.github.com/users/james-prysm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/james-prysm/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129904,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDQ=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Bug",
      "name": "Bug",
      "color": "ee0701",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 3164412573,
      "node_id": "MDU6TGFiZWwzMTY0NDEyNTcz",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Tools",
      "name": "Tools",
      "color": "E51A66",
      "default": false,
      "description": "Tools related tasks"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "prestonvanloon",
    "id": 7246818,
    "node_id": "MDQ6VXNlcjcyNDY4MTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prestonvanloon",
    "html_url": "https://github.com/prestonvanloon",
    "followers_url": "https://api.github.com/users/prestonvanloon/followers",
    "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
    "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
    "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
    "repos_url": "https://api.github.com/users/prestonvanloon/repos",
    "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-10-27T15:15:39Z",
  "updated_at": "2023-10-30T23:48:46Z",
  "closed_at": "2023-10-30T23:48:46Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Describe the bug\r\n\r\nAfter upgrading to Sonoma 14.1 bazel tries to fetch a new version of zig without updating the sha256\r\n\r\nZig should be disabled for mac arm but still tries to pull it anyway.\r\na work around is replacing line 30 on the WORKSPACE file `zig_toolchain` \r\n```\r\n_HOST_PLATFORM_SHA256 = {\r\n    \"linux-aarch64\": \"956eb095d8ba44ac6ebd27f7c9956e47d92937c103bf754745d0a39cdaa5d4c6\",\r\n    \"linux-x86_64\": \"3607099807dca909935fb9249c16f4bfed6e58872ec1a7fc1eb65776d6d32111\",  # Updated\r\n    \"macos-aarch64\": \"5edd4f9e88eb6864f1818ecf81d2d489cb10845a4e84e6ebcee06566b205e769\",  # Updated\r\n    \"macos-x86_64\": \"1c1c6b9a906b42baae73656e24e108fd8444bb50b6e8fd03e9e7a3f8b5f05686\",\r\n    \"windows-x86_64\": \"142caa3b804d86b4752556c9b6b039b7517a08afa3af842645c7e2dcd125f652\",\r\n}\r\n\r\nzig_toolchains(\r\n    host_platform_sha256 = _HOST_PLATFORM_SHA256,\r\n    version = \"0.12.0-dev.1298+da06269d7\",\r\n)\r\n```\r\nnote: the sha can update and should replaced every 90 days\r\n\r\n\r\n### Has this worked before in a previous version?\r\n\r\n_No response_\r\n\r\n### ðŸ”¬ Minimal Reproduction\r\n\r\n1. run mac m1\r\n2. run a bazel command like `bazel run //:gazelle -- fix`\r\n\r\n### Error\r\n\r\n```text\r\nDEBUG: /private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/hermetic_cc_toolchain/toolchain/defs.bzl:182:18: Launcher compilation failed. Retrying build\r\nDEBUG: /private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/hermetic_cc_toolchain/toolchain/defs.bzl:182:18: Launcher compilation failed. Retrying build\r\nINFO: Repository zig_sdk instantiated at:\r\n  /Users/james/Documents/Prysm/git/prysm/WORKSPACE:30:15: in <toplevel>\r\n  /private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/hermetic_cc_toolchain/toolchain/defs.bzl:80:19: in toolchains\r\nRepository rule zig_repository defined at:\r\n  /private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/hermetic_cc_toolchain/toolchain/defs.bzl:218:33: in <toplevel>\r\nINFO: repository @zig_sdk' used the following cache hits instead of downloading the corresponding file.\r\n * Hash '19f9115410a6dfb004c65d63ffecf947efc595d08977906f73a90d7b2de0b3dc' for https://mirror.bazel.build/ziglang.org/builds/zig-macos-aarch64-0.11.0-dev.3312+ab37ab33c.tar.xz\r\nIf the definition of 'repository @zig_sdk' was updated, verify that the hashes were also updated.\r\nERROR: An error occurred during the fetch of repository 'zig_sdk':\r\n   Traceback (most recent call last):\r\n        File \"/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/hermetic_cc_toolchain/toolchain/defs.bzl\", line 205, column 13, in _zig_repository_impl\r\n                fail(zig_wrapper_err_msg)\r\nError in fail: \r\nCompilation of zig-wrapper.zig failed:\r\ncommand=ZIG_LOCAL_CACHE_DIR=/tmp/zig-cache ZIG_GLOBAL_CACHE_DIR=/tmp/zig-cache ../zig build-exe -mcpu=apple_a14 -OReleaseSafe zig-wrapper.zig\r\nreturn_code=1\r\nstderr=error(link): undefined reference to symbol '_isatty'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '___ulock_wait2'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_getenv'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_abort'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '__dyld_image_count'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_close$NOCANCEL'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_fstat'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_openat'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '___error'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '__dyld_get_image_header'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_pthread_threadid_np'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '__tlv_bootstrap'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_munmap'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_mmap'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_bzero'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_environ'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_sigaction'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_posix_memalign'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_fcntl'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '___stack_chk_fail'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_os_unfair_lock_unlock'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_os_unfair_lock_lock'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_malloc_size'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_execve'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_write'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '__dyld_get_image_name'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_free'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '__dyld_get_image_vmaddr_slide'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '___stack_chk_guard'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_read'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '_msync'\r\nerror(link):   first referenced in '/private/var/tmp/_bazel_james/a58facf4a3376e911b6755b87f30dbb8/external/zig_sdk/tools/zig-wrapper.o'\r\nerror(link): undefined reference to symbol '__availability_version_check'\r\nerror(link):   first referenced in '/private/tmp/zig-cache/o/970b38ac9fabc9361ed1c170362d1703/libcompiler_rt.a(/tmp/zig-cache/o/970b38ac9fabc9361ed1c170362d1703/libcompiler_rt.a.o)'\r\nerror(link): undefined reference to symbol '_sys_icache_invalidate'\r\nerror(link):   first referenced in '/private/tmp/zig-cache/o/970b38ac9fabc9361ed1c170362d1703/libcompiler_rt.a(/tmp/zig-cache/o/970b38ac9fabc9361ed1c170362d1703/libcompiler_rt.a.o)'\r\nerror(link): undefined reference to symbol 'dyld_stub_binder'\r\nerror: UndefinedSymbolReference\r\n\r\nstdout=\r\n\r\nYou stumbled into a problem with Zig SDK that bazel-zig-cc was not able to fix.\r\nPlease file a new issue to github.com/uber/hermetic_cc_toolchain with:\r\n- Full output of this Bazel run, including the Bazel command.\r\n- Version of the Zig SDK if you have a non-default.\r\n- Version of hermetic_cc_toolchain\r\n\r\nNote: this *may* have been https://github.com/ziglang/zig/issues/14978, for\r\nwhich hermetic_cc_toolchain has a workaround and you may have been \"struck by\r\nlightning\" three times in a row.\r\n\r\n```\r\n```\r\n\r\n\r\n### Platform(s)\r\n\r\nMac (Apple Silicon)\r\n\r\n### What version of Prysm are you running? (Which release)\r\n\r\n4.10.1\r\n\r\n### Anything else relevant (validator index / public key)?\r\n\r\n_No response_",
  "closed_by": {
    "login": "prylabs-bulldozer[bot]",
    "id": 58059840,
    "node_id": "MDM6Qm90NTgwNTk4NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/in/47372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D",
    "html_url": "https://github.com/apps/prylabs-bulldozer",
    "followers_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/13130/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/13130/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
