{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4683",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4683/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4683/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4683/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/4683",
  "id": 556712522,
  "node_id": "MDU6SXNzdWU1NTY3MTI1MjI=",
  "number": 4683,
  "title": "Booting a validator with 2000 keys takes 90 minutes.",
  "user": {
    "login": "q9f",
    "id": 58883403,
    "node_id": "MDQ6VXNlcjU4ODgzNDAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/58883403?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/q9f",
    "html_url": "https://github.com/q9f",
    "followers_url": "https://api.github.com/users/q9f/followers",
    "following_url": "https://api.github.com/users/q9f/following{/other_user}",
    "gists_url": "https://api.github.com/users/q9f/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/q9f/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/q9f/subscriptions",
    "organizations_url": "https://api.github.com/users/q9f/orgs",
    "repos_url": "https://api.github.com/users/q9f/repos",
    "events_url": "https://api.github.com/users/q9f/events{/privacy}",
    "received_events_url": "https://api.github.com/users/q9f/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2020-01-29T08:35:07Z",
  "updated_at": "2020-02-10T16:58:17Z",
  "closed_at": "2020-02-10T16:58:17Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "note the timestamp:\r\n\r\n```\r\n~/.opt/prysm master*\r\n❯ bazel-bin/validator/linux_amd64_stripped/validator --keymanager=keystore --keymanageropts='{\"path\":\"/home/user/.prysm\",\"passphrase\":\"xxxxx\"}'\r\n2020/01/29 07:14:07 maxprocs: Leaving GOMAXPROCS=4: CPU quota undefined\r\n[2020-01-29 07:14:07]  INFO node: Using custom parameter configuration\r\n[2020-01-29 07:14:07]  WARN node: Using Demo Config\r\n[2020-01-29 08:47:17]  INFO node: Validating for public key pubKey=0xac411e3b6353e1ed53cd029829e76ae76a126cc96e37ca2d4cd1a04e47c17a5f6c2d753abe61b1ef566faac926b7db4a\r\n[2020-01-29 08:47:17]  INFO node: Validating for public key pubKey=0xb1f1ffa5237dee2e43fc6a93424b7516cc055b44a211419412707afd364329ece28a1cbda0dbceaef9447bf2b266386d\r\n[2020-01-29 08:47:17]  INFO node: Validating for public key pubKey=0x875b3e8c205970473f18b27e8d21228f69ce9a84ca4e95f73c9b865c76379d93dbcc1a8c91b978810675962eafbe5a4e\r\n```\r\n\r\n2220 keys:\r\n\r\n```\r\n~/.opt/prysm master*\r\n❯ ll /home/user/.prysm/validatorprivate* | wc -l\r\n2220\r\n```\r\n\r\nmaybe we could be more verbose about loading keys?\r\n\r\nrunning prysm latest master @ 3e9bf58d81a986881de9d2d0fcbe565b3fe83ef2\r\n\r\non arch-linux 5.4.13-arch1-1 x86_64 gnu/linux, go version go1.13.6 linux/amd64, bazel version 2.0.0- (@non-git)\r\n",
  "closed_by": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4683/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4683/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/579651693",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4683#issuecomment-579651693",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4683",
    "id": 579651693,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3OTY1MTY5Mw==",
    "user": {
      "login": "mcdee",
      "id": 511384,
      "node_id": "MDQ6VXNlcjUxMTM4NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/511384?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mcdee",
      "html_url": "https://github.com/mcdee",
      "followers_url": "https://api.github.com/users/mcdee/followers",
      "following_url": "https://api.github.com/users/mcdee/following{/other_user}",
      "gists_url": "https://api.github.com/users/mcdee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mcdee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mcdee/subscriptions",
      "organizations_url": "https://api.github.com/users/mcdee/orgs",
      "repos_url": "https://api.github.com/users/mcdee/repos",
      "events_url": "https://api.github.com/users/mcdee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mcdee/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-29T08:39:29Z",
    "updated_at": "2020-01-29T08:39:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "Key load time will most likely be dominated by the time taken to decode individual keys, but I'll do some profiling to make sure.  It may be possible to have some sort of bulk store/decrypt, although I'd have to consider how best to build it (and the security implications of having such a thing)",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/579651693/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/579653016",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4683#issuecomment-579653016",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4683",
    "id": 579653016,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3OTY1MzAxNg==",
    "user": {
      "login": "q9f",
      "id": 58883403,
      "node_id": "MDQ6VXNlcjU4ODgzNDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/58883403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/q9f",
      "html_url": "https://github.com/q9f",
      "followers_url": "https://api.github.com/users/q9f/followers",
      "following_url": "https://api.github.com/users/q9f/following{/other_user}",
      "gists_url": "https://api.github.com/users/q9f/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/q9f/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/q9f/subscriptions",
      "organizations_url": "https://api.github.com/users/q9f/orgs",
      "repos_url": "https://api.github.com/users/q9f/repos",
      "events_url": "https://api.github.com/users/q9f/events{/privacy}",
      "received_events_url": "https://api.github.com/users/q9f/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-29T08:43:28Z",
    "updated_at": "2020-01-29T08:43:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "5590 seconds / 2220 keys ~ 2.518 seconds per key.\r\n\r\nif you could give me a quick pointer, I might be able to help profiling. are the keys encrypted with the password on disk? is this the reason it takes longer to read them?",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/579653016/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/579661233",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4683#issuecomment-579661233",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4683",
    "id": 579661233,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3OTY2MTIzMw==",
    "user": {
      "login": "mcdee",
      "id": 511384,
      "node_id": "MDQ6VXNlcjUxMTM4NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/511384?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mcdee",
      "html_url": "https://github.com/mcdee",
      "followers_url": "https://api.github.com/users/mcdee/followers",
      "following_url": "https://api.github.com/users/mcdee/following{/other_user}",
      "gists_url": "https://api.github.com/users/mcdee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mcdee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mcdee/subscriptions",
      "organizations_url": "https://api.github.com/users/mcdee/orgs",
      "repos_url": "https://api.github.com/users/mcdee/repos",
      "events_url": "https://api.github.com/users/mcdee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mcdee/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-29T09:07:08Z",
    "updated_at": "2020-01-29T09:07:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "The relevant code is at https://github.com/prysmaticlabs/prysm/blob/master/validator/keymanager/direct_keystore.go#L75 although that uses the old keystore format; a new keystore (v4) implementation will be integrated in the next few days so you may want to hold off until then.  Even then, though, the majority of the time will be in decryption as each key will be in its own keystore and require decryption separate to the others.\r\n\r\nIt would be possible to build a different keystore format for bulk keys; this may be where we have to end up to be able to decrypt a significant number of keys quickly (although as mentioned above this could have security implications).",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/579661233/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/579663881",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4683#issuecomment-579663881",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4683",
    "id": 579663881,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3OTY2Mzg4MQ==",
    "user": {
      "login": "q9f",
      "id": 58883403,
      "node_id": "MDQ6VXNlcjU4ODgzNDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/58883403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/q9f",
      "html_url": "https://github.com/q9f",
      "followers_url": "https://api.github.com/users/q9f/followers",
      "following_url": "https://api.github.com/users/q9f/following{/other_user}",
      "gists_url": "https://api.github.com/users/q9f/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/q9f/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/q9f/subscriptions",
      "organizations_url": "https://api.github.com/users/q9f/orgs",
      "repos_url": "https://api.github.com/users/q9f/repos",
      "events_url": "https://api.github.com/users/q9f/events{/privacy}",
      "received_events_url": "https://api.github.com/users/q9f/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-29T09:14:17Z",
    "updated_at": "2020-01-29T09:14:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "first thing coming to my mind is bitcoin's `wallet.dat` which is an encrypted database file of keypairs. downside of such an approach is that all keys use the same password. but if you run all validators on one machine, you probably don't want to use different passwords anyways.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/579663881/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/579783827",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4683#issuecomment-579783827",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4683",
    "id": 579783827,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3OTc4MzgyNw==",
    "user": {
      "login": "mcdee",
      "id": 511384,
      "node_id": "MDQ6VXNlcjUxMTM4NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/511384?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mcdee",
      "html_url": "https://github.com/mcdee",
      "followers_url": "https://api.github.com/users/mcdee/followers",
      "following_url": "https://api.github.com/users/mcdee/following{/other_user}",
      "gists_url": "https://api.github.com/users/mcdee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mcdee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mcdee/subscriptions",
      "organizations_url": "https://api.github.com/users/mcdee/orgs",
      "repos_url": "https://api.github.com/users/mcdee/repos",
      "events_url": "https://api.github.com/users/mcdee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mcdee/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-29T14:36:31Z",
    "updated_at": "2020-01-29T14:36:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "I just tried a test with 4,096 keys with keystorev4 and it imported them in ~11 seconds, so this may not be an issue.  I'll make a note here once the related patch is in, would love to hear your feedback on its performance.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/579783827/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/579806478",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4683#issuecomment-579806478",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4683",
    "id": 579806478,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3OTgwNjQ3OA==",
    "user": {
      "login": "q9f",
      "id": 58883403,
      "node_id": "MDQ6VXNlcjU4ODgzNDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/58883403?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/q9f",
      "html_url": "https://github.com/q9f",
      "followers_url": "https://api.github.com/users/q9f/followers",
      "following_url": "https://api.github.com/users/q9f/following{/other_user}",
      "gists_url": "https://api.github.com/users/q9f/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/q9f/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/q9f/subscriptions",
      "organizations_url": "https://api.github.com/users/q9f/orgs",
      "repos_url": "https://api.github.com/users/q9f/repos",
      "events_url": "https://api.github.com/users/q9f/events{/privacy}",
      "received_events_url": "https://api.github.com/users/q9f/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-29T15:24:47Z",
    "updated_at": "2020-01-29T15:24:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "ok sure. let me know how to test this.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/579806478/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/584223164",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4683#issuecomment-584223164",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4683",
    "id": 584223164,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU4NDIyMzE2NA==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-02-10T16:58:17Z",
    "updated_at": "2020-02-10T16:58:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey @q9f closing for now, as this is resolved in current master thanks to @mcdee , see #4687",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/584223164/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  }
]
