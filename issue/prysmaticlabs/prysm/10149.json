{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10149",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10149/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10149/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10149/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/10149",
  "id": 1117726197,
  "node_id": "I_kwDOBvuov85CnyX1",
  "number": 10149,
  "title": "Too Hard to Add/Modify API Schema in Prysm",
  "user": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129907,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDc=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Help%20Wanted",
      "name": "Help Wanted",
      "color": "33aa3f",
      "default": false,
      "description": "Extra attention is needed"
    },
    {
      "id": 802129908,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDg=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Good%20First%20Issue",
      "name": "Good First Issue",
      "color": "7057ff",
      "default": false,
      "description": "Good for newcomers"
    },
    {
      "id": 1701740543,
      "node_id": "MDU6TGFiZWwxNzAxNzQwNTQz",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/API",
      "name": "API",
      "color": "30ef13",
      "default": false,
      "description": "Api related tasks"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-01-28T18:46:04Z",
  "updated_at": "2022-08-15T21:17:41Z",
  "closed_at": "2022-08-15T21:17:40Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# ðŸš€ Feature Request\r\n\r\n### Description\r\n\r\nIt is really hard to add a new API endpoint, add a new protobuf type, or change anything about our existing protobuf schemas. Adding a simple, new message in protobuf in a regular file such as `proto/prysm/v1alpha1/attestation.proto` leads to massive changelog of files when generating Go code for the diff\r\n\r\n```\r\ndiff --git a/proto/prysm/v1alpha1/attestation.proto b/proto/prysm/v1alpha1/attestation.proto\r\nindex 9906adc64..c6dc9a7ef 100644\r\n--- a/proto/prysm/v1alpha1/attestation.proto\r\n+++ b/proto/prysm/v1alpha1/attestation.proto\r\n@@ -24,6 +24,10 @@ option java_outer_classname = \"AttestationProto\";\r\n option java_package = \"org.ethereum.eth.v1alpha1\";\r\n option php_namespace = \"Ethereum\\\\Eth\\\\v1alpha1\";\r\n\r\n+message SpecialAttestation {\r\n+    bytes aggregation_bits = 1 [(ethereum.eth.ext.ssz_max) = \"2048\", (ethereum.eth.ext.cast_type) = \"github.com/prysmaticlabs/go-bitfield.Bitlist\"];\r\n+}\r\n+\r\n message Attestation {\r\n     // A bitfield representation of validator indices that have voted exactly\r\n     // the same vote and have been aggregated into this attestation.\r\n````\r\n\r\n...leads to:\r\n\r\n```\r\n$ ./hack/update-go-pbs.sh && git status\r\nOn branch develop\r\nYour branch is up to date with 'origin/develop'.\r\n\r\nChanges not staged for commit:\r\n  (use \"git add <file>...\" to update what will be committed)\r\n  (use \"git restore <file>...\" to discard changes in working directory)\r\n\tmodified:   proto/eth/service/beacon_chain_service.pb.gw.go\r\n\tmodified:   proto/eth/service/beacon_debug_service.pb.gw.go\r\n\tmodified:   proto/eth/service/validator_service.pb.gw.go\r\n\tmodified:   proto/eth/v1/attestation.pb.gw.go\r\n\tmodified:   proto/eth/v1/beacon_block.pb.gw.go\r\n\tmodified:   proto/eth/v1/beacon_chain.pb.gw.go\r\n\tmodified:   proto/eth/v1/beacon_state.pb.gw.go\r\n\tmodified:   proto/eth/v1/events.pb.gw.go\r\n\tmodified:   proto/eth/v1/node.pb.gw.go\r\n\tmodified:   proto/eth/v1/validator.pb.gw.go\r\n\tmodified:   proto/eth/v2/beacon_block.pb.gw.go\r\n\tmodified:   proto/eth/v2/beacon_state.pb.gw.go\r\n\tmodified:   proto/eth/v2/sync_committee.pb.gw.go\r\n\tmodified:   proto/eth/v2/validator.pb.gw.go\r\n\tmodified:   proto/eth/v2/version.pb.gw.go\r\n\tmodified:   proto/prysm/v1alpha1/attestation.pb.go\r\n\tmodified:   proto/prysm/v1alpha1/attestation.pb.gw.go\r\n\tmodified:   proto/prysm/v1alpha1/attestation.proto\r\n\tmodified:   proto/prysm/v1alpha1/beacon_block.pb.gw.go\r\n\tmodified:   proto/prysm/v1alpha1/beacon_state.pb.gw.go\r\n\tmodified:   proto/prysm/v1alpha1/finalized_block_root_container.pb.gw.go\r\n\tmodified:   proto/prysm/v1alpha1/p2p_messages.pb.gw.go\r\n\tmodified:   proto/prysm/v1alpha1/powchain.pb.gw.go\r\n\tmodified:   proto/prysm/v1alpha1/sync_committee.pb.gw.go\r\n\tmodified:   proto/prysm/v1alpha1/sync_committee_mainnet.go\r\n\tmodified:   proto/prysm/v1alpha1/sync_committee_minimal.go\r\n\tmodified:   proto/testing/gocast.go\r\n```\r\n\r\nMost of these edits affect imports and minor formatting issues, but they happen every time one wants to edit a protobuf. Moreover, adding new files is **non-trivial** because our build system, [Bazel](https://bazel.build), relies on special configuration files called `BUILD.bazel` in every directory to figure out how to build the associated protobufs. These require _manual edits_, where we a developer has to update the associated `BUILD.bazel` file when creating a `.proto` file. Adding dependencies is non-trivial, and is error-prone. This makes it really hard for someone to add or modify endpoints, types, and API schemas in Prysm.\r\n\r\n### Describe the solution you'd like\r\n\r\n1. Fix our `./hack/update-go-pbs.sh` file so it works without generating a big changelog\r\n2. Add documentation on a step-by-step guide to adding a new API endpoint with gRPC protobufs in Prysm and generate Go code using our `update-go-pbs.sh` script\r\n3. Add documentation on how to edit existing `.proto` files and generate Go code using our `update-go-pbs.sh` script\r\n4. Find ways of removing the need for developers to manually edit `BUILD.bazel`\r\n\r\nTo solve the last point, (4), we can probably add thorough documentation on\r\n1. What `BUILD.bazel` files are\r\n2. The structure of `BUILD.bazel` files in our `proto/` directory and their common elements\r\n3. How to modify `BUILD.bazel` files when you are adding (a) a new .proto file, or (b) adding Go or protobuf dependencies to your file",
  "closed_by": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10149/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10149/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1026445063",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/10149#issuecomment-1026445063",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10149",
    "id": 1026445063,
    "node_id": "IC_kwDOBvuov849Lk8H",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-01T03:28:25Z",
    "updated_at": "2022-02-01T03:28:25Z",
    "author_association": "MEMBER",
    "body": "> Fix our ./hack/update-go-pbs.sh file so it works without generating a big changelog\r\n\r\nHow is this achieved? I think that big change log is due to dependencies or changes included that didn't run update-go-pbs.sh so all of that data is stale. I ran it on develop with no change and i see changes like a dependency was updated but none of the pbs updated. \r\n\r\n```\r\ndiff --git a/proto/eth/service/node_service.pb.go b/proto/eth/service/node_service.pb.go\r\nindex 992a6ad1e..348419a69 100755\r\n--- a/proto/eth/service/node_service.pb.go\r\n+++ b/proto/eth/service/node_service.pb.go\r\n@@ -1,6 +1,6 @@\r\n // Code generated by protoc-gen-go. DO NOT EDIT.\r\n // versions:\r\n-//     protoc-gen-go v1.25.0\r\n+//     protoc-gen-go v1.27.1\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1026445063/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1031784333",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/10149#issuecomment-1031784333",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10149",
    "id": 1031784333,
    "node_id": "IC_kwDOBvuov849f8eN",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-07T18:29:52Z",
    "updated_at": "2022-02-07T18:29:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "It might be system-dependent. On my linux machine, running the scripts always ends with a huge change-log. However, I think the more important issue is in how difficult it is to modify the BUILD files manually and how someone making small changes, adding a dep, etc. would have to deal with the intricacies of the BUILD files in our proto/ folder",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1031784333/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1215834933",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/10149#issuecomment-1215834933",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10149",
    "id": 1215834933,
    "node_id": "IC_kwDOBvuov85IeCs1",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-15T21:17:40Z",
    "updated_at": "2022-08-15T21:17:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "The go pbs script is no longer as annoying as it used to be. Closing",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1215834933/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
