{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/201",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/201/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/201/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/201/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/201",
  "id": 334330497,
  "node_id": "MDU6SXNzdWUzMzQzMzA0OTc=",
  "number": 201,
  "title": "Notary: Configure the Persisting of Collation Data in Local Storage",
  "user": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129908,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDg=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Good%20First%20Issue",
      "name": "Good First Issue",
      "color": "7057ff",
      "default": false,
      "description": "Good for newcomers"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/milestones/1",
    "html_url": "https://github.com/prysmaticlabs/prysm/milestone/1",
    "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/milestones/1/labels",
    "id": 3141840,
    "node_id": "MDk6TWlsZXN0b25lMzE0MTg0MA==",
    "number": 1,
    "title": "Ruby - Demo",
    "description": "The Ruby Release: Local Alphanet",
    "creator": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 270,
    "state": "closed",
    "created_at": "2018-02-25T21:22:44Z",
    "updated_at": "2018-10-09T10:37:42Z",
    "due_on": "2018-10-01T07:00:00Z",
    "closed_at": "2018-10-09T10:37:42Z"
  },
  "comments": 3,
  "created_at": "2018-06-21T04:08:25Z",
  "updated_at": "2018-07-04T18:30:50Z",
  "closed_at": "2018-07-04T18:30:50Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Hi all,\r\n\r\n(TL;DR: A PR for this should configure a flag that allows a user to specify how long it wants to persist data and a sharding client should know when to delete the data when the specified time is reached)\r\n\r\nAs part of the minimal sharding protocol, notaries are in charge with checking for data availability of collation bodies submitted to the Sharding Manager Contract. Once a notary is selected on a shard at a certain period, the notary has to:\r\n\r\n- Fetch the collation headers submitted to the contract during that assigned period\r\n- Broadcast requests to fetch their corresponding bodies from the shardp2p network\r\n- Mark collations as available or unavailable\r\n- Submit a vote on a valid, available collation at the end of the period\r\n- Get reshuffled into a different shard on a different period\r\n\r\nThe problem with this approach is there is **no incentive** for notaries to persist this data in their local storage, making them prone to the **validator's dilemma** where they can be lazy and just say that a collation was available when it was not. To solve this problem, the research introduces the concept of a proof of custody, which means that when submitting a vote, a notary has to combine his/her signature with chunks of the merklization of the collation body in question into a single Merkle root. This combination allows others to have confidence the notary **has the collation data** at the time of voting, as this is the only way this value could be computed.\r\n\r\nOther nodes can then **challenge** these notaries during a certain time frame known as a **challenge period** that corresponds to the proof of custody. Notaries are incentivized to hold onto their downloaded collation data at least until the length of the challenge period is over. This challenge period is a public parameter that was added to the Sharding Manager Contract in #168.\r\n\r\n### Challenge, Response Mechanism\r\n\r\nIf a notary is challenged before the time period is up, the notary has a maximum **response window** in which it can respond to the request before being punished. \r\n\r\nWe will **NOT** implement the challenge response mechanism as part of the Ruby release, but we will implement a PR in our code that persists collation data in a notary node and periodically checks when the challenge period is over.\r\n\r\nThen, using a CLI flag for configuration, the node knows the maximum time period it can hold the data before it deletes it. This amount of time is **at least challenge_period + response_period** long. \r\n\r\nPurging is done by deleting all downloaded collation body information from the persistent key-value store in a notary node once the challenge period is over (if the notary received no challenges) or challenge period + response period (if the notary received a challenge).\r\n\r\nA PR for this should configure this purge timeframe and allow the user to specify how long it wants to persist data, and should automatically delete the data from storage once the timeframe is over.\r\n\r\n### References\r\n\r\n- [Extending Skin in the Game Of Notarization With Proofs of Custody](https://ethresear.ch/t/extending-skin-in-the-game-of-notarization-with-proofs-of-custody/1639)\r\n- [Minimal Sharding Protocol](https://ethresear.ch/t/a-minimal-sharding-protocol-that-may-be-worthwhile-as-a-development-target-now/1650)",
  "closed_by": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/201/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/201/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/399279173",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/201#issuecomment-399279173",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/201",
    "id": 399279173,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTI3OTE3Mw==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-21T23:58:29Z",
    "updated_at": "2018-06-21T23:58:29Z",
    "author_association": "MEMBER",
    "body": "Please add more context to the requirements. We need to provide more information for a outside contributor to pick this up. \r\n\r\n- How long is the challenge period? How will the notary know if the challenge period has ended?\r\n- What about if they are challenged just before the period ends? Shouldn't we have some buffer and a check to be sure we aren't being challenged before purging this data?\r\n- What flag will you use to determine whether or not to purge? (Think about archival nodes)\r\n- How is purging done? \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/399279173/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/399492762",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/201#issuecomment-399492762",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/201",
    "id": 399492762,
    "node_id": "MDEyOklzc3VlQ29tbWVudDM5OTQ5Mjc2Mg==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-06-22T16:02:04Z",
    "updated_at": "2018-06-22T16:02:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey @prestonvanloon updated the issue description to answer all your questions.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/399492762/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/402539658",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/201#issuecomment-402539658",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/201",
    "id": 402539658,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQwMjUzOTY1OA==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2018-07-04T18:30:49Z",
    "updated_at": "2018-07-04T18:30:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing due to #230.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/402539658/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
