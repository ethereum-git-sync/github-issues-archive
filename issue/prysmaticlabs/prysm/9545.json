{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9545",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9545/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9545/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9545/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/9545",
  "id": 990885885,
  "node_id": "MDU6SXNzdWU5OTA4ODU4ODU=",
  "number": 9545,
  "title": "GetValidatorPerformance returns averageInclusionDistance of 0 in v2",
  "user": {
    "login": "alrevuelta",
    "id": 8811422,
    "node_id": "MDQ6VXNlcjg4MTE0MjI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8811422?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alrevuelta",
    "html_url": "https://github.com/alrevuelta",
    "followers_url": "https://api.github.com/users/alrevuelta/followers",
    "following_url": "https://api.github.com/users/alrevuelta/following{/other_user}",
    "gists_url": "https://api.github.com/users/alrevuelta/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alrevuelta/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alrevuelta/subscriptions",
    "organizations_url": "https://api.github.com/users/alrevuelta/orgs",
    "repos_url": "https://api.github.com/users/alrevuelta/repos",
    "events_url": "https://api.github.com/users/alrevuelta/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alrevuelta/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "prestonvanloon",
    "id": 7246818,
    "node_id": "MDQ6VXNlcjcyNDY4MTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prestonvanloon",
    "html_url": "https://github.com/prestonvanloon",
    "followers_url": "https://api.github.com/users/prestonvanloon/followers",
    "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
    "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
    "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
    "repos_url": "https://api.github.com/users/prestonvanloon/repos",
    "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-09-08T08:47:24Z",
  "updated_at": "2021-09-29T20:49:58Z",
  "closed_at": "2021-09-29T20:49:58Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "# ðŸž Bug Report\r\n\r\n### Description\r\n\r\nAfter upgrading to `v2.0.0-rc.1` in `Prater`, I get that the attestation inclusion distance is 0 for all validators, both in the summary posted by the validator and in the information fetched from the beacon chain using `GetValidatorPerformance`. Note that even if the attestation is not produced, a 0 is returned, whereas `^uint(0)` was being returned before.\r\n\r\nFrom the validator logs: Note `averageInclusionDistance=\"0.00 slots\"`\r\n```console\r\ntime=\"2021-09-07 11:39:08\" level=info msg=\"Vote summary since launch\" attestationsInclusionPct=\"100%\" averageInclusionDistance=\"0.00 slots\" correctlyVotedHeadPct=\"86%\" correctlyVotedSourcePct=\"99%\" correctlyVotedTargetPct=\"100%\" numberOfEpochs=902 pctChangeCombinedBalance=\"0.05755%\" prefix=validator\r\n```\r\n\r\nI also tried querying the beacon node by myself with `GetValidatorPerformance()` and I get that InclusionDistances is always 0. I guess the issue might be somewhere here: https://github.com/prysmaticlabs/prysm/blob/develop/beacon-chain/rpc/prysm/v1alpha1/beacon/validators.go#L685-L699. The validatorSummary[n].inclusionDistances is empty for Altair.\r\n\r\n### Has this worked before in a previous version?\r\n\r\nThis was working on several previous versions, such as `v1.4.3`, where a valid attestation distance was being returned.\r\n\r\n## ðŸ”¬ Minimal Reproduction\r\n\r\nThe issue can be reproduced having a `beacon-chain` running `v2..0.0-rc.1` in Prater and calling `GetValidatorPerformance`.\r\n\r\n```go\r\npackage main\r\n\r\nimport (\r\n\t\"fmt\"\r\n\t\"context\"\r\n\t\"google.golang.org/grpc\"\r\n\tethpb \"github.com/prysmaticlabs/prysm/proto/prysm/v1alpha1\"\r\n\t\"github.com/ethereum/go-ethereum/common/hexutil\"\r\n)\r\n\r\nfunc main() {\r\n\tdialContext, err := grpc.DialContext(context.Background(), \"localhost:4000\", grpc.WithInsecure())\r\n\tif err != nil {\r\n\t\tfmt.Println(\"error\", err)\r\n\t}\r\n\r\n\tbeaconClient := ethpb.NewBeaconChainClient(dialContext)\r\n\r\n\tpubKey := \"0x8d7411ab4411ca27d9fd0a9cc05012bbe9be861e8e90ce2909adf5386a05bc484b004006f8dcd0d5207dc3dde0c73dbe\"\r\n\tkey, _ := hexutil.Decode(pubKey)\r\n\tpubKeys := make([][]byte, 1)\r\n\tpubKeys[0] = key\r\n\r\n\treq := &ethpb.ValidatorPerformanceRequest{\r\n\t\tPublicKeys: pubKeys,\r\n\t}\r\n\r\n\tvalsPerformance, err := beaconClient.GetValidatorPerformance(context.Background(), req)\r\n\tif err != nil {\r\n\t\tfmt.Println(\"error\", err)\r\n\t}\r\n\r\n\tfmt.Println(\"PublicKey:\", pubKey)\r\n\tfmt.Println(valsPerformance)\r\n}\r\n```\r\nSee returned `resp` for different validators.\r\nInactive key (at the moment of writing)\r\n```console\r\nPublicKey: 0x8d7411ab4411ca27d9fd0a9cc05012bbe9be861e8e90ce2909adf5386a05bc484b004006f8dcd0d5207dc3dde0c73dbe\r\ncurrent_effective_balances:32000000000 inclusion_slots:0 inclusion_distances:0 correctly_voted_source:false correctly_voted_target:false correctly_voted_head:false balances_before_epoch_transition:32334839458 balances_after_epoch_transition:32334824258 public_keys:\"\\x8dt\\x11\\xabD\\x11\\xca'\\xd9\\xfd\\n\\x9c\\xc0P\\x12\\xbbé¾†\\x1e\\x8e\\x90\\xce)\\t\\xad\\xf58j\\x05\\xbcHK\\x00@\\x06\\xf8\\xdc\\xd0\\xd5 }\\xc3\\xdd\\xe0\\xc7=\\xbe\"\r\n```\r\n\r\nActive key\r\n```console\r\nPublicKey: 0x8000091c2ae64ee414a54c1cc1fc67dec663408bc636cb86756e0200e41a75c8f86603f104f02c856983d2783116be13\r\ncurrent_effective_balances:32000000000 inclusion_slots:0 inclusion_distances:0 correctly_voted_source:true correctly_voted_target:true correctly_voted_head:true balances_before_epoch_transition:32486753129 balances_after_epoch_transition:32486771083 public_keys:\"\\x80\\x00\\t\\x1c*\\xe6N\\xe4\\x14\\xa5L\\x1c\\xc1\\xfcg\\xde\\xc6c@\\x8b\\xc66Ë†un\\x02\\x00\\xe4\\x1au\\xc8\\xf8f\\x03\\xf1\\x04\\xf0,\\x85i\\x83\\xd2x1\\x16\\xbe\\x13\"\r\n```\r\n\r\n## ðŸ”¥ Error\r\nNot an error per se but an unexpected output `averageInclusionDistance=\"0.00 slots`.\r\n```console\r\ntime=\"2021-09-07 11:39:08\" level=info msg=\"Vote summary since launch\" attestationsInclusionPct=\"100%\" averageInclusionDistance=\"0.00 slots\" correctlyVotedHeadPct=\"86%\" correctlyVotedSourcePct=\"99%\" correctlyVotedTargetPct=\"100%\" numberOfEpochs=902 pctChangeCombinedBalance=\"0.05755%\" prefix=validator\r\n```\r\n\r\n\r\n## ðŸŒ  Your Environment\r\n\r\n**Operating System:** Linux\r\n**What version of Prysm are you running? (Which release)** `v2.0.0-rc.1`\r\n**Anything else relevant (validator index / public key)?** NA\r\n\r\n",
  "closed_by": {
    "login": "prylabs-bulldozer[bot]",
    "id": 58059840,
    "node_id": "MDM6Qm90NTgwNTk4NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/in/47372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D",
    "html_url": "https://github.com/apps/prylabs-bulldozer",
    "followers_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9545/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9545/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/918696693",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9545#issuecomment-918696693",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9545",
    "id": 918696693,
    "node_id": "IC_kwDOBvuov842wjL1",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-14T00:36:53Z",
    "updated_at": "2021-09-14T00:36:53Z",
    "author_association": "MEMBER",
    "body": "I was talking with @terencechain about this and we landed on the fact that Altair no longer supports this information from the beacon state. I'll submit a PR to mark these fields as deprecated and stop showing them after the Altair hardfork.\r\n\r\nFrom @terencechain \r\n\r\n> Here's the difference in accounting reform between phase0 and Altair\r\n> \r\n> In phase 0\r\n> correctlyVotedTarget : voted target checkpoint correct\r\n> correctlyVotedSource: voted source checkpoint correct\r\n> correctlyVotedHead: voted head correct\r\n> inclusionDistance: how fast the attestation get included in the block\r\n> \r\n> In phase1\r\n> correctlyVotedTarget : voted target checkpoint correct && att is included less than 32 slots\r\n> correctlyVotedSource: voted source checkpoint correct && att is included less than 6 slots\r\n> correctlyVotedHead: voted head correct && att is included in 1 slot\r\n> \r\n> These correctlyVotedXXX info has some inclusion distance information in it, but it's no longer a number\r\n> \r\n> This is also a good info to pass around: https://github.com/ethereum/annotated-spec/blob/master/altair/beacon-chain.md#aside-validator-duties-rewards-and-penalties",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/918696693/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
