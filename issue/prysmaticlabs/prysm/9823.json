{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9823",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9823/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9823/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9823/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/9823",
  "id": 1037444891,
  "node_id": "I_kwDOBvuov8491icb",
  "number": 9823,
  "title": "avoid redirects in the RPC API",
  "user": {
    "login": "potuz",
    "id": 16044918,
    "node_id": "MDQ6VXNlcjE2MDQ0OTE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16044918?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/potuz",
    "html_url": "https://github.com/potuz",
    "followers_url": "https://api.github.com/users/potuz/followers",
    "following_url": "https://api.github.com/users/potuz/following{/other_user}",
    "gists_url": "https://api.github.com/users/potuz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/potuz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/potuz/subscriptions",
    "organizations_url": "https://api.github.com/users/potuz/orgs",
    "repos_url": "https://api.github.com/users/potuz/repos",
    "events_url": "https://api.github.com/users/potuz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/potuz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 934596141,
      "node_id": "MDU6TGFiZWw5MzQ1OTYxNDE=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Discussion",
      "name": "Discussion",
      "color": "f9d0c4",
      "default": false,
      "description": "Simply a thread for talking about stuff"
    },
    {
      "id": 1701740543,
      "node_id": "MDU6TGFiZWwxNzAxNzQwNTQz",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/API",
      "name": "API",
      "color": "30ef13",
      "default": false,
      "description": "Api related tasks"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-10-27T13:45:44Z",
  "updated_at": "2021-11-01T10:43:17Z",
  "closed_at": "2021-11-01T10:42:55Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "I am not sure if reporting this as a bug, feature request or security issue. Currently when querying an endpoint with something like `curl -s http://localhost:3500/eth/v1/node/syncing`, the request is being redirected to `http://localhost:3500/internal/eth/v1/node/syncing`. The problem is that these two requests can be made by different users of the system. Namely the first one is made by the user requesting it, the second one is made by the user running the beacon-chain binary. \r\n\r\nThis presents a security issue since someone that runs the beacon-chain as a random user would have to allow outgoing packets to `localhost:3500` for every user instead of some fixed sandboxed one. \r\n\r\nTo be explicit, in my system I do not allow outgoing connections to localhost, but I do open outgoing connections to localhost:3500 for one single user that is allowed to query the beacon-chain node. This user is not the same user that runs the beacon which is chosen at random by systemd at launch. ",
  "closed_by": {
    "login": "rkapka",
    "id": 28876818,
    "node_id": "MDQ6VXNlcjI4ODc2ODE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/28876818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rkapka",
    "html_url": "https://github.com/rkapka",
    "followers_url": "https://api.github.com/users/rkapka/followers",
    "following_url": "https://api.github.com/users/rkapka/following{/other_user}",
    "gists_url": "https://api.github.com/users/rkapka/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rkapka/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rkapka/subscriptions",
    "organizations_url": "https://api.github.com/users/rkapka/orgs",
    "repos_url": "https://api.github.com/users/rkapka/repos",
    "events_url": "https://api.github.com/users/rkapka/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rkapka/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9823/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9823/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/956123933",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9823#issuecomment-956123933",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9823",
    "id": 956123933,
    "node_id": "IC_kwDOBvuov844_Usd",
    "user": {
      "login": "rkapka",
      "id": 28876818,
      "node_id": "MDQ6VXNlcjI4ODc2ODE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/28876818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rkapka",
      "html_url": "https://github.com/rkapka",
      "followers_url": "https://api.github.com/users/rkapka/followers",
      "following_url": "https://api.github.com/users/rkapka/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkapka/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rkapka/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkapka/subscriptions",
      "organizations_url": "https://api.github.com/users/rkapka/orgs",
      "repos_url": "https://api.github.com/users/rkapka/repos",
      "events_url": "https://api.github.com/users/rkapka/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rkapka/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-01T10:42:55Z",
    "updated_at": "2021-11-01T10:43:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @potuz\r\n\r\nUnfortunately this is impossible with the current state of Prysm. We use the [grpc-gateway library](https://github.com/grpc-ecosystem/grpc-gateway) to translate between gRPC and JSON over HTTP. This library is not flexible enough to build an API which conforms to the official spec. This is why we constructed a middleware proxy that sits between the HTTP client and grpc-gateway.\r\n\r\nIn order to remove redirects we would need to do one of the following:\r\n- give up on gRPC (not going to happen)\r\n- write our own \"grpc-gateway\" (not going to happen)\r\n- modify our grpc-gateway fork so that it provides all functionality of the current middleware (very unlikely)\r\n\r\nTo summarize, I don't think we currently have any options to remove the proxying.  ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/956123933/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
