{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11880",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11880/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11880/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11880/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/11880",
  "id": 1535558154,
  "node_id": "I_kwDOBvuov85bhsIK",
  "number": 11880,
  "title": "could not process block in batch: timeout from http.Client: received an undefined ee error",
  "user": {
    "login": "DoubleDi",
    "id": 14843606,
    "node_id": "MDQ6VXNlcjE0ODQzNjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/14843606?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/DoubleDi",
    "html_url": "https://github.com/DoubleDi",
    "followers_url": "https://api.github.com/users/DoubleDi/followers",
    "following_url": "https://api.github.com/users/DoubleDi/following{/other_user}",
    "gists_url": "https://api.github.com/users/DoubleDi/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/DoubleDi/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/DoubleDi/subscriptions",
    "organizations_url": "https://api.github.com/users/DoubleDi/orgs",
    "repos_url": "https://api.github.com/users/DoubleDi/repos",
    "events_url": "https://api.github.com/users/DoubleDi/events{/privacy}",
    "received_events_url": "https://api.github.com/users/DoubleDi/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1966354762,
      "node_id": "MDU6TGFiZWwxOTY2MzU0NzYy",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Need-Info",
      "name": "Need-Info",
      "color": "fbca04",
      "default": false,
      "description": "Need more information from author"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-01-16T22:29:07Z",
  "updated_at": "2023-02-06T19:12:34Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "\r\n\r\n# üêû Bug Report\r\n\r\n### Description\r\n\r\nI am currently running a besu execution client and prysm beacon client. After successfully syncing from the checkpoint and backward resync up to block 16407452, there was a restart of the server, and now there are multiple errors, and the blocks on the server our moving by about 50 per day. The issue looks similar to #11707 as the error is completely the same. \r\n\r\n\r\n## üî¨ Minimal Reproduction\r\n\r\nused your instructions to setup besu + prysm\r\n\r\n<pre><code>\r\nnohup /var/ethereum/execution/besu-22.10.3/bin/besu --rpc-http-enabled --engine-jwt-enabled=true --engine-jwt-secret=/var/ethereum/consensus/prysm/jwt.hex --engine-host-allowlist=\"*\" --data-storage-format=BONSAI --data-path=/var/ethereum --rpc-ws-enabled --rpc-http-host=\"0.0.0.0\" --host-allowlist=\"*\"  > /var/ethereum/ethereum.log\r\n\r\nnohup /var/ethereum/consensus/prysm/prysm.sh beacon-chain --execution-endpoint=http://localhost:8551 --jwt-secret=/var/ethereum/consensus/prysm/jwt.hex --checkpoint-sync-url=https://mainnet.checkpoint.sigp.io --genesis-beacon-api-url=https://mainnet.checkpoint.sigp.io --datadir /var/ethererum/consensus/prysm  > /var/ethereum/prysm.log &\r\n</code></pre>\r\n\r\n## üî• Error\r\n\r\nprysm \r\n\r\n<pre><code>\r\ntime=\"2023-01-17 01:21:36\" level=info msg=\"Processing block batch of size 64 starting from  0x128dca8e... 5575358/5590306 - estimated time remaining 26m13s\" blocksPerSecond=9.5 peers=47 prefix=initial-sync\r\ntime=\"2023-01-17 01:21:52\" level=info msg=\"Peer summary\" activePeers=44 inbound=0 outbound=44 prefix=p2p\r\ntime=\"2023-01-17 01:22:10\" level=warning msg=\"Skip processing batched blocks\" error=\"could not process block in batch: timeout from http.Client: received an undefined ee error\" prefix=initial-sync\r\ntime=\"2023-01-17 01:22:10\" level=info msg=\"Processing block batch of size 64 starting from  0x8e98ed90... 5575550/5590308 - estimated time remaining 1h16m51s\" blocksPerSecond=3.2 peers=45 prefix=initial-sync\r\ntime=\"2023-01-17 01:22:10\" level=warning msg=\"Skip processing batched blocks\" error=\"beacon node doesn't have a parent in db with root: 0xa7f6581fd5109a38d9391c134792ce1e5e5aef968169ae0fbcec9b049d437ea0 (in processBatchedBlocks, slot=5575550)\" prefix=initial-sync\r\ntime=\"2023-01-17 01:22:10\" level=info msg=\"Processing block batch of size 64 starting from  0x074a2eba... 5575614/5590308 - estimated time remaining 38m15s\" blocksPerSecond=6.4 peers=45 prefix=initial-sync\r\ntime=\"2023-01-17 01:22:10\" level=warning msg=\"Skip processing batched blocks\" error=\"beacon node doesn't have a parent in db with root: 0xd3b119576de56f7a0ee8e7e77538dbea6a53b1bc7eaa334e46b490a5c2115714 (in processBatchedBlocks, slot=5575614)\" prefix=initial-sync\r\ntime=\"2023-01-17 01:22:10\" level=info msg=\"Processing block batch of size 64 starting from  0xdf7f8678... 5575678/5590308 - estimated time remaining 25m23s\" blocksPerSecond=9.6 peers=45 prefix=initial-sync\r\ntime=\"2023-01-17 01:22:10\" level=warning msg=\"Skip processing batched blocks\" error=\"beacon node doesn't have a parent in db with root: 0xa42a2cf62987df2125a7411150478eb87aa0ebb383f7f158141100924315c2f3 (in processBatchedBlocks, slot=5575678)\" prefix=initial-sync\r\ntime=\"2023-01-17 01:22:10\" level=info msg=\"Processing block batch of size 63 starting from  0x8115fbc3... 5575742/5590308 - estimated time remaining 19m2s\" blocksPerSecond=12.8 peers=45 prefix=initial-sync\r\ntime=\"2023-01-17 01:22:10\" level=warning msg=\"Skip processing batched blocks\" error=\"beacon node doesn't have a parent in db with root: 0x70ec122be8245ac679237b45b754b955cd535bd30f1172f60abea3d26bcfbb55 (in processBatchedBlocks, slot=5575742)\" prefix=initial-sync\r\ntime=\"2023-01-17 01:22:11\" level=info msg=\"Processing block batch of size 62 starting from  0x071d46d0... 5575422/5590309 - estimated time remaining 15m39s\" blocksPerSecond=15.8 peers=45 prefix=initial-sync\r\ntime=\"2023-01-17 01:22:11\" level=warning msg=\"Skip processing batched blocks\" error=\"beacon node doesn't have a parent in db with root: 0xa03f272e3791f8927965a66e052593004c1ff7b55bc2223e72fb8a4e9b789b26 (in processBatchedBlocks, slot=5575422)\" prefix=initial-sync\r\ntime=\"2023-01-17 01:22:13\" level=info msg=\"Processing block batch of size 64 starting from  0x72e509cd... 5575486/5590309 - estimated time remaining 12m58s\" blocksPerSecond=19.1 peers=45 prefix=initial-sync\r\ntime=\"2023-01-17 01:22:13\" level=warning msg=\"Skip processing batched blocks\" error=\"beacon node doesn't have a parent in db with root: 0x1c2da119f2b7c56cead5022a53713ef295de52b35ff686420e5ad0767df762a1 (in processBatchedBlocks, slot=5575486)\" prefix=initial-sync\r\ntime=\"2023-01-17 01:22:13\" level=info msg=\"Processing block batch of size 63 starting from  0xdb6bad87... 5575806/5590309 - estimated time remaining 10m53s\" blocksPerSecond=22.2 peers=45 prefix=initial-sync\r\ntime=\"2023-01-17 01:22:13\" level=warning msg=\"Skip processing batched blocks\" error=\"beacon node doesn't have a parent in db with root: 0x4dee79666a9a1e3a76fc0b81d0ab63fad583f2828ae982adad8fb1a539355896 (in processBatchedBlocks, slot=5575806)\" prefix=initial-sync\r\n</code></pre>\r\n\r\nbesu \r\n\r\n<pre><code>\r\n2023-01-17 01:23:07.131+03:00 | vertx-blocked-thread-checker | WARN  | BlockedThreadChecker | Thread Thread[#78,vert.x-worker-thread-0,5,main] has been blocked for 679364 ms, time limit is 60000 ms\r\nio.vertx.core.VertxException: Thread blocked\r\n\tat org.rocksdb.Transaction.disposeInternal(Native Method)\r\n\tat org.rocksdb.RocksObject.disposeInternal(RocksObject.java:37)\r\n\tat org.rocksdb.AbstractImmutableNativeReference.close(AbstractImmutableNativeReference.java:55)\r\n\tat org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBSnapshotTransaction.close(RocksDBSnapshotTransaction.java:163)\r\n\tat org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueSnapshot.close(RocksDBColumnarKeyValueSnapshot.java:107)\r\n\tat org.hyperledger.besu.ethereum.bonsai.BonsaiSnapshotWorldStateKeyValueStorage.tryClose(BonsaiSnapshotWorldStateKeyValueStorage.java:112)\r\n\tat org.hyperledger.besu.ethereum.bonsai.BonsaiSnapshotWorldStateKeyValueStorage.close(BonsaiSnapshotWorldStateKeyValueStorage.java:104)\r\n\tat org.hyperledger.besu.ethereum.bonsai.BonsaiInMemoryWorldState.close(BonsaiInMemoryWorldState.java:158)\r\n\tat org.hyperledger.besu.ethereum.MainnetBlockValidator.validateAndProcessBlock(MainnetBlockValidator.java:170)\r\n\tat org.hyperledger.besu.consensus.merge.blockcreation.MergeCoordinator.validateBlock(MergeCoordinator.java:440)\r\n\tat org.hyperledger.besu.consensus.merge.blockcreation.MergeCoordinator.rememberBlock(MergeCoordinator.java:454)\r\n\tat org.hyperledger.besu.consensus.merge.blockcreation.TransitionCoordinator.rememberBlock(TransitionCoordinator.java:141)\r\n\tat org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.engine.EngineNewPayload.syncResponse(EngineNewPayload.java:217)\r\n\tat org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.ExecutionEngineJsonRpcMethod.lambda$response$0(ExecutionEngineJsonRpcMethod.java:73)\r\n\tat io.vertx.core.impl.ContextImpl.lambda$null$0(ContextImpl.java:159)\r\n\tat io.vertx.core.impl.AbstractContext.dispatch(AbstractContext.java:100)\r\n\tat io.vertx.core.impl.ContextImpl.lambda$executeBlocking$1(ContextImpl.java:157)\r\n\tat io.vertx.core.impl.TaskQueue.run(TaskQueue.java:76)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.base/java.lang.Thread.run(Thread.java:1589)\r\n2023-01-17 01:23:07.214+03:00 | vert.x-worker-thread-0 | INFO  | EngineNewPayload | Imported #16,407,465 / 117 tx / base fee 16.28 gwei / 11,340,811 (37.8%) gas / (0x1ded2e01b5f9ec40e3896cb8e754b5863893d9652edd80e290fe8e1e0e9dc022) in 679.416s. Peers: 25\r\n</code></pre>\r\n\r\n## üåç  Your Environment\r\n\r\n**Operating System:**\r\n\r\n<pre>\r\n  <code>\r\nVirtualization: kvm\r\nOperating System: Debian GNU/Linux 11 (bullseye)\r\nKernel: Linux 5.10.0-19-amd64\r\nArchitecture: x86-64\r\nPrysm v3.2.0\r\nBesu 22.10.3\r\n  </code>\r\n</pre>\r\n\r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11880/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11880/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1419294915",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/11880#issuecomment-1419294915",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11880",
    "id": 1419294915,
    "node_id": "IC_kwDOBvuov85UmLjD",
    "user": {
      "login": "james-prysm",
      "id": 90280386,
      "node_id": "MDQ6VXNlcjkwMjgwMzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/90280386?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/james-prysm",
      "html_url": "https://github.com/james-prysm",
      "followers_url": "https://api.github.com/users/james-prysm/followers",
      "following_url": "https://api.github.com/users/james-prysm/following{/other_user}",
      "gists_url": "https://api.github.com/users/james-prysm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/james-prysm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/james-prysm/subscriptions",
      "organizations_url": "https://api.github.com/users/james-prysm/orgs",
      "repos_url": "https://api.github.com/users/james-prysm/repos",
      "events_url": "https://api.github.com/users/james-prysm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/james-prysm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-06T15:43:51Z",
    "updated_at": "2023-02-06T15:43:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "apologies for the late response, an ee error means there's something wrong with besu, you'll find more support with their team. early guess is perhaps there was an unsafe shutdown, I'm not sure what would cause io.vertx.core.VertxException: Thread blocked",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1419294915/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1419297902",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/11880#issuecomment-1419297902",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11880",
    "id": 1419297902,
    "node_id": "IC_kwDOBvuov85UmMRu",
    "user": {
      "login": "DoubleDi",
      "id": 14843606,
      "node_id": "MDQ6VXNlcjE0ODQzNjA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14843606?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DoubleDi",
      "html_url": "https://github.com/DoubleDi",
      "followers_url": "https://api.github.com/users/DoubleDi/followers",
      "following_url": "https://api.github.com/users/DoubleDi/following{/other_user}",
      "gists_url": "https://api.github.com/users/DoubleDi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DoubleDi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DoubleDi/subscriptions",
      "organizations_url": "https://api.github.com/users/DoubleDi/orgs",
      "repos_url": "https://api.github.com/users/DoubleDi/repos",
      "events_url": "https://api.github.com/users/DoubleDi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DoubleDi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-06T15:45:57Z",
    "updated_at": "2023-02-06T15:45:57Z",
    "author_association": "NONE",
    "body": "Hi @james-prysm ! Thanks a lot. What about the \"beacon node doesn't have a parent in db with root\"?  Prysm does not move forward and get insync.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1419297902/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1419608293",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/11880#issuecomment-1419608293",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/11880",
    "id": 1419608293,
    "node_id": "IC_kwDOBvuov85UnYDl",
    "user": {
      "login": "james-prysm",
      "id": 90280386,
      "node_id": "MDQ6VXNlcjkwMjgwMzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/90280386?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/james-prysm",
      "html_url": "https://github.com/james-prysm",
      "followers_url": "https://api.github.com/users/james-prysm/followers",
      "following_url": "https://api.github.com/users/james-prysm/following{/other_user}",
      "gists_url": "https://api.github.com/users/james-prysm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/james-prysm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/james-prysm/subscriptions",
      "organizations_url": "https://api.github.com/users/james-prysm/orgs",
      "repos_url": "https://api.github.com/users/james-prysm/repos",
      "events_url": "https://api.github.com/users/james-prysm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/james-prysm/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-06T19:12:34Z",
    "updated_at": "2023-02-06T19:12:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "This could be the same on the prysm side , I'd try to get the execution client working first and not throwing an error before addressing this. worse case you may need to resync prysm as well, however if you are ok with added security assumptions then checkpointsync would be able to get you synced in a few min. https://docs.prylabs.network/docs/prysm-usage/checkpoint-sync",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1419608293/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
