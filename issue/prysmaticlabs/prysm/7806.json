{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7806",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7806/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7806/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7806/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/7806",
  "id": 742447161,
  "node_id": "MDU6SXNzdWU3NDI0NDcxNjE=",
  "number": 7806,
  "title": "geth restart causes beacon node to lose connection to powchain endpoint and doesn't reconnect",
  "user": {
    "login": "alexfisher",
    "id": 176891,
    "node_id": "MDQ6VXNlcjE3Njg5MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/176891?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/alexfisher",
    "html_url": "https://github.com/alexfisher",
    "followers_url": "https://api.github.com/users/alexfisher/followers",
    "following_url": "https://api.github.com/users/alexfisher/following{/other_user}",
    "gists_url": "https://api.github.com/users/alexfisher/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/alexfisher/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/alexfisher/subscriptions",
    "organizations_url": "https://api.github.com/users/alexfisher/orgs",
    "repos_url": "https://api.github.com/users/alexfisher/repos",
    "events_url": "https://api.github.com/users/alexfisher/events{/privacy}",
    "received_events_url": "https://api.github.com/users/alexfisher/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129904,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDQ=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Bug",
      "name": "Bug",
      "color": "ee0701",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1085357069,
      "node_id": "MDU6TGFiZWwxMDg1MzU3MDY5",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Priority:%20High",
      "name": "Priority: High",
      "color": "f7ea26",
      "default": false,
      "description": "High priority item"
    },
    {
      "id": 1966354762,
      "node_id": "MDU6TGFiZWwxOTY2MzU0NzYy",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Need-Info",
      "name": "Need-Info",
      "color": "fbca04",
      "default": false,
      "description": "Need more information from author"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-11-13T13:24:19Z",
  "updated_at": "2021-02-10T16:24:08Z",
  "closed_at": "2021-02-10T16:24:08Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "# üêû Bug Report\r\n\r\n### Description\r\n\r\nWith this week's ETH 1 network issue due to out-of-date geth releases, I performed two geth updates that triggered this error condition two different times.  I'm running geth in its own docker container and prysm beacon and validator in their own containers.  Typically, the beacon node connects to geth via IPC which is shared between each respective docker container as a volume mapped to the same data directory with the geth.ipc file.\r\n\r\nDuring and after geth container restart, I see the following error get logged on the prsym beacon container:\r\n\r\n`level=error msg=\"Could not connect to powchain endpoint\" error=\"could not dial eth1 nodes: dial unix /root/.ethereum/goerli/geth.ipc: connect: connection refused\" prefix=powchain`\r\n\r\nThis error condition persists until I restart the beacon container and then it connects fine on first try:\r\n\r\n`level=info msg=\"Connected to eth1 proof-of-work chain\" endpoint=\"/root/.ethereum/goerli/geth.ipc\" prefix=powchain`\r\n\r\nI experienced this on the upgrade to yesterday's geth release, as well as the previous version.  I noticed other people on discord having similar issues (and one similar bug report), but am don't think anyone identified the issue as being caused by geth restart (causing the condition of ETH1 connection failure) followed by beacon node restart (causing ETH1 connection issue to be resolved).\r\n\r\n### Has this worked before in a previous version?\r\n\r\nHave been participating in Medalla since genesis and have been using IPC connection for at least the past 2 months without issue.\r\n\r\n## üî¨ Minimal Reproduction\r\n\r\nRunning docker-compose services, but some of the parameters for each container are below:\r\n\r\nDocker container with geth goerli\r\n\r\n--maxpeers=20 --goerli --port=31303\r\n\r\nDocker container with prysm beacon:\r\n\r\naccept-terms-of-use: yes\r\nhead-sync: yes\r\nmedalla: yes\r\nhttp-web3provider: /root/.ethereum/goerli/geth.ipc\r\np2p-max-peers: 40\r\nrpc-port: 4100\r\np2p-tcp-port: 13100\r\np2p-udp-port: 12100\r\ndatadir: /data\r\np2p-host-ip: \"\"\r\np2p-host-dns: \"\"\r\nrpc-host: 0.0.0.0\r\nmonitoring-host: 0.0.0.0\r\np2p-denylist: [\"10.0.0.0/8\",\"172.16.0.0/12\",\"192.168.0.0/16\",\"100.64.0.0/10\",\"169.254.0.0/16\"]\r\nenable-db-backup-webhook: true\r\nblst: yes\r\n\r\n## üî• Error\r\n\r\nSee above.\r\n\r\n## üåç  Your Environment\r\n\r\n**Operating System:**\r\n\r\n<pre>\r\n  <code>\r\nUbuntu Server 20.04.1 LTS\r\n  </code>\r\n</pre>\r\n\r\n**What version of Prysm are you running? (Which release)**\r\n\r\n<pre>\r\n  <code>\r\nv1.0.0-beta.2\r\n  </code>\r\n</pre>\r\n\r\n**Anything else relevant (validator index / public key)?**\r\n\r\n",
  "closed_by": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7806/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7806/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/727555052",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/7806#issuecomment-727555052",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7806",
    "id": 727555052,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNzU1NTA1Mg==",
    "user": {
      "login": "dpSky",
      "id": 56128195,
      "node_id": "MDQ6VXNlcjU2MTI4MTk1",
      "avatar_url": "https://avatars.githubusercontent.com/u/56128195?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dpSky",
      "html_url": "https://github.com/dpSky",
      "followers_url": "https://api.github.com/users/dpSky/followers",
      "following_url": "https://api.github.com/users/dpSky/following{/other_user}",
      "gists_url": "https://api.github.com/users/dpSky/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dpSky/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dpSky/subscriptions",
      "organizations_url": "https://api.github.com/users/dpSky/orgs",
      "repos_url": "https://api.github.com/users/dpSky/repos",
      "events_url": "https://api.github.com/users/dpSky/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dpSky/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-15T11:30:07Z",
    "updated_at": "2020-11-15T11:30:07Z",
    "author_association": "NONE",
    "body": "I used the bash shell to start the goetherum client and encountered the same problem, beaconchain **could not link to eth1 powchain**. \r\nI configured them like this:\r\n`/usr/local/bin/geth --goerli --http --datadir /var/eth-box/geth --rpc --rpcaddr 127.0.0.1`\r\n\r\n`ExecStart=/usr/local/bin/beacon-chain --p2p-host-ip=‚Äò‚Äô --datadir=/var/eth-box/beacon-chain --http-web3provider=http://127.0.0.1:8545 --accept-terms-of-use`\r\n\r\nUse **netstat -tl** to check the port of goeth and confirm that 8545 is in the listening state\r\n\r\n`Proto Recv-Q Send-Q Local Address           Foreign Address         State      \r\ntcp        0      0 0.0.0.0:ssh             0.0.0.0:*               LISTEN     \r\ntcp        0      0 localhost:8545          0.0.0.0:*               LISTEN     \r\ntcp        0      0 127.0.0.53:domain       0.0.0.0:*               LISTEN     \r\ntcp6       0      0 [::]:ssh                [::]:*                  LISTEN     \r\ntcp6       0      0 [::]:30303              [::]:*                  LISTEN     \r\ntcp6       0      0 ::1:35243               [::]:*                  LISTEN`\r\n\r\nI have used source code to compile and install and tested docker to run them, but I found that the success rate of prysm linking eth1 node is a probabilistic problem.\r\n\r\nIt will always prompt Could not connect to powchain endpoint\" error=\"could not dial eth1 nodes: eth1 node using incorrect chain id",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/727555052/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/767658606",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/7806#issuecomment-767658606",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7806",
    "id": 767658606,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2NzY1ODYwNg==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-26T16:23:00Z",
    "updated_at": "2021-01-26T16:23:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @alexfisher we recommend setting up a fallback eth1 node: https://docs.prylabs.network/docs/prysm-usage/setup-eth1#adding-fallback-eth1-nodes. Does this issue still happen to you?",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/767658606/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/776831958",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/7806#issuecomment-776831958",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7806",
    "id": 776831958,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NjgzMTk1OA==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-10T16:24:08Z",
    "updated_at": "2021-02-10T16:24:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @alexfisher let us know if this is still an issue and we can re-open",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/776831958/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
