{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/5638",
  "id": 607201985,
  "node_id": "MDU6SXNzdWU2MDcyMDE5ODU=",
  "number": 5638,
  "title": "Operations on validator db to manage validators",
  "user": {
    "login": "Phistr90",
    "id": 12374491,
    "node_id": "MDQ6VXNlcjEyMzc0NDkx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12374491?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Phistr90",
    "html_url": "https://github.com/Phistr90",
    "followers_url": "https://api.github.com/users/Phistr90/followers",
    "following_url": "https://api.github.com/users/Phistr90/following{/other_user}",
    "gists_url": "https://api.github.com/users/Phistr90/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Phistr90/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Phistr90/subscriptions",
    "organizations_url": "https://api.github.com/users/Phistr90/orgs",
    "repos_url": "https://api.github.com/users/Phistr90/repos",
    "events_url": "https://api.github.com/users/Phistr90/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Phistr90/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129907,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDc=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Help%20Wanted",
      "name": "Help Wanted",
      "color": "33aa3f",
      "default": false,
      "description": "Extra attention is needed"
    },
    {
      "id": 802129908,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDg=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Good%20First%20Issue",
      "name": "Good First Issue",
      "color": "7057ff",
      "default": false,
      "description": "Good for newcomers"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "rkapka",
    "id": 28876818,
    "node_id": "MDQ6VXNlcjI4ODc2ODE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/28876818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rkapka",
    "html_url": "https://github.com/rkapka",
    "followers_url": "https://api.github.com/users/rkapka/followers",
    "following_url": "https://api.github.com/users/rkapka/following{/other_user}",
    "gists_url": "https://api.github.com/users/rkapka/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rkapka/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rkapka/subscriptions",
    "organizations_url": "https://api.github.com/users/rkapka/orgs",
    "repos_url": "https://api.github.com/users/rkapka/repos",
    "events_url": "https://api.github.com/users/rkapka/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rkapka/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "rkapka",
      "id": 28876818,
      "node_id": "MDQ6VXNlcjI4ODc2ODE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/28876818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rkapka",
      "html_url": "https://github.com/rkapka",
      "followers_url": "https://api.github.com/users/rkapka/followers",
      "following_url": "https://api.github.com/users/rkapka/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkapka/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rkapka/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkapka/subscriptions",
      "organizations_url": "https://api.github.com/users/rkapka/orgs",
      "repos_url": "https://api.github.com/users/rkapka/repos",
      "events_url": "https://api.github.com/users/rkapka/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rkapka/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 14,
  "created_at": "2020-04-27T03:23:46Z",
  "updated_at": "2020-06-11T19:18:26Z",
  "closed_at": "2020-06-11T19:18:25Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "# ðŸš€ Feature Request \r\n\r\n### Description\r\n\r\nFor validator management purposes it would be nice to have a possibility to move certain validators from one instance to another. Currently all the validators information on a client are all stored in a single validator db. This makes it difficult to scale and balance load as it is not possible to move validators to another client\r\n\r\n### Describe the solution you'd like\r\n\r\nHelpful operations might be: merge(db_1,db_2) , split([Val1,..,Val_k],[Val_k+1,..,Val_n], db_2)\r\n\r\nThese two operations would allow to move some validators to a another validator client.\r\n\r\nWith merge and split another operation on db_1 could be import([Val_1,..,Val_k], db_2) to import validators Val_1,..,Val_k from db_2 into db_1.\r\n\r\n### Describe alternatives you've considered\r\n\r\nAn alternative might be to have a db for each validator.\r\n",
  "closed_by": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/624143507",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5638#issuecomment-624143507",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638",
    "id": 624143507,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNDE0MzUwNw==",
    "user": {
      "login": "alonmuroch",
      "id": 3773981,
      "node_id": "MDQ6VXNlcjM3NzM5ODE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3773981?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alonmuroch",
      "html_url": "https://github.com/alonmuroch",
      "followers_url": "https://api.github.com/users/alonmuroch/followers",
      "following_url": "https://api.github.com/users/alonmuroch/following{/other_user}",
      "gists_url": "https://api.github.com/users/alonmuroch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alonmuroch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alonmuroch/subscriptions",
      "organizations_url": "https://api.github.com/users/alonmuroch/orgs",
      "repos_url": "https://api.github.com/users/alonmuroch/repos",
      "events_url": "https://api.github.com/users/alonmuroch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alonmuroch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-05T16:01:09Z",
    "updated_at": "2020-05-05T16:01:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "@Phistr90 as I understand most of the db usage for the validator is slashing protection isn't it?",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/624143507/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/625723498",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5638#issuecomment-625723498",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638",
    "id": 625723498,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNTcyMzQ5OA==",
    "user": {
      "login": "rkapka",
      "id": 28876818,
      "node_id": "MDQ6VXNlcjI4ODc2ODE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/28876818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rkapka",
      "html_url": "https://github.com/rkapka",
      "followers_url": "https://api.github.com/users/rkapka/followers",
      "following_url": "https://api.github.com/users/rkapka/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkapka/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rkapka/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkapka/subscriptions",
      "organizations_url": "https://api.github.com/users/rkapka/orgs",
      "repos_url": "https://api.github.com/users/rkapka/repos",
      "events_url": "https://api.github.com/users/rkapka/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rkapka/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-08T09:16:09Z",
    "updated_at": "2020-05-08T09:16:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi!\r\n\r\nI would like to work on this issue. I have already discussed this on Discord and got a green light.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/625723498/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/626232323",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5638#issuecomment-626232323",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638",
    "id": 626232323,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjIzMjMyMw==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-09T20:38:13Z",
    "updated_at": "2020-05-09T20:38:13Z",
    "author_association": "MEMBER",
    "body": "@rkapka can you link to the discord conversation here please? ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/626232323/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/626303412",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5638#issuecomment-626303412",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638",
    "id": 626303412,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjMwMzQxMg==",
    "user": {
      "login": "rkapka",
      "id": 28876818,
      "node_id": "MDQ6VXNlcjI4ODc2ODE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/28876818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rkapka",
      "html_url": "https://github.com/rkapka",
      "followers_url": "https://api.github.com/users/rkapka/followers",
      "following_url": "https://api.github.com/users/rkapka/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkapka/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rkapka/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkapka/subscriptions",
      "organizations_url": "https://api.github.com/users/rkapka/orgs",
      "repos_url": "https://api.github.com/users/rkapka/repos",
      "events_url": "https://api.github.com/users/rkapka/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rkapka/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-10T10:07:21Z",
    "updated_at": "2020-05-10T10:07:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "Certainly.\r\n\r\nhttps://discordapp.com/channels/476244492043812875/667763844365680650/708239399048970301",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/626303412/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/626680564",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5638#issuecomment-626680564",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638",
    "id": 626680564,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjY4MDU2NA==",
    "user": {
      "login": "rkapka",
      "id": 28876818,
      "node_id": "MDQ6VXNlcjI4ODc2ODE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/28876818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rkapka",
      "html_url": "https://github.com/rkapka",
      "followers_url": "https://api.github.com/users/rkapka/followers",
      "following_url": "https://api.github.com/users/rkapka/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkapka/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rkapka/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkapka/subscriptions",
      "organizations_url": "https://api.github.com/users/rkapka/orgs",
      "repos_url": "https://api.github.com/users/rkapka/repos",
      "events_url": "https://api.github.com/users/rkapka/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rkapka/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-11T12:48:08Z",
    "updated_at": "2020-05-11T12:51:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "I have some doubts about how the merging part should be implemented.\r\n\r\n1. This issue's description makes a distinction between `merge(db_1, db_2)` and `import([Val_1,..,Val_k], db_2)`. To me this means that merging should create a completely new database. If this is the case, then should the following function be used?\r\nhttps://github.com/prysmaticlabs/prysm/blob/42278359d99dc30492c37013dbd9161dbc84873c/validator/db/db.go#L68\r\nIf it should, then some keys have to be passed to the function and, as far as I understand, merging should not deal with keys.\r\n2. If I create a new file `validator/db/manage.go`, can I use it directly from `validator/main.go` or should I introduce another layer of abstraction?\r\n3. Should my `Merge` function take a `ctx context.Context` parameter similarly to functions in `attestation_history.go` and `proposal_history.go`? I have a feeling that using context here doesn't make much sense because attestations/proposals are conceptually different that off-chain commands like merging validator data. If I do need to use it, then how can I get hold of it in `main.go` to pass it along to my function?\r\nI have to admit I don't fully understand this context thing. I think of it right now as some kind of an abstraction over request/response flows like HTTP.\r\n4. What is the purpose of `validator/db/iface/interface.go`? GoLand doesn't display any usages of the interface's function. If I have a `Merge` function in `manage.go`, should it be included in the interface?",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/626680564/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/626811415",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5638#issuecomment-626811415",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638",
    "id": 626811415,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjgxMTQxNQ==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-11T16:31:11Z",
    "updated_at": "2020-05-11T16:31:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "1. The primary use case of merging the db's is to be able to include all validator keys you handle under a single database so they can be used by a single validator client, right?\r\n2. The way the validator client runtime works is through the function `NewValidatorClient` defined in https://sourcegraph.com/github.com/prysmaticlabs/prysm/-/blob/validator/node/node.go#L46. It defines the services which run throughout the process' lifetime and is able to start/stop and check their status as needed. You should be able to call such logic in either that function or perhaps in the inside of NewKVStore, depending on your proposed design.\r\n3. Every function should take in a context. Context is critical for everything in Prysm, as it is used for all sorts of things including: cancelation of goroutines, cancelation of long-running functions on SIGTERM, attaching distributed tracing to functions for instrumentation, etc. Looks like the DB is initialized here: https://sourcegraph.com/github.com/prysmaticlabs/prysm/-/blob/validator/client/service.go#L155 and IMO, that function should take in a context, which should be the context of the ValidatorService struct https://sourcegraph.com/github.com/prysmaticlabs/prysm/-/blob/validator/client/service.go#L36. I think the db should be initialized in validator/node.go as well instead of inside of this client/service.go file, but that can be a separate PR\r\n4. The purpose of the interface is so there can be multiple implementations of a database. Currently, we do it in boltdb but someone else might want to implement the whole database in SQL or another framework. Yes, Merge should be part of this interface as it is important for all implementations of the db.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/626811415/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/626862566",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5638#issuecomment-626862566",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638",
    "id": 626862566,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjg2MjU2Ng==",
    "user": {
      "login": "rkapka",
      "id": 28876818,
      "node_id": "MDQ6VXNlcjI4ODc2ODE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/28876818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rkapka",
      "html_url": "https://github.com/rkapka",
      "followers_url": "https://api.github.com/users/rkapka/followers",
      "following_url": "https://api.github.com/users/rkapka/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkapka/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rkapka/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkapka/subscriptions",
      "organizations_url": "https://api.github.com/users/rkapka/orgs",
      "repos_url": "https://api.github.com/users/rkapka/repos",
      "events_url": "https://api.github.com/users/rkapka/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rkapka/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-11T18:04:05Z",
    "updated_at": "2020-06-03T15:52:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "After some discussion with @rauljordan on Discord (the relevant stuff starts here: https://discordapp.com/channels/476244492043812875/667763844365680650/709444111224143914) the current way to implement this feature is over several PRs.\r\n\r\nOperations:\r\n- [x] Merge\r\n- [x] Split\r\n- [ ] Import\r\n- [ ] Export\r\n- [ ] Move",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/626862566/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/626973131",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5638#issuecomment-626973131",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638",
    "id": 626973131,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyNjk3MzEzMQ==",
    "user": {
      "login": "wgknowles",
      "id": 12946048,
      "node_id": "MDQ6VXNlcjEyOTQ2MDQ4",
      "avatar_url": "https://avatars.githubusercontent.com/u/12946048?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wgknowles",
      "html_url": "https://github.com/wgknowles",
      "followers_url": "https://api.github.com/users/wgknowles/followers",
      "following_url": "https://api.github.com/users/wgknowles/following{/other_user}",
      "gists_url": "https://api.github.com/users/wgknowles/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wgknowles/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wgknowles/subscriptions",
      "organizations_url": "https://api.github.com/users/wgknowles/orgs",
      "repos_url": "https://api.github.com/users/wgknowles/repos",
      "events_url": "https://api.github.com/users/wgknowles/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wgknowles/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-11T21:24:10Z",
    "updated_at": "2020-05-11T21:24:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "Conversation about merging db's starts here: https://discord.com/channels/476244492043812875/476588476393848832/704163563635212330",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/626973131/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/629721330",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5638#issuecomment-629721330",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638",
    "id": 629721330,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyOTcyMTMzMA==",
    "user": {
      "login": "rkapka",
      "id": 28876818,
      "node_id": "MDQ6VXNlcjI4ODc2ODE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/28876818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rkapka",
      "html_url": "https://github.com/rkapka",
      "followers_url": "https://api.github.com/users/rkapka/followers",
      "following_url": "https://api.github.com/users/rkapka/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkapka/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rkapka/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkapka/subscriptions",
      "organizations_url": "https://api.github.com/users/rkapka/orgs",
      "repos_url": "https://api.github.com/users/rkapka/repos",
      "events_url": "https://api.github.com/users/rkapka/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rkapka/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-16T23:56:05Z",
    "updated_at": "2020-05-24T00:02:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "I gave this some thought and here is my current standpoint on merging:\r\n\r\n> The way the validator client runtime works is through the function NewValidatorClient (...) You should be able to call such logic in either that function or perhaps in the inside of NewKVStore, depending on your proposed design.\r\n\r\nI don't think spinning up a new client is necessary to do a merge. Let's do the merge in the context of the already running client initialized by the `validator` command. The merge will append data from source databases into the current client's database. This will partially cover the requested import functionality (resulting in data from all validators being imported into the current client's database, equivalent to manually specifying all validators when importing).\r\nIf the user wants to merge `db1` and `db2` into a new, empty database, then they invoke `validator accounts create` followed by `validator accounts merge`, with the `datadir` flag set to a directory that does not contain a database yet (I am unsure how this flag part will exactly work - will they have to provide it for both commands?).\r\n\r\nThe command will require a comma-separated list of source directories.\r\n\r\nOn a side note, I am not sure what would happen if I tried to run another client whilst one is already running. If they shared the same CLI context, things might get strange ðŸ˜€ \r\n\r\n> that function should take in a context, which should be the context of the ValidatorService struct https://sourcegraph.com/github.com/prysmaticlabs/prysm/-/blob/validator/client/service.go#L36\r\n\r\nIf my above reasoning makes sense, then I should use the context from the existing client. But how to access it from within the subcommand's code in `main.go`? The client is created inside the `startNode` function. I can modify the function to return the client, but that won't help me because it's only assigned in `app.Action = startNode` and not invoked anywhere.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/629721330/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/634383402",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5638#issuecomment-634383402",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638",
    "id": 634383402,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNDM4MzQwMg==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-27T02:10:10Z",
    "updated_at": "2020-05-27T02:10:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "Done by #5986",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/634383402/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/634860259",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5638#issuecomment-634860259",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638",
    "id": 634860259,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNDg2MDI1OQ==",
    "user": {
      "login": "rkapka",
      "id": 28876818,
      "node_id": "MDQ6VXNlcjI4ODc2ODE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/28876818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rkapka",
      "html_url": "https://github.com/rkapka",
      "followers_url": "https://api.github.com/users/rkapka/followers",
      "following_url": "https://api.github.com/users/rkapka/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkapka/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rkapka/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkapka/subscriptions",
      "organizations_url": "https://api.github.com/users/rkapka/orgs",
      "repos_url": "https://api.github.com/users/rkapka/repos",
      "events_url": "https://api.github.com/users/rkapka/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rkapka/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-27T18:34:26Z",
    "updated_at": "2020-05-27T19:20:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "@rauljordan This feature is not done yet. Please see my comment with the list of operations to implement - merging is complete, but there are more.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/634860259/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/638322603",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5638#issuecomment-638322603",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638",
    "id": 638322603,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzODMyMjYwMw==",
    "user": {
      "login": "rkapka",
      "id": 28876818,
      "node_id": "MDQ6VXNlcjI4ODc2ODE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/28876818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rkapka",
      "html_url": "https://github.com/rkapka",
      "followers_url": "https://api.github.com/users/rkapka/followers",
      "following_url": "https://api.github.com/users/rkapka/following{/other_user}",
      "gists_url": "https://api.github.com/users/rkapka/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rkapka/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rkapka/subscriptions",
      "organizations_url": "https://api.github.com/users/rkapka/orgs",
      "repos_url": "https://api.github.com/users/rkapka/repos",
      "events_url": "https://api.github.com/users/rkapka/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rkapka/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-03T16:53:02Z",
    "updated_at": "2020-06-03T16:55:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "I have been thinking what other operations might be useful apart from merging ans splitting and here are my proposals:\r\n\r\n1. Export - the user specifies a source directory, a target directory and a list of public keys k_1..k_n whose data should be exported from the source directory's database. A new database containing the exported data is created in the target directory.\r\n_Question: Should the exported data be removed from the source database? Maybe add a boolean flag to control this?_\r\n2. Import - the user specifies a source directory and a target directory. All data from the source database is copied to the target database.\r\n3. Move - the user specifies a source directory, a target directory and a list of public keys k_1..k_n whose data should be moved from the source directory's database to the target directory's database.\r\n_Question: Should the moved data be removed from the source database? Maybe add a boolean flag to control this?_\r\n4. Split (k_1..k_n) - splitting currently creates one database for each source database's key. Add a flag that allows to specify keys whose data should be split from the rest. As a result, two new databases are created: one with data for keys k_1..k_n and one with data for the rest of the keys. The source database stays untouched (this behaviour will be consistent with the \"regular\" split).\r\n_Question: Splitting one database into N databases will be tedious in case N is not a very small number. The keys could be passed in a more complicated manner, e.g. [k_1..k_n],[k_x..k_y]. As an example, passing `[k1,k2],[k3,k4,k5]` would create three databases:_\r\n    - _data for k1 and k2_\r\n    - _data for k3, k4 and k5_\r\n    - _data for the rest of keys (if there are any left)_\r\n\r\n**Remark**\r\nExport could be achieved using Move by creating a new database if the target directory does not contain one. Import could be achieved using Move by moving all keys over to the target database if no keys have been provided. I am wondering if it is better to have multiple operations, each doing their own thing, or a single powerful operation. Or maybe both?",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/638322603/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/638329866",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5638#issuecomment-638329866",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638",
    "id": 638329866,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzODMyOTg2Ng==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-03T17:05:45Z",
    "updated_at": "2020-06-03T17:05:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @rkapka move seems to be the most requested operation from folks. People wonder how they can perhaps move their keys safely with instructions to other machines or folders. We might not need move if we can implement import and export nicely. Those can perhaps output a zip file, which can be imported by another validator client.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/638329866/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/642879768",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5638#issuecomment-642879768",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5638",
    "id": 642879768,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0Mjg3OTc2OA==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-11T19:18:25Z",
    "updated_at": "2020-06-11T19:18:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing in favor of #6220 ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/642879768/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
