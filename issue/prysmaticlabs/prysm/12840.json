{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12840",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12840/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12840/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12840/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/12840",
  "id": 1877430693,
  "node_id": "I_kwDOBvuov85v51Gl",
  "number": 12840,
  "title": "Avoid caching pre-genesis SignedValidatorRegistration objects",
  "user": {
    "login": "bharath-123",
    "id": 21315653,
    "node_id": "MDQ6VXNlcjIxMzE1NjUz",
    "avatar_url": "https://avatars.githubusercontent.com/u/21315653?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bharath-123",
    "html_url": "https://github.com/bharath-123",
    "followers_url": "https://api.github.com/users/bharath-123/followers",
    "following_url": "https://api.github.com/users/bharath-123/following{/other_user}",
    "gists_url": "https://api.github.com/users/bharath-123/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bharath-123/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bharath-123/subscriptions",
    "organizations_url": "https://api.github.com/users/bharath-123/orgs",
    "repos_url": "https://api.github.com/users/bharath-123/repos",
    "events_url": "https://api.github.com/users/bharath-123/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bharath-123/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "james-prysm",
    "id": 90280386,
    "node_id": "MDQ6VXNlcjkwMjgwMzg2",
    "avatar_url": "https://avatars.githubusercontent.com/u/90280386?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/james-prysm",
    "html_url": "https://github.com/james-prysm",
    "followers_url": "https://api.github.com/users/james-prysm/followers",
    "following_url": "https://api.github.com/users/james-prysm/following{/other_user}",
    "gists_url": "https://api.github.com/users/james-prysm/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/james-prysm/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/james-prysm/subscriptions",
    "organizations_url": "https://api.github.com/users/james-prysm/orgs",
    "repos_url": "https://api.github.com/users/james-prysm/repos",
    "events_url": "https://api.github.com/users/james-prysm/events{/privacy}",
    "received_events_url": "https://api.github.com/users/james-prysm/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "james-prysm",
      "id": 90280386,
      "node_id": "MDQ6VXNlcjkwMjgwMzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/90280386?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/james-prysm",
      "html_url": "https://github.com/james-prysm",
      "followers_url": "https://api.github.com/users/james-prysm/followers",
      "following_url": "https://api.github.com/users/james-prysm/following{/other_user}",
      "gists_url": "https://api.github.com/users/james-prysm/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/james-prysm/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/james-prysm/subscriptions",
      "organizations_url": "https://api.github.com/users/james-prysm/orgs",
      "repos_url": "https://api.github.com/users/james-prysm/repos",
      "events_url": "https://api.github.com/users/james-prysm/events{/privacy}",
      "received_events_url": "https://api.github.com/users/james-prysm/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-09-01T13:28:59Z",
  "updated_at": "2023-09-09T18:53:04Z",
  "closed_at": "2023-09-09T18:53:03Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Prysm caches SignedValidatorRegistration objects as shown here before sending it to the MEV relay https://github.com/prysmaticlabs/prysm/blob/0a5c322f2211bee538c9f8279711ef94d6f13c28/validator/client/registration.go#L79 , I believe we register SignedValidatorRegistration with the relayers every epoch. Epoch 0 runs before the genesis timestamp. Sending SignedValidatorRegistration object to relayers before genesis fails because of https://github.com/flashbots/mev-boost-relay/blob/main/services/api/service.go#L1019 . The request to send fails, but the object is still cached. Whenever we resend it post-genesis, we pick the cached object with a stale timestamp, making it such that the validators can never be registered on the relay.\r\n\r\nThe solution I feel should be we shouldn't cache pre-genesis ValidatorRegistration objects in prysm. We should add a check if the timestamp is before genesis and avoid caching such an object.\r\n\r\nThis is not an issue in the current status quo, as relayers were introduced post genesis. This mainly fails in custom devnet setups where we setup relays from genesis. \r\n\r\nThis issue can be reproduced using kurtosis(https://github.com/kurtosis-tech/eth2-package), by setting up with prysm as the consensus client.",
  "closed_by": {
    "login": "prylabs-bulldozer[bot]",
    "id": 58059840,
    "node_id": "MDM6Qm90NTgwNTk4NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/in/47372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D",
    "html_url": "https://github.com/apps/prylabs-bulldozer",
    "followers_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12840/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12840/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1702758787",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/12840#issuecomment-1702758787",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12840",
    "id": 1702758787,
    "node_id": "IC_kwDOBvuov85lfgmD",
    "user": {
      "login": "bharath-123",
      "id": 21315653,
      "node_id": "MDQ6VXNlcjIxMzE1NjUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/21315653?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bharath-123",
      "html_url": "https://github.com/bharath-123",
      "followers_url": "https://api.github.com/users/bharath-123/followers",
      "following_url": "https://api.github.com/users/bharath-123/following{/other_user}",
      "gists_url": "https://api.github.com/users/bharath-123/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bharath-123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bharath-123/subscriptions",
      "organizations_url": "https://api.github.com/users/bharath-123/orgs",
      "repos_url": "https://api.github.com/users/bharath-123/repos",
      "events_url": "https://api.github.com/users/bharath-123/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bharath-123/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-01T13:33:41Z",
    "updated_at": "2023-09-01T13:33:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "With the below network.json file, we can setup the kurtosis devnet\r\n```\r\n{\r\n  \"participants\": [\r\n    {\r\n      \"el_client_type\": \"geth\",\r\n      \"el_client_image\": \"\",\r\n      \"el_client_log_level\": \"\",\r\n      \"el_extra_params\": [],\r\n      \"cl_client_type\": \"prysm\",\r\n      \"cl_client_log_level\": \"\",\r\n      \"cl_client_image\": \"\",\t\r\n      \"beacon_extra_params\": [],\r\n      \"validator_extra_params\": [],\r\n      \"builder_network_params\": null,\r\n      \"count\": 1\r\n    }\r\n  ],\r\n\r\n  \"network_params\": {\r\n    \"network_id\": \"3151908\",\r\n\r\n    \"deposit_contract_address\": \"0x4242424242424242424242424242424242424242\",\r\n\r\n    \"seconds_per_slot\": 12,\r\n\r\n    \"slots_per_epoch\": 32,\r\n\r\n    \"num_validator_keys_per_node\": 64,\r\n\r\n    \"preregistered_validator_keys_mnemonic\": \"giant issue aisle success illegal bike spike question tent bar rely arctic volcano long crawl hungry vocal artwork sniff fantasy very lucky have athlete\",\r\n\r\n    \"capella_fork_epoch\": 1,\r\n    \"deneb_fork_epoch\": 5000\r\n  },\r\n\r\n  \"launch_additional_services\": true,\r\n\r\n  \"wait_for_finalization\": false,\r\n\r\n  \"wait_for_verifications\": false,\r\n\r\n  \"verifications_epoch_limit\": 5,\r\n\r\n  \"global_client_log_level\": \"info\",\r\n\r\n  \"snooper_enabled\": false,\r\n\r\n  \"parallel_keystore_generation\": false,\r\n\r\n  \"mev_type\": \"full\",\r\n\r\n  \"mev_params\": {\r\n    \"mev_relay_api_extra_args\": [],\r\n    \"mev_relay_housekeeper_extra_args\": [],\r\n    \"mev_relay_website_extra_args\": [],\r\n    \"mev_builder_extra_args\": [],\r\n    \"mev_flood_extra_args\": []\r\n  }\r\n}\r\n\r\n\r\n```\r\nwith the following command:\r\n\r\n`sudo kurtosis run --enclave my-testnet github.com/kurtosis-tech/eth2-package \"$(cat ./network.json)\"`\r\n\r\nyou can see through the mev-relayer api logs the error that `timestamp is too early`",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1702758787/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1704787645",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/12840#issuecomment-1704787645",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12840",
    "id": 1704787645,
    "node_id": "IC_kwDOBvuov85lnP69",
    "user": {
      "login": "nisdas",
      "id": 33201827,
      "node_id": "MDQ6VXNlcjMzMjAxODI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/33201827?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nisdas",
      "html_url": "https://github.com/nisdas",
      "followers_url": "https://api.github.com/users/nisdas/followers",
      "following_url": "https://api.github.com/users/nisdas/following{/other_user}",
      "gists_url": "https://api.github.com/users/nisdas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nisdas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nisdas/subscriptions",
      "organizations_url": "https://api.github.com/users/nisdas/orgs",
      "repos_url": "https://api.github.com/users/nisdas/repos",
      "events_url": "https://api.github.com/users/nisdas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nisdas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-04T07:54:41Z",
    "updated_at": "2023-09-04T07:54:41Z",
    "author_association": "MEMBER",
    "body": "cc @james-prysm ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1704787645/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1704996221",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/12840#issuecomment-1704996221",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12840",
    "id": 1704996221,
    "node_id": "IC_kwDOBvuov85loC19",
    "user": {
      "login": "bharath-123",
      "id": 21315653,
      "node_id": "MDQ6VXNlcjIxMzE1NjUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/21315653?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bharath-123",
      "html_url": "https://github.com/bharath-123",
      "followers_url": "https://api.github.com/users/bharath-123/followers",
      "following_url": "https://api.github.com/users/bharath-123/following{/other_user}",
      "gists_url": "https://api.github.com/users/bharath-123/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bharath-123/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bharath-123/subscriptions",
      "organizations_url": "https://api.github.com/users/bharath-123/orgs",
      "repos_url": "https://api.github.com/users/bharath-123/repos",
      "events_url": "https://api.github.com/users/bharath-123/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bharath-123/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-04T10:15:11Z",
    "updated_at": "2023-09-04T10:15:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "Discussed with james offline, raised a PR to fix this  https://github.com/prysmaticlabs/prysm/pull/12847 ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1704996221/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
