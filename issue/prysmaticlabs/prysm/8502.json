{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8502",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8502/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8502/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8502/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/8502",
  "id": 814422794,
  "node_id": "MDU6SXNzdWU4MTQ0MjI3OTQ=",
  "number": 8502,
  "title": "verifyBeaconBlock should wait for the block",
  "user": {
    "login": "potuz",
    "id": 16044918,
    "node_id": "MDQ6VXNlcjE2MDQ0OTE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16044918?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/potuz",
    "html_url": "https://github.com/potuz",
    "followers_url": "https://api.github.com/users/potuz/followers",
    "following_url": "https://api.github.com/users/potuz/following{/other_user}",
    "gists_url": "https://api.github.com/users/potuz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/potuz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/potuz/subscriptions",
    "organizations_url": "https://api.github.com/users/potuz/orgs",
    "repos_url": "https://api.github.com/users/potuz/repos",
    "events_url": "https://api.github.com/users/potuz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/potuz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-02-23T12:33:58Z",
  "updated_at": "2021-02-23T16:04:44Z",
  "closed_at": "2021-02-23T16:04:43Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# 🐞 Bug Report\r\n\r\n### Description\r\nThis is an attempt to find an explanation to a problem that has been repeatedly reported in Discord. I got trace level logs from someone running ~50 validators and they show everything normal on both beacon and validator. \r\n\r\n### The problem:\r\n\r\nSomeone running many validators with the flag `--attest-timely` proposes a block and attests at the same slot. The attestation goes missing. From the point of view of the attesting node and validator client everything seems fine. \r\n\r\nThe problem may lie not on the sending client, but on the receiving peers. Since the attestation is leaving our node at around the same time with the block (only the processing time is the difference) and it goes through different subnets, our peer may receive the attestation before the block has arrived. On prysm this will get verified eventually from `onAttestation --> verifyBeaconBlock` which will check if we don't have yet the block and declare that the attestation cannot be processed because it is from the future. \r\n\r\nThis would explain also why in the situation described above but with one proposer and several attesters, some attestations are missing and some are not, on the same client and same slot. Because the attestations go on different Committees, some peers may have received the block and some may have not. \r\n\r\n### The solution\r\n\r\nCheck in `verifyBeaconBlock` if the target slot is within the head slot time (rather than if it is bigger than our head slot), if this is the case, wait for the block. \r\n\r\n",
  "closed_by": {
    "login": "potuz",
    "id": 16044918,
    "node_id": "MDQ6VXNlcjE2MDQ0OTE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16044918?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/potuz",
    "html_url": "https://github.com/potuz",
    "followers_url": "https://api.github.com/users/potuz/followers",
    "following_url": "https://api.github.com/users/potuz/following{/other_user}",
    "gists_url": "https://api.github.com/users/potuz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/potuz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/potuz/subscriptions",
    "organizations_url": "https://api.github.com/users/potuz/orgs",
    "repos_url": "https://api.github.com/users/potuz/repos",
    "events_url": "https://api.github.com/users/potuz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/potuz/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8502/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8502/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/784310625",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/8502#issuecomment-784310625",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8502",
    "id": 784310625,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NDMxMDYyNQ==",
    "user": {
      "login": "potuz",
      "id": 16044918,
      "node_id": "MDQ6VXNlcjE2MDQ0OTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16044918?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/potuz",
      "html_url": "https://github.com/potuz",
      "followers_url": "https://api.github.com/users/potuz/followers",
      "following_url": "https://api.github.com/users/potuz/following{/other_user}",
      "gists_url": "https://api.github.com/users/potuz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/potuz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/potuz/subscriptions",
      "organizations_url": "https://api.github.com/users/potuz/orgs",
      "repos_url": "https://api.github.com/users/potuz/repos",
      "events_url": "https://api.github.com/users/potuz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/potuz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-23T16:04:43Z",
    "updated_at": "2021-02-23T16:04:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "I was pointed correctly by @nisdas and @terencechain that the attestation is put in the queue during `validateCommitteeIndexBeaconAttestation` before it makes it to the service chain so this cannot be the reason. Closing this. Sorry for the noise. ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/784310625/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
