{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6976",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6976/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6976/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6976/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/6976",
  "id": 677906867,
  "node_id": "MDU6SXNzdWU2Nzc5MDY4Njc=",
  "number": 6976,
  "title": "Accounts-V2: listing accounts produces incorrect output mixing up \"validating public key\" entries",
  "user": {
    "login": "robik75",
    "id": 12534603,
    "node_id": "MDQ6VXNlcjEyNTM0NjAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/12534603?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/robik75",
    "html_url": "https://github.com/robik75",
    "followers_url": "https://api.github.com/users/robik75/followers",
    "following_url": "https://api.github.com/users/robik75/following{/other_user}",
    "gists_url": "https://api.github.com/users/robik75/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/robik75/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/robik75/subscriptions",
    "organizations_url": "https://api.github.com/users/robik75/orgs",
    "repos_url": "https://api.github.com/users/robik75/repos",
    "events_url": "https://api.github.com/users/robik75/events{/privacy}",
    "received_events_url": "https://api.github.com/users/robik75/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "robik75",
    "id": 12534603,
    "node_id": "MDQ6VXNlcjEyNTM0NjAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/12534603?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/robik75",
    "html_url": "https://github.com/robik75",
    "followers_url": "https://api.github.com/users/robik75/followers",
    "following_url": "https://api.github.com/users/robik75/following{/other_user}",
    "gists_url": "https://api.github.com/users/robik75/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/robik75/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/robik75/subscriptions",
    "organizations_url": "https://api.github.com/users/robik75/orgs",
    "repos_url": "https://api.github.com/users/robik75/repos",
    "events_url": "https://api.github.com/users/robik75/events{/privacy}",
    "received_events_url": "https://api.github.com/users/robik75/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "robik75",
      "id": 12534603,
      "node_id": "MDQ6VXNlcjEyNTM0NjAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/12534603?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/robik75",
      "html_url": "https://github.com/robik75",
      "followers_url": "https://api.github.com/users/robik75/followers",
      "following_url": "https://api.github.com/users/robik75/following{/other_user}",
      "gists_url": "https://api.github.com/users/robik75/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/robik75/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/robik75/subscriptions",
      "organizations_url": "https://api.github.com/users/robik75/orgs",
      "repos_url": "https://api.github.com/users/robik75/repos",
      "events_url": "https://api.github.com/users/robik75/events{/privacy}",
      "received_events_url": "https://api.github.com/users/robik75/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-08-12T18:56:39Z",
  "updated_at": "2020-09-01T18:13:44Z",
  "closed_at": "2020-09-01T18:13:44Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# üêû Bug Report\r\n\r\n### Description\r\n\r\nWhen listing V2 validator accounts, the output is incorrect, the \"validating public key\" entries are mixed up, showing as belonging to different accounts than they really do.\r\n\r\nAn example can be seen in ##6918, copied below:\r\n\r\n<pre>\r\n  <code>\r\nAccount 0 | constantly-popular-wasp\r\n[validating public key] 0xb692725fe769d79863eefe4752fac00f878072b8c898a8fbfca32189692ceb0bdb77212d82d9ee8a199b48a60461263b\r\n\r\nAccount 1 | cheaply-summary-gull\r\n[validating public key] 0x8329d8e9aa7da5f6b8300a22e55fd5657d6fa42d30408c83218da10136db06936e1bd7025574718e4283a1adf6c1ab71\r\n\r\nAccount 2 | carefully-wondrous-terrapin\r\n[validating public key] 0x99cc6a756b0492b2790903a175351d1e153b513e1cfb95db7a56a33cd811c5f7c859d94cea46b67b8e7e6481f09eb5f5\r\n\r\nAccount 3 | repeatedly-prime-stinkbug\r\n[validating public key] 0xa9e8ab052e4e80670ecf54a3bec7f43a08a1b146063221348a5c735e42ef16db1c0c9685f29192502526f91272b80a96\r\n  </code>\r\n</pre>\r\n\r\n<pre>\r\n  <code>\r\nAccount 0 | constantly-popular-wasp\r\n[withdrawal public key] 0xa387211380b13ab47d59a00f3eaa7a6edffd1f1b9745231aa607eb7480c42e403dba11d00a8e4f5d7c80627677c3c050\r\n[derivation path] m/12381/3600/0/0\r\n[validating public key] 0xa9e8ab052e4e80670ecf54a3bec7f43a08a1b146063221348a5c735e42ef16db1c0c9685f29192502526f91272b80a96\r\n[derivation path] m/12381/3600/0/0/0\r\n\r\nAccount 1 | cheaply-summary-gull\r\n[withdrawal public key] 0xb8ac604b685fd322c21ce1e2f263934c7e272cb6d3e60052430d6975d2666c2f142ba042213101c48c333df95a40abf4\r\n[derivation path] m/12381/3600/1/0\r\n[validating public key] 0x9958265fbd2577270ad8fda3745bd804ff77fb50fe02b781f203cd571204178e60686f4052803f7ceb5334ac197c2dd8\r\n[derivation path] m/12381/3600/1/0/0\r\n\r\nAccount 2 | carefully-wondrous-terrapin\r\n[withdrawal public key] 0xaf0f953920a8203b1d0a96f59e1cbfb80961086f10931c2ddaa8250d4d952dc38482847da15816842de56417f8273ab5\r\n[derivation path] m/12381/3600/2/0\r\n[validating public key] 0xb692725fe769d79863eefe4752fac00f878072b8c898a8fbfca32189692ceb0bdb77212d82d9ee8a199b48a60461263b\r\n[derivation path] m/12381/3600/2/0/0\r\n\r\nAccount 3 | repeatedly-prime-stinkbug\r\n[withdrawal public key] 0x87b9ebcd8af91ad43485aa311888f1622a2c41ce1614c24d205e9f52506c28c0543628c3eff8db18845925236421fc91\r\n[derivation path] m/12381/3600/3/0\r\n[validating public key] 0x8329d8e9aa7da5f6b8300a22e55fd5657d6fa42d30408c83218da10136db06936e1bd7025574718e4283a1adf6c1ab71\r\n[derivation path] m/12381/3600/3/0/0\r\n  </code>\r\n</pre>\r\n\r\nFor example the key `0xb692725fe769d79863eefe4752fac00f878072b8c898a8fbfca32189692ceb0bdb77212d82d9ee8a199b48a60461263b` is in the first listing show as belonging to the account `constantly-popular-wasp`, in the second listing it is shown to belong to the account `carefully-wondrous-terrapin`.\r\n\r\n### Has this worked before in a previous version?\r\n\r\nNo.\r\n\r\n## üî¨ Minimal Reproduction\r\n\r\nGenerate multiple accounts, note the validator public keys, then invoke validator again listing the accounts and observe that the `[validating public key]` entries are mixed up.\r\n\r\n## üî• Error\r\n\r\nNo error.\r\n\r\n## üåç  Your Environment\r\n\r\n**Operating System:**\r\n\r\n<pre>\r\n  <code>\r\nDistribution:      Clear Linux OS\r\nInstalled version: 33620\r\n\r\nDocker version 19.03.8, build afacb8b7f0d8d4f9d2a8e8736e9c993e672b41f3\r\n  </code>\r\n</pre>\r\n\r\n**What version of Prysm are you running? (Which release)**\r\n\r\n<pre>\r\n  <code>\r\ngcr.io/prysmaticlabs/prysm/validator:v1.0.0-alpha.19\r\n  </code>\r\n</pre>\r\n\r\n**Anything else relevant (validator index / public key)?**\r\n\r\nThe methods producing the output are calling the respective `keymanager.FetchValidatingPublicKeys` functions to retrieve the list of validator public keys. The direct and derived keymanagers both use the key collection of a hashmap to in the `FetchValidatingPublicKeys` function to produce the lis. Because of how a hashmap is implemented, that list is produced in a different order than the order in which the accounts are stored and listed, resulting in a mixup.\r\n\r\nHere is the relevant code:\r\n\r\nhttps://github.com/prysmaticlabs/prysm/blob/399dc85737639df62f3dc2f7d95478307812440f/validator/keymanager/v2/direct/direct.go#L311-L318\r\n\r\nhttps://github.com/prysmaticlabs/prysm/blob/399dc85737639df62f3dc2f7d95478307812440f/validator/keymanager/v2/derived/derived.go#L346-L353",
  "closed_by": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6976/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6976/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/676391008",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/6976#issuecomment-676391008",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6976",
    "id": 676391008,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NjM5MTAwOA==",
    "user": {
      "login": "robik75",
      "id": 12534603,
      "node_id": "MDQ6VXNlcjEyNTM0NjAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/12534603?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/robik75",
      "html_url": "https://github.com/robik75",
      "followers_url": "https://api.github.com/users/robik75/followers",
      "following_url": "https://api.github.com/users/robik75/following{/other_user}",
      "gists_url": "https://api.github.com/users/robik75/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/robik75/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/robik75/subscriptions",
      "organizations_url": "https://api.github.com/users/robik75/orgs",
      "repos_url": "https://api.github.com/users/robik75/repos",
      "events_url": "https://api.github.com/users/robik75/events{/privacy}",
      "received_events_url": "https://api.github.com/users/robik75/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-19T13:50:19Z",
    "updated_at": "2020-08-19T13:50:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "Edited the initial post for more clarity.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/676391008/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/677858062",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/6976#issuecomment-677858062",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6976",
    "id": 677858062,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3Nzg1ODA2Mg==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-20T19:31:29Z",
    "updated_at": "2020-08-20T19:31:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @RoBiK75 what's the status on this?",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/677858062/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/677865826",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/6976#issuecomment-677865826",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/6976",
    "id": 677865826,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3Nzg2NTgyNg==",
    "user": {
      "login": "robik75",
      "id": 12534603,
      "node_id": "MDQ6VXNlcjEyNTM0NjAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/12534603?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/robik75",
      "html_url": "https://github.com/robik75",
      "followers_url": "https://api.github.com/users/robik75/followers",
      "following_url": "https://api.github.com/users/robik75/following{/other_user}",
      "gists_url": "https://api.github.com/users/robik75/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/robik75/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/robik75/subscriptions",
      "organizations_url": "https://api.github.com/users/robik75/orgs",
      "repos_url": "https://api.github.com/users/robik75/repos",
      "events_url": "https://api.github.com/users/robik75/events{/privacy}",
      "received_events_url": "https://api.github.com/users/robik75/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-20T19:43:34Z",
    "updated_at": "2020-08-20T19:43:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Hi @RoBiK75 what's the status on this?\r\n\r\nHi @rauljordan,\r\nI closed the original pull request and I am preparing an another pull request with the solution we discussed on discord. It will be probably ready by tomorrow.\r\n\r\n\r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/677865826/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
