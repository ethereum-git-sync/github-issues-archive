{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/2671",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/2671/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/2671/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/2671/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/2671",
  "id": 446801225,
  "node_id": "MDU6SXNzdWU0NDY4MDEyMjU=",
  "number": 2671,
  "title": "SSZ map concurrent read-write",
  "user": {
    "login": "meyer9",
    "id": 1247379,
    "node_id": "MDQ6VXNlcjEyNDczNzk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1247379?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/meyer9",
    "html_url": "https://github.com/meyer9",
    "followers_url": "https://api.github.com/users/meyer9/followers",
    "following_url": "https://api.github.com/users/meyer9/following{/other_user}",
    "gists_url": "https://api.github.com/users/meyer9/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/meyer9/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/meyer9/subscriptions",
    "organizations_url": "https://api.github.com/users/meyer9/orgs",
    "repos_url": "https://api.github.com/users/meyer9/repos",
    "events_url": "https://api.github.com/users/meyer9/events{/privacy}",
    "received_events_url": "https://api.github.com/users/meyer9/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2019-05-21T20:06:37Z",
  "updated_at": "2019-05-23T00:44:16Z",
  "closed_at": "2019-05-23T00:44:16Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Really not sure why this is happening because it's protected by a lock, but I'm getting a concurrent map read/map write error here:\r\n\r\n```\r\nfatal error: concurrent map read and map write\r\n\r\ngoroutine 380 [running]:\r\nruntime.throw(0x1266d9e, 0x21)\r\n\t/usr/lib/go/src/runtime/panic.go:617 +0x72 fp=0xc00a5207c8 sp=0xc00a520798 pc=0x433692\r\nruntime.mapaccess1(0x1104d60, 0xc0002b4000, 0xc00a5208b0, 0x8)\r\n\t/usr/lib/go/src/runtime/map.go:413 +0x387 fp=0xc00a520848 sp=0xc00a5207c8 pc=0x4101c7\r\ngithub.com/prysmaticlabs/prysm/shared/ssz.cachedSSZUtilsNoAcquireLock(0x14df520, 0x10c8d60, 0x0, 0x0, 0x0)\r\n\t/home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/ssz_utils_cache.go:59 +0x7b fp=0xc00a5208d0 sp=0xc00a520848 pc=0xf0e6db\r\ngithub.com/prysmaticlabs/prysm/shared/ssz.getEncoding(0x10c8d60, 0xc008f62ea0, 0x18b, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/hash.go:88 +0xc5 fp=0xc00a520988 sp=0xc00a5208d0 pc=0xf0a975\r\ngithub.com/prysmaticlabs/prysm/shared/ssz.makeStructHasher.func1(0x11fc400, 0xc008f62e00, 0x199, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/hash.go:143 +0x201 fp=0xc00a520b50 sp=0xc00a520988 pc=0xf13a01\r\ngithub.com/prysmaticlabs/prysm/shared/ssz.makeSliceHasher.func1(0x10b2a80, 0xc00a4f4f30, 0x97, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/hash.go:120 +0x174 fp=0xc00a520ce8 sp=0xc00a520b50 pc=0xf132c4\r\ngithub.com/prysmaticlabs/prysm/shared/ssz.makeStructHasher.func1(0x1234460, 0xc00a4f4f00, 0x99, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/hash.go:143 +0x201 fp=0xc00a520eb0 sp=0xc00a520ce8 pc=0xf13a01\r\ngithub.com/prysmaticlabs/prysm/shared/ssz.TreeHash(0x1234460, 0xc00a4f4f00, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/hash.go:34 +0x36a fp=0xc00a521040 sp=0xc00a520eb0 pc=0xf09aca\r\ngithub.com/phoreproject/synapse/beacon/rpc.(*server).GetStateRoot(0xc00a4dc020, 0x14cde00, 0xc00a4e9170, 0xc00a4dcf00, 0x0, 0x0, 0x0)\r\n\t/home/meyer9/development/synapse/beacon/rpc/rpc.go:144 +0x117 fp=0xc00a521558 sp=0xc00a521040 pc=0x101b987\r\ngithub.com/phoreproject/synapse/pb._BlockchainRPC_GetStateRoot_Handler(0x11e7c40, 0xc00a4dc020, 0x14cde00, 0xc00a4e9170, 0xc00b8f4960, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/meyer9/development/synapse/pb/rpc.pb.go:1258 +0x3df fp=0xc00a521668 sp=0xc00a521558 pc=0xca497f\r\ngoogle.golang.org/grpc.(*Server).processUnaryRPC(0xc00a4f4000, 0x14d6ae0, 0xc00b8f2300, 0xc00bbe4100, 0xc00a4e8180, 0x1cd7bb8, 0x0, 0x0, 0x0)\r\n\t/home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/server.go:972 +0x1038 fp=0xc00a521c10 sp=0xc00a521668 pc=0xc72198\r\ngoogle.golang.org/grpc.(*Server).handleStream(0xc00a4f4000, 0x14d6ae0, 0xc00b8f2300, 0xc00bbe4100, 0x0)\r\n\t/home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/server.go:1252 +0x976 fp=0xc00a521f70 sp=0xc00a521c10 pc=0xc76206\r\ngoogle.golang.org/grpc.(*Server).serveStreams.func1.1(0xc00b8b05c0, 0xc00a4f4000, 0x14d6ae0, 0xc00b8f2300, 0xc00bbe4100)\r\n\t/home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/server.go:691 +0xb5 fp=0xc00a521fb8 sp=0xc00a521f70 pc=0xc869e5\r\nruntime.goexit()\r\n\t/usr/lib/go/src/runtime/asm_amd64.s:1337 +0x1 fp=0xc00a521fc0 sp=0xc00a521fb8 pc=0x462af1\r\ncreated by google.golang.org/grpc.(*Server).serveStreams.func1\r\n\t/home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/server.go:689 +0xb0\r\n```",
  "closed_by": {
    "login": "meyer9",
    "id": 1247379,
    "node_id": "MDQ6VXNlcjEyNDczNzk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1247379?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/meyer9",
    "html_url": "https://github.com/meyer9",
    "followers_url": "https://api.github.com/users/meyer9/followers",
    "following_url": "https://api.github.com/users/meyer9/following{/other_user}",
    "gists_url": "https://api.github.com/users/meyer9/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/meyer9/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/meyer9/subscriptions",
    "organizations_url": "https://api.github.com/users/meyer9/orgs",
    "repos_url": "https://api.github.com/users/meyer9/repos",
    "events_url": "https://api.github.com/users/meyer9/events{/privacy}",
    "received_events_url": "https://api.github.com/users/meyer9/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/2671/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/2671/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/494543031",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/2671#issuecomment-494543031",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/2671",
    "id": 494543031,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NDU0MzAzMQ==",
    "user": {
      "login": "meyer9",
      "id": 1247379,
      "node_id": "MDQ6VXNlcjEyNDczNzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1247379?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meyer9",
      "html_url": "https://github.com/meyer9",
      "followers_url": "https://api.github.com/users/meyer9/followers",
      "following_url": "https://api.github.com/users/meyer9/following{/other_user}",
      "gists_url": "https://api.github.com/users/meyer9/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meyer9/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meyer9/subscriptions",
      "organizations_url": "https://api.github.com/users/meyer9/orgs",
      "repos_url": "https://api.github.com/users/meyer9/repos",
      "events_url": "https://api.github.com/users/meyer9/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meyer9/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-21T20:20:10Z",
    "updated_at": "2019-05-21T20:20:10Z",
    "author_association": "NONE",
    "body": "Run with `-race`:\r\n```\r\n==================\r\nWARNING: DATA RACE\r\nRead at 0x00c000314000 by goroutine 117:\r\n  runtime.mapaccess1()\r\n      /usr/lib/go/src/runtime/map.go:396 +0x0\r\n  github.com/prysmaticlabs/prysm/shared/ssz.cachedSSZUtilsNoAcquireLock()\r\n      /home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/ssz_utils_cache.go:59 +0x98\r\n  github.com/prysmaticlabs/prysm/shared/ssz.getEncoding()\r\n      /home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/hash.go:88 +0x82\r\n  github.com/prysmaticlabs/prysm/shared/ssz.hashedEncoding()\r\n      /home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/hash.go:104 +0x6a\r\n  github.com/prysmaticlabs/prysm/shared/ssz.makeStructHasher.func1()\r\n      /home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/hash.go:143 +0x1a0\r\n  github.com/prysmaticlabs/prysm/shared/ssz.makeSliceHasher.func1()\r\n      /home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/hash.go:120 +0x17f\r\n  github.com/prysmaticlabs/prysm/shared/ssz.makeStructHasher.func1()\r\n      /home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/hash.go:143 +0x1a0\r\n  github.com/prysmaticlabs/prysm/shared/ssz.TreeHash()\r\n      /home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/hash.go:34 +0x324\r\n  github.com/phoreproject/synapse/beacon/rpc.(*server).GetStateRoot()\r\n      /home/meyer9/development/synapse/beacon/rpc/rpc.go:144 +0x178\r\n  github.com/phoreproject/synapse/pb._BlockchainRPC_GetStateRoot_Handler()\r\n      /home/meyer9/development/synapse/pb/rpc.pb.go:1258 +0x2fc\r\n  google.golang.org/grpc.(*Server).processUnaryRPC()\r\n      /home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/server.go:972 +0x936\r\n  google.golang.org/grpc.(*Server).handleStream()\r\n      /home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/server.go:1252 +0x1351\r\n  google.golang.org/grpc.(*Server).serveStreams.func1.1()\r\n      /home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/server.go:691 +0xac\r\n\r\nPrevious write at 0x00c000314000 by goroutine 118:\r\n  runtime.mapassign()\r\n      /usr/lib/go/src/runtime/map.go:576 +0x0\r\n  github.com/prysmaticlabs/prysm/shared/ssz.cachedSSZUtilsNoAcquireLock()\r\n      /home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/ssz_utils_cache.go:66 +0x135\r\n  github.com/prysmaticlabs/prysm/shared/ssz.cachedSSZUtils()\r\n      /home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/ssz_utils_cache.go:48 +0x127\r\n  github.com/prysmaticlabs/prysm/shared/ssz.TreeHash()\r\n      /home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/hash.go:30 +0xfd\r\n  github.com/phoreproject/synapse/primitives.(*State).ValidateAttestation()\r\n      /home/meyer9/development/synapse/primitives/state.go:1747 +0xa85\r\n  github.com/phoreproject/synapse/beacon.(*Mempool).ProcessNewAttestation()\r\n      /home/meyer9/development/synapse/beacon/mempool.go:68 +0x402\r\n  github.com/phoreproject/synapse/beacon/rpc.(*server).SubmitAttestation()\r\n      /home/meyer9/development/synapse/beacon/rpc/rpc.go:42 +0x12a\r\n  github.com/phoreproject/synapse/pb._BlockchainRPC_SubmitAttestation_Handler()\r\n      /home/meyer9/development/synapse/pb/rpc.pb.go:1348 +0x2fc\r\n  google.golang.org/grpc.(*Server).processUnaryRPC()\r\n      /home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/server.go:972 +0x936\r\n  google.golang.org/grpc.(*Server).handleStream()\r\n      /home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/server.go:1252 +0x1351\r\n  google.golang.org/grpc.(*Server).serveStreams.func1.1()\r\n      /home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/server.go:691 +0xac\r\n\r\nGoroutine 117 (running) created at:\r\n  google.golang.org/grpc.(*Server).serveStreams.func1()\r\n      /home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/server.go:689 +0xb8\r\n  google.golang.org/grpc/internal/transport.(*http2Server).operateHeaders()\r\n      /home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/internal/transport/http2_server.go:421 +0x1622\r\n  google.golang.org/grpc/internal/transport.(*http2Server).HandleStreams()\r\n      /home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/internal/transport/http2_server.go:461 +0x37a\r\n  google.golang.org/grpc.(*Server).serveStreams()\r\n      /home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/server.go:687 +0x170\r\n  google.golang.org/grpc.(*Server).handleRawConn.func1()\r\n      /home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/server.go:649 +0x50\r\n\r\nGoroutine 118 (running) created at:\r\n  google.golang.org/grpc.(*Server).serveStreams.func1()\r\n      /home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/server.go:689 +0xb8\r\n  google.golang.org/grpc/internal/transport.(*http2Server).operateHeaders()\r\n      /home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/internal/transport/http2_server.go:421 +0x1622\r\n  google.golang.org/grpc/internal/transport.(*http2Server).HandleStreams()\r\n      /home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/internal/transport/http2_server.go:461 +0x37a\r\n  google.golang.org/grpc.(*Server).serveStreams()\r\n      /home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/server.go:687 +0x170\r\n  google.golang.org/grpc.(*Server).handleRawConn.func1()\r\n      /home/meyer9/go/pkg/mod/google.golang.org/grpc@v1.20.1/server.go:649 +0x50\r\n==================\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/494543031/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/494543586",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/2671#issuecomment-494543586",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/2671",
    "id": 494543586,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NDU0MzU4Ng==",
    "user": {
      "login": "meyer9",
      "id": 1247379,
      "node_id": "MDQ6VXNlcjEyNDczNzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1247379?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meyer9",
      "html_url": "https://github.com/meyer9",
      "followers_url": "https://api.github.com/users/meyer9/followers",
      "following_url": "https://api.github.com/users/meyer9/following{/other_user}",
      "gists_url": "https://api.github.com/users/meyer9/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meyer9/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meyer9/subscriptions",
      "organizations_url": "https://api.github.com/users/meyer9/orgs",
      "repos_url": "https://api.github.com/users/meyer9/repos",
      "events_url": "https://api.github.com/users/meyer9/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meyer9/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-21T20:21:45Z",
    "updated_at": "2019-05-21T20:21:45Z",
    "author_association": "NONE",
    "body": "Seems that this code path doesn't acquire the lock:\r\n```\r\n  github.com/prysmaticlabs/prysm/shared/ssz.cachedSSZUtilsNoAcquireLock()\r\n      /home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/ssz_utils_cache.go:59 +0x98\r\n  github.com/prysmaticlabs/prysm/shared/ssz.getEncoding()\r\n      /home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/hash.go:88 +0x82\r\n  github.com/prysmaticlabs/prysm/shared/ssz.hashedEncoding()\r\n      /home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/hash.go:104 +0x6a\r\n  github.com/prysmaticlabs/prysm/shared/ssz.makeStructHasher.func1()\r\n      /home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/hash.go:143 +0x1a0\r\n  github.com/prysmaticlabs/prysm/shared/ssz.makeSliceHasher.func1()\r\n      /home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/hash.go:120 +0x17f\r\n  github.com/prysmaticlabs/prysm/shared/ssz.makeStructHasher.func1()\r\n      /home/meyer9/go/pkg/mod/github.com/prysmaticlabs/prysm@v0.0.0-20190514144052-d672a0602655/shared/ssz/hash.go:143 +0x1a0\r\n  github.com/prysmaticlabs/prysm/shared/ssz.TreeHash()\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/494543586/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/494611191",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/2671#issuecomment-494611191",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/2671",
    "id": 494611191,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NDYxMTE5MQ==",
    "user": {
      "login": "meyer9",
      "id": 1247379,
      "node_id": "MDQ6VXNlcjEyNDczNzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1247379?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meyer9",
      "html_url": "https://github.com/meyer9",
      "followers_url": "https://api.github.com/users/meyer9/followers",
      "following_url": "https://api.github.com/users/meyer9/following{/other_user}",
      "gists_url": "https://api.github.com/users/meyer9/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meyer9/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meyer9/subscriptions",
      "organizations_url": "https://api.github.com/users/meyer9/orgs",
      "repos_url": "https://api.github.com/users/meyer9/repos",
      "events_url": "https://api.github.com/users/meyer9/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meyer9/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-22T00:53:28Z",
    "updated_at": "2019-05-22T00:54:46Z",
    "author_association": "NONE",
    "body": "Reproduced here: https://github.com/meyer9/prysm/tree/ssz-data-race\r\n\r\n`go test -race -run TestConcurrentHash` produces the following in the `shared/ssz` package:\r\n```\r\n==================\r\nWARNING: DATA RACE\r\nWrite at 0x00c000150060 by goroutine 15:\r\n  runtime.mapassign()\r\n      /usr/lib/go/src/runtime/map.go:576 +0x0\r\n  github.com/prysmaticlabs/prysm/shared/ssz.cachedSSZUtilsNoAcquireLock()\r\n      /home/meyer9/go/src/github.com/prysmaticlabs/prysm/shared/ssz/ssz_utils_cache.go:66 +0x135\r\n  github.com/prysmaticlabs/prysm/shared/ssz.cachedSSZUtils()\r\n      /home/meyer9/go/src/github.com/prysmaticlabs/prysm/shared/ssz/ssz_utils_cache.go:48 +0x127\r\n  github.com/prysmaticlabs/prysm/shared/ssz.TreeHash()\r\n      /home/meyer9/go/src/github.com/prysmaticlabs/prysm/shared/ssz/hash.go:30 +0xfd\r\n  github.com/prysmaticlabs/prysm/shared/ssz.TestConcurrentHash.func1()\r\n      /home/meyer9/go/src/github.com/prysmaticlabs/prysm/shared/ssz/hash_test.go:273 +0xa4\r\n\r\nPrevious read at 0x00c000150060 by goroutine 14:\r\n  runtime.mapaccess1()\r\n      /usr/lib/go/src/runtime/map.go:396 +0x0\r\n  github.com/prysmaticlabs/prysm/shared/ssz.cachedSSZUtilsNoAcquireLock()\r\n      /home/meyer9/go/src/github.com/prysmaticlabs/prysm/shared/ssz/ssz_utils_cache.go:59 +0x98\r\n  github.com/prysmaticlabs/prysm/shared/ssz.getEncoding()\r\n      /home/meyer9/go/src/github.com/prysmaticlabs/prysm/shared/ssz/hash.go:88 +0x82\r\n  github.com/prysmaticlabs/prysm/shared/ssz.makeStructHasher.func1()\r\n      /home/meyer9/go/src/github.com/prysmaticlabs/prysm/shared/ssz/hash.go:143 +0x1a0\r\n  github.com/prysmaticlabs/prysm/shared/ssz.TreeHash()\r\n      /home/meyer9/go/src/github.com/prysmaticlabs/prysm/shared/ssz/hash.go:34 +0x324\r\n  github.com/prysmaticlabs/prysm/shared/ssz.TestConcurrentHash.func1()\r\n      /home/meyer9/go/src/github.com/prysmaticlabs/prysm/shared/ssz/hash_test.go:273 +0xa4\r\n\r\nGoroutine 15 (running) created at:\r\n  github.com/prysmaticlabs/prysm/shared/ssz.TestConcurrentHash()\r\n      /home/meyer9/go/src/github.com/prysmaticlabs/prysm/shared/ssz/hash_test.go:268 +0x367\r\n  testing.tRunner()\r\n      /usr/lib/go/src/testing/testing.go:865 +0x163\r\n\r\nGoroutine 14 (running) created at:\r\n  github.com/prysmaticlabs/prysm/shared/ssz.TestConcurrentHash()\r\n      /home/meyer9/go/src/github.com/prysmaticlabs/prysm/shared/ssz/hash_test.go:268 +0x367\r\n  testing.tRunner()\r\n      /usr/lib/go/src/testing/testing.go:865 +0x163\r\n==================\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/494611191/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/495025338",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/2671#issuecomment-495025338",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/2671",
    "id": 495025338,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ5NTAyNTMzOA==",
    "user": {
      "login": "meyer9",
      "id": 1247379,
      "node_id": "MDQ6VXNlcjEyNDczNzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1247379?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meyer9",
      "html_url": "https://github.com/meyer9",
      "followers_url": "https://api.github.com/users/meyer9/followers",
      "following_url": "https://api.github.com/users/meyer9/following{/other_user}",
      "gists_url": "https://api.github.com/users/meyer9/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meyer9/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meyer9/subscriptions",
      "organizations_url": "https://api.github.com/users/meyer9/orgs",
      "repos_url": "https://api.github.com/users/meyer9/repos",
      "events_url": "https://api.github.com/users/meyer9/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meyer9/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-05-23T00:44:08Z",
    "updated_at": "2019-05-23T00:44:08Z",
    "author_association": "NONE",
    "body": "Fixed with a94e73b2d6d20fc851355d1c6bec52ab9318986f.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/495025338/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
