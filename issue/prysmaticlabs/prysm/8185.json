{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8185",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8185/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8185/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8185/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/8185",
  "id": 776938668,
  "node_id": "MDU6SXNzdWU3NzY5Mzg2Njg=",
  "number": 8185,
  "title": "Attest early if head updates before 4 seconds",
  "user": {
    "login": "potuz",
    "id": 16044918,
    "node_id": "MDQ6VXNlcjE2MDQ0OTE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16044918?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/potuz",
    "html_url": "https://github.com/potuz",
    "followers_url": "https://api.github.com/users/potuz/followers",
    "following_url": "https://api.github.com/users/potuz/following{/other_user}",
    "gists_url": "https://api.github.com/users/potuz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/potuz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/potuz/subscriptions",
    "organizations_url": "https://api.github.com/users/potuz/orgs",
    "repos_url": "https://api.github.com/users/potuz/repos",
    "events_url": "https://api.github.com/users/potuz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/potuz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129904,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDQ=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Bug",
      "name": "Bug",
      "color": "ee0701",
      "default": false,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "terencechain",
    "id": 21316537,
    "node_id": "MDQ6VXNlcjIxMzE2NTM3",
    "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/terencechain",
    "html_url": "https://github.com/terencechain",
    "followers_url": "https://api.github.com/users/terencechain/followers",
    "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
    "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
    "organizations_url": "https://api.github.com/users/terencechain/orgs",
    "repos_url": "https://api.github.com/users/terencechain/repos",
    "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/terencechain/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "terencechain",
      "id": 21316537,
      "node_id": "MDQ6VXNlcjIxMzE2NTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/terencechain",
      "html_url": "https://github.com/terencechain",
      "followers_url": "https://api.github.com/users/terencechain/followers",
      "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
      "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
      "organizations_url": "https://api.github.com/users/terencechain/orgs",
      "repos_url": "https://api.github.com/users/terencechain/repos",
      "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/terencechain/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2020-12-31T12:02:59Z",
  "updated_at": "2021-01-06T21:10:27Z",
  "closed_at": "2021-01-06T21:10:27Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# 🐞 Bug Report\r\n\r\n### Description\r\n\r\nCurrently a validator waits for 4 seconds before submitting any attestation, regardless of whether we receive the block before this mark. There is a lot of room for optimization if we submit early in the cases when we receive the block earlier. \r\n\r\nThis behavior is documented in the \"honest validator\" section of the specs\r\n\r\n> A validator should create and broadcast the attestation to the associated attestation subnet when either (a) the validator has received a valid block from the expected block proposer for the assigned slot or (b) one-third of the slot has transpired (SECONDS_PER_SLOT / 3 seconds after the start of slot) -- whichever comes first.\r\n\r\n### Has this worked before in a previous version?\r\n\r\n@terencechain told me it did, but I tried looking in the current git history and couldn't find an implementation of this. \r\n\r\n### Extra info\r\n\r\nThe call  to wait is made in this line https://github.com/prysmaticlabs/prysm/blob/develop/validator/client/attest.go#L52\r\n\r\nI've checked my last 3000 attestations and they are all 3 miliseconds after the 4 seconds mark on usual attestations and after the 8 seconds mark on aggregator duties. \r\n\r\n```\r\n  time      source   target     slot    index  agr  committee      sourceroot       targetroot       beaconroot      delay\r\n08:55:39     6748     6749    215976    43867            0       0xd8073f4f7317   0x1a59cf818f13   0x87f59fecc9a7   4.0601\r\n08:55:27     6748     6749    215975     7654            9       0xd8073f4f7317   0x1a59cf818f13   0x861fb75dd7b0   4.0286\r\n08:50:27     6747     6748    215950     7654            6       0x238b6ec61d3b   0xd8073f4f7317   0xef6b782ea18d   4.0038\r\n08:48:03     6747     6748    215938    43867            6       0x238b6ec61d3b   0xd8073f4f7317   0xbfd1b5925316   4.0055\r\n08:47:15     6746     6747    215934    43867            7       0xed322e729303   0x238b6ec61d3b   0x5c75ec13d036   4.0041\r\n08:41:39     6746     6747    215906     7654            2       0xed322e729303   0x238b6ec61d3b   0x6b7320368809   4.0040\r\n08:38:51     6745     6746    215892    43867            5       0x978425e1a354   0xed322e729303   0x67c43e421f8e   4.0038\r\n08:36:51     6745     6746    215882     7654            6       0x978425e1a354   0xed322e729303   0xa38b53606b80   4.0040\r\n08:34:03     6744     6745    215868    43867            7       0xd02dd746af65   0x978425e1a354   0xd736305c72de   4.0044\r\n08:29:27     6744     6745    215845     7654           10       0xd02dd746af65   0x978425e1a354   0x445f84ede84b   4.0039\r\n```\r\n",
  "closed_by": {
    "login": "prylabs-bulldozer[bot]",
    "id": 58059840,
    "node_id": "MDM6Qm90NTgwNTk4NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/in/47372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D",
    "html_url": "https://github.com/apps/prylabs-bulldozer",
    "followers_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8185/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8185/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/752951482",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/8185#issuecomment-752951482",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8185",
    "id": 752951482,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1Mjk1MTQ4Mg==",
    "user": {
      "login": "potuz",
      "id": 16044918,
      "node_id": "MDQ6VXNlcjE2MDQ0OTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16044918?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/potuz",
      "html_url": "https://github.com/potuz",
      "followers_url": "https://api.github.com/users/potuz/followers",
      "following_url": "https://api.github.com/users/potuz/following{/other_user}",
      "gists_url": "https://api.github.com/users/potuz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/potuz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/potuz/subscriptions",
      "organizations_url": "https://api.github.com/users/potuz/orgs",
      "repos_url": "https://api.github.com/users/potuz/repos",
      "events_url": "https://api.github.com/users/potuz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/potuz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-31T12:50:53Z",
    "updated_at": "2020-12-31T12:50:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Perhaps this worked before #8078 ?",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/752951482/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/752996251",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/8185#issuecomment-752996251",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8185",
    "id": 752996251,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1Mjk5NjI1MQ==",
    "user": {
      "login": "terencechain",
      "id": 21316537,
      "node_id": "MDQ6VXNlcjIxMzE2NTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/terencechain",
      "html_url": "https://github.com/terencechain",
      "followers_url": "https://api.github.com/users/terencechain/followers",
      "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
      "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
      "organizations_url": "https://api.github.com/users/terencechain/orgs",
      "repos_url": "https://api.github.com/users/terencechain/repos",
      "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/terencechain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-31T16:10:26Z",
    "updated_at": "2020-12-31T16:10:26Z",
    "author_association": "MEMBER",
    "body": "Tracking back, prysm had the correct behavior before `v0.3.0` but it got altered in https://github.com/prysmaticlabs/prysm/pull/5127 to update to `v1.0.0-alpha`, this happened in April. \r\n\r\nThanks @potuz for reporting this",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/752996251/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/753003391",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/8185#issuecomment-753003391",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8185",
    "id": 753003391,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MzAwMzM5MQ==",
    "user": {
      "login": "gitcoinbot",
      "id": 27903976,
      "node_id": "MDQ6VXNlcjI3OTAzOTc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/27903976?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gitcoinbot",
      "html_url": "https://github.com/gitcoinbot",
      "followers_url": "https://api.github.com/users/gitcoinbot/followers",
      "following_url": "https://api.github.com/users/gitcoinbot/following{/other_user}",
      "gists_url": "https://api.github.com/users/gitcoinbot/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gitcoinbot/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gitcoinbot/subscriptions",
      "organizations_url": "https://api.github.com/users/gitcoinbot/orgs",
      "repos_url": "https://api.github.com/users/gitcoinbot/repos",
      "events_url": "https://api.github.com/users/gitcoinbot/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gitcoinbot/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-31T16:45:42Z",
    "updated_at": "2020-12-31T16:45:42Z",
    "author_association": "NONE",
    "body": "⚡️ A tip worth 99.00000  DAI (99.0 USD @ $1.0/DAI) has been granted to @potuz for this issue from @terencechain. ⚡️ \n\nNice work @potuz! Your tip has automatically been deposited in the ETH address we have on file.\n\n * $1000800.50 in Funded OSS Work Available at: https://gitcoin.co/explorer\n * Incentivize contributions to your repo: <a href='https://gitcoin.co/tip'>Send a Tip</a> or <a href='https://gitcoin.co/funding/new'>Fund a PR</a>\n * No Email? Get help on the <a href='https://chat.gitcoin.co/'>Gitcoin Chat</a>",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/753003391/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/753003813",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/8185#issuecomment-753003813",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8185",
    "id": 753003813,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MzAwMzgxMw==",
    "user": {
      "login": "terencechain",
      "id": 21316537,
      "node_id": "MDQ6VXNlcjIxMzE2NTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/terencechain",
      "html_url": "https://github.com/terencechain",
      "followers_url": "https://api.github.com/users/terencechain/followers",
      "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
      "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
      "organizations_url": "https://api.github.com/users/terencechain/orgs",
      "repos_url": "https://api.github.com/users/terencechain/repos",
      "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/terencechain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-31T16:48:24Z",
    "updated_at": "2020-12-31T16:48:24Z",
    "author_association": "MEMBER",
    "body": "> ⚡️ A tip worth 99.00000 DAI (99.0 USD @ $1.0/DAI) has been granted to @potuz for this issue from @terencechain. ⚡️\r\n> \r\n> Nice work @potuz! Your tip has automatically been deposited in the ETH address we have on file.\r\n> \r\n> * $1000800.50 in Funded OSS Work Available at: https://gitcoin.co/explorer\r\n> * Incentivize contributions to your repo: [Send a Tip](https://gitcoin.co/tip) or [Fund a PR](https://gitcoin.co/funding/new)\r\n> * No Email? Get help on the [Gitcoin Chat](https://chat.gitcoin.co/)\r\n\r\nThanks again @potuz. This was a great find and a great issue, therefore it should be rewarded. Sorry I wish i could give you more, this everything i had left in my to be tipped jar 😅  ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/753003813/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
