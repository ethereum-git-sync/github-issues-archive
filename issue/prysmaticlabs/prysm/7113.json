{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7113",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7113/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7113/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7113/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/7113",
  "id": 686206088,
  "node_id": "MDU6SXNzdWU2ODYyMDYwODg=",
  "number": 7113,
  "title": "Prysm crashed on local testnet",
  "user": {
    "login": "TomWang10",
    "id": 4990944,
    "node_id": "MDQ6VXNlcjQ5OTA5NDQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4990944?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/TomWang10",
    "html_url": "https://github.com/TomWang10",
    "followers_url": "https://api.github.com/users/TomWang10/followers",
    "following_url": "https://api.github.com/users/TomWang10/following{/other_user}",
    "gists_url": "https://api.github.com/users/TomWang10/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/TomWang10/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/TomWang10/subscriptions",
    "organizations_url": "https://api.github.com/users/TomWang10/orgs",
    "repos_url": "https://api.github.com/users/TomWang10/repos",
    "events_url": "https://api.github.com/users/TomWang10/events{/privacy}",
    "received_events_url": "https://api.github.com/users/TomWang10/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-08-26T10:27:20Z",
  "updated_at": "2020-08-30T15:10:55Z",
  "closed_at": "2020-08-30T15:10:47Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!--üíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé\r\n\r\nHellooo! üòÑ \r\n\r\nTo help us tend to your issue faster, please search our currently open issues before submitting a new one.\r\nExisting issues often contain information about workarounds, resolution, or progress updates.\r\n\r\nüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé-->\r\n\r\n# üêû Bug Report\r\n\r\n### Description\r\nWe ran 1000 validators in the 2.0 testnet built by ourselvesÔºåthen prysm crashed.\r\n\r\n### Has this worked before in a previous version?\r\n\r\nNot tested\r\n\r\n## üî¨ Minimal Reproduction\r\n\r\nI built a complete set of local eth1.0 and eth2.0 testnets, and used the following command to start 1000 validators:\r\n\r\n#node1\r\nbazel run //beacon-chain -- --datadir=/data/eth2/beacon-chain-data --http-web3provider=http://localhost:8545 --min-sync-peers 1 --clear-db\r\n\r\n#node2\r\nbazel run //beacon-chain -- --datadir=/data/eth2/beacon-chain-data --http-web3provider=http://localhost:8545 --min-sync-peers 1 --peer=/ip4/10.8.129.84/tcp/13000/p2p/16Uiu2HAmAiD8KqXuVyhTpXamhEmcSdgPWwPQy1bzh91sJn3GRnnt --clear-db\r\n\r\n#validator \r\nbazel run //validator -- --datadir=/data/eth2/validator-data\r\n\r\n## üî• Error\r\n\r\n<pre><code>\r\nfatal error: runtime: out of memory\r\n\r\nruntime stack:\r\nruntime.throw(0x18aea8a, 0x16)\r\n        GOROOT/src/runtime/panic.go:1116 +0x72\r\nruntime.sysMap(0xc0c4000000, 0x4000000, 0x2a0e838)\r\n        GOROOT/src/runtime/mem_linux.go:169 +0xc5\r\nruntime.(*mheap).sysAlloc(0x29f5660, 0x400000, 0xc0c3efd440, 0x7fb4ef5fdd78)\r\n        GOROOT/src/runtime/malloc.go:715 +0x1cd\r\nruntime.(*mheap).grow(0x29f5660, 0x1, 0x0)\r\n        GOROOT/src/runtime/mheap.go:1286 +0x11c\r\nruntime.(*mheap).allocSpan(0x29f5660, 0x1, 0x29e0800, 0x2a0e848, 0x45f22d)\r\n        GOROOT/src/runtime/mheap.go:1124 +0x6a0\r\nruntime.(*mheap).alloc.func1()\r\n        GOROOT/src/runtime/mheap.go:871 +0x64\r\nruntime.systemstack(0x0)\r\n        GOROOT/src/runtime/asm_amd64.s:370 +0x66\r\nruntime.mstart()\r\n        GOROOT/src/runtime/proc.go:1041\r\n\r\ngoroutine 63640 [running]:\r\nruntime.systemstack_switch()\r\n        GOROOT/src/runtime/asm_amd64.s:330 fp=0xc029f19458 sp=0xc029f19450 pc=0x4879a0\r\nruntime.(*mheap).alloc(0x29f5660, 0x1, 0x640108, 0xc0c3ee5120)\r\n        GOROOT/src/runtime/mheap.go:865 +0x81 fp=0xc029f194a8 sp=0xc029f19458 pc=0x447551\r\nruntime.(*mcentral).grow(0x2a05cb8, 0x0)\r\n        GOROOT/src/runtime/mcentral.go:255 +0x79 fp=0xc029f194e8 sp=0xc029f194a8 pc=0x439ab9\r\nruntime.(*mcentral).cacheSpan(0x2a05cb8, 0xc06f9d0ec0)\r\n        GOROOT/src/runtime/mcentral.go:106 +0x2bc fp=0xc029f19530 sp=0xc029f194e8 pc=0x4395ec\r\nruntime.(*mcache).refill(0x7fb5273227d0, 0x8)\r\n        GOROOT/src/runtime/mcache.go:138 +0x85 fp=0xc029f19550 sp=0xc029f19530 pc=0x4390d5\r\nruntime.(*mcache).nextFree(0x7fb5273227d0, 0x8, 0xc0b97bbae8, 0xc09b7beb40, 0xc0b97bb9e0)\r\n        GOROOT/src/runtime/malloc.go:868 +0x87 fp=0xc029f19588 sp=0xc029f19550 pc=0x42dce7\r\nruntime.mallocgc(0x30, 0x1707880, 0x1, 0x7fb5273227d0)\r\n        GOROOT/src/runtime/malloc.go:1036 +0x793 fp=0xc029f19628 sp=0xc029f19588 pc=0x42e623\r\nruntime.newobject(0x1707880, 0xc0000a8720)\r\n        GOROOT/src/runtime/malloc.go:1165 +0x38 fp=0xc029f19658 sp=0xc029f19628 pc=0x42ea18\r\ngithub.com/ethereum/go-ethereum/p2p/discover.(*UDPv5).newLookup(0xc0004781e0, 0x1c9d1e0, 0xc0299040c0, 0xa15157555e45d65c, 0xaa6a0d934d8b3c5a, 0x6ec27dac2207dd23, 0xa8ba54bc3c3e9d76, 0x0)\r\n        external/com_github_ethereum_go_ethereum/p2p/discover/v5_udp.go:274 +0x31 fp=0xc029f196b0 sp=0xc029f19658 pc=0xf644a1\r\ngithub.com/ethereum/go-ethereum/p2p/discover.(*UDPv5).newRandomLookup(0xc0004781e0, 0x1c9d1e0, 0xc0299040c0, 0x0)\r\n        external/com_github_ethereum_go_ethereum/p2p/discover/v5_udp.go:270 +0xa8 fp=0xc029f19728 sp=0xc029f196b0 pc=0xf64448\r\ngithub.com/ethereum/go-ethereum/p2p/discover.(*UDPv5).newRandomLookup-fm(0x1c9d1e0, 0xc0299040c0, 0x0)\r\n        external/com_github_ethereum_go_ethereum/p2p/discover/v5_udp.go:267 +0x3e fp=0xc029f19758 sp=0xc029f19728 pc=0xf6b92e\r\ngithub.com/ethereum/go-ethereum/p2p/discover.(*lookupIterator).Next(0xc029904100, 0xf)\r\n        external/com_github_ethereum_go_ethereum/p2p/discover/lookup.go:213 +0x14a fp=0xc029f19788 sp=0xc029f19758 pc=0xf583aa\r\ngithub.com/ethereum/go-ethereum/p2p/enode.ReadNodes(0x1c8bf60, 0xc029904100, 0xf, 0x1, 0x0, 0x0)\r\n        external/com_github_ethereum_go_ethereum/p2p/enode/iter.go:38 +0x404 fp=0xc029f19a58 sp=0xc029f19788 pc=0xf4bac4\r\ngithub.com/prysmaticlabs/prysm/beacon-chain/p2p.(*Service).FindPeersWithSubnet(0xc000576300, 0x1c9d2a0, 0xc0131ac5d0, 0x3f, 0xc004a7c000, 0x0, 0x0)\r\n        beacon-chain/p2p/subnets.go:35 +0x1bb fp=0xc029f19f78 sp=0xc029f19a58 pc=0x124d7fb\r\ngithub.com/prysmaticlabs/prysm/beacon-chain/sync.(*Service).subscribeAggregatorSubnet.func1(0xc0008ea600, 0x3f)\r\n        beacon-chain/sync/subscriber.go:317 +0x53 fp=0xc029f19fd0 sp=0xc029f19f78 pc=0x13547a3\r\nruntime.goexit()\r\n        GOROOT/src/runtime/asm_amd64.s:1373 +0x1 fp=0xc029f19fd8 sp=0xc029f19fd0 pc=0x489ab1\r\ncreated by github.com/prysmaticlabs/prysm/beacon-chain/sync.(*Service).subscribeAggregatorSubnet\r\n        beacon-chain/sync/subscriber.go:316 +0x323\r\n\r\ngoroutine 1 [chan receive, 525 minutes]:\r\ngithub.com/prysmaticlabs/prysm/beacon-chain/node.(*BeaconNode).Start(0xc000154840)\r\n        beacon-chain/node/node.go:269 +0x1dc\r\nmain.startNode(0xc000464980, 0xc000117600, 0x0)\r\n        beacon-chain/main.go:189 +0xc7\r\ngithub.com/urfave/cli/v2.(*App).RunContext(0xc000574c00, 0x1c9d220, 0xc000042078, 0xc00003c070, 0x7, 0x7, 0x0, 0x0)\r\n        external/com_github_urfave_cli_v2/app.go:315 +0x70b\r\ngithub.com/urfave/cli/v2.(*App).Run(...)\r\n        external/com_github_urfave_cli_v2/app.go:215\r\nmain.main()\r\n        beacon-chain/main.go:163 +0x1be\r\n\r\ngoroutine 6 [select]:\r\ngithub.com/dgraph-io/ristretto.(*defaultPolicy).processItems(0xc00013fc50)\r\n        external/com_github_dgraph_io_ristretto/policy.go:96 +0xbe\r\ncreated by github.com/dgraph-io/ristretto.newDefaultPolicy\r\n        external/com_github_dgraph_io_ristretto/policy.go:80 +0x129\r\n\r\ngoroutine 7 [select]:\r\ngithub.com/dgraph-io/ristretto.(*Cache).processItems(0xc00008cc00)\r\n        external/com_github_dgraph_io_ristretto/cache.go:314 +0xed\r\ncreated by github.com/dgraph-io/ristretto.NewCache\r\n        external/com_github_dgraph_io_ristretto/cache.go:162 +0x22d\r\n\r\ngoroutine 8 [select, 525 minutes]:\r\ngithub.com/dgraph-io/ristretto.(*defaultPolicy).processItems(0xc00017fd70)\r\n        external/com_github_dgraph_io_ristretto/policy.go:96 +0xbe\r\ncreated by github.com/dgraph-io/ristretto.newDefaultPolicy\r\n        external/com_github_dgraph_io_ristretto/policy.go:80 +0x129\r\n\r\ngoroutine 9 [select]:\r\ngithub.com/dgraph-io/ristretto.(*Cache).processItems(0xc00008cd80)\r\n        external/com_github_dgraph_io_ristretto/cache.go:314 +0xed\r\ncreated by github.com/dgraph-io/ristretto.NewCache\r\n        external/com_github_dgraph_io_ristretto/cache.go:162 +0x22d\r\n\r\ngoroutine 10 [select, 525 minutes]:\r\ngithub.com/dgraph-io/ristretto.(*defaultPolicy).processItems(0xc000283e90)\r\n        external/com_github_dgraph_io_ristretto/policy.go:96 +0xbe\r\ncreated by github.com/dgraph-io/ristretto.newDefaultPolicy\r\n        external/com_github_dgraph_io_ristretto/policy.go:80 +0x129\r\n\r\ngoroutine 11 [select]:\r\ngithub.com/dgraph-io/ristretto.(*Cache).processItems(0xc00008cf00)\r\n        external/com_github_dgraph_io_ristretto/cache.go:314 +0xed\r\ncreated by github.com/dgraph-io/ristretto.NewCache\r\n        external/com_github_dgraph_io_ristretto/cache.go:162 +0x22d\r\n\r\ngoroutine 12 [select, 480 minutes]:\r\ngithub.com/dgraph-io/ristretto.(*defaultPolicy).processItems(0xc0002d0090)\r\n        external/com_github_dgraph_io_ristretto/policy.go:96 +0xbe\r\ncreated by github.com/dgraph-io/ristretto.newDefaultPolicy\r\n        external/com_github_dgraph_io_ristretto/policy.go:80 +0x129\r\n\r\ngoroutine 13 [select]:\r\ngithub.com/dgraph-io/ristretto.(*Cache).processItems(0xc00008d080)\r\n        external/com_github_dgraph_io_ristretto/cache.go:314 +0xed\r\ncreated by github.com/dgraph-io/ristretto.NewCache\r\n        external/com_github_dgraph_io_ristretto/cache.go:162 +0x22d\r\n\r\ngoroutine 18 [select]:\r\ngithub.com/dgraph-io/ristretto.(*defaultPolicy).processItems(0xc00011c1b0)\r\n        external/com_github_dgraph_io_ristretto/policy.go:96 +0xbe\r\ncreated by github.com/dgraph-io/ristretto.newDefaultPolicy\r\n        external/com_github_dgraph_io_ristretto/policy.go:80 +0x129\r\n\r\ngoroutine 19 [runnable]:\r\ngithub.com/dgraph-io/ristretto.(*Cache).processItems(0xc000110900)\r\n        external/com_github_dgraph_io_ristretto/cache.go:314 +0xed\r\ncreated by github.com/dgraph-io/ristretto.NewCache\r\n        external/com_github_dgraph_io_ristretto/cache.go:162 +0x22d\r\n\r\n\r\n</code></pre>\r\n\r\n\r\n## üåç  Your Environment\r\n\r\n**Operating System:**\r\n\r\n<pre>\r\n  <code>\r\nOS: Linux eth2-beacon 4.19.0-6.ucloud #1 SMP Wed Feb 12 08:20:34 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux, Ubuntu 18.04.3 LTS\r\nHardware Configuration: 2core,4GB memory\r\n\r\n  </code>\r\n</pre>\r\n\r\n**What version of Prysm are you running? (Which release)**\r\n\r\n<pre>\r\n  <code>\r\nTag:399dc85737639df62f3dc2f7d95478307812440f\r\n  </code>\r\n</pre>\r\n\r\n**Anything else relevant (validator index / public key)?**\r\n\r\n",
  "closed_by": {
    "login": "terencechain",
    "id": 21316537,
    "node_id": "MDQ6VXNlcjIxMzE2NTM3",
    "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/terencechain",
    "html_url": "https://github.com/terencechain",
    "followers_url": "https://api.github.com/users/terencechain/followers",
    "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
    "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
    "organizations_url": "https://api.github.com/users/terencechain/orgs",
    "repos_url": "https://api.github.com/users/terencechain/repos",
    "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/terencechain/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7113/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7113/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/683432091",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/7113#issuecomment-683432091",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/7113",
    "id": 683432091,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzQzMjA5MQ==",
    "user": {
      "login": "terencechain",
      "id": 21316537,
      "node_id": "MDQ6VXNlcjIxMzE2NTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/terencechain",
      "html_url": "https://github.com/terencechain",
      "followers_url": "https://api.github.com/users/terencechain/followers",
      "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
      "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
      "organizations_url": "https://api.github.com/users/terencechain/orgs",
      "repos_url": "https://api.github.com/users/terencechain/repos",
      "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/terencechain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-30T15:10:47Z",
    "updated_at": "2020-08-30T15:10:55Z",
    "author_association": "MEMBER",
    "body": "It seems like your setup ran out of memory. Can you try more 8GB? ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/683432091/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
