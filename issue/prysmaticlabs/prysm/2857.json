{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/2857",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/2857/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/2857/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/2857/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/2857",
  "id": 460678407,
  "node_id": "MDU6SXNzdWU0NjA2Nzg0MDc=",
  "number": 2857,
  "title": "Fix BLS to work with uncompressed format",
  "user": {
    "login": "terencechain",
    "id": 21316537,
    "node_id": "MDQ6VXNlcjIxMzE2NTM3",
    "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/terencechain",
    "html_url": "https://github.com/terencechain",
    "followers_url": "https://api.github.com/users/terencechain/followers",
    "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
    "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
    "organizations_url": "https://api.github.com/users/terencechain/orgs",
    "repos_url": "https://api.github.com/users/terencechain/repos",
    "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/terencechain/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129907,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDc=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Help%20Wanted",
      "name": "Help Wanted",
      "color": "33aa3f",
      "default": false,
      "description": "Extra attention is needed"
    },
    {
      "id": 802129908,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDg=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Good%20First%20Issue",
      "name": "Good First Issue",
      "color": "7057ff",
      "default": false,
      "description": "Good for newcomers"
    },
    {
      "id": 1085357069,
      "node_id": "MDU6TGFiZWwxMDg1MzU3MDY5",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Priority:%20High",
      "name": "Priority: High",
      "color": "f7ea26",
      "default": false,
      "description": "High priority item"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2019-06-25T22:43:11Z",
  "updated_at": "2019-07-24T18:55:41Z",
  "closed_at": "2019-07-24T18:55:41Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "For BLS, if the uncompressed format is not compatible, it will cause an issue in [DecompressG2]( https://github.com/phoreproject/bls/blob/master/g2.go#L233)\r\nThis was reproduced by the [invalid_sig_new_deposit](https://media.githubusercontent.com/media/ethereum/eth2.0-spec-tests/master/tests/operations/deposit/deposit_minimal.yaml) deposit test, an invalid signature was in uncompressed format and `the process_deposit` function failed with:\r\n```\r\ncould not convert bytes to signature: could not unmarshal bytes into signature: unexpected compression mode\r\n```\r\n",
  "closed_by": {
    "login": "prestonvanloon",
    "id": 7246818,
    "node_id": "MDQ6VXNlcjcyNDY4MTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prestonvanloon",
    "html_url": "https://github.com/prestonvanloon",
    "followers_url": "https://api.github.com/users/prestonvanloon/followers",
    "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
    "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
    "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
    "repos_url": "https://api.github.com/users/prestonvanloon/repos",
    "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/2857/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/2857/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/513578448",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/2857#issuecomment-513578448",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/2857",
    "id": 513578448,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxMzU3ODQ0OA==",
    "user": {
      "login": "blacktemplar",
      "id": 3133334,
      "node_id": "MDQ6VXNlcjMxMzMzMzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3133334?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blacktemplar",
      "html_url": "https://github.com/blacktemplar",
      "followers_url": "https://api.github.com/users/blacktemplar/followers",
      "following_url": "https://api.github.com/users/blacktemplar/following{/other_user}",
      "gists_url": "https://api.github.com/users/blacktemplar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blacktemplar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blacktemplar/subscriptions",
      "organizations_url": "https://api.github.com/users/blacktemplar/orgs",
      "repos_url": "https://api.github.com/users/blacktemplar/repos",
      "events_url": "https://api.github.com/users/blacktemplar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blacktemplar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-07-21T18:53:51Z",
    "updated_at": "2019-07-21T21:19:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "I had a look into this issue.\r\n\r\nThe specs clearly states that only compressed format is allowed:\r\n\r\n> ...\r\n> Respecting bit ordering, `z` is decomposed as `(c_flag, b_flag, a_flag, x)`.\r\n> ...\r\n> A point in G2 is represented as a pair of 384-bit integers `(z1, z2)`. We decompose `z1` as above into `x1`, `a_flag1`, `b_flag1`, `c_flag1` and `z2` into `x2`, `a_flag2`, `b_flag2`, `c_flag2`.\r\n>\r\n>We require:\r\n>\r\n>* ...\r\n>* `c_flag1 == 1`\r\n>* ...\r\n\r\nThis basically says that the most significant bit must always be one which indicates that the format is compressed (see https://github.com/zkcrypto/pairing/tree/master/src/bls12_381#serialization)\r\n\r\nTherefore, any uncompressed signature must be treated as invalid and therefore `bls_verify` should return False.\r\n\r\nOur implementation returns an error if the signature is uncompressed. The reason why the test fails and the difference to the spec is, that in the spec there is no error thrown if the signature is invalid but the deposit is silently ignored, i.e. process_deposit returns at this point, see https://github.com/ethereum/eth2.0-specs/blob/dev/specs/core/0_beacon-chain.md#deposits.\r\n\r\nSo to strictly follow the spec the only change needed would be to return beaconState, nil instead of returning an error in the following line:\r\nhttps://github.com/prysmaticlabs/prysm/blob/4a422b13f066cbf05afec1c6eab17572d2f88a5b/beacon-chain/core/blocks/block_operations.go#L872\r\n\r\nBut maybe we want to at least log such cases?\r\n\r\nI will create a Pull Request for this (very simple) fix. If we want to do more you can suggest it there.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/513578448/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
