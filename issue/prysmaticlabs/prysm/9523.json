{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/9523",
  "id": 987535277,
  "node_id": "MDU6SXNzdWU5ODc1MzUyNzc=",
  "number": 9523,
  "title": "correctly-insert-orpahned-atts and correctly-prune-canonical-atts increases memory allocations in an extreme way.",
  "user": {
    "login": "mohamedmansour",
    "id": 68524,
    "node_id": "MDQ6VXNlcjY4NTI0",
    "avatar_url": "https://avatars.githubusercontent.com/u/68524?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mohamedmansour",
    "html_url": "https://github.com/mohamedmansour",
    "followers_url": "https://api.github.com/users/mohamedmansour/followers",
    "following_url": "https://api.github.com/users/mohamedmansour/following{/other_user}",
    "gists_url": "https://api.github.com/users/mohamedmansour/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mohamedmansour/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mohamedmansour/subscriptions",
    "organizations_url": "https://api.github.com/users/mohamedmansour/orgs",
    "repos_url": "https://api.github.com/users/mohamedmansour/repos",
    "events_url": "https://api.github.com/users/mohamedmansour/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mohamedmansour/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129904,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDQ=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Bug",
      "name": "Bug",
      "color": "ee0701",
      "default": false,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "terencechain",
    "id": 21316537,
    "node_id": "MDQ6VXNlcjIxMzE2NTM3",
    "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/terencechain",
    "html_url": "https://github.com/terencechain",
    "followers_url": "https://api.github.com/users/terencechain/followers",
    "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
    "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
    "organizations_url": "https://api.github.com/users/terencechain/orgs",
    "repos_url": "https://api.github.com/users/terencechain/repos",
    "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/terencechain/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "terencechain",
      "id": 21316537,
      "node_id": "MDQ6VXNlcjIxMzE2NTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/terencechain",
      "html_url": "https://github.com/terencechain",
      "followers_url": "https://api.github.com/users/terencechain/followers",
      "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
      "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
      "organizations_url": "https://api.github.com/users/terencechain/orgs",
      "repos_url": "https://api.github.com/users/terencechain/repos",
      "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/terencechain/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 13,
  "created_at": "2021-09-03T08:23:52Z",
  "updated_at": "2021-09-07T16:23:22Z",
  "closed_at": "2021-09-07T16:23:22Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "I have enabled these in v1.4.4:\r\n```\r\ncorrectly-insert-orphaned-atts: True\r\ncorrectly-prune-canonical-atts: True\r\n```\r\n\r\nI am seeing excessive CPU usage for beacon:\r\n![image](https://user-images.githubusercontent.com/68524/131974305-cac5f26b-7aea-40e7-aa48-4d1cc5d5f5c2.png)\r\n\r\nGolang Rate of Objects Allocated increased from 150K to 2.6M \r\n![image](https://user-images.githubusercontent.com/68524/131974376-4108a3b7-b112-405f-bb48-2e843e636d9e.png)\r\n\r\nAnd the ssz_snappy experiences some consistent failures\r\n![image](https://user-images.githubusercontent.com/68524/131974432-90f266d1-c3ed-4487-95d2-1d505f96930b.png)\r\n\r\nNothing in the log.\r\n\r\nAfter I disabled:\r\n```\r\n# correctly-insert-orphaned-atts: True\r\n# correctly-prune-canonical-atts: True\r\n```\r\n\r\nThe top graphs I shared went back to normal, no more  spikes in CPU or memory allocations\r\n",
  "closed_by": {
    "login": "mohamedmansour",
    "id": 68524,
    "node_id": "MDQ6VXNlcjY4NTI0",
    "avatar_url": "https://avatars.githubusercontent.com/u/68524?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mohamedmansour",
    "html_url": "https://github.com/mohamedmansour",
    "followers_url": "https://api.github.com/users/mohamedmansour/followers",
    "following_url": "https://api.github.com/users/mohamedmansour/following{/other_user}",
    "gists_url": "https://api.github.com/users/mohamedmansour/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mohamedmansour/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mohamedmansour/subscriptions",
    "organizations_url": "https://api.github.com/users/mohamedmansour/orgs",
    "repos_url": "https://api.github.com/users/mohamedmansour/repos",
    "events_url": "https://api.github.com/users/mohamedmansour/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mohamedmansour/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912602852",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9523#issuecomment-912602852",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523",
    "id": 912602852,
    "node_id": "IC_kwDOBvuov842ZTbk",
    "user": {
      "login": "terencechain",
      "id": 21316537,
      "node_id": "MDQ6VXNlcjIxMzE2NTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/terencechain",
      "html_url": "https://github.com/terencechain",
      "followers_url": "https://api.github.com/users/terencechain/followers",
      "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
      "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
      "organizations_url": "https://api.github.com/users/terencechain/orgs",
      "repos_url": "https://api.github.com/users/terencechain/repos",
      "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/terencechain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-03T14:59:15Z",
    "updated_at": "2021-09-03T16:36:42Z",
    "author_association": "MEMBER",
    "body": "Hi @mohamedmansour, thanks for opening this! We dont see this issue on both prater and pyrmont nodes after enabling both flags 12 hours ago. 24 hours screen shots:\r\n\r\nCan I help us narrow down:\r\n - The set of flags your nodes is running?\r\n - The count of metric `Also, curious to see this metric`\r\n - Is the node syncing? or done syncing?\r\n \r\n![Screen Shot 2021-09-03 at 7 56 40 AM](https://user-images.githubusercontent.com/21316537/132026228-afef9b46-d093-48e3-99e7-c1681b0d652b.png)\r\n![Screen Shot 2021-09-03 at 7 56 17 AM](https://user-images.githubusercontent.com/21316537/132026232-77cd5cd6-75a4-47bc-900a-120e65f4aaa8.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912602852/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912692178",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9523#issuecomment-912692178",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523",
    "id": 912692178,
    "node_id": "IC_kwDOBvuov842ZpPS",
    "user": {
      "login": "mohamedmansour",
      "id": 68524,
      "node_id": "MDQ6VXNlcjY4NTI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/68524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mohamedmansour",
      "html_url": "https://github.com/mohamedmansour",
      "followers_url": "https://api.github.com/users/mohamedmansour/followers",
      "following_url": "https://api.github.com/users/mohamedmansour/following{/other_user}",
      "gists_url": "https://api.github.com/users/mohamedmansour/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mohamedmansour/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mohamedmansour/subscriptions",
      "organizations_url": "https://api.github.com/users/mohamedmansour/orgs",
      "repos_url": "https://api.github.com/users/mohamedmansour/repos",
      "events_url": "https://api.github.com/users/mohamedmansour/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mohamedmansour/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-03T17:21:44Z",
    "updated_at": "2021-09-03T17:22:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "@terencechain I added those two parameters to beacon and the charts look like this, notice the spikes (before was previous version of prysm, then during spike and after spike is 1.4.4. The nodes were done syncing.\r\n\r\n`((process_cpu_seconds_total{job=\"$beacon_job\"} - process_cpu_seconds_total{job=\"$beacon_job\"} offset 2m) > 0)*100/120/go_maxprocs{job=\"$beacon_job\"}`\r\n![image](https://user-images.githubusercontent.com/68524/132043333-9dbca283-fbee-408a-87b5-44b819a8c298.png)\r\n\r\n`rate(go_memstats_mallocs_total[1m])`\r\n![image](https://user-images.githubusercontent.com/68524/132043378-8a63e334-1c94-4768-b8f9-fc4fca5d329f.png)\r\n\r\n`rate(go_memstats_alloc_bytes_total[1m])`\r\n![image](https://user-images.githubusercontent.com/68524/132043455-2a10e6bb-ec52-4fb9-83f0-8c9e2e6c3c5d.png)\r\n\r\n`node_memory_MemAvailable_bytes`\r\n![image](https://user-images.githubusercontent.com/68524/132043841-f306ef17-4fbf-48af-98de-1163a5fd1fe9.png)\r\n\r\n\r\n**beacon.yml**\r\n\r\n```\r\nmainnet: True\r\np2p-max-peers: 100\r\nhttp-web3provider: \"/ethereum/.ethereum/geth.ipc\"\r\nfallback-web3provider:\r\n  - https://mainnet.infura.io/v3/ID\r\n  - https://eth-mainnet.alchemyapi.io/v2/ID\r\naccept-terms-of-use: True\r\nenable-db-backup-webhook: True\r\ndb-backup-output-dir: \"/ethereum/backups\"\r\nenable-optimized-balance-update: True\r\nattestation-aggregation-force-opt-maxcover: True\r\nenable-next-slot-state-cache: True\r\n# correctly-insert-orphaned-atts: True\r\n# correctly-prune-canonical-atts: True\r\n```\r\n**validator**\r\n```\r\nweb: True\r\nmainnet: True\r\naccept-terms-of-use: True\r\nattest-timely: True\r\nenable-doppelganger: True\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912692178/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912724618",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9523#issuecomment-912724618",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523",
    "id": 912724618,
    "node_id": "IC_kwDOBvuov842ZxKK",
    "user": {
      "login": "terencechain",
      "id": 21316537,
      "node_id": "MDQ6VXNlcjIxMzE2NTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/terencechain",
      "html_url": "https://github.com/terencechain",
      "followers_url": "https://api.github.com/users/terencechain/followers",
      "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
      "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
      "organizations_url": "https://api.github.com/users/terencechain/orgs",
      "repos_url": "https://api.github.com/users/terencechain/repos",
      "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/terencechain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-03T18:19:35Z",
    "updated_at": "2021-09-03T18:19:35Z",
    "author_association": "MEMBER",
    "body": "> @terencechain I added those two parameters to beacon and the charts look like this, notice the spikes (before was previous version of prysm, then during spike and after spike is 1.4.4. The nodes were done syncing.\r\n> \r\n> `((process_cpu_seconds_total{job=\"$beacon_job\"} - process_cpu_seconds_total{job=\"$beacon_job\"} offset 2m) > 0)*100/120/go_maxprocs{job=\"$beacon_job\"}`\r\n> ![image](https://user-images.githubusercontent.com/68524/132043333-9dbca283-fbee-408a-87b5-44b819a8c298.png)\r\n> \r\n> `rate(go_memstats_mallocs_total[1m])`\r\n> ![image](https://user-images.githubusercontent.com/68524/132043378-8a63e334-1c94-4768-b8f9-fc4fca5d329f.png)\r\n> \r\n> `rate(go_memstats_alloc_bytes_total[1m])`\r\n> ![image](https://user-images.githubusercontent.com/68524/132043455-2a10e6bb-ec52-4fb9-83f0-8c9e2e6c3c5d.png)\r\n> \r\n> `node_memory_MemAvailable_bytes`\r\n> ![image](https://user-images.githubusercontent.com/68524/132043841-f306ef17-4fbf-48af-98de-1163a5fd1fe9.png)\r\n> \r\n> **beacon.yml**\r\n> \r\n> ```\r\n> mainnet: True\r\n> p2p-max-peers: 100\r\n> http-web3provider: \"/ethereum/.ethereum/geth.ipc\"\r\n> fallback-web3provider:\r\n>   - https://mainnet.infura.io/v3/ID\r\n>   - https://eth-mainnet.alchemyapi.io/v2/ID\r\n> accept-terms-of-use: True\r\n> enable-db-backup-webhook: True\r\n> db-backup-output-dir: \"/ethereum/backups\"\r\n> enable-optimized-balance-update: True\r\n> attestation-aggregation-force-opt-maxcover: True\r\n> enable-next-slot-state-cache: True\r\n> # correctly-insert-orphaned-atts: True\r\n> # correctly-prune-canonical-atts: True\r\n> ```\r\n> \r\n> **validator**\r\n> \r\n> ```\r\n> web: True\r\n> mainnet: True\r\n> accept-terms-of-use: True\r\n> attest-timely: True\r\n> enable-doppelganger: True\r\n> ```\r\n\r\nWhen you have a chance, do you mind trying each of the flag to help us pinpoint which one of the two (maybe both?) is the offender here? Thanks your help as always",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912724618/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912776074",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9523#issuecomment-912776074",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523",
    "id": 912776074,
    "node_id": "IC_kwDOBvuov842Z9uK",
    "user": {
      "login": "mohamedmansour",
      "id": 68524,
      "node_id": "MDQ6VXNlcjY4NTI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/68524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mohamedmansour",
      "html_url": "https://github.com/mohamedmansour",
      "followers_url": "https://api.github.com/users/mohamedmansour/followers",
      "following_url": "https://api.github.com/users/mohamedmansour/following{/other_user}",
      "gists_url": "https://api.github.com/users/mohamedmansour/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mohamedmansour/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mohamedmansour/subscriptions",
      "organizations_url": "https://api.github.com/users/mohamedmansour/orgs",
      "repos_url": "https://api.github.com/users/mohamedmansour/repos",
      "events_url": "https://api.github.com/users/mohamedmansour/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mohamedmansour/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-03T19:55:17Z",
    "updated_at": "2021-09-03T19:55:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "@terencechain enabled `correctly-insert-orphaned-atts: True` , will test for an hour and reach back. I am using the following grafana dashboard https://gist.github.com/mohamedmansour/116d09195f0e91aee2591d79547f7d22\r\n\r\nSo far `correctly-insert-orphaned-atts` is doing good:\r\n![image](https://user-images.githubusercontent.com/68524/132059308-d81bbc42-8777-4190-beeb-0170c764fd6c.png)\r\n\r\nThis is on mainnet.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912776074/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912776486",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9523#issuecomment-912776486",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523",
    "id": 912776486,
    "node_id": "IC_kwDOBvuov842Z90m",
    "user": {
      "login": "terencechain",
      "id": 21316537,
      "node_id": "MDQ6VXNlcjIxMzE2NTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/terencechain",
      "html_url": "https://github.com/terencechain",
      "followers_url": "https://api.github.com/users/terencechain/followers",
      "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
      "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
      "organizations_url": "https://api.github.com/users/terencechain/orgs",
      "repos_url": "https://api.github.com/users/terencechain/repos",
      "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/terencechain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-03T19:56:09Z",
    "updated_at": "2021-09-03T19:56:09Z",
    "author_association": "MEMBER",
    "body": "Thanks so much @mohamedmansour , I really appreciate you working through this with us",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912776486/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912881035",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9523#issuecomment-912881035",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523",
    "id": 912881035,
    "node_id": "IC_kwDOBvuov842aXWL",
    "user": {
      "login": "mohamedmansour",
      "id": 68524,
      "node_id": "MDQ6VXNlcjY4NTI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/68524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mohamedmansour",
      "html_url": "https://github.com/mohamedmansour",
      "followers_url": "https://api.github.com/users/mohamedmansour/followers",
      "following_url": "https://api.github.com/users/mohamedmansour/following{/other_user}",
      "gists_url": "https://api.github.com/users/mohamedmansour/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mohamedmansour/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mohamedmansour/subscriptions",
      "organizations_url": "https://api.github.com/users/mohamedmansour/orgs",
      "repos_url": "https://api.github.com/users/mohamedmansour/repos",
      "events_url": "https://api.github.com/users/mohamedmansour/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mohamedmansour/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-04T01:05:16Z",
    "updated_at": "2021-09-04T01:05:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "@terencechain  it seems `correctly-insert-orphaned-atts` is normal, when I enable just `correctly-prune-canonical-atts`, the only difference is that the CPU usage went down when `correctly-insert-orphaned-atts: False` and `correctly-insert-orphaned-atts=True`\r\n\r\n![image](https://user-images.githubusercontent.com/68524/132077343-ceb1d272-7673-4c86-8f45-5e45b7ce9ad9.png)\r\n\r\nI will try with both of them on now. Will report back in few hours.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912881035/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912898716",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9523#issuecomment-912898716",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523",
    "id": 912898716,
    "node_id": "IC_kwDOBvuov842abqc",
    "user": {
      "login": "mohamedmansour",
      "id": 68524,
      "node_id": "MDQ6VXNlcjY4NTI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/68524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mohamedmansour",
      "html_url": "https://github.com/mohamedmansour",
      "followers_url": "https://api.github.com/users/mohamedmansour/followers",
      "following_url": "https://api.github.com/users/mohamedmansour/following{/other_user}",
      "gists_url": "https://api.github.com/users/mohamedmansour/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mohamedmansour/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mohamedmansour/subscriptions",
      "organizations_url": "https://api.github.com/users/mohamedmansour/orgs",
      "repos_url": "https://api.github.com/users/mohamedmansour/repos",
      "events_url": "https://api.github.com/users/mohamedmansour/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mohamedmansour/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-04T03:18:57Z",
    "updated_at": "2021-09-04T03:23:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "So I can't reproduce the issue. The issue seems gone, and we cannot be certain it is these flags that is causing the issue. The server only has prysm installed, so after I found the anomalies, after the restart of beacon, it seems to go back to normal\r\n\r\n7 day range in grafana:\r\n\r\n![image](https://user-images.githubusercontent.com/68524/132080738-5393f2de-5538-4335-bb47-eef04a626428.png)\r\n\r\nWhen the issues happened the expired expectations graph increased a lot too:\r\n`avg(increase(expired_aggregated_atts_total[1h]))`\r\n![image](https://user-images.githubusercontent.com/68524/132080826-8a793741-fc6d-4839-9adf-4e07304f9c64.png)\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912898716/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912899306",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9523#issuecomment-912899306",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523",
    "id": 912899306,
    "node_id": "IC_kwDOBvuov842abzq",
    "user": {
      "login": "terencechain",
      "id": 21316537,
      "node_id": "MDQ6VXNlcjIxMzE2NTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/terencechain",
      "html_url": "https://github.com/terencechain",
      "followers_url": "https://api.github.com/users/terencechain/followers",
      "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
      "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
      "organizations_url": "https://api.github.com/users/terencechain/orgs",
      "repos_url": "https://api.github.com/users/terencechain/repos",
      "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/terencechain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-04T03:23:56Z",
    "updated_at": "2021-09-04T03:23:56Z",
    "author_association": "MEMBER",
    "body": "Thanks for the update! Let's keep monitoring this. Please ping us if you see anything. Thanks again for all the detailed testing \r\n\r\nre: expired expectation, good clue, ill look into this",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912899306/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912899613",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9523#issuecomment-912899613",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523",
    "id": 912899613,
    "node_id": "IC_kwDOBvuov842ab4d",
    "user": {
      "login": "terencechain",
      "id": 21316537,
      "node_id": "MDQ6VXNlcjIxMzE2NTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/terencechain",
      "html_url": "https://github.com/terencechain",
      "followers_url": "https://api.github.com/users/terencechain/followers",
      "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
      "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
      "organizations_url": "https://api.github.com/users/terencechain/orgs",
      "repos_url": "https://api.github.com/users/terencechain/repos",
      "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/terencechain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-04T03:27:40Z",
    "updated_at": "2021-09-04T03:27:40Z",
    "author_association": "MEMBER",
    "body": "These two metrics will provide more insights: `saved_orphaned_att_total`, `beacon_reorg_total`\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912899613/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912899672",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9523#issuecomment-912899672",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523",
    "id": 912899672,
    "node_id": "IC_kwDOBvuov842ab5Y",
    "user": {
      "login": "mohamedmansour",
      "id": 68524,
      "node_id": "MDQ6VXNlcjY4NTI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/68524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mohamedmansour",
      "html_url": "https://github.com/mohamedmansour",
      "followers_url": "https://api.github.com/users/mohamedmansour/followers",
      "following_url": "https://api.github.com/users/mohamedmansour/following{/other_user}",
      "gists_url": "https://api.github.com/users/mohamedmansour/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mohamedmansour/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mohamedmansour/subscriptions",
      "organizations_url": "https://api.github.com/users/mohamedmansour/orgs",
      "repos_url": "https://api.github.com/users/mohamedmansour/repos",
      "events_url": "https://api.github.com/users/mohamedmansour/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mohamedmansour/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-04T03:28:08Z",
    "updated_at": "2021-09-04T03:28:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "@terencechain is there a way to verify if I have the flags on runtime?",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912899672/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912900090",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9523#issuecomment-912900090",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523",
    "id": 912900090,
    "node_id": "IC_kwDOBvuov842ab_6",
    "user": {
      "login": "terencechain",
      "id": 21316537,
      "node_id": "MDQ6VXNlcjIxMzE2NTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/terencechain",
      "html_url": "https://github.com/terencechain",
      "followers_url": "https://api.github.com/users/terencechain/followers",
      "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
      "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
      "organizations_url": "https://api.github.com/users/terencechain/orgs",
      "repos_url": "https://api.github.com/users/terencechain/repos",
      "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/terencechain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-04T03:33:40Z",
    "updated_at": "2021-09-04T03:33:40Z",
    "author_association": "MEMBER",
    "body": "> @terencechain is there a way to verify if I have the flags on runtime?\r\n\r\nIf `saved_orphaned_att_total` is > 0 then you have `correctly-insert-orphaned-atts` on\r\n\r\nNot much else you can do besides looking at the startup log :(.  (this is a good feature request though)",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/912900090/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/914447198",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9523#issuecomment-914447198",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523",
    "id": 914447198,
    "node_id": "IC_kwDOBvuov842gVte",
    "user": {
      "login": "mohamedmansour",
      "id": 68524,
      "node_id": "MDQ6VXNlcjY4NTI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/68524?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mohamedmansour",
      "html_url": "https://github.com/mohamedmansour",
      "followers_url": "https://api.github.com/users/mohamedmansour/followers",
      "following_url": "https://api.github.com/users/mohamedmansour/following{/other_user}",
      "gists_url": "https://api.github.com/users/mohamedmansour/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mohamedmansour/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mohamedmansour/subscriptions",
      "organizations_url": "https://api.github.com/users/mohamedmansour/orgs",
      "repos_url": "https://api.github.com/users/mohamedmansour/repos",
      "events_url": "https://api.github.com/users/mohamedmansour/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mohamedmansour/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-07T16:22:15Z",
    "updated_at": "2021-09-07T16:23:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "Still seems normal while both settings are on for past 7 days. The consistent spike didn't happen again, seemed it only happen on the time of upgrade and recovered after restart.\r\n![image](https://user-images.githubusercontent.com/68524/132378726-bec50324-2c23-46ea-a24a-b1389afbff4b.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/914447198/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/914447813",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9523#issuecomment-914447813",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9523",
    "id": 914447813,
    "node_id": "IC_kwDOBvuov842gV3F",
    "user": {
      "login": "terencechain",
      "id": 21316537,
      "node_id": "MDQ6VXNlcjIxMzE2NTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/terencechain",
      "html_url": "https://github.com/terencechain",
      "followers_url": "https://api.github.com/users/terencechain/followers",
      "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
      "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
      "organizations_url": "https://api.github.com/users/terencechain/orgs",
      "repos_url": "https://api.github.com/users/terencechain/repos",
      "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/terencechain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-07T16:23:10Z",
    "updated_at": "2021-09-07T16:23:10Z",
    "author_association": "MEMBER",
    "body": "> Still seems normal while both settings are on for past 4 days\r\n> ![image](https://user-images.githubusercontent.com/68524/132378726-bec50324-2c23-46ea-a24a-b1389afbff4b.png)\r\n\r\nThanks for the update!",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/914447813/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
