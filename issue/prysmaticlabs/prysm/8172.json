{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8172",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8172/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8172/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8172/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/8172",
  "id": 773076390,
  "node_id": "MDU6SXNzdWU3NzMwNzYzOTA=",
  "number": 8172,
  "title": "Incorrect banning of peer on custom testnet",
  "user": {
    "login": "parithosh",
    "id": 17509050,
    "node_id": "MDQ6VXNlcjE3NTA5MDUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/17509050?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/parithosh",
    "html_url": "https://github.com/parithosh",
    "followers_url": "https://api.github.com/users/parithosh/followers",
    "following_url": "https://api.github.com/users/parithosh/following{/other_user}",
    "gists_url": "https://api.github.com/users/parithosh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/parithosh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/parithosh/subscriptions",
    "organizations_url": "https://api.github.com/users/parithosh/orgs",
    "repos_url": "https://api.github.com/users/parithosh/repos",
    "events_url": "https://api.github.com/users/parithosh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/parithosh/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129904,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDQ=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Bug",
      "name": "Bug",
      "color": "ee0701",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1500585773,
      "node_id": "MDU6TGFiZWwxNTAwNTg1Nzcz",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Networking",
      "name": "Networking",
      "color": "c7a5f7",
      "default": false,
      "description": "P2P related items"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2020-12-22T16:26:54Z",
  "updated_at": "2021-01-18T12:53:54Z",
  "closed_at": "2021-01-18T12:53:54Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "# üêû Bug Report\r\n\r\n### Description\r\n\r\nPrysm client bans other clients in the custom testnet incorrectly. Shortly after banning, the Prysm client looses all peers on custom testnet. Essentially, two nodes with identitical setup and config are banning each other and then loosing all their peers slowly.\r\n\r\n## üî¨ Minimal Reproduction\r\n\r\n<!--\r\nPlease let us know how we can reproduce this issue. Include the exact method you used to run Prysm along with any flags used in your beacon chain and/or validator. Make sure you don't upload any confidential files or private keys.\r\n-->\r\n\r\n1. Run custom testnet with this genesis config: https://gist.github.com/parithosh/72b32ae41b0e016a6b546764754fc0be\r\n2. Start 2 Prysm beacon nodes with:\r\n```  \r\n--chain-config-file=/PATH/custom_testnet_config/prysm_config.yaml --deposit-contract=\"0x84F345c9D796150d515521Df25645f3B1327eDA7\" --contract-deployment-block=\"3903529\" --http-web3provider=<GOERLI RPC ENDPOINT>\" --p2p-host-ip=<PUBLIC IP> --bootstrap-node=\"enr:-Ku4QCP_MwhNN8EBistazkVY4AnIG2Cx5Hnw0QXt53bIECB7N9CgUnfEfDVcau4UlKbDd8uS8ZrgoGq-g6FuGmdyhycBh2F0dG5ldHOIAAAAAAAAAACEZXRoMpAGiHTPiYmJif__________gmlkgnY0gmlwhBK8Xq-Jc2VjcDI1NmsxoQKM-X_EGDB4HLPrJmelJEWB2l92lvbcBq7CYOVXRawg0IN1ZHCCIyg\"\r\n```\r\n3. Observe the number of peers, initially the node should have a large number of peers. As time goes on, it will loose peers. \r\n\r\n\r\n## üî• Error\r\n\r\nLogs from Prysm node 1: `time=\"2020-12-22 14:13:36\" level=debug msg=\"Sending Goodbye message to peer\" Reason=\"client banned this node\" peer=16Uiu2HAmMA3ssu2pxRSqqNPCNFDArHXrYcPZ9zbp231dT62XxkCs prefix=sync`\r\n\r\nThe peer ID `16Uiu2HAmMA3ssu2pxRSqqNPCNFDArHXrYcPZ9zbp231dT62XxkCs` refers to the Prysm node 2 (Obtained by SSH-ing into the node 2 and running `curl localhost:8080/p2p`)\r\n\r\n\r\n## üåç  Your Environment\r\n\r\n**Operating System:**\r\nUbuntu \r\n\r\n**What version of Prysm are you running? (Which release)**\r\nPrysm running in a docker container (prysmaticlabs/prysm-beacon-chain:latest) with image ID: `eb792117754b`. Can be pulled with: `prysmaticlabs/prysm-beacon-chain@sha256:bb445a703c4632e018c6db92f81dd09178791f832346d89c4d5128d4cb5fb704`\r\n\r\n\r\n\r\n",
  "closed_by": {
    "login": "parithosh",
    "id": 17509050,
    "node_id": "MDQ6VXNlcjE3NTA5MDUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/17509050?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/parithosh",
    "html_url": "https://github.com/parithosh",
    "followers_url": "https://api.github.com/users/parithosh/followers",
    "following_url": "https://api.github.com/users/parithosh/following{/other_user}",
    "gists_url": "https://api.github.com/users/parithosh/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/parithosh/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/parithosh/subscriptions",
    "organizations_url": "https://api.github.com/users/parithosh/orgs",
    "repos_url": "https://api.github.com/users/parithosh/repos",
    "events_url": "https://api.github.com/users/parithosh/events{/privacy}",
    "received_events_url": "https://api.github.com/users/parithosh/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8172/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8172/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/753815113",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/8172#issuecomment-753815113",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8172",
    "id": 753815113,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MzgxNTExMw==",
    "user": {
      "login": "nisdas",
      "id": 33201827,
      "node_id": "MDQ6VXNlcjMzMjAxODI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/33201827?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nisdas",
      "html_url": "https://github.com/nisdas",
      "followers_url": "https://api.github.com/users/nisdas/followers",
      "following_url": "https://api.github.com/users/nisdas/following{/other_user}",
      "gists_url": "https://api.github.com/users/nisdas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nisdas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nisdas/subscriptions",
      "organizations_url": "https://api.github.com/users/nisdas/orgs",
      "repos_url": "https://api.github.com/users/nisdas/repos",
      "events_url": "https://api.github.com/users/nisdas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nisdas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-04T07:47:11Z",
    "updated_at": "2021-01-04T07:47:11Z",
    "author_association": "MEMBER",
    "body": "Hey @parithosh , thanks for the report. Had a few questions:  \r\n- Were all these peers on the same network interface ?\r\n- How many peers were you running with before a Prysm node just started banning everyone ? \r\n- Is this reproducible with only 2 peers in your test network ?",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/753815113/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/756261933",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/8172#issuecomment-756261933",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8172",
    "id": 756261933,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NjI2MTkzMw==",
    "user": {
      "login": "parithosh",
      "id": 17509050,
      "node_id": "MDQ6VXNlcjE3NTA5MDUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/17509050?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/parithosh",
      "html_url": "https://github.com/parithosh",
      "followers_url": "https://api.github.com/users/parithosh/followers",
      "following_url": "https://api.github.com/users/parithosh/following{/other_user}",
      "gists_url": "https://api.github.com/users/parithosh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/parithosh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/parithosh/subscriptions",
      "organizations_url": "https://api.github.com/users/parithosh/orgs",
      "repos_url": "https://api.github.com/users/parithosh/repos",
      "events_url": "https://api.github.com/users/parithosh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/parithosh/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-07T17:28:42Z",
    "updated_at": "2021-01-07T17:28:42Z",
    "author_association": "NONE",
    "body": "@nisdas thanks for picking it up! \r\n\r\n- Each peer was on its own AWS instance, so no shared NICs\r\n- The total custom net had 10 peers running before a Prysm node started banning\r\n- No, this was reproducible with more than 2 peers",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/756261933/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/757888457",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/8172#issuecomment-757888457",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8172",
    "id": 757888457,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1Nzg4ODQ1Nw==",
    "user": {
      "login": "nisdas",
      "id": 33201827,
      "node_id": "MDQ6VXNlcjMzMjAxODI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/33201827?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nisdas",
      "html_url": "https://github.com/nisdas",
      "followers_url": "https://api.github.com/users/nisdas/followers",
      "following_url": "https://api.github.com/users/nisdas/following{/other_user}",
      "gists_url": "https://api.github.com/users/nisdas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nisdas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nisdas/subscriptions",
      "organizations_url": "https://api.github.com/users/nisdas/orgs",
      "repos_url": "https://api.github.com/users/nisdas/repos",
      "events_url": "https://api.github.com/users/nisdas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nisdas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-11T11:23:48Z",
    "updated_at": "2021-01-11T11:23:48Z",
    "author_association": "MEMBER",
    "body": "I tried running the steps to reproduce, but it seems like your bootnode might be down. In your VPC , do all peers share the same public ip ? Or is each instance allocated with a separate public ip",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/757888457/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/762232637",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/8172#issuecomment-762232637",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8172",
    "id": 762232637,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MjIzMjYzNw==",
    "user": {
      "login": "parithosh",
      "id": 17509050,
      "node_id": "MDQ6VXNlcjE3NTA5MDUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/17509050?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/parithosh",
      "html_url": "https://github.com/parithosh",
      "followers_url": "https://api.github.com/users/parithosh/followers",
      "following_url": "https://api.github.com/users/parithosh/following{/other_user}",
      "gists_url": "https://api.github.com/users/parithosh/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/parithosh/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/parithosh/subscriptions",
      "organizations_url": "https://api.github.com/users/parithosh/orgs",
      "repos_url": "https://api.github.com/users/parithosh/repos",
      "events_url": "https://api.github.com/users/parithosh/events{/privacy}",
      "received_events_url": "https://api.github.com/users/parithosh/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-18T12:53:48Z",
    "updated_at": "2021-01-18T12:53:48Z",
    "author_association": "NONE",
    "body": "I tried recreating it myself with the same config and I'm not able to reproduce it either. Perhaps it did have to do with the bootnodes. I'll give it another shot and report back with more concrete steps. Thanks for your help!\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/762232637/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
