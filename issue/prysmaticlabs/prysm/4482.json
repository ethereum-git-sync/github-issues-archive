{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4482",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4482/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4482/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4482/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/4482",
  "id": 548247878,
  "node_id": "MDU6SXNzdWU1NDgyNDc4Nzg=",
  "number": 4482,
  "title": "Beacon Node Stuck in Sync",
  "user": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129904,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDQ=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Bug",
      "name": "Bug",
      "color": "ee0701",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 934596141,
      "node_id": "MDU6TGFiZWw5MzQ1OTYxNDE=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Discussion",
      "name": "Discussion",
      "color": "f9d0c4",
      "default": false,
      "description": "Simply a thread for talking about stuff"
    },
    {
      "id": 1085357069,
      "node_id": "MDU6TGFiZWwxMDg1MzU3MDY5",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Priority:%20High",
      "name": "Priority: High",
      "color": "f7ea26",
      "default": false,
      "description": "High priority item"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2020-01-10T19:22:18Z",
  "updated_at": "2020-01-16T01:46:16Z",
  "closed_at": "2020-01-16T01:46:16Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Our beacon nodes frequently get stuck when syncing with the testnet from blocks `217 - 256`. The node endlessly requests that range of blocks and never seems to move past it, while CPU usage is close to 100%. @nisdas hypothesized there is some issue with bolt being resource constrained while in a docker environment due to how it does MMAP system calls and how it allocates data. Changing `boltDB.AllocSize = 8 * 1024 * 1024` and clearing a node DB fixed the issue for me locally and was able to sync. We believe this is related to the root cause of what triggered #4476.",
  "closed_by": {
    "login": "prylabs-bulldozer[bot]",
    "id": 58059840,
    "node_id": "MDM6Qm90NTgwNTk4NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/in/47372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D",
    "html_url": "https://github.com/apps/prylabs-bulldozer",
    "followers_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4482/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4482/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/573265350",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4482#issuecomment-573265350",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4482",
    "id": 573265350,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MzI2NTM1MA==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-11T01:28:29Z",
    "updated_at": "2020-01-11T01:28:29Z",
    "author_association": "MEMBER",
    "body": "This is still reproducible after #4485 :(  ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/573265350/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/573265524",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4482#issuecomment-573265524",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4482",
    "id": 573265524,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MzI2NTUyNA==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-11T01:30:00Z",
    "updated_at": "2020-01-11T01:30:00Z",
    "author_association": "MEMBER",
    "body": "Example logs\r\n```\r\n[2020-01-10 12:14:54]  INFO initial-sync: Processing block 504/3674 - estimated time remaining 3s blocksPerSecond=880.7 peers=8/12\r\n[2020-01-10 12:14:54]  INFO initial-sync: Processing block 505/3674 - estimated time remaining 3s blocksPerSecond=880.8 peers=8/12\r\n[2020-01-10 12:14:54]  INFO initial-sync: Processing block 506/3674 - estimated time remaining 3s blocksPerSecond=880.8 peers=8/12\r\n[2020-01-10 12:14:54]  INFO initial-sync: Processing block 507/3674 - estimated time remaining 3s blocksPerSecond=880.9 peers=8/12\r\n[2020-01-10 12:14:54]  INFO initial-sync: Processing block 508/3674 - estimated time remaining 3s blocksPerSecond=880.9 peers=8/12\r\n[2020-01-10 12:14:54]  INFO initial-sync: Processing block 509/3674 - estimated time remaining 3s blocksPerSecond=881.0 peers=8/12\r\n[2020-01-10 12:14:54]  INFO initial-sync: Processing block 510/3674 - estimated time remaining 3s blocksPerSecond=881.0 peers=8/12\r\n[2020-01-10 12:14:54]  INFO initial-sync: Processing block 511/3674 - estimated time remaining 3s blocksPerSecond=881.0 peers=8/12\r\n[2020-01-10 12:14:54]  INFO initial-sync: Processing block 512/3674 - estimated time remaining 3s blocksPerSecond=881.1 peers=8/12\r\n```\r\n\r\n![Annotation_2020-01-10_095636](https://user-images.githubusercontent.com/7246818/72196658-d18a4200-33ce-11ea-81dd-fe14d497c185.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/573265524/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/573266073",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4482#issuecomment-573266073",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4482",
    "id": 573266073,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MzI2NjA3Mw==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-11T01:34:38Z",
    "updated_at": "2020-01-11T01:34:38Z",
    "author_association": "MEMBER",
    "body": "What can't be seen in the logs above are at DEBUG level. If a block can't be processed because it's parent is not in the DB, that block is skipped and we move onto the next one. If we failed to process all of the blocks, we query peers again and start over.\r\n\r\nOne of our current theories right now are that Prysm is somehow generating a genesis block with the wrong state root. From what we noticed, the genesis state in all nodes is correct, but blocks fail to process due to an invalid genesis block. In fact, this is what stalled the start of the testnet yesterday. \r\n\r\nWe have also observed that this incident is less likely to occur in a less constrained environment, i.e. not running in docker. If you can, run from bazel. Although we run docker containers for our own nodes, we have not experienced this issue since we wiped databases yesterday after testnet genesis. ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/573266073/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/573404766",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4482#issuecomment-573404766",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4482",
    "id": 573404766,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3MzQwNDc2Ng==",
    "user": {
      "login": "torfbolt",
      "id": 233423,
      "node_id": "MDQ6VXNlcjIzMzQyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/233423?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/torfbolt",
      "html_url": "https://github.com/torfbolt",
      "followers_url": "https://api.github.com/users/torfbolt/followers",
      "following_url": "https://api.github.com/users/torfbolt/following{/other_user}",
      "gists_url": "https://api.github.com/users/torfbolt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/torfbolt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/torfbolt/subscriptions",
      "organizations_url": "https://api.github.com/users/torfbolt/orgs",
      "repos_url": "https://api.github.com/users/torfbolt/repos",
      "events_url": "https://api.github.com/users/torfbolt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/torfbolt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-12T11:15:38Z",
    "updated_at": "2020-01-12T11:17:34Z",
    "author_association": "NONE",
    "body": "Can confirm, whenever I start the client it gets stuck trying to sync the same ~100 blocks over and over.\r\n\r\nRarely it succeeds with a block range and then gets immediately stuck again with the next couple of blocks. So for me this bug makes it impossible to run the beacon client.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/573404766/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/573760398",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/4482#issuecomment-573760398",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/4482",
    "id": 573760398,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU3Mzc2MDM5OA==",
    "user": {
      "login": "Domintek",
      "id": 26261012,
      "node_id": "MDQ6VXNlcjI2MjYxMDEy",
      "avatar_url": "https://avatars.githubusercontent.com/u/26261012?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Domintek",
      "html_url": "https://github.com/Domintek",
      "followers_url": "https://api.github.com/users/Domintek/followers",
      "following_url": "https://api.github.com/users/Domintek/following{/other_user}",
      "gists_url": "https://api.github.com/users/Domintek/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Domintek/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Domintek/subscriptions",
      "organizations_url": "https://api.github.com/users/Domintek/orgs",
      "repos_url": "https://api.github.com/users/Domintek/repos",
      "events_url": "https://api.github.com/users/Domintek/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Domintek/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-01-13T16:50:22Z",
    "updated_at": "2020-01-13T16:50:22Z",
    "author_association": "NONE",
    "body": "I can also confirm that the client gets stuck trying to sync the same blocks between 217 and 256. I am running in docker and unable to use bazel. I have repeated this scenario multiple times over the last three days with no change. Suggestions?",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/573760398/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
