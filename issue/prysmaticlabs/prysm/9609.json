{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9609",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9609/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9609/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9609/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/9609",
  "id": 998198255,
  "node_id": "I_kwDOBvuov847f0vv",
  "number": 9609,
  "title": "headerCache miss in BlockByTimeStamp() ",
  "user": {
    "login": "jmozah",
    "id": 940575,
    "node_id": "MDQ6VXNlcjk0MDU3NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/940575?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jmozah",
    "html_url": "https://github.com/jmozah",
    "followers_url": "https://api.github.com/users/jmozah/followers",
    "following_url": "https://api.github.com/users/jmozah/following{/other_user}",
    "gists_url": "https://api.github.com/users/jmozah/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jmozah/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jmozah/subscriptions",
    "organizations_url": "https://api.github.com/users/jmozah/orgs",
    "repos_url": "https://api.github.com/users/jmozah/repos",
    "events_url": "https://api.github.com/users/jmozah/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jmozah/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "jmozah",
    "id": 940575,
    "node_id": "MDQ6VXNlcjk0MDU3NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/940575?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jmozah",
    "html_url": "https://github.com/jmozah",
    "followers_url": "https://api.github.com/users/jmozah/followers",
    "following_url": "https://api.github.com/users/jmozah/following{/other_user}",
    "gists_url": "https://api.github.com/users/jmozah/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jmozah/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jmozah/subscriptions",
    "organizations_url": "https://api.github.com/users/jmozah/orgs",
    "repos_url": "https://api.github.com/users/jmozah/repos",
    "events_url": "https://api.github.com/users/jmozah/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jmozah/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "jmozah",
      "id": 940575,
      "node_id": "MDQ6VXNlcjk0MDU3NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/940575?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jmozah",
      "html_url": "https://github.com/jmozah",
      "followers_url": "https://api.github.com/users/jmozah/followers",
      "following_url": "https://api.github.com/users/jmozah/following{/other_user}",
      "gists_url": "https://api.github.com/users/jmozah/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jmozah/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jmozah/subscriptions",
      "organizations_url": "https://api.github.com/users/jmozah/orgs",
      "repos_url": "https://api.github.com/users/jmozah/repos",
      "events_url": "https://api.github.com/users/jmozah/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jmozah/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-09-16T13:11:49Z",
  "updated_at": "2021-11-01T05:19:35Z",
  "closed_at": "2021-11-01T05:19:35Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# ðŸ’Ž Issue\r\n\r\n### Background\r\n\r\nAs part of debug session for the `GetBlock()` optimisation, this issue was found and needs to be looked in to.\r\n\r\n### Description\r\n\r\n**GetBlock() -> eth1DataMajorityVote() -> BlockByTimeStamp()**\r\n\r\n- **BlockByTimeStamp()**: This is a search function which tries to minimize the access rate by using a header cache during normal operation. This function somehow misses the headerCache and proceeds to fetch the header from the eth1POW chain (external call) which is inside the search iteration. Even if the call takes 200ms every time, it adds up and crosses a second easily.\r\n- **scenario 1**\r\n![](https://i.imgur.com/2h0GSTG.png)\r\n- **scenario 2**\r\n![](https://i.imgur.com/wn8ShPa.png)\r\n\r\n",
  "closed_by": {
    "login": "jmozah",
    "id": 940575,
    "node_id": "MDQ6VXNlcjk0MDU3NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/940575?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jmozah",
    "html_url": "https://github.com/jmozah",
    "followers_url": "https://api.github.com/users/jmozah/followers",
    "following_url": "https://api.github.com/users/jmozah/following{/other_user}",
    "gists_url": "https://api.github.com/users/jmozah/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jmozah/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jmozah/subscriptions",
    "organizations_url": "https://api.github.com/users/jmozah/orgs",
    "repos_url": "https://api.github.com/users/jmozah/repos",
    "events_url": "https://api.github.com/users/jmozah/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jmozah/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9609/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9609/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/954724421",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9609#issuecomment-954724421",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9609",
    "id": 954724421,
    "node_id": "IC_kwDOBvuov8445_BF",
    "user": {
      "login": "jmozah",
      "id": 940575,
      "node_id": "MDQ6VXNlcjk0MDU3NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/940575?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jmozah",
      "html_url": "https://github.com/jmozah",
      "followers_url": "https://api.github.com/users/jmozah/followers",
      "following_url": "https://api.github.com/users/jmozah/following{/other_user}",
      "gists_url": "https://api.github.com/users/jmozah/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jmozah/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jmozah/subscriptions",
      "organizations_url": "https://api.github.com/users/jmozah/orgs",
      "repos_url": "https://api.github.com/users/jmozah/repos",
      "events_url": "https://api.github.com/users/jmozah/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jmozah/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-29T13:00:34Z",
    "updated_at": "2021-10-29T13:00:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "Summary: After running some experimentation i have come to a conclusion that this will not be a issue during normal block proposals. Spoke about this with @nisdas and he thinks the same too. Some explanations below \r\n\r\n\r\n- This version was modified such that `GetBlock()` will be called as soon the validator calls `WaitForActivation`. This is to monitor the performance of `GetBlock()` function as a whole and find issues.\r\n\r\n- During Start() of the POWService, Eth1BlockHeaders are loaded in the header cache from the previous Eth1 voting period start to the present. This is done in parallel while other services are running.\r\n\r\n- Because of how `GetBlock()` is called, sometimes `BlockByTimeStamp()` is called even before the cache is loaded. So  we saw few header cache misses in the beginning. Also depending upon the machine spec, this initial duration would last few seconds (our setup shows 15 seconds).\r\n\r\n- Once the caches are hot, the misses are virtually not existant even in a longer duration test which spanned more than 3 Eth1VotingPeriod.\r\n\r\nSo i am in recommendation of closing this issue as we wiil have very few probability to propose blocks in the first few seconds of starting the beacon node. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/954724421/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
