{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5372",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5372/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5372/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5372/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/5372",
  "id": 597632644,
  "node_id": "MDU6SXNzdWU1OTc2MzI2NDQ=",
  "number": 5372,
  "title": "Handshake protocol: cannot decode stage 1/2 MessageBuffer: length less than 96 bytes",
  "user": {
    "login": "prestonvanloon",
    "id": 7246818,
    "node_id": "MDQ6VXNlcjcyNDY4MTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prestonvanloon",
    "html_url": "https://github.com/prestonvanloon",
    "followers_url": "https://api.github.com/users/prestonvanloon/followers",
    "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
    "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
    "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
    "repos_url": "https://api.github.com/users/prestonvanloon/repos",
    "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129904,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDQ=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Bug",
      "name": "Bug",
      "color": "ee0701",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 1028320582,
      "node_id": "MDU6TGFiZWwxMDI4MzIwNTgy",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Blocked",
      "name": "Blocked",
      "color": "f3761b",
      "default": false,
      "description": "Blocked by research or external factors"
    },
    {
      "id": 1085357069,
      "node_id": "MDU6TGFiZWwxMDg1MzU3MDY5",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Priority:%20High",
      "name": "Priority: High",
      "color": "f7ea26",
      "default": false,
      "description": "High priority item"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "nisdas",
    "id": 33201827,
    "node_id": "MDQ6VXNlcjMzMjAxODI3",
    "avatar_url": "https://avatars.githubusercontent.com/u/33201827?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nisdas",
    "html_url": "https://github.com/nisdas",
    "followers_url": "https://api.github.com/users/nisdas/followers",
    "following_url": "https://api.github.com/users/nisdas/following{/other_user}",
    "gists_url": "https://api.github.com/users/nisdas/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nisdas/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nisdas/subscriptions",
    "organizations_url": "https://api.github.com/users/nisdas/orgs",
    "repos_url": "https://api.github.com/users/nisdas/repos",
    "events_url": "https://api.github.com/users/nisdas/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nisdas/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "nisdas",
      "id": 33201827,
      "node_id": "MDQ6VXNlcjMzMjAxODI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/33201827?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nisdas",
      "html_url": "https://github.com/nisdas",
      "followers_url": "https://api.github.com/users/nisdas/followers",
      "following_url": "https://api.github.com/users/nisdas/following{/other_user}",
      "gists_url": "https://api.github.com/users/nisdas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nisdas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nisdas/subscriptions",
      "organizations_url": "https://api.github.com/users/nisdas/orgs",
      "repos_url": "https://api.github.com/users/nisdas/repos",
      "events_url": "https://api.github.com/users/nisdas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nisdas/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/milestones/9",
    "html_url": "https://github.com/prysmaticlabs/prysm/milestone/9",
    "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/milestones/9/labels",
    "id": 5304199,
    "node_id": "MDk6TWlsZXN0b25lNTMwNDE5OQ==",
    "number": 9,
    "title": "Multiclient Readiness",
    "description": "All tracking issues to be fully aligned for multiclient interoperability",
    "creator": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "open_issues": 0,
    "closed_issues": 8,
    "state": "closed",
    "created_at": "2020-04-13T18:01:14Z",
    "updated_at": "2020-10-06T17:15:25Z",
    "due_on": null,
    "closed_at": "2020-10-06T17:15:25Z"
  },
  "comments": 8,
  "created_at": "2020-04-10T00:48:39Z",
  "updated_at": "2020-06-01T21:56:28Z",
  "closed_at": "2020-06-01T21:56:28Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "Observed in internal testnet today. Affected node cannot peer with other nodes.\r\n\r\n```\r\n{\"activePeers\":0,\"direction\":2,\"error\":\"failed to dial : all dials failed\\n  * [/ip4/10.0.5.181/tcp/5000] failed to negotiate security protocol: runHandshake initiator stage 1 fail: recvHandshakeMessage decode\r\nmsg err=cannot decode stage 1/2 MessageBuffer: length less than 96 bytes\",\"message\":\"Handshake failed\",\"multiAddr\":\"/ip4/10.0.5.181/tcp/5000/p2p/16Uiu2HAmGBHq5gWCBkwR2v2cBni45TUzk6TSuBP6darEPEbgKbUb\",\"peer\":\"16Uiu2HAmGBHq5gWCBkwR2v2cBni45TUzk6TSuBP6darEPEbgKbUb\",\"prefix\":\"p2p\",\"severity\":\"DEBUG\"}\r\n```\r\n\r\nRunning from commit  9cf22ac0079f56608d9e1d1f48bff336f715d60d",
  "closed_by": {
    "login": "rauljordan",
    "id": 5572669,
    "node_id": "MDQ6VXNlcjU1NzI2Njk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rauljordan",
    "html_url": "https://github.com/rauljordan",
    "followers_url": "https://api.github.com/users/rauljordan/followers",
    "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
    "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
    "organizations_url": "https://api.github.com/users/rauljordan/orgs",
    "repos_url": "https://api.github.com/users/rauljordan/repos",
    "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rauljordan/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5372/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5372/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/612168841",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5372#issuecomment-612168841",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5372",
    "id": 612168841,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMjE2ODg0MQ==",
    "user": {
      "login": "yusefnapora",
      "id": 678715,
      "node_id": "MDQ6VXNlcjY3ODcxNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/678715?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yusefnapora",
      "html_url": "https://github.com/yusefnapora",
      "followers_url": "https://api.github.com/users/yusefnapora/followers",
      "following_url": "https://api.github.com/users/yusefnapora/following{/other_user}",
      "gists_url": "https://api.github.com/users/yusefnapora/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yusefnapora/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yusefnapora/subscriptions",
      "organizations_url": "https://api.github.com/users/yusefnapora/orgs",
      "repos_url": "https://api.github.com/users/yusefnapora/repos",
      "events_url": "https://api.github.com/users/yusefnapora/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yusefnapora/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-10T18:53:44Z",
    "updated_at": "2020-04-10T18:53:44Z",
    "author_association": "NONE",
    "body": "Hey @prestonvanloon - this seems like it could be a bug in go-libp2p-noise. Do you have any more details about when this is happening, or more log output? \r\n\r\nAre you able to reproduce this locally?",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/612168841/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/612178273",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5372#issuecomment-612178273",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5372",
    "id": 612178273,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMjE3ODI3Mw==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-10T19:15:47Z",
    "updated_at": "2020-04-10T19:15:47Z",
    "author_association": "MEMBER",
    "body": "@yusefnapora I have not personally encountered this locally, but it was happening very consistently after restarting Prysm in our internal testnet. We would have to restart the process 3 or 4 times before it would work.\r\n\r\nDo you have any advice on how to troubleshoot this issue? Thanks",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/612178273/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/612189691",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5372#issuecomment-612189691",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5372",
    "id": 612189691,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMjE4OTY5MQ==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-10T19:49:05Z",
    "updated_at": "2020-04-10T19:49:05Z",
    "author_association": "MEMBER",
    "body": "@rauljordan updated some libp2p dependencies and now we have a slightly different message\r\n```\r\n [2020-04-10 14:36:29] DEBUG p2p: Handshake failed activePeers=0 direction=2 error=failed to dial : all dials failed\r\n  * [/ip4/192.168.4.38/tcp/13000] failed to negotiate security protocol: error reading handshake message: noise: message is too short multiAddr=/ip4/192.168.4.38/tcp/13000/p2p/16Uiu2HAm1PULWpBCFrtvmGC26QT54iryMz1Gyraf16n57ir58bxN peer=16Uiu2HAm1PULWpBCFrtvmGC26QT54iryMz1Gyraf16n57ir58bxN\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/612189691/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/612548012",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5372#issuecomment-612548012",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5372",
    "id": 612548012,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMjU0ODAxMg==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-12T01:28:23Z",
    "updated_at": "2020-04-12T01:28:23Z",
    "author_association": "MEMBER",
    "body": "I believe this is where the error originates from: https://github.com/flynn/noise/blob/2492fe189ae688d7edbeae0fd575de2f1c5fec8e/state.go#L420\r\n\r\nOne of the concerns here is that libp2p did not fallback to secio when we had options both options given to the host. This failure rendered the host unable to peer with anyone. ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/612548012/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/612548134",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5372#issuecomment-612548134",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5372",
    "id": 612548134,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMjU0ODEzNA==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-12T01:30:34Z",
    "updated_at": "2020-04-12T01:30:34Z",
    "author_association": "MEMBER",
    "body": "@rauljordan mentioned that this issue is very easy to produce locally and happens quite often. \r\n\r\nThis is the last testnet restart blocking items so this is high priority for us. Do you have any suggestions or feedback @yusefnapora?",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/612548134/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/612593407",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5372#issuecomment-612593407",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5372",
    "id": 612593407,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMjU5MzQwNw==",
    "user": {
      "login": "nisdas",
      "id": 33201827,
      "node_id": "MDQ6VXNlcjMzMjAxODI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/33201827?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nisdas",
      "html_url": "https://github.com/nisdas",
      "followers_url": "https://api.github.com/users/nisdas/followers",
      "following_url": "https://api.github.com/users/nisdas/following{/other_user}",
      "gists_url": "https://api.github.com/users/nisdas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nisdas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nisdas/subscriptions",
      "organizations_url": "https://api.github.com/users/nisdas/orgs",
      "repos_url": "https://api.github.com/users/nisdas/repos",
      "events_url": "https://api.github.com/users/nisdas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nisdas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-12T10:22:46Z",
    "updated_at": "2020-04-12T10:25:04Z",
    "author_association": "MEMBER",
    "body": "Update on this issue, it seems both the local and remote peer regard each other as initiating the outbound handshake. Due to both peers marking themselves as the initiator this leads to a malformed handshake. \r\n\r\nAdded in my own custom logging in ` tcp-tpt` to illustrate the outbound connection. \r\n\r\nPeer A:\r\n```\r\n17:34:00.901 DEBUG     swarm2: [16Uiu2HAmG5fvaMdfYroVxYaELR9No3B18XWbWjfESuYiB3MZHQxj] opening stream to peer [16Uiu2HAmBqdwBtkYHRUdTSNnJkb21EdAMAghcvfFby9hfo7TfpwT] swarm.go:292\r\n17:34:00.901 DEBUG     swarm2: [16Uiu2HAmG5fvaMdfYroVxYaELR9No3B18XWbWjfESuYiB3MZHQxj] swarm dialing peer [16Uiu2HAmBqdwBtkYHRUdTSNnJkb21EdAMAghcvfFby9hfo7TfpwT] swarm_dial.go:193\r\n17:34:00.901 DEBUG net/identi: error opening initial stream for /ipfs/id/1.0.0: session shutdown id.go:187\r\n17:34:00.901 DEBUG     swarm2: 16Uiu2HAmG5fvaMdfYroVxYaELR9No3B18XWbWjfESuYiB3MZHQxj swarm dialing 16Uiu2HAmBqdwBtkYHRUdTSNnJkb21EdAMAghcvfFby9hfo7TfpwT swarm_dial.go:371\r\n17:34:00.901 DEBUG     swarm2: [limiter] adding a dial job through limiter: /ip4/192.168.1.104/tcp/13001 limiter.go:192\r\n17:34:00.901 DEBUG     swarm2: [limiter] taking FD token: peer: 16Uiu2HAmBqdwBtkYHRUdTSNnJkb21EdAMAghcvfFby9hfo7TfpwT; addr: /ip4/192.168.1.104/tcp/13001; prev consuming: 0 limiter.go:160\r\n17:34:00.901 DEBUG     swarm2: [limiter] executing dial; peer: 16Uiu2HAmBqdwBtkYHRUdTSNnJkb21EdAMAghcvfFby9hfo7TfpwT; addr: /ip4/192.168.1.104/tcp/13001; FD consuming: 1; waiting: 0 limiter.go:166\r\n17:34:00.901 DEBUG     swarm2: 16Uiu2HAmG5fvaMdfYroVxYaELR9No3B18XWbWjfESuYiB3MZHQxj swarm dialing 16Uiu2HAmBqdwBtkYHRUdTSNnJkb21EdAMAghcvfFby9hfo7TfpwT /ip4/192.168.1.104/tcp/13001 swarm_dial.go:455\r\n17:34:00.901 DEBUG    tcp-tpt: Applying outbound upgrader for remote peer 16Uiu2HAmBqdwBtkYHRUdTSNnJkb21EdAMAghcvfFby9hfo7TfpwT tcp.go:107\r\n17:34:00.902 DEBUG     swarm2: [limiter] freeing FD token; waiting: 0; consuming: 1 limiter.go:82\r\n17:34:00.902 DEBUG     swarm2: [limiter] freeing peer token; peer 16Uiu2HAmBqdwBtkYHRUdTSNnJkb21EdAMAghcvfFby9hfo7TfpwT; addr: /ip4/192.168.1.104/tcp/13001; active for peer: 1; waiting on peer limit: 0 limiter.go:109\r\n17:34:00.902  INFO     swarm2: got error on dial: failed to negotiate security protocol: runHandshake initiator stage 1 fail: recvHandshakeMessage decode msg err=cannot decode stage 1/2 MessageBuffer: length less than 96 bytes swarm_dial.go:420\r\n17:34:00.902 DEBUG     swarm2: [limiter] clearing all peer dials: 16Uiu2HAmBqdwBtkYHRUdTSNnJkb21EdAMAghcvfFby9hfo7TfpwT limiter.go:200\r\n17:34:00.902 WARNI     pubsub: opening new stream to peer:  failed to dial : all dials failed\r\n  * [/ip4/192.168.1.104/tcp/13001] failed to negotiate security protocol: runHandshake initiator stage 1 fail: recvHandshakeMessage decode msg err=cannot decode stage 1/2 MessageBuffer: length less than 96 bytes 16Uiu2HAmBqdwBtkYHRUdTSNnJkb21EdAMAghcvfFby9hfo7TfpwT comm.go:63\r\n```\r\nPeer B\r\n\r\n```\r\n17:34:00.901 DEBUG net/identi: error opening initial stream for /ipfs/id/1.0.0: error writing length prefix: write tcp4 192.168.1.104:13001->192.168.1.104:52210: write: connection reset by peer id.go:187\r\n17:34:00.901 DEBUG     swarm2: [16Uiu2HAmBqdwBtkYHRUdTSNnJkb21EdAMAghcvfFby9hfo7TfpwT] opening stream to peer [16Uiu2HAmG5fvaMdfYroVxYaELR9No3B18XWbWjfESuYiB3MZHQxj] swarm.go:292\r\n17:34:00.901 DEBUG     swarm2: [16Uiu2HAmBqdwBtkYHRUdTSNnJkb21EdAMAghcvfFby9hfo7TfpwT] swarm dialing peer [16Uiu2HAmG5fvaMdfYroVxYaELR9No3B18XWbWjfESuYiB3MZHQxj] swarm_dial.go:193\r\n17:34:00.901 DEBUG     swarm2: [limiter] freeing FD token; waiting: 0; consuming: 1 limiter.go:82\r\n17:34:00.901 DEBUG     swarm2: [limiter] freeing peer token; peer 16Uiu2HAmG5fvaMdfYroVxYaELR9No3B18XWbWjfESuYiB3MZHQxj; addr: /ip4/192.168.1.104/tcp/13000; active for peer: 1; waiting on peer limit: 0 limiter.go:109\r\n17:34:00.901 DEBUG     swarm2: 16Uiu2HAmBqdwBtkYHRUdTSNnJkb21EdAMAghcvfFby9hfo7TfpwT swarm dialing 16Uiu2HAmG5fvaMdfYroVxYaELR9No3B18XWbWjfESuYiB3MZHQxj swarm_dial.go:371\r\n17:34:00.901 DEBUG     swarm2: [limiter] adding a dial job through limiter: /ip4/192.168.1.104/tcp/13000 limiter.go:192\r\n17:34:00.901 DEBUG     swarm2: [limiter] taking FD token: peer: 16Uiu2HAmG5fvaMdfYroVxYaELR9No3B18XWbWjfESuYiB3MZHQxj; addr: /ip4/192.168.1.104/tcp/13000; prev consuming: 0 limiter.go:160\r\n17:34:00.901 DEBUG     swarm2: [limiter] executing dial; peer: 16Uiu2HAmG5fvaMdfYroVxYaELR9No3B18XWbWjfESuYiB3MZHQxj; addr: /ip4/192.168.1.104/tcp/13000; FD consuming: 1; waiting: 0 limiter.go:166\r\n17:34:00.901 DEBUG     swarm2: 16Uiu2HAmBqdwBtkYHRUdTSNnJkb21EdAMAghcvfFby9hfo7TfpwT swarm dialing 16Uiu2HAmG5fvaMdfYroVxYaELR9No3B18XWbWjfESuYiB3MZHQxj /ip4/192.168.1.104/tcp/13000 swarm_dial.go:455\r\n17:34:00.901 DEBUG    tcp-tpt: Applying outbound upgrader for remote peer 16Uiu2HAmG5fvaMdfYroVxYaELR9No3B18XWbWjfESuYiB3MZHQxj tcp.go:107\r\n17:34:00.902 DEBUG     swarm2: [limiter] freeing FD token; waiting: 0; consuming: 1 limiter.go:82\r\n17:34:00.902 DEBUG     swarm2: [limiter] freeing peer token; peer 16Uiu2HAmG5fvaMdfYroVxYaELR9No3B18XWbWjfESuYiB3MZHQxj; addr: /ip4/192.168.1.104/tcp/13000; active for peer: 1; waiting on peer limit: 0 limiter.go:109\r\n17:34:00.902  INFO     swarm2: got error on dial: failed to negotiate security protocol: runHandshake initiator stage 1 fail: recvHandshakeMessage decode msg err=cannot decode stage 1/2 MessageBuffer: length less than 96 bytes swarm_dial.go:420\r\n17:34:00.902 DEBUG     swarm2: [limiter] clearing all peer dials: 16Uiu2HAmG5fvaMdfYroVxYaELR9No3B18XWbWjfESuYiB3MZHQxj limiter.go:200\r\n17:34:00.902 WARNI     pubsub: opening new stream to peer:  failed to dial : all dials failed\r\n  * [/ip4/192.168.1.104/tcp/13000] failed to negotiate security protocol: runHandshake initiator stage 1 fail: recvHandshakeMessage decode msg err=cannot decode stage 1/2 MessageBuffer: length less than 96 bytes 16Uiu2HAmG5fvaMdfYroVxYaELR9No3B18XWbWjfESuYiB3MZHQxj comm.go:63\r\n17:34:00.902 DEBUG     pubsub: PEERDOWN: Remove disconnected peer 16Uiu2HAmG5fvaMdfYroVxYaELR9No3B18XWbWjfESuYiB3MZHQxj gossipsub.go:90\r\n```\r\n\r\nIt seems like both of these peers dial each other at the same exact time and then regard themselves as initiator of the connection and handshake. I am not sure how this is possible ? But it would point\r\nto the issue potentially being in swarm. @yusefnapora any ideas ?\r\n\r\nYou can probably reproduce this by having a libp2p host with Noise enabled. Just disconnecting one peer and reconnecting it a few times should lead to this issue coming up.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/612593407/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/612918432",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5372#issuecomment-612918432",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5372",
    "id": 612918432,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMjkxODQzMg==",
    "user": {
      "login": "yusefnapora",
      "id": 678715,
      "node_id": "MDQ6VXNlcjY3ODcxNQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/678715?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yusefnapora",
      "html_url": "https://github.com/yusefnapora",
      "followers_url": "https://api.github.com/users/yusefnapora/followers",
      "following_url": "https://api.github.com/users/yusefnapora/following{/other_user}",
      "gists_url": "https://api.github.com/users/yusefnapora/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yusefnapora/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yusefnapora/subscriptions",
      "organizations_url": "https://api.github.com/users/yusefnapora/orgs",
      "repos_url": "https://api.github.com/users/yusefnapora/repos",
      "events_url": "https://api.github.com/users/yusefnapora/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yusefnapora/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-13T14:20:24Z",
    "updated_at": "2020-04-13T14:20:24Z",
    "author_association": "NONE",
    "body": "Hey, sorry I wasn't able to help much on Friday & thanks for digging deeper and discovering that it's a simultaneous connection issue.\r\n\r\nI think we can fix this by detecting the size mismatch and having one peer re-initialize the handshake as a responder. I'll start on this today & keep you guys posted.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/612918432/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/637137835",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/5372#issuecomment-637137835",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/5372",
    "id": 637137835,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYzNzEzNzgzNQ==",
    "user": {
      "login": "rauljordan",
      "id": 5572669,
      "node_id": "MDQ6VXNlcjU1NzI2Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5572669?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rauljordan",
      "html_url": "https://github.com/rauljordan",
      "followers_url": "https://api.github.com/users/rauljordan/followers",
      "following_url": "https://api.github.com/users/rauljordan/following{/other_user}",
      "gists_url": "https://api.github.com/users/rauljordan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rauljordan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rauljordan/subscriptions",
      "organizations_url": "https://api.github.com/users/rauljordan/orgs",
      "repos_url": "https://api.github.com/users/rauljordan/repos",
      "events_url": "https://api.github.com/users/rauljordan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rauljordan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-01T21:56:28Z",
    "updated_at": "2020-06-01T21:56:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "Resolved in v0.12, now running in dev testnet",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/637137835/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
