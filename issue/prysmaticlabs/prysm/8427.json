{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8427",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8427/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8427/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8427/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/8427",
  "id": 806297398,
  "node_id": "MDU6SXNzdWU4MDYyOTczOTg=",
  "number": 8427,
  "title": "beacon-chain should exit gracefully",
  "user": {
    "login": "potuz",
    "id": 16044918,
    "node_id": "MDQ6VXNlcjE2MDQ0OTE4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16044918?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/potuz",
    "html_url": "https://github.com/potuz",
    "followers_url": "https://api.github.com/users/potuz/followers",
    "following_url": "https://api.github.com/users/potuz/following{/other_user}",
    "gists_url": "https://api.github.com/users/potuz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/potuz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/potuz/subscriptions",
    "organizations_url": "https://api.github.com/users/potuz/orgs",
    "repos_url": "https://api.github.com/users/potuz/repos",
    "events_url": "https://api.github.com/users/potuz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/potuz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129904,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDQ=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Bug",
      "name": "Bug",
      "color": "ee0701",
      "default": false,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-02-11T11:19:33Z",
  "updated_at": "2021-03-24T05:00:48Z",
  "closed_at": "2021-03-24T05:00:48Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# üêû Bug Report\r\n\r\n### Description\r\n\r\nRunning beacon-chain as a systemd service. `Systemd` times out trying to send `SIGTERM` and eventually sends SIGKILL after `TimeoutStopSec` seconds passed. \r\n\r\nThis results in the best case scenario in a failed systemd unit and in the worst case scenario in a possibly corrupt db. \r\n\r\nLogs (Info level) show nothing relevant\r\n\r\n```\r\nFeb 11 06:58:23 vertex beacon-chain[2213008]: time=\"2021-02-11 06:58:23\" level=info msg=\"Synced new block\" block=0xb063c8a9... epoch=16180 finalizedEpoch=16178 finalizedRoot=0xbe81a383... prefix=blockchain slot=517790 slotInEpoch=30\r\nFeb 11 06:58:23 vertex beacon-chain[2213008]: time=\"2021-02-11 06:58:23\" level=info msg=\"Finished applying state transition\" attestations=33 attesterSlashings=0 deposits=0 prefix=blockchain proposerSlashings=0 voluntaryExits=0\r\nFeb 11 06:58:35 vertex beacon-chain[2213008]: time=\"2021-02-11 06:58:35\" level=info msg=\"Synced new block\" block=0x0b2c0ef1... epoch=16180 finalizedEpoch=16178 finalizedRoot=0xbe81a383... prefix=blockchain slot=517791 slotInEpoch=31\r\nFeb 11 06:58:35 vertex beacon-chain[2213008]: time=\"2021-02-11 06:58:35\" level=info msg=\"Finished applying state transition\" attestations=30 attesterSlashings=0 deposits=0 prefix=blockchain proposerSlashings=0 voluntaryExits=0\r\nFeb 11 06:58:55 vertex beacon-chain[2213008]: time=\"2021-02-11 06:58:55\" level=info msg=\"Got interrupt, shutting down...\" prefix=node\r\nFeb 11 06:58:55 vertex beacon-chain[2213008]: time=\"2021-02-11 06:58:55\" level=info msg=\"Stopping beacon node\" prefix=node\r\nFeb 11 06:58:55 vertex systemd[1]: Stopping Prysm beacon-chain client...\r\nFeb 11 06:58:59 vertex beacon-chain[2213008]: time=\"2021-02-11 06:58:59\" level=info msg=\"Synced new block\" block=0xcf2c165b... epoch=16181 finalizedEpoch=16179 finalizedRoot=0x0106ac82... prefix=blockchain slot=517793 slotInEpoch=1\r\nFeb 11 06:58:59 vertex beacon-chain[2213008]: time=\"2021-02-11 06:58:59\" level=info msg=\"Finished applying state transition\" attestations=70 attesterSlashings=0 deposits=0 prefix=blockchain proposerSlashings=0 voluntaryExits=0\r\n....\r\nFeb 11 07:01:47 vertex beacon-chain[2213008]: time=\"2021-02-11 07:01:47\" level=info msg=\"Finished applying state transition\" attestations=45 attesterSlashings=0 deposits=0 prefix=blockchain proposerSlashings=0 voluntaryExits=0\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: State 'stop-sigterm' timed out. Killing.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213008 (beacon-chain) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213023 (beacon-chain) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213029 (beacon-chain) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213032 (n/a) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213033 (beacon-chain) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213034 (n/a) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213036 (n/a) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213044 (n/a) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213049 (beacon-chain) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213074 (n/a) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213075 (n/a) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213076 (n/a) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213087 (n/a) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213088 (n/a) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213089 (n/a) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213090 (n/a) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213091 (n/a) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213092 (n/a) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213093 (n/a) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213094 (n/a) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Killing process 2213095 (beacon-chain) with signal SIGKILL.\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Main process exited, code=killed, status=9/KILL\r\nFeb 11 07:01:56 vertex systemd[1]: beacon-chain.service: Failed with result 'timeout'.his worked before in a previous version?\r\n```\r\nNotice the 3 minutes delay between the signals. I increased the timeout from the default 90 seconds and still fails. This does not happen always but most times in my node. \r\n\r\n## üåç  Your Environment\r\n\r\n**Operating System:**\r\n\r\n```\r\n$ uname -a\r\nLinux vertex 5.10.10-arch1-1 #1 SMP PREEMPT Sat, 23 Jan 2021 23:59:48 +0000 x86_64 GNU/Linux\r\n```\r\n\r\n**What version of Prysm are you running? (Which release)**\r\n1.0.5",
  "closed_by": {
    "login": "prylabs-bulldozer[bot]",
    "id": 58059840,
    "node_id": "MDM6Qm90NTgwNTk4NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/in/47372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D",
    "html_url": "https://github.com/apps/prylabs-bulldozer",
    "followers_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8427/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8427/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/777612153",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/8427#issuecomment-777612153",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8427",
    "id": 777612153,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NzYxMjE1Mw==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-11T16:16:28Z",
    "updated_at": "2021-02-11T16:17:02Z",
    "author_association": "MEMBER",
    "body": "There wasn't a log about receiving the sigterm?\r\n\r\nIt looks like this: https://github.com/prysmaticlabs/prysm/blob/cbd01d4ff4a011220d274dd50ca55b9d560337dd/beacon-chain/node/node.go#L258\r\n\r\n\r\nEdit: nevermind, i see it.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/777612153/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/777646111",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/8427#issuecomment-777646111",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8427",
    "id": 777646111,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3NzY0NjExMQ==",
    "user": {
      "login": "potuz",
      "id": 16044918,
      "node_id": "MDQ6VXNlcjE2MDQ0OTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16044918?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/potuz",
      "html_url": "https://github.com/potuz",
      "followers_url": "https://api.github.com/users/potuz/followers",
      "following_url": "https://api.github.com/users/potuz/following{/other_user}",
      "gists_url": "https://api.github.com/users/potuz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/potuz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/potuz/subscriptions",
      "organizations_url": "https://api.github.com/users/potuz/orgs",
      "repos_url": "https://api.github.com/users/potuz/repos",
      "events_url": "https://api.github.com/users/potuz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/potuz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-11T17:05:50Z",
    "updated_at": "2021-02-11T17:05:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "Oh yes sorry, I thought I had included since two lines before, adding them to the description",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/777646111/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/782503293",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/8427#issuecomment-782503293",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8427",
    "id": 782503293,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MjUwMzI5Mw==",
    "user": {
      "login": "potuz",
      "id": 16044918,
      "node_id": "MDQ6VXNlcjE2MDQ0OTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16044918?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/potuz",
      "html_url": "https://github.com/potuz",
      "followers_url": "https://api.github.com/users/potuz/followers",
      "following_url": "https://api.github.com/users/potuz/following{/other_user}",
      "gists_url": "https://api.github.com/users/potuz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/potuz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/potuz/subscriptions",
      "organizations_url": "https://api.github.com/users/potuz/orgs",
      "repos_url": "https://api.github.com/users/potuz/repos",
      "events_url": "https://api.github.com/users/potuz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/potuz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-20T01:15:04Z",
    "updated_at": "2021-02-20T01:15:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "This is probably due to having a stream endpoint connected. At the time this was bugging me I was streaming blocks for pyrmont. And I have other scripts that stream duties and the such from the beacon node. I just stopped the beacon without any streaming endpoint connected a couple of times and could not reproduce this.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/782503293/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/786151833",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/8427#issuecomment-786151833",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/8427",
    "id": 786151833,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NjE1MTgzMw==",
    "user": {
      "login": "prestonvanloon",
      "id": 7246818,
      "node_id": "MDQ6VXNlcjcyNDY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7246818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prestonvanloon",
      "html_url": "https://github.com/prestonvanloon",
      "followers_url": "https://api.github.com/users/prestonvanloon/followers",
      "following_url": "https://api.github.com/users/prestonvanloon/following{/other_user}",
      "gists_url": "https://api.github.com/users/prestonvanloon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prestonvanloon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prestonvanloon/subscriptions",
      "organizations_url": "https://api.github.com/users/prestonvanloon/orgs",
      "repos_url": "https://api.github.com/users/prestonvanloon/repos",
      "events_url": "https://api.github.com/users/prestonvanloon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prestonvanloon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-25T19:38:42Z",
    "updated_at": "2021-02-25T19:38:42Z",
    "author_association": "MEMBER",
    "body": "Interesting relationship with streaming. Perhaps we need to check the stream exit conditions better or perform a shutdown of the gRPC server in the Stop(), if it's not already being done correctly.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/786151833/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
