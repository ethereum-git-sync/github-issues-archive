{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10770",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10770/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10770/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10770/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/10770",
  "id": 1250873846,
  "node_id": "I_kwDOBvuov85KjtH2",
  "number": 10770,
  "title": "Panic in fork watcher if `no-discovery` enabled",
  "user": {
    "login": "ferranbt",
    "id": 30872539,
    "node_id": "MDQ6VXNlcjMwODcyNTM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/30872539?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ferranbt",
    "html_url": "https://github.com/ferranbt",
    "followers_url": "https://api.github.com/users/ferranbt/followers",
    "following_url": "https://api.github.com/users/ferranbt/following{/other_user}",
    "gists_url": "https://api.github.com/users/ferranbt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ferranbt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ferranbt/subscriptions",
    "organizations_url": "https://api.github.com/users/ferranbt/orgs",
    "repos_url": "https://api.github.com/users/ferranbt/repos",
    "events_url": "https://api.github.com/users/ferranbt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ferranbt/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129904,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDQ=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Bug",
      "name": "Bug",
      "color": "ee0701",
      "default": false,
      "description": "Something isn't working"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2022-05-27T15:06:25Z",
  "updated_at": "2022-05-27T23:50:00Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!--üíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé\r\n\r\nHellooo! üòÑ \r\n\r\nTo help us tend to your issue faster, please search our currently open issues before submitting a new one.\r\nExisting issues often contain information about workarounds, resolution, or progress updates.\r\n\r\nüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé-->\r\n\r\n# üêû Bug Report\r\n\r\n### Description\r\n\r\nI am running a `Prysm` devnet with one beacon (v2.0.6), one validator, and one Geth server, I am not using pre-generated validator state. The `config.yaml` files enables the `Altair` fork at epoch 2. I am running the beacon node with the `no-discovery` flag enabled.\r\n\r\n## üî• Error\r\n\r\nThe first epoch finishes with no problems but when the second epoch starts the beacon node crashes.\r\n```\r\ntime=\"2022-05-27 14:49:21\" level=info msg=\"Finished applying state transition\" prefix=blockchain slot=4\r\ntime=\"2022-05-27 14:49:24\" level=info msg=\"Peer summary\" activePeers=0 inbound=0 outbound=0 prefix=p2p\r\ntime=\"2022-05-27 14:49:33\" level=info msg=\"Synced new block\" block=0xe10daa74... epoch=0 finalizedEpoch=0 finalizedRoot=0x00000000... parentRoot=0x0c0c854c... prefix=blockchain slot=5 slotInEpoch=5 version=phase0\r\ntime=\"2022-05-27 14:49:33\" level=info msg=\"Finished applying state transition\" prefix=blockchain slot=5\r\ntime=\"2022-05-27 14:49:45\" level=warning msg=\"Attestation subnets with digest 0xc59a6e09 are no longer valid, unsubscribing from all of them.\" prefix=sync\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x20 pc=0x29ae774]\r\n\r\ngoroutine 221 [running]:\r\ngithub.com/prysmaticlabs/prysm/beacon-chain/p2p.(*Service).forkWatcher(0xc0000cd200)\r\n\tbeacon-chain/p2p/fork_watcher.go:24 +0x194\r\ncreated by github.com/prysmaticlabs/prysm/beacon-chain/p2p.(*Service).Start\r\n\tbeacon-chain/p2p/service.go:273 +0x450\r\n```\r\n\r\nIt looks like that `forkWatcher` tries to use `dv5Listener` [here](https://github.com/prysmaticlabs/prysm/blob/v2.0.6/beacon-chain/p2p/fork_watcher.go#L24) but that variable is never [set](https://github.com/prysmaticlabs/prysm/blob/v2.0.6/beacon-chain/p2p/service.go#L220) if the discovery is disabled.\r\n\r\n\r\n## üåç  Your Environment\r\n\r\n**Operating System:**\r\n\r\n<pre>\r\n  <code>\r\nUbuntu 20\r\n  </code>\r\n</pre>\r\n\r\n**What version of Prysm are you running? (Which release)**\r\n\r\n<pre>\r\n  <code>\r\nv2.0.6\r\n  </code>\r\n</pre>\r\n\r\n**Anything else relevant (validator index / public key)?**\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10770/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/10770/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
