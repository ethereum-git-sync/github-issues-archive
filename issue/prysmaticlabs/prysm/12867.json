{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12867",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12867/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12867/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12867/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/12867",
  "id": 1886188793,
  "node_id": "I_kwDOBvuov85wbPT5",
  "number": 12867,
  "title": "Race error in `is_data_available`",
  "user": {
    "login": "terencechain",
    "id": 21316537,
    "node_id": "MDQ6VXNlcjIxMzE2NTM3",
    "avatar_url": "https://avatars.githubusercontent.com/u/21316537?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/terencechain",
    "html_url": "https://github.com/terencechain",
    "followers_url": "https://api.github.com/users/terencechain/followers",
    "following_url": "https://api.github.com/users/terencechain/following{/other_user}",
    "gists_url": "https://api.github.com/users/terencechain/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/terencechain/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/terencechain/subscriptions",
    "organizations_url": "https://api.github.com/users/terencechain/orgs",
    "repos_url": "https://api.github.com/users/terencechain/repos",
    "events_url": "https://api.github.com/users/terencechain/events{/privacy}",
    "received_events_url": "https://api.github.com/users/terencechain/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 5462402659,
      "node_id": "LA_kwDOBvuov88AAAABRZWmYw",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Deneb",
      "name": "Deneb",
      "color": "040874",
      "default": false,
      "description": "PRs or issues for the Deneb upgrade"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "kasey",
    "id": 489222,
    "node_id": "MDQ6VXNlcjQ4OTIyMg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/489222?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kasey",
    "html_url": "https://github.com/kasey",
    "followers_url": "https://api.github.com/users/kasey/followers",
    "following_url": "https://api.github.com/users/kasey/following{/other_user}",
    "gists_url": "https://api.github.com/users/kasey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kasey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kasey/subscriptions",
    "organizations_url": "https://api.github.com/users/kasey/orgs",
    "repos_url": "https://api.github.com/users/kasey/repos",
    "events_url": "https://api.github.com/users/kasey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kasey/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "kasey",
      "id": 489222,
      "node_id": "MDQ6VXNlcjQ4OTIyMg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/489222?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/kasey",
      "html_url": "https://github.com/kasey",
      "followers_url": "https://api.github.com/users/kasey/followers",
      "following_url": "https://api.github.com/users/kasey/following{/other_user}",
      "gists_url": "https://api.github.com/users/kasey/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/kasey/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/kasey/subscriptions",
      "organizations_url": "https://api.github.com/users/kasey/orgs",
      "repos_url": "https://api.github.com/users/kasey/repos",
      "events_url": "https://api.github.com/users/kasey/events{/privacy}",
      "received_events_url": "https://api.github.com/users/kasey/received_events",
      "type": "User",
      "site_admin": false
    },
    {
      "login": "potuz",
      "id": 16044918,
      "node_id": "MDQ6VXNlcjE2MDQ0OTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16044918?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/potuz",
      "html_url": "https://github.com/potuz",
      "followers_url": "https://api.github.com/users/potuz/followers",
      "following_url": "https://api.github.com/users/potuz/following{/other_user}",
      "gists_url": "https://api.github.com/users/potuz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/potuz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/potuz/subscriptions",
      "organizations_url": "https://api.github.com/users/potuz/orgs",
      "repos_url": "https://api.github.com/users/potuz/repos",
      "events_url": "https://api.github.com/users/potuz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/potuz/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-09-07T16:07:34Z",
  "updated_at": "2023-09-12T15:32:23Z",
  "closed_at": "2023-09-12T15:32:23Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "The following errors were observed in the interop while spamming blobs. There were discrepancies in the number of blobs received and processed before data availability check in block chain pkg. Special mention the slot time is 6s\r\n```\r\ntime=\"2023-09-06 18:40:48\" level=debug msg=\"Received blob sidecar\" blockRoot=0xea157798e542fe6ca6dc413753c3da2b89e99ce3050050bbe0042b1b4fe30e5d index=0 prefix=sync proposerIndex=70 slot=19\r\ntime=\"2023-09-06 18:40:48\" level=debug msg=\"Received blob sidecar\" blockRoot=0xea157798e542fe6ca6dc413753c3da2b89e99ce3050050bbe0042b1b4fe30e5d index=3 prefix=sync proposerIndex=70 slot=19\r\ntime=\"2023-09-06 18:40:48\" level=debug msg=\"Received blob sidecar\" blockRoot=0xea157798e542fe6ca6dc413753c3da2b89e99ce3050050bbe0042b1b4fe30e5d index=2 prefix=sync proposerIndex=70 slot=19\r\ntime=\"2023-09-06 18:40:48\" level=debug msg=\"Received blob sidecar\" blockRoot=0xea157798e542fe6ca6dc413753c3da2b89e99ce3050050bbe0042b1b4fe30e5d index=1 prefix=sync proposerIndex=70 slot=19\r\ntime=\"2023-09-06 18:40:48\" level=debug msg=\"Received blob sidecar\" blockRoot=0xea157798e542fe6ca6dc413753c3da2b89e99ce3050050bbe0042b1b4fe30e5d index=5 prefix=sync proposerIndex=70 slot=19\r\ntime=\"2023-09-06 18:40:48\" level=debug msg=\"Received blob sidecar\" blockRoot=0xea157798e542fe6ca6dc413753c3da2b89e99ce3050050bbe0042b1b4fe30e5d index=4 prefix=sync proposerIndex=70 slot=19\r\ntime=\"2023-09-06 18:40:48\" level=error msg=\"Could not handle p2p pubsub\" error=\"could not validate blob data availability: could not check data availability, expected 6 commitments, obtained 5\r\n```\r\n\r\nWe added additional log here\r\n```\r\ncase <-nc.channel:\r\n\t\t\tchannelWrites++\r\n\t\t\tif channelWrites == existingBlobs {\r\n\t\t\t\ts.blobNotifier.Lock()\r\n\t\t\t\tdelete(s.blobNotifier.chanForRoot, root)\r\n\t\t\t\ts.blobNotifier.Unlock()\r\n\t\t\t\tsidecars, err := s.cfg.BeaconDB.BlobSidecarsByRoot(ctx, root)\r\n\t\t\t\tif err != nil {\r\n\t\t\t\t\treturn errors.Wrap(err, \"could not get blob sidecars\")\r\n\t\t\t\t}\r\n\t\t\t\tlog.Info(\"All blobs are available in database but arrived late \", channelWrites, existingBlobs, len(sidecars))\r\n\t\t\t\treturn kzg.IsDataAvailable(kzgCommitments, sidecars)\r\n```\r\n\r\nAnd confirmed `BlobSidecarsByRoot` returned one less sidecar\r\n```\r\ntime=\"2023-09-06 18:56:52\" level=info msg=\"All blobs are available in database but arrived late 5 5 4\" prefix=blockchain\r\n```\r\n**Temporary Workaround:**\r\nWe introduced a 500ms delay before invoking BlobSidecarsByRoot as a temporary measure. This is intriguing because all the DB methods are presumed to be blocking calls, but this issue suggests otherwise.",
  "closed_by": {
    "login": "prylabs-bulldozer[bot]",
    "id": 58059840,
    "node_id": "MDM6Qm90NTgwNTk4NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/in/47372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D",
    "html_url": "https://github.com/apps/prylabs-bulldozer",
    "followers_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prylabs-bulldozer%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12867/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/12867/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
