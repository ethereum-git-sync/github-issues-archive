{
  "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9347",
  "repository_url": "https://api.github.com/repos/prysmaticlabs/prysm",
  "labels_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9347/labels{/name}",
  "comments_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9347/comments",
  "events_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9347/events",
  "html_url": "https://github.com/prysmaticlabs/prysm/issues/9347",
  "id": 963828295,
  "node_id": "MDU6SXNzdWU5NjM4MjgyOTU=",
  "number": 9347,
  "title": "Node restart breaks p2p connectivity",
  "user": {
    "login": "k1rill-fedoseev",
    "id": 29590423,
    "node_id": "MDQ6VXNlcjI5NTkwNDIz",
    "avatar_url": "https://avatars.githubusercontent.com/u/29590423?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/k1rill-fedoseev",
    "html_url": "https://github.com/k1rill-fedoseev",
    "followers_url": "https://api.github.com/users/k1rill-fedoseev/followers",
    "following_url": "https://api.github.com/users/k1rill-fedoseev/following{/other_user}",
    "gists_url": "https://api.github.com/users/k1rill-fedoseev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/k1rill-fedoseev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/k1rill-fedoseev/subscriptions",
    "organizations_url": "https://api.github.com/users/k1rill-fedoseev/orgs",
    "repos_url": "https://api.github.com/users/k1rill-fedoseev/repos",
    "events_url": "https://api.github.com/users/k1rill-fedoseev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/k1rill-fedoseev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 802129904,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDQ=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Bug",
      "name": "Bug",
      "color": "ee0701",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 802129907,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDc=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Help%20Wanted",
      "name": "Help Wanted",
      "color": "33aa3f",
      "default": false,
      "description": "Extra attention is needed"
    },
    {
      "id": 802129908,
      "node_id": "MDU6TGFiZWw4MDIxMjk5MDg=",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Good%20First%20Issue",
      "name": "Good First Issue",
      "color": "7057ff",
      "default": false,
      "description": "Good for newcomers"
    },
    {
      "id": 1500585773,
      "node_id": "MDU6TGFiZWwxNTAwNTg1Nzcz",
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/labels/Networking",
      "name": "Networking",
      "color": "c7a5f7",
      "default": false,
      "description": "P2P related items"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-08-09T09:55:25Z",
  "updated_at": "2023-11-15T08:32:17Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!--üíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé\r\n\r\nHellooo! üòÑ \r\n\r\nTo help us tend to your issue faster, please search our currently open issues before submitting a new one.\r\nExisting issues often contain information about workarounds, resolution, or progress updates.\r\n\r\nüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíéüíé-->\r\n\r\n# üêû Bug Report\r\n\r\n### Description\r\n\r\nWhen you restart the node with `--p2p-priv-key` option pointing to the same private key, it can no longer connect to the existing nodes in the network due to some handshake problems.\r\n\r\n### Has this worked before in a previous version?\r\n\r\nNo, AFAIK\r\n\r\n## üî¨ Minimal Reproduction\r\n\r\n<!--\r\nPlease let us know how we can reproduce this issue. Include the exact method you used to run Prysm along with any flags used in your beacon chain and/or validator. Make sure you don't upload any confidential files or private keys.\r\n-->\r\n* Setup private chain with N nodes with fixed private keys (via `--p2p-priv-key`) and 1 bootnode.\r\n* Setup and run necessary validators to test that chain is operating.\r\n* Stop one of the beacon nodes and restart it after some time passes.\r\n* Observe debug and trace level logs.\r\n\r\n## üî• Error\r\n\r\nNode cannot sync with the rest of the chain in `Waiting for enough suitable peers before syncing` state with zero suitable peers.\r\n\r\n<pre><code>\r\n021-08-09T07:30:58.545Z\tDEBUG\tswarm2\t[limiter] freeing FD token; waiting: 0; consuming: 1\r\n2021-08-09T07:30:58.545Z\tDEBUG\tswarm2\t[limiter] freeing peer token; peer 16Uiu2HAm68etebwYHpMZTTiTxEa7zehC9jQkVxxDMXo1LGkMaEpT; addr: /ip4/134.122.127.194/tcp/13000; active for peer: 1; waiting on peer limit: 0\r\n2021-08-09T07:30:58.545Z\tDEBUG\tswarm2\t[limiter] clearing all peer dials: 16Uiu2HAm68etebwYHpMZTTiTxEa7zehC9jQkVxxDMXo1LGkMaEpT\r\n2021-08-09T07:30:58.545Z\tDEBUG\tswarm2\t[16Uiu2HAmBKp1bVEpuePbM9JizW2r7fUGrP4qamTreXrRps4HvVa2] opening stream to peer [16Uiu2HAm68etebwYHpMZTTiTxEa7zehC9jQkVxxDMXo1LGkMaEpT]\r\n2021-08-09T07:30:58.545Z\tDEBUG\tswarm2\t[16Uiu2HAmBKp1bVEpuePbM9JizW2r7fUGrP4qamTreXrRps4HvVa2] swarm dialing peer [16Uiu2HAm68etebwYHpMZTTiTxEa7zehC9jQkVxxDMXo1LGkMaEpT]\r\n2021-08-09T07:30:58.545Z\tDEBUG\tswarm2\t[16Uiu2HAmBKp1bVEpuePbM9JizW2r7fUGrP4qamTreXrRps4HvVa2] opening stream to peer [16Uiu2HAm68etebwYHpMZTTiTxEa7zehC9jQkVxxDMXo1LGkMaEpT]\r\n2021-08-09T07:30:58.545Z\tDEBUG\tswarm2\t[16Uiu2HAmBKp1bVEpuePbM9JizW2r7fUGrP4qamTreXrRps4HvVa2] swarm dialing peer [16Uiu2HAm68etebwYHpMZTTiTxEa7zehC9jQkVxxDMXo1LGkMaEpT]\r\n2021-08-09T07:30:58.545Z\tDEBUG\tnet/identify\terror opening identify stream\t{\"error\": \"read tcp4 172.18.0.2:13000->134.122.127.194:13000: read: connection reset by peer\"}\r\n2021-08-09T07:30:58.545Z\tDEBUG\tnet/identify\terror opening identify stream\t{\"error\": \"read tcp4 172.18.0.2:13000->134.122.127.194:13000: read: connection reset by peer\"}\r\n2021-08-09T07:30:58.545Z\tDEBUG\tbasichost\thost 16Uiu2HAmBKp1bVEpuePbM9JizW2r7fUGrP4qamTreXrRps4HvVa2 finished dialing 16Uiu2HAm68etebwYHpMZTTiTxEa7zehC9jQkVxxDMXo1LGkMaEpT\r\ntime=\"2021-08-09 07:30:58\" level=trace msg=\"Handshake failed\" error=\"max dial attempts exceeded\" prefix=p2p\r\n2021-08-09T07:30:58.545Z\tDEBUG\tpubsub\topening new stream to peer: max dial attempts exceeded16Uiu2HAm68etebwYHpMZTTiTxEa7zehC9jQkVxxDMXo1LGkMaEpT\r\n2021-08-09T07:30:58.545Z\tDEBUG\tpubsub\tPEERDOWN: Remove disconnected peer 16Uiu2HAm68etebwYHpMZTTiTxEa7zehC9jQkVxxDMXo1LGkMaEpT\r\n</code></pre>\r\n\r\n\r\n## üåç  Your Environment\r\n\r\n**Operating System:**\r\n\r\n<pre>\r\n  <code>\r\nUbuntu 18.04\r\n  </code>\r\n</pre>\r\n\r\n**What version of Prysm are you running? (Which release)**\r\n\r\n<pre>\r\n  <code>\r\nv1.4.3\r\n  </code>\r\n</pre>\r\n\r\n**Anything else relevant (validator index / public key)?**\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9347/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9347/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/895839426",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9347#issuecomment-895839426",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9347",
    "id": 895839426,
    "node_id": "IC_kwDOBvuov841ZWzC",
    "user": {
      "login": "nisdas",
      "id": 33201827,
      "node_id": "MDQ6VXNlcjMzMjAxODI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/33201827?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nisdas",
      "html_url": "https://github.com/nisdas",
      "followers_url": "https://api.github.com/users/nisdas/followers",
      "following_url": "https://api.github.com/users/nisdas/following{/other_user}",
      "gists_url": "https://api.github.com/users/nisdas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nisdas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nisdas/subscriptions",
      "organizations_url": "https://api.github.com/users/nisdas/orgs",
      "repos_url": "https://api.github.com/users/nisdas/repos",
      "events_url": "https://api.github.com/users/nisdas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nisdas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-10T08:33:18Z",
    "updated_at": "2021-08-10T08:33:18Z",
    "author_association": "MEMBER",
    "body": "Hey thanks for opening the issue @k1rill-fedoseev , do you mind stating which flags you are running the beacon nodes with ? ",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/895839426/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/895851870",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9347#issuecomment-895851870",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9347",
    "id": 895851870,
    "node_id": "IC_kwDOBvuov841ZZ1e",
    "user": {
      "login": "k1rill-fedoseev",
      "id": 29590423,
      "node_id": "MDQ6VXNlcjI5NTkwNDIz",
      "avatar_url": "https://avatars.githubusercontent.com/u/29590423?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/k1rill-fedoseev",
      "html_url": "https://github.com/k1rill-fedoseev",
      "followers_url": "https://api.github.com/users/k1rill-fedoseev/followers",
      "following_url": "https://api.github.com/users/k1rill-fedoseev/following{/other_user}",
      "gists_url": "https://api.github.com/users/k1rill-fedoseev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/k1rill-fedoseev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/k1rill-fedoseev/subscriptions",
      "organizations_url": "https://api.github.com/users/k1rill-fedoseev/orgs",
      "repos_url": "https://api.github.com/users/k1rill-fedoseev/repos",
      "events_url": "https://api.github.com/users/k1rill-fedoseev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/k1rill-fedoseev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-10T08:52:53Z",
    "updated_at": "2021-08-10T08:52:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Sure, I was using docker-compose for setting up the network, here is the snippet from my compose file:\r\n```\r\nversion: '3.8'\r\nservices:\r\n  node:\r\n    image: gcr.io/prysmaticlabs/prysm/beacon-chain:v1.4.3\r\n    command: |\r\n      --accept-terms-of-use\r\n      --contract-deployment-block 9068790\r\n      --http-web3provider https://rinkeby.infura.io/v3/$PROJECT_ID\r\n      --bootstrap-node $BOOTNODE\r\n      --config-file /sbc_test/config/config.yml\r\n      --chain-config-file /sbc_test/config/config.yml\r\n      --rpc-host 0.0.0.0\r\n      --p2p-priv-key /sbc_test/config/nodekey.txt\r\n      --p2p-local-ip 0.0.0.0\r\n      --p2p-host-ip $IP_NODE\r\n    ports:\r\n      - '12000:12000/udp'\r\n      - '13000:13000'\r\n      - '4000:4000'\r\n```\r\n\r\nAll nodes had different IPs and nodekey files.",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/895851870/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1812011550",
    "html_url": "https://github.com/prysmaticlabs/prysm/issues/9347#issuecomment-1812011550",
    "issue_url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/9347",
    "id": 1812011550,
    "node_id": "IC_kwDOBvuov85sARoe",
    "user": {
      "login": "wangyifan",
      "id": 518877,
      "node_id": "MDQ6VXNlcjUxODg3Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/518877?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wangyifan",
      "html_url": "https://github.com/wangyifan",
      "followers_url": "https://api.github.com/users/wangyifan/followers",
      "following_url": "https://api.github.com/users/wangyifan/following{/other_user}",
      "gists_url": "https://api.github.com/users/wangyifan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wangyifan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wangyifan/subscriptions",
      "organizations_url": "https://api.github.com/users/wangyifan/orgs",
      "repos_url": "https://api.github.com/users/wangyifan/repos",
      "events_url": "https://api.github.com/users/wangyifan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wangyifan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-15T08:32:17Z",
    "updated_at": "2023-11-15T08:32:17Z",
    "author_association": "NONE",
    "body": "Hi, I will take a look at this as my first issue of prysm. Could someone assign the ticket to me?",
    "reactions": {
      "url": "https://api.github.com/repos/prysmaticlabs/prysm/issues/comments/1812011550/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
