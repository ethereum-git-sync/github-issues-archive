{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/6031",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/6031/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/6031/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/6031/events",
  "html_url": "https://github.com/hyperledger/besu/issues/6031",
  "id": 1943820695,
  "node_id": "I_kwDODE2jmc5z3FmX",
  "number": 6031,
  "title": "Unclear presentation of the new release",
  "user": {
    "login": "RogerHKW",
    "id": 135605677,
    "node_id": "U_kgDOCBUtrQ",
    "avatar_url": "https://avatars.githubusercontent.com/u/135605677?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/RogerHKW",
    "html_url": "https://github.com/RogerHKW",
    "followers_url": "https://api.github.com/users/RogerHKW/followers",
    "following_url": "https://api.github.com/users/RogerHKW/following{/other_user}",
    "gists_url": "https://api.github.com/users/RogerHKW/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/RogerHKW/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/RogerHKW/subscriptions",
    "organizations_url": "https://api.github.com/users/RogerHKW/orgs",
    "repos_url": "https://api.github.com/users/RogerHKW/repos",
    "events_url": "https://api.github.com/users/RogerHKW/events{/privacy}",
    "received_events_url": "https://api.github.com/users/RogerHKW/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3805580086,
      "node_id": "LA_kwDODE2jmc7i1Is2",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/question",
      "name": "question",
      "color": "bfd4f2",
      "default": true,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "fab-10",
    "id": 91944855,
    "node_id": "U_kgDOBXr3lw",
    "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fab-10",
    "html_url": "https://github.com/fab-10",
    "followers_url": "https://api.github.com/users/fab-10/followers",
    "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
    "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
    "organizations_url": "https://api.github.com/users/fab-10/orgs",
    "repos_url": "https://api.github.com/users/fab-10/repos",
    "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fab-10/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-10-15T09:52:17Z",
  "updated_at": "2023-10-23T22:03:35Z",
  "closed_at": "2023-10-23T22:03:35Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "There are 3 things that I don't understand in the [text of your new release](https://github.com/hyperledger/besu/releases/tag/23.10.0). I can't update because of that.\n\n1. You cite several times \"# 5772\" but clicking the tag doesn't work in this text when I want to learn more about this change.\n\n2.\n> `tx-pool-retention-hours`: simply remove it, since it is not applicable in the Layered txpool, old transactions will eventually expire when the memory cache is full.\n\nIsn't there a vulnerability here? By mistake (or with the goal to disturb all Besu nodes of the network), it can happen that accounts send transactions with nonces far enough in the future (up to +199) and, if the gas price is reasonable, these transactions will slowly start to clog our 2nd and 3rd layers, potentially squatting our pools forever if these accounts get abandoned before they reach such nonces.\n\n3. \n> --Xlayered-tx-pool-layer-max-capacity, --Xlayered-tx-pool-max-prioritized and --Xlayered-tx-pool-max-future-by-sender just drop the X and keep the same behavior\n\nIt contradicts what is written before. In the text above this paragraph, what seems to be dropped is _Xlayered-_. So, what should I drop to make sure that Besu understands my settings?",
  "closed_by": {
    "login": "non-fungible-nelson",
    "id": 85905982,
    "node_id": "MDQ6VXNlcjg1OTA1OTgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/non-fungible-nelson",
    "html_url": "https://github.com/non-fungible-nelson",
    "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
    "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
    "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
    "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
    "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
    "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/6031/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/6031/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1765361400",
    "html_url": "https://github.com/hyperledger/besu/issues/6031#issuecomment-1765361400",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6031",
    "id": 1765361400,
    "node_id": "IC_kwDODE2jmc5pOUb4",
    "user": {
      "login": "non-fungible-nelson",
      "id": 85905982,
      "node_id": "MDQ6VXNlcjg1OTA1OTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/non-fungible-nelson",
      "html_url": "https://github.com/non-fungible-nelson",
      "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
      "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
      "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
      "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
      "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
      "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-16T22:18:13Z",
    "updated_at": "2023-10-16T22:18:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "@fab-10 will address questions 2 and 3 , thanks for these. I have fixed question number 1. \r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1765361400/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1765860642",
    "html_url": "https://github.com/hyperledger/besu/issues/6031#issuecomment-1765860642",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6031",
    "id": 1765860642,
    "node_id": "IC_kwDODE2jmc5pQOUi",
    "user": {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-17T07:49:01Z",
    "updated_at": "2023-10-17T08:06:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "> > `tx-pool-retention-hours`: simply remove it, since it is not applicable in the Layered txpool, old transactions will eventually expire when the memory cache is full.\r\n> \r\n> Isn't there a vulnerability here? By mistake (or with the goal to disturb all Besu nodes of the network), it can happen that accounts send transactions with nonces far enough in the future (up to +199) and, if the gas price is reasonable, these transactions will slowly start to clog our 2nd and 3rd layers, potentially squatting our pools forever if these accounts get abandoned before \r\nthey reach such nonces.\r\n\r\nLet's call these txs _nonce-gapped_, since they are not candidate for selection, due to the fact that for the same sender,  preceding tx is missing, and thus introduces a nonce gap.\r\nActually, one of the goals of this implementation is to avoid that those _nonce-gapped_ txs will clog the txpool, and prevent other new txs to be added. \r\nLet me describe how we achieve this property with the new implementation, detailing the lifecycle of a _nonce-gapped_ tx: \r\n\r\n- when we try to add it to the txpool we detected the nonce gap, and this means that it skips both the prioritized and the ready layers (since these layers only accept txs that are sequential with no gaps), so it directly goes to the sparse layer. \r\n- the sparse layer keeps track of all the gaps, and it will only promote a tx if has no more a gap\r\n- when the sparse layer if full, it starts evicting txs from the oldest\r\n- thus a _nonce-gapped_ tx will always live in the sparse layer, until there is no more space and eventually it gets evicted, or the gap is filled and can be promoted, think of it like a _purgatory_ for those kind of txs.\r\n- at the same time the prioritized and the ready layers are always free of these non-executable txs\r\n- even in the case the txpool is full, when a new sequential executable tx arrives in the pool, it will gets added even if the price is lower that all _nonce-gapped_ txs, because we prefer executable txs and the space for it is recovered evicting the older sparse tx\r\n- so instead of regularly evict old txs, we evict them when the txpool is full, actually trying to fully utilize the space reserved for it\r\n\r\nTest performed have confirmed that the layered implementation is much more robust than the legacy in preventing _nonce-gapped_ txs from harming the txpool, if there is space they could be there for a long time, but will never prevent new good txs from being added and confirmed.\r\n\r\nHope this helps, the description in the release was necessarily high level, but I am happy to describe the details of the implementation, and hear about possible issues. See also #5290 \r\n\r\n> \r\n> > --Xlayered-tx-pool-layer-max-capacity, --Xlayered-tx-pool-max-prioritized and --Xlayered-tx-pool-max-future-by-sender just drop the X and keep the same behavior\r\n> \r\n> It contradicts what is written before. In the text above this paragraph, what seems to be dropped is _Xlayered-_. So, what should I drop to make sure that Besu understands my settings?\r\n\r\nYou are right, indeed there is an error in this section, and the right options are the ones above, will update the changelog, thanks.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1765860642/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
