{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/1539",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/1539/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/1539/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/1539/events",
  "html_url": "https://github.com/hyperledger/besu/issues/1539",
  "id": 738456997,
  "node_id": "MDU6SXNzdWU3Mzg0NTY5OTc=",
  "number": 1539,
  "title": "JsonRpcHttpService Error processing JSON-RPC requestBody and vertx-blocked-thread-checker warn in logs",
  "user": {
    "login": "forkwatch-ninja",
    "id": 74117285,
    "node_id": "MDQ6VXNlcjc0MTE3Mjg1",
    "avatar_url": "https://avatars.githubusercontent.com/u/74117285?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/forkwatch-ninja",
    "html_url": "https://github.com/forkwatch-ninja",
    "followers_url": "https://api.github.com/users/forkwatch-ninja/followers",
    "following_url": "https://api.github.com/users/forkwatch-ninja/following{/other_user}",
    "gists_url": "https://api.github.com/users/forkwatch-ninja/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/forkwatch-ninja/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/forkwatch-ninja/subscriptions",
    "organizations_url": "https://api.github.com/users/forkwatch-ninja/orgs",
    "repos_url": "https://api.github.com/users/forkwatch-ninja/repos",
    "events_url": "https://api.github.com/users/forkwatch-ninja/events{/privacy}",
    "received_events_url": "https://api.github.com/users/forkwatch-ninja/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 2051683573,
      "node_id": "MDU6TGFiZWwyMDUxNjgzNTcz",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/P3",
      "name": "P3",
      "color": "ffff00",
      "default": false,
      "description": "Medium (ex: JSON-RPC request not working with a specific client library due to loose spec assumtion)"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "macfarla",
    "id": 2627919,
    "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/macfarla",
    "html_url": "https://github.com/macfarla",
    "followers_url": "https://api.github.com/users/macfarla/followers",
    "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
    "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
    "organizations_url": "https://api.github.com/users/macfarla/orgs",
    "repos_url": "https://api.github.com/users/macfarla/repos",
    "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
    "received_events_url": "https://api.github.com/users/macfarla/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-11-08T12:42:20Z",
  "updated_at": "2021-06-29T10:27:43Z",
  "closed_at": "2021-06-29T10:27:43Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I'm running into the same issue @shemnon as https://github.com/hyperledger/besu/issues/1114\r\nWhere threads are blocked.\r\n\r\nI am running a public Hyperledger Besu RPC endpoint which means others would be using it to deploy their smart contracts, and I see this in the log repeatedly:\r\n```\r\n# Besu Buggs\t\r\n        at app//org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthGetLogs$$Lambda$858/0x0000000801072440.get(Unknown Source)                                                                                                       [300/1896]\r\n        at java.base@14/java.util.Optional.orElseGet(Optional.java:362)\r\n        at app//org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthGetLogs.response(EthGetLogs.java:59)\r\n        at app//org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcHttpService.process(JsonRpcHttpService.java:614)\r\n        at app//org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcHttpService.lambda$handleJsonSingleRequest$10(JsonRpcHttpService.java:476)\r\n        at app//org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcHttpService$$Lambda$753/0x000000080102b440.handle(Unknown Source)\r\n        at app//io.vertx.core.impl.ContextImpl.lambda$executeBlocking$2(ContextImpl.java:313)\r\n        at app//io.vertx.core.impl.ContextImpl$$Lambda$587/0x0000000800f8d040.run(Unknown Source)\r\n        at java.base@14/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)\r\n        at java.base@14/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630)\r\n        at app//io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base@14/java.lang.Thread.run(Thread.java:832)\r\n\r\n2020-11-07 20:47:46.848+00:00 | vert.x-worker-thread-19 | WARN  | BackendQuery | Zombie backend query detected [ unnamed ], aborting process.\r\n2020-11-07 20:47:46.852+00:00 | vert.x-worker-thread-19 | ERROR | BlockchainQueries | Error retrieving matching logs\r\norg.hyperledger.besu.ethereum.api.handlers.RpcMethodTimeoutException: Timeout expired\r\n        at org.hyperledger.besu.ethereum.api.query.BackendQuery.runIfAlive(BackendQuery.java:46)\r\n        at org.hyperledger.besu.ethereum.api.query.BackendQuery.runIfAlive(BackendQuery.java:31)\r\n        at org.hyperledger.besu.ethereum.api.query.BackendQuery.stopIfExpired(BackendQuery.java:52)\r\n        at org.hyperledger.besu.ethereum.api.query.BlockchainQueries.matchingLogs(BlockchainQueries.java:560)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthGetLogs.lambda$response$1(EthGetLogs.java:64)\r\n        at java.base/java.util.Optional.orElseGet(Optional.java:362)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthGetLogs.response(EthGetLogs.java:59)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcHttpService.process(JsonRpcHttpService.java:614)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcHttpService.lambda$handleJsonSingleRequest$10(JsonRpcHttpService.java:476)\r\n        at io.vertx.core.impl.ContextImpl.lambda$executeBlocking$2(ContextImpl.java:313)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:832)\r\n2020-11-07 20:47:46.857+00:00 | vert.x-worker-thread-19 | ERROR | JsonRpcHttpService | Error processing JSON-RPC requestBody\r\norg.hyperledger.besu.ethereum.api.handlers.RpcMethodTimeoutException: Timeout expired\r\n        at org.hyperledger.besu.ethereum.api.query.BackendQuery.runIfAlive(BackendQuery.java:46)\r\n        at org.hyperledger.besu.ethereum.api.query.BackendQuery.runIfAlive(BackendQuery.java:31)\r\n        at org.hyperledger.besu.ethereum.api.query.BackendQuery.stopIfExpired(BackendQuery.java:52)\r\n        at org.hyperledger.besu.ethereum.api.query.BlockchainQueries.matchingLogs(BlockchainQueries.java:560)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthGetLogs.lambda$response$1(EthGetLogs.java:64)\r\n        at java.base/java.util.Optional.orElseGet(Optional.java:362)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthGetLogs.response(EthGetLogs.java:59)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcHttpService.process(JsonRpcHttpService.java:614)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcHttpService.lambda$handleJsonSingleRequest$10(JsonRpcHttpService.java:476)\r\n        at io.vertx.core.impl.ContextImpl.lambda$executeBlocking$2(ContextImpl.java:313)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:832)\r\n2020-11-07 20:47:47.428+00:00 | vertx-blocked-thread-checker | WARN  | BlockedThreadChecker | Thread Thread[vert.x-worker-thread-8,5,main]=Thread[vert.x-worker-thread-8,5,main] has been blocked for 78205 ms, time limit is 60000 ms\r\nio.vertx.core.VertxException: Thread blocked\r\n        at app//org.rocksdb.RocksDB.get(Native Method)\r\n        at app//org.rocksdb.RocksDB.get(RocksDB.java:1886)\r\n        at app//org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.get(RocksDBColumnarKeyValueStorage.java:155)\r\n        at app//org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.get(RocksDBColumnarKeyValueStorage.java:62)\r\n        at app//org.hyperledger.besu.services.kvstore.SegmentedKeyValueStorageAdapter.get(SegmentedKeyValueStorageAdapter.java:50)\r\n        at app//org.hyperledger.besu.ethereum.storage.keyvalue.KeyValueStoragePrefixedKeyBlockchainStorage.get(KeyValueStoragePrefixedKeyBlockchainStorage.java:122)\r\n        at app//org.hyperledger.besu.ethereum.storage.keyvalue.KeyValueStoragePrefixedKeyBlockchainStorage.getBlockHeader(KeyValueStoragePrefixedKeyBlockchainStorage.java:77)\r\n        at app//org.hyperledger.besu.ethereum.chain.DefaultBlockchain$$Lambda$833/0x0000000801067c40.apply(Unknown Source)\r\n        at java.base@14/java.util.Optional.flatMap(Optional.java:287)\r\n        at app//org.hyperledger.besu.ethereum.chain.DefaultBlockchain.getBlockHeader(DefaultBlockchain.java:186)\r\n        at app//org.hyperledger.besu.ethereum.api.query.BlockchainQueries$$Lambda$869/0x0000000801079440.apply(Unknown Source)\r\n        at java.base@14/java.util.stream.LongPipeline$1$1.accept(LongPipeline.java:177)\r\n        at java.base@14/java.util.stream.Streams$RangeLongSpliterator.tryAdvance(Streams.java:207)\r\n        at java.base@14/java.util.stream.LongPipeline.forEachWithCancel(LongPipeline.java:161)\r\n        at java.base@14/java.util.stream.AbstractPipeline.copyIntoWithCancel(AbstractPipeline.java:502)\r\n```\r\nI'm running this command:\r\n```\r\nbesu --network=classic --data-path=~/besu-dir --node-private-key-file=~/besu-dir/keys --rpc-http-enabled --rpc-ws-enabled --host-whitelist=* --rpc-http-cors-origins=* --p2p-host=<IP> --p2p-port=30303 --rpc-http-host=0.0.0.0 --rpc-http-port=8545 --sync-mode=FULL --rpc-http-api=web3,net,eth,trace,txpool --rpc-ws-api=web3,net,eth,trace,txpool --rpc-ws-host=0.0.0.0\r\n```\r\n\r\n@shemnon  I'm connecting it to blockscout used by the public and providing the RPC endpoint to the public as well. I can share traffic data to the RPC, but for specific RPC calls triggering it, I can't really say, it's mostly Blockscout and a public RPC endpoint. How do you advise me to look into the RPC calls hitting the Besu node and how large the getLogsQuery being polled. Are there docs to allow me to debug this to provide the data for you?",
  "closed_by": {
    "login": "vmichalik",
    "id": 12459761,
    "node_id": "MDQ6VXNlcjEyNDU5NzYx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12459761?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vmichalik",
    "html_url": "https://github.com/vmichalik",
    "followers_url": "https://api.github.com/users/vmichalik/followers",
    "following_url": "https://api.github.com/users/vmichalik/following{/other_user}",
    "gists_url": "https://api.github.com/users/vmichalik/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vmichalik/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vmichalik/subscriptions",
    "organizations_url": "https://api.github.com/users/vmichalik/orgs",
    "repos_url": "https://api.github.com/users/vmichalik/repos",
    "events_url": "https://api.github.com/users/vmichalik/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vmichalik/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/1539/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/1539/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/864644429",
    "html_url": "https://github.com/hyperledger/besu/issues/1539#issuecomment-864644429",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1539",
    "id": 864644429,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NDY0NDQyOQ==",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-21T00:46:33Z",
    "updated_at": "2021-06-21T00:46:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "@forkwatch-ninja sorry about the delay - is this still a problem for you? And if so, can you provide any more data - besu logs will show all RPC calls if you set log level to TRACE",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/864644429/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/870474438",
    "html_url": "https://github.com/hyperledger/besu/issues/1539#issuecomment-870474438",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1539",
    "id": 870474438,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MDQ3NDQzOA==",
    "user": {
      "login": "vmichalik",
      "id": 12459761,
      "node_id": "MDQ6VXNlcjEyNDU5NzYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12459761?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vmichalik",
      "html_url": "https://github.com/vmichalik",
      "followers_url": "https://api.github.com/users/vmichalik/followers",
      "following_url": "https://api.github.com/users/vmichalik/following{/other_user}",
      "gists_url": "https://api.github.com/users/vmichalik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vmichalik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vmichalik/subscriptions",
      "organizations_url": "https://api.github.com/users/vmichalik/orgs",
      "repos_url": "https://api.github.com/users/vmichalik/repos",
      "events_url": "https://api.github.com/users/vmichalik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vmichalik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-29T10:27:43Z",
    "updated_at": "2021-06-29T10:27:43Z",
    "author_association": "NONE",
    "body": "Hi @forkwatch-ninja, closing this for now as we haven't been able to recreate this issue, if you're still having problems please feel free to reopen!",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/870474438/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
