{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/3190",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/3190/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/3190/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/3190/events",
  "html_url": "https://github.com/hyperledger/besu/issues/3190",
  "id": 1082144866,
  "node_id": "I_kwDODE2jmc5AgDhi",
  "number": 3190,
  "title": "TLS client authentication fails due to `certificate unknown`",
  "user": {
    "login": "arnegebert",
    "id": 35544567,
    "node_id": "MDQ6VXNlcjM1NTQ0NTY3",
    "avatar_url": "https://avatars.githubusercontent.com/u/35544567?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/arnegebert",
    "html_url": "https://github.com/arnegebert",
    "followers_url": "https://api.github.com/users/arnegebert/followers",
    "following_url": "https://api.github.com/users/arnegebert/following{/other_user}",
    "gists_url": "https://api.github.com/users/arnegebert/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/arnegebert/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/arnegebert/subscriptions",
    "organizations_url": "https://api.github.com/users/arnegebert/orgs",
    "repos_url": "https://api.github.com/users/arnegebert/repos",
    "events_url": "https://api.github.com/users/arnegebert/events{/privacy}",
    "received_events_url": "https://api.github.com/users/arnegebert/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 1921587647,
      "node_id": "MDU6TGFiZWwxOTIxNTg3NjQ3",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamGroot",
      "name": "TeamGroot",
      "color": "1d76db",
      "default": false,
      "description": "GH issues worked on by Groot Team"
    },
    {
      "id": 2051683573,
      "node_id": "MDU6TGFiZWwyMDUxNjgzNTcz",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/P3",
      "name": "P3",
      "color": "ffff00",
      "default": false,
      "description": "Medium (ex: JSON-RPC request not working with a specific client library due to loose spec assumtion)"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "usmansaleem",
    "id": 669527,
    "node_id": "MDQ6VXNlcjY2OTUyNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/669527?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/usmansaleem",
    "html_url": "https://github.com/usmansaleem",
    "followers_url": "https://api.github.com/users/usmansaleem/followers",
    "following_url": "https://api.github.com/users/usmansaleem/following{/other_user}",
    "gists_url": "https://api.github.com/users/usmansaleem/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/usmansaleem/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/usmansaleem/subscriptions",
    "organizations_url": "https://api.github.com/users/usmansaleem/orgs",
    "repos_url": "https://api.github.com/users/usmansaleem/repos",
    "events_url": "https://api.github.com/users/usmansaleem/events{/privacy}",
    "received_events_url": "https://api.github.com/users/usmansaleem/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "usmansaleem",
      "id": 669527,
      "node_id": "MDQ6VXNlcjY2OTUyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/669527?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/usmansaleem",
      "html_url": "https://github.com/usmansaleem",
      "followers_url": "https://api.github.com/users/usmansaleem/followers",
      "following_url": "https://api.github.com/users/usmansaleem/following{/other_user}",
      "gists_url": "https://api.github.com/users/usmansaleem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/usmansaleem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/usmansaleem/subscriptions",
      "organizations_url": "https://api.github.com/users/usmansaleem/orgs",
      "repos_url": "https://api.github.com/users/usmansaleem/repos",
      "events_url": "https://api.github.com/users/usmansaleem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/usmansaleem/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-12-16T12:33:13Z",
  "updated_at": "2022-01-10T00:59:36Z",
  "closed_at": "2022-01-04T23:17:04Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nWhen configuring TLS Client authentication, the TLS handshake always terminates with 'certificate unknown' even if the certificate is configured in the \"knownClients\" file. \r\n\r\n### Details\r\n\r\nI am attempting to configure TLS for the connection between my Dapp and Besu. Configuring server authentication (Besu authenticates to my Dapp) worked but I am unable to set up client authentication (my Dapp authenticates to Besu) due to the connection terminating with `unknown certificate`. \r\n\r\nTo activate server TLS authentication, I additionally added the following CLI options to my `besu` invocation: \r\n```\r\n  --rpc-http-tls-enabled \\\r\n  --rpc-http-tls-keystore-file=tls/besu_store.p12 \\\r\n  --rpc-http-tls-keystore-password-file=tls/password.txt \\\r\n```\r\nWhich works. \r\n\r\nTo add client TLS authentication, I furthermore added:\r\n```\r\n  --rpc-http-tls-client-auth-enabled \\\r\n  --rpc-http-tls-known-clients-file=tls/knownClients.txt \\\r\n```\r\n\r\nwhere `knownClients.txt` contains the following line: \r\n```\r\nCantonBesuDemo 34:C7:30:1D:7C:A9:87:E7:CD:5A:88:A2:55:F0:BE:A1:9C:4A:39:2A:7C:9C:6D:1C:B3:FA:8B:BA:86:AB:54:05\r\n```\r\n\r\nThe common name and SHA256 fingerprint were obtained through inspection via `keytool` as described [in the docs](https://besu.hyperledger.org/en/stable/HowTo/Configure/TLS/Configure-TLS/#create-the-known-clients-file). \r\n\r\nHowever, with client authentication enabled, the connection always terminates with `javax.net.ssl.SSLHandshakeException: Received fatal alert: certificate_unknown`. I also see the following error in the Besu `TRACE` logs:  \r\n```\r\n javax.net.ssl.SSLHandshakeException: Certificate for CantonBesuDemo (CN=CantonBesuDemo, O=Digital Asset, ST=Some-State, C=AU) has unknown fingerprint 34c7301d7ca987e7cd5a88a255f0bea19c4a392a7c9c6d1cb3fa8bba86ab5405                               â”¤\r\nat java.base/sun.security.ssl.Alert.createSSLException(Unknown Source)\r\nat java.base/sun.security.ssl.TransportContext.fatal(Unknown Source)\r\nat java.base/sun.security.ssl.TransportContext.fatal(Unknown Source)\r\nat java.base/sun.security.ssl.TransportContext.fatal(Unknown Source\r\n[... omitted ...]\r\n```\r\n\r\nNote that this is the same fingerprint I configured in `knownClients.txt`. I also attempted to connect to Besu via the `openssl s_client` just in case I had a bug in the HTTP client configuration of my Dapp. For my setup, this was the following command: \r\n```\r\nopenssl s_client -connect localhost:8550 -status -key canton_key.pem -cert canton_cert.pem \r\n```\r\nSadly, this leads to the same result: this succeeds with only server authentication but fails with client authentication enabled (concretely: `140676117705152:error:14094416:SSL routines:ssl3_read_bytes:sslv3 alert certificate unknown:../ssl/record/rec_layer_s3.c:1528:SSL alert number 46`).\r\n\r\nI am aware that a bug in the TLS setup is unlikely but I just don't see where my setup could be misconfigured. Let me know if you need any more details. \r\n\r\n**Frequency:** Always\r\n\r\n### Versions (Add all that apply)\r\n* Besu version: 21.10.3\r\n* Java version: openjdk 11.0.11 2021-04-20\r\n* OS Name & Version: Ubuntu 18.04 LTS\r\n* Kernel Version: Linux arne-Precision-5540 5.4.0-90-generic # 101~18.04.1-Ubuntu SMP Fri Oct 22 09:25:04 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\r\n* Docker Version:  20.10.11\r\n\r\n### Additional Information\r\nI am running Besu locally using the latest Docker containers. \r\n\r\nChanging `knownClients.txt` to \r\n```\r\nBesuCantonDemo 34c7301d7ca987e7cd5a88a255f0bea19c4a392a7c9c6d1cb3fa8bba86ab5405\r\n```\r\ndid not fix the issue. ",
  "closed_by": {
    "login": "usmansaleem",
    "id": 669527,
    "node_id": "MDQ6VXNlcjY2OTUyNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/669527?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/usmansaleem",
    "html_url": "https://github.com/usmansaleem",
    "followers_url": "https://api.github.com/users/usmansaleem/followers",
    "following_url": "https://api.github.com/users/usmansaleem/following{/other_user}",
    "gists_url": "https://api.github.com/users/usmansaleem/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/usmansaleem/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/usmansaleem/subscriptions",
    "organizations_url": "https://api.github.com/users/usmansaleem/orgs",
    "repos_url": "https://api.github.com/users/usmansaleem/repos",
    "events_url": "https://api.github.com/users/usmansaleem/events{/privacy}",
    "received_events_url": "https://api.github.com/users/usmansaleem/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/3190/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/3190/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1004689479",
    "html_url": "https://github.com/hyperledger/besu/issues/3190#issuecomment-1004689479",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3190",
    "id": 1004689479,
    "node_id": "IC_kwDODE2jmc474lhH",
    "user": {
      "login": "usmansaleem",
      "id": 669527,
      "node_id": "MDQ6VXNlcjY2OTUyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/669527?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/usmansaleem",
      "html_url": "https://github.com/usmansaleem",
      "followers_url": "https://api.github.com/users/usmansaleem/followers",
      "following_url": "https://api.github.com/users/usmansaleem/following{/other_user}",
      "gists_url": "https://api.github.com/users/usmansaleem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/usmansaleem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/usmansaleem/subscriptions",
      "organizations_url": "https://api.github.com/users/usmansaleem/orgs",
      "repos_url": "https://api.github.com/users/usmansaleem/repos",
      "events_url": "https://api.github.com/users/usmansaleem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/usmansaleem/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-04T10:25:15Z",
    "updated_at": "2022-01-04T10:28:38Z",
    "author_association": "MEMBER",
    "body": "@arnegebert I am unable to reproduce the issue in my local testing. https://github.com/usmansaleem/besu_tls_setup . The only thing I notice is CN is in mixed case, try using all lower case for CN and see if it works i.e. `CantonBesuDemo` should be `cantonbesudemo` both in client's certificate and in knownClients file.  ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1004689479/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1004720794",
    "html_url": "https://github.com/hyperledger/besu/issues/3190#issuecomment-1004720794",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3190",
    "id": 1004720794,
    "node_id": "IC_kwDODE2jmc474tKa",
    "user": {
      "login": "arnegebert",
      "id": 35544567,
      "node_id": "MDQ6VXNlcjM1NTQ0NTY3",
      "avatar_url": "https://avatars.githubusercontent.com/u/35544567?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arnegebert",
      "html_url": "https://github.com/arnegebert",
      "followers_url": "https://api.github.com/users/arnegebert/followers",
      "following_url": "https://api.github.com/users/arnegebert/following{/other_user}",
      "gists_url": "https://api.github.com/users/arnegebert/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arnegebert/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arnegebert/subscriptions",
      "organizations_url": "https://api.github.com/users/arnegebert/orgs",
      "repos_url": "https://api.github.com/users/arnegebert/repos",
      "events_url": "https://api.github.com/users/arnegebert/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arnegebert/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-04T11:13:09Z",
    "updated_at": "2022-01-04T11:13:09Z",
    "author_association": "NONE",
    "body": "Argh.... that seems to be it! Thank you very much @usmansaleem, this fixes my issue!",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1004720794/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1005242594",
    "html_url": "https://github.com/hyperledger/besu/issues/3190#issuecomment-1005242594",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3190",
    "id": 1005242594,
    "node_id": "IC_kwDODE2jmc476sji",
    "user": {
      "login": "usmansaleem",
      "id": 669527,
      "node_id": "MDQ6VXNlcjY2OTUyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/669527?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/usmansaleem",
      "html_url": "https://github.com/usmansaleem",
      "followers_url": "https://api.github.com/users/usmansaleem/followers",
      "following_url": "https://api.github.com/users/usmansaleem/following{/other_user}",
      "gists_url": "https://api.github.com/users/usmansaleem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/usmansaleem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/usmansaleem/subscriptions",
      "organizations_url": "https://api.github.com/users/usmansaleem/orgs",
      "repos_url": "https://api.github.com/users/usmansaleem/repos",
      "events_url": "https://api.github.com/users/usmansaleem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/usmansaleem/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-04T23:17:04Z",
    "updated_at": "2022-01-04T23:17:04Z",
    "author_association": "MEMBER",
    "body": "Glad it sorted out. Apologies for delayed response due to end of year holidays. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1005242594/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1008433460",
    "html_url": "https://github.com/hyperledger/besu/issues/3190#issuecomment-1008433460",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3190",
    "id": 1008433460,
    "node_id": "IC_kwDODE2jmc48G3k0",
    "user": {
      "login": "arnegebert",
      "id": 35544567,
      "node_id": "MDQ6VXNlcjM1NTQ0NTY3",
      "avatar_url": "https://avatars.githubusercontent.com/u/35544567?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arnegebert",
      "html_url": "https://github.com/arnegebert",
      "followers_url": "https://api.github.com/users/arnegebert/followers",
      "following_url": "https://api.github.com/users/arnegebert/following{/other_user}",
      "gists_url": "https://api.github.com/users/arnegebert/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arnegebert/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arnegebert/subscriptions",
      "organizations_url": "https://api.github.com/users/arnegebert/orgs",
      "repos_url": "https://api.github.com/users/arnegebert/repos",
      "events_url": "https://api.github.com/users/arnegebert/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arnegebert/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-09T22:09:58Z",
    "updated_at": "2022-01-09T22:09:58Z",
    "author_association": "NONE",
    "body": "> Glad it sorted out. Apologies for delayed response due to end of year holidays.\r\n\r\nNo worries and thanks again. But I would suggest adding this to the documentation as (IMHO) it's counterintuitive and the error message is somewhat misleading too. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1008433460/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1008441296",
    "html_url": "https://github.com/hyperledger/besu/issues/3190#issuecomment-1008441296",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3190",
    "id": 1008441296,
    "node_id": "IC_kwDODE2jmc48G5fQ",
    "user": {
      "login": "usmansaleem",
      "id": 669527,
      "node_id": "MDQ6VXNlcjY2OTUyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/669527?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/usmansaleem",
      "html_url": "https://github.com/usmansaleem",
      "followers_url": "https://api.github.com/users/usmansaleem/followers",
      "following_url": "https://api.github.com/users/usmansaleem/following{/other_user}",
      "gists_url": "https://api.github.com/users/usmansaleem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/usmansaleem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/usmansaleem/subscriptions",
      "organizations_url": "https://api.github.com/users/usmansaleem/orgs",
      "repos_url": "https://api.github.com/users/usmansaleem/repos",
      "events_url": "https://api.github.com/users/usmansaleem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/usmansaleem/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-09T23:03:04Z",
    "updated_at": "2022-01-09T23:03:20Z",
    "author_association": "MEMBER",
    "body": "> No worries and thanks again. But I would suggest adding this to the documentation as (IMHO) it's counterintuitive and the error message is somewhat misleading too.\r\n\r\nYes, will add a doco warning about it. Have already submitted a patch to the upstream library where this bug originated from. https://github.com/apache/incubator-tuweni/pull/353\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1008441296/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1008465179",
    "html_url": "https://github.com/hyperledger/besu/issues/3190#issuecomment-1008465179",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3190",
    "id": 1008465179,
    "node_id": "IC_kwDODE2jmc48G_Ub",
    "user": {
      "login": "arnegebert",
      "id": 35544567,
      "node_id": "MDQ6VXNlcjM1NTQ0NTY3",
      "avatar_url": "https://avatars.githubusercontent.com/u/35544567?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/arnegebert",
      "html_url": "https://github.com/arnegebert",
      "followers_url": "https://api.github.com/users/arnegebert/followers",
      "following_url": "https://api.github.com/users/arnegebert/following{/other_user}",
      "gists_url": "https://api.github.com/users/arnegebert/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/arnegebert/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/arnegebert/subscriptions",
      "organizations_url": "https://api.github.com/users/arnegebert/orgs",
      "repos_url": "https://api.github.com/users/arnegebert/repos",
      "events_url": "https://api.github.com/users/arnegebert/events{/privacy}",
      "received_events_url": "https://api.github.com/users/arnegebert/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-01-10T00:59:36Z",
    "updated_at": "2022-01-10T00:59:36Z",
    "author_association": "NONE",
    "body": "> > No worries and thanks again. But I would suggest adding this to the documentation as (IMHO) it's counterintuitive and the error message is somewhat misleading too.\r\n> \r\n> Yes, will add a doco warning about it. Have already submitted a patch to the upstream library where this bug originated from. [apache/incubator-tuweni#353](https://github.com/apache/incubator-tuweni/pull/353)\r\n\r\nYou are a GOAT! ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1008465179/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
