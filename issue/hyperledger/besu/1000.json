{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/1000",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/1000/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/1000/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/1000/events",
  "html_url": "https://github.com/hyperledger/besu/issues/1000",
  "id": 626885763,
  "node_id": "MDU6SXNzdWU2MjY4ODU3NjM=",
  "number": 1000,
  "title": "Shape RPC traffic to prevent DoS from heavy load",
  "user": {
    "login": "benjamincburns",
    "id": 803016,
    "node_id": "MDQ6VXNlcjgwMzAxNg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/803016?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/benjamincburns",
    "html_url": "https://github.com/benjamincburns",
    "followers_url": "https://api.github.com/users/benjamincburns/followers",
    "following_url": "https://api.github.com/users/benjamincburns/following{/other_user}",
    "gists_url": "https://api.github.com/users/benjamincburns/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/benjamincburns/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/benjamincburns/subscriptions",
    "organizations_url": "https://api.github.com/users/benjamincburns/orgs",
    "repos_url": "https://api.github.com/users/benjamincburns/repos",
    "events_url": "https://api.github.com/users/benjamincburns/events{/privacy}",
    "received_events_url": "https://api.github.com/users/benjamincburns/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2058129555,
      "node_id": "MDU6TGFiZWwyMDU4MTI5NTU1",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/performance",
      "name": "performance",
      "color": "d29ce2",
      "default": false,
      "description": ""
    },
    {
      "id": 4164098293,
      "node_id": "LA_kwDODE2jmc74Mxj1",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/icebox",
      "name": "icebox",
      "color": "1D76DB",
      "default": false,
      "description": "items that need more consideration, time, or can wait"
    },
    {
      "id": 4328706977,
      "node_id": "LA_kwDODE2jmc8AAAABAgLToQ",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamChupa",
      "name": "TeamChupa",
      "color": "fbca04",
      "default": false,
      "description": "GH issues worked on by Chupacabara Team"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-05-28T23:28:32Z",
  "updated_at": "2023-03-07T17:29:15Z",
  "closed_at": "2023-03-07T17:29:14Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nAs an person running a Besu node, I want it to rate limit RPC requests when there are lots of pending requests that have not yet completed.\r\n\r\nToday it's fairly easy for me to run operations over RPC that cause a node to become bogged down and stop tracking the network head, or worse, to throw OOM exceptions and hang. In enterprise environments it's likely that nodes will be shared across many services/users. In this sort of environment, we don't want a surge in RPC traffic from one user to crash the node or deny service to other users who are keeping their traffic within expected limits.\r\n\r\n### Acceptance Criteria\r\n* RPC traffic can be submitted to Besu at any rate and Besu does not crash and does not stop tracking the head of the network.\r\n\r\n### Steps to Reproduce (Bug)\r\n1. Spam Besu with a ton of Transactions\r\nor\r\n3. Spam Besu with a ton of transaction trace requests\r\nor\r\n3. Spam basu with a ton of `eth_call` requests\r\n\r\n(there likely are plenty of other heavy RPC calls that will either cause crashes or cause the node to fall behind)\r\n\r\n**Expected behavior:**\r\nNode returns a rate limiting error response when it is too busy to process incoming RPC messages, or applies back-pressure on the request rte through some other means.\r\n\r\n**Actual behavior:**\r\nNode keeps trying to process RPC requests past the point where it can no longer maintain network state, or until it runs out of memory and hangs without crashing.\r\n\r\n**Frequency:**\r\nI expect in a large scale production environment this will be a common issue.\r\n\r\nRecently I've seen this happen on our test nodes when a misconfiguration caused RPC traffic to be sent to a node that wasn't spec'd to handle the load that was being put on it.\r\n\r\nI've also caused plenty of nodes to hang while running fixed-rate performance tests with Caliper.\r\n\r\n### Versions (Add all that apply)\r\n* Software version: 1.4.X (1.4.5 is current release)\r\n\r\n",
  "closed_by": {
    "login": "non-fungible-nelson",
    "id": 85905982,
    "node_id": "MDQ6VXNlcjg1OTA1OTgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/non-fungible-nelson",
    "html_url": "https://github.com/non-fungible-nelson",
    "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
    "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
    "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
    "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
    "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
    "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/1000/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/1000/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1458558965",
    "html_url": "https://github.com/hyperledger/besu/issues/1000#issuecomment-1458558965",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1000",
    "id": 1458558965,
    "node_id": "IC_kwDODE2jmc5W79f1",
    "user": {
      "login": "non-fungible-nelson",
      "id": 85905982,
      "node_id": "MDQ6VXNlcjg1OTA1OTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/non-fungible-nelson",
      "html_url": "https://github.com/non-fungible-nelson",
      "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
      "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
      "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
      "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
      "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
      "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-07T17:29:14Z",
    "updated_at": "2023-03-07T17:29:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "we now limit RPC with this #4965 which is user configurable with some sensible defaults. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1458558965/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
