{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/2436",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/2436/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/2436/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/2436/events",
  "html_url": "https://github.com/hyperledger/besu/issues/2436",
  "id": 921209983,
  "node_id": "MDU6SXNzdWU5MjEyMDk5ODM=",
  "number": 2436,
  "title": "Private Transaction compatibility with Ethereum MainNet",
  "user": {
    "login": "Viserius",
    "id": 8427677,
    "node_id": "MDQ6VXNlcjg0Mjc2Nzc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8427677?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Viserius",
    "html_url": "https://github.com/Viserius",
    "followers_url": "https://api.github.com/users/Viserius/followers",
    "following_url": "https://api.github.com/users/Viserius/following{/other_user}",
    "gists_url": "https://api.github.com/users/Viserius/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Viserius/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Viserius/subscriptions",
    "organizations_url": "https://api.github.com/users/Viserius/orgs",
    "repos_url": "https://api.github.com/users/Viserius/repos",
    "events_url": "https://api.github.com/users/Viserius/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Viserius/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362496,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDk2",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/enhancement",
      "name": "enhancement",
      "color": "a2eeef",
      "default": true,
      "description": "New feature or request"
    },
    {
      "id": 2152224197,
      "node_id": "MDU6TGFiZWwyMTUyMjI0MTk3",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamRevenant",
      "name": "TeamRevenant",
      "color": "78e298",
      "default": false,
      "description": "GH issues worked on by Revenant Team"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-06-15T09:43:52Z",
  "updated_at": "2021-06-22T08:18:32Z",
  "closed_at": "2021-06-22T08:18:32Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi all. I have been studying Besu's implementation of data privacy and believe I have an idea, or at least a first step, for making data privacy work on the Ethereum mainnet.\r\n\r\nI believe that the main reason private transactions are not compatible with the Ethereum MainNet right now, is because of the contents of the private transaction _marker_. A marker has the structure of any \"normal\" contract execution transaction. However, the payload of a marker is a simple hash and the smart contract address is a flag (such as 0x00000000) for Besu nodes to recognize the transaction as being a marker. \r\nUsually, these transactions contain a function name and arguments for the payload, and the address of a legitimate smart contract account (SCA).\r\n\r\nThus, as a first step for making it compatible on the Ethereum MainNet, we could do the following.\r\n\r\n1. The hash in the payload will be disguised as a normal function execution, i.e. `doNothing(0x2974842...)`. This would allow non-Besu nodes on the mainnet to execute the function (which does nothing), while Besu nodes simply fetch the private tx and execute it like we do now.\r\n2. The \"flag\" or address of the smart contract will be configurable. Then, we can deploy a smart contract on the MainNet using the do-nothing-function described earlier. The flag will be set to this address.\r\n\r\nI do not know if this is a feature you would be interested in, but it could definitely be an interesting option for those who simply want to use the MainNet, rather than maintaining their own network. Obviously, you still need to have private nodes. Simply wanted to express my idea on this possible enhancement.",
  "closed_by": {
    "login": "vmichalik",
    "id": 12459761,
    "node_id": "MDQ6VXNlcjEyNDU5NzYx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12459761?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/vmichalik",
    "html_url": "https://github.com/vmichalik",
    "followers_url": "https://api.github.com/users/vmichalik/followers",
    "following_url": "https://api.github.com/users/vmichalik/following{/other_user}",
    "gists_url": "https://api.github.com/users/vmichalik/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/vmichalik/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/vmichalik/subscriptions",
    "organizations_url": "https://api.github.com/users/vmichalik/orgs",
    "repos_url": "https://api.github.com/users/vmichalik/repos",
    "events_url": "https://api.github.com/users/vmichalik/events{/privacy}",
    "received_events_url": "https://api.github.com/users/vmichalik/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/2436/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/2436/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/864661077",
    "html_url": "https://github.com/hyperledger/besu/issues/2436#issuecomment-864661077",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2436",
    "id": 864661077,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NDY2MTA3Nw==",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-21T01:31:18Z",
    "updated_at": "2021-06-21T01:31:18Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @Viserius - Besu style private marker transactions are already mainnet compatible. The `to` contract address is not a flag as such, it's a legit address - for the precompile - more info here - https://besu.hyperledger.org/en/stable/Concepts/Privacy/Private-Transaction-Processing/",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/864661077/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/864799880",
    "html_url": "https://github.com/hyperledger/besu/issues/2436#issuecomment-864799880",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2436",
    "id": 864799880,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NDc5OTg4MA==",
    "user": {
      "login": "Viserius",
      "id": 8427677,
      "node_id": "MDQ6VXNlcjg0Mjc2Nzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8427677?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Viserius",
      "html_url": "https://github.com/Viserius",
      "followers_url": "https://api.github.com/users/Viserius/followers",
      "following_url": "https://api.github.com/users/Viserius/following{/other_user}",
      "gists_url": "https://api.github.com/users/Viserius/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Viserius/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Viserius/subscriptions",
      "organizations_url": "https://api.github.com/users/Viserius/orgs",
      "repos_url": "https://api.github.com/users/Viserius/repos",
      "events_url": "https://api.github.com/users/Viserius/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Viserius/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-21T07:32:12Z",
    "updated_at": "2021-06-21T07:32:12Z",
    "author_association": "NONE",
    "body": "Hi macfarla, thank you for coming back to me.\r\nI am aware the precompile address has the _format_ of a normal address, but does it also point to an actual Ethereum Smart Contract Account? While looking at the source code, I see that the precompile address [maps to the privacy address](https://github.com/hyperledger/besu/blob/0923de90d60d57b2624ace35eedb096ad3875cb3/ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/privacy/methods/priv/PrivGetPrivacyPrecompileAddress.java#L41). This privacy address [maps to Address.PRIVACY](https://github.com/hyperledger/besu/blob/0923de90d60d57b2624ace35eedb096ad3875cb3/ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/PrivacyParameters.java#L63) which [is always the constant 126 (or 0x000000000000000000000000000000000000007e)](https://github.com/hyperledger/besu/blob/0923de90d60d57b2624ace35eedb096ad3875cb3/ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/Address.java#L55). This is not an actual smart contract on the MainNet (Etherscan). Should we not set this option to be configurable, such that regular (non-Besu) nodes on the MainNet see this as a proper message call that can be executed (but simply does not modify the ledger's state, i.e. empty function body)?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/864799880/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/865188109",
    "html_url": "https://github.com/hyperledger/besu/issues/2436#issuecomment-865188109",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2436",
    "id": 865188109,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NTE4ODEwOQ==",
    "user": {
      "login": "vmichalik",
      "id": 12459761,
      "node_id": "MDQ6VXNlcjEyNDU5NzYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12459761?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vmichalik",
      "html_url": "https://github.com/vmichalik",
      "followers_url": "https://api.github.com/users/vmichalik/followers",
      "following_url": "https://api.github.com/users/vmichalik/following{/other_user}",
      "gists_url": "https://api.github.com/users/vmichalik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vmichalik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vmichalik/subscriptions",
      "organizations_url": "https://api.github.com/users/vmichalik/orgs",
      "repos_url": "https://api.github.com/users/vmichalik/repos",
      "events_url": "https://api.github.com/users/vmichalik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vmichalik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-21T16:47:09Z",
    "updated_at": "2021-06-21T16:47:09Z",
    "author_association": "NONE",
    "body": "Hi Viserius, I think you might misunderstand how a precompile works - it isn't deployed to a network but exists natively inside the client's EVM implementation. In this case it doesn't affect the public state differently on Besu, it just goes on to make calls to the Private Transaction manager and update the private state. This means it is actually a valid transaction on mainnet (it has also been extensively tested on Ropsten). See the order of operations in Sally's documentation link above for more.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/865188109/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/865655498",
    "html_url": "https://github.com/hyperledger/besu/issues/2436#issuecomment-865655498",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2436",
    "id": 865655498,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NTY1NTQ5OA==",
    "user": {
      "login": "Viserius",
      "id": 8427677,
      "node_id": "MDQ6VXNlcjg0Mjc2Nzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8427677?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Viserius",
      "html_url": "https://github.com/Viserius",
      "followers_url": "https://api.github.com/users/Viserius/followers",
      "following_url": "https://api.github.com/users/Viserius/following{/other_user}",
      "gists_url": "https://api.github.com/users/Viserius/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Viserius/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Viserius/subscriptions",
      "organizations_url": "https://api.github.com/users/Viserius/orgs",
      "repos_url": "https://api.github.com/users/Viserius/repos",
      "events_url": "https://api.github.com/users/Viserius/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Viserius/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-22T07:05:23Z",
    "updated_at": "2021-06-22T07:05:23Z",
    "author_association": "NONE",
    "body": "Hi, thank you for coming back to me. I am aware of the precompile, but I was under the impression that you cannot submit a message call with an arbitrary payload structure to a non-SCA address, since non-Besu nodes likely do not have the precompile. After revisiting my test for the Ropsten network, it seems a typo snooped in that made me believe this. After resolving it, I indeed verify that marker transactions can be submitted to non-Besu nodes on the Ropsten network with an arbitrary payload to an arbitrary address. I apologize for the confusion and appreciate the help, thank you! This takes away the necessity of the alternative approach I came up with.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/865655498/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/865703669",
    "html_url": "https://github.com/hyperledger/besu/issues/2436#issuecomment-865703669",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2436",
    "id": 865703669,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NTcwMzY2OQ==",
    "user": {
      "login": "vmichalik",
      "id": 12459761,
      "node_id": "MDQ6VXNlcjEyNDU5NzYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12459761?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vmichalik",
      "html_url": "https://github.com/vmichalik",
      "followers_url": "https://api.github.com/users/vmichalik/followers",
      "following_url": "https://api.github.com/users/vmichalik/following{/other_user}",
      "gists_url": "https://api.github.com/users/vmichalik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vmichalik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vmichalik/subscriptions",
      "organizations_url": "https://api.github.com/users/vmichalik/orgs",
      "repos_url": "https://api.github.com/users/vmichalik/repos",
      "events_url": "https://api.github.com/users/vmichalik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vmichalik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-22T08:18:32Z",
    "updated_at": "2021-06-22T08:18:32Z",
    "author_association": "NONE",
    "body": "Ok, great!",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/865703669/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
