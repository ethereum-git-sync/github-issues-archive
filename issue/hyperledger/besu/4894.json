{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/4894",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/4894/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/4894/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/4894/events",
  "html_url": "https://github.com/hyperledger/besu/issues/4894",
  "id": 1525100833,
  "node_id": "I_kwDODE2jmc5a5zEh",
  "number": 4894,
  "title": "Ability to add SNI header in TLS ClientHello message",
  "user": {
    "login": "wilsonfv",
    "id": 4541194,
    "node_id": "MDQ6VXNlcjQ1NDExOTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4541194?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wilsonfv",
    "html_url": "https://github.com/wilsonfv",
    "followers_url": "https://api.github.com/users/wilsonfv/followers",
    "following_url": "https://api.github.com/users/wilsonfv/following{/other_user}",
    "gists_url": "https://api.github.com/users/wilsonfv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wilsonfv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wilsonfv/subscriptions",
    "organizations_url": "https://api.github.com/users/wilsonfv/orgs",
    "repos_url": "https://api.github.com/users/wilsonfv/repos",
    "events_url": "https://api.github.com/users/wilsonfv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wilsonfv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362500,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNTAw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "7057ff",
      "default": true,
      "description": "Good for newcomers"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-01-09T07:58:24Z",
  "updated_at": "2023-05-10T05:47:15Z",
  "closed_at": "2023-05-10T05:47:14Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nWhen join a network / connect to another node, as an INITIATOR during first plain handshake message, I want to add [SNI header](https://datatracker.ietf.org/doc/html/rfc6066#section-3) in TLS [ClientHello](https://datatracker.ietf.org/doc/html/rfc5246#section-7.4.1.2) message so that Target Server can return correct certificate by reading TLS SNI header. \r\n\r\nModern Server may host multiple virtual hostnames. In order to return correct TLS certificate to client, client may add SNI header during TLS clientHello. This is common industry solution to resolve one server hosting multiple virtual hostnames problem. \r\n\r\nExisting P2P RLPx agent does not add SNI header when constructing TLS ClientHello.  \r\n\r\nhttps://github.com/hyperledger/besu/blob/7c926d20ae1b9a8cdba6a7c44a5d0817e86ff541/ethereum/p2p/src/main/java/org/hyperledger/besu/ethereum/p2p/rlpx/RlpxAgent.java#L333-L349\r\n\r\nhttps://github.com/hyperledger/besu/blob/1b45cac3795c59b52a8fcd2126ac4bed6943f537/ethereum/p2p/src/main/java/org/hyperledger/besu/ethereum/p2p/rlpx/connections/netty/NettyTLSConnectionInitializer.java#L93-L102\r\n\r\nIn order to add SNI header in TLS ClientHello, NettyTLSConnectionInitializer should call another implementation of [sslContext.newHandler](https://github.com/netty/netty/blob/6c81a3fa025f31bc0308d7913f8ecbf540f99247/handler/src/main/java/io/netty/handler/ssl/SslContext.java#L1008-L1010)\r\n\r\n```\r\n    public final SslHandler newHandler(ByteBufAllocator alloc, String peerHost, int peerPort) {\r\n        return newHandler(alloc, peerHost, peerPort, startTls);\r\n    }\r\n```\r\n\r\nWe could add a new command line option in Besu to enable this feature. Such as proposed [command line option](https://besu.hyperledger.org/en/stable/public-networks/reference/cli/options/) `p2p-tls-clienthello-sni`, once this is enabled, SNI header will be added in TLS ClientHello. Default behavior is disabled.\r\n\r\n### Acceptance Criteria\r\nIf besu command line option `p2p-tls-clienthello-sni` is enabled, RLPx agent will add SNI header in TLS ClientHello message.\r\n",
  "closed_by": {
    "login": "macfarla",
    "id": 2627919,
    "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/macfarla",
    "html_url": "https://github.com/macfarla",
    "followers_url": "https://api.github.com/users/macfarla/followers",
    "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
    "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
    "organizations_url": "https://api.github.com/users/macfarla/orgs",
    "repos_url": "https://api.github.com/users/macfarla/repos",
    "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
    "received_events_url": "https://api.github.com/users/macfarla/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/4894/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/4894/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1405127364",
    "html_url": "https://github.com/hyperledger/besu/issues/4894#issuecomment-1405127364",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4894",
    "id": 1405127364,
    "node_id": "IC_kwDODE2jmc5TwIrE",
    "user": {
      "login": "non-fungible-nelson",
      "id": 85905982,
      "node_id": "MDQ6VXNlcjg1OTA1OTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/non-fungible-nelson",
      "html_url": "https://github.com/non-fungible-nelson",
      "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
      "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
      "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
      "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
      "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
      "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-26T14:51:53Z",
    "updated_at": "2023-01-28T13:25:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi there - thank you for requesting this! This is a great issue for a new contributor to pick up. It is likely the Maintainers cannot pick this up at this time. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1405127364/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1407307929",
    "html_url": "https://github.com/hyperledger/besu/issues/4894#issuecomment-1407307929",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4894",
    "id": 1407307929,
    "node_id": "IC_kwDODE2jmc5T4dCZ",
    "user": {
      "login": "atoulme",
      "id": 16758,
      "node_id": "MDQ6VXNlcjE2NzU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16758?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/atoulme",
      "html_url": "https://github.com/atoulme",
      "followers_url": "https://api.github.com/users/atoulme/followers",
      "following_url": "https://api.github.com/users/atoulme/following{/other_user}",
      "gists_url": "https://api.github.com/users/atoulme/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/atoulme/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/atoulme/subscriptions",
      "organizations_url": "https://api.github.com/users/atoulme/orgs",
      "repos_url": "https://api.github.com/users/atoulme/repos",
      "events_url": "https://api.github.com/users/atoulme/events{/privacy}",
      "received_events_url": "https://api.github.com/users/atoulme/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-28T06:26:24Z",
    "updated_at": "2023-01-28T06:26:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm sorry, I'm unsure why I'm tagged on this issue. I have no insight into this work.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1407307929/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
