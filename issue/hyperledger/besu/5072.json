{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/5072",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/5072/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/5072/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/5072/events",
  "html_url": "https://github.com/hyperledger/besu/issues/5072",
  "id": 1576787351,
  "node_id": "I_kwDODE2jmc5d-92X",
  "number": 5072,
  "title": "No buffer space available",
  "user": {
    "login": "estensen",
    "id": 9142800,
    "node_id": "MDQ6VXNlcjkxNDI4MDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9142800?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/estensen",
    "html_url": "https://github.com/estensen",
    "followers_url": "https://api.github.com/users/estensen/followers",
    "following_url": "https://api.github.com/users/estensen/following{/other_user}",
    "gists_url": "https://api.github.com/users/estensen/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/estensen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/estensen/subscriptions",
    "organizations_url": "https://api.github.com/users/estensen/orgs",
    "repos_url": "https://api.github.com/users/estensen/repos",
    "events_url": "https://api.github.com/users/estensen/events{/privacy}",
    "received_events_url": "https://api.github.com/users/estensen/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 3013559202,
      "node_id": "MDU6TGFiZWwzMDEzNTU5MjAy",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/mainnet",
      "name": "mainnet",
      "color": "9D578C",
      "default": false,
      "description": ""
    },
    {
      "id": 3932728358,
      "node_id": "LA_kwDODE2jmc7qaKwm",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/syncing",
      "name": "syncing",
      "color": "ECC431",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-02-08T20:55:43Z",
  "updated_at": "2023-02-16T13:10:27Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Mainnet\r\nv22.10.3\r\nCheckpoint sync\r\nBonsai\r\nPaired with Lighthouse\r\n\r\nRe-syncing from scratch after experiencing [Internal error, backward sync completed but failed to import finalized block](https://github.com/hyperledger/besu/issues/5053)\r\nAlso getting a lot of [Best peer has chain height below pivotBlock height hangs](https://github.com/hyperledger/besu/issues/4725)\r\n\r\n```\r\ntrace: io.netty.channel.unix.Errors$NativeIoException: sendToAddress(..) failed: No buffer space available\r\n2023-02-07 22:25:59.488+01:00 | vert.x-eventloop-thread-1 | WARN  | VertxPeerDiscoveryAgent | Sending to peer DiscoveryPeer{status=bonding, enode=enode://ea6b729b46180aba4b968327f3f4cc25c8780381a6169560f9e4108a7e4e76d3592c71eb65390fdf3dc1b7e09ef7bba781d9a47fbe0ddc7f5cd4fe168e9aa7c1@62.210.122.19:59998, firstDiscovered=1675805159488, lastContacted=0, lastSeen=1675805159488} failed, native error code -55, packet: 0x553c7a063aa9a90dd5d0243034c7eabf338c4f977a167e15f1f81c1557bedfcf36ad3022c1409d39009d14a24aa407c0a29c05e2c40480882009c27670c88c0956a56f7aeb9a58038ff28704baf4a8b532d47bbbf3dcad299ded384829e837540001df05cb847f00000182765f82765fcb843ed27a1382ea5e82ea5e8463e2c22303, stacktrace: io.netty.channel.unix.Errors$NativeIoException: sendToAddress(..) failed: No buffer space available\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/5072/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/5072/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1423445662",
    "html_url": "https://github.com/hyperledger/besu/issues/5072#issuecomment-1423445662",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5072",
    "id": 1423445662,
    "node_id": "IC_kwDODE2jmc5U2A6e",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-09T00:46:56Z",
    "updated_at": "2023-02-09T00:46:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "This is a pretty low-level exception, I've never seen this with Besu before.\r\nThis indicates it might be related to resource limitation or exhaustion? https://stackoverflow.com/questions/6068423/java-net-socketexception-no-buffer-space-available-maximum-connections-reached\r\nCan you give more info about your OS etc? besu config? \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1423445662/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1423720237",
    "html_url": "https://github.com/hyperledger/besu/issues/5072#issuecomment-1423720237",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5072",
    "id": 1423720237,
    "node_id": "IC_kwDODE2jmc5U3D8t",
    "user": {
      "login": "estensen",
      "id": 9142800,
      "node_id": "MDQ6VXNlcjkxNDI4MDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9142800?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/estensen",
      "html_url": "https://github.com/estensen",
      "followers_url": "https://api.github.com/users/estensen/followers",
      "following_url": "https://api.github.com/users/estensen/following{/other_user}",
      "gists_url": "https://api.github.com/users/estensen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/estensen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/estensen/subscriptions",
      "organizations_url": "https://api.github.com/users/estensen/orgs",
      "repos_url": "https://api.github.com/users/estensen/repos",
      "events_url": "https://api.github.com/users/estensen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/estensen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-09T06:53:32Z",
    "updated_at": "2023-02-09T06:54:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "I do run a pretty minimalist node. A M1 Mac Mini with 8GB RAM which is shared between Besu and Lighthouse. I accept that that might cause issues. \r\n\r\n```\r\nJAVA_OPTS=-Xmx3g besu-22.7.4/bin/besu\r\n  --network=mainnet --data-storage-format=bonsai\r\n  --sync-mode=X_CHECKPOINT\r\n  --data-path=/Volumes/WD_BLACK\\ SN750\\ 2TB/besu\r\n  --engine-jwt-secret=/var/lib/jwtsecret/jwt.hex\r\n  --nat-method=auto\r\n  --p2p-host \r\n  --p2p-interface\r\n  --metrics-enabled\r\n```\r\n\r\nCPU is 90% idle and I'm using 1-2GB swap now while re-syncing, which is pretty similar to when operational.\r\n\r\nAre you running any setup similar to this testing new releases?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1423720237/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1432524932",
    "html_url": "https://github.com/hyperledger/besu/issues/5072#issuecomment-1432524932",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5072",
    "id": 1432524932,
    "node_id": "IC_kwDODE2jmc5VYpiE",
    "user": {
      "login": "shemnon",
      "id": 38109,
      "node_id": "MDQ6VXNlcjM4MTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shemnon",
      "html_url": "https://github.com/shemnon",
      "followers_url": "https://api.github.com/users/shemnon/followers",
      "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
      "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
      "organizations_url": "https://api.github.com/users/shemnon/orgs",
      "repos_url": "https://api.github.com/users/shemnon/repos",
      "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shemnon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-16T05:14:59Z",
    "updated_at": "2023-02-16T05:14:59Z",
    "author_association": "MEMBER",
    "body": "I run a similar setup just fine except on a 16 GB M1 mac mini.  I expect the issue is with the available RAM.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1432524932/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1433058131",
    "html_url": "https://github.com/hyperledger/besu/issues/5072#issuecomment-1433058131",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5072",
    "id": 1433058131,
    "node_id": "IC_kwDODE2jmc5VartT",
    "user": {
      "login": "ahamlat",
      "id": 5099602,
      "node_id": "MDQ6VXNlcjUwOTk2MDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5099602?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahamlat",
      "html_url": "https://github.com/ahamlat",
      "followers_url": "https://api.github.com/users/ahamlat/followers",
      "following_url": "https://api.github.com/users/ahamlat/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahamlat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahamlat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahamlat/subscriptions",
      "organizations_url": "https://api.github.com/users/ahamlat/orgs",
      "repos_url": "https://api.github.com/users/ahamlat/repos",
      "events_url": "https://api.github.com/users/ahamlat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahamlat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-16T13:04:16Z",
    "updated_at": "2023-02-16T13:10:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "I did some tests on 8 GiB VMs with 4 cores, I didn't notice such error, but in your case, it seems to be definitely related to available RAM (used by the OS on system cache and IO buffers).\r\nWith 8 GiB machine/VM, Besu should work fine on non RPC node but performances will be affected, because Besu is IO Bound especially during sync. With almost no system cache and probably some swapping activity, Block processing time will be affected. Furthermore, Besu can consume more than 3 GiB defined in -Xmx as its embedded database use a native memory.\r\nI used to recommend for solo stakers 16 GiB RAM if they want to run the CL and the EL on the same machine and avoid performance degradation on block processing.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1433058131/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
