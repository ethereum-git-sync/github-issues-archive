{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/1580",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/1580/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/1580/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/1580/events",
  "html_url": "https://github.com/hyperledger/besu/issues/1580",
  "id": 745124744,
  "node_id": "MDU6SXNzdWU3NDUxMjQ3NDQ=",
  "number": 1580,
  "title": "Feature Request: add total difficulty and other \"current\" peer info to `admin_peers` RPC",
  "user": {
    "login": "ryanschneider",
    "id": 53520,
    "node_id": "MDQ6VXNlcjUzNTIw",
    "avatar_url": "https://avatars.githubusercontent.com/u/53520?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ryanschneider",
    "html_url": "https://github.com/ryanschneider",
    "followers_url": "https://api.github.com/users/ryanschneider/followers",
    "following_url": "https://api.github.com/users/ryanschneider/following{/other_user}",
    "gists_url": "https://api.github.com/users/ryanschneider/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ryanschneider/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ryanschneider/subscriptions",
    "organizations_url": "https://api.github.com/users/ryanschneider/orgs",
    "repos_url": "https://api.github.com/users/ryanschneider/repos",
    "events_url": "https://api.github.com/users/ryanschneider/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ryanschneider/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362496,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDk2",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/enhancement",
      "name": "enhancement",
      "color": "a2eeef",
      "default": true,
      "description": "New feature or request"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "shemnon",
    "id": 38109,
    "node_id": "MDQ6VXNlcjM4MTA5",
    "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/shemnon",
    "html_url": "https://github.com/shemnon",
    "followers_url": "https://api.github.com/users/shemnon/followers",
    "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
    "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
    "organizations_url": "https://api.github.com/users/shemnon/orgs",
    "repos_url": "https://api.github.com/users/shemnon/repos",
    "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/shemnon/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "shemnon",
      "id": 38109,
      "node_id": "MDQ6VXNlcjM4MTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shemnon",
      "html_url": "https://github.com/shemnon",
      "followers_url": "https://api.github.com/users/shemnon/followers",
      "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
      "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
      "organizations_url": "https://api.github.com/users/shemnon/orgs",
      "repos_url": "https://api.github.com/users/shemnon/repos",
      "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shemnon/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2020-11-17T22:09:57Z",
  "updated_at": "2022-03-22T06:52:30Z",
  "closed_at": "2020-12-02T01:02:30Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!-- Have you done the following? -->\r\n<!--   * read the Code of Conduct? By filing an Issue, you are expected to -->  \r\n<!--     comply with it, including treating everyone with respect: -->\r\n<!--     https://github.com/hyperledger/besu/blob/master/CODE-OF-CONDUCT.md -->\r\n<!--   * Reproduced the issue in the latest version of the software -->\r\n<!--   * Read the debugging wiki: https://github.com/hyperledger/besu/wiki/debugging -->\r\n<!--   * Duplicate Issue check:  https://github.com/search?q=+is%3Aissue+repo%3Ahyperledger/Besu -->\r\n<!-- Note:  Not all sections will apply to all issue types. -->\r\n\r\n### Description\r\n\r\nAs an operator of a `besu` node, I want to see what block my peers are synced to so that I know that I'm connected to quality peers (and am receiving the blocks correctly).\r\n\r\nI think it would be useful for the `admin_peers` RPC to return some \"current\" state of peers in addition to the \"static\" state of peers.\r\n\r\nFor example, in `geth`, each peer entry returned by `admin_peers` also includes a `protocols` section which includes data about the current `eth`:\r\n\r\n\r\n```\r\n[\r\n  ...,\r\n  {\r\n     ...\r\n     protocols: {\r\n      eth: {\r\n        difficulty: 1.8776698526694168e+22,\r\n        head: \"0x1dadd5a337feec81c4c73af022df4825191aaa23037d3f2d25bbc3a80c44c956\",\r\n        version: 65\r\n      }\r\n    }\r\n  }\r\n]\r\n```\r\n\r\nThis data can be used to:\r\n\r\n- Determine the \"quality\" of ones peers.  For example an external process could use this data in conjunction with `admin_removePeer` to disconnect from peers that appear \"stalled\" at a single difficulty for an extended period of time.\r\n- Help diagnose that _my_ client is operating correctly.  For example, if my peers continue to report increasing difficulties but my local node seems stuck at the same block number this may indicate an issue with block propagation or that my node is on a different fork than most of my peers.\r\n\r\nI know the `admin` namespace is not standardized in any real way, so fully understand `besu` not including this data, and I'm of course open to this data being returned via a different RPC or a slightly different version than `geth` or other nodes (for example, I'd actually _prefer_ if `besu` returned the total difficulty as a hex string rather than a JSON number).\r\n\r\nThe tricky part, IMO, is that `admin_peers` currently returns an array of `PeerInfo` data defined here: https://github.com/hyperledger/besu/blob/ccefada736850eee6db58d1503f079482ff254a0/ethereum/p2p/src/main/java/org/hyperledger/besu/ethereum/p2p/rlpx/wire/PeerInfo.java#L38\r\n\r\nI'm not familiar enough with the code to know if there's another data source that includes data like the peer's current total difficulty, if that data is available it would need to be folded into the `List<PeerResult>` response generated here:  https://github.com/hyperledger/besu/blob/ccefada736850eee6db58d1503f079482ff254a0/ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/AdminPeers.java#L46\r\n\r\n### Acceptance Criteria\r\n\r\nIn my opinion any RPC that allowed one to view the state of peers would be acceptable.\r\n\r\n### Steps to Reproduce (Bug)\r\n1. Issue an `admin_peers` RPC to a `besu` node\r\n2.Note that each peer entry does not include \"current\" data about the peer such as the eth/65 total difficulty.\r\n\r\n**Expected behavior:** [What you expect to happen]\r\n\r\nEither add the `protocol` data to `admin_peers` or provide another means to inspect the current state of `besu` peers.\r\n\r\n**Actual behavior:** [What actually happens]\r\n\r\nCurrently there's no way to query the state of `besu` peers.\r\n\r\n**Frequency:** [What percentage of the time does it occur?]\r\n\r\nAlways\r\n\r\n### Versions (Add all that apply)\r\n\r\nCurrent master, though I suspect all previous versions as well.\r\n\r\n",
  "closed_by": {
    "login": "shemnon",
    "id": 38109,
    "node_id": "MDQ6VXNlcjM4MTA5",
    "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/shemnon",
    "html_url": "https://github.com/shemnon",
    "followers_url": "https://api.github.com/users/shemnon/followers",
    "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
    "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
    "organizations_url": "https://api.github.com/users/shemnon/orgs",
    "repos_url": "https://api.github.com/users/shemnon/repos",
    "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/shemnon/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/1580/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/1580/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/733987507",
    "html_url": "https://github.com/hyperledger/besu/issues/1580#issuecomment-733987507",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1580",
    "id": 733987507,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMzk4NzUwNw==",
    "user": {
      "login": "shemnon",
      "id": 38109,
      "node_id": "MDQ6VXNlcjM4MTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shemnon",
      "html_url": "https://github.com/shemnon",
      "followers_url": "https://api.github.com/users/shemnon/followers",
      "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
      "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
      "organizations_url": "https://api.github.com/users/shemnon/orgs",
      "repos_url": "https://api.github.com/users/shemnon/repos",
      "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shemnon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-25T23:19:31Z",
    "updated_at": "2020-11-25T23:23:31Z",
    "author_association": "MEMBER",
    "body": "Here's a sample peer from the new endpoint:\r\n```\r\n        {\r\n            \"version\": \"0x5\",\r\n            \"name\": \"Geth/v1.9.24-stable-cc05b050/linux-amd64/go1.15.5\",\r\n            \"caps\": [\r\n                \"eth/63\",\r\n                \"eth/64\",\r\n                \"eth/65\"\r\n            ],\r\n            \"network\": {\r\n                \"localAddress\": \"10.0.2.18:46958\",\r\n                \"remoteAddress\": \"116.255.13.69:30303\"\r\n            },\r\n            \"port\": \"0x0\",\r\n            \"id\": \"0x465719d28b6defe69eb5e3d16d4786788fdb13bbf9630692e51aeb6baac39d85829ed62b7d2510f19949631b1b9596a4c13a2740c4eeeb374620e4db6eecf976\",\r\n            \"protocols\": {\r\n                \"eth\": {\r\n                    \"difficulty\": \"0x403d1d5ac261b926509\",\r\n                    \"head\": \"0xcdc4fd3720fe60ba4a7235bc4a0d72f9d411a58d4b0a7d7efebce251780cd83c\",\r\n                    \"version\": 64\r\n                }\r\n            }\r\n        },\r\n```\r\n\r\nThe new section `\"protocols\"` is a map where `\"eth\"` is the only expected entry.  The three parameters are self reported by the peer.  \r\n* `\"difficulty\"` is the reported total difficulty of the peer (the sum of each difficulty field of all prior blocks).  Ours is in hex so we don't lose precision like Geth's float version. (customer request) \r\n* `\"head\"` is the hash of the head that peer is using, \r\n* `\"version\"` is the version of the protocol we are communicating with for the peer (may not be the highest level).  In theory the map key plus this field like `\"{key}/{version}\"` should be a member of the `\"caps\"` array.\r\n\r\nThis is new in 20.10.2.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/733987507/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/733989262",
    "html_url": "https://github.com/hyperledger/besu/issues/1580#issuecomment-733989262",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1580",
    "id": 733989262,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMzk4OTI2Mg==",
    "user": {
      "login": "ryanschneider",
      "id": 53520,
      "node_id": "MDQ6VXNlcjUzNTIw",
      "avatar_url": "https://avatars.githubusercontent.com/u/53520?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ryanschneider",
      "html_url": "https://github.com/ryanschneider",
      "followers_url": "https://api.github.com/users/ryanschneider/followers",
      "following_url": "https://api.github.com/users/ryanschneider/following{/other_user}",
      "gists_url": "https://api.github.com/users/ryanschneider/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ryanschneider/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ryanschneider/subscriptions",
      "organizations_url": "https://api.github.com/users/ryanschneider/orgs",
      "repos_url": "https://api.github.com/users/ryanschneider/repos",
      "events_url": "https://api.github.com/users/ryanschneider/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ryanschneider/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-25T23:26:16Z",
    "updated_at": "2020-11-25T23:26:16Z",
    "author_association": "NONE",
    "body": "Awesome thanks @shemnon this is perfect!  I would definitely consider this feature request completed.  I'll let you all close the issue though since not sure what your process is and don't want to interfere.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/733989262/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/733991991",
    "html_url": "https://github.com/hyperledger/besu/issues/1580#issuecomment-733991991",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1580",
    "id": 733991991,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMzk5MTk5MQ==",
    "user": {
      "login": "shemnon",
      "id": 38109,
      "node_id": "MDQ6VXNlcjM4MTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shemnon",
      "html_url": "https://github.com/shemnon",
      "followers_url": "https://api.github.com/users/shemnon/followers",
      "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
      "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
      "organizations_url": "https://api.github.com/users/shemnon/orgs",
      "repos_url": "https://api.github.com/users/shemnon/repos",
      "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shemnon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-25T23:37:18Z",
    "updated_at": "2020-11-25T23:37:18Z",
    "author_association": "MEMBER",
    "body": "We have it open to update the docs.  We have some sample RPCs that will need an update.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/733991991/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/736904518",
    "html_url": "https://github.com/hyperledger/besu/issues/1580#issuecomment-736904518",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1580",
    "id": 736904518,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNjkwNDUxOA==",
    "user": {
      "login": "MadelineMurray",
      "id": 43356962,
      "node_id": "MDQ6VXNlcjQzMzU2OTYy",
      "avatar_url": "https://avatars.githubusercontent.com/u/43356962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MadelineMurray",
      "html_url": "https://github.com/MadelineMurray",
      "followers_url": "https://api.github.com/users/MadelineMurray/followers",
      "following_url": "https://api.github.com/users/MadelineMurray/following{/other_user}",
      "gists_url": "https://api.github.com/users/MadelineMurray/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MadelineMurray/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MadelineMurray/subscriptions",
      "organizations_url": "https://api.github.com/users/MadelineMurray/orgs",
      "repos_url": "https://api.github.com/users/MadelineMurray/repos",
      "events_url": "https://api.github.com/users/MadelineMurray/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MadelineMurray/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-02T00:20:41Z",
    "updated_at": "2020-12-02T00:20:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "Raised https://github.com/hyperledger/besu-docs/issues/562 to doc. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/736904518/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/736918849",
    "html_url": "https://github.com/hyperledger/besu/issues/1580#issuecomment-736918849",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1580",
    "id": 736918849,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNjkxODg0OQ==",
    "user": {
      "login": "shemnon",
      "id": 38109,
      "node_id": "MDQ6VXNlcjM4MTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shemnon",
      "html_url": "https://github.com/shemnon",
      "followers_url": "https://api.github.com/users/shemnon/followers",
      "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
      "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
      "organizations_url": "https://api.github.com/users/shemnon/orgs",
      "repos_url": "https://api.github.com/users/shemnon/repos",
      "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shemnon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-02T01:02:30Z",
    "updated_at": "2020-12-02T01:02:30Z",
    "author_association": "MEMBER",
    "body": "With that doc issue I'll close this out.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/736918849/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
