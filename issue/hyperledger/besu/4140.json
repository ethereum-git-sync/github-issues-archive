{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/4140",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/4140/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/4140/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/4140/events",
  "html_url": "https://github.com/hyperledger/besu/issues/4140",
  "id": 1312246967,
  "node_id": "I_kwDODE2jmc5ON0y3",
  "number": 4140,
  "title": "Conflicting Pivot Blocks on Ropsten",
  "user": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3013559202,
      "node_id": "MDU6TGFiZWwzMDEzNTU5MjAy",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/mainnet",
      "name": "mainnet",
      "color": "9D578C",
      "default": false,
      "description": ""
    },
    {
      "id": 3932728358,
      "node_id": "LA_kwDODE2jmc7qaKwm",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/syncing",
      "name": "syncing",
      "color": "ECC431",
      "default": false,
      "description": ""
    },
    {
      "id": 4328706977,
      "node_id": "LA_kwDODE2jmc8AAAABAgLToQ",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamChupa",
      "name": "TeamChupa",
      "color": "fbca04",
      "default": false,
      "description": "GH issues worked on by Chupacabara Team"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "matkt",
    "id": 26581503,
    "node_id": "MDQ6VXNlcjI2NTgxNTAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/26581503?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/matkt",
    "html_url": "https://github.com/matkt",
    "followers_url": "https://api.github.com/users/matkt/followers",
    "following_url": "https://api.github.com/users/matkt/following{/other_user}",
    "gists_url": "https://api.github.com/users/matkt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/matkt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/matkt/subscriptions",
    "organizations_url": "https://api.github.com/users/matkt/orgs",
    "repos_url": "https://api.github.com/users/matkt/repos",
    "events_url": "https://api.github.com/users/matkt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/matkt/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "matkt",
      "id": 26581503,
      "node_id": "MDQ6VXNlcjI2NTgxNTAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/26581503?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matkt",
      "html_url": "https://github.com/matkt",
      "followers_url": "https://api.github.com/users/matkt/followers",
      "following_url": "https://api.github.com/users/matkt/following{/other_user}",
      "gists_url": "https://api.github.com/users/matkt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matkt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matkt/subscriptions",
      "organizations_url": "https://api.github.com/users/matkt/orgs",
      "repos_url": "https://api.github.com/users/matkt/repos",
      "events_url": "https://api.github.com/users/matkt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matkt/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-07-21T01:09:25Z",
  "updated_at": "2022-11-02T18:06:09Z",
  "closed_at": "2022-11-02T18:06:09Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\r\nBesu 22.4.0 is failing to sync on Ropsten because it's getting conflicting pivot block headers from it's peers:\r\n\r\n```\r\n2022-07-20 21:00:47.840+00:00 | nioEventLoopGroup-3-8 | INFO  | PivotBlockRetriever | Received conflicting pivot blocks for 11658432.\r\n2022-07-20 21:00:47.840+00:00 | nioEventLoopGroup-3-8 | INFO  | PivotBlockRetriever | Move pivot block back to 11658382 and retry.\r\n2022-07-20 21:00:47.840+00:00 | nioEventLoopGroup-3-8 | INFO  | PivotBlockConfirmer | Confirm pivot block 11658382 with at least 5 peers.\r\n2022-07-20 21:00:47.852+00:00 | nioEventLoopGroup-3-4 | INFO  | PivotBlockConfirmer | Received 1 confirmation(s) for pivot block header 11658382: 0x9f6a0432a46914a6466dd039b158ed3c5202c4a9a2519672ab4bfa61dddd8ff1\r\n2022-07-20 21:00:47.918+00:00 | nioEventLoopGroup-3-10 | INFO  | PivotBlockConfirmer | Received 2 confirmation(s) for pivot block header 11658382: 0x9f6a0432a46914a6466dd039b158ed3c5202c4a9a2519672ab4bfa61dddd8ff1\r\n2022-07-20 21:00:47.938+00:00 | nioEventLoopGroup-3-8 | INFO  | PivotBlockConfirmer | Failed to confirm pivot block 11658382. Received conflicting headers: 0x9f6a0432a46914a6466dd039b158ed3c5202c4a9a2519672ab4bfa61dddd8ff1 (2),0x2236711f1\r\n137c7b1c53929b7108781b6eebcb786285e19fa21a42a1a4d129965 (1)\r\n2022-07-20 21:00:47.938+00:00 | nioEventLoopGroup-3-8 | INFO  | PivotBlockRetriever | Received conflicting pivot blocks for 11658382.\r\n2022-07-20 21:00:47.938+00:00 | nioEventLoopGroup-3-8 | INFO  | PivotBlockRetriever | Move pivot block back to 11658332 and retry.\r\n2022-07-20 21:00:47.938+00:00 | nioEventLoopGroup-3-8 | INFO  | PivotBlockConfirmer | Confirm pivot block 11658332 with at least 5 peers.\r\n2022-07-20 21:00:47.950+00:00 | nioEventLoopGroup-3-4 | INFO  | PivotBlockConfirmer | Received 1 confirmation(s) for pivot block header 11658332: 0x11a78db9e2616c2230ac30614e80ae3a4453b58be5092a14f9c6f20910aefb7a\r\n2022-07-20 21:00:48.015+00:00 | nioEventLoopGroup-3-10 | INFO  | PivotBlockConfirmer | Received 2 confirmation(s) for pivot block header 11658332: 0x11a78db9e2616c2230ac30614e80ae3a4453b58be5092a14f9c6f20910aefb7a\r\n2022-07-20 21:00:48.035+00:00 | nioEventLoopGroup-3-8 | INFO  | PivotBlockConfirmer | Failed to confirm pivot block 11658332. Received conflicting headers: 0xbd97dfc1f8e50441dae3072e46dfefbbb8a36e50324204b0f108454d043f296a (1),0x11a78db9e\r\n2616c2230ac30614e80ae3a4453b58be5092a14f9c6f20910aefb7a (2)\r\n2022-07-20 21:00:48.035+00:00 | nioEventLoopGroup-3-8 | INFO  | PivotBlockRetriever | Received conflicting pivot blocks for 11658332.\r\n2022-07-20 21:00:48.035+00:00 | nioEventLoopGroup-3-8 | INFO  | PivotBlockRetriever | Move pivot block back to 11658282 and retry.\r\n2022-07-20 21:00:48.035+00:00 | nioEventLoopGroup-3-8 | INFO  | PivotBlockConfirmer | Confirm pivot block 11658282 with at least 5 peers.\r\n2022-07-20 21:00:48.047+00:00 | nioEventLoopGroup-3-4 | INFO  | PivotBlockConfirmer | Received 1 confirmation(s) for pivot block header 11658282: 0xecaaf3af219931842fd06926b25ad2c7aed9798358d71eff6b5946bafc8927c8\r\n2022-07-20 21:00:48.113+00:00 | nioEventLoopGroup-3-10 | INFO  | PivotBlockConfirmer | Received 2 confirmation(s) for pivot block header 11658282: 0xecaaf3af219931842fd06926b25ad2c7aed9798358d71eff6b5946bafc8927c8\r\n2022-07-20 21:00:48.133+00:00 | nioEventLoopGroup-3-8 | INFO  | PivotBlockConfirmer | Failed to confirm pivot block 11658282. Received conflicting headers: 0x8c0ca212b71f26a40e56dc69cd80a80916a8acf3db70943f30e240427b2e17ae (1),0xecaaf3af219931842fd06926b25ad2c7aed9798358d71eff6b5946bafc8927c8 (2)\r\n2022-07-20 21:00:48.133+00:00 | nioEventLoopGroup-3-8 | INFO  | PivotBlockRetriever | Received conflicting pivot blocks for 11658282.\r\n2022-07-20 21:00:48.133+00:00 | nioEventLoopGroup-3-8 | INFO  | PivotBlockRetriever | Move pivot block back to 11658232 and retry.\r\n2022-07-20 21:00:48.133+00:00 | nioEventLoopGroup-3-8 | INFO  | PivotBlockConfirmer | Confirm pivot block 11658232 with at least 5 peers.\r\n2022-07-20 21:00:48.145+00:00 | nioEventLoopGroup-3-4 | INFO  | PivotBlockConfirmer | Received 1 confirmation(s) for pivot block header 11658232: 0x88f6f09f03f46b69b2380eb51e20d8acbf88613c693321cb5aadc123cace35de\r\n2022-07-20 21:00:48.211+00:00 | nioEventLoopGroup-3-10 | INFO  | PivotBlockConfirmer | Received 2 confirmation(s) for pivot block header 11658232: 0x88f6f09f03f46b69b2380eb51e20d8acbf88613c693321cb5aadc123cace35de\r\n2022-07-20 21:00:48.230+00:00 | nioEventLoopGroup-3-8 | INFO  | PivotBlockConfirmer | Failed to confirm pivot block 11658232. Received conflicting headers: 0x8073b8e6c83cba660e22704d923c57cf1be5c8836e7f484eaf5d7a9dc8fa91ca (1),0x88f6f09f03f46b69b2380eb51e20d8acbf88613c693321cb5aadc123cace35de (2)\r\n```\r\n\r\n\r\nThe errors repeat continuously and very rapidly.\r\n\r\nA single conflicting block header shouldn't cause besu to fail to sync, otherwise a single bad peer can prevent besu from syncing. There's also little point in requesting the same pivot block from the same peers in such rapid succession.\r\n\r\nProblem occurred on two separate nodes (syncing at the same time) and repeated after restart.",
  "closed_by": {
    "login": "matkt",
    "id": 26581503,
    "node_id": "MDQ6VXNlcjI2NTgxNTAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/26581503?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/matkt",
    "html_url": "https://github.com/matkt",
    "followers_url": "https://api.github.com/users/matkt/followers",
    "following_url": "https://api.github.com/users/matkt/following{/other_user}",
    "gists_url": "https://api.github.com/users/matkt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/matkt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/matkt/subscriptions",
    "organizations_url": "https://api.github.com/users/matkt/orgs",
    "repos_url": "https://api.github.com/users/matkt/repos",
    "events_url": "https://api.github.com/users/matkt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/matkt/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/4140/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/4140/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1190928413",
    "html_url": "https://github.com/hyperledger/besu/issues/4140#issuecomment-1190928413",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4140",
    "id": 1190928413,
    "node_id": "IC_kwDODE2jmc5G_CAd",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-21T01:16:28Z",
    "updated_at": "2022-07-21T01:16:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "Also occurred with 22.7.0-RC2.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1190928413/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1192020772",
    "html_url": "https://github.com/hyperledger/besu/issues/4140#issuecomment-1192020772",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4140",
    "id": 1192020772,
    "node_id": "IC_kwDODE2jmc5HDMsk",
    "user": {
      "login": "non-fungible-nelson",
      "id": 85905982,
      "node_id": "MDQ6VXNlcjg1OTA1OTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/non-fungible-nelson",
      "html_url": "https://github.com/non-fungible-nelson",
      "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
      "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
      "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
      "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
      "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
      "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-21T23:17:24Z",
    "updated_at": "2022-07-21T23:17:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "I also experienced this on a ropsten sync today. @matkt might be good to check this out when able. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1192020772/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1197935323",
    "html_url": "https://github.com/hyperledger/besu/issues/4140#issuecomment-1197935323",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4140",
    "id": 1197935323,
    "node_id": "IC_kwDODE2jmc5HZwrb",
    "user": {
      "login": "matkt",
      "id": 26581503,
      "node_id": "MDQ6VXNlcjI2NTgxNTAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/26581503?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matkt",
      "html_url": "https://github.com/matkt",
      "followers_url": "https://api.github.com/users/matkt/followers",
      "following_url": "https://api.github.com/users/matkt/following{/other_user}",
      "gists_url": "https://api.github.com/users/matkt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matkt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matkt/subscriptions",
      "organizations_url": "https://api.github.com/users/matkt/orgs",
      "repos_url": "https://api.github.com/users/matkt/repos",
      "events_url": "https://api.github.com/users/matkt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matkt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-28T10:04:23Z",
    "updated_at": "2022-07-28T10:04:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "@ajsutton  There's also little point in requesting the same pivot block from the same peers in such rapid succession. \r\n\r\n\r\nnot sure I understand this. the principle is that we are not asking for the same pivot block. we go back to find a common block. but on the other hand this technique is no longer really useful with snapsync and post merge\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1197935323/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1198726500",
    "html_url": "https://github.com/hyperledger/besu/issues/4140#issuecomment-1198726500",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4140",
    "id": 1198726500,
    "node_id": "IC_kwDODE2jmc5Hcx1k",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-28T23:37:21Z",
    "updated_at": "2022-07-28T23:37:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yeah I think I misread the log. Somehow I thought it was requesting exactly the same pivot block repeatedly but at least the part of the log quoted is definitely moving to different slots.  I'm not sure that going back to find a common block because of a single peer is a sensible strategy pre or post merge - its most likely that one peer is just wrong and we should ignore it.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1198726500/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
