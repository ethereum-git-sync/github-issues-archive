{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/3743",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/3743/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/3743/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/3743/events",
  "html_url": "https://github.com/hyperledger/besu/issues/3743",
  "id": 1209380373,
  "node_id": "I_kwDODE2jmc5IFa4V",
  "number": 3743,
  "title": "Besu fails to start when storage-mode doesn't match existing database",
  "user": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362500,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNTAw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "7057ff",
      "default": true,
      "description": "Good for newcomers"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-04-20T08:53:38Z",
  "updated_at": "2023-01-26T11:11:43Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\r\nIf I sync besu using FOREST storage format, then specify `--data-storage-format=BONSAI` without deleting the database, besu fails to start with a very cryptic message:\r\n\r\n```\r\n{\"timestamp\":\"2022-04-20T08:50:34,880\",\"level\":\"INFO\",\"thread\":\"main\",\"class\":\"ProtocolScheduleBuilder\",\"message\":\"Protocol schedule created with milestones: [Frontier: 0, Homestead: 1150000, DaoRecoveryInit: 19200\r\n00, DaoRecoveryTransition: 1920001, Homestead: 1920010, TangerineWhistle: 2463000, SpuriousDragon: 2675000, Byzantium: 4370000, Petersburg: 7280000, Istanbul: 9069000, MuirGlacier: 9200000, Berlin: 12244000, London\r\n: 12965000, ArrowGlacier: 13773000]\",\"throwable\":\"\"}\r\nCannot read field \"nativeHandle_\" because \"<parameter1>\" is null\r\n\r\nTo display full help:\r\nbesu [COMMAND] --help\r\n```\r\n\r\nBesu should at least provide a meaningful error message that the existing database doesn't match.  Ideally it would continue using the existing database (possibly logging a warning). When a new database is created it would use the specified format.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/3743/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/3743/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1111368395",
    "html_url": "https://github.com/hyperledger/besu/issues/3743#issuecomment-1111368395",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3743",
    "id": 1111368395,
    "node_id": "IC_kwDODE2jmc5CPiLL",
    "user": {
      "login": "sharad-develop",
      "id": 23285242,
      "node_id": "MDQ6VXNlcjIzMjg1MjQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/23285242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sharad-develop",
      "html_url": "https://github.com/sharad-develop",
      "followers_url": "https://api.github.com/users/sharad-develop/followers",
      "following_url": "https://api.github.com/users/sharad-develop/following{/other_user}",
      "gists_url": "https://api.github.com/users/sharad-develop/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sharad-develop/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sharad-develop/subscriptions",
      "organizations_url": "https://api.github.com/users/sharad-develop/orgs",
      "repos_url": "https://api.github.com/users/sharad-develop/repos",
      "events_url": "https://api.github.com/users/sharad-develop/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sharad-develop/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-27T18:56:55Z",
    "updated_at": "2022-04-27T18:56:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "Unhandled nullpointer exception in RocksDB implementation causes Besu to crash  when trying to create world state block hash BonsaiPersistedWorldState.\r\nThe reason is some of the rock db columnhandles are not created. We can add warning messages in SegmentedKeyValueStorageAdapter or BonsaiWorldStateKeyValueStorage.\r\nLet me know, I can take this up.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1111368395/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1404858846",
    "html_url": "https://github.com/hyperledger/besu/issues/3743#issuecomment-1404858846",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3743",
    "id": 1404858846,
    "node_id": "IC_kwDODE2jmc5TvHHe",
    "user": {
      "login": "non-fungible-nelson",
      "id": 85905982,
      "node_id": "MDQ6VXNlcjg1OTA1OTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/non-fungible-nelson",
      "html_url": "https://github.com/non-fungible-nelson",
      "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
      "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
      "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
      "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
      "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
      "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-26T11:11:35Z",
    "updated_at": "2023-01-26T11:11:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "@sharad-develop - this could be a great issue to take up! ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1404858846/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
