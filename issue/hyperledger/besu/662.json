{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/662",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/662/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/662/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/662/events",
  "html_url": "https://github.com/hyperledger/besu/issues/662",
  "id": 595473695,
  "node_id": "MDU6SXNzdWU1OTU0NzM2OTU=",
  "number": 662,
  "title": "JsonRPCHttpService can silently fail to start",
  "user": {
    "login": "magooster",
    "id": 12111442,
    "node_id": "MDQ6VXNlcjEyMTExNDQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/12111442?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/magooster",
    "html_url": "https://github.com/magooster",
    "followers_url": "https://api.github.com/users/magooster/followers",
    "following_url": "https://api.github.com/users/magooster/following{/other_user}",
    "gists_url": "https://api.github.com/users/magooster/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/magooster/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/magooster/subscriptions",
    "organizations_url": "https://api.github.com/users/magooster/orgs",
    "repos_url": "https://api.github.com/users/magooster/repos",
    "events_url": "https://api.github.com/users/magooster/events{/privacy}",
    "received_events_url": "https://api.github.com/users/magooster/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2020-04-06T22:44:42Z",
  "updated_at": "2020-04-20T22:00:33Z",
  "closed_at": "2020-04-15T07:24:31Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Steps to Reproduce (Bug)\r\n1. Configure node for TLS --rpc-http-tls-enabled, --rpc-http-tls-keystore-file=<FILE>, --rpc-http-tls-keystore-password-file=<FILE> make the password file path invalid\r\n2. Start the node\r\n3. Try to access JSON_RPC Http endpoint\r\n\r\n**Expected behavior:** \r\nException should be thrown and node fails to start\r\n\r\n**Actual behavior:** \r\nNode starts with no JSON-RPC Http service\r\n\r\n**Frequency:** \r\nAll the time\r\n\r\n### Versions (Add all that apply)\r\n* Software version: 1.4.2\r\n\r\n### Additional Information\r\n\r\nAs you can see from the logs, never get a log confirming that JsonRPC service has started...\r\n\r\n2020-04-06 23:19:03.213+01:00 | main | INFO  | JsonRpcHttpService | Starting JsonRPC service on 0.0.0.0:8545\r\n2020-04-06 23:19:03.216+01:00 | main | INFO  | WebSocketService | Starting Websocket service on 0.0.0.0:8546\r\n2020-04-06 23:19:03.244+01:00 | vert.x-eventloop-thread-1 | INFO  | WebSocketService | Websocket service started and listening on 0.0.0.0:8546\r\n2020-04-06 23:19:03.244+01:00 | main | INFO  | MetricsHttpService | Starting metrics http service on 0.0.0.0:9545\r\n2020-04-06 23:19:03.255+01:00 | main | INFO  | Runner | Ethereum main loop is up.\r\n2020-04-06 23:19:03.256+01:00 | vert.x-eventloop-thread-2 | INFO  | MetricsHttpService | Metrics service started and listening on 9545:9545\r\n\r\nnetstat -nltp shows nothing listening on 8545\r\n\r\nLooking at waitForServiceToStart in org.hyperledger.besu.Runner.java, it would seem only checking the status of the future before it is completed, any future that completes immediately is not checked.\r\n\r\nprivate void waitForServiceToStart(\r\n      final String serviceName, final CompletableFuture<?> startFuture) {\r\n    while (!startFuture.isDone()) {\r\n      try {\r\n        startFuture.get(60, TimeUnit.SECONDS);\r\n      } catch (final InterruptedException e) {\r\n        Thread.currentThread().interrupt();\r\n        throw new IllegalStateException(\"Interrupted while waiting for service to start\", e);\r\n      } catch (final ExecutionException e) {\r\n        LOG.error(\"Service \" + serviceName + \" failed to start\", e);\r\n        throw new IllegalStateException(e);\r\n      } catch (final TimeoutException e) {\r\n        LOG.warn(\"Service {} is taking an unusually long time to start\", serviceName);\r\n      }\r\n    }\r\n  }\r\n\r\nWhy not just just call Future.get(60, TimeUnit.SECONDS) without the while loop?\r\n\r\n\r\n\r\n",
  "closed_by": {
    "login": "abdelhamidbakhta",
    "id": 45264458,
    "node_id": "MDQ6VXNlcjQ1MjY0NDU4",
    "avatar_url": "https://avatars.githubusercontent.com/u/45264458?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/abdelhamidbakhta",
    "html_url": "https://github.com/abdelhamidbakhta",
    "followers_url": "https://api.github.com/users/abdelhamidbakhta/followers",
    "following_url": "https://api.github.com/users/abdelhamidbakhta/following{/other_user}",
    "gists_url": "https://api.github.com/users/abdelhamidbakhta/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/abdelhamidbakhta/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/abdelhamidbakhta/subscriptions",
    "organizations_url": "https://api.github.com/users/abdelhamidbakhta/orgs",
    "repos_url": "https://api.github.com/users/abdelhamidbakhta/repos",
    "events_url": "https://api.github.com/users/abdelhamidbakhta/events{/privacy}",
    "received_events_url": "https://api.github.com/users/abdelhamidbakhta/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/662/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/662/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/610091941",
    "html_url": "https://github.com/hyperledger/besu/issues/662#issuecomment-610091941",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/662",
    "id": 610091941,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDA5MTk0MQ==",
    "user": {
      "login": "shemnon",
      "id": 38109,
      "node_id": "MDQ6VXNlcjM4MTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shemnon",
      "html_url": "https://github.com/shemnon",
      "followers_url": "https://api.github.com/users/shemnon/followers",
      "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
      "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
      "organizations_url": "https://api.github.com/users/shemnon/orgs",
      "repos_url": "https://api.github.com/users/shemnon/repos",
      "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shemnon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-06T23:40:22Z",
    "updated_at": "2020-04-06T23:41:30Z",
    "author_association": "MEMBER",
    "body": "We in essence poll forever.  Every 60 seconds we complain that it is taking too long.  The log messages you have show that it isn't complete.  What does the log look like after 60 seconds?  Do we get an error at error level or a complaint about taking an unusually long time to start?\r\n\r\nThe logs will be at ERROR or WARN, which should show up in standard output unless you are doing something special to the log4j config.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/610091941/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/610097779",
    "html_url": "https://github.com/hyperledger/besu/issues/662#issuecomment-610097779",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/662",
    "id": 610097779,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDA5Nzc3OQ==",
    "user": {
      "login": "magooster",
      "id": 12111442,
      "node_id": "MDQ6VXNlcjEyMTExNDQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/12111442?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/magooster",
      "html_url": "https://github.com/magooster",
      "followers_url": "https://api.github.com/users/magooster/followers",
      "following_url": "https://api.github.com/users/magooster/following{/other_user}",
      "gists_url": "https://api.github.com/users/magooster/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/magooster/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/magooster/subscriptions",
      "organizations_url": "https://api.github.com/users/magooster/orgs",
      "repos_url": "https://api.github.com/users/magooster/repos",
      "events_url": "https://api.github.com/users/magooster/events{/privacy}",
      "received_events_url": "https://api.github.com/users/magooster/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-07T00:00:30Z",
    "updated_at": "2020-04-07T00:00:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "IMHO: You'll never get an error (warning), as the future has already completed... Future.isDone Returns true if completed in any fashion: normally, exceptionally, or via cancellation.\r\n\r\nI can wait forever... I never see the warning in the logs.\r\n\r\nWith no issues JSON-RPC service starts almost immediately...\r\n\r\n2020-04-07 00:59:14.349+01:00 | main | INFO  | JsonRpcHttpService | Starting JsonRPC service on 0.0.0.0:8545\r\n2020-04-07 00:59:14.429+01:00 | vert.x-eventloop-thread-1 | INFO  | JsonRpcHttpService | JsonRPC service started and listening on 0.0.0.0:8545 with TLS enabled.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/610097779/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/613832657",
    "html_url": "https://github.com/hyperledger/besu/issues/662#issuecomment-613832657",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/662",
    "id": 613832657,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMzgzMjY1Nw==",
    "user": {
      "login": "shemnon",
      "id": 38109,
      "node_id": "MDQ6VXNlcjM4MTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shemnon",
      "html_url": "https://github.com/shemnon",
      "followers_url": "https://api.github.com/users/shemnon/followers",
      "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
      "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
      "organizations_url": "https://api.github.com/users/shemnon/orgs",
      "repos_url": "https://api.github.com/users/shemnon/repos",
      "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shemnon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-15T05:55:58Z",
    "updated_at": "2020-04-15T05:55:58Z",
    "author_association": "MEMBER",
    "body": "I think we need to go from a while to a do/while then, to give the exception a chance to throw.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/613832657/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/616834153",
    "html_url": "https://github.com/hyperledger/besu/issues/662#issuecomment-616834153",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/662",
    "id": 616834153,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxNjgzNDE1Mw==",
    "user": {
      "login": "MadelineMurray",
      "id": 43356962,
      "node_id": "MDQ6VXNlcjQzMzU2OTYy",
      "avatar_url": "https://avatars.githubusercontent.com/u/43356962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MadelineMurray",
      "html_url": "https://github.com/MadelineMurray",
      "followers_url": "https://api.github.com/users/MadelineMurray/followers",
      "following_url": "https://api.github.com/users/MadelineMurray/following{/other_user}",
      "gists_url": "https://api.github.com/users/MadelineMurray/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MadelineMurray/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MadelineMurray/subscriptions",
      "organizations_url": "https://api.github.com/users/MadelineMurray/orgs",
      "repos_url": "https://api.github.com/users/MadelineMurray/repos",
      "events_url": "https://api.github.com/users/MadelineMurray/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MadelineMurray/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-20T22:00:33Z",
    "updated_at": "2020-04-20T22:00:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "@magooster - #714 will be included in 1.4.4 and should solve this issue.  If not, let us know. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/616834153/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
