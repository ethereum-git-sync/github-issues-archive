{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/5757",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/5757/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/5757/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/5757/events",
  "html_url": "https://github.com/hyperledger/besu/issues/5757",
  "id": 1842366720,
  "node_id": "I_kwDODE2jmc5t0EkA",
  "number": 5757,
  "title": "Besu 23.4.4 Low TPS around 37 TPS Compared to Besu-21.10.8 Which can go above 1000 TPS",
  "user": {
    "login": "shehinfn",
    "id": 13316230,
    "node_id": "MDQ6VXNlcjEzMzE2MjMw",
    "avatar_url": "https://avatars.githubusercontent.com/u/13316230?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/shehinfn",
    "html_url": "https://github.com/shehinfn",
    "followers_url": "https://api.github.com/users/shehinfn/followers",
    "following_url": "https://api.github.com/users/shehinfn/following{/other_user}",
    "gists_url": "https://api.github.com/users/shehinfn/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/shehinfn/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/shehinfn/subscriptions",
    "organizations_url": "https://api.github.com/users/shehinfn/orgs",
    "repos_url": "https://api.github.com/users/shehinfn/repos",
    "events_url": "https://api.github.com/users/shehinfn/events{/privacy}",
    "received_events_url": "https://api.github.com/users/shehinfn/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-08-09T02:48:07Z",
  "updated_at": "2023-08-17T05:18:50Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Description:\r\nAs a Besu node operator, I want to achieve higher Transactions Per Second (TPS) on the latest version of Besu (23.4.4) as was possible with version besu-21.10.8. When benchmarking using the wrk tool at TPS above 37, the network starts to break down and produces errors, specifically \"Transaction nonce is too distant from current sender nonce\". Interestingly, the earlier version (besu-21.10.8) did not have this issue.\r\n\r\n`../../besu-23.4.4/bin/besu --tx-pool-max-size=100000 --revert-reason-enabled   --data-path=data --genesis-file=../genesis.json --rpc-http-enabled --rpc-http-api=ETH,NET,QBFT,ADMIN,TXPOOL,TRACE --rpc-ws-enabled=true --rpc-ws-host=0.0.0.0 --rpc-ws-port=9545 --host-allowlist=\"*\" --rpc-http-cors-origins=\"all\" \r\n`\r\n\r\nImages:\r\n\r\nBelow is the most ideal case around 30-40 milliseconds of delay we get the transaction\r\n![image](https://github.com/hyperledger/besu/assets/13316230/6e8c1a79-206e-4a72-83e9-6f0473efc767)\r\nBelow is the most ideal case around 10-30 milliseconds of delay starts breaking\r\n![image](https://github.com/hyperledger/besu/assets/13316230/00397ede-66da-49c8-9e8a-bf93ab857979)\r\nAcceptance Criteria:\r\nBesu 23.4.4 should be able to handle a TPS comparable to, or better than, besu-21.10.8.\r\n\r\nSteps to Reproduce (Bug):\r\n\r\nSet up a Besu node using version 23.4.4.\r\nBenchmark the node using the wrk tool, increasing the TPS load.\r\nObserve that when the load surpasses 37 TPS, the network starts to degrade, and errors start appearing.\r\nExpected behavior:\r\nBesu 23.4.4 should handle higher TPS without breaking.\r\n\r\nActual behavior:\r\nAt TPS rates above 37, the network fails and errors appear indicating nonce issues.\r\n\r\nFrequency:\r\nThis issue occurs consistently when the TPS threshold is crossed.\r\n\r\nLogs (if a bug):\r\nRelevant logs from Besu showing the \"Transaction nonce is too distant from current sender nonce\" error would be beneficial here.\r\n\r\nVersions (Add all that apply):\r\n\r\nSoftware version: Besu 23.4.4\r\nJava version: [Specify version]\r\nOS Name & Version: [Specify OS & version]\r\nKernel Version: [Specify kernel version]\r\nVirtual Machine software & version: [e.g., vmware -v]\r\nDocker Version: [Specify version]\r\nCloud VM, type, size: Amazon Web Services I3-large\r\nConsensus Client & Version if using Proof of Stake: [Specify consensus client & version if relevant]\r\nSmart contract information:\r\n\r\nSolidity version: [Specify version using solc --version]\r\nRepo with minimal set of deployable/reproducible contract code: [Please provide a link]\r\nDeployment/calling method of the contract: [Specify how the contract is deployed/called]\r\nReproduction on other ETH clients: [Specify if the issue also occurs on other Ethereum clients]\r\nAdditional Information:\r\n\r\nBesu setup info: [Please provide genesis file, config options, etc.]\r\nSystem info:\r\nMemory: 32 GB RAM\r\nCPU: 8 core",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/5757/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/5757/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1678155837",
    "html_url": "https://github.com/hyperledger/besu/issues/5757#issuecomment-1678155837",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5757",
    "id": 1678155837,
    "node_id": "IC_kwDODE2jmc5kBqA9",
    "user": {
      "login": "non-fungible-nelson",
      "id": 85905982,
      "node_id": "MDQ6VXNlcjg1OTA1OTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/non-fungible-nelson",
      "html_url": "https://github.com/non-fungible-nelson",
      "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
      "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
      "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
      "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
      "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
      "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-14T22:17:56Z",
    "updated_at": "2023-08-14T22:17:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi there - would you be able to provide any more information in the ticket? there are a few questions in the description that you could fill out that would help us with this issue. At minimum, please provide your configuration and logs from Besu and any CL client (if on public networks). Thank you\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1678155837/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1681629015",
    "html_url": "https://github.com/hyperledger/besu/issues/5757#issuecomment-1681629015",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5757",
    "id": 1681629015,
    "node_id": "IC_kwDODE2jmc5kO59X",
    "user": {
      "login": "shehinfn",
      "id": 13316230,
      "node_id": "MDQ6VXNlcjEzMzE2MjMw",
      "avatar_url": "https://avatars.githubusercontent.com/u/13316230?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shehinfn",
      "html_url": "https://github.com/shehinfn",
      "followers_url": "https://api.github.com/users/shehinfn/followers",
      "following_url": "https://api.github.com/users/shehinfn/following{/other_user}",
      "gists_url": "https://api.github.com/users/shehinfn/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shehinfn/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shehinfn/subscriptions",
      "organizations_url": "https://api.github.com/users/shehinfn/orgs",
      "repos_url": "https://api.github.com/users/shehinfn/repos",
      "events_url": "https://api.github.com/users/shehinfn/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shehinfn/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-17T05:18:06Z",
    "updated_at": "2023-08-17T05:18:50Z",
    "author_association": "NONE",
    "body": "@non-fungible-nelson hi I have updated now please check I am getting only 37 TPS in new version compared to very early version",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1681629015/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
