{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/4512",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/4512/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/4512/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/4512/events",
  "html_url": "https://github.com/hyperledger/besu/issues/4512",
  "id": 1403325764,
  "node_id": "I_kwDODE2jmc5TpQ1E",
  "number": 4512,
  "title": "Incorrectly returned INVALID for ropsten block",
  "user": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "jflo",
    "id": 345937,
    "node_id": "MDQ6VXNlcjM0NTkzNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/345937?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jflo",
    "html_url": "https://github.com/jflo",
    "followers_url": "https://api.github.com/users/jflo/followers",
    "following_url": "https://api.github.com/users/jflo/following{/other_user}",
    "gists_url": "https://api.github.com/users/jflo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jflo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jflo/subscriptions",
    "organizations_url": "https://api.github.com/users/jflo/orgs",
    "repos_url": "https://api.github.com/users/jflo/repos",
    "events_url": "https://api.github.com/users/jflo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jflo/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "jflo",
      "id": 345937,
      "node_id": "MDQ6VXNlcjM0NTkzNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/345937?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jflo",
      "html_url": "https://github.com/jflo",
      "followers_url": "https://api.github.com/users/jflo/followers",
      "following_url": "https://api.github.com/users/jflo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jflo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jflo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jflo/subscriptions",
      "organizations_url": "https://api.github.com/users/jflo/orgs",
      "repos_url": "https://api.github.com/users/jflo/repos",
      "events_url": "https://api.github.com/users/jflo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jflo/received_events",
      "type": "User",
      "site_admin": false
    },
    {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 9,
  "created_at": "2022-10-10T15:05:33Z",
  "updated_at": "2022-11-14T21:57:26Z",
  "closed_at": "2022-11-14T21:57:26Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\r\nOn one of our ropsten nodes, besu incorrectly returned `INVALID` with a 0x0000 latestValidHash for beacon block 957088 (root 0x1cfaadb29cab42bb951aca0d068f624cbf4ae68fe5117c8c133114a84b96fb6f)\r\n\r\nExecution payload header:\r\n```\r\n        \"execution_payload\": {\r\n          \"parent_hash\": \"0x9abbfb6c82d7c0b9639333acd2d648205c12c16db0e304877ec765a822323803\",\r\n          \"fee_recipient\": \"0x965b7a773e3632b259108d246a7cfdcdff118999\",\r\n          \"state_root\": \"0x93489b3724363a97c28808016d360e630ffe99d3449c8f275163dcb1120652ab\",\r\n          \"receipts_root\": \"0xc97efdeae4ddcbb597099852fe158644f86a6411c8db862c4f698526474980dd\",\r\n          \"logs_bloom\": \"0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\",\r\n          \"prev_randao\": \"0xcf371ca53a22567031cb5c909a1c9f27f417240b795a718c9bcb269efdea8325\",\r\n          \"block_number\": \"13125902\",\r\n          \"gas_limit\": \"30000000\",\r\n          \"gas_used\": \"346036\",\r\n          \"timestamp\": \"1665407856\",\r\n          \"extra_data\": \"0x\",\r\n          \"base_fee_per_gas\": \"7\",\r\n          \"block_hash\": \"0x56128e3165fa54e3644b2de9493972741a029666f128b9b2595a0df47be61d5f\",\r\n```\r\n\r\nThis caused the node to be unable to follow the canonical chain.  The block was correctly imported after restarting besu and then teku.\r\n\r\nRelevant teku logs:\r\n```\r\n\r\n{\"@timestamp\":\"2022-10-10T13:17:36,270\",\"level\":\"INFO\",\"thread\":\"beaconchain-async-0\",\"class\":\"teku-status-log\",\"message\":\"Sync committee performance: epoch 29908, expected 768, produced 768, correct 768, included 672 (88%)\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:37,124\",\"level\":\"ERROR\",\"thread\":\"pool-4-thread-417\",\"class\":\"teku-event-log\",\"message\":\"Execution Client request failed. Make sure the Execution Client is online and in sync.\",\"throwable\":\" java.io.IOException: -32603: Internal error\\n\\tat tech.pegasys.teku.ethereum.executionclient.web3j.Web3JClient.lambda$doRequest$0(Web3JClient.java:85)\\n\\tat java.base/java.util.concurrent.CompletableFuture.uniHandle(CompletableFuture.java:934)\\n\\tat java.base/java.util.concurrent.CompletableFuture$UniHandle.tryFire(CompletableFuture.java:911)\\n\\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\\n\\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\\n\\tat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:148)\\n\\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\\n\\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\\n\\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\\n\\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\\n\\tat org.web3j.utils.Async.lambda$run$1(Async.java:38)\\n\\tat java.base/java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1804)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\\n\\tat java.base/java.lang.Thread.run(Thread.java:833)\\n\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:37,134\",\"level\":\"ERROR\",\"thread\":\"forkchoice-async-0\",\"class\":\"BlockManager\",\"message\":\"Unable to import block: Execution Client returned an error: tech.pegasys.teku.ethereum.executionlayer.InvalidRemoteResponseException: Invalid remote response from the execution client: -32603: Internal error\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:37,136\",\"level\":\"ERROR\",\"thread\":\"beaconchain-async-4\",\"class\":\"teku-validator-log\",\"message\":\"Failed to import proposed block due to FAILED_EXECUTION_PAYLOAD_EXECUTION: 1cfaadb29cab42bb951aca0d068f624cbf4ae68fe5117c8c133114a84b96fb6f (957088)\",\"throwable\":\" java.util.concurrent.CompletionException: tech.pegasys.teku.ethereum.executionlayer.InvalidRemoteResponseException: Invalid remote response from the execution client: -32603: Internal error\\n\\tat java.base/java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:315)\\n\\tat java.base/java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:320)\\n\\tat java.base/java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:649)\\n\\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\\n\\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\\n\\tat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:148)\\n\\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\\n\\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\\n\\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\\n\\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\\n\\tat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:148)\\n\\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\\n\\tat java.base/java.util.concurrent.CompletableFuture.uniWhenCompleteStage(CompletableFuture.java:887)\\n\\tat java.base/java.util.concurrent.CompletableFuture.whenComplete(CompletableFuture.java:2325)\\n\\tat tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:603)\\n\\tat tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:33)\\n\\tat tech.pegasys.teku.infrastructure.async.SafeFuture.propagateResult(SafeFuture.java:143)\\n\\tat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$exceptionallyCompose$33(SafeFuture.java:422)\\n\\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\\n\\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\\n\\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\\n\\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\\n\\tat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:148)\\n\\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\\n\\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\\n\\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\\n\\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\\n\\tat org.web3j.utils.Async.lambda$run$1(Async.java:38)\\n\\tat java.base/java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1804)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\\n\\tat java.base/java.lang.Thread.run(Thread.java:833)\\nCaused by: tech.pegasys.teku.ethereum.executionlayer.InvalidRemoteResponseException: Invalid remote response from the execution client: -32603: Internal error\\n\\tat tech.pegasys.teku.ethereum.executionlayer.ExecutionLayerManagerImpl.unwrapResponseOrThrow(ExecutionLayerManagerImpl.java:518)\\n\\tat tech.pegasys.teku.ethereum.executionlayer.ExecutionLayerManagerImpl.unwrapExecutionClientResponseOrThrow(ExecutionLayerManagerImpl.java:504)\\n\\tat java.base/java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:646)\\n\\t... 29 more\\n\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:37,647\",\"level\":\"INFO\",\"thread\":\"validator-async-2\",\"class\":\"teku-validator-log\",\"message\":\"Validator   *** Published block              Count: 1, Slot: 957088, Root: 1cfaadb29cab42bb951aca0d068f624cbf4ae68fe5117c8c133114a84b96fb6f, 346036 (1%) gas, EL block:  56128e3165fa54e3644b2de9493972741a029666f128b9b2595a0df47be61d5f (13125902)\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:39,135\",\"level\":\"INFO\",\"thread\":\"beaconchain-async-1\",\"class\":\"FailedExecutionPool\",\"message\":\"Retrying execution of block 1cfaadb29cab42bb951aca0d068f624cbf4ae68fe5117c8c133114a84b96fb6f (957088)\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:39,139\",\"level\":\"INFO\",\"thread\":\"pool-4-thread-417\",\"class\":\"teku-event-log\",\"message\":\"Execution Client request succeeded after a previous failure\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:39,169\",\"level\":\"WARN\",\"thread\":\"forkchoice-async-0\",\"class\":\"ForkChoiceStrategy\",\"message\":\"Payload for child of block root 0xd85399eb10de6804a2d8d5d749a457b350a6c2bbedc3858dc24be275072d3c63 marked as invalid by Execution Client\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:39,170\",\"level\":\"ERROR\",\"thread\":\"forkchoice-async-0\",\"class\":\"teku-status-log\",\"message\":\"Could not find latest valid execution payload hash (0x0000000000000000000000000000000000000000000000000000000000000000) in the non-finalized chain. Optimistic sync may have finalized an invalid transition block.\",\"throwable\":\"\"}\r\n```\r\n\r\nBesu logs:\r\n```\r\n{\"@timestamp\":\"2022-10-10T13:17:24,224\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"EngineNewPayload\",\"message\":\"Imported #13,125,901 / 0 tx / base fee 7 wei / 0 (0.0%) gas / (0x9abbfb6c82d7c0b9639333\r\nacd2d648205c12c16db0e304877ec765a822323803) in 0.001s. Peers: 25\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:24,910\",\"level\":\"INFO\",\"thread\":\"EthScheduler-Computation-534\",\"class\":\"MergeCoordinator\",\"message\":\"Successfully built block 13125902 (0x56128e3165fa54e3644b2de9493972741a029666f128\r\nb9b2595a0df47be61d5f) for proposal identified by 0x0035eb5652a22a90, with 5 transactions, in 108ms\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:24,999\",\"level\":\"INFO\",\"thread\":\"EthScheduler-Computation-534\",\"class\":\"MergeCoordinator\",\"message\":\"Successfully built block 13125902 (0x56128e3165fa54e3644b2de9493972741a029666f128\r\nb9b2595a0df47be61d5f) for proposal identified by 0x0035eb5652a22a90, with 5 transactions, in 188ms\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:36,043\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"EngineGetPayload\",\"message\":\"Fetch block proposal by identifier: 0x0035eb5652a22a90, hash: 0x56128e3165fa54e3644b2de\r\n9493972741a029666f128b9b2595a0df47be61d5f, number: 13125902, coinbase: 0x965b7a773e3632b259108d246a7cfdcdff118999, transaction count: 5\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:37,092\",\"level\":\"ERROR\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"AbstractBlockProcessor\",\"message\":\"failed persisting block\",\"throwable\":\" org.hyperledger.besu.plugin.services.exce\r\nption.StorageException: org.rocksdb.RocksDBException: TimedOut(LockTimeout)\\n\\tat org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage$RocksDbTransaction.put(RocksDBColumnar\r\nKeyValueStorage.java:299)\\n\\tat org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage$RocksDbTransaction.put(RocksDBColumnarKeyValueStorage.java:280)\\n\\tat org.hyperledger.be\r\nsu.services.kvstore.SegmentedKeyValueStorageTransactionTransitionValidatorDecorator.put(SegmentedKeyValueStorageTransactionTransitionValidatorDecorator.java:36)\\n\\tat org.hyperledger.besu.services.kvstore.Segmented\r\nKeyValueStorageAdapter$1.put(SegmentedKeyValueStorageAdapter.java:80)\\n\\tat org.hyperledger.besu.ethereum.bonsai.BonsaiWorldStateKeyValueStorage$Updater.putAccountInfoState(BonsaiWorldStateKeyValueStorage.java:318)\r\n\\n\\tat org.hyperledger.besu.ethereum.bonsai.BonsaiPersistedWorldState.calculateRootHash(BonsaiPersistedWorldState.java:223)\\n\\tat org.hyperledger.besu.ethereum.bonsai.BonsaiInMemoryWorldState.rootHash(BonsaiInMemor\r\nyWorldState.java:43)\\n\\tat org.hyperledger.besu.ethereum.bonsai.BonsaiInMemoryWorldState.persist(BonsaiInMemoryWorldState.java:53)\\n\\tat org.hyperledger.besu.ethereum.mainnet.AbstractBlockProcessor.processBlock(Abs\r\ntractBlockProcessor.java:220)\\n\\tat org.hyperledger.besu.ethereum.mainnet.AbstractBlockProcessor.processBlock(AbstractBlockProcessor.java:43)\\n\\tat org.hyperledger.besu.ethereum.mainnet.BlockProcessor.processBlock(\r\nBlockProcessor.java:80)\\n\\tat org.hyperledger.besu.ethereum.MainnetBlockValidator.processBlock(MainnetBlockValidator.java:175)\\n\\tat org.hyperledger.besu.ethereum.MainnetBlockValidator.validateAndProcessBlock(Mainn\r\netBlockValidator.java:112)\\n\\tat org.hyperledger.besu.consensus.merge.blockcreation.MergeCoordinator.validateBlock(MergeCoordinator.java:343)\\n\\tat org.hyperledger.besu.consensus.merge.blockcreation.MergeCoordinator.rememberBlock(MergeCoordinator.java:359)\\n\\tat org.hyperledger.besu.consensus.merge.blockcreation.TransitionCoordinator.rememberBlock(TransitionCoordinator.java:137)\\n\\tat org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.engine.EngineNewPayload.syncResponse(EngineNewPayload.java:215)\\n\\tat org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.ExecutionEngineJsonRpcMethod.lambda$response$0(ExecutionEngineJsonRpcMethod.java:73)\\n\\tat io.vertx.core.impl.ContextImpl.lambda$null$0(ContextImpl.java:159)\\n\\tat io.vertx.core.impl.AbstractContext.dispatch(AbstractContext.java:100)\\n\\tat io.vertx.core.impl.ContextImpl.lambda$executeBlocking$1(ContextImpl.java:157)\\n\\tat io.vertx.core.impl.TaskQueue.run(TaskQueue.java:76)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\\n\\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\\n\\tat java.base/java.lang.Thread.run(Thread.java:833)\\nCaused by: org.rocksdb.RocksDBException: TimedOut(LockTimeout)\\n\\tat org.rocksdb.Transaction.put(Native Method)\\n\\tat org.rocksdb.Transaction.put(Transaction.java:705)\\n\\tat org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage$RocksDbTransaction.put(RocksDBColumnarKeyValueStorage.java:293)\\n\\t... 25 more\\n\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:37,115\",\"level\":\"ERROR\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"MainnetBlockValidator\",\"message\":\"Error processing block. Block 13125902 (0x56128e3165fa54e3644b2de9493972741a029666f128b9b2595a0df47be61d5f), caused by Optional[org.hyperledger.besu.plugin.services.exception.StorageException: org.rocksdb.RocksDBException: TimedOut(LockTimeout)]\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:37,178\",\"level\":\"INFO\",\"thread\":\"EthScheduler-Computation-535\",\"class\":\"MergeCoordinator\",\"message\":\"Successfully built block 13125902 (0x56128e3165fa54e3644b2de9493972741a029666f128b9b2595a0df47be61d5f) for proposal identified by 0x0035eb5652a22a90, with 5 transactions, in 1146ms\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:40,024\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"EngineForkchoiceUpdated\",\"message\":\"VALID for fork-choice-update: head: 0x9abbfb6c82d7c0b9639333acd2d648205c12c16db0e304877ec765a822323803, finalized: 0x8ba9bc3f1eae2be2dd6f72d0fca0b92539a8d9df918f12c237a0270111aae8b3, safeBlockHash: 0xe6e2279003ab00660ab571b64dee3d82f8550078af727f0b29db0eb1134bc71c\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:40,092\",\"level\":\"INFO\",\"thread\":\"EthScheduler-Computation-536\",\"class\":\"MergeCoordinator\",\"message\":\"Successfully built block 13125902 (0x8f679c1cc8e936bb60706a6437df2cc9492613e7f92a98f5036130c962c93580) for proposal identified by 0x0035eb5652a22a84, with 5 transactions, in 68ms\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:48,028\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"EngineGetPayload\",\"message\":\"Fetch block proposal by identifier: 0x0035eb5652a22a84, hash: 0x8f679c1cc8e936bb60706a6437df2cc9492613e7f92a98f5036130c962c93580, number: 13125902, coinbase: 0x965b7a773e3632b259108d246a7cfdcdff118999, transaction count: 5\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:17:48,057\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"EngineNewPayload\",\"message\":\"Imported #13,125,902 / 5 tx / base fee 7 wei / 346,036 (1.2%) gas / (0x8f679c1cc8e936bb60706a6437df2cc9492613e7f92a98f5036130c962c93580) in 0.004s. Peers: 25\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:19:04,015\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"EngineForkchoiceUpdated\",\"message\":\"VALID for fork-choice-update: head: 0x8f679c1cc8e936bb60706a6437df2cc9492613e7f92a98f5036130c962c93580, finalized: 0x8ba9bc3f1eae2be2dd6f72d0fca0b92539a8d9df918f12c237a0270111aae8b3, safeBlockHash: 0xe6e2279003ab00660ab571b64dee3d82f8550078af727f0b29db0eb1134bc71c\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:20:16,019\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"EngineForkchoiceUpdated\",\"message\":\"VALID for fork-choice-update: head: 0x8f679c1cc8e936bb60706a6437df2cc9492613e7f92a98f5036130c962c93580, finalized: 0x8ba9bc3f1eae2be2dd6f72d0fca0b92539a8d9df918f12c237a0270111aae8b3, safeBlockHash: 0xe6e2279003ab00660ab571b64dee3d82f8550078af727f0b29db0eb1134bc71c\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-10T13:20:16,091\",\"level\":\"INFO\",\"thread\":\"EthScheduler-Computation-537\",\"class\":\"MergeCoordinator\",\"message\":\"Successfully built block 13125903 (0x3c93b52ee42013c33f3f8a2dfb4e9e7350dd3a099864a3ffdb284c1ca86f6b94) for proposal identified by 0x0035e5100fe7b1e8, with 3 transactions, in 72ms\",\"throwable\":\"\"}\r\n```\r\n\r\nInitially Besu hit an error and correctly returned an error response (not invalid).  Then Teku retried executing the block and got the incorrect `INVALID` response and from there it went off creating its own fork.",
  "closed_by": {
    "login": "jflo",
    "id": 345937,
    "node_id": "MDQ6VXNlcjM0NTkzNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/345937?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jflo",
    "html_url": "https://github.com/jflo",
    "followers_url": "https://api.github.com/users/jflo/followers",
    "following_url": "https://api.github.com/users/jflo/following{/other_user}",
    "gists_url": "https://api.github.com/users/jflo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jflo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jflo/subscriptions",
    "organizations_url": "https://api.github.com/users/jflo/orgs",
    "repos_url": "https://api.github.com/users/jflo/repos",
    "events_url": "https://api.github.com/users/jflo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jflo/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/4512/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/4512/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1274134718",
    "html_url": "https://github.com/hyperledger/besu/issues/4512#issuecomment-1274134718",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4512",
    "id": 1274134718,
    "node_id": "IC_kwDODE2jmc5L8cC-",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-11T06:11:46Z",
    "updated_at": "2022-10-11T06:11:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "from the above logs I can't tell what the exception was the second time ie why besu is returning `Invalid`\r\n\r\nspotted this TODO which may be related?\r\nhttps://github.com/hyperledger/besu/blob/e179b86b48d271626e2972720ca37c5df9caaaa4/ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/engine/EngineNewPayload.java#L222\r\n\r\ndoes it make sense to only log one invalid block per minute? or do we need a different timing mechanism for this? \r\nI don't see this `Invalid new payload` at all in the besu logs (and it was not started up within a minute of the issue) ->\r\nhttps://github.com/hyperledger/besu/blob/e179b86b48d271626e2972720ca37c5df9caaaa4/ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/engine/EngineNewPayload.java#L261",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1274134718/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1275153842",
    "html_url": "https://github.com/hyperledger/besu/issues/4512#issuecomment-1275153842",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4512",
    "id": 1275153842,
    "node_id": "IC_kwDODE2jmc5MAU2y",
    "user": {
      "login": "jflo",
      "id": 345937,
      "node_id": "MDQ6VXNlcjM0NTkzNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/345937?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jflo",
      "html_url": "https://github.com/jflo",
      "followers_url": "https://api.github.com/users/jflo/followers",
      "following_url": "https://api.github.com/users/jflo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jflo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jflo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jflo/subscriptions",
      "organizations_url": "https://api.github.com/users/jflo/orgs",
      "repos_url": "https://api.github.com/users/jflo/repos",
      "events_url": "https://api.github.com/users/jflo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jflo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-11T19:10:38Z",
    "updated_at": "2022-10-11T19:10:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yeah, agree with what Sally found. Even if we were suppressing invalid block messages to one per minute, we don't see any at all.  I was going to add more logging on INVALID, but its already there.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1275153842/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1275421780",
    "html_url": "https://github.com/hyperledger/besu/issues/4512#issuecomment-1275421780",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4512",
    "id": 1275421780,
    "node_id": "IC_kwDODE2jmc5MBWRU",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-12T00:10:06Z",
    "updated_at": "2022-10-12T00:10:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "adjustment to logging https://github.com/hyperledger/besu/pull/4520",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1275421780/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1276315740",
    "html_url": "https://github.com/hyperledger/besu/issues/4512#issuecomment-1276315740",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4512",
    "id": 1276315740,
    "node_id": "IC_kwDODE2jmc5MEwhc",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-12T14:55:22Z",
    "updated_at": "2022-10-12T14:55:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm pretty sure the problem is that Besu is failing to import on the first try because of an internal error and incorrectly adding the block to the bad block list. So when Teku retries it responds INVALID because it's already in the known bad block list.  Why do I think this, because someone helpfully added a TODO that pointed out exactly how this is broken. :)\r\n\r\nhttps://github.com/hyperledger/besu/blob/016016d4f7f4af623a25a655fd7fb645b4ce2760/ethereum/core/src/main/java/org/hyperledger/besu/ethereum/MainnetBlockValidator.java#L153\r\n```java\r\n    if (result.causedBy().isPresent()) {\r\n      LOG.info(\"{}. Block {}, caused by {}\", reason, invalidBlock.toLogString(), result.causedBy());\r\n      // TODO: if it's an internal error, don't add it\r\n      badBlockManager.addBadBlock(invalidBlock);\r\n      return new Result(reason, result.causedBy().get());\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1276315740/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1276794830",
    "html_url": "https://github.com/hyperledger/besu/issues/4512#issuecomment-1276794830",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4512",
    "id": 1276794830,
    "node_id": "IC_kwDODE2jmc5MGlfO",
    "user": {
      "login": "non-fungible-nelson",
      "id": 85905982,
      "node_id": "MDQ6VXNlcjg1OTA1OTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/non-fungible-nelson",
      "html_url": "https://github.com/non-fungible-nelson",
      "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
      "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
      "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
      "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
      "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
      "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-12T22:24:12Z",
    "updated_at": "2022-10-12T22:24:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "ROUGH To-Do lol ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1276794830/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1286662296",
    "html_url": "https://github.com/hyperledger/besu/issues/4512#issuecomment-1286662296",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4512",
    "id": 1286662296,
    "node_id": "IC_kwDODE2jmc5MsOiY",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-21T08:52:36Z",
    "updated_at": "2022-10-21T08:52:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "Reopening this one. It's recurred with 22.7.7 on goerli:\r\n\r\n```\r\n{\"@timestamp\":\"2022-10-21T08:08:14,250\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"EngineNewPayload\",\"message\":\"Imported #7,807,240 / 115 tx / base fee 52.74 gwei / 29,997,769 (100.0%) gas / (0xc8a33\r\n0188690e6a0f8dc96e7980de612b152a9c944ee5155b44e928eaea286e4) in 0.643s. Peers: 25\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-21T08:08:15,160\",\"level\":\"INFO\",\"thread\":\"EthScheduler-Computation-0\",\"class\":\"MergeCoordinator\",\"message\":\"Successfully built block 7807241 (0xc1fac2b70275bcde2cdea44086b53d376bdd1a213ca136d\r\n34dacf752360b935a) for proposal identified by 0x002cea8de1f80288, with 40 transactions, in 748ms\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-21T08:08:24,082\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"EngineGetPayload\",\"message\":\"Fetch block proposal by identifier: 0x002cea8de1f80288, hash: 0xc1fac2b70275bcde2cdea44\r\n086b53d376bdd1a213ca136d34dacf752360b935a, number: 7807241, coinbase: 0x000095e79eac4d76aab57cb2c1f091d553b36ca0, transaction count: 40\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-21T08:08:25,336\",\"level\":\"ERROR\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"AbstractBlockProcessor\",\"message\":\"failed persisting block\",\"throwable\":\" org.hyperledger.besu.plugin.services.exce\r\nption.StorageException: org.rocksdb.RocksDBException: TimedOut(LockTimeout)\\n\\tat org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage$RocksDbTransaction.put(RocksDBColumnar\r\nKeyValueStorage.java:299)\\n\\tat org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage$RocksDbTransaction.put(RocksDBColumnarKeyValueStorage.java:280)\\n\\tat org.hyperledger.be\r\nsu.services.kvstore.SegmentedKeyValueStorageTransactionTransitionValidatorDecorator.put(SegmentedKeyValueStorageTransactionTransitionValidatorDecorator.java:36)\\n\\tat org.hyperledger.besu.services.kvstore.Segmented\r\nKeyValueStorageAdapter$1.put(SegmentedKeyValueStorageAdapter.java:80)\\n\\tat org.hyperledger.besu.ethereum.bonsai.BonsaiWorldStateKeyValueStorage$Updater.putStorageValueBySlotHash(BonsaiWorldStateKeyValueStorage.jav\r\na:362)\\n\\tat org.hyperledger.besu.ethereum.bonsai.BonsaiPersistedWorldState.calculateRootHash(BonsaiPersistedWorldState.java:171)\\n\\tat org.hyperledger.besu.ethereum.bonsai.BonsaiInMemoryWorldState.rootHash(BonsaiI\r\nnMemoryWorldState.java:43)\\n\\tat org.hyperledger.besu.ethereum.bonsai.BonsaiInMemoryWorldState.persist(BonsaiInMemoryWorldState.java:53)\\n\\tat org.hyperledger.besu.ethereum.mainnet.AbstractBlockProcessor.processBlo\r\nck(AbstractBlockProcessor.java:220)\\n\\tat org.hyperledger.besu.ethereum.mainnet.AbstractBlockProcessor.processBlock(AbstractBlockProcessor.java:43)\\n\\tat org.hyperledger.besu.ethereum.mainnet.BlockProcessor.process\r\nBlock(BlockProcessor.java:92)\\n\\tat org.hyperledger.besu.ethereum.MainnetBlockValidator.processBlock(MainnetBlockValidator.java:175)\\n\\tat org.hyperledger.besu.ethereum.MainnetBlockValidator.validateAndProcessBlock\r\n(MainnetBlockValidator.java:112)\\n\\tat org.hyperledger.besu.consensus.merge.blockcreation.MergeCoordinator.validateBlock(MergeCoordinator.java:343)\\n\\tat org.hyperledger.besu.consensus.merge.blockcreation.MergeCoor\r\ndinator.rememberBlock(MergeCoordinator.java:359)\\n\\tat org.hyperledger.besu.consensus.merge.blockcreation.TransitionCoordinator.rememberBlock(TransitionCoordinator.java:137)\\n\\tat org.hyperledger.besu.ethereum.api.\r\njsonrpc.internal.methods.engine.EngineNewPayload.syncResponse(EngineNewPayload.java:220)\\n\\tat org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.ExecutionEngineJsonRpcMethod.lambda$response$0(ExecutionEngi\r\nneJsonRpcMethod.java:73)\\n\\tat io.vertx.core.impl.ContextImpl.lambda$null$0(ContextImpl.java:159)\\n\\tat io.vertx.core.impl.AbstractContext.dispatch(AbstractContext.java:100)\\n\\tat io.vertx.core.impl.ContextImpl.lam\r\nbda$executeBlocking$1(ContextImpl.java:157)\\n\\tat io.vertx.core.impl.TaskQueue.run(TaskQueue.java:76)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\\n\\tat java.base/\r\njava.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\\n\\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\\n\\tat java.base/java.lang.Thread.run(Threa\r\nd.java:833)\\nCaused by: org.rocksdb.RocksDBException: TimedOut(LockTimeout)\\n\\tat org.rocksdb.Transaction.put(Native Method)\\n\\tat org.rocksdb.Transaction.put(Transaction.java:705)\\n\\tat org.hyperledger.besu.plugin\r\n.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage$RocksDbTransaction.put(RocksDBColumnarKeyValueStorage.java:293)\\n\\t... 25 more\\n\"}\r\n{\"@timestamp\":\"2022-10-21T08:08:25,339\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"MainnetBlockValidator\",\"message\":\"Error processing block. Block 7807241 (0xc1fac2b70275bcde2cdea44086b53d376bdd1a213\r\nca136d34dacf752360b935a), caused by Optional[org.hyperledger.besu.plugin.services.exception.StorageException: org.rocksdb.RocksDBException: TimedOut(LockTimeout)]\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-21T08:08:25,764\",\"level\":\"INFO\",\"thread\":\"EthScheduler-Computation-0\",\"class\":\"MergeCoordinator\",\"message\":\"Successfully built block 7807241 (0x7de5c3b86efb25792b820d74a7d763fe685a4b8fa69e755\r\n6c77b4b8c4fe91460) for proposal identified by 0x002cea8de1f8027c, with 75 transactions, in 1708ms\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-21T08:08:26,482\",\"level\":\"INFO\",\"thread\":\"EthScheduler-Computation-0\",\"class\":\"MergeCoordinator\",\"message\":\"Successfully built block 7807241 (0xee31984909c687f92cc1cb9a376f8854331f3f61efad29c\r\n8beeb2bc7fd91471a) for proposal identified by 0x002cea8de1f80288, with 87 transactions, in 2423ms\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-21T08:08:27,354\",\"level\":\"WARN\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"EngineNewPayload\",\"message\":\"Invalid new payload: number: 7807241, hash: 0xc1fac2b70275bcde2cdea44086b53d376bdd1a213\r\nca136d34dacf752360b935a, parentHash: 0xc8a330188690e6a0f8dc96e7980de612b152a9c944ee5155b44e928eaea286e4, latestValidHash: 0x0000000000000000000000000000000000000000000000000000000000000000, status: INVALID, validat\r\nionError: Block already present in bad block manager.\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-21T08:08:29,894\",\"level\":\"INFO\",\"thread\":\"EthScheduler-Computation-0\",\"class\":\"MergeCoordinator\",\"message\":\"Successfully built block 7807241 (0x0a887d2a7a9abf3acf9fff7ae91a695b257aece9da9e284\r\nf5597fbe1f0c0b09f) for proposal identified by 0x002cea8de1f8027c, with 96 transactions, in 1859ms\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-21T08:08:36,069\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"EngineGetPayload\",\"message\":\"Fetch block proposal by identifier: 0x002cea8de1f8027c, hash: 0x0a887d2a7a9abf3acf9fff7\r\nae91a695b257aece9da9e284f5597fbe1f0c0b09f, number: 7807241, coinbase: 0x000095e79eac4d76aab57cb2c1f091d553b36ca0, transaction count: 96\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-21T08:08:36,627\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"EngineNewPayload\",\"message\":\"Imported #7,807,241 / 96 tx / base fee 59.33 gwei / 22,170,408 (73.9%) gas / (0x0a887d2\r\na7a9abf3acf9fff7ae91a695b257aece9da9e284f5597fbe1f0c0b09f) in 0.396s. Peers: 24\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-21T08:09:16,031\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"EngineForkchoiceUpdated\",\"message\":\"VALID for fork-choice-update: head: 0x0a887d2a7a9abf3acf9fff7ae91a695b257aece9da\r\n9e284f5597fbe1f0c0b09f, finalized: 0x143ece4e2b06ef971121488683728fda6c53ae0d3584ebdef6cbce02d93f9193, safeBlockHash: 0xb46cfb90dbb6f9c9ac36980e024c05f18402c7a551e3908ad10d6fb069b70dd1\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-21T08:10:28,036\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"EngineForkchoiceUpdated\",\"message\":\"VALID for fork-choice-update: head: 0x0a887d2a7a9abf3acf9fff7ae91a695b257aece9da\r\n9e284f5597fbe1f0c0b09f, finalized: 0x143ece4e2b06ef971121488683728fda6c53ae0d3584ebdef6cbce02d93f9193, safeBlockHash: 0xb46cfb90dbb6f9c9ac36980e024c05f18402c7a551e3908ad10d6fb069b70dd1\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-21T08:11:40,035\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"EngineForkchoiceUpdated\",\"message\":\"VALID for fork-choice-update: head: 0x0a887d2a7a9abf3acf9fff7ae91a695b257aece9da\r\n9e284f5597fbe1f0c0b09f, finalized: 0x143ece4e2b06ef971121488683728fda6c53ae0d3584ebdef6cbce02d93f9193, safeBlockHash: 0xb46cfb90dbb6f9c9ac36980e024c05f18402c7a551e3908ad10d6fb069b70dd1\",\"throwable\":\"\"}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1286662296/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1287682633",
    "html_url": "https://github.com/hyperledger/besu/issues/4512#issuecomment-1287682633",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4512",
    "id": 1287682633,
    "node_id": "IC_kwDODE2jmc5MwHpJ",
    "user": {
      "login": "jflo",
      "id": 345937,
      "node_id": "MDQ6VXNlcjM0NTkzNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/345937?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jflo",
      "html_url": "https://github.com/jflo",
      "followers_url": "https://api.github.com/users/jflo/followers",
      "following_url": "https://api.github.com/users/jflo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jflo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jflo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jflo/subscriptions",
      "organizations_url": "https://api.github.com/users/jflo/orgs",
      "repos_url": "https://api.github.com/users/jflo/repos",
      "events_url": "https://api.github.com/users/jflo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jflo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-22T08:36:56Z",
    "updated_at": "2022-10-22T08:36:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "Reformatted logging output. \r\n[4512logs_teku_repoened.json.zip](https://github.com/hyperledger/besu/files/9843890/4512logs_teku_repoened.json.zip)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1287682633/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1287700015",
    "html_url": "https://github.com/hyperledger/besu/issues/4512#issuecomment-1287700015",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4512",
    "id": 1287700015,
    "node_id": "IC_kwDODE2jmc5MwL4v",
    "user": {
      "login": "jflo",
      "id": 345937,
      "node_id": "MDQ6VXNlcjM0NTkzNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/345937?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jflo",
      "html_url": "https://github.com/jflo",
      "followers_url": "https://api.github.com/users/jflo/followers",
      "following_url": "https://api.github.com/users/jflo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jflo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jflo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jflo/subscriptions",
      "organizations_url": "https://api.github.com/users/jflo/orgs",
      "repos_url": "https://api.github.com/users/jflo/repos",
      "events_url": "https://api.github.com/users/jflo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jflo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-22T10:04:09Z",
    "updated_at": "2022-10-22T10:04:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "The block was being added to badblock manager due to an exception during validation, as opposed to execution. \r\n\r\nhttps://github.com/hyperledger/besu/blob/33a0188fe25b1a675bf84af7fe0d64745f1aeb1f/consensus/merge/src/main/java/org/hyperledger/besu/consensus/merge/blockcreation/MergeCoordinator.java#L350\r\n\r\nThe results classes are different, and are handled differently. Will reafactor to have execution results extend validation results, and handle them in one place.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1287700015/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1297672041",
    "html_url": "https://github.com/hyperledger/besu/issues/4512#issuecomment-1297672041",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4512",
    "id": 1297672041,
    "node_id": "IC_kwDODE2jmc5NWOdp",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-31T20:53:15Z",
    "updated_at": "2022-10-31T20:53:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "Report from `Sea Monkey` https://discord.com/channels/905194001349627914/938504958909747250/1036727707293196359\r\n\r\n> All of my goerli-besu client pairs are hitting Invalid new payload at 7861134.\r\n`\r\n2022-10-31 15:44:39.978-04:00 | vert.x-worker-thread-0 | WARN  | EngineNewPayload | Invalid new payload: number: 7861134, hash: 0x1dd53b7be3e97262011376c2f1e8da4535785270db6a46659d6e1670e83c53af, parentHash: 0x6cf6b9f42cb3d995cad4871645e8165039df13a684a3aa2b15d6dc3e456186e2, latestValidHash: 0x0000000000000000000000000000000000000000000000000000000000000000, status: INVALID, validationError: Block already present in bad block manager.\r\n`",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1297672041/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
