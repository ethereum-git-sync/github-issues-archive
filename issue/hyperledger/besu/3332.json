{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/3332",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/3332/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/3332/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/3332/events",
  "html_url": "https://github.com/hyperledger/besu/issues/3332",
  "id": 1115980166,
  "node_id": "I_kwDODE2jmc5ChIGG",
  "number": 3332,
  "title": "Besu Ignores `BESU_REMOTE_CONNECTIONS_LIMIT_ENABLED` Being Set to `false`",
  "user": {
    "login": "ItayPodhajcer",
    "id": 19306955,
    "node_id": "MDQ6VXNlcjE5MzA2OTU1",
    "avatar_url": "https://avatars.githubusercontent.com/u/19306955?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ItayPodhajcer",
    "html_url": "https://github.com/ItayPodhajcer",
    "followers_url": "https://api.github.com/users/ItayPodhajcer/followers",
    "following_url": "https://api.github.com/users/ItayPodhajcer/following{/other_user}",
    "gists_url": "https://api.github.com/users/ItayPodhajcer/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ItayPodhajcer/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ItayPodhajcer/subscriptions",
    "organizations_url": "https://api.github.com/users/ItayPodhajcer/orgs",
    "repos_url": "https://api.github.com/users/ItayPodhajcer/repos",
    "events_url": "https://api.github.com/users/ItayPodhajcer/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ItayPodhajcer/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2129007612,
      "node_id": "MDU6TGFiZWwyMTI5MDA3NjEy",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/dev%20experience",
      "name": "dev experience",
      "color": "2a0b89",
      "default": false,
      "description": "The build system, things that enable easier development etc."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "macfarla",
    "id": 2627919,
    "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/macfarla",
    "html_url": "https://github.com/macfarla",
    "followers_url": "https://api.github.com/users/macfarla/followers",
    "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
    "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
    "organizations_url": "https://api.github.com/users/macfarla/orgs",
    "repos_url": "https://api.github.com/users/macfarla/repos",
    "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
    "received_events_url": "https://api.github.com/users/macfarla/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-01-27T09:34:05Z",
  "updated_at": "2022-02-09T17:21:08Z",
  "closed_at": "2022-02-09T17:21:08Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nAs we were deploying a private permissioned blockchain network, at some point we noticed that nodes were failing to start the sync process due to not finding any peers to connect to.\r\nTurns out they were getting the `TOO_MANY_PEERS` response from the bootnodes, who already had the max connected peers reached (the default 25 peers).\r\n\r\nWe decided to try and turn off that limit using the `BESU_REMOTE_CONNECTIONS_LIMIT_ENABLED` environment variable set to `false`, only to discover that it was being ignored having the max limit still enforced by the nodes.\r\n\r\nAs a workaround, we increased the max allowed peers which seems to have solved the inability of nodes to connect, but it means we'll need to keep adjusting that value as more nodes are added to the network, which is not ideal, as it requires a restart of the node.\r\n\r\n### Acceptance Criteria\r\nBesu should respect `BESU_REMOTE_CONNECTIONS_LIMIT_ENABLED` when it is set to `false`.\r\n\r\n### Steps to Reproduce (Bug)\r\n1. Deploy private permissioned network with a total of 25 (default max) nodes (with `BESU_REMOTE_CONNECTIONS_LIMIT_ENABLED` set to `false`)\r\n2. Deploy an additional node to the network\r\n3. Node should fail to connect to other peers\r\n\r\n**Expected behavior:** Besu should respect `BESU_REMOTE_CONNECTIONS_LIMIT_ENABLED` when it is set to `false`.\r\n\r\n**Actual behavior:** Besu ignores the value of `BESU_REMOTE_CONNECTIONS_LIMIT_ENABLED`.\r\n\r\n**Frequency:** Always\r\n\r\n### Versions (Add all that apply)\r\n* Software version: `21.10.6`\r\n\r\n\r\n",
  "closed_by": {
    "login": "macfarla",
    "id": 2627919,
    "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/macfarla",
    "html_url": "https://github.com/macfarla",
    "followers_url": "https://api.github.com/users/macfarla/followers",
    "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
    "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
    "organizations_url": "https://api.github.com/users/macfarla/orgs",
    "repos_url": "https://api.github.com/users/macfarla/repos",
    "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
    "received_events_url": "https://api.github.com/users/macfarla/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/3332/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/3332/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1033199626",
    "html_url": "https://github.com/hyperledger/besu/issues/3332#issuecomment-1033199626",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3332",
    "id": 1033199626,
    "node_id": "IC_kwDODE2jmc49lWAK",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-09T00:29:37Z",
    "updated_at": "2022-02-09T00:29:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "@ItayPodhajcer the `BESU_REMOTE_CONNECTIONS_LIMIT_ENABLED` is different to max_peers is to do with managing the percentage of total P2P connections that can be remotely initiated. This is useful if you're connecting to mainnet or public testnet but less useful for your private network use case. \r\nMore info here - https://besu.hyperledger.org/en/stable/HowTo/Find-and-Connect/Managing-Peers/#limit-remote-connections\r\n\r\nYou can't totally disable the max_peers, the default value is 25. But if your nodes can only connect to each other (ie not open to public mainnet/testnets) then it should be fine to make that 50? \r\n\r\nAlso consider - do you need all of your nodes to connect to all other nodes? Or maybe 25 peers is enough? The p2p and tx propagation protocols can handle it if not all nodes are 100% directly connected.\r\n\r\nAnother option in private networks is to disable discovery and use static nodes instead",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1033199626/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1033522083",
    "html_url": "https://github.com/hyperledger/besu/issues/3332#issuecomment-1033522083",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3332",
    "id": 1033522083,
    "node_id": "IC_kwDODE2jmc49mkuj",
    "user": {
      "login": "ItayPodhajcer",
      "id": 19306955,
      "node_id": "MDQ6VXNlcjE5MzA2OTU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/19306955?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ItayPodhajcer",
      "html_url": "https://github.com/ItayPodhajcer",
      "followers_url": "https://api.github.com/users/ItayPodhajcer/followers",
      "following_url": "https://api.github.com/users/ItayPodhajcer/following{/other_user}",
      "gists_url": "https://api.github.com/users/ItayPodhajcer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ItayPodhajcer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ItayPodhajcer/subscriptions",
      "organizations_url": "https://api.github.com/users/ItayPodhajcer/orgs",
      "repos_url": "https://api.github.com/users/ItayPodhajcer/repos",
      "events_url": "https://api.github.com/users/ItayPodhajcer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ItayPodhajcer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-09T09:07:12Z",
    "updated_at": "2022-02-09T09:07:12Z",
    "author_association": "NONE",
    "body": "Ah, it's a relatively new change to that page:\r\nhttps://github.com/hyperledger/besu-docs/commit/6839e9df4ccfeed710911c1fc38a020499dd10f2\r\n\r\nBefore that update, it used to read:\r\n\r\n======================================================\r\n\r\n**Limiting remote connections**\r\n\r\nIn private and permissioned networks with a level of trust between peers, enabling the\r\n[remote connection limits](../../Reference/CLI/CLI-Syntax.md#remote-connections-limit-enabled)\r\nis unnecessary and might adversely affect the speed at which nodes can join the network.\r\nLimiting remote connections may cause a clique of nodes to form when the number of nodes in the network is slightly\r\nhigher than [`--max-peers`](../../Reference/CLI/CLI-Syntax.md#max-peers).\r\nThe nodes in this clique are all connected to each other and cannot accept more connections.\r\n\r\nIn public networks, enabling the remote connections limit is necessary to prevent eclipse attacks, especially when\r\nusing [`--sync-mode`](../../Reference/CLI/CLI-Syntax.md#sync-mode) and\r\n[`--fast-sync-min-peers`](../../Reference/CLI/CLI-Syntax.md#fast-sync-min-peers).\r\n\r\n======================================================\r\n\r\nThat's why we thought setting `BESU_REMOTE_CONNECTIONS_LIMIT_ENABLED` will disable that the max peers limit completely.\r\n\r\nWe ended up increasing the max peers count.\r\n\r\nThanks for your response!",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1033522083/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1034007077",
    "html_url": "https://github.com/hyperledger/besu/issues/3332#issuecomment-1034007077",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3332",
    "id": 1034007077,
    "node_id": "IC_kwDODE2jmc49obIl",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-09T17:21:08Z",
    "updated_at": "2022-02-09T17:21:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "Great, thanks for your reply! I will close this ticket.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1034007077/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
