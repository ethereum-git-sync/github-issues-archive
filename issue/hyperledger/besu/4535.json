{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/4535",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/4535/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/4535/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/4535/events",
  "html_url": "https://github.com/hyperledger/besu/issues/4535",
  "id": 1408838405,
  "node_id": "I_kwDODE2jmc5T-SsF",
  "number": 4535,
  "title": "Excessive memory consumption on initial sync",
  "user": {
    "login": "tdiesler",
    "id": 244946,
    "node_id": "MDQ6VXNlcjI0NDk0Ng==",
    "avatar_url": "https://avatars.githubusercontent.com/u/244946?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tdiesler",
    "html_url": "https://github.com/tdiesler",
    "followers_url": "https://api.github.com/users/tdiesler/followers",
    "following_url": "https://api.github.com/users/tdiesler/following{/other_user}",
    "gists_url": "https://api.github.com/users/tdiesler/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tdiesler/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tdiesler/subscriptions",
    "organizations_url": "https://api.github.com/users/tdiesler/orgs",
    "repos_url": "https://api.github.com/users/tdiesler/repos",
    "events_url": "https://api.github.com/users/tdiesler/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tdiesler/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 16,
  "created_at": "2022-10-14T06:31:38Z",
  "updated_at": "2022-10-21T14:10:15Z",
  "closed_at": "2022-10-21T14:10:15Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nAfter 23h of syncing, Besu starts the world state healing process - I see an excessive mem usage of 26G and a very busy CPU. \r\n\r\n```\r\nCONTAINER ID   NAME      CPU %     MEM USAGE / LIMIT     MEM %     NET I/O           BLOCK I/O        PIDS\r\n8b3616a0c196   besu      241.31%   25.96GiB / 29.24GiB   88.79%    62.8GB / 6.84GB   455GB / 1.27TB   138\r\n```\r\n\r\nAfter several attempts, Besu has not yet managed to fully sync and crashed for memory issues, every time. \r\nIt seems to be worse with versions > 22.7.4\r\n\r\n**Expected behavior:**\r\nMem usage within acceptable/documented bounds. A system crash after several days of syncing should be avoided, especially because the initial sync will have to restart all over again.\r\n\r\n**Frequency:** \r\nSeems to occur every time\r\n\r\n### Versions (Add all that apply)\r\n* Besu-22.7.4-openjdk-11\r\n* CentOS Stream release 8\r\n* Linux vpsl01 4.18.0-365.el8.x86_64\r\n* Docker version 20.10.13\r\n\r\n### Additional Information (Add any of the following or anything else that may be relevant)\r\n\r\nI'm using -XX:MaxRAMPercentage=80, so it should have 24G\r\n\r\n```\r\ndocker run --detach \\\r\n  --name=besu \\\r\n  --user=0:0 \\\r\n  --restart=no \\\r\n  -p 8545:8545 \\\r\n  -p 8551:8551 \\\r\n  -p 30303:30303/tcp \\\r\n  -p 30303:30303/udp \\\r\n  -v besu-data:/var/besu/data \\\r\n  -v besu-config:/var/besu/config \\\r\n  -e BESU_OPTS=-XX:MaxRAMPercentage=80 \\\r\n  hyperledger/besu:${BESU_VERSION:-latest} \\\r\n    --network=mainnet \\\r\n    --data-path=/var/besu/data \\\r\n    --data-storage-format=bonsai \\\r\n    --sync-mode=x_checkpoint\r\n```\r\n\r\nhttps://discord.com/channels/697535391594446898/888098626264502302/1030171074052235325",
  "closed_by": {
    "login": "tdiesler",
    "id": 244946,
    "node_id": "MDQ6VXNlcjI0NDk0Ng==",
    "avatar_url": "https://avatars.githubusercontent.com/u/244946?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tdiesler",
    "html_url": "https://github.com/tdiesler",
    "followers_url": "https://api.github.com/users/tdiesler/followers",
    "following_url": "https://api.github.com/users/tdiesler/following{/other_user}",
    "gists_url": "https://api.github.com/users/tdiesler/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tdiesler/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tdiesler/subscriptions",
    "organizations_url": "https://api.github.com/users/tdiesler/orgs",
    "repos_url": "https://api.github.com/users/tdiesler/repos",
    "events_url": "https://api.github.com/users/tdiesler/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tdiesler/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/4535/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/4535/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1278595727",
    "html_url": "https://github.com/hyperledger/besu/issues/4535#issuecomment-1278595727",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4535",
    "id": 1278595727,
    "node_id": "IC_kwDODE2jmc5MNdKP",
    "user": {
      "login": "ahamlat",
      "id": 5099602,
      "node_id": "MDQ6VXNlcjUwOTk2MDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5099602?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahamlat",
      "html_url": "https://github.com/ahamlat",
      "followers_url": "https://api.github.com/users/ahamlat/followers",
      "following_url": "https://api.github.com/users/ahamlat/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahamlat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahamlat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahamlat/subscriptions",
      "organizations_url": "https://api.github.com/users/ahamlat/orgs",
      "repos_url": "https://api.github.com/users/ahamlat/repos",
      "events_url": "https://api.github.com/users/ahamlat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahamlat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-14T07:24:09Z",
    "updated_at": "2022-10-14T07:24:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "@tdiesler : The first thing we can check is either this is related to on-heap memory consumption or native memory consumption. For both cases have fixes and workarounds for both cases.\r\nFor heap usage, could you share heap usage and GC pause time graph ?\r\nFor native memory usage, have you already enabled Jemalloc lib ? it allows Besu to have less fragmentation when allocating objects in memory.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1278595727/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1278720960",
    "html_url": "https://github.com/hyperledger/besu/issues/4535#issuecomment-1278720960",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4535",
    "id": 1278720960,
    "node_id": "IC_kwDODE2jmc5MN7vA",
    "user": {
      "login": "tdiesler",
      "id": 244946,
      "node_id": "MDQ6VXNlcjI0NDk0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/244946?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tdiesler",
      "html_url": "https://github.com/tdiesler",
      "followers_url": "https://api.github.com/users/tdiesler/followers",
      "following_url": "https://api.github.com/users/tdiesler/following{/other_user}",
      "gists_url": "https://api.github.com/users/tdiesler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tdiesler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tdiesler/subscriptions",
      "organizations_url": "https://api.github.com/users/tdiesler/orgs",
      "repos_url": "https://api.github.com/users/tdiesler/repos",
      "events_url": "https://api.github.com/users/tdiesler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tdiesler/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-14T09:13:00Z",
    "updated_at": "2022-10-14T09:31:36Z",
    "author_association": "NONE",
    "body": "@ahamlat AFAICS, there is no mention of jemalloc at startup ...\r\n\r\n```\r\n2022-10-13 06:36:40.972+00:00 | main | INFO  | Besu | Using LibEthPairings native alt bn128\r\n2022-10-13 06:36:40.976+00:00 | main | INFO  | Besu | Using the native implementation of the signature algorithm\r\n2022-10-13 06:36:40.997+00:00 | main | INFO  | Besu | Using the native implementation of the blake2bf algorithm\r\n2022-10-13 06:36:41.004+00:00 | main | INFO  | Besu | Starting Besu version: besu/v22.7.4/linux-x86_64/openjdk-java-11\r\n2022-10-13 06:36:41.495+00:00 | main | WARN  | Besu | --graphql-http-host has been ignored because --graphql-http-enabled was not defined on the command line.\r\n2022-10-13 06:36:41.496+00:00 | main | WARN  | Besu | --rpc-ws-host has been ignored because --rpc-ws-enabled was not defined on the command line.\r\n2022-10-13 06:36:41.498+00:00 | main | INFO  | Besu | Static Nodes file = /var/besu/data/static-nodes.json\r\n2022-10-13 06:36:41.499+00:00 | main | INFO  | StaticNodesParser | StaticNodes file /var/besu/data/static-nodes.json does not exist, no static connections will be created.\r\n2022-10-13 06:36:41.499+00:00 | main | INFO  | Besu | Connecting to 0 static nodes.\r\n2022-10-13 06:36:41.502+00:00 | main | INFO  | Besu | Security Module: localfile\r\n2022-10-13 06:36:41.526+00:00 | main | INFO  | DatabaseMetadata | Lookup database metadata file in data directory: /var/besu/data\r\n2022-10-13 06:36:41.609+00:00 | main | INFO  | RocksDBKeyValueStorageFactory | Existing database detected at /var/besu/data. Version 2\r\n2022-10-13 06:36:44.794+00:00 | main | WARN  | Besu | --tx-pool-future-max-by-account has been deprecated, use --tx-pool-limit-by-account-percentage instead.\r\n2022-10-13 06:36:44.816+00:00 | main | INFO  | KeyPairUtil | Loaded public key 0x0ae8afc65f4eb662171fd5634e841e0ecff73d4e06f4f3de0222656176c1f75edc8c3bce90c6afd689c0de5ba9d6120832e21dbf783aefb7344c54a1cfde5918 from /var/besu/data/key\r\n2022-10-13 06:36:45.035+00:00 | main | INFO  | ProtocolScheduleBuilder | Protocol schedule created with milestones: [Frontier: 0, Homestead: 1150000, DaoRecoveryInit: 1920000, DaoRecoveryTransition: 1920001, Homestead: 1920010, TangerineWhistle: 2463000, SpuriousDragon: 2675000, Byzantium: 4370000, Petersburg: 7280\r\n000, Istanbul: 9069000, MuirGlacier: 9200000, Berlin: 12244000, London: 12965000, ArrowGlacier: 13773000, GrayGlacier: 15050000]\r\n2022-10-13 06:36:45.066+00:00 | main | INFO  | ProtocolScheduleBuilder | Protocol schedule created with milestones: [Frontier: 0, Homestead: 1150000, DaoRecoveryInit: 1920000, DaoRecoveryTransition: 1920001, Homestead: 1920010, TangerineWhistle: 2463000, SpuriousDragon: 2675000, Byzantium: 4370000, Petersburg: 7280\r\n000, Istanbul: 9069000, MuirGlacier: 9200000, Berlin: 12244000, London: 12965000, ArrowGlacier: 13773000, GrayGlacier: 15050000]\r\n2022-10-13 06:36:45.704+00:00 | main | INFO  | EthPeers | Updating the default best peer comparator\r\n2022-10-13 06:36:45.734+00:00 | main | INFO  | BesuControllerBuilder | TTD difficulty is present, creating initial sync phase with transition to PoS support\r\n2022-10-13 06:36:45.766+00:00 | main | INFO  | CheckpointDownloaderFactory | Checkpoint sync start with block 11052984 and hash 0x44bca881b07a6a09f83b130798072441705d9a665c5ac8bdf2f39a3cdf3bee29\r\n2022-10-13 06:36:46.087+00:00 | main | INFO  | TransitionBesuControllerBuilder | TTD present, creating DefaultSynchronizer that stops propagating after finalization\r\n2022-10-13 06:36:46.115+00:00 | main | INFO  | RunnerBuilder | Detecting NAT service.\r\n2022-10-13 06:36:46.401+00:00 | main | INFO  | Runner | Starting external services ... \r\n2022-10-13 06:36:46.402+00:00 | main | INFO  | JsonRpcHttpService | Starting JSON-RPC service on 0.0.0.0:8545\r\n2022-10-13 06:36:46.515+00:00 | main | INFO  | JsonRpcService | Starting JSON-RPC service on 0.0.0.0:8551\r\n2022-10-13 06:36:46.514+00:00 | vert.x-eventloop-thread-1 | INFO  | JsonRpcHttpService | JSON-RPC service started and listening on 0.0.0.0:8545\r\n2022-10-13 06:36:46.525+00:00 | vert.x-eventloop-thread-1 | INFO  | JsonRpcService | JSON-RPC service started and listening on 0.0.0.0:8551\r\n2022-10-13 06:36:46.530+00:00 | main | INFO  | AutoTransactionLogBloomCachingService | Starting auto transaction log bloom caching service.\r\n2022-10-13 06:36:46.532+00:00 | main | INFO  | LogBloomCacheMetadata | Lookup cache metadata file in data directory: /var/besu/data/caches\r\n2022-10-13 06:36:46.541+00:00 | main | INFO  | Runner | Starting Ethereum main loop ... \r\n2022-10-13 06:36:46.541+00:00 | main | INFO  | DockerNatManager | Starting docker NAT manager.\r\n2022-10-13 06:36:46.548+00:00 | main | INFO  | NetworkRunner | Starting Network.\r\n2022-10-13 06:36:46.552+00:00 | main | INFO  | DefaultP2PNetwork | Starting DNS discovery with URL enrtree://AKA3AM6LPBYEUDMVNU3BSVQJ5AD45Y7YPOHJLEF6W26QOE4VTUDPE@all.mainnet.ethdisco.net\r\n2022-10-13 06:36:46.662+00:00 | nioEventLoopGroup-2-1 | INFO  | RlpxAgent | P2P RLPx agent started and listening on /0.0.0.0:30303.\r\n2022-10-13 06:36:46.664+00:00 | main | INFO  | PeerDiscoveryAgent | Starting peer discovery agent on host=0.0.0.0, port=30303\r\n2022-10-13 06:36:46.725+00:00 | vert.x-eventloop-thread-1 | INFO  | VertxPeerDiscoveryAgent | Started peer discovery agent successfully, on effective host=0.0.0.0 and port=30303\r\n2022-10-13 06:36:46.727+00:00 | vert.x-eventloop-thread-1 | INFO  | PeerDiscoveryAgent | P2P peer discovery agent started and listening on /0.0.0.0:30303\r\n2022-10-13 06:36:46.830+00:00 | vert.x-eventloop-thread-1 | INFO  | PeerDiscoveryAgent | Writing node record to disk. NodeRecord{seq=37, publicKey=0x020ae8afc65f4eb662171fd5634e841e0ecff73d4e06f4f3de0222656176c1f75e, udpAddress=Optional[/127.0.0.1:30303], tcpAddress=Optional[/127.0.0.1:30303], asBase64=-Je4QJB_CLhN\r\ndRJpTxJItXvzw1qQiZ-cV3-yCoZdyxRj8xezZoc0d8baYJ4zZXRCuFmPRwOnNCDPtz2g_UyLpHIH2vglg2V0aMfGhPCv0OOAgmlkgnY0gmlwhH8AAAGJc2VjcDI1NmsxoQIK6K_GX062Yhcf1WNOhB4Oz_c9Tgb0894CImVhdsH3XoN0Y3CCdl-DdWRwgnZf, nodeId=0x532470b557b8c4e3bc78de09812dcf4dfc82f8a88ac4dd59130fa765e3f1b048, customFields={tcp=30303, udp=30303, ip=0x7f0000\r\n01, eth=[[0xf0afd0e3, 0x]], id=V4, secp256k1=0x020ae8afc65f4eb662171fd5634e841e0ecff73d4e06f4f3de0222656176c1f75e}}\r\n2022-10-13 06:36:46.913+00:00 | main | INFO  | DefaultP2PNetwork | Enode URL enode://0ae8afc65f4eb662171fd5634e841e0ecff73d4e06f4f3de0222656176c1f75edc8c3bce90c6afd689c0de5ba9d6120832e21dbf783aefb7344c54a1cfde5918@127.0.0.1:30303\r\n2022-10-13 06:36:46.914+00:00 | main | INFO  | DefaultP2PNetwork | Node address 0x812dcf4dfc82f8a88ac4dd59130fa765e3f1b048\r\n2022-10-13 06:36:46.918+00:00 | main | INFO  | DefaultSynchronizer | Starting synchronizer.\r\n2022-10-13 06:36:46.920+00:00 | main | INFO  | SnapSyncDownloader | Starting sync.\r\n2022-10-13 06:36:46.923+00:00 | main | INFO  | WaitForPeersTask | Waiting for 1 total peers to connect. 0 peers currently connected.\r\n2022-10-13 06:36:46.933+00:00 | main | INFO  | Runner | Ethereum main loop is up.\r\n```\r\n\r\n[This](https://github.com/hyperledger/besu/blob/main/besu/src/main/java/org/hyperledger/besu/cli/BesuCommand.java#L1486) suggests there should be a message about it. In any case, it would have to be enabled by the besu docker image, right? Here is a [related post](https://storck.io/posts/psa-switch-ruby-docker-to-jemalloc-now/) about a ruby image.\r\n\r\nHow would I get these mem stats from a running docker container?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1278720960/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1279169712",
    "html_url": "https://github.com/hyperledger/besu/issues/4535#issuecomment-1279169712",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4535",
    "id": 1279169712,
    "node_id": "IC_kwDODE2jmc5MPpSw",
    "user": {
      "login": "tdiesler",
      "id": 244946,
      "node_id": "MDQ6VXNlcjI0NDk0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/244946?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tdiesler",
      "html_url": "https://github.com/tdiesler",
      "followers_url": "https://api.github.com/users/tdiesler/followers",
      "following_url": "https://api.github.com/users/tdiesler/following{/other_user}",
      "gists_url": "https://api.github.com/users/tdiesler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tdiesler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tdiesler/subscriptions",
      "organizations_url": "https://api.github.com/users/tdiesler/orgs",
      "repos_url": "https://api.github.com/users/tdiesler/repos",
      "events_url": "https://api.github.com/users/tdiesler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tdiesler/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-14T15:41:32Z",
    "updated_at": "2022-10-14T15:54:04Z",
    "author_association": "NONE",
    "body": "[This](https://github.com/hyperledger/besu/blob/22.7.4/docker/openjdk-11/Dockerfile#L6) suggests that jemalloc is getting installed in `hyperledger/besu:22.7.4-openjdk-11`, but `BESU_USING_JEMALLOC ` is not getting set by the [startup script](https://github.com/hyperledger/besu/blob/release-22.7.6/besu/src/main/scripts/unixStartScript.txt#L190)\r\n\r\n```\r\nroot@09f08bdfc84a:/opt/besu# set | grep BESU\r\nBESU_GRAPHQL_HTTP_HOST=0.0.0.0\r\nBESU_OPTS=-XX:MaxRAMPercentage=80\r\nBESU_PID_PATH=/tmp/pid\r\nBESU_RPC_HTTP_HOST=0.0.0.0\r\nBESU_RPC_WS_HOST=0.0.0.0\r\n```\r\n\r\nI can load the library in container\r\n\r\n```\r\n$ docker exec -it besu bash\r\nLD_PRELOAD=libjemalloc.so sh -c true\r\n```\r\n\r\nNow, is it using it or not?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1279169712/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1280671291",
    "html_url": "https://github.com/hyperledger/besu/issues/4535#issuecomment-1280671291",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4535",
    "id": 1280671291,
    "node_id": "IC_kwDODE2jmc5MVX47",
    "user": {
      "login": "tdiesler",
      "id": 244946,
      "node_id": "MDQ6VXNlcjI0NDk0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/244946?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tdiesler",
      "html_url": "https://github.com/tdiesler",
      "followers_url": "https://api.github.com/users/tdiesler/followers",
      "following_url": "https://api.github.com/users/tdiesler/following{/other_user}",
      "gists_url": "https://api.github.com/users/tdiesler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tdiesler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tdiesler/subscriptions",
      "organizations_url": "https://api.github.com/users/tdiesler/orgs",
      "repos_url": "https://api.github.com/users/tdiesler/repos",
      "events_url": "https://api.github.com/users/tdiesler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tdiesler/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-17T10:54:01Z",
    "updated_at": "2022-10-17T10:54:01Z",
    "author_association": "NONE",
    "body": "@ahamlat Could you please share your workarounds? What do other folks use in their docker BESU_OPTS?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1280671291/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1281068943",
    "html_url": "https://github.com/hyperledger/besu/issues/4535#issuecomment-1281068943",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4535",
    "id": 1281068943,
    "node_id": "IC_kwDODE2jmc5MW4-P",
    "user": {
      "login": "ahamlat",
      "id": 5099602,
      "node_id": "MDQ6VXNlcjUwOTk2MDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5099602?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahamlat",
      "html_url": "https://github.com/ahamlat",
      "followers_url": "https://api.github.com/users/ahamlat/followers",
      "following_url": "https://api.github.com/users/ahamlat/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahamlat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahamlat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahamlat/subscriptions",
      "organizations_url": "https://api.github.com/users/ahamlat/orgs",
      "repos_url": "https://api.github.com/users/ahamlat/repos",
      "events_url": "https://api.github.com/users/ahamlat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahamlat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-17T15:35:22Z",
    "updated_at": "2022-10-17T15:35:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Now, is it using it or not?\r\n\r\nYou can use this command inside your docker container to be sure that Jemalloc is actually loaded : \r\nsudo lsof -n -p [PID] | fgrep jem \r\n\r\n> @ahamlat Could you please share your workarounds? What do other folks use in their docker BESU_OPTS?\r\n\r\nFor BESU_OPTS, you can replace the one you're using currently with this one :\r\nBESU_OPTS=-Xmx8g.\r\n\r\nIf you still have this excessive memory consumption, please share the result of this command :\r\njcmd [PID] GC.class_histogram\r\n \r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1281068943/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1282149710",
    "html_url": "https://github.com/hyperledger/besu/issues/4535#issuecomment-1282149710",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4535",
    "id": 1282149710,
    "node_id": "IC_kwDODE2jmc5MbA1O",
    "user": {
      "login": "tdiesler",
      "id": 244946,
      "node_id": "MDQ6VXNlcjI0NDk0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/244946?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tdiesler",
      "html_url": "https://github.com/tdiesler",
      "followers_url": "https://api.github.com/users/tdiesler/followers",
      "following_url": "https://api.github.com/users/tdiesler/following{/other_user}",
      "gists_url": "https://api.github.com/users/tdiesler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tdiesler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tdiesler/subscriptions",
      "organizations_url": "https://api.github.com/users/tdiesler/orgs",
      "repos_url": "https://api.github.com/users/tdiesler/repos",
      "events_url": "https://api.github.com/users/tdiesler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tdiesler/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-18T10:09:47Z",
    "updated_at": "2022-10-18T10:59:52Z",
    "author_association": "NONE",
    "body": "ok, it is using jemalloc\r\n\r\n```\r\nroot@456e6c4d7f81:/opt/besu# lsof -n -p 1 | grep jem\r\njava      1 root  mem       REG                8,2            1444124 /usr/lib/x86_64-linux-gnu/libjemalloc.so.2 (path dev=0,45)\r\n```\r\n\r\njcmd is not available in the openjdk image by default. If needed, I'll try to get it from elsewhere",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1282149710/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1282619077",
    "html_url": "https://github.com/hyperledger/besu/issues/4535#issuecomment-1282619077",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4535",
    "id": 1282619077,
    "node_id": "IC_kwDODE2jmc5MczbF",
    "user": {
      "login": "ahamlat",
      "id": 5099602,
      "node_id": "MDQ6VXNlcjUwOTk2MDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5099602?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahamlat",
      "html_url": "https://github.com/ahamlat",
      "followers_url": "https://api.github.com/users/ahamlat/followers",
      "following_url": "https://api.github.com/users/ahamlat/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahamlat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahamlat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahamlat/subscriptions",
      "organizations_url": "https://api.github.com/users/ahamlat/orgs",
      "repos_url": "https://api.github.com/users/ahamlat/repos",
      "events_url": "https://api.github.com/users/ahamlat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahamlat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-18T15:52:17Z",
    "updated_at": "2022-10-18T15:52:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "In this case, you can just let it run and see if Jemalloc helps to reduce memory consumption.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1282619077/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1282662450",
    "html_url": "https://github.com/hyperledger/besu/issues/4535#issuecomment-1282662450",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4535",
    "id": 1282662450,
    "node_id": "IC_kwDODE2jmc5Mc-Ay",
    "user": {
      "login": "tdiesler",
      "id": 244946,
      "node_id": "MDQ6VXNlcjI0NDk0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/244946?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tdiesler",
      "html_url": "https://github.com/tdiesler",
      "followers_url": "https://api.github.com/users/tdiesler/followers",
      "following_url": "https://api.github.com/users/tdiesler/following{/other_user}",
      "gists_url": "https://api.github.com/users/tdiesler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tdiesler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tdiesler/subscriptions",
      "organizations_url": "https://api.github.com/users/tdiesler/orgs",
      "repos_url": "https://api.github.com/users/tdiesler/repos",
      "events_url": "https://api.github.com/users/tdiesler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tdiesler/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-18T16:23:47Z",
    "updated_at": "2022-10-18T16:23:47Z",
    "author_association": "NONE",
    "body": "I manually installed jcmd in the running container and found that by running it mem drops by 1G - probably GC. Now that we verified that the process is indeed using jemalloc, I assume it was always there ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1282662450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1282685113",
    "html_url": "https://github.com/hyperledger/besu/issues/4535#issuecomment-1282685113",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4535",
    "id": 1282685113,
    "node_id": "IC_kwDODE2jmc5MdDi5",
    "user": {
      "login": "ahamlat",
      "id": 5099602,
      "node_id": "MDQ6VXNlcjUwOTk2MDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5099602?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahamlat",
      "html_url": "https://github.com/ahamlat",
      "followers_url": "https://api.github.com/users/ahamlat/followers",
      "following_url": "https://api.github.com/users/ahamlat/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahamlat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahamlat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahamlat/subscriptions",
      "organizations_url": "https://api.github.com/users/ahamlat/orgs",
      "repos_url": "https://api.github.com/users/ahamlat/repos",
      "events_url": "https://api.github.com/users/ahamlat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahamlat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-18T16:38:31Z",
    "updated_at": "2022-10-18T16:38:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "Could you share jcmd command results please ? ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1282685113/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1282731030",
    "html_url": "https://github.com/hyperledger/besu/issues/4535#issuecomment-1282731030",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4535",
    "id": 1282731030,
    "node_id": "IC_kwDODE2jmc5MdOwW",
    "user": {
      "login": "tdiesler",
      "id": 244946,
      "node_id": "MDQ6VXNlcjI0NDk0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/244946?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tdiesler",
      "html_url": "https://github.com/tdiesler",
      "followers_url": "https://api.github.com/users/tdiesler/followers",
      "following_url": "https://api.github.com/users/tdiesler/following{/other_user}",
      "gists_url": "https://api.github.com/users/tdiesler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tdiesler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tdiesler/subscriptions",
      "organizations_url": "https://api.github.com/users/tdiesler/orgs",
      "repos_url": "https://api.github.com/users/tdiesler/repos",
      "events_url": "https://api.github.com/users/tdiesler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tdiesler/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-18T17:05:11Z",
    "updated_at": "2022-10-18T17:05:11Z",
    "author_association": "NONE",
    "body": "Here you go ... \r\n\r\nThis is after 8h, currently @ `Worldstate download in progress synced=30.36%`\r\n\r\n```\r\nCONTAINER ID   NAME      CPU %     MEM USAGE / LIMIT     MEM %     NET I/O           BLOCK I/O        PIDS\r\naa78adccf96d   besu      255.21%   6.664GiB / 20GiB      33.32%    74.2GB / 2.48GB   305GB / 1.22TB   144\r\n```\r\n\r\n[gc_hist.txt](https://github.com/hyperledger/besu/files/9813496/gc_hist.txt)\r\n\r\nWith previous attempts, I could always get passed the worldstate download phase. Memory consumption shot up during healing and the furthest I got was 20m nodes\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1282731030/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1282989028",
    "html_url": "https://github.com/hyperledger/besu/issues/4535#issuecomment-1282989028",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4535",
    "id": 1282989028,
    "node_id": "IC_kwDODE2jmc5MeNvk",
    "user": {
      "login": "ahamlat",
      "id": 5099602,
      "node_id": "MDQ6VXNlcjUwOTk2MDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5099602?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahamlat",
      "html_url": "https://github.com/ahamlat",
      "followers_url": "https://api.github.com/users/ahamlat/followers",
      "following_url": "https://api.github.com/users/ahamlat/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahamlat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahamlat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahamlat/subscriptions",
      "organizations_url": "https://api.github.com/users/ahamlat/orgs",
      "repos_url": "https://api.github.com/users/ahamlat/repos",
      "events_url": "https://api.github.com/users/ahamlat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahamlat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-18T20:50:22Z",
    "updated_at": "2022-10-18T20:50:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "From the histogram, we can see that we have a lot of Transaction's objects in memory. We already fixed this issue in Besu 22.7.6 and one other similar issue that happens during backward sync in 22.10.0-RC1.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1282989028/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1283438645",
    "html_url": "https://github.com/hyperledger/besu/issues/4535#issuecomment-1283438645",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4535",
    "id": 1283438645,
    "node_id": "IC_kwDODE2jmc5Mf7g1",
    "user": {
      "login": "tdiesler",
      "id": 244946,
      "node_id": "MDQ6VXNlcjI0NDk0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/244946?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tdiesler",
      "html_url": "https://github.com/tdiesler",
      "followers_url": "https://api.github.com/users/tdiesler/followers",
      "following_url": "https://api.github.com/users/tdiesler/following{/other_user}",
      "gists_url": "https://api.github.com/users/tdiesler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tdiesler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tdiesler/subscriptions",
      "organizations_url": "https://api.github.com/users/tdiesler/orgs",
      "repos_url": "https://api.github.com/users/tdiesler/repos",
      "events_url": "https://api.github.com/users/tdiesler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tdiesler/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-19T05:10:37Z",
    "updated_at": "2022-10-19T07:53:28Z",
    "author_association": "NONE",
    "body": "This is `hyperledger/besu:22.7.6-openjdk-11`. After 20h it got to `Worldstate download in progress synced=49.02%` - this seems (a lot) slower than on previous attempts (with -Xmx > 16g). Now, for 3h no worldstate download progress ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1283438645/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1283953538",
    "html_url": "https://github.com/hyperledger/besu/issues/4535#issuecomment-1283953538",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4535",
    "id": 1283953538,
    "node_id": "IC_kwDODE2jmc5Mh5OC",
    "user": {
      "login": "ahamlat",
      "id": 5099602,
      "node_id": "MDQ6VXNlcjUwOTk2MDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5099602?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahamlat",
      "html_url": "https://github.com/ahamlat",
      "followers_url": "https://api.github.com/users/ahamlat/followers",
      "following_url": "https://api.github.com/users/ahamlat/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahamlat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahamlat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahamlat/subscriptions",
      "organizations_url": "https://api.github.com/users/ahamlat/orgs",
      "repos_url": "https://api.github.com/users/ahamlat/repos",
      "events_url": "https://api.github.com/users/ahamlat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahamlat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-19T12:40:57Z",
    "updated_at": "2022-10-19T12:40:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "Do you have metrics to share to see why this is so slow ? (block time import, number of connected peers, GC activity, CPU  usage, ...etc. \r\nIf you don't have a Besu Dashboard, you can take a look to this one : https://grafana.com/grafana/dashboards/10273-besu-overview/\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1283953538/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1286524906",
    "html_url": "https://github.com/hyperledger/besu/issues/4535#issuecomment-1286524906",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4535",
    "id": 1286524906,
    "node_id": "IC_kwDODE2jmc5Mrs_q",
    "user": {
      "login": "tdiesler",
      "id": 244946,
      "node_id": "MDQ6VXNlcjI0NDk0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/244946?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tdiesler",
      "html_url": "https://github.com/tdiesler",
      "followers_url": "https://api.github.com/users/tdiesler/followers",
      "following_url": "https://api.github.com/users/tdiesler/following{/other_user}",
      "gists_url": "https://api.github.com/users/tdiesler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tdiesler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tdiesler/subscriptions",
      "organizations_url": "https://api.github.com/users/tdiesler/orgs",
      "repos_url": "https://api.github.com/users/tdiesler/repos",
      "events_url": "https://api.github.com/users/tdiesler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tdiesler/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-21T06:39:57Z",
    "updated_at": "2022-10-21T06:45:07Z",
    "author_association": "NONE",
    "body": "The worldstate download stage completed after 42h with hyperledger/besu:22.7.6-openjdk-11. \r\n- memory usage at the time 15G (with -Xmx=16g)\r\n- 6.8TB written to disk\r\n- 2m core transaction kept in memory\r\n\r\n```\r\nCONTAINER ID   NAME      CPU %     MEM USAGE / LIMIT    MEM %     NET I/O         BLOCK I/O         PIDS\r\ne5e684197070   besu      148.87%   15.14GiB / 26GiB     58.23%    322GB / 15GB    2.73TB / 6.75TB   148\r\n```\r\n\r\n```\r\nroot@e5e684197070:/opt/besu# jcmd 1 GC.class_histogram | more\r\n1:\r\n num     #instances         #bytes  class name (module)\r\n-------------------------------------------------------\r\n   1:       2269717     1054792440  [B (java.base@11.0.16)\r\n   2:      11913052      948593616  [I (java.base@11.0.16)\r\n   3:       6144888      245795520  java.math.BigInteger (java.base@11.0.16)\r\n   4:       2051226      180507888  org.hyperledger.besu.ethereum.core.Transaction\r\n   5:       9450372      151205952  java.util.Optional (java.base@11.0.16)\r\n   6:       5758156      138195744  org.apache.tuweni.units.bigints.UInt256\r\n   7:       5757807      138187368  org.hyperledger.besu.datatypes.Wei\r\n   8:       3718265      118984480  org.apache.tuweni.bytes.ArrayWrappingBytes\r\n   9:       2051231       65639392  org.hyperledger.besu.crypto.SECPSignature\r\n  10:       2148159       51555816  org.hyperledger.besu.datatypes.Address\r\n  11:       2077249       49853976  com.google.common.base.Suppliers$NonSerializableMemoizingSupplier\r\n  12:       1748787       41970888  java.util.ArrayList (java.base@11.0.16)\r\n  13:       2051227       32819632  org.hyperledger.besu.crypto.SECPSignature$$Lambda$491/0x000000084043d840\r\n  14:        565769       18104608  org.apache.tuweni.bytes.ArrayWrappingBytes32\r\n  15:        120635       17225456  [Ljava.lang.Object; (java.base@11.0.16)\r\n  16:         97882        3915280  java.lang.ref.Finalizer (java.base@11.0.16)\r\n  17:         86573        2077752  org.hyperledger.besu.evm.AccessListEntry\r\n  18:         77219        1853256  java.lang.String (java.base@11.0.16)\r\n  19:         69647        1671528  org.hyperledger.besu.datatypes.Hash\r\n  20:        100059        1600944  java.util.concurrent.atomic.AtomicBoolean (java.base@11.0.16)\r\n  21:         48877        1564064  org.rocksdb.Transaction\r\n  22:         47499        1519968  java.util.HashMap$Node (java.base@11.0.16)\r\n  23:         13000        1456000  org.hyperledger.besu.ethereum.core.BlockHeader\r\n  24:         11355        1346784  java.lang.Class (java.base@11.0.16)\r\n  25:         48882        1173168  org.rocksdb.WriteOptions\r\n  26:         36155        1156960  java.util.concurrent.ConcurrentHashMap$Node (java.base@11.0.16)\r\n  27:           387         909336  [C (java.base@11.0.16)\r\n  28:          3780         789648  [Ljava.util.HashMap$Node; (java.base@11.0.16)\r\n  29:         15822         759456  java.nio.HeapByteBuffer (java.base@11.0.16)\r\n  30:         17775         711000  java.util.LinkedHashMap$Entry (java.base@11.0.16)\r\n  31:           960         645120  io.netty.util.internal.shaded.org.jctools.queues.MpscArrayQueue\r\n  32:         26811         643464  java.util.concurrent.CompletableFuture (java.base@11.0.16)\r\n  33:           642         608880  [Ljava.util.concurrent.ConcurrentHashMap$Node; (java.base@11.0.16)\r\n  34:          1956         603552  [J (java.base@11.0.16)\r\n  35:         12780         511200  java.util.concurrent.CompletableFuture$UniExceptionally (java.base@11.0.16)\r\n```\r\n\r\nNow, onward to the node healing stage. Let's hope this time it completes before the process dies with OOME\r\nCurrently nodes heal at a rate of 60k / min",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1286524906/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1286996779",
    "html_url": "https://github.com/hyperledger/besu/issues/4535#issuecomment-1286996779",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4535",
    "id": 1286996779,
    "node_id": "IC_kwDODE2jmc5MtgMr",
    "user": {
      "login": "tdiesler",
      "id": 244946,
      "node_id": "MDQ6VXNlcjI0NDk0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/244946?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tdiesler",
      "html_url": "https://github.com/tdiesler",
      "followers_url": "https://api.github.com/users/tdiesler/followers",
      "following_url": "https://api.github.com/users/tdiesler/following{/other_user}",
      "gists_url": "https://api.github.com/users/tdiesler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tdiesler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tdiesler/subscriptions",
      "organizations_url": "https://api.github.com/users/tdiesler/orgs",
      "repos_url": "https://api.github.com/users/tdiesler/repos",
      "events_url": "https://api.github.com/users/tdiesler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tdiesler/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-21T13:51:38Z",
    "updated_at": "2022-10-21T13:51:38Z",
    "author_association": "NONE",
    "body": "Ok, besu is done \r\n\r\n```\r\n2022-10-21 13:13:31.731+00:00 | EthScheduler-Services-28 (requestCompleteTask) | INFO  | SnapsyncMetricsManager | Finished worldstate snapsync with nodes 1390002633 (healed=8613992) duration 1:20:0,970.\r\n2022-10-21 13:13:31.998+00:00 | EthScheduler-Services-666 (importBlock) | INFO  | PipelineChainDownloader | PipelineChain download complete\r\n2022-10-21 13:13:32.043+00:00 | EthScheduler-Services-666 (importBlock) | INFO  | DefaultSynchronizer | Sync completed successfully with pivot block 15796599\r\n2022-10-21 13:13:32.043+00:00 | EthScheduler-Services-666 (importBlock) | INFO  | BesuControllerBuilder | Initial sync done, unsubscribe finalized block hash supplier\r\n```\r\n\r\nDoes this mean I can upgrade besu without having to do the initial sync again?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1286996779/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1287021319",
    "html_url": "https://github.com/hyperledger/besu/issues/4535#issuecomment-1287021319",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4535",
    "id": 1287021319,
    "node_id": "IC_kwDODE2jmc5MtmMH",
    "user": {
      "login": "tdiesler",
      "id": 244946,
      "node_id": "MDQ6VXNlcjI0NDk0Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/244946?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tdiesler",
      "html_url": "https://github.com/tdiesler",
      "followers_url": "https://api.github.com/users/tdiesler/followers",
      "following_url": "https://api.github.com/users/tdiesler/following{/other_user}",
      "gists_url": "https://api.github.com/users/tdiesler/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tdiesler/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tdiesler/subscriptions",
      "organizations_url": "https://api.github.com/users/tdiesler/orgs",
      "repos_url": "https://api.github.com/users/tdiesler/repos",
      "events_url": "https://api.github.com/users/tdiesler/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tdiesler/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-21T14:10:15Z",
    "updated_at": "2022-10-21T14:10:15Z",
    "author_association": "NONE",
    "body": "Closing - Thanks for your help ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1287021319/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
