{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/2288",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/2288/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/2288/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/2288/events",
  "html_url": "https://github.com/hyperledger/besu/issues/2288",
  "id": 893232124,
  "node_id": "MDU6SXNzdWU4OTMyMzIxMjQ=",
  "number": 2288,
  "title": "Uncaught exception on first start for fresh sync: `java.net.SocketTimeoutException`",
  "user": {
    "login": "yorickdowne",
    "id": 71337066,
    "node_id": "MDQ6VXNlcjcxMzM3MDY2",
    "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yorickdowne",
    "html_url": "https://github.com/yorickdowne",
    "followers_url": "https://api.github.com/users/yorickdowne/followers",
    "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
    "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
    "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
    "repos_url": "https://api.github.com/users/yorickdowne/repos",
    "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-05-17T11:25:37Z",
  "updated_at": "2021-06-01T16:05:54Z",
  "closed_at": "2021-06-01T16:05:54Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nThis is a cosmetic bug, of the \"we should really catch all expected exceptions\" variety.\r\n\r\nOn a fresh fast bonsai mainnet sync, this uncaught `java.net.SocketTimeoutException` exception is displayed in logs.\r\n\r\n```\r\nAttaching to besu-main_eth1_1\r\neth1_1  | Setting logging level to INFO\r\neth1_1  | 2021-05-17 11:21:23.300+00:00 | main | INFO  | AbstractAltBnPrecompiledContract | Using LibEthPairings native alt bn128\r\neth1_1  | 2021-05-17 11:21:23.318+00:00 | main | INFO  | SECP256K1 | Using native secp256k1\r\neth1_1  | 2021-05-17 11:21:23.322+00:00 | main | INFO  | Besu | Starting Besu version: besu/v21.1.6-dev-57f6cf55/linux-x86_64/oracle_openjdk-java-15\r\neth1_1  | 2021-05-17 11:21:23.495+00:00 | main | INFO  | Besu | Static Nodes file = /var/lib/besu/static-nodes.json\r\neth1_1  | 2021-05-17 11:21:23.497+00:00 | main | INFO  | StaticNodesParser | StaticNodes file /var/lib/besu/static-nodes.json does not exist, no static connections will be created.\r\neth1_1  | 2021-05-17 11:21:23.497+00:00 | main | INFO  | Besu | Connecting to 0 static nodes.\r\neth1_1  | 2021-05-17 11:21:23.501+00:00 | main | INFO  | Besu | Security Module: localfile\r\neth1_1  | 2021-05-17 11:21:23.515+00:00 | main | INFO  | RocksDBKeyValueStorageFactory | No existing database detected at /var/lib/besu. Using version 2\r\neth1_1  | 2021-05-17 11:21:24.596+00:00 | main | INFO  | KeyPairUtil | Generated new public key 0xb35e5d7a31c95b0630cd19cae80cba21eb22380e81e3cbe94b266ddaaf3dec8af9689ad3d51ffd8f470a478de014ba9297cdd300ca1e8cd58531d13a8a62dfeb and stored it to /var/lib/besu/key\r\neth1_1  | 2021-05-17 11:21:24.759+00:00 | main | INFO  | ProtocolScheduleBuilder | Protocol schedule created with milestones: [Frontier: 0, Homestead: 1150000, DaoRecoveryInit: 1920000, DaoRecoveryTransition: 1920001, Homestead: 1920010, TangerineWhistle: 2463000, SpuriousDragon: 2675000, Byzantium: 4370000, Petersburg: 7280000, Istanbul: 9069000, MuirGlacier: 9200000, Berlin: 12244000]\r\neth1_1  | 2021-05-17 11:21:26.005+00:00 | main | INFO  | RunnerBuilder | Detecting NAT service.\r\neth1_1  | 2021-05-17 11:21:26.132+00:00 | main | INFO  | Runner | Starting Ethereum main loop ...\r\neth1_1  | 2021-05-17 11:21:26.132+00:00 | main | INFO  | DockerNatManager | Starting docker NAT manager.\r\neth1_1  | 2021-05-17 11:21:26.148+00:00 | main | INFO  | NetworkRunner | Starting Network.\r\neth1_1  | 2021-05-17 11:21:26.151+00:00 | main | INFO  | DefaultP2PNetwork | Starting DNS discovery with URL enrtree://AKA3AM6LPBYEUDMVNU3BSVQJ5AD45Y7YPOHJLEF6W26QOE4VTUDPE@all.mainnet.ethdisco.net\r\neth1_1  | 2021-05-17 11:21:26.378+00:00 | nioEventLoopGroup-2-1 | INFO  | RlpxAgent | P2P RLPx agent started and listening on /0.0.0.0:30313.\r\neth1_1  | 2021-05-17 11:21:26.378+00:00 | main | INFO  | PeerDiscoveryAgent | Starting peer discovery agent on host=0.0.0.0, port=30313\r\neth1_1  | 2021-05-17 11:21:26.443+00:00 | vert.x-eventloop-thread-2 | INFO  | VertxPeerDiscoveryAgent | Started peer discovery agent successfully, on effective host=0.0.0.0 and port=30313\r\neth1_1  | 2021-05-17 11:21:26.444+00:00 | vert.x-eventloop-thread-2 | INFO  | PeerDiscoveryAgent | P2P peer discovery agent started and listening on /0.0.0.0:30313\r\neth1_1  | 2021-05-17 11:21:26.488+00:00 | vert.x-eventloop-thread-2 | INFO  | PeerDiscoveryAgent | Writing node record to disk. NodeRecord{seq=1, publicKey=0x03b35e5d7a31c95b0630cd19cae80cba21eb22380e81e3cbe94b266ddaaf3dec8a, udpAddress=Optional[/127.0.0.1:30313], tcpAddress=Optional[/127.0.0.1:30313], asBase64=-Jq4QELpKnULAYa0sRq_AlJYA_tX9puQQ41l-uPq4omiWolFASdcQ0Jlc9eRMAiwSIkd_0RoFXuQHZmfirCJv1PmCHYBg2V0aMrJhPxk7ASDEYwwgmlkgnY0gmlwhH8AAAGJc2VjcDI1NmsxoQOzXl16MclbBjDNGcroDLoh6yI4DoHjy-lLJm3arz3sioN0Y3CCdmmDdWRwgnZp, nodeId=0xf154424ac21b8605578b554bdd8fbde4302d2d7a945653ca98816ad60f20fd2c}\r\neth1_1  | 2021-05-17 11:21:26.733+00:00 | main | INFO  | DefaultP2PNetwork | Enode URL enode://b35e5d7a31c95b0630cd19cae80cba21eb22380e81e3cbe94b266ddaaf3dec8af9689ad3d51ffd8f470a478de014ba9297cdd300ca1e8cd58531d13a8a62dfeb@127.0.0.1:30313\r\neth1_1  | 2021-05-17 11:21:26.734+00:00 | main | INFO  | DefaultP2PNetwork | Node address 0xdd8fbde4302d2d7a945653ca98816ad60f20fd2c\r\neth1_1  | 2021-05-17 11:21:26.748+00:00 | main | INFO  | DefaultSynchronizer | Starting synchronizer.\r\neth1_1  | 2021-05-17 11:21:26.752+00:00 | main | INFO  | FastSyncDownloader | Starting fast sync.\r\neth1_1  | 2021-05-17 11:21:26.758+00:00 | main | INFO  | WaitForPeersTask | Waiting for 5 peers to connect. 0 peers currently connected.\r\neth1_1  | 2021-05-17 11:21:26.770+00:00 | main | INFO  | JsonRpcHttpService | Starting JSON-RPC service on 0.0.0.0:8547\r\neth1_1  | 2021-05-17 11:21:26.827+00:00 | vert.x-eventloop-thread-6 | INFO  | JsonRpcHttpService | JSON-RPC service started and listening on 0.0.0.0:8547\r\neth1_1  | 2021-05-17 11:21:26.829+00:00 | main | INFO  | WebSocketService | Starting Websocket service on 0.0.0.0:8548\r\neth1_1  | 2021-05-17 11:21:26.837+00:00 | vert.x-eventloop-thread-0 | INFO  | WebSocketService | Websocket service started and listening on 0.0.0.0:8548\r\neth1_1  | 2021-05-17 11:21:26.840+00:00 | main | INFO  | Runner | Ethereum main loop is up.\r\neth1_1  | 2021-05-17 11:21:26.851+00:00 | main | INFO  | AutoTransactionLogBloomCachingService | Starting auto transaction log bloom caching service.\r\neth1_1  | 2021-05-17 11:21:26.852+00:00 | main | INFO  | LogBloomCacheMetadata | Lookup cache metadata file in data directory: /var/lib/besu/caches\r\neth1_1  | 2021-05-17 11:21:27.659+00:00 | nioEventLoopGroup-3-4 | INFO  | WaitForPeersTask | Waiting for 4 peers to connect.\r\neth1_1  | 2021-05-17 11:21:33.246+00:00 | nioEventLoopGroup-3-4 | INFO  | WaitForPeersTask | Waiting for 1 peers to connect.\r\neth1_1  | 2021-05-17 11:21:43.520+00:00 | Timer-0 | ERROR | Besu | Uncaught exception in thread \"Timer-0\"\r\neth1_1  | java.net.SocketTimeoutException\r\neth1_1  |       at org.xbill.DNS.Resolver.send(Resolver.java:157)\r\neth1_1  |       at org.apache.tuweni.discovery.DNSResolver.resolveRecordRaw(DNSResolver.kt:149)\r\neth1_1  |       at org.apache.tuweni.discovery.DNSResolver.resolveRecord(DNSResolver.kt:72)\r\neth1_1  |       at org.apache.tuweni.discovery.DNSResolver.internalVisit(DNSResolver.kt:166)\r\neth1_1  |       at org.apache.tuweni.discovery.DNSResolver.internalVisit(DNSResolver.kt:175)\r\neth1_1  |       at org.apache.tuweni.discovery.DNSResolver.internalVisit(DNSResolver.kt:175)\r\neth1_1  |       at org.apache.tuweni.discovery.DNSResolver.internalVisit(DNSResolver.kt:175)\r\neth1_1  |       at org.apache.tuweni.discovery.DNSResolver.internalVisit(DNSResolver.kt:175)\r\neth1_1  |       at org.apache.tuweni.discovery.DNSResolver.visitTree(DNSResolver.kt:129)\r\neth1_1  |       at org.apache.tuweni.discovery.DNSResolver.visitTree(DNSResolver.kt:105)\r\neth1_1  |       at org.apache.tuweni.discovery.DNSResolver.collectAll(DNSResolver.kt:94)\r\neth1_1  |       at org.apache.tuweni.discovery.DNSTimerTask.run(DNSDaemon.kt:70)\r\neth1_1  |       at java.base/java.util.TimerThread.mainLoop(Timer.java:556)\r\neth1_1  |       at java.base/java.util.TimerThread.run(Timer.java:506)\r\neth1_1  | 2021-05-17 11:21:45.249+00:00 | nioEventLoopGroup-3-7 | INFO  | WaitForPeersTask | Waiting for 3 peers to connect.\r\neth1_1  | 2021-05-17 11:21:46.659+00:00 | nioEventLoopGroup-3-3 | INFO  | WaitForPeersTask | Waiting for 3 peers to connect.\r\neth1_1  | 2021-05-17 11:21:51.386+00:00 | nioEventLoopGroup-3-2 | INFO  | WaitForPeersTask | Waiting for 3 peers to connect.\r\n```\r\n\r\n**Expected behavior:** \r\n\r\nException is caught and handled by Besu\r\n\r\n### Versions (Add all that apply)\r\n* Software version: `besu/v21.1.6-dev-57f6cf55/linux-x86_64/oracle_openjdk-java-15`\r\n* Java version: 15\r\n* OS Name & Version: Ubuntu 20.04\r\n\r\n",
  "closed_by": {
    "login": "sajz",
    "id": 5994549,
    "node_id": "MDQ6VXNlcjU5OTQ1NDk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5994549?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sajz",
    "html_url": "https://github.com/sajz",
    "followers_url": "https://api.github.com/users/sajz/followers",
    "following_url": "https://api.github.com/users/sajz/following{/other_user}",
    "gists_url": "https://api.github.com/users/sajz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sajz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sajz/subscriptions",
    "organizations_url": "https://api.github.com/users/sajz/orgs",
    "repos_url": "https://api.github.com/users/sajz/repos",
    "events_url": "https://api.github.com/users/sajz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sajz/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/2288/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/2288/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/842588800",
    "html_url": "https://github.com/hyperledger/besu/issues/2288#issuecomment-842588800",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2288",
    "id": 842588800,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MjU4ODgwMA==",
    "user": {
      "login": "atoulme",
      "id": 16758,
      "node_id": "MDQ6VXNlcjE2NzU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16758?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/atoulme",
      "html_url": "https://github.com/atoulme",
      "followers_url": "https://api.github.com/users/atoulme/followers",
      "following_url": "https://api.github.com/users/atoulme/following{/other_user}",
      "gists_url": "https://api.github.com/users/atoulme/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/atoulme/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/atoulme/subscriptions",
      "organizations_url": "https://api.github.com/users/atoulme/orgs",
      "repos_url": "https://api.github.com/users/atoulme/repos",
      "events_url": "https://api.github.com/users/atoulme/events{/privacy}",
      "received_events_url": "https://api.github.com/users/atoulme/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-17T19:53:24Z",
    "updated_at": "2021-05-17T19:53:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "This issue occurs while Besu tries to connect via DNS over TCP for dns discovery.\r\n\r\nIt will be better handled once Tuweni 1.4 is out. In the meantime, this wonâ€™t break the client. The task will try to run again.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/842588800/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
