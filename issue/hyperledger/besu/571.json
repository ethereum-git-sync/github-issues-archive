{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/571",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/571/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/571/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/571/events",
  "html_url": "https://github.com/hyperledger/besu/issues/571",
  "id": 587599682,
  "node_id": "MDU6SXNzdWU1ODc1OTk2ODI=",
  "number": 571,
  "title": "Concurrent Private Transactions fail to be processed",
  "user": {
    "login": "magooster",
    "id": 12111442,
    "node_id": "MDQ6VXNlcjEyMTExNDQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/12111442?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/magooster",
    "html_url": "https://github.com/magooster",
    "followers_url": "https://api.github.com/users/magooster/followers",
    "following_url": "https://api.github.com/users/magooster/following{/other_user}",
    "gists_url": "https://api.github.com/users/magooster/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/magooster/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/magooster/subscriptions",
    "organizations_url": "https://api.github.com/users/magooster/orgs",
    "repos_url": "https://api.github.com/users/magooster/repos",
    "events_url": "https://api.github.com/users/magooster/events{/privacy}",
    "received_events_url": "https://api.github.com/users/magooster/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 1740324632,
      "node_id": "MDU6TGFiZWwxNzQwMzI0NjMy",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/privacy",
      "name": "privacy",
      "color": "d7f99a",
      "default": false,
      "description": "private transactions"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "lucassaldanha",
    "id": 1766440,
    "node_id": "MDQ6VXNlcjE3NjY0NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lucassaldanha",
    "html_url": "https://github.com/lucassaldanha",
    "followers_url": "https://api.github.com/users/lucassaldanha/followers",
    "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
    "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
    "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
    "repos_url": "https://api.github.com/users/lucassaldanha/repos",
    "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 12,
  "created_at": "2020-03-25T10:37:30Z",
  "updated_at": "2020-04-07T23:20:16Z",
  "closed_at": "2020-04-07T23:20:16Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Steps to Reproduce (Bug)\r\n\r\n1.  Using web3js-eea, submit two private transactions in rapid succession, with an incrementing private tx nonce. \r\n\r\n**Expected behavior:** \r\nTransactions are processed in the submitted order - according to private transaction nonce\r\n\r\n**Actual behavior:** \r\nTransactions fail to be processed, typically one will fail. In web3j-eea polling for transaction receipt times out...\r\n\r\n**Frequency:** \r\nMajority of the time\r\n\r\n### Versions (Add all that apply)\r\n* Software version: Besu 1.4.2-SNAPSHOT, Orion 1.5.0, Web3js-eea latest\r\n\r\n### Additional Information\r\nBesu running with fixed signing key\r\n\r\nIssue relates to the privacy marker transaction nonce which ultimately determines order of transactions. The privacy marker transaction can get duplicate nonces or even out of order with respect to private transaction nonce.\r\n\r\nI adding some logging for the generated privacy marker transaction nonce and see for example two requests using the same nonce.\r\n\r\n2020-03-25 08:41:42.570+00:00 | vert.x-worker-thread-16 | DEBUG | EeaSendRawTransaction | Privacy Marker Transaction nonce 7755\r\n2020-03-25 08:41:42.570+00:00 | vert.x-worker-thread-17 | DEBUG | EeaSendRawTransaction | Privacy Marker Transaction nonce 7755\r\n\r\nWhere privacy marker transaction nonce is out of order with respect to private transaction nonce - see the following in the logs\r\n\r\n2020-03-25 10:22:00.034+00:00 | pool-10-thread-1 | ERROR | PrivacyPrecompiledContract | Failed to process private transaction 0xa53b8b21ea7799b3897924e3cb13f4fe40b3afcf23ca437179f18e468b28eade: Private Transaction nonce 50, does not match sender account nonce 49.\r\n\r\n\r\n\r\n\r\n",
  "closed_by": {
    "login": "MadelineMurray",
    "id": 43356962,
    "node_id": "MDQ6VXNlcjQzMzU2OTYy",
    "avatar_url": "https://avatars.githubusercontent.com/u/43356962?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MadelineMurray",
    "html_url": "https://github.com/MadelineMurray",
    "followers_url": "https://api.github.com/users/MadelineMurray/followers",
    "following_url": "https://api.github.com/users/MadelineMurray/following{/other_user}",
    "gists_url": "https://api.github.com/users/MadelineMurray/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MadelineMurray/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MadelineMurray/subscriptions",
    "organizations_url": "https://api.github.com/users/MadelineMurray/orgs",
    "repos_url": "https://api.github.com/users/MadelineMurray/repos",
    "events_url": "https://api.github.com/users/MadelineMurray/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MadelineMurray/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/571/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/571/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/604740864",
    "html_url": "https://github.com/hyperledger/besu/issues/571#issuecomment-604740864",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/571",
    "id": 604740864,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNDc0MDg2NA==",
    "user": {
      "login": "MadelineMurray",
      "id": 43356962,
      "node_id": "MDQ6VXNlcjQzMzU2OTYy",
      "avatar_url": "https://avatars.githubusercontent.com/u/43356962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MadelineMurray",
      "html_url": "https://github.com/MadelineMurray",
      "followers_url": "https://api.github.com/users/MadelineMurray/followers",
      "following_url": "https://api.github.com/users/MadelineMurray/following{/other_user}",
      "gists_url": "https://api.github.com/users/MadelineMurray/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MadelineMurray/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MadelineMurray/subscriptions",
      "organizations_url": "https://api.github.com/users/MadelineMurray/orgs",
      "repos_url": "https://api.github.com/users/MadelineMurray/repos",
      "events_url": "https://api.github.com/users/MadelineMurray/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MadelineMurray/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-26T23:38:17Z",
    "updated_at": "2020-03-26T23:38:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "Next step - test incrementing nonce outside of library and sending with transaction. \r\nNext next step - document above approach. \r\nNext next next step - add nonce incrementing to library as default behaviour.  Raise GI for libraries once at this step. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/604740864/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/604755451",
    "html_url": "https://github.com/hyperledger/besu/issues/571#issuecomment-604755451",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/571",
    "id": 604755451,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNDc1NTQ1MQ==",
    "user": {
      "login": "magooster",
      "id": 12111442,
      "node_id": "MDQ6VXNlcjEyMTExNDQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/12111442?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/magooster",
      "html_url": "https://github.com/magooster",
      "followers_url": "https://api.github.com/users/magooster/followers",
      "following_url": "https://api.github.com/users/magooster/following{/other_user}",
      "gists_url": "https://api.github.com/users/magooster/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/magooster/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/magooster/subscriptions",
      "organizations_url": "https://api.github.com/users/magooster/orgs",
      "repos_url": "https://api.github.com/users/magooster/repos",
      "events_url": "https://api.github.com/users/magooster/events{/privacy}",
      "received_events_url": "https://api.github.com/users/magooster/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-27T00:33:42Z",
    "updated_at": "2020-03-27T00:35:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "The failures i describe occur when incrementing the nonce outside of the call to web3.eea.sendRawTransaction...\r\n\r\nIMHO: There's still an issue with the generation of the privacy marker transaction nonces in the request handler in Besu - race condition",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/604755451/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/604770526",
    "html_url": "https://github.com/hyperledger/besu/issues/571#issuecomment-604770526",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/571",
    "id": 604770526,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNDc3MDUyNg==",
    "user": {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-27T01:37:47Z",
    "updated_at": "2020-03-27T01:37:56Z",
    "author_association": "MEMBER",
    "body": "> There's still an issue with the generation of the privacy marker transaction nonces in the request handler in Besu\r\n\r\nWe are aware of this issue and we are investigating how we can solve it (or get around it). It isn't a race condition in the code but it is a consequence of the way public and private tx nonces are independent of each other.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/604770526/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/605026846",
    "html_url": "https://github.com/hyperledger/besu/issues/571#issuecomment-605026846",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/571",
    "id": 605026846,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTAyNjg0Ng==",
    "user": {
      "login": "magooster",
      "id": 12111442,
      "node_id": "MDQ6VXNlcjEyMTExNDQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/12111442?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/magooster",
      "html_url": "https://github.com/magooster",
      "followers_url": "https://api.github.com/users/magooster/followers",
      "following_url": "https://api.github.com/users/magooster/following{/other_user}",
      "gists_url": "https://api.github.com/users/magooster/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/magooster/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/magooster/subscriptions",
      "organizations_url": "https://api.github.com/users/magooster/orgs",
      "repos_url": "https://api.github.com/users/magooster/repos",
      "events_url": "https://api.github.com/users/magooster/events{/privacy}",
      "received_events_url": "https://api.github.com/users/magooster/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-27T14:20:49Z",
    "updated_at": "2020-03-27T14:20:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for the update - it's a race condition in the system, two or more private transaction requests are trying to generate a privacy marker transaction at the same time but they need to be generated in the same order as the private transaction nonces to be processed correctly.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/605026846/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/605858072",
    "html_url": "https://github.com/hyperledger/besu/issues/571#issuecomment-605858072",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/571",
    "id": 605858072,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTg1ODA3Mg==",
    "user": {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-30T08:29:29Z",
    "updated_at": "2020-03-30T08:29:46Z",
    "author_association": "MEMBER",
    "body": "At the moment we don't have a way to specify the PMT nonce when using `eea_sendRawTransaction`. However, it is possible to use `priv_distributeRawTransaction` to distribute the private tx to the participants (with the private nonce) and `eth_sendRawTransaction` to create the PMT (with the public nonce).\r\n\r\nI'm gonna update web3js-eea with an example on how to do that through the library (https://github.com/PegaSysEng/web3js-eea/pull/77).\r\n\r\nWe will also raise a ticket for implementing a utility method in the library to make sending batch private transactions easier.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/605858072/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/605933358",
    "html_url": "https://github.com/hyperledger/besu/issues/571#issuecomment-605933358",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/571",
    "id": 605933358,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNTkzMzM1OA==",
    "user": {
      "login": "magooster",
      "id": 12111442,
      "node_id": "MDQ6VXNlcjEyMTExNDQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/12111442?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/magooster",
      "html_url": "https://github.com/magooster",
      "followers_url": "https://api.github.com/users/magooster/followers",
      "following_url": "https://api.github.com/users/magooster/following{/other_user}",
      "gists_url": "https://api.github.com/users/magooster/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/magooster/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/magooster/subscriptions",
      "organizations_url": "https://api.github.com/users/magooster/orgs",
      "repos_url": "https://api.github.com/users/magooster/repos",
      "events_url": "https://api.github.com/users/magooster/events{/privacy}",
      "received_events_url": "https://api.github.com/users/magooster/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-30T11:02:23Z",
    "updated_at": "2020-03-30T11:02:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "You can pass the nonce in web3js-eea to eea_sendRawTransaction via the options map\r\n\r\n* options map can contain the following:\r\n   * privateKey : Private Key used to sign transaction with\r\n   * privateFrom : Enclave public key\r\n   * privateFor : Enclave keys to send the transaction to\r\n   * privacyGroupId : Enclave id representing the receivers of the transaction\r\n   * nonce(Optional) : If not provided, will be calculated using `eea_getTransctionCount`\r\n...\r\n\r\nconst genericSendRawTransaction = (options, method) => {\r\n    if (options.privacyGroupId && options.privateFor) {\r\n      throw Error(\"privacyGroupId and privateFor are mutually exclusive\");\r\n    }\r\n    const tx = new PrivateTransaction();\r\n    const privateKeyBuffer = Buffer.from(options.privateKey, \"hex\");\r\n    const from = `0x${privateToAddress(privateKeyBuffer).toString(\"hex\")}`;\r\n    return web3.priv\r\n      .getTransactionCount({\r\n        from,\r\n        privateFrom: options.privateFrom,\r\n        privateFor: options.privateFor,\r\n        privacyGroupId: options.privacyGroupId\r\n      })\r\n      .then(transactionCount => {\r\n        tx.nonce = options.nonce || transactionCount;\r\n...\r\n\r\nObviously there's an unnecessary JSON-RPC call but you can override the nonce.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/605933358/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/606181152",
    "html_url": "https://github.com/hyperledger/besu/issues/571#issuecomment-606181152",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/571",
    "id": 606181152,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjE4MTE1Mg==",
    "user": {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-30T18:59:06Z",
    "updated_at": "2020-03-30T18:59:32Z",
    "author_association": "MEMBER",
    "body": "`eea_sendRawTransaction` allows you to choose the nonce of the private transaction, not the nonce of the PMT that will be created (the public tx). The process that I have described, using `priv_distributeRawTransaction` and `eth_sendRawTransaction` (ETH not EEA), makes it possible to specify both the private and the public nonce.\r\n\r\nThe example should make it clearer.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/606181152/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/606203684",
    "html_url": "https://github.com/hyperledger/besu/issues/571#issuecomment-606203684",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/571",
    "id": 606203684,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjIwMzY4NA==",
    "user": {
      "login": "magooster",
      "id": 12111442,
      "node_id": "MDQ6VXNlcjEyMTExNDQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/12111442?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/magooster",
      "html_url": "https://github.com/magooster",
      "followers_url": "https://api.github.com/users/magooster/followers",
      "following_url": "https://api.github.com/users/magooster/following{/other_user}",
      "gists_url": "https://api.github.com/users/magooster/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/magooster/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/magooster/subscriptions",
      "organizations_url": "https://api.github.com/users/magooster/orgs",
      "repos_url": "https://api.github.com/users/magooster/repos",
      "events_url": "https://api.github.com/users/magooster/events{/privacy}",
      "received_events_url": "https://api.github.com/users/magooster/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-30T19:38:55Z",
    "updated_at": "2020-03-30T19:38:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for the clarification, I had misread the previous response... it sounds like we'll need a public account for each privacy group account, to ensure both the private tx nonce and PMT nonce are aligned by order. Does this mean eea_sendRawTransaction will be deprecated in a future release?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/606203684/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/606206913",
    "html_url": "https://github.com/hyperledger/besu/issues/571#issuecomment-606206913",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/571",
    "id": 606206913,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjIwNjkxMw==",
    "user": {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-30T19:45:36Z",
    "updated_at": "2020-03-30T19:45:36Z",
    "author_association": "MEMBER",
    "body": "> it sounds like we'll need a public account for each privacy group account\r\n\r\nI'm not sure if I understood what you mean. Basically, any account can sign the private tx, and any account can sign the PMT. The important thing is, when creating the Private TXs and the PMTs, that the private and public nonces are chosen in a sensible way that will ensure that the PMTs will be executed in the expected order, and by consequence, the private txs will also be executed in the expected order.\r\n\r\nThe order that the PMTs are executed will dictate the ordering of the private transactions.\r\n\r\nWe don't have plans to deprecate eea_sendRawTransaction. It can still be used for sending private transactions (with the caveat of sending multiple txs from the same account at once being hard). We'll investigate how we can improve this in the future.\r\n\r\nAt this point in time, we'll recommend users to use the distribute/create PMT \"trick\" when needing to send multiple private txs at once.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/606206913/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/606213394",
    "html_url": "https://github.com/hyperledger/besu/issues/571#issuecomment-606213394",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/571",
    "id": 606213394,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjIxMzM5NA==",
    "user": {
      "login": "magooster",
      "id": 12111442,
      "node_id": "MDQ6VXNlcjEyMTExNDQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/12111442?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/magooster",
      "html_url": "https://github.com/magooster",
      "followers_url": "https://api.github.com/users/magooster/followers",
      "following_url": "https://api.github.com/users/magooster/following{/other_user}",
      "gists_url": "https://api.github.com/users/magooster/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/magooster/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/magooster/subscriptions",
      "organizations_url": "https://api.github.com/users/magooster/orgs",
      "repos_url": "https://api.github.com/users/magooster/repos",
      "events_url": "https://api.github.com/users/magooster/events{/privacy}",
      "received_events_url": "https://api.github.com/users/magooster/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-30T19:59:03Z",
    "updated_at": "2020-03-30T20:02:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "> The important thing is, when creating the Private TXs and the PMTs, that the private and public nonces are chosen in a sensible way that will ensure that the PMTs will be executed in the expected order, and by consequence, the private txs will also be executed in the expected order.\r\n\r\nThat's what I meant 'lock' a public account to a private account ensuring nonce increment in step. Ethereum enforces ordering at the account level.\r\n\r\nReusing across many increases the risk that public/private nonces will get out of step.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/606213394/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/606215457",
    "html_url": "https://github.com/hyperledger/besu/issues/571#issuecomment-606215457",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/571",
    "id": 606215457,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNjIxNTQ1Nw==",
    "user": {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-30T20:02:56Z",
    "updated_at": "2020-03-30T20:02:56Z",
    "author_association": "MEMBER",
    "body": "Got it! You are right, using the same account for the private transaction and for the PMT should definitely make things easier for the user. Easier to keep track of. This isn't something we'll enforce in the protocol level though.\r\n\r\nHave you had a chance to look at the PR that I have raised with the example on how to send concurrent txs? Do you think it can help others having the same problem?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/606215457/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/608174861",
    "html_url": "https://github.com/hyperledger/besu/issues/571#issuecomment-608174861",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/571",
    "id": 608174861,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwODE3NDg2MQ==",
    "user": {
      "login": "MadelineMurray",
      "id": 43356962,
      "node_id": "MDQ6VXNlcjQzMzU2OTYy",
      "avatar_url": "https://avatars.githubusercontent.com/u/43356962?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MadelineMurray",
      "html_url": "https://github.com/MadelineMurray",
      "followers_url": "https://api.github.com/users/MadelineMurray/followers",
      "following_url": "https://api.github.com/users/MadelineMurray/following{/other_user}",
      "gists_url": "https://api.github.com/users/MadelineMurray/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MadelineMurray/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MadelineMurray/subscriptions",
      "organizations_url": "https://api.github.com/users/MadelineMurray/orgs",
      "repos_url": "https://api.github.com/users/MadelineMurray/repos",
      "events_url": "https://api.github.com/users/MadelineMurray/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MadelineMurray/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-03T01:11:06Z",
    "updated_at": "2020-04-03T01:11:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "@magooster - following up to see if you've got anymore questions/comments before I close this one?  \r\n\r\nRaised https://github.com/hyperledger/besu-docs/issues/287 to reflect how to handle sending concurrent private transactions. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/608174861/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
