{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/2709",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/2709/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/2709/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/2709/events",
  "html_url": "https://github.com/hyperledger/besu/issues/2709",
  "id": 985825007,
  "node_id": "MDU6SXNzdWU5ODU4MjUwMDc=",
  "number": 2709,
  "title": "sync up on 4 nodes IBFT2.0 network takes hours every time ",
  "user": {
    "login": "emclab",
    "id": 946013,
    "node_id": "MDQ6VXNlcjk0NjAxMw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/946013?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/emclab",
    "html_url": "https://github.com/emclab",
    "followers_url": "https://api.github.com/users/emclab/followers",
    "following_url": "https://api.github.com/users/emclab/following{/other_user}",
    "gists_url": "https://api.github.com/users/emclab/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/emclab/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/emclab/subscriptions",
    "organizations_url": "https://api.github.com/users/emclab/orgs",
    "repos_url": "https://api.github.com/users/emclab/repos",
    "events_url": "https://api.github.com/users/emclab/events{/privacy}",
    "received_events_url": "https://api.github.com/users/emclab/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 2051683573,
      "node_id": "MDU6TGFiZWwyMDUxNjgzNTcz",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/P3",
      "name": "P3",
      "color": "ffff00",
      "default": false,
      "description": "Medium (ex: JSON-RPC request not working with a specific client library due to loose spec assumtion)"
    },
    {
      "id": 3805591260,
      "node_id": "LA_kwDODE2jmc7i1Lbc",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/peering",
      "name": "peering",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-09-01T23:24:55Z",
  "updated_at": "2022-04-19T02:37:05Z",
  "closed_at": "2022-04-19T02:37:05Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!-- Have you done the following? -->\r\n<!--   * read the Code of Conduct? By filing an Issue, you are expected to -->  \r\n<!--     comply with it, including treating everyone with respect: -->\r\n<!--     https://github.com/hyperledger/besu/blob/main/CODE_OF_CONDUCT.md -->\r\n<!--   * Reproduced the issue in the latest version of the software -->\r\n<!--   * Read the debugging docs: https://besu.hyperledger.org/en/stable/HowTo/Monitor/Logging/ -->\r\n<!--   * Duplicate Issue check:  https://github.com/search?q=+is%3Aissue+repo%3Ahyperledger/Besu -->\r\n<!-- Note:  Not all sections will apply to all issue types. -->\r\n\r\n### Description\r\n4 nodes (one boot node) IBFT2.0 network 21.7.2, running on single physical ubuntu 20.04 server. After changing some params in config.toml, they are not syncing up after 30 min or hours. I may come back tomorrow morning and find the nodes are synced after restart last night. But it seems no certain way to guarantee sync up. \r\n\r\nHere is the boot node log showing peer search ends with 0 peer found:\r\n\r\n```\r\n2021-09-02 07:12:41.428+08:00 | vert.x-eventloop-thread-1 | DEBUG | RecursivePeerRefreshState | Start peer search.\r\n2021-09-02 07:12:41.428+08:00 | vert.x-eventloop-thread-1 | DEBUG | RecursivePeerRefreshState | Skipping bonding round because no candidates are available\r\n2021-09-02 07:12:41.428+08:00 | vert.x-eventloop-thread-1 | DEBUG | RecursivePeerRefreshState | Iterative peer search complete.  0 peers processed over 1 rounds.\r\n2021-09-02 07:12:41.632+08:00 | EthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\n2021-09-02 07:12:41.632+08:00 | EthScheduler-Timer-0 | DEBUG | WaitForPeerTask | Waiting for new peer connection. 0 peers currently connected.\r\n2021-09-02 07:12:46.633+08:00 | EthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\n2021-09-02 07:12:46.633+08:00 | EthScheduler-Timer-0 | DEBUG | WaitForPeerTask | Waiting for new peer connection. 0 peers currently connected.\r\n2021-09-02 07:12:51.634+08:00 | EthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\n2021-09-02 07:12:51.634+08:00 | EthScheduler-Timer-0 | DEBUG | WaitForPeerTask | Waiting for new peer connection. 0 peers currently connected.\r\n2021-09-02 07:12:56.634+08:00 | EthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\n2021-09-02 07:12:56.634+08:00 | EthScheduler-Timer-0 | DEBUG | WaitForPeerTask | Waiting for new peer connection. 0 peers currently connected.\r\n```\r\n\r\nHere is a node log showing no peers connected:\r\n\r\n```\r\n2021-09-02 07:13:33.541+08:00 | EthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\n2021-09-02 07:13:38.541+08:00 | EthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\n2021-09-02 07:13:43.541+08:00 | EthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\n2021-09-02 07:13:48.542+08:00 | EthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\n2021-09-02 07:13:53.542+08:00 | EthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\n2021-09-02 07:13:58.542+08:00 | EthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\n2021-09-02 07:14:03.543+08:00 | EthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\n2021-09-02 07:14:08.543+08:00 | EthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\n2021-09-02 07:14:13.543+08:00 | EthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\n2021-09-02 07:14:18.543+08:00 | EthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\n2021-09-02 07:14:23.544+08:00 | EthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\n```\r\n\r\nThe time stamp of those 2 logs are at the same time. The nodes have been up for at least 30 min. \r\n\r\n### Acceptance Criteria\r\n4 nodes are synced up after start.\r\n\r\n### Steps to Reproduce (Bug)\r\n1. [Step 1]\r\n2. [Step 2]\r\n3. [Step ...]\r\n\r\n**Expected behavior:** [What you expect to happen]\r\n4 nodes sync up in a reasonable amount of time. let's say 5 min.\r\n**Actual behavior:** [What actually happens]\r\nNodes shall sync up but 0 peers connected on log for all 4 nodes.\r\n\r\n**Frequency:** [What percentage of the time does it occur?]\r\nevery time restart boot node\r\n\r\n### Versions (Add all that apply)\r\n* Software version: [`besu --version`] 21.7.2\r\n* Java version: [`java -version`] openjdk 14\r\n* OS Name & Version: [`cat /etc/*release`] ubuntu 20.04\r\n* Kernel Version: [`uname -a`]\r\n* Virtual Machine software & version: [`vmware -v`]\r\n* Docker Version: [`docker version`]\r\n* Cloud VM, type, size: [Amazon Web Services I3-large]\r\n\r\n### Additional Information\r\nHere is the config.toml on boot node:\r\n\r\n```\r\n# Valid TOML config file\r\ndata-path=\"/home/besu_network/node1/data\" # Path\r\n\r\np2p-port=30303 \r\nmax-peers=25\r\nrpc-http-host=[\"0.0.0.0\"] \r\nrpc-http-port=8545 \r\nrpc-http-enabled=true \r\nrpc-http-api=[\"ETH\",\"NET\",\"WEB3\",\"ADMIN\",\"TXPOOL\",\"IBFT\", \"EEA\",\"DEBUG\"] \r\n\r\nmetrics-port=9545 \r\nmetrics-push-port=9001 \r\nmin-gas-price=0 \r\nlogging=\"DEBUG\"\r\n#allow all\r\nhost-allowlist=[\"*\"] \r\nrpc-http-cors-origins=[\"*\"]\r\n# Chain\r\ngenesis-file=\"/home/besu_network/genesis.json\" # Path to the custom genesis file\r\nminer-enabled=false \r\nminer-coinbase=\"0xfe3b557b8fb62b89f4116b721be55deb828dbd73\"\r\n```\r\n",
  "closed_by": {
    "login": "macfarla",
    "id": 2627919,
    "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/macfarla",
    "html_url": "https://github.com/macfarla",
    "followers_url": "https://api.github.com/users/macfarla/followers",
    "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
    "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
    "organizations_url": "https://api.github.com/users/macfarla/orgs",
    "repos_url": "https://api.github.com/users/macfarla/repos",
    "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
    "received_events_url": "https://api.github.com/users/macfarla/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/2709/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/2709/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/913198140",
    "html_url": "https://github.com/hyperledger/besu/issues/2709#issuecomment-913198140",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2709",
    "id": 913198140,
    "node_id": "IC_kwDODE2jmc42bkw8",
    "user": {
      "login": "vmichalik",
      "id": 12459761,
      "node_id": "MDQ6VXNlcjEyNDU5NzYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12459761?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vmichalik",
      "html_url": "https://github.com/vmichalik",
      "followers_url": "https://api.github.com/users/vmichalik/followers",
      "following_url": "https://api.github.com/users/vmichalik/following{/other_user}",
      "gists_url": "https://api.github.com/users/vmichalik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vmichalik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vmichalik/subscriptions",
      "organizations_url": "https://api.github.com/users/vmichalik/orgs",
      "repos_url": "https://api.github.com/users/vmichalik/repos",
      "events_url": "https://api.github.com/users/vmichalik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vmichalik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-05T17:53:43Z",
    "updated_at": "2021-09-05T17:53:43Z",
    "author_association": "NONE",
    "body": "Thanks for raising issue @emclab, this is indeed unexpected behaviour. I'll queue it up for investigating this week hopefully!",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/913198140/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1066408015",
    "html_url": "https://github.com/hyperledger/besu/issues/2709#issuecomment-1066408015",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2709",
    "id": 1066408015,
    "node_id": "IC_kwDODE2jmc4_kBhP",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-14T05:56:03Z",
    "updated_at": "2022-03-14T05:56:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @emclab I realise it's been a while but we have made some improvements in peering and syncing. And we are also beginning a holistic assessment of peering behavior including any outstanding issues. So we're hoping that it's either fixed already, or that you're able to give us some more info if you're still having related issues? ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1066408015/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
