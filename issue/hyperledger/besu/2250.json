{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/2250",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/2250/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/2250/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/2250/events",
  "html_url": "https://github.com/hyperledger/besu/issues/2250",
  "id": 880341479,
  "node_id": "MDU6SXNzdWU4ODAzNDE0Nzk=",
  "number": 2250,
  "title": "Besu discovery packets are rejected by peers",
  "user": {
    "login": "atoulme",
    "id": 16758,
    "node_id": "MDQ6VXNlcjE2NzU4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16758?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/atoulme",
    "html_url": "https://github.com/atoulme",
    "followers_url": "https://api.github.com/users/atoulme/followers",
    "following_url": "https://api.github.com/users/atoulme/following{/other_user}",
    "gists_url": "https://api.github.com/users/atoulme/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/atoulme/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/atoulme/subscriptions",
    "organizations_url": "https://api.github.com/users/atoulme/orgs",
    "repos_url": "https://api.github.com/users/atoulme/repos",
    "events_url": "https://api.github.com/users/atoulme/events{/privacy}",
    "received_events_url": "https://api.github.com/users/atoulme/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-05-08T05:58:06Z",
  "updated_at": "2021-05-17T14:26:47Z",
  "closed_at": "2021-05-17T14:26:47Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\r\nBesu discovery packets are rejected by Core-Geth with the following message:\r\n\r\n```\r\nTRACE[05-01|00:33:00.410] >> PING/v4                               id=0cf4136259a482a1 addr=3.16.171.213:30303 err=nil\r\nTRACE[05-01|00:33:00.509] << PONG/v4                               id=0cf4136259a482a1 addr=3.16.171.213:30303 err=nil\r\nTRACE[05-01|00:33:01.010] >> FINDNODE/v4                           id=0cf4136259a482a1 addr=3.16.171.213:30303 err=nil\r\nDEBUG[05-01|00:33:01.099] Bad discv4 packet                        addr=3.16.171.213:30303 err=\"bad hash\"\r\nTRACE[05-01|00:33:01.511] FINDNODE failed                          id=0cf4136259a482a1 failcount=384 dropped=false err=\"RPC timeout\"\r\n```\r\n\r\n### Steps to Reproduce\r\n1. Run a geth node next to Besu and connect to it for discovery\r\n2. Observe the logs\r\n\r\n**Expected behavior:**\r\nBesu should communicate properly with Core-Geth.\r\n\r\n**Actual behavior:**\r\nAll discovery packets are rejected.\r\n\r\n**Frequency:**\r\nAlways\r\n",
  "closed_by": {
    "login": "RatanRSur",
    "id": 4733314,
    "node_id": "MDQ6VXNlcjQ3MzMzMTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4733314?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/RatanRSur",
    "html_url": "https://github.com/RatanRSur",
    "followers_url": "https://api.github.com/users/RatanRSur/followers",
    "following_url": "https://api.github.com/users/RatanRSur/following{/other_user}",
    "gists_url": "https://api.github.com/users/RatanRSur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/RatanRSur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/RatanRSur/subscriptions",
    "organizations_url": "https://api.github.com/users/RatanRSur/orgs",
    "repos_url": "https://api.github.com/users/RatanRSur/repos",
    "events_url": "https://api.github.com/users/RatanRSur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/RatanRSur/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/2250/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/2250/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/835552271",
    "html_url": "https://github.com/hyperledger/besu/issues/2250#issuecomment-835552271",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2250",
    "id": 835552271,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzNTU1MjI3MQ==",
    "user": {
      "login": "atoulme",
      "id": 16758,
      "node_id": "MDQ6VXNlcjE2NzU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16758?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/atoulme",
      "html_url": "https://github.com/atoulme",
      "followers_url": "https://api.github.com/users/atoulme/followers",
      "following_url": "https://api.github.com/users/atoulme/following{/other_user}",
      "gists_url": "https://api.github.com/users/atoulme/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/atoulme/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/atoulme/subscriptions",
      "organizations_url": "https://api.github.com/users/atoulme/orgs",
      "repos_url": "https://api.github.com/users/atoulme/repos",
      "events_url": "https://api.github.com/users/atoulme/events{/privacy}",
      "received_events_url": "https://api.github.com/users/atoulme/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-08T22:40:45Z",
    "updated_at": "2021-05-08T22:40:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "After some investigation, what appears to happen is that Besu sends packet which are longer than 1280 bytes. This is because most networks out there will drop bytes after that size.\r\nThe packet is truncated, and the hash doesn't check the packet contents anymore, so it's impossible to receive peers.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/835552271/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
