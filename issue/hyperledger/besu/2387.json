{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/2387/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/2387/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/2387/events",
  "html_url": "https://github.com/hyperledger/besu/issues/2387",
  "id": 915254883,
  "node_id": "MDU6SXNzdWU5MTUyNTQ4ODM=",
  "number": 2387,
  "title": "Besu + Private transaction manager Performance problems",
  "user": {
    "login": "Ferparishuertas",
    "id": 1405582,
    "node_id": "MDQ6VXNlcjE0MDU1ODI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1405582?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Ferparishuertas",
    "html_url": "https://github.com/Ferparishuertas",
    "followers_url": "https://api.github.com/users/Ferparishuertas/followers",
    "following_url": "https://api.github.com/users/Ferparishuertas/following{/other_user}",
    "gists_url": "https://api.github.com/users/Ferparishuertas/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Ferparishuertas/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Ferparishuertas/subscriptions",
    "organizations_url": "https://api.github.com/users/Ferparishuertas/orgs",
    "repos_url": "https://api.github.com/users/Ferparishuertas/repos",
    "events_url": "https://api.github.com/users/Ferparishuertas/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Ferparishuertas/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1740324632,
      "node_id": "MDU6TGFiZWwxNzQwMzI0NjMy",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/privacy",
      "name": "privacy",
      "color": "d7f99a",
      "default": false,
      "description": "private transactions"
    },
    {
      "id": 2152224197,
      "node_id": "MDU6TGFiZWwyMTUyMjI0MTk3",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamRevenant",
      "name": "TeamRevenant",
      "color": "78e298",
      "default": false,
      "description": "GH issues worked on by Revenant Team"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "macfarla",
    "id": 2627919,
    "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/macfarla",
    "html_url": "https://github.com/macfarla",
    "followers_url": "https://api.github.com/users/macfarla/followers",
    "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
    "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
    "organizations_url": "https://api.github.com/users/macfarla/orgs",
    "repos_url": "https://api.github.com/users/macfarla/repos",
    "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
    "received_events_url": "https://api.github.com/users/macfarla/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 21,
  "created_at": "2021-06-08T16:56:14Z",
  "updated_at": "2021-07-27T07:32:32Z",
  "closed_at": "2021-07-12T00:49:54Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "HI\r\n\r\nAt @iobuilders we are working with several clients, including Allfunds (on their custom transaction manager).\r\nOn out latest smart contract set, we are using structs as params, return value, arrays etc. with the new abiencoderv2\r\n\r\nWe use pragma solidity ^0.7.5; pragma experimental ABIEncoderV2;\r\n\r\nWe use a standard hyperledger besu network, with maxContractSize to 48k, because our main contract are around 38kb. (4gb 2vcpus, 4 validators, 2 regular nodes)\r\n\r\nDeploying smart contracts at the public state works perfectly fine. Once we deploy de same smart contract, and do the same transactions on the privacy group, and private state level, performance bottlenecks appears, increasing the heap consumption for one single rpc call ( not tx ) to 3GB. Added to rocks db thread blocked traces\r\n\r\nHaving similar issues in the past with public state, and having reported rocks db performance issues in the past(https://pegasys1.atlassian.net/browse/PAN-3245?atlOrigin=eyJpIjoiYTUxYTI2MDQ3MTZkNDY2NGIwZTNjZTU4MjcxNmFlMWEiLCJwIjoiaiJ9), having known that private state has no log bloom cache, our guess and feeling, is that:\r\n\r\n- Private state performance for complex SC and transactions needs to be tuned\r\n- Root cause could be state read at rocks db level, and no cache existence\r\n\r\nCan you help us, give support on this?\r\n\r\nDoes the new tessera based implementation focus on this perfomance, cache topic?\r\n\r\nKind regards\r\n\r\nGenesis File\r\n\r\n{\r\n\"config\": {\r\n\"chainId\": 2021,\r\n\"muirglacierblock\": 0,\r\n\"ibft2\": {\r\n\"blockperiodseconds\": 1,\r\n\"epochlength\": 30000,\r\n\"requesttimeoutseconds\": 2\r\n},\r\n\"contractSizeLimit\": 2147483647,\r\n\"evmStackSize\": 4096\r\n},\r\n\"nonce\": \"0x0\",\r\n\r\n\"gasLimit\": \"0x1fffffffffffff\",\r\n\"difficulty\": \"0x1\",\r\n\"timestamp\": \"0x58ee40ba\",\r\n\"extraData\":\r\n---",
  "closed_by": {
    "login": "macfarla",
    "id": 2627919,
    "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/macfarla",
    "html_url": "https://github.com/macfarla",
    "followers_url": "https://api.github.com/users/macfarla/followers",
    "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
    "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
    "organizations_url": "https://api.github.com/users/macfarla/orgs",
    "repos_url": "https://api.github.com/users/macfarla/repos",
    "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
    "received_events_url": "https://api.github.com/users/macfarla/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/2387/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/2387/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/856941518",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-856941518",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 856941518,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1Njk0MTUxOA==",
    "user": {
      "login": "atoulme",
      "id": 16758,
      "node_id": "MDQ6VXNlcjE2NzU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16758?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/atoulme",
      "html_url": "https://github.com/atoulme",
      "followers_url": "https://api.github.com/users/atoulme/followers",
      "following_url": "https://api.github.com/users/atoulme/following{/other_user}",
      "gists_url": "https://api.github.com/users/atoulme/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/atoulme/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/atoulme/subscriptions",
      "organizations_url": "https://api.github.com/users/atoulme/orgs",
      "repos_url": "https://api.github.com/users/atoulme/repos",
      "events_url": "https://api.github.com/users/atoulme/events{/privacy}",
      "received_events_url": "https://api.github.com/users/atoulme/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-08T17:05:39Z",
    "updated_at": "2021-06-08T17:05:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "Can you help me understand where the slowness and memory consumption was measured? Was it with Besu only or the private enclave too?\r\nIs there a way to reproduce the issue you're seeing?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/856941518/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/856963761",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-856963761",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 856963761,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1Njk2Mzc2MQ==",
    "user": {
      "login": "Ferparishuertas",
      "id": 1405582,
      "node_id": "MDQ6VXNlcjE0MDU1ODI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1405582?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ferparishuertas",
      "html_url": "https://github.com/Ferparishuertas",
      "followers_url": "https://api.github.com/users/Ferparishuertas/followers",
      "following_url": "https://api.github.com/users/Ferparishuertas/following{/other_user}",
      "gists_url": "https://api.github.com/users/Ferparishuertas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Ferparishuertas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Ferparishuertas/subscriptions",
      "organizations_url": "https://api.github.com/users/Ferparishuertas/orgs",
      "repos_url": "https://api.github.com/users/Ferparishuertas/repos",
      "events_url": "https://api.github.com/users/Ferparishuertas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Ferparishuertas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-08T17:39:34Z",
    "updated_at": "2021-06-08T17:39:34Z",
    "author_association": "NONE",
    "body": "Thanks @atoulme \r\n\r\nPerformance problem is at besu level.   i can send you the smart contract set and reproduction instructions, if you want",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/856963761/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/856970344",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-856970344",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 856970344,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1Njk3MDM0NA==",
    "user": {
      "login": "Ferparishuertas",
      "id": 1405582,
      "node_id": "MDQ6VXNlcjE0MDU1ODI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1405582?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ferparishuertas",
      "html_url": "https://github.com/Ferparishuertas",
      "followers_url": "https://api.github.com/users/Ferparishuertas/followers",
      "following_url": "https://api.github.com/users/Ferparishuertas/following{/other_user}",
      "gists_url": "https://api.github.com/users/Ferparishuertas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Ferparishuertas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Ferparishuertas/subscriptions",
      "organizations_url": "https://api.github.com/users/Ferparishuertas/orgs",
      "repos_url": "https://api.github.com/users/Ferparishuertas/repos",
      "events_url": "https://api.github.com/users/Ferparishuertas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Ferparishuertas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-08T17:49:39Z",
    "updated_at": "2021-06-08T17:49:39Z",
    "author_association": "NONE",
    "body": "https://drive.google.com/drive/folders/16kqXPjAjYRLfmjqyk4kkMhrqVUbqiW1P?usp=sharing\r\n\r\nHere ypu can find a full repo and instructions to reproduce it",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/856970344/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/860575596",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-860575596",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 860575596,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MDU3NTU5Ng==",
    "user": {
      "login": "DelgadoTrueba",
      "id": 33582727,
      "node_id": "MDQ6VXNlcjMzNTgyNzI3",
      "avatar_url": "https://avatars.githubusercontent.com/u/33582727?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DelgadoTrueba",
      "html_url": "https://github.com/DelgadoTrueba",
      "followers_url": "https://api.github.com/users/DelgadoTrueba/followers",
      "following_url": "https://api.github.com/users/DelgadoTrueba/following{/other_user}",
      "gists_url": "https://api.github.com/users/DelgadoTrueba/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DelgadoTrueba/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DelgadoTrueba/subscriptions",
      "organizations_url": "https://api.github.com/users/DelgadoTrueba/orgs",
      "repos_url": "https://api.github.com/users/DelgadoTrueba/repos",
      "events_url": "https://api.github.com/users/DelgadoTrueba/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DelgadoTrueba/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-14T10:25:19Z",
    "updated_at": "2021-06-14T10:33:04Z",
    "author_association": "NONE",
    "body": "We are also experiencing similar problems, in a network with one validator node and three regular nodes in which private transactions are enabled using orion as an enclave.\r\n\r\n**Topology**\r\nvalidator\thyperledger/besu:20.10.3\r\nnode3\t  hyperledger/besu:21.1.4\r\nnode2\t  hyperledger/besu:21.1.4\r\nnode1\t  hyperledger/besu:21.1.4\r\norion1\t  pegasyseng/orion:21.1.0\r\norion2\t  pegasyseng/orion:21.1.0\r\norion3\t  pegasyseng/orion:21.1.0\r\n\r\nnode-1 and node-2 form PrivacyGroup1\r\nnode-1 and node-3 form PrivacyGroup2\r\n\r\nWhen we start the network the memory heap metrics are normal.\r\n\r\n![image](https://user-images.githubusercontent.com/33582727/121876676-11fb9700-cd0a-11eb-8015-93a8af217197.png)\r\n\r\nWhen we start performing private transactions on PrivacyGroup1, the memory heap in node-1 and node-2 increases progressively.\r\n\r\n![image](https://user-images.githubusercontent.com/33582727/121876848-453e2600-cd0a-11eb-9987-210e0e0cb39e.png)\r\n\r\nHowever, memory usage is not reduced at any time, as a result, node-1 throws: **java.lang.OutOfMemoryError: Java heap space**\r\n```\r\nException: java.lang.OutOfMemoryError thrown from the UncaughtExceptionHandler in thread \"vert.x-worker-thread-0\"\r\n\r\nException: java.lang.OutOfMemoryError thrown from the UncaughtExceptionHandler in thread \"vert.x-worker-thread-7\"\r\n\r\nException: java.lang.OutOfMemoryError thrown from the UncaughtExceptionHandler in thread \"vert.x-worker-thread-13\"\r\n\r\n2021-06-14 10:05:36.051+00:00 | nioEventLoopGroup-3-3 | INFO  | BlockPropagationManager | Saving announced block 6024 (0x7457d962d669fdbcfd4d19b3d170a3a36e6aca3fbddb8cc0772beb78ceff82d3) for future import\r\n\r\n2021-06-14 10:05:36.047+00:00 | vert.x-eventloop-thread-4 | ERROR | ContextImpl | Unhandled exception\r\njava.lang.OutOfMemoryError: Java heap space\r\n\r\n2021-06-14 10:05:36.052+00:00 | nioEventLoopGroup-3-5 | INFO  | BlockPropagationManager | Saving announced block 6025 (0xef687b9f307ca23713c66911fed70d9014f731d5d238728af89bc50ebb5fb826) for future import\r\n\r\n2021-06-14 10:05:36.054+00:00 | vertx-blocked-thread-checker | ERROR | Besu | Uncaught exception in thread \"vertx-blocked-thread-checker\"\r\n\r\njava.lang.OutOfMemoryError: Java heap space\r\n```\r\n\r\nthanks in advance",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/860575596/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/863632306",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-863632306",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 863632306,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MzYzMjMwNg==",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-17T23:53:10Z",
    "updated_at": "2021-06-17T23:55:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "@Ferparishuertas thanks for providing comprehensive info on how to reproduce your scenario. I can indeed reproduce this memory spike in my environment. Looking at the RPC call that causes the spike in memory, the chaining of function calls within validate() function in fact allocates a new ManagedData object for each call. \r\nI tested out replacing\r\n```\r\n         return managedData\r\n            .checkData0107Enabled()\r\n            .checkData0106Positive()\r\n...\r\n.result;\r\n``` \r\nwith \r\n```\r\n       return  managedData\r\n            .checkData0107Enabled().result\r\n            && managedData\r\n            .checkData0106Positive()\r\n...\r\n.result;\r\n```\r\nthat is, force the code to reuse the same managedData object instead of implicitly creating a new one for each call. Using this method, the memory spike does not occur. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/863632306/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/863632676",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-863632676",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 863632676,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MzYzMjY3Ng==",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-17T23:54:28Z",
    "updated_at": "2021-06-17T23:58:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "@DelgadoTrueba In order to further investigate your issue, are you able to provide a test scenario including any smart contracts? Thanks!\r\n\r\nAlso feel free to make a separate issue for this since I think it is a different problem - slow heap growth vs a spike that (unless causing heap OOM) gets cleaned up by GC.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/863632676/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/863758399",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-863758399",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 863758399,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2Mzc1ODM5OQ==",
    "user": {
      "login": "Ferparishuertas",
      "id": 1405582,
      "node_id": "MDQ6VXNlcjE0MDU1ODI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1405582?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ferparishuertas",
      "html_url": "https://github.com/Ferparishuertas",
      "followers_url": "https://api.github.com/users/Ferparishuertas/followers",
      "following_url": "https://api.github.com/users/Ferparishuertas/following{/other_user}",
      "gists_url": "https://api.github.com/users/Ferparishuertas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Ferparishuertas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Ferparishuertas/subscriptions",
      "organizations_url": "https://api.github.com/users/Ferparishuertas/orgs",
      "repos_url": "https://api.github.com/users/Ferparishuertas/repos",
      "events_url": "https://api.github.com/users/Ferparishuertas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Ferparishuertas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-18T05:06:19Z",
    "updated_at": "2021-06-18T05:06:19Z",
    "author_association": "NONE",
    "body": "Thanks! will review and get back to you\n\nEl vie, 18 jun 2021 a las 1:54, Sally MacFarlane ***@***.***>)\nescribió:\n\n> @DelgadoTrueba <https://github.com/DelgadoTrueba> In order to further\n> investigate your issue, are you able to provide a test scenario including\n> any smart contracts? Thanks!\n>\n> —\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/hyperledger/besu/issues/2387#issuecomment-863632676>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AAKXFDWIHLAX6N6YQLQWRVTTTKDMBANCNFSM46KLA2ZQ>\n> .\n>\n\n\n-- \n[image: logo] <https://io.builders/>\n*io.builders <http://io.builders/>*\nBlockchain venture builder *Fernando París*\nCTO • ioBUILDERS\nMobile: +34 679 467 927\nParque Científico y Tecnológico UPM Campus de Montegancedo, s/n.\n28223 Pozuelo de Alarcón, MADRID\n\n\nNOTA LEGAL: Este mensaje y cualquier archivo adjunto está destinado\núnicamente a quien se dirige y es confidencial. Si usted ha recibido este\nmensaje por error, comuníqueselo al remitente y bórrelo inmediatamente. La\nutilización, revelación y/o reproducción del mensaje puede constituir un\ndelito.\n\nPROTECCIÓN DE DATOS – Responsable: ioBUILDERS, S.L., Finalidad. Envío de\ninformación, respuesta a consultas y contactos genéricos, mientras dure\nnuestra relación y tengamos su consentimiento. Destinatarios. No se cederán\ndatos a terceros salvo obligación legal. Derechos. Puede ejercer los\nderechos de acceso, rectificación, supresión y oposición, limitar el\ntratamiento de sus datos, o directamente oponerse al tratamiento, o ejercer\nel derecho a la portabilidad de los mismos. Todo ello, mediante escrito,\nacompañado de copia de documento oficial que le identifique, dirigido a\nParque Científico y Tecnológico UPM Campus de Montegancedo, s/n. 28223\nPozuelo de Alarcón, MADRID (España). En caso de disconformidad con el\ntratamiento, también tiene derecho a presentar una reclamación ante la\nAgencia Española de Protección de Datos. También podrá oponerse a nuestros\nenvíos de comunicaciones comerciales (Art.21.2 de la LSSI) a través de la\nsiguiente dirección de correo electrónico: ***@***.***\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/863758399/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/864649176",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-864649176",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 864649176,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NDY0OTE3Ng==",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-21T00:59:45Z",
    "updated_at": "2021-06-21T00:59:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "Great! @Ferparishuertas are you also able to supply the js you've used to verify that this memory spike does not occur in public state ie when not using privacy? ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/864649176/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/864810016",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-864810016",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 864810016,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NDgxMDAxNg==",
    "user": {
      "login": "Ferparishuertas",
      "id": 1405582,
      "node_id": "MDQ6VXNlcjE0MDU1ODI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1405582?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ferparishuertas",
      "html_url": "https://github.com/Ferparishuertas",
      "followers_url": "https://api.github.com/users/Ferparishuertas/followers",
      "following_url": "https://api.github.com/users/Ferparishuertas/following{/other_user}",
      "gists_url": "https://api.github.com/users/Ferparishuertas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Ferparishuertas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Ferparishuertas/subscriptions",
      "organizations_url": "https://api.github.com/users/Ferparishuertas/orgs",
      "repos_url": "https://api.github.com/users/Ferparishuertas/repos",
      "events_url": "https://api.github.com/users/Ferparishuertas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Ferparishuertas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-21T07:50:25Z",
    "updated_at": "2021-06-21T07:50:25Z",
    "author_association": "NONE",
    "body": "That was my next question? Whats the reason for having a memory spike only\nat the private state and not on the public one?\n\nWe are reviewing your suggestion, perhaps its kind a patch vs working as on\nthe public state.\n\nEl lun, 21 jun 2021 a las 2:59, Sally MacFarlane ***@***.***>)\nescribió:\n\n> Great! @Ferparishuertas <https://github.com/Ferparishuertas> are you also\n> able to supply the js you've used to verify that this memory spike does not\n> occur in public state ie when not using privacy?\n>\n> —\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/hyperledger/besu/issues/2387#issuecomment-864649176>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AAKXFDSUYHSENMAVL26QFZTTT2FIZANCNFSM46KLA2ZQ>\n> .\n>\n\n\n-- \n[image: logo] <https://io.builders/>\n*io.builders <http://io.builders/>*\nBlockchain venture builder *Fernando París*\nCTO • ioBUILDERS\nMobile: +34 679 467 927\nParque Científico y Tecnológico UPM Campus de Montegancedo, s/n.\n28223 Pozuelo de Alarcón, MADRID\n\n\nNOTA LEGAL: Este mensaje y cualquier archivo adjunto está destinado\núnicamente a quien se dirige y es confidencial. Si usted ha recibido este\nmensaje por error, comuníqueselo al remitente y bórrelo inmediatamente. La\nutilización, revelación y/o reproducción del mensaje puede constituir un\ndelito.\n\nPROTECCIÓN DE DATOS – Responsable: ioBUILDERS, S.L., Finalidad. Envío de\ninformación, respuesta a consultas y contactos genéricos, mientras dure\nnuestra relación y tengamos su consentimiento. Destinatarios. No se cederán\ndatos a terceros salvo obligación legal. Derechos. Puede ejercer los\nderechos de acceso, rectificación, supresión y oposición, limitar el\ntratamiento de sus datos, o directamente oponerse al tratamiento, o ejercer\nel derecho a la portabilidad de los mismos. Todo ello, mediante escrito,\nacompañado de copia de documento oficial que le identifique, dirigido a\nParque Científico y Tecnológico UPM Campus de Montegancedo, s/n. 28223\nPozuelo de Alarcón, MADRID (España). En caso de disconformidad con el\ntratamiento, también tiene derecho a presentar una reclamación ante la\nAgencia Española de Protección de Datos. También podrá oponerse a nuestros\nenvíos de comunicaciones comerciales (Art.21.2 de la LSSI) a través de la\nsiguiente dirección de correo electrónico: ***@***.***\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/864810016/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/865885182",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-865885182",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 865885182,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NTg4NTE4Mg==",
    "user": {
      "login": "Ferparishuertas",
      "id": 1405582,
      "node_id": "MDQ6VXNlcjE0MDU1ODI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1405582?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ferparishuertas",
      "html_url": "https://github.com/Ferparishuertas",
      "followers_url": "https://api.github.com/users/Ferparishuertas/followers",
      "following_url": "https://api.github.com/users/Ferparishuertas/following{/other_user}",
      "gists_url": "https://api.github.com/users/Ferparishuertas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Ferparishuertas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Ferparishuertas/subscriptions",
      "organizations_url": "https://api.github.com/users/Ferparishuertas/orgs",
      "repos_url": "https://api.github.com/users/Ferparishuertas/repos",
      "events_url": "https://api.github.com/users/Ferparishuertas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Ferparishuertas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-22T11:01:24Z",
    "updated_at": "2021-06-22T11:01:24Z",
    "author_association": "NONE",
    "body": "We have a new version of optimized code which mitigates de memory spike, 3 weeks ago, but still unusual memory consumption.\r\n\r\nThe tricky thing its that same code on public storage works perfectly. Rocks db?  memory management?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/865885182/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/866382890",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-866382890",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 866382890,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NjM4Mjg5MA==",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-22T22:38:01Z",
    "updated_at": "2021-06-22T22:38:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "@Ferparishuertas are you also able to supply the js you've used to verify that this memory spike does not occur in public state? This would help us in narrowing down the problem. Thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/866382890/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/868491829",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-868491829",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 868491829,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2ODQ5MTgyOQ==",
    "user": {
      "login": "marcosio",
      "id": 29300883,
      "node_id": "MDQ6VXNlcjI5MzAwODgz",
      "avatar_url": "https://avatars.githubusercontent.com/u/29300883?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marcosio",
      "html_url": "https://github.com/marcosio",
      "followers_url": "https://api.github.com/users/marcosio/followers",
      "following_url": "https://api.github.com/users/marcosio/following{/other_user}",
      "gists_url": "https://api.github.com/users/marcosio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marcosio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marcosio/subscriptions",
      "organizations_url": "https://api.github.com/users/marcosio/orgs",
      "repos_url": "https://api.github.com/users/marcosio/repos",
      "events_url": "https://api.github.com/users/marcosio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marcosio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-25T13:15:24Z",
    "updated_at": "2021-06-25T13:15:24Z",
    "author_association": "NONE",
    "body": "Hi @macfarla!\r\n\r\nThis is the [drive link](https://drive.google.com/file/d/1b1Yc4SkGh6g_Ulf_LBALZIdJ8UmTwlvZ/view?usp=sharing) to test the public state.\r\n\r\n`afb-public-contracts-test.js` is the new test with public deploy.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/868491829/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/870216848",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-870216848",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 870216848,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MDIxNjg0OA==",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-29T04:13:16Z",
    "updated_at": "2021-06-29T04:13:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks @marcosio this is helpful. We are still digging into this issue! ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/870216848/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/870956904",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-870956904",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 870956904,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MDk1NjkwNA==",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-29T22:19:19Z",
    "updated_at": "2021-06-29T22:19:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "Linked a PR which changes privacy calls to use the no-op tracer. This makes a big difference to the memory used - and explains why the issue was happening in private state, not public state. With this change I do not have the memory spike with priv_call. Are you able to try this in your environment? https://github.com/hyperledger/besu/pull/2482",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/870956904/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/871345560",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-871345560",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 871345560,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3MTM0NTU2MA==",
    "user": {
      "login": "alberto-hernandez",
      "id": 1534458,
      "node_id": "MDQ6VXNlcjE1MzQ0NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1534458?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alberto-hernandez",
      "html_url": "https://github.com/alberto-hernandez",
      "followers_url": "https://api.github.com/users/alberto-hernandez/followers",
      "following_url": "https://api.github.com/users/alberto-hernandez/following{/other_user}",
      "gists_url": "https://api.github.com/users/alberto-hernandez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alberto-hernandez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alberto-hernandez/subscriptions",
      "organizations_url": "https://api.github.com/users/alberto-hernandez/orgs",
      "repos_url": "https://api.github.com/users/alberto-hernandez/repos",
      "events_url": "https://api.github.com/users/alberto-hernandez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alberto-hernandez/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-30T12:06:06Z",
    "updated_at": "2021-06-30T12:06:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi Sally, we are going to test the change fix asap.\r\nThank you for your feedback.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/871345560/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/874123561",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-874123561",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 874123561,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3NDEyMzU2MQ==",
    "user": {
      "login": "alberto-hernandez",
      "id": 1534458,
      "node_id": "MDQ6VXNlcjE1MzQ0NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1534458?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alberto-hernandez",
      "html_url": "https://github.com/alberto-hernandez",
      "followers_url": "https://api.github.com/users/alberto-hernandez/followers",
      "following_url": "https://api.github.com/users/alberto-hernandez/following{/other_user}",
      "gists_url": "https://api.github.com/users/alberto-hernandez/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alberto-hernandez/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alberto-hernandez/subscriptions",
      "organizations_url": "https://api.github.com/users/alberto-hernandez/orgs",
      "repos_url": "https://api.github.com/users/alberto-hernandez/repos",
      "events_url": "https://api.github.com/users/alberto-hernandez/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alberto-hernandez/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-05T13:41:28Z",
    "updated_at": "2021-07-05T14:02:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "We made a backport based of the PR-2482 to our current network version 21.1.3.\r\n\r\nThe memory consumption remains almost the same 900MB-1TB of heap per priv_call. What clearly improve the fix is the response time 3'3 vs 5'5 seconds and the memory handling.\r\n\r\nI attach some captures of the visualvm to check the jvm memory handling:\r\n\r\n**Besu 21.1.3 (No Fixed)**\r\n![Besu-21 1 3-No-Fixed](https://user-images.githubusercontent.com/1534458/124482755-ea986700-dda9-11eb-9b59-9ddb51149abc.png)\r\n\r\n**Besu 21.1.3 (Fixed)**\r\n![Besu-21 1 3-Fixed](https://user-images.githubusercontent.com/1534458/124482761-eb30fd80-dda9-11eb-8669-c007958d3bc4.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/874123561/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 2,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/877893882",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-877893882",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 877893882,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3Nzg5Mzg4Mg==",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-12T00:49:43Z",
    "updated_at": "2021-07-12T00:49:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks @alberto-hernandez - good to hear this fix resolved your issue. I will close this ticket!",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/877893882/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/878014890",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-878014890",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 878014890,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3ODAxNDg5MA==",
    "user": {
      "login": "marcosio",
      "id": 29300883,
      "node_id": "MDQ6VXNlcjI5MzAwODgz",
      "avatar_url": "https://avatars.githubusercontent.com/u/29300883?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marcosio",
      "html_url": "https://github.com/marcosio",
      "followers_url": "https://api.github.com/users/marcosio/followers",
      "following_url": "https://api.github.com/users/marcosio/following{/other_user}",
      "gists_url": "https://api.github.com/users/marcosio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marcosio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marcosio/subscriptions",
      "organizations_url": "https://api.github.com/users/marcosio/orgs",
      "repos_url": "https://api.github.com/users/marcosio/repos",
      "events_url": "https://api.github.com/users/marcosio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marcosio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-12T06:42:29Z",
    "updated_at": "2021-07-12T06:42:29Z",
    "author_association": "NONE",
    "body": "Hi!!\r\n\r\nAfter your changes in Besu, we have refactored SC and the memory consumption is drastically reduced.\r\n\r\nThe next step is to benchmark our solution by deploying everything with public contracts and compare it with a normal deployment where there are contracts deployed in the public space and others in the private space.\r\n\r\nAs information from this comparison becomes available, we will share it.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/878014890/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/878017829",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-878017829",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 878017829,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3ODAxNzgyOQ==",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-12T06:49:00Z",
    "updated_at": "2021-07-12T06:49:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks @marcosio will definitely be interested in what you find out from your benchmarking.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/878017829/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/885663529",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-885663529",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 885663529,
    "node_id": "IC_kwDODE2jmc40yicp",
    "user": {
      "login": "marcosio",
      "id": 29300883,
      "node_id": "MDQ6VXNlcjI5MzAwODgz",
      "avatar_url": "https://avatars.githubusercontent.com/u/29300883?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marcosio",
      "html_url": "https://github.com/marcosio",
      "followers_url": "https://api.github.com/users/marcosio/followers",
      "following_url": "https://api.github.com/users/marcosio/following{/other_user}",
      "gists_url": "https://api.github.com/users/marcosio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marcosio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marcosio/subscriptions",
      "organizations_url": "https://api.github.com/users/marcosio/orgs",
      "repos_url": "https://api.github.com/users/marcosio/repos",
      "events_url": "https://api.github.com/users/marcosio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marcosio/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-23T14:05:57Z",
    "updated_at": "2021-07-23T14:05:57Z",
    "author_association": "NONE",
    "body": "Hi @macfarla!!\r\n\r\nWe have conducted rigorous tests deploying the same contracts without using the privacy and another deployment in an environment where some contracts are deployed in the public zone and others in the private zone.\r\n\r\nIn the case of the public zone, we have launched 80 sequential requests in which the Besu node with the introduced improvement has consumed between 100 and 200 Mb of memory for each request and takes between 200 and 400 msg for each request. \r\n\r\nHowever, in the case of private zone deployment, out of 320 requests to the same public zone call, the memory consumed has been between 200 and 700 Mb and the response time has been between 916 msg and 32 sg.\r\n\r\nIn addition, of the 320 requests, 30 took more than 3 seconds to answer.\r\n\r\nIn conclusion, the patch introduced stability to the node as a request does not reserve so much memory that it causes the node to crash, but there is a big difference in performance between public contracts and contracts deployed in privacy zones.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/885663529/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/887282089",
    "html_url": "https://github.com/hyperledger/besu/issues/2387#issuecomment-887282089",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2387",
    "id": 887282089,
    "node_id": "IC_kwDODE2jmc404tmp",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-27T07:32:31Z",
    "updated_at": "2021-07-27T07:32:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for sharing these results @marcosio, this is useful for us to feed into our optimization work going forward. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/887282089/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
