{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/6039",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/6039/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/6039/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/6039/events",
  "html_url": "https://github.com/hyperledger/besu/issues/6039",
  "id": 1946453072,
  "node_id": "I_kwDODE2jmc50BIRQ",
  "number": 6039,
  "title": "bug in recognization maintainer peers  as well as denyList",
  "user": {
    "login": "iampkuhz",
    "id": 4539861,
    "node_id": "MDQ6VXNlcjQ1Mzk4NjE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4539861?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/iampkuhz",
    "html_url": "https://github.com/iampkuhz",
    "followers_url": "https://api.github.com/users/iampkuhz/followers",
    "following_url": "https://api.github.com/users/iampkuhz/following{/other_user}",
    "gists_url": "https://api.github.com/users/iampkuhz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/iampkuhz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/iampkuhz/subscriptions",
    "organizations_url": "https://api.github.com/users/iampkuhz/orgs",
    "repos_url": "https://api.github.com/users/iampkuhz/repos",
    "events_url": "https://api.github.com/users/iampkuhz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/iampkuhz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 1537362500,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNTAw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "7057ff",
      "default": true,
      "description": "Good for newcomers"
    },
    {
      "id": 2051683573,
      "node_id": "MDU6TGFiZWwyMDUxNjgzNTcz",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/P3",
      "name": "P3",
      "color": "ffff00",
      "default": false,
      "description": "Medium (ex: JSON-RPC request not working with a specific client library due to loose spec assumtion)"
    },
    {
      "id": 3805591260,
      "node_id": "LA_kwDODE2jmc7i1Lbc",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/peering",
      "name": "peering",
      "color": "006b75",
      "default": false,
      "description": ""
    },
    {
      "id": 4426494776,
      "node_id": "LA_kwDODE2jmc8AAAABB9bzOA",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/snack",
      "name": "snack",
      "color": "fef2c0",
      "default": false,
      "description": "Small coding task"
    },
    {
      "id": 5290172097,
      "node_id": "LA_kwDODE2jmc8AAAABO1GewQ",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/non%20mainnet%20(private%20networks)",
      "name": "non mainnet (private networks)",
      "color": "0052cc",
      "default": false,
      "description": "not related to mainnet features - covers privacy, permissioning, IBFT2, QBFT"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-10-17T03:12:29Z",
  "updated_at": "2023-10-18T00:32:04Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nThe node would be added to denyList if block validation failed.\r\nHowever, some block import failure is caused by busy RocksDb or BONSAI data incorrect, instead of bad node.\r\nEspecially in private network, the nodes are already listed in `static-nodes.json` file.\r\n\r\n**Even though there is a logic to avoid add nodes to denyList if the node is listed as maintenance peers, it still exist a bug on detecting whether current Peer object is in maintenance peer list**.\r\n\r\nit was because the maintenance peers Set is an object set and for Peer object, there is no override about equals method. If the peer object changes port or something else, there would create a new peer object and add valid peerId to denyList\r\n\r\n### Acceptance Criteria\r\n\r\n\r\n### Steps to Reproduce (Bug)\r\n\r\n\r\n**Expected behavior:**\r\nthe Peer object should override Equals and hashCode method. The peer should detected base on the peerId instead of object equals\r\n\r\n**Actual behavior:** \r\nvalid peers are added into denyList adn cause private network peers found non peers in the future\r\n\r\n**Frequency:** \r\nquite offen.\r\n\r\n### Logs (if a bug)\r\n![image](https://github.com/hyperledger/besu/assets/4539861/157a4fc6-4857-4fa7-b72f-643383aba131)\r\n\r\n\r\n### Versions (Add all that apply)\r\n* Software version: 23.7.3\r\n* Java version:openjdk version \"17.0.8\" 2023-07-18 LTS\r\n* OS Name & Version: CentOS7.2\r\n* Kernel Version: Linux 4.9.151-015.ali3000.alios7.x86_64",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/6039/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/6039/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1767401171",
    "html_url": "https://github.com/hyperledger/besu/issues/6039#issuecomment-1767401171",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6039",
    "id": 1767401171,
    "node_id": "IC_kwDODE2jmc5pWGbT",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-18T00:30:54Z",
    "updated_at": "2023-10-18T00:30:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "thanks for reporting this @iampkuhz - since you have pinpointed where to fix the problem in the code, would you like to to open a PR with the fix?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1767401171/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
