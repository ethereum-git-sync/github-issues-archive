{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/2606",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/2606/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/2606/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/2606/events",
  "html_url": "https://github.com/hyperledger/besu/issues/2606",
  "id": 959284834,
  "node_id": "MDU6SXNzdWU5NTkyODQ4MzQ=",
  "number": 2606,
  "title": "ether value is not supported for private transactions",
  "user": {
    "login": "ehanoc",
    "id": 1436105,
    "node_id": "MDQ6VXNlcjE0MzYxMDU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1436105?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ehanoc",
    "html_url": "https://github.com/ehanoc",
    "followers_url": "https://api.github.com/users/ehanoc/followers",
    "following_url": "https://api.github.com/users/ehanoc/following{/other_user}",
    "gists_url": "https://api.github.com/users/ehanoc/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ehanoc/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ehanoc/subscriptions",
    "organizations_url": "https://api.github.com/users/ehanoc/orgs",
    "repos_url": "https://api.github.com/users/ehanoc/repos",
    "events_url": "https://api.github.com/users/ehanoc/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ehanoc/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 2051683248,
      "node_id": "MDU6TGFiZWwyMDUxNjgzMjQ4",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/P2",
      "name": "P2",
      "color": "ff9900",
      "default": false,
      "description": "High (ex: Degrading performance issues, unexpected behavior of core features (DevP2P, syncing, etc))"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-08-03T16:21:48Z",
  "updated_at": "2021-08-04T01:02:46Z",
  "closed_at": "2021-08-04T00:34:47Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nUpdating to **21.7.1** currently all mainnet transactions fail with ``` ether value is not supported for private transactions ```\r\nTransaction signature (r,s,v) with v == 37 or v == 38 \r\n\r\nAccording to https://eips.ethereum.org/EIPS/eip-155; (replay protection)\r\n\r\nchain_id == 1 ; v should be either 37 or 38. Minimum. \r\n\r\nBut in here https://github.com/hyperledger/besu/blob/992c6563870ea87874e80b93d3dc6ce93dce880f/ethereum/core/src/main/java/org/hyperledger/besu/ethereum/core/Transaction.java#L629\r\n\r\nV = 37 & v = 38; should still be valid with mainnet txs unless if including the private txs fields such as privateFor, privateFrom, privacyGroupId, etc... \r\n\r\nWhat am i missing?\r\n\r\nNote: With previous version **21.1.7** works fine\r\n",
  "closed_by": {
    "login": "garyschulte",
    "id": 1238512,
    "node_id": "MDQ6VXNlcjEyMzg1MTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1238512?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/garyschulte",
    "html_url": "https://github.com/garyschulte",
    "followers_url": "https://api.github.com/users/garyschulte/followers",
    "following_url": "https://api.github.com/users/garyschulte/following{/other_user}",
    "gists_url": "https://api.github.com/users/garyschulte/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/garyschulte/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/garyschulte/subscriptions",
    "organizations_url": "https://api.github.com/users/garyschulte/orgs",
    "repos_url": "https://api.github.com/users/garyschulte/repos",
    "events_url": "https://api.github.com/users/garyschulte/events{/privacy}",
    "received_events_url": "https://api.github.com/users/garyschulte/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/2606/reactions",
    "total_count": 2,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 1
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/2606/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/892174605",
    "html_url": "https://github.com/hyperledger/besu/issues/2606#issuecomment-892174605",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2606",
    "id": 892174605,
    "node_id": "IC_kwDODE2jmc41LYEN",
    "user": {
      "login": "pedrobranco",
      "id": 4319748,
      "node_id": "MDQ6VXNlcjQzMTk3NDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4319748?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pedrobranco",
      "html_url": "https://github.com/pedrobranco",
      "followers_url": "https://api.github.com/users/pedrobranco/followers",
      "following_url": "https://api.github.com/users/pedrobranco/following{/other_user}",
      "gists_url": "https://api.github.com/users/pedrobranco/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pedrobranco/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pedrobranco/subscriptions",
      "organizations_url": "https://api.github.com/users/pedrobranco/orgs",
      "repos_url": "https://api.github.com/users/pedrobranco/repos",
      "events_url": "https://api.github.com/users/pedrobranco/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pedrobranco/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-03T21:21:14Z",
    "updated_at": "2021-08-03T21:21:14Z",
    "author_association": "NONE",
    "body": "This is affecting Ethereum mainnet transactions (with v = 37/38), and since we're close to the London fork, do we have any ETA to solve this issue (if confirmed)?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/892174605/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/892226327",
    "html_url": "https://github.com/hyperledger/besu/issues/2606#issuecomment-892226327",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2606",
    "id": 892226327,
    "node_id": "IC_kwDODE2jmc41LksX",
    "user": {
      "login": "garyschulte",
      "id": 1238512,
      "node_id": "MDQ6VXNlcjEyMzg1MTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1238512?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/garyschulte",
      "html_url": "https://github.com/garyschulte",
      "followers_url": "https://api.github.com/users/garyschulte/followers",
      "following_url": "https://api.github.com/users/garyschulte/following{/other_user}",
      "gists_url": "https://api.github.com/users/garyschulte/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/garyschulte/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/garyschulte/subscriptions",
      "organizations_url": "https://api.github.com/users/garyschulte/orgs",
      "repos_url": "https://api.github.com/users/garyschulte/repos",
      "events_url": "https://api.github.com/users/garyschulte/events{/privacy}",
      "received_events_url": "https://api.github.com/users/garyschulte/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-03T23:13:16Z",
    "updated_at": "2021-08-03T23:21:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Can you provide more detail on how you are sending the transactions?  ~~Are you not able to provide the chain id in the transactions?~~\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/892226327/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/892271684",
    "html_url": "https://github.com/hyperledger/besu/issues/2606#issuecomment-892271684",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2606",
    "id": 892271684,
    "node_id": "IC_kwDODE2jmc41LvxE",
    "user": {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-04T00:50:26Z",
    "updated_at": "2021-08-04T01:02:46Z",
    "author_association": "MEMBER",
    "body": "Thank you for raising this ticket. I can confirm that we have identified an issue with the misclassification of public transactions as private transactions.\r\n\r\n## The Problem\r\n\r\nThe scope of this problem is limited to:\r\n- Value transfer public transactions received via JSON-RPC\r\n- Value transfer public transactions received via DevP2P\r\n\r\nWhen receiving a value transfer tx via JSON-RPC, Besu was considering it a private tx and enforcing a validity check that prevents private transactions from transferring value. That's why it was returning the error message `ether value is not supported for private transactions`.\r\n\r\nWhen receiving value transfer tx via DevP2P, Besu was considering those transactions invalid, not propagating them further.\r\n\r\nLuckily, the logic for block validation and import wasn't using the same code path. This means that Besu would still successfully synchronise with Mainnet and be up-to-date. **This bug won't cause a fork**.\r\n\r\nWe have already merged the fix for this issue and we will release version `21.7.2` in a few hours. Even though this bug won't impact London chain synchronization and won't cause forks, we recommend that all users update their Besu to the latest version.\r\n\r\n## Actions\r\n\r\nTo prevent something like this from happening again, we have added a test that validates that transactions with `chainId = 1 ` (and any other chainId) won't be affected by private transaction logic.\r\n\r\nA hotfix version `21.7.2` will be released containing the fix.\r\n\r\n## Next Steps\r\n\r\nWe will review the branching of execution of public vs private transactions in an effort to better isolate their differences. The ideal scenario would be that, when running on public networks, none of the private tx logic would be ever in the code execution path.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/892271684/reactions",
      "total_count": 3,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 2,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
