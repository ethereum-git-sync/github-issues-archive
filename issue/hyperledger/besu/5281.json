{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/5281",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/5281/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/5281/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/5281/events",
  "html_url": "https://github.com/hyperledger/besu/issues/5281",
  "id": 1646567318,
  "node_id": "I_kwDODE2jmc5iJJ-W",
  "number": 5281,
  "title": "Nimbus Besu connection disruption",
  "user": {
    "login": "yorickdowne",
    "id": 71337066,
    "node_id": "MDQ6VXNlcjcxMzM3MDY2",
    "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yorickdowne",
    "html_url": "https://github.com/yorickdowne",
    "followers_url": "https://api.github.com/users/yorickdowne/followers",
    "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
    "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
    "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
    "repos_url": "https://api.github.com/users/yorickdowne/repos",
    "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 1921587647,
      "node_id": "MDU6TGFiZWwxOTIxNTg3NjQ3",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamGroot",
      "name": "TeamGroot",
      "color": "1d76db",
      "default": false,
      "description": "GH issues worked on by Groot Team"
    },
    {
      "id": 3013559202,
      "node_id": "MDU6TGFiZWwzMDEzNTU5MjAy",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/mainnet",
      "name": "mainnet",
      "color": "9D578C",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "siladu",
    "id": 2893793,
    "node_id": "MDQ6VXNlcjI4OTM3OTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/siladu",
    "html_url": "https://github.com/siladu",
    "followers_url": "https://api.github.com/users/siladu/followers",
    "following_url": "https://api.github.com/users/siladu/following{/other_user}",
    "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
    "organizations_url": "https://api.github.com/users/siladu/orgs",
    "repos_url": "https://api.github.com/users/siladu/repos",
    "events_url": "https://api.github.com/users/siladu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/siladu/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 14,
  "created_at": "2023-03-29T21:32:41Z",
  "updated_at": "2023-04-03T22:01:27Z",
  "closed_at": "2023-04-03T06:37:38Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nCompanion issue to https://github.com/status-im/nimbus-eth2/issues/4773, as it's unclear to me whether it's a Nimbus issue, a Besu issue, or both\r\n\r\nNimbus 23.3.2 with Besu 23.1.2, the Engine API connection gets disrupted. Reported on Discord; I think I can reproduce this. Fresh Nimbus/Besu sync on Goerli, with Nimbus checkpoint synced and Besu snap synced.\r\n\r\n### Additional Information (Add any of the following or anything else that may be relevant)\r\n\r\nDebug logs are too large to attach, placed them on dropbox: https://www.dropbox.com/s/69sejeefa9i85kt/nimbus-besu-connection-woes.debug.log.tar.gz?dl=0\r\n\r\nLog examples from Nimbus\r\n```\r\nconsensus_1             | WRN 2023-03-29 20:25:07.252+00:00 Connection to EL node degraded             topics=\"elmon\" url=http://execution:8551 failedRequest=getBlockByNumber statusCode=0 err=\"{\\\"code\\\":-32603,\\\"message\\\":\\\"Internal error\\\"}\"\r\nconsensus_1             | INF 2023-03-29 20:25:09.810+00:00 Connection to EL node restored             topics=\"elmon\" url=http://execution:8551\r\n```\r\n\r\nand from Besu\r\n```\r\nexecution_1             | java.net.SocketException: Connection reset\r\nexecution_1             |     at java.base/sun.nio.ch.SocketChannelImpl.throwConnectionReset(SocketChannelImpl.java:394)\r\nexecution_1             |     at java.base/sun.nio.ch.SocketChannelImpl.read(SocketChannelImpl.java:426)\r\nexecution_1             |     at io.netty.buffer.PooledByteBuf.setBytes(PooledByteBuf.java:258)\r\nexecution_1             |     at io.netty.buffer.AbstractByteBuf.writeBytes(AbstractByteBuf.java:1132)\r\nexecution_1             |     at io.netty.channel.socket.nio.NioSocketChannel.doReadBytes(NioSocketChannel.java:357)\r\nexecution_1             |     at io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:151)\r\nexecution_1             |     at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:722)\r\nexecution_1             |     at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:658)\r\nexecution_1             |     at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:584)\r\nexecution_1             |     at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:496)\r\nexecution_1             |     at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\r\nexecution_1             |     at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\nexecution_1             |     at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\nexecution_1             |     at java.base/java.lang.Thread.run(Thread.java:833)\r\n```",
  "closed_by": {
    "login": "siladu",
    "id": 2893793,
    "node_id": "MDQ6VXNlcjI4OTM3OTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/siladu",
    "html_url": "https://github.com/siladu",
    "followers_url": "https://api.github.com/users/siladu/followers",
    "following_url": "https://api.github.com/users/siladu/following{/other_user}",
    "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
    "organizations_url": "https://api.github.com/users/siladu/orgs",
    "repos_url": "https://api.github.com/users/siladu/repos",
    "events_url": "https://api.github.com/users/siladu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/siladu/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/5281/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/5281/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1489392006",
    "html_url": "https://github.com/hyperledger/besu/issues/5281#issuecomment-1489392006",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5281",
    "id": 1489392006,
    "node_id": "IC_kwDODE2jmc5YxlGG",
    "user": {
      "login": "non-fungible-nelson",
      "id": 85905982,
      "node_id": "MDQ6VXNlcjg1OTA1OTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/non-fungible-nelson",
      "html_url": "https://github.com/non-fungible-nelson",
      "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
      "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
      "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
      "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
      "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
      "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-29T22:08:08Z",
    "updated_at": "2023-03-29T22:08:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "Do you have any notes on reproduction? Or frequency? ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1489392006/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1489574334",
    "html_url": "https://github.com/hyperledger/besu/issues/5281#issuecomment-1489574334",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5281",
    "id": 1489574334,
    "node_id": "IC_kwDODE2jmc5YyRm-",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-30T01:57:09Z",
    "updated_at": "2023-03-30T02:02:46Z",
    "author_association": "NONE",
    "body": "I reproduced it by fresh-syncing a Nimbus:Besu pair on Goerli. Showed within a few hours. Besu snap synced, bonsai; nimbus checkpoint synced; http for engine connection, not ws.\r\n\r\nI'll try a second pair overnight on a better machine, in case this is related to low performance of the host.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1489574334/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1489792995",
    "html_url": "https://github.com/hyperledger/besu/issues/5281#issuecomment-1489792995",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5281",
    "id": 1489792995,
    "node_id": "IC_kwDODE2jmc5YzG_j",
    "user": {
      "login": "stefa2k",
      "id": 54934211,
      "node_id": "MDQ6VXNlcjU0OTM0MjEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/54934211?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stefa2k",
      "html_url": "https://github.com/stefa2k",
      "followers_url": "https://api.github.com/users/stefa2k/followers",
      "following_url": "https://api.github.com/users/stefa2k/following{/other_user}",
      "gists_url": "https://api.github.com/users/stefa2k/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stefa2k/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stefa2k/subscriptions",
      "organizations_url": "https://api.github.com/users/stefa2k/orgs",
      "repos_url": "https://api.github.com/users/stefa2k/repos",
      "events_url": "https://api.github.com/users/stefa2k/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stefa2k/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-30T06:58:35Z",
    "updated_at": "2023-03-30T06:58:35Z",
    "author_association": "NONE",
    "body": "I've searched 14 days of logs of Besu and don't see this issue on Besu with Nimbus.\r\n\r\nDo you have some more specifics, like server specs, configs?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1489792995/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1490291201",
    "html_url": "https://github.com/hyperledger/besu/issues/5281#issuecomment-1490291201",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5281",
    "id": 1490291201,
    "node_id": "IC_kwDODE2jmc5Y1AoB",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-30T13:18:41Z",
    "updated_at": "2023-03-30T13:18:41Z",
    "author_association": "NONE",
    "body": "After some more testing, this may be related to test system 1 being a Potato (Netcup VPS). Test system two, a baremetal, has not shown the same errors.\r\n\r\nWhich then begs the question of whether that's worth your while to dig into. Please let me know.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1490291201/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1491289629",
    "html_url": "https://github.com/hyperledger/besu/issues/5281#issuecomment-1491289629",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5281",
    "id": 1491289629,
    "node_id": "IC_kwDODE2jmc5Y40Yd",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-31T04:57:59Z",
    "updated_at": "2023-03-31T05:03:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "@yorickdowne I can see from the logs that besu was still syncing during this period (both block import and snapsync world state download). That may have an impact on besu's ability to respond to RPCs. I will check the expected behaviour of eth_getByBlockNumber during a sync...it shouldn't be throwing an error though :)\r\n\r\nWe are missing logging of this exact error, so am adding that: https://github.com/hyperledger/besu/pull/5288\r\n\r\nHave you got any metrics from this period, e.g. the \"Besu Full\" grafana dashboard?\r\n\r\n---\r\n\r\nAnalysis of the logs...\r\n\r\n```\r\nexecution_1             | 2023-03-29 20:22:06.387+00:00 | nioEventLoopGroup-3-6 | DEBUG | AbstractHandshakeHandler | Handshake error:\r\nexecution_1             | java.net.SocketException: Connection reset\r\n```\r\n\r\n^ This error is related to EL peer handshake not CL, so think we can ignore.\r\n\r\n\r\n```\r\nexecution_1             | 2023-03-29 20:51:38.012+00:00 | EthScheduler-Services-34 (importBlock) | DEBUG | TransactionLogBloomCacher | Caching logs bloom for block 0x4c1892.\r\n```\r\n\r\n^ I see this log surrounding all of the calls to `eth_getBlockByNumber` and there are 443746 of these caching entries in the logs, the final one being 0x4c2704 (4990724). Note this number is close to one of the eth_getBlockByNumber parameters being sent by nimbus, see below.\r\n\r\nI'm pretty sure this much cache population only happens during startup of besu, so maybe it temporarily increases the resource requirements on besu and is another reason why something went south on a lower spec machine.\r\n\r\n```\r\ncat nimbus-besu-connection-woes.debug.log/nimbus-besu-connection-woes.nimbus.debug.log | grep  \"getBlockByNumber\" | grep \"Internal error\" | wc -l\r\n      20\r\n```\r\n\r\n^ Number of errors seen on nimbus side.\r\n\r\n```\r\ncat nimbus-besu-connection-woes.debug.log/nimbus-besu-connection-woes.besu.debug.log | grep \"eth_getBlockByNumber\" | awk '{print $15$16}' | sort | uniq -c\r\n  26 eth_getBlockByNumber[\"0x42A3DA\",false]\r\n 135 eth_getBlockByNumber[\"latest\",false]\r\n```\r\n\r\n^ These are the requests we see on besu side. It doesn't tally exactly with the 20 errors (maybe logs aren't exactly the same timeframe?) but matches more closely with `eth_getBlockByNumber[\"0x42A3DA\",false]` which is a request for this block https://goerli.beaconcha.in/block/4367322\r\nwhich is from `759 days 17 hrs ago (Mar-01-2021)`\r\n\r\nI'm not sure why nimbus would need to repeatedly ask for this block...maybe deposit contract related? I thought goerli deposit contract was much later than that though.\r\n\r\nAlso, if I hit this block on a fully synced bonsai goerli node, it returns a result without an issue.\r\nI am yet to test what happens if you ask for it during syncing at the same point where your node was, but early on in the sync, it just returns a valid response containing a null value (since the syncing chain hasn't imported that block yet).",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1491289629/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1491306544",
    "html_url": "https://github.com/hyperledger/besu/issues/5281#issuecomment-1491306544",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5281",
    "id": 1491306544,
    "node_id": "IC_kwDODE2jmc5Y44gw",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-31T05:12:06Z",
    "updated_at": "2023-03-31T05:12:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Netcup VPS\r\n\r\n@yorickdowne have you got more details about the spec please - I would like to try to recreate a something similar in AWS",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1491306544/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1491742653",
    "html_url": "https://github.com/hyperledger/besu/issues/5281#issuecomment-1491742653",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5281",
    "id": 1491742653,
    "node_id": "IC_kwDODE2jmc5Y6i-9",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-31T10:59:32Z",
    "updated_at": "2023-03-31T11:51:06Z",
    "author_association": "NONE",
    "body": "Hey @siladu thanks for digging! Yes I think you're right that low-spec machine + still syncing + a lot of requests caused the issues. Now that it's synced, it's not showing errors.\r\n\r\nSo on some level - this is acceptable. Potato may show errors while syncing. Fine. If it's something you can optimize fairly easily great, but optimization can be a bottomless hole to throw time into.\r\n\r\nThis is a Netcup VPS 4000 G9. 8 virtual cores on shared CPU - it does not get the compute from an actual 8 cores. 32 GiB memory. 800GB storage, shared access. Tested IOPS: r=18.3k,w=6055 IOPS\r\n\r\nVPS4000 G10, the current model, is 12 virtual cores, 24 GiB memory, same storage.\r\n\r\nIn AWS, maybe a t3a.xlarge with gp3 16k IOPS",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1491742653/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1491747396",
    "html_url": "https://github.com/hyperledger/besu/issues/5281#issuecomment-1491747396",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5281",
    "id": 1491747396,
    "node_id": "IC_kwDODE2jmc5Y6kJE",
    "user": {
      "login": "stefa2k",
      "id": 54934211,
      "node_id": "MDQ6VXNlcjU0OTM0MjEx",
      "avatar_url": "https://avatars.githubusercontent.com/u/54934211?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/stefa2k",
      "html_url": "https://github.com/stefa2k",
      "followers_url": "https://api.github.com/users/stefa2k/followers",
      "following_url": "https://api.github.com/users/stefa2k/following{/other_user}",
      "gists_url": "https://api.github.com/users/stefa2k/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/stefa2k/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/stefa2k/subscriptions",
      "organizations_url": "https://api.github.com/users/stefa2k/orgs",
      "repos_url": "https://api.github.com/users/stefa2k/repos",
      "events_url": "https://api.github.com/users/stefa2k/events{/privacy}",
      "received_events_url": "https://api.github.com/users/stefa2k/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-31T11:03:17Z",
    "updated_at": "2023-03-31T11:03:17Z",
    "author_association": "NONE",
    "body": "8 vCPUs are almost always too short in my experience, especially with AWS",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1491747396/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1491753557",
    "html_url": "https://github.com/hyperledger/besu/issues/5281#issuecomment-1491753557",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5281",
    "id": 1491753557,
    "node_id": "IC_kwDODE2jmc5Y6lpV",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-31T11:08:17Z",
    "updated_at": "2023-03-31T11:12:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "I span up a fleet of nodes (one `m5.xlarge` per besu-CL pair) with the extra logging from #5288 and may have recreated it with prysm and lighthouse on sepolia. Unfortunately the nimbus sepolia and nimbus goerli nodes didn't sync yet (no simple checkpoint sync flag, think it's a manual process) so will have to fix them up on Monday.\r\n\r\nLeaving the error I found here to continue analysing next week...\r\n```\r\nError processing method: eth_getBlockByNumber\r\njava.lang.NullPointerException: Cannot invoke \\\"org.hyperledger.besu.ethereum.core.BlockHeader.getHash()\\\" because \\\"headHeader\\\" is null\r\nat org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthGetBlockByNumber.latestResult(EthGetBlockByNumber.java:86)\r\nat org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.AbstractBlockParameterMethod.findResultByParamType(AbstractBlockParameterMethod.java:90)\r\nat org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.AbstractBlockParameterMethod.response(AbstractBlockParameterMethod.java:102)\r\nat org.hyperledger.besu.ethereum.api.jsonrpc.execution.BaseJsonRpcProcessor.process(BaseJsonRpcProcessor.java:42)\r\nat org.hyperledger.besu.ethereum.api.jsonrpc.execution.TracedJsonRpcProcessor.process(TracedJsonRpcProcessor.java:41)\r\nat org.hyperledger.besu.ethereum.api.jsonrpc.execution.TimedJsonRpcProcessor.process(TimedJsonRpcProcessor.java:45)\r\nat org.hyperledger.besu.ethereum.api.jsonrpc.execution.AuthenticatedJsonRpcProcessor.process(AuthenticatedJsonRpcProcessor.java:51)\r\nat org.hyperledger.besu.ethereum.api.jsonrpc.execution.JsonRpcExecutor.execute(JsonRpcExecutor.java:92)\r\nat org.hyperledger.besu.ethereum.api.handlers.JsonRpcExecutorHandler.executeRequest(JsonRpcExecutorHandler.java:118)\r\nat org.hyperledger.besu.ethereum.api.handlers.JsonRpcExecutorHandler.executeJsonObjectRequest(JsonRpcExecutorHandler.java:131)\r\nat org.hyperledger.besu.ethereum.api.handlers.JsonRpcExecutorHandler.lambda$handler$0(JsonRpcExecutorHandler.java:78)\r\nat io.vertx.ext.web.impl.BlockingHandlerDecorator.lambda$handle$0(BlockingHandlerDecorator.java:48)\r\nat io.vertx.core.impl.ContextImpl.lambda$null$0(ContextImpl.java:159)\r\nat io.vertx.core.impl.AbstractContext.dispatch(AbstractContext.java:100)\r\nat io.vertx.core.impl.ContextImpl.lambda$executeBlocking$1(ContextImpl.java:157)\r\nat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\r\nat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\r\nat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\nat java.base/java.lang.Thread.run(Thread.java:833)\\n\"}\r\n```\r\n\r\nIt might be as simple as not having the requested block number in the chain...although my earlier tests showed this should return a null field in an otherwise valid response, so something else is going on I think.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1491753557/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1491761421",
    "html_url": "https://github.com/hyperledger/besu/issues/5281#issuecomment-1491761421",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5281",
    "id": 1491761421,
    "node_id": "IC_kwDODE2jmc5Y6nkN",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-31T11:14:51Z",
    "updated_at": "2023-03-31T11:14:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "> In AWS, maybe a t3a.xlarge with gp3 8k IOPS, and I'll adjust the IOPS number when I have it, see above.\r\n\r\nThanks. Will see if I can recreate the nimbus scenario with something lower specced like this next week, including the new logging.\r\nI used `m5.xlarge` (wasn't trying to low ball it).",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1491761421/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1493759281",
    "html_url": "https://github.com/hyperledger/besu/issues/5281#issuecomment-1493759281",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5281",
    "id": 1493759281,
    "node_id": "IC_kwDODE2jmc5ZCPUx",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-03T06:37:38Z",
    "updated_at": "2023-04-03T06:37:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "@yorickdowne This was indeed a besu bug, related to a mismatch of cached vs non-cached data, essentially a race condition exposed by syncing (a rapid succession of block imports) and I guess lower-powered machines (slower to import individual blocks).\r\n\r\nThanks for the quality report!\r\n\r\nFixed by #5292 ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1493759281/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1494280700",
    "html_url": "https://github.com/hyperledger/besu/issues/5281#issuecomment-1494280700",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5281",
    "id": 1494280700,
    "node_id": "IC_kwDODE2jmc5ZEOn8",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-03T13:00:30Z",
    "updated_at": "2023-04-03T13:00:30Z",
    "author_association": "NONE",
    "body": "Oh wow @siladu ! I was thinking I should stop testing on potato machines because it's just not useful to do that - but now I'm rethinking. Maybe the occasional potato test *is* useful.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1494280700/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1494989779",
    "html_url": "https://github.com/hyperledger/besu/issues/5281#issuecomment-1494989779",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5281",
    "id": 1494989779,
    "node_id": "IC_kwDODE2jmc5ZG7vT",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-03T21:15:01Z",
    "updated_at": "2023-04-03T21:15:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "@yorickdowne Yeh I think it's useful, good to know the limits where things break down and it's always changing. This one was easily reproducible on our default for non-validating nodes, m5.xlarge - 4 vCPU, 16 GB RAM and EBS rather than NVMe. Would you regard that as a potato ðŸ˜„ ?\r\nMaybe EBS makes block import slow enough.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1494989779/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1495043454",
    "html_url": "https://github.com/hyperledger/besu/issues/5281#issuecomment-1495043454",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5281",
    "id": 1495043454,
    "node_id": "IC_kwDODE2jmc5ZHI1-",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-03T22:01:27Z",
    "updated_at": "2023-04-03T22:01:27Z",
    "author_association": "NONE",
    "body": "EBS is kinda a potato, even at 16k IOPS. Even more so below that.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1495043454/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
