{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/1470",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/1470/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/1470/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/1470/events",
  "html_url": "https://github.com/hyperledger/besu/issues/1470",
  "id": 724521605,
  "node_id": "MDU6SXNzdWU3MjQ1MjE2MDU=",
  "number": 1470,
  "title": "evmtool: Pipe multiple tests into tool doesn't work",
  "user": {
    "login": "MariusVanDerWijden",
    "id": 16664698,
    "node_id": "MDQ6VXNlcjE2NjY0Njk4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16664698?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/MariusVanDerWijden",
    "html_url": "https://github.com/MariusVanDerWijden",
    "followers_url": "https://api.github.com/users/MariusVanDerWijden/followers",
    "following_url": "https://api.github.com/users/MariusVanDerWijden/following{/other_user}",
    "gists_url": "https://api.github.com/users/MariusVanDerWijden/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/MariusVanDerWijden/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/MariusVanDerWijden/subscriptions",
    "organizations_url": "https://api.github.com/users/MariusVanDerWijden/orgs",
    "repos_url": "https://api.github.com/users/MariusVanDerWijden/repos",
    "events_url": "https://api.github.com/users/MariusVanDerWijden/events{/privacy}",
    "received_events_url": "https://api.github.com/users/MariusVanDerWijden/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362496,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDk2",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/enhancement",
      "name": "enhancement",
      "color": "a2eeef",
      "default": true,
      "description": "New feature or request"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-10-19T11:24:07Z",
  "updated_at": "2020-11-13T21:56:27Z",
  "closed_at": "2020-11-13T21:56:27Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nI want to be able to pipe in several tests into the evmtool to execute them. \r\nCurrently it breaks on different errors when piping several tests in.\r\n\r\n### Steps to Reproduce (Bug)\r\n```\r\ncat blaketest.json blaketest.json |  sh ~/ethereum/besu/ethereum/evmtool/build/install/evmtool/bin/evm --json state-test\r\n```\r\n**Expected behavior:** \r\nExecute both tests after one another\r\n\r\n**Actual behavior:**\r\n```\r\n{\"pc\":0,\"op\":124,\"gas\":\"0x79be38\",\"gasCost\":\"0x3\",\"memory\":\"0x\",\"memSize\":0,\"stack\":[],\"returnStack\":[],\"returnData\":null,\"depth\":1,\"refund\":0,\"opName\":\"PUSH29\",\"error\":\"\"}\r\n{\"pc\":30,\"op\":96,\"gas\":\"0x79be35\",\"gasCost\":\"0x3\",\"memory\":\"0x\",\"memSize\":0,\"stack\":[\"0x524bb847c63b6cbc7a4e0f78ba190a4c30324f8012aec991c1ba78b9a\"],\"returnStack\":[],\"returnData\":null,\"depth\":1,\"refund\":0,\"opName\":\"PUSH1\",\"error\":\"\"}\r\n[...]\r\n{\"output\":\"\",\"gasUsed\":\"0x10e26\",\"time\":87663988,\"test\":\"-blaketest-0\",\"fork\":\"Istanbul\",\"d\":0,\"g\":0,\"v\":0,\"postHash\":\"0xf76a3ab4e020b1d8a9e4e3effed4387f5fe5fc36da66a552144e9540bf775e46\",\"postLogsHash\":\"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347\",\"pass\":true}\r\n2020-10-19 13:09:51.343+02:00 | main | FATAL | StateTestSubCommand | com.fasterxml.jackson.databind.exc.MismatchedInputException: No content to map due to end-of-input\r\n at [Source: (BufferedInputStream); line: 1, column: 0]\r\n```\r\n\r\nOR\r\n\r\n```\r\n> cat ./00000021-storagefuzz-0.json ./00000021-storagefuzz-0.json  | /home/martin/besu/ethereum/evmtool/build/install/evmtool/bin/evm --nomemory  --Xberlin-enabled=true state-test \r\n{\"output\":\"\",\"gasUsed\":\"0x79d4df\",\"time\":150001322,\"test\":\"00000021-storagefuzz-0\",\"fork\":\"Berlin\",\"d\":0,\"g\":0,\"v\":0,\"postHash\":\"0x7c9b3cccc38b8a3e1088a9437c051cdbb5a013633580bb1b0f22fd4dfb746186\",\"postLogsHash\":\"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347\",\"pass\":false}\r\n2020-10-19 13:13:59.559+02:00 | main | FATAL | StateTestSubCommand | com.fasterxml.jackson.core.JsonParseException: Unrecognized token 'e546020527f5060005450600060006000600060f25af45060600052600060205360606060206040527f527f2153600060225360526023536060602453606060255360606026536020606060527f27536040527f605360285360606029536000602a536060602b536021602c53606080527f53602d5360606060527f602e5360f...': was expecting (JSON String, Number, Array, Object or token 'null', 'true' or 'false')\r\n at [Source: (BufferedInputStream); line: 1, column: 257]\r\n```\r\n\r\n### Versions (Add all that apply)\r\n* Software version: master at 58945b393538ff791be72098e5cff0ab1415f8ca\r\n\r\ncc @holiman\r\n",
  "closed_by": {
    "login": "timbeiko",
    "id": 9390255,
    "node_id": "MDQ6VXNlcjkzOTAyNTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9390255?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/timbeiko",
    "html_url": "https://github.com/timbeiko",
    "followers_url": "https://api.github.com/users/timbeiko/followers",
    "following_url": "https://api.github.com/users/timbeiko/following{/other_user}",
    "gists_url": "https://api.github.com/users/timbeiko/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/timbeiko/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/timbeiko/subscriptions",
    "organizations_url": "https://api.github.com/users/timbeiko/orgs",
    "repos_url": "https://api.github.com/users/timbeiko/repos",
    "events_url": "https://api.github.com/users/timbeiko/events{/privacy}",
    "received_events_url": "https://api.github.com/users/timbeiko/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/1470/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/1470/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/712098260",
    "html_url": "https://github.com/hyperledger/besu/issues/1470#issuecomment-712098260",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1470",
    "id": 712098260,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMjA5ODI2MA==",
    "user": {
      "login": "holiman",
      "id": 142290,
      "node_id": "MDQ6VXNlcjE0MjI5MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/142290?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/holiman",
      "html_url": "https://github.com/holiman",
      "followers_url": "https://api.github.com/users/holiman/followers",
      "following_url": "https://api.github.com/users/holiman/following{/other_user}",
      "gists_url": "https://api.github.com/users/holiman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/holiman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/holiman/subscriptions",
      "organizations_url": "https://api.github.com/users/holiman/orgs",
      "repos_url": "https://api.github.com/users/holiman/repos",
      "events_url": "https://api.github.com/users/holiman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/holiman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-19T11:38:49Z",
    "updated_at": "2020-10-19T11:38:49Z",
    "author_association": "NONE",
    "body": "I think, for our purposes, it would also work well if we could pipe filenames via stdin. Then evmtool would only have to read input line by line, and exit if the line empty or EOF happens. If we pipe `json` and then another chunk of `json`, a regular json parser might have a difficult time sorting it out",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/712098260/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/726169560",
    "html_url": "https://github.com/hyperledger/besu/issues/1470#issuecomment-726169560",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1470",
    "id": 726169560,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNjE2OTU2MA==",
    "user": {
      "login": "shemnon",
      "id": 38109,
      "node_id": "MDQ6VXNlcjM4MTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shemnon",
      "html_url": "https://github.com/shemnon",
      "followers_url": "https://api.github.com/users/shemnon/followers",
      "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
      "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
      "organizations_url": "https://api.github.com/users/shemnon/orgs",
      "repos_url": "https://api.github.com/users/shemnon/repos",
      "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shemnon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-12T16:00:20Z",
    "updated_at": "2020-11-12T16:00:20Z",
    "author_association": "MEMBER",
    "body": "Fix will be in docker develop shortly, will be part of 20.10.1 next week.\r\n\r\nEach input line is considered an input file.  Output is still the same (unless there are file not found errors or json errors)",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/726169560/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/726172103",
    "html_url": "https://github.com/hyperledger/besu/issues/1470#issuecomment-726172103",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1470",
    "id": 726172103,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyNjE3MjEwMw==",
    "user": {
      "login": "shemnon",
      "id": 38109,
      "node_id": "MDQ6VXNlcjM4MTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shemnon",
      "html_url": "https://github.com/shemnon",
      "followers_url": "https://api.github.com/users/shemnon/followers",
      "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
      "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
      "organizations_url": "https://api.github.com/users/shemnon/orgs",
      "repos_url": "https://api.github.com/users/shemnon/repos",
      "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shemnon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-12T16:04:26Z",
    "updated_at": "2020-11-12T16:04:26Z",
    "author_association": "MEMBER",
    "body": "```\r\ndannos-mbp:besu dannoferrin$ echo \"ethereum/referencetests/src/test/resources/GeneralStateTests/stRandom/randomStatetest77.json\r\n> ethereum/referencetests/src/test/resources/GeneralStateTests/stRandom/randomStatetest78.json\r\n> ethereum/referencetests/src/test/resources/GeneralStateTests/stRandom/randomStatetest79.json\" | build/install/besu/bin/evm state-test \r\n{\"output\":\"\",\"gasUsed\":\"0xa4fb\",\"time\":22980036,\"test\":\"randomStatetest77\",\"fork\":\"Istanbul\",\"d\":0,\"g\":0,\"v\":0,\"postHash\":\"0x8aec5d22d021ecc562cbf8bdb06c113b5de0d9580790e47dee61e3e3d5a106f4\",\"postLogsHash\":\"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347\",\"pass\":true}\r\n{\"output\":\"\",\"gasUsed\":\"0x5d6d\",\"time\":1274074,\"test\":\"randomStatetest78\",\"fork\":\"Istanbul\",\"d\":0,\"g\":0,\"v\":0,\"postHash\":\"0xab50425efdf22d51ea3227261d6117112b623317cbceb6965836f1da7916142a\",\"postLogsHash\":\"0x1dcc4de8dec75d7aab85b567b6ccd41ad312451b948a7413f0a142fd40d49347\",\"pass\":true}\r\nFile not found:ethereum/referencetests/src/test/resources/GeneralStateTests/stRandom/randomStatetest79.json\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/726172103/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
