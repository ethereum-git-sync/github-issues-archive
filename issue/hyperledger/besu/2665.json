{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/2665",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/2665/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/2665/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/2665/events",
  "html_url": "https://github.com/hyperledger/besu/issues/2665",
  "id": 976051509,
  "node_id": "MDU6SXNzdWU5NzYwNTE1MDk=",
  "number": 2665,
  "title": "SECP256R1 unit tests failing on MacOS",
  "user": {
    "login": "lucassaldanha",
    "id": 1766440,
    "node_id": "MDQ6VXNlcjE3NjY0NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lucassaldanha",
    "html_url": "https://github.com/lucassaldanha",
    "followers_url": "https://api.github.com/users/lucassaldanha/followers",
    "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
    "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
    "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
    "repos_url": "https://api.github.com/users/lucassaldanha/repos",
    "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 1537362498,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDk4",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/help%20wanted",
      "name": "help wanted",
      "color": "008672",
      "default": true,
      "description": "Extra attention is needed"
    },
    {
      "id": 2051684044,
      "node_id": "MDU6TGFiZWwyMDUxNjg0MDQ0",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/P4",
      "name": "P4",
      "color": "ccff33",
      "default": false,
      "description": "Low (ex: Node doesn't start up when the configuration file has unexpected \"end-of-line\" character)"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-08-21T05:40:16Z",
  "updated_at": "2021-08-23T23:43:11Z",
  "closed_at": "2021-08-23T23:43:11Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "### Description\r\nSome tests on `SECP256R1Test` are failing when running on MacOS. This was likely introduced in https://github.com/hyperledger/besu/pull/2630.\r\n\r\nThe tests are working fine on a Linux machine and on the CircleCI build.\r\n\r\nThe native libraries are from https://github.com/hyperledger/besu-native\r\n\r\nTest **â€‹org.hyperledger.besu.crypto.SECP256R1Test#signatureGenerationAndVerification:**\r\n```\r\ndlopen(/Users/lucas/Library/Caches/JNA/temp/jna17785093207262039815.tmp, 9): Library not loaded: /usr/local/lib/libcrypto.3.dylib\r\n  Referenced from: /Users/lucas/Library/Caches/JNA/temp/jna17785093207262039815.tmp\r\n  Reason: image not found\r\njava.lang.UnsatisfiedLinkError: dlopen(/Users/lucas/Library/Caches/JNA/temp/jna17785093207262039815.tmp, 9): Library not loaded: /usr/local/lib/libcrypto.3.dylib\r\n  Referenced from: /Users/lucas/Library/Caches/JNA/temp/jna17785093207262039815.tmp\r\n  Reason: image not found\r\n\tat com.sun.jna.Native.open(Native Method)\r\n\tat com.sun.jna.NativeLibrary.loadLibrary(NativeLibrary.java:277)\r\n\tat com.sun.jna.NativeLibrary.getInstance(NativeLibrary.java:461)\r\n\tat com.sun.jna.Library$Handler.<init>(Library.java:192)\r\n\tat com.sun.jna.Native.load(Native.java:596)\r\n\tat com.sun.jna.Native.load(Native.java:570)\r\n\tat org.hyperledger.besu.nativelib.secp256r1.besuNativeEC.BesuNativeEC.<clinit>(BesuNativeEC.java:23)\r\n\tat org.hyperledger.besu.nativelib.secp256r1.LibSECP256R1.sign(LibSECP256R1.java:35)\r\n\tat org.hyperledger.besu.crypto.SECP256R1.signNative(SECP256R1.java:94)\r\n\tat org.hyperledger.besu.crypto.SECP256R1.sign(SECP256R1.java:67)\r\n\tat org.hyperledger.besu.crypto.SECP256R1Test.lambda$signatureGenerationAndVerification$0(SECP256R1Test.java:156)\r\n\tat java.base/java.lang.Iterable.forEach(Iterable.java:75)\r\n\tat org.hyperledger.besu.crypto.SECP256R1Test.signatureGenerationAndVerification(SECP256R1Test.java:146)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\r\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\r\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\r\n\tat org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)\r\n\tat org.junit.runners.BlockJUnit4ClassRunner$1.evaluate(BlockJUnit4ClassRunner.java:100)\r\n\tat org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)\r\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103)\r\n\tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63)\r\n\tat org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)\r\n\tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)\r\n\tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)\r\n\tat org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)\r\n\tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)\r\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\r\n\tat org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)\r\n\tat org.junit.runners.ParentRunner.run(ParentRunner.java:413)\r\n\tat org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor.runTestClass(JUnitTestClassExecutor.java:110)\r\n\tat org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor.execute(JUnitTestClassExecutor.java:58)\r\n\tat org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor.execute(JUnitTestClassExecutor.java:38)\r\n\tat org.gradle.api.internal.tasks.testing.junit.AbstractJUnitTestClassProcessor.processTestClass(AbstractJUnitTestClassProcessor.java:62)\r\n\tat org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.processTestClass(SuiteTestClassProcessor.java:51)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:36)\r\n\tat org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)\r\n\tat org.gradle.internal.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:33)\r\n\tat org.gradle.internal.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:94)\r\n\tat com.sun.proxy.$Proxy5.processTestClass(Unknown Source)\r\n\tat org.gradle.api.internal.tasks.testing.worker.TestWorker.processTestClass(TestWorker.java:121)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:36)\r\n\tat org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)\r\n\tat org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:182)\r\n\tat org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:164)\r\n\tat org.gradle.internal.remote.internal.hub.MessageHub$Handler.run(MessageHub.java:414)\r\n\tat org.gradle.internal.concurrent.ExecutorPolicy$CatchAndRecordFailures.onExecute(ExecutorPolicy.java:64)\r\n\tat org.gradle.internal.concurrent.ManagedExecutorImpl$1.run(ManagedExecutorImpl.java:48)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n\tat org.gradle.internal.concurrent.ThreadFactoryImpl$ManagedThreadRunnable.run(ThreadFactoryImpl.java:56)\r\n\tat java.base/java.lang.Thread.run(Thread.java:834)\r\n```\r\n\r\nTest **org.hyperledger.besu.crypto.SECP256R1Test#recoverPublicKeyFromSignature**\r\n```\r\nCould not initialize class org.hyperledger.besu.nativelib.secp256r1.besuNativeEC.BesuNativeEC\r\njava.lang.NoClassDefFoundError: Could not initialize class org.hyperledger.besu.nativelib.secp256r1.besuNativeEC.BesuNativeEC\r\n\tat org.hyperledger.besu.nativelib.secp256r1.LibSECP256R1.sign(LibSECP256R1.java:35)\r\n\tat org.hyperledger.besu.crypto.SECP256R1.signNative(SECP256R1.java:94)\r\n\tat org.hyperledger.besu.crypto.SECP256R1.sign(SECP256R1.java:67)\r\n\tat org.hyperledger.besu.crypto.SECP256R1Test.recoverPublicKeyFromSignature(SECP256R1Test.java:137)\r\n```\r\n\r\n### Acceptance Criteria\r\n* Test success should be independent of the platform\r\n\r\n### Steps to Reproduce (Bug)\r\n1. Run `./gradlew :crypto:test` on a MacOS machine\r\n\r\n**Expected behavior:** All tests passing\r\n\r\n**Actual behavior:** Some tests in SECP256R1 class are failing\r\n\r\n**Frequency:** Always\r\n\r\n### Versions (Add all that apply)\r\n* Software version: Commit 0b2b2bacd210f5b30665eb6febb907e28f159817 onwards\r\n* Java version: openjdk 11.0.2 2019-01-15\r\n* OS Name & Version: MacOS Big Sur 11.5.2\r\n\r\n### Additional Information\r\n\r\nIf this is blocking someone, you can exclude the test from the crypto package:\r\n```\r\n./gradlew build -x :crypto:test\r\n```\r\n\r\n",
  "closed_by": {
    "login": "lucassaldanha",
    "id": 1766440,
    "node_id": "MDQ6VXNlcjE3NjY0NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lucassaldanha",
    "html_url": "https://github.com/lucassaldanha",
    "followers_url": "https://api.github.com/users/lucassaldanha/followers",
    "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
    "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
    "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
    "repos_url": "https://api.github.com/users/lucassaldanha/repos",
    "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/2665/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/2665/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/903422305",
    "html_url": "https://github.com/hyperledger/besu/issues/2665#issuecomment-903422305",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2665",
    "id": 903422305,
    "node_id": "IC_kwDODE2jmc412SFh",
    "user": {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-23T03:59:27Z",
    "updated_at": "2021-08-23T04:00:31Z",
    "author_association": "MEMBER",
    "body": "@daniel-iobuilders is looking at this issue. Starting with https://github.com/ConsenSys/besu-native-ec/pull/17",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/903422305/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
