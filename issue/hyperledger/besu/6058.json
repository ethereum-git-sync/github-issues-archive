{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/6058/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/6058/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/6058/events",
  "html_url": "https://github.com/hyperledger/besu/issues/6058",
  "id": 1951893294,
  "node_id": "I_kwDODE2jmc50V4cu",
  "number": 6058,
  "title": "[FEATURE REQUEST] Set  DEFAULT_LOWEST_INVALID_KNOWN_NONCE_CACHE configurable, like others transaction pool options",
  "user": {
    "login": "tzdesing",
    "id": 9799146,
    "node_id": "MDQ6VXNlcjk3OTkxNDY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9799146?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tzdesing",
    "html_url": "https://github.com/tzdesing",
    "followers_url": "https://api.github.com/users/tzdesing/followers",
    "following_url": "https://api.github.com/users/tzdesing/following{/other_user}",
    "gists_url": "https://api.github.com/users/tzdesing/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tzdesing/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tzdesing/subscriptions",
    "organizations_url": "https://api.github.com/users/tzdesing/orgs",
    "repos_url": "https://api.github.com/users/tzdesing/repos",
    "events_url": "https://api.github.com/users/tzdesing/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tzdesing/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 4328706977,
      "node_id": "LA_kwDODE2jmc8AAAABAgLToQ",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamChupa",
      "name": "TeamChupa",
      "color": "fbca04",
      "default": false,
      "description": "GH issues worked on by Chupacabara Team"
    },
    {
      "id": 5290172097,
      "node_id": "LA_kwDODE2jmc8AAAABO1GewQ",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/non%20mainnet%20(private%20networks)",
      "name": "non mainnet (private networks)",
      "color": "0052cc",
      "default": false,
      "description": "not related to mainnet features - covers privacy, permissioning, IBFT2, QBFT"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 20,
  "created_at": "2023-10-19T10:57:08Z",
  "updated_at": "2023-11-09T08:56:29Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!-- Have you done the following? -->\r\n<!--   * read the Code of Conduct? By filing an Issue, you are expected to -->  \r\n<!--     comply with it, including treating everyone with respect: -->\r\n<!--     https://github.com/hyperledger/besu/blob/main/CODE_OF_CONDUCT.md -->\r\n<!--   * Reproduced the issue in the latest version of the software -->\r\n<!--   * Read the debugging docs: https://besu.hyperledger.org/en/stable/HowTo/Monitor/Logging/ -->\r\n<!--   * Duplicate Issue check:  https://github.com/search?q=+is%3Aissue+repo%3Ahyperledger/Besu -->\r\n<!-- Note:  Not all sections will apply to all issue types. -->\r\n\r\n### Description\r\nWe are In a private free gas chain , using QBFT protocol, to implement a national CBDC, when a trasanction get stucked in TX_POOL, that transactions are included in cache. We are unable to send a new transaction with higher gas, so the only way is set our TX_POOL_MAX_SIZE to 0 , and back to default value, then we are able to sent new transactons, but , the invalid transaction was included in cache of validator and we are unable to reset then. because of network rules. So always we sent new transactions BESU will check this cache, and invalidate again because we have a higher nonce.\r\n\r\n### Acceptance Criteria\r\nIF we are able to set LOWEST_INVALID_KNOWN_NONCE_CACHE = 0 on bootstrap of validators nodes, we can transact normally and transactions will not being invalidated every time, because we haven't a cache, in our case this cache isn't necessary. \r\n\r\n\r\n\r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/6058/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/6058/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1770911167",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1770911167",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1770911167,
    "node_id": "IC_kwDODE2jmc5pjfW_",
    "user": {
      "login": "alexcostars",
      "id": 6418743,
      "node_id": "MDQ6VXNlcjY0MTg3NDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6418743?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcostars",
      "html_url": "https://github.com/alexcostars",
      "followers_url": "https://api.github.com/users/alexcostars/followers",
      "following_url": "https://api.github.com/users/alexcostars/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcostars/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcostars/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcostars/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcostars/orgs",
      "repos_url": "https://api.github.com/users/alexcostars/repos",
      "events_url": "https://api.github.com/users/alexcostars/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcostars/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-19T12:43:32Z",
    "updated_at": "2023-10-19T12:43:32Z",
    "author_association": "NONE",
    "body": "We are facing the same problem. In our case, we have a lot of accounts that as blocked (all transactions signed by these accounts are getting stuck in TX_POOL).\r\n\r\nOne other option is a command line option that disables invalid nonce cache control.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1770911167/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1773006266",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1773006266",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1773006266,
    "node_id": "IC_kwDODE2jmc5pre26",
    "user": {
      "login": "matthew1001",
      "id": 6599269,
      "node_id": "MDQ6VXNlcjY1OTkyNjk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6599269?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthew1001",
      "html_url": "https://github.com/matthew1001",
      "followers_url": "https://api.github.com/users/matthew1001/followers",
      "following_url": "https://api.github.com/users/matthew1001/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthew1001/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthew1001/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthew1001/subscriptions",
      "organizations_url": "https://api.github.com/users/matthew1001/orgs",
      "repos_url": "https://api.github.com/users/matthew1001/repos",
      "events_url": "https://api.github.com/users/matthew1001/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthew1001/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-20T16:03:16Z",
    "updated_at": "2023-10-20T16:03:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "I raised a discussion on discord about exactly this issue a couple of days ago: https://discord.com/channels/905194001349627914/905205502940696607/1164623046389272699\r\n\r\nI was considering a PR that would prevent invalid TXs entering the invalid nonce cache if the reason was `NONCE_TOO_LOW` (which is the reason I've seen it happening with). The `NONCE_TOO_LOW` error seems to be the least sensible reason to set the invalid nonce cache to that value - because by definition, you couldn't submit a new TX at that nonce anyway.\r\n\r\nI'll potentially raise that PR, but I think the new layered pool implementation doesn't use an invalid nonce cache. So you could set `--tx-pool=layered` and see if that prevents the invalid nonce cache from blocking up the pool.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1773006266/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1773026889",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1773026889",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1773026889,
    "node_id": "IC_kwDODE2jmc5prj5J",
    "user": {
      "login": "matthew1001",
      "id": 6599269,
      "node_id": "MDQ6VXNlcjY1OTkyNjk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6599269?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthew1001",
      "html_url": "https://github.com/matthew1001",
      "followers_url": "https://api.github.com/users/matthew1001/followers",
      "following_url": "https://api.github.com/users/matthew1001/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthew1001/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthew1001/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthew1001/subscriptions",
      "organizations_url": "https://api.github.com/users/matthew1001/orgs",
      "repos_url": "https://api.github.com/users/matthew1001/repos",
      "events_url": "https://api.github.com/users/matthew1001/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthew1001/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-20T16:17:05Z",
    "updated_at": "2023-10-20T16:17:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "I've raised https://github.com/hyperledger/besu/pull/6067 which I think could help in a large number of the cases.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1773026889/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1773029476",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1773029476",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1773029476,
    "node_id": "IC_kwDODE2jmc5prkhk",
    "user": {
      "login": "matthew1001",
      "id": 6599269,
      "node_id": "MDQ6VXNlcjY1OTkyNjk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6599269?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthew1001",
      "html_url": "https://github.com/matthew1001",
      "followers_url": "https://api.github.com/users/matthew1001/followers",
      "following_url": "https://api.github.com/users/matthew1001/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthew1001/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthew1001/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthew1001/subscriptions",
      "organizations_url": "https://api.github.com/users/matthew1001/orgs",
      "repos_url": "https://api.github.com/users/matthew1001/repos",
      "events_url": "https://api.github.com/users/matthew1001/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthew1001/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-20T16:18:58Z",
    "updated_at": "2023-10-20T16:18:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "Note that I think this issue which I raised yesterday is closely related to the scenario described:\r\n\r\nhttps://github.com/hyperledger/besu/issues/6043\r\n\r\nCurrently even if you set `--tx-pool-price-bump=0` you cannot replace existing transactions. I think for QBFT, permissioned deployments it is very difficult to manage the pool through set its max size, or its retention time, when problematic transactions make their way into the pool.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1773029476/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1773122761",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1773122761",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1773122761,
    "node_id": "IC_kwDODE2jmc5pr7TJ",
    "user": {
      "login": "alexcostars",
      "id": 6418743,
      "node_id": "MDQ6VXNlcjY0MTg3NDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6418743?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcostars",
      "html_url": "https://github.com/alexcostars",
      "followers_url": "https://api.github.com/users/alexcostars/followers",
      "following_url": "https://api.github.com/users/alexcostars/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcostars/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcostars/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcostars/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcostars/orgs",
      "repos_url": "https://api.github.com/users/alexcostars/repos",
      "events_url": "https://api.github.com/users/alexcostars/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcostars/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-20T17:27:33Z",
    "updated_at": "2023-10-20T17:27:33Z",
    "author_association": "NONE",
    "body": "@matthew1001 as you mentioned, there is a new layered pool implementation. Has this new implementation already been released?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1773122761/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1773127266",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1773127266",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1773127266,
    "node_id": "IC_kwDODE2jmc5pr8Zi",
    "user": {
      "login": "matthew1001",
      "id": 6599269,
      "node_id": "MDQ6VXNlcjY1OTkyNjk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6599269?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthew1001",
      "html_url": "https://github.com/matthew1001",
      "followers_url": "https://api.github.com/users/matthew1001/followers",
      "following_url": "https://api.github.com/users/matthew1001/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthew1001/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthew1001/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthew1001/subscriptions",
      "organizations_url": "https://api.github.com/users/matthew1001/orgs",
      "repos_url": "https://api.github.com/users/matthew1001/repos",
      "events_url": "https://api.github.com/users/matthew1001/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthew1001/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-20T17:30:30Z",
    "updated_at": "2023-10-20T17:30:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "> @matthew1001 as you mentioned, there is a new layered pool implementation. Has this new implementation already been released?\n\nYes it's available in 23.10.0 as the default pool implementation.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1773127266/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1773130118",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1773130118",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1773130118,
    "node_id": "IC_kwDODE2jmc5pr9GG",
    "user": {
      "login": "matthew1001",
      "id": 6599269,
      "node_id": "MDQ6VXNlcjY1OTkyNjk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6599269?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matthew1001",
      "html_url": "https://github.com/matthew1001",
      "followers_url": "https://api.github.com/users/matthew1001/followers",
      "following_url": "https://api.github.com/users/matthew1001/following{/other_user}",
      "gists_url": "https://api.github.com/users/matthew1001/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matthew1001/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matthew1001/subscriptions",
      "organizations_url": "https://api.github.com/users/matthew1001/orgs",
      "repos_url": "https://api.github.com/users/matthew1001/repos",
      "events_url": "https://api.github.com/users/matthew1001/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matthew1001/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-20T17:31:56Z",
    "updated_at": "2023-10-20T17:31:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "Before 23.10.0 you need to set `--Xlayered-tx-pool=true` to use it ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1773130118/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1776739922",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1776739922",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1776739922,
    "node_id": "IC_kwDODE2jmc5p5uZS",
    "user": {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-24T08:18:06Z",
    "updated_at": "2023-10-24T08:18:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "the _invalid known nonce cache_ was introduced as a workaround to mitigate the nonce gap problem while we where introducing the new layered txpool, that solves this problem in a much better way. So if you are running Besu version *>= 23.4.1* I strongly recommend to use it instead of the legacy one. [Since version *23.10.0* it is the default](https://github.com/hyperledger/besu/releases/tag/23.10.0)\r\n\r\nSaid that we see that there are some specific use cases for private networks that are not supported, and there is the opportunity to create a txpool tailored for them.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1776739922/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1777210481",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1777210481",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1777210481,
    "node_id": "IC_kwDODE2jmc5p7hRx",
    "user": {
      "login": "alexcostars",
      "id": 6418743,
      "node_id": "MDQ6VXNlcjY0MTg3NDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6418743?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcostars",
      "html_url": "https://github.com/alexcostars",
      "followers_url": "https://api.github.com/users/alexcostars/followers",
      "following_url": "https://api.github.com/users/alexcostars/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcostars/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcostars/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcostars/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcostars/orgs",
      "repos_url": "https://api.github.com/users/alexcostars/repos",
      "events_url": "https://api.github.com/users/alexcostars/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcostars/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-24T13:30:38Z",
    "updated_at": "2023-10-24T13:30:38Z",
    "author_association": "NONE",
    "body": "Excellent advice. We will enable this option, but we are using 23.4.1 version and there is no documented option related `--Xlayered-tx-pool=true` (https://besu.hyperledger.org/23.4.1/public-networks/reference/cli/options and https://besu.hyperledger.org/23.4.1/private-networks/reference/cli/options), then I suggest to include this command line in the official documentation.\r\n\r\nThere is an equivalent ENV variable to set this config?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1777210481/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1777277572",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1777277572",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1777277572,
    "node_id": "IC_kwDODE2jmc5p7xqE",
    "user": {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-24T14:01:20Z",
    "updated_at": "2023-10-24T14:01:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "It is not documented in that version, because we are not documenting experimental or hidden features, but you can read about the options, directly in the PR https://github.com/hyperledger/besu/pull/5290\r\n\r\nfor the env variable try `BESU_XLAYERED_TX_POOL=true`",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1777277572/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1779198541",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1779198541",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1779198541,
    "node_id": "IC_kwDODE2jmc5qDGpN",
    "user": {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-25T12:45:56Z",
    "updated_at": "2023-10-25T12:45:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "FYI: [This PR](https://github.com/hyperledger/besu/pull/6079) is an improvement to allow for easier tx replacement",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1779198541/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1790003824",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1790003824",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1790003824,
    "node_id": "IC_kwDODE2jmc5qsUpw",
    "user": {
      "login": "alexcostars",
      "id": 6418743,
      "node_id": "MDQ6VXNlcjY0MTg3NDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6418743?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcostars",
      "html_url": "https://github.com/alexcostars",
      "followers_url": "https://api.github.com/users/alexcostars/followers",
      "following_url": "https://api.github.com/users/alexcostars/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcostars/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcostars/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcostars/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcostars/orgs",
      "repos_url": "https://api.github.com/users/alexcostars/repos",
      "events_url": "https://api.github.com/users/alexcostars/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcostars/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-02T03:24:11Z",
    "updated_at": "2023-11-02T03:24:11Z",
    "author_association": "NONE",
    "body": "@fab-10,\r\nWe recently ran into this issue on one of our addresses (caching invalid nonces).\r\n\r\nI understand and agree with your suggestion to enable the parameters (or migrate to 23.10), but we are trying to reproduce the error to document and justify the configuration change, but we are not succeeding. When we didn't want to generate the error it occurred, but now that we want to generate it we can't.\r\n\r\nCould you help us understand how we can reproduce the nonce gap scenario in version 23.4? Except network problems and spam transactions (mentioned in the PR), is there any practical way to cause the inclusion of an address in the cache of invalid nonces?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1790003824/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1792716101",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1792716101",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1792716101,
    "node_id": "IC_kwDODE2jmc5q2q1F",
    "user": {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-03T16:08:46Z",
    "updated_at": "2023-11-03T16:08:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "@alexcostars could you share the configuration and parameters used to start Besu? it will also help to know about your setup, how many nodes and from which nodes you send the txs.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1792716101/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1792894215",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1792894215",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1792894215,
    "node_id": "IC_kwDODE2jmc5q3WUH",
    "user": {
      "login": "alexcostars",
      "id": 6418743,
      "node_id": "MDQ6VXNlcjY0MTg3NDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6418743?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcostars",
      "html_url": "https://github.com/alexcostars",
      "followers_url": "https://api.github.com/users/alexcostars/followers",
      "following_url": "https://api.github.com/users/alexcostars/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcostars/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcostars/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcostars/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcostars/orgs",
      "repos_url": "https://api.github.com/users/alexcostars/repos",
      "events_url": "https://api.github.com/users/alexcostars/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcostars/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-03T17:59:03Z",
    "updated_at": "2023-11-03T17:59:03Z",
    "author_association": "NONE",
    "body": "Here we have the genesis file (https://github.com/bacen/pilotord-kit-onboarding/blob/main/genesis.json) and conf (https://github.com/bacen/pilotord-kit-onboarding/blob/main/config.toml).\r\n\r\nWe are connected to 20 peers, 14 full nodes and 6 validators.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1792894215/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1800122587",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1800122587",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1800122587,
    "node_id": "IC_kwDODE2jmc5rS7Db",
    "user": {
      "login": "alexcostars",
      "id": 6418743,
      "node_id": "MDQ6VXNlcjY0MTg3NDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6418743?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcostars",
      "html_url": "https://github.com/alexcostars",
      "followers_url": "https://api.github.com/users/alexcostars/followers",
      "following_url": "https://api.github.com/users/alexcostars/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcostars/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcostars/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcostars/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcostars/orgs",
      "repos_url": "https://api.github.com/users/alexcostars/repos",
      "events_url": "https://api.github.com/users/alexcostars/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcostars/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-07T21:08:34Z",
    "updated_at": "2023-11-07T21:08:34Z",
    "author_association": "NONE",
    "body": "Hi, 2 weeks ago we faced this error, and the solution was to restart all validator nodes (because Invalid Nonce Cache is controlled in memory).\r\n\r\nToday the error occurred again. We have, now, an account blocked (possibly setted as invalid nonce cache into validators). There is anything that I can do to understand why is this occurring?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1800122587/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1801870669",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1801870669",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1801870669,
    "node_id": "IC_kwDODE2jmc5rZl1N",
    "user": {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-08T13:15:10Z",
    "updated_at": "2023-11-09T08:47:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "@alexcostars unfortunately with your version is not possible to do much, the only thing that comes to mind is to check the metrics, but also there there are limits.\r\n\r\nAbout your request to reproduce the issue, if you were on a gas priced network, then I would have suggested to play with the balances of the account, to simulate it, but since in your case you are on a gas free network, it is not easy to manually simulate the issue, because if the invalid reason is NONCE_TOO_LOW, that depends on the timing of events.\r\n\r\nNONCE_TOO_LOW is triggered when a validator is trying to create a block, and it selects a tx with a nonce that is already present in the world state for that sender, namely already confirmed, and this should happens if some events overlaps  as detailed below:\r\n\r\nNormal flow\r\n1. Tx1 and Tx2 for Sender1 are sent (Sender1 nonce=0)\r\n2. Block1 with only Tx1 is created\r\n3. Block1 with Tx1 is imported -> nonce increased (Sender1 nonce=1)\r\n4. Tx1 is now confirmed and removed from the pool\r\n5. Block2 with Tx2 is produced\r\n\r\nthe issue is when 5. happens before 4., that is, when a new block is being built, before the removal of confirmed txs from the pool is complete, as below:\r\n\r\n1. Tx1 and Tx2 for Sender1 are sent (Sender1 nonce=0)\r\n2. Block1 with only Tx1 is created\r\n3. Block1 with Tx1 is imported -> nonce increased (Sender1 nonce=1)\r\n4a. Block2 creation starts with Tx1 and Tx2 in the txppol (Tx1 is invalid since already present in the state) and flagged with NONCE_TOO_LOW and inserted in the invalid nonce cache, and by consequence also Tx2 is removed since it has an invalid tx with a lower nonce. Block2 is then created with no tx from that sender\r\n5a. Tx1 is now confirmed and removed from the pool\r\n\r\nSo this case is hard to reproduce in a deterministic way, at some point you need to upgrade to a newer version where, with the help of @matthew1001, we are improving on this part.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1801870669/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1802260925",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1802260925",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1802260925,
    "node_id": "IC_kwDODE2jmc5rbFG9",
    "user": {
      "login": "alexcostars",
      "id": 6418743,
      "node_id": "MDQ6VXNlcjY0MTg3NDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6418743?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alexcostars",
      "html_url": "https://github.com/alexcostars",
      "followers_url": "https://api.github.com/users/alexcostars/followers",
      "following_url": "https://api.github.com/users/alexcostars/following{/other_user}",
      "gists_url": "https://api.github.com/users/alexcostars/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alexcostars/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alexcostars/subscriptions",
      "organizations_url": "https://api.github.com/users/alexcostars/orgs",
      "repos_url": "https://api.github.com/users/alexcostars/repos",
      "events_url": "https://api.github.com/users/alexcostars/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alexcostars/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-08T16:38:56Z",
    "updated_at": "2023-11-08T16:38:56Z",
    "author_association": "NONE",
    "body": "Thanks for describing the scenario, we know that it's hard to reproduce it.\r\n\r\nI have 2 questions:\r\n\r\n1) In step 4a, when Besu created Block2 and faced that the Tx1 is already present in the state, why validator not delete Block2 from local and trigger a new block producer (what is de gain of including this account on Invalid Cache Nonce?)? Or Block2 is already broadcasted?\r\n\r\n2) If this scenario occurs in a validator that has `--Xlayered-tx-pool=true` seeted, what happens?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1802260925/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1802306483",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1802306483",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1802306483,
    "node_id": "IC_kwDODE2jmc5rbQOz",
    "user": {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-08T17:05:46Z",
    "updated_at": "2023-11-08T17:05:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "@matthew1001 found another race condition that results in chain head not available error, that he is tracking [here ](https://github.com/hyperledger/besu/issues/6140), and could be also a cause of your errors.\r\n\r\nAbout your questions:\r\n\r\n1. Block2 is created because, it selects txs from the txpool content has at that moment, the fact that tx1 is not accepted has no effect on block building, like any other tx\r\n2. This scenario could also happen with the layered txpool, but the layered txpool does not have the invalid nonce cache, so you should be able to send other txs from the same sender",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1802306483/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1802514509",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1802514509",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1802514509,
    "node_id": "IC_kwDODE2jmc5rcDBN",
    "user": {
      "login": "rsarres",
      "id": 23102018,
      "node_id": "MDQ6VXNlcjIzMTAyMDE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/23102018?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rsarres",
      "html_url": "https://github.com/rsarres",
      "followers_url": "https://api.github.com/users/rsarres/followers",
      "following_url": "https://api.github.com/users/rsarres/following{/other_user}",
      "gists_url": "https://api.github.com/users/rsarres/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rsarres/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rsarres/subscriptions",
      "organizations_url": "https://api.github.com/users/rsarres/orgs",
      "repos_url": "https://api.github.com/users/rsarres/repos",
      "events_url": "https://api.github.com/users/rsarres/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rsarres/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-08T19:26:51Z",
    "updated_at": "2023-11-08T19:26:51Z",
    "author_association": "NONE",
    "body": "@fab-10 \r\nPlease evaluate my understanding of the issue:\r\n1- The error LOWER_NONCE_INVALID_TRANSACTION_EXISTS means that the node is rejecting the tx to enter its txpool because it thinks there is an already confirmed tx with a higher nonce on the blockchain.\r\n1a- If the above understanding is correct, the text of the error is misleading. I personally understood that a invalid transaction  with a lower nonce exists on the blockchain but I couldn´t understand  how an invalid transaction got into the blockchain. After all, even reverted txs are valid txs.\r\n\r\n2- There is a bug on besu code that is misaligning the nonce cache and the actual blockchain data/world state. Somehow the nonce cache gets higher than it should and txs with the correct nonces are considered invalid (nonce already used)\r\n2a- If the above is correct, I do not see how the inversion of steps 4 and 5 of the normal flow could create a misalignment of the nonce cache. Block 2 may be created on step 4a, but it should never be imported because it contains a replayed tx.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1802514509/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1803404195",
    "html_url": "https://github.com/hyperledger/besu/issues/6058#issuecomment-1803404195",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/6058",
    "id": 1803404195,
    "node_id": "IC_kwDODE2jmc5rfcOj",
    "user": {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-09T08:56:29Z",
    "updated_at": "2023-11-09T08:56:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "@rsarres \r\n1. no the LOWER_NONCE_INVALID_TRANSACTION_EXISTS  means that a tx with lower nonce was considered invalid, for any reason, not only nonce to low. So the sequence of the events is like that:\r\n   - tx1 with nonce 1 is invalid, could be any error including NONCE_TOO_LOW, and it is added to the invalid cache\r\n   - tx2 with nonce 2 arrived, but since tx1 is present in the invalid cache it is refused with LOWER_NONCE_INVALID_TRANSACTION_EXISTS  \r\n   \r\n   \r\n2. I elaborated the point 4a, as below, since it was not clear:\r\n> 4a. Block2 creation starts with Tx1 and Tx2 in the txpool (Tx1 is invalid since already present in the state) and flagged with NONCE_TOO_LOW and inserted in the invalid nonce cache, and by consequence also Tx2 is removed since it has an invalid tx with a lower nonce. Block2 is then created with no tx from that sender\r\n\r\nSaid that, I reckon that the invalid nonce cache, was a quick workaround, specifically crafted for public networks, to avoiding that the txpool was polluted with spam txs, while we were developing the layered txpool, that is built to solve this issue at the core. \r\nNow that for public networks we have the layered txpool, and this invalid nonce cache is creating many problems in private networks, I think that it is the right time to get rid of this workaround, and remove the invalid nonce cache and I will propose a PR for that.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1803404195/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
