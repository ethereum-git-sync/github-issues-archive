{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/2454",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/2454/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/2454/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/2454/events",
  "html_url": "https://github.com/hyperledger/besu/issues/2454",
  "id": 926098592,
  "node_id": "MDU6SXNzdWU5MjYwOTg1OTI=",
  "number": 2454,
  "title": "Unexpected behaviour when using \"strict\":false when making a call to a smart contract",
  "user": {
    "login": "rynobey",
    "id": 2112544,
    "node_id": "MDQ6VXNlcjIxMTI1NDQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2112544?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rynobey",
    "html_url": "https://github.com/rynobey",
    "followers_url": "https://api.github.com/users/rynobey/followers",
    "following_url": "https://api.github.com/users/rynobey/following{/other_user}",
    "gists_url": "https://api.github.com/users/rynobey/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rynobey/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rynobey/subscriptions",
    "organizations_url": "https://api.github.com/users/rynobey/orgs",
    "repos_url": "https://api.github.com/users/rynobey/repos",
    "events_url": "https://api.github.com/users/rynobey/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rynobey/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 1537362500,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNTAw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "7057ff",
      "default": true,
      "description": "Good for newcomers"
    },
    {
      "id": 2051684044,
      "node_id": "MDU6TGFiZWwyMDUxNjg0MDQ0",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/P4",
      "name": "P4",
      "color": "ccff33",
      "default": false,
      "description": "Low (ex: Node doesn't start up when the configuration file has unexpected \"end-of-line\" character)"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "fab-10",
    "id": 91944855,
    "node_id": "U_kgDOBXr3lw",
    "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fab-10",
    "html_url": "https://github.com/fab-10",
    "followers_url": "https://api.github.com/users/fab-10/followers",
    "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
    "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
    "organizations_url": "https://api.github.com/users/fab-10/orgs",
    "repos_url": "https://api.github.com/users/fab-10/repos",
    "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fab-10/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-06-21T11:04:06Z",
  "updated_at": "2021-10-19T14:36:04Z",
  "closed_at": "2021-10-19T14:36:04Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nDifferent results are obtained when using \"strict\":false vs \"strict\":true as rpc call parameter when reading the ether balance of msg.sender inside a view function of a contract: With \"strict\":false, the balance is always equal to `115792089237316195423570985008687907853269984665640564039457584007913129639935`, regardless of the actual balance of msg.sender, whereas with \"strict\":true the correct result is returned.\r\n\r\nI suspect this is related to https://github.com/hyperledger/besu/pull/1834, where it appears that the ether balance of msg.sender is modified on calls/estimations when using \"strict\":false. \r\n\r\nAdditionally, if this is the case, and the msg.sender balance is modified also for gas estimations, the estimation for any function that has different logical flows depending on msg.sender's balance might be inaccurate. \r\n\r\nI have only been able to reproduce this behaviour on versions >= 21.1.0-RC1.\r\n\r\n### Steps to Reproduce (Bug)\r\n1. Start a single-node network using besu (we are using IBFT2 consensus)\r\n2. Deploy a smart contract with a view function that returns `msg.sender.balance`\r\n3. Call the function that returns the balance using \"strict\":false as parameter in the rpc call, and log the output\r\n\r\n**Expected behavior:** To see the actual balance of msg.sender\r\n\r\n**Actual behavior:** The value `115792089237316195423570985008687907853269984665640564039457584007913129639935` is returned\r\n\r\n**Frequency:** 100%\r\n\r\n### Versions (Add all that apply)\r\n* Software version: >= 21.1.0-RC1\r\n\r\n### Additional Information\r\n\r\n",
  "closed_by": {
    "login": "matkt",
    "id": 26581503,
    "node_id": "MDQ6VXNlcjI2NTgxNTAz",
    "avatar_url": "https://avatars.githubusercontent.com/u/26581503?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/matkt",
    "html_url": "https://github.com/matkt",
    "followers_url": "https://api.github.com/users/matkt/followers",
    "following_url": "https://api.github.com/users/matkt/following{/other_user}",
    "gists_url": "https://api.github.com/users/matkt/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/matkt/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/matkt/subscriptions",
    "organizations_url": "https://api.github.com/users/matkt/orgs",
    "repos_url": "https://api.github.com/users/matkt/repos",
    "events_url": "https://api.github.com/users/matkt/events{/privacy}",
    "received_events_url": "https://api.github.com/users/matkt/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/2454/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/2454/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/865334555",
    "html_url": "https://github.com/hyperledger/besu/issues/2454#issuecomment-865334555",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2454",
    "id": 865334555,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NTMzNDU1NQ==",
    "user": {
      "login": "vmichalik",
      "id": 12459761,
      "node_id": "MDQ6VXNlcjEyNDU5NzYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12459761?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vmichalik",
      "html_url": "https://github.com/vmichalik",
      "followers_url": "https://api.github.com/users/vmichalik/followers",
      "following_url": "https://api.github.com/users/vmichalik/following{/other_user}",
      "gists_url": "https://api.github.com/users/vmichalik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vmichalik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vmichalik/subscriptions",
      "organizations_url": "https://api.github.com/users/vmichalik/orgs",
      "repos_url": "https://api.github.com/users/vmichalik/repos",
      "events_url": "https://api.github.com/users/vmichalik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vmichalik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-21T20:49:39Z",
    "updated_at": "2021-06-21T20:49:39Z",
    "author_association": "NONE",
    "body": "Thanks for flagging @rynobey, looking into this",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/865334555/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
