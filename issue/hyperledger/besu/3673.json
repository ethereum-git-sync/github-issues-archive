{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/3673",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/3673/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/3673/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/3673/events",
  "html_url": "https://github.com/hyperledger/besu/issues/3673",
  "id": 1189484900,
  "node_id": "I_kwDODE2jmc5G5hlk",
  "number": 3673,
  "title": "Peer list is not consistent tested with small network",
  "user": {
    "login": "helderjnpinto",
    "id": 12281088,
    "node_id": "MDQ6VXNlcjEyMjgxMDg4",
    "avatar_url": "https://avatars.githubusercontent.com/u/12281088?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/helderjnpinto",
    "html_url": "https://github.com/helderjnpinto",
    "followers_url": "https://api.github.com/users/helderjnpinto/followers",
    "following_url": "https://api.github.com/users/helderjnpinto/following{/other_user}",
    "gists_url": "https://api.github.com/users/helderjnpinto/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/helderjnpinto/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/helderjnpinto/subscriptions",
    "organizations_url": "https://api.github.com/users/helderjnpinto/orgs",
    "repos_url": "https://api.github.com/users/helderjnpinto/repos",
    "events_url": "https://api.github.com/users/helderjnpinto/events{/privacy}",
    "received_events_url": "https://api.github.com/users/helderjnpinto/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2152224197,
      "node_id": "MDU6TGFiZWwyMTUyMjI0MTk3",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamRevenant",
      "name": "TeamRevenant",
      "color": "78e298",
      "default": false,
      "description": "GH issues worked on by Revenant Team"
    },
    {
      "id": 3805591260,
      "node_id": "LA_kwDODE2jmc7i1Lbc",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/peering",
      "name": "peering",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-04-01T09:03:50Z",
  "updated_at": "2022-04-28T02:32:59Z",
  "closed_at": "2022-04-28T02:32:58Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nAs a blockchain client validador or not i want a list of a peers of my network not in duplicated and more consistent.\r\n\r\n### Acceptance Criteria\r\n- In small network (we talk about 4 validators) only of validators should by a consistent count between all peers\r\n- Not have duplicated nodes (like filter by enode public key and ip)\r\n\r\n\r\n### Steps to Reproduce (Bug)\r\n- I made a setup local with multiple clients using docker-compose below i will put my findings.\r\n\r\nIn the following tests i made with same group of validators that is composed by: \r\n1 bootnode + validator IBFT 2.0\r\n3 validators IBFT 2.0\r\n\r\n#### Test 1 - Testing only a small group of validators\r\n\r\n![Peers-testing-besu drawio (4 valid)](https://user-images.githubusercontent.com/12281088/161228489-45edcc09-b76e-46bf-b4d3-f5edb5d3d5af.png)\r\n\r\n![e5a63673898f226ce8f5a56de2fc2293](https://user-images.githubusercontent.com/12281088/161228686-3b42de9a-38b0-492e-9c82-c030a8a69c4a.png)\r\n\r\nThis result some times give the same amount of peers should be 4 on each of them that i think it is correct i suppose.\r\nworking dockers more than 30 min.\r\n\r\n\r\n#### Test 2 - Testing only a small group of validators + clients\r\n\r\n![f4c4304b0b834365b0a84c12a1833771](https://user-images.githubusercontent.com/12281088/161229910-f532cd6b-86d3-4800-afa4-1f887c8d950d.png)\r\n\r\n![6fc776bcc1fa4c27baafb65e333cc532](https://user-images.githubusercontent.com/12281088/161230007-ded0bf00-5cfe-44cd-85a2-444826b0b059.png)\r\n\r\nSome result as test 1 the peers count never is equal working time > 1h.\r\n\r\n#### Test 3 - Testing validators + clients with other parameters\r\n![5832ed7b68d74e8eadc89c3e0dc0cd77](https://user-images.githubusercontent.com/12281088/161230506-1ac56cc2-fab0-4e77-860d-8fc2d0c02446.png)\r\n\r\n![195f4023bda3419893c3a5de7ffb4ea7](https://user-images.githubusercontent.com/12281088/161230870-32afafb8-698f-41cf-89bc-36aa29cc14f1.png)\r\n\r\nsome of the peers have duplicated peer enode but network property have different ports (at first time i thought maybe is a docker-compose thing) but when i checked my aws network i also have duplicate enodes and this exists in different pods.\r\n\r\n![c8b3e24761a94493a29dedb21f0d66cd](https://user-images.githubusercontent.com/12281088/161231186-6ab25674-c5d3-44f3-9d18-a9397ef76ca8.png)\r\n\r\n\r\n### Additional Information (Add any of the following or anything else that may be relevant)\r\n\r\n* Besu version is 21 (this bug is present in older versions) I tested this to try solve the other issue  #2011 \r\n* Linux l480 5.13.0-39-generic 20.04.1-Ubuntu SMP Thu Mar 24 16:43:35 UTC 2022 x86_64 x86_64 x86_64 GNU/Linux\r\n - i5, 16 GB RAM.\r\n",
  "closed_by": {
    "login": "macfarla",
    "id": 2627919,
    "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/macfarla",
    "html_url": "https://github.com/macfarla",
    "followers_url": "https://api.github.com/users/macfarla/followers",
    "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
    "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
    "organizations_url": "https://api.github.com/users/macfarla/orgs",
    "repos_url": "https://api.github.com/users/macfarla/repos",
    "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
    "received_events_url": "https://api.github.com/users/macfarla/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/3673/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/3673/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1087023993",
    "html_url": "https://github.com/hyperledger/besu/issues/3673#issuecomment-1087023993",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3673",
    "id": 1087023993,
    "node_id": "IC_kwDODE2jmc5Ayqt5",
    "user": {
      "login": "frankisawesome",
      "id": 39414003,
      "node_id": "MDQ6VXNlcjM5NDE0MDAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39414003?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/frankisawesome",
      "html_url": "https://github.com/frankisawesome",
      "followers_url": "https://api.github.com/users/frankisawesome/followers",
      "following_url": "https://api.github.com/users/frankisawesome/following{/other_user}",
      "gists_url": "https://api.github.com/users/frankisawesome/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/frankisawesome/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/frankisawesome/subscriptions",
      "organizations_url": "https://api.github.com/users/frankisawesome/orgs",
      "repos_url": "https://api.github.com/users/frankisawesome/repos",
      "events_url": "https://api.github.com/users/frankisawesome/events{/privacy}",
      "received_events_url": "https://api.github.com/users/frankisawesome/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-04T01:39:17Z",
    "updated_at": "2022-04-04T01:39:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for the detailed report - this is a known issue that's currently in our backlog, we had a draft PR up but other priorities came up so it's pending further work, we'll use this issue and report back once progress is made.\r\n\r\nFeel free to look at the draft pr in the meantime https://github.com/hyperledger/besu/pull/3383",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1087023993/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1111675874",
    "html_url": "https://github.com/hyperledger/besu/issues/3673#issuecomment-1111675874",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3673",
    "id": 1111675874,
    "node_id": "IC_kwDODE2jmc5CQtPi",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-28T02:32:58Z",
    "updated_at": "2022-04-28T02:32:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "For clarity @helderjnpinto we are closing this issue as a duplicate - this will be addressed as part of the work for https://github.com/hyperledger/besu/issues/2689\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1111675874/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
