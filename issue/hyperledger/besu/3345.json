{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/3345",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/3345/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/3345/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/3345/events",
  "html_url": "https://github.com/hyperledger/besu/issues/3345",
  "id": 1117665950,
  "node_id": "I_kwDODE2jmc5Cnjqe",
  "number": 3345,
  "title": "A contract which works on Rinkeby but not on Besu",
  "user": {
    "login": "soragXYZ",
    "id": 67227269,
    "node_id": "MDQ6VXNlcjY3MjI3MjY5",
    "avatar_url": "https://avatars.githubusercontent.com/u/67227269?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/soragXYZ",
    "html_url": "https://github.com/soragXYZ",
    "followers_url": "https://api.github.com/users/soragXYZ/followers",
    "following_url": "https://api.github.com/users/soragXYZ/following{/other_user}",
    "gists_url": "https://api.github.com/users/soragXYZ/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/soragXYZ/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/soragXYZ/subscriptions",
    "organizations_url": "https://api.github.com/users/soragXYZ/orgs",
    "repos_url": "https://api.github.com/users/soragXYZ/repos",
    "events_url": "https://api.github.com/users/soragXYZ/events{/privacy}",
    "received_events_url": "https://api.github.com/users/soragXYZ/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "macfarla",
    "id": 2627919,
    "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/macfarla",
    "html_url": "https://github.com/macfarla",
    "followers_url": "https://api.github.com/users/macfarla/followers",
    "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
    "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
    "organizations_url": "https://api.github.com/users/macfarla/orgs",
    "repos_url": "https://api.github.com/users/macfarla/repos",
    "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
    "received_events_url": "https://api.github.com/users/macfarla/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-01-28T17:36:05Z",
  "updated_at": "2022-02-04T09:30:20Z",
  "closed_at": "2022-02-04T09:30:19Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi everyone! I'm having a very weird behavior, I hope someone can help me\r\n\r\nI deployed a simple smart contract for token vesting\r\nThis contract is working perfectly fine on Rinkeby and other test networks as you can see [here](https://rinkeby.etherscan.io/address/0x742e33F354Ef982385785280e16d53056bb75C36#code) \r\n\r\nI'm able to deploy the same contract on my private network as you can see [here](http://20.101.172.72/address/0x9d1008C11C17C00132aB18Ce0F9F3D695b0D4c15/contracts), but when trying to interact with the contract, each transaction get reverted without more information...\r\nMoreover, it seems like the transaction consume every gas in the block, even if I have a crazy block gas limit of more than 10B... See [here](http://20.101.172.72/tx/0x88ae9ae364e93c03b11f88151b3fd66e4f0dc2e74536ce98b1b9cebd63d81a2d/internal-transactions) \r\n\r\nAnd I can't even send ethers to this contract, the transaction gets reverted too as you can see [here](http://20.101.172.72/tx/0x4bd24574ef93a55da08b77a7cfe22f4a7b8559647d62a2cf7f1e4d954dc27480/internal-transactions)\r\n\r\nI have absolutely no idea about what is going on, and why this contract can't even receive some ethers\r\n\r\n\r\n\r\nThe contract was deployed using hardhat, Solidity v0.8.4\r\nHere is my genesis.json, maybe my mistake is here:\r\n\r\n```\r\n\r\nrawGenesisConfig:\r\n  genesis:\r\n    config:\r\n      homestead: 0\r\n      eip150: 0\r\n      eip155: 0\r\n      eip158: 0\r\n      byzantium: 0\r\n      constantinople: 0\r\n      petersburg: 0\r\n      istanbul: 0\r\n      muirglacier: 0\r\n      berlin: 0\r\n      london: 0\r\n      arrowGlacier: 0\r\n      chainId: 1337\r\n      constantinoplefixblock: 0\r\n      ibft2:\r\n        blockperiodseconds: 10\r\n        epochlength: 30000\r\n        requesttimeoutseconds: 20\r\n    nonce: '0x0'\r\n    timestamp: '0x58ee40ba'\r\n    gasLimit: '0x1fffffffffffff'\r\n    difficulty: '0x1'\r\n    mixHash: '0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365'\r\n    coinbase: '0x0000000000000000000000000000000000000000'\r\n    alloc:\r\n      627306090abaB3A6e1400e9345bC60c78a8BEf57:\r\n        balance: '0x446c3b15f9926687d2c40534fdb564000000000000'\r\n      f17f52151EbEF6C7334FAD080c5704D77216b732:\r\n        balance: '0x446c3b15f9926687d2c40534fdb564000000000000'\r\n      fe3b557e8fb62b89f4916b721be55ceb828dbd73:\r\n        balance: '0x446c3b15f9926687d2c40534fdb564000000000000'\r\n      f90acf91bdab539aac3093e5c5b207b562354401:\r\n        balance: '0x446c3b15f9926687d2c40534fdb564000000000000'\r\n  blockchain:\r\n    nodes:\r\n      generate: true\r\n      count: 4\r\n\r\n```",
  "closed_by": {
    "login": "soragXYZ",
    "id": 67227269,
    "node_id": "MDQ6VXNlcjY3MjI3MjY5",
    "avatar_url": "https://avatars.githubusercontent.com/u/67227269?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/soragXYZ",
    "html_url": "https://github.com/soragXYZ",
    "followers_url": "https://api.github.com/users/soragXYZ/followers",
    "following_url": "https://api.github.com/users/soragXYZ/following{/other_user}",
    "gists_url": "https://api.github.com/users/soragXYZ/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/soragXYZ/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/soragXYZ/subscriptions",
    "organizations_url": "https://api.github.com/users/soragXYZ/orgs",
    "repos_url": "https://api.github.com/users/soragXYZ/repos",
    "events_url": "https://api.github.com/users/soragXYZ/events{/privacy}",
    "received_events_url": "https://api.github.com/users/soragXYZ/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/3345/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/3345/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1029600391",
    "html_url": "https://github.com/hyperledger/besu/issues/3345#issuecomment-1029600391",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3345",
    "id": 1029600391,
    "node_id": "IC_kwDODE2jmc49XnSH",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-04T03:18:28Z",
    "updated_at": "2022-02-04T03:18:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "ðŸ‘‹  @soragXYZ thanks for your report, we will have to look into this to see if we can replicate it. To help us, can you provide some extra info:\r\n\r\nBesu config options\r\n* Besu config file or CLI options\r\n### Versions (Add all that apply)\r\n* Software version: [`besu --version`]\r\n* Java version: [`java -version`]\r\n* OS Name & Version: [`cat /etc/*release`]\r\n* Kernel Version: [`uname -a`]\r\n* Virtual Machine software & version: [`vmware -v`]\r\n* Docker Version: [`docker version`]\r\n* Cloud VM, type, size: [Amazon Web Services I3-large]\r\n\r\nAlso we can't access your internal server links eg `http://20.101.172.72/tx/0x88ae9ae364e93c03b11f88151b3fd66e4f0dc2e74536ce98b1b9cebd63d81a2d/internal-transactions` so if there's anything there that's helpful can you copy/paste or provide screenshots?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1029600391/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1029800038",
    "html_url": "https://github.com/hyperledger/besu/issues/3345#issuecomment-1029800038",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3345",
    "id": 1029800038,
    "node_id": "IC_kwDODE2jmc49YYBm",
    "user": {
      "login": "soragXYZ",
      "id": 67227269,
      "node_id": "MDQ6VXNlcjY3MjI3MjY5",
      "avatar_url": "https://avatars.githubusercontent.com/u/67227269?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/soragXYZ",
      "html_url": "https://github.com/soragXYZ",
      "followers_url": "https://api.github.com/users/soragXYZ/followers",
      "following_url": "https://api.github.com/users/soragXYZ/following{/other_user}",
      "gists_url": "https://api.github.com/users/soragXYZ/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/soragXYZ/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/soragXYZ/subscriptions",
      "organizations_url": "https://api.github.com/users/soragXYZ/orgs",
      "repos_url": "https://api.github.com/users/soragXYZ/repos",
      "events_url": "https://api.github.com/users/soragXYZ/events{/privacy}",
      "received_events_url": "https://api.github.com/users/soragXYZ/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-04T09:30:19Z",
    "updated_at": "2022-02-04T09:30:19Z",
    "author_association": "NONE",
    "body": "Hi @macfarla !\r\n\r\nSorry for the broken links, I have changed my config\r\n\r\nI found the issue, the problem was that the contract used balance(address.this) and the OPCODE associated with it was not supported with my current EVM config\r\n\r\nUpdating it in the genesis.json file and setting the EVM version to Berlin solved this issue\r\nI think that compiling with an older solidity version would have worked too",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1029800038/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  }
]
