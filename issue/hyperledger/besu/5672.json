{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/5672",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/5672/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/5672/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/5672/events",
  "html_url": "https://github.com/hyperledger/besu/issues/5672",
  "id": 1789068112,
  "node_id": "I_kwDODE2jmc5qowNQ",
  "number": 5672,
  "title": " Without the --net host option, Docker Besu cannot find peers",
  "user": {
    "login": "hardice501",
    "id": 54879931,
    "node_id": "MDQ6VXNlcjU0ODc5OTMx",
    "avatar_url": "https://avatars.githubusercontent.com/u/54879931?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hardice501",
    "html_url": "https://github.com/hardice501",
    "followers_url": "https://api.github.com/users/hardice501/followers",
    "following_url": "https://api.github.com/users/hardice501/following{/other_user}",
    "gists_url": "https://api.github.com/users/hardice501/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hardice501/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hardice501/subscriptions",
    "organizations_url": "https://api.github.com/users/hardice501/orgs",
    "repos_url": "https://api.github.com/users/hardice501/repos",
    "events_url": "https://api.github.com/users/hardice501/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hardice501/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-07-05T08:39:14Z",
  "updated_at": "2023-07-13T05:16:10Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!-- Have you done the following? -->\r\n<!--   * read the Code of Conduct? By filing an Issue, you are expected to -->  \r\n<!--     comply with it, including treating everyone with respect: -->\r\n<!--     https://github.com/hyperledger/besu/blob/main/CODE_OF_CONDUCT.md -->\r\n<!--   * Reproduced the issue in the latest version of the software -->\r\n<!--   * Read the debugging docs: https://besu.hyperledger.org/en/stable/HowTo/Monitor/Logging/ -->\r\n<!--   * Duplicate Issue check:  https://github.com/search?q=+is%3Aissue+repo%3Ahyperledger/Besu -->\r\n<!-- Note:  Not all sections will apply to all issue types. -->\r\n\r\n### Description\r\nWe are Test Besu 21.10.9 Docker, IBFT2 consensus protocol, on a private network, gas price free with 4 validators.\r\n\r\n4 Validators on 1 machine is no problem. \r\n\r\nBut build docker on each of 4 computers with different ip, bootnode cannot found each peers.\r\n\r\n\r\n\r\n### Acceptance Criteria\r\n\r\n### Steps to Reproduce (Bug)\r\n1. By ibftConfigFile.json, make genesis file and key file in first Computer\r\n2. 1 Validator(also bootnode) setup to first Computer without --net host option, \r\n3. Copy and paste the Genesis file and key file to the second computer\r\n4. Run second Computer's Docker without --net host option\r\n5. ping test in docker container\r\n\r\n**Expected behavior:** [What you expect to happen]\r\nSuccessfully connected peers\r\nSuccessfully Ping test\r\n**Actual behavior:** [What actually happens]\r\nNo connection between peers.\r\nSuccessfully Ping test\r\n**Frequency:** [What percentage of the time does it occur?]\r\nAlways except when adding the --net host option\r\nPing test always succeeds even without --net host option\r\n### Logs (if a bug)\r\nPlease post relevant logs from Besu (and the consensus client, if running proof of stake) from before and after the issue. \r\nFullSyncTargetManager | No sync target, waiting for peers: 0\r\n\r\n### Versions (Add all that apply)\r\n* Software version: 21.10.9(Docker image)\r\n* Java version: just used Docker\r\n* OS Name & Version:\r\nISTRIB_ID=Ubuntu\r\nDISTRIB_RELEASE=22.04\r\nDISTRIB_CODENAME=jammy\r\nDISTRIB_DESCRIPTION=\"Ubuntu 22.04.2 LTS\"\r\nPRETTY_NAME=\"Ubuntu 22.04.2 LTS\"\r\nNAME=\"Ubuntu\"\r\nVERSION_ID=\"22.04\"\r\nVERSION=\"22.04.2 LTS (Jammy Jellyfish)\"\r\nVERSION_CODENAME=jammy\r\nID=ubuntu\r\nID_LIKE=debian\r\nHOME_URL=\"https://www.ubuntu.com/\"\r\nSUPPORT_URL=\"https://help.ubuntu.com/\"\r\nBUG_REPORT_URL=\"https://bugs.launchpad.net/ubuntu/\"\r\nPRIVACY_POLICY_URL=\"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy\"\r\n* Kernel Version: Linux besu-try-testnet-node-1 5.4.0-139-generic #156-Ubuntu SMP Fri Jan 20 17:27:18 UTC 2023 x86_64 x86_64 x86_64 GNU/Linux\r\n* Virtual Machine software & version: [`vmware -v`]\r\n* Docker Version:\r\nClient: Docker Engine - Community\r\n Version:           24.0.2\r\n API version:       1.43\r\n Go version:        go1.20.4\r\n Git commit:        cb74dfc\r\n Built:             Thu May 25 21:51:00 2023\r\n OS/Arch:           linux/amd64\r\n Context:           default\r\n\r\n\r\n### Additional Information (Add any of the following or anything else that may be relevant)\r\n* Besu setup info\r\ngenesis file:\r\n```\r\n{\r\n  \"config\" : {\r\n    \"chainId\" : 1337,\r\n    \"berlinBlock\" : 0,\r\n    \"ibft2\" : {\r\n      \"blockperiodseconds\" : 2,\r\n      \"epochlength\" : 30000,\r\n      \"requesttimeoutseconds\" : 4\r\n    },\r\n    \"contractSizeLimit\" : 2147483647\r\n  },\r\n  \"nonce\" : \"0x0\",\r\n  \"timestamp\" : \"0x58ee40ba\",\r\n  \"gasLimit\" : \"0x1fffffffffffff\",\r\n  \"difficulty\" : \"0x1\",\r\n  \"mixHash\" : \"0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365\",\r\n  \"coinbase\" : \"0x0000000000000000000000000000000000000000\",\r\n  \"alloc\" : {\r\n    \"fe3b557e8fb62b89f4916b721be55ceb828dbd73\" : {\r\n      \"privateKey\" : \"8f2a55949038a9610f50fb23b5883af3b4ecb3c3bb792cbcefbd1542c692be63\",\r\n      \"comment\" : \"private key and this comment are ignored.  In a real chain, the private key should NOT be stored\",\r\n      \"balance\" : \"0xad78ebc5ac6200000\"\r\n    },\r\n    \"627306090abaB3A6e1400e9345bC60c78a8BEf57\" : {\r\n      \"privateKey\" : \"c87509a1c067bbde78beb793e6fa76530b6382a4c0241e5e4a9ec0a0f44dc0d3\",\r\n      \"comment\" : \"private key and this comment are ignored.  In a real chain, the private key should NOT be stored\",\r\n      \"balance\" : \"90000000000000000000000\"\r\n    },\r\n    \"f17f52151EbEF6C7334FAD080c5704D77216b732\" : {\r\n      \"privateKey\" : \"ae6ae8e5ccbfb04590405997ee2d52d2b330726137b875053c36d94e974d162f\",\r\n      \"comment\" : \"private key and this comment are ignored.  In a real chain, the private key should NOT be stored\",\r\n      \"balance\" : \"90000000000000000000000\"\r\n    }\r\n  },\r\n  \"extraData\" : \"0xf87ea00000000000000000000000000000000000000000000000000000000000000000f854945ad06e82e508711d9b64632a6702edf60dbb840f94fe605c77ab9f2ba80c102e2ee734a803df6c7da994269f2e8e1924be1f27744f56094ad8c9d6884ef29493d19121054b420c566b87a8ce92fcb19fd20528808400000000c0\"\r\n```\r\nconfig option (if not boot_node, include option --bootnodes=${BOOT_NODE_ENODE}):\r\n```\r\ndocker create --name boot_node -p 8545:8545 -p 8546:8546 -p 30303:30303 hyperledger/besu:21.10.9  --genesis-file=/genesis.json --rpc-http-enabled --rpc-http-api=ETH,NET,IBFT --rpc-http-cors-origins=\"all\" --rpc-http-host=0.0.0.0 --rpc-ws-enabled --rpc-ws-host=0.0.0.0 --rpc-ws-apis=ADMIN,ETH,MINER,WEB3,NET,PRIV,EEA --host-allowlist=\"*\" --min-gas-price=0\r\ndocker cp genesis.json boot_node:/genesis.json\r\ndocker cp Node-1/data/key boot_node:/opt/besu/key\r\ndocker start boot node\r\n```\r\n* System info - memory, CPU\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/5672/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/5672/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1628370668",
    "html_url": "https://github.com/hyperledger/besu/issues/5672#issuecomment-1628370668",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5672",
    "id": 1628370668,
    "node_id": "IC_kwDODE2jmc5hDvbs",
    "user": {
      "login": "hardice501",
      "id": 54879931,
      "node_id": "MDQ6VXNlcjU0ODc5OTMx",
      "avatar_url": "https://avatars.githubusercontent.com/u/54879931?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hardice501",
      "html_url": "https://github.com/hardice501",
      "followers_url": "https://api.github.com/users/hardice501/followers",
      "following_url": "https://api.github.com/users/hardice501/following{/other_user}",
      "gists_url": "https://api.github.com/users/hardice501/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hardice501/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hardice501/subscriptions",
      "organizations_url": "https://api.github.com/users/hardice501/orgs",
      "repos_url": "https://api.github.com/users/hardice501/repos",
      "events_url": "https://api.github.com/users/hardice501/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hardice501/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-10T07:11:18Z",
    "updated_at": "2023-07-13T05:16:10Z",
    "author_association": "NONE",
    "body": "update issue\r\nin my cases, add option -p 30303:30303/udp is working at linux.\r\n\r\nbut in mac(m1), must need to build a virtual environment to run the docker cli.\r\n - paid license(docker desktop, OrbStack) is working at M1\r\n\r\n\r\n// the other are free license\r\n - using program based on lima (lima, colima, rancher desktop): udp port is not enable\r\n - using podman: p2p connection is possible only with boot_node.\r\n(If not specify MAC address, podman does not send the host's ip, but the url for the virtualized ip.)\r\n\r\nin boot_node\r\n```bash\r\n> admin.peers\r\n{\r\n  firstEnode: {\r\n     localhost: [virtual ip]:30303,\r\n     remotehost: [virtual ip]:{random port},\r\n },\r\n secondEnode:{\r\n   localhost: [virtual ip]:30303,\r\n   remotehost: [virtual ip]:{random port},\r\n }\r\n}\r\n```\r\nso each peers(ex: first and second p2p connection) cannot connect.\r\n\r\n\r\n - using multipass + docker-cli: can find peer(but must be assigned two physical IPs.)",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1628370668/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1629803339",
    "html_url": "https://github.com/hyperledger/besu/issues/5672#issuecomment-1629803339",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5672",
    "id": 1629803339,
    "node_id": "IC_kwDODE2jmc5hJNNL",
    "user": {
      "login": "non-fungible-nelson",
      "id": 85905982,
      "node_id": "MDQ6VXNlcjg1OTA1OTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/non-fungible-nelson",
      "html_url": "https://github.com/non-fungible-nelson",
      "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
      "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
      "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
      "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
      "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
      "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-10T22:15:26Z",
    "updated_at": "2023-07-10T22:15:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for the update - Docker on Mac has some limitations with Localhost, recommend testing/dev with --net. \r\n\r\nDefinitely also recommend updating to the latest version and trying as well. 23.4.4\r\nNot sure if this version of Besu (21.10.9) did not have specific M1 support in Besu. A newer version might play nicer with Docker. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1629803339/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1629909696",
    "html_url": "https://github.com/hyperledger/besu/issues/5672#issuecomment-1629909696",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5672",
    "id": 1629909696,
    "node_id": "IC_kwDODE2jmc5hJnLA",
    "user": {
      "login": "hardice501",
      "id": 54879931,
      "node_id": "MDQ6VXNlcjU0ODc5OTMx",
      "avatar_url": "https://avatars.githubusercontent.com/u/54879931?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hardice501",
      "html_url": "https://github.com/hardice501",
      "followers_url": "https://api.github.com/users/hardice501/followers",
      "following_url": "https://api.github.com/users/hardice501/following{/other_user}",
      "gists_url": "https://api.github.com/users/hardice501/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hardice501/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hardice501/subscriptions",
      "organizations_url": "https://api.github.com/users/hardice501/orgs",
      "repos_url": "https://api.github.com/users/hardice501/repos",
      "events_url": "https://api.github.com/users/hardice501/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hardice501/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-11T00:19:59Z",
    "updated_at": "2023-07-11T00:19:59Z",
    "author_association": "NONE",
    "body": "> Thanks for the update - Docker on Mac has some limitations with Localhost, recommend testing/dev with --net.\r\n> \r\n> Definitely also recommend updating to the latest version and trying as well. 23.4.4 Not sure if this version of Besu (21.10.9) did not have specific M1 support in Besu. A newer version might play nicer with Docker.\r\n\r\nThanks for the reply.\r\nA nonce error always occurred when performing a load test on besu version 21.10.9 later. Do you know anything about this?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1629909696/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1630835889",
    "html_url": "https://github.com/hyperledger/besu/issues/5672#issuecomment-1630835889",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5672",
    "id": 1630835889,
    "node_id": "IC_kwDODE2jmc5hNJSx",
    "user": {
      "login": "non-fungible-nelson",
      "id": 85905982,
      "node_id": "MDQ6VXNlcjg1OTA1OTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/non-fungible-nelson",
      "html_url": "https://github.com/non-fungible-nelson",
      "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
      "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
      "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
      "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
      "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
      "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-11T13:28:29Z",
    "updated_at": "2023-07-11T13:28:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "We have tweaked nonce behaviors a lot to prevent Denial of Service attacks on Mainnet. Newer versions of Besu should have fixes for this and we even have a new transaction pool type that can handle \"future nonce\" transactions. \r\n\r\nThis flag has more details: https://besu.hyperledger.org/stable/public-networks/reference/cli/options#tx-pool-limit-by-account-percentage",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1630835889/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1633540989",
    "html_url": "https://github.com/hyperledger/besu/issues/5672#issuecomment-1633540989",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5672",
    "id": 1633540989,
    "node_id": "IC_kwDODE2jmc5hXdt9",
    "user": {
      "login": "hardice501",
      "id": 54879931,
      "node_id": "MDQ6VXNlcjU0ODc5OTMx",
      "avatar_url": "https://avatars.githubusercontent.com/u/54879931?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hardice501",
      "html_url": "https://github.com/hardice501",
      "followers_url": "https://api.github.com/users/hardice501/followers",
      "following_url": "https://api.github.com/users/hardice501/following{/other_user}",
      "gists_url": "https://api.github.com/users/hardice501/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hardice501/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hardice501/subscriptions",
      "organizations_url": "https://api.github.com/users/hardice501/orgs",
      "repos_url": "https://api.github.com/users/hardice501/repos",
      "events_url": "https://api.github.com/users/hardice501/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hardice501/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-13T04:50:02Z",
    "updated_at": "2023-07-13T05:10:20Z",
    "author_association": "NONE",
    "body": "> We have tweaked nonce behaviors a lot to prevent Denial of Service attacks on Mainnet. Newer versions of Besu should have fixes for this and we even have a new transaction pool type that can handle \"future nonce\" transactions.\r\n> \r\n> This flag has more details: https://besu.hyperledger.org/stable/public-networks/reference/cli/options#tx-pool-limit-by-account-percentage\r\n\r\nI try that(ex tx-pool-limit-by-account-percentage=0.9)\r\nand try https://github.com/hyperledger/besu/pull/5290 this also.\r\nbut nonce error always occurred.(if sended TPS is 1000).\r\nHow can i solve it?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1633540989/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
