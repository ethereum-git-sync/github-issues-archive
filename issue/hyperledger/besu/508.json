{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/508",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/508/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/508/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/508/events",
  "html_url": "https://github.com/hyperledger/besu/issues/508",
  "id": 583084367,
  "node_id": "MDU6SXNzdWU1ODMwODQzNjc=",
  "number": 508,
  "title": "VertxPeerDiscoveryAgent can stall shutdown",
  "user": {
    "login": "timbeiko",
    "id": 9390255,
    "node_id": "MDQ6VXNlcjkzOTAyNTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9390255?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/timbeiko",
    "html_url": "https://github.com/timbeiko",
    "followers_url": "https://api.github.com/users/timbeiko/followers",
    "following_url": "https://api.github.com/users/timbeiko/following{/other_user}",
    "gists_url": "https://api.github.com/users/timbeiko/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/timbeiko/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/timbeiko/subscriptions",
    "organizations_url": "https://api.github.com/users/timbeiko/orgs",
    "repos_url": "https://api.github.com/users/timbeiko/repos",
    "events_url": "https://api.github.com/users/timbeiko/events{/privacy}",
    "received_events_url": "https://api.github.com/users/timbeiko/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2020-03-17T15:11:02Z",
  "updated_at": "2020-05-19T13:57:02Z",
  "closed_at": "2020-04-02T18:27:06Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "VertxPeerDiscoveryAgent relies on the io.vertx.core.datagram.DatagramSocket#close(Handler<AsyncResult<Void>>>) api.  The code in the handler must be executed for proper shutdown.  However if the underlying socket channel has already been closed then the handler is never called - https://github.com/eclipse-vertx/vert.x/blob/a490f9b20aacf8b09a98cb2db51084214be0138b/src/main/java/io/vertx/core/datagram/impl/DatagramSocketImpl.java#L307 . There is no known way to detect if the socket has already been closed and no feedback that the close call exited early.  The handler is simply ignored.\r\n\r\nThis is causing long shutdown loops for full instances of Besu during unit and integration testing. The underlying issues causing the closure is that we are re-using and restarting multiple instances of the main Vertx object.  Hence the impact is only in unit testing and not at typical client run.\r\n\r\nTo fix this we should consider re-writing vertx out of the peer discovery stack, altering how the VertxPeerDiscoveryAgent shuts down, or using a newer version of vertx where APIs exist to properly shutdown\r\n\r\nProbability: Occasional\r\n\r\nSeverity: Marginal",
  "closed_by": {
    "login": "atoulme",
    "id": 16758,
    "node_id": "MDQ6VXNlcjE2NzU4",
    "avatar_url": "https://avatars.githubusercontent.com/u/16758?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/atoulme",
    "html_url": "https://github.com/atoulme",
    "followers_url": "https://api.github.com/users/atoulme/followers",
    "following_url": "https://api.github.com/users/atoulme/following{/other_user}",
    "gists_url": "https://api.github.com/users/atoulme/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/atoulme/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/atoulme/subscriptions",
    "organizations_url": "https://api.github.com/users/atoulme/orgs",
    "repos_url": "https://api.github.com/users/atoulme/repos",
    "events_url": "https://api.github.com/users/atoulme/events{/privacy}",
    "received_events_url": "https://api.github.com/users/atoulme/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/508/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/508/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
