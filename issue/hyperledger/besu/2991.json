{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/2991",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/2991/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/2991/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/2991/events",
  "html_url": "https://github.com/hyperledger/besu/issues/2991",
  "id": 1043105494,
  "node_id": "I_kwDODE2jmc4-LIbW",
  "number": 2991,
  "title": "IBFT2 to QBFT migration",
  "user": {
    "login": "jframe",
    "id": 909467,
    "node_id": "MDQ6VXNlcjkwOTQ2Nw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/909467?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jframe",
    "html_url": "https://github.com/jframe",
    "followers_url": "https://api.github.com/users/jframe/followers",
    "following_url": "https://api.github.com/users/jframe/following{/other_user}",
    "gists_url": "https://api.github.com/users/jframe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jframe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jframe/subscriptions",
    "organizations_url": "https://api.github.com/users/jframe/orgs",
    "repos_url": "https://api.github.com/users/jframe/repos",
    "events_url": "https://api.github.com/users/jframe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jframe/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1913956965,
      "node_id": "MDU6TGFiZWwxOTEzOTU2OTY1",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/epic",
      "name": "epic",
      "color": "3E4B9E",
      "default": false,
      "description": ""
    },
    {
      "id": 1921587647,
      "node_id": "MDU6TGFiZWwxOTIxNTg3NjQ3",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamGroot",
      "name": "TeamGroot",
      "color": "1d76db",
      "default": false,
      "description": "GH issues worked on by Groot Team"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 11,
  "created_at": "2021-11-03T05:36:23Z",
  "updated_at": "2023-08-21T01:39:00Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "This feature is for migrating between the IBFT2  and the QBFT.\n\nThe migration will use a hard fork approach specifying which blocks each consensus mechanism will start from.\n\nQBFT is the planned long term support BFT consensus algorithm, and weâ€™d like to provide a pathway for existing networks to migrate across\n\n- [x] Create a Switchable BesuControllerBuilder without migration capabilities #2997\n- [x] Unified protocol schedule for migrating consensus mechanism #2998\n- [x] Switchable protocol context for consensus migration #3000\n- [x] Switchable mining co-ordinator #2999\n- [x] IBFT to QBFT integration tests #3315\n- [x] Allow multiple BftExecutors to be created #3004\n- [x] Allow BftMiningCoordinator to be shutdown from same thread #3003\n- [ ] Switchable sub-protocol manager for bft migration #3002\n- [ ] Ibft2 to qbft migration single node AT #3001\n- [ ] QBFT Migration: Use correct BftExtraDataCodec when validating the migration block's parent hash #3469\n- [ ] QBFT migration: protocol context needs the context for block being proposed #3146\n- [ ] Bft RPCs to switch and be enabled for bft migration #3009\n- [ ] Migrating PluginServiceFactory - createAdditionalPluginServices #3148\n- [ ] IBFT2 to QBFT migration ATs #3005\n\n\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/2991/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/2991/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1179713196",
    "html_url": "https://github.com/hyperledger/besu/issues/2991#issuecomment-1179713196",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2991",
    "id": 1179713196,
    "node_id": "IC_kwDODE2jmc5GUP6s",
    "user": {
      "login": "ItayPodhajcer",
      "id": 19306955,
      "node_id": "MDQ6VXNlcjE5MzA2OTU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/19306955?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ItayPodhajcer",
      "html_url": "https://github.com/ItayPodhajcer",
      "followers_url": "https://api.github.com/users/ItayPodhajcer/followers",
      "following_url": "https://api.github.com/users/ItayPodhajcer/following{/other_user}",
      "gists_url": "https://api.github.com/users/ItayPodhajcer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ItayPodhajcer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ItayPodhajcer/subscriptions",
      "organizations_url": "https://api.github.com/users/ItayPodhajcer/orgs",
      "repos_url": "https://api.github.com/users/ItayPodhajcer/repos",
      "events_url": "https://api.github.com/users/ItayPodhajcer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ItayPodhajcer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-10T11:50:13Z",
    "updated_at": "2022-07-10T11:50:13Z",
    "author_association": "NONE",
    "body": "Hi @jframe @lucassaldanha ,\r\nHaven't found any updates on this since November 2021.\r\nIs there anything new on this migration feature?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1179713196/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1184713919",
    "html_url": "https://github.com/hyperledger/besu/issues/2991#issuecomment-1184713919",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2991",
    "id": 1184713919,
    "node_id": "IC_kwDODE2jmc5GnUy_",
    "user": {
      "login": "iamhsk",
      "id": 2249367,
      "node_id": "MDQ6VXNlcjIyNDkzNjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2249367?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iamhsk",
      "html_url": "https://github.com/iamhsk",
      "followers_url": "https://api.github.com/users/iamhsk/followers",
      "following_url": "https://api.github.com/users/iamhsk/following{/other_user}",
      "gists_url": "https://api.github.com/users/iamhsk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iamhsk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iamhsk/subscriptions",
      "organizations_url": "https://api.github.com/users/iamhsk/orgs",
      "repos_url": "https://api.github.com/users/iamhsk/repos",
      "events_url": "https://api.github.com/users/iamhsk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iamhsk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-14T17:26:38Z",
    "updated_at": "2022-07-14T17:26:38Z",
    "author_association": "NONE",
    "body": "Hi @ItayPodhajcer, thank you for your inquiry! Currently the Besu maintainers are not planning on working on this migration feature for the foreseeable future. We welcome any community contribution though ðŸ™‚",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1184713919/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1186478681",
    "html_url": "https://github.com/hyperledger/besu/issues/2991#issuecomment-1186478681",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2991",
    "id": 1186478681,
    "node_id": "IC_kwDODE2jmc5GuDpZ",
    "user": {
      "login": "ItayPodhajcer",
      "id": 19306955,
      "node_id": "MDQ6VXNlcjE5MzA2OTU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/19306955?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ItayPodhajcer",
      "html_url": "https://github.com/ItayPodhajcer",
      "followers_url": "https://api.github.com/users/ItayPodhajcer/followers",
      "following_url": "https://api.github.com/users/ItayPodhajcer/following{/other_user}",
      "gists_url": "https://api.github.com/users/ItayPodhajcer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ItayPodhajcer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ItayPodhajcer/subscriptions",
      "organizations_url": "https://api.github.com/users/ItayPodhajcer/orgs",
      "repos_url": "https://api.github.com/users/ItayPodhajcer/repos",
      "events_url": "https://api.github.com/users/ItayPodhajcer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ItayPodhajcer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-17T10:50:19Z",
    "updated_at": "2022-07-17T10:50:19Z",
    "author_association": "NONE",
    "body": "Hi @iamhsk,\r\n\r\nThis is a very disappointing answer, as IBFT 2.0 was THE way to go with Hyperledger Besu based PoA networks before QBFT reached production grade.\r\nExpecting someone in the community with no prior experience on this codebase, to go into the heart of the consensus mechanism and implement a migration path seems highly unrealistic.\r\n\r\nThis significantly lowers the reliability of this software (and we are running three networks with it, one of them is a production network), as taking the risk that something that's being used now won't be supported in the future, and no migration path to whatever replaced that something isn't provided, isn't something that can be afforded on production workloads.\r\n\r\nWe chose Hyperledger Besu because it seemed like the best option available for a private permissioned network with enterprise capabilities, WE TOOK THE RISK, and now we are pretty much stuck with something that's very hard to upgrade, as upgrade means creating an additional network (with all the members deploying nodes to that new network in addition to the current one) and \"copy\" the data somehow from the existing contracts to the one in the new network.\r\n\r\nThis shouldn't happen with software that's considered ready for production!\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1186478681/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1188583774",
    "html_url": "https://github.com/hyperledger/besu/issues/2991#issuecomment-1188583774",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2991",
    "id": 1188583774,
    "node_id": "IC_kwDODE2jmc5G2Fle",
    "user": {
      "login": "iamhsk",
      "id": 2249367,
      "node_id": "MDQ6VXNlcjIyNDkzNjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2249367?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iamhsk",
      "html_url": "https://github.com/iamhsk",
      "followers_url": "https://api.github.com/users/iamhsk/followers",
      "following_url": "https://api.github.com/users/iamhsk/following{/other_user}",
      "gists_url": "https://api.github.com/users/iamhsk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iamhsk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iamhsk/subscriptions",
      "organizations_url": "https://api.github.com/users/iamhsk/orgs",
      "repos_url": "https://api.github.com/users/iamhsk/repos",
      "events_url": "https://api.github.com/users/iamhsk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iamhsk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-19T04:27:45Z",
    "updated_at": "2022-07-19T04:31:26Z",
    "author_association": "NONE",
    "body": "Hello @ItayPodhajcer,\r\n\r\nThank you for sharing your feedback and I can see how my previous answer might have caused some frustration there with seemly unrealistic expectation. I meant to say that contribution in any way (however small or big) is welcomed not to mean that we are expecting a community member to implement the entire migration. \r\n\r\nIBFT 2.0 is equally production-grade and we have several enterprise customers using it in their production environment. We are only encouraging new users to use QBFT because weâ€™d like to converge on a single PoA consensus protocol and sunset IBFT 2.0 in the future. When we plan on doing that is still to be determined at the moment. However till we make that decision, we are going to support both IBFT 2.0 and QBFT plus before we sunset IBFT 2.0, we will provide a migration path so that the upgrade process is seamless. \r\n\r\nMay I ask you why youâ€™d like to migrate to QBFT? There shouldnâ€™t be much difference between IBFT 2.0 and QBFT in terms of user experience but Iâ€™d like to understand what you are looking for in QBFT. Thank you!",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1188583774/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1188640415",
    "html_url": "https://github.com/hyperledger/besu/issues/2991#issuecomment-1188640415",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2991",
    "id": 1188640415,
    "node_id": "IC_kwDODE2jmc5G2Taf",
    "user": {
      "login": "ItayPodhajcer",
      "id": 19306955,
      "node_id": "MDQ6VXNlcjE5MzA2OTU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/19306955?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ItayPodhajcer",
      "html_url": "https://github.com/ItayPodhajcer",
      "followers_url": "https://api.github.com/users/ItayPodhajcer/followers",
      "following_url": "https://api.github.com/users/ItayPodhajcer/following{/other_user}",
      "gists_url": "https://api.github.com/users/ItayPodhajcer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ItayPodhajcer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ItayPodhajcer/subscriptions",
      "organizations_url": "https://api.github.com/users/ItayPodhajcer/orgs",
      "repos_url": "https://api.github.com/users/ItayPodhajcer/repos",
      "events_url": "https://api.github.com/users/ItayPodhajcer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ItayPodhajcer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-19T06:13:07Z",
    "updated_at": "2022-07-19T06:13:07Z",
    "author_association": "NONE",
    "body": "Thanks for the clarification @iamhsk!\r\n\r\nThe need to migrate was triggered by the docs leading to believe that QBFT is the long-term support consensus algorithm starting from the point it reached a production grade release.\r\nSo, to make sure we are not caught by surprise by IBFT 2.0 being retired, cause as I mentioned before, we are running three networks, one of which is a production network, we wanted to start looking at the migration path as early as possible.\r\n\r\nYour last answer made it clear that IBFT 2.0 won't be going away that fast, and once it does, a migration path will already be available.\r\n\r\nThank you!",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1188640415/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1219697983",
    "html_url": "https://github.com/hyperledger/besu/issues/2991#issuecomment-1219697983",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2991",
    "id": 1219697983,
    "node_id": "IC_kwDODE2jmc5Isx0_",
    "user": {
      "login": "feed755x",
      "id": 57309075,
      "node_id": "MDQ6VXNlcjU3MzA5MDc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/57309075?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/feed755x",
      "html_url": "https://github.com/feed755x",
      "followers_url": "https://api.github.com/users/feed755x/followers",
      "following_url": "https://api.github.com/users/feed755x/following{/other_user}",
      "gists_url": "https://api.github.com/users/feed755x/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/feed755x/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/feed755x/subscriptions",
      "organizations_url": "https://api.github.com/users/feed755x/orgs",
      "repos_url": "https://api.github.com/users/feed755x/repos",
      "events_url": "https://api.github.com/users/feed755x/events{/privacy}",
      "received_events_url": "https://api.github.com/users/feed755x/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-18T16:30:21Z",
    "updated_at": "2022-08-18T16:30:21Z",
    "author_association": "NONE",
    "body": "@ItayPodhajcer @iamhsk https://consensys.net/docs/goquorum/en/latest/configure-and-manage/configure/consensus-protocols/qbft/ this information would work for the migration from ibft to qbft in hyperledger?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1219697983/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1219717869",
    "html_url": "https://github.com/hyperledger/besu/issues/2991#issuecomment-1219717869",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2991",
    "id": 1219717869,
    "node_id": "IC_kwDODE2jmc5Is2rt",
    "user": {
      "login": "ItayPodhajcer",
      "id": 19306955,
      "node_id": "MDQ6VXNlcjE5MzA2OTU1",
      "avatar_url": "https://avatars.githubusercontent.com/u/19306955?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ItayPodhajcer",
      "html_url": "https://github.com/ItayPodhajcer",
      "followers_url": "https://api.github.com/users/ItayPodhajcer/followers",
      "following_url": "https://api.github.com/users/ItayPodhajcer/following{/other_user}",
      "gists_url": "https://api.github.com/users/ItayPodhajcer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ItayPodhajcer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ItayPodhajcer/subscriptions",
      "organizations_url": "https://api.github.com/users/ItayPodhajcer/orgs",
      "repos_url": "https://api.github.com/users/ItayPodhajcer/repos",
      "events_url": "https://api.github.com/users/ItayPodhajcer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ItayPodhajcer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-18T16:53:10Z",
    "updated_at": "2022-08-18T18:24:42Z",
    "author_association": "NONE",
    "body": "Looks pretty good!!\n\nTwo questions:\n1. Why is `geth init` required?\n2. Can the transition update be done gradually and not all nodes at once if the transition block is far enough in the future?\n\nThanks for all your great work!!",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1219717869/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1404843028",
    "html_url": "https://github.com/hyperledger/besu/issues/2991#issuecomment-1404843028",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2991",
    "id": 1404843028,
    "node_id": "IC_kwDODE2jmc5TvDQU",
    "user": {
      "login": "non-fungible-nelson",
      "id": 85905982,
      "node_id": "MDQ6VXNlcjg1OTA1OTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/non-fungible-nelson",
      "html_url": "https://github.com/non-fungible-nelson",
      "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
      "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
      "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
      "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
      "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
      "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-26T10:58:20Z",
    "updated_at": "2023-01-26T10:58:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "@iamhsk - status on this? ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1404843028/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1683605928",
    "html_url": "https://github.com/hyperledger/besu/issues/2991#issuecomment-1683605928",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2991",
    "id": 1683605928,
    "node_id": "IC_kwDODE2jmc5kWcmo",
    "user": {
      "login": "SimowTopos",
      "id": 101154139,
      "node_id": "U_kgDOBgd9Ww",
      "avatar_url": "https://avatars.githubusercontent.com/u/101154139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SimowTopos",
      "html_url": "https://github.com/SimowTopos",
      "followers_url": "https://api.github.com/users/SimowTopos/followers",
      "following_url": "https://api.github.com/users/SimowTopos/following{/other_user}",
      "gists_url": "https://api.github.com/users/SimowTopos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SimowTopos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SimowTopos/subscriptions",
      "organizations_url": "https://api.github.com/users/SimowTopos/orgs",
      "repos_url": "https://api.github.com/users/SimowTopos/repos",
      "events_url": "https://api.github.com/users/SimowTopos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SimowTopos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-18T09:09:18Z",
    "updated_at": "2023-08-18T09:09:18Z",
    "author_association": "NONE",
    "body": "Hello team, any news on this feature? \r\nI found in this doc : https://consensys.net/blog/quorum/consensys-quorum-21-7-0-product-update-london-hard-fork-qbft-and-more/\r\n\"Because QBFT is an early access feature, we currently recommend it for new networks. Existing networks using IBFT2.0 cannot currently migrate to QBFT. This will become available in a future release. The ConsenSys Quorum team would also welcome any community feedback on the feature and their experience using it in their networks.\"\r\n\r\nThe link proposed by @feed755x is for Quorum consensus switch and not besu....Can we have some help on this please? Thanks",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1683605928/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1685078868",
    "html_url": "https://github.com/hyperledger/besu/issues/2991#issuecomment-1685078868",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2991",
    "id": 1685078868,
    "node_id": "IC_kwDODE2jmc5kcENU",
    "user": {
      "login": "SimowTopos",
      "id": 101154139,
      "node_id": "U_kgDOBgd9Ww",
      "avatar_url": "https://avatars.githubusercontent.com/u/101154139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SimowTopos",
      "html_url": "https://github.com/SimowTopos",
      "followers_url": "https://api.github.com/users/SimowTopos/followers",
      "following_url": "https://api.github.com/users/SimowTopos/following{/other_user}",
      "gists_url": "https://api.github.com/users/SimowTopos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SimowTopos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SimowTopos/subscriptions",
      "organizations_url": "https://api.github.com/users/SimowTopos/orgs",
      "repos_url": "https://api.github.com/users/SimowTopos/repos",
      "events_url": "https://api.github.com/users/SimowTopos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SimowTopos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-19T18:20:25Z",
    "updated_at": "2023-08-19T18:20:25Z",
    "author_association": "NONE",
    "body": "Hello @jframe , @lucassaldanha , @iamhsk ,\r\nI deep dived on the besu code related to this issue...mainly MigratingProtocolContext  in Besu consensys common.\r\nIn getConsensusContext : \r\n`@Override\r\n  public <C extends ConsensusContext> C getConsensusContext(final Class<C> klass) {\r\n    final long chainHeadBlockNumber = getBlockchain().getChainHeadBlockNumber();\r\n    return consensusContextSchedule.getFork(chainHeadBlockNumber).getValue().as(klass);\r\n  }`\r\nWe encounter a java.lang.ClassCastException when we have a genesis configuration to trigger a migration from IBFT2 to QBFT : \r\n`\"ibft2\" : {\r\n      \"blockperiodseconds\" : 2,\r\n      \"epochlength\" : 30000,\r\n      \"requesttimeoutseconds\" : 4\r\n    },\r\n    \"qbft\": {\r\n      \"blockperiodseconds\": 2,\r\n      \"epochlength\": 30000,\r\n      \"requesttimeoutseconds\": 10,\r\n      \"startBlock\": 1520\r\n    }`\r\n\r\nThe issue seems understandable as we try to do a downcasting from BftContext  to QbftContext ( QbftContext inherit from BftContext) which is forbiden !!\r\n\r\nI saw also that this downcasting is due to this code :  \r\n`/**\r\n   * Gets fork.\r\n   *\r\n   * @param blockNumber the block number\r\n   * @return the fork\r\n   */\r\n  public ForkSpec<C> getFork(final long blockNumber) {\r\n    for (final ForkSpec<C> f : forks) {\r\n      if (blockNumber >= f.getBlock()) {\r\n        return f;\r\n      }\r\n    }\r\n\r\n    return forks.first();\r\n  }`\r\n\r\n....which return BftContext as the Treeset is reversed....\r\n\r\nI m trying to propose a fix but needs some help from you : \r\n- Changing the reversed is obviously a bad idea as it has a lot of impact ! \r\n- Do you think if we create a new QBftContext base on BftContext is the good solution ??\r\n\r\nThanks a lot for your time.\r\nMohamed.\r\n\r\nError occured : \r\n`2023-08-19 19:58:27.869+02:00 | BftProcessorExecutor-QBFT-0 | ERROR | EventMultiplexer | State machine threw exception while processing event \\{BlockTimerExpiry{Round Identifier=ConsensusRoundIdentifier{Sequence=1520, Round=0}}\\}\r\njava.lang.ClassCastException: Cannot cast org.hyperledger.besu.consensus.common.bft.BftContext to org.hyperledger.besu.consensus.qbft.QbftContext\r\n        at java.base/java.lang.Class.cast(Class.java:3921)\r\n        at org.hyperledger.besu.consensus.common.bft.BftContext.as(BftContext.java:70)\r\n        at org.hyperledger.besu.consensus.common.MigratingProtocolContext.getConsensusContext(MigratingProtocolContext.java:78)\r\n        at org.hyperledger.besu.consensus.qbft.blockcreation.QbftBlockCreatorFactory.create(QbftBlockCreatorFactory.java:71)\r\n        at org.hyperledger.besu.consensus.qbft.statemachine.QbftRoundFactory.createNewRoundWithState(QbftRoundFactory.java:103)\r\n        at org.hyperledger.besu.consensus.qbft.statemachine.QbftRoundFactory.createNewRound(QbftRoundFactory.java:90)\r\n        at org.hyperledger.besu.consensus.qbft.statemachine.QbftBlockHeightManager.startNewRound(QbftBlockHeightManager.java:291)\r\n        at org.hyperledger.besu.consensus.qbft.statemachine.QbftBlockHeightManager.handleBlockTimerExpiry(QbftBlockHeightManager.java:126)\r\n        at org.hyperledger.besu.consensus.common.bft.statemachine.BaseBftController.handleBlockTimerExpiry(BaseBftController.java:167)\r\n        at org.hyperledger.besu.consensus.common.bft.EventMultiplexer.handleBftEvent(EventMultiplexer.java:65)\r\n        at java.base/java.util.Optional.ifPresent(Optional.java:178)\r\n        at org.hyperledger.besu.consensus.common.bft.BftProcessor.run(BftProcessor.java:65)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\r\n        at java.base/java.lang.Thread.run(Thread.java:833)`",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1685078868/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1685491976",
    "html_url": "https://github.com/hyperledger/besu/issues/2991#issuecomment-1685491976",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2991",
    "id": 1685491976,
    "node_id": "IC_kwDODE2jmc5kdpEI",
    "user": {
      "login": "jframe",
      "id": 909467,
      "node_id": "MDQ6VXNlcjkwOTQ2Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/909467?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jframe",
      "html_url": "https://github.com/jframe",
      "followers_url": "https://api.github.com/users/jframe/followers",
      "following_url": "https://api.github.com/users/jframe/following{/other_user}",
      "gists_url": "https://api.github.com/users/jframe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jframe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jframe/subscriptions",
      "organizations_url": "https://api.github.com/users/jframe/orgs",
      "repos_url": "https://api.github.com/users/jframe/repos",
      "events_url": "https://api.github.com/users/jframe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jframe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-21T01:39:00Z",
    "updated_at": "2023-08-21T01:39:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "I've updated this ticket with the progress that we have made with this feature. Development on this is currently paused and we won't be getting back to this for a while. If you want to pick this up though, would be happy to help get you started and point you in the right direction.\r\n\r\nCreating a new QbftContext from a BftContext could work. That is similar to the solution we were working on. The approach we were taking was to have a ProtocolContext that could switch protocol contexts when reaching the Qbft block. To do this we created a [MigratingProtocolContext](https://github.com/hyperledger/besu/blob/main/consensus/common/src/main/java/org/hyperledger/besu/consensus/common/MigratingProtocolContext.java\r\n) and a [MigratingContext](https://github.com/hyperledger/besu/blob/main/consensus/common/src/main/java/org/hyperledger/besu/consensus/common/MigratingProtocolContext.java\r\n) which allows switching ProtocolContexts.\r\n\r\nThere is also a [ConsensusScheduleBesuControllerBuilder](https://github.com/hyperledger/besu/blob/main/consensus/common/src/main/java/org/hyperledger/besu/consensus/common/MigratingProtocolContext.java\r\n) that will switch consensus mechanisms at a particular block.\r\n\r\nThe general approach we took was to have components for `BesuControllerBuilder`, `ProtocolSchedule`, `ProtocolContext`, `MiningCoordinator` that could switch between consensus mechanisms. In the `BesuController` [fromGensisConfig](https://github.com/hyperledger/besu/blob/main/besu/src/main/java/org/hyperledger/besu/controller/BesuController.java#L346) if we have both IBFT2 and QBFT configured in the genesis then we create a create a ConsensusScheduleBesuControllerBuilder using the IbftBesuControllerBuilder and the QbftBesuControllerBuilder which allows for switching between the consensus mechanisms at runtime.\r\n\r\nWhat's missing is changing subprotocols at the fork from the IBFT2 protocol to the QBFT protocol, edge cases around the extra data codec, RPCs and lots of testing.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1685491976/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
