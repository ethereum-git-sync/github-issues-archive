{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/3524",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/3524/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/3524/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/3524/events",
  "html_url": "https://github.com/hyperledger/besu/issues/3524",
  "id": 1159428046,
  "node_id": "I_kwDODE2jmc5FG3fO",
  "number": 3524,
  "title": "Sync issues and many \"1000 expired transaction messages have been skipped\" warning",
  "user": {
    "login": "fab-10",
    "id": 91944855,
    "node_id": "U_kgDOBXr3lw",
    "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fab-10",
    "html_url": "https://github.com/fab-10",
    "followers_url": "https://api.github.com/users/fab-10/followers",
    "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
    "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
    "organizations_url": "https://api.github.com/users/fab-10/orgs",
    "repos_url": "https://api.github.com/users/fab-10/repos",
    "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fab-10/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3013559202,
      "node_id": "MDU6TGFiZWwzMDEzNTU5MjAy",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/mainnet",
      "name": "mainnet",
      "color": "9D578C",
      "default": false,
      "description": ""
    },
    {
      "id": 3932728358,
      "node_id": "LA_kwDODE2jmc7qaKwm",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/syncing",
      "name": "syncing",
      "color": "ECC431",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "fab-10",
    "id": 91944855,
    "node_id": "U_kgDOBXr3lw",
    "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fab-10",
    "html_url": "https://github.com/fab-10",
    "followers_url": "https://api.github.com/users/fab-10/followers",
    "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
    "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
    "organizations_url": "https://api.github.com/users/fab-10/orgs",
    "repos_url": "https://api.github.com/users/fab-10/repos",
    "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fab-10/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-03-04T09:24:16Z",
  "updated_at": "2022-03-21T09:07:07Z",
  "closed_at": "2022-03-21T09:07:07Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!-- Have you done the following? -->\r\n<!--   * read the Code of Conduct? By filing an Issue, you are expected to -->  \r\n<!--     comply with it, including treating everyone with respect: -->\r\n<!--     https://github.com/hyperledger/besu/blob/main/CODE_OF_CONDUCT.md -->\r\n<!--   * Reproduced the issue in the latest version of the software -->\r\n<!--   * Read the debugging docs: https://besu.hyperledger.org/en/stable/HowTo/Monitor/Logging/ -->\r\n<!--   * Duplicate Issue check:  https://github.com/search?q=+is%3Aissue+repo%3Ahyperledger/Besu -->\r\n<!-- Note:  Not all sections will apply to all issue types. -->\r\n\r\n### Description\r\nIt seems there is a correlation when Besu is not able to stay in sync on mainnet and the presence of many warnings in the log, stating that `\"1000 expired transaction messages have been skipped.`\r\n\r\nfor example this graph, shows that Besu if frequently some blocks behind\r\n![image](https://user-images.githubusercontent.com/91944855/156734463-31527558-eed2-428f-bee3-e17e2a513897.png)\r\nand at the same time the log if full of warnings:\r\n```\r\n{\"timestamp\":\"2022-03-04T09:14:34,355\",\"level\":\"WARN\",\"thread\":\"EthScheduler-Transactions-1\",\"class\":\"TransactionsMessageProcessor\",\"message\":\"1000 expired transaction messages have been skipped.\",\"throwable\":\"\"}\r\n{\"timestamp\":\"2022-03-04T09:14:35,411\",\"level\":\"WARN\",\"thread\":\"EthScheduler-Transactions-1\",\"class\":\"TransactionsMessageProcessor\",\"message\":\"1000 expired transaction messages have been skipped.\",\"throwable\":\"\"}\r\n{\"timestamp\":\"2022-03-04T09:14:35,688\",\"level\":\"WARN\",\"thread\":\"EthScheduler-Transactions-0\",\"class\":\"PendingTransactionsMessageProcessor\",\"message\":\"1000 expired transaction messages have been skipped.\",\"throwable\":\"\"}\r\n{\"timestamp\":\"2022-03-04T09:14:36,161\",\"level\":\"WARN\",\"thread\":\"EthScheduler-Transactions-0\",\"class\":\"TransactionsMessageProcessor\",\"message\":\"1000 expired transaction messages have been skipped.\",\"throwable\":\"\"}\r\n{\"timestamp\":\"2022-03-04T09:14:36,938\",\"level\":\"WARN\",\"thread\":\"EthScheduler-Transactions-0\",\"class\":\"TransactionsMessageProcessor\",\"message\":\"1000 expired transaction messages have been skipped.\",\"throwable\":\"\"}\r\n{\"timestamp\":\"2022-03-04T09:14:37,638\",\"level\":\"WARN\",\"thread\":\"EthScheduler-Transactions-1\",\"class\":\"TransactionsMessageProcessor\",\"message\":\"1000 expired transaction messages have been skipped.\",\"throwable\":\"\"}\r\n```\r\n\r\nat the same time the `transactions` executor, has a very long queue\r\n![image](https://user-images.githubusercontent.com/91944855/156734816-9dffea8d-7862-4737-b4d5-f348569f41ba.png)\r\nand this could be a symptom, that Besu is queuing too much and is not able to process in time these messages.\r\n\r\nIf queuing too much is the issues, then a limit on the queue or other strategy to discard some messages should be implemented\r\n\r\n### Versions (Add all that apply)\r\n* Software version: 22.1.0\r\n* Java version: Java11\r\n* Cloud VM, type, size: Amazon t3.xlarge with EBS gp3\r\n\r\n### Additional Information\r\n\r\n",
  "closed_by": {
    "login": "fab-10",
    "id": 91944855,
    "node_id": "U_kgDOBXr3lw",
    "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fab-10",
    "html_url": "https://github.com/fab-10",
    "followers_url": "https://api.github.com/users/fab-10/followers",
    "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
    "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
    "organizations_url": "https://api.github.com/users/fab-10/orgs",
    "repos_url": "https://api.github.com/users/fab-10/repos",
    "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fab-10/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/3524/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/3524/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1059641100",
    "html_url": "https://github.com/hyperledger/besu/issues/3524#issuecomment-1059641100",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3524",
    "id": 1059641100,
    "node_id": "IC_kwDODE2jmc4_KNcM",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-05T01:27:59Z",
    "updated_at": "2022-03-05T01:27:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "Those warnings are the strategy to discard messages if Besu is unable to keep up with the rate of incoming transactions messages.  So I'd suggest this is a side effect of Besu not being able to keep up.  The big question is, why can't Besu keep up? It may be that there's a spike in the number of transactions messages which then consumes too much CPU causing the whole node to fall behind or there could be something like lock contention causing both block import and transaction processing to fall behind.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1059641100/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
