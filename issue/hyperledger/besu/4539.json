{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/4539",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/4539/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/4539/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/4539/events",
  "html_url": "https://github.com/hyperledger/besu/issues/4539",
  "id": 1410438756,
  "node_id": "I_kwDODE2jmc5UEZZk",
  "number": 4539,
  "title": "Provide meaningful progress updates during backwards/forwards sync",
  "user": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-10-16T10:04:42Z",
  "updated_at": "2023-01-26T13:08:03Z",
  "closed_at": "2023-01-26T13:08:02Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\r\nCurrently when the consensus client jumps ahead and besu needs to perform a backwards sync it gives some really confusing log messages which make it look like it's not making any progress:\r\n\r\n```\r\n{\"@timestamp\":\"2022-10-16T10:00:27,655\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-3\",\"class\":\"ForwardSyncStep\",\"message\":\"No blocks to save...\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-16T10:00:27,664\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-3\",\"class\":\"BackwardsSyncAlgorithm\",\"message\":\"Backward sync reached ancestor header, starting Forward sync\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-16T10:00:27,850\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-3\",\"class\":\"ForwardSyncStep\",\"message\":\"No blocks to save...\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-16T10:00:27,858\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-3\",\"class\":\"BackwardsSyncAlgorithm\",\"message\":\"Backward sync reached ancestor header, starting Forward sync\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-16T10:00:27,971\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-3\",\"class\":\"ForwardSyncStep\",\"message\":\"No blocks to save...\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-16T10:00:27,979\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-3\",\"class\":\"BackwardsSyncAlgorithm\",\"message\":\"Backward sync reached ancestor header, starting Forward sync\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-16T10:00:28,145\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-3\",\"class\":\"ForwardSyncStep\",\"message\":\"No blocks to save...\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-16T10:00:28,157\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-3\",\"class\":\"BackwardsSyncAlgorithm\",\"message\":\"Backward sync reached ancestor header, starting Forward sync\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-16T10:00:28,158\",\"level\":\"WARN\",\"thread\":\"ForkJoinPool.commonPool-worker-1\",\"class\":\"BackwardSyncContext\",\"message\":\"Backward sync failed (org.hyperledger.besu.ethereum.eth.manager.exceptions.NoAvailablePeersException: Task failed: NO_AVAILABLE_PEERS). Current Peers: 0. Retrying in 5000 milliseconds...\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-16T10:00:33,169\",\"level\":\"INFO\",\"thread\":\"EthScheduler-Timer-0\",\"class\":\"BackwardsSyncAlgorithm\",\"message\":\"Backward sync reached ancestor header, starting Forward sync\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-16T10:00:33,169\",\"level\":\"WARN\",\"thread\":\"ForkJoinPool.commonPool-worker-1\",\"class\":\"BackwardSyncContext\",\"message\":\"Backward sync failed (org.hyperledger.besu.ethereum.eth.manager.exceptions.NoAvailablePeersException: Task failed: NO_AVAILABLE_PEERS). Current Peers: 1. Retrying in 5000 milliseconds...\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-16T10:00:37,016\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"EngineForkchoiceUpdated\",\"message\":\"SYNCING for fork-choice-update: head: 0x972a8b063ec543e1a9ea8cf3f7cb2f9d98926c2845964fedbf93d0684a8d1ea7, finalized: 0xfc82ad881922642e14f091a5db3af932269ffcc9b06bec0dbb1720dbf2ec8bcf, safeBlockHash: 0xd56abb85963124d77cee765fbb01111e1bc56765020a2e4a3a50251c321be41f\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-16T10:00:38,179\",\"level\":\"INFO\",\"thread\":\"EthScheduler-Timer-0\",\"class\":\"BackwardsSyncAlgorithm\",\"message\":\"Backward sync reached ancestor header, starting Forward sync\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-16T10:00:42,666\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-1\",\"class\":\"ForwardSyncStep\",\"message\":\"Saved blocks 7775831 -> 7775844 (target: 7778816)\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-16T10:00:42,685\",\"level\":\"INFO\",\"thread\":\"ForkJoinPool.commonPool-worker-1\",\"class\":\"BackwardsSyncAlgorithm\",\"message\":\"Backward sync reached ancestor header, starting Forward sync\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-16T10:00:59,832\",\"level\":\"INFO\",\"thread\":\"ForkJoinPool.commonPool-worker-1\",\"class\":\"BackwardsSyncAlgorithm\",\"message\":\"Backward sync reached ancestor header, starting Forward sync\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-16T10:01:12,576\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-1\",\"class\":\"ForwardSyncStep\",\"message\":\"Saved blocks 7775890 -> 7775923 (target: 7778819)\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2022-10-16T10:01:12,594\",\"level\":\"INFO\",\"thread\":\"ForkJoinPool.commonPool-worker-1\",\"class\":\"BackwardsSyncAlgorithm\",\"message\":\"Backward sync reached ancestor header, starting Forward sync\",\"throwable\":\"\"}\r\n```\r\n\r\nI _think_ based on the way the \"Saved blocks\" log line numbers are changing that it is actually importing blocks but it looks like it's stuck doing backwards sync and then forward sync does nothing because there were \"No blocks to save...\".\r\n\r\nWe should improve this logging to just clearly show the progress being made and how much further it has to sync.",
  "closed_by": {
    "login": "non-fungible-nelson",
    "id": 85905982,
    "node_id": "MDQ6VXNlcjg1OTA1OTgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/non-fungible-nelson",
    "html_url": "https://github.com/non-fungible-nelson",
    "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
    "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
    "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
    "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
    "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
    "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/4539/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/4539/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1279937113",
    "html_url": "https://github.com/hyperledger/besu/issues/4539#issuecomment-1279937113",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4539",
    "id": 1279937113,
    "node_id": "IC_kwDODE2jmc5MSkpZ",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-16T10:06:13Z",
    "updated_at": "2022-10-16T10:06:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ah actually the:\r\n```\r\n{\"@timestamp\":\"2022-10-16T10:05:11,856\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-3\",\"class\":\"ForwardSyncStep\",\"message\":\"Saved blocks 7776535 -> 7776577 (target: 7778836)\",\"throwable\":\"\"}\r\n```\r\n\r\nlines towards the end are more useful when you can spot them in all the backwards sync noise. Maybe it wasn't actually making progress initially but then I don't know why not.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1279937113/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1404983001",
    "html_url": "https://github.com/hyperledger/besu/issues/4539#issuecomment-1404983001",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4539",
    "id": 1404983001,
    "node_id": "IC_kwDODE2jmc5TvlbZ",
    "user": {
      "login": "non-fungible-nelson",
      "id": 85905982,
      "node_id": "MDQ6VXNlcjg1OTA1OTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/non-fungible-nelson",
      "html_url": "https://github.com/non-fungible-nelson",
      "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
      "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
      "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
      "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
      "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
      "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-26T13:08:02Z",
    "updated_at": "2023-01-26T13:08:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing for logging changes in backwards and forward sync in 22.10.x series. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1404983001/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
