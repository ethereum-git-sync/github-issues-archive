{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/5697",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/5697/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/5697/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/5697/events",
  "html_url": "https://github.com/hyperledger/besu/issues/5697",
  "id": 1800819029,
  "node_id": "I_kwDODE2jmc5rVlFV",
  "number": 5697,
  "title": "Thread blocked due to allocateInstance on Windows",
  "user": {
    "login": "LeoHLee",
    "id": 48520136,
    "node_id": "MDQ6VXNlcjQ4NTIwMTM2",
    "avatar_url": "https://avatars.githubusercontent.com/u/48520136?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/LeoHLee",
    "html_url": "https://github.com/LeoHLee",
    "followers_url": "https://api.github.com/users/LeoHLee/followers",
    "following_url": "https://api.github.com/users/LeoHLee/following{/other_user}",
    "gists_url": "https://api.github.com/users/LeoHLee/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/LeoHLee/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/LeoHLee/subscriptions",
    "organizations_url": "https://api.github.com/users/LeoHLee/orgs",
    "repos_url": "https://api.github.com/users/LeoHLee/repos",
    "events_url": "https://api.github.com/users/LeoHLee/events{/privacy}",
    "received_events_url": "https://api.github.com/users/LeoHLee/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-07-12T11:56:01Z",
  "updated_at": "2023-07-12T11:56:01Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nI ran `besu.bat --data-path=besu-eth --sync-mode=X_SNAP --data-storage-format=BONSAI --engine-rpc-enabled --engine-jwt-secret=jwtsecret.hex --Xdns-enabled=true --rpc-http-enabled=true --rpc-http-api=ADMIN,ETH,WEB3,NET`, which starts an execution client for Ethereum Mainnet on Windows. After about 5.5 hours of syncing, the following warnings are output.\r\n\r\n```\r\n2023-07-10 23:00:34.109+08:00 | EthScheduler-Services-26 (batchPersistTrieNodeData) | INFO  | SnapsyncMetricsManager | Healed 4589584 world state trie nodes, Peer count: 4\r\n2023-07-10 23:00:54.160+08:00 | EthScheduler-Services-42 (importBlock) | INFO  | FastImportBlocksStep | Block import progress: 3789645 of 17656454 (21%)\r\n2023-07-10 23:00:59.587+08:00 | vertx-blocked-thread-checker | WARN  | BlockedThreadChecker | Thread Thread[#35,vert.x-eventloop-thread-1,5,main] has been blocked for 3602 ms, time limit is 2000 ms\r\n2023-07-10 23:01:26.646+08:00 | EthScheduler-Services-42 (importBlock) | INFO  | FastImportBlocksStep | Block import progress: 3790445 of 17656454 (21%)\r\n2023-07-10 23:01:35.295+08:00 | EthScheduler-Services-26 (batchPersistTrieNodeData) | INFO  | SnapsyncMetricsManager | Healed 4603975 world state trie nodes, Peer count: 3\r\n2023-07-10 23:02:06.691+08:00 | EthScheduler-Services-42 (importBlock) | INFO  | FastImportBlocksStep | Block import progress: 3791245 of 17656454 (21%)\r\n2023-07-10 23:02:35.758+08:00 | EthScheduler-Services-26 (batchPersistTrieNodeData) | INFO  | SnapsyncMetricsManager | Healed 4616236 world state trie nodes, Peer count: 3\r\n2023-07-10 23:02:48.532+08:00 | EthScheduler-Services-42 (importBlock) | INFO  | FastImportBlocksStep | Block import progress: 3792045 of 17656454 (21%)\r\n2023-07-10 23:03:31.292+08:00 | EthScheduler-Services-42 (importBlock) | INFO  | FastImportBlocksStep | Block import progress: 3792645 of 17656454 (21%)\r\n2023-07-10 23:03:35.811+08:00 | EthScheduler-Services-26 (batchPersistTrieNodeData) | INFO  | SnapsyncMetricsManager | Healed 4624273 world state trie nodes, Peer count: 3\r\n2023-07-10 23:03:52.409+08:00 | vertx-blocked-thread-checker | WARN  | BlockedThreadChecker | Thread Thread[#35,vert.x-eventloop-thread-1,5,main] has been blocked for 3702 ms, time limit is 2000 ms\r\n2023-07-10 23:03:56.197+08:00 | vertx-blocked-thread-checker | WARN  | BlockedThreadChecker | Thread Thread[#35,vert.x-eventloop-thread-1,5,main] has been blocked for 7450 ms, time limit is 2000 ms\r\nio.vertx.core.VertxException: Thread blocked\r\n        at java.base/java.lang.invoke.DirectMethodHandle.allocateInstance(DirectMethodHandle.java:501)\r\n        at org.hyperledger.besu.ethereum.p2p.discovery.internal.PeerDiscoveryController.lambda$bond$10(PeerDiscoveryController.java:538)\r\n        at java.base/java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:718)\r\n        at java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\r\n        at java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2179)\r\n        at org.hyperledger.besu.ethereum.p2p.discovery.VertxPeerDiscoveryAgent$VertxAsyncExecutor.lambda$execute$1(VertxPeerDiscoveryAgent.java:327)\r\n        at io.vertx.core.impl.future.FutureImpl$3.onSuccess(FutureImpl.java:141)\r\n        at io.vertx.core.impl.future.FutureBase.lambda$emitSuccess$0(FutureBase.java:54)\r\n        at io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:174)\r\n        at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:167)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:569)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:1623)\r\n2023-07-10 23:03:59.968+08:00 | vertx-blocked-thread-checker | WARN  | BlockedThreadChecker | Thread Thread[#35,vert.x-eventloop-thread-1,5,main] has been blocked for 11262 ms, time limit is 2000 ms\r\nio.vertx.core.VertxException: Thread blocked\r\n        at java.base/java.lang.invoke.DirectMethodHandle.allocateInstance(DirectMethodHandle.java:501)\r\n        at org.hyperledger.besu.ethereum.p2p.discovery.internal.PeerDiscoveryController.lambda$bond$10(PeerDiscoveryController.java:538)\r\n        at java.base/java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:718)\r\n        at java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\r\n        at java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2179)\r\n        at org.hyperledger.besu.ethereum.p2p.discovery.VertxPeerDiscoveryAgent$VertxAsyncExecutor.lambda$execute$1(VertxPeerDiscoveryAgent.java:327)\r\n        at io.vertx.core.impl.future.FutureImpl$3.onSuccess(FutureImpl.java:141)\r\n        at io.vertx.core.impl.future.FutureBase.lambda$emitSuccess$0(FutureBase.java:54)\r\n        at io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:174)\r\n        at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:167)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:569)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:1623)\r\n2023-07-10 23:04:11.378+08:00 | vertx-blocked-thread-checker | WARN  | BlockedThreadChecker | Thread Thread[#35,vert.x-eventloop-thread-1,5,main] has been blocked for 3828 ms, time limit is 2000 ms\r\n2023-07-10 23:04:15.515+08:00 | vertx-blocked-thread-checker | WARN  | BlockedThreadChecker | Thread Thread[#35,vert.x-eventloop-thread-1,5,main] has been blocked for 7964 ms, time limit is 2000 ms\r\nio.vertx.core.VertxException: Thread blocked\r\n        at java.base/java.lang.invoke.DirectMethodHandle.allocateInstance(DirectMethodHandle.java:501)\r\n        at org.hyperledger.besu.ethereum.p2p.discovery.VertxPeerDiscoveryAgent.handlePacket(VertxPeerDiscoveryAgent.java:283)\r\n        at io.vertx.core.impl.EventLoopContext.emit(EventLoopContext.java:55)\r\n        at io.vertx.core.impl.ContextBase.emit(ContextBase.java:239)\r\n        at io.vertx.core.datagram.impl.DatagramSocketImpl$Connection.handlePacket(DatagramSocketImpl.java:551)\r\n        at io.vertx.core.datagram.impl.DatagramSocketImpl$Connection.handleMessage(DatagramSocketImpl.java:531)\r\n        at io.vertx.core.net.impl.ConnectionBase.read(ConnectionBase.java:157)\r\n        at io.vertx.core.net.impl.VertxHandler.channelRead(VertxHandler.java:153)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\r\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\r\n        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\r\n        at io.netty.channel.nio.AbstractNioMessageChannel$NioMessageUnsafe.read(AbstractNioMessageChannel.java:97)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\r\n        at io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:1623)\r\n2023-07-10 23:04:19.305+08:00 | vertx-blocked-thread-checker | WARN  | BlockedThreadChecker | Thread Thread[#35,vert.x-eventloop-thread-1,5,main] has been blocked for 3753 ms, time limit is 2000 ms\r\n2023-07-10 23:04:35.739+08:00 | vertx-blocked-thread-checker | WARN  | BlockedThreadChecker | Thread Thread[#34,vert.x-eventloop-thread-0,5,main] has been blocked for 7568 ms, time limit is 2000 ms\r\nio.vertx.core.VertxException: Thread blocked\r\n        at java.base/jdk.internal.misc.Unsafe.allocateInstance(Native Method)\r\n        at java.base/java.lang.invoke.DirectMethodHandle.allocateInstance(DirectMethodHandle.java:501)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.filter.FilterManager.lambda$startFilterTimeoutTimer$2(FilterManager.java:82)\r\n        at io.vertx.core.impl.VertxImpl$InternalTimerHandler.handle(VertxImpl.java:927)\r\n        at io.vertx.core.impl.VertxImpl$InternalTimerHandler.handle(VertxImpl.java:903)\r\n        at io.vertx.core.impl.EventLoopContext.emit(EventLoopContext.java:55)\r\n        at io.vertx.core.impl.ContextBase.emit(ContextBase.java:239)\r\n        at io.vertx.core.impl.ContextInternal.emit(ContextInternal.java:194)\r\n        at io.vertx.core.impl.VertxImpl$InternalTimerHandler.run(VertxImpl.java:921)\r\n        at io.netty.util.concurrent.PromiseTask.runTask(PromiseTask.java:98)\r\n        at io.netty.util.concurrent.ScheduledFutureTask.run(ScheduledFutureTask.java:159)\r\n        at io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:174)\r\n        at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:167)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:569)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:1623)\r\n2023-07-10 23:04:35.755+08:00 | vertx-blocked-thread-checker | WARN  | BlockedThreadChecker | Thread Thread[#34,vert.x-eventloop-thread-0,5,main] has been blocked for 7585 ms, time limit is 2000 ms\r\nio.vertx.core.VertxException: Thread blocked\r\n        at java.base/jdk.internal.misc.Unsafe.allocateInstance(Native Method)\r\n        at java.base/java.lang.invoke.DirectMethodHandle.allocateInstance(DirectMethodHandle.java:501)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.filter.FilterManager.lambda$startFilterTimeoutTimer$2(FilterManager.java:82)\r\n        at io.vertx.core.impl.VertxImpl$InternalTimerHandler.handle(VertxImpl.java:927)\r\n        at io.vertx.core.impl.VertxImpl$InternalTimerHandler.handle(VertxImpl.java:903)\r\n        at io.vertx.core.impl.EventLoopContext.emit(EventLoopContext.java:55)\r\n        at io.vertx.core.impl.ContextBase.emit(ContextBase.java:239)\r\n        at io.vertx.core.impl.ContextInternal.emit(ContextInternal.java:194)\r\n        at io.vertx.core.impl.VertxImpl$InternalTimerHandler.run(VertxImpl.java:921)\r\n        at io.netty.util.concurrent.PromiseTask.runTask(PromiseTask.java:98)\r\n        at io.netty.util.concurrent.ScheduledFutureTask.run(ScheduledFutureTask.java:159)\r\n        at io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:174)\r\n        at io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:167)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)\r\n        at io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:569)\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:1623)\r\n```\r\n\r\nMeanwhile, Teku losed connection with Besu.\r\n\r\nI tried `java 17.0.7 2023-04-18 LTS` from Oracle, and there were still thread blocked warnings after serveral hours of syncing.\r\n\r\n### Versions (Add all that apply)\r\n* Software version: v23.4.4\r\n* Java version: openjdk 20.0.1 2023-04-18\r\n* OS Name & Version: Windows 10 22H2 19045.3155\r\n* Consensus Client & Version if using Proof of Stake: Teku 23.6.1\r\n\r\n### Hardware Info\r\n* CPU: 4-core Ryzen 3 4100\r\n* RAM: 32GB\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/5697/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/5697/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
