{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/1084",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/1084/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/1084/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/1084/events",
  "html_url": "https://github.com/hyperledger/besu/issues/1084",
  "id": 639675702,
  "node_id": "MDU6SXNzdWU2Mzk2NzU3MDI=",
  "number": 1084,
  "title": "Besu on Kubernetes RPC endpoint shows as \"Resource Not Found\" when serving over HTTPS with Ingress",
  "user": {
    "login": "YazzyYaz",
    "id": 9094204,
    "node_id": "MDQ6VXNlcjkwOTQyMDQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9094204?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/YazzyYaz",
    "html_url": "https://github.com/YazzyYaz",
    "followers_url": "https://api.github.com/users/YazzyYaz/followers",
    "following_url": "https://api.github.com/users/YazzyYaz/following{/other_user}",
    "gists_url": "https://api.github.com/users/YazzyYaz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/YazzyYaz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/YazzyYaz/subscriptions",
    "organizations_url": "https://api.github.com/users/YazzyYaz/orgs",
    "repos_url": "https://api.github.com/users/YazzyYaz/repos",
    "events_url": "https://api.github.com/users/YazzyYaz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/YazzyYaz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 2051683573,
      "node_id": "MDU6TGFiZWwyMDUxNjgzNTcz",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/P3",
      "name": "P3",
      "color": "ffff00",
      "default": false,
      "description": "Medium (ex: JSON-RPC request not working with a specific client library due to loose spec assumtion)"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 13,
  "created_at": "2020-06-16T13:41:37Z",
  "updated_at": "2020-09-11T20:09:49Z",
  "closed_at": "2020-09-11T20:09:48Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nI have a Besu statefulset manifest file and a service yaml file, and can get the endpoint directly from the IP provided by the service yaml file. So, doing a curl on the Besu endpoint served via the Service file allows me to get latest block data.\r\n\r\nMy issue stems from when I try to use the Kubernetes Ingress to grab that service endpoint and serve it over HTTPS on a domain. By then, it shows \"Resource Not Found\".\r\n\r\nOn Google Kubernetes Engine, I've set the health check for the Ingress file and that endpoint for the 8545 port for Besu to do a health check on `/liveness` and the health check completes normally and no issue is found. The system is found to be healthy because my Besu endpoint is synced up and can serve on HTTP endpoint provided by the Service manifest. It's just odd behavior when it tries to serve it via ingress on HTTPS.\r\n\r\nHere is the StatefulSet manifest yaml file:\r\n```\r\napiVersion: apps/v1beta1\r\nkind: StatefulSet\r\nmetadata:\r\n  name: classic-besu \r\n  namespace: ethercluster\r\n  labels:\r\n    app: classic-besu\r\nspec:\r\n  replicas: 1 \r\n  selector:\r\n    matchLabels:\r\n      app: classic-besu\r\n  serviceName: classic-besu\r\n  template:\r\n    metadata:\r\n      name: classic-besu\r\n      labels:\r\n        app: classic-besu\r\n    spec:\r\n      securityContext:\r\n        fsGroup: 1000\r\n      containers:\r\n        - name: besu\r\n          image: \"hyperledger/besu:latest\"\r\n          imagePullPolicy: Always\r\n          securityContext:\r\n            runAsUser: 1000\r\n          args: \r\n          - \"--network=classic\"\r\n          - \"--sync-mode=FAST\"\r\n          - \"--data-path=/classic-besu-data\"\r\n          - \"--node-private-key-file=/classic-besu-data/keys\"\r\n          - \"--rpc-http-enabled\" \r\n          - \"--rpc-ws-enabled\"\r\n          - \"--host-whitelist=*\"\r\n          - \"--rpc-http-cors-origins=*\"\r\n          - \"--p2p-host=35.223.202.158\"\r\n          - \"--p2p-port=30303\"\r\n          - \"--rpc-http-host=0.0.0.0\"\r\n          - \"--rpc-http-port=8545\"\r\n          - \"--nat-method=KUBERNETES\"\r\n          ports:\r\n            - containerPort: 8545\r\n              protocol: TCP\r\n              name: rpc-port\r\n            - containerPort: 8546\r\n              protocol: TCP\r\n              name: ws-port\r\n            - containerPort: 443\r\n              protocol: TCP\r\n              name: https\r\n          volumeMounts:\r\n            - name: classic-besu-data\r\n              mountPath: /classic-besu-data\r\n      volumes:\r\n       - name: classic-besu-data\r\n  volumeClaimTemplates:\r\n    - metadata:\r\n        name: classic-besu-data\r\n      spec:\r\n        accessModes: [\"ReadWriteOnce\"]\r\n        storageClassName: \"classic-besu-ssd\"\r\n        resources:\r\n          requests:\r\n            storage: 800Gi\r\n```\r\n\r\nThe Service YAML manifest is:\r\n\r\n```\r\napiVersion: v1\r\nkind: Service\r\nmetadata:\r\n  labels:\r\n    app: classic-besu\r\n  name: classic-besu\r\n  namespace: ethercluster\r\n  annotations:\r\n    cloud.google.com/app-protocols: '{\"my-https-port\":\"HTTPS\",\"my-http-port\":\"HTTP\"}'\r\nspec:\r\n  selector:\r\n    app: classic-besu\r\n  ports:\r\n  - name: default\r\n    protocol: TCP\r\n    port: 80\r\n    targetPort: 80\r\n  - name: rpc-endpoint\r\n    port: 8545\r\n    protocol: TCP\r\n    targetPort: 8545\r\n  - name: ws-endpoint\r\n    port: 8546\r\n    protocol: TCP\r\n    targetPort: 8546\r\n  - name: https\r\n    port: 443\r\n    protocol: TCP\r\n    targetPort: 443\r\n  type: LoadBalancer\r\n  sessionAffinity: ClientIP\r\n```\r\n\r\nThe basic command in the deployment manifest for Besu that references the hardcoded IP address \"35.223.202.158\" (which is generated by the Service yaml manifest provided) is the following command:\r\n```\r\nbesu --network=classic --sync-mode=FAST --data-path=/classic-besu-data --node-private-key-file=/classic-besu-data/keys --rpc-http-enabled --rpc-ws-enabled --host-whitelist=* --rpc-http-cors-origins=* --p2p-host=35.223.202.158\r\n--p2p-port=30303 --rpc-http-host=0.0.0.0 --rpc-http-port=8545 --nat-method=KUBERNETES\r\n```\r\n\r\nThe Ingress File has the following:\r\n```\r\napiVersion: extensions/v1beta1\r\nkind: Ingress\r\nmetadata:\r\n    name: ingress-eth\r\n    namespace: ethercluster\r\n    annotations:\r\n        kubernetes.io/ingress.global-static-ip-name: ethercluster-address\r\n        kubernetes.io/ingress.allow-http: \"false\"\r\n        kubernetes.io/ingress.class: \"gce\"\r\n        nginx.org/websocket-services: \"ws-svc\"\r\n        ingress.kubernetes.io/enable-ssl-chain-completion: \"false\"\r\n        ingress.kubernetes.io/enable-cors: \"true\"\r\n        nginx.ingress.kubernetes.io/connection-proxy-header: \"keep-alive\"\r\nspec:\r\n    tls:\r\n      - hosts:\r\n        - www.ethercluster.com\r\n        secretName: tls-ethercluster\r\n    backend:\r\n      serviceName: ethercluster-site\r\n      servicePort: 8080\r\n    rules:\r\n    - host: www.ethercluster.com\r\n      http:\r\n        paths:\r\n        - path: /\r\n          backend:\r\n            serviceName: ethercluster-site\r\n            servicePort: 8080\r\n         - path: /besu-etc\r\n          backend:\r\n            serviceName: classic-besu\r\n            servicePort: 8545\r\n```\r\n\r\nAs you can see from this setup, running the following curl command on the IP Address (pre-ingress) gives the followign:\r\n```\r\n$ curl --data '{\"method\":\"eth_blockNumber\",\"params\":[],\"id\":1,\"jsonrpc\":\"2.0\"}' \\\r\n-H \"Content-Type: application/json\" \\\r\n-X POST http://35.223.202.158:8545/\r\n\r\n{\r\n  \"jsonrpc\" : \"2.0\",\r\n  \"id\" : 1,\r\n  \"result\" : \"0xa1c72b\"\r\n}\r\n```\r\n\r\nNow, if I run it on the endpoint I specified for it: https://www.ethercluster.com/besu-etc, it'll show \"Resource Not Found\". Not sure if there's a missing config in Besu I need to setup in order to serve over SSL.\r\n\r\nI have a similar setup with Parity that provides an RPC endpoint publicly over SSL. Just having difficulties communicating with Besu Statefulset.\r\n\r\n### Steps to Reproduce (Bug)\r\n1. Start a Kubernetes cluster using the above manifests and setup Ingress on GKE. Documentations for GKE and Kubernetes for this system are found here: https://docs.ethercluster.com/#/\r\n2. Try to communicate with domain ssl endpoing for /besu-etc after sync.\r\n3. Notice \"Resource Not Found\"\r\n\r\n**Expected behavior:** [What you expect to happen]\r\nBesu can be served over SSL from Kubernetes\r\n\r\n**Actual behavior:** [What actually happens]\r\n\r\nBesu can't be served over SSL from Kubernetes.\r\n\r\n### Versions\r\n* Software version: Latest Besu Release Candidate: https://hub.docker.com/layers/hyperledger/besu/latest/images/sha256-68b9df486d4837f055f5ca0680de8674f40be5ab45d4d5e590e496456c8e613d?context=explore\r\n* Cloud VM, type, size: [Amazon Web Services I3-large] Google GKE \r\n\r\n\r\n",
  "closed_by": {
    "login": "YazzyYaz",
    "id": 9094204,
    "node_id": "MDQ6VXNlcjkwOTQyMDQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9094204?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/YazzyYaz",
    "html_url": "https://github.com/YazzyYaz",
    "followers_url": "https://api.github.com/users/YazzyYaz/followers",
    "following_url": "https://api.github.com/users/YazzyYaz/following{/other_user}",
    "gists_url": "https://api.github.com/users/YazzyYaz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/YazzyYaz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/YazzyYaz/subscriptions",
    "organizations_url": "https://api.github.com/users/YazzyYaz/orgs",
    "repos_url": "https://api.github.com/users/YazzyYaz/repos",
    "events_url": "https://api.github.com/users/YazzyYaz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/YazzyYaz/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/1084/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/1084/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/645163359",
    "html_url": "https://github.com/hyperledger/besu/issues/1084#issuecomment-645163359",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1084",
    "id": 645163359,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NTE2MzM1OQ==",
    "user": {
      "login": "joshuafernandes",
      "id": 3722503,
      "node_id": "MDQ6VXNlcjM3MjI1MDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3722503?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/joshuafernandes",
      "html_url": "https://github.com/joshuafernandes",
      "followers_url": "https://api.github.com/users/joshuafernandes/followers",
      "following_url": "https://api.github.com/users/joshuafernandes/following{/other_user}",
      "gists_url": "https://api.github.com/users/joshuafernandes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/joshuafernandes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/joshuafernandes/subscriptions",
      "organizations_url": "https://api.github.com/users/joshuafernandes/orgs",
      "repos_url": "https://api.github.com/users/joshuafernandes/repos",
      "events_url": "https://api.github.com/users/joshuafernandes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/joshuafernandes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-17T05:39:34Z",
    "updated_at": "2020-06-17T05:39:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @YazzyYaz \r\n\r\nI'll attempt to recreate your setup (likely next week) and get back to you. From the config Im not seeing anything that stands out. About the only thing I've not used in our setups in the --nat-manager - @matkt is the best person to ask about this. \r\n\r\nSmall typo in the last few lines of the ingress config which I presume is markdown formatting? Backend for classic-besu and the lines that follow need to be spaced 1 more character\r\n\r\nApart from that the ingres config I've tested with is here https://github.com/PegaSysEng/besu-kubernetes/blob/master/helm/ingress/ingress-rules-besu.yaml  \r\n\r\nCheers\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/645163359/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/648531254",
    "html_url": "https://github.com/hyperledger/besu/issues/1084#issuecomment-648531254",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1084",
    "id": 648531254,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0ODUzMTI1NA==",
    "user": {
      "login": "joshuafernandes",
      "id": 3722503,
      "node_id": "MDQ6VXNlcjM3MjI1MDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3722503?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/joshuafernandes",
      "html_url": "https://github.com/joshuafernandes",
      "followers_url": "https://api.github.com/users/joshuafernandes/followers",
      "following_url": "https://api.github.com/users/joshuafernandes/following{/other_user}",
      "gists_url": "https://api.github.com/users/joshuafernandes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/joshuafernandes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/joshuafernandes/subscriptions",
      "organizations_url": "https://api.github.com/users/joshuafernandes/orgs",
      "repos_url": "https://api.github.com/users/joshuafernandes/repos",
      "events_url": "https://api.github.com/users/joshuafernandes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/joshuafernandes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-24T01:39:26Z",
    "updated_at": "2020-06-24T01:40:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hello @YazzyYaz \r\n\r\nI've attempted to reproduce this on Azure and AWS and have been able to get it responding fine via https. I've not got certs for our domains but running a redirection to https in our config to make sure this works. For what its worth, we've got the same setup This is what I've done:\r\n\r\n1. plain old K8S cluster in Azure \r\n\r\n2. deployed our Besu IBFT2 setup via Helm from here https://github.com/PegaSysEng/besu-kubernetes/tree/master/helm/ibft2/besu\r\n\r\n3. Installed an ingress and used ingress rules from here that tie back to my `besu-node` service. Config here: https://github.com/PegaSysEng/besu-kubernetes/tree/master/helm/ingress\r\n\r\n4. Test with normal http:\r\n```curl -v -k -X POST --data '{\"jsonrpc\":\"2.0\",\"method\":\"net_peerCount\",\"params\":[],\"id\":1}' http://40.112.165.13:80/jsonrpc\r\nNote: Unnecessary use of -X or --request, POST is already inferred.\r\n*   Trying 40.112.165.13:80...\r\n* TCP_NODELAY set\r\n* Connected to 40.112.165.13 (40.112.165.13) port 80 (#0)\r\n> POST /jsonrpc HTTP/1.1\r\n> Host: 40.112.165.13\r\n> User-Agent: curl/7.68.0\r\n> Accept: */*\r\n> Content-Length: 61\r\n> Content-Type: application/x-www-form-urlencoded\r\n> \r\n* upload completely sent off: 61 out of 61 bytes\r\n* Mark bundle as not supporting multiuse\r\n< HTTP/1.1 200 OK\r\n< Server: nginx/1.17.10\r\n< Date: Wed, 24 Jun 2020 01:26:36 GMT\r\n< Content-Type: application/json\r\n< Content-Length: 55\r\n< Connection: keep-alive\r\n< \r\n{\r\n  \"jsonrpc\" : \"2.0\",\r\n  \"id\" : 1,\r\n  \"result\" : \"0x4\"\r\n* Connection #0 to host 40.112.165.13 left intact\r\n}\r\n```\r\n\r\n\r\n5. Test with https:\r\n```curl -v -k -X POST --data '{\"jsonrpc\":\"2.0\",\"method\":\"net_peerCount\",\"params\":[],\"id\":1}' https://40.112.165.13:443/jsonrpc\r\nNote: Unnecessary use of -X or --request, POST is already inferred.\r\n*   Trying 40.112.165.13:443...\r\n* TCP_NODELAY set\r\n* Connected to 40.112.165.13 (40.112.165.13) port 443 (#0)\r\n* ALPN, offering h2\r\n* ALPN, offering http/1.1\r\n* successfully set certificate verify locations:\r\n*   CAfile: /etc/ssl/certs/ca-certificates.crt\r\n  CApath: /etc/ssl/certs\r\n* TLSv1.3 (OUT), TLS handshake, Client hello (1):\r\n* TLSv1.3 (IN), TLS handshake, Server hello (2):\r\n* TLSv1.2 (IN), TLS handshake, Certificate (11):\r\n* TLSv1.2 (IN), TLS handshake, Server key exchange (12):\r\n* TLSv1.2 (IN), TLS handshake, Server finished (14):\r\n* TLSv1.2 (OUT), TLS handshake, Client key exchange (16):\r\n* TLSv1.2 (OUT), TLS change cipher, Change cipher spec (1):\r\n* TLSv1.2 (OUT), TLS handshake, Finished (20):\r\n* TLSv1.2 (IN), TLS handshake, Finished (20):\r\n* SSL connection using TLSv1.2 / ECDHE-RSA-AES128-GCM-SHA256\r\n* ALPN, server accepted to use h2\r\n* Server certificate:\r\n*  subject: O=Acme Co; CN=Kubernetes Ingress Controller Fake Certificate\r\n*  start date: Jun 24 01:14:58 2020 GMT\r\n*  expire date: Jun 24 01:14:58 2021 GMT\r\n*  issuer: O=Acme Co; CN=Kubernetes Ingress Controller Fake Certificate\r\n*  SSL certificate verify result: unable to get local issuer certificate (20), continuing anyway.\r\n* Using HTTP2, server supports multi-use\r\n* Connection state changed (HTTP/2 confirmed)\r\n* Copying HTTP/2 data in stream buffer to connection buffer after upgrade: len=0\r\n* Using Stream ID: 1 (easy handle 0x5616ce5ff4a0)\r\n> POST /jsonrpc HTTP/2\r\n> Host: 40.112.165.13\r\n> user-agent: curl/7.68.0\r\n> accept: */*\r\n> content-length: 61\r\n> content-type: application/x-www-form-urlencoded\r\n> \r\n* Connection state changed (MAX_CONCURRENT_STREAMS == 128)!\r\n* We are completely uploaded and fine\r\n< HTTP/2 200 \r\n< server: nginx/1.17.10\r\n< date: Wed, 24 Jun 2020 01:28:05 GMT\r\n< content-type: application/json\r\n< content-length: 55\r\n< strict-transport-security: max-age=15724800; includeSubDomains\r\n< \r\n{\r\n  \"jsonrpc\" : \"2.0\",\r\n  \"id\" : 1,\r\n  \"result\" : \"0x4\"\r\n* Connection #0 to host 40.112.165.13 left intact\r\n}\r\n```\r\n\r\n\r\nApart from the spacing on the yaml thats a bit off with the backend I can't see anything wrong. This feels like a config error in the manifest rather than Besu - does that sound about right to you @matkt? I'd suggest going at this fixing one thing at at time:\r\n- maybe use our config on GCP and see if you can connect\r\n- if that works try just the Besu etc-classic one first and see whats different\r\n- when thats good, add the site config in on port 8080\r\n\r\nCheers\r\nJosh",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/648531254/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/648560421",
    "html_url": "https://github.com/hyperledger/besu/issues/1084#issuecomment-648560421",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1084",
    "id": 648560421,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0ODU2MDQyMQ==",
    "user": {
      "login": "YazzyYaz",
      "id": 9094204,
      "node_id": "MDQ6VXNlcjkwOTQyMDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9094204?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YazzyYaz",
      "html_url": "https://github.com/YazzyYaz",
      "followers_url": "https://api.github.com/users/YazzyYaz/followers",
      "following_url": "https://api.github.com/users/YazzyYaz/following{/other_user}",
      "gists_url": "https://api.github.com/users/YazzyYaz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YazzyYaz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YazzyYaz/subscriptions",
      "organizations_url": "https://api.github.com/users/YazzyYaz/orgs",
      "repos_url": "https://api.github.com/users/YazzyYaz/repos",
      "events_url": "https://api.github.com/users/YazzyYaz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YazzyYaz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-24T03:26:04Z",
    "updated_at": "2020-06-24T03:26:04Z",
    "author_association": "NONE",
    "body": "Hi @joshuafernandes my apologies, I've originally drafted a response to your comment from last week but for some reason it's not there. I guess I didn't click send.\r\n\r\nI was gonna say that it's not the formatting issue as this is only indented wrong because I copy pasted from a file to Github while deleting other parts of the config to narrow on the problem.\r\n\r\nI will test out the ingress file you showed me and follow your guideline here. Thank you very much for your detailed response, it's much appreciated!\r\n\r\nIt might something in the Ingress specific to GKE, I'll do my best to test the Ingress on my end and if I run out of ideas will contact GCE as well.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/648560421/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/652602195",
    "html_url": "https://github.com/hyperledger/besu/issues/1084#issuecomment-652602195",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1084",
    "id": 652602195,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MjYwMjE5NQ==",
    "user": {
      "login": "sambacha",
      "id": 32783916,
      "node_id": "MDQ6VXNlcjMyNzgzOTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/32783916?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sambacha",
      "html_url": "https://github.com/sambacha",
      "followers_url": "https://api.github.com/users/sambacha/followers",
      "following_url": "https://api.github.com/users/sambacha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sambacha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sambacha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sambacha/subscriptions",
      "organizations_url": "https://api.github.com/users/sambacha/orgs",
      "repos_url": "https://api.github.com/users/sambacha/repos",
      "events_url": "https://api.github.com/users/sambacha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sambacha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-01T19:22:20Z",
    "updated_at": "2020-07-01T19:22:20Z",
    "author_association": "NONE",
    "body": "Does this issue persist when connecting to any chain or deploying your own? ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/652602195/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/652675551",
    "html_url": "https://github.com/hyperledger/besu/issues/1084#issuecomment-652675551",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1084",
    "id": 652675551,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MjY3NTU1MQ==",
    "user": {
      "login": "YazzyYaz",
      "id": 9094204,
      "node_id": "MDQ6VXNlcjkwOTQyMDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9094204?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YazzyYaz",
      "html_url": "https://github.com/YazzyYaz",
      "followers_url": "https://api.github.com/users/YazzyYaz/followers",
      "following_url": "https://api.github.com/users/YazzyYaz/following{/other_user}",
      "gists_url": "https://api.github.com/users/YazzyYaz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YazzyYaz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YazzyYaz/subscriptions",
      "organizations_url": "https://api.github.com/users/YazzyYaz/orgs",
      "repos_url": "https://api.github.com/users/YazzyYaz/repos",
      "events_url": "https://api.github.com/users/YazzyYaz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YazzyYaz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-01T22:23:46Z",
    "updated_at": "2020-07-01T22:23:46Z",
    "author_association": "NONE",
    "body": "I haven't tested it on anything except ETC network on GCE.\r\n\r\nI tried referring to the Ingress provided but if I don't have `kubernetes.io/ingress.class: \"gce\"` on my Ingress but that disables the Ingress on GCE and can't work within their system.\r\n\r\nIt could be an issue just on GCE as I haven't tested on other cloud providers. I can open a ticket with Google Cloud if anything",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/652675551/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/658988322",
    "html_url": "https://github.com/hyperledger/besu/issues/1084#issuecomment-658988322",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1084",
    "id": 658988322,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1ODk4ODMyMg==",
    "user": {
      "login": "YazzyYaz",
      "id": 9094204,
      "node_id": "MDQ6VXNlcjkwOTQyMDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9094204?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YazzyYaz",
      "html_url": "https://github.com/YazzyYaz",
      "followers_url": "https://api.github.com/users/YazzyYaz/followers",
      "following_url": "https://api.github.com/users/YazzyYaz/following{/other_user}",
      "gists_url": "https://api.github.com/users/YazzyYaz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YazzyYaz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YazzyYaz/subscriptions",
      "organizations_url": "https://api.github.com/users/YazzyYaz/orgs",
      "repos_url": "https://api.github.com/users/YazzyYaz/repos",
      "events_url": "https://api.github.com/users/YazzyYaz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YazzyYaz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-15T20:20:51Z",
    "updated_at": "2020-07-15T20:20:51Z",
    "author_association": "NONE",
    "body": "@sambacha @joshuafernandes I tried to debug the issue by taking the IP address of the available service for Besu (mapped from container port 8545 to port 80) on the endpoint: http://35.223.202.158/\r\n\r\nI then added an A Record for https://besu.ethercluster.com to this port via CloudFlare and it doesn't seem to fix the issue either. Getting a 404 still on HTTPS/SSL. I wonder if my settings in CloudFlare also affecting this.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/658988322/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/658989836",
    "html_url": "https://github.com/hyperledger/besu/issues/1084#issuecomment-658989836",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1084",
    "id": 658989836,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1ODk4OTgzNg==",
    "user": {
      "login": "YazzyYaz",
      "id": 9094204,
      "node_id": "MDQ6VXNlcjkwOTQyMDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9094204?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YazzyYaz",
      "html_url": "https://github.com/YazzyYaz",
      "followers_url": "https://api.github.com/users/YazzyYaz/followers",
      "following_url": "https://api.github.com/users/YazzyYaz/following{/other_user}",
      "gists_url": "https://api.github.com/users/YazzyYaz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YazzyYaz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YazzyYaz/subscriptions",
      "organizations_url": "https://api.github.com/users/YazzyYaz/orgs",
      "repos_url": "https://api.github.com/users/YazzyYaz/repos",
      "events_url": "https://api.github.com/users/YazzyYaz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YazzyYaz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-15T20:24:01Z",
    "updated_at": "2020-07-15T20:24:01Z",
    "author_association": "NONE",
    "body": "Actually, funny enough, it works now if I specify in my CloudFlare settings for SSL \"Flexible\" vs \"Full Encryption\". But switching to Flexible makes the endpoint work but disables the other endpoints I have. Will need to dig deeper into CloudFlare.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/658989836/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/658990342",
    "html_url": "https://github.com/hyperledger/besu/issues/1084#issuecomment-658990342",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1084",
    "id": 658990342,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1ODk5MDM0Mg==",
    "user": {
      "login": "YazzyYaz",
      "id": 9094204,
      "node_id": "MDQ6VXNlcjkwOTQyMDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9094204?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YazzyYaz",
      "html_url": "https://github.com/YazzyYaz",
      "followers_url": "https://api.github.com/users/YazzyYaz/followers",
      "following_url": "https://api.github.com/users/YazzyYaz/following{/other_user}",
      "gists_url": "https://api.github.com/users/YazzyYaz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YazzyYaz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YazzyYaz/subscriptions",
      "organizations_url": "https://api.github.com/users/YazzyYaz/orgs",
      "repos_url": "https://api.github.com/users/YazzyYaz/repos",
      "events_url": "https://api.github.com/users/YazzyYaz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YazzyYaz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-15T20:25:01Z",
    "updated_at": "2020-07-15T20:25:01Z",
    "author_association": "NONE",
    "body": "Has a Besu RPC endpoint over SSL been tested with CloudFlare before? CloudFlare encryption is probably the root cause here.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/658990342/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/665298095",
    "html_url": "https://github.com/hyperledger/besu/issues/1084#issuecomment-665298095",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1084",
    "id": 665298095,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NTI5ODA5NQ==",
    "user": {
      "login": "YazzyYaz",
      "id": 9094204,
      "node_id": "MDQ6VXNlcjkwOTQyMDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9094204?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YazzyYaz",
      "html_url": "https://github.com/YazzyYaz",
      "followers_url": "https://api.github.com/users/YazzyYaz/followers",
      "following_url": "https://api.github.com/users/YazzyYaz/following{/other_user}",
      "gists_url": "https://api.github.com/users/YazzyYaz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YazzyYaz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YazzyYaz/subscriptions",
      "organizations_url": "https://api.github.com/users/YazzyYaz/orgs",
      "repos_url": "https://api.github.com/users/YazzyYaz/repos",
      "events_url": "https://api.github.com/users/YazzyYaz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YazzyYaz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-28T21:40:53Z",
    "updated_at": "2020-07-28T21:40:53Z",
    "author_association": "NONE",
    "body": "Hey all, does this guide help with this issue? https://besu.hyperledger.org/en/stable/HowTo/Configure/Configure-TLS/#create-the-known-servers-file\r\n\r\nIt says to connect securely to JSON-RPC endpoint of Besu over TLS, one needs to create a keystore file with trusted clients like curl, a dAPP, etc.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/665298095/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/665317922",
    "html_url": "https://github.com/hyperledger/besu/issues/1084#issuecomment-665317922",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1084",
    "id": 665317922,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NTMxNzkyMg==",
    "user": {
      "login": "joshuafernandes",
      "id": 3722503,
      "node_id": "MDQ6VXNlcjM3MjI1MDM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3722503?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/joshuafernandes",
      "html_url": "https://github.com/joshuafernandes",
      "followers_url": "https://api.github.com/users/joshuafernandes/followers",
      "following_url": "https://api.github.com/users/joshuafernandes/following{/other_user}",
      "gists_url": "https://api.github.com/users/joshuafernandes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/joshuafernandes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/joshuafernandes/subscriptions",
      "organizations_url": "https://api.github.com/users/joshuafernandes/orgs",
      "repos_url": "https://api.github.com/users/joshuafernandes/repos",
      "events_url": "https://api.github.com/users/joshuafernandes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/joshuafernandes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-28T22:21:43Z",
    "updated_at": "2020-07-28T22:21:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @YazzyYaz \r\n\r\nI've not tried it with Cloudflare myself, so am really curious to know what you find out.\r\n\r\n@rain-on @jframe thoughts on the above?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/665317922/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/666059186",
    "html_url": "https://github.com/hyperledger/besu/issues/1084#issuecomment-666059186",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1084",
    "id": 666059186,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NjA1OTE4Ng==",
    "user": {
      "login": "usmansaleem",
      "id": 669527,
      "node_id": "MDQ6VXNlcjY2OTUyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/669527?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/usmansaleem",
      "html_url": "https://github.com/usmansaleem",
      "followers_url": "https://api.github.com/users/usmansaleem/followers",
      "following_url": "https://api.github.com/users/usmansaleem/following{/other_user}",
      "gists_url": "https://api.github.com/users/usmansaleem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/usmansaleem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/usmansaleem/subscriptions",
      "organizations_url": "https://api.github.com/users/usmansaleem/orgs",
      "repos_url": "https://api.github.com/users/usmansaleem/repos",
      "events_url": "https://api.github.com/users/usmansaleem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/usmansaleem/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-30T02:58:05Z",
    "updated_at": "2020-07-30T02:58:05Z",
    "author_association": "MEMBER",
    "body": "Cloudflare's TLS setting \"flexible\" means encryption between browser and cloudflare. \"Full\" means browser -> cloudflare TLS and then cloudflare to Besu TLS where Besu has custom/self signed certificate. I suspect if you don't run Besu over TLS, then \"flexible\" setting would work.\r\n\r\nhttps://support.cloudflare.com/hc/en-us/articles/200170416-End-to-end-HTTPS-with-Cloudflare-Part-3-SSL-options#h_8afd8a8d-382d-4694-a2b2-44cbc9f637ef",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/666059186/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/667170660",
    "html_url": "https://github.com/hyperledger/besu/issues/1084#issuecomment-667170660",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1084",
    "id": 667170660,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NzE3MDY2MA==",
    "user": {
      "login": "YazzyYaz",
      "id": 9094204,
      "node_id": "MDQ6VXNlcjkwOTQyMDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9094204?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YazzyYaz",
      "html_url": "https://github.com/YazzyYaz",
      "followers_url": "https://api.github.com/users/YazzyYaz/followers",
      "following_url": "https://api.github.com/users/YazzyYaz/following{/other_user}",
      "gists_url": "https://api.github.com/users/YazzyYaz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YazzyYaz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YazzyYaz/subscriptions",
      "organizations_url": "https://api.github.com/users/YazzyYaz/orgs",
      "repos_url": "https://api.github.com/users/YazzyYaz/repos",
      "events_url": "https://api.github.com/users/YazzyYaz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YazzyYaz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-31T15:09:42Z",
    "updated_at": "2020-07-31T15:09:42Z",
    "author_association": "NONE",
    "body": "@usmansaleem sounds good, will investigate the CloudFlare option and report back. For now, I'm trying to debug this issue with Google Cloud's support team as it might be something related to the cloud provider as well. Will keep you all posted. Thanks so far for all your help.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/667170660/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/691290387",
    "html_url": "https://github.com/hyperledger/besu/issues/1084#issuecomment-691290387",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1084",
    "id": 691290387,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MTI5MDM4Nw==",
    "user": {
      "login": "YazzyYaz",
      "id": 9094204,
      "node_id": "MDQ6VXNlcjkwOTQyMDQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9094204?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/YazzyYaz",
      "html_url": "https://github.com/YazzyYaz",
      "followers_url": "https://api.github.com/users/YazzyYaz/followers",
      "following_url": "https://api.github.com/users/YazzyYaz/following{/other_user}",
      "gists_url": "https://api.github.com/users/YazzyYaz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/YazzyYaz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/YazzyYaz/subscriptions",
      "organizations_url": "https://api.github.com/users/YazzyYaz/orgs",
      "repos_url": "https://api.github.com/users/YazzyYaz/repos",
      "events_url": "https://api.github.com/users/YazzyYaz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/YazzyYaz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-11T20:09:48Z",
    "updated_at": "2020-09-11T20:09:48Z",
    "author_association": "NONE",
    "body": "Closing this as I think the issue is in using the Ingress template for GCE. It works when using NginX. Thanks everyone!",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/691290387/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
