{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/5215",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/5215/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/5215/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/5215/events",
  "html_url": "https://github.com/hyperledger/besu/issues/5215",
  "id": 1623100853,
  "node_id": "I_kwDODE2jmc5gvo21",
  "number": 5215,
  "title": "Smartcontracts complied for Berlin EVM fail in private network on Berlin milestone.",
  "user": {
    "login": "jorgesjv",
    "id": 81416738,
    "node_id": "MDQ6VXNlcjgxNDE2NzM4",
    "avatar_url": "https://avatars.githubusercontent.com/u/81416738?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jorgesjv",
    "html_url": "https://github.com/jorgesjv",
    "followers_url": "https://api.github.com/users/jorgesjv/followers",
    "following_url": "https://api.github.com/users/jorgesjv/following{/other_user}",
    "gists_url": "https://api.github.com/users/jorgesjv/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jorgesjv/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jorgesjv/subscriptions",
    "organizations_url": "https://api.github.com/users/jorgesjv/orgs",
    "repos_url": "https://api.github.com/users/jorgesjv/repos",
    "events_url": "https://api.github.com/users/jorgesjv/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jorgesjv/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 1921587647,
      "node_id": "MDU6TGFiZWwxOTIxNTg3NjQ3",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamGroot",
      "name": "TeamGroot",
      "color": "1d76db",
      "default": false,
      "description": "GH issues worked on by Groot Team"
    },
    {
      "id": 5290172097,
      "node_id": "LA_kwDODE2jmc8AAAABO1GewQ",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/non%20mainnet%20(private%20networks)",
      "name": "non mainnet (private networks)",
      "color": "0052cc",
      "default": false,
      "description": "not related to mainnet features - covers privacy, permissioning, IBFT2, QBFT"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "gfukushima",
    "id": 25556862,
    "node_id": "MDQ6VXNlcjI1NTU2ODYy",
    "avatar_url": "https://avatars.githubusercontent.com/u/25556862?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gfukushima",
    "html_url": "https://github.com/gfukushima",
    "followers_url": "https://api.github.com/users/gfukushima/followers",
    "following_url": "https://api.github.com/users/gfukushima/following{/other_user}",
    "gists_url": "https://api.github.com/users/gfukushima/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gfukushima/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gfukushima/subscriptions",
    "organizations_url": "https://api.github.com/users/gfukushima/orgs",
    "repos_url": "https://api.github.com/users/gfukushima/repos",
    "events_url": "https://api.github.com/users/gfukushima/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gfukushima/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "gfukushima",
      "id": 25556862,
      "node_id": "MDQ6VXNlcjI1NTU2ODYy",
      "avatar_url": "https://avatars.githubusercontent.com/u/25556862?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gfukushima",
      "html_url": "https://github.com/gfukushima",
      "followers_url": "https://api.github.com/users/gfukushima/followers",
      "following_url": "https://api.github.com/users/gfukushima/following{/other_user}",
      "gists_url": "https://api.github.com/users/gfukushima/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gfukushima/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gfukushima/subscriptions",
      "organizations_url": "https://api.github.com/users/gfukushima/orgs",
      "repos_url": "https://api.github.com/users/gfukushima/repos",
      "events_url": "https://api.github.com/users/gfukushima/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gfukushima/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2023-03-14T09:45:18Z",
  "updated_at": "2023-05-29T03:06:48Z",
  "closed_at": "2023-05-09T02:06:24Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nIn a private Besu network that transitioned to Berlin in the past we get fails with contracts compiled for Berlin EVM with Remix. The same contracts work OK when compiled for Constantinople.\r\n\r\n### Steps to Reproduce (Bug)\r\n1. Private network running\r\n2. Update to Berlin Protocol from ConstantinopleFixBlock.\r\n3. Test with SC compiled for EVM Berlin with transfer function and failed.\r\n4. Test with SC compiled for EVM Constantinople with transfer function and success.\r\n\r\n#### genesis.json\r\n```\r\n{\r\n  \"config\" : {\r\n    \"chainId\" : 1972,\r\n    \"constantinopleFixBlock\": 0,\r\n    \"berlinBlock\":10782300,\r\n    \"ibft2\" : {\r\n      \"blockperiodseconds\" : 5,\r\n      \"epochlength\" : 30000,\r\n      \"requesttimeoutseconds\" : 10\r\n    },\r\n    \"transitions\": {\r\n      \"ibft2\": [\r\n        {\r\n          \"block\": 8943109,\r\n          \"validators\":[\r\n            \"0x555709de3d8f26f35143ef414c68b9459972575c\",\r\n            \"0xb4ce159828a61066c072f8f4b37285b453cca86a\",\r\n            \"0x5fcc72d50ca999a5472bb196c22d42cef8b13725\",\r\n            \"0x65889c20b9451979894f01868162655aec35dbcf\"\r\n          ]\r\n        }\r\n      ]\r\n    }\r\n  },\r\n  \"nonce\" : \"0x0\",\r\n  \"timestamp\" : \"0x58ee40ba\",\r\n  \"gasLimit\" : \"0x1fffffffffffff\",\r\n  \"difficulty\" : \"0x1\",\r\n  \"mixHash\" : \"0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365\",\r\n  \"coinbase\" : \"0x2491522b83c8fFE33bB6156fb9385799FBf39a23\",\r\n  \"alloc\" : {\r\n    \"0x2491522b83c8fFE33bB6156fb9385799FBf39a23\": {\r\n      \"balance\" : \"90000000000000000000000000000000000000000000000000000000000\"\r\n    },\r\n    \"7f2843A8F0Cffb51f5dc2A2026Ef5948eE155856\" : {\r\n      \"balance\" : \"90000000000000000000000\"\r\n    },\r\n    \"Cc3196FD83A4ea41E5581AA57a7898e54B95CE44\" : {\r\n      \"balance\" : \"90000000000000000000000\"\r\n    },\r\n    \"fC288399ee6225BfA6fC3252a9f0DBbFD66b6A42\" : {\r\n      \"balance\" : \"90000000000000000000000\"\r\n    },\r\n    \"0x0000000000000000000000000000000000008888\": {\r\n      \"comment\": \"Account Ingress smart contract\",\r\n      \"balance\": \"0\",\r\n      \"code\": \"60806040...\",\r\n      \"storage\": {\r\n        \"0x0000000000000000000000000000000000000000000000000000000000000000\": \"0x72756c6573000000000000000000000000000000000000000000000000000000\",\r\n        \"0x0000000000000000000000000000000000000000000000000000000000000001\": \"0x61646d696e697374726174696f6e000000000000000000000000000000000000\",\r\n        \"0x0000000000000000000000000000000000000000000000000000000000000004\": \"0x0f4240\"\r\n      }\r\n    },\r\n    \"0x0000000000000000000000000000000000009999\": {\r\n      \"comment\": \"Node Ingress smart contract\",\r\n      \"balance\": \"0\",\r\n      \"code\": \"6080...\",\r\n      \"storage\": {\r\n        \"0x0000000000000000000000000000000000000000000000000000000000000000\": \"0x72756c6573000000000000000000000000000000000000000000000000000000\",\r\n        \"0x0000000000000000000000000000000000000000000000000000000000000001\": \"0x61646d696e697374726174696f6e000000000000000000000000000000000000\",\r\n        \"0x0000000000000000000000000000000000000000000000000000000000000004\": \"0x0f4240\"\r\n      }\r\n    }\r\n  },\r\n  \"extraData\" : \"0xf87ea00000000000000000000000000000000000000000000000000000000000000000f85494b4ce159828a61066c072f8f4b37285b453cca86a945fcc72d50ca999a5472bb196c22d42cef8b1372594555709de3d8f26f35143ef414c68b9459972575c9465889c20b9451979894f01868162655aec35dbcf808400000000c0\"\r\n}\r\n```\r\n### test.sol\r\n```\r\n// SPDX-License-Identifier: MIT\r\npragma solidity ^0.8.17;\r\n\r\ncontract ReceiveEther {\r\n\r\n    // Function to receive Ether. msg.data must be empty\r\n    receive() external payable {}\r\n\r\n    // Fallback function is called when msg.data is not empty\r\n    fallback() external payable {}\r\n\r\n    function getBalance() public view returns (uint) {\r\n        return address(this).balance;\r\n    }\r\n}\r\n\r\ncontract SendEther {\r\n    function sendViaTransfer(address payable _to) public payable {\r\n        // This function is no longer recommended for sending Ether.\r\n        _to.transfer(msg.value);\r\n    }\r\n\r\n    function sendViaSend(address payable _to) public payable {\r\n        // Send returns a boolean value indicating success or failure.\r\n        // This function is not recommended for sending Ether.\r\n        bool sent = _to.send(msg.value);\r\n        require(sent, \"Failed to send Ether\");\r\n    }\r\n\r\n    function sendViaCall(address payable _to) public payable {\r\n        // Call returns a boolean value indicating success or failure.\r\n        // This is the current recommended method to use.\r\n        (bool sent, bytes memory data) = _to.call{value: msg.value}(\"\");\r\n        require(sent, \"Failed to send Ether\");\r\n    }\r\n\r\n        // Function to receive Ether. msg.data must be empty\r\n    receive() external payable {}\r\n\r\n    // Fallback function is called when msg.data is not empty\r\n    fallback() external payable {}\r\n}\r\n```\r\n#### Logs from node\r\n```\r\n2023-03-13 12:27:09.536+00:00 | main | INFO  | Besu | Using the Java implementation of alt bn128\r\n2023-03-13 12:27:09.546+00:00 | main | INFO  | Besu | Using the native implementation of the signature algorithm\r\n2023-03-13 12:27:09.552+00:00 | main | INFO  | Besu | Using the native implementation of the blake2bf algorithm\r\n2023-03-13 12:27:09.558+00:00 | main | INFO  | Besu | Starting Besu version: besu/v22.7.6/linux-x86_64/openjdk-java-11\r\n2023-03-13 12:27:10.304+00:00 | main | INFO  | Besu | Static Nodes file = /mnt/okapi/besu/static-nodes.json\r\n2023-03-13 12:27:10.309+00:00 | main | INFO  | StaticNodesParser | StaticNodes file /mnt/okapi/besu/static-nodes.json does not exist, no static connections will be created.\r\n2023-03-13 12:27:10.309+00:00 | main | INFO  | Besu | Connecting to 0 static nodes.\r\n2023-03-13 12:27:10.314+00:00 | main | INFO  | Besu | Security Module: localfile\r\n2023-03-13 12:27:10.344+00:00 | main | INFO  | DatabaseMetadata | Lookup database metadata file in data directory: /mnt/okapi/besu\r\n2023-03-13 12:27:10.451+00:00 | main | INFO  | RocksDBKeyValueStorageFactory | Existing database detected at /mnt/okapi/besu. Version 1\r\n2023-03-13 12:27:15.497+00:00 | main | WARN  | Besu | --tx-pool-future-max-by-account has been deprecated, use --tx-pool-limit-by-account-percentage instead.\r\n2023-03-13 12:27:15.558+00:00 | main | INFO  | KeyPairUtil | Loaded public key 0x2f2b921f4e3b52783ee34fbbbee817110d8b1662e6e1eac15009c77bf6932ec74635523350cdc6a7047d6834e64e841484f949c44aaf1153af674bc49b408aa5 from /mnt/okapi/besu/keys/besu/key\r\n2023-03-13 12:27:17.613+00:00 | main | INFO  | AbstractAltBnPrecompiledContract | Native alt bn128 not available\r\n2023-03-13 12:27:17.616+00:00 | main | INFO  | AbstractAltBnPrecompiledContract | Native alt bn128 not available\r\n2023-03-13 12:27:17.618+00:00 | main | INFO  | AbstractAltBnPrecompiledContract | Native alt bn128 not available\r\n2023-03-13 12:27:17.670+00:00 | main | INFO  | AbstractAltBnPrecompiledContract | Native alt bn128 not available\r\n2023-03-13 12:27:17.671+00:00 | main | INFO  | AbstractAltBnPrecompiledContract | Native alt bn128 not available\r\n2023-03-13 12:27:17.671+00:00 | main | INFO  | AbstractAltBnPrecompiledContract | Native alt bn128 not available\r\n2023-03-13 12:27:17.674+00:00 | main | INFO  | AbstractAltBnPrecompiledContract | Native alt bn128 not available\r\n2023-03-13 12:27:17.675+00:00 | main | INFO  | AbstractAltBnPrecompiledContract | Native alt bn128 not available\r\n2023-03-13 12:27:17.677+00:00 | main | INFO  | AbstractAltBnPrecompiledContract | Native alt bn128 not available\r\n2023-03-13 12:27:17.677+00:00 | main | INFO  | AbstractAltBnPrecompiledContract | Native alt bn128 not available\r\n2023-03-13 12:27:17.677+00:00 | main | INFO  | AbstractAltBnPrecompiledContract | Native alt bn128 not available\r\n2023-03-13 12:27:17.678+00:00 | main | INFO  | AbstractAltBnPrecompiledContract | Native alt bn128 not available\r\n2023-03-13 12:27:17.711+00:00 | main | INFO  | ProtocolScheduleBuilder | Protocol schedule created with milestones: [Petersburg: 0, Petersburg: 8943109, Berlin: 10782300]\r\n2023-03-13 12:27:18.097+00:00 | main | INFO  | TransactionPoolFactory | Enabling transaction pool\r\n2023-03-13 12:27:18.159+00:00 | main | INFO  | BesuControllerBuilder | TTD difficulty is not present, creating initial sync phase for PoW\r\n2023-03-13 12:27:18.721+00:00 | main | INFO  | RunnerBuilder | Detecting NAT service.\r\n2023-03-13 12:27:20.387+00:00 | main | INFO  | Runner | Starting external services ...\r\n2023-03-13 12:27:20.388+00:00 | main | INFO  | MetricsHttpService | Starting metrics http service on 0.0.0.0:9545\r\n2023-03-13 12:27:20.665+00:00 | main | INFO  | JsonRpcHttpService | Starting JSON-RPC service on 0.0.0.0:8545\r\n2023-03-13 12:27:20.664+00:00 | vert.x-eventloop-thread-1 | INFO  | MetricsHttpService | Metrics service started and listening on 0.0.0.0:9545\r\n2023-03-13 12:27:20.844+00:00 | vert.x-eventloop-thread-1 | INFO  | JsonRpcHttpService | JSON-RPC service started and listening on 0.0.0.0:8545\r\n2023-03-13 12:27:20.849+00:00 | main | INFO  | WebSocketService | Starting Websocket service on 0.0.0.0:8546\r\n2023-03-13 12:27:20.855+00:00 | vert.x-eventloop-thread-1 | INFO  | WebSocketService | Websocket service started and listening on 0.0.0.0:8546\r\n2023-03-13 12:27:20.859+00:00 | main | INFO  | AutoTransactionLogBloomCachingService | Starting auto transaction log bloom caching service.\r\n2023-03-13 12:27:20.860+00:00 | main | INFO  | LogBloomCacheMetadata | Lookup cache metadata file in data directory: /mnt/okapi/besu/caches\r\n2023-03-13 12:27:20.883+00:00 | main | INFO  | Runner | Starting Ethereum main loop ...\r\n2023-03-13 12:27:20.883+00:00 | main | INFO  | NatService | No NAT environment detected so no service could be started\r\n2023-03-13 12:27:20.884+00:00 | main | INFO  | NetworkRunner | Starting Network.\r\n2023-03-13 12:27:20.950+00:00 | nioEventLoopGroup-2-1 | INFO  | RlpxAgent | P2P RLPx agent started and listening on /0:0:0:0:0:0:0:0:30303.\r\n2023-03-13 12:27:20.952+00:00 | main | INFO  | PeerDiscoveryAgent | Starting peer discovery agent on host=0.0.0.0, port=30303\r\n2023-03-13 12:27:21.778+00:00 | vert.x-eventloop-thread-1 | INFO  | VertxPeerDiscoveryAgent | Started peer discovery agent successfully, on effective host=0:0:0:0:0:0:0:0%0 and port=30303\r\n2023-03-13 12:27:21.781+00:00 | vert.x-eventloop-thread-1 | INFO  | PeerDiscoveryAgent | P2P peer discovery agent started and listening on /0:0:0:0:0:0:0:0%0:30303\r\n2023-03-13 12:27:23.126+00:00 | vert.x-eventloop-thread-1 | INFO  | PeerDiscoveryAgent | Writing node record to disk. NodeRecord{seq=135, publicKey=0x032f2b921f4e3b52783ee34fbbbee817110d8b1662e6e1eac15009c77bf6932ec7, udpAddress=Optional[/180.49.47.19:30303], tcpAddress=Optional[/180.49.47.19:30303], asBase64=-Ji4QIqnf8Ks0FFR89grumWgoiuFDfRAJsBSv8JY-e-5Qxe_at1Nvfr-heK0nv-Fwi-72VoiASE2akD8S3zlVjDyVnmBh4NldGjHxoRmEhQpgIJpZIJ2NIJpcIS0MS8TiXNlY3AyNTZrMaEDLyuSH047Ung-40-7vugXEQ2LFmLm4erBUAnHe_aTLseDdGNwgnZfg3VkcIJ2Xw, nodeId=0x53bd63b09e3a8ca8e824ec52e8033804e9ab3901cb3ef9c762df8c1b188b8aba, customFields={tcp=30303, udp=30303, ip=0xb4312f13, eth=[[0x66121429, 0x]], id=V4, secp256k1=0x032f2b921f4e3b52783ee34fbbbee817110d8b1662e6e1eac15009c77bf6932ec7}}\r\n2023-03-13 12:27:23.245+00:00 | main | INFO  | DefaultP2PNetwork | Enode URL enode://2f2b921f4e3b52783ee34fbbbee817110d8b1662e6e1eac15009c77bf6932ec74635523350cdc6a7047d6834e64e841484f949c44aaf1153af674bc49b408aa5@180.49.47.19:30303\r\n2023-03-13 12:27:23.246+00:00 | main | INFO  | DefaultP2PNetwork | Node address 0xe8033804e9ab3901cb3ef9c762df8c1b188b8aba\r\n2023-03-13 12:27:23.260+00:00 | main | INFO  | DefaultSynchronizer | Starting synchronizer.\r\n2023-03-13 12:27:23.286+00:00 | main | INFO  | FullSyncDownloader | Starting full sync.\r\n2023-03-13 12:27:23.287+00:00 | main | INFO  | FullSyncTargetManager | No sync target, waiting for peers. Current peers: 0\r\n2023-03-13 12:27:24.224+00:00 | nioEventLoopGroup-3-2 | INFO  | FullSyncTargetManager | No sync target, waiting for peers. Current peers: 4\r\n2023-03-13 12:27:25.009+00:00 | main | INFO  | Runner | Ethereum main loop is up.\r\n2023-03-13 12:27:30.039+00:00 | EthScheduler-Workers-0 | INFO  | PersistBlockTask | Imported #13,718,739 / 0 tx / 0 om / 0 (0.0%) gas / (0x932845caa51b95682c58a225f251398be23bea1452ebbccf6c05c9589e6fca26) in 0.103s. Peers: 4\r\n2023-03-13 12:27:35.268+00:00 | EthScheduler-Workers-1 | INFO  | PersistBlockTask | Imported #13,718,740 / 0 tx / 0 om / 0 (0.0%) gas / (0x2e3c665766699ba5493325ed5c1ecd8d8d99456a7475294415f8647304a34b6d) in 0.049s. Peers: 6\r\n2023-03-13 12:27:39.115+00:00 | EthScheduler-Workers-2 | INFO  | PersistBlockTask | Imported #13,718,741 / 0 tx / 0 om / 0 (0.0%) gas / (0x61d524bfd83963c65a0b20393fefe27bd2ef6a3ad04a55fbf365bd442b5adf56) in 0.053s. Peers: 6\r\n2023-03-13 12:27:44.084+00:00 | EthScheduler-Workers-3 | INFO  | PersistBlockTask | Imported #13,718,742 / 0 tx / 0 om / 0 (0.0%) gas / (0x2d6bf285c49de5a17bc6298dc139e405a39667e7397001ee455545a5466f9ccc) in 0.034s. Peers: 6\r\n2023-03-13 12:27:49.092+00:00 | EthScheduler-Workers-4 | INFO  | PersistBlockTask | Imported #13,718,743 / 0 tx / 0 om / 0 (0.0%) gas / (0x2c2252fe722551212b4ca5d9278aca1ae016dddce4376a0a06c6c19bc16ce361) in 0.042s. Peers: 6\r\n\r\n```\r\n```\r\n2023-03-13 12:27:17.711+00:00 | main | INFO  | ProtocolScheduleBuilder | Protocol schedule created with milestones: [Petersburg: 0, Petersburg: 8943109, Berlin: 10782300]\r\n```\r\nThis log proves the Berlin milestone passed long ago.\r\n\r\nAnd the moment it was updated to Berlín.\r\n<img width=\"808\" alt=\"Captura_transicion_berlin\" src=\"https://user-images.githubusercontent.com/81416738/224959942-b33f9716-9841-4881-9db9-3c4fcdd505b8.PNG\">\r\n\r\n\r\nIn order to test it in Remix IDE, i compiled the SC for Berlin EVM version and call sendViaTransfer, sendViaCall and sendViaSend functions, and all failed.\r\n<img width=\"609\" alt=\"TX_failed\" src=\"https://user-images.githubusercontent.com/81416738/224960187-0816889e-788a-4b46-b7e9-3944e768ddd6.PNG\">\r\n\r\nAnd when i compiled the same SC for Constantinople EVM version, and call the same send functions, it worked.\r\n<img width=\"582\" alt=\"TX_success\" src=\"https://user-images.githubusercontent.com/81416738/224960271-d511dec6-2465-4627-bc9b-6beaeb505824.PNG\">\r\n\r\n\r\n### Versions \r\n* Software version: v22.7.6\r\n* Java version: openjdk-java-11",
  "closed_by": {
    "login": "gfukushima",
    "id": 25556862,
    "node_id": "MDQ6VXNlcjI1NTU2ODYy",
    "avatar_url": "https://avatars.githubusercontent.com/u/25556862?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gfukushima",
    "html_url": "https://github.com/gfukushima",
    "followers_url": "https://api.github.com/users/gfukushima/followers",
    "following_url": "https://api.github.com/users/gfukushima/following{/other_user}",
    "gists_url": "https://api.github.com/users/gfukushima/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gfukushima/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gfukushima/subscriptions",
    "organizations_url": "https://api.github.com/users/gfukushima/orgs",
    "repos_url": "https://api.github.com/users/gfukushima/repos",
    "events_url": "https://api.github.com/users/gfukushima/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gfukushima/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/5215/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/5215/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1524357195",
    "html_url": "https://github.com/hyperledger/besu/issues/5215#issuecomment-1524357195",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5215",
    "id": 1524357195,
    "node_id": "IC_kwDODE2jmc5a29hL",
    "user": {
      "login": "gfukushima",
      "id": 25556862,
      "node_id": "MDQ6VXNlcjI1NTU2ODYy",
      "avatar_url": "https://avatars.githubusercontent.com/u/25556862?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gfukushima",
      "html_url": "https://github.com/gfukushima",
      "followers_url": "https://api.github.com/users/gfukushima/followers",
      "following_url": "https://api.github.com/users/gfukushima/following{/other_user}",
      "gists_url": "https://api.github.com/users/gfukushima/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gfukushima/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gfukushima/subscriptions",
      "organizations_url": "https://api.github.com/users/gfukushima/orgs",
      "repos_url": "https://api.github.com/users/gfukushima/repos",
      "events_url": "https://api.github.com/users/gfukushima/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gfukushima/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-27T01:10:58Z",
    "updated_at": "2023-04-27T01:15:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @jorgesjv I've set up an environment to replicate your issue and it still happens on the latest version of besu. What I've noticed is that when you enable the trace logs from besu you can see the contract call gets this logs raised in besu: \"MessageFrame evaluation halted because of INSUFFICIENT_GAS\"\r\nSo if you're working with a wallet like metamask you can probably edit the the gas limit you're giving to the transaction.\r\nIt's likely that you've seen issues after going through Berlin because some opcodes had gas prices increased in Berlin.\r\nYou can find some of the informations of why this transaction might require more gas after berlin here:\r\nhttps://eips.ethereum.org/EIPS/eip-2929\r\nAnd the difficulty of calculating a estimated gas limit (which is hard to get accurate) here:\r\nhttps://github.com/trufflesuite/ganache-cli-archive/releases/tag/v6.4.2\r\n\r\nThat said, there might be improvements that we could do on our side to provide a better gas limit estimation but it will require further investigation.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1524357195/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1524670010",
    "html_url": "https://github.com/hyperledger/besu/issues/5215#issuecomment-1524670010",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5215",
    "id": 1524670010,
    "node_id": "IC_kwDODE2jmc5a4J46",
    "user": {
      "login": "gfukushima",
      "id": 25556862,
      "node_id": "MDQ6VXNlcjI1NTU2ODYy",
      "avatar_url": "https://avatars.githubusercontent.com/u/25556862?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gfukushima",
      "html_url": "https://github.com/gfukushima",
      "followers_url": "https://api.github.com/users/gfukushima/followers",
      "following_url": "https://api.github.com/users/gfukushima/following{/other_user}",
      "gists_url": "https://api.github.com/users/gfukushima/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gfukushima/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gfukushima/subscriptions",
      "organizations_url": "https://api.github.com/users/gfukushima/orgs",
      "repos_url": "https://api.github.com/users/gfukushima/repos",
      "events_url": "https://api.github.com/users/gfukushima/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gfukushima/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-27T04:12:15Z",
    "updated_at": "2023-04-27T04:27:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "Also I just noticed that you've called the Constantinople version of the contract passing 0 as value, if you do the same for Berlin it the call will be successful. The same applies for the contrary if you call the contract compiled to Constantinople passing 5 ethers (5000000000000000000 wei) as value it will fail.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1524670010/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1539287189",
    "html_url": "https://github.com/hyperledger/besu/issues/5215#issuecomment-1539287189",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5215",
    "id": 1539287189,
    "node_id": "IC_kwDODE2jmc5bv6iV",
    "user": {
      "login": "gfukushima",
      "id": 25556862,
      "node_id": "MDQ6VXNlcjI1NTU2ODYy",
      "avatar_url": "https://avatars.githubusercontent.com/u/25556862?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gfukushima",
      "html_url": "https://github.com/gfukushima",
      "followers_url": "https://api.github.com/users/gfukushima/followers",
      "following_url": "https://api.github.com/users/gfukushima/following{/other_user}",
      "gists_url": "https://api.github.com/users/gfukushima/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gfukushima/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gfukushima/subscriptions",
      "organizations_url": "https://api.github.com/users/gfukushima/orgs",
      "repos_url": "https://api.github.com/users/gfukushima/repos",
      "events_url": "https://api.github.com/users/gfukushima/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gfukushima/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-09T02:06:22Z",
    "updated_at": "2023-05-09T02:06:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing due to inactivity. Please feel free to re-open if necessary.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1539287189/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1554107942",
    "html_url": "https://github.com/hyperledger/besu/issues/5215#issuecomment-1554107942",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5215",
    "id": 1554107942,
    "node_id": "IC_kwDODE2jmc5coc4m",
    "user": {
      "login": "jorgesanjose",
      "id": 47521746,
      "node_id": "MDQ6VXNlcjQ3NTIxNzQ2",
      "avatar_url": "https://avatars.githubusercontent.com/u/47521746?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jorgesanjose",
      "html_url": "https://github.com/jorgesanjose",
      "followers_url": "https://api.github.com/users/jorgesanjose/followers",
      "following_url": "https://api.github.com/users/jorgesanjose/following{/other_user}",
      "gists_url": "https://api.github.com/users/jorgesanjose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jorgesanjose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jorgesanjose/subscriptions",
      "organizations_url": "https://api.github.com/users/jorgesanjose/orgs",
      "repos_url": "https://api.github.com/users/jorgesanjose/repos",
      "events_url": "https://api.github.com/users/jorgesanjose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jorgesanjose/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-19T07:00:10Z",
    "updated_at": "2023-05-19T07:00:10Z",
    "author_association": "NONE",
    "body": "Hi @gfukushima, sorry for the delay.\r\nThanks for the info, i will check it out and test it again these days.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1554107942/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1562727000",
    "html_url": "https://github.com/hyperledger/besu/issues/5215#issuecomment-1562727000",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5215",
    "id": 1562727000,
    "node_id": "IC_kwDODE2jmc5dJVJY",
    "user": {
      "login": "jorgesanjose",
      "id": 47521746,
      "node_id": "MDQ6VXNlcjQ3NTIxNzQ2",
      "avatar_url": "https://avatars.githubusercontent.com/u/47521746?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jorgesanjose",
      "html_url": "https://github.com/jorgesanjose",
      "followers_url": "https://api.github.com/users/jorgesanjose/followers",
      "following_url": "https://api.github.com/users/jorgesanjose/following{/other_user}",
      "gists_url": "https://api.github.com/users/jorgesanjose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jorgesanjose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jorgesanjose/subscriptions",
      "organizations_url": "https://api.github.com/users/jorgesanjose/orgs",
      "repos_url": "https://api.github.com/users/jorgesanjose/repos",
      "events_url": "https://api.github.com/users/jorgesanjose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jorgesanjose/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-25T11:17:31Z",
    "updated_at": "2023-05-25T11:17:31Z",
    "author_association": "NONE",
    "body": "Hi @gfukushima, i've already test it, and you were right.\r\nIt was a gas problem, i`ve increaded the gas limit up to 300000 and both versions were successful.\r\nMy Metamask, by default, set gas limit under the necesary for the transactions and have to edited for the purpose.\r\n\r\nThanks a lot!",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1562727000/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1564001895",
    "html_url": "https://github.com/hyperledger/besu/issues/5215#issuecomment-1564001895",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5215",
    "id": 1564001895,
    "node_id": "IC_kwDODE2jmc5dOMZn",
    "user": {
      "login": "jorgesanjose",
      "id": 47521746,
      "node_id": "MDQ6VXNlcjQ3NTIxNzQ2",
      "avatar_url": "https://avatars.githubusercontent.com/u/47521746?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jorgesanjose",
      "html_url": "https://github.com/jorgesanjose",
      "followers_url": "https://api.github.com/users/jorgesanjose/followers",
      "following_url": "https://api.github.com/users/jorgesanjose/following{/other_user}",
      "gists_url": "https://api.github.com/users/jorgesanjose/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jorgesanjose/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jorgesanjose/subscriptions",
      "organizations_url": "https://api.github.com/users/jorgesanjose/orgs",
      "repos_url": "https://api.github.com/users/jorgesanjose/repos",
      "events_url": "https://api.github.com/users/jorgesanjose/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jorgesanjose/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-26T08:22:50Z",
    "updated_at": "2023-05-26T08:22:50Z",
    "author_association": "NONE",
    "body": "Hi again @gfukushima.\r\nI've check again the results and i've notice something that i don't really understand.\r\nLike i've said before, when i send the transaction, i have to increase gas limit in Metamask, if not, the transaction fails; but after increase it and the transaction is succesfull, the transaction cost is below the previously estimated.\r\nFor example:\r\nEstimated Gas by Metamask:\r\n![image](https://github.com/hyperledger/besu/assets/47521746/6842bc22-aed3-42f7-8fdd-d3e792343f67)\r\nLater i have to increase the gas limit to 320520 (for example,just a zero at the end, just to be sure).\r\nAnd the transaction response:\r\n![image](https://github.com/hyperledger/besu/assets/47521746/94e232db-4151-4b3f-a73d-e0e483f774c1)\r\n\r\nThe transaction cost is below the estimated, but if i don't increase it, transaction fails.\r\n\r\nAny sense of that?\r\n\r\nThanks in advance.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1564001895/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1566433593",
    "html_url": "https://github.com/hyperledger/besu/issues/5215#issuecomment-1566433593",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5215",
    "id": 1566433593,
    "node_id": "IC_kwDODE2jmc5dXeE5",
    "user": {
      "login": "gfukushima",
      "id": 25556862,
      "node_id": "MDQ6VXNlcjI1NTU2ODYy",
      "avatar_url": "https://avatars.githubusercontent.com/u/25556862?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gfukushima",
      "html_url": "https://github.com/gfukushima",
      "followers_url": "https://api.github.com/users/gfukushima/followers",
      "following_url": "https://api.github.com/users/gfukushima/following{/other_user}",
      "gists_url": "https://api.github.com/users/gfukushima/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gfukushima/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gfukushima/subscriptions",
      "organizations_url": "https://api.github.com/users/gfukushima/orgs",
      "repos_url": "https://api.github.com/users/gfukushima/repos",
      "events_url": "https://api.github.com/users/gfukushima/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gfukushima/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-29T03:06:34Z",
    "updated_at": "2023-05-29T03:06:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "The link I shared in one of my comments above explains why that happens.\r\nRe-sharing: https://github.com/trufflesuite/ganache-cli-archive/releases/tag/v6.4.2 ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1566433593/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
