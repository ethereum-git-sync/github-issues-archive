{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/3863",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/3863/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/3863/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/3863/events",
  "html_url": "https://github.com/hyperledger/besu/issues/3863",
  "id": 1241420387,
  "node_id": "I_kwDODE2jmc5J_pJj",
  "number": 3863,
  "title": "Improve initial sync phase UX",
  "user": {
    "login": "fab-10",
    "id": 91944855,
    "node_id": "U_kgDOBXr3lw",
    "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fab-10",
    "html_url": "https://github.com/fab-10",
    "followers_url": "https://api.github.com/users/fab-10/followers",
    "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
    "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
    "organizations_url": "https://api.github.com/users/fab-10/orgs",
    "repos_url": "https://api.github.com/users/fab-10/repos",
    "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fab-10/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3013559202,
      "node_id": "MDU6TGFiZWwzMDEzNTU5MjAy",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/mainnet",
      "name": "mainnet",
      "color": "9D578C",
      "default": false,
      "description": ""
    },
    {
      "id": 3013615532,
      "node_id": "MDU6TGFiZWwzMDEzNjE1NTMy",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/logging",
      "name": "logging",
      "color": "5319e7",
      "default": false,
      "description": ""
    },
    {
      "id": 4328706977,
      "node_id": "LA_kwDODE2jmc8AAAABAgLToQ",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamChupa",
      "name": "TeamChupa",
      "color": "fbca04",
      "default": false,
      "description": "GH issues worked on by Chupacabara Team"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-05-19T08:25:59Z",
  "updated_at": "2023-03-06T22:32:21Z",
  "closed_at": "2023-03-06T22:32:21Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!-- Have you done the following? -->\r\n<!--   * read the Code of Conduct? By filing an Issue, you are expected to -->  \r\n<!--     comply with it, including treating everyone with respect: -->\r\n<!--     https://github.com/hyperledger/besu/blob/main/CODE_OF_CONDUCT.md -->\r\n<!--   * Reproduced the issue in the latest version of the software -->\r\n<!--   * Read the debugging docs: https://besu.hyperledger.org/en/stable/HowTo/Monitor/Logging/ -->\r\n<!--   * Duplicate Issue check:  https://github.com/search?q=+is%3Aissue+repo%3Ahyperledger/Besu -->\r\n<!-- Note:  Not all sections will apply to all issue types. -->\r\n\r\n### Description\r\nAs an first time Besu user, I want to have informative logs so that I can understand how long it takes to complete the initial sync. \r\n\r\n\r\n\r\n### Acceptance Criteria\r\n* Besu should clearly show the progess of the initial sync in the logs\r\n\r\n**Expected behavior:** [What you expect to happen]\r\n\r\nWe I start Besu for the first time, I want to easily understand how the initial sync is going by looking at the logs.\r\n\r\nThe optimal information is something like that: \r\n**Initial sync: 30% done, ETA: 18h 29m**\r\nbut if that is not possible, because we still do not know the total amount of work to be done, it is acceptable to show a progress in term of the work done till now:\r\n**Downloaded x world state nodes, and y blocks\"\r\n\r\nThese logs are meant to be consumed by human, to they should be print at regular interval, not too fast, but also not to slowly to avoid givin the false idea that Besu is doing nothing, for example every minute could be a good tradeoff.\r\n\r\nDuring the initial sync phase there should be no other logs at info level that pollute the logs and create confusion to the user, of course warnings and errors are always allowed.\r\n\r\n\r\n**Actual behavior:** [What actually happens]\r\n\r\nCurrently many first time user are confused by Besu logs during the initial sync, since there are some logs that are not informative, like:\r\n```\r\nDNSTimerTask [Timer-0] Refreshing DNS records with enrtree://AKA3AM6LPBYEUDMVNU3BSVQJ5AD45Y7YPOHJLEF6W26QOE4VTUDPE@all.mainnet.ethdisco.net\r\n```\r\nor\r\n```\r\nSyncTargetManager | Found common ancestor with peer Peer 0x8ba0932c425635a9f7... PeerReputation 100, validated? true, disconnected? false at block 14785691\r\n```\r\nthat are logged frequently and usually hide the other more informative logs about the number of blocks and world state nodes downloaded.\r\n\r\n",
  "closed_by": {
    "login": "non-fungible-nelson",
    "id": 85905982,
    "node_id": "MDQ6VXNlcjg1OTA1OTgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/non-fungible-nelson",
    "html_url": "https://github.com/non-fungible-nelson",
    "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
    "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
    "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
    "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
    "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
    "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/3863/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/3863/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1140412937",
    "html_url": "https://github.com/hyperledger/besu/issues/3863#issuecomment-1140412937",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3863",
    "id": 1140412937,
    "node_id": "IC_kwDODE2jmc5D-VIJ",
    "user": {
      "login": "diglos",
      "id": 16838272,
      "node_id": "MDQ6VXNlcjE2ODM4Mjcy",
      "avatar_url": "https://avatars.githubusercontent.com/u/16838272?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/diglos",
      "html_url": "https://github.com/diglos",
      "followers_url": "https://api.github.com/users/diglos/followers",
      "following_url": "https://api.github.com/users/diglos/following{/other_user}",
      "gists_url": "https://api.github.com/users/diglos/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/diglos/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/diglos/subscriptions",
      "organizations_url": "https://api.github.com/users/diglos/orgs",
      "repos_url": "https://api.github.com/users/diglos/repos",
      "events_url": "https://api.github.com/users/diglos/events{/privacy}",
      "received_events_url": "https://api.github.com/users/diglos/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-29T09:40:43Z",
    "updated_at": "2022-05-29T09:40:43Z",
    "author_association": "NONE",
    "body": "I agree, particularly with the second one. It is very confusing. At first it seems that the sync is stucked and something is wrong.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1140412937/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1143076681",
    "html_url": "https://github.com/hyperledger/besu/issues/3863#issuecomment-1143076681",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3863",
    "id": 1143076681,
    "node_id": "IC_kwDODE2jmc5EIfdJ",
    "user": {
      "login": "sharad-develop",
      "id": 23285242,
      "node_id": "MDQ6VXNlcjIzMjg1MjQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/23285242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sharad-develop",
      "html_url": "https://github.com/sharad-develop",
      "followers_url": "https://api.github.com/users/sharad-develop/followers",
      "following_url": "https://api.github.com/users/sharad-develop/following{/other_user}",
      "gists_url": "https://api.github.com/users/sharad-develop/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sharad-develop/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sharad-develop/subscriptions",
      "organizations_url": "https://api.github.com/users/sharad-develop/orgs",
      "repos_url": "https://api.github.com/users/sharad-develop/repos",
      "events_url": "https://api.github.com/users/sharad-develop/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sharad-develop/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-01T03:25:38Z",
    "updated_at": "2022-06-01T03:26:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "SyncTargetManager  can be updated to debug. But DNSTimerTask is coming apache tuweni where it is defaulting to info.\r\n\r\nAlso, the progress info is present minus the ETA.\r\n\r\nBelow is repetitive once sync starts:\r\n2022-05-31 23:05:04.353-04:00 | Timer-0 | INFO  | DNSTimerTask | Refreshing DNS records with enrtree://AKA3AM6LPBYEUDMVNU3BSVQJ5AD45Y7YPOHJLEF6W26QOE4VTUDPE@all.mainnet.ethdisco.net\r\n2022-05-31 23:05:07.940-04:00 | EthScheduler-Services-7 (requestCompleteTask) | INFO  | CompleteTaskStep | **Downloaded 1069190 world state nodes. At least 134452 nodes remaining.**\r\n2022-05-31 23:05:14.772-04:00 | EthScheduler-Services-13 (importBlock) | INFO  | FastImportBlocksStep | Completed importing chain segment 331751 to 338150 (6400 blocks in 11797ms), Peers: 10\r\n2022-05-31 23:05:25.086-04:00 | EthScheduler-Services-13 (importBlock) | INFO  | FastImportBlocksStep | Completed importing chain segment 338151 to 341150 (3000 blocks in 10283ms), Peers: 10 ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1143076681/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1143215057",
    "html_url": "https://github.com/hyperledger/besu/issues/3863#issuecomment-1143215057",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3863",
    "id": 1143215057,
    "node_id": "IC_kwDODE2jmc5EJBPR",
    "user": {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-01T07:27:36Z",
    "updated_at": "2022-06-01T07:27:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "There are a couple of option to manage the DNSTimerTask log, the simple one is to just tune our default log4j configuration to silence it, the other option is to propose a change to the Tuweni library and make its log configurable.\r\n\r\nFor the world state and the block downloads, instead we need to rethink how we show progress, and hopefully unify it, so we can have a better ETA of the whole initial sync progress, since the average user should not be interested about the different progress on block download or state download on themselves.\r\n\r\n@gezero since you are doing a refactoring of the initial sync, it could be a good opportunity to rethink also how we show progress to the user.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1143215057/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1157899839",
    "html_url": "https://github.com/hyperledger/besu/issues/3863#issuecomment-1157899839",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3863",
    "id": 1157899839,
    "node_id": "IC_kwDODE2jmc5FBCY_",
    "user": {
      "login": "non-fungible-nelson",
      "id": 85905982,
      "node_id": "MDQ6VXNlcjg1OTA1OTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/non-fungible-nelson",
      "html_url": "https://github.com/non-fungible-nelson",
      "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
      "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
      "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
      "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
      "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
      "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-16T16:45:26Z",
    "updated_at": "2022-06-16T16:45:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "User's have also mentioned that the initial sync should echo some/all of their configuration options (without exposing Auth) to confirm what sync mode, storage mode, and more they have chosen. I think this could be useful as Besu initializes to re-assure users their configuration was done properly (or that it was not and they should reinitialize sync). I also think we should print logs with regards to the consensus layer to target a post-Merge context as well. I.e. a sync will fail to complete on a post-merge network with a graceful error catch if there is no CL endpoint configured. The CL prints that it is waiting for the EL to sync, so clear messages about this handoff would be appreciated for new users as well. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1157899839/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1158588201",
    "html_url": "https://github.com/hyperledger/besu/issues/3863#issuecomment-1158588201",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3863",
    "id": 1158588201,
    "node_id": "IC_kwDODE2jmc5FDqcp",
    "user": {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-17T07:40:13Z",
    "updated_at": "2022-06-17T07:40:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "@matt-nelson-csi [this ticket](https://github.com/hyperledger/besu/issues/3864) is related to your comment.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1158588201/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
