{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/487",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/487/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/487/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/487/events",
  "html_url": "https://github.com/hyperledger/besu/issues/487",
  "id": 582583057,
  "node_id": "MDU6SXNzdWU1ODI1ODMwNTc=",
  "number": 487,
  "title": "Improve LoadLocalDataStep performance",
  "user": {
    "login": "timbeiko",
    "id": 9390255,
    "node_id": "MDQ6VXNlcjkzOTAyNTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9390255?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/timbeiko",
    "html_url": "https://github.com/timbeiko",
    "followers_url": "https://api.github.com/users/timbeiko/followers",
    "following_url": "https://api.github.com/users/timbeiko/following{/other_user}",
    "gists_url": "https://api.github.com/users/timbeiko/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/timbeiko/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/timbeiko/subscriptions",
    "organizations_url": "https://api.github.com/users/timbeiko/orgs",
    "repos_url": "https://api.github.com/users/timbeiko/repos",
    "events_url": "https://api.github.com/users/timbeiko/events{/privacy}",
    "received_events_url": "https://api.github.com/users/timbeiko/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-03-16T20:35:30Z",
  "updated_at": "2021-04-07T17:39:58Z",
  "closed_at": "2021-04-07T17:39:58Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "The current bottleneck for world state download is the LoadLocalDataStep which attempts to load the existing data for a hash from our world state. If we can improve the performance of this step our fast sync times should decrease, be less likely to need to pick a new pivot block and be faster once a new pivot block is selected.\r\n\r\nTwo possible approaches:\r\n1. Use the RocksDB `keyMayExist` method. May be able to use this just to skip nodes that definitely aren't in the database but that likely makes it slower when picking a new pivot block (as most nodes will exist and will now take two calls into the DB). If we changed the RocksDB JNI wrapper so that it could return the bytes of any value it finds in the index instead of a String version (which corrupts the value), keyMayExist may provide a significantly faster way of loading existing nodes from the database as well.\r\n    * See [this comment ](https://github.com/hyperledger/besu/issues/487#issuecomment-611086372)\r\n\r\n2. Add a bloom filter to track nodes we've downloaded so we only actually request data from the world state if it's likely to exist there. Downside: adds the extra overhead of maintaining a bloom filter.\r\n\r\n*Acceptance Criteria*\r\n * Implement a PoC for both of the approaches above and measure the improvement.\r\n\r\n * Fully implement approaches which significantly improve performance",
  "closed_by": {
    "login": "timbeiko",
    "id": 9390255,
    "node_id": "MDQ6VXNlcjkzOTAyNTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9390255?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/timbeiko",
    "html_url": "https://github.com/timbeiko",
    "followers_url": "https://api.github.com/users/timbeiko/followers",
    "following_url": "https://api.github.com/users/timbeiko/following{/other_user}",
    "gists_url": "https://api.github.com/users/timbeiko/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/timbeiko/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/timbeiko/subscriptions",
    "organizations_url": "https://api.github.com/users/timbeiko/orgs",
    "repos_url": "https://api.github.com/users/timbeiko/repos",
    "events_url": "https://api.github.com/users/timbeiko/events{/privacy}",
    "received_events_url": "https://api.github.com/users/timbeiko/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/487/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/487/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/611086372",
    "html_url": "https://github.com/hyperledger/besu/issues/487#issuecomment-611086372",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/487",
    "id": 611086372,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMTA4NjM3Mg==",
    "user": {
      "login": "shemnon",
      "id": 38109,
      "node_id": "MDQ6VXNlcjM4MTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shemnon",
      "html_url": "https://github.com/shemnon",
      "followers_url": "https://api.github.com/users/shemnon/followers",
      "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
      "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
      "organizations_url": "https://api.github.com/users/shemnon/orgs",
      "repos_url": "https://api.github.com/users/shemnon/repos",
      "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shemnon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-08T17:22:58Z",
    "updated_at": "2020-04-08T17:22:58Z",
    "author_association": "MEMBER",
    "body": "This will need to be paired with a rocksdb upgrade to https://github.com/facebook/rocksdb/releases/tag/v6.7.3 as they expose a better `keyMayExist` API for java.  It does exactly what we need for option 1.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/611086372/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
