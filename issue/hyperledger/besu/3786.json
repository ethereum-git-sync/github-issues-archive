{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/3786",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/3786/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/3786/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/3786/events",
  "html_url": "https://github.com/hyperledger/besu/issues/3786",
  "id": 1225064835,
  "node_id": "I_kwDODE2jmc5JBQGD",
  "number": 3786,
  "title": "OutOfMemoryError on JSON RPC method trace_replayBlockTransactions",
  "user": {
    "login": "ahamlat",
    "id": 5099602,
    "node_id": "MDQ6VXNlcjUwOTk2MDI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5099602?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ahamlat",
    "html_url": "https://github.com/ahamlat",
    "followers_url": "https://api.github.com/users/ahamlat/followers",
    "following_url": "https://api.github.com/users/ahamlat/following{/other_user}",
    "gists_url": "https://api.github.com/users/ahamlat/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ahamlat/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ahamlat/subscriptions",
    "organizations_url": "https://api.github.com/users/ahamlat/orgs",
    "repos_url": "https://api.github.com/users/ahamlat/repos",
    "events_url": "https://api.github.com/users/ahamlat/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ahamlat/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 2051684044,
      "node_id": "MDU6TGFiZWwyMDUxNjg0MDQ0",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/P4",
      "name": "P4",
      "color": "ccff33",
      "default": false,
      "description": "Low (ex: Node doesn't start up when the configuration file has unexpected \"end-of-line\" character)"
    },
    {
      "id": 2152224197,
      "node_id": "MDU6TGFiZWwyMTUyMjI0MTk3",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamRevenant",
      "name": "TeamRevenant",
      "color": "78e298",
      "default": false,
      "description": "GH issues worked on by Revenant Team"
    },
    {
      "id": 4328706977,
      "node_id": "LA_kwDODE2jmc8AAAABAgLToQ",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamChupa",
      "name": "TeamChupa",
      "color": "fbca04",
      "default": false,
      "description": "GH issues worked on by Chupacabara Team"
    },
    {
      "id": 4609582991,
      "node_id": "LA_kwDODE2jmc8AAAABEsCnjw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/RPC",
      "name": "RPC",
      "color": "1d76db",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "macfarla",
    "id": 2627919,
    "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/macfarla",
    "html_url": "https://github.com/macfarla",
    "followers_url": "https://api.github.com/users/macfarla/followers",
    "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
    "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
    "organizations_url": "https://api.github.com/users/macfarla/orgs",
    "repos_url": "https://api.github.com/users/macfarla/repos",
    "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
    "received_events_url": "https://api.github.com/users/macfarla/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    {
      "login": "ahamlat",
      "id": 5099602,
      "node_id": "MDQ6VXNlcjUwOTk2MDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5099602?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahamlat",
      "html_url": "https://github.com/ahamlat",
      "followers_url": "https://api.github.com/users/ahamlat/followers",
      "following_url": "https://api.github.com/users/ahamlat/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahamlat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahamlat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahamlat/subscriptions",
      "organizations_url": "https://api.github.com/users/ahamlat/orgs",
      "repos_url": "https://api.github.com/users/ahamlat/repos",
      "events_url": "https://api.github.com/users/ahamlat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahamlat/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 14,
  "created_at": "2022-05-04T08:28:50Z",
  "updated_at": "2023-03-21T19:52:59Z",
  "closed_at": "2023-03-21T19:52:59Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!-- Have you done the following? -->\r\n<!--   * read the Code of Conduct? By filing an Issue, you are expected to -->  \r\n<!--     comply with it, including treating everyone with respect: -->\r\n<!--     https://github.com/hyperledger/besu/blob/main/CODE_OF_CONDUCT.md -->\r\n<!--   * Reproduced the issue in the latest version of the software -->\r\n<!--   * Read the debugging docs: https://besu.hyperledger.org/en/stable/HowTo/Monitor/Logging/ -->\r\n<!--   * Duplicate Issue check:  https://github.com/search?q=+is%3Aissue+repo%3Ahyperledger/Besu -->\r\n<!-- Note:  Not all sections will apply to all issue types. -->\r\n\r\n### Description\r\nAs a Besu user, I want to get block transactions traces when I call JSON RPC method trace_replayBlockTransactions on blocks with big transactions (> 20M Gas)\r\n\r\n### Acceptance Criteria\r\n* trace_replayBlockTransactions JSON RPC call displays block transactions traces\r\n\r\n### Steps to Reproduce (Bug)\r\n1. Create a private network of Besu nodes, set for each node these java options -Xms2G -Xmx2G (BESU_OPTS)\r\n2. Send a huge transaction 25M Gas \r\n3. Call JSON RPC method trace_replayBlockTransactions with the  block number of the transaction sent in 2. as parameter\r\n\r\n**Expected behavior:** \r\nReturn the block transactions traces, we can see below the json result template\r\n```json\r\n{\r\n    \"jsonrpc\": \"2.0\",\r\n    \"id\": 1,\r\n    \"result\":[ \r\n      { \r\n        \"output\":\"0x\",\r\n        \"vmTrace\":{\r\n          \"code\":\"0x7f3940be4289e4c3587d88c1856cc95352461992db0a584c281226faefe560b3016000527f14c4d2c102bdeb2354bfc3dc96a95e4512cf3a8461e0560e2272dbf884ef3905601052600851\",\r\n          \"ops\":[ \r\n            { \r\n              \"cost\":3,\r\n              \"ex\":{ \r\n                \"mem\":null,\r\n                \"push\":[ \r\n                  \"0x8\"\r\n                ],\r\n                \"store\":null,\r\n                \"used\":16756175\r\n              },\r\n              \"pc\":72,\r\n              \"sub\":null\r\n            },\r\n            ...\r\n          ]\r\n        },\r\n        \"trace\":[ \r\n          { \r\n            \"action\":{ \r\n              \"callType\":\"call\",\r\n              \"from\":\"0xfe3b557e8fb62b89f4916b721be55ceb828dbd73\",\r\n              \"gas\":\"0xffadea\",\r\n              \"input\":\"0x\",\r\n              \"to\":\"0x0100000000000000000000000000000000000000\",\r\n              \"value\":\"0x0\"\r\n            },\r\n            \"result\":{ \r\n              \"gasUsed\":\"0x1e\",\r\n              \"output\":\"0x\"\r\n            },\r\n            \"subtraces\":0,\r\n            \"traceAddress\":[      \r\n            ],\r\n            \"type\":\"call\"\r\n          }\r\n        ],\r\n        \"stateDiff\":{\r\n          \"0xfe3b557e8fb62b89f4916b721be55ceb828dbd73\":{ \r\n            \"balance\":{ \r\n              \"*\":{ \r\n                \"from\":\"0xffffffffffffffffffffffffffffffffc3e12a20b\",\r\n                \"to\":\"0xffffffffffffffffffffffffffffffffc3dc5f091\"\r\n              }\r\n            },\r\n            \"code\":\"=\",\r\n            \"nonce\":{ \r\n              \"*\":{ \r\n                \"from\":\"0x14\",\r\n                \"to\":\"0x15\"\r\n              }\r\n            },\r\n            \"storage\":{              \r\n            }\r\n          }\r\n        },\r\n        \"transactionHash\":\"0x2a5079cc535c429f668f13a7fb9a28bdba6831b5462bd04f781777b332a8fcbd\",\r\n      },\r\n      {...}\r\n    ]\r\n}\r\n```\r\n**Actual behavior:** \r\njava.lang.OutOfMemoryError: Java heap space\r\n```\r\njava.lang.OutOfMemoryError: Java heap space\r\n        at java.base/java.util.Arrays.copyOf(Arrays.java:3689)\r\n        at java.base/java.util.ArrayList.grow(ArrayList.java:238)\r\n        at java.base/java.util.ArrayList.grow(ArrayList.java:243)\r\n        at java.base/java.util.ArrayList.add(ArrayList.java:486)\r\n        at java.base/java.util.ArrayList.add(ArrayList.java:499)\r\n        at org.hyperledger.besu.ethereum.vm.DebugOperationTracer.traceExecution(DebugOperationTracer.java:97)\r\n        at org.hyperledger.besu.evm.EVM.executeNextOperation(EVM.java:81)\r\n        at org.hyperledger.besu.evm.EVM.runToHalt(EVM.java:74)\r\n        at org.hyperledger.besu.evm.processor.AbstractMessageProcessor.codeExecute(AbstractMessageProcessor.java:161)\r\n        at org.hyperledger.besu.evm.processor.AbstractMessageProcessor.process(AbstractMessageProcessor.java:173)\r\n        at org.hyperledger.besu.ethereum.mainnet.MainnetTransactionProcessor.process(MainnetTransactionProcessor.java:485)\r\n        at org.hyperledger.besu.ethereum.mainnet.MainnetTransactionProcessor.processTransaction(MainnetTransactionProcessor.java:397)\r\n        at org.hyperledger.besu.ethereum.mainnet.MainnetTransactionProcessor.processTransaction(MainnetTransactionProcessor.java:181)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.processor.BlockTracer.lambda$prepareReplayAction$0(BlockTracer.java:60)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.processor.BlockTracer$$Lambda$1375/0x00000008407b5040.performAction(Unknown Source)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.processor.BlockReplay.lambda$block$0(BlockReplay.java:60)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.processor.BlockReplay$$Lambda$1377/0x00000008407b5840.apply(Unknown Source)\r\n        at java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:195)\r\n        at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1655)\r\n        at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:484)\r\n        at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:474)\r\n        at java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:913)\r\n        at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\r\n        at java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:578)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.processor.BlockReplay.lambda$block$1(BlockReplay.java:66)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.processor.BlockReplay$$Lambda$1376/0x00000008407b5440.perform(Unknown Source)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.processor.BlockReplay.performActionWithBlock(BlockReplay.java:155)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.processor.BlockReplay.block(BlockReplay.java:52)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.processor.BlockTracer.trace(BlockTracer.java:45)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.TraceReplayBlockTransactions.traceBlock(TraceReplayBlockTransactions.java:118)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.TraceReplayBlockTransactions.lambda$resultByBlockNumber$0(TraceReplayBlockTransactions.java:102)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.TraceReplayBlockTransactions$$Lambda$1373/0x00000008407b4840.apply(Unknown Source)\r\n```\r\n**Frequency:** \r\n100% \r\n\r\n### Versions\r\n* Software version: besu/v22.4.0-RC2-dev-898ce928/linux-x86_64/corretto-java-17\r\n* Java version: openjdk version \"17.0.2\" 2022-01-18 LTS\r\n* OS Name & Version: NAME=\"Amazon Linux\", VERSION=\"2\", ID=\"amzn\", ID_LIKE=\"centos rhel fedora\", VERSION_ID=\"2\", PRETTY_NAME=\"Amazon Linux 2\", ANSI_COLOR=\"0;33\", CPE_NAME=\"cpe:2.3: o:amazon:amazon_linux:2\", HOME_URL=\"https://amazonlinux.com/\", Amazon Linux release 2 (Karoo)\r\n* Kernel Version: Linux ip-172-31-14-96.us-east-2.compute.internal 4.14.181-140.257.amzn2.x86_64 1 SMP Wed May 27 02:17:36 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\r\n* Cloud VM, type, size: i3.2xlarge\r\n",
  "closed_by": {
    "login": "garyschulte",
    "id": 1238512,
    "node_id": "MDQ6VXNlcjEyMzg1MTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1238512?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/garyschulte",
    "html_url": "https://github.com/garyschulte",
    "followers_url": "https://api.github.com/users/garyschulte/followers",
    "following_url": "https://api.github.com/users/garyschulte/following{/other_user}",
    "gists_url": "https://api.github.com/users/garyschulte/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/garyschulte/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/garyschulte/subscriptions",
    "organizations_url": "https://api.github.com/users/garyschulte/orgs",
    "repos_url": "https://api.github.com/users/garyschulte/repos",
    "events_url": "https://api.github.com/users/garyschulte/events{/privacy}",
    "received_events_url": "https://api.github.com/users/garyschulte/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/3786/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/3786/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1117081387",
    "html_url": "https://github.com/hyperledger/besu/issues/3786#issuecomment-1117081387",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3786",
    "id": 1117081387,
    "node_id": "IC_kwDODE2jmc5ClU8r",
    "user": {
      "login": "ahamlat",
      "id": 5099602,
      "node_id": "MDQ6VXNlcjUwOTk2MDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5099602?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahamlat",
      "html_url": "https://github.com/ahamlat",
      "followers_url": "https://api.github.com/users/ahamlat/followers",
      "following_url": "https://api.github.com/users/ahamlat/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahamlat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahamlat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahamlat/subscriptions",
      "organizations_url": "https://api.github.com/users/ahamlat/orgs",
      "repos_url": "https://api.github.com/users/ahamlat/repos",
      "events_url": "https://api.github.com/users/ahamlat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahamlat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-04T09:03:00Z",
    "updated_at": "2022-05-04T09:03:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "Top components :\r\n```\r\n num     #instances         #bytes  class name (module)\r\n-------------------------------------------------------\r\n   1:     146572886     9400658032  [B (java.base@17.0.2)\r\n   2:     146445748     4686263936  org.apache.tuweni.bytes.MutableArrayWrappingBytes32\r\n   3:       6083127     1300789808  [Lorg.apache.tuweni.bytes.Bytes32;\r\n   4:       3041563      389320064  org.hyperledger.besu.ethereum.debug.TraceFrame\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1117081387/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1139559403",
    "html_url": "https://github.com/hyperledger/besu/issues/3786#issuecomment-1139559403",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3786",
    "id": 1139559403,
    "node_id": "IC_kwDODE2jmc5D7Evr",
    "user": {
      "login": "soragXYZ",
      "id": 67227269,
      "node_id": "MDQ6VXNlcjY3MjI3MjY5",
      "avatar_url": "https://avatars.githubusercontent.com/u/67227269?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/soragXYZ",
      "html_url": "https://github.com/soragXYZ",
      "followers_url": "https://api.github.com/users/soragXYZ/followers",
      "following_url": "https://api.github.com/users/soragXYZ/following{/other_user}",
      "gists_url": "https://api.github.com/users/soragXYZ/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/soragXYZ/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/soragXYZ/subscriptions",
      "organizations_url": "https://api.github.com/users/soragXYZ/orgs",
      "repos_url": "https://api.github.com/users/soragXYZ/repos",
      "events_url": "https://api.github.com/users/soragXYZ/events{/privacy}",
      "received_events_url": "https://api.github.com/users/soragXYZ/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-27T12:10:47Z",
    "updated_at": "2022-05-27T12:10:47Z",
    "author_association": "NONE",
    "body": "Hi! Any updates ?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1139559403/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1150184260",
    "html_url": "https://github.com/hyperledger/besu/issues/3786#issuecomment-1150184260",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3786",
    "id": 1150184260,
    "node_id": "IC_kwDODE2jmc5EjmtE",
    "user": {
      "login": "iamhsk",
      "id": 2249367,
      "node_id": "MDQ6VXNlcjIyNDkzNjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2249367?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iamhsk",
      "html_url": "https://github.com/iamhsk",
      "followers_url": "https://api.github.com/users/iamhsk/followers",
      "following_url": "https://api.github.com/users/iamhsk/following{/other_user}",
      "gists_url": "https://api.github.com/users/iamhsk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iamhsk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iamhsk/subscriptions",
      "organizations_url": "https://api.github.com/users/iamhsk/orgs",
      "repos_url": "https://api.github.com/users/iamhsk/repos",
      "events_url": "https://api.github.com/users/iamhsk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iamhsk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-08T17:16:26Z",
    "updated_at": "2022-06-08T17:16:26Z",
    "author_association": "NONE",
    "body": "Hi @soragXYZ, thank you for following up on this. The maintainers will prioritize this and work on it in the near future. \n\nAdding our discord conversations for reference here: \n\n- https://discord.com/channels/905194001349627914/938504958909747250/969536062047256620\n\n- https://discord.com/channels/905194001349627914/938504958909747250/970674116766101534",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1150184260/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1150673624",
    "html_url": "https://github.com/hyperledger/besu/issues/3786#issuecomment-1150673624",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3786",
    "id": 1150673624,
    "node_id": "IC_kwDODE2jmc5EleLY",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-09T05:03:58Z",
    "updated_at": "2022-06-09T05:03:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "I seem to get different behaviour:\nbesu/v22.4.3-dev-1c7c9ed1/osx-x86_64/openjdk-java-11\nJAVA_OPTS=\"-Xms2G -Xmx2G\" besu --config-file config/besu/besu1.conf\n\n```\n{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"eth_sendTransaction\",\n  \"params\": [{\n  \t\"from\": \"0xfe3b557e8fb62b89f4916b721be55ceb828dbd73\",\n  \t\"data\": \"608060405234801561001057600080fd5b50610274806100206000396000f3fe608060405234801561001057600080fd5b506004361061002b5760003560e01c8063b27b880414610030575b600080fd5b61004a60048036038101906100459190610108565b61004c565b005b60606000806000604051935036600085376000803686885af490503d9150816000853e806000811461007d57610093565b60008311156100925761012085019350836040525b5b5060008114156100ec578473ffffffffffffffffffffffffffffffffffffffff167f410d96db3f80b0f89b36888c4d8a94004268f8d42309ac39b7bcba706293e099856040516100e3919061016e565b60405180910390a25b5050505050565b60008135905061010281610227565b92915050565b60006020828403121561011e5761011d610211565b5b600061012c848285016100f3565b91505092915050565b600061014082610190565b61014a818561019b565b935061015a8185602086016101de565b61016381610216565b840191505092915050565b600060208201905081810360008301526101888184610135565b905092915050565b600081519050919050565b600082825260208201905092915050565b60006101b7826101be565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60005b838110156101fc5780820151818401526020810190506101e1565b8381111561020b576000848401525b50505050565b600080fd5b6000601f19601f8301169050919050565b610230816101ac565b811461023b57600080fd5b5056fea2646970667358221220fdfb5c371055342507b8fb9ca7b0c234f79819bd5cb05c0d467fb605de979eb564736f6c63430008060033\",\n  \t\"gas\": \"0xfffffffffffff\"\n  }],\n  \"id\": 1\n}\n```\n...\nblockNumber 0xfd1\n```\n{\n    \"jsonrpc\": \"2.0\",\n    \"method\": \"trace_replayBlockTransactions\",\n    \"params\": [\n        \"0xfd1\", [ \"vmTrace\"]\n    ],\n    \"id\": 1\n}\n```\nResponse:\n```\n{\n    \"jsonrpc\": \"2.0\",\n    \"id\": 1,\n    \"result\": [\n        {\n            \"output\": \"0x608060405234801561001057600080fd5b506004361061002b5760003560e01c8063b27b880414610030575b600080fd5b61004a60048036038101906100459190610108565b61004c565b005b60606000806000604051935036600085376000803686885af490503d9150816000853e806000811461007d57610093565b60008311156100925761012085019350836040525b5b5060008114156100ec578473ffffffffffffffffffffffffffffffffffffffff167f410d96db3f80b0f89b36888c4d8a94004268f8d42309ac39b7bcba706293e099856040516100e3919061016e565b60405180910390a25b5050505050565b60008135905061010281610227565b92915050565b60006020828403121561011e5761011d610211565b5b600061012c848285016100f3565b91505092915050565b600061014082610190565b61014a818561019b565b935061015a8185602086016101de565b61016381610216565b840191505092915050565b600060208201905081810360008301526101888184610135565b905092915050565b600081519050919050565b600082825260208201905092915050565b60006101b7826101be565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60005b838110156101fc5780820151818401526020810190506101e1565b8381111561020b576000848401525b50505050565b600080fd5b6000601f19601f8301169050919050565b610230816101ac565b811461023b57600080fd5b5056fea2646970667358221220fdfb5c371055342507b8fb9ca7b0c234f79819bd5cb05c0d467fb605de979eb564736f6c63430008060033\",\n            \"stateDiff\": null,\n            \"trace\": [],\n            \"transactionHash\": \"0x6448270c8211215465a209177e9c0ca0e4b32d0398e36f6a146e4e27b0d6c206\",\n            \"vmTrace\": {\n                \"code\": \"0x608060405234801561001057600080fd5b50610274806100206000396000f3fe608060405234801561001057600080fd5b506004361061002b5760003560e01c8063b27b880414610030575b600080fd5b61004a60048036038101906100459190610108565b61004c565b005b60606000806000604051935036600085376000803686885af490503d9150816000853e806000811461007d57610093565b60008311156100925761012085019350836040525b5b5060008114156100ec578473ffffffffffffffffffffffffffffffffffffffff167f410d96db3f80b0f89b36888c4d8a94004268f8d42309ac39b7bcba706293e099856040516100e3919061016e565b60405180910390a25b5050505050565b60008135905061010281610227565b92915050565b60006020828403121561011e5761011d610211565b5b600061012c848285016100f3565b91505092915050565b600061014082610190565b61014a818561019b565b935061015a8185602086016101de565b61016381610216565b840191505092915050565b600060208201905081810360008301526101888184610135565b905092915050565b600081519050919050565b600082825260208201905092915050565b60006101b7826101be565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60005b838110156101fc5780820151818401526020810190506101e1565b8381111561020b576000848401525b50505050565b600080fd5b6000601f19601f8301169050919050565b610230816101ac565b811461023b57600080fd5b5056fea2646970667358221220fdfb5c371055342507b8fb9ca7b0c234f79819bd5cb05c0d467fb605de979eb564736f6c63430008060033\",\n                \"ops\": [\n                    {\n                        \"cost\": 3,\n                        \"ex\": {\n                            \"mem\": null,\n                            \"push\": [\n                                \"0x80\"\n                            ],\n                            \"store\": null,\n                            \"used\": 4503599627307496\n                        },\n                        \"pc\": 0,\n                        \"sub\": null\n                    },\n                    {\n                        \"cost\": 3,\n                        \"ex\": {\n                            \"mem\": null,\n                            \"push\": [\n                                \"0x40\"\n                            ],\n                            \"store\": null,\n                            \"used\": 4503599627307493\n                        },\n                        \"pc\": 2,\n                        \"sub\": null\n                    },\n                    {\n                        \"cost\": 12,\n                        \"ex\": {\n                            \"mem\": {\n                                \"data\": \"0x0000000000000000000000000000000000000000000000000000000000000080\",\n                                \"off\": 64\n                            },\n                            \"push\": [],\n                            \"store\": null,\n                            \"used\": 4503599627307481\n                        },\n                        \"pc\": 4,\n                        \"sub\": null\n                    },\n                    {\n                        \"cost\": 2,\n                        \"ex\": {\n                            \"mem\": null,\n                            \"push\": [\n                                \"0x0\"\n                            ],\n                            \"store\": null,\n                            \"used\": 4503599627307479\n                        },\n                        \"pc\": 5,\n                        \"sub\": null\n                    },\n                    {\n                        \"cost\": 3,\n                        \"ex\": {\n                            \"mem\": null,\n                            \"push\": [\n                                \"0x0\",\n                                \"0x0\"\n                            ],\n                            \"store\": null,\n                            \"used\": 4503599627307476\n                        },\n                        \"pc\": 6,\n                        \"sub\": null\n                    },\n                    {\n                        \"cost\": 3,\n                        \"ex\": {\n                            \"mem\": null,\n                            \"push\": [\n                                \"0x1\"\n                            ],\n                            \"store\": null,\n                            \"used\": 4503599627307473\n                        },\n                        \"pc\": 7,\n                        \"sub\": null\n                    },\n                    {\n                        \"cost\": 3,\n                        \"ex\": {\n                            \"mem\": null,\n                            \"push\": [\n                                \"0x10\"\n                            ],\n                            \"store\": null,\n                            \"used\": 4503599627307470\n                        },\n                        \"pc\": 8,\n                        \"sub\": null\n                    },\n                    {\n                        \"cost\": 10,\n                        \"ex\": {\n                            \"mem\": null,\n                            \"push\": [],\n                            \"store\": null,\n                            \"used\": 4503599627307460\n                        },\n                        \"pc\": 11,\n                        \"sub\": null\n                    },\n                    {\n                        \"cost\": 1,\n                        \"ex\": {\n                            \"mem\": null,\n                            \"push\": [],\n                            \"store\": null,\n                            \"used\": 4503599627307459\n                        },\n                        \"pc\": 16,\n                        \"sub\": null\n                    },\n                    {\n                        \"cost\": 2,\n                        \"ex\": {\n                            \"mem\": null,\n                            \"push\": [],\n                            \"store\": null,\n                            \"used\": 4503599627307457\n                        },\n                        \"pc\": 17,\n                        \"sub\": null\n                    },\n                    {\n                        \"cost\": 3,\n                        \"ex\": {\n                            \"mem\": null,\n                            \"push\": [\n                                \"0x274\"\n                            ],\n                            \"store\": null,\n                            \"used\": 4503599627307454\n                        },\n                        \"pc\": 18,\n                        \"sub\": null\n                    },\n                    {\n                        \"cost\": 3,\n                        \"ex\": {\n                            \"mem\": null,\n                            \"push\": [\n                                \"0x274\",\n                                \"0x274\"\n                            ],\n                            \"store\": null,\n                            \"used\": 4503599627307451\n                        },\n                        \"pc\": 21,\n                        \"sub\": null\n                    },\n                    {\n                        \"cost\": 3,\n                        \"ex\": {\n                            \"mem\": null,\n                            \"push\": [\n                                \"0x20\"\n                            ],\n                            \"store\": null,\n                            \"used\": 4503599627307448\n                        },\n                        \"pc\": 22,\n                        \"sub\": null\n                    },\n                    {\n                        \"cost\": 3,\n                        \"ex\": {\n                            \"mem\": null,\n                            \"push\": [\n                                \"0x0\"\n                            ],\n                            \"store\": null,\n                            \"used\": 4503599627307445\n                        },\n                        \"pc\": 25,\n                        \"sub\": null\n                    },\n                    {\n                        \"cost\": 114,\n                        \"ex\": {\n                            \"mem\": {\n                                \"data\": \"0x608060405234801561001057600080fd5b506004361061002b5760003560e01c8063b27b880414610030575b600080fd5b61004a60048036038101906100459190610108565b61004c565b005b60606000806000604051935036600085376000803686885af490503d9150816000853e806000811461007d57610093565b60008311156100925761012085019350836040525b5b5060008114156100ec578473ffffffffffffffffffffffffffffffffffffffff167f410d96db3f80b0f89b36888c4d8a94004268f8d42309ac39b7bcba706293e099856040516100e3919061016e565b60405180910390a25b5050505050565b60008135905061010281610227565b92915050565b60006020828403121561011e5761011d610211565b5b600061012c848285016100f3565b91505092915050565b600061014082610190565b61014a818561019b565b935061015a8185602086016101de565b61016381610216565b840191505092915050565b600060208201905081810360008301526101888184610135565b905092915050565b600081519050919050565b600082825260208201905092915050565b60006101b7826101be565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60005b838110156101fc5780820151818401526020810190506101e1565b8381111561020b576000848401525b50505050565b600080fd5b6000601f19601f8301169050919050565b610230816101ac565b811461023b57600080fd5b5056fea2646970667358221220fdfb5c371055342507b8fb9ca7b0c234f79819bd5cb05c0d467fb605de979eb564736f6c63430008060033\",\n                                \"off\": 0\n                            },\n                            \"push\": [],\n                            \"store\": null,\n                            \"used\": 4503599627307331\n                        },\n                        \"pc\": 27,\n                        \"sub\": null\n                    },\n                    {\n                        \"cost\": 3,\n                        \"ex\": {\n                            \"mem\": null,\n                            \"push\": [\n                                \"0x0\"\n                            ],\n                            \"store\": null,\n                            \"used\": 4503599627307328\n                        },\n                        \"pc\": 28,\n                        \"sub\": null\n                    },\n                    {\n                        \"cost\": 0,\n                        \"ex\": {\n                            \"mem\": null,\n                            \"push\": [],\n                            \"store\": null,\n                            \"used\": 4503599627307328\n                        },\n                        \"pc\": 30,\n                        \"sub\": null\n                    }\n                ]\n            }\n        }\n    ]\n}\n```",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1150673624/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1150674551",
    "html_url": "https://github.com/hyperledger/besu/issues/3786#issuecomment-1150674551",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3786",
    "id": 1150674551,
    "node_id": "IC_kwDODE2jmc5EleZ3",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-09T05:06:06Z",
    "updated_at": "2022-06-09T05:06:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "I don't get OOM. looking at heap dump\njcmd pid GC.heap_dump ~/besu-heapdump0.hprof\nI've got heap size 67,634,206 B - so 67M. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1150674551/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1151698135",
    "html_url": "https://github.com/hyperledger/besu/issues/3786#issuecomment-1151698135",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3786",
    "id": 1151698135,
    "node_id": "IC_kwDODE2jmc5EpYTX",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-09T23:04:04Z",
    "updated_at": "2022-06-09T23:04:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "@ahamlat @soragXYZ is it just the gas supplied for the transaction or is there something specific about the transaction you submitted? ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1151698135/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1175192289",
    "html_url": "https://github.com/hyperledger/besu/issues/3786#issuecomment-1175192289",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3786",
    "id": 1175192289,
    "node_id": "IC_kwDODE2jmc5GDALh",
    "user": {
      "login": "matkt",
      "id": 26581503,
      "node_id": "MDQ6VXNlcjI2NTgxNTAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/26581503?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matkt",
      "html_url": "https://github.com/matkt",
      "followers_url": "https://api.github.com/users/matkt/followers",
      "following_url": "https://api.github.com/users/matkt/following{/other_user}",
      "gists_url": "https://api.github.com/users/matkt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matkt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matkt/subscriptions",
      "organizations_url": "https://api.github.com/users/matkt/orgs",
      "repos_url": "https://api.github.com/users/matkt/repos",
      "events_url": "https://api.github.com/users/matkt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matkt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-05T15:26:42Z",
    "updated_at": "2022-07-05T15:26:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "there is an issue related to that https://github.com/hyperledger/besu/issues/4050 \r\nyou can reproduce the issue easily with ropsten ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1175192289/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1176159306",
    "html_url": "https://github.com/hyperledger/besu/issues/3786#issuecomment-1176159306",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3786",
    "id": 1176159306,
    "node_id": "IC_kwDODE2jmc5GGsRK",
    "user": {
      "login": "ahamlat",
      "id": 5099602,
      "node_id": "MDQ6VXNlcjUwOTk2MDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5099602?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahamlat",
      "html_url": "https://github.com/ahamlat",
      "followers_url": "https://api.github.com/users/ahamlat/followers",
      "following_url": "https://api.github.com/users/ahamlat/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahamlat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahamlat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahamlat/subscriptions",
      "organizations_url": "https://api.github.com/users/ahamlat/orgs",
      "repos_url": "https://api.github.com/users/ahamlat/repos",
      "events_url": "https://api.github.com/users/ahamlat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahamlat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-06T12:25:56Z",
    "updated_at": "2022-07-06T12:25:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "@macfarla : to reproduce, you have to call trace_replayBlockTransactions on a block that contains one or several huge transactions. @matkt was able to reproduce on Ropsten.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1176159306/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1382924316",
    "html_url": "https://github.com/hyperledger/besu/issues/3786#issuecomment-1382924316",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3786",
    "id": 1382924316,
    "node_id": "IC_kwDODE2jmc5SbcAc",
    "user": {
      "login": "GrzegorzDrozda",
      "id": 25419353,
      "node_id": "MDQ6VXNlcjI1NDE5MzUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/25419353?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/GrzegorzDrozda",
      "html_url": "https://github.com/GrzegorzDrozda",
      "followers_url": "https://api.github.com/users/GrzegorzDrozda/followers",
      "following_url": "https://api.github.com/users/GrzegorzDrozda/following{/other_user}",
      "gists_url": "https://api.github.com/users/GrzegorzDrozda/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/GrzegorzDrozda/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/GrzegorzDrozda/subscriptions",
      "organizations_url": "https://api.github.com/users/GrzegorzDrozda/orgs",
      "repos_url": "https://api.github.com/users/GrzegorzDrozda/repos",
      "events_url": "https://api.github.com/users/GrzegorzDrozda/events{/privacy}",
      "received_events_url": "https://api.github.com/users/GrzegorzDrozda/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-14T21:33:25Z",
    "updated_at": "2023-01-14T21:33:25Z",
    "author_association": "NONE",
    "body": "Hi, I hit same bug:\r\n```\r\n$ curl -v -XPOST --data '{\"id\":0,\"jsonrpc\":\"2.0\",\"method\":\"trace_block\",\"params\":[\"0x5D5E43\"]}' http://localhost:8545\r\nNote: Unnecessary use of -X or --request, POST is already inferred.\r\n*   Trying 127.0.0.1:8545...\r\n* Connected to localhost (127.0.0.1) port 8545 (#0)\r\n> POST / HTTP/1.1\r\n> Host: localhost:8545\r\n> User-Agent: curl/7.81.0\r\n> Accept: */*\r\n> Content-Length: 69\r\n> Content-Type: application/x-www-form-urlencoded\r\n> \r\n* Mark bundle as not supporting multiuse\r\n< HTTP/1.1 500 Internal Server Error\r\n< vary: origin\r\n< Content-Type: application/json\r\n< content-length: 21\r\n< \r\n* Connection #0 to host localhost left intact\r\nInternal Server Error\r\n```\r\nActually another method is affected as well:\r\n```\r\n$ curl -v -XPOST --data '{\"id\":0,\"jsonrpc\":\"2.0\",\"method\":\"trace_replayBlockTransactions\",\"params\":[\"0x5D5E43\",[\"trace\"]]}'  Note: \r\nUnnecessary use of -X or --request, POST is already inferred.\r\n*   Trying 127.0.0.1:8545...\r\n* Connected to localhost (127.0.0.1) port 8545 (#0)\r\n> POST / HTTP/1.1\r\n> Host: localhost:8545\r\n> User-Agent: curl/7.81.0\r\n> Accept: */*\r\n> Content-Length: 97\r\n> Content-Type: application/x-www-form-urlencoded\r\n> \r\n* Mark bundle as not supporting multiuse\r\n< HTTP/1.1 500 Internal Server Error\r\n< vary: origin\r\n< Content-Type: application/json\r\n< content-length: 21\r\n< \r\n* Connection #0 to host localhost left intact\r\nInternal Server Error\r\n```\r\nOn besu site: \r\n```\r\n\"level\":\"ERROR\",\"thread\":\"vert.x-eventloop-thread-1\",\"class\":\"RoutingContext\",\"message\":\"Unhandled exception in router\",\"throwable\":\" java.lang.OutOfMemoryError: Java heap space\\n\"\r\n```\r\nIn both cases - block which is causing this problem has `34,287,831 | 52.8%` Gas Used",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1382924316/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1404849667",
    "html_url": "https://github.com/hyperledger/besu/issues/3786#issuecomment-1404849667",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3786",
    "id": 1404849667,
    "node_id": "IC_kwDODE2jmc5TvE4D",
    "user": {
      "login": "non-fungible-nelson",
      "id": 85905982,
      "node_id": "MDQ6VXNlcjg1OTA1OTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/non-fungible-nelson",
      "html_url": "https://github.com/non-fungible-nelson",
      "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
      "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
      "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
      "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
      "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
      "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-26T11:04:19Z",
    "updated_at": "2023-01-26T11:04:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "@daniellehrner - status? ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1404849667/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1404857556",
    "html_url": "https://github.com/hyperledger/besu/issues/3786#issuecomment-1404857556",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3786",
    "id": 1404857556,
    "node_id": "IC_kwDODE2jmc5TvGzU",
    "user": {
      "login": "daniellehrner",
      "id": 6727189,
      "node_id": "MDQ6VXNlcjY3MjcxODk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6727189?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/daniellehrner",
      "html_url": "https://github.com/daniellehrner",
      "followers_url": "https://api.github.com/users/daniellehrner/followers",
      "following_url": "https://api.github.com/users/daniellehrner/following{/other_user}",
      "gists_url": "https://api.github.com/users/daniellehrner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/daniellehrner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daniellehrner/subscriptions",
      "organizations_url": "https://api.github.com/users/daniellehrner/orgs",
      "repos_url": "https://api.github.com/users/daniellehrner/repos",
      "events_url": "https://api.github.com/users/daniellehrner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/daniellehrner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-26T11:10:15Z",
    "updated_at": "2023-01-26T11:10:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "> @daniellehrner - status?\r\n\r\nI am still working on this one.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1404857556/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1409025753",
    "html_url": "https://github.com/hyperledger/besu/issues/3786#issuecomment-1409025753",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3786",
    "id": 1409025753,
    "node_id": "IC_kwDODE2jmc5T_AbZ",
    "user": {
      "login": "dhallatmaine",
      "id": 1324930,
      "node_id": "MDQ6VXNlcjEzMjQ5MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1324930?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dhallatmaine",
      "html_url": "https://github.com/dhallatmaine",
      "followers_url": "https://api.github.com/users/dhallatmaine/followers",
      "following_url": "https://api.github.com/users/dhallatmaine/following{/other_user}",
      "gists_url": "https://api.github.com/users/dhallatmaine/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dhallatmaine/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dhallatmaine/subscriptions",
      "organizations_url": "https://api.github.com/users/dhallatmaine/orgs",
      "repos_url": "https://api.github.com/users/dhallatmaine/repos",
      "events_url": "https://api.github.com/users/dhallatmaine/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dhallatmaine/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-30T17:26:18Z",
    "updated_at": "2023-01-30T17:26:18Z",
    "author_association": "NONE",
    "body": "Hello, we have been using Besu successfully in production for a few months. Recently, we have noticed the reader node that our block explorer connects to has been running into this issue. For more information, we are running BlockScout and BlockScout relies on the `trace_replayBlockTransactions` endpoint in order to index our chain. The issue seems to be loading into memory all of the TraceFrame's for all transactions within a block. With our specific use case, we have the need for some large transactions with high gas fees.\r\n\r\nIn order to reproduce this, I ran 3 nodes locally built off of main. In the genesis.json file, I specified a large gasLimit:\r\n`\"gasLimit\" : \"0x38D7EA4C67FFF\",`\r\n\r\nI ran the following contract:\r\n```// SPDX-License-Identifier: MIT\r\npragma solidity >=0.4.22 <0.9.0;\r\ncontract GasHog {\r\n  mapping(uint => string) public hogSomeGas1;\r\n  mapping(uint => string) public hogSomeGas2;\r\n  mapping(uint => string) public hogSomeGas3;\r\n  mapping(uint => string) public hogSomeGas4;\r\n  mapping(uint => string) public hogSomeGas5;\r\n  mapping(uint => string) public hogSomeGas6;\r\n  mapping(uint => string) public hogSomeGas7;\r\n  mapping(uint => string) public hogSomeGas8;\r\n  mapping(uint => string) public hogSomeGas9;\r\n  mapping(uint => string) public hogSomeGas10;\r\n  mapping(uint => string) public hogSomeGas11;\r\n  mapping(uint => string) public hogSomeGas12;\r\n  mapping(uint => string) public hogSomeGas13;\r\n  function hogMeSomeGas(uint amount) public {\r\n    for (uint i=0; i < amount; i++) {\r\n      hogSomeGas1[i] = \"LoremIpsumissimplydummytextoftheprintingandtypesettingindustry.LoremIpsumhasbeentheindustrysstandarddummytexteversincethe1500s,whenanunknownprintertookagalleyoftypeandscrambledittomakeatypespecimenbook.Ithassurvivednotonlyfivecenturies,butalsotheleapintoelectronictypesetting,remainingessentiallyunchanged.Itwaspopularisedinthe1960swiththereleaseofLetrasetsheetscontainingLoremIpsumpassages,andmorerecentlywithdesktoppublishingsoftwarelikeAldusPageMakerincludingversionsofLoremIpsum\";\r\n      hogSomeGas2[i] = \"LoremIpsumissimplydummytextoftheprintingandtypesettingindustry.LoremIpsumhasbeentheindustrysstandarddummytexteversincethe1500s,whenanunknownprintertookagalleyoftypeandscrambledittomakeatypespecimenbook.Ithassurvivednotonlyfivecenturies,butalsotheleapintoelectronictypesetting,remainingessentiallyunchanged.Itwaspopularisedinthe1960swiththereleaseofLetrasetsheetscontainingLoremIpsumpassages,andmorerecentlywithdesktoppublishingsoftwarelikeAldusPageMakerincludingversionsofLoremIpsum\";\r\n      hogSomeGas3[i] = \"LoremIpsumissimplydummytextoftheprintingandtypesettingindustry.LoremIpsumhasbeentheindustrysstandarddummytexteversincethe1500s,whenanunknownprintertookagalleyoftypeandscrambledittomakeatypespecimenbook.Ithassurvivednotonlyfivecenturies,butalsotheleapintoelectronictypesetting,remainingessentiallyunchanged.Itwaspopularisedinthe1960swiththereleaseofLetrasetsheetscontainingLoremIpsumpassages,andmorerecentlywithdesktoppublishingsoftwarelikeAldusPageMakerincludingversionsofLoremIpsum\";\r\n      hogSomeGas4[i] = \"LoremIpsumissimplydummytextoftheprintingandtypesettingindustry.LoremIpsumhasbeentheindustrysstandarddummytexteversincethe1500s,whenanunknownprintertookagalleyoftypeandscrambledittomakeatypespecimenbook.Ithassurvivednotonlyfivecenturies,butalsotheleapintoelectronictypesetting,remainingessentiallyunchanged.Itwaspopularisedinthe1960swiththereleaseofLetrasetsheetscontainingLoremIpsumpassages,andmorerecentlywithdesktoppublishingsoftwarelikeAldusPageMakerincludingversionsofLoremIpsum\";\r\n      hogSomeGas5[i] = \"LoremIpsumissimplydummytextoftheprintingandtypesettingindustry.LoremIpsumhasbeentheindustrysstandarddummytexteversincethe1500s,whenanunknownprintertookagalleyoftypeandscrambledittomakeatypespecimenbook.Ithassurvivednotonlyfivecenturies,butalsotheleapintoelectronictypesetting,remainingessentiallyunchanged.Itwaspopularisedinthe1960swiththereleaseofLetrasetsheetscontainingLoremIpsumpassages,andmorerecentlywithdesktoppublishingsoftwarelikeAldusPageMakerincludingversionsofLoremIpsum\";\r\n      hogSomeGas6[i] = \"LoremIpsumissimplydummytextoftheprintingandtypesettingindustry.LoremIpsumhasbeentheindustrysstandarddummytexteversincethe1500s,whenanunknownprintertookagalleyoftypeandscrambledittomakeatypespecimenbook.Ithassurvivednotonlyfivecenturies,butalsotheleapintoelectronictypesetting,remainingessentiallyunchanged.Itwaspopularisedinthe1960swiththereleaseofLetrasetsheetscontainingLoremIpsumpassages,andmorerecentlywithdesktoppublishingsoftwarelikeAldusPageMakerincludingversionsofLoremIpsum\";\r\n      hogSomeGas7[i] = \"LoremIpsumissimplydummytextoftheprintingandtypesettingindustry.LoremIpsumhasbeentheindustrysstandarddummytexteversincethe1500s,whenanunknownprintertookagalleyoftypeandscrambledittomakeatypespecimenbook.Ithassurvivednotonlyfivecenturies,butalsotheleapintoelectronictypesetting,remainingessentiallyunchanged.Itwaspopularisedinthe1960swiththereleaseofLetrasetsheetscontainingLoremIpsumpassages,andmorerecentlywithdesktoppublishingsoftwarelikeAldusPageMakerincludingversionsofLoremIpsum\";\r\n      hogSomeGas8[i] = \"LoremIpsumissimplydummytextoftheprintingandtypesettingindustry.LoremIpsumhasbeentheindustrysstandarddummytexteversincethe1500s,whenanunknownprintertookagalleyoftypeandscrambledittomakeatypespecimenbook.Ithassurvivednotonlyfivecenturies,butalsotheleapintoelectronictypesetting,remainingessentiallyunchanged.Itwaspopularisedinthe1960swiththereleaseofLetrasetsheetscontainingLoremIpsumpassages,andmorerecentlywithdesktoppublishingsoftwarelikeAldusPageMakerincludingversionsofLoremIpsum\";\r\n      hogSomeGas9[i] = \"LoremIpsumissimplydummytextoftheprintingandtypesettingindustry.LoremIpsumhasbeentheindustrysstandarddummytexteversincethe1500s,whenanunknownprintertookagalleyoftypeandscrambledittomakeatypespecimenbook.Ithassurvivednotonlyfivecenturies,butalsotheleapintoelectronictypesetting,remainingessentiallyunchanged.Itwaspopularisedinthe1960swiththereleaseofLetrasetsheetscontainingLoremIpsumpassages,andmorerecentlywithdesktoppublishingsoftwarelikeAldusPageMakerincludingversionsofLoremIpsum\";\r\n      hogSomeGas10[i] = \"LoremIpsumissimplydummytextoftheprintingandtypesettingindustry.LoremIpsumhasbeentheindustrysstandarddummytexteversincethe1500s,whenanunknownprintertookagalleyoftypeandscrambledittomakeatypespecimenbook.Ithassurvivednotonlyfivecenturies,butalsotheleapintoelectronictypesetting,remainingessentiallyunchanged.Itwaspopularisedinthe1960swiththereleaseofLetrasetsheetscontainingLoremIpsumpassages,andmorerecentlywithdesktoppublishingsoftwarelikeAldusPageMakerincludingversionsofLoremIpsum\";\r\n      hogSomeGas11[i] = \"LoremIpsumissimplydummytextoftheprintingandtypesettingindustry.LoremIpsumhasbeentheindustrysstandarddummytexteversincethe1500s,whenanunknownprintertookagalleyoftypeandscrambledittomakeatypespecimenbook.Ithassurvivednotonlyfivecenturies,butalsotheleapintoelectronictypesetting,remainingessentiallyunchanged.Itwaspopularisedinthe1960swiththereleaseofLetrasetsheetscontainingLoremIpsumpassages,andmorerecentlywithdesktoppublishingsoftwarelikeAldusPageMakerincludingversionsofLoremIpsum\";\r\n      hogSomeGas12[i] = \"LoremIpsumissimplydummytextoftheprintingandtypesettingindustry.LoremIpsumhasbeentheindustrysstandarddummytexteversincethe1500s,whenanunknownprintertookagalleyoftypeandscrambledittomakeatypespecimenbook.Ithassurvivednotonlyfivecenturies,butalsotheleapintoelectronictypesetting,remainingessentiallyunchanged.Itwaspopularisedinthe1960swiththereleaseofLetrasetsheetscontainingLoremIpsumpassages,andmorerecentlywithdesktoppublishingsoftwarelikeAldusPageMakerincludingversionsofLoremIpsum\";\r\n      hogSomeGas13[i] = \"LoremIpsumissimplydummytextoftheprintingandtypesettingindustry.LoremIpsumhasbeentheindustrysstandarddummytexteversincethe1500s,whenanunknownprintertookagalleyoftypeandscrambledittomakeatypespecimenbook.Ithassurvivednotonlyfivecenturies,butalsotheleapintoelectronictypesetting,remainingessentiallyunchanged.Itwaspopularisedinthe1960swiththereleaseofLetrasetsheetscontainingLoremIpsumpassages,andmorerecentlywithdesktoppublishingsoftwarelikeAldusPageMakerincludingversionsofLoremIpsum\";\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nThis was deployed via truffle with the following script:\r\n```\r\nconst GasHog = artifacts.require(\"GasHog\");\r\nmodule.exports = async function (deployer, network, accounts) {\r\n  await deployer.deploy(GasHog);\r\n  let contract = await GasHog.deployed();\r\n  for (i = 0; i < 20; i++) {\r\n    contract.hogMeSomeGas(20, { gas: 50000000000, gasPrice: 5000000000000 })\r\n  }\r\n}\r\n```\r\n\r\nPlease note this uses around 300M gas for a single block.\r\n\r\nI then curled the block and this triggered the out of memory successfully.\r\n\r\n`curl -v -XPOST --data '{\"id\":0,\"jsonrpc\":\"2.0\",\"method\":\"trace_replayBlockTransactions\",\"params\":[\"0x4\",[\"trace\"]]}' http://localhost:8542`\r\nI believe we have successfully implemented a fix for this issue and would like to get some community feedback on getting this or something similar to this in.\r\nhttps://github.com/dhallatmaine/besu/commit/af5ecc5f424acf6c5536c6805f37bc792e46ef16",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1409025753/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1409504299",
    "html_url": "https://github.com/hyperledger/besu/issues/3786#issuecomment-1409504299",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3786",
    "id": 1409504299,
    "node_id": "IC_kwDODE2jmc5UA1Qr",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-30T23:16:10Z",
    "updated_at": "2023-01-30T23:16:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "@daniellehrner can you take a look at this proposed fix - using streams instead of lists - https://github.com/dhallatmaine/besu/commit/af5ecc5f424acf6c5536c6805f37bc792e46ef16 ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1409504299/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1410610960",
    "html_url": "https://github.com/hyperledger/besu/issues/3786#issuecomment-1410610960",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3786",
    "id": 1410610960,
    "node_id": "IC_kwDODE2jmc5UFDcQ",
    "user": {
      "login": "daniellehrner",
      "id": 6727189,
      "node_id": "MDQ6VXNlcjY3MjcxODk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6727189?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/daniellehrner",
      "html_url": "https://github.com/daniellehrner",
      "followers_url": "https://api.github.com/users/daniellehrner/followers",
      "following_url": "https://api.github.com/users/daniellehrner/following{/other_user}",
      "gists_url": "https://api.github.com/users/daniellehrner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/daniellehrner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daniellehrner/subscriptions",
      "organizations_url": "https://api.github.com/users/daniellehrner/orgs",
      "repos_url": "https://api.github.com/users/daniellehrner/repos",
      "events_url": "https://api.github.com/users/daniellehrner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/daniellehrner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-31T15:40:07Z",
    "updated_at": "2023-01-31T15:40:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "@dhallatmaine Your fix looks good to me. We would need to measure performance and memory consumption, but if it fixes the problem for you I guess those measurements should definitely show an improvement.\r\n\r\nCould you please open a PR with your changes? Then we could run the additional tests and I would like to get a review from other Besu contributors as well.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1410610960/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
