{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/4007",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/4007/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/4007/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/4007/events",
  "html_url": "https://github.com/hyperledger/besu/issues/4007",
  "id": 1282164429,
  "node_id": "I_kwDODE2jmc5MbEbN",
  "number": 4007,
  "title": "Implement liveness check",
  "user": {
    "login": "daniellehrner",
    "id": 6727189,
    "node_id": "MDQ6VXNlcjY3MjcxODk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6727189?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/daniellehrner",
    "html_url": "https://github.com/daniellehrner",
    "followers_url": "https://api.github.com/users/daniellehrner/followers",
    "following_url": "https://api.github.com/users/daniellehrner/following{/other_user}",
    "gists_url": "https://api.github.com/users/daniellehrner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/daniellehrner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/daniellehrner/subscriptions",
    "organizations_url": "https://api.github.com/users/daniellehrner/orgs",
    "repos_url": "https://api.github.com/users/daniellehrner/repos",
    "events_url": "https://api.github.com/users/daniellehrner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/daniellehrner/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362496,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDk2",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/enhancement",
      "name": "enhancement",
      "color": "a2eeef",
      "default": true,
      "description": "New feature or request"
    },
    {
      "id": 4328706977,
      "node_id": "LA_kwDODE2jmc8AAAABAgLToQ",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamChupa",
      "name": "TeamChupa",
      "color": "fbca04",
      "default": false,
      "description": "GH issues worked on by Chupacabara Team"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-06-23T10:13:57Z",
  "updated_at": "2022-10-25T19:50:23Z",
  "closed_at": "2022-10-25T19:50:22Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Besu offers a [liveness RPC endpoint](https://besu.hyperledger.org/en/latest/HowTo/Interact/APIs/Using-JSON-RPC-API/#liveness). But the endpoint does not do any check and just returns that is is `UP` no matter what: [source code of the check](https://github.com/hyperledger/besu/blob/ed1329cf848a9d7858d039a55add810da3c428b5/ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/health/LivenessCheck.java#L24).\r\n\r\nWe need to define what a proper liveness check looks like and implement it.",
  "closed_by": {
    "login": "daniellehrner",
    "id": 6727189,
    "node_id": "MDQ6VXNlcjY3MjcxODk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6727189?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/daniellehrner",
    "html_url": "https://github.com/daniellehrner",
    "followers_url": "https://api.github.com/users/daniellehrner/followers",
    "following_url": "https://api.github.com/users/daniellehrner/following{/other_user}",
    "gists_url": "https://api.github.com/users/daniellehrner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/daniellehrner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/daniellehrner/subscriptions",
    "organizations_url": "https://api.github.com/users/daniellehrner/orgs",
    "repos_url": "https://api.github.com/users/daniellehrner/repos",
    "events_url": "https://api.github.com/users/daniellehrner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/daniellehrner/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/4007/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/4007/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1164251523",
    "html_url": "https://github.com/hyperledger/besu/issues/4007#issuecomment-1164251523",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4007",
    "id": 1164251523,
    "node_id": "IC_kwDODE2jmc5FZRGD",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-23T10:39:29Z",
    "updated_at": "2022-06-23T10:39:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "That's typically all a liveness endpoint does.  Something context dependent such as reporting if the node is in sync or not is usually a separate health check endpoint. Both are useful in different situations (ie you want a docker container to consider itself started once the liveness check passes - it would time out long before the node finishes syncing and the health check returns OK).",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1164251523/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1185598553",
    "html_url": "https://github.com/hyperledger/besu/issues/4007#issuecomment-1185598553",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4007",
    "id": 1185598553,
    "node_id": "IC_kwDODE2jmc5GqsxZ",
    "user": {
      "login": "antonydenyer",
      "id": 469160,
      "node_id": "MDQ6VXNlcjQ2OTE2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/469160?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/antonydenyer",
      "html_url": "https://github.com/antonydenyer",
      "followers_url": "https://api.github.com/users/antonydenyer/followers",
      "following_url": "https://api.github.com/users/antonydenyer/following{/other_user}",
      "gists_url": "https://api.github.com/users/antonydenyer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/antonydenyer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/antonydenyer/subscriptions",
      "organizations_url": "https://api.github.com/users/antonydenyer/orgs",
      "repos_url": "https://api.github.com/users/antonydenyer/repos",
      "events_url": "https://api.github.com/users/antonydenyer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/antonydenyer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-15T14:24:56Z",
    "updated_at": "2022-07-15T14:24:56Z",
    "author_association": "MEMBER",
    "body": "I think there's potential for some ordering issues here, the `JsonRpcHttpService` starts before ethereum main loop starts. So you could be responding with \"UP\" before besu is fully up, but we're talking nanoseconds. The other possibility is that something fails after the `JsonRpcHttpService` starts, meaning that you could erroneously report as being up when you're not.\r\n\r\nI think the main scenario that would be helpful is around graceful shutdowns. At the moment when you stop besu you may still be serving http requests. Ideally you'd want to indicate that you're shutting down on the LivenessCheck, this would allow k8s/whatever to remove the instance from rotation and direct requests elsewhere, then you could gracefully shutdown besu as normal (let me know if you want me to elaborate more). ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1185598553/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1291059089",
    "html_url": "https://github.com/hyperledger/besu/issues/4007#issuecomment-1291059089",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4007",
    "id": 1291059089,
    "node_id": "IC_kwDODE2jmc5M8_-R",
    "user": {
      "login": "daniellehrner",
      "id": 6727189,
      "node_id": "MDQ6VXNlcjY3MjcxODk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6727189?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/daniellehrner",
      "html_url": "https://github.com/daniellehrner",
      "followers_url": "https://api.github.com/users/daniellehrner/followers",
      "following_url": "https://api.github.com/users/daniellehrner/following{/other_user}",
      "gists_url": "https://api.github.com/users/daniellehrner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/daniellehrner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daniellehrner/subscriptions",
      "organizations_url": "https://api.github.com/users/daniellehrner/orgs",
      "repos_url": "https://api.github.com/users/daniellehrner/repos",
      "events_url": "https://api.github.com/users/daniellehrner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/daniellehrner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-25T19:50:22Z",
    "updated_at": "2022-10-25T19:50:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "  We [discussed this a while ago among the developers](https://wiki.hyperledger.org/display/BESU/2022-07-05+Contributor+Call) and the reason why we always return `UP`is that there is no metric to tell if a Besu node needs a restart or not. Every issue could potentially just be temporary or an external factor, like bad peers or problems with the CL client. A restart would not fix that.\r\n  \r\nWe have updated the documentation of the endpoint to make this behavior clear: https://besu.hyperledger.org/en/stable/public-networks/how-to/use-besu-api/json-rpc/?h=liveness#liveness",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1291059089/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
