{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/6173",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/6173/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/6173/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/6173/events",
  "html_url": "https://github.com/hyperledger/besu/issues/6173",
  "id": 1995556003,
  "node_id": "I_kwDODE2jmc528cSj",
  "number": 6173,
  "title": "BONSAI: Invalid Slot Found for account at 0x",
  "user": {
    "login": "non-fungible-nelson",
    "id": 85905982,
    "node_id": "MDQ6VXNlcjg1OTA1OTgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/non-fungible-nelson",
    "html_url": "https://github.com/non-fungible-nelson",
    "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
    "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
    "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
    "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
    "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
    "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 3013559202,
      "node_id": "MDU6TGFiZWwzMDEzNTU5MjAy",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/mainnet",
      "name": "mainnet",
      "color": "9D578C",
      "default": false,
      "description": ""
    },
    {
      "id": 3932728358,
      "node_id": "LA_kwDODE2jmc7qaKwm",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/syncing",
      "name": "syncing",
      "color": "ECC431",
      "default": false,
      "description": ""
    },
    {
      "id": 5113384824,
      "node_id": "LA_kwDODE2jmc8AAAABMMgPeA",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bonsai",
      "name": "bonsai",
      "color": "0E8A16",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-11-15T20:55:58Z",
  "updated_at": "2023-11-15T21:10:15Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!-- Have you done the following? -->\r\n<!--   * read the Code of Conduct? By filing an Issue, you are expected to -->  \r\n<!--     comply with it, including treating everyone with respect: -->\r\n<!--     https://github.com/hyperledger/besu/blob/main/CODE_OF_CONDUCT.md -->\r\n<!--   * Reproduced the issue in the latest version of the software -->\r\n<!--   * Read the debugging docs: https://besu.hyperledger.org/en/stable/HowTo/Monitor/Logging/ -->\r\n<!--   * Duplicate Issue check:  https://github.com/search?q=+is%3Aissue+repo%3Ahyperledger/Besu -->\r\n<!-- Note:  Not all sections will apply to all issue types. -->\r\n\r\n### Description\r\nAs a user, I am encountering invalid slots in the bonsai tree during normal operation of a validating node. This triggers an auto-heal, but would like this to be avoidable in the future. This occurred on a rocketpool node but not using the rocketpool configs. \r\n\r\nDOCKER environment for 23.10.1. \r\n\r\n[Discord context](https://discord.com/channels/697535391594446898/888098626264502302/1174447261443424297)\r\n\r\n### Acceptance Criteria\r\n* Bonsai PARTIAL and FULL do not encounter invalid slots during normal operation, and the DB does not get corrupted. \r\n\r\n### Logs (if a bug)\r\nFrom the user - \r\n```\r\nsync-mode = \"X_CHECKPOINT\"\r\ndata-storage-format = \"BONSAI\"\r\n```\r\n\r\nHad about 30 of these errors over about 3 hours:\r\n```\r\n2023-11-15 04:29:01.400+00:00 | vert.x-worker-thread-0 | WARN  | BonsaiWorldStateProvider | Invalid slot found for account 0xddac6d3a2a787b1f4bf26ab6faf519ae3f1a94cf at location 0x\r\n2023-11-15 12:40:12.050+00:00 | ForkJoinPool.commonPool-worker-13 | WARN  | BonsaiWorldStateProvider | Invalid slot found for account 0x0c5853bfe1dfaafb2142b2b9fa68e00c923654f7 at location 0x\r\n2023-11-15 12:46:37.308+00:00 | nioEventLoopGroup-3-3 | WARN  | BonsaiWorldStateProvider | Invalid slot found for account 0xc02aaa39b223fe8d0a0e5c4f27ead9083c756cc2 at location 0x\r\n```\r\nEverything was fine keeping up with the chain and looked to be synced for about five hours. Then had another error with the world state. \r\n\r\nAnd have been down now for about an hour while the synchronizer is downloading.\r\n\r\nAny idea how I can validate that I wont continue with this issue? \r\n\r\nzfs pools dont show any disk errors. \r\n\r\n```# Besu has identified a problem with its worldstate database.                         \r\n# Your node will fetch the correct data from peers to repair the problem.             \r\n# Starting the sync pipeline...                                                                    \r\n2023-11-15 19:46:12.398+00:00 | vert.x-worker-thread-0 | INFO  | TransactionPoolFactory | Disabling transaction handling during re-sync\r\n2023-11-15 19:46:12.399+00:00 | vert.x-worker-thread-0 | WARN  | BonsaiWorldStateProvider | Invalid slot found for account 0x966fa7acf1b6c732458e4d3264fd2393aec840ba at location 0x\r\n2023-11-15 19:46:12.399+00:00 | vert.x-worker-thread-0 | INFO  | BonsaiWorldStateKeyValueStorage | Bonsai flat db mode found PARTIAL\r\n2023-11-15 19:46:12.563+00:00 | vert.x-worker-thread-0 | INFO  | DefaultSynchronizer | Starting synchronizer.\r\n2023-11-15 19:46:12.563+00:00 | vert.x-worker-thread-0 | INFO  | FastSyncDownloader | Starting sync\r\n2023-11-15 19:46:12.814+00:00 | nioEventLoopGroup-3-1 | INFO  | SnapWorldStateDownloader | Downloading world state from peers for pivot block 18577783 (0x246d9f028b787aa2b90c6b22322a3a031bfab9211af0579d42b9c251742149ee). State root 0x92a7221f3912bb329c363afe24ecc02883a14195eed91035efcf2a6742ae0bc6 pending requests 0\r\n2023-11-15 19:46:13.495+00:00 | nioEventLoopGroup-3-1 | INFO  | SnapWorldDownloadState | Running world state heal process from peers with pivot block 18577783\r\n2023-11-15 19:46:14.701+00:00 | vert.x-worker-thread-0 | INFO  | BackwardSyncContext | Starting a new backward sync session\r\n\r\n2023-11-15 19:46:18.121+00:00 | nioEventLoopGroup-3-1 | WARN  | DefaultBlockchain | Chain Reorganization +0 new / -1675 old\r\n       Old - hash: 0xd195107e81b11ca67746207a1fb9becfdea256c5c28c3802485ab4e359de96e1, height: 18579458\r\n       New - hash: 0x246d9f028b787aa2b90c6b22322a3a031bfab9211af0579d42b9c251742149ee, height: 18577783\r\n  Ancestor - hash: 0x246d9f028b787aa2b90c6b22322a3a031bfab9211af0579d42b9c251742149ee, height: 18577783\r\n ```\r\n\r\n### Versions (Add all that apply)\r\n* Software version: 23.10.1 \r\n* Docker ENV \r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/6173/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/6173/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
