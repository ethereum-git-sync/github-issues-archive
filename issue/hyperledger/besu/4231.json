{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/4231",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/4231/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/4231/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/4231/events",
  "html_url": "https://github.com/hyperledger/besu/issues/4231",
  "id": 1332197143,
  "node_id": "I_kwDODE2jmc5PZ7cX",
  "number": 4231,
  "title": "Using getFeeHistory with \"earliest\"",
  "user": {
    "login": "sjmini",
    "id": 30855700,
    "node_id": "MDQ6VXNlcjMwODU1NzAw",
    "avatar_url": "https://avatars.githubusercontent.com/u/30855700?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sjmini",
    "html_url": "https://github.com/sjmini",
    "followers_url": "https://api.github.com/users/sjmini/followers",
    "following_url": "https://api.github.com/users/sjmini/following{/other_user}",
    "gists_url": "https://api.github.com/users/sjmini/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sjmini/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sjmini/subscriptions",
    "organizations_url": "https://api.github.com/users/sjmini/orgs",
    "repos_url": "https://api.github.com/users/sjmini/repos",
    "events_url": "https://api.github.com/users/sjmini/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sjmini/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 1537362500,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNTAw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "7057ff",
      "default": true,
      "description": "Good for newcomers"
    },
    {
      "id": 2152224197,
      "node_id": "MDU6TGFiZWwyMTUyMjI0MTk3",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamRevenant",
      "name": "TeamRevenant",
      "color": "78e298",
      "default": false,
      "description": "GH issues worked on by Revenant Team"
    },
    {
      "id": 4609582991,
      "node_id": "LA_kwDODE2jmc8AAAABEsCnjw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/RPC",
      "name": "RPC",
      "color": "1d76db",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "gtebrean",
    "id": 99179176,
    "node_id": "U_kgDOBelaqA",
    "avatar_url": "https://avatars.githubusercontent.com/u/99179176?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gtebrean",
    "html_url": "https://github.com/gtebrean",
    "followers_url": "https://api.github.com/users/gtebrean/followers",
    "following_url": "https://api.github.com/users/gtebrean/following{/other_user}",
    "gists_url": "https://api.github.com/users/gtebrean/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gtebrean/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gtebrean/subscriptions",
    "organizations_url": "https://api.github.com/users/gtebrean/orgs",
    "repos_url": "https://api.github.com/users/gtebrean/repos",
    "events_url": "https://api.github.com/users/gtebrean/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gtebrean/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "gtebrean",
      "id": 99179176,
      "node_id": "U_kgDOBelaqA",
      "avatar_url": "https://avatars.githubusercontent.com/u/99179176?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gtebrean",
      "html_url": "https://github.com/gtebrean",
      "followers_url": "https://api.github.com/users/gtebrean/followers",
      "following_url": "https://api.github.com/users/gtebrean/following{/other_user}",
      "gists_url": "https://api.github.com/users/gtebrean/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gtebrean/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gtebrean/subscriptions",
      "organizations_url": "https://api.github.com/users/gtebrean/orgs",
      "repos_url": "https://api.github.com/users/gtebrean/repos",
      "events_url": "https://api.github.com/users/gtebrean/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gtebrean/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-08-08T17:50:28Z",
  "updated_at": "2023-05-02T11:25:33Z",
  "closed_at": "2023-05-02T11:25:33Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nWhen getFeeHistory web3 API is used with \"earliest\" tag as below example,\r\nit seems that the node produces the wrong output.\r\n\r\n_**web3_nethermind.eth.getFeeHistory(400, \"earliest\", [20]);**_\r\n\r\n\r\n**Expected behavior:**\r\nDifferent clients give the below response.\r\n{\r\n        \"oldestBlock\": \"0x0\",\r\n        \"reward\": [\r\n            [\r\n                \"0x0\"\r\n            ]\r\n        ],\r\n        \"baseFeePerGas\": [\r\n            \"0x0\",\r\n            \"0x3b9aca00\"\r\n        ],\r\n        \"gasUsedRatio\": [\r\n            0\r\n        ]\r\n    },\r\n\r\n**Actual behavior:** \r\n\r\nOnly the besu produce different results.\r\n\r\n\"oldestBlock\": \"0x0\",\r\n        \"baseFeePerGas\": [\r\n            \"0x0\",\r\n            \"0x3b9aca00\",\r\n            \"0x342770c0\",\r\n            \"0x2da282a8\",\r\n            \"0x27ee3253\",\r\n            \"0x22f06c09\",\r\n            \"0x1e925e88\",\r\n            \"0x1ac012b7\",\r\n            \"0x17681061\",\r\n            \"0x147b0e55\",\r\n            \"0x11ed611c\",\r\n            \"0xfafb4f9\",\r\n            \"0xdbb0c12\",\r\n            \"0xc03aa90\",\r\n            \"0xa83353e\",\r\n            \"0x933ad95\",\r\n            \"0x80d37e3\",\r\n            \"0x70c3b5d\",\r\n            \"0x62ab3f2\",\r\n            \"0x565dfc1\",\r\n            \"0x4b995bb\",\r\n            \"0x4226304\"\r\n   ...\r\n   ...\r\n   ]\r\n \"gasUsedRatio\": [\r\n            0,\r\n            0,\r\n            0,\r\n            0,\r\n            0,\r\n            0,\r\n            0,\r\n            0,\r\n            0,\r\n            0.0013010214939282877,\r\n            0,\r\n            0.0012984844028217674,\r\n            0,\r\n            0,\r\n            0.0012946880060842939,\r\n            0,\r\n            0.0012921632880903895,\r\n            0,\r\n            0.0012896434872696834,\r\n            0.0012883854505698652,\r\n            0,\r\n   ...\r\n   ...\r\n]\r\n\r\n**Frequency:** \r\nAlways\r\n\r\n### Versions (Add all that apply)\r\n* Software version: \r\nbesu/v22.4.4/linux-x86_64/openjdk-java-11\r\n",
  "closed_by": {
    "login": "gtebrean",
    "id": 99179176,
    "node_id": "U_kgDOBelaqA",
    "avatar_url": "https://avatars.githubusercontent.com/u/99179176?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gtebrean",
    "html_url": "https://github.com/gtebrean",
    "followers_url": "https://api.github.com/users/gtebrean/followers",
    "following_url": "https://api.github.com/users/gtebrean/following{/other_user}",
    "gists_url": "https://api.github.com/users/gtebrean/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gtebrean/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gtebrean/subscriptions",
    "organizations_url": "https://api.github.com/users/gtebrean/orgs",
    "repos_url": "https://api.github.com/users/gtebrean/repos",
    "events_url": "https://api.github.com/users/gtebrean/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gtebrean/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/4231/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/4231/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1414736484",
    "html_url": "https://github.com/hyperledger/besu/issues/4231#issuecomment-1414736484",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4231",
    "id": 1414736484,
    "node_id": "IC_kwDODE2jmc5UUypk",
    "user": {
      "login": "iamhsk",
      "id": 2249367,
      "node_id": "MDQ6VXNlcjIyNDkzNjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2249367?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iamhsk",
      "html_url": "https://github.com/iamhsk",
      "followers_url": "https://api.github.com/users/iamhsk/followers",
      "following_url": "https://api.github.com/users/iamhsk/following{/other_user}",
      "gists_url": "https://api.github.com/users/iamhsk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iamhsk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iamhsk/subscriptions",
      "organizations_url": "https://api.github.com/users/iamhsk/orgs",
      "repos_url": "https://api.github.com/users/iamhsk/repos",
      "events_url": "https://api.github.com/users/iamhsk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iamhsk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-03T02:52:05Z",
    "updated_at": "2023-02-03T02:52:05Z",
    "author_association": "NONE",
    "body": "Check if there is a hive test related to this. Also check how Geth's output looks like. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1414736484/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1415108074",
    "html_url": "https://github.com/hyperledger/besu/issues/4231#issuecomment-1415108074",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4231",
    "id": 1415108074,
    "node_id": "IC_kwDODE2jmc5UWNXq",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-03T06:25:13Z",
    "updated_at": "2023-02-03T06:25:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "would be good to add a \"by spec\" test for this - see org/hyperledger/besu/ethereum/api/jsonrpc/bonsai/EthJsonRpcHttpBySpecTest.java",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1415108074/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1415109464",
    "html_url": "https://github.com/hyperledger/besu/issues/4231#issuecomment-1415109464",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4231",
    "id": 1415109464,
    "node_id": "IC_kwDODE2jmc5UWNtY",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-03T06:26:06Z",
    "updated_at": "2023-02-03T06:26:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "there is 1 `rpc-compat` hive test for eth_feeHistory https://hivetests2.ethdevops.io/",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1415109464/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1521972701",
    "html_url": "https://github.com/hyperledger/besu/issues/4231#issuecomment-1521972701",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4231",
    "id": 1521972701,
    "node_id": "IC_kwDODE2jmc5at3Xd",
    "user": {
      "login": "gtebrean",
      "id": 99179176,
      "node_id": "U_kgDOBelaqA",
      "avatar_url": "https://avatars.githubusercontent.com/u/99179176?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gtebrean",
      "html_url": "https://github.com/gtebrean",
      "followers_url": "https://api.github.com/users/gtebrean/followers",
      "following_url": "https://api.github.com/users/gtebrean/following{/other_user}",
      "gists_url": "https://api.github.com/users/gtebrean/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gtebrean/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gtebrean/subscriptions",
      "organizations_url": "https://api.github.com/users/gtebrean/orgs",
      "repos_url": "https://api.github.com/users/gtebrean/repos",
      "events_url": "https://api.github.com/users/gtebrean/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gtebrean/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-25T15:16:08Z",
    "updated_at": "2023-04-25T15:16:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "I took the sample used for testing in #4243 and tested it on Besu 23.1.3 and I got the same behaviour as for v22.4.4:\r\n\r\nGeth:\r\n```\r\n{\r\n  oldestBlock: '0x0',\r\n  reward: [ [ '0x0' ], [ '0x0' ], [ '0x0' ], [ '0x0' ], [ '0x0' ], [ '0x0' ] ],\r\n  baseFeePerGas: [\r\n    '0x0',\r\n    '0x3b9aca00',\r\n    '0x342770c0',\r\n    '0x2da282a8',\r\n    '0x27ee3253',\r\n    '0x22f06c09',\r\n    '0x1e925e88'\r\n  ],\r\n  gasUsedRatio: [ 0, 0, 0, 0, 0, 0 ]\r\n}\r\n```\r\n\r\nBesu:\r\n```\r\n{\r\n  oldestBlock: '0x0',\r\n  baseFeePerGas: [\r\n    '0x0',        '0x3b9aca00',\r\n    '0x342770c0', '0x2da282a8',\r\n    '0x27ee3253', '0x22f06c09',\r\n    '0x1e925e88', '0x1ac012b7',\r\n    '0x17681061', '0x147b0e55',\r\n    '0x1e925e88'\r\n  ],\r\n  gasUsedRatio: [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0.0013010214939282877 ],\r\n  reward: [\r\n    [ '0x0' ],\r\n    [ '0x0' ],\r\n    [ '0x0' ],\r\n    [ '0x0' ],\r\n    [ '0x0' ],\r\n    [ '0x0' ],\r\n    [ '0x0' ],\r\n    [ '0x0' ],\r\n    [ '0x0' ],\r\n    [ '0x1158ae3ab' ]\r\n  ]\r\n}\r\n```\r\nThis above behaviour happens for the following call web3.eth.getFeeHistory(10, \"5\", [60]).\r\nRemember that the paramenters represents:\r\n\r\nblockCount: [Numbers](https://docs.web3js.org/api/web3/namespace/types#Numbers)\r\nNumber of blocks in the requested range. Between 1 and 1024 blocks can be requested in a single query. Less than requested may be returned if not all blocks are available.\r\n\r\nnewestBlock: [BlockNumberOrTag](https://docs.web3js.org/api/web3/namespace/types#BlockNumberOrTag) = web3Context.defaultBlock\r\nHighest number block of the requested range.\r\n\r\nrewardPercentiles: [Numbers](https://docs.web3js.org/api/web3/namespace/types#Numbers)[]\r\nA monotonically increasing list of percentile values to sample from each block’s effective priority fees per gas in ascending order, weighted by gas used. Example: [“0”, “25”, “50”, “75”, “100”] or [“0”, “0.5”, “1”, “1.5”, “3”, “80”]\r\n\r\nNOTE! Found out that both Besu and Geth are retuning the same results if `newestBlock = \"latest\"` or if `newestBlock + 1 >= blockCount`. I rest Besu will return **wrong** values.\r\n\r\n**Conclusion** there is a bug that can be reproduced every time when getFeeHistory is called with a value `newestBlock` < `blockCount -1`\r\n\r\nI'm looking forward to find a solution.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1521972701/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1531302812",
    "html_url": "https://github.com/hyperledger/besu/issues/4231#issuecomment-1531302812",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4231",
    "id": 1531302812,
    "node_id": "IC_kwDODE2jmc5bRdOc",
    "user": {
      "login": "gtebrean",
      "id": 99179176,
      "node_id": "U_kgDOBelaqA",
      "avatar_url": "https://avatars.githubusercontent.com/u/99179176?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gtebrean",
      "html_url": "https://github.com/gtebrean",
      "followers_url": "https://api.github.com/users/gtebrean/followers",
      "following_url": "https://api.github.com/users/gtebrean/following{/other_user}",
      "gists_url": "https://api.github.com/users/gtebrean/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gtebrean/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gtebrean/subscriptions",
      "organizations_url": "https://api.github.com/users/gtebrean/orgs",
      "repos_url": "https://api.github.com/users/gtebrean/repos",
      "events_url": "https://api.github.com/users/gtebrean/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gtebrean/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-02T11:25:33Z",
    "updated_at": "2023-05-02T11:25:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm closing this as the PR has been merged. If will occur again I will reopen it.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1531302812/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
