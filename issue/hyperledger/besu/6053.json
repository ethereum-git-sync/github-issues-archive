{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/6053",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/6053/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/6053/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/6053/events",
  "html_url": "https://github.com/hyperledger/besu/issues/6053",
  "id": 1950588061,
  "node_id": "I_kwDODE2jmc50Q5yd",
  "number": 6053,
  "title": "BftProcessorExecutor-QBFT-0 | ERROR | AbstractBlockProcessor | failed persisting block org.hyperledger.besu.plugin.services.exception.StorageException: org.rocksdb.RocksDBException: Busy",
  "user": {
    "login": "kkeaton-rcp",
    "id": 110416443,
    "node_id": "U_kgDOBpTSOw",
    "avatar_url": "https://avatars.githubusercontent.com/u/110416443?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kkeaton-rcp",
    "html_url": "https://github.com/kkeaton-rcp",
    "followers_url": "https://api.github.com/users/kkeaton-rcp/followers",
    "following_url": "https://api.github.com/users/kkeaton-rcp/following{/other_user}",
    "gists_url": "https://api.github.com/users/kkeaton-rcp/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kkeaton-rcp/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kkeaton-rcp/subscriptions",
    "organizations_url": "https://api.github.com/users/kkeaton-rcp/orgs",
    "repos_url": "https://api.github.com/users/kkeaton-rcp/repos",
    "events_url": "https://api.github.com/users/kkeaton-rcp/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kkeaton-rcp/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-10-18T20:25:05Z",
  "updated_at": "2023-10-18T20:25:05Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nI have a private blockchain where all the validator nodes crashed and stopped processing blocks. They all seemed to have the error(s) attached below. This is extremely similar to [https://github.com/hyperledger/besu/issues/5441] which happened on besu version 23.4.0. However, the solution says it was an underlying hardware issue which I feel is unlikely as this happened to my nodes running on AWS. Any further discussion on this issue would be greatly appreciated, thank you!\r\n\r\n### Steps to Reproduce\r\nI am unsure how to reproduce this error as it seems to be an error with rocksdb. Using v23.1.2, ubuntu 22.04 running on t2.large aws instances.\r\n\r\n**Expected behavior:** \r\nExpected the system to fix the error and start processing blocks again. \r\n\r\n**Actual behavior:** \r\nError continues and seems to cause additional errors for the blockchain that cause the blockchain to stop processing blocks.\r\n\r\n**Frequency:** \r\nThis has only happened once so far on October 12th. \r\n\r\n### Versions \r\nSoftware version: besu v23.1.2\r\nJava version: 17.0.8.1\r\nOS Name & Version: Ubuntu 22.04.2 LTS\r\nKernel Version: x86_64\r\nCloud VM, type, size: AWS t2-large\r\n\r\n### Logs\r\n```\r\n2023-10-12 00:13:21.013+00:00 | BftProcessorExecutor-QBFT-0 | ERROR | AbstractBlockProcessor | failed persisting block\r\norg.hyperledger.besu.plugin.services.exception.StorageException: org.rocksdb.RocksDBException: Busy\r\n        at org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage$RocksDbTransaction.commit(RocksDBColumnarKeyValueStorage.java:408)\r\n        at org.hyperledger.besu.services.kvstore.SegmentedKeyValueStorageTransactionTransitionValidatorDecorator.commit(SegmentedKeyValueStorageTransactionTransitionValidatorDecorator.java:59)\r\n        at org.hyperledger.besu.services.kvstore.SegmentedKeyValueStorageAdapter$1.commit(SegmentedKeyValueStorageAdapter.java:137)\r\n        at org.hyperledger.besu.ethereum.storage.keyvalue.WorldStateKeyValueStorage$Updater.commit(WorldStateKeyValueStorage.java:216)\r\n        at org.hyperledger.besu.ethereum.worldstate.DefaultMutableWorldState.persist(DefaultMutableWorldState.java:198)\r\n        at org.hyperledger.besu.ethereum.mainnet.AbstractBlockProcessor.processBlock(AbstractBlockProcessor.java:179)\r\n        at org.hyperledger.besu.ethereum.mainnet.BlockProcessor.processBlock(BlockProcessor.java:78)\r\n        at org.hyperledger.besu.ethereum.MainnetBlockValidator.processBlock(MainnetBlockValidator.java:228)\r\n        at org.hyperledger.besu.ethereum.MainnetBlockValidator.validateAndProcessBlock(MainnetBlockValidator.java:137)\r\n        at org.hyperledger.besu.ethereum.MainnetBlockValidator.validateAndProcessBlock(MainnetBlockValidator.java:74)\r\n        at org.hyperledger.besu.consensus.qbft.validation.ProposalPayloadValidator.validateBlock(ProposalPayloadValidator.java:148)\r\n        at org.hyperledger.besu.consensus.qbft.validation.ProposalPayloadValidator.validate(ProposalPayloadValidator.java:127)\r\n        at org.hyperledger.besu.consensus.qbft.validation.ProposalValidator.validate(ProposalValidator.java:100)\r\n        at org.hyperledger.besu.consensus.qbft.validation.MessageValidator.validateProposal(MessageValidator.java:133)\r\n        at org.hyperledger.besu.consensus.qbft.statemachine.RoundState.setProposedBlock(RoundState.java:87)\r\n        at org.hyperledger.besu.consensus.qbft.statemachine.QbftRound.updateStateWithProposedBlock(QbftRound.java:258)\r\n        at org.hyperledger.besu.consensus.qbft.statemachine.QbftRound.handleProposalMessage(QbftRound.java:202)\r\n        at org.hyperledger.besu.consensus.qbft.statemachine.QbftBlockHeightManager.lambda$handleProposalPayload$1(QbftBlockHeightManager.java:207)\r\n        at java.base/java.util.Optional.ifPresent(Optional.java:178)\r\n        at org.hyperledger.besu.consensus.qbft.statemachine.QbftBlockHeightManager.handleProposalPayload(QbftBlockHeightManager.java:207)\r\n        at org.hyperledger.besu.consensus.common.bft.statemachine.BaseBftController.consumeMessage(BaseBftController.java:126)\r\n        at org.hyperledger.besu.consensus.qbft.statemachine.QbftController.handleMessage(QbftController.java:81)\r\n        at org.hyperledger.besu.consensus.common.bft.statemachine.BaseBftController.handleMessageEvent(BaseBftController.java:88)\r\n        at org.hyperledger.besu.consensus.common.bft.EventMultiplexer.handleBftEvent(EventMultiplexer.java:53)\r\n        at java.base/java.util.Optional.ifPresent(Optional.java:178)\r\n        at org.hyperledger.besu.consensus.common.bft.BftProcessor.run(BftProcessor.java:65)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\r\n        at java.base/java.lang.Thread.run(Thread.java:833)\r\nCaused by: org.rocksdb.RocksDBException: Busy\r\n        at org.rocksdb.Transaction.commit(Native Method)\r\n        at org.rocksdb.Transaction.commit(Transaction.java:208)\r\n        at org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage$RocksDbTransaction.commit(RocksDBColumnarKeyValueStorage.java:402)\r\n        ... 28 more\r\n2023-10-12 00:13:21.014+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | MainnetBlockValidator | Invalid block <block number> (0x5...): Optional[org.rocksdb.RocksDBException: Busy], caused by org.hyperledger.besu.plugin.services.exception.StorageException: org.rocksdb.RocksDBException: Busy\r\n2023-10-12 00:13:21.014+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | ProposalPayloadValidator | Invalid Proposal Payload: block did not pass validation. Reason Optional[org.rocksdb.RocksDBException: Busy]\r\n2023-10-12 00:13:21.014+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | ProposalValidator | Invalid Proposal Payload: invalid proposal payload in proposal message\r\n2023-10-12 00:13:21.036+00:00 | EthScheduler-Workers-0 | INFO  | PersistBlockTask | Imported #7,213,038 / 2 tx / 0 om / 11,175,311 (0.0%) gas / (0x5...) in 2.921s. Peers: 11\r\n2023-10-12 00:13:21.067+00:00 | EthScheduler-Workers-0 | INFO  | PersistBlockTask | Block 7213039 (0x1...) is already imported\r\n2023-10-12 00:13:21.067+00:00 | EthScheduler-Workers-0 | INFO  | BlockPropagationManager | Imported 1 pending blocks: [7213039]\r\n2023-10-12 00:13:30.506+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | QbftRound | Importing proposed block to chain. round=ConsensusRoundIdentifier{Sequence=7213040, Round=1}, hash=0x1...\r\n2023-10-12 00:13:30.760+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | QbftBesuControllerBuilder | Imported #7,213,040 / 2 tx / 2 pending / 11,175,311 (0.0%) gas / (0x1...)\r\n2023-10-12 00:13:30.770+00:00 | EthScheduler-Workers-0 | INFO  | PersistBlockTask | Imported #7,213,040 / 2 tx / 0 om / 11,175,311 (0.0%) gas / (0x1...) in 0.784s. Peers: 11\r\n2023-10-12 00:13:38.923+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | QbftRound | Importing proposed block to chain. round=ConsensusRoundIdentifier{Sequence=7213041, Round=1}, hash=0xc...\r\n2023-10-12 00:13:39.955+00:00 | EthScheduler-Workers-0 | INFO  | PersistBlockTask | Block 7213041 (0xc...) is already imported\r\n2023-10-12 00:13:39.958+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | QbftBesuControllerBuilder | Produced #7,213,041 / 2 tx / 2 pending / 11,175,299 (0.0%) gas / (0xc...)\r\n2023-10-12 00:13:40.070+00:00 | EthScheduler-Workers-0 | INFO  | PersistBlockTask | Imported #7,213,042 / 0 tx / 0 om / 0 (0.0%) gas / (0x13...) in 0.001s. Peers: 11\r\n2023-10-12 00:13:52.327+00:00 | nioEventLoopGroup-3-7 | INFO  | BlockPropagationManager | Saved announced block for future import 7213044 (0x98...) - 1 saved block(s)\r\n2023-10-12 00:13:52.327+00:00 | nioEventLoopGroup-3-7 | INFO  | BlockPropagationManager | Retrieving parent 0x92... of block 7213044 (0x98...)\r\n2023-10-12 00:13:52.339+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | QbftRound | Importing proposed block to chain. round=ConsensusRoundIdentifier{Sequence=7213043, Round=1}, hash=0x92...\r\n2023-10-12 00:13:52.747+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | QbftBesuControllerBuilder | Imported #7,213,043 / 2 tx / 2 pending / 11,175,287 (0.0%) gas / (0x92...)\r\n2023-10-12 00:13:52.821+00:00 | EthScheduler-Workers-0 | INFO  | PersistBlockTask | Imported #7,213,043 / 2 tx / 0 om / 11,175,287 (0.0%) gas / (0x92...) in 1.723s. Peers: 11\r\n2023-10-12 00:13:52.823+00:00 | EthScheduler-Workers-0 | INFO  | PersistBlockTask | Imported #7,213,044 / 0 tx / 0 om / 0 (0.0%) gas / (0x98...) in 0.001s. Peers: 11\r\n2023-10-12 00:13:52.823+00:00 | EthScheduler-Workers-0 | INFO  | BlockPropagationManager | Imported 1 pending blocks: [7213044]\r\n2023-10-12 00:14:02.543+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | QbftRound | Importing proposed block to chain. round=ConsensusRoundIdentifier{Sequence=7213045, Round=1}, hash=0xec...\r\n2023-10-12 00:14:03.218+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | QbftBesuControllerBuilder | Imported #7,213,045 / 2 tx / 1 pending / 11,175,299 (0.0%) gas / (0xec...)\r\n2023-10-12 00:14:03.219+00:00 | EthScheduler-Workers-0 | INFO  | PersistBlockTask | Imported #7,213,045 / 2 tx / 0 om / 11,175,299 (0.0%) gas / (0xec...) in 1.330s. Peers: 11\r\n2023-10-12 00:14:18.582+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | ProposalValidator | Invalid Proposal Payload: Latest Prepared Metadata blockhash does not align with proposed block\r\n2023-10-12 00:14:35.468+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | ProposalValidator | Invalid Proposal Payload: Latest Prepared Metadata blockhash does not align with proposed block\r\n2023-10-12 00:15:07.559+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | ProposalValidator | Invalid Proposal Payload: Latest Prepared Metadata blockhash does not align with proposed block\r\n2023-10-12 00:15:07.559+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | QbftBlockHeightManager | Received future Proposal which is illegal, no round change triggered.\r\n2023-10-12 00:16:08.620+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | ProposalValidator | Invalid Proposal Payload: Latest Prepared Metadata blockhash does not align with proposed block\r\n2023-10-12 00:18:16.978+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | ProposalValidator | Invalid Proposal Payload: Latest Prepared Metadata blockhash does not align with proposed block\r\n2023-10-12 00:22:33.139+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | ProposalValidator | Invalid Proposal Payload: Latest Prepared Metadata blockhash does not align with proposed block\r\n2023-10-12 00:31:04.671+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | ProposalValidator | Invalid Proposal Payload: Latest Prepared Metadata blockhash does not align with proposed block\r\n2023-10-12 00:48:08.598+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | ProposalValidator | Invalid Proposal Payload: Latest Prepared Metadata blockhash does not align with proposed block\r\n2023-10-12 01:22:16.671+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | ProposalValidator | Invalid Proposal Payload: Latest Prepared Metadata blockhash does not align with proposed block\r\n2023-10-12 02:30:32.530+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | ProposalValidator | Invalid Proposal Payload: Latest Prepared Metadata blockhash does not align with proposed block\r\n2023-10-12 02:30:32.530+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | QbftBlockHeightManager | Received future Proposal which is illegal, no round change triggered.\r\n2023-10-12 04:47:04.668+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | ProposalValidator | Invalid Proposal Payload: Latest Prepared Metadata blockhash does not align with proposed block\r\n2023-10-12 09:20:08.665+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | ProposalValidator | Invalid Proposal Payload: Latest Prepared Metadata blockhash does not align with proposed block\r\n2023-10-12 18:26:16.710+00:00 | BftProcessorExecutor-QBFT-0 | INFO  | ProposalValidator | Invalid Proposal Payload: Latest Prepared Metadata blockhash does not align with proposed block\r\n```\r\n\r\n### Additional Information \r\nBesu setup info \r\n\r\n```\r\nbesu --data-path=<path> \\\r\n    --miner-enabled \\\r\n    --miner-coinbase=0x0000000000000000000000000000000000000000 \\\r\n    --min-gas-price=0 \\\r\n    --genesis-file=<path> \\\r\n    --rpc-http-enabled \\\r\n    --rpc-http-api=ETH,NET,QBFT,WEB3,ADMIN,TXPOOL \\\r\n    --host-allowlist=\"*\" \\\r\n    --rpc-http-cors-origins=\"all\" \\\r\n    --discovery-enabled=false \\\r\n    --Xdns-enabled=true \\\r\n    --rpc-http-port=23000 \\\r\n    --rpc-http-host=$IP \\\r\n    --p2p-port=54000 \\\r\n    --p2p-host=$IP \\\r\n    --p2p-interface=$IP \\\r\n    --sync-mode=FULL \\\r\n    --metrics-enabled \\\r\n    --static-nodes-file=<path>  > /tmp/besu-$(date '+%s').out 2>&1\r\n```\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/6053/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/6053/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
