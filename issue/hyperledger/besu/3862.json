{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/3862",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/3862/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/3862/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/3862/events",
  "html_url": "https://github.com/hyperledger/besu/issues/3862",
  "id": 1241389677,
  "node_id": "I_kwDODE2jmc5J_hpt",
  "number": 3862,
  "title": "Peer validation by Total Terminal Difficulty (TTD)",
  "user": {
    "login": "fab-10",
    "id": 91944855,
    "node_id": "U_kgDOBXr3lw",
    "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fab-10",
    "html_url": "https://github.com/fab-10",
    "followers_url": "https://api.github.com/users/fab-10/followers",
    "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
    "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
    "organizations_url": "https://api.github.com/users/fab-10/orgs",
    "repos_url": "https://api.github.com/users/fab-10/repos",
    "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fab-10/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-05-19T08:04:23Z",
  "updated_at": "2023-01-26T11:13:54Z",
  "closed_at": "2023-01-26T11:13:53Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!-- Have you done the following? -->\r\n<!--   * read the Code of Conduct? By filing an Issue, you are expected to -->  \r\n<!--     comply with it, including treating everyone with respect: -->\r\n<!--     https://github.com/hyperledger/besu/blob/main/CODE_OF_CONDUCT.md -->\r\n<!--   * Reproduced the issue in the latest version of the software -->\r\n<!--   * Read the debugging docs: https://besu.hyperledger.org/en/stable/HowTo/Monitor/Logging/ -->\r\n<!--   * Duplicate Issue check:  https://github.com/search?q=+is%3Aissue+repo%3Ahyperledger/Besu -->\r\n<!-- Note:  Not all sections will apply to all issue types. -->\r\n\r\n### Description\r\n\r\nThe switch to PoS happens when the PoW chain total difficulty reaches the value speficied by TTD, after that event, the difficulty will never increase again, and so total difficulty will remain fixed at the last value.\r\nIt could happen that not all the Execution Clients will agree with the switch to PoS, and they could continue to follow the PoW chain, causing forks that will continue to increase the total difficulty, with values that could be higher than TTD. These peers are not useful for Besu after it switched to PoS, and viceversa, so it make sense to extend the peer validation mechanism to avoid that Besu estabilishes a connection with them.\r\n\r\nPeer validation rules are defined in the package `org.hyperledger.besu.ethereum.eth.peervalidation`.\r\n\r\nBasically the new `TotalTerminalDifficultyPeerValidator`, should be enabled only if the TTD value is present in the genesis file, and should behave like that, if TTD has been reached (i.e. Besu switched to PoS), then a peer is invalid if its total difficulty is not equal to our total difficulty.\r\n\r\nThis also helps with the peering on shadow forks testnets.\r\n\r\n### Acceptance Criteria\r\n* Before the switch to PoS nothing changes\r\n* After the switch to PoS clients that continue to follow PoW, will be considered invalid on connection\r\n\r\n",
  "closed_by": {
    "login": "non-fungible-nelson",
    "id": 85905982,
    "node_id": "MDQ6VXNlcjg1OTA1OTgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/non-fungible-nelson",
    "html_url": "https://github.com/non-fungible-nelson",
    "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
    "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
    "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
    "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
    "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
    "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/3862/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/3862/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1404861286",
    "html_url": "https://github.com/hyperledger/besu/issues/3862#issuecomment-1404861286",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3862",
    "id": 1404861286,
    "node_id": "IC_kwDODE2jmc5TvHtm",
    "user": {
      "login": "non-fungible-nelson",
      "id": 85905982,
      "node_id": "MDQ6VXNlcjg1OTA1OTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/non-fungible-nelson",
      "html_url": "https://github.com/non-fungible-nelson",
      "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
      "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
      "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
      "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
      "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
      "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-26T11:13:53Z",
    "updated_at": "2023-01-26T11:13:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closed as irrelevant post-merge ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1404861286/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
