{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/3201",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/3201/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/3201/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/3201/events",
  "html_url": "https://github.com/hyperledger/besu/issues/3201",
  "id": 1084029972,
  "node_id": "I_kwDODE2jmc5AnPwU",
  "number": 3201,
  "title": "eth_feeHistory does not return transaction effective priority fee per gas history",
  "user": {
    "login": "JustNotHelpful",
    "id": 96366920,
    "node_id": "U_kgDOBb5xSA",
    "avatar_url": "https://avatars.githubusercontent.com/u/96366920?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/JustNotHelpful",
    "html_url": "https://github.com/JustNotHelpful",
    "followers_url": "https://api.github.com/users/JustNotHelpful/followers",
    "following_url": "https://api.github.com/users/JustNotHelpful/following{/other_user}",
    "gists_url": "https://api.github.com/users/JustNotHelpful/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/JustNotHelpful/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/JustNotHelpful/subscriptions",
    "organizations_url": "https://api.github.com/users/JustNotHelpful/orgs",
    "repos_url": "https://api.github.com/users/JustNotHelpful/repos",
    "events_url": "https://api.github.com/users/JustNotHelpful/events{/privacy}",
    "received_events_url": "https://api.github.com/users/JustNotHelpful/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-12-19T07:08:27Z",
  "updated_at": "2021-12-21T23:07:03Z",
  "closed_at": "2021-12-21T23:07:03Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nAs an user, I want to be able to see the priority fee history on Mainnnet to estimate current gas prices and track trends over time. The current implementation only provides the basefee history.\r\n\r\n### Acceptance Criteria\r\n* A call to eth_feeHistory should return the basefee history and the priority / reward fee history\r\n\r\n### Steps to Reproduce (Bug)\r\n1. Execute the below command whilst connected to the node via SSH (can also be ran remotely):\r\ncurl -X POST --data '{\"jsonrpc\":\"2.0\",\"method\":\"eth_feeHistory\",\"params\":[2,\"latest\"],\"id\":1}' http://127.0.0.1:8545\r\n\r\n\r\n**Expected behavior:**\r\n\r\nI would expect a mainnet node to return results as per https://github.com/ethereum/execution-specs/pull/212/commits/45d49bf403e0a5ec356e4940cf15800d0a59a661\r\n\r\n{\r\n  \"jsonrpc\" : \"2.0\",\r\n  \"id\" : 1,\r\n  \"result\" : {\r\n    \"oldestBlock\" : \"0xd316fb\",\r\n    \"baseFeePerGas\" : [ \"0x896dc065a\", \"0x9a975fe20\", \"0xa28748cc8\" ],\r\n    \"gasUsedRatio\" : [ 0.9995342762406927, 0.705371128050491 ],\r\n    \"reward\" : (as per spec)\r\n  }\r\n\r\n**Actual behavior:** [What actually happens]\r\nSample from querying my mainnet node earlier today. There is no priority fee history, which is not credible for mainnet.\r\n\r\n{\r\n  \"jsonrpc\" : \"2.0\",\r\n  \"id\" : 1,\r\n  \"result\" : {\r\n    \"oldestBlock\" : \"0xd316fb\",\r\n    \"baseFeePerGas\" : [ \"0x896dc065a\", \"0x9a975fe20\", \"0xa28748cc8\" ],\r\n    \"gasUsedRatio\" : [ 0.9995342762406927, 0.705371128050491 ]\r\n  }\r\n\r\n**Frequency:** 100%\r\n\r\n### Versions (Add all that apply)\r\n* Software version: 21.10.4\r\n* Java version: Not sure (using docker).\r\n* OS Name & Version: Ubuntu 20.04.3 LTS\r\n* Kernel Version: Linux ****** 5.4.0-91-generic #102-Ubuntu SMP Fri Nov 5 16:31:28 UTC 2021 x86_64 x86_64 x86_64 GNU/Linux\r\n* Docker Version: 20.10.7\r\n\r\n### Additional Information\r\n\r\n",
  "closed_by": {
    "login": "JustNotHelpful",
    "id": 96366920,
    "node_id": "U_kgDOBb5xSA",
    "avatar_url": "https://avatars.githubusercontent.com/u/96366920?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/JustNotHelpful",
    "html_url": "https://github.com/JustNotHelpful",
    "followers_url": "https://api.github.com/users/JustNotHelpful/followers",
    "following_url": "https://api.github.com/users/JustNotHelpful/following{/other_user}",
    "gists_url": "https://api.github.com/users/JustNotHelpful/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/JustNotHelpful/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/JustNotHelpful/subscriptions",
    "organizations_url": "https://api.github.com/users/JustNotHelpful/orgs",
    "repos_url": "https://api.github.com/users/JustNotHelpful/repos",
    "events_url": "https://api.github.com/users/JustNotHelpful/events{/privacy}",
    "received_events_url": "https://api.github.com/users/JustNotHelpful/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/3201/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/3201/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/998853315",
    "html_url": "https://github.com/hyperledger/besu/issues/3201#issuecomment-998853315",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3201",
    "id": 998853315,
    "node_id": "IC_kwDODE2jmc47iUrD",
    "user": {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-21T15:06:28Z",
    "updated_at": "2021-12-21T15:06:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @JustNotHelpful, I have checked this, and Besu actually calculates and returns the reward field, but only if in the request you specify the `rewardPercentiles` parameter like that:\r\n\r\n```\r\ncurl -X POST -H'Content-Type: application/json' --data '{\"jsonrpc\":\"2.0\",\"method\":\"eth_feeHistory\",\"params\":[2,\"latest\",[50,100]],\"id\":1}' http://127.0.0.1:8545\r\n```\r\n\r\nand the response is:\r\n\r\n```\r\n{\r\n  \"jsonrpc\" : \"2.0\",\r\n  \"id\" : 1,\r\n  \"result\" : {\r\n    \"oldestBlock\" : \"0x5c7db8\",\r\n    \"baseFeePerGas\" : [ \"0x7\", \"0x7\", \"0x7\" ],\r\n    \"gasUsedRatio\" : [ 0.06381766666666666, 0.041748801037546496 ],\r\n    \"reward\" : [ [ \"0x4d7c6d02\", \"0x4d7c6d02\" ], [ \"0x4d7c6d02\", \"0x59682f00\" ] ]\r\n  }\r\n}\r\n```\r\n\r\nDoes this solve your issue?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/998853315/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/999153429",
    "html_url": "https://github.com/hyperledger/besu/issues/3201#issuecomment-999153429",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/3201",
    "id": 999153429,
    "node_id": "IC_kwDODE2jmc47jd8V",
    "user": {
      "login": "JustNotHelpful",
      "id": 96366920,
      "node_id": "U_kgDOBb5xSA",
      "avatar_url": "https://avatars.githubusercontent.com/u/96366920?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JustNotHelpful",
      "html_url": "https://github.com/JustNotHelpful",
      "followers_url": "https://api.github.com/users/JustNotHelpful/followers",
      "following_url": "https://api.github.com/users/JustNotHelpful/following{/other_user}",
      "gists_url": "https://api.github.com/users/JustNotHelpful/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JustNotHelpful/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JustNotHelpful/subscriptions",
      "organizations_url": "https://api.github.com/users/JustNotHelpful/orgs",
      "repos_url": "https://api.github.com/users/JustNotHelpful/repos",
      "events_url": "https://api.github.com/users/JustNotHelpful/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JustNotHelpful/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-21T23:07:03Z",
    "updated_at": "2021-12-21T23:07:03Z",
    "author_association": "NONE",
    "body": "Yes it does - thank you for your assistance.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/999153429/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
