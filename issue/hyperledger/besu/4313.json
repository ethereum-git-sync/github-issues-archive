{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/4313",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/4313/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/4313/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/4313/events",
  "html_url": "https://github.com/hyperledger/besu/issues/4313",
  "id": 1350932218,
  "node_id": "I_kwDODE2jmc5QhZb6",
  "number": 4313,
  "title": "Besu takes too much to shutdown",
  "user": {
    "login": "fab-10",
    "id": 91944855,
    "node_id": "U_kgDOBXr3lw",
    "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fab-10",
    "html_url": "https://github.com/fab-10",
    "followers_url": "https://api.github.com/users/fab-10/followers",
    "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
    "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
    "organizations_url": "https://api.github.com/users/fab-10/orgs",
    "repos_url": "https://api.github.com/users/fab-10/repos",
    "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fab-10/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-08-25T13:48:10Z",
  "updated_at": "2022-09-07T14:23:35Z",
  "closed_at": "2022-09-07T14:23:35Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!-- Have you done the following? -->\r\n<!--   * read the Code of Conduct? By filing an Issue, you are expected to -->  \r\n<!--     comply with it, including treating everyone with respect: -->\r\n<!--     https://github.com/hyperledger/besu/blob/main/CODE_OF_CONDUCT.md -->\r\n<!--   * Reproduced the issue in the latest version of the software -->\r\n<!--   * Read the debugging docs: https://besu.hyperledger.org/en/stable/HowTo/Monitor/Logging/ -->\r\n<!--   * Duplicate Issue check:  https://github.com/search?q=+is%3Aissue+repo%3Ahyperledger/Besu -->\r\n<!-- Note:  Not all sections will apply to all issue types. -->\r\n\r\n### Description\r\n\r\nOn network with the merge enabled, Besu takes many seconds to stop, for example:\r\n\r\n```\r\n# time service besu stop\r\n\r\nreal    0m31.088s\r\nuser    0m0.008s\r\nsys     0m0.002s\r\n```\r\n\r\nwithout the merge enabled it was faster.\r\n\r\nDepending on the setup taking to much to stop could result in the process being killed and depending on what Besu was doing, it could cause data inconsistencies.\r\n\r\n### Acceptance Criteria\r\n\r\nBesu should only few seconds to stop \r\n\r\n### Steps to Reproduce (Bug)\r\n\r\nStart Besu on a network with the merge enabled, i.e. Goerli, let it finish the bootstrap step, and then stop it\r\n\r\n**Frequency:** [What percentage of the time does it occur?]\r\n\r\nAlways\r\n\r\n### Versions (Add all that apply)\r\n* Software version: 22.7.1\r\n* Java version: \"11.0.16\"\r\n* OS Name & Version: Ubuntu 22.04.1 LTS\r\n",
  "closed_by": {
    "login": "fab-10",
    "id": 91944855,
    "node_id": "U_kgDOBXr3lw",
    "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fab-10",
    "html_url": "https://github.com/fab-10",
    "followers_url": "https://api.github.com/users/fab-10/followers",
    "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
    "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
    "organizations_url": "https://api.github.com/users/fab-10/orgs",
    "repos_url": "https://api.github.com/users/fab-10/repos",
    "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fab-10/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/4313/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/4313/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1232508683",
    "html_url": "https://github.com/hyperledger/besu/issues/4313#issuecomment-1232508683",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4313",
    "id": 1232508683,
    "node_id": "IC_kwDODE2jmc5JdpcL",
    "user": {
      "login": "fiah84",
      "id": 46091350,
      "node_id": "MDQ6VXNlcjQ2MDkxMzUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/46091350?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fiah84",
      "html_url": "https://github.com/fiah84",
      "followers_url": "https://api.github.com/users/fiah84/followers",
      "following_url": "https://api.github.com/users/fiah84/following{/other_user}",
      "gists_url": "https://api.github.com/users/fiah84/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fiah84/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fiah84/subscriptions",
      "organizations_url": "https://api.github.com/users/fiah84/orgs",
      "repos_url": "https://api.github.com/users/fiah84/repos",
      "events_url": "https://api.github.com/users/fiah84/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fiah84/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-31T06:16:39Z",
    "updated_at": "2022-08-31T06:18:07Z",
    "author_association": "NONE",
    "body": "it looks to me like this is caused by failing to shutdown the \"PoWMinerExecutor\"\r\n\r\n```\r\nAug 31 03:12:04 ethnode systemd[1]: Stopping Besu Execution Layer Client service...\r\nAug 31 03:12:14 ethnode besu[80296]: 2022-08-31 03:12:14.635+02:00 | vert.x-eventloop-thread-0 | WARN  | EngineExchangeTransitionConfiguration | not called in 120 seconds, consensus client may not be connected\r\nAug 31 03:12:25 ethnode besu[80296]: 2022-08-31 03:12:25.667+02:00 | EthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers. Current peers: 5\r\nAug 31 03:12:30 ethnode besu[80296]: 2022-08-31 03:12:30.668+02:00 | EthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers. Current peers: 6\r\nAug 31 03:12:34 ethnode besu[80296]: 2022-08-31 03:12:34.983+02:00 | BesuCommand-Shutdown-Hook | ERROR | AbstractMinerExecutor | Failed to shutdown PoWMinerExecutor.\r\nAug 31 03:12:34 ethnode besu[80296]: 2022-08-31 03:12:34.988+02:00 | BesuCommand-Shutdown-Hook | INFO  | DefaultSynchronizer | Stopping synchronizer\r\nAug 31 03:12:34 ethnode besu[80296]: 2022-08-31 03:12:34.992+02:00 | BesuCommand-Shutdown-Hook | INFO  | NetworkRunner | Stopping Network.\r\nAug 31 03:12:35 ethnode besu[80296]: 2022-08-31 03:12:35.012+02:00 | BesuCommand-Shutdown-Hook | INFO  | EthProtocolManager | Stopping eth Subprotocol.\r\nAug 31 03:12:35 ethnode besu[80296]: 2022-08-31 03:12:35.020+02:00 | BesuCommand-Shutdown-Hook | INFO  | EthProtocolManager | eth Subprotocol stopped.\r\nAug 31 03:12:35 ethnode besu[80296]: 2022-08-31 03:12:35.020+02:00 | BesuCommand-Shutdown-Hook | INFO  | NetworkRunner | Network stopped.\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1232508683/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
