{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/1317",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/1317/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/1317/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/1317/events",
  "html_url": "https://github.com/hyperledger/besu/issues/1317",
  "id": 680142225,
  "node_id": "MDU6SXNzdWU2ODAxNDIyMjU=",
  "number": 1317,
  "title": "Enable plugins to expose custom JSON RPC / GraphQL / WebSocket methods",
  "user": {
    "login": "aldoborrero",
    "id": 82811,
    "node_id": "MDQ6VXNlcjgyODEx",
    "avatar_url": "https://avatars.githubusercontent.com/u/82811?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/aldoborrero",
    "html_url": "https://github.com/aldoborrero",
    "followers_url": "https://api.github.com/users/aldoborrero/followers",
    "following_url": "https://api.github.com/users/aldoborrero/following{/other_user}",
    "gists_url": "https://api.github.com/users/aldoborrero/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/aldoborrero/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/aldoborrero/subscriptions",
    "organizations_url": "https://api.github.com/users/aldoborrero/orgs",
    "repos_url": "https://api.github.com/users/aldoborrero/repos",
    "events_url": "https://api.github.com/users/aldoborrero/events{/privacy}",
    "received_events_url": "https://api.github.com/users/aldoborrero/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3372711461,
      "node_id": "MDU6TGFiZWwzMzcyNzExNDYx",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/plugins",
      "name": "plugins",
      "color": "E2AA6B",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "antonydenyer",
    "id": 469160,
    "node_id": "MDQ6VXNlcjQ2OTE2MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/469160?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/antonydenyer",
    "html_url": "https://github.com/antonydenyer",
    "followers_url": "https://api.github.com/users/antonydenyer/followers",
    "following_url": "https://api.github.com/users/antonydenyer/following{/other_user}",
    "gists_url": "https://api.github.com/users/antonydenyer/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/antonydenyer/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/antonydenyer/subscriptions",
    "organizations_url": "https://api.github.com/users/antonydenyer/orgs",
    "repos_url": "https://api.github.com/users/antonydenyer/repos",
    "events_url": "https://api.github.com/users/antonydenyer/events{/privacy}",
    "received_events_url": "https://api.github.com/users/antonydenyer/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "antonydenyer",
      "id": 469160,
      "node_id": "MDQ6VXNlcjQ2OTE2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/469160?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/antonydenyer",
      "html_url": "https://github.com/antonydenyer",
      "followers_url": "https://api.github.com/users/antonydenyer/followers",
      "following_url": "https://api.github.com/users/antonydenyer/following{/other_user}",
      "gists_url": "https://api.github.com/users/antonydenyer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/antonydenyer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/antonydenyer/subscriptions",
      "organizations_url": "https://api.github.com/users/antonydenyer/orgs",
      "repos_url": "https://api.github.com/users/antonydenyer/repos",
      "events_url": "https://api.github.com/users/antonydenyer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/antonydenyer/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-08-17T10:55:09Z",
  "updated_at": "2021-10-11T08:45:52Z",
  "closed_at": "2021-10-11T08:45:52Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nAs a plugin writer, I would like to have the possibility of exposing custom JSON RPC / GraphQL / WebSocket methods (I'll focus only on JSON RPC for the rest of the issue but it should apply to all of those).\r\n\r\nCurrently, the plugin API is limited by how we can interact with the outside world. Having the possibility of custom JSON RPC commands is immensely useful when you want to extend the capabilities of Besu beyond the default set of exposed methods.\r\n\r\nIn terms of the API, we can add the following to `BesuPlugin` interface:\r\n\r\n```Java\r\n...\r\n\r\n/** Called when the plugin wants to expose custom JSON RPC methods.\r\n* If not overridden, this method does nothing for convenience.\r\n**/\r\ndefault Map<String, JsonRpcMethod> createJsonRpcMethods() {\r\n    return Collections.emptyMap();\r\n}\r\n```\r\n\r\nThis method would be called once at the `Registering` phase. The format for each method name could be the following:\r\n\r\n```\r\n<plugin-name-id>_<api-method>\r\n```\r\n\r\nLike this:\r\n\r\n```\r\nplugin-besu-exflo_retrieveTokenBalances\r\n```\r\n\r\nEach plugin is responsible of generating a custom response that can be serialized by Jackson.\r\n\r\nWe can reuse part of the work that has been done already in the class [`PluginsJsonRpcMethods`](https://github.com/hyperledger/besu/blob/master/ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/methods/PluginsJsonRpcMethods.java). That class receives the list of Plugins, so apart of registering the reload configuration, we can iterate for each plugin and see if they have defined a map of `JsonRpcMethods`.\r\n\r\nCurrently, neither of `JsonRpcMethod`, `JsonRpcMethods`, `JsonRpcRequestContext`... are exposed to `plugin-api` module. So a worthwhile discussion would be what is the best approach to expose those relevant entities to plugins.\r\n\r\nAlso, probably, I might be forgetting anything that could be crucial to take into account before any attempt of implementation.\r\n\r\n### Acceptance Criteria\r\n\r\n- It should not override existing JSON RPC commands (throw an error if the id of the method is one of the native ones).\r\n- It should expose custom JSON RPC methods.\r\n- It should expose custom GraphQL mutations/queries.\r\n- It should allow custom WebSocket subscriptions/methods.\r\n\r\nMaybe we can start with just only supporting JSON RPC and later on adding support to GraphQL and WebSockets.\r\n\r\n### Additional Information\r\n\r\n[Quorum has implemented a similar feature already](https://github.com/jpmorganchase/quorum/pull/956). \r\n\r\nIf an approach is agreed upon, I would be happy to implement it.",
  "closed_by": {
    "login": "antonydenyer",
    "id": 469160,
    "node_id": "MDQ6VXNlcjQ2OTE2MA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/469160?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/antonydenyer",
    "html_url": "https://github.com/antonydenyer",
    "followers_url": "https://api.github.com/users/antonydenyer/followers",
    "following_url": "https://api.github.com/users/antonydenyer/following{/other_user}",
    "gists_url": "https://api.github.com/users/antonydenyer/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/antonydenyer/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/antonydenyer/subscriptions",
    "organizations_url": "https://api.github.com/users/antonydenyer/orgs",
    "repos_url": "https://api.github.com/users/antonydenyer/repos",
    "events_url": "https://api.github.com/users/antonydenyer/events{/privacy}",
    "received_events_url": "https://api.github.com/users/antonydenyer/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/1317/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/1317/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/917944492",
    "html_url": "https://github.com/hyperledger/besu/issues/1317#issuecomment-917944492",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1317",
    "id": 917944492,
    "node_id": "IC_kwDODE2jmc42tris",
    "user": {
      "login": "antonydenyer",
      "id": 469160,
      "node_id": "MDQ6VXNlcjQ2OTE2MA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/469160?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/antonydenyer",
      "html_url": "https://github.com/antonydenyer",
      "followers_url": "https://api.github.com/users/antonydenyer/followers",
      "following_url": "https://api.github.com/users/antonydenyer/following{/other_user}",
      "gists_url": "https://api.github.com/users/antonydenyer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/antonydenyer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/antonydenyer/subscriptions",
      "organizations_url": "https://api.github.com/users/antonydenyer/orgs",
      "repos_url": "https://api.github.com/users/antonydenyer/repos",
      "events_url": "https://api.github.com/users/antonydenyer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/antonydenyer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-13T08:07:43Z",
    "updated_at": "2021-09-13T08:07:43Z",
    "author_association": "MEMBER",
    "body": "Reference to previous discussions about design and prototype:\r\n\r\nhttps://github.com/PegaSysEng/pantheon/pull/1909/files\r\n\r\nhttps://wiki.hyperledger.org/display/BESU/RPC+Endpoint+Service",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/917944492/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
