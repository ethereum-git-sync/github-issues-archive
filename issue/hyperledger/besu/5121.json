{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/5121",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/5121/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/5121/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/5121/events",
  "html_url": "https://github.com/hyperledger/besu/issues/5121",
  "id": 1594674394,
  "node_id": "I_kwDODE2jmc5fDMza",
  "number": 5121,
  "title": "Out of Order Backwards Sync Logs",
  "user": {
    "login": "siladu",
    "id": 2893793,
    "node_id": "MDQ6VXNlcjI4OTM3OTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/siladu",
    "html_url": "https://github.com/siladu",
    "followers_url": "https://api.github.com/users/siladu/followers",
    "following_url": "https://api.github.com/users/siladu/following{/other_user}",
    "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
    "organizations_url": "https://api.github.com/users/siladu/orgs",
    "repos_url": "https://api.github.com/users/siladu/repos",
    "events_url": "https://api.github.com/users/siladu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/siladu/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 3013559202,
      "node_id": "MDU6TGFiZWwzMDEzNTU5MjAy",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/mainnet",
      "name": "mainnet",
      "color": "9D578C",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "fab-10",
    "id": 91944855,
    "node_id": "U_kgDOBXr3lw",
    "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fab-10",
    "html_url": "https://github.com/fab-10",
    "followers_url": "https://api.github.com/users/fab-10/followers",
    "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
    "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
    "organizations_url": "https://api.github.com/users/fab-10/orgs",
    "repos_url": "https://api.github.com/users/fab-10/repos",
    "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fab-10/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-02-22T08:30:12Z",
  "updated_at": "2023-03-28T16:07:05Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "I have recently noticed some odd behaviour in the backwards sync log output. \r\n\r\nI have noticed it while investigating other bugs, but I don't think I could say that it is related to or causes the bug, e.g. https://github.com/hyperledger/besu/issues/5053\r\n\r\nIt could just be futures returning results out of order.\r\n\r\nOne situation detailed is here:\r\nhttps://github.com/hyperledger/besu/issues/5097#issuecomment-1432515362\r\n\r\nAnother occurred on a local sync of zhejiang testnet, where we jumped back to phase 1 of 2 briefly in the middle of phase 2 of 2 \r\n```\r\n2023-02-17 15:51:43.533+10:00 | nioEventLoopGroup-3-2 | INFO  | BackwardSyncStep | Backward sync phase 1 of 2 completed, downloaded a total of 107002 headers. Peers: 1\r\n...\r\n...\r\n2023-02-17 15:56:55.589+10:00 | nioEventLoopGroup-3-2 | INFO  | BackwardSyncContext | Backward sync phase 2 of 2, 81.95% completed, imported 87712 blocks of at least 107027 (current head 87712, target head 107027). Peers: 1\r\n\r\n2023-02-17 15:57:05.810+10:00 | ForkJoinPool.commonPool-worker-9 | INFO  | BackwardSyncStep | Backward sync phase 1 of 2, 15.12% completed, downloaded 16180 headers of at least 107028. Peers: 4\r\n\r\n2023-02-17 15:57:15.933+10:00 | nioEventLoopGroup-3-2 | INFO  | BackwardSyncContext | Backward sync phase 2 of 2, 87.60% completed, imported 93759 blocks of at least 107029 (current head 93759, target head 107029). Peers: 1\r\n...\r\n...\r\n2023-02-17 15:57:57.553+10:00 | ForkJoinPool.commonPool-worker-6 | INFO  | BackwardsSyncAlgorithm | Current backward sync session is done\r\n2023-02-17 15:58:00.025+10:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineNewPayload | Imported #107,033 / 2 tx / 16 ws / base fee 7 wei / 57,906 (0.2%) gas / (0xd8311ac4dc4e0416c3b8abb4816ccd11060836f2cb16253341bd84ff58fcf08c) in 0.007s. Peers: 3\r\n```\r\n\r\nAnd another occurred on Sepolia using a recent main commit...\r\n```\r\n{\"@timestamp\":\"2023-02-21T15:09:24,065\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"BackwardSyncContext\",\"message\":\"Starting a new backward sync session\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2023-02-21T15:09:24,279\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-2\",\"class\":\"BackwardsSyncAlgorithm\",\"message\":\"Backward sync target block is 2947529 (0xd850c0e105b4322bdb3c7e1a91ab6a477fa13e856db98324706556997feb69ce)\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2023-02-21T15:09:24,599\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-2\",\"class\":\"BackwardSyncStep\",\"message\":\"Backward sync phase 1 of 2 completed, downloaded a total of 200 headers. Peers: 8\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2023-02-21T15:09:24,755\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-2\",\"class\":\"BackwardSyncContext\",\"message\":\"Backward sync phase 2 of 2, 1.85% completed, imported 1 blocks of at least 54 (current head 2947476, target head 2947529). Peers: 7\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2023-02-21T15:09:25,982\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-2\",\"class\":\"BackwardSyncContext\",\"message\":\"Backward sync phase 2 of 2 completed, imported a total of 54 blocks. Peers: 7\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2023-02-21T15:09:25,985\",\"level\":\"INFO\",\"thread\":\"ForkJoinPool.commonPool-worker-3\",\"class\":\"BackwardsSyncAlgorithm\",\"message\":\"Current backward sync session is done\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2023-02-21T15:09:36,176\",\"level\":\"INFO\",\"thread\":\"vert.x-worker-thread-0\",\"class\":\"BackwardSyncContext\",\"message\":\"Starting a new backward sync session\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2023-02-21T15:09:36,545\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-2\",\"class\":\"BackwardSyncStep\",\"message\":\"Backward sync phase 1 of 2 completed, downloaded a total of 200 headers. Peers: 6\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2023-02-21T15:09:36,687\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-2\",\"class\":\"BackwardSyncContext\",\"message\":\"Backward sync phase 2 of 2, 50.00% completed, imported 1 blocks of at least 2 (current head 2947530, target head 2947531). Peers: 7\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2023-02-21T15:09:36,706\",\"level\":\"INFO\",\"thread\":\"nioEventLoopGroup-3-2\",\"class\":\"BackwardSyncContext\",\"message\":\"Backward sync phase 2 of 2 completed, imported a total of 2 blocks. Peers: 8\",\"throwable\":\"\"}\r\n{\"@timestamp\":\"2023-02-21T15:09:36,706\",\"level\":\"INFO\",\"thread\":\"ForkJoinPool.commonPool-worker-3\",\"class\":\"BackwardsSyncAlgorithm\",\"message\":\"Current backward sync session is done\",\"throwable\":\"\"}\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/5121/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/5121/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1439949281",
    "html_url": "https://github.com/hyperledger/besu/issues/5121#issuecomment-1439949281",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5121",
    "id": 1439949281,
    "node_id": "IC_kwDODE2jmc5V0-Hh",
    "user": {
      "login": "ahamlat",
      "id": 5099602,
      "node_id": "MDQ6VXNlcjUwOTk2MDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5099602?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahamlat",
      "html_url": "https://github.com/ahamlat",
      "followers_url": "https://api.github.com/users/ahamlat/followers",
      "following_url": "https://api.github.com/users/ahamlat/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahamlat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahamlat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahamlat/subscriptions",
      "organizations_url": "https://api.github.com/users/ahamlat/orgs",
      "repos_url": "https://api.github.com/users/ahamlat/repos",
      "events_url": "https://api.github.com/users/ahamlat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahamlat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-22T12:36:57Z",
    "updated_at": "2023-02-22T12:36:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "Here's another user facing the same issue https://github.com/hyperledger/besu/issues/5043",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1439949281/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1452378373",
    "html_url": "https://github.com/hyperledger/besu/issues/5121#issuecomment-1452378373",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5121",
    "id": 1452378373,
    "node_id": "IC_kwDODE2jmc5WkYkF",
    "user": {
      "login": "non-fungible-nelson",
      "id": 85905982,
      "node_id": "MDQ6VXNlcjg1OTA1OTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/non-fungible-nelson",
      "html_url": "https://github.com/non-fungible-nelson",
      "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
      "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
      "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
      "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
      "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
      "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-02T18:47:01Z",
    "updated_at": "2023-03-02T18:47:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "@fab-10 - does it make sense to address this alongside #5053? ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1452378373/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1453211816",
    "html_url": "https://github.com/hyperledger/besu/issues/5121#issuecomment-1453211816",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5121",
    "id": 1453211816,
    "node_id": "IC_kwDODE2jmc5WnkCo",
    "user": {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-03T09:14:38Z",
    "updated_at": "2023-03-03T09:14:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "yes will check this as well",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1453211816/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1456142008",
    "html_url": "https://github.com/hyperledger/besu/issues/5121#issuecomment-1456142008",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5121",
    "id": 1456142008,
    "node_id": "IC_kwDODE2jmc5Wyva4",
    "user": {
      "login": "ahamlat",
      "id": 5099602,
      "node_id": "MDQ6VXNlcjUwOTk2MDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5099602?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahamlat",
      "html_url": "https://github.com/ahamlat",
      "followers_url": "https://api.github.com/users/ahamlat/followers",
      "following_url": "https://api.github.com/users/ahamlat/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahamlat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahamlat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahamlat/subscriptions",
      "organizations_url": "https://api.github.com/users/ahamlat/orgs",
      "repos_url": "https://api.github.com/users/ahamlat/repos",
      "events_url": "https://api.github.com/users/ahamlat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahamlat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-06T13:30:44Z",
    "updated_at": "2023-03-06T13:32:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "Adding here the logs from another user which had Backward sync executed in the same time as newPayload calls. We can see errors in the logs like \r\n```\r\n2023-03-06 10:00:59.168+00:00 | vert.x-worker-thread-0 | ERROR | MergeCoordinator | Could not persist world for root hash 0x69554bab83b9960b951e80b1fadfc69fdeb03e17850e67fcc49680052e1f5bfb and block hash 0x8a7225e038382b463b44a627b8cc0fcc284f2f8609227b321c29900c10673f5b\r\n```\r\nand blocked threads.\r\n[Besu (5).log](https://github.com/hyperledger/besu/files/10898659/Besu.5.log)\r\n \r\nand the logs from Nimbus\r\n[Nimbus.log](https://github.com/hyperledger/besu/files/10898670/Nimbus.log)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1456142008/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1487210654",
    "html_url": "https://github.com/hyperledger/besu/issues/5121#issuecomment-1487210654",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5121",
    "id": 1487210654,
    "node_id": "IC_kwDODE2jmc5YpQie",
    "user": {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-28T16:07:04Z",
    "updated_at": "2023-03-28T16:07:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "Another report \r\n[20230328_eth1.txt](https://github.com/hyperledger/besu/files/11091535/20230328_eth1.txt)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1487210654/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
