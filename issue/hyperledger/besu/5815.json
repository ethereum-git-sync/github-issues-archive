{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/5815",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/5815/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/5815/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/5815/events",
  "html_url": "https://github.com/hyperledger/besu/issues/5815",
  "id": 1869944397,
  "node_id": "I_kwDODE2jmc5vdRZN",
  "number": 5815,
  "title": "Devnet 8, Prysm - Besu forked",
  "user": {
    "login": "jflo",
    "id": 345937,
    "node_id": "MDQ6VXNlcjM0NTkzNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/345937?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jflo",
    "html_url": "https://github.com/jflo",
    "followers_url": "https://api.github.com/users/jflo/followers",
    "following_url": "https://api.github.com/users/jflo/following{/other_user}",
    "gists_url": "https://api.github.com/users/jflo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jflo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jflo/subscriptions",
    "organizations_url": "https://api.github.com/users/jflo/orgs",
    "repos_url": "https://api.github.com/users/jflo/repos",
    "events_url": "https://api.github.com/users/jflo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jflo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-08-28T15:04:24Z",
  "updated_at": "2023-09-05T22:09:38Z",
  "closed_at": "2023-09-05T22:09:38Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Curious behavior causing a halt for the Besu-Prysm pair on devnet8:\r\n\r\nPrysm just stops sending fcus for a while, last one was at:\r\n\r\n```\r\nAug 25 16:14:09.830 2023 REQUEST\r\n{\r\n  \"jsonrpc\": \"2.0\",\r\n  \"id\": 101606,\r\n  \"method\": \"engine_forkchoiceUpdatedV3\",\r\n  \"params\": [\r\n    {\r\n      \"headBlockHash\": \"0xfd9b79c468c60a3a3f752a4e61fee9f098f04327152ce4b30fd9f3a115415ec9\",\r\n      \"safeBlockHash\": \"0x6d9f88800cfac51c655eb6ef07155d0525c409cc9c828107f97c3bc9fc9558d5\",\r\n      \"finalizedBlockHash\": \"0x12756a17a887e818bb3dab58d505b21a03f5b4faff7c9d92ef93a75954b3aa11\"\r\n    },\r\n    null\r\n  ]\r\n}\r\n```\r\n\r\nHowever, it continues asking for latest block and logs during this time. Besu detects no calls to the execution engine, and so does not move its head. Presumably the rest of the network did.\r\n\r\n```\r\n00 | vert.x-eventloop-thread-0 | WARN  | EngineQosTimer | Execution engine not called in 120 seconds, consensus client may not be connected\r\n2023-08-25 16:16:52.008+00:00 | vert.x-worker-thread-0 | INFO  | MergeCoordinator | Start building proposals for block 62642 identified by 0x00541a4a1c5403fd\r\n2023-08-25 16:16:52.009+00:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineForkchoiceUpdated | VALID for fork-choice-update: head: 0xfd9b79c468c60a3a3f752a4e61fee9f098f04327152ce4b30fd9f3a115415ec9, finalized: 0x12756a17a887e818bb3dab58d505b21a03f5b4faff7c9d92ef93a7\r\n5954b3aa11, safeBlockHash: 0x6d9f88800cfac51c655eb6ef07155d0525c409cc9c828107f97c3bc9fc9558d5\r\n2023-08-25 16:17:16.010+00:00 | vert.x-worker-thread-0 | INFO  | MergeCoordinator | Start building proposals for block 62642 identified by 0x00541a4a1c540415\r\n2023-08-25 16:17:24.305+00:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineNewPayload | Imported #62,642 / 6 tx / 0 ws / base fee 7 wei / 126,000 (0.4%) gas / (0xbe7c753299e094176479e9de3d3e8a405a45a9e8cdf6e2ffea900841fb479f62) in 0.008s. Peers: 25\r\n2023-08-25 16:18:45.604+00:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineForkchoiceUpdated | VALID for fork-choice-update: head: 0xbe7c753299e094176479e9de3d3e8a405a45a9e8cdf6e2ffea900841fb479f62, finalized: 0x12756a17a887e818bb3dab58d505b21a03f5b4faff7c9d92ef93a75954b3aa11, safeBlockHash: 0x6d9f88800cfac51c655eb6ef07155d0525c409cc9c828107f97c3bc9fc9558d5\r\n2023-08-25 16:19:16.013+00:00 | vert.x-worker-thread-0 | INFO  | MergeCoordinator | Start building proposals for block 62643 identified by 0x00625dc0da153873\r\n2023-08-25 16:19:28.021+00:00 | vert.x-worker-thread-0 | INFO  | MergeCoordinator | Start building proposals for block 62643 identified by 0x00625dc0da153867\r\n2023-08-25 16:19:40.020+00:00 | vert.x-worker-thread-0 | WARN  | MergeCoordinator | New payloadId 0x00625dc0da15385b received so cancelling block creation tasks for the following payloadIds: 0x00625dc0da153867\r\n2023-08-25 16:19:40.023+00:00 | vert.x-worker-thread-0 | INFO  | MergeCoordinator | Start building proposals for block 62643 identified by 0x00625dc0da15385b\r\n2023-08-25 16:19:52.020+00:00 | vert.x-worker-thread-0 | WARN  | MergeCoordinator | New payloadId 0x00625dc0da15384f received so cancelling block creation tasks for the following payloadIds: 0x00625dc0da15385b\r\n2023-08-25 16:19:52.024+00:00 | vert.x-worker-thread-0 | INFO  | MergeCoordinator | Start building proposals for block 62643 identified by 0x00625dc0da15384f\r\n2023-08-25 16:19:52.025+00:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineForkchoiceUpdated | VALID for fork-choice-update: head: 0xbe7c753299e094176479e9de3d3e8a405a45a9e8cdf6e2ffea900841fb479f62, finalized: 0x12756a17a887e818bb3dab58d505b21a03f5b4faff7c9d92ef93a7\r\n5954b3aa11, safeBlockHash: 0x6d9f88800cfac51c655eb6ef07155d0525c409cc9c828107f97c3bc9fc9558d5\r\n```\r\n\r\n\r\n> _Logs are also preceded by large numbers of deserialization errors via devp2p- is it possible mempool was empty, and delayed proposal start?_\r\n\r\n\r\nit then keeps looping on cancelling and starting new proposals, and the payload ids only change by the last few bytes. Seems like it is still trying to build on the same, old parent.\r\n\r\nit's almost like prysm missed a proposal and doesn't know it.\r\n\r\nWhats weird is that besu should've just proposed on the old block, and then the rest of the network either forks to it or re-orgs it out. I don't think this should have caused a chain split.\r\n\r\n\r\n",
  "closed_by": {
    "login": "jframe",
    "id": 909467,
    "node_id": "MDQ6VXNlcjkwOTQ2Nw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/909467?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jframe",
    "html_url": "https://github.com/jframe",
    "followers_url": "https://api.github.com/users/jframe/followers",
    "following_url": "https://api.github.com/users/jframe/following{/other_user}",
    "gists_url": "https://api.github.com/users/jframe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jframe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jframe/subscriptions",
    "organizations_url": "https://api.github.com/users/jframe/orgs",
    "repos_url": "https://api.github.com/users/jframe/repos",
    "events_url": "https://api.github.com/users/jframe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jframe/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/5815/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/5815/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1695880488",
    "html_url": "https://github.com/hyperledger/besu/issues/5815#issuecomment-1695880488",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5815",
    "id": 1695880488,
    "node_id": "IC_kwDODE2jmc5lFRUo",
    "user": {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-28T15:15:23Z",
    "updated_at": "2023-08-28T15:15:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "looking at the logs, what I can tell is that the CL is sending FcU with parameters, but it is never asking for the built payload, otherwise you should see lines stating with `\"Fetch block proposal by identifier: 0x00688b709583d090`",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1695880488/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
