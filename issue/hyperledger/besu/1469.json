{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/1469",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/1469/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/1469/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/1469/events",
  "html_url": "https://github.com/hyperledger/besu/issues/1469",
  "id": 724469717,
  "node_id": "MDU6SXNzdWU3MjQ0Njk3MTc=",
  "number": 1469,
  "title": "Nonce mismatch between public and private nonces",
  "user": {
    "login": "roderik",
    "id": 16780,
    "node_id": "MDQ6VXNlcjE2Nzgw",
    "avatar_url": "https://avatars.githubusercontent.com/u/16780?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/roderik",
    "html_url": "https://github.com/roderik",
    "followers_url": "https://api.github.com/users/roderik/followers",
    "following_url": "https://api.github.com/users/roderik/following{/other_user}",
    "gists_url": "https://api.github.com/users/roderik/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/roderik/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/roderik/subscriptions",
    "organizations_url": "https://api.github.com/users/roderik/orgs",
    "repos_url": "https://api.github.com/users/roderik/repos",
    "events_url": "https://api.github.com/users/roderik/events{/privacy}",
    "received_events_url": "https://api.github.com/users/roderik/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 2051683573,
      "node_id": "MDU6TGFiZWwyMDUxNjgzNTcz",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/P3",
      "name": "P3",
      "color": "ffff00",
      "default": false,
      "description": "Medium (ex: JSON-RPC request not working with a specific client library due to loose spec assumtion)"
    },
    {
      "id": 2152224197,
      "node_id": "MDU6TGFiZWwyMTUyMjI0MTk3",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamRevenant",
      "name": "TeamRevenant",
      "color": "78e298",
      "default": false,
      "description": "GH issues worked on by Revenant Team"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "mark-terry",
    "id": 36909937,
    "node_id": "MDQ6VXNlcjM2OTA5OTM3",
    "avatar_url": "https://avatars.githubusercontent.com/u/36909937?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mark-terry",
    "html_url": "https://github.com/mark-terry",
    "followers_url": "https://api.github.com/users/mark-terry/followers",
    "following_url": "https://api.github.com/users/mark-terry/following{/other_user}",
    "gists_url": "https://api.github.com/users/mark-terry/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mark-terry/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mark-terry/subscriptions",
    "organizations_url": "https://api.github.com/users/mark-terry/orgs",
    "repos_url": "https://api.github.com/users/mark-terry/repos",
    "events_url": "https://api.github.com/users/mark-terry/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mark-terry/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "mark-terry",
      "id": 36909937,
      "node_id": "MDQ6VXNlcjM2OTA5OTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/36909937?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mark-terry",
      "html_url": "https://github.com/mark-terry",
      "followers_url": "https://api.github.com/users/mark-terry/followers",
      "following_url": "https://api.github.com/users/mark-terry/following{/other_user}",
      "gists_url": "https://api.github.com/users/mark-terry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mark-terry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mark-terry/subscriptions",
      "organizations_url": "https://api.github.com/users/mark-terry/orgs",
      "repos_url": "https://api.github.com/users/mark-terry/repos",
      "events_url": "https://api.github.com/users/mark-terry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mark-terry/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-10-19T10:07:10Z",
  "updated_at": "2020-10-25T22:45:03Z",
  "closed_at": "2020-10-25T22:45:03Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!-- Have you done the following? -->\n<!--   * read the Code of Conduct? By filing an Issue, you are expected to -->  \n<!--     comply with it, including treating everyone with respect: -->\n<!--     https://github.com/hyperledger/besu/blob/master/CODE-OF-CONDUCT.md -->\n<!--   * Reproduced the issue in the latest version of the software -->\n<!--   * Read the debugging wiki: https://github.com/hyperledger/besu/wiki/debugging -->\n<!--   * Duplicate Issue check:  https://github.com/search?q=+is%3Aissue+repo%3Ahyperledger/Besu -->\n<!-- Note:  Not all sections will apply to all issue types. -->\n\n### Description\n\nI'm having a strange issue with private transaction nonces. \n\n```\n│ 2020-10-19 09:33:03.052+00:00 | EthScheduler-Workers-2 | ERROR | PrivacyPrecompiledContract | Failed to process private transaction 0x1dbdc23939ede1367558532130d0875a3d47cb1cf7d0adc71c615f902a362ea2: Private Transaction nonce 67, does not match sender account nonce 0.                                                          │\n```\n\nThis happens in [\"my\" version](https://github.com/settlemint/besu-privacy-examples/blob/main/scripts/multinode.ts) of https://github.com/ConsenSys/web3js-eea/blob/master/example/multiNodeExample/storeValueFromNode1.js \n\nI'm not setting the nonce manually, I wait between each call for it to be mined, so the issues about concurrent tx do not apply. \n\nThe result is that in step 7, I get a return value of 0 instead of 5000\n\n![output](https://user-images.githubusercontent.com/16780/96431368-b244fe80-1203-11eb-8f9f-31bab2feb03f.png)\n\n\nAny idea where to look?\n\n**Bug Triage**\n\nSeverity: Critical (breaks a key privacy behaviour)\nFrequency: Remote (we haven't seen this happening before in any of other privacy networks)\nAssessed Bug Priority: P3",
  "closed_by": {
    "login": "pinges",
    "id": 16143240,
    "node_id": "MDQ6VXNlcjE2MTQzMjQw",
    "avatar_url": "https://avatars.githubusercontent.com/u/16143240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pinges",
    "html_url": "https://github.com/pinges",
    "followers_url": "https://api.github.com/users/pinges/followers",
    "following_url": "https://api.github.com/users/pinges/following{/other_user}",
    "gists_url": "https://api.github.com/users/pinges/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pinges/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pinges/subscriptions",
    "organizations_url": "https://api.github.com/users/pinges/orgs",
    "repos_url": "https://api.github.com/users/pinges/repos",
    "events_url": "https://api.github.com/users/pinges/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pinges/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/1469/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/1469/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/712422792",
    "html_url": "https://github.com/hyperledger/besu/issues/1469#issuecomment-712422792",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1469",
    "id": 712422792,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMjQyMjc5Mg==",
    "user": {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-19T20:27:36Z",
    "updated_at": "2020-10-19T20:27:36Z",
    "author_association": "MEMBER",
    "body": "Hi @roderik ! Thanks for raising this issue. Let's see if we can get to the bottom of it.\r\n\r\nI'll try to run your script later, while I look at it, would you be able to tell me what is the nonce for user1 account in the privacy group that you are deploying the contract? You can use this method https://besu.hyperledger.org/en/latest/Reference/API-Methods/#priv_geteeatransactioncount\r\n\r\n```\r\ncurl -X POST --data '{\"jsonrpc\":\"2.0\",\"method\":\"priv_getEeaTransactionCount\",\"params\":[\"<user1_ethereum_address>\", \"< node1_orion_key>\", [\"node2_orion_key\"]], \"id\":1}' http://<node_ip>:<port>\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/712422792/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/714938725",
    "html_url": "https://github.com/hyperledger/besu/issues/1469#issuecomment-714938725",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1469",
    "id": 714938725,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxNDkzODcyNQ==",
    "user": {
      "login": "roderik",
      "id": 16780,
      "node_id": "MDQ6VXNlcjE2Nzgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/16780?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/roderik",
      "html_url": "https://github.com/roderik",
      "followers_url": "https://api.github.com/users/roderik/followers",
      "following_url": "https://api.github.com/users/roderik/following{/other_user}",
      "gists_url": "https://api.github.com/users/roderik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/roderik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/roderik/subscriptions",
      "organizations_url": "https://api.github.com/users/roderik/orgs",
      "repos_url": "https://api.github.com/users/roderik/repos",
      "events_url": "https://api.github.com/users/roderik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/roderik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-23T06:14:20Z",
    "updated_at": "2020-10-23T06:14:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok, some more info that might help\r\n\r\n1. I had already destroyed this network, so I could not do the debugging steps\r\n2. I created a new network, and it worked\r\n\r\nSo thinking about the difference between the two, I had the initial network setup wrong and the Orion nodes were not connected. I messed up some ports and NAT announcements and /knownhosts on Orion was empty. While the Besu nodes were connected to their own Orion and to each other. In that faulty state, I ran the test script several times. \r\n\r\nSo my guess, is that the way it keeps track of nonces in that scenario is a little off.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/714938725/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/716224888",
    "html_url": "https://github.com/hyperledger/besu/issues/1469#issuecomment-716224888",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1469",
    "id": 716224888,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxNjIyNDg4OA==",
    "user": {
      "login": "pinges",
      "id": 16143240,
      "node_id": "MDQ6VXNlcjE2MTQzMjQw",
      "avatar_url": "https://avatars.githubusercontent.com/u/16143240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pinges",
      "html_url": "https://github.com/pinges",
      "followers_url": "https://api.github.com/users/pinges/followers",
      "following_url": "https://api.github.com/users/pinges/following{/other_user}",
      "gists_url": "https://api.github.com/users/pinges/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pinges/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pinges/subscriptions",
      "organizations_url": "https://api.github.com/users/pinges/orgs",
      "repos_url": "https://api.github.com/users/pinges/repos",
      "events_url": "https://api.github.com/users/pinges/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pinges/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-25T22:44:59Z",
    "updated_at": "2020-10-25T22:44:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing this! Misconfiguration!",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/716224888/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
