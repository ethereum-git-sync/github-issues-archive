{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/983",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/983/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/983/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/983/events",
  "html_url": "https://github.com/hyperledger/besu/issues/983",
  "id": 625177800,
  "node_id": "MDU6SXNzdWU2MjUxNzc4MDA=",
  "number": 983,
  "title": "Prioritizing long-lived peers makes it difficult for new nodes to join larger, stable, private networks.",
  "user": {
    "login": "benjamincburns",
    "id": 803016,
    "node_id": "MDQ6VXNlcjgwMzAxNg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/803016?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/benjamincburns",
    "html_url": "https://github.com/benjamincburns",
    "followers_url": "https://api.github.com/users/benjamincburns/followers",
    "following_url": "https://api.github.com/users/benjamincburns/following{/other_user}",
    "gists_url": "https://api.github.com/users/benjamincburns/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/benjamincburns/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/benjamincburns/subscriptions",
    "organizations_url": "https://api.github.com/users/benjamincburns/orgs",
    "repos_url": "https://api.github.com/users/benjamincburns/repos",
    "events_url": "https://api.github.com/users/benjamincburns/events{/privacy}",
    "received_events_url": "https://api.github.com/users/benjamincburns/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "RatanRSur",
    "id": 4733314,
    "node_id": "MDQ6VXNlcjQ3MzMzMTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4733314?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/RatanRSur",
    "html_url": "https://github.com/RatanRSur",
    "followers_url": "https://api.github.com/users/RatanRSur/followers",
    "following_url": "https://api.github.com/users/RatanRSur/following{/other_user}",
    "gists_url": "https://api.github.com/users/RatanRSur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/RatanRSur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/RatanRSur/subscriptions",
    "organizations_url": "https://api.github.com/users/RatanRSur/orgs",
    "repos_url": "https://api.github.com/users/RatanRSur/repos",
    "events_url": "https://api.github.com/users/RatanRSur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/RatanRSur/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "RatanRSur",
      "id": 4733314,
      "node_id": "MDQ6VXNlcjQ3MzMzMTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4733314?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RatanRSur",
      "html_url": "https://github.com/RatanRSur",
      "followers_url": "https://api.github.com/users/RatanRSur/followers",
      "following_url": "https://api.github.com/users/RatanRSur/following{/other_user}",
      "gists_url": "https://api.github.com/users/RatanRSur/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RatanRSur/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RatanRSur/subscriptions",
      "organizations_url": "https://api.github.com/users/RatanRSur/orgs",
      "repos_url": "https://api.github.com/users/RatanRSur/repos",
      "events_url": "https://api.github.com/users/RatanRSur/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RatanRSur/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2020-05-26T20:29:08Z",
  "updated_at": "2020-10-12T18:53:24Z",
  "closed_at": "2020-10-12T18:53:24Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nImagine a long-running private or public/permissioned network that has more nodes than the default max peer limit (25). The nodes running on this network will eventually fill their peer lists with valid nodes, and, assuming good connection stability, there likely won't be much \"churn\" on this network. That is, once a node connects to a peer, that connection is likely to persist indefinitely.\r\n\r\nNow imagine that a new node is provisioned to join the network. If all nodes already have saturated peer lists, and since we [prioritize peers with long-lived connections](https://github.com/mbaxter/besu/blob/26af974913266363eea994af52ffdb21a603881e/ethereum/p2p/src/main/java/org/hyperledger/besu/ethereum/p2p/rlpx/RlpxAgent.java#L475) over new peers, it may take a very long time for this new node to find peers, if it's able to at all.\r\n\r\n### Steps to Reproduce (Bug)\r\n1. Spin up a private network of 20 nodes, with each node configured for a max peer limit of 10. Call the time at which the last node is added to the network T0.\r\n2. Wait for all nodes to fill their peer lists. Call this time T1.\r\n3. Wait for some duration significant percentage of T1-T0 so that the existing nodes are prioritiezed among their peers.\r\n4. Add another node to the network (also with a max peer limit of 10), and observe the rate at which it acquires new peers.\r\n\r\n**Desired behavior:**\r\nThe new node would fill its peer list about as quickly as the other nodes filled theirs.\r\n\r\n**Actual behavior:**\r\nI haven't run this experiment yet myself to confirm, but I suspect that it will take a very long time for the new node to peer, and depending on the stability of the network, it either might not be able to peer at all, or if it does peer, it might never fill its own peer list.\r\n\r\n**Frequency:**\r\nI don't think it's any concern for a network with a decent percentage of nodes run by hobbyist volunteers, but where networks are comprised primarily of professionally-managed nodes I think this might be a more common issue. I think we may have seen this ourselves within PegaSys on the node that we're running for a public/permissioned network. On restart and update of this node, it takes quite some time for the peer list to fill.\r\n\r\nIt also has trouble maintaining a full peer list, but we suspect that this is related more to misconfiguration per #982.\r\n\r\n### Versions (Add all that apply)\r\n* Software version: all versions through 1.4.5\r\n\r\n\r\n### Additional Information\r\nThanks to @mbaxter for spotting this potentially pathological scenario.",
  "closed_by": {
    "login": "RatanRSur",
    "id": 4733314,
    "node_id": "MDQ6VXNlcjQ3MzMzMTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4733314?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/RatanRSur",
    "html_url": "https://github.com/RatanRSur",
    "followers_url": "https://api.github.com/users/RatanRSur/followers",
    "following_url": "https://api.github.com/users/RatanRSur/following{/other_user}",
    "gists_url": "https://api.github.com/users/RatanRSur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/RatanRSur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/RatanRSur/subscriptions",
    "organizations_url": "https://api.github.com/users/RatanRSur/orgs",
    "repos_url": "https://api.github.com/users/RatanRSur/repos",
    "events_url": "https://api.github.com/users/RatanRSur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/RatanRSur/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/983/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/983/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
