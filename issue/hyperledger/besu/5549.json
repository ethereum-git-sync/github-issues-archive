{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/5549",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/5549/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/5549/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/5549/events",
  "html_url": "https://github.com/hyperledger/besu/issues/5549",
  "id": 1747979397,
  "node_id": "I_kwDODE2jmc5oMAyF",
  "number": 5549,
  "title": "Fresh snap sync did not start worldstate heal",
  "user": {
    "login": "yorickdowne",
    "id": 71337066,
    "node_id": "MDQ6VXNlcjcxMzM3MDY2",
    "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yorickdowne",
    "html_url": "https://github.com/yorickdowne",
    "followers_url": "https://api.github.com/users/yorickdowne/followers",
    "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
    "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
    "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
    "repos_url": "https://api.github.com/users/yorickdowne/repos",
    "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 2051683573,
      "node_id": "MDU6TGFiZWwyMDUxNjgzNTcz",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/P3",
      "name": "P3",
      "color": "ffff00",
      "default": false,
      "description": "Medium (ex: JSON-RPC request not working with a specific client library due to loose spec assumtion)"
    },
    {
      "id": 3932728358,
      "node_id": "LA_kwDODE2jmc7qaKwm",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/syncing",
      "name": "syncing",
      "color": "ECC431",
      "default": false,
      "description": ""
    },
    {
      "id": 4328706977,
      "node_id": "LA_kwDODE2jmc8AAAABAgLToQ",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamChupa",
      "name": "TeamChupa",
      "color": "fbca04",
      "default": false,
      "description": "GH issues worked on by Chupacabara Team"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 13,
  "created_at": "2023-06-08T14:12:34Z",
  "updated_at": "2023-09-07T07:42:04Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nA fresh sync of mainnet Ethereum on Besu using snap sync got through FastImportBlocksStep, but did not start worldstate heal. It was \"stuck\" here.\r\n\r\n### Steps to Reproduce (Bug)\r\n\r\n- Sync mainnet\r\n- Likely a highly intermittent issue\r\n\r\n### Logs (if a bug)\r\n\r\n```\r\neth-main-execution-1  | 2023-06-06 23:45:55.873+00:00 | EthScheduler-Services-73 (importBlock) | INFO  | FastImportBlocksStep | Block import progress: 17407253 of 17423064 (99%)\r\neth-main-execution-1  | 2023-06-06 23:46:27.843+00:00 | EthScheduler-Services-73 (importBlock) | INFO  | FastImportBlocksStep | Block import progress: 17408453 of 17423064 (99%)\r\neth-main-execution-1  | 2023-06-06 23:48:34.674+00:00 | EthScheduler-Services-78 (importBlock) | INFO  | FastImportBlocksStep | Block import progress: 17415357 of 17423064 (99%)\r\neth-main-execution-1  | 2023-06-07 01:40:37.386+00:00 | Timer-0 | INFO  | DNSResolver | Resolved 2409 nodes\r\neth-main-execution-1  | 2023-06-07 07:40:34.310+00:00 | Timer-0 | INFO  | DNSResolver | Resolved 2409 nodes\r\neth-main-execution-1  | 2023-06-07 13:30:44.083+00:00 | Timer-0 | INFO  | DNSResolver | Resolved 2409 nodes\r\neth-main-execution-1  | 2023-06-07 19:20:40.366+00:00 | Timer-0 | INFO  | DNSResolver | Resolved 2409 nodes\r\neth-main-execution-1  | 2023-06-08 01:10:29.142+00:00 | Timer-0 | INFO  | DNSResolver | Resolved 2409 nodes\r\neth-main-execution-1  | 2023-06-08 07:00:31.256+00:00 | Timer-0 | INFO  | DNSResolver | Resolved 2409 nodes\r\neth-main-execution-1  | 2023-06-08 12:10:36.405+00:00 | Timer-0 | INFO  | DNSResolver | Resolved 2409 nodes\r\n```\r\n\r\nNode restarted at this point\r\n\r\n```\r\neth-main-execution-1  | 2023-06-08 13:59:56.533+00:00 | main | INFO  | DefaultP2PNetwork | Node address 0xcbe24acf964d074e77a3e604410094a053702dfe\r\neth-main-execution-1  | 2023-06-08 13:59:56.536+00:00 | main | INFO  | NetworkRunner | Supported capabilities: [eth/63, eth/64, eth/65, eth/66, eth/67, eth/68], [snap/1]\r\neth-main-execution-1  | 2023-06-08 13:59:56.536+00:00 | main | INFO  | DefaultSynchronizer | Starting synchronizer.\r\neth-main-execution-1  | 2023-06-08 13:59:56.537+00:00 | main | INFO  | FastSyncDownloader | Starting sync\r\neth-main-execution-1  | 2023-06-08 13:59:56.540+00:00 | main | INFO  | SnapWorldStateDownloader | Downloading world state from peers for pivot block 17413930 (0x3b875b5934da29843acb539b2abbf98219eb8bd0d84cb7ebfc0ac5398172189c). State root 0xef1e81850d7759bd982c36eebc37b40073c37b4fa8aa2b9bd272f8fd3a98489b pending requests 0\r\neth-main-execution-1  | 2023-06-08 13:59:56.736+00:00 | main | INFO  | FastSyncTargetManager | Unable to find sync target. Currently checking 0 peers for usefulness.\r\neth-main-execution-1  | 2023-06-08 13:59:56.742+00:00 | main | INFO  | Runner | Ethereum main loop is up.\r\neth-main-execution-1  | 2023-06-08 14:00:12.213+00:00 | nioEventLoopGroup-3-6 | INFO  | SnapWorldDownloadState | Running world state heal process from peers with pivot block 17435984\r\neth-main-execution-1  | 2023-06-08 14:00:20.569+00:00 | Timer-0 | INFO  | DNSResolver | Resolved 2409 nodes\r\neth-main-execution-1  | 2023-06-08 14:00:56.545+00:00 | EthScheduler-Services-26 (batchPersistTrieNodeData) | INFO  | SnapsyncMetricsManager | Healed 11427 world state nodes\r\neth-main-execution-1  | 2023-06-08 14:01:56.579+00:00 | EthScheduler-Services-26 (batchPersistTrieNodeData) | INFO  | SnapsyncMetricsManager | Healed 335269 world state nodes\r\neth-main-execution-1  | 2023-06-08 14:01:59.349+00:00 | EthScheduler-Services-34 (importBlock) | INFO  | FastImportBlocksStep | Block import progress: 17428304 of 17435984 (99%)\r\neth-main-execution-1  | 2023-06-08 14:02:56.579+00:00 | EthScheduler-Services-26 (batchPersistTrieNodeData) | INFO  | SnapsyncMetricsManager | Healed 630472 world state nodes\r\neth-main-execution-1  | 2023-06-08 14:03:01.838+00:00 | EthScheduler-Services-34 (importBlock) | INFO  | FastImportBlocksStep | Block import progress: 17433904 of 17435984 (99%)\r\neth-main-execution-1  | 2023-06-08 14:03:56.579+00:00 | EthScheduler-Services-26 (batchPersistTrieNodeData) | INFO  | SnapsyncMetricsManager | Healed 936610 world state nodes\r\neth-main-execution-1  | 2023-06-08 14:04:56.677+00:00 | EthScheduler-Services-26 (batchPersistTrieNodeData) | INFO  | SnapsyncMetricsManager | Healed 1334574 world state nodes\r\neth-main-execution-1  | 2023-06-08 14:05:56.683+00:00 | EthScheduler-Services-26 (batchPersistTrieNodeData) | INFO  | SnapsyncMetricsManager | Healed 1809978 world state nodes\r\neth-main-execution-1  | 2023-06-08 14:06:56.703+00:00 | EthScheduler-Services-26 (batchPersistTrieNodeData) | INFO  | SnapsyncMetricsManager | Healed 2240408 world state nodes\r\neth-main-execution-1  | 2023-06-08 14:07:56.703+00:00 | EthScheduler-Services-26 (batchPersistTrieNodeData) | INFO  | SnapsyncMetricsManager | Healed 2705233 world state nodes\r\neth-main-execution-1  | 2023-06-08 14:08:56.707+00:00 | EthScheduler-Services-26 (batchPersistTrieNodeData) | INFO  | SnapsyncMetricsManager | Healed 3133786 world state nodes\r\neth-main-execution-1  | 2023-06-08 14:09:56.729+00:00 | EthScheduler-Services-26 (batchPersistTrieNodeData) | INFO  | SnapsyncMetricsManager | Healed 3518179 world state nodes\r\n```\r\n\r\n### Versions (Add all that apply)\r\n* Software version: `besu/v23.4.1/linux-x86_64/openjdk-java-17`\r\n* OS Name & Version: Debian 11\r\n* Kernel Version: `5.10.0-23-amd64`\r\n* Docker Version: `24.0.2`\r\n* Consensus Client & Version if using Proof of Stake: `teku/v23.5.0/linux-x86_64/-eclipseadoptium-openjdk64bitservervm-java-17`\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/5549/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/5549/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1593779839",
    "html_url": "https://github.com/hyperledger/besu/issues/5549#issuecomment-1593779839",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5549",
    "id": 1593779839,
    "node_id": "IC_kwDODE2jmc5e_yZ_",
    "user": {
      "login": "jframe",
      "id": 909467,
      "node_id": "MDQ6VXNlcjkwOTQ2Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/909467?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jframe",
      "html_url": "https://github.com/jframe",
      "followers_url": "https://api.github.com/users/jframe/followers",
      "following_url": "https://api.github.com/users/jframe/following{/other_user}",
      "gists_url": "https://api.github.com/users/jframe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jframe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jframe/subscriptions",
      "organizations_url": "https://api.github.com/users/jframe/orgs",
      "repos_url": "https://api.github.com/users/jframe/repos",
      "events_url": "https://api.github.com/users/jframe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jframe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-15T22:04:50Z",
    "updated_at": "2023-06-15T22:04:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "This could be related to #5191 ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1593779839/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1596296704",
    "html_url": "https://github.com/hyperledger/besu/issues/5549#issuecomment-1596296704",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5549",
    "id": 1596296704,
    "node_id": "IC_kwDODE2jmc5fJY4A",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-18T22:58:24Z",
    "updated_at": "2023-06-18T22:59:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Had a similar issue doing a fresh sepolia sync.\r\n\r\nTurned on debug after it halted and this error appears a lot. @pinges or @matkt do you think this could be related to sync halting at 99% and/or heal stage not starting...or is it just noise?\r\n\r\nFull log: [besu-sync-halt.log](https://github.com/hyperledger/besu/files/11782783/besu-sync-halt.log)\r\n\r\n```\r\n{\"@timestamp\":\"2023-06-18T21:22:22,637\",\"level\":\"DEBUG\",\"thread\":\"nioEventLoopGroup-3-2\",\"class\":\"Subscribers\",\"message\":\"Error in callback: {}\",\r\n\"throwable\":\" com.google.common.cache.CacheLoader$InvalidCacheLoadException: \r\nCacheLoader returned null for key [Connection with hashCode -505516889 with peer 0x592b71dbfe9c9df0524b709ad5deb2ca5eb7a217984d4512484d7c2af71ee6c9739563f2504afbc48403902234bd1f7c5fcb0290a6a14c769822c02c8062a7b6 inboundInitiated true initAt 1687123342597].\r\nat com.google.common.cache.LocalCache$Segment.getAndRecordStats(LocalCache.java:2319)\r\nat com.google.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2283)\r\nat com.google.common.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2159)\r\nat com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2049)\r\nat com.google.common.cache.LocalCache.get(LocalCache.java:3966)\r\nat com.google.common.cache.LocalCache$LocalManualCache.get(LocalCache.java:4863)\r\nat org.hyperledger.besu.ethereum.eth.manager.EthPeers.peer(EthPeers.java:223)\r\nat org.hyperledger.besu.ethereum.eth.manager.EthProtocolManager.processMessage(EthProtocolManager.java:278)\r\nat org.hyperledger.besu.ethereum.p2p.network.NetworkRunner.lambda$setupHandlers$1(NetworkRunner.java:142)\r\nat org.hyperledger.besu.ethereum.p2p.rlpx.connections.PeerConnectionEvents.lambda$dispatchMessage$1(PeerConnectionEvents.java:64)\r\nat org.hyperledger.besu.util.Subscribers.lambda$forEach$0(Subscribers.java:131)\r\nat java.base/java.lang.Iterable.forEach(Iterable.java:75)\r\nat org.hyperledger.besu.util.Subscribers.forEach(Subscribers.java:128)\r\nat org.hyperledger.besu.ethereum.p2p.rlpx.connections.PeerConnectionEvents.dispatchMessage(PeerConnectionEvents.java:64)\r\nat org.hyperledger.besu.ethereum.p2p.rlpx.connections.netty.ApiHandler.channelRead0(ApiHandler.java:112)\r\nat org.hyperledger.besu.ethereum.p2p.rlpx.connections.netty.ApiHandler.channelRead0(ApiHandler.java:35)\r\nat io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:99)\r\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\r\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\r\nat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\r\nat io.netty.handler.timeout.IdleStateHandler.channelRead(IdleStateHandler.java:286)\r\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)\r\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\r\nat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\r\nat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)\r\nat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)\r\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\r\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\r\nat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\r\nat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\r\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\r\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\r\nat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\r\nat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\r\nat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\r\nat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\r\nat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\r\nat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\r\nat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\r\nat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\nat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\nat java.base/java.lang.Thread.run(Thread.java:833)\\n\"}\r\n```\r\n\r\n```\r\n# Besu version 23.4.3-dev-b790ff19                                                                 #\r\n#                                                                                                  #\r\n# Configuration:                                                                                   #\r\n# Network: Sepolia                                                                                 #\r\n# Network Id: 11155111                                                                             #\r\n# Data storage: Bonsai                                                                             #\r\n# Sync mode: Snap                                                                                  #\r\n# RPC HTTP APIs: ADMIN,DEBUG,NET,ETH,MINER,WEB3                                                    #\r\n# RPC HTTP port: 8545                                                                              #\r\n# Engine APIs: ENGINE,ETH                                                                          #\r\n# Engine port: 8551                                                                                #\r\n# Engine JWT: /etc/jwt-secret.hex                                                                  #\r\n#                                                                                                  #\r\n# Host:                                                                                            #\r\n# Java: openjdk-java-17                                                                            #\r\n# Maximum heap size: 3.84 GB                                                                       #\r\n# OS: linux-x86_64                                                                                 #\r\n# glibc: 2.35                                                                                      #\r\n# jemalloc: 5.2.1-0-gea6b3e973b477b8061e0076bb257dbd7f3faa756                                      #\r\n# Total memory: 15.34 GB                                                                           #\r\n# CPU cores: 4                                                                                     #\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1596296704/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1596380239",
    "html_url": "https://github.com/hyperledger/besu/issues/5549#issuecomment-1596380239",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5549",
    "id": 1596380239,
    "node_id": "IC_kwDODE2jmc5fJtRP",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-19T02:05:50Z",
    "updated_at": "2023-06-19T02:05:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "@matkt correction to the above comment. I found an ERROR in the logs, think the DEBUG error I posted above is a red herring.\r\n\r\n```\r\n{\"@timestamp\":\"2023-06-18T02:30:34,650\",\"level\":\"ERROR\",\"thread\":\"EthScheduler-Services-42 (importBlock)\",\"class\":\"PipelineChainDownloader\",\"message\":\"Chain download failed. Restarting after short delay.\",\"throwable\":\" java.util.concurrent.CompletionException: java.lang.NullPointerException: Cannot invoke \\\"org.hyperledger.besu.ethereum.bonsai.storage.flat.FlatDbReaderStrategy.resetOnResync(org.hyperledger.besu.plugin.services.storage.KeyValueStorage, org.hyperledger.besu.plugin.services.storage.KeyValueStorage)\\\" because the return value of \\\"org.hyperledger.besu.ethereum.bonsai.storage.BonsaiWorldStateKeyValueStorage.getFlatDbReaderStrategy()\\\" is null\r\nat java.base/java.util.concurrent.CompletableFuture.encodeRelay(CompletableFuture.java:368)\r\nat java.base/java.util.concurrent.CompletableFuture.completeRelay(CompletableFuture.java:377)\r\nat java.base/java.util.concurrent.CompletableFuture$UniRelay.tryFire(CompletableFuture.java:1097)\r\nat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\r\nat java.base/java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2162)\r\nat org.hyperledger.besu.services.pipeline.Pipeline.abort(Pipeline.java:195)\r\nat org.hyperledger.besu.services.pipeline.Pipeline.lambda$runWithErrorHandling$3(Pipeline.java:174)\r\nat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\r\nat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\nat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\r\nat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\r\nat java.base/java.lang.Thread.run(Thread.java:833)\\nCaused by: java.lang.NullPointerException: Cannot invoke \\\"org.hyperledger.besu.ethereum.bonsai.storage.flat.FlatDbReaderStrategy.resetOnResync(org.hyperledger.besu.plugin.services.storage.KeyValueStorage, org.hyperledger.besu.plugin.services.storage.KeyValueStorage)\\\" because the return value of \\\"org.hyperledger.besu.ethereum.bonsai.storage.BonsaiWorldStateKeyValueStorage.getFlatDbReaderStrategy()\\\" is null\r\nat org.hyperledger.besu.ethereum.bonsai.storage.BonsaiWorldStateKeyValueStorage.clearFlatDatabase(BonsaiWorldStateKeyValueStorage.java:306)\r\nat org.hyperledger.besu.ethereum.eth.sync.snapsync.SnapWorldDownloadState.reloadTrieHeal(SnapWorldDownloadState.java:220)\r\nat org.hyperledger.besu.ethereum.eth.sync.snapsync.SnapWorldDownloadState.lambda$getBlockAddedListener$10(SnapWorldDownloadState.java:405)\r\nat org.hyperledger.besu.ethereum.chain.DefaultBlockchain.lambda$appendBlockHelper$9(DefaultBlockchain.java:336)\r\nat org.hyperledger.besu.util.Subscribers.lambda$forEach$0(Subscribers.java:131)\r\nat java.base/java.lang.Iterable.forEach(Iterable.java:75)\r\nat org.hyperledger.besu.util.Subscribers.forEach(Subscribers.java:128)\r\nat org.hyperledger.besu.ethereum.chain.DefaultBlockchain.appendBlockHelper(DefaultBlockchain.java:336)\r\nat org.hyperledger.besu.ethereum.chain.DefaultBlockchain.appendBlock(DefaultBlockchain.java:286)\r\nat org.hyperledger.besu.ethereum.mainnet.MainnetBlockImporter.fastImportBlock(MainnetBlockImporter.java:69)\r\nat org.hyperledger.besu.ethereum.eth.sync.fastsync.FastImportBlocksStep.importBlock(FastImportBlocksStep.java:120)\r\nat org.hyperledger.besu.ethereum.eth.sync.fastsync.FastImportBlocksStep.accept(FastImportBlocksStep.java:68)\r\nat org.hyperledger.besu.ethereum.eth.sync.fastsync.FastImportBlocksStep.accept(FastImportBlocksStep.java:36)\r\nat org.hyperledger.besu.services.pipeline.CompleterStage.run(CompleterStage.java:37)\r\nat org.hyperledger.besu.services.pipeline.Pipeline.lambda$runWithErrorHandling$3(Pipeline.java:167)\\n\\t... 5 more\\n\"}\r\n```\r\n\r\n@pinges had the same error on a mainnet node too, which resulted in a 99% sync halt.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1596380239/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1596482010",
    "html_url": "https://github.com/hyperledger/besu/issues/5549#issuecomment-1596482010",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5549",
    "id": 1596482010,
    "node_id": "IC_kwDODE2jmc5fKGHa",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-19T04:39:00Z",
    "updated_at": "2023-06-19T05:31:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "Also, my issue may be related to the recent [flat db commit](https://github.com/hyperledger/besu/commit/180c75197c4a32e4a2d4cf6b732a580197fbf496) (since it's calling getFlatDbReaderStrategy even without the feature enabled) which could be different to Yorick's original issue which was using 23.4.1",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1596482010/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1596483060",
    "html_url": "https://github.com/hyperledger/besu/issues/5549#issuecomment-1596483060",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5549",
    "id": 1596483060,
    "node_id": "IC_kwDODE2jmc5fKGX0",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-19T04:41:00Z",
    "updated_at": "2023-06-19T04:41:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "@yorickdowne on the off chance you still have the complete logs, can you share them please? I'm looking for an error that may have occurred sometime between the worldstate download completing and the block import completing",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1596483060/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1596509809",
    "html_url": "https://github.com/hyperledger/besu/issues/5549#issuecomment-1596509809",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5549",
    "id": 1596509809,
    "node_id": "IC_kwDODE2jmc5fKM5x",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-19T05:07:53Z",
    "updated_at": "2023-06-19T06:02:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "Happened again on another mainnet fresh sync...\r\n\r\n```\r\n{\"@timestamp\":\"2023-06-18T09:47:03,509\",\"level\":\"ERROR\",\"thread\":\"EthScheduler-Services-38 (importBlock)\",\"class\":\"PipelineChainDownloader\",\"message\":\"Chain download failed. Restarting after short delay.\",\"throwable\":\" \r\njava.util.concurrent.CompletionException: java.lang.NullPointerException: \r\nCannot invoke \\\"org.hyperledger.besu.ethereum.bonsai.storage.flat.FlatDbReaderStrategy.resetOnResync(org.hyperledger.besu.plugin.services.storage.KeyValueStorage, org.hyperledger.besu.plugin.services.storage.KeyValueStorage)\\\" \r\nbecause the return value of \\\"org.hyperledger.besu.ethereum.bonsai.storage.BonsaiWorldStateKeyValueStorage.getFlatDbReaderStrategy()\\\" is null\r\nat java.base/java.util.concurrent.CompletableFuture.encodeRelay(CompletableFuture.java:368)\r\nat java.base/java.util.concurrent.CompletableFuture.completeRelay(CompletableFuture.java:377)\r\nat java.base/java.util.concurrent.CompletableFuture$UniRelay.tryFire(CompletableFuture.java:1097)\r\nat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\r\nat java.base/java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2162)\r\nat org.hyperledger.besu.services.pipeline.Pipeline.abort(Pipeline.java:195)\r\nat org.hyperledger.besu.services.pipeline.Pipeline.lambda$runWithErrorHandling$3(Pipeline.java:174)\r\nat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\r\nat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\nat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\r\nat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\r\nat java.base/java.lang.Thread.run(Thread.java:833)\\nCaused by: java.lang.NullPointerException: Cannot invoke \\\"org.hyperledger.besu.ethereum.bonsai.storage.flat.FlatDbReaderStrategy.resetOnResync(org.hyperledger.besu.plugin.services.storage.KeyValueStorage, org.hyperledger.besu.plugin.services.storage.KeyValueStorage)\\\" because the return value of \\\"org.hyperledger.besu.ethereum.bonsai.storage.BonsaiWorldStateKeyValueStorage.getFlatDbReaderStrategy()\\\" is null\r\nat org.hyperledger.besu.ethereum.bonsai.storage.BonsaiWorldStateKeyValueStorage.clearFlatDatabase(BonsaiWorldStateKeyValueStorage.java:306)\r\nat org.hyperledger.besu.ethereum.eth.sync.snapsync.SnapWorldDownloadState.reloadTrieHeal(SnapWorldDownloadState.java:220)\r\nat org.hyperledger.besu.ethereum.eth.sync.snapsync.SnapWorldDownloadState.lambda$getBlockAddedListener$10(SnapWorldDownloadState.java:405)\r\nat org.hyperledger.besu.ethereum.chain.DefaultBlockchain.lambda$appendBlockHelper$9(DefaultBlockchain.java:336)\r\nat org.hyperledger.besu.util.Subscribers.lambda$forEach$0(Subscribers.java:131)\r\nat java.base/java.lang.Iterable.forEach(Iterable.java:75)\r\nat org.hyperledger.besu.util.Subscribers.forEach(Subscribers.java:128)\r\nat org.hyperledger.besu.ethereum.chain.DefaultBlockchain.appendBlockHelper(DefaultBlockchain.java:336)\r\nat org.hyperledger.besu.ethereum.chain.DefaultBlockchain.appendBlock(DefaultBlockchain.java:286)\r\nat org.hyperledger.besu.ethereum.mainnet.MainnetBlockImporter.fastImportBlock(MainnetBlockImporter.java:69)\r\nat org.hyperledger.besu.ethereum.eth.sync.fastsync.FastImportBlocksStep.importBlock(FastImportBlocksStep.java:120)\r\nat org.hyperledger.besu.ethereum.eth.sync.fastsync.FastImportBlocksStep.accept(FastImportBlocksStep.java:68)\r\nat org.hyperledger.besu.ethereum.eth.sync.fastsync.FastImportBlocksStep.accept(FastImportBlocksStep.java:36)\r\nat org.hyperledger.besu.services.pipeline.CompleterStage.run(CompleterStage.java:37)\r\nat org.hyperledger.besu.services.pipeline.Pipeline.lambda$runWithErrorHandling$3(Pipeline.java:167)\\n\\t... 5 more\\n\"}\r\n```\r\n\r\n\r\n```\r\n# Besu version 23.4.3-dev-50ea7268                                                                 #\r\n#                                                                                                  #\r\n# Configuration:                                                                                   #\r\n# Network: Mainnet                                                                                 #\r\n# Network Id: 1                                                                                    #\r\n# Data storage: Bonsai                                                                             #\r\n# Sync mode: Snap                                                                                  #\r\n# RPC HTTP APIs: ADMIN,DEBUG,NET,ETH,MINER,WEB3                                                    #\r\n# RPC HTTP port: 8545                                                                              #\r\n# Engine APIs: ENGINE,ETH                                                                          #\r\n# Engine port: 8551                                                                                #\r\n# Engine JWT: /etc/jwt-secret.hex                                                                  #\r\n#                                                                                                  #\r\n# Host:                                                                                            #\r\n# Java: openjdk-java-17                                                                            #\r\n# Maximum heap size: 3.82 GB                                                                       #\r\n# OS: linux-x86_64                                                                                 #\r\n# glibc: 2.35                                                                                      #\r\n# jemalloc: 5.2.1-0-gea6b3e973b477b8061e0076bb257dbd7f3faa756                                      #\r\n# Total memory: 15.28 GB                                                                           #\r\n# CPU cores: 4                                                                                     #\r\n```\r\n\r\nIn both my cases, restarting fixed it",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1596509809/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1599073460",
    "html_url": "https://github.com/hyperledger/besu/issues/5549#issuecomment-1599073460",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5549",
    "id": 1599073460,
    "node_id": "IC_kwDODE2jmc5fT-y0",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-20T15:56:10Z",
    "updated_at": "2023-06-20T15:56:10Z",
    "author_association": "NONE",
    "body": "> on the off chance you still have the complete logs\r\n\r\nI do not, sorry\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1599073460/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1599094304",
    "html_url": "https://github.com/hyperledger/besu/issues/5549#issuecomment-1599094304",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5549",
    "id": 1599094304,
    "node_id": "IC_kwDODE2jmc5fUD4g",
    "user": {
      "login": "matkt",
      "id": 26581503,
      "node_id": "MDQ6VXNlcjI2NTgxNTAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/26581503?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matkt",
      "html_url": "https://github.com/matkt",
      "followers_url": "https://api.github.com/users/matkt/followers",
      "following_url": "https://api.github.com/users/matkt/following{/other_user}",
      "gists_url": "https://api.github.com/users/matkt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matkt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matkt/subscriptions",
      "organizations_url": "https://api.github.com/users/matkt/orgs",
      "repos_url": "https://api.github.com/users/matkt/repos",
      "events_url": "https://api.github.com/users/matkt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matkt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-20T16:07:43Z",
    "updated_at": "2023-06-20T16:07:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "nullpointer issue should now be fixed on main branch  ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1599094304/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1599812754",
    "html_url": "https://github.com/hyperledger/besu/issues/5549#issuecomment-1599812754",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5549",
    "id": 1599812754,
    "node_id": "IC_kwDODE2jmc5fWzSS",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-21T00:51:47Z",
    "updated_at": "2023-06-29T22:32:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "> nullpointer issue should now be fixed on main branch\r\n\r\nAwesome. I'll leave this story open since there must be some other error causing the halt, likely still the Snapsync thread dying due to an unhandled exception.\r\n\r\nOther than waiting for it to happen again and being able to collect DEBUG logs, we could progress this by hunting for unhandled exceptions in the code.\r\nAnother less desirable option is to raise the snapsync exceptions to ERROR level so we're more likely to see the problem next time it happens (that might make it too noisy though).",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1599812754/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1676326146",
    "html_url": "https://github.com/hyperledger/besu/issues/5549#issuecomment-1676326146",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5549",
    "id": 1676326146,
    "node_id": "IC_kwDODE2jmc5j6rUC",
    "user": {
      "login": "anovalunosis",
      "id": 128309050,
      "node_id": "U_kgDOB6XXOg",
      "avatar_url": "https://avatars.githubusercontent.com/u/128309050?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/anovalunosis",
      "html_url": "https://github.com/anovalunosis",
      "followers_url": "https://api.github.com/users/anovalunosis/followers",
      "following_url": "https://api.github.com/users/anovalunosis/following{/other_user}",
      "gists_url": "https://api.github.com/users/anovalunosis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/anovalunosis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/anovalunosis/subscriptions",
      "organizations_url": "https://api.github.com/users/anovalunosis/orgs",
      "repos_url": "https://api.github.com/users/anovalunosis/repos",
      "events_url": "https://api.github.com/users/anovalunosis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/anovalunosis/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-13T11:21:43Z",
    "updated_at": "2023-08-13T11:21:43Z",
    "author_association": "NONE",
    "body": "OS: Ubuntu 22.04.3 LTS\r\nKernel: 5.19.0-46-generic\r\nCL client: Teku  23.8.0 (docker image pulled from docker hub)\r\nEL client: Besu 23.4.4 (docker image pulled from docker hub)\r\nDocker version 24.0.5\r\n\r\n\r\nDealing with the same logs as original post so I turned on DEBUG level logs:\r\n\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893753385Z org.hyperledger.besu.ethereum.p2p.rlpx.handshake.HandshakeException: Unable to create ECDH Key agreement due to Crypto engine failure\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893757259Z \tat org.hyperledger.besu.ethereum.p2p.rlpx.handshake.ecies.ECIESHandshaker.handleMessage(ECIESHandshaker.java:214)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893760256Z \tat org.hyperledger.besu.ethereum.p2p.rlpx.connections.netty.HandshakeHandlerInbound.nextHandshakeMessage(HandshakeHandlerInbound.java:61)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893762798Z \tat org.hyperledger.besu.ethereum.p2p.rlpx.connections.netty.AbstractHandshakeHandler.channelRead0(AbstractHandshakeHandler.java:95)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893765262Z \tat org.hyperledger.besu.ethereum.p2p.rlpx.connections.netty.AbstractHandshakeHandler.channelRead0(AbstractHandshakeHandler.java:44)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893767693Z \tat io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:99)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893770082Z \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893772435Z \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893775296Z \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893777770Z \tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893780311Z \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893782653Z \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893785066Z \tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893787523Z \tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893789981Z \tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893792280Z \tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893794580Z \tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893799649Z \tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893802622Z \tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893805193Z \tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893817285Z \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893820404Z \tat java.base/java.lang.Thread.run(Thread.java:833)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893822779Z Caused by: org.hyperledger.besu.plugin.services.securitymodule.SecurityModuleException: Unexpected error while calculating ECDH Key Agreement: Invalid point coordinates\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893825224Z \tat org.hyperledger.besu.cryptoservices.KeyPairSecurityModule.calculateECDHKeyAgreement(KeyPairSecurityModule.java:88)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893827552Z \tat org.hyperledger.besu.cryptoservices.NodeKey.calculateECDHKeyAgreement(NodeKey.java:72)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893829736Z \tat org.hyperledger.besu.ethereum.p2p.rlpx.handshake.ecies.ECIESEncryptionEngine.forDecryption(ECIESEncryptionEngine.java:102)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893831947Z \tat org.hyperledger.besu.ethereum.p2p.rlpx.handshake.ecies.EncryptedMessage.decryptMsg(EncryptedMessage.java:68)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893834121Z \tat org.hyperledger.besu.ethereum.p2p.rlpx.handshake.ecies.ECIESHandshaker.handleMessage(ECIESHandshaker.java:206)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893836409Z \t... 20 more\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893838692Z Caused by: java.lang.IllegalArgumentException: Invalid point coordinates\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893840729Z \tat org.bouncycastle.math.ec.ECCurve.validatePoint(ECCurve.java:125)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893842807Z \tat org.bouncycastle.math.ec.ECCurve.decodePoint(ECCurve.java:420)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893845129Z \tat org.hyperledger.besu.crypto.SECPPublicKey.asEcPoint(SECPPublicKey.java:122)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893847269Z \tat org.hyperledger.besu.crypto.AbstractSECP256.publicKeyAsEcPoint(AbstractSECP256.java:184)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893849452Z \tat org.hyperledger.besu.cryptoservices.NodeKey.lambda$calculateECDHKeyAgreement$0(NodeKey.java:73)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893851519Z \tat org.hyperledger.besu.cryptoservices.KeyPairSecurityModule.calculateECDHKeyAgreement(KeyPairSecurityModule.java:82)\r\nteku-besu_node-1  | 2023-08-13T11:13:34.893853703Z \t... 24 more\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1676326146/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1677511476",
    "html_url": "https://github.com/hyperledger/besu/issues/5549#issuecomment-1677511476",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5549",
    "id": 1677511476,
    "node_id": "IC_kwDODE2jmc5j_Ms0",
    "user": {
      "login": "anovalunosis",
      "id": 128309050,
      "node_id": "U_kgDOB6XXOg",
      "avatar_url": "https://avatars.githubusercontent.com/u/128309050?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/anovalunosis",
      "html_url": "https://github.com/anovalunosis",
      "followers_url": "https://api.github.com/users/anovalunosis/followers",
      "following_url": "https://api.github.com/users/anovalunosis/following{/other_user}",
      "gists_url": "https://api.github.com/users/anovalunosis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/anovalunosis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/anovalunosis/subscriptions",
      "organizations_url": "https://api.github.com/users/anovalunosis/orgs",
      "repos_url": "https://api.github.com/users/anovalunosis/repos",
      "events_url": "https://api.github.com/users/anovalunosis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/anovalunosis/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-14T15:06:00Z",
    "updated_at": "2023-08-14T15:06:00Z",
    "author_association": "NONE",
    "body": "teku-besu_node-1  | 2023-08-14T15:04:23.002041466Z com.google.common.cache.CacheLoader$InvalidCacheLoadException: **CacheLoader returned null for key** [Connection with hashCode -1647236115 with peer 0x210643148ea56b6465bd32995d389aaeb6ca1362456c6abfa4bbc307eaa2d9107f34c1309911d6877d5ad77f618487d94c131198eaf4121eee009f78c2b21751 inboundInitiated true initAt 1692025462893].\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002052138Z \tat com.google.common.cache.LocalCache$Segment.getAndRecordStats(LocalCache.java:2319)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002059601Z \tat com.google.common.cache.LocalCache$Segment.loadSync(LocalCache.java:2283)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002065950Z \tat com.google.common.cache.LocalCache$Segment.lockedGetOrLoad(LocalCache.java:2159)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002072358Z \tat com.google.common.cache.LocalCache$Segment.get(LocalCache.java:2049)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002079117Z \tat com.google.common.cache.LocalCache.get(LocalCache.java:3966)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002085850Z \tat com.google.common.cache.LocalCache$LocalManualCache.get(LocalCache.java:4863)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002091913Z \tat org.hyperledger.besu.ethereum.eth.manager.EthPeers.peer(EthPeers.java:223)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002097826Z \tat org.hyperledger.besu.ethereum.eth.manager.EthProtocolManager.processMessage(EthProtocolManager.java:278)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002103905Z \tat org.hyperledger.besu.ethereum.p2p.network.NetworkRunner.lambda$setupHandlers$1(NetworkRunner.java:142)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002110174Z \tat org.hyperledger.besu.ethereum.p2p.rlpx.connections.PeerConnectionEvents.lambda$dispatchMessage$1(PeerConnectionEvents.java:64)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002116692Z \tat org.hyperledger.besu.util.Subscribers.lambda$forEach$0(Subscribers.java:131)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002122966Z \tat java.base/java.lang.Iterable.forEach(Iterable.java:75)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002129312Z \tat org.hyperledger.besu.util.Subscribers.forEach(Subscribers.java:128)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002159873Z \tat org.hyperledger.besu.ethereum.p2p.rlpx.connections.PeerConnectionEvents.dispatchMessage(PeerConnectionEvents.java:64)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002167906Z \tat org.hyperledger.besu.ethereum.p2p.rlpx.connections.netty.ApiHandler.channelRead0(ApiHandler.java:112)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002174311Z \tat org.hyperledger.besu.ethereum.p2p.rlpx.connections.netty.ApiHandler.channelRead0(ApiHandler.java:35)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002180950Z \tat io.netty.channel.SimpleChannelInboundHandler.channelRead(SimpleChannelInboundHandler.java:99)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002188876Z \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002195528Z \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002201695Z \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002207896Z \tat io.netty.handler.timeout.IdleStateHandler.channelRead(IdleStateHandler.java:286)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002213832Z \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002219812Z \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002225725Z \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002231846Z \tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002237876Z \tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002244117Z \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002250076Z \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002256423Z \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002262792Z \tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002268831Z \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002274994Z \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002281226Z \tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002287373Z \tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002293523Z \tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002300460Z \tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002313681Z \tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002321019Z \tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002328774Z \tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002335836Z \tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002345129Z \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\nteku-besu_node-1  | 2023-08-14T15:04:23.002352323Z \tat java.base/java.lang.Thread.run(Thread.java:833)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1677511476/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1682837617",
    "html_url": "https://github.com/hyperledger/besu/issues/5549#issuecomment-1682837617",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5549",
    "id": 1682837617,
    "node_id": "IC_kwDODE2jmc5kThBx",
    "user": {
      "login": "anovalunosis",
      "id": 128309050,
      "node_id": "U_kgDOB6XXOg",
      "avatar_url": "https://avatars.githubusercontent.com/u/128309050?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/anovalunosis",
      "html_url": "https://github.com/anovalunosis",
      "followers_url": "https://api.github.com/users/anovalunosis/followers",
      "following_url": "https://api.github.com/users/anovalunosis/following{/other_user}",
      "gists_url": "https://api.github.com/users/anovalunosis/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/anovalunosis/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/anovalunosis/subscriptions",
      "organizations_url": "https://api.github.com/users/anovalunosis/orgs",
      "repos_url": "https://api.github.com/users/anovalunosis/repos",
      "events_url": "https://api.github.com/users/anovalunosis/events{/privacy}",
      "received_events_url": "https://api.github.com/users/anovalunosis/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-17T19:24:15Z",
    "updated_at": "2023-08-17T19:25:18Z",
    "author_association": "NONE",
    "body": "Any updates on this ? @yorickdowne @siladu ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1682837617/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1709637215",
    "html_url": "https://github.com/hyperledger/besu/issues/5549#issuecomment-1709637215",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5549",
    "id": 1709637215,
    "node_id": "IC_kwDODE2jmc5l5v5f",
    "user": {
      "login": "matkt",
      "id": 26581503,
      "node_id": "MDQ6VXNlcjI2NTgxNTAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/26581503?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matkt",
      "html_url": "https://github.com/matkt",
      "followers_url": "https://api.github.com/users/matkt/followers",
      "following_url": "https://api.github.com/users/matkt/following{/other_user}",
      "gists_url": "https://api.github.com/users/matkt/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matkt/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matkt/subscriptions",
      "organizations_url": "https://api.github.com/users/matkt/orgs",
      "repos_url": "https://api.github.com/users/matkt/repos",
      "events_url": "https://api.github.com/users/matkt/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matkt/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-07T07:42:04Z",
    "updated_at": "2023-09-07T07:42:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "thanks for your feedback. we are working on a PR to fix several issues related to the heal . could you try this PR and tell me if it's better https://github.com/hyperledger/besu/pull/5838",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1709637215/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
