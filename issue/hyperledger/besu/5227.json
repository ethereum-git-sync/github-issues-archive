{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/5227",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/5227/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/5227/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/5227/events",
  "html_url": "https://github.com/hyperledger/besu/issues/5227",
  "id": 1627411267,
  "node_id": "I_kwDODE2jmc5hAFND",
  "number": 5227,
  "title": "Besu - Local permission (with Node Allowlist)",
  "user": {
    "login": "gokulraj17687",
    "id": 123349134,
    "node_id": "U_kgDOB1oojg",
    "avatar_url": "https://avatars.githubusercontent.com/u/123349134?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gokulraj17687",
    "html_url": "https://github.com/gokulraj17687",
    "followers_url": "https://api.github.com/users/gokulraj17687/followers",
    "following_url": "https://api.github.com/users/gokulraj17687/following{/other_user}",
    "gists_url": "https://api.github.com/users/gokulraj17687/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gokulraj17687/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gokulraj17687/subscriptions",
    "organizations_url": "https://api.github.com/users/gokulraj17687/orgs",
    "repos_url": "https://api.github.com/users/gokulraj17687/repos",
    "events_url": "https://api.github.com/users/gokulraj17687/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gokulraj17687/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 5290172097,
      "node_id": "LA_kwDODE2jmc8AAAABO1GewQ",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/non%20mainnet%20(private%20networks)",
      "name": "non mainnet (private networks)",
      "color": "0052cc",
      "default": false,
      "description": "not related to mainnet features - covers privacy, permissioning, IBFT2, QBFT"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "NickSneo",
    "id": 32759145,
    "node_id": "MDQ6VXNlcjMyNzU5MTQ1",
    "avatar_url": "https://avatars.githubusercontent.com/u/32759145?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/NickSneo",
    "html_url": "https://github.com/NickSneo",
    "followers_url": "https://api.github.com/users/NickSneo/followers",
    "following_url": "https://api.github.com/users/NickSneo/following{/other_user}",
    "gists_url": "https://api.github.com/users/NickSneo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/NickSneo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/NickSneo/subscriptions",
    "organizations_url": "https://api.github.com/users/NickSneo/orgs",
    "repos_url": "https://api.github.com/users/NickSneo/repos",
    "events_url": "https://api.github.com/users/NickSneo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/NickSneo/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "NickSneo",
      "id": 32759145,
      "node_id": "MDQ6VXNlcjMyNzU5MTQ1",
      "avatar_url": "https://avatars.githubusercontent.com/u/32759145?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NickSneo",
      "html_url": "https://github.com/NickSneo",
      "followers_url": "https://api.github.com/users/NickSneo/followers",
      "following_url": "https://api.github.com/users/NickSneo/following{/other_user}",
      "gists_url": "https://api.github.com/users/NickSneo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NickSneo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NickSneo/subscriptions",
      "organizations_url": "https://api.github.com/users/NickSneo/orgs",
      "repos_url": "https://api.github.com/users/NickSneo/repos",
      "events_url": "https://api.github.com/users/NickSneo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NickSneo/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-03-16T12:50:15Z",
  "updated_at": "2023-04-23T14:42:59Z",
  "closed_at": "2023-04-23T14:42:59Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hello Everyone, \r\nI am using local permission concept to restrict the nodes. My environment is under AWS ECS and has DNS mapped. I have enabled --xdns-enabled & --xdns-update-enabled param in my network. Have a permissions_config.toml file with list of all enodes that can connect. While deploying the network, the permission file is got deployed into the container.  Even the DNS and IP mapping is also getting resolved after few mins of node start or when I do a permission file reload throught api call. Also I have the same permission config file for all the nodes.\r\nWhen I pull the Allowlist through api call, it gives the result with all enodes along with DNS to connect with the node.\r\nBut if I do a net_peerCount, the result is 0x0, means the nodes are not connected with each other. There was no log with error. Then I have to a redeploy all the nodes to make it sync and then the peer count comes with exact number of nodes.\r\nAny idea, why the behaviour is like this? Is anything I am missing here?\r\n<@680245613258211336> We were able to check further on this and below is the scenario where discovery fails when we enable node local permisioning.\r\n\r\nWe are starting boot node with the initial list of peers having permission to network. The permission list is updated with Enode URL having hostname rather than IP. Also we have enabled BESU_DNS_ENABLED and BESU_XDNS_UPDATE_ENABLED parameters for this. As none of the Besu nodes are currently up and when we call the Perm method ( curl\r\n-X POST - - data ‘{\" jsonrpc\": \"2.0- \"method\":\"perm getNodesAllowlist\", \"params\": [], \"id\": 1}’ http://bootnode_hostname:8545 ) to list the permitted node list from boot node, its giving the enode addresses of all nodes with loopback IP instead of hostname which we passed in permission TOML file. In our environment, Besu nodes hostname is only resolvable after the node starts as we are using discovery to get the DNS configured.\r\nNow if we start any of the besu nodes - it won't be able to communicate to bootnode for discovery as the permission list of bootnode is still with 127.0.0.1. Post besu node starts and the corresponding hostname is resolvable - when we do a reload of permission list in bootnode - the enode URL of node will get updated with the hostname entry as we given in permission TOML file ( enode://enodeaddrss@DNS_NAME: p2p_port )\r\nEven after the boot node permission list is updated with host entries\r\n- besu node is not able to do the discovery until the node is restated.\r\n\r\nFollowing are our queries\r\n\r\nHow we can retrigger the connection to bootnode from besu nodes to do the discovery again?\r\n\r\nWhy the permission list is giving loopback IP when we are providing hostnames in the TOML file?\r\n\r\nThis has been raised in discord channel(Topic : Besu-Local permissioning issue) and as advised raising an issue here\r\n\r\n\r\n",
  "closed_by": {
    "login": "NickSneo",
    "id": 32759145,
    "node_id": "MDQ6VXNlcjMyNzU5MTQ1",
    "avatar_url": "https://avatars.githubusercontent.com/u/32759145?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/NickSneo",
    "html_url": "https://github.com/NickSneo",
    "followers_url": "https://api.github.com/users/NickSneo/followers",
    "following_url": "https://api.github.com/users/NickSneo/following{/other_user}",
    "gists_url": "https://api.github.com/users/NickSneo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/NickSneo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/NickSneo/subscriptions",
    "organizations_url": "https://api.github.com/users/NickSneo/orgs",
    "repos_url": "https://api.github.com/users/NickSneo/repos",
    "events_url": "https://api.github.com/users/NickSneo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/NickSneo/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/5227/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/5227/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1477158048",
    "html_url": "https://github.com/hyperledger/besu/issues/5227#issuecomment-1477158048",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5227",
    "id": 1477158048,
    "node_id": "IC_kwDODE2jmc5YC6Sg",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-21T01:23:05Z",
    "updated_at": "2023-03-21T01:23:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "@NickSneo ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1477158048/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1486360685",
    "html_url": "https://github.com/hyperledger/besu/issues/5227#issuecomment-1486360685",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5227",
    "id": 1486360685,
    "node_id": "IC_kwDODE2jmc5YmBBt",
    "user": {
      "login": "NickSneo",
      "id": 32759145,
      "node_id": "MDQ6VXNlcjMyNzU5MTQ1",
      "avatar_url": "https://avatars.githubusercontent.com/u/32759145?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NickSneo",
      "html_url": "https://github.com/NickSneo",
      "followers_url": "https://api.github.com/users/NickSneo/followers",
      "following_url": "https://api.github.com/users/NickSneo/following{/other_user}",
      "gists_url": "https://api.github.com/users/NickSneo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NickSneo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NickSneo/subscriptions",
      "organizations_url": "https://api.github.com/users/NickSneo/orgs",
      "repos_url": "https://api.github.com/users/NickSneo/repos",
      "events_url": "https://api.github.com/users/NickSneo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NickSneo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-28T07:35:38Z",
    "updated_at": "2023-03-29T07:05:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey @gokulraj17687 ,\r\n\r\nThanks for raising the issue. Few points from what I understood -\r\n\r\n1. You have given hostnames in permission TOML file but it gives loopback IP if nodes are not up - This is because the DNS resolution for the hostnames is not available when the bootnode is started, so it resolves the enode addresses with the loopback IP. Once the nodes are started and their hostnames are resolvable, the bootnode's permission list can be updated with the hostname entries. (Hope this resolves your 2nd Question)\r\n\r\n2. Now if you start the nodes, DNS and IP mapping is getting resolved after few mins but still nodes are not able to communicate. Here if you do `perm_reloadPermissionsFromFile` (reload of permission list) the enode URL of node will get updated with the hostname entry as given in permission TOML file but still the issue persists. (This is what we need to check)\r\n\r\nBy the statement - \"besu node is not able to do the discovery until the node is restated.\"\r\nYou mean when you try restarting the bootnode and keeping all other nodes up the issue resolves ?\r\n\r\nBTW, what if you give IP addresses of nodes instead of domain names? Does this issue persists?\r\n\r\nAlso can you try these steps if it works fine for you? or you can follow this guide - https://besu.hyperledger.org/en/stable/private-networks/tutorials/permissioning/\r\n**Just replace enode IP of nodes with dns \r\n1. Start the bootnode with --xdns-enabled & --xdns-update-enabled param.\r\n2. Start the other besu nodes having hostnames\r\n3. Now update the nodes allowlist using the following JSON-RPC API methods:\r\n - perm_addNodesToAllowlist\r\n - perm_removeNodesFromAllowlist\r\n4. Do the above api call for all the nodes to update the perm file.\r\n5. Use admin_addPeer api call to Add nodes as peers.\r\n6. Now check if the nodes are able to communicate and net_peerCount is giving the correct value\r\n\r\n\r\n\r\nLet me know if above steps work for you? ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1486360685/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1487980361",
    "html_url": "https://github.com/hyperledger/besu/issues/5227#issuecomment-1487980361",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5227",
    "id": 1487980361,
    "node_id": "IC_kwDODE2jmc5YsMdJ",
    "user": {
      "login": "NickSneo",
      "id": 32759145,
      "node_id": "MDQ6VXNlcjMyNzU5MTQ1",
      "avatar_url": "https://avatars.githubusercontent.com/u/32759145?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NickSneo",
      "html_url": "https://github.com/NickSneo",
      "followers_url": "https://api.github.com/users/NickSneo/followers",
      "following_url": "https://api.github.com/users/NickSneo/following{/other_user}",
      "gists_url": "https://api.github.com/users/NickSneo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NickSneo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NickSneo/subscriptions",
      "organizations_url": "https://api.github.com/users/NickSneo/orgs",
      "repos_url": "https://api.github.com/users/NickSneo/repos",
      "events_url": "https://api.github.com/users/NickSneo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NickSneo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-29T05:44:46Z",
    "updated_at": "2023-03-29T05:44:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey @gokulraj17687 ,\r\n\r\nCan you also attach the logs for different scenarios.\r\nSet log level to trace - https://besu.hyperledger.org/en/stable/public-networks/reference/api/#admin_changeloglevel\r\nand then collect all the logs.\r\n\r\nThanks!",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1487980361/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1515404779",
    "html_url": "https://github.com/hyperledger/besu/issues/5227#issuecomment-1515404779",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5227",
    "id": 1515404779,
    "node_id": "IC_kwDODE2jmc5aUz3r",
    "user": {
      "login": "NickSneo",
      "id": 32759145,
      "node_id": "MDQ6VXNlcjMyNzU5MTQ1",
      "avatar_url": "https://avatars.githubusercontent.com/u/32759145?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NickSneo",
      "html_url": "https://github.com/NickSneo",
      "followers_url": "https://api.github.com/users/NickSneo/followers",
      "following_url": "https://api.github.com/users/NickSneo/following{/other_user}",
      "gists_url": "https://api.github.com/users/NickSneo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NickSneo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NickSneo/subscriptions",
      "organizations_url": "https://api.github.com/users/NickSneo/orgs",
      "repos_url": "https://api.github.com/users/NickSneo/repos",
      "events_url": "https://api.github.com/users/NickSneo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NickSneo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-19T21:25:13Z",
    "updated_at": "2023-04-19T21:25:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "@macfarla There has been no reply from the reporter @gokulraj17687 \r\nShall we close or wait for more time?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1515404779/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1519083594",
    "html_url": "https://github.com/hyperledger/besu/issues/5227#issuecomment-1519083594",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5227",
    "id": 1519083594,
    "node_id": "IC_kwDODE2jmc5ai2BK",
    "user": {
      "login": "NickSneo",
      "id": 32759145,
      "node_id": "MDQ6VXNlcjMyNzU5MTQ1",
      "avatar_url": "https://avatars.githubusercontent.com/u/32759145?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/NickSneo",
      "html_url": "https://github.com/NickSneo",
      "followers_url": "https://api.github.com/users/NickSneo/followers",
      "following_url": "https://api.github.com/users/NickSneo/following{/other_user}",
      "gists_url": "https://api.github.com/users/NickSneo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/NickSneo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/NickSneo/subscriptions",
      "organizations_url": "https://api.github.com/users/NickSneo/orgs",
      "repos_url": "https://api.github.com/users/NickSneo/repos",
      "events_url": "https://api.github.com/users/NickSneo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/NickSneo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-23T14:42:59Z",
    "updated_at": "2023-04-23T14:42:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing issue, as no reply from the issue reporter.\r\n@gokulraj17687 You can reopen the issue if you face the error again. Thanks!!",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1519083594/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
