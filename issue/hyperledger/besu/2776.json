{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/2776",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/2776/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/2776/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/2776/events",
  "html_url": "https://github.com/hyperledger/besu/issues/2776",
  "id": 998662656,
  "node_id": "I_kwDODE2jmc47hmIA",
  "number": 2776,
  "title": "21.7.3 mainnet stops syncing with \"Attempting to update buffer with 213 byte(s) but there is -213 byte(s) left to fill\"",
  "user": {
    "login": "leontastic",
    "id": 5552308,
    "node_id": "MDQ6VXNlcjU1NTIzMDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5552308?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/leontastic",
    "html_url": "https://github.com/leontastic",
    "followers_url": "https://api.github.com/users/leontastic/followers",
    "following_url": "https://api.github.com/users/leontastic/following{/other_user}",
    "gists_url": "https://api.github.com/users/leontastic/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/leontastic/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leontastic/subscriptions",
    "organizations_url": "https://api.github.com/users/leontastic/orgs",
    "repos_url": "https://api.github.com/users/leontastic/repos",
    "events_url": "https://api.github.com/users/leontastic/events{/privacy}",
    "received_events_url": "https://api.github.com/users/leontastic/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3805591260,
      "node_id": "LA_kwDODE2jmc7i1Lbc",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/peering",
      "name": "peering",
      "color": "006b75",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-09-16T21:38:49Z",
  "updated_at": "2022-04-04T04:13:03Z",
  "closed_at": "2022-04-04T04:13:03Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!-- Have you done the following? -->\r\n<!--   * read the Code of Conduct? By filing an Issue, you are expected to -->  \r\n<!--     comply with it, including treating everyone with respect: -->\r\n<!--     https://github.com/hyperledger/besu/blob/main/CODE_OF_CONDUCT.md -->\r\n<!--   * Reproduced the issue in the latest version of the software -->\r\n<!--   * Read the debugging docs: https://besu.hyperledger.org/en/stable/HowTo/Monitor/Logging/ -->\r\n<!--   * Duplicate Issue check:  https://github.com/search?q=+is%3Aissue+repo%3Ahyperledger/Besu -->\r\n<!-- Note:  Not all sections will apply to all issue types. -->\r\n\r\n### Description\r\n\r\nI want to besu stay synced without getting stuck.\r\n\r\nI encountered this issue on two nodes syncing with *mainnet*.\r\n\r\n### Acceptance Criteria\r\n\r\nShould not get stuck\r\n\r\n### Steps to Reproduce (Bug)\r\n\r\nRun a synced besu node on 21.7.3\r\n\r\n**Expected behavior:** \r\n\r\nShould work\r\n\r\n**Actual behavior:** [What actually happens]\r\n\r\nObserve log `Attempting to update buffer with 213 byte(s) but there is -213 byte(s) left to fill`. Besu will fail to accept that block and get stuck.\r\n\r\nThe node stops syncing, but there are still many peers connected (25).\r\n\r\n**Frequency:**\r\n\r\nI ran two nodes that stopped syncing on the same block.\r\n\r\nSeems to resolve itself after recreating the container. I notice this error happens again with other byte values (e.g. `Attempting to update buffer with 213 byte(s) but there is 0 byte(s) left to fill`) but this doesn't seem to cause the node to get stuck.\r\n\r\n### Versions (Add all that apply)\r\n\r\n\r\n* Software version: 21.7.3\r\n* Java version:\r\n    ```\r\n    openjdk 11.0.12 2021-07-20\r\n    OpenJDK Runtime Environment 18.9 (build 11.0.12+7)\r\n    OpenJDK 64-Bit Server VM 18.9 (build 11.0.12+7, mixed mode, sharing)\r\n    ```\r\n* OS Name & Version: Debian GNU/Linux 10 (buster)\r\n* Kernel Version: x86_64 GNU/Linux\r\n* Cloud VM, type, size: GCP n1-standard-2\r\n\r\n### Additional Information\r\n\r\nLogs:\r\n```\r\n2021-09-16 21:04:29.972+00:00 | nioEventLoopGroup-3-5 | INFO  | SyncTargetManager | Found common ancestor with peer Peer 0x2295bf19ca8f8e934c... at block 13238964\r\n2021-09-16 21:04:36.328+00:00 | EthScheduler-Services-6920 (importBlock) | ERROR | MainnetTransactionProcessor | Critical Exception Processing Transaction\r\njava.lang.IllegalArgumentException: Attempting to update buffer with 213 byte(s) but there is -213 byte(s) left to fill\r\n\tat org.hyperledger.besu.crypto.Blake2bfMessageDigest$Blake2bfDigest.update(Blake2bfMessageDigest.java:152)\r\n\tat org.bouncycastle.jcajce.provider.digest.BCMessageDigest.engineUpdate(Unknown Source)\r\n\tat java.base/java.security.MessageDigest.update(Unknown Source)\r\n\tat org.apache.tuweni.bytes.ArrayWrappingBytes.update(ArrayWrappingBytes.java:115)\r\n\tat org.hyperledger.besu.crypto.Hash.digestUsingAlgorithm(Hash.java:62)\r\n\tat org.hyperledger.besu.crypto.Hash.blake2bf(Hash.java:106)\r\n\tat org.hyperledger.besu.ethereum.mainnet.precompiles.BLAKE2BFPrecompileContract.compute(BLAKE2BFPrecompileContract.java:69)\r\n\tat org.hyperledger.besu.ethereum.mainnet.MainnetMessageCallProcessor.executePrecompile(MainnetMessageCallProcessor.java:131)\r\n\tat org.hyperledger.besu.ethereum.mainnet.MainnetMessageCallProcessor.start(MainnetMessageCallProcessor.java:60)\r\n\tat org.hyperledger.besu.ethereum.mainnet.AbstractMessageProcessor.process(AbstractMessageProcessor.java:163)\r\n\tat org.hyperledger.besu.ethereum.mainnet.MainnetTransactionProcessor.process(MainnetTransactionProcessor.java:454)\r\n\tat org.hyperledger.besu.ethereum.mainnet.MainnetTransactionProcessor.processTransaction(MainnetTransactionProcessor.java:361)\r\n\tat org.hyperledger.besu.ethereum.mainnet.AbstractBlockProcessor.processBlock(AbstractBlockProcessor.java:161)\r\n\tat org.hyperledger.besu.ethereum.mainnet.AbstractBlockProcessor.processBlock(AbstractBlockProcessor.java:42)\r\n\tat org.hyperledger.besu.ethereum.mainnet.BlockProcessor.processBlock(BlockProcessor.java:75)\r\n\tat org.hyperledger.besu.ethereum.MainnetBlockValidator.processBlock(MainnetBlockValidator.java:150)\r\n\tat org.hyperledger.besu.ethereum.MainnetBlockValidator.validateAndProcessBlock(MainnetBlockValidator.java:108)\r\n\tat org.hyperledger.besu.ethereum.mainnet.MainnetBlockImporter.importBlock(MainnetBlockImporter.java:45)\r\n\tat org.hyperledger.besu.ethereum.core.BlockImporter.importBlock(BlockImporter.java:44)\r\n\tat org.hyperledger.besu.ethereum.eth.sync.fullsync.FullImportBlockStep.accept(FullImportBlockStep.java:54)\r\n\tat org.hyperledger.besu.ethereum.eth.sync.fullsync.FullImportBlockStep.accept(FullImportBlockStep.java:31)\r\n\tat org.hyperledger.besu.services.pipeline.CompleterStage.run(CompleterStage.java:37)\r\n\tat org.hyperledger.besu.services.pipeline.Pipeline.lambda$runWithErrorHandling$3(Pipeline.java:152)\r\n\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source)\r\n\tat java.base/java.util.concurrent.FutureTask.run(Unknown Source)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\r\n\tat java.base/java.lang.Thread.run(Unknown Source)\r\n2021-09-16 21:04:36.329+00:00 | EthScheduler-Services-6920 (importBlock) | INFO  | AbstractBlockProcessor | Block processing error: transaction invalid 'INTERNAL_ERROR'. Block 0xb738c748d52d0c2f1a66a2306078a763ee99ad3d9a126c250036a43e91b539e9 Transaction 0xfc55eac21b7803e27d65ad9146b606b206cc0aa830a06d117baf2a2e82fa055c\r\n2021-09-16 21:04:36.330+00:00 | EthScheduler-Services-6920 (importBlock) | WARN  | PipelineChainDownloader | Invalid block detected.  Disconnecting from sync target. Failed to import block: Invalid block at #13238965 (0xb738c748d52d0c2f1a66a2306078a763ee99ad3d9a126c250036a43e91b539e9)\r\n2021-09-16 21:04:36.330+00:00 | EthScheduler-Services-6920 (importBlock) | WARN  | PipelineChainDownloader | Chain download failed. Restarting after short delay.\r\njava.util.concurrent.CompletionException: org.hyperledger.besu.ethereum.eth.sync.tasks.exceptions.InvalidBlockException: Failed to import block: Invalid block at #13238965 (0xb738c748d52d0c2f1a66a2306078a763ee99ad3d9a126c250036a43e91b539e9)\r\n\tat java.base/java.util.concurrent.CompletableFuture.encodeRelay(Unknown Source)\r\n\tat java.base/java.util.concurrent.CompletableFuture.completeRelay(Unknown Source)\r\n\tat java.base/java.util.concurrent.CompletableFuture$UniRelay.tryFire(Unknown Source)\r\n\tat java.base/java.util.concurrent.CompletableFuture.postComplete(Unknown Source)\r\n\tat java.base/java.util.concurrent.CompletableFuture.completeExceptionally(Unknown Source)\r\n\tat org.hyperledger.besu.services.pipeline.Pipeline.abort(Pipeline.java:180)\r\n\tat org.hyperledger.besu.services.pipeline.Pipeline.lambda$runWithErrorHandling$3(Pipeline.java:159)\r\n\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source)\r\n\tat java.base/java.util.concurrent.FutureTask.run(Unknown Source)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\r\n\tat java.base/java.lang.Thread.run(Unknown Source)\r\nCaused by: org.hyperledger.besu.ethereum.eth.sync.tasks.exceptions.InvalidBlockException: Failed to import block: Invalid block at #13238965 (0xb738c748d52d0c2f1a66a2306078a763ee99ad3d9a126c250036a43e91b539e9)\r\n\tat org.hyperledger.besu.ethereum.eth.sync.fullsync.FullImportBlockStep.accept(FullImportBlockStep.java:55)\r\n\tat org.hyperledger.besu.ethereum.eth.sync.fullsync.FullImportBlockStep.accept(FullImportBlockStep.java:31)\r\n\tat org.hyperledger.besu.services.pipeline.CompleterStage.run(CompleterStage.java:37)\r\n\tat org.hyperledger.besu.services.pipeline.Pipeline.lambda$runWithErrorHandling$3(Pipeline.java:152)\r\n\t... 5 more\r\n2021-09-16 21:07:55.851+00:00 | nioEventLoopGroup-3-3 | INFO  | SyncTargetManager | Found common ancestor with peer Peer 0xeaa7bc9bd297c70f79... at block 13238964\r\n2021-09-16 21:07:56.066+00:00 | EthScheduler-Services-6921 (downloadBodies) | INFO  | AbstractRetryingPeerTask | No peers available, waiting for peers: 25\r\n2021-09-16 21:10:20.339+00:00 | nioEventLoopGroup-3-3 | INFO  | SyncTargetManager | Found common ancestor with peer Peer 0xbd71c6b2d202b8faf6... at block 13238964\r\n2021-09-16 21:10:20.370+00:00 | EthScheduler-Services-6926 (downloadBodies) | INFO  | AbstractRetryingPeerTask | No peers available, waiting for peers: 25\r\n2021-09-16 21:10:25.646+00:00 | nioEventLoopGroup-3-3 | INFO  | AbstractRetryingPeerTask | No peers available, waiting for peers: 25\r\n2021-09-16 21:10:30.890+00:00 | nioEventLoopGroup-3-3 | INFO  | AbstractRetryingPeerTask | No peers available, waiting for peers: 25\r\n```",
  "closed_by": {
    "login": "macfarla",
    "id": 2627919,
    "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/macfarla",
    "html_url": "https://github.com/macfarla",
    "followers_url": "https://api.github.com/users/macfarla/followers",
    "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
    "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
    "organizations_url": "https://api.github.com/users/macfarla/orgs",
    "repos_url": "https://api.github.com/users/macfarla/repos",
    "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
    "received_events_url": "https://api.github.com/users/macfarla/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/2776/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/2776/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/921894133",
    "html_url": "https://github.com/hyperledger/besu/issues/2776#issuecomment-921894133",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2776",
    "id": 921894133,
    "node_id": "IC_kwDODE2jmc428vz1",
    "user": {
      "login": "atoulme",
      "id": 16758,
      "node_id": "MDQ6VXNlcjE2NzU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16758?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/atoulme",
      "html_url": "https://github.com/atoulme",
      "followers_url": "https://api.github.com/users/atoulme/followers",
      "following_url": "https://api.github.com/users/atoulme/following{/other_user}",
      "gists_url": "https://api.github.com/users/atoulme/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/atoulme/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/atoulme/subscriptions",
      "organizations_url": "https://api.github.com/users/atoulme/orgs",
      "repos_url": "https://api.github.com/users/atoulme/repos",
      "events_url": "https://api.github.com/users/atoulme/events{/privacy}",
      "received_events_url": "https://api.github.com/users/atoulme/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-17T15:38:29Z",
    "updated_at": "2021-09-17T15:38:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "Please indicate which network or chain you were syncing. Please provide information on your OS and machine architecture. Please let us know if native bindings were loaded on startup (looking for the first 100 lines of your log at startup time).\r\n\r\nThank you for your report.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/921894133/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/921951918",
    "html_url": "https://github.com/hyperledger/besu/issues/2776#issuecomment-921951918",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2776",
    "id": 921951918,
    "node_id": "IC_kwDODE2jmc42896u",
    "user": {
      "login": "leontastic",
      "id": 5552308,
      "node_id": "MDQ6VXNlcjU1NTIzMDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5552308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/leontastic",
      "html_url": "https://github.com/leontastic",
      "followers_url": "https://api.github.com/users/leontastic/followers",
      "following_url": "https://api.github.com/users/leontastic/following{/other_user}",
      "gists_url": "https://api.github.com/users/leontastic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/leontastic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leontastic/subscriptions",
      "organizations_url": "https://api.github.com/users/leontastic/orgs",
      "repos_url": "https://api.github.com/users/leontastic/repos",
      "events_url": "https://api.github.com/users/leontastic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/leontastic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-17T17:10:01Z",
    "updated_at": "2021-09-17T17:10:27Z",
    "author_association": "NONE",
    "body": "@atoulme Thanks for looking at this. I updated the issue title and description with more information.\r\n\r\n<details>\r\n<summary>Startup logs</summary>\r\n<pre>\r\n2021-09-16 21:44:48.090+00:00 | main | INFO  | Besu | Using LibEthPairings native alt bn128\r\n2021-09-16 21:44:48.094+00:00 | main | INFO  | Besu | Using the native implementation of the signature algorithm\r\n2021-09-16 21:44:48.100+00:00 | main | INFO  | Besu | Starting Besu version: besu/v21.7.3/linux-x86_64/oracle_openjdk-java-11\r\n2021-09-16 21:44:48.378+00:00 | main | INFO  | Besu | Static Nodes file = /data/static-nodes.json\r\n2021-09-16 21:44:48.380+00:00 | main | INFO  | StaticNodesParser | StaticNodes file /data/static-nodes.json does not exist, no static connections will be created.\r\n2021-09-16 21:44:48.381+00:00 | main | INFO  | Besu | Connecting to 0 static nodes.\r\n2021-09-16 21:44:48.384+00:00 | main | INFO  | Besu | Security Module: localfile\r\n2021-09-16 21:44:48.407+00:00 | main | INFO  | DatabaseMetadata | Lookup database metadata file in data directory: /data\r\n2021-09-16 21:44:48.493+00:00 | main | INFO  | RocksDBKeyValueStorageFactory | Existing database detected at /data. Version 1\r\n2021-09-16 21:44:50.584+00:00 | main | INFO  | KeyPairUtil | Loaded public key 0x017cb427027149128597e841b79c76a29b2ce4aa5dadb3d289370eea79a98a144080b319da0c9a6163240d204c42eab907a4000870c4438f116c65308e9b57c1 from /data/key\r\n2021-09-16 21:44:50.721+00:00 | main | INFO  | ProtocolScheduleBuilder | Protocol schedule created with milestones: [Frontier: 0, Homestead: 1150000, DaoRecoveryInit: 1920000, DaoRecoveryTransition: 1920001, Homestead: 1920010, TangerineWhistle: 2463000, SpuriousDragon: 2675000, Byzantium: 4370000, Petersburg: 7280000, Istanbul: 9069000, MuirGlacier: 9200000, Berlin: 12244000, London: 12965000]\r\n2021-09-16 21:44:51.448+00:00 | main | INFO  | FastDownloaderFactory | Fast sync was requested, but cannot be enabled because the local blockchain is not empty.\r\n2021-09-16 21:44:51.468+00:00 | main | INFO  | RunnerBuilder | Detecting NAT service.\r\n2021-09-16 21:44:51.618+00:00 | main | INFO  | Runner | Starting Ethereum main loop ...\r\n2021-09-16 21:44:51.618+00:00 | main | INFO  | MetricsHttpService | Starting metrics http service on 127.0.0.1:9094\r\n2021-09-16 21:44:51.799+00:00 | main | INFO  | KubernetesNatManager | Starting kubernetes NAT manager.\r\n2021-09-16 21:44:51.799+00:00 | vert.x-eventloop-thread-3 | INFO  | MetricsHttpService | Metrics service started and listening on 9094:9094\r\nANTLR Tool version 4.7.1 used for code generation does not match the current runtime version 4.8ANTLR Runtime version 4.7.1 used for parser compilation does not match the current runtime version 4.8ANTLR Tool version 4.7.1 used for code generation does not match the current runtime version 4.8ANTLR Runtime version 4.7.1 used for parser compilation does not match the current runtime version 4.8SLF4J: Class path contains multiple SLF4J bindings.\r\nSLF4J: Found binding in [jar:file:/besu/lib/log4j-slf4j-impl-2.14.1.jar!/org/slf4j/impl/StaticLoggerBinder.class]\r\nSLF4J: Found binding in [jar:file:/besu/lib/logback-classic-1.2.3.jar!/org/slf4j/impl/StaticLoggerBinder.class]\r\nSLF4J: See http://www.slf4j.org/codes.html#multiple_bindings for an explanation.\r\nSLF4J: Actual binding is of type [org.apache.logging.slf4j.Log4jLoggerFactory]\r\n2021-09-16 21:44:52.160+00:00 | main | INFO  | NetworkRunner | Starting Network.\r\n2021-09-16 21:44:52.163+00:00 | main | INFO  | DefaultP2PNetwork | Starting DNS discovery with URL enrtree://AKA3AM6LPBYEUDMVNU3BSVQJ5AD45Y7YPOHJLEF6W26QOE4VTUDPE@all.mainnet.ethdisco.net\r\n2021-09-16 21:44:52.225+00:00 | nioEventLoopGroup-2-1 | INFO  | RlpxAgent | P2P RLPx agent started and listening on /0.0.0.0:30303.\r\n2021-09-16 21:44:52.226+00:00 | main | INFO  | PeerDiscoveryAgent | Starting peer discovery agent on host=0.0.0.0, port=30303\r\n2021-09-16 21:44:52.243+00:00 | vert.x-eventloop-thread-4 | INFO  | VertxPeerDiscoveryAgent | Started peer discovery agent successfully, on effective host=0.0.0.0 and port=30303\r\n2021-09-16 21:44:52.244+00:00 | vert.x-eventloop-thread-4 | INFO  | PeerDiscoveryAgent | P2P peer discovery agent started and listening on /0.0.0.0:30303\r\n2021-09-16 21:44:52.295+00:00 | vert.x-eventloop-thread-4 | INFO  | PeerDiscoveryAgent | Writing node record to disk. NodeRecord{seq=74, publicKey=0x03017cb427027149128597e841b79c76a29b2ce4aa5dadb3d289370eea79a98a14, udpAddress=Optional[/127.0.0.1:30303], tcpAddress=Optional[/127.0.0.1:30303], asBase64=-Je4QJWTEcqUmqW1gE_rOk5DMa0dxzIzE6VITdTkAeQi96Pzb5nJ41spP_zxk48TWZUfX7j8oX5s7mrf8CyK_mRAKwtKg2V0aMfGhLcVB32AgmlkgnY0gmlwhH8AAAGJc2VjcDI1NmsxoQMBfLQnAnFJEoWX6EG3nHaimyzkql2ts9KJNw7qeamKFIN0Y3CCdl-DdWRwgnZf, nodeId=0x3163108181fdee800ddd854ba1ba49093909e29bb4fdfa524634f6735c1ee460, customFields={tcp=30303, udp=30303, ip=0x7f000001, eth=[[0xb715077d, 0x]], id=V4, secp256k1=0x03017cb427027149128597e841b79c76a29b2ce4aa5dadb3d289370eea79a98a14}}\r\n2021-09-16 21:44:52.372+00:00 | main | INFO  | DefaultP2PNetwork | Enode URL enode://017cb427027149128597e841b79c76a29b2ce4aa5dadb3d289370eea79a98a144080b319da0c9a6163240d204c42eab907a4000870c4438f116c65308e9b57c1@127.0.0.1:30303\r\n2021-09-16 21:44:52.373+00:00 | main | INFO  | DefaultP2PNetwork | Node address 0xa1ba49093909e29bb4fdfa524634f6735c1ee460\r\n2021-09-16 21:44:52.378+00:00 | main | INFO  | DefaultSynchronizer | Starting synchronizer.\r\n2021-09-16 21:44:52.380+00:00 | main | INFO  | FullSyncDownloader | Starting full sync.\r\n2021-09-16 21:44:52.381+00:00 | StatePruning-0 | INFO  | Pruner | Starting Pruner.\r\n2021-09-16 21:44:52.382+00:00 | main | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\n2021-09-16 21:44:52.394+00:00 | main | INFO  | JsonRpcHttpService | Starting JSON-RPC service on 0.0.0.0:9091\r\n2021-09-16 21:44:52.393+00:00 | StatePruning-0 | ERROR | Besu | Uncaught exception in thread \"StatePruning-0\"\r\norg.hyperledger.besu.plugin.services.exception.StorageException: org.rocksdb.RocksDBException: DeleteRangeCF not implemented\r\n        at org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.clear(RocksDBColumnarKeyValueStorage.java:211)\r\n        at org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.clear(RocksDBColumnarKeyValueStorage.java:62)\r\n        at org.hyperledger.besu.services.kvstore.SegmentedKeyValueStorageAdapter.clear(SegmentedKeyValueStorageAdapter.java:40)\r\n        at org.hyperledger.besu.ethereum.worldstate.MarkSweepPruner.clearMarks(MarkSweepPruner.java:229)\r\n        at org.hyperledger.besu.ethereum.worldstate.MarkSweepPruner.prepare(MarkSweepPruner.java:124)\r\n        at org.hyperledger.besu.ethereum.worldstate.Pruner.lambda$start$0(Pruner.java:97)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\r\n        at java.base/java.lang.Thread.run(Unknown Source)\r\nCaused by: org.rocksdb.RocksDBException: DeleteRangeCF not implemented\r\n        at org.rocksdb.RocksDB.deleteRange(Native Method)\r\n        at org.rocksdb.RocksDB.deleteRange(RocksDB.java:1493)\r\n        at org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.clear(RocksDBColumnarKeyValueStorage.java:206)\r\n        ... 8 more\r\n2021-09-16 21:44:52.422+00:00 | vert.x-eventloop-thread-8 | INFO  | JsonRpcHttpService | JSON-RPC service started and listening on 0.0.0.0:9091\r\n2021-09-16 21:44:52.424+00:00 | main | INFO  | WebSocketService | Starting Websocket service on 0.0.0.0:9092\r\n2021-09-16 21:44:52.434+00:00 | vert.x-eventloop-thread-10 | INFO  | WebSocketService | Websocket service started and listening on 0.0.0.0:9092\r\n2021-09-16 21:44:52.436+00:00 | main | INFO  | Runner | Ethereum main loop is up.\r\n</pre>\r\n</details>\r\n\r\nMaybe it was just a bad peer or something. I felt this needed a report because the server would get stuck for many blocks without restarting. Besu's liveness is very valuable.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/921951918/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/922172054",
    "html_url": "https://github.com/hyperledger/besu/issues/2776#issuecomment-922172054",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2776",
    "id": 922172054,
    "node_id": "IC_kwDODE2jmc429zqW",
    "user": {
      "login": "atoulme",
      "id": 16758,
      "node_id": "MDQ6VXNlcjE2NzU4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16758?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/atoulme",
      "html_url": "https://github.com/atoulme",
      "followers_url": "https://api.github.com/users/atoulme/followers",
      "following_url": "https://api.github.com/users/atoulme/following{/other_user}",
      "gists_url": "https://api.github.com/users/atoulme/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/atoulme/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/atoulme/subscriptions",
      "organizations_url": "https://api.github.com/users/atoulme/orgs",
      "repos_url": "https://api.github.com/users/atoulme/repos",
      "events_url": "https://api.github.com/users/atoulme/events{/privacy}",
      "received_events_url": "https://api.github.com/users/atoulme/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-18T03:35:10Z",
    "updated_at": "2021-09-18T03:35:10Z",
    "author_association": "CONTRIBUTOR",
    "body": "Are you unblocked now?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/922172054/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/946742972",
    "html_url": "https://github.com/hyperledger/besu/issues/2776#issuecomment-946742972",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2776",
    "id": 946742972,
    "node_id": "IC_kwDODE2jmc44bia8",
    "user": {
      "login": "leontastic",
      "id": 5552308,
      "node_id": "MDQ6VXNlcjU1NTIzMDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5552308?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/leontastic",
      "html_url": "https://github.com/leontastic",
      "followers_url": "https://api.github.com/users/leontastic/followers",
      "following_url": "https://api.github.com/users/leontastic/following{/other_user}",
      "gists_url": "https://api.github.com/users/leontastic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/leontastic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leontastic/subscriptions",
      "organizations_url": "https://api.github.com/users/leontastic/orgs",
      "repos_url": "https://api.github.com/users/leontastic/repos",
      "events_url": "https://api.github.com/users/leontastic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/leontastic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-19T13:48:46Z",
    "updated_at": "2021-10-19T13:48:46Z",
    "author_association": "NONE",
    "body": "Encountered this again on 21.7.3\r\n\r\n<details>\r\n<summary>\r\nLogs:\r\n</summary>\r\n\r\n```\r\n2021-10-19 07:44:18.707 EDTjava.lang.IllegalArgumentException: Attempting to update buffer with 213 byte(s) but there is -213 byte(s) left to fill\r\n  at org.hyperledger.besu.crypto.Blake2bfMessageDigest$Blake2bfDigest.update(Blake2bfMessageDigest.java:152)\r\n  at org.bouncycastle.jcajce.provider.digest.BCMessageDigest.engineUpdate(Unknown Source)\r\n  at java.base/java.security.MessageDigest.update(Unknown Source)\r\n  at org.apache.tuweni.bytes.ArrayWrappingBytes.update(ArrayWrappingBytes.java:115)\r\n  at org.hyperledger.besu.crypto.Hash.digestUsingAlgorithm(Hash.java:62)\r\n  at org.hyperledger.besu.crypto.Hash.blake2bf(Hash.java:106)\r\n  at org.hyperledger.besu.ethereum.mainnet.precompiles.BLAKE2BFPrecompileContract.compute(BLAKE2BFPrecompileContract.java:69)\r\n  at org.hyperledger.besu.ethereum.mainnet.MainnetMessageCallProcessor.executePrecompile(MainnetMessageCallProcessor.java:131)\r\n  at org.hyperledger.besu.ethereum.mainnet.MainnetMessageCallProcessor.start(MainnetMessageCallProcessor.java:60)\r\n  at org.hyperledger.besu.ethereum.mainnet.AbstractMessageProcessor.process(AbstractMessageProcessor.java:163)\r\n  at org.hyperledger.besu.ethereum.mainnet.MainnetTransactionProcessor.process(MainnetTransactionProcessor.java:454)\r\n  at org.hyperledger.besu.ethereum.mainnet.MainnetTransactionProcessor.processTransaction(MainnetTransactionProcessor.java:361)\r\n  at org.hyperledger.besu.ethereum.mainnet.AbstractBlockProcessor.processBlock(AbstractBlockProcessor.java:161)\r\n  at org.hyperledger.besu.ethereum.mainnet.AbstractBlockProcessor.processBlock(AbstractBlockProcessor.java:42)\r\n  at org.hyperledger.besu.ethereum.mainnet.BlockProcessor.processBlock(BlockProcessor.java:75)\r\n  at org.hyperledger.besu.ethereum.MainnetBlockValidator.processBlock(MainnetBlockValidator.java:150)\r\n  at org.hyperledger.besu.ethereum.MainnetBlockValidator.validateAndProcessBlock(MainnetBlockValidator.java:108)\r\n  at org.hyperledger.besu.ethereum.mainnet.MainnetBlockImporter.importBlock(MainnetBlockImporter.java:45)\r\n  at org.hyperledger.besu.ethereum.core.BlockImporter.importBlock(BlockImporter.java:44)\r\n  at org.hyperledger.besu.ethereum.eth.sync.fullsync.FullImportBlockStep.accept(FullImportBlockStep.java:54)\r\n  at org.hyperledger.besu.ethereum.eth.sync.fullsync.FullImportBlockStep.accept(FullImportBlockStep.java:31)\r\n  at org.hyperledger.besu.services.pipeline.CompleterStage.run(CompleterStage.java:37)\r\n  at org.hyperledger.besu.services.pipeline.Pipeline.lambda$runWithErrorHandling$3(Pipeline.java:152)\r\n  at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source)\r\n  at java.base/java.util.concurrent.FutureTask.run(Unknown Source)\r\n  at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\r\n  at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\r\n  at java.base/java.lang.Thread.run(Unknown Source)\r\n```\r\n\r\n</details>",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/946742972/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1066454595",
    "html_url": "https://github.com/hyperledger/besu/issues/2776#issuecomment-1066454595",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2776",
    "id": 1066454595,
    "node_id": "IC_kwDODE2jmc4_kM5D",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-14T07:18:21Z",
    "updated_at": "2022-03-14T07:18:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @leontastic - realise it's been a while but we have made some improvements in peering and syncing (eg 22.1.0 had fast sync optimisations). Additionally we are beginning a holistic assessment of peering behavior including any outstanding issues. So we're hoping that either those changes have it fixed already, or that you're able to give us an update if you're still having related issues?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1066454595/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
