{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/3933",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/3933/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/3933/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/3933/events",
  "html_url": "https://github.com/hyperledger/besu/issues/3933",
  "id": 1257401319,
  "node_id": "I_kwDODE2jmc5K8mvn",
  "number": 3933,
  "title": "org.rocksdb.RocksDBException: Invalid column family specified in write batch",
  "user": {
    "login": "qntoine",
    "id": 12987611,
    "node_id": "MDQ6VXNlcjEyOTg3NjEx",
    "avatar_url": "https://avatars.githubusercontent.com/u/12987611?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/qntoine",
    "html_url": "https://github.com/qntoine",
    "followers_url": "https://api.github.com/users/qntoine/followers",
    "following_url": "https://api.github.com/users/qntoine/following{/other_user}",
    "gists_url": "https://api.github.com/users/qntoine/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/qntoine/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/qntoine/subscriptions",
    "organizations_url": "https://api.github.com/users/qntoine/orgs",
    "repos_url": "https://api.github.com/users/qntoine/repos",
    "events_url": "https://api.github.com/users/qntoine/events{/privacy}",
    "received_events_url": "https://api.github.com/users/qntoine/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2022-06-02T00:50:07Z",
  "updated_at": "2022-06-07T01:29:34Z",
  "closed_at": "2022-06-07T01:29:34Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nUsing Besu through Rocket Pool (1.4.1), I am getting the following error logs when trying to sync using snap sync.\r\nThe error seems to occur once the initial snap sync is completed and the client switches to fast sync. \r\n\r\n### Logs\r\n```\r\neth1_1           | java.util.concurrent.CompletionException: org.hyperledger.besu.plugin.services.exception.StorageException: org.rocksdb.RocksDBException: Invalid column family specified in write batch\r\neth1_1           |      at java.base/java.util.concurrent.CompletableFuture.encodeRelay(CompletableFuture.java:368)\r\neth1_1           |      at java.base/java.util.concurrent.CompletableFuture.completeRelay(CompletableFuture.java:377)\r\neth1_1           |      at java.base/java.util.concurrent.CompletableFuture$UniRelay.tryFire(CompletableFuture.java:1097)\r\neth1_1           |      at java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\r\neth1_1           |      at java.base/java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2162)\r\neth1_1           |      at org.hyperledger.besu.services.pipeline.Pipeline.abort(Pipeline.java:180)\r\neth1_1           |      at org.hyperledger.besu.services.pipeline.Pipeline.lambda$runWithErrorHandling$3(Pipeline.java:159)\r\neth1_1           |      at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\r\neth1_1           |      at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\neth1_1           |      at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\r\neth1_1           |      at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\r\neth1_1           |      at java.base/java.lang.Thread.run(Thread.java:833)\r\neth1_1           | Caused by: org.hyperledger.besu.plugin.services.exception.StorageException: org.rocksdb.RocksDBException: Invalid column family specified in write batch\r\neth1_1           |      at org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage$RocksDbTransaction.commit(RocksDBColumnarKeyValueStorage.java:277)\r\neth1_1           |      at org.hyperledger.besu.services.kvstore.SegmentedKeyValueStorageTransactionTransitionValidatorDecorator.commit(SegmentedKeyValueStorageTransactionTransitionValidatorDecorator.java:49)\r\neth1_1           |      at org.hyperledger.besu.services.kvstore.SegmentedKeyValueStorageAdapter$1.commit(SegmentedKeyValueStorageAdapter.java:90)\r\neth1_1           |      at org.hyperledger.besu.ethereum.storage.keyvalue.KeyValueStoragePrefixedKeyBlockchainStorage$Updater.commit(KeyValueStoragePrefixedKeyBlockchainStorage.java:213)\r\neth1_1           |      at org.hyperledger.besu.ethereum.chain.DefaultBlockchain.appendBlockHelper(DefaultBlockchain.java:314)\r\neth1_1           |      at org.hyperledger.besu.ethereum.chain.DefaultBlockchain.appendBlock(DefaultBlockchain.java:294)\r\neth1_1           |      at org.hyperledger.besu.ethereum.mainnet.MainnetBlockImporter.fastImportBlock(MainnetBlockImporter.java:64)\r\neth1_1           |      at org.hyperledger.besu.ethereum.eth.sync.fastsync.FastImportBlocksStep.importBlock(FastImportBlocksStep.java:99)\r\neth1_1           |      at org.hyperledger.besu.ethereum.eth.sync.fastsync.FastImportBlocksStep.accept(FastImportBlocksStep.java:64)\r\neth1_1           |      at org.hyperledger.besu.ethereum.eth.sync.fastsync.FastImportBlocksStep.accept(FastImportBlocksStep.java:35)\r\neth1_1           |      at org.hyperledger.besu.services.pipeline.CompleterStage.run(CompleterStage.java:37)\r\neth1_1           |      at org.hyperledger.besu.services.pipeline.Pipeline.lambda$runWithErrorHandling$3(Pipeline.java:152)\r\neth1_1           |      ... 5 more\r\neth1_1           | Caused by: org.rocksdb.RocksDBException: Invalid column family specified in write batch\r\neth1_1           |      at org.rocksdb.Transaction.commit(Native Method)\r\neth1_1           |      at org.rocksdb.Transaction.commit(Transaction.java:206)\r\neth1_1           |      at org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage$RocksDbTransaction.commit(RocksDBColumnarKeyValueStorage.java:271)\r\neth1_1           |      ... 16 more\r\n```\r\n\r\n\r\n### Versions\r\n* Besu version: 22.4.2\r\n* OS Name & Version: Ubuntu 20.04 LTS (up-to-date)\r\n* Kernel Version: 5.4.0-105-generic\r\n* Docker Version: 20.10.16\r\n* Cloud VM, type, size: Contabo Cloud VPS L (fresh install)",
  "closed_by": {
    "login": "macfarla",
    "id": 2627919,
    "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/macfarla",
    "html_url": "https://github.com/macfarla",
    "followers_url": "https://api.github.com/users/macfarla/followers",
    "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
    "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
    "organizations_url": "https://api.github.com/users/macfarla/orgs",
    "repos_url": "https://api.github.com/users/macfarla/repos",
    "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
    "received_events_url": "https://api.github.com/users/macfarla/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/3933/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/3933/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
