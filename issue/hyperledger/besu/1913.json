{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/1913",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/1913/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/1913/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/1913/events",
  "html_url": "https://github.com/hyperledger/besu/issues/1913",
  "id": 808249185,
  "node_id": "MDU6SXNzdWU4MDgyNDkxODU=",
  "number": 1913,
  "title": "DeleteRangeCF error when enabling pruning",
  "user": {
    "login": "3nprob",
    "id": 74199244,
    "node_id": "MDQ6VXNlcjc0MTk5MjQ0",
    "avatar_url": "https://avatars.githubusercontent.com/u/74199244?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/3nprob",
    "html_url": "https://github.com/3nprob",
    "followers_url": "https://api.github.com/users/3nprob/followers",
    "following_url": "https://api.github.com/users/3nprob/following{/other_user}",
    "gists_url": "https://api.github.com/users/3nprob/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/3nprob/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/3nprob/subscriptions",
    "organizations_url": "https://api.github.com/users/3nprob/orgs",
    "repos_url": "https://api.github.com/users/3nprob/repos",
    "events_url": "https://api.github.com/users/3nprob/events{/privacy}",
    "received_events_url": "https://api.github.com/users/3nprob/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3013559202,
      "node_id": "MDU6TGFiZWwzMDEzNTU5MjAy",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/mainnet",
      "name": "mainnet",
      "color": "9D578C",
      "default": false,
      "description": ""
    },
    {
      "id": 4164098293,
      "node_id": "LA_kwDODE2jmc74Mxj1",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/icebox",
      "name": "icebox",
      "color": "1D76DB",
      "default": false,
      "description": "items that need more consideration, time, or can wait"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "RatanRSur",
    "id": 4733314,
    "node_id": "MDQ6VXNlcjQ3MzMzMTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4733314?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/RatanRSur",
    "html_url": "https://github.com/RatanRSur",
    "followers_url": "https://api.github.com/users/RatanRSur/followers",
    "following_url": "https://api.github.com/users/RatanRSur/following{/other_user}",
    "gists_url": "https://api.github.com/users/RatanRSur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/RatanRSur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/RatanRSur/subscriptions",
    "organizations_url": "https://api.github.com/users/RatanRSur/orgs",
    "repos_url": "https://api.github.com/users/RatanRSur/repos",
    "events_url": "https://api.github.com/users/RatanRSur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/RatanRSur/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "RatanRSur",
      "id": 4733314,
      "node_id": "MDQ6VXNlcjQ3MzMzMTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4733314?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RatanRSur",
      "html_url": "https://github.com/RatanRSur",
      "followers_url": "https://api.github.com/users/RatanRSur/followers",
      "following_url": "https://api.github.com/users/RatanRSur/following{/other_user}",
      "gists_url": "https://api.github.com/users/RatanRSur/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RatanRSur/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RatanRSur/subscriptions",
      "organizations_url": "https://api.github.com/users/RatanRSur/orgs",
      "repos_url": "https://api.github.com/users/RatanRSur/repos",
      "events_url": "https://api.github.com/users/RatanRSur/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RatanRSur/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 12,
  "created_at": "2021-02-15T07:07:03Z",
  "updated_at": "2023-01-26T10:29:04Z",
  "closed_at": "2023-01-26T10:29:03Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\r\nAs a user, I want to have the node open up the http rpc interface once synced \r\n\r\n### Acceptance Criteria\r\n* Service listening on specified port\r\n\r\n### Steps to Reproduce (Bug)\r\n1. Start full pruned sync on Rinkeby testnet\r\n2. Wait until caught up with current head\r\n3. Attempt to connect to RPC interface. \r\n\r\n**Expected behavior:**\r\nConnection opens\r\n\r\n**Actual behavior:**\r\nConnection refused\r\n\r\n**Frequency:** 100%\r\n\r\n### Versions (Add all that apply)\r\n* Software version: [`besu/v21.1.0-RC2/linux-x86_64/oracle_openjdk-java-15`]\r\n* Java version: [`OpenJDK 64-Bit Server VM (build 15.0.2+7-27, mixed mode, sharing)`]\r\n* OS Name & Version: Docker, host is Debian 10 / Debian 11\r\n* Kernel Version: [`Linux 5.9.0-5-amd64 #1 SMP Debian 5.9.15-1 x86_64 GNU/Linux`]\r\n* Docker Version: [`20.10.2`]\r\n\r\n### Additional Information\r\n\r\nRunning on self-managed hardware/OS (not cloud/vm) in docker. Local DNS is working. State is stored on a local zfs volume.\r\n\r\nThere seems to be some issue with the node not being able to tranbsition to stynced state once caught up, it throws some errors and then continues to download and sync new blocks, with the number of connected peers increasing as expected and by the looks of it, it's keeping up with current head of chain.\r\n\r\n```\r\nmain | INFO  | AbstractAltBnPrecompiledContract | Using LibEthPairings native alt bn128\r\nmain | INFO  | SECP256K1 | Using native secp256k1\r\nmain | INFO  | Besu | Starting Besu version: besu/v21.1.0-RC2/linux-x86_64/oracle_openjdk-java-15\r\nmain | INFO  | Besu | Static Nodes file = /besu/data/static-nodes.json\r\nmain | INFO  | StaticNodesParser | StaticNodes file /besu/data/static-nodes.json does not exist, no static connections will be created.\r\nmain | INFO  | Besu | Connecting to 0 static nodes.\r\nmain | INFO  | Besu | Security Module: localfile\r\nmain | INFO  | KeyPairUtil | Loaded public key REDACTED from /besu/data/key\r\nmain | INFO  | DatabaseMetadata | Lookup database metadata file in data directory: /besu/data\r\nmain | INFO  | RocksDBKeyValueStorageFactory | Existing database detected at /besu/data. Version 1\r\nmain | INFO  | ProtocolScheduleBuilder | Protocol schedule created with milestones: [Frontier: 0, Homestead: 1, TangerineWhistle: 2, SpuriousDragon: 3, Byzantium: 1035301, Constantinople: 3660663, Petersburg: 4321234, Istanbul: 5435345]\r\nmain | INFO  | FastDownloaderFactory | Fast sync was requested, but cannot be enabled because the local blockchain is not empty.\r\nmain | INFO  | RunnerBuilder | Detecting NAT service.\r\nmain | INFO  | Runner | Starting Ethereum main loop ...\r\nmain | INFO  | NatService | No NAT environment detected so no service could be started\r\nmain | INFO  | NetworkRunner | Starting Network.\r\nmain | INFO  | DefaultP2PNetwork | Starting DNS discovery with URL enrtree://REDACTED@all.rinkeby.ethdisco.net\r\nnioEventLoopGroup-2-1 | INFO  | RlpxAgent | P2P RLPx agent started and listening on /0.0.0.0:REDACTED.\r\nmain | INFO  | PeerDiscoveryAgent | Starting peer discovery agent on host=0.0.0.0, port=REDACTED\r\nvert.x-eventloop-thread-1 | INFO  | VertxPeerDiscoveryAgent | Started peer discovery agent successfully, on effective host=0.0.0.0 and port=REDACTED\r\nvert.x-eventloop-thread-1 | INFO  | PeerDiscoveryAgent | P2P peer discovery agent started and listening on /0.0.0.0:REDACTED\r\nmain | INFO  | DefaultP2PNetwork | Enode URL enode://REDACTED@REDACTED\r\nmain | INFO  | DefaultP2PNetwork | Node address REDACTED\r\nmain | INFO  | DefaultSynchronizer | Starting synchronizer.\r\nStatePruning-0 | INFO  | Pruner | Starting Pruner.\r\nmain | INFO  | FullSyncDownloader | Starting full sync.\r\nmain | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\nmain | INFO  | Runner | Ethereum main loop is up.\r\nStatePruning-0 | ERROR | Besu | Uncaught exception in thread \"StatePruning-0\"\r\norg.hyperledger.besu.plugin.services.exception.StorageException: org.rocksdb.RocksDBException: DeleteRangeCF not implemented\r\n        at org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.clear(RocksDBColumnarKeyValueStorage.java:211)\r\n        at org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.clear(RocksDBColumnarKeyValueStorage.java:62)\r\n        at org.hyperledger.besu.services.kvstore.SegmentedKeyValueStorageAdapter.clear(SegmentedKeyValueStorageAdapter.java:40)\r\n        at org.hyperledger.besu.ethereum.worldstate.MarkSweepPruner.clearMarks(MarkSweepPruner.java:228)\r\n        at org.hyperledger.besu.ethereum.worldstate.MarkSweepPruner.prepare(MarkSweepPruner.java:123)\r\n        at org.hyperledger.besu.ethereum.worldstate.Pruner.lambda$start$0(Pruner.java:97)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630)\r\n        at java.base/java.lang.Thread.run(Thread.java:832)\r\nCaused by: org.rocksdb.RocksDBException: DeleteRangeCF not implemented\r\n        at org.rocksdb.RocksDB.deleteRange(Native Method)\r\n        at org.rocksdb.RocksDB.deleteRange(RocksDB.java:1493)\r\n        at org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.clear(RocksDBColumnarKeyValueStorage.java:206)\r\n        ... 8 more\r\nmain | INFO  | AutoTransactionLogBloomCachingService | Starting auto transaction log bloom caching service.\r\nmain | INFO  | LogBloomCacheMetadata | Lookup cache metadata file in data directory: /besu/data/caches\r\nnioEventLoopGroup-3-1 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 1\r\nEthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 1\r\nTimer-0 | ERROR | Besu | Uncaught exception in thread \"Timer-0\"\r\njava.net.SocketTimeoutException\r\n        at org.xbill.DNS.Resolver.send(Resolver.java:157)\r\n        at org.apache.tuweni.discovery.DNSResolver.resolveRecordRaw(DNSResolver.kt:149)\r\n        at org.apache.tuweni.discovery.DNSResolver.resolveRecord(DNSResolver.kt:72)\r\n        at org.apache.tuweni.discovery.DNSResolver.visitTree(DNSResolver.kt:114)\r\n        at org.apache.tuweni.discovery.DNSResolver.visitTree(DNSResolver.kt:105)\r\n        at org.apache.tuweni.discovery.DNSResolver.collectAll(DNSResolver.kt:94)\r\n        at org.apache.tuweni.discovery.DNSTimerTask.run(DNSDaemon.kt:70)\r\n        at java.base/java.util.TimerThread.mainLoop(Timer.java:556)\r\n        at java.base/java.util.TimerThread.run(Timer.java:506)\r\nEthScheduler-Timer-0 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\nnioEventLoopGroup-3-3 | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 1\r\nnioEventLoopGroup-3-3 | INFO  | SyncTargetManager | Found common ancestor with peer REDACTED... at block 8076206\r\nEthScheduler-Workers-2 | INFO  | PersistBlockTask | Imported #8,076,208 / 15 tx / 0 om / 2,260,911 (22.6%) gas / (0xdda7250c3bacf9809521b66b9c548b8df6640bdc94d9a7a04a2a698671ca5032) in 0.149s. Peers: 1\r\nEthScheduler-Workers-3 | INFO  | PersistBlockTask | Imported #8,076,209 / 10 tx / 0 om / 1,312,420 (13.1%) gas / (0xb86fa09ddd4b194635ae992fd83927c966630efa213b2abe593e7c89dc3af8b0) in 0.089s. Peers: 1\r\n```\r\n\r\n### Environment variables:\r\n\r\n```\r\nBESU_DATA_PATH=/besu/data\r\nBESU_GRAPHQL_HTTP_HOST=0.0.0.0\r\nBESU_METRICS_PORT=25943\r\nBESU_NAT_METHOD=NONE\r\nBESU_NETWORK=rinkeby\r\nBESU_P2P_HOST=REDACTED\r\nBESU_P2P_INTERFACE=0.0.0.0\r\nBESU_P2P_PORT=REDACTED\r\nBESU_PID_PATH=/tmp/pid\r\nBESU_PRUNING_BLOCKS_RETAINED=10000\r\nBESU_PRUNING_ENABLED=true\r\nBESU_RPC_HTTP_HOST=0.0.0.0\r\nBESU_RPC_HTTP_PORT=26695\r\nBESU_RPC_WS_HOST=0.0.0.0\r\nBESU_RPC_WS_PORT=8546\r\nBESU_SYNC_MODE=FAST\r\n```\r\n\r\n```\r\n# netstat -tanpu | grep LISTEN\r\ntcp        0      0 0.0.0.0:$P2P_PORT           0.0.0.0:*               LISTEN      -\r\n```",
  "closed_by": {
    "login": "non-fungible-nelson",
    "id": 85905982,
    "node_id": "MDQ6VXNlcjg1OTA1OTgy",
    "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/non-fungible-nelson",
    "html_url": "https://github.com/non-fungible-nelson",
    "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
    "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
    "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
    "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
    "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
    "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
    "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/1913/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/1913/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/779007929",
    "html_url": "https://github.com/hyperledger/besu/issues/1913#issuecomment-779007929",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1913",
    "id": 779007929,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3OTAwNzkyOQ==",
    "user": {
      "login": "3nprob",
      "id": 74199244,
      "node_id": "MDQ6VXNlcjc0MTk5MjQ0",
      "avatar_url": "https://avatars.githubusercontent.com/u/74199244?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/3nprob",
      "html_url": "https://github.com/3nprob",
      "followers_url": "https://api.github.com/users/3nprob/followers",
      "following_url": "https://api.github.com/users/3nprob/following{/other_user}",
      "gists_url": "https://api.github.com/users/3nprob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/3nprob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/3nprob/subscriptions",
      "organizations_url": "https://api.github.com/users/3nprob/orgs",
      "repos_url": "https://api.github.com/users/3nprob/repos",
      "events_url": "https://api.github.com/users/3nprob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/3nprob/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-15T07:20:49Z",
    "updated_at": "2021-02-15T07:20:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "The error, if related, seems to come from here:  https://github.com/facebook/rocksdb/blob/master/include/rocksdb/write_batch.h#L226",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/779007929/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/779926873",
    "html_url": "https://github.com/hyperledger/besu/issues/1913#issuecomment-779926873",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1913",
    "id": 779926873,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3OTkyNjg3Mw==",
    "user": {
      "login": "shemnon",
      "id": 38109,
      "node_id": "MDQ6VXNlcjM4MTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shemnon",
      "html_url": "https://github.com/shemnon",
      "followers_url": "https://api.github.com/users/shemnon/followers",
      "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
      "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
      "organizations_url": "https://api.github.com/users/shemnon/orgs",
      "repos_url": "https://api.github.com/users/shemnon/repos",
      "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shemnon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-16T15:51:26Z",
    "updated_at": "2021-02-16T15:52:37Z",
    "author_association": "MEMBER",
    "body": "Set `BESU_RPC_HTTP_ENABLED=true`, `BESU_RPC_WS_ENABLED=true`, and `BESU_GRAPHQL_HTTP_ENABLED=true`",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/779926873/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/779933133",
    "html_url": "https://github.com/hyperledger/besu/issues/1913#issuecomment-779933133",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1913",
    "id": 779933133,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3OTkzMzEzMw==",
    "user": {
      "login": "3nprob",
      "id": 74199244,
      "node_id": "MDQ6VXNlcjc0MTk5MjQ0",
      "avatar_url": "https://avatars.githubusercontent.com/u/74199244?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/3nprob",
      "html_url": "https://github.com/3nprob",
      "followers_url": "https://api.github.com/users/3nprob/followers",
      "following_url": "https://api.github.com/users/3nprob/following{/other_user}",
      "gists_url": "https://api.github.com/users/3nprob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/3nprob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/3nprob/subscriptions",
      "organizations_url": "https://api.github.com/users/3nprob/orgs",
      "repos_url": "https://api.github.com/users/3nprob/repos",
      "events_url": "https://api.github.com/users/3nprob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/3nprob/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-16T16:00:42Z",
    "updated_at": "2021-02-16T16:00:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks @shemnon , that was it for the RPC :flushed: \r\n\r\nThe DeleteRangeCF error seems related to pruning - it disappears if I disable pruning, so seems like that's not functional.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/779933133/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/779943388",
    "html_url": "https://github.com/hyperledger/besu/issues/1913#issuecomment-779943388",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1913",
    "id": 779943388,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3OTk0MzM4OA==",
    "user": {
      "login": "shemnon",
      "id": 38109,
      "node_id": "MDQ6VXNlcjM4MTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shemnon",
      "html_url": "https://github.com/shemnon",
      "followers_url": "https://api.github.com/users/shemnon/followers",
      "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
      "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
      "organizations_url": "https://api.github.com/users/shemnon/orgs",
      "repos_url": "https://api.github.com/users/shemnon/repos",
      "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shemnon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-16T16:14:59Z",
    "updated_at": "2021-02-16T16:14:59Z",
    "author_association": "MEMBER",
    "body": "I've flagged it internally.  It's curious because all our local pruning nodes never complained.  Seems to be related to column families.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/779943388/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/779944225",
    "html_url": "https://github.com/hyperledger/besu/issues/1913#issuecomment-779944225",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1913",
    "id": 779944225,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3OTk0NDIyNQ==",
    "user": {
      "login": "3nprob",
      "id": 74199244,
      "node_id": "MDQ6VXNlcjc0MTk5MjQ0",
      "avatar_url": "https://avatars.githubusercontent.com/u/74199244?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/3nprob",
      "html_url": "https://github.com/3nprob",
      "followers_url": "https://api.github.com/users/3nprob/followers",
      "following_url": "https://api.github.com/users/3nprob/following{/other_user}",
      "gists_url": "https://api.github.com/users/3nprob/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/3nprob/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/3nprob/subscriptions",
      "organizations_url": "https://api.github.com/users/3nprob/orgs",
      "repos_url": "https://api.github.com/users/3nprob/repos",
      "events_url": "https://api.github.com/users/3nprob/events{/privacy}",
      "received_events_url": "https://api.github.com/users/3nprob/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-16T16:16:13Z",
    "updated_at": "2021-02-16T16:16:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "Let me know if there's anything I can do to help with debugging. For the time being I have the space to spare so I'll keep it running like this. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/779944225/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/801082422",
    "html_url": "https://github.com/hyperledger/besu/issues/1913#issuecomment-801082422",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1913",
    "id": 801082422,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwMTA4MjQyMg==",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-17T13:31:40Z",
    "updated_at": "2021-03-17T13:52:25Z",
    "author_association": "NONE",
    "body": "Started a fresh mainnet full sync on v21.1.2 (official docker image) with `--pruning-enabled=true` and `--sync-mode=FULL`, same error after the first 1000 blocks:\r\n\r\n```\r\neth1_1    | 2021-03-17 13:28:51.135+00:00 | EthScheduler-Services-5 (importBlock) | INFO  | FullImportBlockStep | Import reached block 1000 (0x5b45..5d58), - Mg/s, Peers: 4\r\neth1_1    | 2021-03-17 13:28:54.782+00:00 | EthScheduler-Services-5 (importBlock) | INFO  | Pruner | Begin sweeping unused nodes for pruning. Keeping full state for blocks 1 to 1025\r\neth1_1    | 2021-03-17 13:28:55.143+00:00 | StatePruning-2 | ERROR | Besu | Uncaught exception in thread \"StatePruning-2\"\r\neth1_1    | org.hyperledger.besu.plugin.services.exception.StorageException: org.rocksdb.RocksDBException: DeleteRangeCF not implemented\r\neth1_1    |     at org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.clear(RocksDBColumnarKeyValueStorage.java:211)\r\neth1_1    |     at org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.clear(RocksDBColumnarKeyValueStorage.java:62)\r\neth1_1    |     at org.hyperledger.besu.services.kvstore.SegmentedKeyValueStorageAdapter.clear(SegmentedKeyValueStorageAdapter.java:40)\r\neth1_1    |     at org.hyperledger.besu.ethereum.worldstate.MarkSweepPruner.clearMarks(MarkSweepPruner.java:229)\r\neth1_1    |     at org.hyperledger.besu.ethereum.worldstate.MarkSweepPruner.sweepBefore(MarkSweepPruner.java:219)\r\neth1_1    |     at org.hyperledger.besu.ethereum.worldstate.Pruner.lambda$sweep$2(Pruner.java:159)\r\neth1_1    |     at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\r\neth1_1    |     at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\r\neth1_1    |     at java.base/java.lang.Thread.run(Unknown Source)\r\neth1_1    | Caused by: org.rocksdb.RocksDBException: DeleteRangeCF not implemented\r\neth1_1    |     at org.rocksdb.RocksDB.deleteRange(Native Method)\r\neth1_1    |     at org.rocksdb.RocksDB.deleteRange(RocksDB.java:1493)\r\neth1_1    |     at org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.clear(RocksDBColumnarKeyValueStorage.java:206)\r\neth1_1    |     ... 8 more\r\neth1_1    | 2021-03-17 13:28:55.366+00:00 | EthScheduler-Services-5 (importBlock) | INFO  | FullImportBlockStep | Import reached block 1200 (0x838b..b869), - Mg/s, Peers: 4\r\n```\r\n\r\nEdit: Tested with official docker image `Starting Besu version: besu/v21.1.2/linux-x86_64/oracle_openjdk-java-11` and docker source build `Starting Besu version: besu/v21.1.2/linux-x86_64/oracle_openjdk-java-14`, same exception on initial mainnet full sync with pruning for both. This should be easy to reproduce.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/801082422/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/801406057",
    "html_url": "https://github.com/hyperledger/besu/issues/1913#issuecomment-801406057",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1913",
    "id": 801406057,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwMTQwNjA1Nw==",
    "user": {
      "login": "RatanRSur",
      "id": 4733314,
      "node_id": "MDQ6VXNlcjQ3MzMzMTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4733314?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RatanRSur",
      "html_url": "https://github.com/RatanRSur",
      "followers_url": "https://api.github.com/users/RatanRSur/followers",
      "following_url": "https://api.github.com/users/RatanRSur/following{/other_user}",
      "gists_url": "https://api.github.com/users/RatanRSur/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RatanRSur/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RatanRSur/subscriptions",
      "organizations_url": "https://api.github.com/users/RatanRSur/orgs",
      "repos_url": "https://api.github.com/users/RatanRSur/repos",
      "events_url": "https://api.github.com/users/RatanRSur/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RatanRSur/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-17T20:10:45Z",
    "updated_at": "2021-03-17T20:10:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "We're working on an overhaul to how we structure our database that should make pruning like this a thing of the past. I haven't looked into this but I'm assuming this could be a zfs issue? I recommend turning pruning off for the time being.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/801406057/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/801509429",
    "html_url": "https://github.com/hyperledger/besu/issues/1913#issuecomment-801509429",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1913",
    "id": 801509429,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwMTUwOTQyOQ==",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-17T23:34:43Z",
    "updated_at": "2021-03-17T23:34:43Z",
    "author_association": "NONE",
    "body": "I can’t see this being a ZFS issue. DeleteRangeCF is a DB function isn’t it?\r\n\r\nPlus, I think I tested it on a VPS, no ZFS there. The file system is just a file system, standard Linux fare.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/801509429/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/802011391",
    "html_url": "https://github.com/hyperledger/besu/issues/1913#issuecomment-802011391",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1913",
    "id": 802011391,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwMjAxMTM5MQ==",
    "user": {
      "login": "RatanRSur",
      "id": 4733314,
      "node_id": "MDQ6VXNlcjQ3MzMzMTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4733314?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RatanRSur",
      "html_url": "https://github.com/RatanRSur",
      "followers_url": "https://api.github.com/users/RatanRSur/followers",
      "following_url": "https://api.github.com/users/RatanRSur/following{/other_user}",
      "gists_url": "https://api.github.com/users/RatanRSur/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RatanRSur/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RatanRSur/subscriptions",
      "organizations_url": "https://api.github.com/users/RatanRSur/orgs",
      "repos_url": "https://api.github.com/users/RatanRSur/repos",
      "events_url": "https://api.github.com/users/RatanRSur/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RatanRSur/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-18T15:16:21Z",
    "updated_at": "2021-03-18T15:16:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "Perhaps you're right but I jumped to that being the likely case since delete range has never given us issues and it sounds like it might be because there's some non-standard call that perhaps zfs doesn't implement so rocksdb then says it's not implemented. Again, perhaps you're right but since our new Bonsai Tries database format is our main focus right now, there might not be a fix to this until that becomes production ready.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/802011391/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/874131069",
    "html_url": "https://github.com/hyperledger/besu/issues/1913#issuecomment-874131069",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1913",
    "id": 874131069,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg3NDEzMTA2OQ==",
    "user": {
      "login": "jondoe1337",
      "id": 768498,
      "node_id": "MDQ6VXNlcjc2ODQ5OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/768498?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jondoe1337",
      "html_url": "https://github.com/jondoe1337",
      "followers_url": "https://api.github.com/users/jondoe1337/followers",
      "following_url": "https://api.github.com/users/jondoe1337/following{/other_user}",
      "gists_url": "https://api.github.com/users/jondoe1337/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jondoe1337/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jondoe1337/subscriptions",
      "organizations_url": "https://api.github.com/users/jondoe1337/orgs",
      "repos_url": "https://api.github.com/users/jondoe1337/repos",
      "events_url": "https://api.github.com/users/jondoe1337/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jondoe1337/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-05T13:52:52Z",
    "updated_at": "2021-07-05T13:52:52Z",
    "author_association": "NONE",
    "body": "Same problem here with:\r\n```\r\n      - \"--sync-mode=FAST\"\r\n      - \"--pruning-enabled=true\"\r\n      - \"--pruning-blocks-retained=1024\"\r\n```\r\n\r\nResulting during startup with:\r\n```\r\n2021-07-05 12:10:30.342+00:00 | StatePruning-0 | INFO  | Pruner | Starting Pruner.\r\n2021-07-05 12:10:30.342+00:00 | main | INFO  | FullSyncDownloader | Starting full sync.\r\n2021-07-05 12:10:30.360+00:00 | main | INFO  | FullSyncTargetManager | No sync target, waiting for peers: 0\r\n2021-07-05 12:10:30.397+00:00 | main | INFO  | JsonRpcHttpService | Starting JSON-RPC service on 0.0.0.0:8545\r\n2021-07-05 12:10:30.387+00:00 | StatePruning-0 | ERROR | Besu | Uncaught exception in thread \"StatePruning-0\"\r\norg.hyperledger.besu.plugin.services.exception.StorageException: org.rocksdb.RocksDBException: DeleteRangeCF not implemented\r\n\tat org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.clear(RocksDBColumnarKeyValueStorage.java:211)\r\n\tat org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.clear(RocksDBColumnarKeyValueStorage.java:62)\r\n\tat org.hyperledger.besu.services.kvstore.SegmentedKeyValueStorageAdapter.clear(SegmentedKeyValueStorageAdapter.java:40)\r\n\tat org.hyperledger.besu.ethereum.worldstate.MarkSweepPruner.clearMarks(MarkSweepPruner.java:229)\r\n\tat org.hyperledger.besu.ethereum.worldstate.MarkSweepPruner.prepare(MarkSweepPruner.java:124)\r\n\tat org.hyperledger.besu.ethereum.worldstate.Pruner.lambda$start$0(Pruner.java:97)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)\r\n\tat java.base/java.lang.Thread.run(Unknown Source)\r\nCaused by: org.rocksdb.RocksDBException: DeleteRangeCF not implemented\r\n\tat org.rocksdb.RocksDB.deleteRange(Native Method)\r\n\tat org.rocksdb.RocksDB.deleteRange(RocksDB.java:1493)\r\n\tat org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.clear(RocksDBColumnarKeyValueStorage.java:206)\r\n\t... 8 more\r\n```\r\n\r\nThe node was previously configured with 2048 retained blocks, reduced that to 1024.\r\n\r\nThe disk usage is still 1.4TB - obviously the pruning does not work at all!? 🤔 ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/874131069/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/919717661",
    "html_url": "https://github.com/hyperledger/besu/issues/1913#issuecomment-919717661",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1913",
    "id": 919717661,
    "node_id": "IC_kwDODE2jmc420ccd",
    "user": {
      "login": "jcodic",
      "id": 68349218,
      "node_id": "MDQ6VXNlcjY4MzQ5MjE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/68349218?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jcodic",
      "html_url": "https://github.com/jcodic",
      "followers_url": "https://api.github.com/users/jcodic/followers",
      "following_url": "https://api.github.com/users/jcodic/following{/other_user}",
      "gists_url": "https://api.github.com/users/jcodic/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jcodic/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jcodic/subscriptions",
      "organizations_url": "https://api.github.com/users/jcodic/orgs",
      "repos_url": "https://api.github.com/users/jcodic/repos",
      "events_url": "https://api.github.com/users/jcodic/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jcodic/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-15T05:44:06Z",
    "updated_at": "2021-09-15T05:44:06Z",
    "author_association": "NONE",
    "body": "Build from source v 21.7.3.\r\n--network=mainnet --sync-mode=FAST --pruning-enabled=true\r\nGet same error always when restarting besu.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/919717661/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1404811215",
    "html_url": "https://github.com/hyperledger/besu/issues/1913#issuecomment-1404811215",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1913",
    "id": 1404811215,
    "node_id": "IC_kwDODE2jmc5Tu7fP",
    "user": {
      "login": "non-fungible-nelson",
      "id": 85905982,
      "node_id": "MDQ6VXNlcjg1OTA1OTgy",
      "avatar_url": "https://avatars.githubusercontent.com/u/85905982?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/non-fungible-nelson",
      "html_url": "https://github.com/non-fungible-nelson",
      "followers_url": "https://api.github.com/users/non-fungible-nelson/followers",
      "following_url": "https://api.github.com/users/non-fungible-nelson/following{/other_user}",
      "gists_url": "https://api.github.com/users/non-fungible-nelson/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/non-fungible-nelson/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/non-fungible-nelson/subscriptions",
      "organizations_url": "https://api.github.com/users/non-fungible-nelson/orgs",
      "repos_url": "https://api.github.com/users/non-fungible-nelson/repos",
      "events_url": "https://api.github.com/users/non-fungible-nelson/events{/privacy}",
      "received_events_url": "https://api.github.com/users/non-fungible-nelson/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-26T10:29:03Z",
    "updated_at": "2023-01-26T10:29:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing due to bonsai ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1404811215/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
