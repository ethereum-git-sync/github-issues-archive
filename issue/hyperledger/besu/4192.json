{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/4192",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/4192/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/4192/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/4192/events",
  "html_url": "https://github.com/hyperledger/besu/issues/4192",
  "id": 1321031514,
  "node_id": "I_kwDODE2jmc5OvVda",
  "number": 4192,
  "title": "Race condition in `JsonRpcExecutor`",
  "user": {
    "login": "Dzejkop",
    "id": 5088647,
    "node_id": "MDQ6VXNlcjUwODg2NDc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5088647?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Dzejkop",
    "html_url": "https://github.com/Dzejkop",
    "followers_url": "https://api.github.com/users/Dzejkop/followers",
    "following_url": "https://api.github.com/users/Dzejkop/following{/other_user}",
    "gists_url": "https://api.github.com/users/Dzejkop/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Dzejkop/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Dzejkop/subscriptions",
    "organizations_url": "https://api.github.com/users/Dzejkop/orgs",
    "repos_url": "https://api.github.com/users/Dzejkop/repos",
    "events_url": "https://api.github.com/users/Dzejkop/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Dzejkop/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 2051684044,
      "node_id": "MDU6TGFiZWwyMDUxNjg0MDQ0",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/P4",
      "name": "P4",
      "color": "ccff33",
      "default": false,
      "description": "Low (ex: Node doesn't start up when the configuration file has unexpected \"end-of-line\" character)"
    },
    {
      "id": 2152224197,
      "node_id": "MDU6TGFiZWwyMTUyMjI0MTk3",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamRevenant",
      "name": "TeamRevenant",
      "color": "78e298",
      "default": false,
      "description": "GH issues worked on by Revenant Team"
    },
    {
      "id": 4609582991,
      "node_id": "LA_kwDODE2jmc8AAAABEsCnjw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/RPC",
      "name": "RPC",
      "color": "1d76db",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "macfarla",
    "id": 2627919,
    "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/macfarla",
    "html_url": "https://github.com/macfarla",
    "followers_url": "https://api.github.com/users/macfarla/followers",
    "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
    "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
    "organizations_url": "https://api.github.com/users/macfarla/orgs",
    "repos_url": "https://api.github.com/users/macfarla/repos",
    "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
    "received_events_url": "https://api.github.com/users/macfarla/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2022-07-28T14:35:33Z",
  "updated_at": "2023-01-16T04:33:38Z",
  "closed_at": "2023-01-16T04:33:38Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!-- Have you done the following? -->\r\n<!--   * read the Code of Conduct? By filing an Issue, you are expected to -->  \r\n<!--     comply with it, including treating everyone with respect: -->\r\n<!--     https://github.com/hyperledger/besu/blob/main/CODE_OF_CONDUCT.md -->\r\n<!--   * Reproduced the issue in the latest version of the software -->\r\n<!--   * Read the debugging docs: https://besu.hyperledger.org/en/stable/HowTo/Monitor/Logging/ -->\r\n<!--   * Duplicate Issue check:  https://github.com/search?q=+is%3Aissue+repo%3Ahyperledger/Besu -->\r\n<!-- Note:  Not all sections will apply to all issue types. -->\r\n\r\n### Description\r\nWe started noticing that when we're frequently using the `eth_call` method, every now and then it would fail unexpectedly with the `Block not found` error.\r\n\r\nAfter observing the logs I believe the issue is a race condition:\r\n\r\nLogs from the time the error occured:\r\n```\r\n2022-07-28 13:39:11.899+00:00 | vert.x-worker-thread-15 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_call [{to=0xd0f52767c5d2d3a5a1b5de558dc673ad35a4b7e8, data=0x003e36bf000000000000000000000000d0584d4d37157f7105a4b41ed8ecbdfafdb2547f}, latest]\r\n2022-07-28 13:39:11.901+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:11.901+00:00 | vert.x-worker-thread-14 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_call [{to=0xd0f52767c5d2d3a5a1b5de558dc673ad35a4b7e8, data=0x6adb038b}, latest]\r\n2022-07-28 13:39:11.951+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:11.952+00:00 | vert.x-worker-thread-16 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_blockNumber []\r\n2022-07-28 13:39:12.001+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | IbftRound | Creating proposed block. round=ConsensusRoundIdentifier{Sequence=862, Round=0}\r\n2022-07-28 13:39:12.002+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:12.003+00:00 | vert.x-worker-thread-2 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_call [{to=0xd0f52767c5d2d3a5a1b5de558dc673ad35a4b7e8, data=0x003e36bf000000000000000000000000d0584d4d37157f7105a4b41ed8ecbdfafdb2547f}, latest]\r\n2022-07-28 13:39:12.005+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | IbftRound | Sending commit message. round=ConsensusRoundIdentifier{Sequence=862, Round=0}\r\n2022-07-28 13:39:12.006+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:12.006+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | IbftRound | Importing block to chain. round=ConsensusRoundIdentifier{Sequence=862, Round=0}, hash=0x402c2dad739593c3dd5a6efc5f051c1bdf6ab1eaef0240da42cb222652155e0f\r\n2022-07-28 13:39:12.007+00:00 | vert.x-worker-thread-17 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_call [{to=0xd0f52767c5d2d3a5a1b5de558dc673ad35a4b7e8, data=0x6adb038b}, latest]\r\n2022-07-28 13:39:12.008+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | TransactionLogBloomCacher | Caching logs bloom for block 0x35e.\r\n2022-07-28 13:39:12.009+00:00 | BftProcessorExecutor-IBFT-0 | INFO  | IbftBesuControllerBuilder | Produced #862 / 0 tx / 0 pending / 0 (0.0%) gas / (0x402c2dad739593c3dd5a6efc5f051c1bdf6ab1eaef0240da42cb222652155e0f)\r\n2022-07-28 13:39:12.009+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | BaseBftController | New chain head detected (block number=862), currently mining on top of 861.\r\n2022-07-28 13:39:12.056+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:12.056+00:00 | vert.x-worker-thread-19 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_blockNumber []\r\n```\r\n\r\nLogs from other calls to `eth_call` that didn't fail:\r\n```\r\n2022-07-28 13:39:10.975+00:00 | vert.x-worker-thread-5 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_call [{to=0xd0f52767c5d2d3a5a1b5de558dc673ad35a4b7e8, data=0x003e36bf000000000000000000000000d0584d4d37157f7105a4b41ed8ecbdfafdb2547f}, latest]\r\n2022-07-28 13:39:10.984+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:10.986+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:10.987+00:00 | vert.x-worker-thread-7 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_blockNumber []\r\n2022-07-28 13:39:10.987+00:00 | vert.x-worker-thread-7 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_call [{to=0xd0f52767c5d2d3a5a1b5de558dc673ad35a4b7e8, data=0x6adb038b}, latest]\r\n2022-07-28 13:39:11.004+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | IbftRound | Creating proposed block. round=ConsensusRoundIdentifier{Sequence=861, Round=0}\r\n2022-07-28 13:39:11.007+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | IbftRound | Sending commit message. round=ConsensusRoundIdentifier{Sequence=861, Round=0}\r\n2022-07-28 13:39:11.009+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | IbftRound | Importing block to chain. round=ConsensusRoundIdentifier{Sequence=861, Round=0}, hash=0x9776c29ee0d9c5656f01f487b3e44c3f8bf329af4a827950cff34738a23a9c23\r\n2022-07-28 13:39:11.011+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | TransactionLogBloomCacher | Caching logs bloom for block 0x35d.\r\n2022-07-28 13:39:11.012+00:00 | BftProcessorExecutor-IBFT-0 | INFO  | IbftBesuControllerBuilder | Produced #861 / 0 tx / 0 pending / 0 (0.0%) gas / (0x9776c29ee0d9c5656f01f487b3e44c3f8bf329af4a827950cff34738a23a9c23)\r\n2022-07-28 13:39:11.012+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | BaseBftController | New chain head detected (block number=861), currently mining on top of 860.\r\n2022-07-28 13:39:11.078+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:11.078+00:00 | vert.x-worker-thread-9 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_call [{to=0xd0f52767c5d2d3a5a1b5de558dc673ad35a4b7e8, data=0x003e36bf000000000000000000000000d0584d4d37157f7105a4b41ed8ecbdfafdb2547f}, latest]\r\n2022-07-28 13:39:11.089+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:11.090+00:00 | vert.x-worker-thread-8 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_call [{to=0xd0f52767c5d2d3a5a1b5de558dc673ad35a4b7e8, data=0x6adb038b}, latest]\r\n```\r\n\r\n```\r\n2022-07-28 13:39:12.900+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:12.900+00:00 | vert.x-worker-thread-7 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_blockNumber []\r\n2022-07-28 13:39:12.930+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:12.931+00:00 | vert.x-worker-thread-4 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_call [{to=0xd0f52767c5d2d3a5a1b5de558dc673ad35a4b7e8, data=0x003e36bf000000000000000000000000d0584d4d37157f7105a4b41ed8ecbdfafdb2547f}, latest]\r\n2022-07-28 13:39:12.932+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:12.933+00:00 | vert.x-worker-thread-9 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_call [{to=0xd0f52767c5d2d3a5a1b5de558dc673ad35a4b7e8, data=0x6adb038b}, latest]\r\n2022-07-28 13:39:13.007+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | IbftRound | Creating proposed block. round=ConsensusRoundIdentifier{Sequence=863, Round=0}\r\n2022-07-28 13:39:13.011+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | IbftRound | Sending commit message. round=ConsensusRoundIdentifier{Sequence=863, Round=0}\r\n2022-07-28 13:39:13.013+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | IbftRound | Importing block to chain. round=ConsensusRoundIdentifier{Sequence=863, Round=0}, hash=0x821cee9098df3b642949b04ae0e9bd38f65d8098a0ab27db202fecbb15eb1755\r\n2022-07-28 13:39:13.015+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | TransactionLogBloomCacher | Caching logs bloom for block 0x35f.\r\n2022-07-28 13:39:13.015+00:00 | BftProcessorExecutor-IBFT-0 | INFO  | IbftBesuControllerBuilder | Produced #863 / 0 tx / 0 pending / 0 (0.0%) gas / (0x821cee9098df3b642949b04ae0e9bd38f65d8098a0ab27db202fecbb15eb1755)\r\n2022-07-28 13:39:13.015+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | BaseBftController | New chain head detected (block number=863), currently mining on top of 862.\r\n2022-07-28 13:39:13.017+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:13.018+00:00 | vert.x-worker-thread-8 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_blockNumber []\r\n2022-07-28 13:39:13.021+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:13.021+00:00 | vert.x-worker-thread-10 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_getLogs [{fromBlock=0x35e, toBlock=0x35e, address=0xd0f52767c5d2d3a5a1b5de558dc673ad35a4b7e8, topics=[[0x9d5e3328d970a5c6148e8517851833559e79a94a9e23c376e4fee239d22b0bd1, 0x0c8c078f4dd07dbcb3760ab8ea213e22ae0a6f5131ac172980591d05e85ea41c, 0x274b9db18c1fe5545e1e46c41c24276caa16ea2666000637ed1d9517adcec0dc, 0x953e2be1a971fbc42605a647cf3cfe0ddfeb9ee42a202c2d78d3b24d7a3e1d15]]}]\r\n2022-07-28 13:39:13.023+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:13.023+00:00 | vert.x-worker-thread-13 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_blockNumber []\r\n2022-07-28 13:39:13.035+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n```\r\n\r\n```\r\n2022-07-28 13:39:13.860+00:00 | vert.x-worker-thread-14 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_call [{to=0xd0f52767c5d2d3a5a1b5de558dc673ad35a4b7e8, data=0x6adb038b}, latest]\r\n2022-07-28 13:39:13.904+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:13.904+00:00 | vert.x-worker-thread-16 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_blockNumber []\r\n2022-07-28 13:39:13.960+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:13.961+00:00 | vert.x-worker-thread-2 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_call [{to=0xd0f52767c5d2d3a5a1b5de558dc673ad35a4b7e8, data=0x003e36bf000000000000000000000000d0584d4d37157f7105a4b41ed8ecbdfafdb2547f}, latest]\r\n2022-07-28 13:39:13.962+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:13.963+00:00 | vert.x-worker-thread-18 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_call [{to=0xd0f52767c5d2d3a5a1b5de558dc673ad35a4b7e8, data=0x6adb038b}, latest]\r\n2022-07-28 13:39:14.002+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | IbftRound | Creating proposed block. round=ConsensusRoundIdentifier{Sequence=864, Round=0}\r\n2022-07-28 13:39:14.003+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | IbftRound | Sending commit message. round=ConsensusRoundIdentifier{Sequence=864, Round=0}\r\n2022-07-28 13:39:14.004+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | IbftRound | Importing block to chain. round=ConsensusRoundIdentifier{Sequence=864, Round=0}, hash=0xdecd60ebd89319caddabae991d531a5968f3630b2c07017cd553bee7be31b7c2\r\n2022-07-28 13:39:14.005+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | TransactionLogBloomCacher | Caching logs bloom for block 0x360.\r\n2022-07-28 13:39:14.005+00:00 | BftProcessorExecutor-IBFT-0 | INFO  | IbftBesuControllerBuilder | Produced #864 / 0 tx / 0 pending / 0 (0.0%) gas / (0xdecd60ebd89319caddabae991d531a5968f3630b2c07017cd553bee7be31b7c2)\r\n2022-07-28 13:39:14.005+00:00 | BftProcessorExecutor-IBFT-0 | DEBUG | BaseBftController | New chain head detected (block number=864), currently mining on top of 863.\r\n2022-07-28 13:39:14.007+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:14.007+00:00 | vert.x-worker-thread-19 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_blockNumber []\r\n2022-07-28 13:39:14.008+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:14.009+00:00 | vert.x-worker-thread-0 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_getLogs [{fromBlock=0x35f, toBlock=0x35f, address=0xd0f52767c5d2d3a5a1b5de558dc673ad35a4b7e8, topics=[[0x9d5e3328d970a5c6148e8517851833559e79a94a9e23c376e4fee239d22b0bd1, 0x0c8c078f4dd07dbcb3760ab8ea213e22ae0a6f5131ac172980591d05e85ea41c, 0x274b9db18c1fe5545e1e46c41c24276caa16ea2666000637ed1d9517adcec0dc, 0x953e2be1a971fbc42605a647cf3cfe0ddfeb9ee42a202c2d78d3b24d7a3e1d15]]}]\r\n2022-07-28 13:39:14.010+00:00 | vert.x-eventloop-thread-1 | DEBUG | B3PropagatorExtractorMultipleHeaders | Invalid TraceId in B3 header: null'. Returning INVALID span context.\r\n2022-07-28 13:39:14.010+00:00 | vert.x-worker-thread-1 | DEBUG | JsonRpcExecutor | JSON-RPC request -> eth_blockNumber []\r\n```\r\n\r\nthe fact that the error case has `BftProcessorExecutor` logs mixed with `JsonRpcExecutor` makes me believe that some sort of race condition is occuring, but that's all I was able to figure out.\r\n\r\n### Steps to Reproduce (Bug)\r\n1. Start up Besu\r\n2. Frequently call `eth_call` with with any smart contract method\r\n\r\n**Expected behavior:**\r\nNo errors\r\n\r\n**Actual behavior:**\r\nBesu returns `Block not found`\r\n\r\n**Frequency:**\r\nWe saw it occuring say after 2 or so minutes of running our software.\r\n\r\n### Versions\r\nDocker image labels:\r\n```\r\n\"org.label-schema.build-date\": \"2022-07-13T11:08Z\",\r\n\"org.label-schema.description\": \"Enterprise Ethereum client\",\r\n\"org.label-schema.name\": \"Besu\",\r\n\"org.label-schema.schema-version\": \"1.0\",\r\n\"org.label-schema.url\": \"https://besu.hyperledger.org/\",\r\n\"org.label-schema.vcs-ref\": \"b85b39d3\",\r\n\"org.label-schema.vcs-url\": \"https://github.com/hyperledger/besu.git\",\r\n\"org.label-schema.vendor\": \"Hyperledger\",\r\n\"org.label-schema.version\": \"22.7.0-RC2-SNAPSHOT\"\r\n```\r\n\r\n\r\n* Software version: `22.7.0-RC2-SNAPSHOT`\r\nWe observed this issue on M1 MacBooks and also on our CI - which last time I checked was running various generations of Intel Xeon.",
  "closed_by": {
    "login": "macfarla",
    "id": 2627919,
    "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/macfarla",
    "html_url": "https://github.com/macfarla",
    "followers_url": "https://api.github.com/users/macfarla/followers",
    "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
    "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
    "organizations_url": "https://api.github.com/users/macfarla/orgs",
    "repos_url": "https://api.github.com/users/macfarla/repos",
    "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
    "received_events_url": "https://api.github.com/users/macfarla/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/4192/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/4192/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1204040181",
    "html_url": "https://github.com/hyperledger/besu/issues/4192#issuecomment-1204040181",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4192",
    "id": 1204040181,
    "node_id": "IC_kwDODE2jmc5HxDH1",
    "user": {
      "login": "samsondav",
      "id": 4147639,
      "node_id": "MDQ6VXNlcjQxNDc2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4147639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/samsondav",
      "html_url": "https://github.com/samsondav",
      "followers_url": "https://api.github.com/users/samsondav/followers",
      "following_url": "https://api.github.com/users/samsondav/following{/other_user}",
      "gists_url": "https://api.github.com/users/samsondav/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/samsondav/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/samsondav/subscriptions",
      "organizations_url": "https://api.github.com/users/samsondav/orgs",
      "repos_url": "https://api.github.com/users/samsondav/repos",
      "events_url": "https://api.github.com/users/samsondav/events{/privacy}",
      "received_events_url": "https://api.github.com/users/samsondav/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-03T14:40:27Z",
    "updated_at": "2022-08-03T14:45:14Z",
    "author_association": "NONE",
    "body": "We are also seeing this bug, it's a blocker for us to use Chainlink with Besu. We need reliable RPC calls.\r\n\r\nOne example RPC call that triggered it:\r\n\r\n```\r\ncurl -v --data '{\"method\":\"eth_call\",\"id\":\"1\",\"params\":[{\"from\": \"0x0000000000000000000000000000000000000000\", \"to\": \"0x4c0ce02c1219ce5d2afffba97e484272a4637b49\", \"gas\": 9800000, \"data\":\"c41b813a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000084b90895ef775e63adfc50a4e15b5beea08c0b7f\"}, \"latest\"],\"jsonrpc\":\"2.0\"}' -H \"Content-Type: application/json\" -X POST http://besu-rpc-goerli.example.com\r\n```\r\n\r\nNote that this usually returns the correct payload:\r\n\r\n```\r\n{\r\n  \"jsonrpc\": \"2.0\",\r\n  \"id\": \"1\",\r\n  \"error\": {\r\n    \"code\": -32000,\r\n    \"message\": \"Execution reverted\",\r\n    \"data\": \"0x08c379a00000000000000000000000000000000000000000000000000000000000000020000000000000000000000000000000000000000000000000000000000000001175706b656570206e6f74206e6565646564000000000000000000000000000000\"\r\n  }\r\n}\r\n```\r\n\r\nBut, sometimes it instead returns `\"Block not found\"` error as detailed in the OP.\r\n\r\nThe problem is **intermittent**.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1204040181/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1208385053",
    "html_url": "https://github.com/hyperledger/besu/issues/4192#issuecomment-1208385053",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4192",
    "id": 1208385053,
    "node_id": "IC_kwDODE2jmc5IBn4d",
    "user": {
      "login": "jflo",
      "id": 345937,
      "node_id": "MDQ6VXNlcjM0NTkzNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/345937?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jflo",
      "html_url": "https://github.com/jflo",
      "followers_url": "https://api.github.com/users/jflo/followers",
      "following_url": "https://api.github.com/users/jflo/following{/other_user}",
      "gists_url": "https://api.github.com/users/jflo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jflo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jflo/subscriptions",
      "organizations_url": "https://api.github.com/users/jflo/orgs",
      "repos_url": "https://api.github.com/users/jflo/repos",
      "events_url": "https://api.github.com/users/jflo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jflo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-08T17:09:16Z",
    "updated_at": "2022-08-08T17:09:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "@samsondav I am assuming this was found on goerli based on the domain in your curl command. Is that true?  If so how frequently and how long did you loop this statement to create the \"Block not found\" error. I have not yet been able to reproduce it.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1208385053/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1302763308",
    "html_url": "https://github.com/hyperledger/besu/issues/4192#issuecomment-1302763308",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4192",
    "id": 1302763308,
    "node_id": "IC_kwDODE2jmc5Nppcs",
    "user": {
      "login": "iamhsk",
      "id": 2249367,
      "node_id": "MDQ6VXNlcjIyNDkzNjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2249367?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iamhsk",
      "html_url": "https://github.com/iamhsk",
      "followers_url": "https://api.github.com/users/iamhsk/followers",
      "following_url": "https://api.github.com/users/iamhsk/following{/other_user}",
      "gists_url": "https://api.github.com/users/iamhsk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iamhsk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iamhsk/subscriptions",
      "organizations_url": "https://api.github.com/users/iamhsk/orgs",
      "repos_url": "https://api.github.com/users/iamhsk/repos",
      "events_url": "https://api.github.com/users/iamhsk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iamhsk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-03T22:47:52Z",
    "updated_at": "2022-11-03T22:47:52Z",
    "author_association": "NONE",
    "body": "@samsondav, checking in again. Are you still seeing the error? If yes, we would love to help investigate the issue. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1302763308/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1306920592",
    "html_url": "https://github.com/hyperledger/besu/issues/4192#issuecomment-1306920592",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4192",
    "id": 1306920592,
    "node_id": "IC_kwDODE2jmc5N5gaQ",
    "user": {
      "login": "citizen-stig",
      "id": 3115300,
      "node_id": "MDQ6VXNlcjMxMTUzMDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3115300?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/citizen-stig",
      "html_url": "https://github.com/citizen-stig",
      "followers_url": "https://api.github.com/users/citizen-stig/followers",
      "following_url": "https://api.github.com/users/citizen-stig/following{/other_user}",
      "gists_url": "https://api.github.com/users/citizen-stig/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/citizen-stig/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/citizen-stig/subscriptions",
      "organizations_url": "https://api.github.com/users/citizen-stig/orgs",
      "repos_url": "https://api.github.com/users/citizen-stig/repos",
      "events_url": "https://api.github.com/users/citizen-stig/events{/privacy}",
      "received_events_url": "https://api.github.com/users/citizen-stig/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-08T09:44:46Z",
    "updated_at": "2022-11-08T09:45:25Z",
    "author_association": "NONE",
    "body": "@samsondav , We still have this bug in our private QBFT deployment",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1306920592/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1363561947",
    "html_url": "https://github.com/hyperledger/besu/issues/4192#issuecomment-1363561947",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4192",
    "id": 1363561947,
    "node_id": "IC_kwDODE2jmc5RRk3b",
    "user": {
      "login": "massun-onibakuchi",
      "id": 49754494,
      "node_id": "MDQ6VXNlcjQ5NzU0NDk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/49754494?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/massun-onibakuchi",
      "html_url": "https://github.com/massun-onibakuchi",
      "followers_url": "https://api.github.com/users/massun-onibakuchi/followers",
      "following_url": "https://api.github.com/users/massun-onibakuchi/following{/other_user}",
      "gists_url": "https://api.github.com/users/massun-onibakuchi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/massun-onibakuchi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/massun-onibakuchi/subscriptions",
      "organizations_url": "https://api.github.com/users/massun-onibakuchi/orgs",
      "repos_url": "https://api.github.com/users/massun-onibakuchi/repos",
      "events_url": "https://api.github.com/users/massun-onibakuchi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/massun-onibakuchi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-23T02:54:08Z",
    "updated_at": "2022-12-23T02:54:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "same issue here.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1363561947/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1363564792",
    "html_url": "https://github.com/hyperledger/besu/issues/4192#issuecomment-1363564792",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4192",
    "id": 1363564792,
    "node_id": "IC_kwDODE2jmc5RRlj4",
    "user": {
      "login": "massun-onibakuchi",
      "id": 49754494,
      "node_id": "MDQ6VXNlcjQ5NzU0NDk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/49754494?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/massun-onibakuchi",
      "html_url": "https://github.com/massun-onibakuchi",
      "followers_url": "https://api.github.com/users/massun-onibakuchi/followers",
      "following_url": "https://api.github.com/users/massun-onibakuchi/following{/other_user}",
      "gists_url": "https://api.github.com/users/massun-onibakuchi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/massun-onibakuchi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/massun-onibakuchi/subscriptions",
      "organizations_url": "https://api.github.com/users/massun-onibakuchi/orgs",
      "repos_url": "https://api.github.com/users/massun-onibakuchi/repos",
      "events_url": "https://api.github.com/users/massun-onibakuchi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/massun-onibakuchi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-23T03:01:29Z",
    "updated_at": "2022-12-23T06:22:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "I use Besu and call `eth_call` with ethersjs. besu version : `besu-22.10.2`\r\nI run Besu on EC2 instance and call from another EC2 instance.\r\n\r\n### Error\r\nsomething like this.\r\n```\r\n\"error\\\\\\\" : {\\\\n    \\\\\\\"code\\\\\\\" : -32000,\\\\n    \\\\\\\"message\\\\\\\" : \\\\\\\"Block not found\\\\\\\"\\\\n  }\\\\n}\\\",\\\"error\\\":{\\\"code\\\":-32000},\\\"requestBody\\\":\\\"{\\\\\\\"method\\\\\\\":\\\\\\\"eth_call\\\\\\\",\\\\\\\"params\\\\\\\":[{\\\\\\\"to\\\\\\\":\\\\\\\"0x1e2f9e10d02a6b8f8f69fcbf515e75039d2ea30d\\\\\\\",\\\\\\\"data\\\\\\\":\\\\\\\"0xb4658bfb000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000001e000000000000000000000000000000000000000000000000000000000000000010000000000000000000000001d7022f5b17d2f8b695918fb48fa1089c9f854010000000000000000000000000b1ba0af832d7c05fd64161e0db78e85978e8082000000000000000000000000000000000000000000000018baaaf5637dd7aba00000000000000000000000000000000000000000000000008ac7230489e800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000a9f3a3e8eac6461d83072dbc2ae64f765b46ab3400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000063a48dc7000000000000000000000000000000000000000000000000000001853ac800b200000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000001c97d558b84456e3a943922ff6132fecd633bc4797909fe657bfd08cd82368bc1a27e01c22ea28745eaaeba45d5defcab0cdddb7ac3deac6bbed7abd3ce8218f7e\\\\\\\"},\\\\\\\"latest\\\\\\\"],\\\\\\\"id\\\\\\\":405348,\\\\\\\"jsonrpc\\\\\\\":\\\\\\\"2.0\\\\\\\"}\\\",\\\"requestMethod\\\":\\\"POST\\\",\\\"url\\\":\\\"http://54.65.214.149:8545\\\"},\r\n```\r\n### frequency\r\nsometimes I got the error 90 times when i try 420000 times.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1363564792/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1363565378",
    "html_url": "https://github.com/hyperledger/besu/issues/4192#issuecomment-1363565378",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4192",
    "id": 1363565378,
    "node_id": "IC_kwDODE2jmc5RRltC",
    "user": {
      "login": "massun-onibakuchi",
      "id": 49754494,
      "node_id": "MDQ6VXNlcjQ5NzU0NDk0",
      "avatar_url": "https://avatars.githubusercontent.com/u/49754494?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/massun-onibakuchi",
      "html_url": "https://github.com/massun-onibakuchi",
      "followers_url": "https://api.github.com/users/massun-onibakuchi/followers",
      "following_url": "https://api.github.com/users/massun-onibakuchi/following{/other_user}",
      "gists_url": "https://api.github.com/users/massun-onibakuchi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/massun-onibakuchi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/massun-onibakuchi/subscriptions",
      "organizations_url": "https://api.github.com/users/massun-onibakuchi/orgs",
      "repos_url": "https://api.github.com/users/massun-onibakuchi/repos",
      "events_url": "https://api.github.com/users/massun-onibakuchi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/massun-onibakuchi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-23T03:02:31Z",
    "updated_at": "2022-12-23T03:02:31Z",
    "author_association": "CONTRIBUTOR",
    "body": " I have not yet been able to reproduce it.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1363565378/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
