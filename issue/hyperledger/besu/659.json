{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/659",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/659/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/659/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/659/events",
  "html_url": "https://github.com/hyperledger/besu/issues/659",
  "id": 595204915,
  "node_id": "MDU6SXNzdWU1OTUyMDQ5MTU=",
  "number": 659,
  "title": "How to deploy a smartcontract on Besu - Rinkeby with truffle",
  "user": {
    "login": "Louvivien",
    "id": 43605778,
    "node_id": "MDQ6VXNlcjQzNjA1Nzc4",
    "avatar_url": "https://avatars.githubusercontent.com/u/43605778?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Louvivien",
    "html_url": "https://github.com/Louvivien",
    "followers_url": "https://api.github.com/users/Louvivien/followers",
    "following_url": "https://api.github.com/users/Louvivien/following{/other_user}",
    "gists_url": "https://api.github.com/users/Louvivien/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Louvivien/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Louvivien/subscriptions",
    "organizations_url": "https://api.github.com/users/Louvivien/orgs",
    "repos_url": "https://api.github.com/users/Louvivien/repos",
    "events_url": "https://api.github.com/users/Louvivien/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Louvivien/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2020-04-06T15:19:44Z",
  "updated_at": "2020-04-09T19:55:14Z",
  "closed_at": "2020-04-09T19:55:14Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hello, \r\n\r\n\r\nI try to deploy a smartcontract on Besu, I can deploy on a private Besu with docker and truffle and now I try to deploy my contract on Besu with Rinkeby. \r\n\r\nI start the network with this script and it works fine :\r\n`\"besu\": \"sudo docker run -p 30303:30303 --mount type=bind,source=/tmp/besu/rinkeby,target=/var/lib/besu hyperledger/besu:latest --network=rinkeby --data-path=/var/lib/besu\"`\r\n\r\nI can't find in the documentation how to migrate my smartcontract to this network.\r\nI try :\r\n`truffle migrate --reset --compile-all --network besu` but i get an error message. \r\n\r\nThis is my truffle config with the private key provided in the documentation :\r\n\r\n```\r\nconst PrivateKeyProvider = require(\"@truffle/hdwallet-provider\");\r\nconst privateKeys = [\r\n  \"0x8f2a55949038a9610f50fb23b5883af3b4ecb3c3bb792cbcefbd1542c692be63\"\r\n];\r\n\r\nconst privateKeyProvider = new PrivateKeyProvider(\r\n  privateKeys,\r\n  \"http://localhost:8545\",\r\n  0,\r\n  3\r\n);\r\n\r\nmodule.exports = {\r\n  networks: {\r\n    besu: {\r\n      provider: privateKeyProvider,\r\n      network_id: \"*\"\r\n    }\r\n  }\r\n};\r\n```\r\n\r\n\r\nDo I need to change something in the truffle config file ?\r\n\r\nThank you for your work\r\n",
  "closed_by": {
    "login": "timbeiko",
    "id": 9390255,
    "node_id": "MDQ6VXNlcjkzOTAyNTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9390255?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/timbeiko",
    "html_url": "https://github.com/timbeiko",
    "followers_url": "https://api.github.com/users/timbeiko/followers",
    "following_url": "https://api.github.com/users/timbeiko/following{/other_user}",
    "gists_url": "https://api.github.com/users/timbeiko/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/timbeiko/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/timbeiko/subscriptions",
    "organizations_url": "https://api.github.com/users/timbeiko/orgs",
    "repos_url": "https://api.github.com/users/timbeiko/repos",
    "events_url": "https://api.github.com/users/timbeiko/events{/privacy}",
    "received_events_url": "https://api.github.com/users/timbeiko/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/659/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/659/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/609918901",
    "html_url": "https://github.com/hyperledger/besu/issues/659#issuecomment-609918901",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/659",
    "id": 609918901,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwOTkxODkwMQ==",
    "user": {
      "login": "Louvivien",
      "id": 43605778,
      "node_id": "MDQ6VXNlcjQzNjA1Nzc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/43605778?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Louvivien",
      "html_url": "https://github.com/Louvivien",
      "followers_url": "https://api.github.com/users/Louvivien/followers",
      "following_url": "https://api.github.com/users/Louvivien/following{/other_user}",
      "gists_url": "https://api.github.com/users/Louvivien/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Louvivien/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Louvivien/subscriptions",
      "organizations_url": "https://api.github.com/users/Louvivien/orgs",
      "repos_url": "https://api.github.com/users/Louvivien/repos",
      "events_url": "https://api.github.com/users/Louvivien/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Louvivien/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-06T17:05:18Z",
    "updated_at": "2020-04-06T17:30:10Z",
    "author_association": "NONE",
    "body": "ok i found out part of the solution :\r\n\r\n- I changed the script to include both ports : \r\n`sudo docker run -p 8545:8545 -p 30303:30303 --mount type=bind,source=/tmp/besu/rinkeby,target=/var/lib/besu hyperledger/besu:latest --rpc-http-enabled --rpc-http-cors-origins='all' --host-whitelist='*' --network=rinkeby --data-path=/var/lib/besu`\r\n- and I have changed the privateKey for the privateKey of an account with Rinkeby faucets\r\n\r\nbut now it fails for insufficient funds :  \r\n\r\nError:  *** Deployment Failed ***\r\n\r\n```\r\n\"Migrations\" could not deploy due to insufficient funds\r\n   * Account:  0x20cEE93C127d8F35F54f56e0d28D14219Fe23919\r\n   * Balance:  0 wei\r\n   * Message:  sender doesn't have enough funds to send tx. The upfront cost is: 372936000000000 and the sender's account only has: 0\r\n   * Try:\r\n      + Using an adequately funded account\r\n      + If you are using a local Geth node, verify that your node is synced.\r\n```\r\n\r\nOn the terminal where i have started besu I see that very often, I don't know if it is important :\r\n`No peers available, wait for peer.`\r\n\r\n<img width=\"293\" alt=\"Screen Shot 2020-04-06 at 19 04 40\" src=\"https://user-images.githubusercontent.com/43605778/78585062-818a1280-7839-11ea-881f-ca3e69c1e55a.png\">\r\n\r\nWhat can I do ? \r\n\r\nThank you\r\n\r\n\r\n\r\n\r\n<img width=\"701\" alt=\"Screen Shot 2020-04-06 at 19 06 01\" src=\"https://user-images.githubusercontent.com/43605778/78585297-e5144000-7839-11ea-91da-2fcc0fb14db7.png\">\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/609918901/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/610367450",
    "html_url": "https://github.com/hyperledger/besu/issues/659#issuecomment-610367450",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/659",
    "id": 610367450,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDM2NzQ1MA==",
    "user": {
      "login": "timbeiko",
      "id": 9390255,
      "node_id": "MDQ6VXNlcjkzOTAyNTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9390255?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/timbeiko",
      "html_url": "https://github.com/timbeiko",
      "followers_url": "https://api.github.com/users/timbeiko/followers",
      "following_url": "https://api.github.com/users/timbeiko/following{/other_user}",
      "gists_url": "https://api.github.com/users/timbeiko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/timbeiko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/timbeiko/subscriptions",
      "organizations_url": "https://api.github.com/users/timbeiko/orgs",
      "repos_url": "https://api.github.com/users/timbeiko/repos",
      "events_url": "https://api.github.com/users/timbeiko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/timbeiko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-07T12:50:33Z",
    "updated_at": "2020-04-07T12:52:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey @Louvivien, \r\n\r\nBased on this:\r\n>On the terminal where i have started besu I see that very often, I don't know if it is important :\r\n`No peers available, wait for peer.`\r\n\r\nI assume your Besu node hasn't fully synced up to Rinkeby yet. Is that the case? This would explain why your Metamask account shows funds (it queries Infura behind the scenes, which has fully sync'ed nodes), but your Truffle console doesn't (it is relying on a node that hasn't sync'ed so hasn't processed the transfer of funds into your account yet). \r\n\r\nOne quick way to find out is to look at the logs of your Besu node and see if you have logs showing the latest blocks being imported, such as:\r\n\r\n```\r\n2020-04-07 08:48:35.548-04:00 | EthScheduler-Services-5 (importBlock) | INFO  | FullImportBlockStep | Import reached block 3000\r\n2020-04-07 08:48:36.702-04:00 | EthScheduler-Services-5 (importBlock) | INFO  | FullImportBlockStep | Import reached block 3200\r\n2020-04-07 08:48:37.539-04:00 | EthScheduler-Services-5 (importBlock) | INFO  | FullImportBlockStep | Import reached block 3400\r\n2020-04-07 08:48:38.113-04:00 | EthScheduler-Services-5 (importBlock) | INFO  | FullImportBlockStep | Import reached block 3600\r\n2020-04-07 08:48:38.610-04:00 | EthScheduler-Services-5 (importBlock) | INFO  | FullImportBlockStep | Import reached block 3800\r\n2020-04-07 08:48:39.537-04:00 | EthScheduler-Services-5 (importBlock) | INFO  | FullImportBlockStep | Import reached block 4000\r\n```\r\n\r\nFor Rinkeby, you'll need to sync ~6.2 million blocks. You can use [fast sync](https://besu.hyperledger.org/en/latest/Concepts/Pruning/#fast-synchronization) to do this quicker, and if you are looking to deploy on any testnet, [Goerli](https://besu.hyperledger.org/en/latest/HowTo/Get-Started/Starting-node/#run-a-node-on-goerli-testnet) is quicker to sync than Rinkeby (it can usually fast sync in ~1h). \r\n\r\nLet me know if that helps! ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/610367450/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/610978551",
    "html_url": "https://github.com/hyperledger/besu/issues/659#issuecomment-610978551",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/659",
    "id": 610978551,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDk3ODU1MQ==",
    "user": {
      "login": "Louvivien",
      "id": 43605778,
      "node_id": "MDQ6VXNlcjQzNjA1Nzc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/43605778?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Louvivien",
      "html_url": "https://github.com/Louvivien",
      "followers_url": "https://api.github.com/users/Louvivien/followers",
      "following_url": "https://api.github.com/users/Louvivien/following{/other_user}",
      "gists_url": "https://api.github.com/users/Louvivien/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Louvivien/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Louvivien/subscriptions",
      "organizations_url": "https://api.github.com/users/Louvivien/orgs",
      "repos_url": "https://api.github.com/users/Louvivien/repos",
      "events_url": "https://api.github.com/users/Louvivien/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Louvivien/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-08T14:02:31Z",
    "updated_at": "2020-04-08T14:05:53Z",
    "author_association": "NONE",
    "body": "Hi, \r\n\r\nThank you for you reply. \r\nI have updated my starting script to include the fast sync option. After one hour this is what I get :  \r\n<img width=\"742\" alt=\"Screen Shot 2020-04-07 at 19 04 36\" src=\"https://user-images.githubusercontent.com/43605778/78792808-e36d8800-79b1-11ea-8dfc-e0dcdf7c356f.png\">\r\n\r\nand at the end after more than one hour this is what I have : \r\n<img width=\"664\" alt=\"Screen Shot 2020-04-08 at 16 05 19\" src=\"https://user-images.githubusercontent.com/43605778/78793516-ce452900-79b2-11ea-9fd3-1602bbfce5cf.png\">\r\n\r\nI don't see \"FullImportBlockStep | Import reached block\"\r\n\r\nwhen I try `truffle migrate --reset --compile-all --network besu` but i still get the same error message\r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/610978551/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/610982554",
    "html_url": "https://github.com/hyperledger/besu/issues/659#issuecomment-610982554",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/659",
    "id": 610982554,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMDk4MjU1NA==",
    "user": {
      "login": "timbeiko",
      "id": 9390255,
      "node_id": "MDQ6VXNlcjkzOTAyNTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9390255?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/timbeiko",
      "html_url": "https://github.com/timbeiko",
      "followers_url": "https://api.github.com/users/timbeiko/followers",
      "following_url": "https://api.github.com/users/timbeiko/following{/other_user}",
      "gists_url": "https://api.github.com/users/timbeiko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/timbeiko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/timbeiko/subscriptions",
      "organizations_url": "https://api.github.com/users/timbeiko/orgs",
      "repos_url": "https://api.github.com/users/timbeiko/repos",
      "events_url": "https://api.github.com/users/timbeiko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/timbeiko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-08T14:10:05Z",
    "updated_at": "2020-04-08T14:10:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for the update! It seems that what happens is that your fast sync started well (as per your first screenshot), but then you lost the peers you were syncing from (possibly just because they went offline, or they didn't have the state you needed). Once it finds peers again it will start importing blocks again, and once it is ~1000 blocks from the head of the chain it will switch from `FastImportBlockStep` to `FullImportBlockStep`. \r\n\r\nIn short, no need to change anything in your config, you just need to let it run for a little while. ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/610982554/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/611723003",
    "html_url": "https://github.com/hyperledger/besu/issues/659#issuecomment-611723003",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/659",
    "id": 611723003,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYxMTcyMzAwMw==",
    "user": {
      "login": "timbeiko",
      "id": 9390255,
      "node_id": "MDQ6VXNlcjkzOTAyNTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9390255?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/timbeiko",
      "html_url": "https://github.com/timbeiko",
      "followers_url": "https://api.github.com/users/timbeiko/followers",
      "following_url": "https://api.github.com/users/timbeiko/following{/other_user}",
      "gists_url": "https://api.github.com/users/timbeiko/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/timbeiko/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/timbeiko/subscriptions",
      "organizations_url": "https://api.github.com/users/timbeiko/orgs",
      "repos_url": "https://api.github.com/users/timbeiko/repos",
      "events_url": "https://api.github.com/users/timbeiko/events{/privacy}",
      "received_events_url": "https://api.github.com/users/timbeiko/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-09T19:55:14Z",
    "updated_at": "2020-04-09T19:55:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "@Louvivien I'll close this issue for now, but please re-open if you encounter any other problems. \r\n\r\nCheers! ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/611723003/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
