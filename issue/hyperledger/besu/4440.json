{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/4440",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/4440/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/4440/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/4440/events",
  "html_url": "https://github.com/hyperledger/besu/issues/4440",
  "id": 1385903194,
  "node_id": "I_kwDODE2jmc5SmzRa",
  "number": 4440,
  "title": "IBFT Invalid Block Header (BftProcessorExecutor-IBFT-0 | ERROR | MainnetBlockValidator | Invalid block header. Block 445840)",
  "user": {
    "login": "daragao",
    "id": 3007280,
    "node_id": "MDQ6VXNlcjMwMDcyODA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3007280?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/daragao",
    "html_url": "https://github.com/daragao",
    "followers_url": "https://api.github.com/users/daragao/followers",
    "following_url": "https://api.github.com/users/daragao/following{/other_user}",
    "gists_url": "https://api.github.com/users/daragao/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/daragao/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/daragao/subscriptions",
    "organizations_url": "https://api.github.com/users/daragao/orgs",
    "repos_url": "https://api.github.com/users/daragao/repos",
    "events_url": "https://api.github.com/users/daragao/events{/privacy}",
    "received_events_url": "https://api.github.com/users/daragao/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1921587647,
      "node_id": "MDU6TGFiZWwxOTIxNTg3NjQ3",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamGroot",
      "name": "TeamGroot",
      "color": "1d76db",
      "default": false,
      "description": "GH issues worked on by Groot Team"
    },
    {
      "id": 2051683573,
      "node_id": "MDU6TGFiZWwyMDUxNjgzNTcz",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/P3",
      "name": "P3",
      "color": "ffff00",
      "default": false,
      "description": "Medium (ex: JSON-RPC request not working with a specific client library due to loose spec assumtion)"
    },
    {
      "id": 4328777430,
      "node_id": "LA_kwDODE2jmc8AAAABAgPm1g",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/blocked",
      "name": "blocked",
      "color": "B60205",
      "default": false,
      "description": null
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "jframe",
    "id": 909467,
    "node_id": "MDQ6VXNlcjkwOTQ2Nw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/909467?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jframe",
    "html_url": "https://github.com/jframe",
    "followers_url": "https://api.github.com/users/jframe/followers",
    "following_url": "https://api.github.com/users/jframe/following{/other_user}",
    "gists_url": "https://api.github.com/users/jframe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jframe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jframe/subscriptions",
    "organizations_url": "https://api.github.com/users/jframe/orgs",
    "repos_url": "https://api.github.com/users/jframe/repos",
    "events_url": "https://api.github.com/users/jframe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jframe/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "jframe",
      "id": 909467,
      "node_id": "MDQ6VXNlcjkwOTQ2Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/909467?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jframe",
      "html_url": "https://github.com/jframe",
      "followers_url": "https://api.github.com/users/jframe/followers",
      "following_url": "https://api.github.com/users/jframe/following{/other_user}",
      "gists_url": "https://api.github.com/users/jframe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jframe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jframe/subscriptions",
      "organizations_url": "https://api.github.com/users/jframe/orgs",
      "repos_url": "https://api.github.com/users/jframe/repos",
      "events_url": "https://api.github.com/users/jframe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jframe/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-09-26T11:27:04Z",
  "updated_at": "2022-11-21T20:48:40Z",
  "closed_at": "2022-11-21T20:48:40Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nI am currently running a private network of Besu nodes with IBFT 2.0 and gas cost to 0. For an unknown reason the nodes started accumulating pending transactions, after some time a bad block header is propagated (but not mined).\r\n\r\nAfter restarting the network, the problem is resolved.\r\n\r\n- What are the reasons why this might be happening?\r\n- In which situations is an invalid block header is created (having into account that all validators are well behaved)?\r\n\r\n### Versions (Add all that apply)\r\n*Besu v22.7.1\r\n* oracle-java-11\r\n* Linux CentOS\r\n\r\n### Additional Information (Add any of the following or anything else that may be relevant)\r\n* Besu setup info - genesis file, config options\r\n* System info - memory, CPU\r\n\r\n### Logs:\r\nError on my 4 validators: [besu_invalid_block.md](https://github.com/hyperledger/besu/files/9645665/besu_invalid_block.md)\r\nSingle node pending tx accumulating and resulting on Bad Block Header error: [pending_tx_bad_block.md](https://github.com/hyperledger/besu/files/9645668/pending_tx_bad_block.md)\r\n\r\n\r\nI am happy to provide any more info that might be helpful to debug what has happened, I am not able to reproduce it.",
  "closed_by": {
    "login": "siladu",
    "id": 2893793,
    "node_id": "MDQ6VXNlcjI4OTM3OTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/siladu",
    "html_url": "https://github.com/siladu",
    "followers_url": "https://api.github.com/users/siladu/followers",
    "following_url": "https://api.github.com/users/siladu/following{/other_user}",
    "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
    "organizations_url": "https://api.github.com/users/siladu/orgs",
    "repos_url": "https://api.github.com/users/siladu/repos",
    "events_url": "https://api.github.com/users/siladu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/siladu/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/4440/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/4440/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1311288298",
    "html_url": "https://github.com/hyperledger/besu/issues/4440#issuecomment-1311288298",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4440",
    "id": 1311288298,
    "node_id": "IC_kwDODE2jmc5OKKvq",
    "user": {
      "login": "jframe",
      "id": 909467,
      "node_id": "MDQ6VXNlcjkwOTQ2Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/909467?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jframe",
      "html_url": "https://github.com/jframe",
      "followers_url": "https://api.github.com/users/jframe/followers",
      "following_url": "https://api.github.com/users/jframe/following{/other_user}",
      "gists_url": "https://api.github.com/users/jframe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jframe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jframe/subscriptions",
      "organizations_url": "https://api.github.com/users/jframe/orgs",
      "repos_url": "https://api.github.com/users/jframe/repos",
      "events_url": "https://api.github.com/users/jframe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jframe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-11T06:37:06Z",
    "updated_at": "2022-11-11T06:37:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi daragao,\n\nApologies for only just getting back to you now with this.\n\nIt's not clear from the logs why the pending transactions are accumulating. The node that has pending transactions is this one of the proposer nodes? Is it possible get some logs from the proposer nodes?\n\nThe invalid block might not be related to the pending transactions issue. The invalid block in this case was caused by a block being created with block with an invalid header timestamp. It had a timestamp that was only 1 second newer than the parent block instead waiting the 2 seconds before proposing the block. This could happen for a few reasons. One could be that there was some time drift on the proposer node and it was slightly of sync with the other nodes. There also the accuracy of the Java timer also can vary and it depends on the OS system timer which can sometimes vary. Both which are not possible for Besu to control.\n\nIf this happens and a invalid block is created then a round change will be triggered. I can see in the logs the roundchange occurred and the network was able to continue.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1311288298/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1321313382",
    "html_url": "https://github.com/hyperledger/besu/issues/4440#issuecomment-1321313382",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4440",
    "id": 1321313382,
    "node_id": "IC_kwDODE2jmc5OwaRm",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-21T01:16:46Z",
    "updated_at": "2022-11-21T01:16:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "@daragao please see @jframe's response above. We will close this issue in a week if no response.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1321313382/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1321953926",
    "html_url": "https://github.com/hyperledger/besu/issues/4440#issuecomment-1321953926",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4440",
    "id": 1321953926,
    "node_id": "IC_kwDODE2jmc5Oy2qG",
    "user": {
      "login": "daragao",
      "id": 3007280,
      "node_id": "MDQ6VXNlcjMwMDcyODA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3007280?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/daragao",
      "html_url": "https://github.com/daragao",
      "followers_url": "https://api.github.com/users/daragao/followers",
      "following_url": "https://api.github.com/users/daragao/following{/other_user}",
      "gists_url": "https://api.github.com/users/daragao/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/daragao/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/daragao/subscriptions",
      "organizations_url": "https://api.github.com/users/daragao/orgs",
      "repos_url": "https://api.github.com/users/daragao/repos",
      "events_url": "https://api.github.com/users/daragao/events{/privacy}",
      "received_events_url": "https://api.github.com/users/daragao/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-21T12:04:11Z",
    "updated_at": "2022-11-21T12:04:11Z",
    "author_association": "NONE",
    "body": "can be closed. Understood the issue. \r\nBlock time too short.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1321953926/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1322622938",
    "html_url": "https://github.com/hyperledger/besu/issues/4440#issuecomment-1322622938",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4440",
    "id": 1322622938,
    "node_id": "IC_kwDODE2jmc5O1Z_a",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-11-21T20:48:40Z",
    "updated_at": "2022-11-21T20:48:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for letting us know @daragao :)",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1322622938/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
