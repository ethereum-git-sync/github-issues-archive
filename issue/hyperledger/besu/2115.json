{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/2115",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/2115/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/2115/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/2115/events",
  "html_url": "https://github.com/hyperledger/besu/issues/2115",
  "id": 852495616,
  "node_id": "MDU6SXNzdWU4NTI0OTU2MTY=",
  "number": 2115,
  "title": "NullPointerException in `updateNodeRecord` when mining milestone block",
  "user": {
    "login": "RatanRSur",
    "id": 4733314,
    "node_id": "MDQ6VXNlcjQ3MzMzMTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4733314?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/RatanRSur",
    "html_url": "https://github.com/RatanRSur",
    "followers_url": "https://api.github.com/users/RatanRSur/followers",
    "following_url": "https://api.github.com/users/RatanRSur/following{/other_user}",
    "gists_url": "https://api.github.com/users/RatanRSur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/RatanRSur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/RatanRSur/subscriptions",
    "organizations_url": "https://api.github.com/users/RatanRSur/orgs",
    "repos_url": "https://api.github.com/users/RatanRSur/repos",
    "events_url": "https://api.github.com/users/RatanRSur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/RatanRSur/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 2051683248,
      "node_id": "MDU6TGFiZWwyMDUxNjgzMjQ4",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/P2",
      "name": "P2",
      "color": "ff9900",
      "default": false,
      "description": "High (ex: Degrading performance issues, unexpected behavior of core features (DevP2P, syncing, etc))"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "RatanRSur",
    "id": 4733314,
    "node_id": "MDQ6VXNlcjQ3MzMzMTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4733314?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/RatanRSur",
    "html_url": "https://github.com/RatanRSur",
    "followers_url": "https://api.github.com/users/RatanRSur/followers",
    "following_url": "https://api.github.com/users/RatanRSur/following{/other_user}",
    "gists_url": "https://api.github.com/users/RatanRSur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/RatanRSur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/RatanRSur/subscriptions",
    "organizations_url": "https://api.github.com/users/RatanRSur/orgs",
    "repos_url": "https://api.github.com/users/RatanRSur/repos",
    "events_url": "https://api.github.com/users/RatanRSur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/RatanRSur/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "RatanRSur",
      "id": 4733314,
      "node_id": "MDQ6VXNlcjQ3MzMzMTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4733314?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RatanRSur",
      "html_url": "https://github.com/RatanRSur",
      "followers_url": "https://api.github.com/users/RatanRSur/followers",
      "following_url": "https://api.github.com/users/RatanRSur/following{/other_user}",
      "gists_url": "https://api.github.com/users/RatanRSur/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RatanRSur/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RatanRSur/subscriptions",
      "organizations_url": "https://api.github.com/users/RatanRSur/orgs",
      "repos_url": "https://api.github.com/users/RatanRSur/repos",
      "events_url": "https://api.github.com/users/RatanRSur/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RatanRSur/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-04-07T14:54:09Z",
  "updated_at": "2021-04-16T14:57:22Z",
  "closed_at": "2021-04-16T14:57:22Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "besu version: `21.1.3`\r\n\r\n```\r\n2021-04-06 16:24:38.165+00:00 | EthScheduler-Workers-0 | INFO  | PersistBlockTask | Imported #17,619 / 0 tx / 0 om / 0 (0.0%) gas / (0x33f23515d643f6f63c61eb1fc556bf212e04de2fc8b27ddb841ab62d9e9dd65e) in 0.082s. Peers: 3\r\n2021-04-06 16:24:43.182+00:00 | pool-7-thread-2 | ERROR | BlockMiner | Block mining threw an unhandled exception.\r\njava.lang.NullPointerException\r\n        at com.google.common.net.InetAddresses.ipStringToBytes(InetAddresses.java:169)\r\n        at com.google.common.net.InetAddresses.forString(InetAddresses.java:142)\r\n        at org.hyperledger.besu.ethereum.p2p.discovery.PeerDiscoveryAgent.updateNodeRecord(PeerDiscoveryAgent.java:189)\r\n        at org.hyperledger.besu.ethereum.p2p.network.DefaultP2PNetwork.updateNodeRecord(DefaultP2PNetwork.java:435)\r\n        at org.hyperledger.besu.RunnerBuilder.lambda$build$6(RunnerBuilder.java:459)\r\n        at org.hyperledger.besu.RunnerBuilder$$Lambda$516/000000006A0FDFF0.onBlockAdded(Unknown Source)\r\n        at org.hyperledger.besu.ethereum.chain.DefaultBlockchain.lambda$appendBlock$8(DefaultBlockchain.java:242)\r\n        at org.hyperledger.besu.ethereum.chain.DefaultBlockchain$$Lambda$858/00000000C089F6F0.accept(Unknown Source)\r\n        at org.hyperledger.besu.util.Subscribers.lambda$forEach$0(Subscribers.java:112)\r\n        at org.hyperledger.besu.util.Subscribers$$Lambda$384/0000000069FC9DD0.accept(Unknown Source)\r\n        at java.base/java.lang.Iterable.forEach(Iterable.java:75)\r\n        at org.hyperledger.besu.util.Subscribers.forEach(Subscribers.java:109)\r\n        at org.hyperledger.besu.ethereum.chain.DefaultBlockchain.appendBlock(DefaultBlockchain.java:242)\r\n        at org.hyperledger.besu.ethereum.mainnet.MainnetBlockImporter.lambda$importBlock$0(MainnetBlockImporter.java:50)\r\n        at org.hyperledger.besu.ethereum.mainnet.MainnetBlockImporter$$Lambda$850/00000000C0876EC0.accept(Unknown Source)\r\n        at java.base/java.util.Optional.ifPresent(Optional.java:183)\r\n        at org.hyperledger.besu.ethereum.mainnet.MainnetBlockImporter.importBlock(MainnetBlockImporter.java:48)\r\n        at org.hyperledger.besu.ethereum.core.BlockImporter.importBlock(BlockImporter.java:44)\r\n        at org.hyperledger.besu.ethereum.blockcreation.BlockMiner.mineBlock(BlockMiner.java:131)\r\n        at org.hyperledger.besu.consensus.clique.blockcreation.CliqueBlockMiner.mineBlock(CliqueBlockMiner.java:49)\r\n        at org.hyperledger.besu.ethereum.blockcreation.BlockMiner.run(BlockMiner.java:82)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n        at java.base/java.lang.Thread.run(Thread.java:834)\r\n```\r\n```\r\n> admin.nodeInfo\r\n{\r\n  enode: \"enode://95fbe5135415caf11e56fb75950db7ebbc3acbe9e604d5b81b9e644e3906aa955adb0400af8cf48bb81c18fe20320cedc4a27d2e56a784075640e2fff91c4305@0.0.0.0:30303?discport=0\",\r\n  id: \"95fbe5135415caf11e56fb75950db7ebbc3acbe9e604d5b81b9e644e3906aa955adb0400af8cf48bb81c18fe20320cedc4a27d2e56a784075640e2fff91c4305\",\r\n  ip: \"0.0.0.0\",\r\n  listenAddr: \"0.0.0.0:30303\",\r\n  name: \"besu/v21.1.3/linux-x86_64/openj9-java-11\",\r\n  po21.1.3rts: {\r\n    listener: 30303\r\n  },\r\n  protocols: {\r\n    eth: {\r\n      config: {\r\n        byzantiumBlock: 0,\r\n        chainId: 644457192,\r\n        clique: {...},\r\n        eip150Block: 0,\r\n        eip158Block: 0,\r\n        homesteadBlock: 0,\r\n        istanbulBlock: 17620,\r\n        muirGlacierBlock: 17620,\r\n        petersburgBlock: 0\r\n      },\r\n```",
  "closed_by": {
    "login": "RatanRSur",
    "id": 4733314,
    "node_id": "MDQ6VXNlcjQ3MzMzMTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4733314?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/RatanRSur",
    "html_url": "https://github.com/RatanRSur",
    "followers_url": "https://api.github.com/users/RatanRSur/followers",
    "following_url": "https://api.github.com/users/RatanRSur/following{/other_user}",
    "gists_url": "https://api.github.com/users/RatanRSur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/RatanRSur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/RatanRSur/subscriptions",
    "organizations_url": "https://api.github.com/users/RatanRSur/orgs",
    "repos_url": "https://api.github.com/users/RatanRSur/repos",
    "events_url": "https://api.github.com/users/RatanRSur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/RatanRSur/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/2115/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/2115/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/815013523",
    "html_url": "https://github.com/hyperledger/besu/issues/2115#issuecomment-815013523",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2115",
    "id": 815013523,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNTAxMzUyMw==",
    "user": {
      "login": "vdamle",
      "id": 5338861,
      "node_id": "MDQ6VXNlcjUzMzg4NjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5338861?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vdamle",
      "html_url": "https://github.com/vdamle",
      "followers_url": "https://api.github.com/users/vdamle/followers",
      "following_url": "https://api.github.com/users/vdamle/following{/other_user}",
      "gists_url": "https://api.github.com/users/vdamle/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vdamle/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vdamle/subscriptions",
      "organizations_url": "https://api.github.com/users/vdamle/orgs",
      "repos_url": "https://api.github.com/users/vdamle/repos",
      "events_url": "https://api.github.com/users/vdamle/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vdamle/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-07T15:35:49Z",
    "updated_at": "2021-04-07T15:35:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "[besu-restart-21.1.3.log](https://github.com/hyperledger/besu/files/6272717/besu-restart-21.1.3.log)\r\n\r\n@RatanRSur Attaching logs from the node here.\r\n\r\nOne thing I see, now that I looked at the logs following the NPE (since I bumped up the level to `debug` after), is that there are `Duplicate Peer` messages and the output seems to show 5 peers. The number of nodes in the chain is 3. Not sure if this has anything to do with the error. As background, in Kaleido, we run private chains with a set of static nodes (which could change over time when nodes are added/removed from the chain). Since Besu did not have support for providing a static nodes file as a startup argument until recently, we orchestrate calling `admin_addPeer` on nodes.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/815013523/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/815034205",
    "html_url": "https://github.com/hyperledger/besu/issues/2115#issuecomment-815034205",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2115",
    "id": 815034205,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNTAzNDIwNQ==",
    "user": {
      "login": "RatanRSur",
      "id": 4733314,
      "node_id": "MDQ6VXNlcjQ3MzMzMTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4733314?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RatanRSur",
      "html_url": "https://github.com/RatanRSur",
      "followers_url": "https://api.github.com/users/RatanRSur/followers",
      "following_url": "https://api.github.com/users/RatanRSur/following{/other_user}",
      "gists_url": "https://api.github.com/users/RatanRSur/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RatanRSur/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RatanRSur/subscriptions",
      "organizations_url": "https://api.github.com/users/RatanRSur/orgs",
      "repos_url": "https://api.github.com/users/RatanRSur/repos",
      "events_url": "https://api.github.com/users/RatanRSur/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RatanRSur/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-07T16:04:11Z",
    "updated_at": "2021-04-07T16:04:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "Can you provide your configuration? The `.toml` file and any command line flags you used as overrides to the `.toml`",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/815034205/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/815044320",
    "html_url": "https://github.com/hyperledger/besu/issues/2115#issuecomment-815044320",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/2115",
    "id": 815044320,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNTA0NDMyMA==",
    "user": {
      "login": "vdamle",
      "id": 5338861,
      "node_id": "MDQ6VXNlcjUzMzg4NjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5338861?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vdamle",
      "html_url": "https://github.com/vdamle",
      "followers_url": "https://api.github.com/users/vdamle/followers",
      "following_url": "https://api.github.com/users/vdamle/following{/other_user}",
      "gists_url": "https://api.github.com/users/vdamle/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vdamle/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vdamle/subscriptions",
      "organizations_url": "https://api.github.com/users/vdamle/orgs",
      "repos_url": "https://api.github.com/users/vdamle/repos",
      "events_url": "https://api.github.com/users/vdamle/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vdamle/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-07T16:17:50Z",
    "updated_at": "2021-04-07T16:17:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "The command line args are (we aren't using a `.toml` file yet):\r\n\r\n```\r\n--data-path=/<path>/ethereum --node-private-key-file /<path>/ethereum/nodekey --discovery-enabled=false --max-peers=200 --p2p-port=30303 --p2p-host=0.0.0.0 --rpc-http-enabled --rpc-http-host=0.0.0.0 --rpc-http-port=8555 --rpc-ws-enabled --rpc-ws-host=0.0.0.0 --rpc-ws-port=8556 --rpc-http-api=ETH,NET,WEB3,DEBUG,MINER,ADMIN,TXPOOL,PERM,EEA,PRIV,CLIQUE --rpc-ws-api=ETH,NET,WEB3,DEBUG,MINER,ADMIN,TXPOOL,PERM,EEA,PRIV,CLIQUE --rpc-http-cors-origins='*' --host-whitelist='*' --network-id=644457192 --privacy-enabled --privacy-url=http://127.0.0.1:8888 --privacy-public-key-file=/<path>/orion/orion.pub --privacy-enable-database-migration --min-gas-price=0 --logging=INFO --genesis-file=/<path>/ethereum/genesis.json\r\n```\r\n\r\nThe genesis config is:\r\n\r\n```\r\n{\r\n  \"alloc\": {\r\n    \"ca8e94f9482bfd7dd0845fa67d9c3e804f71f49b\": {\r\n      \"balance\": \"1000000000000000000000000000\"\r\n    }\r\n  },\r\n  \"coinbase\": \"0x0000000000000000000000000000000000000000\",\r\n  \"config\": {\r\n    \"homesteadBlock\": 0,\r\n    \"eip150Block\": 0,\r\n    \"eip155Block\": 0,\r\n    \"eip158Block\": 0,\r\n    \"byzantiumBlock\": 0,\r\n    \"constantinoplefixblock\": 0,\r\n    \"clique\": {\r\n      \"blockperiodseconds\": 5,\r\n      \"epochlength\": 30000\r\n    },\r\n    \"chainId\": 644457192,\r\n    \"istanbulBlock\": 17620,\r\n    \"muirGlacierBlock\": 17620\r\n  },\r\n  \"nonce\": \"0x0\",\r\n  \"timestamp\": \"0x58ee40ba\",\r\n  \"extraData\": \"0x00000000000000000000000000000000000000000000000000000000000000000f99f3979dfde1dd3cfadb60c23e9dd845b58e210000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\",\r\n  \"gasLimit\": \"0x2FEFD800\",\r\n  \"contractSizeLimit\": 2147483647,\r\n  \"difficulty\": \"0x1\",\r\n  \"number\": \"0x0\",\r\n  \"gasUsed\": \"0x0\",\r\n  \"mixHash\": \"0x0000000000000000000000000000000000000000000000000000000000000000\",\r\n  \"parentHash\": \"0x0000000000000000000000000000000000000000000000000000000000000000\"\r\n}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/815044320/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
