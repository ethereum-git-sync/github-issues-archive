{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/1997",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/1997/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/1997/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/1997/events",
  "html_url": "https://github.com/hyperledger/besu/issues/1997",
  "id": 827669124,
  "node_id": "MDU6SXNzdWU4Mjc2NjkxMjQ=",
  "number": 1997,
  "title": "besu blocks export subcommand fails",
  "user": {
    "login": "b-rohit",
    "id": 24924350,
    "node_id": "MDQ6VXNlcjI0OTI0MzUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/24924350?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/b-rohit",
    "html_url": "https://github.com/b-rohit",
    "followers_url": "https://api.github.com/users/b-rohit/followers",
    "following_url": "https://api.github.com/users/b-rohit/following{/other_user}",
    "gists_url": "https://api.github.com/users/b-rohit/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/b-rohit/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/b-rohit/subscriptions",
    "organizations_url": "https://api.github.com/users/b-rohit/orgs",
    "repos_url": "https://api.github.com/users/b-rohit/repos",
    "events_url": "https://api.github.com/users/b-rohit/events{/privacy}",
    "received_events_url": "https://api.github.com/users/b-rohit/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-03-10T12:35:33Z",
  "updated_at": "2021-06-01T15:38:22Z",
  "closed_at": "2021-06-01T15:38:22Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Steps to Reproduce (Bug)\r\n1. besu --data-path=/opt/besu/data/ blocks export --start-block=2 --end-block=3 --to=/home/exportblock.bin\r\n\r\n**Expected behavior:** [What you expect to happen]\r\nit should export the blocks in the given file in the RLP format\r\n\r\n**Actual behavior:** [What actually happens]\r\n```\r\n2021-03-10 12:26:17.013+00:00 | main | INFO  | BlocksSubCommand | Export RLP block data to file /home/exportblock.bin\r\n2021-03-10 12:26:19.444+00:00 | main | INFO  | KeyPairUtil | Loaded key 0x642147e9304f8237f7195c3dc125b5e485b7615948fa96a61e8dbfe554a891d7a0244222050785d0663c1a42d085fa266479867f12ef666a93106eb70fab99ed from /opt/besu/data/key\r\n2021-03-10 12:26:19.548+00:00 | main | INFO  | DatabaseMetadata | Lookup database metadata file in data directory: /opt/besu/data\r\n2021-03-10 12:26:19.679+00:00 | main | INFO  | RocksDBKeyValueStorageFactory | Existing database detected at /opt/besu/data. Version 1\r\npicocli.CommandLine$ExecutionException: org.rocksdb.RocksDBException: While lock file: /opt/besu/data/database/LOCK: Resource temporarily unavailable\r\n        at org.hyperledger.besu.cli.BesuCommand.buildController(BesuCommand.java:1222)\r\n        at org.hyperledger.besu.cli.subcommands.blocks.BlocksSubCommand$ExportSubCommand.createBesuController(BlocksSubCommand.java:309)\r\n        at org.hyperledger.besu.cli.subcommands.blocks.BlocksSubCommand$ExportSubCommand.run(BlocksSubCommand.java:292)\r\n        at picocli.CommandLine.executeUserObject(CommandLine.java:1769)\r\n        at picocli.CommandLine.access$900(CommandLine.java:145)\r\n        at picocli.CommandLine$RunLast.handle(CommandLine.java:2141)\r\n        at picocli.CommandLine$RunLast.handle(CommandLine.java:2108)\r\n        at picocli.CommandLine$AbstractParseResultHandler.handleParseResult(CommandLine.java:1968)\r\n        at picocli.CommandLine.parseWithHandlers(CommandLine.java:2322)\r\n        at org.hyperledger.besu.cli.util.ConfigOptionSearchAndRunHandler.handle(ConfigOptionSearchAndRunHandler.java:61)\r\n        at org.hyperledger.besu.cli.util.ConfigOptionSearchAndRunHandler.handle(ConfigOptionSearchAndRunHandler.java:31)\r\n        at picocli.CommandLine$AbstractParseResultHandler.handleParseResult(CommandLine.java:1968)\r\n        at picocli.CommandLine.parseWithHandlers(CommandLine.java:2322)\r\n        at org.hyperledger.besu.cli.BesuCommand.parse(BesuCommand.java:1053)\r\n        at org.hyperledger.besu.cli.BesuCommand.parse(BesuCommand.java:922)\r\n        at org.hyperledger.besu.Besu.main(Besu.java:49)\r\nCaused by: org.hyperledger.besu.plugin.services.exception.StorageException: org.rocksdb.RocksDBException: While lock file: /opt/besu/data/database/LOCK: Resource temporarily unavailable\r\n        at org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.<init>(RocksDBColumnarKeyValueStorage.java:133)\r\n        at org.hyperledger.besu.plugin.services.storage.rocksdb.RocksDBKeyValueStorageFactory.create(RocksDBKeyValueStorageFactory.java:118)\r\n        at org.hyperledger.besu.ethereum.storage.keyvalue.KeyValueStorageProviderBuilder.build(KeyValueStorageProviderBuilder.java:64)\r\n        at org.hyperledger.besu.cli.BesuCommand.keyStorageProvider(BesuCommand.java:1695)\r\n        at org.hyperledger.besu.cli.BesuCommand.getControllerBuilder(BesuCommand.java:1251)\r\n        at org.hyperledger.besu.cli.BesuCommand.buildController(BesuCommand.java:1220)\r\n        ... 15 more\r\nCaused by: org.rocksdb.RocksDBException: While lock file: /opt/besu/data/database/LOCK: Resource temporarily unavailable\r\n        at org.rocksdb.TransactionDB.open(Native Method)\r\n        at org.rocksdb.TransactionDB.open(TransactionDB.java:90)\r\n        at org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.<init>(RocksDBColumnarKeyValueStorage.java:109)\r\n        ... 20 more\r\n```\r\n\r\n**Frequency:** [What percentage of the time does it occur?]\r\nEvery time\r\n\r\n### Versions (Add all that apply)\r\n* Software version: [`besu --version`]\r\n`besu/v1.4.3/linux-x86_64/oracle_openjdk-java-11`\r\n* Java version: [`java -version`]\r\n```\r\nopenjdk version \"11.0.2\" 2019-01-15\r\nOpenJDK Runtime Environment (build 11.0.2+9-Debian-3bpo91)\r\nOpenJDK 64-Bit Server VM (build 11.0.2+9-Debian-3bpo91, mixed mode, sharing)\r\n```\r\n* OS Name & Version: [`cat /etc/*release`]\r\n```\r\nNAME=\"Ubuntu\"\r\nVERSION=\"16.04.6 LTS (Xenial Xerus)\"\r\nID=ubuntu\r\nID_LIKE=debian\r\nPRETTY_NAME=\"Ubuntu 16.04.6 LTS\"\r\nVERSION_ID=\"16.04\"\r\nHOME_URL=\"http://www.ubuntu.com/\"\r\nSUPPORT_URL=\"http://help.ubuntu.com/\"\r\nBUG_REPORT_URL=\"http://bugs.launchpad.net/ubuntu/\"\r\nVERSION_CODENAME=xenial\r\nUBUNTU_CODENAME=xenial\r\n```\r\n* Docker Version: [`docker version`]\r\n```\r\nClient: Docker Engine - Community\r\n Version:           19.03.12\r\n API version:       1.40\r\n Go version:        go1.13.10\r\n Git commit:        48a66213fe\r\n Built:             Mon Jun 22 15:45:49 2020\r\n OS/Arch:           linux/amd64\r\n Experimental:      false\r\n```\r\n* Cloud VM, type, size: [Amazon Web Services I3-large]\r\nGoogle cloud VM instance\r\n\r\n### Additional Information\r\n\r\n",
  "closed_by": {
    "login": "RatanRSur",
    "id": 4733314,
    "node_id": "MDQ6VXNlcjQ3MzMzMTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4733314?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/RatanRSur",
    "html_url": "https://github.com/RatanRSur",
    "followers_url": "https://api.github.com/users/RatanRSur/followers",
    "following_url": "https://api.github.com/users/RatanRSur/following{/other_user}",
    "gists_url": "https://api.github.com/users/RatanRSur/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/RatanRSur/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/RatanRSur/subscriptions",
    "organizations_url": "https://api.github.com/users/RatanRSur/orgs",
    "repos_url": "https://api.github.com/users/RatanRSur/repos",
    "events_url": "https://api.github.com/users/RatanRSur/events{/privacy}",
    "received_events_url": "https://api.github.com/users/RatanRSur/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/1997/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/1997/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/845570103",
    "html_url": "https://github.com/hyperledger/besu/issues/1997#issuecomment-845570103",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1997",
    "id": 845570103,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NTU3MDEwMw==",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-21T00:33:07Z",
    "updated_at": "2021-05-21T00:33:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "@b-rohit This error means the exporter can't get a lock on the db. This would be explained by Besu still running. Can you try to run the export command after stopping Besu?",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/845570103/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/852226902",
    "html_url": "https://github.com/hyperledger/besu/issues/1997#issuecomment-852226902",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1997",
    "id": 852226902,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MjIyNjkwMg==",
    "user": {
      "login": "RatanRSur",
      "id": 4733314,
      "node_id": "MDQ6VXNlcjQ3MzMzMTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4733314?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/RatanRSur",
      "html_url": "https://github.com/RatanRSur",
      "followers_url": "https://api.github.com/users/RatanRSur/followers",
      "following_url": "https://api.github.com/users/RatanRSur/following{/other_user}",
      "gists_url": "https://api.github.com/users/RatanRSur/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/RatanRSur/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/RatanRSur/subscriptions",
      "organizations_url": "https://api.github.com/users/RatanRSur/orgs",
      "repos_url": "https://api.github.com/users/RatanRSur/repos",
      "events_url": "https://api.github.com/users/RatanRSur/events{/privacy}",
      "received_events_url": "https://api.github.com/users/RatanRSur/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-01T15:38:22Z",
    "updated_at": "2021-06-01T15:38:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "@b-rohit Closing this assuming that the lock file was indeed the issue. Feel free to reopen if not.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/852226902/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
