{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/5576",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/5576/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/5576/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/5576/events",
  "html_url": "https://github.com/hyperledger/besu/issues/5576",
  "id": 1750846083,
  "node_id": "I_kwDODE2jmc5oW8qD",
  "number": 5576,
  "title": "Besu randomly crashes and stops syncing",
  "user": {
    "login": "yuri-moens",
    "id": 1128153,
    "node_id": "MDQ6VXNlcjExMjgxNTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1128153?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yuri-moens",
    "html_url": "https://github.com/yuri-moens",
    "followers_url": "https://api.github.com/users/yuri-moens/followers",
    "following_url": "https://api.github.com/users/yuri-moens/following{/other_user}",
    "gists_url": "https://api.github.com/users/yuri-moens/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yuri-moens/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yuri-moens/subscriptions",
    "organizations_url": "https://api.github.com/users/yuri-moens/orgs",
    "repos_url": "https://api.github.com/users/yuri-moens/repos",
    "events_url": "https://api.github.com/users/yuri-moens/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yuri-moens/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-06-10T07:23:47Z",
  "updated_at": "2023-06-10T07:23:47Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Expected behavior:** It works\r\n\r\n**Actual behavior:** It doesn't work\r\n\r\n**Frequency:** About 1-2 hours after restarting Besu\r\n\r\n### Logs (if a bug)\r\n```\r\n2023-06-10 01:18:12.790+00:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineNewPayload | Imported #17,446,465 / 127 tx / 16 ws / base fee 18.07 gwei / 8,465,311 (28.2%) gas / (0xe35c859e2798ebcc951e3743215dc69a0d60c04047c1c86bb646bdbbde47335b) in 0.600s. Peers: 50\r\n2023-06-10 01:18:24.763+00:00 | vert.x-worker-thread-0 | INFO  | DefaultSynchronizer |\r\n####################################################################################################\r\n#                                                                                                  #\r\n# Besu has identified a problem with its worldstate database.                                      #\r\n# Your node will fetch the correct data from peers to repair the problem.                          #\r\n# Starting the sync pipeline...                                                                    #\r\n#                                                                                                  #\r\n####################################################################################################\r\n2023-06-10 01:18:24.765+00:00 | vert.x-worker-thread-0 | INFO  | TransactionPoolFactory | Disabling transaction handling during re-sync\r\n2023-06-10 01:18:24.769+00:00 | vert.x-worker-thread-0 | WARN  | BonsaiWorldStateProvider | Invalid slot found for account 0xdfde78d2baec499fe18f2be74b6c287eed9511d7 at location 0x0c0c\r\n2023-06-10 01:18:25.011+00:00 | vert.x-worker-thread-0 | INFO  | DefaultSynchronizer | Starting synchronizer.\r\n2023-06-10 01:18:25.012+00:00 | vert.x-worker-thread-0 | INFO  | FastSyncDownloader | Starting sync\r\n2023-06-10 01:18:25.058+00:00 | nioEventLoopGroup-3-5 | INFO  | SnapWorldStateDownloader | Downloading world state from peers for pivot block 17445216 (0x3643700ec320aa10c77861639c27734fd3f82364c028f527686720dac70b0635). State root 0x3eeffb63b373cab4a1f201e96f6d3a23b9ca27973860b68f1c3857055f669267 pending requests 0\r\n2023-06-10 01:18:26.006+00:00 | nioEventLoopGroup-3-5 | INFO  | SnapWorldDownloadState | Running world state heal process from peers with pivot block 17445216\r\n2023-06-10 01:18:33.145+00:00 | nioEventLoopGroup-3-4 | WARN  | DefaultBlockchain | Chain Reorganization +0 new / -1249 old\r\n       Old - hash: 0xe35c859e2798ebcc951e3743215dc69a0d60c04047c1c86bb646bdbbde47335b, height: 17446465\r\n       New - hash: 0x3643700ec320aa10c77861639c27734fd3f82364c028f527686720dac70b0635, height: 17445216\r\n  Ancestor - hash: 0x3643700ec320aa10c77861639c27734fd3f82364c028f527686720dac70b0635, height: 17445216\r\n2023-06-10 01:18:37.594+00:00 | vert.x-worker-thread-0 | INFO  | BonsaiWorldStateProvider | Archive rolling failed for block hash 0x3643700ec320aa10c77861639c27734fd3f82364c028f527686720dac70b0635\r\njava.util.NoSuchElementException: No value present\r\n        at java.base/java.util.Optional.get(Optional.java:143)\r\n        at org.hyperledger.besu.ethereum.bonsai.BonsaiWorldStateProvider.rollMutableStateToBlockHash(BonsaiWorldStateProvider.java:208)\r\n        at org.hyperledger.besu.ethereum.bonsai.BonsaiWorldStateProvider.lambda$getMutable$5(BonsaiWorldStateProvider.java:176)\r\n        at java.base/java.util.Optional.flatMap(Optional.java:289)\r\n        at org.hyperledger.besu.ethereum.bonsai.BonsaiWorldStateProvider.getMutable(BonsaiWorldStateProvider.java:174)\r\n        at org.hyperledger.besu.ethereum.transaction.TransactionSimulator.getWorldState(TransactionSimulator.java:151)\r\n        at org.hyperledger.besu.ethereum.transaction.TransactionSimulator.process(TransactionSimulator.java:131)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthCall.resultByBlockHeader(EthCall.java:78)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.AbstractBlockParameterOrBlockHashMethod.latestResult(AbstractBlockParameterOrBlockHashMethod.java:68)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.AbstractBlockParameterOrBlockHashMethod.handleParamTypes(AbstractBlockParameterOrBlockHashMethod.java:98)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthCall.response(EthCall.java:102)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.execution.BaseJsonRpcProcessor.process(BaseJsonRpcProcessor.java:44)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.execution.TracedJsonRpcProcessor.process(TracedJsonRpcProcessor.java:41)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.execution.TimedJsonRpcProcessor.process(TimedJsonRpcProcessor.java:45)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.execution.JsonRpcExecutor.execute(JsonRpcExecutor.java:92)\r\n        at org.hyperledger.besu.ethereum.api.handlers.AbstractJsonRpcExecutor.executeRequest(AbstractJsonRpcExecutor.java:87)\r\n        at org.hyperledger.besu.ethereum.api.handlers.JsonRpcObjectExecutor.execute(JsonRpcObjectExecutor.java:57)\r\n        at org.hyperledger.besu.ethereum.api.handlers.JsonRpcExecutorHandler.lambda$handler$0(JsonRpcExecutorHandler.java:57)\r\n        at java.base/java.util.Optional.ifPresentOrElse(Optional.java:196)\r\n        at org.hyperledger.besu.ethereum.api.handlers.JsonRpcExecutorHandler.lambda$handler$2(JsonRpcExecutorHandler.java:54)\r\n        at io.vertx.ext.web.impl.BlockingHandlerDecorator.lambda$handle$0(BlockingHandlerDecorator.java:48)\r\n        at io.vertx.core.impl.ContextBase.lambda$null$0(ContextBase.java:137)\r\n        at io.vertx.core.impl.ContextInternal.dispatch(ContextInternal.java:264)\r\n        at io.vertx.core.impl.ContextBase.lambda$executeBlocking$1(ContextBase.java:135)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:833)\r\n2023-06-10 01:18:37.605+00:00 | vert.x-worker-thread-14 | INFO  | BonsaiWorldStateProvider | Archive rolling failed for block hash 0x3643700ec320aa10c77861639c27734fd3f82364c028f527686720dac70b0635\r\njava.util.NoSuchElementException: No value present\r\n        at java.base/java.util.Optional.get(Optional.java:143)\r\n        at org.hyperledger.besu.ethereum.bonsai.BonsaiWorldStateProvider.rollMutableStateToBlockHash(BonsaiWorldStateProvider.java:208)\r\n        at org.hyperledger.besu.ethereum.bonsai.BonsaiWorldStateProvider.lambda$getMutable$5(BonsaiWorldStateProvider.java:176)\r\n        at java.base/java.util.Optional.flatMap(Optional.java:289)\r\n        at org.hyperledger.besu.ethereum.bonsai.BonsaiWorldStateProvider.getMutable(BonsaiWorldStateProvider.java:174)\r\n        at org.hyperledger.besu.ethereum.transaction.TransactionSimulator.getWorldState(TransactionSimulator.java:151)\r\n        at org.hyperledger.besu.ethereum.transaction.TransactionSimulator.process(TransactionSimulator.java:131)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthCall.resultByBlockHeader(EthCall.java:78)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.AbstractBlockParameterOrBlockHashMethod.latestResult(AbstractBlockParameterOrBlockHashMethod.java:68)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.AbstractBlockParameterOrBlockHashMethod.handleParamTypes(AbstractBlockParameterOrBlockHashMethod.java:98)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthCall.response(EthCall.java:102)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.execution.BaseJsonRpcProcessor.process(BaseJsonRpcProcessor.java:44)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.execution.TracedJsonRpcProcessor.process(TracedJsonRpcProcessor.java:41)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.execution.TimedJsonRpcProcessor.process(TimedJsonRpcProcessor.java:45)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.execution.JsonRpcExecutor.execute(JsonRpcExecutor.java:92)\r\n        at org.hyperledger.besu.ethereum.api.handlers.AbstractJsonRpcExecutor.executeRequest(AbstractJsonRpcExecutor.java:87)\r\n        at org.hyperledger.besu.ethereum.api.handlers.JsonRpcObjectExecutor.execute(JsonRpcObjectExecutor.java:57)\r\n        at org.hyperledger.besu.ethereum.api.handlers.JsonRpcExecutorHandler.lambda$handler$0(JsonRpcExecutorHandler.java:57)\r\n        at java.base/java.util.Optional.ifPresentOrElse(Optional.java:196)\r\n        at org.hyperledger.besu.ethereum.api.handlers.JsonRpcExecutorHandler.lambda$handler$2(JsonRpcExecutorHandler.java:54)\r\n        at io.vertx.ext.web.impl.BlockingHandlerDecorator.lambda$handle$0(BlockingHandlerDecorator.java:48)\r\n        at io.vertx.core.impl.ContextBase.lambda$null$0(ContextBase.java:137)\r\n        at io.vertx.core.impl.ContextInternal.dispatch(ContextInternal.java:264)\r\n        at io.vertx.core.impl.ContextBase.lambda$executeBlocking$1(ContextBase.java:135)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:833)\r\n2023-06-10 03:54:17.164+00:00 | Timer-0 | INFO  | DNSResolver | Resolved 319 nodes\r\n```\r\n\r\nThis happens on a new machine, new Rocket Pool install, new sync. It was fully synced and working but throws this error after a couple of hours (around 2-3) and stays there. Restarting it makes it work again until the same error pops up (again, after a couple of hours). This is a default Rocket Pool install. Another note: syncing took about 2.5-3 days rather than the ~6 hours I've read everywhere. Not sure if this is relevant.\r\n\r\nAnother note: I probably won't be able to do a lot of testing. I've lost quite some time with this already so I'll be moving to another client to get things up and running as soon as possible. I'll try to keep the Besu files if my storage allows it.\r\n\r\n### Versions (Add all that apply)\r\n* Software version: `besu/v23.4.1/linux-x86_64/openjdk-java-17`\r\n* Java version: `openjdk version \"17.0.7\" 2023-04-18`\r\n* OS Name & Version: `Ubuntu 22.04.2 LTS\"`\r\n* Kernel Version: `5.14.0-284.11.1.el9_2.x86_64`\r\n* Docker Version: `Docker version 24.0.2, build cb74dfc`\r\n* Consensus Client & Version if using Proof of Stake: `Teku 23.5.0`\r\n\r\n### Additional Information (Add any of the following or anything else that may be relevant)\r\n* Besu setup info - genesis file, config options\r\nStandard Rocket Pool install, environment variables as found in the compose file\r\n```\r\n      BESU_JVM_HEAP_SIZE: \"0\"\r\n      BESU_MAX_BACK_LAYERS: \"512\"\r\n      CLIENT: besu\r\n      EC_ADDITIONAL_FLAGS: \"\"\r\n      EC_CACHE_SIZE: \"\"\r\n      EC_ENGINE_PORT: \"8551\"\r\n      EC_HTTP_PORT: \"8545\"\r\n      EC_MAX_PEERS: \"50\"\r\n      EC_METRICS_PORT: \"9105\"\r\n      EC_P2P_PORT: \"30303\"\r\n      EC_WS_PORT: \"8546\"\r\n      ENABLE_METRICS: \"true\"\r\n      ETHSTATS_LABEL: \"\"\r\n      ETHSTATS_LOGIN: \"\"\r\n      EXTERNAL_IP: 67.211.221.163\r\n      NETWORK: mainnet\r\n      RP_NETHERMIND_ADDITIONAL_MODULES: \"\"\r\n      RP_NETHERMIND_ADDITIONAL_URLS: \"\"\r\n      RP_NETHERMIND_COMPLETE_HISTORY: \"\"\r\n      RP_NETHERMIND_PRUNE_MEM_SIZE: \"\"\r\n      TTD_OVERRIDE: \"\"\r\n```\r\n* System info - memory, CPU\r\nIntel(R) Xeon(R) CPU E3-1270 V2 3.5GHz 8-core\r\n29GB RAM",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/5576/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/5576/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
