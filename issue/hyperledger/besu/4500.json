{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/4500",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/4500/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/4500/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/4500/events",
  "html_url": "https://github.com/hyperledger/besu/issues/4500",
  "id": 1401763302,
  "node_id": "I_kwDODE2jmc5TjTXm",
  "number": 4500,
  "title": "High Fork Rate since v22.7.3",
  "user": {
    "login": "gitmewai",
    "id": 101709931,
    "node_id": "U_kgDOBg_4aw",
    "avatar_url": "https://avatars.githubusercontent.com/u/101709931?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gitmewai",
    "html_url": "https://github.com/gitmewai",
    "followers_url": "https://api.github.com/users/gitmewai/followers",
    "following_url": "https://api.github.com/users/gitmewai/following{/other_user}",
    "gists_url": "https://api.github.com/users/gitmewai/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gitmewai/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gitmewai/subscriptions",
    "organizations_url": "https://api.github.com/users/gitmewai/orgs",
    "repos_url": "https://api.github.com/users/gitmewai/repos",
    "events_url": "https://api.github.com/users/gitmewai/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gitmewai/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "fab-10",
    "id": 91944855,
    "node_id": "U_kgDOBXr3lw",
    "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fab-10",
    "html_url": "https://github.com/fab-10",
    "followers_url": "https://api.github.com/users/fab-10/followers",
    "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
    "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
    "organizations_url": "https://api.github.com/users/fab-10/orgs",
    "repos_url": "https://api.github.com/users/fab-10/repos",
    "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fab-10/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "fab-10",
      "id": 91944855,
      "node_id": "U_kgDOBXr3lw",
      "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/fab-10",
      "html_url": "https://github.com/fab-10",
      "followers_url": "https://api.github.com/users/fab-10/followers",
      "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
      "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
      "organizations_url": "https://api.github.com/users/fab-10/orgs",
      "repos_url": "https://api.github.com/users/fab-10/repos",
      "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
      "received_events_url": "https://api.github.com/users/fab-10/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-10-08T00:26:43Z",
  "updated_at": "2022-10-13T15:01:41Z",
  "closed_at": "2022-10-13T15:01:41Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nHigh fork rate detected on besu since `v22.7.3` (and the same at `v22.7.5`)\r\n\r\n### Acceptance Criteria\r\nHigh fork rate is not detected before besu `v22.7.2` or earlier\r\n\r\n### Steps to Reproduce (Bug)\r\n1. Upgrade node to besu `v22.7.3` `v22.7.4` or `v22.7.5`\r\n2. collectd reports high fork rate\r\n3. Fallback to `v22.7.2` and high fork rate will not be observed\r\n\r\n**Expected behavior:** Fork rate should not be high\r\n\r\n**Actual behavior:** Fork rate is high with the recent releases\r\nGoerli testnet running `v22.7.3` since 26-Sep-2022:\r\n![image](https://user-images.githubusercontent.com/101709931/194676988-74407fdc-cd45-4abf-969d-7ce136b34c1e.png)\r\n\r\nMainnet just upgraded to `v22.7.3` on 27-Sep-2022, then fallback to `v22.7.2` on the same day, upgraded to `v22.7.5` since 7-Oct-2022:\r\n![image](https://user-images.githubusercontent.com/101709931/194677159-83d45579-4636-4208-948b-7f2ce960fd4f.png)\r\n\r\n**Frequency:** Occurs on all releases since `v22.7.3`\r\n\r\n### Versions (Add all that apply)\r\n* Software version: [`besu --version`] `besu/v22.7.5/linux-x86_64/openjdk-java-11`\r\n* Java version: [`java -version`]\r\n```\r\nopenjdk version \"11.0.16\" 2022-07-19\r\nOpenJDK Runtime Environment (build 11.0.16+8-post-Debian-1deb10u1)\r\nOpenJDK 64-Bit Server VM (build 11.0.16+8-post-Debian-1deb10u1, mixed mode, sharing)\r\n```\r\n* OS Name & Version: [`cat /etc/*release`]\r\n```\r\nPRETTY_NAME=\"Debian GNU/Linux 10 (buster)\"\r\nNAME=\"Debian GNU/Linux\"\r\nVERSION_ID=\"10\"\r\nVERSION=\"10 (buster)\"\r\nVERSION_CODENAME=buster\r\nID=debian\r\nHOME_URL=\"https://www.debian.org/\"\r\nSUPPORT_URL=\"https://www.debian.org/support\"\r\nBUG_REPORT_URL=\"https://bugs.debian.org/\"\r\n```\r\n* Kernel Version: [`uname -a`]\r\n```\r\nLinux besu-node 4.19.0-21-cloud-amd64 #1 SMP Debian 4.19.249-2 (2022-06-30) x86_64 GNU/Linux\r\n```\r\n* Virtual Machine software & version: [`vmware -v`] `N/A`\r\n* Docker Version: [`docker version`] `N/A`\r\n* Cloud VM, type, size: [Amazon Web Services I3-large] \r\n`AWS r5.xlarge` for goerli testnet\r\n`AWS c5.4xlarge` for mainnet\r\n\r\n### Smart contract information (If you're reporting an issue arising from deploying or calling a smart contract, please supply related information)\r\n* Solidity version [`solc --version`] `N/A`\r\n* Repo with minimal set of deployable/reproducible contract code - please provide a link\r\n* Please include specifics on how you are deploying/calling the contract \r\n* Have you reproduced the issue on other eth clients\r\n\r\n### Additional Information (Add any of the following or anything else that may be relevant)\r\n* Besu setup info - genesis file, config options\r\n\r\nBesu config:\r\n```\r\ndata-path=\"/home/besu/besu-data\" # Path\r\nlogging=\"INFO\"\r\ncolor-enabled=false\r\np2p-enabled=true\r\np2p-host=\"x.x.x.x\"\r\np2p-port=30303\r\nmax-peers=30\r\nhost-allowlist=[\"all\"]\r\nengine-host-allowlist=[\"all\"]\r\nengine-jwt-enabled=true\r\nengine-jwt-secret=\"/etc/eth2/jwtsecret\"\r\nnetwork=\"goerli\"\r\nsync-mode=\"full\"\r\nrpc-http-enabled=true\r\nrpc-http-host=\"x.x.x.x\"\r\nrpc-http-port=8545\r\nengine-rpc-enabled=true\r\nengine-rpc-port=8551\r\nrpc-http-api=[\"ADMIN\",\"ETH\",\"NET\",\"PRIV\",\"TRACE\",\"WEB3\",\"TXPOOL\"]\r\nrpc-http-apis=[\"ADMIN\",\"ETH\",\"NET\",\"PRIV\",\"TRACE\",\"WEB3\",\"TXPOOL\"]\r\nrpc-http-cors-origins=[\"*\"]\r\nrpc-http-authentication-enabled=false\r\nprivacy-tls-enabled=false\r\ngraphql-http-enabled=false\r\nrpc-ws-enabled=false\r\nmetrics-enabled=false\r\nminer-enabled=false\r\npruning-enabled=false\r\npermissions-nodes-config-file-enabled=false\r\nprivacy-enabled=false\r\n```\r\n\r\nTeku config:\r\n```\r\nnetwork: \"prater\"\r\np2p-enabled: True\r\np2p-interface: \"x.x.x.x\"\r\np2p-port: 9000\r\np2p-discovery-enabled: True\r\np2p-advertised-ip: \"x.x.x.x\"\r\np2p-advertised-port: 9000\r\ninitial-state: /var/lib/teku/beacon/genesis.ssz\r\neth1-endpoints: [\"http://x.x.x.x:8545\"]\r\nee-endpoint: \"http://x.x.x.x:8551\"\r\nee-jwt-secret-file: \"/etc/eth2/jwtsecret\"\r\nlog-color-enabled: False\r\nlog-include-events-enabled: True\r\nlog-destination: \"both\"\r\nlog-file: \"/var/lib/teku/logs/teku.log\"\r\nlog-file-name-pattern: \"teku_%d{yyyy-MM-dd}.log\"\r\nmetrics-enabled: True\r\nmetrics-categories: [\"BEACON\", \"LIBP2P\", \"NETWORK\", \"EVENTBUS\", \"JVM\", \"PROCESS\"]\r\nmetrics-interface: \"127.0.0.1\"\r\nmetrics-port: 8008\r\ndata-base-path: \"/var/lib/teku\"\r\ndata-beacon-path: \"/var/lib/teku/beacon\"\r\ndata-storage-archive-frequency: 1\r\ndata-storage-mode: \"archive\"\r\nrest-api-port: 5051\r\nrest-api-docs-enabled: False\r\nrest-api-enabled: True\r\nrest-api-interface: \"127.0.0.1\"\r\n```\r\n\r\n* System info - memory, CPU\r\nRunning with teku `Teku version: teku/v22.9.1/linux-x86_64/-debian-openjdk64bitservervm-java-11`\r\n\r\n`pstree -glpt`   ###    for besu and teku processes\r\n```\r\n             ├─java(10580,10580)─┬─{C1 CompilerThre}(10608,10580)\r\n             │                   ├─{C2 CompilerThre}(10607,10580)\r\n             │                   ├─{Common-Cleaner}(10610,10580)\r\n             │                   ├─{EthScheduler-Ti}(10673,10580)\r\n             │                   ├─{Finalizer}(10604,10580)\r\n             │                   ├─{ForkJoinPool.co}(10711,10580)\r\n             │                   ├─{ForkJoinPool.co}(12993,10580)\r\n             │                   ├─{ForkJoinPool.co}(16401,10580)\r\n             │                   ├─{G1 Conc#0}(10599,10580)\r\n             │                   ├─{G1 Main Marker}(10598,10580)\r\n             │                   ├─{G1 Refine#0}(10600,10580)\r\n             │                   ├─{G1 Young RemSet}(10601,10580)\r\n             │                   ├─{GC Thread#0}(10597,10580)\r\n             │                   ├─{GC Thread#1}(10613,10580)\r\n             │                   ├─{GC Thread#2}(10614,10580)\r\n             │                   ├─{GC Thread#3}(10615,10580)\r\n             │                   ├─{JNA Cleaner}(10618,10580)\r\n             │                   ├─{Reference Handl}(10603,10580)\r\n             │                   ├─{Service Thread}(10606,10580)\r\n             │                   ├─{Signal Dispatch}(10605,10580)\r\n             │                   ├─{Sweeper thread}(10609,10580)\r\n             │                   ├─{Timer-0}(10674,10580)\r\n             │                   ├─{VM Periodic Tas}(10611,10580)\r\n             │                   ├─{VM Thread}(10602,10580)\r\n             │                   ├─{dnsjava NIO sel}(10675,10580)\r\n             │                   ├─{java}(10596,10580)\r\n             │                   ├─{java}(10664,10580)\r\n             │                   ├─{nioEventLoopGro}(10676,10580)\r\n             │                   ├─{nioEventLoopGro}(10687,10580)\r\n             │                   ├─{nioEventLoopGro}(10690,10580)\r\n             │                   ├─{nioEventLoopGro}(10702,10580)\r\n             │                   ├─{nioEventLoopGro}(10703,10580)\r\n             │                   ├─{nioEventLoopGro}(10704,10580)\r\n             │                   ├─{nioEventLoopGro}(10705,10580)\r\n             │                   ├─{nioEventLoopGro}(10706,10580)\r\n             │                   ├─{nioEventLoopGro}(10707,10580)\r\n             │                   ├─{nioEventLoopGro}(10708,10580)\r\n             │                   ├─{nioEventLoopGro}(10709,10580)\r\n             │                   ├─{pool-8-thread-1}(10685,10580)\r\n             │                   ├─{rocksdb:high}(10633,10580)\r\n             │                   ├─{rocksdb:low}(10629,10580)\r\n             │                   ├─{rocksdb:low}(10630,10580)\r\n             │                   ├─{rocksdb:low}(10631,10580)\r\n             │                   ├─{rocksdb:low}(10632,10580)\r\n             │                   ├─{vert.x-acceptor}(10672,10580)\r\n             │                   ├─{vert.x-eventloo}(10666,10580)\r\n             │                   ├─{vert.x-eventloo}(10667,10580)\r\n             │                   ├─{vert.x-eventloo}(10669,10580)\r\n             │                   ├─{vert.x-eventloo}(10671,10580)\r\n             │                   ├─{vert.x-eventloo}(10692,10580)\r\n             │                   ├─{vert.x-eventloo}(10713,10580)\r\n             │                   ├─{vert.x-eventloo}(10730,10580)\r\n             │                   ├─{vert.x-eventloo}(10742,10580)\r\n             │                   ├─{vert.x-eventloo}(10747,10580)\r\n             │                   ├─{vert.x-eventloo}(10781,10580)\r\n             │                   ├─{vert.x-eventloo}(10910,10580)\r\n             │                   ├─{vert.x-eventloo}(10926,10580)\r\n             │                   ├─{vert.x-eventloo}(26942,10580)\r\n             │                   ├─{vert.x-worker-t}(10678,10580)\r\n             │                   ├─{vert.x-worker-t}(10679,10580)\r\n             │                   ├─{vert.x-worker-t}(10680,10580)\r\n             │                   ├─{vert.x-worker-t}(10681,10580)\r\n             │                   ├─{vert.x-worker-t}(10682,10580)\r\n             │                   ├─{vert.x-worker-t}(10683,10580)\r\n             │                   ├─{vert.x-worker-t}(10684,10580)\r\n             │                   ├─{vert.x-worker-t}(10686,10580)\r\n             │                   ├─{vert.x-worker-t}(10688,10580)\r\n             │                   ├─{vert.x-worker-t}(10689,10580)\r\n             │                   ├─{vert.x-worker-t}(10691,10580)\r\n             │                   ├─{vert.x-worker-t}(10693,10580)\r\n             │                   ├─{vert.x-worker-t}(10694,10580)\r\n             │                   ├─{vert.x-worker-t}(10695,10580)\r\n             │                   ├─{vert.x-worker-t}(10696,10580)\r\n             │                   ├─{vert.x-worker-t}(10697,10580)\r\n             │                   ├─{vert.x-worker-t}(10698,10580)\r\n             │                   ├─{vert.x-worker-t}(10699,10580)\r\n             │                   ├─{vert.x-worker-t}(10700,10580)\r\n             │                   ├─{vert.x-worker-t}(10701,10580)\r\n             │                   ├─{vert.x-worker-t}(10712,10580)\r\n             │                   ├─{vertx-blocked-t}(10619,10580)\r\n             │                   ├─{vertx-blocked-t}(10668,10580)\r\n             │                   └─{vertx-blocked-t}(10670,10580)\r\n             ├─java(747,747)─┬─{AggregatingSign}(3122,747)\r\n             │               ├─{AggregatingSign}(3123,747)\r\n             │               ├─{BlockGossipChan}(3182,747)\r\n             │               ├─{BlockImportChan}(2792,747)\r\n             │               ├─{BlockImportNoti}(2789,747)\r\n             │               ├─{BlockImportNoti}(2793,747)\r\n             │               ├─{C1 CompilerThre}(1157,747)\r\n             │               ├─{C2 CompilerThre}(1156,747)\r\n             │               ├─{ChainHeadChanne}(2849,747)\r\n             │               ├─{ChainHeadChanne}(2871,747)\r\n             │               ├─{ChainHeadChanne}(3120,747)\r\n             │               ├─{ChainHeadChanne}(3202,747)\r\n             │               ├─{CombinedStorage}(2213,747)\r\n             │               ├─{Common-Cleaner}(1160,747)\r\n             │               ├─{CompletableFutu}(2231,747)\r\n             │               ├─{Connector-Sched}(4436,747)\r\n             │               ├─{Eth1DepositStor}(2214,747)\r\n             │               ├─{Eth1EventsChann}(2216,747)\r\n             │               ├─{Eth1EventsChann}(2780,747)\r\n             │               ├─{ExecutionLayerC}(2219,747)\r\n             │               ├─{FinalizedCheckp}(2781,747)\r\n             │               ├─{FinalizedCheckp}(2788,747)\r\n             │               ├─{FinalizedCheckp}(2790,747)\r\n             │               ├─{FinalizedCheckp}(2872,747)\r\n             │               ├─{Finalizer}(1152,747)\r\n             │               ├─{ForkJoinPool.co}(2651,747)\r\n             │               ├─{ForkJoinPool.co}(2652,747)\r\n             │               ├─{ForkJoinPool.co}(2653,747)\r\n             │               ├─{G1 Conc#0}(1147,747)\r\n             │               ├─{G1 Main Marker}(1146,747)\r\n             │               ├─{G1 Refine#0}(1148,747)\r\n             │               ├─{G1 Refine#1}(1181,747)\r\n             │               ├─{G1 Refine#2}(1182,747)\r\n             │               ├─{G1 Refine#3}(2458,747)\r\n             │               ├─{G1 Young RemSet}(1149,747)\r\n             │               ├─{GC Thread#0}(1145,747)\r\n             │               ├─{GC Thread#1}(1178,747)\r\n             │               ├─{GC Thread#2}(1179,747)\r\n             │               ├─{GC Thread#3}(1180,747)\r\n             │               ├─{GossipRouter-ev}(2827,747)\r\n             │               ├─{OkHttp TaskRunn}(20012,747)\r\n             │               ├─{OkHttp TaskRunn}(28340,747)\r\n             │               ├─{Okio Watchdog}(2794,747)\r\n             │               ├─{QuartzScheduler}(2225,747)\r\n             │               ├─{Reference Handl}(1151,747)\r\n             │               ├─{RejectedExecuti}(3206,747)\r\n             │               ├─{RejectedExecuti}(3337,747)\r\n             │               ├─{RxCachedWorkerP}(1400,747)\r\n             │               ├─{RxSchedulerPurg}(1399,747)\r\n             │               ├─{Service Thread}(1155,747)\r\n             │               ├─{Session-HouseKe}(3187,747)\r\n             │               ├─{Signal Dispatch}(1154,747)\r\n             │               ├─{SlotEventsChann}(2218,747)\r\n             │               ├─{SlotEventsChann}(2459,747)\r\n             │               ├─{SlotEventsChann}(2775,747)\r\n             │               ├─{SlotEventsChann}(2785,747)\r\n             │               ├─{SlotEventsChann}(2786,747)\r\n             │               ├─{SlotEventsChann}(2791,747)\r\n             │               ├─{SlotEventsChann}(2797,747)\r\n             │               ├─{SlotEventsChann}(2798,747)\r\n             │               ├─{SlotEventsChann}(2847,747)\r\n             │               ├─{SlotEventsChann}(2848,747)\r\n             │               ├─{SlotEventsChann}(2851,747)\r\n             │               ├─{SlotEventsChann}(2853,747)\r\n             │               ├─{SlotEventsChann}(2855,747)\r\n             │               ├─{SlotEventsChann}(2857,747)\r\n             │               ├─{Sweeper thread}(1158,747)\r\n             │               ├─{TimeTick-1}(2224,747)\r\n             │               ├─{VM Periodic Tas}(1159,747)\r\n             │               ├─{VM Thread}(1150,747)\r\n             │               ├─{ValidatorApiCha}(2854,747)\r\n             │               ├─{ValidatorTiming}(3200,747)\r\n             │               ├─{VoteUpdateChann}(2217,747)\r\n             │               ├─{beaconchain-asy}(2227,747)\r\n             │               ├─{beaconchain-asy}(2457,747)\r\n             │               ├─{beaconchain-asy}(2462,747)\r\n             │               ├─{beaconchain-asy}(2464,747)\r\n             │               ├─{beaconchain-asy}(2472,747)\r\n             │               ├─{beaconchain-asy}(3141,747)\r\n             │               ├─{discovery-clien}(3191,747)\r\n             │               ├─{discovery-expir}(3151,747)\r\n             │               ├─{discovery-tasks}(3149,747)\r\n             │               ├─{forkChoiceNotif}(2771,747)\r\n             │               ├─{forkchoice-asyn}(2765,747)\r\n             │               ├─{java}(1143,747)\r\n             │               ├─{java}(2199,747)\r\n             │               ├─{nioEventLoopGro}(3136,747)\r\n             │               ├─{nioEventLoopGro}(3140,747)\r\n             │               ├─{nioEventLoopGro}(3152,747)\r\n             │               ├─{nioEventLoopGro}(3153,747)\r\n             │               ├─{nioEventLoopGro}(3154,747)\r\n             │               ├─{nioEventLoopGro}(3195,747)\r\n             │               ├─{nioEventLoopGro}(3235,747)\r\n             │               ├─{nioEventLoopGro}(3298,747)\r\n             │               ├─{nioEventLoopGro}(3344,747)\r\n             │               ├─{nioEventLoopGro}(3381,747)\r\n             │               ├─{p2p-async-0}(3183,747)\r\n             │               ├─{p2p-async-1}(3220,747)\r\n             │               ├─{p2p-async-2}(3234,747)\r\n             │               ├─{p2p-async-3}(3238,747)\r\n             │               ├─{p2p-async-4}(3247,747)\r\n             │               ├─{p2p-async-5}(3248,747)\r\n             │               ├─{p2p-async-6}(3252,747)\r\n             │               ├─{p2p-async-7}(3255,747)\r\n             │               ├─{p2p-async-8}(3284,747)\r\n             │               ├─{p2p-async-9}(3288,747)\r\n             │               ├─{p2p-async-sched}(3170,747)\r\n             │               ├─{pool-3-thread-2}(32120,747)\r\n             │               ├─{pool-3-thread-2}(5570,747)\r\n             │               ├─{pool-3-thread-2}(3128,747)\r\n             │               ├─{powchain-async-}(3198,747)\r\n             │               ├─{powchain-async-}(3205,747)\r\n             │               ├─{powchain-async-}(3219,747)\r\n             │               ├─{powchain-async-}(3223,747)\r\n             │               ├─{powchain-async-}(31914,747)\r\n             │               ├─{powchain-async-}(30222,747)\r\n             │               ├─{qtp1543664490-9}(3168,747)\r\n             │               ├─{qtp1543664490-9}(3171,747)\r\n             │               ├─{qtp1543664490-9}(3172,747)\r\n             │               ├─{qtp1543664490-9}(3175,747)\r\n             │               ├─{qtp1543664490-9}(3176,747)\r\n             │               ├─{qtp1543664490-9}(3177,747)\r\n             │               ├─{qtp1543664490-9}(3178,747)\r\n             │               ├─{qtp1543664490-9}(3179,747)\r\n             │               ├─{storage_query-a}(6094,747)\r\n             │               ├─{storage_query-a}(6310,747)\r\n             │               ├─{storage_query-a}(8570,747)\r\n             │               ├─{storage_query-a}(8608,747)\r\n             │               ├─{storage_query-a}(11179,747)\r\n             │               ├─{storage_query-a}(11296,747)\r\n             │               ├─{storage_query-a}(18059,747)\r\n             │               ├─{storage_query-a}(18930,747)\r\n             │               ├─{storage_query-a}(18957,747)\r\n             │               ├─{storage_query-a}(19624,747)\r\n             │               ├─{sync-async-0}(3236,747)\r\n             │               ├─{validator-async}(3201,747)\r\n             │               ├─{validator-async}(3204,747)\r\n             │               ├─{validator-async}(3456,747)\r\n             │               ├─{validator-async}(3461,747)\r\n             │               ├─{validator-async}(3552,747)\r\n             │               ├─{validator-async}(3632,747)\r\n             │               ├─{vert.x-acceptor}(1407,747)\r\n             │               ├─{vert.x-eventloo}(1408,747)\r\n             │               └─{vertx-blocked-t}(1349,747)\r\n```",
  "closed_by": {
    "login": "fab-10",
    "id": 91944855,
    "node_id": "U_kgDOBXr3lw",
    "avatar_url": "https://avatars.githubusercontent.com/u/91944855?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/fab-10",
    "html_url": "https://github.com/fab-10",
    "followers_url": "https://api.github.com/users/fab-10/followers",
    "following_url": "https://api.github.com/users/fab-10/following{/other_user}",
    "gists_url": "https://api.github.com/users/fab-10/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/fab-10/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/fab-10/subscriptions",
    "organizations_url": "https://api.github.com/users/fab-10/orgs",
    "repos_url": "https://api.github.com/users/fab-10/repos",
    "events_url": "https://api.github.com/users/fab-10/events{/privacy}",
    "received_events_url": "https://api.github.com/users/fab-10/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/4500/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/4500/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1272765007",
    "html_url": "https://github.com/hyperledger/besu/issues/4500#issuecomment-1272765007",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4500",
    "id": 1272765007,
    "node_id": "IC_kwDODE2jmc5L3NpP",
    "user": {
      "login": "gitmewai",
      "id": 101709931,
      "node_id": "U_kgDOBg_4aw",
      "avatar_url": "https://avatars.githubusercontent.com/u/101709931?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gitmewai",
      "html_url": "https://github.com/gitmewai",
      "followers_url": "https://api.github.com/users/gitmewai/followers",
      "following_url": "https://api.github.com/users/gitmewai/following{/other_user}",
      "gists_url": "https://api.github.com/users/gitmewai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gitmewai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gitmewai/subscriptions",
      "organizations_url": "https://api.github.com/users/gitmewai/orgs",
      "repos_url": "https://api.github.com/users/gitmewai/repos",
      "events_url": "https://api.github.com/users/gitmewai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gitmewai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-10T04:15:04Z",
    "updated_at": "2022-10-10T04:15:04Z",
    "author_association": "NONE",
    "body": "Please note that the issue persists at the latest `v22.7.6` release",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1272765007/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1274859845",
    "html_url": "https://github.com/hyperledger/besu/issues/4500#issuecomment-1274859845",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4500",
    "id": 1274859845,
    "node_id": "IC_kwDODE2jmc5L_NFF",
    "user": {
      "login": "ahamlat",
      "id": 5099602,
      "node_id": "MDQ6VXNlcjUwOTk2MDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5099602?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahamlat",
      "html_url": "https://github.com/ahamlat",
      "followers_url": "https://api.github.com/users/ahamlat/followers",
      "following_url": "https://api.github.com/users/ahamlat/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahamlat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahamlat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahamlat/subscriptions",
      "organizations_url": "https://api.github.com/users/ahamlat/orgs",
      "repos_url": "https://api.github.com/users/ahamlat/repos",
      "events_url": "https://api.github.com/users/ahamlat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahamlat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-11T15:14:26Z",
    "updated_at": "2022-10-11T15:25:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for reporting @gitmewai. \r\nThe metric displayed by Collectd is the one in /proc/stat, that we can also display with vmstat -f.\r\nI was able to reproduce, I'm looking into this to understand what causes this metric to grow that fast.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1274859845/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1275524210",
    "html_url": "https://github.com/hyperledger/besu/issues/4500#issuecomment-1275524210",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4500",
    "id": 1275524210,
    "node_id": "IC_kwDODE2jmc5MBvRy",
    "user": {
      "login": "gitmewai",
      "id": 101709931,
      "node_id": "U_kgDOBg_4aw",
      "avatar_url": "https://avatars.githubusercontent.com/u/101709931?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gitmewai",
      "html_url": "https://github.com/gitmewai",
      "followers_url": "https://api.github.com/users/gitmewai/followers",
      "following_url": "https://api.github.com/users/gitmewai/following{/other_user}",
      "gists_url": "https://api.github.com/users/gitmewai/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gitmewai/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gitmewai/subscriptions",
      "organizations_url": "https://api.github.com/users/gitmewai/orgs",
      "repos_url": "https://api.github.com/users/gitmewai/repos",
      "events_url": "https://api.github.com/users/gitmewai/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gitmewai/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-12T03:09:20Z",
    "updated_at": "2022-10-12T03:09:20Z",
    "author_association": "NONE",
    "body": "This is what we observed from the system log @ahamlat :\r\n```\r\nOct 11 18:15:09 besu-node besu[847]: 2022-10-11 18:15:09.656+00:00 | vertx-blocked-thread-checker | WARN  | BlockedThreadChecker | Thread Thread[vert.x-worker-thread-14,5,main] has been blocked for 20195242 ms, time limit is 60000 ms\r\nOct 11 18:15:09 besu-node besu[847]: io.vertx.core.VertxException: Thread blocked\r\nOct 11 18:15:09 besu-node besu[847]:         at java.base@11.0.16/jdk.internal.misc.Unsafe.park(Native Method)\r\nOct 11 18:15:09 besu-node besu[847]:         at java.base@11.0.16/java.util.concurrent.locks.LockSupport.park(LockSupport.java:194)\r\nOct 11 18:15:09 besu-node besu[847]:         at java.base@11.0.16/java.util.concurrent.CompletableFuture$Signaller.block(CompletableFuture.java:1796)\r\nOct 11 18:15:09 besu-node besu[847]:         at java.base@11.0.16/java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3128)\r\nOct 11 18:15:09 besu-node besu[847]:         at java.base@11.0.16/java.util.concurrent.CompletableFuture.waitingGet(CompletableFuture.java:1823)\r\nOct 11 18:15:09 besu-node besu[847]:         at java.base@11.0.16/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1998)\r\nOct 11 18:15:09 besu-node besu[847]:         at app//org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.ExecutionEngineJsonRpcMethod.response(ExecutionEngineJsonRpcMethod.java:89)\r\nOct 11 18:15:09 besu-node besu[847]:         at app//org.hyperledger.besu.ethereum.api.jsonrpc.execution.BaseJsonRpcProcessor.process(BaseJsonRpcProcessor.java:42)\r\nOct 11 18:15:09 besu-node besu[847]:         at app//org.hyperledger.besu.ethereum.api.jsonrpc.execution.TracedJsonRpcProcessor.process(TracedJsonRpcProcessor.java:41)\r\nOct 11 18:15:09 besu-node besu[847]:         at app//org.hyperledger.besu.ethereum.api.jsonrpc.execution.TimedJsonRpcProcessor.process(TimedJsonRpcProcessor.java:45)\r\nOct 11 18:15:09 besu-node besu[847]:         at app//org.hyperledger.besu.ethereum.api.jsonrpc.execution.AuthenticatedJsonRpcProcessor.process(AuthenticatedJsonRpcProcessor.java:51)\r\nOct 11 18:15:09 besu-node besu[847]:         at app//org.hyperledger.besu.ethereum.api.jsonrpc.execution.JsonRpcExecutor.execute(JsonRpcExecutor.java:91)\r\nOct 11 18:15:09 besu-node besu[847]:         at app//org.hyperledger.besu.ethereum.api.handlers.JsonRpcExecutorHandler.lambda$handler$8(JsonRpcExecutorHandler.java:79)\r\nOct 11 18:15:09 besu-node besu[847]:         at app//org.hyperledger.besu.ethereum.api.handlers.JsonRpcExecutorHandler$$Lambda$760/0x0000000840509c40.handle(Unknown Source)\r\nOct 11 18:15:09 besu-node besu[847]:         at app//io.vertx.ext.web.impl.BlockingHandlerDecorator.lambda$handle$0(BlockingHandlerDecorator.java:48)\r\nOct 11 18:15:09 besu-node besu[847]:         at app//io.vertx.ext.web.impl.BlockingHandlerDecorator$$Lambda$1098/0x000000084069c040.handle(Unknown Source)\r\nOct 11 18:15:09 besu-node besu[847]:         at app//io.vertx.core.impl.ContextImpl.lambda$null$0(ContextImpl.java:159)\r\nOct 11 18:15:09 besu-node besu[847]:         at app//io.vertx.core.impl.ContextImpl$$Lambda$975/0x0000000840612c40.handle(Unknown Source)\r\nOct 11 18:15:09 besu-node besu[847]:         at app//io.vertx.core.impl.AbstractContext.dispatch(AbstractContext.java:100)\r\nOct 11 18:15:09 besu-node besu[847]:         at app//io.vertx.core.impl.ContextImpl.lambda$executeBlocking$1(ContextImpl.java:157)\r\nOct 11 18:15:09 besu-node besu[847]:         at app//io.vertx.core.impl.ContextImpl$$Lambda$972/0x0000000840613840.run(Unknown Source)\r\nOct 11 18:15:09 besu-node besu[847]:         at java.base@11.0.16/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\nOct 11 18:15:09 besu-node besu[847]:         at java.base@11.0.16/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\nOct 11 18:15:09 besu-node besu[847]:         at app//io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\nOct 11 18:15:09 besu-node besu[847]:         at java.base@11.0.16/java.lang.Thread.run(Thread.java:829)\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1275524210/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1275733702",
    "html_url": "https://github.com/hyperledger/besu/issues/4500#issuecomment-1275733702",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4500",
    "id": 1275733702,
    "node_id": "IC_kwDODE2jmc5MCibG",
    "user": {
      "login": "ahamlat",
      "id": 5099602,
      "node_id": "MDQ6VXNlcjUwOTk2MDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5099602?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahamlat",
      "html_url": "https://github.com/ahamlat",
      "followers_url": "https://api.github.com/users/ahamlat/followers",
      "following_url": "https://api.github.com/users/ahamlat/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahamlat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahamlat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahamlat/subscriptions",
      "organizations_url": "https://api.github.com/users/ahamlat/orgs",
      "repos_url": "https://api.github.com/users/ahamlat/repos",
      "events_url": "https://api.github.com/users/ahamlat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahamlat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-12T07:45:43Z",
    "updated_at": "2022-10-12T08:54:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "I don't think it is related @gitmewai. The log you showed just tells us that there is an engine RPC call taking a very long time, so the CompletableFuture is blocked on get method waiting for the Async call to complete. I think we should improve that  and add a timeout to avoid blocking for a very long time. \r\nThe only impact I was able to see with these forks was on context switches and interrupts which makes sens.\r\n\r\n<img width=\"811\" alt=\"image\" src=\"https://user-images.githubusercontent.com/5099602/195281220-648e47bd-ede6-478d-91c7-bcf926f2b1bb.png\">\r\n\r\n<img width=\"811\" alt=\"image\" src=\"https://user-images.githubusercontent.com/5099602/195281544-70fee5de-6b42-453f-9362-608d9f8bf2b8.png\">\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1275733702/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1277227589",
    "html_url": "https://github.com/hyperledger/besu/issues/4500#issuecomment-1277227589",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4500",
    "id": 1277227589,
    "node_id": "IC_kwDODE2jmc5MIPJF",
    "user": {
      "login": "ahamlat",
      "id": 5099602,
      "node_id": "MDQ6VXNlcjUwOTk2MDI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5099602?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ahamlat",
      "html_url": "https://github.com/ahamlat",
      "followers_url": "https://api.github.com/users/ahamlat/followers",
      "following_url": "https://api.github.com/users/ahamlat/following{/other_user}",
      "gists_url": "https://api.github.com/users/ahamlat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ahamlat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ahamlat/subscriptions",
      "organizations_url": "https://api.github.com/users/ahamlat/orgs",
      "repos_url": "https://api.github.com/users/ahamlat/repos",
      "events_url": "https://api.github.com/users/ahamlat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ahamlat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-13T08:23:02Z",
    "updated_at": "2022-10-13T08:23:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "@gitmewai We found the root cause of these fork processes, they're actually very short living threads created in our transactions and workers ThreadPoolExecutors.\r\nBy doing [Wall clock profiling](https://github.com/jvm-profiling-tools/async-profiler/wiki/Wall-clock-profiling) with Async Profiler, I was able to see very short lived threads, with this name pattern : EthScheduler-Transactions-id.\r\n\r\n<img width=\"1271\" alt=\"image\" src=\"https://user-images.githubusercontent.com/5099602/195542121-537d5ae2-1332-4f19-97e3-38178f60cdef.png\">\r\n\r\n\r\n[In this code line](https://github.com/hyperledger/besu/blob/main/ethereum/eth/src/main/java/org/hyperledger/besu/ethereum/eth/manager/MonitoredExecutors.java#L50), We're creating a ThreadPoolExecutor with coreSize=0 and keepAliveTime=0, this means for each execution, a new thread is created.\r\nBy changing coreSize parameter, we can see less fork processes (threads in this case) :\r\n\r\n<img width=\"1265\" alt=\"image\" src=\"https://user-images.githubusercontent.com/5099602/195542462-2dad21aa-7440-431a-8fad-4c90b1800fb9.png\">\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1277227589/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
