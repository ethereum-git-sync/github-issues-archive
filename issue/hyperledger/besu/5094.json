{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/5094",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/5094/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/5094/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/5094/events",
  "html_url": "https://github.com/hyperledger/besu/issues/5094",
  "id": 1584934845,
  "node_id": "I_kwDODE2jmc5eeC-9",
  "number": 5094,
  "title": "Investigate why we couldn't automatically recover from bad block",
  "user": {
    "login": "siladu",
    "id": 2893793,
    "node_id": "MDQ6VXNlcjI4OTM3OTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/siladu",
    "html_url": "https://github.com/siladu",
    "followers_url": "https://api.github.com/users/siladu/followers",
    "following_url": "https://api.github.com/users/siladu/following{/other_user}",
    "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
    "organizations_url": "https://api.github.com/users/siladu/orgs",
    "repos_url": "https://api.github.com/users/siladu/repos",
    "events_url": "https://api.github.com/users/siladu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/siladu/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1921587647,
      "node_id": "MDU6TGFiZWwxOTIxNTg3NjQ3",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamGroot",
      "name": "TeamGroot",
      "color": "1d76db",
      "default": false,
      "description": "GH issues worked on by Groot Team"
    },
    {
      "id": 3013559202,
      "node_id": "MDU6TGFiZWwzMDEzNTU5MjAy",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/mainnet",
      "name": "mainnet",
      "color": "9D578C",
      "default": false,
      "description": ""
    },
    {
      "id": 3372108177,
      "node_id": "MDU6TGFiZWwzMzcyMTA4MTc3",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/EIP",
      "name": "EIP",
      "color": "006b75",
      "default": false,
      "description": "Ethereum Improvement Proposal"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "siladu",
    "id": 2893793,
    "node_id": "MDQ6VXNlcjI4OTM3OTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/siladu",
    "html_url": "https://github.com/siladu",
    "followers_url": "https://api.github.com/users/siladu/followers",
    "following_url": "https://api.github.com/users/siladu/following{/other_user}",
    "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
    "organizations_url": "https://api.github.com/users/siladu/orgs",
    "repos_url": "https://api.github.com/users/siladu/repos",
    "events_url": "https://api.github.com/users/siladu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/siladu/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2023-02-14T22:40:49Z",
  "updated_at": "2023-02-22T08:13:42Z",
  "closed_at": "2023-02-22T08:13:23Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Restarting besu recovered this node (presumably by clearing the bad block cache)\r\n\r\nwithdrawal-devnet-7-lodestar-besu-2\r\n\r\n```\r\n2023-02-14 11:07:26.845+00:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineForkchoiceUpdated | VALID for fork-choice-update: head: 0xad2a20b926f3fed3a5eaca74ad7bc871b884795e3daa6a5d0adeb9c70bb94171, finalized: 0x91aaad4049972ce7652bcd3578b50b9e5babfb63eb1f61581ac8c0396800539b, safeBlockHash: 0xc2069a31a17c07bd84e29f09ccc3aad65e7c9dac8bc37acf2cf5e022ce878cf7\r\n2023-02-14 11:07:36.685+00:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineNewPayload | Imported #614 / 6 tx / base fee 7 wei / 324,673 (1.1%) gas / (0x7cd07f56b3456571700a4b682221070c00637f1f8862952aed0435158348940f) in 0.008s. Peers: 29\r\n2023-02-14 11:08:00.448+00:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineNewPayload | Imported #615 / 4 tx / base fee 7 wei / 214,405 (0.7%) gas / (0x257b373dd605c65ef1bb61324c912d1c6522e130e4afa13041db9e1050144667) in 0.003s. Peers: 30\r\n2023-02-14 11:08:12.344+00:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineNewPayload | Imported #616 / 8 tx / base fee 7 wei / 434,882 (1.4%) gas / (0x7cfd756ed04b64d68c35c4ed965ae3b4d0804f70f64eafbb3abfaa8ab41a14fd) in 0.006s. Peers: 29\r\n2023-02-14 11:08:13.626+00:00 | PoS-Block-Builder-0 | INFO  | AbstractBlockProcessor | Block processing error: transaction invalid transaction nonce 1848 below sender account nonce 1856. Block 0xd4ff381bb41109fb4396d3a1b5807896fbec260291f2b4b8cb97f29f404490b7 Transaction 0xaccca88128b365ddf31a7f074aaad1817f66c246cd66b6282022d2aa1b5965e8\r\n2023-02-14 11:08:13.627+00:00 | PoS-Block-Builder-0 | INFO  | MainnetBlockValidator | Invalid block 616 (0xd4ff381bb41109fb4396d3a1b5807896fbec260291f2b4b8cb97f29f404490b7): Optional[Block processing error: transaction invalid transaction nonce 1848 below sender account nonce 1856. Block 0xd4ff381bb41109fb4396d3a1b5807896fbec260291f2b4b8cb97f29f404490b7 Transaction 0xaccca88128b365ddf31a7f074aaad1817f66c246cd66b6282022d2aa1b5965e8]\r\n2023-02-14 11:08:13.627+00:00 | PoS-Block-Builder-0 | WARN  | MergeCoordinator | Block 0xd4ff381bb41109fb4396d3a1b5807896fbec260291f2b4b8cb97f29f404490b7 built for proposal identified by 0x00540b0f0717b164, is not valid reason Optional[Block processing error: transaction invalid transaction nonce 1848 below sender account nonce 1856. Block 0xd4ff381bb41109fb4396d3a1b5807896fbec260291f2b4b8cb97f29f404490b7 Transaction 0xaccca88128b365ddf31a7f074aaad1817f66c246cd66b6282022d2aa1b5965e8]\r\n2023-02-14 11:08:13.632+00:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineGetPayload | Fetch block proposal by identifier: 0x00540b0f0717b164, hash: 0xd4ff381bb41109fb4396d3a1b5807896fbec260291f2b4b8cb97f29f404490b7, number: 616, coinbase: 0xf97e180c050e5ab072211ad2c213eb5aee4df134, transaction count: 1\r\n2023-02-14 11:08:13.987+00:00 | vert.x-worker-thread-0 | WARN  | AbstractEngineNewPayload | Invalid new payload: number: 616, hash: 0xd4ff381bb41109fb4396d3a1b5807896fbec260291f2b4b8cb97f29f404490b7, parentHash: 0x257b373dd605c65ef1bb61324c912d1c6522e130e4afa13041db9e1050144667, latestValidHash: 0x0000000000000000000000000000000000000000000000000000000000000000, status: INVALID, validationError: Block already present in bad block manager.\r\n2023-02-14 11:09:12.629+00:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineForkchoiceUpdated | INVALID for fork-choice-update: head: 0xcb346eb981ece0d69e0f2fbb43e4356b9590c1eb5b8b57918bc04e75267a9450, finalized: 0x670555653f86bc045878d2e23e939dd5dd76675fc7db36e49d7437a74ace3191, safeBlockHash: 0x670555653f86bc045878d2e23e939dd5dd76675fc7db36e49d7437a74ace3191\r\n2023-02-14 11:10:12.687+00:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineForkchoiceUpdated | INVALID for fork-choice-update: head: 0xf98d24915c1dca090c4ee029c2b4aacba1eecda00e00cd17a6dc75558721b55d, finalized: 0xe224bcb28c585b14254f6879c76662a87747e05e20c4a750f102a93271ad1d4e, safeBlockHash: 0xb02d8e8cbbd9e7b25f5a33664b54ed426e1f051357ec62e718eb7c8277611a7d\r\n2023-02-14 11:11:02.557+00:00 | vert.x-worker-thread-0 | WARN  | AbstractEngineNewPayload | Invalid new payload: number: 616, hash: 0xd4ff381bb41109fb4396d3a1b5807896fbec260291f2b4b8cb97f29f404490b7, parentHash: 0x257b373dd605c65ef1bb61324c912d1c6522e130e4afa13041db9e1050144667, latestValidHash: 0x0000000000000000000000000000000000000000000000000000000000000000, status: INVALID, validationError: Block already present in bad block manager.\r\n2023-02-14 11:12:00.227+00:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineForkchoiceUpdated | INVALID for fork-choice-update: head: 0xcb346eb981ece0d69e0f2fbb43e4356b9590c1eb5b8b57918bc04e75267a9450, finalized: 0x670555653f86bc045878d2e23e939dd5dd76675fc7db36e49d7437a74ace3191, safeBlockHash: 0x670555653f86bc045878d2e23e939dd5dd76675fc7db36e49d7437a74ace3191\r\n2023-02-14 11:13:00.304+00:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineForkchoiceUpdated | INVALID for fork-choice-update: head: 0x79d3517d5a692bf7373f66b7e6729e095813febbf182bba8ec44b6cdf167ef80, finalized: 0xe224bcb28c585b14254f6879c76662a87747e05e20c4a750f102a93271ad1d4e, safeBlockHash: 0xb02d8e8cbbd9e7b25f5a33664b54ed426e1f051357ec62e718eb7c8277611a7d\r\n2023-02-14 11:14:12.358+00:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineForkchoiceUpdated | INVALID for fork-choice-update: head: 0xd465427f81f4487d3e0050970dd5b0efb9d5c98b7abae36be939512633a2fb14, finalized: 0xc904a81f36ad6e5ec5fb6c87b4c4aadf58ec91ef0c579fddd3c322ca8f3d5782, safeBlockHash: 0x89e32ed86356dee2b5d1791ebb6dcec1bc8ed48fa38162142183f5b24973a640\r\n2023-02-14 11:14:34.824+00:00 | vert.x-worker-thread-0 | WARN  | AbstractEngineNewPayload | Invalid new payload: number: 616, hash: 0xd4ff381bb41109fb4396d3a1b5807896fbec260291f2b4b8cb97f29f404490b7, parentHash: 0x257b373dd605c65ef1bb61324c912d1c6522e130e4afa13041db9e1050144667, latestValidHash: 0x0000000000000000000000000000000000000000000000000000000000000000, status: INVALID, validationError: Block already present in bad block manager.\r\n2023-02-14 11:15:25.995+00:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineForkchoiceUpdated | INVALID for fork-choice-update: head: 0xcb346eb981ece0d69e0f2fbb43e4356b9590c1eb5b8b57918bc04e75267a9450, finalized: 0x670555653f86bc045878d2e23e939dd5dd76675fc7db36e49d7437a74ace3191, safeBlockHash: 0x670555653f86bc045878d2e23e939dd5dd76675fc7db36e49d7437a74ace3191\r\n2023-02-14 11:16:26.073+00:00 | vert.x-worker-thread-0 | INFO  | AbstractEngineForkchoiceUpdated | INVALID for fork-choice-update: head: 0x2cb05f0ce1b115e1d62bab809d01a22a6eff88a911c4ae17774871565021f59c, finalized: 0x206e64ea5d13d95850dd38a6fce5eebca24faf7d8b8d05ab38f1d43f1386ba1b, safeBlockHash: 0xe224bcb28c585b14254f6879c76662a87747e05e20c4a750f102a93271ad1d4e\r\n```",
  "closed_by": {
    "login": "siladu",
    "id": 2893793,
    "node_id": "MDQ6VXNlcjI4OTM3OTM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/siladu",
    "html_url": "https://github.com/siladu",
    "followers_url": "https://api.github.com/users/siladu/followers",
    "following_url": "https://api.github.com/users/siladu/following{/other_user}",
    "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
    "organizations_url": "https://api.github.com/users/siladu/orgs",
    "repos_url": "https://api.github.com/users/siladu/repos",
    "events_url": "https://api.github.com/users/siladu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/siladu/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/5094/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/5094/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1430755992",
    "html_url": "https://github.com/hyperledger/besu/issues/5094#issuecomment-1430755992",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5094",
    "id": 1430755992,
    "node_id": "IC_kwDODE2jmc5VR5qY",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-15T04:58:16Z",
    "updated_at": "2023-02-15T05:02:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "Notes:\n\n[Besu 23.1.1-dev-56ae1fcf](https://github.com/hyperledger/besu/commit/56ae1fcf)\n\nIn the snooper logs, we are getting a lot of eth_getBlockByNumber, bit weird how it's an array too...\n```\nFeb 15 00:19:35.040 2023 WARNING: request not formatted as JSON-RPC request [invalid type: map, expected u64 at line 2 column 2]:\n[\n  {\n    \"jsonrpc\": \"2.0\",\n    \"method\": \"eth_getBlockByNumber\",\n    \"params\": [\n      \"0xa7\",\n      false\n    ],\n    \"id\": 4591221\n  },\n  {\n    \"jsonrpc\": \"2.0\",\n    \"method\": \"eth_getBlockByNumber\",\n    \"params\": [\n      \"0xa8\",\n      false\n    ],\n    \"id\": 4591222\n  },\n```",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1430755992/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1430780657",
    "html_url": "https://github.com/hyperledger/besu/issues/5094#issuecomment-1430780657",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5094",
    "id": 1430780657,
    "node_id": "IC_kwDODE2jmc5VR_rx",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-15T05:33:03Z",
    "updated_at": "2023-02-15T05:38:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "We invalidated our block during building...I'm surprised we don't filter these transactions out from the txpool before this.\n\n`2023-02-14 11:08:13.626+00:00 | PoS-Block-Builder-0 | INFO  | AbstractBlockProcessor | Block processing error: transaction invalid transaction nonce 1848 below sender account nonce 1856. Block 0xd4ff381bb41109fb4396d3a1b5807896fbec260291f2b4b8cb97f29f404490b7 Transaction 0xaccca88128b365ddf31a7f074aaad1817f66c246cd66b6282022d2aa1b5965e8`\n\n`2023-02-14 11:08:13.627+00:00 | PoS-Block-Builder-0 | INFO  | MainnetBlockValidator | Invalid block 616 (0xd4ff381bb41109fb4396d3a1b5807896fbec260291f2b4b8cb97f29f404490b7): Optional[Block processing error: transaction invalid transaction nonce 1848 below sender account nonce 1856. Block 0xd4ff381bb41109fb4396d3a1b5807896fbec260291f2b4b8cb97f29f404490b7 Transaction 0xaccca88128b365ddf31a7f074aaad1817f66c246cd66b6282022d2aa1b5965e8]`\n\nHowever, this transaction was included in a block with number 616 at some point though: https://beaconchain.withdrawal-devnet-7.ethpandaops.io/tx/accca88128b365ddf31a7f074aaad1817f66c246cd66b6282022d2aa1b5965e8#overview",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1430780657/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1430783177",
    "html_url": "https://github.com/hyperledger/besu/issues/5094#issuecomment-1430783177",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5094",
    "id": 1430783177,
    "node_id": "IC_kwDODE2jmc5VSATJ",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-15T05:37:34Z",
    "updated_at": "2023-02-15T05:40:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "Here's the beacon block (queried via another node: withdrawal-devnet-7-lodestar-besu-1)\nusing `curl localhost:4000/eth/v2/beacon/blocks/641 | jq`\n\nNote Slot 639 = Block 615\nNote Slot 640 = empty\nNote Slot 641 = Block 616\n\n```\n{\n  \"data\": {\n    \"message\": {\n      \"slot\": \"641\",\n      \"proposer_index\": \"552650\",\n      \"parent_root\": \"0x3c7768170cdfc0199d4354cc83fd996febb4699563a06bb9944dcccfbc4e316f\",\n      \"state_root\": \"0xeba14549569c412e21f97a3276b9e81eb37208f8c31558f9a9d1d362e555fb42\",\n      \"body\": {\n        \"randao_reveal\": \"0xb813c25417b5db455b19ed85926297d5d4b25ddc35004b12fd405fcd78eb6d8e992b9f0771cc8f7b4db49b8836fe62e70f2bfa35e7a1d9871f499b9765906db05c86a965c07c54b6af3b3ef2ea83d3be34a8da63fbb08ec1f04173311004c776\",\n        \"eth1_data\": {\n          \"deposit_root\": \"0xd70a234731285c6804c2a4f56711ddb8c82c99740f207854891028af34e27e5e\",\n          \"deposit_count\": \"0\",\n          \"block_hash\": \"0x670555653f86bc045878d2e23e939dd5dd76675fc7db36e49d7437a74ace3191\"\n        },\n        \"graffiti\": \"0x6c6f6465737461722d6265737500000000000000000000000000000000000000\",\n         ...\n         ...\n        \"execution_payload\": {\n          \"parent_hash\": \"0x257b373dd605c65ef1bb61324c912d1c6522e130e4afa13041db9e1050144667\",\n          \"fee_recipient\": \"0xf97e180c050e5ab072211ad2c213eb5aee4df134\",\n          \"state_root\": \"0xbd07ebca146dec4d76f35ff1019a2161f1a2e0384cf76295076c63a0d5165fc2\",\n          \"receipts_root\": \"0xc5e845556bfccf0d767f7d4fd731838324572106d7fcffb7b49a583338f6b450\",\n          \"logs_bloom\": \"0x10000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000020000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008000000000000000000000000\",\n          \"prev_randao\": \"0xf21be8e5f9532ed463d37f8fc854b291dcb9ebf285c7713e33f9a74869af562c\",\n          \"block_number\": \"616\",\n          \"gas_limit\": \"30000000\",\n          \"gas_used\": \"50646\",\n          \"timestamp\": \"1676372892\",\n          \"extra_data\": \"0x\",\n          \"base_fee_per_gas\": \"7\",\n          \"block_hash\": \"0xd4ff381bb41109fb4396d3a1b5807896fbec260291f2b4b8cb97f29f404490b7\",\n          \"transactions\": [\n            \"0x02f9021f831469d38207388459682f008459682f0e830271009442424242424242424242424242424242424242428901bc16d674ec800000b901a422895118000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000e00000000000000000000000000000000000000000000000000000000000000120b61367b7984752a1c59205aa97fe9fdcab45b3fe78babe3ab0e1add2a6a9725f0000000000000000000000000000000000000000000000000000000000000030aebfb831214f4f2032b18771de874b3a7d300260d2d3ddb9a604d94d4d3a96967ac219dfa63e7804b51539e6e5fe52fb00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000ea53d19db06fb7daa8197206960757be5121032f5983ac7ff4412b2598086d0000000000000000000000000000000000000000000000000000000000000060864378cadfc68b7cd1f69ab1e9266642ed08278d1866b982ba718343d8419575cd8773308a3e2130b636b3331ea8f8030923b2b870ac87f6bab40b27c166465958cd6e51dc70653c40ec304cf64e5486ebb0e685b1b9abdcbca5d9c0076bbceec001a04824f05c44edf3137fab097192181ad206b816d74b3e984c59c8345f9ad7cbd2a06f1256c456eb8d00ccc15e3c88c8a73a418c0ff4faccdd3f4d76883c2ca178fd\"\n          ]\n        }\n      }\n    },\n    \"signature\": \"0x8268a6121c2a5af45fa58ab5244e14fab9209d622acfa3a406352d4f45408ef300e0041765716ac84ae43f7b0dd79e11157057a113a1b91f7799b3e5d4b7deddf76c18c5b16464311a8bed9a1b1bfc2e354d6c8f6f432d4ab52e12bc2cc565fe\"\n  },\n  \"version\": \"bellatrix\",\n  \"execution_optimistic\": false\n}\n```\n\n> \"proposer_index\": \"552650\",\n\nIt looks like withdrawal-devnet-7-lodestar-besu-2 was still the proposer according to this https://github.com/ethpandaops/withdrawals-testnet/tree/master/withdrawal-devnet-7\n\nand the block hash was even the same.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1430783177/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1430822180",
    "html_url": "https://github.com/hyperledger/besu/issues/5094#issuecomment-1430822180",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5094",
    "id": 1430822180,
    "node_id": "IC_kwDODE2jmc5VSJ0k",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-15T06:28:32Z",
    "updated_at": "2023-02-15T06:28:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "Beacon logs during this time:\n\n```\nFeb-14 11:08:02.920[api]             error: Error on publishContributionAndProofs [0] slot=639, subcommitteeIndex=0 code=SYNC_COMMITTEE_ERROR_NOT_CURRENT_SLOT, currentSlot=640, slot=639\nFeb-14 11:08:02.921[rest]            error: Req req-ago publishContributionAndProofs error  code=SYNC_COMMITTEE_ERROR_NOT_CURRENT_SLOT, currentSlot=640, slot=639\nFeb-14 11:08:06.108[eth1]            error: Error updating eth1 chain cache  JSON RPC error: Number of requests exceeds max batch size, batch\nFeb-14 11:08:06.164[]                 info: Synced - slot: 640 (skipped 1) - head: 639 0x3c77…316f - execution: valid(0x257b…4667) - finalized: 0xa249…3f7b:18 - peers: 50\nFeb-14 11:08:13.988[eth1]            error: Error updating eth1 chain cache  JSON RPC error: Number of requests exceeds max batch size, batch\nFeb-14 11:08:14.074[chain]           error: Block error slot=641 code=BLOCK_ERROR_EXECUTION_ERROR, execStatus=INVALID, errorMessage=Block already present in bad block manager.\nFeb-14 11:08:14.081[rest]            error: Req req-ahd publishBlock error  code=BLOCK_ERROR_EXECUTION_ERROR, execStatus=INVALID, errorMessage=Block already present in bad block manager.\nFeb-14 11:08:15.519[eth1]            error: Error updating eth1 chain cache  JSON RPC error: Number of requests exceeds max batch size, batch\nFeb-14 11:08:18.480[]                 info: Synced - slot: 641 (skipped 1) - head: 640 0xb029…e6cb - execution: valid(0x7cfd…14fd) - finalized: 0xa249…3f7b:18 - peers: 50\nFeb-14 11:08:21.118[chain]           error: Failed to run prepareForNextSlot nextEpoch=21, isEpochTransition=false, prepareSlot=642 code=PROTO_ARRAY_INVALID_LVH_EXECUTION_RESPONSE, lvhCode=ValidToInvalid, blockRoot=0x3c7768170cdfc0199d4354cc83fd996febb4699563a06bb9944dcccfbc4e316f, execHash=0x257b373dd605c65ef1bb61324c912d1c6522e130e4afa13041db9e1050144667\nFeb-14 11:08:24.187[]                error: Process shutdown requested  code=PROTO_ARRAY_INVALID_LVH_EXECUTION_RESPONSE, lvhCode=ValidToInvalid, blockRoot=0x3c7768170cdfc0199d4354cc83fd996febb4699563a06bb9944dcccfbc4e316f, execHash=0x257b373dd605c65ef1bb61324c912d1c6522e130e4afa13041db9e1050144667\nFeb-14 11:08:24.798[rest]            error: Req req-ahq produceBlockV2 error  code=PROTO_ARRAY_INVALID_LVH_EXECUTION_RESPONSE, lvhCode=ValidToInvalid, blockRoot=0x3c7768170cdfc0199d4354cc83fd996febb4699563a06bb9944dcccfbc4e316f, execHash=0x257b373dd605c65ef1bb61324c912d1c6522e130e4afa13041db9e1050144667\nFeb-14 11:08:24.804[]                 info: Stopping gracefully, use Ctrl+C again to force process exit\nFeb-14 11:08:27.848[]                 info: Lodestar network=testnet, version=v1.4.3/3236de8, commit=3236de87c9fc54b06902c6317f53d5f41d8a7acf\nFeb-14 11:08:27.887[]                 info: Connected to LevelDB database path=/beacondata/chain-db\nFeb-14 11:08:43.351[]                 info: Initializing beacon from a valid db state slot=0, epoch=0, stateRoot=0xb7cea36464ae50c0ce29877172b39417ac8f8c19e5c612cdf6b81e6f4752eb75, isWithinWeakSubjectivityPeriod=true\n```",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1430822180/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1430834216",
    "html_url": "https://github.com/hyperledger/besu/issues/5094#issuecomment-1430834216",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5094",
    "id": 1430834216,
    "node_id": "IC_kwDODE2jmc5VSMwo",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-15T06:38:39Z",
    "updated_at": "2023-02-15T21:43:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "My guess is that we create a bad block and mistakenly add it to the bad blocks (soon to be resolved by https://github.com/hyperledger/besu/pull/5082)\r\n...but return a valid block to our CL on a retry.\r\n\r\nThen when the CL plays our own valid block back to us via newPayload, it has the same hash as the previously invalid one, so due to this code, we keep returning INVALID:\r\nhttps://github.com/hyperledger/besu/blob/main/ethereum/api/src/main/java/org/hyperledger/besu/ethereum/api/jsonrpc/internal/methods/engine/AbstractEngineNewPayload.java#L178-L187\r\n\r\nThe main thing that I don't understand is why this doesn't happen for all the other cases of misreporting our own bad blocks...the unique thing with this is the transaction nonce error (as opposed to a concurrency error).\r\nPerhaps this type of invalidation leads to a the same block hash whereas for some reason the concurrency-error type leads to a different block hash?\r\n\r\nEither way, https://github.com/hyperledger/besu/pull/5082 should avoid this I hope",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1430834216/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1439589760",
    "html_url": "https://github.com/hyperledger/besu/issues/5094#issuecomment-1439589760",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5094",
    "id": 1439589760,
    "node_id": "IC_kwDODE2jmc5VzmWA",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-22T08:11:52Z",
    "updated_at": "2023-02-22T08:11:52Z",
    "author_association": "CONTRIBUTOR",
    "body": ">The main thing that I don't understand is why this doesn't happen for all the other cases of misreporting our own bad blocks...the unique thing with this is the transaction nonce error (as opposed to a concurrency error).\r\nPerhaps this type of invalidation leads to a the same block hash whereas for some reason the concurrency-error type leads to a different block hash?\r\n\r\nThe first thing the block builder does is create and cache an empty block before handing off to the thread. One possibility is that the block building thread failed on the first iteration which perhaps means the block hash that ended up in the bad block cache was for an empty block.\r\nThen if subsequent block building iterations had no valid transactions, they too would build a VALID empty block with the same hash (since the header data should be the same). This VALID block gets returned to the CL and propagated, but when we try to import via newPayload, it's found in our bad block cache.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1439589760/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1439591304",
    "html_url": "https://github.com/hyperledger/besu/issues/5094#issuecomment-1439591304",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/5094",
    "id": 1439591304,
    "node_id": "IC_kwDODE2jmc5VzmuI",
    "user": {
      "login": "siladu",
      "id": 2893793,
      "node_id": "MDQ6VXNlcjI4OTM3OTM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2893793?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/siladu",
      "html_url": "https://github.com/siladu",
      "followers_url": "https://api.github.com/users/siladu/followers",
      "following_url": "https://api.github.com/users/siladu/following{/other_user}",
      "gists_url": "https://api.github.com/users/siladu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/siladu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/siladu/subscriptions",
      "organizations_url": "https://api.github.com/users/siladu/orgs",
      "repos_url": "https://api.github.com/users/siladu/repos",
      "events_url": "https://api.github.com/users/siladu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/siladu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-22T08:13:23Z",
    "updated_at": "2023-02-22T08:13:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "I am happy that I can explain everything that happened here and there are fixes already done or in flight. \r\nI have created an new bug issue to look into the transaction nonce error specifically #5120.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1439591304/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
