{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/1114",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/1114/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/1114/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/1114/events",
  "html_url": "https://github.com/hyperledger/besu/issues/1114",
  "id": 641310373,
  "node_id": "MDU6SXNzdWU2NDEzMTAzNzM=",
  "number": 1114,
  "title": "Threads blocked on `org.rocksdb.RocksDB.get(Native Method)`",
  "user": {
    "login": "roderik",
    "id": 16780,
    "node_id": "MDQ6VXNlcjE2Nzgw",
    "avatar_url": "https://avatars.githubusercontent.com/u/16780?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/roderik",
    "html_url": "https://github.com/roderik",
    "followers_url": "https://api.github.com/users/roderik/followers",
    "following_url": "https://api.github.com/users/roderik/following{/other_user}",
    "gists_url": "https://api.github.com/users/roderik/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/roderik/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/roderik/subscriptions",
    "organizations_url": "https://api.github.com/users/roderik/orgs",
    "repos_url": "https://api.github.com/users/roderik/repos",
    "events_url": "https://api.github.com/users/roderik/events{/privacy}",
    "received_events_url": "https://api.github.com/users/roderik/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1537362490,
      "node_id": "MDU6TGFiZWwxNTM3MzYyNDkw",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 2051683573,
      "node_id": "MDU6TGFiZWwyMDUxNjgzNTcz",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/P3",
      "name": "P3",
      "color": "ffff00",
      "default": false,
      "description": "Medium (ex: JSON-RPC request not working with a specific client library due to loose spec assumtion)"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 13,
  "created_at": "2020-06-18T15:32:14Z",
  "updated_at": "2021-09-21T09:20:51Z",
  "closed_at": "2021-09-21T09:20:51Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!-- Have you done the following? -->\r\n<!--   * read the Code of Conduct? By filing an Issue, you are expected to -->  \r\n<!--     comply with it, including treating everyone with respect: -->\r\n<!--     https://github.com/hyperledger/besu/blob/master/CODE-OF-CONDUCT.md -->\r\n<!--   * Reproduced the issue in the latest version of the software -->\r\n<!--   * Read the debugging wiki: https://github.com/hyperledger/besu/wiki/debugging -->\r\n<!--   * Duplicate Issue check:  https://github.com/search?q=+is%3Aissue+repo%3Ahyperledger/Besu -->\r\n<!-- Note:  Not all sections will apply to all issue types. -->\r\n\r\n### Description\r\n\r\nI'm running an ibft network (started at v 1.4.2, upgraded to 1.4.6) on with nodes in GKE and AKS. \r\nIn each cloud provider, we run 1 validator, and 2 rpc nodes.\r\n\r\n<details>\r\n<summary>Network config:</summary>\r\n```\r\n{\r\n  \"alloc\": {\r\n    \"0x41bEA720b87EE046F9B8d7eEc737ca702e3073e7\": {\r\n      \"balance\": \"0x446c3b15f9926687d2c40534fdb564000000000000\"\r\n    }\r\n  },\r\n  \"coinbase\": \"0x0000000000000000000000000000000000000000\",\r\n  \"config\": {\r\n    \"chainId\": 45124,\r\n    \"constantinoplefixblock\": 0,\r\n    \"contractSizeLimit\": 2147483647,\r\n    \"evmStackSize\": 2048,\r\n    \"ibft2\": {\r\n      \"blockperiodseconds\": 2,\r\n      \"epochlength\": 30000,\r\n      \"requesttimeoutseconds\": 10\r\n    }\r\n  },\r\n  \"difficulty\": \"0x1\",\r\n  \"extraData\": \"0xf83ea00000000000000000000000000000000000000000000000000000000000000000d59441bea720b87ee046f9b8d7eec737ca702e3073e7808400000000c0\",\r\n  \"gasLimit\": \"0x1fffffffffffff\",\r\n  \"mixHash\": \"0x63746963616c2062797a616e74696e65206661756c7420746f6c6572616e6365\",\r\n  \"nonce\": \"0x0\",\r\n  \"timestamp\": \"0x0\"\r\n}\r\n```\r\n</details>\r\n\r\nWe sent a bunch of transactions and overloaded the rpc nodes in some way. \r\nWe saw OOM errors (both in Besu and in k8s) so we increased memory (5g) and cpu limits (4cpu) and the Xmx and Xms settings to 4g.\r\n\r\nThe validators never failed in any way.\r\n\r\nOn some nodes we deleted the DB and synced again, on others de did not.\r\n\r\nAll nodes after a restart/recreate boot, resync and follow the chain for a short while. Then they start failing with: \r\n\r\n```\r\n2020-06-18T15:24:33.675489427Z 2020-06-18 15:24:33.673+00:00 | vertx-blocked-thread-checker | WARN  | BlockedThreadChecker | Thread Thread[vert.x-worker-thread-19,5,main]=Thread[vert.x-worker-thread-19,5,main] has been blocked for 805883 ms, time limit is 60000 ms\r\n2020-06-18T15:24:33.675525157Z io.vertx.core.VertxException: Thread blocked\r\n2020-06-18T15:24:33.675532272Z \tat org.rocksdb.RocksDB.get(Native Method) ~[rocksdbjni-6.4.6.jar:?]\r\n2020-06-18T15:24:33.675538854Z \tat org.rocksdb.RocksDB.get(RocksDB.java:1721) ~[rocksdbjni-6.4.6.jar:?]\r\n2020-06-18T15:24:33.675544948Z \tat org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.get(RocksDBColumnarKeyValueStorage.java:155) ~[besu-plugin-rocksdb-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675551439Z \tat org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.get(RocksDBColumnarKeyValueStorage.java:62) ~[besu-plugin-rocksdb-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.67555785Z \tat org.hyperledger.besu.services.kvstore.SegmentedKeyValueStorageAdapter.get(SegmentedKeyValueStorageAdapter.java:50) ~[besu-kvstore-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.67556437Z \tat org.hyperledger.besu.ethereum.storage.keyvalue.WorldStateKeyValueStorage.getTrieNode(WorldStateKeyValueStorage.java:69) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675570524Z \tat org.hyperledger.besu.ethereum.storage.keyvalue.WorldStateKeyValueStorage.getAccountStorageTrieNode(WorldStateKeyValueStorage.java:62) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.67557631Z \tat org.hyperledger.besu.ethereum.worldstate.DefaultMutableWorldState$$Lambda$1165/0x0000000840663040.getNode(Unknown Source) ~[?:?]\r\n2020-06-18T15:24:33.675581786Z \tat org.hyperledger.besu.ethereum.trie.StoredNodeFactory.retrieve(StoredNodeFactory.java:95) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675587366Z \tat org.hyperledger.besu.ethereum.trie.StoredNode.load(StoredNode.java:106) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675592804Z \tat org.hyperledger.besu.ethereum.trie.StoredNode.accept(StoredNode.java:50) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675598964Z \tat org.hyperledger.besu.ethereum.trie.GetVisitor.visit(GetVisitor.java:46) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675604822Z \tat org.hyperledger.besu.ethereum.trie.BranchNode.accept(BranchNode.java:63) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675610835Z \tat org.hyperledger.besu.ethereum.trie.StoredNode.accept(StoredNode.java:51) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675617724Z \tat org.hyperledger.besu.ethereum.trie.GetVisitor.visit(GetVisitor.java:46) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675634108Z \tat org.hyperledger.besu.ethereum.trie.BranchNode.accept(BranchNode.java:63) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675639709Z \tat org.hyperledger.besu.ethereum.trie.StoredNode.accept(StoredNode.java:51) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675653645Z \tat org.hyperledger.besu.ethereum.trie.GetVisitor.visit(GetVisitor.java:46) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675659094Z \tat org.hyperledger.besu.ethereum.trie.BranchNode.accept(BranchNode.java:63) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675664492Z \tat org.hyperledger.besu.ethereum.trie.StoredNode.accept(StoredNode.java:51) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675669787Z \tat org.hyperledger.besu.ethereum.trie.GetVisitor.visit(GetVisitor.java:46) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.67567489Z \tat org.hyperledger.besu.ethereum.trie.BranchNode.accept(BranchNode.java:63) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675680098Z \tat org.hyperledger.besu.ethereum.trie.StoredNode.accept(StoredNode.java:51) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675685196Z \tat org.hyperledger.besu.ethereum.trie.GetVisitor.visit(GetVisitor.java:46) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675690655Z \tat org.hyperledger.besu.ethereum.trie.BranchNode.accept(BranchNode.java:63) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675695989Z \tat org.hyperledger.besu.ethereum.trie.StoredNode.accept(StoredNode.java:51) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675701366Z \tat org.hyperledger.besu.ethereum.trie.GetVisitor.visit(GetVisitor.java:46) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675706494Z \tat org.hyperledger.besu.ethereum.trie.BranchNode.accept(BranchNode.java:63) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675711589Z \tat org.hyperledger.besu.ethereum.trie.StoredNode.accept(StoredNode.java:51) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675717025Z \tat org.hyperledger.besu.ethereum.trie.StoredMerklePatriciaTrie.get(StoredMerklePatriciaTrie.java:80) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675722474Z \tat org.hyperledger.besu.ethereum.trie.StoredMerklePatriciaTrie.get(StoredMerklePatriciaTrie.java:35) ~[besu-trie-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675727717Z \tat org.hyperledger.besu.ethereum.worldstate.DefaultMutableWorldState$WorldStateAccount.getStorageValue(DefaultMutableWorldState.java:292) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675733122Z \tat org.hyperledger.besu.ethereum.core.AbstractWorldUpdater$UpdateTrackingAccount.getStorageValue(AbstractWorldUpdater.java:340) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675738191Z \tat org.hyperledger.besu.ethereum.core.AbstractWorldUpdater$UpdateTrackingAccount.getStorageValue(AbstractWorldUpdater.java:340) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675742887Z \tat org.hyperledger.besu.ethereum.core.AbstractWorldUpdater$UpdateTrackingAccount.getStorageValue(AbstractWorldUpdater.java:340) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.67574801Z \tat org.hyperledger.besu.ethereum.vm.operations.SLoadOperation.execute(SLoadOperation.java:44) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675758046Z \tat org.hyperledger.besu.ethereum.vm.EVM.lambda$executeNextOperation$0(EVM.java:82) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675763052Z \tat org.hyperledger.besu.ethereum.vm.EVM$$Lambda$1162/0x0000000840664440.execute(Unknown Source) ~[?:?]\r\n2020-06-18T15:24:33.675768075Z \tat org.hyperledger.besu.ethereum.vm.OperationTracer.lambda$static$0(OperationTracer.java:27) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675773259Z \tat org.hyperledger.besu.ethereum.vm.OperationTracer$$Lambda$1156/0x0000000840665c40.traceExecution(Unknown Source) ~[?:?]\r\n2020-06-18T15:24:33.675793183Z \tat org.hyperledger.besu.ethereum.vm.EVM.executeNextOperation(EVM.java:75) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675800948Z \tat org.hyperledger.besu.ethereum.vm.EVM.runToHalt(EVM.java:51) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675806202Z \tat org.hyperledger.besu.ethereum.mainnet.AbstractMessageProcessor.codeExecute(AbstractMessageProcessor.java:157) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675811742Z \tat org.hyperledger.besu.ethereum.mainnet.AbstractMessageProcessor.process(AbstractMessageProcessor.java:171) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675817634Z \tat org.hyperledger.besu.ethereum.mainnet.MainnetTransactionProcessor.process(MainnetTransactionProcessor.java:407) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675822754Z \tat org.hyperledger.besu.ethereum.mainnet.MainnetTransactionProcessor.processTransaction(MainnetTransactionProcessor.java:330) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675828222Z \tat org.hyperledger.besu.ethereum.mainnet.MainnetTransactionProcessor.processTransaction(MainnetTransactionProcessor.java:47) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675834952Z \tat org.hyperledger.besu.ethereum.mainnet.TransactionProcessor.processTransaction(TransactionProcessor.java:182) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675839778Z \tat org.hyperledger.besu.ethereum.transaction.TransactionSimulator.process(TransactionSimulator.java:131) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675844511Z \tat org.hyperledger.besu.ethereum.transaction.TransactionSimulator.process(TransactionSimulator.java:84) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675849252Z \tat org.hyperledger.besu.ethereum.transaction.TransactionSimulator.process(TransactionSimulator.java:76) ~[besu-core-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675854476Z \tat org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthCall.resultByBlockNumber(EthCall.java:56) ~[besu-api-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675859413Z \tat org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.AbstractBlockParameterMethod.latestResult(AbstractBlockParameterMethod.java:55) ~[besu-api-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675864825Z \tat org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.AbstractBlockParameterMethod.findResultByParamType(AbstractBlockParameterMethod.java:66) ~[besu-api-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.67587043Z \tat org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthCall.response(EthCall.java:78) ~[besu-api-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675875959Z \tat org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcHttpService.process(JsonRpcHttpService.java:599) ~[besu-api-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675886846Z \tat org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcHttpService.lambda$handleJsonSingleRequest$10(JsonRpcHttpService.java:472) ~[besu-api-1.4.6.jar:1.4.6]\r\n2020-06-18T15:24:33.675892384Z \tat org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcHttpService$$Lambda$1106/0x000000084063dc40.handle(Unknown Source) ~[?:?]\r\n2020-06-18T15:24:33.67589828Z \tat io.vertx.core.impl.ContextImpl.lambda$executeBlocking$2(ContextImpl.java:316) ~[vertx-core-3.8.5.jar:3.8.5]\r\n2020-06-18T15:24:33.675903583Z \tat io.vertx.core.impl.ContextImpl$$Lambda$795/0x0000000840562440.run(Unknown Source) ~[?:?]\r\n2020-06-18T15:24:33.675908506Z \tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\r\n2020-06-18T15:24:33.67591333Z \tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\r\n2020-06-18T15:24:33.675918327Z \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[netty-common-4.1.42.Final.jar:4.1.42.Final]\r\n2020-06-18T15:24:33.675923754Z \tat java.lang.Thread.run(Thread.java:834) ~[?:?]\r\n```\r\n\r\n[Full log from startup to failure](https://github.com/hyperledger/besu/files/4799486/validators.log)\r\n\r\nAt that point in time, they keep running, but stop interacting with the network. Running at 1 full CPU and a rising memory graph until they restart due to memory limits (at 5gb...)\r\n\r\n![image](https://user-images.githubusercontent.com/16780/85040247-e55d7f80-b188-11ea-9b5d-c6167bb656d9.png)\r\n\r\n**Frequency:** [What percentage of the time does it occur?]\r\n\r\n100% of the time\r\n\r\n### Versions (Add all that apply)\r\n\r\nWe run out of the official docker container\r\n\r\n* Software version: [`besu --version`] \r\n\r\nbesu/v1.4.6/linux-x86_64/oracle_openjdk-java-11\r\n\r\n* Java version: [`java -version`] \r\n\r\nopenjdk version \"11.0.2\" 2019-01-15\r\nOpenJDK Runtime Environment (build 11.0.2+9-Debian-3bpo91)\r\nOpenJDK 64-Bit Server VM (build 11.0.2+9-Debian-3bpo91, mixed mode, sharing)\r\n\r\n* OS Name & Version: [`cat /etc/*release`]\r\n\r\nPRETTY_NAME=\"Debian GNU/Linux 9 (stretch)\"\r\nNAME=\"Debian GNU/Linux\"\r\nVERSION_ID=\"9\"\r\nVERSION=\"9 (stretch)\"\r\nID=debian\r\nHOME_URL=\"https://www.debian.org/\"\r\nSUPPORT_URL=\"https://www.debian.org/support\"\r\nBUG_REPORT_URL=\"https://bugs.debian.org/\"\r\n\r\n* Kernel Version: [`uname -a`]\r\n\r\nLinux besu-edge-1-peach-aardwolf-0 4.14.138+ #1 SMP Tue Sep 3 02:58:08 PDT 2019 x86_64 GNU/Linux\r\n\r\n* Virtual Machine software & version: [`vmware -v`]\r\n* Docker Version: [`docker version`]\r\n\r\nk8s - 1.14.10-gke.36\r\n\r\n* Cloud VM, type, size: [Amazon Web Services I3-large]\r\n\r\n4 x n1-standard-2\r\n\r\n### Additional info\r\n\r\nDB size, 1.5gb\r\n\r\n```\r\n90M     000043.log\r\n58M     000045.log\r\n58M     000047.log\r\n60M     000049.log\r\n68M     000051.log\r\n63M     000057.log\r\n71M     000059.log\r\n1008K   000065.log\r\n71M     000087.log\r\n65M     000100.sst\r\n65M     000103.sst\r\n4.0K    000111.log\r\n156K    000128.log\r\n71M     000145.log\r\n4.0K    000161.log\r\n71M     000178.log\r\n4.0K    000200.log\r\n928K    000217.log\r\n71M     000234.log\r\n65M     000250.sst\r\n65M     000251.sst\r\n49M     000252.sst\r\n71M     000257.log\r\n65M     000261.sst\r\n65M     000273.sst\r\n65M     000274.sst\r\n16K     000275.sst\r\n320K    000278.sst\r\n660K    000280.log\r\n304K    000295.sst\r\n71M     000297.log\r\n276K    000312.sst\r\n71M     000314.log\r\n65M     000324.sst\r\n4.0K    CURRENT\r\n4.0K    IDENTITY\r\n0       LOCK\r\n256K    LOG\r\n772K    LOG.old.1592485304454240\r\n256K    LOG.old.1592485822129207\r\n256K    LOG.old.1592485870423897\r\n128K    LOG.old.1592485922244741\r\n256K    LOG.old.1592486102069536\r\n256K    LOG.old.1592486147831992\r\n256K    LOG.old.1592486187278630\r\n388K    LOG.old.1592489180764970\r\n256K    LOG.old.1592489269440959\r\n256K    LOG.old.1592490017001269\r\n256K    LOG.old.1592490425812230\r\n256K    LOG.old.1592491729755350\r\n256K    LOG.old.1592492974804448\r\n256K    LOG.old.1592494089862828\r\n4.0M    MANIFEST-000311\r\n20K     OPTIONS-000327\r\n20K     OPTIONS-000329\r\n1.5G    total\r\n```",
  "closed_by": {
    "login": "roderik",
    "id": 16780,
    "node_id": "MDQ6VXNlcjE2Nzgw",
    "avatar_url": "https://avatars.githubusercontent.com/u/16780?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/roderik",
    "html_url": "https://github.com/roderik",
    "followers_url": "https://api.github.com/users/roderik/followers",
    "following_url": "https://api.github.com/users/roderik/following{/other_user}",
    "gists_url": "https://api.github.com/users/roderik/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/roderik/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/roderik/subscriptions",
    "organizations_url": "https://api.github.com/users/roderik/orgs",
    "repos_url": "https://api.github.com/users/roderik/repos",
    "events_url": "https://api.github.com/users/roderik/events{/privacy}",
    "received_events_url": "https://api.github.com/users/roderik/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/1114/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/1114/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/646138862",
    "html_url": "https://github.com/hyperledger/besu/issues/1114#issuecomment-646138862",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1114",
    "id": 646138862,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NjEzODg2Mg==",
    "user": {
      "login": "roderik",
      "id": 16780,
      "node_id": "MDQ6VXNlcjE2Nzgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/16780?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/roderik",
      "html_url": "https://github.com/roderik",
      "followers_url": "https://api.github.com/users/roderik/followers",
      "following_url": "https://api.github.com/users/roderik/following{/other_user}",
      "gists_url": "https://api.github.com/users/roderik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/roderik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/roderik/subscriptions",
      "organizations_url": "https://api.github.com/users/roderik/orgs",
      "repos_url": "https://api.github.com/users/roderik/repos",
      "events_url": "https://api.github.com/users/roderik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/roderik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-18T16:20:27Z",
    "updated_at": "2020-06-18T16:21:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "We have the sneaking suspicion that a user pushed a large value in a contract, and the errors are coming from trying to get these values out of the jsonrpc interface.\r\n\r\nThe errors we currently get in our code, which correlates roughly to the errors in the Besu logs\r\n\r\n```\r\nThe value of \"offset\" is out of range. It must be >= 0 && <= 17825792. Received 17825795\r\n```\r\n\r\n```\r\ntimeout\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/646138862/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/646318425",
    "html_url": "https://github.com/hyperledger/besu/issues/1114#issuecomment-646318425",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1114",
    "id": 646318425,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NjMxODQyNQ==",
    "user": {
      "login": "shemnon",
      "id": 38109,
      "node_id": "MDQ6VXNlcjM4MTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shemnon",
      "html_url": "https://github.com/shemnon",
      "followers_url": "https://api.github.com/users/shemnon/followers",
      "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
      "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
      "organizations_url": "https://api.github.com/users/shemnon/orgs",
      "repos_url": "https://api.github.com/users/shemnon/repos",
      "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shemnon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-18T21:36:42Z",
    "updated_at": "2020-06-18T21:36:42Z",
    "author_association": "MEMBER",
    "body": "It looks like the eth_call rpc is indeed taking too much time.  My gut is that it is related to the number of sload operations and not the single large value.  Is the particular contract available for us to examine?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/646318425/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/646597467",
    "html_url": "https://github.com/hyperledger/besu/issues/1114#issuecomment-646597467",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1114",
    "id": 646597467,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NjU5NzQ2Nw==",
    "user": {
      "login": "sambacha",
      "id": 32783916,
      "node_id": "MDQ6VXNlcjMyNzgzOTE2",
      "avatar_url": "https://avatars.githubusercontent.com/u/32783916?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sambacha",
      "html_url": "https://github.com/sambacha",
      "followers_url": "https://api.github.com/users/sambacha/followers",
      "following_url": "https://api.github.com/users/sambacha/following{/other_user}",
      "gists_url": "https://api.github.com/users/sambacha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sambacha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sambacha/subscriptions",
      "organizations_url": "https://api.github.com/users/sambacha/orgs",
      "repos_url": "https://api.github.com/users/sambacha/repos",
      "events_url": "https://api.github.com/users/sambacha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sambacha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-19T12:01:18Z",
    "updated_at": "2020-06-19T12:01:18Z",
    "author_association": "NONE",
    "body": "This reminds me of the contracted that violated state, , 0x03 out of gas\n\nOn Thu, Jun 18, 2020, 2:36 PM Danno Ferrin <notifications@github.com> wrote:\n\n> It looks like the eth_call rpc is indeed taking too much time. My gut is\n> that it is related to the number of sload operations and not the single\n> large value. Is the particular contract available for us to examine?\n>\n> â€”\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/hyperledger/besu/issues/1114#issuecomment-646318425>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AH2D4LCNHHTY7MISERFKADTRXKCHTANCNFSM4OB4EPIQ>\n> .\n>\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/646597467/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/646741338",
    "html_url": "https://github.com/hyperledger/besu/issues/1114#issuecomment-646741338",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1114",
    "id": 646741338,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0Njc0MTMzOA==",
    "user": {
      "login": "roderik",
      "id": 16780,
      "node_id": "MDQ6VXNlcjE2Nzgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/16780?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/roderik",
      "html_url": "https://github.com/roderik",
      "followers_url": "https://api.github.com/users/roderik/followers",
      "following_url": "https://api.github.com/users/roderik/following{/other_user}",
      "gists_url": "https://api.github.com/users/roderik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/roderik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/roderik/subscriptions",
      "organizations_url": "https://api.github.com/users/roderik/orgs",
      "repos_url": "https://api.github.com/users/roderik/repos",
      "events_url": "https://api.github.com/users/roderik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/roderik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-19T16:43:35Z",
    "updated_at": "2020-06-19T16:45:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "After a lot of debugging I've got some more info:\r\n\r\nEssentially the contract:\r\n```\r\npragma solidity ^0.6.4;\r\npragma experimental ABIEncoderV2;\r\n\r\ncontract PD {\r\n\r\n  struct ReceivedPalletData {\r\n    string did;\r\n    string receivedPalletSsccCode;\r\n    string receivedPalletSsccStatusCode;\r\n    string receivedPalletBarcode;\r\n    string receivedPalletQuantitySu;\r\n    string receivedPalletBestBeforDate;\r\n    string goodsReceiptMessage;\r\n  }\r\n\r\n  ReceivedPalletData[] internal _receivedPalletDataRegistry;\r\n\r\n  function getContents() public view override returns (ReceivedPalletData[] memory) {\r\n    return _receivedPalletDataRegistry;\r\n  }\r\n\r\n}\r\n```\r\n\r\nThe problem is I cannot tell you how much is in the array since it is hard to get out. But I cannot find any information on there being limits to get data out. Even my logger truncates ;) https://gist.github.com/roderik/c99f345624f95a37c6c386a9c4d9c6f8\r\n\r\nSome random things:\r\n- My nodes return data, albeit slowly, with -Xms4g -Xmx4g, but they get killed by hitting the 5gb Kubernetes limit I've set. But Xmx is max VM size, so I thought it would stay at max 4\r\n- I had to increase the Ethers timeout (2min) to a lot higher to get it to wait long enough for the response. \r\n\r\nSome things I've been thinking about:\r\n\r\n- the db is stored on a regular persistent disk in google cloud, you can also create ssd persistent disks, that might speed up rocksdb queries?\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/646741338/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/646746222",
    "html_url": "https://github.com/hyperledger/besu/issues/1114#issuecomment-646746222",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1114",
    "id": 646746222,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0Njc0NjIyMg==",
    "user": {
      "login": "roderik",
      "id": 16780,
      "node_id": "MDQ6VXNlcjE2Nzgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/16780?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/roderik",
      "html_url": "https://github.com/roderik",
      "followers_url": "https://api.github.com/users/roderik/followers",
      "following_url": "https://api.github.com/users/roderik/following{/other_user}",
      "gists_url": "https://api.github.com/users/roderik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/roderik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/roderik/subscriptions",
      "organizations_url": "https://api.github.com/users/roderik/orgs",
      "repos_url": "https://api.github.com/users/roderik/repos",
      "events_url": "https://api.github.com/users/roderik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/roderik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-19T16:48:12Z",
    "updated_at": "2020-06-19T16:48:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "It takes at least 220 seconds, this is the last message I see before everything returns to normal because the request dies with a `504 Gateway timeout`\r\n\r\n```\r\n 2020-06-19 16:45:29.538+00:00 | vertx-blocked-thread-checker | WARN  | BlockedThreadChecker | Thread Thread[vert.x-worker-thread-11,5,main]=Thread[vert.x-worker-thread-11,5,main] has been blocked for 219643 ms, time limit is 60000 ms \r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/646746222/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/646751028",
    "html_url": "https://github.com/hyperledger/besu/issues/1114#issuecomment-646751028",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1114",
    "id": 646751028,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0Njc1MTAyOA==",
    "user": {
      "login": "shemnon",
      "id": 38109,
      "node_id": "MDQ6VXNlcjM4MTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shemnon",
      "html_url": "https://github.com/shemnon",
      "followers_url": "https://api.github.com/users/shemnon/followers",
      "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
      "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
      "organizations_url": "https://api.github.com/users/shemnon/orgs",
      "repos_url": "https://api.github.com/users/shemnon/repos",
      "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shemnon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-19T16:52:38Z",
    "updated_at": "2020-06-19T16:52:38Z",
    "author_association": "MEMBER",
    "body": "I would recommend a paginated variant of getContents where either an explicit sub-range of the array is returned.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/646751028/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/646843704",
    "html_url": "https://github.com/hyperledger/besu/issues/1114#issuecomment-646843704",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1114",
    "id": 646843704,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0Njg0MzcwNA==",
    "user": {
      "login": "roderik",
      "id": 16780,
      "node_id": "MDQ6VXNlcjE2Nzgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/16780?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/roderik",
      "html_url": "https://github.com/roderik",
      "followers_url": "https://api.github.com/users/roderik/followers",
      "following_url": "https://api.github.com/users/roderik/following{/other_user}",
      "gists_url": "https://api.github.com/users/roderik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/roderik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/roderik/subscriptions",
      "organizations_url": "https://api.github.com/users/roderik/orgs",
      "repos_url": "https://api.github.com/users/roderik/repos",
      "events_url": "https://api.github.com/users/roderik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/roderik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-19T20:11:58Z",
    "updated_at": "2020-06-19T20:11:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "I upgraded to bigger machines and SSD disks, but the query keeps being 300+ seconds long. On an infrastructure level, there is nothing more I can do.\r\n\r\nWill implement the pagination next unless anyone has a better idea? ",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/646843704/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/650439352",
    "html_url": "https://github.com/hyperledger/besu/issues/1114#issuecomment-650439352",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1114",
    "id": 650439352,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MDQzOTM1Mg==",
    "user": {
      "login": "shemnon",
      "id": 38109,
      "node_id": "MDQ6VXNlcjM4MTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shemnon",
      "html_url": "https://github.com/shemnon",
      "followers_url": "https://api.github.com/users/shemnon/followers",
      "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
      "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
      "organizations_url": "https://api.github.com/users/shemnon/orgs",
      "repos_url": "https://api.github.com/users/shemnon/repos",
      "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shemnon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-26T22:57:02Z",
    "updated_at": "2020-06-26T22:57:02Z",
    "author_association": "MEMBER",
    "body": "What is the scale of the response?  i.e.How many items are in that array?  We are considering some radical DB changes on the back end so that number would be helpful in determining if this is an issue of trie-climbing to get all the values or some other problem.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/650439352/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/668418572",
    "html_url": "https://github.com/hyperledger/besu/issues/1114#issuecomment-668418572",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1114",
    "id": 668418572,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2ODQxODU3Mg==",
    "user": {
      "login": "roderik",
      "id": 16780,
      "node_id": "MDQ6VXNlcjE2Nzgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/16780?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/roderik",
      "html_url": "https://github.com/roderik",
      "followers_url": "https://api.github.com/users/roderik/followers",
      "following_url": "https://api.github.com/users/roderik/following{/other_user}",
      "gists_url": "https://api.github.com/users/roderik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/roderik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/roderik/subscriptions",
      "organizations_url": "https://api.github.com/users/roderik/orgs",
      "repos_url": "https://api.github.com/users/roderik/repos",
      "events_url": "https://api.github.com/users/roderik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/roderik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-04T07:01:14Z",
    "updated_at": "2020-08-04T07:01:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "Sorry, I missed this question. I do not have exact numbers anymore, but it was about 2000 items and serialized as JSON they went over the 16MB MongoDB document limit. So I only know more then 2k and together more than 16mb in space (in one response, so this was a bad query / implementation anyway from my side)",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/668418572/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/723495801",
    "html_url": "https://github.com/hyperledger/besu/issues/1114#issuecomment-723495801",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1114",
    "id": 723495801,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyMzQ5NTgwMQ==",
    "user": {
      "login": "forkwatch-ninja",
      "id": 74117285,
      "node_id": "MDQ6VXNlcjc0MTE3Mjg1",
      "avatar_url": "https://avatars.githubusercontent.com/u/74117285?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/forkwatch-ninja",
      "html_url": "https://github.com/forkwatch-ninja",
      "followers_url": "https://api.github.com/users/forkwatch-ninja/followers",
      "following_url": "https://api.github.com/users/forkwatch-ninja/following{/other_user}",
      "gists_url": "https://api.github.com/users/forkwatch-ninja/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/forkwatch-ninja/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/forkwatch-ninja/subscriptions",
      "organizations_url": "https://api.github.com/users/forkwatch-ninja/orgs",
      "repos_url": "https://api.github.com/users/forkwatch-ninja/repos",
      "events_url": "https://api.github.com/users/forkwatch-ninja/events{/privacy}",
      "received_events_url": "https://api.github.com/users/forkwatch-ninja/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-07T21:10:35Z",
    "updated_at": "2020-11-07T21:10:35Z",
    "author_association": "NONE",
    "body": "I'm running into the same issue @shemnon\r\n\r\nI am running a public Hyperledger Besu RPC endpoint which means others would be using it to deploy their smart contracts, and I see this in the log repeatedly:\r\n\r\n```\r\n# Besu Buggs\t\r\n        at app//org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthGetLogs$$Lambda$858/0x0000000801072440.get(Unknown Source)                                                                                                       [300/1896]\r\n        at java.base@14/java.util.Optional.orElseGet(Optional.java:362)\r\n        at app//org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthGetLogs.response(EthGetLogs.java:59)\r\n        at app//org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcHttpService.process(JsonRpcHttpService.java:614)\r\n        at app//org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcHttpService.lambda$handleJsonSingleRequest$10(JsonRpcHttpService.java:476)\r\n        at app//org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcHttpService$$Lambda$753/0x000000080102b440.handle(Unknown Source)\r\n        at app//io.vertx.core.impl.ContextImpl.lambda$executeBlocking$2(ContextImpl.java:313)\r\n        at app//io.vertx.core.impl.ContextImpl$$Lambda$587/0x0000000800f8d040.run(Unknown Source)\r\n        at java.base@14/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)\r\n        at java.base@14/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630)\r\n        at app//io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base@14/java.lang.Thread.run(Thread.java:832)\r\n\r\n2020-11-07 20:47:46.848+00:00 | vert.x-worker-thread-19 | WARN  | BackendQuery | Zombie backend query detected [ unnamed ], aborting process.\r\n2020-11-07 20:47:46.852+00:00 | vert.x-worker-thread-19 | ERROR | BlockchainQueries | Error retrieving matching logs\r\norg.hyperledger.besu.ethereum.api.handlers.RpcMethodTimeoutException: Timeout expired\r\n        at org.hyperledger.besu.ethereum.api.query.BackendQuery.runIfAlive(BackendQuery.java:46)\r\n        at org.hyperledger.besu.ethereum.api.query.BackendQuery.runIfAlive(BackendQuery.java:31)\r\n        at org.hyperledger.besu.ethereum.api.query.BackendQuery.stopIfExpired(BackendQuery.java:52)\r\n        at org.hyperledger.besu.ethereum.api.query.BlockchainQueries.matchingLogs(BlockchainQueries.java:560)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthGetLogs.lambda$response$1(EthGetLogs.java:64)\r\n        at java.base/java.util.Optional.orElseGet(Optional.java:362)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthGetLogs.response(EthGetLogs.java:59)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcHttpService.process(JsonRpcHttpService.java:614)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcHttpService.lambda$handleJsonSingleRequest$10(JsonRpcHttpService.java:476)\r\n        at io.vertx.core.impl.ContextImpl.lambda$executeBlocking$2(ContextImpl.java:313)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:832)\r\n2020-11-07 20:47:46.857+00:00 | vert.x-worker-thread-19 | ERROR | JsonRpcHttpService | Error processing JSON-RPC requestBody\r\norg.hyperledger.besu.ethereum.api.handlers.RpcMethodTimeoutException: Timeout expired\r\n        at org.hyperledger.besu.ethereum.api.query.BackendQuery.runIfAlive(BackendQuery.java:46)\r\n        at org.hyperledger.besu.ethereum.api.query.BackendQuery.runIfAlive(BackendQuery.java:31)\r\n        at org.hyperledger.besu.ethereum.api.query.BackendQuery.stopIfExpired(BackendQuery.java:52)\r\n        at org.hyperledger.besu.ethereum.api.query.BlockchainQueries.matchingLogs(BlockchainQueries.java:560)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthGetLogs.lambda$response$1(EthGetLogs.java:64)\r\n        at java.base/java.util.Optional.orElseGet(Optional.java:362)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.internal.methods.EthGetLogs.response(EthGetLogs.java:59)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcHttpService.process(JsonRpcHttpService.java:614)\r\n        at org.hyperledger.besu.ethereum.api.jsonrpc.JsonRpcHttpService.lambda$handleJsonSingleRequest$10(JsonRpcHttpService.java:476)\r\n        at io.vertx.core.impl.ContextImpl.lambda$executeBlocking$2(ContextImpl.java:313)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630)\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n        at java.base/java.lang.Thread.run(Thread.java:832)\r\n2020-11-07 20:47:47.428+00:00 | vertx-blocked-thread-checker | WARN  | BlockedThreadChecker | Thread Thread[vert.x-worker-thread-8,5,main]=Thread[vert.x-worker-thread-8,5,main] has been blocked for 78205 ms, time limit is 60000 ms\r\nio.vertx.core.VertxException: Thread blocked\r\n        at app//org.rocksdb.RocksDB.get(Native Method)\r\n        at app//org.rocksdb.RocksDB.get(RocksDB.java:1886)\r\n        at app//org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.get(RocksDBColumnarKeyValueStorage.java:155)\r\n        at app//org.hyperledger.besu.plugin.services.storage.rocksdb.segmented.RocksDBColumnarKeyValueStorage.get(RocksDBColumnarKeyValueStorage.java:62)\r\n        at app//org.hyperledger.besu.services.kvstore.SegmentedKeyValueStorageAdapter.get(SegmentedKeyValueStorageAdapter.java:50)\r\n        at app//org.hyperledger.besu.ethereum.storage.keyvalue.KeyValueStoragePrefixedKeyBlockchainStorage.get(KeyValueStoragePrefixedKeyBlockchainStorage.java:122)\r\n        at app//org.hyperledger.besu.ethereum.storage.keyvalue.KeyValueStoragePrefixedKeyBlockchainStorage.getBlockHeader(KeyValueStoragePrefixedKeyBlockchainStorage.java:77)\r\n        at app//org.hyperledger.besu.ethereum.chain.DefaultBlockchain$$Lambda$833/0x0000000801067c40.apply(Unknown Source)\r\n        at java.base@14/java.util.Optional.flatMap(Optional.java:287)\r\n        at app//org.hyperledger.besu.ethereum.chain.DefaultBlockchain.getBlockHeader(DefaultBlockchain.java:186)\r\n        at app//org.hyperledger.besu.ethereum.api.query.BlockchainQueries$$Lambda$869/0x0000000801079440.apply(Unknown Source)\r\n        at java.base@14/java.util.stream.LongPipeline$1$1.accept(LongPipeline.java:177)\r\n        at java.base@14/java.util.stream.Streams$RangeLongSpliterator.tryAdvance(Streams.java:207)\r\n        at java.base@14/java.util.stream.LongPipeline.forEachWithCancel(LongPipeline.java:161)\r\n        at java.base@14/java.util.stream.AbstractPipeline.copyIntoWithCancel(AbstractPipeline.java:502)\r\n```\r\n\r\nI'm running this command:\r\n```\r\nbesu --network=classic --data-path=~/besu-dir --node-private-key-file=~/besu-dir/keys --rpc-http-enabled --rpc-ws-enabled --host-whitelist=* --rpc-http-cors-origins=* --p2p-host=<IP> --p2p-port=30303 --rpc-http-host=0.0.0.0 --rpc-http-port=8545 --sync-mode=FULL --rpc-http-api=web3,net,eth,trace,txpool --rpc-ws-api=web3,net,eth,trace,txpool --rpc-ws-host=0.0.0.0\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/723495801/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/723517534",
    "html_url": "https://github.com/hyperledger/besu/issues/1114#issuecomment-723517534",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1114",
    "id": 723517534,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyMzUxNzUzNA==",
    "user": {
      "login": "shemnon",
      "id": 38109,
      "node_id": "MDQ6VXNlcjM4MTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/38109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shemnon",
      "html_url": "https://github.com/shemnon",
      "followers_url": "https://api.github.com/users/shemnon/followers",
      "following_url": "https://api.github.com/users/shemnon/following{/other_user}",
      "gists_url": "https://api.github.com/users/shemnon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shemnon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shemnon/subscriptions",
      "organizations_url": "https://api.github.com/users/shemnon/orgs",
      "repos_url": "https://api.github.com/users/shemnon/repos",
      "events_url": "https://api.github.com/users/shemnon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shemnon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-08T01:27:03Z",
    "updated_at": "2020-11-08T01:27:03Z",
    "author_association": "MEMBER",
    "body": "@forkwatch-ninja the stacks indicate you are causing this via a different means than roderik is.  Can you post this in a separate bug?\r\n\r\nAlso, can you post the RPC calls triggering it?  How large is the getLogsQuery you are polling?  How big is the block range, what are the filters, and how much data are you expecting to get?  Add this to the new bug because that will be my first thing to look at.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/723517534/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/923175978",
    "html_url": "https://github.com/hyperledger/besu/issues/1114#issuecomment-923175978",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1114",
    "id": 923175978,
    "node_id": "IC_kwDODE2jmc43Bowq",
    "user": {
      "login": "vmichalik",
      "id": 12459761,
      "node_id": "MDQ6VXNlcjEyNDU5NzYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/12459761?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vmichalik",
      "html_url": "https://github.com/vmichalik",
      "followers_url": "https://api.github.com/users/vmichalik/followers",
      "following_url": "https://api.github.com/users/vmichalik/following{/other_user}",
      "gists_url": "https://api.github.com/users/vmichalik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vmichalik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vmichalik/subscriptions",
      "organizations_url": "https://api.github.com/users/vmichalik/orgs",
      "repos_url": "https://api.github.com/users/vmichalik/repos",
      "events_url": "https://api.github.com/users/vmichalik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vmichalik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-20T18:31:19Z",
    "updated_at": "2021-09-20T18:31:19Z",
    "author_association": "NONE",
    "body": "Hi @roderik, are you still experiencing this issue? If not, I'll go ahead and close it!",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/923175978/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/923795455",
    "html_url": "https://github.com/hyperledger/besu/issues/1114#issuecomment-923795455",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/1114",
    "id": 923795455,
    "node_id": "IC_kwDODE2jmc43D___",
    "user": {
      "login": "roderik",
      "id": 16780,
      "node_id": "MDQ6VXNlcjE2Nzgw",
      "avatar_url": "https://avatars.githubusercontent.com/u/16780?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/roderik",
      "html_url": "https://github.com/roderik",
      "followers_url": "https://api.github.com/users/roderik/followers",
      "following_url": "https://api.github.com/users/roderik/following{/other_user}",
      "gists_url": "https://api.github.com/users/roderik/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/roderik/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/roderik/subscriptions",
      "organizations_url": "https://api.github.com/users/roderik/orgs",
      "repos_url": "https://api.github.com/users/roderik/repos",
      "events_url": "https://api.github.com/users/roderik/events{/privacy}",
      "received_events_url": "https://api.github.com/users/roderik/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-21T09:20:51Z",
    "updated_at": "2021-09-21T09:20:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "Nope, all good here!",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/923795455/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
