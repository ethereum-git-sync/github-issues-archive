{
  "url": "https://api.github.com/repos/hyperledger/besu/issues/4147",
  "repository_url": "https://api.github.com/repos/hyperledger/besu",
  "labels_url": "https://api.github.com/repos/hyperledger/besu/issues/4147/labels{/name}",
  "comments_url": "https://api.github.com/repos/hyperledger/besu/issues/4147/comments",
  "events_url": "https://api.github.com/repos/hyperledger/besu/issues/4147/events",
  "html_url": "https://github.com/hyperledger/besu/issues/4147",
  "id": 1313133407,
  "node_id": "I_kwDODE2jmc5ORNNf",
  "number": 4147,
  "title": "Logging improvements",
  "user": {
    "login": "daniellehrner",
    "id": 6727189,
    "node_id": "MDQ6VXNlcjY3MjcxODk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6727189?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/daniellehrner",
    "html_url": "https://github.com/daniellehrner",
    "followers_url": "https://api.github.com/users/daniellehrner/followers",
    "following_url": "https://api.github.com/users/daniellehrner/following{/other_user}",
    "gists_url": "https://api.github.com/users/daniellehrner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/daniellehrner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/daniellehrner/subscriptions",
    "organizations_url": "https://api.github.com/users/daniellehrner/orgs",
    "repos_url": "https://api.github.com/users/daniellehrner/repos",
    "events_url": "https://api.github.com/users/daniellehrner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/daniellehrner/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2152224197,
      "node_id": "MDU6TGFiZWwyMTUyMjI0MTk3",
      "url": "https://api.github.com/repos/hyperledger/besu/labels/TeamRevenant",
      "name": "TeamRevenant",
      "color": "78e298",
      "default": false,
      "description": "GH issues worked on by Revenant Team"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "mark-terry",
    "id": 36909937,
    "node_id": "MDQ6VXNlcjM2OTA5OTM3",
    "avatar_url": "https://avatars.githubusercontent.com/u/36909937?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mark-terry",
    "html_url": "https://github.com/mark-terry",
    "followers_url": "https://api.github.com/users/mark-terry/followers",
    "following_url": "https://api.github.com/users/mark-terry/following{/other_user}",
    "gists_url": "https://api.github.com/users/mark-terry/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mark-terry/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mark-terry/subscriptions",
    "organizations_url": "https://api.github.com/users/mark-terry/orgs",
    "repos_url": "https://api.github.com/users/mark-terry/repos",
    "events_url": "https://api.github.com/users/mark-terry/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mark-terry/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "mark-terry",
      "id": 36909937,
      "node_id": "MDQ6VXNlcjM2OTA5OTM3",
      "avatar_url": "https://avatars.githubusercontent.com/u/36909937?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mark-terry",
      "html_url": "https://github.com/mark-terry",
      "followers_url": "https://api.github.com/users/mark-terry/followers",
      "following_url": "https://api.github.com/users/mark-terry/following{/other_user}",
      "gists_url": "https://api.github.com/users/mark-terry/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mark-terry/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mark-terry/subscriptions",
      "organizations_url": "https://api.github.com/users/mark-terry/orgs",
      "repos_url": "https://api.github.com/users/mark-terry/repos",
      "events_url": "https://api.github.com/users/mark-terry/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mark-terry/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-07-21T11:48:42Z",
  "updated_at": "2023-01-23T23:55:18Z",
  "closed_at": "2023-01-23T23:55:18Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\nWe want to improve the log file output to make it easier to understand for end users. I propose to clean up the `INFO` log level and make the target group for `INFO` the end user. \n\n- [ ] Remove thread and class name on the info log level. I think this does not provide any value to the end users\n  - An investigation found that the default log4j configuration varies between the log source and programmatically altering the default formatting was complicated \n- [x] Show an informative configuration section at the beginning (including storage, sync mode). Take Geth as example\n- [x] Move `Refreshing DNS records with enrtree` to debug or trace (in progress)\n- [x] `No sync target, checking current peers for usefulness` is too spammy. It should be only logged in a fixed interval [#4794](https://github.com/hyperledger/besu/issues/4794)\n- [ ] Snap sync: I think for we should output just the download progress in percent in a regular interval (eg 30s). The other output can be moved to `DEBUG`.  Geth prints an estimation how long it will take as well, which I find very useful [#4941](https://github.com/hyperledger/besu/issues/4941)\n- [ ] Snap sync: Once we are downloading blocks, it would be useful to print the the age of the latest block (eg 3y10m2d) to give a better sense how far we behind we are [#4941](https://github.com/hyperledger/besu/issues/4941)\n- [x] Make the log message `No sync target, checking current peers for usefulness messages` clearer or downgrade it to debug/trace [#4794](https://github.com/hyperledger/besu/issues/4794)\n- [x] Add context to  message ` BackwardsSyncAlgorithm | Waiting for preconditions..` #4915\n\n`DEBUG` and `TRACE` should not be changed for the time being, as the target group are mainly the Besu contributors. There are some extra logs that we should add:\n\n- [ ] Add why transactions have been rejected - made a separate ticket #4914\n\nRefer to protocol-misc # 486\n",
  "closed_by": {
    "login": "iamhsk",
    "id": 2249367,
    "node_id": "MDQ6VXNlcjIyNDkzNjc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2249367?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/iamhsk",
    "html_url": "https://github.com/iamhsk",
    "followers_url": "https://api.github.com/users/iamhsk/followers",
    "following_url": "https://api.github.com/users/iamhsk/following{/other_user}",
    "gists_url": "https://api.github.com/users/iamhsk/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/iamhsk/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/iamhsk/subscriptions",
    "organizations_url": "https://api.github.com/users/iamhsk/orgs",
    "repos_url": "https://api.github.com/users/iamhsk/repos",
    "events_url": "https://api.github.com/users/iamhsk/events{/privacy}",
    "received_events_url": "https://api.github.com/users/iamhsk/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/4147/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/hyperledger/besu/issues/4147/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1191978169",
    "html_url": "https://github.com/hyperledger/besu/issues/4147#issuecomment-1191978169",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4147",
    "id": 1191978169,
    "node_id": "IC_kwDODE2jmc5HDCS5",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-21T22:01:11Z",
    "updated_at": "2022-07-21T22:01:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'd be cautious of only logging download progress at % intervals because you don't know how long it will take to progress and the user needs regular feedback so they don't think it's stalled.\r\n\r\nI'd suggest a regular log line, say every 15 seconds, that gives a snapshot of the sync progress. Something like: `Syncing - Blocks: 1,000,000/10,000,000 (10%), World state: 25%, Peer count: 25`.  They may not be the exact details and there would need to be variants when progress is paused waiting for peers or waiting for info from the CL etc but that's the general idea. \r\n\r\nThen the logs about how the sync works could move down to debug level unless:\r\n\r\n* they're something particularly notable (starting sync, switching between modes in sync etc)\r\n* they're something unusual that the user should be aware of (a peer failing to respond is normal, an invalid block during long sync is probably unexpected and worth logging) or\r\n* the user needs to take some action (out of disk space, no calls from the CL for too long etc)",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1191978169/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1375041432",
    "html_url": "https://github.com/hyperledger/besu/issues/4147#issuecomment-1375041432",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4147",
    "id": 1375041432,
    "node_id": "IC_kwDODE2jmc5R9XeY",
    "user": {
      "login": "macfarla",
      "id": 2627919,
      "node_id": "MDQ6VXNlcjI2Mjc5MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2627919?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/macfarla",
      "html_url": "https://github.com/macfarla",
      "followers_url": "https://api.github.com/users/macfarla/followers",
      "following_url": "https://api.github.com/users/macfarla/following{/other_user}",
      "gists_url": "https://api.github.com/users/macfarla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/macfarla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/macfarla/subscriptions",
      "organizations_url": "https://api.github.com/users/macfarla/orgs",
      "repos_url": "https://api.github.com/users/macfarla/repos",
      "events_url": "https://api.github.com/users/macfarla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/macfarla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-09T02:49:25Z",
    "updated_at": "2023-01-09T02:49:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "This PR filters the DNS refresh messages (they come from tuweni) https://github.com/hyperledger/besu/pull/4155/files",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1375041432/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1401164794",
    "html_url": "https://github.com/hyperledger/besu/issues/4147#issuecomment-1401164794",
    "issue_url": "https://api.github.com/repos/hyperledger/besu/issues/4147",
    "id": 1401164794,
    "node_id": "IC_kwDODE2jmc5ThBP6",
    "user": {
      "login": "iamhsk",
      "id": 2249367,
      "node_id": "MDQ6VXNlcjIyNDkzNjc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2249367?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/iamhsk",
      "html_url": "https://github.com/iamhsk",
      "followers_url": "https://api.github.com/users/iamhsk/followers",
      "following_url": "https://api.github.com/users/iamhsk/following{/other_user}",
      "gists_url": "https://api.github.com/users/iamhsk/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/iamhsk/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/iamhsk/subscriptions",
      "organizations_url": "https://api.github.com/users/iamhsk/orgs",
      "repos_url": "https://api.github.com/users/iamhsk/repos",
      "events_url": "https://api.github.com/users/iamhsk/events{/privacy}",
      "received_events_url": "https://api.github.com/users/iamhsk/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-23T23:55:18Z",
    "updated_at": "2023-01-23T23:55:18Z",
    "author_association": "NONE",
    "body": "Decided not to investigate  log4j configuration issue further. Closing this issue.",
    "reactions": {
      "url": "https://api.github.com/repos/hyperledger/besu/issues/comments/1401164794/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
