{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/7315",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/7315/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/7315/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/7315/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/7315",
  "id": 1905193336,
  "node_id": "I_kwDODjvEJM5xjvF4",
  "number": 7315,
  "title": "Cannon fraud proofs have debug_dbGet dependency",
  "user": {
    "login": "jyellick",
    "id": 7431583,
    "node_id": "MDQ6VXNlcjc0MzE1ODM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7431583?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jyellick",
    "html_url": "https://github.com/jyellick",
    "followers_url": "https://api.github.com/users/jyellick/followers",
    "following_url": "https://api.github.com/users/jyellick/following{/other_user}",
    "gists_url": "https://api.github.com/users/jyellick/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jyellick/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jyellick/subscriptions",
    "organizations_url": "https://api.github.com/users/jyellick/orgs",
    "repos_url": "https://api.github.com/users/jyellick/repos",
    "events_url": "https://api.github.com/users/jyellick/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jyellick/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-09-20T15:03:03Z",
  "updated_at": "2023-09-25T09:29:06Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "I was a little unsure whether to classify this issue as a bug or a feature, so please feel free to convert.\r\n\r\nThere are a number of client diversity projects underway to bring Optimism support to Ethereum clients other than Geth.  The community seems to recognize the importance of having multiple client implementations for the health of the overall Optimism ecosystem.\r\n\r\nHowever, it seems that the Cannon fraud proofs are being built with a strong dependency on Geth specific APIs.  In particular, the `fraudproof_test.go` e2e tests seem to ultimately be using the `debug_dbGet` API.  Based on my reading of these tests, this API is not simply being used by the test, but is actually relied on by the implementation.  This feels like a serious problem because this API is not part of the formal Ethereum JSON RPC spec, so its behavior is not defined.  Additionally because there is no real versioning guarantees over the layout of the Geth database, it is also inherently not stable.\r\n\r\nI've not had a chance to really dig into exactly how this API is being used in Cannon, but based on other usage seen in the e2e tests, I suspect that its usage might be related to retrieving nodes of the Merkle Trie.  Could we instead use the `eth_getProof` API instead?  Do we need to put an EIP together for a new well specified API that other clients can implement?  Is the `debug_dbGet` usage simply intended to be transient and replaced with something else ultimately?  Is the coupling of the on-chain executing mini-Geth so tight that Cannon will never be able to be used with other Ethereum clients?\r\n\r\nIt would be great to hear some clarification on the above questions and to learn whether changes to eliminate this dependency would be welcomed.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/7315/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/7315/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1733295099",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/7315#issuecomment-1733295099",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/7315",
    "id": 1733295099,
    "node_id": "IC_kwDODjvEJM5nT_v7",
    "user": {
      "login": "protolambda",
      "id": 19571989,
      "node_id": "MDQ6VXNlcjE5NTcxOTg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/19571989?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/protolambda",
      "html_url": "https://github.com/protolambda",
      "followers_url": "https://api.github.com/users/protolambda/followers",
      "following_url": "https://api.github.com/users/protolambda/following{/other_user}",
      "gists_url": "https://api.github.com/users/protolambda/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/protolambda/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/protolambda/subscriptions",
      "organizations_url": "https://api.github.com/users/protolambda/orgs",
      "repos_url": "https://api.github.com/users/protolambda/repos",
      "events_url": "https://api.github.com/users/protolambda/events{/privacy}",
      "received_events_url": "https://api.github.com/users/protolambda/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-25T09:29:06Z",
    "updated_at": "2023-09-25T09:29:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "I definitely hope to support all clients with standard RPC in the future, the debug method is there because it simplified and derisked the MPT a lot, to unblock development of other parts of the proof stack.\r\n\r\nPrevious versions of Cannon have tried `eth_getProof` instead, but this added significant complexity at the time, since `eth_getProof` is meant to provide MPT data only as part of a branch to a leaf node. Edge-cases related to retrieving the right pre-images, even throughout MPT changes (node deletions etc. included), are challenging and resulted in several bugs.\r\n\r\n `debug_dbGet` is thus used instead to retrieve the MPT nodes, providing a much simpler hash->preimage lookup for the MPT nodes (at least when using the old geth tree based DB scheme).\r\n\r\nHowever, with new improvements to the FP design, there may be a way to make `eth_getProof` work: by utilizing the preimage-hinting system. I.e. the op-program client can write a new type of hint, that essentially says to the server: \"I'll need all preimages of state-root X and path y\", and the op-program host can prepare the preimages. The in-memory op-program oracle-backed state DB can then fetch the preimages lazily as necessary, and retain a copy of them to then build any new branches on top of, and cache for future use, without interrupting future preimage lookups, since hints are always written with full path/state-root information, unlike previous versions in the original minigeth that had to deal with MPT edits/deletions to fetch the right preimages.\r\n\r\nSo yes, I believe we can move it back to `eth_getProof` thanks to newer features that were introduced after the original MPT-proving issues with legacy Cannon/minigeth setup, it will still add a little bit of complexity, but remove the `debug_dbGet` dependency.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1733295099/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
