{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5468",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5468/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5468/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5468/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/5468",
  "id": 1671066971,
  "node_id": "I_kwDODjvEJM5jmnVb",
  "number": 5468,
  "title": "DTL: TypeError: Cannot read properties of null (reading 'from')",
  "user": {
    "login": "prih",
    "id": 3285877,
    "node_id": "MDQ6VXNlcjMyODU4Nzc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3285877?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/prih",
    "html_url": "https://github.com/prih",
    "followers_url": "https://api.github.com/users/prih/followers",
    "following_url": "https://api.github.com/users/prih/following{/other_user}",
    "gists_url": "https://api.github.com/users/prih/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/prih/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/prih/subscriptions",
    "organizations_url": "https://api.github.com/users/prih/orgs",
    "repos_url": "https://api.github.com/users/prih/repos",
    "events_url": "https://api.github.com/users/prih/events{/privacy}",
    "received_events_url": "https://api.github.com/users/prih/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832490,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNDkw",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bug",
      "name": "C-bug",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: This is a bug."
    },
    {
      "id": 2907832766,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNzY2",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/M-dtl",
      "name": "M-dtl",
      "color": "FBCA04",
      "default": false,
      "description": "Module: data transport layer"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-04-17T12:31:22Z",
  "updated_at": "2023-04-24T09:58:50Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!--\r\nNeed help?\r\nRefer to our contributing guidelines for additional information about making a good issue:\r\nhttps://github.com/ethereum-optimism/.github/blob/master/CONTRIBUTING.md\r\n-->\r\n\r\n**Describe the bug**\r\nerror occurs on block L1 16814466\r\n\r\n```\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373575,\"msg\":\"Service is starting...\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373576,\"msg\":\"Service is initializing...\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373576,\"msg\":\"Initializing L1 Data Transport Service...\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373736,\"msg\":\"L2 chain ID is: 10\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373736,\"msg\":\"BSS HF1 will activate at: 2824317\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373741,\"msg\":\"Service is initializing...\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373746,\"defaultBackend\":\"l1\",\"l1GasPriceBackend\":\"l1\",\"msg\":\"HTTP Server Options\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373746,\"url\":\"http://192.168.0.4:8045\",\"msg\":\"HTTP Server L1 RPC Provider initialized\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373746,\"url\":\"http://192.168.0.4:8045\",\"msg\":\"HTTP Server L2 RPC Provider initialized\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373746,\"msg\":\"Service has initialized.\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373746,\"msg\":\"Service is initializing...\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373764,\"addressManager\":\"0xdE1FCfB0851916CA5101820A69b13a4E276bd81F\",\"msg\":\"Using AddressManager\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373800,\"startingL1BlockNumber\":13596466,\"msg\":\"Starting sync\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373804,\"msg\":\"Service has initialized.\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373804,\"msg\":\"Service has initialized.\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373804,\"msg\":\"Service is starting...\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373804,\"msg\":\"Service is starting...\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373807,\"host\":\"0.0.0.0\",\"port\":7878,\"msg\":\"Server started and listening\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373808,\"msg\":\"Service has started\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733373812,\"highestSyncedL1Block\":16814466,\"targetL1Block\":16816466,\"msg\":\"Synchronizing events from Layer 1 (Ethereum)\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733374286,\"eventName\":\"TransactionEnqueued\",\"numEvents\":216,\"durationMs\":48,\"msg\":\"Processed events\"}\r\noptimism-dtl-1  | {\"level\":50,\"time\":1681733418402,\"extra\":{\"message\":\"TypeError: Cannot read properties of null (reading 'from')\",\"stack\":\"TypeError: Cannot read properties of null (reading 'from')\\n    at Object.getExtraData (/opt/optimism/packages/data-transport-layer/dist/src/services/l1-ingestion/handlers/sequencer-batch-appended.js:27:38)\\n    at runMicrotasks (<anonymous>)\\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\\n    at async L1IngestionService._syncEvents (/opt/optimism/packages/data-transport-layer/dist/src/services/l1-ingestion/service.js:286:39)\\n    at async L1IngestionService._start (/opt/optimism/packages/data-transport-layer/dist/src/services/l1-ingestion/service.js:165:17)\\n    at async L1IngestionService.start (/opt/optimism/packages/common-ts/dist/base-service/base-service.js:33:9)\\n    at async Promise.all (index 1)\\n    at async L1DataTransportService._start (/opt/optimism/packages/data-transport-layer/dist/src/services/main/service.js:69:13)\\n    at async L1DataTransportService.start (/opt/optimism/packages/common-ts/dist/base-service/base-service.js:33:9)\\n    at async /opt/optimism/packages/data-transport-layer/dist/src/services/run.js:78:9\"},\"msg\":\"Caught an unhandled error\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733418904,\"highestSyncedL1Block\":16814466,\"targetL1Block\":16816466,\"msg\":\"Synchronizing events from Layer 1 (Ethereum)\"}\r\noptimism-dtl-1  | {\"level\":30,\"time\":1681733419270,\"eventName\":\"TransactionEnqueued\",\"numEvents\":216,\"durationMs\":60,\"msg\":\"Processed events\"}\r\n``` \r\n\r\n**To Reproduce**\r\n\r\n.env\r\n```env\r\n# Network to run the node on (\"mainnet\" or \"goerli\")\r\nNETWORK_NAME=mainnet\r\n\r\n# Type of node to run (\"full\" or \"archive\"), note that \"archive\" is 10x bigger\r\nNODE_TYPE=full\r\n\r\n# Where to sync data from (\"l1\" or \"l2\"), see README\r\nSYNC_SOURCE=l1\r\n\r\n# Reference L2 node to run healthcheck against\r\nHEALTHCHECK__REFERENCE_RPC_PROVIDER=https://mainnet.optimism.io\r\n\r\n# L1 node to run fault detection against\r\nFAULT_DETECTOR__L1_RPC_PROVIDER=http://192.168.0.4:8045\r\n\r\n# Node to get chain data from (if SYNC_SOURCE is \"l1\" then use L1 node, etc.)\r\nDATA_TRANSPORT_LAYER__RPC_ENDPOINT=http://192.168.0.4:8045\r\n```\r\n\r\ndtl.env\r\n```env\r\nDATA_TRANSPORT_LAYER__ADDRESS_MANAGER=0xdE1FCfB0851916CA5101820A69b13a4E276bd81F\r\nDATA_TRANSPORT_LAYER__L1_START_HEIGHT=13596466\r\nDATA_TRANSPORT_LAYER__CONFIRMATIONS=12\r\nDATA_TRANSPORT_LAYER__DANGEROUSLY_CATCH_ALL_ERRORS=true\r\nDATA_TRANSPORT_LAYER__DB_PATH=/db\r\nDATA_TRANSPORT_LAYER__ENABLE_METRICS=true\r\nDATA_TRANSPORT_LAYER__ETH_NETWORK_NAME=mainnet\r\nDATA_TRANSPORT_LAYER__L2_CHAIN_ID=10\r\nDATA_TRANSPORT_LAYER__LOGS_PER_POLLING_INTERVAL=2000\r\nDATA_TRANSPORT_LAYER__NODE_ENV=production\r\nDATA_TRANSPORT_LAYER__POLLING_INTERVAL=500\r\nDATA_TRANSPORT_LAYER__SENTRY_TRACE_RATE=0.05\r\nDATA_TRANSPORT_LAYER__SERVER_HOSTNAME=0.0.0.0\r\nDATA_TRANSPORT_LAYER__SERVER_PORT=7878\r\nDATA_TRANSPORT_LAYER__TRANSACTIONS_PER_POLLING_INTERVAL=1000\r\n```\r\n\r\ndtl-start.sh\r\n```bash\r\n# Setting both endpoints doesn't hurt\r\nexport DATA_TRANSPORT_LAYER__L1_RPC_ENDPOINT=$DATA_TRANSPORT_LAYER__RPC_ENDPOINT\r\nexport DATA_TRANSPORT_LAYER__L2_RPC_ENDPOINT=$DATA_TRANSPORT_LAYER__RPC_ENDPOINT\r\n\r\n# Set the backend depending on given sync source\r\nexport DATA_TRANSPORT_LAYER__DEFAULT_BACKEND=$SYNC_SOURCE\r\nexport DATA_TRANSPORT_LAYER__L1_GAS_PRICE_BACKEND=$SYNC_SOURCE\r\n\r\n# Also tell the DTL to sync from the right place\r\nif [ $SYNC_SOURCE == \"l1\" ]; then\r\n  export DATA_TRANSPORT_LAYER__SYNC_FROM_L1=true\r\n  export DATA_TRANSPORT_LAYER__SYNC_FROM_L2=false\r\nelse\r\n  export DATA_TRANSPORT_LAYER__SYNC_FROM_L1=false\r\n  export DATA_TRANSPORT_LAYER__SYNC_FROM_L2=true\r\nfi\r\n\r\n# Run the DTL\r\nexec node \\\r\n  dist/src/services/run.js \\\r\n  $@\r\n```\r\n\r\ndocker-compose.yml\r\n```yaml\r\nservices:\r\n  dtl:\r\n    image: ethereumoptimism/data-transport-layer:${IMAGE_TAG__DTL:-latest}\r\n    restart: unless-stopped\r\n    entrypoint: /scripts/dtl-start.sh\r\n    env_file:\r\n      - ./envs/${NETWORK_NAME}/dtl.env\r\n      - .env\r\n    volumes:\r\n      - /mnt/data/optimism/dtl:/db\r\n      - ./scripts/:/scripts/\r\n    ports:\r\n      - ${PORT__DTL:-7878}:7878\r\n    <<: *logging\r\n```\r\n\r\n**Ethereum Mainnet Node**\r\n\r\ndocker-compose.yml\r\n```yaml\r\nethereum:\r\n    image: \"ethereum/client-go:v1.11.5\"\r\n    command:\r\n      --snapshot=false\r\n      --txlookuplimit=0\r\n      --cache.preimages\r\n      --rpc.allow-unprotected-txs\r\n      --authrpc.addr 0.0.0.0\r\n      --authrpc.vhosts *\r\n      --cache 8192\r\n      --http\r\n      --http.addr 0.0.0.0\r\n      --http.port 8045\r\n      --http.api web3,net,eth\r\n      --http.corsdomain *\r\n      --http.vhosts *\r\n      --ws\r\n      --ws.addr 0.0.0.0\r\n      --ws.port 8046\r\n      --ws.api web3,net,eth\r\n      --ws.origins *\r\n      --syncmode snap\r\n      --port 30303\r\n```\r\n\r\n**System Specs:**\r\n - OS: Ubuntu 22.04.2 LTS\r\n - Docker 23.0.3\r\n - Package Version (or commit hash): ethereumoptimism/data-transport-layer:latest (9d3140b608da)\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5468/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5468/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1514907502",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/5468#issuecomment-1514907502",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5468",
    "id": 1514907502,
    "node_id": "IC_kwDODjvEJM5aS6du",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-19T15:08:49Z",
    "updated_at": "2023-04-19T15:08:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "Mmhh this is usually an issue with the L1 node",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1514907502/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1515298908",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/5468#issuecomment-1515298908",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5468",
    "id": 1515298908,
    "node_id": "IC_kwDODjvEJM5aUaBc",
    "user": {
      "login": "prih",
      "id": 3285877,
      "node_id": "MDQ6VXNlcjMyODU4Nzc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3285877?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/prih",
      "html_url": "https://github.com/prih",
      "followers_url": "https://api.github.com/users/prih/followers",
      "following_url": "https://api.github.com/users/prih/following{/other_user}",
      "gists_url": "https://api.github.com/users/prih/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/prih/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/prih/subscriptions",
      "organizations_url": "https://api.github.com/users/prih/orgs",
      "repos_url": "https://api.github.com/users/prih/repos",
      "events_url": "https://api.github.com/users/prih/events{/privacy}",
      "received_events_url": "https://api.github.com/users/prih/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-19T19:56:54Z",
    "updated_at": "2023-04-19T19:56:54Z",
    "author_association": "NONE",
    "body": "> Mmhh this is usually an issue with the L1 node\r\n\r\nhow to check it? I tried all blocks nearby, all transactions are there... Arbitrum, Polygon - all ok with this node.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1515298908/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1519808407",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/5468#issuecomment-1519808407",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5468",
    "id": 1519808407,
    "node_id": "IC_kwDODjvEJM5alm-X",
    "user": {
      "login": "pavelfedortsov2",
      "id": 129864553,
      "node_id": "U_kgDOB72TaQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/129864553?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pavelfedortsov2",
      "html_url": "https://github.com/pavelfedortsov2",
      "followers_url": "https://api.github.com/users/pavelfedortsov2/followers",
      "following_url": "https://api.github.com/users/pavelfedortsov2/following{/other_user}",
      "gists_url": "https://api.github.com/users/pavelfedortsov2/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pavelfedortsov2/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pavelfedortsov2/subscriptions",
      "organizations_url": "https://api.github.com/users/pavelfedortsov2/orgs",
      "repos_url": "https://api.github.com/users/pavelfedortsov2/repos",
      "events_url": "https://api.github.com/users/pavelfedortsov2/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pavelfedortsov2/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-24T09:58:49Z",
    "updated_at": "2023-04-24T09:58:49Z",
    "author_association": "NONE",
    "body": "Same for me\r\n\r\nsimple-optimism-node-dtl-1  | {\"level\":30,\"time\":1682330061933,\"highestSyncedL1Block\":13596466,\"targetL1Block\":13598466,\"msg\":\"Synchronizing events from Layer 1 (Ethereum)\"}\r\nsimple-optimism-node-dtl-1  | {\"level\":30,\"time\":1682330062022,\"eventName\":\"TransactionEnqueued\",\"numEvents\":23,\"durationMs\":2,\"msg\":\"Processed events\"}\r\nsimple-optimism-node-dtl-1  | {\"level\":50,\"time\":1682330062074,\"extra\":{\"message\":\"TypeError: Cannot read properties of null (reading 'from')\",\"stack\":\"TypeError: Cannot read properties of null (reading 'from')\\n    at Object.getExtraData (/opt/optimism/packages/data-transport-layer/dist/src/services/l1-ingestion/handlers/sequencer-batch-appended.js:27:38)\\n    at runMicrotasks (<anonymous>)\\n    at processTicksAndRejections (node:internal/process/task_queues:96:5)\\n    at async L1IngestionService._syncEvents (/opt/optimism/packages/data-transport-layer/dist/src/services/l1-ingestion/service.js:286:39)\\n    at async L1IngestionService._start (/opt/optimism/packages/data-transport-layer/dist/src/services/l1-ingestion/service.js:165:17)\\n    at async L1IngestionService.start (/opt/optimism/packages/common-ts/dist/base-service/base-service.js:33:9)\\n    at async Promise.all (index 1)\\n    at async L1DataTransportService._start (/opt/optimism/packages/data-transport-layer/dist/src/services/main/service.js:69:13)\\n    at async L1DataTransportService.start (/opt/optimism/packages/common-ts/dist/base-service/base-service.js:33:9)\\n    at async /opt/optimism/packages/data-transport-layer/dist/src/services/run.js:78:9\"},\"msg\":\"Caught an unhandled error\"}\r\nsimple-optimism-node-dtl-1  | {\"level\":30,\"time\":1682330062253,\"method\":\"GET\",\"url\":\"/batch/transaction/latest\",\"elapsed\":0,\"msg\":\"Served HTTP Request\"}\r\n\r\n\r\ngeth v1.11.5",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1519808407/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
