{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/706",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/706/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/706/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/706/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/706",
  "id": 871737737,
  "node_id": "MDU6SXNzdWU4NzE3Mzc3Mzc=",
  "number": 706,
  "title": "Add ability to initiate an L2 upgrade on L1",
  "user": {
    "login": "karlfloersch",
    "id": 706123,
    "node_id": "MDQ6VXNlcjcwNjEyMw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/706123?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karlfloersch",
    "html_url": "https://github.com/karlfloersch",
    "followers_url": "https://api.github.com/users/karlfloersch/followers",
    "following_url": "https://api.github.com/users/karlfloersch/following{/other_user}",
    "gists_url": "https://api.github.com/users/karlfloersch/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karlfloersch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karlfloersch/subscriptions",
    "organizations_url": "https://api.github.com/users/karlfloersch/orgs",
    "repos_url": "https://api.github.com/users/karlfloersch/repos",
    "events_url": "https://api.github.com/users/karlfloersch/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karlfloersch/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832555,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNTU1",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-feature-request",
      "name": "C-feature-request",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: A feature request."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "smartcontracts",
    "id": 14298799,
    "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/smartcontracts",
    "html_url": "https://github.com/smartcontracts",
    "followers_url": "https://api.github.com/users/smartcontracts/followers",
    "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
    "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
    "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
    "repos_url": "https://api.github.com/users/smartcontracts/repos",
    "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
    "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-04-30T00:54:41Z",
  "updated_at": "2021-05-20T19:40:06Z",
  "closed_at": "2021-05-20T19:40:06Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!--\r\nNeed help?\r\nRefer to our contributing guidelines for additional information about making a good issue:\r\nhttps://github.com/ethereum-optimism/.github/blob/master/CONTRIBUTING.md\r\n-->\r\n\r\n**Is your feature request related to a problem? Please describe.**\r\nWe would like the ability to use a contract on L1 to authenticate upgrades to L2 for security & stability reasons. \r\n\r\n**Describe the solution you'd like**\r\nIn order for us to do this, we will need to send a message from L1 into L2 that starts an upgrade. Once an upgrade is started, the L2 ExecutionManager must pause transactions to any account that is not the upgrade contract.\r\n\r\nOne side-effect of pausing transactions on L2 is that all deposits will fail to be executed until the upgrade is complete. This is unfortunate but it's hard to avoid. However, thankfully we can replay all deposits by using: https://github.com/ethereum-optimism/optimism/issues/705 !\r\n\r\nThe mechanics of this is as follows:\r\n1. Create a transaction on L1 which submits an `enqueue` which initiates the L2 upgrade.\r\n2. Wait until the enqueue which initiates the upgrade is processed. This will change the ExecutionManager to only forward transactions along to the upgrade contract.\r\n3. Submit a bunch of off-chain transactions to the sequencer which carry out the upgrade.\r\n4. Once the upgrade on L2 is done, run the deposit replayer and make sure that any enqueue messages that failed because of the upgrade are included!\r\n\r\n**Blockers**\r\n https://github.com/ethereum-optimism/optimism/issues/705\r\n",
  "closed_by": {
    "login": "smartcontracts",
    "id": 14298799,
    "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/smartcontracts",
    "html_url": "https://github.com/smartcontracts",
    "followers_url": "https://api.github.com/users/smartcontracts/followers",
    "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
    "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
    "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
    "repos_url": "https://api.github.com/users/smartcontracts/repos",
    "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
    "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/706/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/706/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/831502839",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/706#issuecomment-831502839",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/706",
    "id": 831502839,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzMTUwMjgzOQ==",
    "user": {
      "login": "karlfloersch",
      "id": 706123,
      "node_id": "MDQ6VXNlcjcwNjEyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/706123?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karlfloersch",
      "html_url": "https://github.com/karlfloersch",
      "followers_url": "https://api.github.com/users/karlfloersch/followers",
      "following_url": "https://api.github.com/users/karlfloersch/following{/other_user}",
      "gists_url": "https://api.github.com/users/karlfloersch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karlfloersch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karlfloersch/subscriptions",
      "organizations_url": "https://api.github.com/users/karlfloersch/orgs",
      "repos_url": "https://api.github.com/users/karlfloersch/repos",
      "events_url": "https://api.github.com/users/karlfloersch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karlfloersch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-03T20:08:53Z",
    "updated_at": "2021-05-03T20:10:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "- Write function which ABI encodes for you  `abi.encode(l2ContractCalldata)`\r\n- Make change in L2 contract to support L1 message from XDomainMessenger\r\n- Add comprehensive tests ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/831502839/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/838676334",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/706#issuecomment-838676334",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/706",
    "id": 838676334,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzODY3NjMzNA==",
    "user": {
      "login": "ben-chain",
      "id": 10091895,
      "node_id": "MDQ6VXNlcjEwMDkxODk1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10091895?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ben-chain",
      "html_url": "https://github.com/ben-chain",
      "followers_url": "https://api.github.com/users/ben-chain/followers",
      "following_url": "https://api.github.com/users/ben-chain/following{/other_user}",
      "gists_url": "https://api.github.com/users/ben-chain/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ben-chain/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ben-chain/subscriptions",
      "organizations_url": "https://api.github.com/users/ben-chain/orgs",
      "repos_url": "https://api.github.com/users/ben-chain/repos",
      "events_url": "https://api.github.com/users/ben-chain/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ben-chain/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-11T15:24:32Z",
    "updated_at": "2021-05-11T15:24:32Z",
    "author_association": "COLLABORATOR",
    "body": "Now that I have reviewed https://github.com/ethereum-optimism/optimism/pull/755/, I believe this is even simpler than originally planned.  Since the `L2ChugsplashDeployer` already implements L2-specific logic, I think it's fine to double down on that, and just do this: Replace the [`onlyOwner`](https://github.com/ethereum-optimism/optimism/blob/feee5dc2d941e93874b8149f7d6306aa67d85903/packages/contracts/contracts/chugsplash/L2ChugSplashDeployer.sol#L126) modifier checks in it with the [`onlyFromCrossDomainAccount` modifier](https://github.com/ethereum-optimism/optimism/blob/feee5dc2d941e93874b8149f7d6306aa67d85903/packages/contracts/contracts/optimistic-ethereum/libraries/bridge/OVM_CrossDomainEnabled.sol#L47).  I think this basically makes it a one-line change in the contracts, and hopefully the smock testing is similarly easy.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/838676334/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/840805131",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/706#issuecomment-840805131",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/706",
    "id": 840805131,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDgwNTEzMQ==",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-13T20:12:01Z",
    "updated_at": "2021-05-13T20:12:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Would be closed by #854 ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/840805131/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
