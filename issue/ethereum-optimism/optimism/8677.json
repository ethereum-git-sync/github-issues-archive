{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8677",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8677/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8677/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8677/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/8677",
  "id": 2047791356,
  "node_id": "I_kwDODjvEJM56DtD8",
  "number": 8677,
  "title": "Indexer CI Flakiness",
  "user": {
    "login": "hamdiallam",
    "id": 10552045,
    "node_id": "MDQ6VXNlcjEwNTUyMDQ1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10552045?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hamdiallam",
    "html_url": "https://github.com/hamdiallam",
    "followers_url": "https://api.github.com/users/hamdiallam/followers",
    "following_url": "https://api.github.com/users/hamdiallam/following{/other_user}",
    "gists_url": "https://api.github.com/users/hamdiallam/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hamdiallam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hamdiallam/subscriptions",
    "organizations_url": "https://api.github.com/users/hamdiallam/orgs",
    "repos_url": "https://api.github.com/users/hamdiallam/repos",
    "events_url": "https://api.github.com/users/hamdiallam/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hamdiallam/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832490,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNDkw",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bug",
      "name": "C-bug",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: bugs"
    },
    {
      "id": 4703439312,
      "node_id": "LA_kwDODjvEJM8AAAABGFjJ0A",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/A-indexer",
      "name": "A-indexer",
      "color": "FEF2C0",
      "default": false,
      "description": "Area: indexer"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "hamdiallam",
    "id": 10552045,
    "node_id": "MDQ6VXNlcjEwNTUyMDQ1",
    "avatar_url": "https://avatars.githubusercontent.com/u/10552045?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/hamdiallam",
    "html_url": "https://github.com/hamdiallam",
    "followers_url": "https://api.github.com/users/hamdiallam/followers",
    "following_url": "https://api.github.com/users/hamdiallam/following{/other_user}",
    "gists_url": "https://api.github.com/users/hamdiallam/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/hamdiallam/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/hamdiallam/subscriptions",
    "organizations_url": "https://api.github.com/users/hamdiallam/orgs",
    "repos_url": "https://api.github.com/users/hamdiallam/repos",
    "events_url": "https://api.github.com/users/hamdiallam/events{/privacy}",
    "received_events_url": "https://api.github.com/users/hamdiallam/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "hamdiallam",
      "id": 10552045,
      "node_id": "MDQ6VXNlcjEwNTUyMDQ1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10552045?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hamdiallam",
      "html_url": "https://github.com/hamdiallam",
      "followers_url": "https://api.github.com/users/hamdiallam/followers",
      "following_url": "https://api.github.com/users/hamdiallam/following{/other_user}",
      "gists_url": "https://api.github.com/users/hamdiallam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hamdiallam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hamdiallam/subscriptions",
      "organizations_url": "https://api.github.com/users/hamdiallam/orgs",
      "repos_url": "https://api.github.com/users/hamdiallam/repos",
      "events_url": "https://api.github.com/users/hamdiallam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hamdiallam/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-12-19T02:14:13Z",
  "updated_at": "2023-12-25T19:13:20Z",
  "closed_at": null,
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "The indexer e2e tests sometimes fail due to timeout errors surface from op-e2e.\r\n> Error:          Received unexpected error:\r\n                                failed to get receipt: dial tcp 127.0.0.1:49297: i/o timeout\r\n\r\nThis can also be repo'd simply running the all the e2e tests in `/indexer/e2e_tests`. However these tests never fail when run individually so this issue will track debugging why they periodically fail when run in parallel.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8677/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8677/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1861994065",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/8677#issuecomment-1861994065",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8677",
    "id": 1861994065,
    "node_id": "IC_kwDODjvEJM5u-8ZR",
    "user": {
      "login": "hamdiallam",
      "id": 10552045,
      "node_id": "MDQ6VXNlcjEwNTUyMDQ1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10552045?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hamdiallam",
      "html_url": "https://github.com/hamdiallam",
      "followers_url": "https://api.github.com/users/hamdiallam/followers",
      "following_url": "https://api.github.com/users/hamdiallam/following{/other_user}",
      "gists_url": "https://api.github.com/users/hamdiallam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hamdiallam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hamdiallam/subscriptions",
      "organizations_url": "https://api.github.com/users/hamdiallam/orgs",
      "repos_url": "https://api.github.com/users/hamdiallam/repos",
      "events_url": "https://api.github.com/users/hamdiallam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hamdiallam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-19T02:15:33Z",
    "updated_at": "2023-12-19T02:15:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "Initial hypothesis is some resources being shared between parallel instances of op-e2e causing the timeout on the client side. It would make in single-instances of op-e2e that this isn't an issue. Going to dive a bit deeper into the resources managed by a setup of op-e2e",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1861994065/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1863706292",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/8677#issuecomment-1863706292",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8677",
    "id": 1863706292,
    "node_id": "IC_kwDODjvEJM5vFea0",
    "user": {
      "login": "hamdiallam",
      "id": 10552045,
      "node_id": "MDQ6VXNlcjEwNTUyMDQ1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10552045?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hamdiallam",
      "html_url": "https://github.com/hamdiallam",
      "followers_url": "https://api.github.com/users/hamdiallam/followers",
      "following_url": "https://api.github.com/users/hamdiallam/following{/other_user}",
      "gists_url": "https://api.github.com/users/hamdiallam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hamdiallam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hamdiallam/subscriptions",
      "organizations_url": "https://api.github.com/users/hamdiallam/orgs",
      "repos_url": "https://api.github.com/users/hamdiallam/repos",
      "events_url": "https://api.github.com/users/hamdiallam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hamdiallam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-20T01:37:43Z",
    "updated_at": "2023-12-20T01:37:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "The indexer marks the e2e tests as parallel after starting the devnet. Another suspicion is that this causes a large number of go-routines to be created for each test while the test itself is paused.\r\n\r\nThe test should be marked as parallel prior to all this work being done. This will help the test only create resources as needed in order to successfully complete",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1863706292/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1864850333",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/8677#issuecomment-1864850333",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8677",
    "id": 1864850333,
    "node_id": "IC_kwDODjvEJM5vJ1ud",
    "user": {
      "login": "hamdiallam",
      "id": 10552045,
      "node_id": "MDQ6VXNlcjEwNTUyMDQ1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10552045?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hamdiallam",
      "html_url": "https://github.com/hamdiallam",
      "followers_url": "https://api.github.com/users/hamdiallam/followers",
      "following_url": "https://api.github.com/users/hamdiallam/following{/other_user}",
      "gists_url": "https://api.github.com/users/hamdiallam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hamdiallam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hamdiallam/subscriptions",
      "organizations_url": "https://api.github.com/users/hamdiallam/orgs",
      "repos_url": "https://api.github.com/users/hamdiallam/repos",
      "events_url": "https://api.github.com/users/hamdiallam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hamdiallam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-20T17:16:51Z",
    "updated_at": "2023-12-20T17:16:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "Still looks like there some flakes even with #8695\r\n\r\nThe flakes occur when waiting on a receipt on a submitted L2 transaction. It reaches the internal 2m bound in `wait.ForReceiptOK`. Need to continue to investigate why this happens for tests run in parallel\r\n\r\nL2 block building doesn't get stuck. Perhaps the batcher runs into some issues",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1864850333/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1868125146",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/8677#issuecomment-1868125146",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8677",
    "id": 1868125146,
    "node_id": "IC_kwDODjvEJM5vWVPa",
    "user": {
      "login": "hamdiallam",
      "id": 10552045,
      "node_id": "MDQ6VXNlcjEwNTUyMDQ1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10552045?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hamdiallam",
      "html_url": "https://github.com/hamdiallam",
      "followers_url": "https://api.github.com/users/hamdiallam/followers",
      "following_url": "https://api.github.com/users/hamdiallam/following{/other_user}",
      "gists_url": "https://api.github.com/users/hamdiallam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hamdiallam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hamdiallam/subscriptions",
      "organizations_url": "https://api.github.com/users/hamdiallam/orgs",
      "repos_url": "https://api.github.com/users/hamdiallam/repos",
      "events_url": "https://api.github.com/users/hamdiallam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hamdiallam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-22T23:18:27Z",
    "updated_at": "2023-12-22T23:18:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "op-e2e sets the L2 block time to 1s with L1 blocktime to 2s. When a bunch of tests are running in parallel, the L2 transactions may be getting stuck due to the volume of blocks being produced by different routines while contending for cpu resources.\r\n\r\nI'm going to experiment with bumping up these values such that the local devnets for these tests have some idle time between blocks to ease resource contention",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1868125146/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1869090227",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/8677#issuecomment-1869090227",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8677",
    "id": 1869090227,
    "node_id": "IC_kwDODjvEJM5vaA2z",
    "user": {
      "login": "hamdiallam",
      "id": 10552045,
      "node_id": "MDQ6VXNlcjEwNTUyMDQ1",
      "avatar_url": "https://avatars.githubusercontent.com/u/10552045?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/hamdiallam",
      "html_url": "https://github.com/hamdiallam",
      "followers_url": "https://api.github.com/users/hamdiallam/followers",
      "following_url": "https://api.github.com/users/hamdiallam/following{/other_user}",
      "gists_url": "https://api.github.com/users/hamdiallam/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/hamdiallam/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/hamdiallam/subscriptions",
      "organizations_url": "https://api.github.com/users/hamdiallam/orgs",
      "repos_url": "https://api.github.com/users/hamdiallam/repos",
      "events_url": "https://api.github.com/users/hamdiallam/events{/privacy}",
      "received_events_url": "https://api.github.com/users/hamdiallam/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-25T19:13:20Z",
    "updated_at": "2023-12-25T19:13:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "Instrumenting op-geth logs, seeing this message which explains why the L2 transaction isn't included\r\n>t=2023-12-24T22:00:01-0800 lvl=trce msg=\"Skipping transaction with low nonce\"    hash=0x0d7aff5f2bcc00c2777cb68a1a646fb74e3f09e669b969b8fb3c1a9f6a0ecbe3 sender=0x15d34AAf54267DB7D7c367839AAf71A00a2C6A65 nonce=0\r\n\r\n\r\nHowever, there are no other transactions from the account so will have to investigate why this is happening",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1869090227/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
