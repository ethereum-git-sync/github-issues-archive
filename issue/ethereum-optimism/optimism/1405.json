{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1405",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1405/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1405/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1405/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/1405",
  "id": 984523721,
  "node_id": "MDU6SXNzdWU5ODQ1MjM3MjE=",
  "number": 1405,
  "title": "User bug:  cannot start `ops` tool docker containers on M1 Mac",
  "user": {
    "login": "platocrat",
    "id": 37757724,
    "node_id": "MDQ6VXNlcjM3NzU3NzI0",
    "avatar_url": "https://avatars.githubusercontent.com/u/37757724?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/platocrat",
    "html_url": "https://github.com/platocrat",
    "followers_url": "https://api.github.com/users/platocrat/followers",
    "following_url": "https://api.github.com/users/platocrat/following{/other_user}",
    "gists_url": "https://api.github.com/users/platocrat/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/platocrat/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/platocrat/subscriptions",
    "organizations_url": "https://api.github.com/users/platocrat/orgs",
    "repos_url": "https://api.github.com/users/platocrat/repos",
    "events_url": "https://api.github.com/users/platocrat/events{/privacy}",
    "received_events_url": "https://api.github.com/users/platocrat/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832490,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNDkw",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bug",
      "name": "C-bug",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: This is a bug."
    },
    {
      "id": 2907832834,
      "node_id": "MDU6TGFiZWwyOTA3ODMyODM0",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/M-ops",
      "name": "M-ops",
      "color": "FBCA04",
      "default": false,
      "description": "Module: ops"
    },
    {
      "id": 2930018676,
      "node_id": "MDU6TGFiZWwyOTMwMDE4Njc2",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/P-unconfirmed",
      "name": "P-unconfirmed",
      "color": "BFD4F2",
      "default": false,
      "description": "Issue might be valid, but itâ€™s not yet confirmed"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-09-01T02:10:45Z",
  "updated_at": "2022-03-27T17:05:28Z",
  "closed_at": "2022-03-27T17:05:28Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!--\r\nNeed help?\r\nRefer to our contributing guidelines for additional information about making a good issue:\r\nhttps://github.com/ethereum-optimism/.github/blob/master/CONTRIBUTING.md\r\n-->\r\n\r\n**Describe the bug**\r\nI was trying to help debug @matYang's error while starting the docker containers of the `ops` tool.\r\n\r\nHis error when starting the containers:\r\n![image](https://user-images.githubusercontent.com/37757724/131599919-a4ee119c-ffad-452b-a850-a271256fbb5d.png)\r\n\r\n![image](https://user-images.githubusercontent.com/37757724/131599931-5dc0d5e2-31af-4c43-bbd8-ec3b44e4491b.png)\r\n\r\n\r\n**To Reproduce**\r\n\r\nNOTE:  I was not able to reproduce this error with the steps below, but @matYang ran through these steps and received an error. More on what Matt and I did is described by Matt in his comments below this comment :)\r\n\r\nSteps to reproduce the behavior:\r\n1. Git clone repository: `git clone https://github.com/ethereum-optimism/optimism.git`\r\n2. Install and build deps:  ` yarn && yarn build\r\n3. Start and build containers:  `cd ops && docker-compose build && docker-compose up`\r\n4. See errors as shown above\r\n\r\n\r\n**Expected behavior**\r\nDocker containers should build and start without any errors.\r\n\r\n**System Specs:**\r\n - OS:  M1 Mac\r\n - Package Version (or commit hash):  docker v20.xx, docker desktop v3.6\r\n\r\n**Additional context**\r\n@matYang tried following the repro steps on both a Rosetta and a regular terminal on his M1 Mac.\r\n",
  "closed_by": {
    "login": "smartcontracts",
    "id": 14298799,
    "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/smartcontracts",
    "html_url": "https://github.com/smartcontracts",
    "followers_url": "https://api.github.com/users/smartcontracts/followers",
    "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
    "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
    "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
    "repos_url": "https://api.github.com/users/smartcontracts/repos",
    "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
    "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1405/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1405/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/909815758",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1405#issuecomment-909815758",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1405",
    "id": 909815758,
    "node_id": "IC_kwDODjvEJM42Oq_O",
    "user": {
      "login": "matYang",
      "id": 2754307,
      "node_id": "MDQ6VXNlcjI3NTQzMDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2754307?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matYang",
      "html_url": "https://github.com/matYang",
      "followers_url": "https://api.github.com/users/matYang/followers",
      "following_url": "https://api.github.com/users/matYang/following{/other_user}",
      "gists_url": "https://api.github.com/users/matYang/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matYang/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matYang/subscriptions",
      "organizations_url": "https://api.github.com/users/matYang/orgs",
      "repos_url": "https://api.github.com/users/matYang/repos",
      "events_url": "https://api.github.com/users/matYang/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matYang/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-01T02:24:29Z",
    "updated_at": "2021-09-01T02:32:39Z",
    "author_association": "NONE",
    "body": "Thanks @platocrat for taking the time to help me.\r\n\r\nI should clarify that the error in the screenshot above are results of trying to run\r\n\r\n`docker-compose -f docker-compose-nobuild.yml up ` as I was following the instructions on https://github.com/ethereum-optimism/optimism-tutorial/tree/main/truffle\r\n\r\nWhat I am seeing is:\r\n1. l1_chain_1 is able to boot up\r\n2. deployer_1 is able to boot up\r\n3. l2geth_1 initially is able to boot up and waits for dtl\r\n4. dtl_1 tries to bootup, dtl_1 says 'Service has started', then immediately raises network error (the 1st screenshot)\r\n\r\n`dtl_1      | {\"level\":50,\"time\":1630460045555,\"extra\":{\"message\":\"Error: could not detect network (event=\\\"noNetwork\\\", code=NETWORK_ERROR, version=providers/5.4.4)\",\"stack\":\"Error: could not detect network (event=\\\"noNetwork\\\", code=NETWORK_ERROR, version=providers/5.4.4)\\n    at Logger.makeError (/opt/optimism/node_modules/@ethersproject/logger/lib/index.js:187:21)\\n    at Logger.throwError (/opt/optimism/node_modules/@ethersproject/logger/lib/index.js:196:20)\\n    at JsonRpcProvider.<anonymous> (/opt/optimism/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:491:54)\\n    at step (/opt/optimism/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:48:23)\\n    at Object.throw (/opt/optimism/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:29:53)\\n    at rejected (/opt/optimism/node_modules/@ethersproject/providers/lib/json-rpc-provider.js:21:65)\\n    at processTicksAndRejections (internal/process/task_queues.js:95:5)\",\"code\":\"NETWORK_ERROR\"},\"msg\":\"Caught an unhandled error\"}`\r\n\r\n5. l2geth_1 throws seg fault (the 2nd screenshot)\r\n\r\n`qemu: uncaught target signal 11 (Segmentation fault) - core dumped`\r\n\r\n6. all the other containers say connection refused when trying to connect to l2geth_1 and dtl_1\r\n\r\nThis happens consistently.\r\nI tried to separate the containers and start them one-by-one and this still happens.\r\nThis happens in native terminal as well as Rosetta terminal.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/909815758/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/909819137",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1405#issuecomment-909819137",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1405",
    "id": 909819137,
    "node_id": "IC_kwDODjvEJM42Or0B",
    "user": {
      "login": "matYang",
      "id": 2754307,
      "node_id": "MDQ6VXNlcjI3NTQzMDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2754307?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matYang",
      "html_url": "https://github.com/matYang",
      "followers_url": "https://api.github.com/users/matYang/followers",
      "following_url": "https://api.github.com/users/matYang/following{/other_user}",
      "gists_url": "https://api.github.com/users/matYang/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matYang/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matYang/subscriptions",
      "organizations_url": "https://api.github.com/users/matYang/orgs",
      "repos_url": "https://api.github.com/users/matYang/repos",
      "events_url": "https://api.github.com/users/matYang/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matYang/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-01T02:32:05Z",
    "updated_at": "2021-09-01T02:32:05Z",
    "author_association": "NONE",
    "body": "After failing to run nobuild version, we also tried to follow in instructions on https://github.com/ethereum-optimism/optimism\r\n\r\nwhich we:\r\npruned Docker containers with `docker system prune -a`\r\nfollowed instructions and ran\r\n\r\n```\r\ncd optimism\r\nyarn clean\r\nyarn build\r\ncd ops\r\ndocker-compose down -v\r\ndocker-compose build \r\n```\r\n\r\nBuild successfully builds `builder` and `l1_chain`, but fails consistently when trying to build `deployer` with error \r\n```\r\n => ERROR [stage-1  8/24] COPY --from=builder /optimism/packages/hardhat-ovm/package.json ./packages/hardhat-ovm/packa  0.0s\r\n => ERROR [stage-1  9/24] COPY --from=builder /optimism/packages/hardhat-ovm/dist ./packages/hardhat-ovm/dist           0.0s\r\n...\r\n => ERROR [stage-1 15/24] COPY --from=builder /optimism/packages/contracts/artifacts-ovm ./artifacts-ovm                0.0s\r\n```\r\n![image](https://user-images.githubusercontent.com/2754307/131602012-6456ff6c-c2f5-4dd8-aede-99449b28fe6c.png)\r\n\r\nThis happens for me consistently.\r\nThis happens for me in native terminal as well as Rosetta terminal.\r\nThis happens for me on develop branch as well as master branch.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/909819137/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/954292714",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1405#issuecomment-954292714",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1405",
    "id": 954292714,
    "node_id": "IC_kwDODjvEJM444Vnq",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-28T23:17:21Z",
    "updated_at": "2021-10-28T23:17:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "Could you try this again on the `regenesis/0.5.0` branch? I don't have an M1 to test this with",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/954292714/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/990146787",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1405#issuecomment-990146787",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1405",
    "id": 990146787,
    "node_id": "IC_kwDODjvEJM47BHDj",
    "user": {
      "login": "0xB548E",
      "id": 95565981,
      "node_id": "U_kgDOBbI4nQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/95565981?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xB548E",
      "html_url": "https://github.com/0xB548E",
      "followers_url": "https://api.github.com/users/0xB548E/followers",
      "following_url": "https://api.github.com/users/0xB548E/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xB548E/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xB548E/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xB548E/subscriptions",
      "organizations_url": "https://api.github.com/users/0xB548E/orgs",
      "repos_url": "https://api.github.com/users/0xB548E/repos",
      "events_url": "https://api.github.com/users/0xB548E/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xB548E/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-09T19:15:19Z",
    "updated_at": "2021-12-09T19:15:19Z",
    "author_association": "NONE",
    "body": "I just ran it with latest `develop` and it seems like it works fine on M1 now\r\n\r\n<img width=\"828\" alt=\"Screenshot 2021-12-09\" src=\"https://user-images.githubusercontent.com/95565981/145460804-f86c9a72-5c6f-4840-b68c-12ed658b7ebb.png\">\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/990146787/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/990163324",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1405#issuecomment-990163324",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1405",
    "id": 990163324,
    "node_id": "IC_kwDODjvEJM47BLF8",
    "user": {
      "login": "0xB548E",
      "id": 95565981,
      "node_id": "U_kgDOBbI4nQ",
      "avatar_url": "https://avatars.githubusercontent.com/u/95565981?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xB548E",
      "html_url": "https://github.com/0xB548E",
      "followers_url": "https://api.github.com/users/0xB548E/followers",
      "following_url": "https://api.github.com/users/0xB548E/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xB548E/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xB548E/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xB548E/subscriptions",
      "organizations_url": "https://api.github.com/users/0xB548E/orgs",
      "repos_url": "https://api.github.com/users/0xB548E/repos",
      "events_url": "https://api.github.com/users/0xB548E/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xB548E/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-09T19:27:32Z",
    "updated_at": "2021-12-09T19:27:32Z",
    "author_association": "NONE",
    "body": "Important notice: I've increased RAM allocation from 2GB to 6GB for Docker",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/990163324/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1079971468",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1405#issuecomment-1079971468",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1405",
    "id": 1079971468,
    "node_id": "IC_kwDODjvEJM5AXw6M",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-27T17:05:28Z",
    "updated_at": "2022-03-27T17:05:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "Going to close this, there hasn't been much movement on this issue since it was created and @0xB548E noted that it appears to be working fine. If someone else has issues building on an M1 we can re-open later.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1079971468/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
