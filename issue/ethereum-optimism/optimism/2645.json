{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2645",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2645/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2645/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2645/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/2645",
  "id": 1256160651,
  "node_id": "I_kwDODjvEJM5K332L",
  "number": 2645,
  "title": "Batch submitter crash on local network",
  "user": {
    "login": "matheusbrat",
    "id": 293885,
    "node_id": "MDQ6VXNlcjI5Mzg4NQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/293885?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/matheusbrat",
    "html_url": "https://github.com/matheusbrat",
    "followers_url": "https://api.github.com/users/matheusbrat/followers",
    "following_url": "https://api.github.com/users/matheusbrat/following{/other_user}",
    "gists_url": "https://api.github.com/users/matheusbrat/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/matheusbrat/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/matheusbrat/subscriptions",
    "organizations_url": "https://api.github.com/users/matheusbrat/orgs",
    "repos_url": "https://api.github.com/users/matheusbrat/repos",
    "events_url": "https://api.github.com/users/matheusbrat/events{/privacy}",
    "received_events_url": "https://api.github.com/users/matheusbrat/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832490,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNDkw",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bug",
      "name": "C-bug",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: This is a bug."
    },
    {
      "id": 2907832673,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNjcz",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/M-batch-submitter",
      "name": "M-batch-submitter",
      "color": "FBCA04",
      "default": false,
      "description": "Module: batch submitter"
    },
    {
      "id": 2930018676,
      "node_id": "MDU6TGFiZWwyOTMwMDE4Njc2",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/P-unconfirmed",
      "name": "P-unconfirmed",
      "color": "BFD4F2",
      "default": false,
      "description": "Issue might be valid, but itâ€™s not yet confirmed"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 10,
  "created_at": "2022-06-01T14:33:37Z",
  "updated_at": "2022-09-24T02:17:38Z",
  "closed_at": "2022-09-24T02:17:38Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\nWhenever using the local network from docker-compose as: https://github.com/ethereum-optimism/optimism/tree/develop/ops/ \r\nAfter submitting a transaction the batch_submitter hard crash with:\r\n```\r\nINFO [06-01|04:27:54.877] Sequencer updating batch tx gas price    start=1 end=25 nonce=1\r\nINFO [06-01|04:27:54.890] Proposer fetching current block range\r\nWARN [06-01|04:27:54.892] Sequencer eth_maxPriorityFeePerGas is unsupported by current backend, using fallback gasTipCap\r\n\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x8 pc=0x513234]\r\ngoroutine 63 [running]:\r\nmath/big.(*Int).Mul(0x40002a7968, 0x0, 0x40002a7988)\r\n    /usr/local/go/src/math/big/int.go:168 +0xa4\r\ngithub.com/ethereum-optimism/optimism/bss-core/txmgr.CalcGasFeeCap(0x4000010060?, 0xd18fa8?)\r\n    /go/bss-core/txmgr/txmgr.go:335 +0x68\r\ngithub.com/ethereum-optimism/optimism/batch-submitter/drivers/sequencer.(*Driver).UpdateGasPrice(0x4000454a50, {0xd18fa8?, 0x4000260fc0}, 0x40004a4d80)\r\n    /go/batch-submitter/drivers/sequencer/driver.go:340 +0xf8\r\ngithub.com/ethereum-optimism/optimism/bss-core.(*Service).eventLoop.func1({0xd18fa8, 0x4000260fc0})\r\n    /go/bss-core/service.go:209 +0x138\r\ngithub.com/ethereum-optimism/optimism/bss-core/txmgr.(*SimpleTxManager).Send.func1()\r\n    /go/bss-core/txmgr/txmgr.go:141 +0xac\r\ncreated by github.com/ethereum-optimism/optimism/bss-core/txmgr.(*SimpleTxManager).Send\r\n    /go/bss-core/txmgr/txmgr.go:205 +0x260\r\n```\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Clone https://github.com/ethereum-optimism/optimism/tree/develop/ops/ \r\n2. Go to ops folder, docker-compose pull\r\n3. docker-compose up\r\n4. Wait for the system to get stable \r\n5. Submit a transaction on l2\r\n6. Check batch_submitter logs or start it again with `docker-compose up batch_submitter`\r\n7. See it crashing\r\n\r\n**Expected behavior**\r\nBatch submitter should submit batch to L1 without crashing\r\n\r\n**System Specs:**\r\n - OS: MAC 12.04\r\n - Package Version (or commit hash): master or develop as both would use the \"latest\" available image\r\n\r\n**Additional context**\r\nI have tried to recompile the batch_submitter with a hardcoded fee of 0x1 with something like:\r\n```\r\n--- a/batch-submitter/drivers/sequencer/driver.go\r\n+++ b/batch-submitter/drivers/sequencer/driver.go\r\n@@ -333,11 +333,11 @@ func (d *Driver) UpdateGasPrice(\r\n                gasTipCap = drivers.FallbackGasTipCap\r\n        }\r\n\r\n-       header, err := d.cfg.L1Client.HeaderByNumber(ctx, nil)\r\n-       if err != nil {\r\n-               return nil, err\r\n-       }\r\n-       gasFeeCap := txmgr.CalcGasFeeCap(header.BaseFee, gasTipCap)\r\n+       //header, err := d.cfg.L1Client.HeaderByNumber(ctx, nil)\r\n+       //if err != nil {\r\n+       //      return nil, err\r\n+       //}\r\n+       gasFeeCap := txmgr.CalcGasFeeCap(big.NewInt(1), gasTipCap)\r\n```\r\n\r\nAfter that it doesn't crash and I started seeing something like:\r\n```\r\nbatch_submitter_1      | ERROR[06-01|14:28:47.257] Sequencer unable to update txn gas price err=\"maxFeePerGas or maxPriorityFeePerGas specified but london is not active yet\"\r\n```\r\n",
  "closed_by": {
    "login": "smartcontracts",
    "id": 14298799,
    "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/smartcontracts",
    "html_url": "https://github.com/smartcontracts",
    "followers_url": "https://api.github.com/users/smartcontracts/followers",
    "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
    "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
    "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
    "repos_url": "https://api.github.com/users/smartcontracts/repos",
    "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
    "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2645/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2645/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1144129709",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/2645#issuecomment-1144129709",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2645",
    "id": 1144129709,
    "node_id": "IC_kwDODjvEJM5EMgit",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-01T21:00:41Z",
    "updated_at": "2022-06-01T21:00:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "What are you using as L1? The L1 node provided in the `docker-compose` setup?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1144129709/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1144302369",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/2645#issuecomment-1144302369",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2645",
    "id": 1144302369,
    "node_id": "IC_kwDODjvEJM5ENKsh",
    "user": {
      "login": "matheusbrat",
      "id": 293885,
      "node_id": "MDQ6VXNlcjI5Mzg4NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/293885?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matheusbrat",
      "html_url": "https://github.com/matheusbrat",
      "followers_url": "https://api.github.com/users/matheusbrat/followers",
      "following_url": "https://api.github.com/users/matheusbrat/following{/other_user}",
      "gists_url": "https://api.github.com/users/matheusbrat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matheusbrat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matheusbrat/subscriptions",
      "organizations_url": "https://api.github.com/users/matheusbrat/orgs",
      "repos_url": "https://api.github.com/users/matheusbrat/repos",
      "events_url": "https://api.github.com/users/matheusbrat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matheusbrat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-02T00:53:03Z",
    "updated_at": "2022-06-02T01:00:35Z",
    "author_association": "NONE",
    "body": "Yes @smartcontracts , I just pruned my whole docker (`docker system prune -a`) to be sure and I'm getting the same result.\r\n\r\n```\r\n optimism % git pull origin master\r\nFrom https://github.com/ethereum-optimism/optimism\r\n * branch              master     -> FETCH_HEAD\r\nAlready up to date.\r\n optimism % cd ops\r\n ops % docker-compose pull\r\nPulling l1_chain            ... done\r\nPulling deployer            ... done\r\nPulling l2geth              ... done\r\nPulling dtl                 ... done\r\nPulling relayer             ... done\r\nPulling fault_detector      ... done\r\nPulling verifier            ... done\r\nPulling replica             ... done\r\nPulling replica_healthcheck ... done\r\nPulling integration_tests   ... done\r\nPulling gas_oracle          ... done\r\nPulling batch_submitter     ... done\r\n\r\n ops % docker image ls\r\nREPOSITORY                                 TAG       IMAGE ID       CREATED         SIZE\r\nethereumoptimism/gas-oracle                latest    50cb2ad84f1e   2 minutes ago   21.8MB\r\nethereumoptimism/message-relayer           latest    8f1e7fc7343d   2 weeks ago     1.28GB\r\nethereumoptimism/batch-submitter-service   latest    76b1d7b32404   2 weeks ago     28.9MB\r\nethereumoptimism/fault-detector            latest    e9c68fe0e76e   3 weeks ago     1.28GB\r\nethereumoptimism/deployer                  latest    45b0cb0b15bf   3 weeks ago     1.28GB\r\nethereumoptimism/data-transport-layer      latest    e66ac6868d18   3 weeks ago     1.28GB\r\nethereumoptimism/replica-healthcheck       latest    75d4ec10bce2   4 weeks ago     1.19GB\r\nethereumoptimism/l2geth                    latest    dfeabbadcd62   4 weeks ago     41.4MB\r\nethereumoptimism/hardhat                   latest    aeac162bde6b   10 months ago   271MB\r\nethereumoptimism/integration-tests         latest    3ceed3144a81   14 months ago   2.22GB\r\n\r\n ops % docker-compose up \r\n```\r\n\r\nLater submit tx:\r\n```\r\n% curl -X POST --data '{\"jsonrpc\":\"2.0\",\"method\":\"eth_sendRawTransaction\", \"params\":[\"0xf8688001830186a09423618e81e3f5cdf7f54c3d65f7fbc0abf5b21e8f880de0b6b3a7640000801ba0785e949640b432c31d4f26dc4d3f24875694fdc02715d8ad711d8ade09937c09a02d45d83751e8dc38c90c47a15f1f1b2e26b1b2d698fe3919d84b12be56b08184\"], \"id\": 1001}' -H \"Content-type: application/json\" http://localhost:8545/ | jq\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100   398  100   106  100   292   1828   5037 --:--:-- --:--:-- --:--:--  7509\r\n{\r\n  \"jsonrpc\": \"2.0\",\r\n  \"id\": 1001,\r\n  \"result\": \"0x05d0258ae858446fce06eec1cc686702bdc18bd3b5f7b0805da3a10f3282ed2b\"\r\n}\r\n```\r\n\r\nLogs l2geth, replica:\r\n```\r\nl2geth_1               | TRACE[06-01|21:49:24.398] Sequencer transaction validation         hash=0x05d0258ae858446fce06eec1cc686702bdc18bd3b5f7b0805da3a10f3282ed2b\r\nl2geth_1               | INFO [06-01|21:49:24.398] Updating latest timestamp                timestamp=2022-06-01T21:49:24+0000 unix=1654120164\r\nl2geth_1               | DEBUG[06-01|21:49:24.401] Applying transaction to tip              index=21    hash=0x05d0258ae858446fce06eec1cc686702bdc18bd3b5f7b0805da3a10f3282ed2b origin=sequencer\r\nl2geth_1               | TRACE[06-01|21:49:24.401] Waiting for transaction to be added to chain hash=0x05d0258ae858446fce06eec1cc686702bdc18bd3b5f7b0805da3a10f3282ed2b\r\nl2geth_1               | DEBUG[06-01|21:49:24.402] Attempting to commit rollup transaction  hash=0x05d0258ae858446fce06eec1cc686702bdc18bd3b5f7b0805da3a10f3282ed2b\r\nl2geth_1               | DEBUG[06-01|21:49:24.409] Adding L1 fee                            l1-fee=6633\r\nl2geth_1               | INFO [06-01|21:49:24.413] New block                                index=21    l1-timestamp=1654120164 l1-blocknumber=40 tx-hash=0x05d0258ae858446fce06eec1cc686702bdc18bd3b5f7b0805da3a10f3282ed2b queue-orign=sequencer gas=21000  fees=2.1e-14 elapsed=10.926ms\r\nl2geth_1               | TRACE[06-01|21:49:24.416] Waiting for slot to sign and propagate   delay=0s\r\nl2geth_1               | DEBUG[06-01|21:49:24.423] Persisted trie from memory database      nodes=9  size=1.62KiB   time=1.566833ms gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=-3444.00B\r\nl2geth_1               | DEBUG[06-01|21:49:24.424] Miner got new head                       height=22 block-hash=0xfa51bb56565fd49318dd5440351c01f592b80fe422132dd2e29d871079963386 tx-hash=0x05d0258ae858446fce06eec1cc686702bdc18bd3b5f7b0805da3a10f3282ed2b tx-hash=0x05d0258ae858446fce06eec1cc686702bdc18bd3b5f7b0805da3a10f3282ed2b\r\nl2geth_1               | INFO [06-01|21:49:24.425] Submitted transaction                    fullhash=0x05d0258ae858446fce06eec1cc686702bdc18bd3b5f7b0805da3a10f3282ed2b recipient=0x23618e81E3f5cdF7f54C3d65f7FBc0aBf5B21E8f\r\nl2geth_1               | DEBUG[06-01|21:49:24.425] Served eth_sendRawTransaction            conn=192.168.160.1:60444 reqid=1001             t=32.084959ms\r\nl2geth_1               | DEBUG[06-01|21:49:24.427] Reinjecting stale transactions           count=0\r\ndtl_1                  | {\"level\":30,\"time\":1654120164430,\"method\":\"GET\",\"url\":\"/enqueue/latest\",\"elapsed\":2,\"msg\":\"Served HTTP Request\"}\r\neth_blockNumber (5)    | {\"level\":30,\"time\":1654120164436,\"method\":\"GET\",\"url\":\"/enqueue/latest\",\"elapsed\":1,\"msg\":\"Served HTTP Request\"}\r\nl1_chain_1             | eth_chainId\r\neth_chainId (2)        | DEBUG[06-01|21:49:24.467] Served eth_blockNumber                   conn=192.168.160.6:36482 reqid=5931             t=333.625Âµs\r\ndtl_1                  | {\"level\":30,\"time\":1654120164470,\"fromBlock\":21,\"toBlock\":22,\"msg\":\"Synchronizing unconfirmed transactions from Layer 2 (Optimism)\"}\r\nl1_chain_1             | eth_blockNumber\r\nl2geth_1               | DEBUG[06-01|21:49:24.610] Served eth_getBlockRange                 conn=192.168.160.6:36486 reqid=1                t=4.448834ms\r\nl1_chain_1             | eth_getBlockByNumber\r\ndtl_1                  | {\"level\":30,\"time\":1654120164847,\"method\":\"GET\",\"url\":\"/eth/context/latest\",\"elapsed\":407,\"msg\":\"Served HTTP Request\"}\r\ndtl_1                  | {\"level\":30,\"time\":1654120164894,\"method\":\"GET\",\"url\":\"/batch/transaction/latest\",\"elapsed\":19,\"msg\":\"Served HTTP Request\"}\r\ndtl_1                  | {\"level\":30,\"time\":1654120164955,\"method\":\"GET\",\"url\":\"/transaction/latest?backend=l2\",\"elapsed\":88,\"msg\":\"Served HTTP Request\"}\r\nl1_chain_1             | eth_blockNumber\r\ndtl_1                  | {\"level\":30,\"time\":1654120165008,\"method\":\"GET\",\"url\":\"/transaction/latest?backend=l2\",\"elapsed\":14,\"msg\":\"Served HTTP Request\"}\r\ndtl_1                  | {\"level\":30,\"time\":1654120165018,\"method\":\"GET\",\"url\":\"/enqueue/latest\",\"elapsed\":42,\"msg\":\"Served HTTP Request\"}\r\neth_blockNumber (2)    | {\"level\":30,\"time\":1654120165035,\"method\":\"GET\",\"url\":\"/enqueue/latest\",\"elapsed\":6,\"msg\":\"Served HTTP Request\"}\r\neth_chainId (2)        | eth_chainId\r\nl1_chain_1             | eth_getBlockByNumber\r\ndtl_1                  | {\"level\":30,\"time\":1654120165121,\"method\":\"GET\",\"url\":\"/eth/context/latest\",\"elapsed\":81,\"msg\":\"Served HTTP Request\"}\r\nl1_chain_1             | eth_blockNumber\r\nl2geth_1               | DEBUG[06-01|21:49:25.161] Served eth_blockNumber                   conn=192.168.160.6:36502 reqid=5932             t=156.125Âµs\r\ndtl_1                  | {\"level\":30,\"time\":1654120165165,\"currentL2Block\":22,\"targetL2Block\":22,\"msg\":\"All Layer 2 (Optimism) transactions are synchronized\"}\r\ndtl_1                  | {\"level\":30,\"time\":1654120165205,\"method\":\"GET\",\"url\":\"/transaction/latest?backend=l2\",\"elapsed\":1,\"msg\":\"Served HTTP Request\"}\r\nreplica_1              | INFO [06-01|21:49:25.208] Syncing transaction range                start=21 end=21 backend=l2\r\ndtl_1                  | {\"level\":30,\"time\":1654120165215,\"method\":\"GET\",\"url\":\"/transaction/index/21?backend=l2\",\"elapsed\":1,\"msg\":\"Served HTTP Request\"}\r\nreplica_1              | TRACE[06-01|21:49:25.218] Applying indexed transaction             index=21\r\nreplica_1              | DEBUG[06-01|21:49:25.222] Applying transaction to tip              index=21    hash=0x05d0258ae858446fce06eec1cc686702bdc18bd3b5f7b0805da3a10f3282ed2b origin=sequencer\r\nreplica_1              | TRACE[06-01|21:49:25.223] Waiting for transaction to be added to chain hash=0x05d0258ae858446fce06eec1cc686702bdc18bd3b5f7b0805da3a10f3282ed2b\r\nreplica_1              | DEBUG[06-01|21:49:25.223] Attempting to commit rollup transaction  hash=0x05d0258ae858446fce06eec1cc686702bdc18bd3b5f7b0805da3a10f3282ed2b\r\ndtl_1                  | {\"level\":30,\"time\":1654120165230,\"method\":\"GET\",\"url\":\"/batch/transaction/latest\",\"elapsed\":1,\"msg\":\"Served HTTP Request\"}\r\nreplica_1              | DEBUG[06-01|21:49:25.239] Adding L1 fee                            l1-fee=6633\r\nreplica_1              | INFO [06-01|21:49:25.243] New block                                index=21    l1-timestamp=1654120164 l1-blocknumber=40 tx-hash=0x05d0258ae858446fce06eec1cc686702bdc18bd3b5f7b0805da3a10f3282ed2b queue-orign=sequencer gas=21000  fees=2.1e-14 elapsed=20.052ms\r\neth_blockNumber (2)    | TRACE[06-01|21:49:25.246] Waiting for slot to sign and propagate   delay=0s\r\nreplica_1              | DEBUG[06-01|21:49:25.252] Persisted trie from memory database      nodes=9  size=1.62KiB   time=951.125Âµs  gcnodes=0 gcsize=0.00B gctime=0s livenodes=1 livesize=-3444.00B\r\nreplica_1              | DEBUG[06-01|21:49:25.253] Miner got new head                       height=22 block-hash=0xfa51bb56565fd49318dd5440351c01f592b80fe422132dd2e29d871079963386 tx-hash=0x05d0258ae858446fce06eec1cc686702bdc18bd3b5f7b0805da3a10f3282ed2b tx-hash=0x05d0258ae858446fce06eec1cc686702bdc18bd3b5f7b0805da3a10f3282ed2b\r\nreplica_1              | DEBUG[06-01|21:49:25.254] Reinjecting stale transactions           count=0\r\n```\r\n\r\nLogs batch_submitter:\r\n```\r\n% docker-compose up batch_submitter\r\nops_l1_chain_1 is up-to-date\r\nops_deployer_1 is up-to-date\r\nops_l2geth_1 is up-to-date\r\nStarting ops_batch_submitter_1 ... done\r\nAttaching to ops_batch_submitter_1\r\nbatch_submitter_1      | INFO [06-02|00:50:17.181] Config parsed                            min_tx_size=32 max_tx_size=90000\r\nbatch_submitter_1      | INFO [06-02|00:50:17.183] Initializing batch submitter\r\nbatch_submitter_1      | INFO [06-02|00:50:17.186] Sequencer wallet params parsed successfully wallet_address=0x70997970C51812dc3A010C7d01b50e0d17dc79C8 contract_address=0xCf7Ed3AccA5a467e9e704C703E8D87F634fB0Fc9\r\nbatch_submitter_1      | INFO [06-02|00:50:17.187] Proposer wallet params parsed successfully wallet_address=0x3C44CdDdB6a900fa2b585dd299e03d12FA4293BC contract_address=0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9\r\nbatch_submitter_1      | INFO [06-02|00:50:17.277] Starting batch submitter\r\nbatch_submitter_1      | INFO [06-02|00:50:17.278] Batch submitter started\r\nbatch_submitter_1      | INFO [06-02|00:50:17.794] Proposer fetching current block range\r\nbatch_submitter_1      | INFO [06-02|00:50:17.796] Sequencer fetching current block range\r\nbatch_submitter_1      | INFO [06-02|00:50:17.891] Sequencer block range                    start=1 end=31\r\nbatch_submitter_1      | INFO [06-02|00:50:18.012] Sequencer crafting batch tx              start=1 end=31 nonce=1 type=ZLIB\r\nbatch_submitter_1      | INFO [06-02|00:50:18.103] Proposer no updates                      start=1 end=1\r\nbatch_submitter_1      | INFO [06-02|00:50:18.218] Sequencer testing batch size             calldata_size=971 min_tx_size=32 max_tx_size=90000\r\nbatch_submitter_1      | INFO [06-02|00:50:18.218] Sequencer batch constructed              num_txs=30 final_size=971 batch_type=ZLIB\r\nbatch_submitter_1      | INFO [06-02|00:50:18.755] Proposer fetching current block range\r\nbatch_submitter_1      | INFO [06-02|00:50:18.759] Sequencer updating batch tx gas price    start=1 end=31 nonce=1\r\nbatch_submitter_1      | WARN [06-02|00:50:18.769] Sequencer eth_maxPriorityFeePerGas is unsupported by current backend, using fallback gasTipCap\r\nbatch_submitter_1      | panic: runtime error: invalid memory address or nil pointer dereference\r\nbatch_submitter_1      | [signal SIGSEGV: segmentation violation code=0x1 addr=0x8 pc=0x51c873]\r\nbatch_submitter_1      |\r\nbatch_submitter_1      | goroutine 95 [running]:\r\nbatch_submitter_1      | math/big.(*Int).Mul(0xc000149978, 0x0, 0xc000149998)\r\nbatch_submitter_1      | \t/usr/local/go/src/math/big/int.go:168 +0x93\r\nbatch_submitter_1      | github.com/ethereum-optimism/optimism/bss-core/txmgr.CalcGasFeeCap(0xc00030c058?, 0xda9278?)\r\nbatch_submitter_1      | \t/go/bss-core/txmgr/txmgr.go:335 +0x7c\r\nbatch_submitter_1      | github.com/ethereum-optimism/optimism/batch-submitter/drivers/sequencer.(*Driver).UpdateGasPrice(0xc0004e6b00, {0xda9278?, 0xc00035f3c0}, 0xc00015aa20)\r\nbatch_submitter_1      | \t/go/batch-submitter/drivers/sequencer/driver.go:340 +0x13d\r\nbatch_submitter_1      | github.com/ethereum-optimism/optimism/bss-core.(*Service).eventLoop.func1({0xda9278, 0xc00035f3c0})\r\nbatch_submitter_1      | \t/go/bss-core/service.go:209 +0x192\r\nbatch_submitter_1      | github.com/ethereum-optimism/optimism/bss-core/txmgr.(*SimpleTxManager).Send.func1()\r\nbatch_submitter_1      | \t/go/bss-core/txmgr/txmgr.go:141 +0xec\r\nbatch_submitter_1      | created by github.com/ethereum-optimism/optimism/bss-core/txmgr.(*SimpleTxManager).Send\r\nbatch_submitter_1      | \t/go/bss-core/txmgr/txmgr.go:205 +0x2f5\r\nops_batch_submitter_1 exited with code 2\r\n```\r\n\r\n```\r\n% docker exec -it ops_l2geth_1 ./geth version\r\nGeth\r\nVersion: 1.9.10-stable\r\nArchitecture: amd64\r\nProtocol Versions: [64 63]\r\nGo Version: go1.18\r\nOperating System: linux\r\nGOPATH=\r\nGOROOT=/usr/local/go\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1144302369/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1144388177",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/2645#issuecomment-1144388177",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2645",
    "id": 1144388177,
    "node_id": "IC_kwDODjvEJM5ENfpR",
    "user": {
      "login": "matheusbrat",
      "id": 293885,
      "node_id": "MDQ6VXNlcjI5Mzg4NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/293885?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matheusbrat",
      "html_url": "https://github.com/matheusbrat",
      "followers_url": "https://api.github.com/users/matheusbrat/followers",
      "following_url": "https://api.github.com/users/matheusbrat/following{/other_user}",
      "gists_url": "https://api.github.com/users/matheusbrat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matheusbrat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matheusbrat/subscriptions",
      "organizations_url": "https://api.github.com/users/matheusbrat/orgs",
      "repos_url": "https://api.github.com/users/matheusbrat/repos",
      "events_url": "https://api.github.com/users/matheusbrat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matheusbrat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-02T03:12:54Z",
    "updated_at": "2022-06-02T03:16:30Z",
    "author_association": "NONE",
    "body": "@smartcontracts I believe the issue is on the hardhat image, the image which is on dockerhub:\r\n``` \r\nethereumoptimism/hardhat                   latest    aeac162bde6b   10 months ago   271MB\r\n```\r\n\r\nAfter `cd ops/docker/hardhat/` and `docker build . -t ethereumoptimism/hardhat` I have:\r\n```\r\nhardhat % docker image ls\r\nREPOSITORY                                 TAG       IMAGE ID       CREATED          SIZE\r\nethereumoptimism/hardhat                   latest    868c5bc32085   13 minutes ago   194MB\r\n```\r\n\r\nAnd it seems this solves the issue. Would it be possible to update the ci pipeline to update it as well and to update the existing image? Thanks!\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1144388177/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1180074661",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/2645#issuecomment-1180074661",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2645",
    "id": 1180074661,
    "node_id": "IC_kwDODjvEJM5GVoKl",
    "user": {
      "login": "bmalepaty",
      "id": 77955726,
      "node_id": "MDQ6VXNlcjc3OTU1NzI2",
      "avatar_url": "https://avatars.githubusercontent.com/u/77955726?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bmalepaty",
      "html_url": "https://github.com/bmalepaty",
      "followers_url": "https://api.github.com/users/bmalepaty/followers",
      "following_url": "https://api.github.com/users/bmalepaty/following{/other_user}",
      "gists_url": "https://api.github.com/users/bmalepaty/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bmalepaty/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bmalepaty/subscriptions",
      "organizations_url": "https://api.github.com/users/bmalepaty/orgs",
      "repos_url": "https://api.github.com/users/bmalepaty/repos",
      "events_url": "https://api.github.com/users/bmalepaty/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bmalepaty/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-11T07:47:24Z",
    "updated_at": "2022-07-11T07:47:24Z",
    "author_association": "NONE",
    "body": "@matheusbrat \r\nWhen you are submitting a trx, what exactly is the address you are providing in the params?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1180074661/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1180523697",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/2645#issuecomment-1180523697",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2645",
    "id": 1180523697,
    "node_id": "IC_kwDODjvEJM5GXVyx",
    "user": {
      "login": "matheusbrat",
      "id": 293885,
      "node_id": "MDQ6VXNlcjI5Mzg4NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/293885?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/matheusbrat",
      "html_url": "https://github.com/matheusbrat",
      "followers_url": "https://api.github.com/users/matheusbrat/followers",
      "following_url": "https://api.github.com/users/matheusbrat/following{/other_user}",
      "gists_url": "https://api.github.com/users/matheusbrat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/matheusbrat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/matheusbrat/subscriptions",
      "organizations_url": "https://api.github.com/users/matheusbrat/orgs",
      "repos_url": "https://api.github.com/users/matheusbrat/repos",
      "events_url": "https://api.github.com/users/matheusbrat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/matheusbrat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-11T15:02:19Z",
    "updated_at": "2022-07-11T15:02:19Z",
    "author_association": "NONE",
    "body": "@bmalepaty I have pasted the raw tx I was using, so it should be easy to use it, no? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1180523697/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1184127594",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/2645#issuecomment-1184127594",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2645",
    "id": 1184127594,
    "node_id": "IC_kwDODjvEJM5GlFpq",
    "user": {
      "login": "dremofly",
      "id": 21236768,
      "node_id": "MDQ6VXNlcjIxMjM2NzY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/21236768?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dremofly",
      "html_url": "https://github.com/dremofly",
      "followers_url": "https://api.github.com/users/dremofly/followers",
      "following_url": "https://api.github.com/users/dremofly/following{/other_user}",
      "gists_url": "https://api.github.com/users/dremofly/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dremofly/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dremofly/subscriptions",
      "organizations_url": "https://api.github.com/users/dremofly/orgs",
      "repos_url": "https://api.github.com/users/dremofly/repos",
      "events_url": "https://api.github.com/users/dremofly/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dremofly/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-14T08:02:36Z",
    "updated_at": "2022-07-14T08:02:36Z",
    "author_association": "NONE",
    "body": "I encountered this problem too",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1184127594/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1186412396",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/2645#issuecomment-1186412396",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2645",
    "id": 1186412396,
    "node_id": "IC_kwDODjvEJM5Gtzds",
    "user": {
      "login": "dremofly",
      "id": 21236768,
      "node_id": "MDQ6VXNlcjIxMjM2NzY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/21236768?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dremofly",
      "html_url": "https://github.com/dremofly",
      "followers_url": "https://api.github.com/users/dremofly/followers",
      "following_url": "https://api.github.com/users/dremofly/following{/other_user}",
      "gists_url": "https://api.github.com/users/dremofly/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dremofly/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dremofly/subscriptions",
      "organizations_url": "https://api.github.com/users/dremofly/orgs",
      "repos_url": "https://api.github.com/users/dremofly/repos",
      "events_url": "https://api.github.com/users/dremofly/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dremofly/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-17T05:57:18Z",
    "updated_at": "2022-07-17T05:57:18Z",
    "author_association": "NONE",
    "body": "I found that this problem may be caused by the the `L1 chain` service. It doesn't support London Upgrade. We can change its `hardhat.config.js`. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1186412396/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1221421732",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/2645#issuecomment-1221421732",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2645",
    "id": 1221421732,
    "node_id": "IC_kwDODjvEJM5IzWqk",
    "user": {
      "login": "sam-goldman",
      "id": 106038229,
      "node_id": "U_kgDOBlID1Q",
      "avatar_url": "https://avatars.githubusercontent.com/u/106038229?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sam-goldman",
      "html_url": "https://github.com/sam-goldman",
      "followers_url": "https://api.github.com/users/sam-goldman/followers",
      "following_url": "https://api.github.com/users/sam-goldman/following{/other_user}",
      "gists_url": "https://api.github.com/users/sam-goldman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sam-goldman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sam-goldman/subscriptions",
      "organizations_url": "https://api.github.com/users/sam-goldman/orgs",
      "repos_url": "https://api.github.com/users/sam-goldman/repos",
      "events_url": "https://api.github.com/users/sam-goldman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sam-goldman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-20T22:53:29Z",
    "updated_at": "2022-08-20T22:53:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "> @smartcontracts I believe the issue is on the hardhat image, the image which is on dockerhub:\r\n> \r\n> ```\r\n> ethereumoptimism/hardhat                   latest    aeac162bde6b   10 months ago   271MB\r\n> ```\r\n> \r\n> After `cd ops/docker/hardhat/` and `docker build . -t ethereumoptimism/hardhat` I have:\r\n> \r\n> ```\r\n> hardhat % docker image ls\r\n> REPOSITORY                                 TAG       IMAGE ID       CREATED          SIZE\r\n> ethereumoptimism/hardhat                   latest    868c5bc32085   13 minutes ago   194MB\r\n> ```\r\n> \r\n> And it seems this solves the issue. Would it be possible to update the ci pipeline to update it as well and to update the existing image? Thanks!\r\n\r\nI was running into this same issue, and this fixed it for me.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1221421732/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 1,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1238477780",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/2645#issuecomment-1238477780",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2645",
    "id": 1238477780,
    "node_id": "IC_kwDODjvEJM5J0avU",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-06T17:54:42Z",
    "updated_at": "2022-09-06T17:54:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "https://github.com/ethereum-optimism/optimism/pull/3339 should fix this",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1238477780/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1256835777",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/2645#issuecomment-1256835777",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2645",
    "id": 1256835777,
    "node_id": "IC_kwDODjvEJM5K6crB",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-24T02:17:38Z",
    "updated_at": "2022-09-24T02:17:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "#3339 fixed this for good, thanks for the reports here everyone!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1256835777/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
