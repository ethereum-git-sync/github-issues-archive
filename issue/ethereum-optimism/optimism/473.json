{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/473",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/473/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/473/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/473/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/473",
  "id": 859132929,
  "node_id": "MDU6SXNzdWU4NTkxMzI5Mjk=",
  "number": 473,
  "title": "Document running a replica",
  "user": {
    "login": "tynes",
    "id": 6626818,
    "node_id": "MDQ6VXNlcjY2MjY4MTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tynes",
    "html_url": "https://github.com/tynes",
    "followers_url": "https://api.github.com/users/tynes/followers",
    "following_url": "https://api.github.com/users/tynes/following{/other_user}",
    "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
    "organizations_url": "https://api.github.com/users/tynes/orgs",
    "repos_url": "https://api.github.com/users/tynes/repos",
    "events_url": "https://api.github.com/users/tynes/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tynes/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-04-15T18:10:54Z",
  "updated_at": "2021-08-30T21:43:22Z",
  "closed_at": "2021-08-30T21:43:22Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!--\r\nNeed help?\r\nRefer to our contributing guidelines for additional information about making a good issue:\r\nhttps://github.com/ethereum-optimism/.github/blob/master/CONTRIBUTING.md\r\n-->\r\n\r\nNote: this is out of date, see later comments for the `v0.3.0` config which is up to date\r\n\r\nThe instructions for running a replica should be clearly documented in a way that does not go stale over time.\r\nThe deployed addresses can be found here: https://github.com/ethereum-optimism/optimism/blob/master/packages/contracts/addresses.md\r\n\r\nAn example of running a replica for mainnet as of 4/14/21 can be found below. This depends on running a local data transport layer that is syncing from L2. The addresses in the config can be found in the above link, note that the `Proxy__*` are used instead of the actual contracts themselves. The state dump files are becoming too large to keep in normal `git`, we need a better way of managing them. Note that both geth and the data transport layer must run together.\r\n\r\n```bash\r\n#!/bin/bash\r\n\r\nUSING_OVM=true ./build/bin/geth \\\r\n    --datadir $HOME/.ethereum \\\r\n    --eth1.syncservice \\\r\n    --eth1.l1crossdomainmessengeraddress 0xD1EC7d40CCd01EB7A305b94cBa8AB6D17f6a9eFE \\\r\n    --eth1.l1ethgatewayaddress 0xF20C38fCdDF0C790319Fd7431d17ea0c2bC9959c \\\r\n    --rollup.addressmanagerowneraddress 0x9BA6e03D8B90dE867373Db8cF1A58d2F7F006b3A \\\r\n    --rollup.statedumppath https://storage.googleapis.com/optimism/mainnet/3.json \\\r\n    --eth1.ctcdeploymentheight 12207792 \\\r\n    --rollup.clienthttp http://localhost:7878 \\\r\n    --rollup.verifier \\\r\n    --rpc \\\r\n    --dev \\\r\n    --chainid 10 \\\r\n    --rpcaddr 0.0.0.0 \\\r\n    --rpcport 8545 \\\r\n    --rpcvhosts '*' \\\r\n    --rpccorsdomain '*' \\\r\n    --ws \\\r\n    --wsaddr 0.0.0.0 \\\r\n    --wsport 8546 \\\r\n    --wsorigins '*' \\\r\n    --rpcapi 'eth,net,rollup,web3' \\\r\n    --gasprice 0 \\\r\n    --miner.gastarget 9000000 \\\r\n    --miner.gaslimit 9000000 \\\r\n    --nousb \\\r\n    --gcmode=archive \\\r\n    --ipcdisable \\\r\n    --verbosity=3\r\n```\r\n\r\nConfig for the data transport layer\r\n```\r\nDATA_TRANSPORT_LAYER__DB_PATH=<my-db-path>\r\nDATA_TRANSPORT_LAYER__SERVER_HOSTNAME=0.0.0.0\r\nDATA_TRANSPORT_LAYER__SERVER_PORT=7878\r\nDATA_TRANSPORT_LAYER__ADDRESS_MANAGER=0xd3EeD86464Ff13B4BFD81a3bB1e753b7ceBA3A39\r\nDATA_TRANSPORT_LAYER__L1_START_HEIGHT=12207737\r\nDATA_TRANSPORT_LAYER__CONFIRMATIONS=10\r\nDATA_TRANSPORT_LAYER__POLLING_INTERVAL=5000\r\nDATA_TRANSPORT_LAYER__LOGS_PER_POLLING_INTERVAL=2000\r\n\r\nDATA_TRANSPORT_LAYER__SYNC_FROM_L1=false\r\nDATA_TRANSPORT_LAYER__SYNC_FROM_L2=true\r\nDATA_TRANSPORT_LAYER__L2_RPC_ENDPOINT=https://mainnet.optimism.io\r\nDATA_TRANSPORT_LAYER__L2_CHAIN_ID=10\r\n\r\nDATA_TRANSPORT_LAYER__TRANSACTIONS_PER_POLLING_INTERVAL=1000\r\nDATA_TRANSPORT_LAYER__DANGEROUSLY_CATCH_ALL_ERRORS=true\r\nDATA_TRANSPORT_LAYER__LEGACY_SEQUENCER_COMPATIBILITY=false\r\nDATA_TRANSPORT_LAYER__STOP_L2_DEFAULT_BACKEND=l1\r\n```",
  "closed_by": {
    "login": "smartcontracts",
    "id": 14298799,
    "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/smartcontracts",
    "html_url": "https://github.com/smartcontracts",
    "followers_url": "https://api.github.com/users/smartcontracts/followers",
    "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
    "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
    "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
    "repos_url": "https://api.github.com/users/smartcontracts/repos",
    "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
    "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/473/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/473/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/827863482",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/473#issuecomment-827863482",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/473",
    "id": 827863482,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNzg2MzQ4Mg==",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-27T19:32:52Z",
    "updated_at": "2021-05-07T17:23:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "A replica syncs from the sequencer and has the config:\r\n\r\n```\r\nDATA_TRANSPORT_LAYER__SYNC_FROM_L1=false\r\nDATA_TRANSPORT_LAYER__SYNC_FROM_L2=true\r\nDATA_TRANSPORT_LAYER__DEFAULT_BACKEND=l2\r\n```\r\n\r\nA verifier syncs from the L1 contracts and has the config:\r\n\r\n```\r\nDATA_TRANSPORT_LAYER__SYNC_FROM_L1=true\r\nDATA_TRANSPORT_LAYER__SYNC_FROM_L2=false\r\nDATA_TRANSPORT_LAYER__DEFAULT_BACKEND=l1\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/827863482/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/834637897",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/473#issuecomment-834637897",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/473",
    "id": 834637897,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzNDYzNzg5Nw==",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-07T17:24:51Z",
    "updated_at": "2021-05-07T17:25:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "The data-transport-layer parses from argv as well as from env vars. The env vars have the prefix `DATA_TRANSPORT_LAYER__` and the suffix is the cli option.\r\n\r\nIt is possible to run the data-transport-layer from the CLI using the command:\r\n\r\n```bash\r\nexport DATA_TRANSPORT_LAYER__ADDRESS_MANAGER='0x18394b52d3cb931dfa76f63251919d051953413d'\r\n\r\nnpx lerna exec --scope @eth-optimism/data-transport-layer --no-bail yarn start -- \\\r\n    --db-path <path-to-db> \\\r\n    --confirmations 12 \\\r\n    --dangerously-catch-all-errors true \\\r\n    --sync-from-l1 false \\\r\n    --sync-from-l2 true \\\r\n    --l2-rpc-endpoint https://kovan.optimism.io \\\r\n    --l2-chainid 69 \\\r\n    --default-backend l2\r\n```\r\n\r\n`lerna` seems to parse the address as a floating point number instead of a string, double quoting in bash causes an error in the javascript\r\n\r\nThis will sync a replica from Kovan L2",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/834637897/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/839000904",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/473#issuecomment-839000904",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/473",
    "id": 839000904,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzOTAwMDkwNA==",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-11T18:56:16Z",
    "updated_at": "2021-05-11T19:03:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "The config for the `v0.3.0` regenesis is as follows. The URL of L2 nodes are the following:\r\n\r\n- https://mainnet.optimism.io\r\n- https://kovan.optimism.io\r\n- https://goerli.optimism.io (not guaranteed to work, our testnet)\r\n\r\nThe addresses can be found in `packages/contracts/deployements`, see https://github.com/ethereum-optimism/optimism/tree/develop/packages/contracts/deployments. The addresses in the below config are mainnet addresses\r\n\r\nWaiting on the merge of https://github.com/ethereum-optimism/optimism/pull/838\r\n\r\n```\r\nImage:          ethereumoptimism/data-transport-layer:0.3.0\r\n\r\nDATA_TRANSPORT_LAYER__SYNC_FROM_L1:                       false\r\nDATA_TRANSPORT_LAYER__SYNC_FROM_L2:                       true\r\nDATA_TRANSPORT_LAYER__L2_RPC_ENDPOINT:                    <url of L2 node>\r\nDATA_TRANSPORT_LAYER__DB_PATH:                            /db\r\nDATA_TRANSPORT_LAYER__SERVER_PORT:                        7878\r\nDATA_TRANSPORT_LAYER__TRANSACTIONS_PER_POLLING_INTERVAL:  1000\r\nDATA_TRANSPORT_LAYER__POLLING_INTERVAL:                   500\r\nDATA_TRANSPORT_LAYER__LOGS_PER_POLLING_INTERVAL:          2000\r\nDATA_TRANSPORT_LAYER__DANGEROUSLY_CATCH_ALL_ERRORS:       true\r\nDATA_TRANSPORT_LAYER__SERVER_HOSTNAME:                    0.0.0.0\r\nDATA_TRANSPORT_LAYER__L1_RPC_ENDPOINT:                    <url of L1 node>\r\nDATA_TRANSPORT_LAYER__CONFIRMATIONS:                      20\r\nDATA_TRANSPORT_LAYER__ADDRESS_MANAGER:                    0x668E5b997b9aE88a56cd40409119d4Db9e6d752E\r\nDATA_TRANSPORT_LAYER__DEFAULT_BACKEND:                    l2\r\nL1_NODE_WEB3_URL:                                         <url of L1 node>\r\n```\r\n\r\n```\r\nImage:         ethereumoptimism/l2geth:0.3.1\r\n\r\nDEV:                                     true\r\nDATADIR:                                 /geth\r\nRPC_ENABLE:                              true\r\nRPC_ADDR:                                0.0.0.0\r\nRPC_CORS_DOMAIN:                         *\r\nRPC_VHOSTS:                              *\r\nRPC_PORT:                                8545\r\nWS:                                      true\r\nWS_ADDR:                                 0.0.0.0\r\nIPC_DISABLE:                             true\r\nTARGET_GAS_LIMIT:                        9000000\r\nRPC_API:                                 eth,rollup,net,web3\r\nWS_API:                                  eth,rollup,net,web3\r\nWS_ORIGINS:                              *\r\nGASPRICE:                                0\r\nNO_USB:                                  true\r\nGCMODE:                                  archive\r\nNO_DISCOVER:                             true\r\nETH1_SYNC_SERVICE_ENABLE:                true\r\nUSING_OVM:                               true\r\nROLLUP_MAX_CALLDATA_SIZE:                40000\r\nCHAIN_ID:                                10\r\nNETWORK_ID:                              10\r\nETH1_CTC_DEPLOYMENT_HEIGHT:              12410807\r\nROLLUP_CLIENT_HTTP:                      <url of dtl>\r\nROLLUP_STATE_DUMP_PATH:                  https://storage.googleapis.com/optimism/mainnet/4.json\r\nETH1_L1_CROSS_DOMAIN_MESSENGER_ADDRESS:  0x902e5fF5A99C4eC1C21bbab089fdabE32EF0A5DF\r\nROLLUP_ADDRESS_MANAGER_OWNER_ADDRESS:    0x9BA6e03D8B90dE867373Db8cF1A58d2F7F006b3A\r\nETH1_L1_ETH_GATEWAY_ADDRESS:             0xe681F80966a8b1fFadECf8068bD6F99034791c95\r\nROLLUP_TIMESTAMP_REFRESH:                3m\r\nROLLUP_POLL_INTERVAL:                    1s\r\nROLLUP_VERIFIER_ENABLE:                  true\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/839000904/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/908721299",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/473#issuecomment-908721299",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/473",
    "id": 908721299,
    "node_id": "IC_kwDODjvEJM42KfyT",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-30T21:43:22Z",
    "updated_at": "2021-08-30T21:43:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "I believe @optimisticben has done a sufficient job documenting this in https://github.com/optimisticben/op-replica/blob/main/README.md",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/908721299/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
