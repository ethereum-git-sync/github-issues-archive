{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1275",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1275/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1275/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1275/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/1275",
  "id": 943771180,
  "node_id": "MDU6SXNzdWU5NDM3NzExODA=",
  "number": 1275,
  "title": "Smock: `smodify.put` bool with value `true` gets stored as `false`",
  "user": {
    "login": "j1mmie",
    "id": 4650220,
    "node_id": "MDQ6VXNlcjQ2NTAyMjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4650220?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/j1mmie",
    "html_url": "https://github.com/j1mmie",
    "followers_url": "https://api.github.com/users/j1mmie/followers",
    "following_url": "https://api.github.com/users/j1mmie/following{/other_user}",
    "gists_url": "https://api.github.com/users/j1mmie/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/j1mmie/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/j1mmie/subscriptions",
    "organizations_url": "https://api.github.com/users/j1mmie/orgs",
    "repos_url": "https://api.github.com/users/j1mmie/repos",
    "events_url": "https://api.github.com/users/j1mmie/events{/privacy}",
    "received_events_url": "https://api.github.com/users/j1mmie/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "smartcontracts",
    "id": 14298799,
    "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/smartcontracts",
    "html_url": "https://github.com/smartcontracts",
    "followers_url": "https://api.github.com/users/smartcontracts/followers",
    "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
    "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
    "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
    "repos_url": "https://api.github.com/users/smartcontracts/repos",
    "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
    "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-07-13T19:45:42Z",
  "updated_at": "2021-07-20T15:48:24Z",
  "closed_at": "2021-07-20T15:48:24Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\nIn some cases, `smodify.put` attempts to stores a bool with value `true` and completes without error, but upon checking the value, it appears to have been stored as `false`.\r\n\r\n**To Reproduce**\r\nExample repository with repro case here:\r\nhttps://github.com/j1mmie/Smock_1.1.9_Test\r\n\r\nThe gist of it is that this sort of test should NEVER fail:\r\n\r\n```\r\n# SmockTest.sol\r\ncontract SmockTest {\r\n  bool public booleanOne = true;\r\n  bool public booleanTwo = true;\r\n}\r\n\r\n#SmockTest.spec.ts\r\nexpect(await contract.booleanTwo()).to.be.equal(true)\r\nawait contract.smodify.put({ booleanTwo: true })\r\nexpect(await contract.booleanTwo()).to.be.equal(true)\r\n```\r\n\r\nBut in the above repo, the test fails.\r\n\r\n**Expected behavior**\r\n`smodify.put` should store boolean values correctly\r\n\r\n**System Specs:**\r\n - OS: macOS 10.15.7\r\n - Package Version (or commit hash): @eth-optimism/smock@1.1.9\r\n - node @ v16.3.0\r\n - @nomiclabs/hardhat-ethers@2.0.2\r\n - @nomiclabs/hardhat-waffle@2.0.1\r\n - @types/chai@4.2.18\r\n - @types/mocha@8.2.2\r\n - @types/node@15.12.2\r\n - chai@4.3.4\r\n - ethereum-waffle@3.3.0\r\n - ethers@5.3.1\r\n - hardhat@2.3.3\r\n - solc@0.8.4\r\n - ts-node@10.0.0\r\n - typescript@4.3.2\r\n\r\n**Additional context**\r\nThe test passes when the first boolean (`booleanOne`) is removed from the Solidity contract, even though `booleanOne` is not referenced in the tests or anywhere else.\r\n\r\nI added some debug output to the Smock code, in `smoddit.js` I output the values of the parameters that are passed to `putContractStorage`:\r\n\r\n```\r\nfor (const slot of slots) {\r\n    const a = common_1.toFancyAddress(contract.address)\r\n    console.log('a:', a)\r\n    const b = core_utils_1.fromHexString(slot.hash.toLowerCase())\r\n    console.log('b:', b)\r\n    const c = core_utils_1.fromHexString(slot.value)\r\n    console.log('c:', c)\r\n\r\n    await pStateManager.putContractStorage(a, b, c);\r\n}\r\n```\r\n\r\nThe output is:\r\n\r\n```\r\na:  <Buffer 5f bd b2 31 56 78 af ec b3 67 f0 32 d9 3f 64 2f 64 18 0a a3, buf: <Buffer 5f bd b2 31 56 78 af ec b3 67 f0 32 d9 3f 64 2f 64 18 0a a3>, toString: [Function (anonymous)]>\r\nb:  <Buffer 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 0a>\r\nc: <Buffer 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 01>\r\n```\r\n\r\nSo it appears the value is correctly being interpreted correctly as a `1` / `true`. Maybe the issue is with the VM state manager",
  "closed_by": {
    "login": "smartcontracts",
    "id": 14298799,
    "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/smartcontracts",
    "html_url": "https://github.com/smartcontracts",
    "followers_url": "https://api.github.com/users/smartcontracts/followers",
    "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
    "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
    "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
    "repos_url": "https://api.github.com/users/smartcontracts/repos",
    "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
    "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1275/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 1,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1275/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/882498238",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1275#issuecomment-882498238",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1275",
    "id": 882498238,
    "node_id": "IC_kwDODjvEJM40mdq-",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-19T12:12:45Z",
    "updated_at": "2021-07-19T12:12:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey! Sorry, I took last week off. Just getting back to this now. This is very weird, I'm going to take a look and see what's going on... thank you for the *very* detailed report!!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/882498238/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/882502233",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1275#issuecomment-882502233",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1275",
    "id": 882502233,
    "node_id": "IC_kwDODjvEJM40mepZ",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-19T12:19:01Z",
    "updated_at": "2021-07-19T12:19:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ah ok, I know what the issue is. Let me think about the easiest way to fix...",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/882502233/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/882519609",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1275#issuecomment-882519609",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1275",
    "id": 882519609,
    "node_id": "IC_kwDODjvEJM40mi45",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-19T12:48:52Z",
    "updated_at": "2021-07-19T12:48:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok the issue was related to the way that Solidity packs storage slots together in order to save gas. I made a quick fix in the PR linked above.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/882519609/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/882705124",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1275#issuecomment-882705124",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1275",
    "id": 882705124,
    "node_id": "IC_kwDODjvEJM40nQLk",
    "user": {
      "login": "j1mmie",
      "id": 4650220,
      "node_id": "MDQ6VXNlcjQ2NTAyMjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4650220?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/j1mmie",
      "html_url": "https://github.com/j1mmie",
      "followers_url": "https://api.github.com/users/j1mmie/followers",
      "following_url": "https://api.github.com/users/j1mmie/following{/other_user}",
      "gists_url": "https://api.github.com/users/j1mmie/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/j1mmie/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/j1mmie/subscriptions",
      "organizations_url": "https://api.github.com/users/j1mmie/orgs",
      "repos_url": "https://api.github.com/users/j1mmie/repos",
      "events_url": "https://api.github.com/users/j1mmie/events{/privacy}",
      "received_events_url": "https://api.github.com/users/j1mmie/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-07-19T16:56:50Z",
    "updated_at": "2021-07-19T16:56:50Z",
    "author_association": "NONE",
    "body": "That’s huge - thanks for you help with this @smartcontracts ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/882705124/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
