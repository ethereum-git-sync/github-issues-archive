{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2644",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2644/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2644/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2644/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/2644",
  "id": 1255981594,
  "node_id": "I_kwDODjvEJM5K3MIa",
  "number": 2644,
  "title": "l2geth is not syncing although currentTransactionIndex is increasing",
  "user": {
    "login": "huahuayu",
    "id": 1725060,
    "node_id": "MDQ6VXNlcjE3MjUwNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1725060?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/huahuayu",
    "html_url": "https://github.com/huahuayu",
    "followers_url": "https://api.github.com/users/huahuayu/followers",
    "following_url": "https://api.github.com/users/huahuayu/following{/other_user}",
    "gists_url": "https://api.github.com/users/huahuayu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/huahuayu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/huahuayu/subscriptions",
    "organizations_url": "https://api.github.com/users/huahuayu/orgs",
    "repos_url": "https://api.github.com/users/huahuayu/repos",
    "events_url": "https://api.github.com/users/huahuayu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/huahuayu/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-06-01T13:17:21Z",
  "updated_at": "2022-06-06T23:22:35Z",
  "closed_at": "2022-06-06T23:22:35Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Env\r\n\r\nversoin: @eth-optimism/sdk@1.1.5\r\n\r\n## Script to run\r\n\r\n```bash\r\n#!/usr/bin/env bash\r\nset -o errexit\r\nset -o nounset\r\nset -o pipefail\r\nset -x\r\n\r\nSRC_DIR=$HOME\r\nVERSION=@eth-optimism/sdk@1.1.2\r\nETH_RPC=http://192.168.2.36:54102\r\nDATA_DIR=/data/optimism\r\n\r\nmkdir -p $DATA_DIR/dtl/db\r\nmkdir -p $DATA_DIR/l2geth/geth\r\ncd $SRC_DIR\r\nif [[ -e $SRC_DIR/optimism ]]\r\nthen\r\n    cd $SRC_DIR/optimism\r\n    git reset --hard\r\n    git fetch --all\r\n    git checkout tags/$VERSION 1>/dev/null\r\nelse\r\n    git clone https://github.com/ethereum-optimism/optimism.git\r\n    git checkout tags/$VERSION 1>/dev/null\r\nfi\r\ncd $SRC_DIR/optimism/infra/op-replica/docker-compose/\r\ncp default-mainnet.env .env\r\nsed -i \"s|WONT_WORK_UNLESS_YOU_PROVIDE_A_VALID_ETHEREUM_L1_ENDPOINT|$ETH_RPC|\" .env\r\nsed -i 's|COMPOSE_FILE=replica.yml:replica-shared.yml:replica-toml.yml|COMPOSE_FILE=replica.yml:replica-shared.yml:replica-toml.yml:replica-volume.yml|' .env\r\ncat > replica-volume.yml <<EOF\r\n---\r\nversion: \"3.4\"\r\nx-logging: &logging\r\n  logging:\r\n    driver: json-file\r\n    options:\r\n      max-size: 10m\r\n      max-file: \"3\"\r\n\r\nservices:\r\n  data-transport-layer:\r\n    volumes:\r\n      - $DATA_DIR/dtl/db:/db\r\n  l2geth-replica:\r\n    volumes:\r\n      - $DATA_DIR/l2geth/geth:/geth\r\nEOF\r\n\r\nsudo docker-compose up -d\r\n```\r\n\r\n## Docker containers\r\n\r\n```text\r\nCONTAINER ID   IMAGE                                          COMMAND                  CREATED          STATUS                         PORTS                                                                                            NAMES\r\n8b2f4c1396f8   ethereumoptimism/data-transport-layer:0.5.20   \"node dist/src/servi…\"   18 minutes ago   Up 18 minutes                  0.0.0.0:7878->7878/tcp, :::7878->7878/tcp                                                        op-replica-data-transport-layer-1\r\nca5e428eb426   ethereumoptimism/l2geth:0.5.12                 \"/bin/sh -c '/script…\"   18 minutes ago   Up 18 minutes                  8547/tcp, 0.0.0.0:9991->8545/tcp, :::9991->8545/tcp, 0.0.0.0:9992->8546/tcp, :::9992->8546/tcp   op-replica-l2geth-replica-1\r\nd715ab2ed2ef   ethereumoptimism/replica-healthcheck:0.3.11    \"node dist/exec/run-…\"   18 minutes ago   Restarting (1) 6 seconds ago                                                                                                    op-replica-replica-healthcheck-1\r\n```\r\n\r\n## Issue1\r\n\r\nHealthcheck container keep restarting.\r\n\r\nContainer logs:\r\n\r\n```text\r\n{\"level\":30,\"time\":1654089054673,\"msg\":\"Listening on port 3000\"}\r\nError: bad response (status=400, headers={\"date\":\"Wed, 01 Jun 2022 13:10:54 GMT\",\"content-type\":\"application/json\",\"content-length\":\"92\",\"connection\":\"close\",\"vary\":\"Origin\",\"x-proxyd-cache-status\":\"MISS\",\"via\":\"1.1 google\",\"cf-cache-status\":\"DYNAMIC\",\"expect-ct\":\"max-age=604800, report-uri=\\\"https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct\\\"\",\"server\":\"cloudflare\",\"cf-ray\":\"71483130dd2a5cd7-IAD\"}, body=\"{\\\"jsonrpc\\\":\\\"2.0\\\",\\\"error\\\":{\\\"code\\\":-32601,\\\"message\\\":\\\"unsupported archive request\\\"},\\\"id\\\":null}\\n\", requestBody=\"{\\\"method\\\":\\\"eth_getBlockByNumber\\\",\\\"params\\\":[\\\"0x63a3f2\\\",false],\\\"id\\\":42,\\\"jsonrpc\\\":\\\"2.0\\\"}\", requestMethod=\"POST\", url=\"https://mainnet.optimism.io\", code=SERVER_ERROR, version=web/5.5.1)\r\n    at Logger.makeError (/opt/optimism/node_modules/@ethersproject/providers/node_modules/@ethersproject/logger/lib/index.js:199:21)\r\n    at Logger.throwError (/opt/optimism/node_modules/@ethersproject/providers/node_modules/@ethersproject/logger/lib/index.js:208:20)\r\n    at /opt/optimism/node_modules/@ethersproject/providers/node_modules/@ethersproject/web/lib/index.js:263:36\r\n    at step (/opt/optimism/node_modules/@ethersproject/providers/node_modules/@ethersproject/web/lib/index.js:33:23)\r\n    at Object.next (/opt/optimism/node_modules/@ethersproject/providers/node_modules/@ethersproject/web/lib/index.js:14:53)\r\n    at fulfilled (/opt/optimism/node_modules/@ethersproject/providers/node_modules/@ethersproject/web/lib/index.js:5:58)\r\n    at processTicksAndRejections (node:internal/process/task_queues:96:5) {\r\n  reason: 'bad response',\r\n  code: 'SERVER_ERROR',\r\n  status: 400,\r\n  headers: {\r\n    date: 'Wed, 01 Jun 2022 13:10:54 GMT',\r\n    'content-type': 'application/json',\r\n    'content-length': '92',\r\n    connection: 'close',\r\n    vary: 'Origin',\r\n    'x-proxyd-cache-status': 'MISS',\r\n    via: '1.1 google',\r\n    'cf-cache-status': 'DYNAMIC',\r\n    'expect-ct': 'max-age=604800, report-uri=\"https://report-uri.cloudflare.com/cdn-cgi/beacon/expect-ct\"',\r\n    server: 'cloudflare',\r\n    'cf-ray': '71483130dd2a5cd7-IAD'\r\n  },\r\n  body: '{\"jsonrpc\":\"2.0\",\"error\":{\"code\":-32601,\"message\":\"unsupported archive request\"},\"id\":null}\\n',\r\n  requestBody: '{\"method\":\"eth_getBlockByNumber\",\"params\":[\"0x63a3f2\",false],\"id\":42,\"jsonrpc\":\"2.0\"}',\r\n  requestMethod: 'POST',\r\n  url: 'https://mainnet.optimism.io'\r\n}\r\n```\r\n\r\n## Issue2\r\n\r\nIt looks like L2 block is syncing:\r\n\r\n```bash\r\n$ curl -s http://localhost:7878/eth/syncing?backend=l2\r\n{\"syncing\":false,\"currentTransactionIndex\":9987885}\r\n$ curl -s http://localhost:7878/eth/syncing?backend=l2\r\n{\"syncing\":false,\"currentTransactionIndex\":9987899}\r\n```\r\n\r\nBut inside `ethereumoptimism/l2geth` container, blockNumber don't increase:\r\n\r\n```bash\r\nsudo docker exec -it $(sudo docker ps | grep ethereumoptimism/l2geth | awk '{print $1}') sh -c 'geth attach /geth/geth.ipc'\r\n> eth.blockNumber\r\n6530034\r\n> eth.blockNumber\r\n6530034\r\n> eth.syncing\r\nfalse\r\n```",
  "closed_by": {
    "login": "smartcontracts",
    "id": 14298799,
    "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/smartcontracts",
    "html_url": "https://github.com/smartcontracts",
    "followers_url": "https://api.github.com/users/smartcontracts/followers",
    "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
    "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
    "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
    "repos_url": "https://api.github.com/users/smartcontracts/repos",
    "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
    "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2644/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2644/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1144350867",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/2644#issuecomment-1144350867",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2644",
    "id": 1144350867,
    "node_id": "IC_kwDODjvEJM5ENWiT",
    "user": {
      "login": "Jackwumingjie",
      "id": 39093109,
      "node_id": "MDQ6VXNlcjM5MDkzMTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/39093109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Jackwumingjie",
      "html_url": "https://github.com/Jackwumingjie",
      "followers_url": "https://api.github.com/users/Jackwumingjie/followers",
      "following_url": "https://api.github.com/users/Jackwumingjie/following{/other_user}",
      "gists_url": "https://api.github.com/users/Jackwumingjie/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Jackwumingjie/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Jackwumingjie/subscriptions",
      "organizations_url": "https://api.github.com/users/Jackwumingjie/orgs",
      "repos_url": "https://api.github.com/users/Jackwumingjie/repos",
      "events_url": "https://api.github.com/users/Jackwumingjie/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Jackwumingjie/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-02T02:26:55Z",
    "updated_at": "2022-06-02T02:26:55Z",
    "author_association": "NONE",
    "body": "I have meet the issue. Is there any method to solve?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1144350867/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1144352074",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/2644#issuecomment-1144352074",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2644",
    "id": 1144352074,
    "node_id": "IC_kwDODjvEJM5ENW1K",
    "user": {
      "login": "Jackwumingjie",
      "id": 39093109,
      "node_id": "MDQ6VXNlcjM5MDkzMTA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/39093109?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Jackwumingjie",
      "html_url": "https://github.com/Jackwumingjie",
      "followers_url": "https://api.github.com/users/Jackwumingjie/followers",
      "following_url": "https://api.github.com/users/Jackwumingjie/following{/other_user}",
      "gists_url": "https://api.github.com/users/Jackwumingjie/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Jackwumingjie/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Jackwumingjie/subscriptions",
      "organizations_url": "https://api.github.com/users/Jackwumingjie/orgs",
      "repos_url": "https://api.github.com/users/Jackwumingjie/repos",
      "events_url": "https://api.github.com/users/Jackwumingjie/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Jackwumingjie/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-02T02:29:16Z",
    "updated_at": "2022-06-02T02:29:16Z",
    "author_association": "NONE",
    "body": "my node shows\r\n![image](https://user-images.githubusercontent.com/39093109/171538134-2540780c-4b7e-4c76-8a8b-58769cdf8ff4.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1144352074/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1145084059",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/2644#issuecomment-1145084059",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2644",
    "id": 1145084059,
    "node_id": "IC_kwDODjvEJM5EQJib",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-02T16:47:42Z",
    "updated_at": "2022-06-02T16:47:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "If you are using a version of l2Geth below 0.5.14, you will need to upgrade your l2Geth to latest version (0.5.19) and resync your node from scratch. There was a hardfork in 0.5.14 approximately a month ago. Please see here to keep up with latest updates: https://changelog.optimism.io/",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1145084059/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1146981322",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/2644#issuecomment-1146981322",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2644",
    "id": 1146981322,
    "node_id": "IC_kwDODjvEJM5EXYvK",
    "user": {
      "login": "huahuayu",
      "id": 1725060,
      "node_id": "MDQ6VXNlcjE3MjUwNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1725060?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/huahuayu",
      "html_url": "https://github.com/huahuayu",
      "followers_url": "https://api.github.com/users/huahuayu/followers",
      "following_url": "https://api.github.com/users/huahuayu/following{/other_user}",
      "gists_url": "https://api.github.com/users/huahuayu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/huahuayu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/huahuayu/subscriptions",
      "organizations_url": "https://api.github.com/users/huahuayu/orgs",
      "repos_url": "https://api.github.com/users/huahuayu/repos",
      "events_url": "https://api.github.com/users/huahuayu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/huahuayu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-06T02:53:43Z",
    "updated_at": "2022-06-06T02:53:43Z",
    "author_association": "NONE",
    "body": "The block data is not reuseable?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1146981322/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1148028828",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/2644#issuecomment-1148028828",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2644",
    "id": 1148028828,
    "node_id": "IC_kwDODjvEJM5EbYec",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-06T23:22:35Z",
    "updated_at": "2022-06-06T23:22:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "It's reusable if you use `debug_setHead` to a block before the hardfork (6,000,000) should work. Otherwise will need to resync. Resync is easier but takes longer ofc.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1148028828/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
