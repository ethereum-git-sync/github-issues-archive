{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/823",
  "id": 881989063,
  "node_id": "MDU6SXNzdWU4ODE5ODkwNjM=",
  "number": 823,
  "title": "Reintroduce a gasLimit in EOA wallet / `eth_estimateGas`",
  "user": {
    "login": "karlfloersch",
    "id": 706123,
    "node_id": "MDQ6VXNlcjcwNjEyMw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/706123?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/karlfloersch",
    "html_url": "https://github.com/karlfloersch",
    "followers_url": "https://api.github.com/users/karlfloersch/followers",
    "following_url": "https://api.github.com/users/karlfloersch/following{/other_user}",
    "gists_url": "https://api.github.com/users/karlfloersch/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/karlfloersch/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/karlfloersch/subscriptions",
    "organizations_url": "https://api.github.com/users/karlfloersch/orgs",
    "repos_url": "https://api.github.com/users/karlfloersch/repos",
    "events_url": "https://api.github.com/users/karlfloersch/events{/privacy}",
    "received_events_url": "https://api.github.com/users/karlfloersch/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832518,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNTE4",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-enhancement",
      "name": "C-enhancement",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: A PR with an enhancement or bugfix."
    },
    {
      "id": 2981952422,
      "node_id": "MDU6TGFiZWwyOTgxOTUyNDIy",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/M-contracts",
      "name": "M-contracts",
      "color": "FBCA04",
      "default": false,
      "description": "Module: contracts"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 23,
  "created_at": "2021-05-09T08:18:40Z",
  "updated_at": "2021-10-26T23:15:30Z",
  "closed_at": "2021-10-26T23:15:29Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!--\r\nNeed help?\r\nRefer to our contributing guidelines for additional information about making a good issue:\r\nhttps://github.com/ethereum-optimism/.github/blob/master/CONTRIBUTING.md\r\n-->\r\n\r\n**Is your feature request related to a problem? Please describe.**\r\nWe have disabled the `gasLimit` check inside of the ECDSA wallet account here: \r\n\r\nhttps://github.com/ethereum-optimism/optimism/blob/751e2be840af343e33836f5cc6d63325a3531ab4/packages/contracts/contracts/optimistic-ethereum/OVM/accounts/OVM_ECDSAContractAccount.sol#L109-L114\r\n\r\nWe disabled this check because we changed the meaning of `gasLimit` signed in transactions to equal `fee`. This meant that the wallet contract no longer had access to the gas required for execution. Removing this check introduces a security vulnerability for user wallets as the sequencer can extract a fee even if the gas supplied to the call is lower than what is acceptable.\r\n\r\nFor more information on why we turned `gasLimit` into `fee` see [this discussion](https://github.com/ethereum-optimism/roadmap/issues/777#issuecomment-794887046) ([mirror](https://gist.github.com/karlfloersch/bc0475cb9ff3318d0f4eda31aafc2f81)). \r\n\r\n\r\n**Describe the solution you'd like**\r\nCurrently, \r\n\r\n```\r\ngasLimit = gasUsed*executionPrice + transactionSizeInBytes*dataPrice\r\ngasPrice = 1gwei\r\n```\r\n\r\nWe propose to change this to:\r\n\r\n```\r\ngasLimit = Math.round((gasUsed*executionPrice + transactionSizeInBytes*dataPrice) / feeDivisor) + gasUsed/gasLimitGranularity\r\ngasPrice = 0.001gwei\r\n```\r\n\r\nWhere `feeDivisor=10000000` and `gasLimitGranularity=100000`. Note this means that gasLimits can only be set in increments of 100k.\r\n\r\nNext we modify the wallet contract to include the following check:\r\n\r\n```\r\n        gasLimit = (decodedTx.gasLimit % 1000) * 100,000;\r\n        require(\r\n           gasleft() >= SafeMath.add(gasLimit, EXECUTION_VALIDATION_GAS_OVERHEAD),\r\n           \"Gas is not sufficient to execute the transaction.\"\r\n        );\r\n```\r\n\r\nThis change also requires modifying L2Geth's `estimateGas` endpoint to return a `gas` value which also encodes the `gasLimit` as is done above.\r\n\r\n**Describe alternatives you've considered**\r\nAnother option is require that the wallet's call _does not revert_. This has the adverse effect that the sequencer must execute all transactions before applying them. Otherwise they won't know that the transaction will pay them. This is a DOS vector,",
  "closed_by": {
    "login": "smartcontracts",
    "id": 14298799,
    "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/smartcontracts",
    "html_url": "https://github.com/smartcontracts",
    "followers_url": "https://api.github.com/users/smartcontracts/followers",
    "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
    "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
    "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
    "repos_url": "https://api.github.com/users/smartcontracts/repos",
    "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
    "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/835869560",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-835869560",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 835869560,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzNTg2OTU2MA==",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-09T19:27:55Z",
    "updated_at": "2021-05-09T19:27:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "> We disabled this check because we changed the meaning of gasLimit signed in transactions to equal fee. This meant that the wallet contract no longer had access to the gas required for execution.\r\n\r\nSince the `gasLimit` was no longer encoding the `gasLimit`, information was being lost. The new scheme preserves the value of the `gasLimit` so that no information is lost",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/835869560/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/837065536",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-837065536",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 837065536,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzNzA2NTUzNg==",
    "user": {
      "login": "karlfloersch",
      "id": 706123,
      "node_id": "MDQ6VXNlcjcwNjEyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/706123?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karlfloersch",
      "html_url": "https://github.com/karlfloersch",
      "followers_url": "https://api.github.com/users/karlfloersch/followers",
      "following_url": "https://api.github.com/users/karlfloersch/following{/other_user}",
      "gists_url": "https://api.github.com/users/karlfloersch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karlfloersch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karlfloersch/subscriptions",
      "organizations_url": "https://api.github.com/users/karlfloersch/orgs",
      "repos_url": "https://api.github.com/users/karlfloersch/repos",
      "events_url": "https://api.github.com/users/karlfloersch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karlfloersch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-10T18:05:29Z",
    "updated_at": "2021-05-10T18:05:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "Updated this issue to specifically call out the change required in L2Geth",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/837065536/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/840598502",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-840598502",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 840598502,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDU5ODUwMg==",
    "user": {
      "login": "samsondav",
      "id": 4147639,
      "node_id": "MDQ6VXNlcjQxNDc2Mzk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4147639?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/samsondav",
      "html_url": "https://github.com/samsondav",
      "followers_url": "https://api.github.com/users/samsondav/followers",
      "following_url": "https://api.github.com/users/samsondav/following{/other_user}",
      "gists_url": "https://api.github.com/users/samsondav/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/samsondav/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/samsondav/subscriptions",
      "organizations_url": "https://api.github.com/users/samsondav/orgs",
      "repos_url": "https://api.github.com/users/samsondav/repos",
      "events_url": "https://api.github.com/users/samsondav/events{/privacy}",
      "received_events_url": "https://api.github.com/users/samsondav/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-13T14:27:19Z",
    "updated_at": "2021-05-13T14:27:19Z",
    "author_association": "NONE",
    "body": "Is there a reference implementation of this calculation that we can take a look at?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/840598502/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/842525326",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-842525326",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 842525326,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MjUyNTMyNg==",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-17T18:05:31Z",
    "updated_at": "2021-06-01T23:34:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "~~Note that `transactionSizeInBytes*dataPrice` does not take into account the gas cost differences between zero and non zero bytes in calldata. The implementation will change 4 gas for a zero byte and 16 bytes for a non zero byte, see https://eips.ethereum.org/EIPS/eip-2028~~\r\n\r\nIt now does",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/842525326/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/842676337",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-842676337",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 842676337,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MjY3NjMzNw==",
    "user": {
      "login": "K-Ho",
      "id": 5341583,
      "node_id": "MDQ6VXNlcjUzNDE1ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5341583?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/K-Ho",
      "html_url": "https://github.com/K-Ho",
      "followers_url": "https://api.github.com/users/K-Ho/followers",
      "following_url": "https://api.github.com/users/K-Ho/following{/other_user}",
      "gists_url": "https://api.github.com/users/K-Ho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/K-Ho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/K-Ho/subscriptions",
      "organizations_url": "https://api.github.com/users/K-Ho/orgs",
      "repos_url": "https://api.github.com/users/K-Ho/repos",
      "events_url": "https://api.github.com/users/K-Ho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/K-Ho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-17T22:13:01Z",
    "updated_at": "2021-05-17T22:58:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "**L1 gas cost of a transaction is equal to:**\r\n`L1GasPrice * ((16 * numNonZeroBytes + 4 * numZeroBytes) + perTxL1BatchCost + perStateRootL1BatchCost)`\r\nassuming 200 txs in a batch, `perTxL1BatchCost` will be 2687 gas\r\nassuming 250 state roots in a batch `perStateRootL1BatchCost` is `369832/251 = 1473.4 gas`. (See https://etherscan.io/tx/0x80100d2fdbe1d7d3a99f9569c25040e453ec2f3e173aadfbb8d1e672ee3194d4) -  \r\n**L2 gas cost of a transaction is equal to:**\r\n`L2ExecutionGasPrice * L2GasUsed`\r\n\r\n**Total fee per tx (sum of the two):**\r\n`1.5 * (L1GasPrice * ((16 * numNonZeroBytes + 4 * numZeroBytes) + perTxL1BatchCost + perStateRootL1BatchCost) + L2ExecutionGasPrice * L2GasUsed)`\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/842676337/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/842694257",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-842694257",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 842694257,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MjY5NDI1Nw==",
    "user": {
      "login": "K-Ho",
      "id": 5341583,
      "node_id": "MDQ6VXNlcjUzNDE1ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5341583?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/K-Ho",
      "html_url": "https://github.com/K-Ho",
      "followers_url": "https://api.github.com/users/K-Ho/followers",
      "following_url": "https://api.github.com/users/K-Ho/following{/other_user}",
      "gists_url": "https://api.github.com/users/K-Ho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/K-Ho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/K-Ho/subscriptions",
      "organizations_url": "https://api.github.com/users/K-Ho/orgs",
      "repos_url": "https://api.github.com/users/K-Ho/repos",
      "events_url": "https://api.github.com/users/K-Ho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/K-Ho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-17T22:55:42Z",
    "updated_at": "2021-05-17T22:55:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "```\r\n  [GAS BENCHMARK] OVM_CanonicalTransactionChain\r\n    appendSequencerBatch [ @skip-on-coverage ]\r\nBenchmark: 200 transactions in a single context.\r\nBenchmark complete.\r\nGas used: 1646860\r\nFixed calldata cost: 1280000\r\nNon-calldata overhead gas cost per transaction: 1834.3\r\n      âœ“ 200 transactions in a single context (533ms)\r\nBenchmark: 200 transactions in 200 contexts.\r\nBenchmark complete.\r\nGas used: 1817522\r\nFixed calldata cost: 1280000\r\nNon-calldata overhead gas cost per transaction: 2687.61\r\n      âœ“ 200 transactions in 200 contexts (681ms)\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/842694257/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/842696180",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-842696180",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 842696180,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MjY5NjE4MA==",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-17T23:00:31Z",
    "updated_at": "2021-05-18T23:06:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "edit: no longer being used\r\n\r\n~~The formula used is:~~\r\n\r\n```\r\noverhead = 2688 + 1473\r\ndataCost = 4 * zeroDataBytes + 16 * nonZeroDataBytes + overhead\r\ndataFee =  dataCost * dataPrice\r\nexecutionFee = executionPrice * gasUsed\r\nscaledFee = dataFee + executionFee\r\nnormalizedFee = fee // feeDivisor\r\nnormalizedGasused = gasUsed // gasLimitGranularity\r\nfee = normalizedFee + normalizedGasused\r\nresult = fee * 1.5\r\n```\r\n\r\n~~where `rollupBatchOverhead` is the sum of the cost of a single transaction in a transaction batch and the cost of a single state root in a state root batch~~",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/842696180/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/842731198",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-842731198",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 842731198,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MjczMTE5OA==",
    "user": {
      "login": "K-Ho",
      "id": 5341583,
      "node_id": "MDQ6VXNlcjUzNDE1ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5341583?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/K-Ho",
      "html_url": "https://github.com/K-Ho",
      "followers_url": "https://api.github.com/users/K-Ho/followers",
      "following_url": "https://api.github.com/users/K-Ho/following{/other_user}",
      "gists_url": "https://api.github.com/users/K-Ho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/K-Ho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/K-Ho/subscriptions",
      "organizations_url": "https://api.github.com/users/K-Ho/orgs",
      "repos_url": "https://api.github.com/users/K-Ho/repos",
      "events_url": "https://api.github.com/users/K-Ho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/K-Ho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-18T00:25:44Z",
    "updated_at": "2021-05-18T00:25:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "Example Transaction:\r\n```\r\nl1 gas price = 61 (gwei)\r\nbatchoverhead = 4161\r\n4 *152 zero bytes + 16* 220 data bytes = 4128 gas\r\nl1gasCost = 8289 gas * 61 gwei = 505629 gwei\r\nExecutionfee = .1 gwei executionPrice * 5,000,000 gasLimit = 500,000 gwei\r\negFee = floor(1.5 * (505,629 gwei + 500,000 gwei)) * 10,000,000 max gas + 5,000,000 gas limit\r\negFee = 12584435000000 \r\ngetGasPrice = 1/10000000 gwei = .0000001gwei\r\nestimatedFee (in metamask) = 12584435000000 * .0000001gwei = $4.4045\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/842731198/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/843453169",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-843453169",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 843453169,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MzQ1MzE2OQ==",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-18T18:59:09Z",
    "updated_at": "2021-06-01T23:34:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "Edit: removing the scalar due to complexity reasons, we can get the same effect without it (by just increasing the execution fee) and it saves a contract call in the ecsda contract account\r\n\r\nThe new formula is shown below\r\n\r\nGlobal variables that should be easy to source:\r\n\r\n```\r\noverhead\r\nexecution price\r\nl1GasCost\r\ngasPrice\r\n```\r\n\r\nThree of the variables should be pulled from a smart contract that can be updated by the sequencer. Short term they can be config options set at runtime\r\n- `overhead`\r\n- `executionPrice`\r\n\r\nThe `overhead` is meant to account for the gas used to submit the batches - the transaction batch and the state root batch.\r\n\r\nThe `executionPrice` can be thought of as the L2 Gas Price. It should go up if congestion increases.  This value needs to be able to updated in the future when the batch submission process is optimized. Longer term, there will be an eip1559 like mechanism dictating this value automatically\r\n\r\nThe `gasPrice` is the return value from the L2 node of the RPC endpoint `eth_gasPrice` and it returns 1wei in all cases\r\n\r\n```\r\noverhead = 2688 + 1473\r\nl1GasCost = (4 * zeroDataBytes) + (16 * nonZeroDataBytes) + overhead\r\nl1Fee = l1GasCost * l1GasPrice\r\nexecutionFee = executionPrice * gasLimit\r\nestimateGas =  (l1Fee + executionFee) * (maxGasLimit + gasLimit)\r\ngasPrice = 1wei\r\nfee = estimateGas * gasPrice\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/843453169/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/844387785",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-844387785",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 844387785,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NDM4Nzc4NQ==",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-19T19:05:16Z",
    "updated_at": "2021-06-01T23:34:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "edit: this solution will not be used\r\nProposed final and much more simple solution\r\nThis solution does not make it human readable for end users of metamask what the gas limit is\r\n\r\n```python\r\n#!/usr/bin/env python\r\n\r\nMAX_UINT_24 = 0xffffff - 1\r\n\r\ndef compute_data_cost(data):\r\n    ones = 0\r\n    zeros = 0\r\n    for b in data:\r\n        if b == 0:\r\n            zeros += 1\r\n        else:\r\n            ones += 1\r\n    ones_cost = ones * 16\r\n    zeros_cost = zeros * 4\r\n    return ones_cost + zeros_cost\r\n\r\ndef bit_count(num):\r\n    return num.bit_length()\r\n\r\nif __name__ == '__main__':\r\n    # example mainnet transaction\r\n    tx = b'0xf86c01854349be0a0082520894a1d8d972560c2f8144af871db508f0b0b10a3fbf8803f60cc2863df0008026a06d0450652736e0b8f9b5b9d369498dcfd805bafc2099e02b5ecd1d8e9726d548a070718c36c22987a840869f87d650882554f2fa4faf85be061e355ceba930a270'\r\n\r\n    # the l2_max_gas is currently unused - using it would require a contract\r\n    # call in the OVM_ECDSAContractAccount to the ExecutionManager to get the\r\n    # gas limit. Adding this would require a regenesis because the execution\r\n    # manager is at a 0xdead... address which are blocked from being called by\r\n    # userland transactions. the call could be avoided if it was a constant and\r\n    # then chugspash was used to upgrade the constant in the\r\n    # OVM_ECDSAContractAccount smart contract\r\n    l2_max_gas = 10000000\r\n\r\n    # instead we opt for using a specific number of bits to specify the l2 gas\r\n    # limit - it must fit in a uint24. This gives us a max gas limit on L2 of\r\n    # 16777214, which is plenty\r\n\r\n    # the overhead is removed from the equation for simplicity purposes and MUST\r\n    # be accounted for in the l2_gas_price. removing this value removes the need\r\n    # to hardcode the overhead or add a call from the ecdsa contract account to\r\n    # the OVM_GasOracle contract to get the overhead\r\n    l1_gas_price = 100\r\n    l1_gas_used = compute_data_cost(tx)\r\n    l1_fee = l1_gas_price * l1_gas_used\r\n\r\n    l2_gas_price = 100\r\n    l2_gas_used = 200\r\n    l2_fee = l2_gas_price * l2_gas_used\r\n\r\n    l2_gas_limit = eth_estimate_gas(tx)\r\n    bits = bit_count(MAX_UINT_24)\r\n\r\n    l1_l2_fee = l1_fee + l2_fee\r\n    # the return value of eth_estimateGas. This value is committed to by the\r\n    # signature and included in the RLP encoded transaction as the gasLimit\r\n    estimate_gas = (l1_l2_fee << bits) + l2_gas_limit\r\n\r\n    # the smart contract wallet can recompute the gas limit using the\r\n    # following code, where estimate_gas is deserialized from the EIP155\r\n    # transaction\r\n    recomupted_l1_l2_fee = estimate_gas >> bits\r\n    recomputed_l2_gas_limit = estimate_gas & ~(recomupted_l1_l2_fee << bits)\r\n\r\n    assert recomupted_l1_l2_fee == l1_l2_fee\r\n    assert recomputed_l2_gas_limit == l2_gas_limit\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/844387785/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/844557937",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-844557937",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 844557937,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NDU1NzkzNw==",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-19T23:12:14Z",
    "updated_at": "2021-05-24T21:54:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "This solution encodes the L2 gaslimit in the lower order bits of the fee, which is `tx.gasLimit` because `tx.gasPrice` should always be 1\r\n\r\n```python\r\n#!/usr/bin/env python\r\n\r\ndef compute_data_cost(data):\r\n    ones = 0\r\n    zeros = 0\r\n    for b in data:\r\n        if b == 0:\r\n            zeros += 1\r\n        else:\r\n            ones += 1\r\n    ones_cost = ones * 16\r\n    zeros_cost = zeros * 4\r\n    return ones_cost + zeros_cost\r\n\r\ndef eth_estimate_gas(x):\r\n    return x\r\n\r\ndef gwei_to_wei(x):\r\n    return x * 10**9\r\n\r\ndef wei_to_gwei(x):\r\n    return x * 10**-9\r\n\r\n# The L1 gas price must satisfy the equation `x * (10**8)`\r\n# Round to next highest number that satisfies this equation\r\ndef get_l1_gas_price(number):\r\n    number += (10**8 - 2 if number % 10**8 < 2 else 10**8)\r\n    return number - (number % 10**8)\r\n\r\n# The L2 gas price must satisfy the equation `x * (10**8) + 1`\r\ndef get_l2_gas_price(number):\r\n    number += (10**8 - 2 if number % 10**8 < 2 else 10**8)\r\n    return number - (number % 10**8) + 1\r\n\r\nif __name__ == '__main__':\r\n    # example mainnet transaction\r\n    tx = b'0xf86c01854349be0a0082520894a1d8d972560c2f8144af871db508f0b0b10a3fbf8803f60cc2863df0008026a06d0450652736e0b8f9b5b9d369498dcfd805bafc2099e02b5ecd1d8e9726d548a070718c36c22987a840869f87d650882554f2fa4faf85be061e355ceba930a270'\r\n\r\n    # the overhead of submitting a transaction to L1 is ~4200 gas\r\n    # this value is hardcoded\r\n    overhead = 4200\r\n\r\n    # fetch the L1 gas price from an L1 Provider\r\n    # the return value must satisfy the equation\r\n    # `y * 10**8` so round up to the nearest number\r\n    l1_gas_price = get_l1_gas_price(gwei_to_wei(2000))\r\n    # compute the L1 gas used to submit the transaction\r\n    l1_gas_used = compute_data_cost(tx) + overhead\r\n\r\n    # call the L2 gas oracle to get the current gas price\r\n    # the return value must satisfy the equation\r\n    # `x * (10**8) + 1`\r\n    # round up to the nearest number\r\n    l2_gas_price = get_l2_gas_price(gwei_to_wei(5000))\r\n    # call estimate gas to determine how much gas is used by the transaction\r\n    l2_gas_limit = eth_estimate_gas(437118)\r\n\r\n    estimate_gas = l2_gas_price * l2_gas_limit + l1_gas_price * l1_gas_used\r\n    gas_price = 1\r\n\r\n    print(estimate_gas)\r\n    recomputed_l2_gas_limit = estimate_gas % 10**8\r\n\r\n    assert recomputed_l2_gas_limit == l2_gas_limit\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/844557937/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/844591566",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-844591566",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 844591566,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NDU5MTU2Ng==",
    "user": {
      "login": "platocrat",
      "id": 37757724,
      "node_id": "MDQ6VXNlcjM3NzU3NzI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/37757724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/platocrat",
      "html_url": "https://github.com/platocrat",
      "followers_url": "https://api.github.com/users/platocrat/followers",
      "following_url": "https://api.github.com/users/platocrat/following{/other_user}",
      "gists_url": "https://api.github.com/users/platocrat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/platocrat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/platocrat/subscriptions",
      "organizations_url": "https://api.github.com/users/platocrat/orgs",
      "repos_url": "https://api.github.com/users/platocrat/repos",
      "events_url": "https://api.github.com/users/platocrat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/platocrat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-20T00:37:35Z",
    "updated_at": "2021-05-20T21:27:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "do we have any code that's written in Python or is this just pseudocode? ðŸ‘€ ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/844591566/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/845489320",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-845489320",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 845489320,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NTQ4OTMyMA==",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-20T21:27:48Z",
    "updated_at": "2021-05-20T21:27:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "You can try running the python linked above",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/845489320/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/845541000",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-845541000",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 845541000,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NTU0MTAwMA==",
    "user": {
      "login": "platocrat",
      "id": 37757724,
      "node_id": "MDQ6VXNlcjM3NzU3NzI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/37757724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/platocrat",
      "html_url": "https://github.com/platocrat",
      "followers_url": "https://api.github.com/users/platocrat/followers",
      "following_url": "https://api.github.com/users/platocrat/following{/other_user}",
      "gists_url": "https://api.github.com/users/platocrat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/platocrat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/platocrat/subscriptions",
      "organizations_url": "https://api.github.com/users/platocrat/orgs",
      "repos_url": "https://api.github.com/users/platocrat/repos",
      "events_url": "https://api.github.com/users/platocrat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/platocrat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-20T23:11:30Z",
    "updated_at": "2021-05-20T23:11:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "> You can try running the python linked above\r\n\r\nI was more so wondering why you were referring to the python code as a \"solution\" if you're not implementing it in python",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/845541000/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/845553605",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-845553605",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 845553605,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NTU1MzYwNQ==",
    "user": {
      "login": "K-Ho",
      "id": 5341583,
      "node_id": "MDQ6VXNlcjUzNDE1ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5341583?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/K-Ho",
      "html_url": "https://github.com/K-Ho",
      "followers_url": "https://api.github.com/users/K-Ho/followers",
      "following_url": "https://api.github.com/users/K-Ho/following{/other_user}",
      "gists_url": "https://api.github.com/users/K-Ho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/K-Ho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/K-Ho/subscriptions",
      "organizations_url": "https://api.github.com/users/K-Ho/orgs",
      "repos_url": "https://api.github.com/users/K-Ho/repos",
      "events_url": "https://api.github.com/users/K-Ho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/K-Ho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-20T23:45:42Z",
    "updated_at": "2021-05-20T23:45:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "I love that the overhead is 4200 gas ðŸ¤£",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/845553605/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/845554638",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-845554638",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 845554638,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NTU1NDYzOA==",
    "user": {
      "login": "K-Ho",
      "id": 5341583,
      "node_id": "MDQ6VXNlcjUzNDE1ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5341583?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/K-Ho",
      "html_url": "https://github.com/K-Ho",
      "followers_url": "https://api.github.com/users/K-Ho/followers",
      "following_url": "https://api.github.com/users/K-Ho/following{/other_user}",
      "gists_url": "https://api.github.com/users/K-Ho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/K-Ho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/K-Ho/subscriptions",
      "organizations_url": "https://api.github.com/users/K-Ho/orgs",
      "repos_url": "https://api.github.com/users/K-Ho/repos",
      "events_url": "https://api.github.com/users/K-Ho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/K-Ho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-20T23:48:42Z",
    "updated_at": "2021-05-20T23:49:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "Documenting what we chatted about @tynes - \r\n\r\nWhen a tx is received via RPC, we calculate the fee it should have been sent by:\r\n1. Extract the `L2GasLimit` from the lower-order bits of the `tx.gasLimit`\r\n2. Read the current `L1GasPrice`\r\n3. Read the current `L2ExecutionPrice`\r\n4. Calculate the `ExpectedFee` given the `L2GasLimit`, `L2ExecutionPrice`, `Scalar`, `L1GasPrice`, and`tx.data`\r\n5. If the `tx.gasLimit` specifies a fee that is less than `ExpectedFee`, then reject the tx",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/845554638/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/849189190",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-849189190",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 849189190,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0OTE4OTE5MA==",
    "user": {
      "login": "karlfloersch",
      "id": 706123,
      "node_id": "MDQ6VXNlcjcwNjEyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/706123?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karlfloersch",
      "html_url": "https://github.com/karlfloersch",
      "followers_url": "https://api.github.com/users/karlfloersch/followers",
      "following_url": "https://api.github.com/users/karlfloersch/following{/other_user}",
      "gists_url": "https://api.github.com/users/karlfloersch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karlfloersch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karlfloersch/subscriptions",
      "organizations_url": "https://api.github.com/users/karlfloersch/orgs",
      "repos_url": "https://api.github.com/users/karlfloersch/repos",
      "events_url": "https://api.github.com/users/karlfloersch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karlfloersch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-26T23:36:14Z",
    "updated_at": "2021-05-26T23:36:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "It turns out that setting a `1 wei` gasPrice breaks metamask. This means we need to adjust the equation so I am reopening this issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/849189190/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/849189622",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-849189622",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 849189622,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0OTE4OTYyMg==",
    "user": {
      "login": "karlfloersch",
      "id": 706123,
      "node_id": "MDQ6VXNlcjcwNjEyMw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/706123?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karlfloersch",
      "html_url": "https://github.com/karlfloersch",
      "followers_url": "https://api.github.com/users/karlfloersch/followers",
      "following_url": "https://api.github.com/users/karlfloersch/following{/other_user}",
      "gists_url": "https://api.github.com/users/karlfloersch/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karlfloersch/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karlfloersch/subscriptions",
      "organizations_url": "https://api.github.com/users/karlfloersch/orgs",
      "repos_url": "https://api.github.com/users/karlfloersch/repos",
      "events_url": "https://api.github.com/users/karlfloersch/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karlfloersch/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-26T23:37:26Z",
    "updated_at": "2021-05-28T17:31:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "```\r\nl1Fee = l1GasLimit * l1GasPrice\r\nl2Fee = l2GasLimit * l2GasPrice\r\nsum = l1Fee + l2Fee\r\nscaled = sum / txGasPrice\r\nremainder = scaled % 100_000_000\r\nroundedScaled = scaled + 100_000_000 - remainder\r\ntxGasLimit = roundedScaled + l2GasLimit\r\n\r\nfee = txGasLimit * txGasPrice\r\n```\r\n\r\nFor this to work the following must be satisfied:\r\n```\r\ntx.gasPrice == 0 OR 10^tx.gasPrice // 0, 1, 10, 100, 1000, etc\r\n```\r\n\r\nTo efficiently verify whether the tx.gasPrice is correct you can use:\r\n```\r\nx % 1 == 0 AND (x < 2 OR len(str(tx.GasPrice-1)) != len(str(tx.GasPrice)))\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/849189622/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/849189924",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-849189924",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 849189924,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0OTE4OTkyNA==",
    "user": {
      "login": "K-Ho",
      "id": 5341583,
      "node_id": "MDQ6VXNlcjUzNDE1ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5341583?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/K-Ho",
      "html_url": "https://github.com/K-Ho",
      "followers_url": "https://api.github.com/users/K-Ho/followers",
      "following_url": "https://api.github.com/users/K-Ho/following{/other_user}",
      "gists_url": "https://api.github.com/users/K-Ho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/K-Ho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/K-Ho/subscriptions",
      "organizations_url": "https://api.github.com/users/K-Ho/orgs",
      "repos_url": "https://api.github.com/users/K-Ho/repos",
      "events_url": "https://api.github.com/users/K-Ho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/K-Ho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-26T23:38:13Z",
    "updated_at": "2021-05-26T23:38:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "e.g. for a tx, with 1 wei gasPrice, we have a gasLimit of 450615**00209015**\r\nif we increase this to 10000 wei gasPrice, we can have a gasLimit of: 45**00209015**",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/849189924/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/849191525",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-849191525",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 849191525,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0OTE5MTUyNQ==",
    "user": {
      "login": "K-Ho",
      "id": 5341583,
      "node_id": "MDQ6VXNlcjUzNDE1ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5341583?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/K-Ho",
      "html_url": "https://github.com/K-Ho",
      "followers_url": "https://api.github.com/users/K-Ho/followers",
      "following_url": "https://api.github.com/users/K-Ho/following{/other_user}",
      "gists_url": "https://api.github.com/users/K-Ho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/K-Ho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/K-Ho/subscriptions",
      "organizations_url": "https://api.github.com/users/K-Ho/orgs",
      "repos_url": "https://api.github.com/users/K-Ho/repos",
      "events_url": "https://api.github.com/users/K-Ho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/K-Ho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-26T23:42:48Z",
    "updated_at": "2021-05-26T23:43:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "^ Actionably, we just divide the fee by 10000 before adding the l2GasLimit \r\nrather than doing 45061500000000 wei + 209015 l2GasLimit = 450615**00209015,**\r\nwe do:  (45061500000000 wei / 10000) + 209015 l2GasLimit = 45**00209015**",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/849191525/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/850563719",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-850563719",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 850563719,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MDU2MzcxOQ==",
    "user": {
      "login": "K-Ho",
      "id": 5341583,
      "node_id": "MDQ6VXNlcjUzNDE1ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5341583?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/K-Ho",
      "html_url": "https://github.com/K-Ho",
      "followers_url": "https://api.github.com/users/K-Ho/followers",
      "following_url": "https://api.github.com/users/K-Ho/following{/other_user}",
      "gists_url": "https://api.github.com/users/K-Ho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/K-Ho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/K-Ho/subscriptions",
      "organizations_url": "https://api.github.com/users/K-Ho/orgs",
      "repos_url": "https://api.github.com/users/K-Ho/repos",
      "events_url": "https://api.github.com/users/K-Ho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/K-Ho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-28T17:26:07Z",
    "updated_at": "2021-05-28T17:32:38Z",
    "author_association": "CONTRIBUTOR",
    "body": "Proposal: Round up `scaled` to the nearest value where `value%100_000_000==0`\r\n\r\n**Formula**\r\n```\r\nl1Fee = l1GasLimit * l1GasPrice\r\nl2Fee = l2GasLimit * l2GasPrice\r\nsum = l1Fee + l2Fee\r\nscaled = sum / 1000\r\nremainder = scaled %100_000_000\r\nroundedScaled = scaled + 100_000_000 - remainder\r\nresult = roundedScaled + l2GasLimit\r\n```\r\n**Example:**\r\n```\r\nl1GasPrice = 8_000_000_000 // 8 gwei\r\nl2GasPrice = 75 // 75 wei\r\nl2GasLimit = 10_999_999\r\nl1GasLimit = 4_219\r\nl1Fee = 8_000_000_000 * 4_219 = 33_752_000_000_000\r\nl2Fee =  75 * 10_999_999 = 824_999_925\r\nsum = 33_752_000_000_000 + 824_999_925 = 33_752_824_999_925\r\nscaled = 33_752_824_999_925 / 1000 = 33_752_824_999 // this does round down to nearest int. We're just rounding for this value anyways, so this shouldn't matter.\r\nremainder = 33_752_824_999 % 100_000_000 = 52_824_999\r\nroundedScaled = 33_752_824_999  + 100_000_000 - 52_824_999\r\nroundedScaled = 33_800_000_000\r\nresult = 33_800_000_000 + 10_999_999 = 33_810_999_999\r\n```\r\n\r\nFor fun on the above calc:\r\n```\r\ntx.gasLimit = 33_810_999_999\r\ntx.gasPrice = 1000\r\nfee = 33_810_999_999 * 1_000 wei = 0.000033811 ETH = ~$.09\r\n```\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/850563719/reactions",
      "total_count": 3,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/851760512",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-851760512",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 851760512,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1MTc2MDUxMg==",
    "user": {
      "login": "K-Ho",
      "id": 5341583,
      "node_id": "MDQ6VXNlcjUzNDE1ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5341583?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/K-Ho",
      "html_url": "https://github.com/K-Ho",
      "followers_url": "https://api.github.com/users/K-Ho/followers",
      "following_url": "https://api.github.com/users/K-Ho/following{/other_user}",
      "gists_url": "https://api.github.com/users/K-Ho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/K-Ho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/K-Ho/subscriptions",
      "organizations_url": "https://api.github.com/users/K-Ho/orgs",
      "repos_url": "https://api.github.com/users/K-Ho/repos",
      "events_url": "https://api.github.com/users/K-Ho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/K-Ho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-01T02:29:47Z",
    "updated_at": "2021-06-01T23:41:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "Turns out Metamask rounds gasPrice down to `gwei` to 4 decimal places, which rounds a 1,000 Wei gasPrice to 0 :(. Here is a proposed revision to the above to allow a gasPrice of 10,000,000 wei or .01 gwei (can be scaled up to .015 gwei):\r\n\r\nProposal: Round up `scaled` to the nearest value where `value%10,000==0` *and* scale l2GasLimit down to `ceil(l2GasLimit / 10,000)`\r\n\r\n**Formula**\r\n```\r\nroundedL2GasLimit = ceilMod(l2GasLimit, 10_000)\r\nl1Fee = l1GasLimit * l1GasPrice\r\nl2Fee = roundedL2GasLimit * l2GasPrice\r\nsum = l1Fee + l2Fee\r\nscaledFee = sum / 10,000,000\r\nremainder = scaled %10_000\r\nroundedScaledFee = scaledFee + 10_000 - remainder\r\nscaledRoundedL2GasLimit = roundedL2GasLimit / 10_000\r\nresult = roundedScaledFee + scaledRoundedL2GasLimit\r\n```\r\n**Example:**\r\n```\r\nl1GasPrice = 8_000_000_000 // 8 gwei\r\nl2GasPrice = 75 // 75 wei\r\nl2GasLimit = 10_999_999\r\nl1GasLimit = 4_219\r\nroundedL2GasLimit = ceilMod(10_999_999, 10_000) = 11_000_000\r\nl1Fee = 8_000_000_000 * 4_219 = 33_752_000_000_000\r\nl2Fee =  75 * 11_000_000 = 825_000_000\r\nsum = 33_752_000_000_000 + 824_999_925 = 33_752_825_000_000\r\nscaledFee = 33_752_824_999_925 / 10_000_000 = 3_375_282 # this does round down to nearest int. We're just rounding for this value anyways, so this shouldn't matter.\r\nremainder =  3_375_282 % 10_000 = 5_282\r\nroundedScaledFee = 3_375_282  + 10_000 - 5_282 = 3_380_000\r\nroundedScaledL2GasLimit = 11_000_000/10_000 = 1_100\r\nresult = 3_380_000 +  1_100 = 3_381_100\r\n```\r\n\r\nFor fun on the above calc:\r\n```\r\ntx.gasLimit =3_381_100 gas\r\ntx.gasPrice = 10_000_000 wei\r\nfee = 3_381_100 * 10_000_000 wei = 0.000033811 ETH = ~$.09\r\n```\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/851760512/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/952400640",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/823#issuecomment-952400640",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/823",
    "id": 952400640,
    "node_id": "IC_kwDODjvEJM44xHsA",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-26T23:15:29Z",
    "updated_at": "2021-10-26T23:15:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "No longer required in OVM 2.0.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/952400640/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
