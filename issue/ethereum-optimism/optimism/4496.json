{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4496",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4496/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4496/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4496/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/4496",
  "id": 1498468591,
  "node_id": "I_kwDODjvEJM5ZUNDv",
  "number": 4496,
  "title": "op-node stuck after a derivation temporary error",
  "user": {
    "login": "Kelvyne",
    "id": 8125532,
    "node_id": "MDQ6VXNlcjgxMjU1MzI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8125532?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Kelvyne",
    "html_url": "https://github.com/Kelvyne",
    "followers_url": "https://api.github.com/users/Kelvyne/followers",
    "following_url": "https://api.github.com/users/Kelvyne/following{/other_user}",
    "gists_url": "https://api.github.com/users/Kelvyne/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Kelvyne/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Kelvyne/subscriptions",
    "organizations_url": "https://api.github.com/users/Kelvyne/orgs",
    "repos_url": "https://api.github.com/users/Kelvyne/repos",
    "events_url": "https://api.github.com/users/Kelvyne/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Kelvyne/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832490,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNDkw",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bug",
      "name": "C-bug",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: bugs"
    },
    {
      "id": 2930018676,
      "node_id": "MDU6TGFiZWwyOTMwMDE4Njc2",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/S-unconfirmed",
      "name": "S-unconfirmed",
      "color": "BFD4F2",
      "default": false,
      "description": "Status: Issue might be valid, but itâ€™s not yet confirmed"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-12-15T13:47:23Z",
  "updated_at": "2023-09-04T08:37:40Z",
  "closed_at": "2023-01-04T15:09:27Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\nFor some reason, the L1 RPC returned an invalid receipt for a tx at block 8132846 (on Goerli)\r\n\r\n```\r\nops-bedrock-op-node-1      | WARN [12-15|09:19:57.203] Derivation process temporary error       attempts=8143 err=\"temp: failed to fetch receipts of L1 block 0xd2e567dc9d620f1a17ca79c229d3f0e92200931918273580c3cc799bf662c5f6:8132846 for L1 sysCfg update: receipt 20 has unexpected tx index 0\"\r\n```\r\n\r\nI relaunched `op-node` ~24 hours later, it seemed to be stuck (no logs after startup). \r\n\r\n**To Reproduce**\r\n\r\nI don't know\r\n\r\n**Expected behavior**\r\nIt should \r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**System Specs:**\r\n - OS:  Debian GNU/Linux 11 (bullseye)\r\n - Package Version (or commit hash): 0b7963ebeb5f8ba62fa365576a8a5b62686206de\r\n\r\n**Additional context**\r\n\r\nI deployed contracts on Goerli and run a batcher, proposer and node on the same server.\r\n\r\nI tried to deduce what was the problem. \r\nI fetched the faulty block using the same L1 RPC : \r\n```node\r\n  const block = await hre.ethers.provider.getBlockWithTransactions(8132846);\r\n\r\n  console.log(block.hash);\r\n  for (let i = 0; i < block.transactions.length; i++) {\r\n    const tx = block.transactions[i];\r\n    const receipt = await hre.ethers.provider.getTransactionReceipt(tx.hash);\r\n    console.log(receipt.transactionIndex, i);\r\n\r\n  }\r\n```\r\n\r\nThe transaction indexes seem to match the order.\r\n\r\nIt looks like the EthClient that fetches receipts has them in cache. I believe it cached the response of the RPC that had an error in it.\r\n\r\nWhat do you guys think ? I can also provide rollup configuration or genesis.\r\n\r\nObviously, if the cache is the problem, I'd love to propose a PR to fix the problem.",
  "closed_by": {
    "login": "Kelvyne",
    "id": 8125532,
    "node_id": "MDQ6VXNlcjgxMjU1MzI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/8125532?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Kelvyne",
    "html_url": "https://github.com/Kelvyne",
    "followers_url": "https://api.github.com/users/Kelvyne/followers",
    "following_url": "https://api.github.com/users/Kelvyne/following{/other_user}",
    "gists_url": "https://api.github.com/users/Kelvyne/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Kelvyne/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Kelvyne/subscriptions",
    "organizations_url": "https://api.github.com/users/Kelvyne/orgs",
    "repos_url": "https://api.github.com/users/Kelvyne/repos",
    "events_url": "https://api.github.com/users/Kelvyne/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Kelvyne/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4496/reactions",
    "total_count": 3,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 2
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4496/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1357463157",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4496#issuecomment-1357463157",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4496",
    "id": 1357463157,
    "node_id": "IC_kwDODjvEJM5Q6T51",
    "user": {
      "login": "Kelvyne",
      "id": 8125532,
      "node_id": "MDQ6VXNlcjgxMjU1MzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8125532?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kelvyne",
      "html_url": "https://github.com/Kelvyne",
      "followers_url": "https://api.github.com/users/Kelvyne/followers",
      "following_url": "https://api.github.com/users/Kelvyne/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kelvyne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kelvyne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kelvyne/subscriptions",
      "organizations_url": "https://api.github.com/users/Kelvyne/orgs",
      "repos_url": "https://api.github.com/users/Kelvyne/repos",
      "events_url": "https://api.github.com/users/Kelvyne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kelvyne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-19T11:01:21Z",
    "updated_at": "2022-12-19T11:01:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "Little update on the matter: the same temporary error happened this weekend at a different height using the same L1 RPC.\r\nThis time, re-running op-node made it resync and fixed the issue.\r\nI'll take some time to try and make the bug reproducible.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1357463157/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1371049452",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4496#issuecomment-1371049452",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4496",
    "id": 1371049452,
    "node_id": "IC_kwDODjvEJM5RuI3s",
    "user": {
      "login": "Kelvyne",
      "id": 8125532,
      "node_id": "MDQ6VXNlcjgxMjU1MzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8125532?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Kelvyne",
      "html_url": "https://github.com/Kelvyne",
      "followers_url": "https://api.github.com/users/Kelvyne/followers",
      "following_url": "https://api.github.com/users/Kelvyne/following{/other_user}",
      "gists_url": "https://api.github.com/users/Kelvyne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Kelvyne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Kelvyne/subscriptions",
      "organizations_url": "https://api.github.com/users/Kelvyne/orgs",
      "repos_url": "https://api.github.com/users/Kelvyne/repos",
      "events_url": "https://api.github.com/users/Kelvyne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Kelvyne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-04T15:09:27Z",
    "updated_at": "2023-01-04T15:09:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "I believe this was fixed by #4494",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1371049452/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1704849277",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4496#issuecomment-1704849277",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4496",
    "id": 1704849277,
    "node_id": "IC_kwDODjvEJM5lne99",
    "user": {
      "login": "Mrigesh901",
      "id": 59439845,
      "node_id": "MDQ6VXNlcjU5NDM5ODQ1",
      "avatar_url": "https://avatars.githubusercontent.com/u/59439845?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Mrigesh901",
      "html_url": "https://github.com/Mrigesh901",
      "followers_url": "https://api.github.com/users/Mrigesh901/followers",
      "following_url": "https://api.github.com/users/Mrigesh901/following{/other_user}",
      "gists_url": "https://api.github.com/users/Mrigesh901/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Mrigesh901/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Mrigesh901/subscriptions",
      "organizations_url": "https://api.github.com/users/Mrigesh901/orgs",
      "repos_url": "https://api.github.com/users/Mrigesh901/repos",
      "events_url": "https://api.github.com/users/Mrigesh901/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Mrigesh901/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-04T08:37:40Z",
    "updated_at": "2023-09-04T08:37:40Z",
    "author_association": "NONE",
    "body": "I am facing a similar issue but don't know how to resolve it. Can you give a little more detail on how to fix this. I am setting up a base mainnet node and sync is stuck from a day. logs of op-node container shows the same err warning.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1704849277/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
