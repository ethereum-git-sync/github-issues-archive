{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1687",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1687/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1687/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1687/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/1687",
  "id": 1044106526,
  "node_id": "I_kwDODjvEJM4-O80e",
  "number": 1687,
  "title": "Canary release versioning scheme can break past releases",
  "user": {
    "login": "smartcontracts",
    "id": 14298799,
    "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/smartcontracts",
    "html_url": "https://github.com/smartcontracts",
    "followers_url": "https://api.github.com/users/smartcontracts/followers",
    "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
    "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
    "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
    "repos_url": "https://api.github.com/users/smartcontracts/repos",
    "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
    "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832490,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNDkw",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bug",
      "name": "C-bug",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: This is a bug."
    },
    {
      "id": 3409449026,
      "node_id": "LA_kwDODjvEJM7LOBBC",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/M-ci",
      "name": "M-ci",
      "color": "FBCA04",
      "default": false,
      "description": "Module: ci"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-11-03T20:56:54Z",
  "updated_at": "2021-11-04T17:19:14Z",
  "closed_at": "2021-11-04T17:19:14Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!--\r\nNeed help?\r\nRefer to our contributing guidelines for additional information about making a good issue:\r\nhttps://github.com/ethereum-optimism/.github/blob/master/CONTRIBUTING.md\r\n-->\r\n\r\n**Describe the bug**\r\nOur canary release versioning scheme can break when a new canary release is published on a different branch that is incompatible with existing canary releases. For instance, we recently published canary release version `0.0.0-202192720115` of the `@eth-optimism/message-relayer` package based on the `regenesis/0.5.0` branch. This package relies on the `@eth-optimism/contracts` package as shown in the `package.json`:\r\n\r\nhttps://github.com/ethereum-optimism/optimism/blob/regenesis/0.5.0/packages/message-relayer/package.json#L38\r\n\r\nHowever, note that the version specified here is `\"^0.4.13\"` with a `^` denoting that it will accept any versions of the `@eth-optimism/contracts` package 0.4.XX where XX > 13. Apparently this caret constraint is carried over to the canary version of the release, so the published package has the following constraint:\r\n\r\n`    \"@eth-optimism/contracts\": \"^0.0.0-202192720115\",`\r\n\r\n`yarn` resolves this to the highest version number that satisfies the constraint, which in this case ends up being `0.0.0-alpha.1` and is not at all what we want. We have a similar issue whenever a new canary release is published because we use `yarn changeset version --snapshot`, which publishes with a version number `0.0.0-DATETIMESTAMP`. Any canary releases published AFTER your desired canary release will have a greater DATETIMESTAMP and therefore will take precedence if a caret constraint exists.\r\n\r\nI think we can solve this by entirely removing caret constraints for packages imported within the monorepo, but I need to double-check this.",
  "closed_by": {
    "login": "smartcontracts",
    "id": 14298799,
    "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/smartcontracts",
    "html_url": "https://github.com/smartcontracts",
    "followers_url": "https://api.github.com/users/smartcontracts/followers",
    "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
    "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
    "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
    "repos_url": "https://api.github.com/users/smartcontracts/repos",
    "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
    "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1687/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1687/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/960055159",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1687#issuecomment-960055159",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1687",
    "id": 960055159,
    "node_id": "IC_kwDODjvEJM45OUd3",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-03T21:00:09Z",
    "updated_at": "2021-11-03T21:00:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "![Screenshot from 2021-11-03 16-59-53](https://user-images.githubusercontent.com/14298799/140191907-ec24dffa-708b-4835-b659-5507b05accc7.png)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/960055159/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/960246155",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1687#issuecomment-960246155",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1687",
    "id": 960246155,
    "node_id": "IC_kwDODjvEJM45PDGL",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-03T22:32:39Z",
    "updated_at": "2021-11-03T22:32:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "Good catch, I'm good with being very explicit about versioning of the packages when they import other packages that exist in the monorepo. It is less scalable, but another way to do this is `yarn link` or `npm link`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/960246155/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/960247828",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1687#issuecomment-960247828",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1687",
    "id": 960247828,
    "node_id": "IC_kwDODjvEJM45PDgU",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-03T22:36:11Z",
    "updated_at": "2021-11-03T23:09:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "~Bleh I think the issue with being explicit is just that it will require manually bumping package versions and we lose a lot of the benefits of changesets. I was hoping that there would be some way to get changesets to pin versions only when releasing a canary release.~",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/960247828/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/960262098",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1687#issuecomment-960262098",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1687",
    "id": 960262098,
    "node_id": "IC_kwDODjvEJM45PG_S",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-03T22:57:38Z",
    "updated_at": "2021-11-03T23:10:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "~We could try to use the following experimental option:~\r\n\r\n~https://github.com/atlassian/changesets/blob/9dcc364bf19e48f8f2824ebaf967d9ef41b6fc04/packages/config/src/index.test.ts#L33~\r\n\r\n~This would release canary releases as `<actual version>-<DATETIMESTAMP>` instead of `0.0.0-DATETIMESTAMP`.~",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/960262098/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/960271203",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1687#issuecomment-960271203",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1687",
    "id": 960271203,
    "node_id": "IC_kwDODjvEJM45PJNj",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-03T23:04:33Z",
    "updated_at": "2021-11-03T23:04:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "Scratch that, automatic versioning does still apply when not using caret constraints: https://github.com/ethereum-optimism/optimism/pull/1655/files#diff-39e4ba51a41e33f6e8a570c2bc4dbb8d0e35685a4f819f3157efed7f1b22e2d6R37",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/960271203/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
