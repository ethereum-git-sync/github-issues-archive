{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/6851",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/6851/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/6851/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/6851/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/6851",
  "id": 1854207201,
  "node_id": "I_kwDODjvEJM5uhPTh",
  "number": 6851,
  "title": "op-node stuck after L1 node switch",
  "user": {
    "login": "crebsy",
    "id": 121096251,
    "node_id": "U_kgDOBzfIOw",
    "avatar_url": "https://avatars.githubusercontent.com/u/121096251?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/crebsy",
    "html_url": "https://github.com/crebsy",
    "followers_url": "https://api.github.com/users/crebsy/followers",
    "following_url": "https://api.github.com/users/crebsy/following{/other_user}",
    "gists_url": "https://api.github.com/users/crebsy/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/crebsy/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/crebsy/subscriptions",
    "organizations_url": "https://api.github.com/users/crebsy/orgs",
    "repos_url": "https://api.github.com/users/crebsy/repos",
    "events_url": "https://api.github.com/users/crebsy/events{/privacy}",
    "received_events_url": "https://api.github.com/users/crebsy/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-08-17T04:02:09Z",
  "updated_at": "2023-10-03T11:17:29Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!--\r\nNeed help?\r\nRefer to our contributing guidelines for additional information about making a good issue:\r\nhttps://github.com/ethereum-optimism/.github/blob/master/CONTRIBUTING.md\r\n-->\r\n\r\n**Describe the bug**\r\nI'm running bedrock stack on mainnet with the dockerized `op-node:v1.1.1`\r\nIn the last two days, I lost network connection to the configured L1 node.\r\nToday, I've switched the L1 URL and restarted op-node.\r\nNow the op-node is stuck in a loop traversing back around 2 days of L1 blocks over and over again.\r\n```\r\n...\r\nt=2023-08-17T03:45:25+0000 lvl=info msg=\"Walking back L1Block by hash\"       curr=0x731ca1d47d67669803bf14e585db34fc55f7b218119ecc0dbc31851a7d7fe979:17927746 next=0x551ed54dbda8d7ff705e9f0c46c9f72cf58f217e3c2646af1cd27ec91de77657:17927745 l2block=0x6e2bf3aad26cbde7153017833634149da3fbe438b2eb79341c66fa33d526aea2:108297243\r\nt=2023-08-17T03:45:25+0000 lvl=info msg=\"Walking back L1Block by hash\"       curr=0x551ed54dbda8d7ff705e9f0c46c9f72cf58f217e3c2646af1cd27ec91de77657:17927745 next=0x7e3992df851edcb60d52608879eaa238f6420f396f305af0a0623e5f862dc7b1:17927744 l2block=0x6a72668599ba100f47cac1e7827ef3909e4935dd0666357ac7d498eccad4e8b4:108297237\r\nt=2023-08-17T03:45:25+0000 lvl=info msg=\"Walking back L1Block by hash\"       curr=0x7e3992df851edcb60d52608879eaa238f6420f396f305af0a0623e5f862dc7b1:17927744 next=0x3c9e4e966465efb8dee9086c7ab98d2e77dba6332163ef704a38e7cbe28fe0ef:17927743 l2block=0xbc957b7eb9e142405c5be4366208b0e1937d2e70e7d2202bd4a0f481123a586c:108297231\r\nt=2023-08-17T03:45:25+0000 lvl=info msg=\"Walking back L1Block by hash\"       curr=0x3c9e4e966465efb8dee9086c7ab98d2e77dba6332163ef704a38e7cbe28fe0ef:17927743 next=0xe148f6c7220bf5a9db1a7ae01a5726be40f2d5f378aa9bba1a761cd6eec8555e:17927742 l2block=0xf1f9cdb6e98f22771d0efed5118836cdedd8311f56630ec5627317b7ab04a56a:108297225\r\nt=2023-08-17T03:45:25+0000 lvl=info msg=\"Walking back L1Block by hash\"       curr=0xe148f6c7220bf5a9db1a7ae01a5726be40f2d5f378aa9bba1a761cd6eec8555e:17927742 next=0x4bff1e62b1727274627cbc82e28115b35a74ba1e2a84774c81b692ce0acae55c:17927741 l2block=0x40a5a34c6458e5a63a92458f7832af0477ebec2bdec5448a1ba297fde93f39b8:108297219\r\n...\r\n```\r\n\r\nI've seen a few other logs indicating a reorg problem:\r\n```\r\nt=2023-08-17T03:01:06+0000 lvl=warn msg=\"Derivation process temporary error\" attempts=1 err=\"stage 0 failed resetting: temp: failed to find the L2 Heads to start from: reorg is too deep: traversed back to L2 block 0x80e91068369632491fe9c34005b434ec268daf6fc5a0e72a4e96e610affa565d:108198044, but too deep compared to previous unsafe block 0x3a0ca33bfeff0d153f8b73178eb800617d5f02efb9ecd829f71df0ce6d830715:108306767\"\r\nt=2023-08-17T03:16:00+0000 lvl=warn msg=\"Derivation process temporary error\" attempts=2 err=\"stage 0 failed resetting: temp: failed to find the L2 Heads to start from: reorg is too deep: traversed back to L2 block 0x80e91068369632491fe9c34005b434ec268daf6fc5a0e72a4e96e610affa565d:108198044, but too deep compared to previous unsafe block 0x3a0ca33bfeff0d153f8b73178eb800617d5f02efb9ecd829f71df0ce6d830715:108306767\"\r\nt=2023-08-17T03:30:00+0000 lvl=warn msg=\"Derivation process temporary error\" attempts=3 err=\"stage 0 failed resetting: temp: failed to find the L2 Heads to start from: reorg is too deep: traversed back to L2 block 0x80e91068369632491fe9c34005b434ec268daf6fc5a0e72a4e96e610affa565d:108198044, but too deep compared to previous unsafe block 0x3a0ca33bfeff0d153f8b73178eb800617d5f02efb9ecd829f71df0ce6d830715:108306767\"\r\n```\r\n\r\n\r\n**Expected behavior**\r\nop-node should self-recover\r\n\r\nIs there anything that can be done to recover the node ?",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/6851/reactions",
    "total_count": 6,
    "+1": 6,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/6851/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1710578686",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/6851#issuecomment-1710578686",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/6851",
    "id": 1710578686,
    "node_id": "IC_kwDODjvEJM5l9Vv-",
    "user": {
      "login": "0xalex88",
      "id": 113263502,
      "node_id": "U_kgDOBsBDjg",
      "avatar_url": "https://avatars.githubusercontent.com/u/113263502?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/0xalex88",
      "html_url": "https://github.com/0xalex88",
      "followers_url": "https://api.github.com/users/0xalex88/followers",
      "following_url": "https://api.github.com/users/0xalex88/following{/other_user}",
      "gists_url": "https://api.github.com/users/0xalex88/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/0xalex88/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/0xalex88/subscriptions",
      "organizations_url": "https://api.github.com/users/0xalex88/orgs",
      "repos_url": "https://api.github.com/users/0xalex88/repos",
      "events_url": "https://api.github.com/users/0xalex88/events{/privacy}",
      "received_events_url": "https://api.github.com/users/0xalex88/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-07T18:09:20Z",
    "updated_at": "2023-09-07T18:09:20Z",
    "author_association": "NONE",
    "body": "In my case I've upgraded from 1.1.1 to 1.1.4 and instead of throwing that `reorg is too deep` and looping it showed `Hit finalized L2 head, returning immediately` (when it reached l1 block 0) and then it resumed working properly",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1710578686/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1711034150",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/6851#issuecomment-1711034150",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/6851",
    "id": 1711034150,
    "node_id": "IC_kwDODjvEJM5l_E8m",
    "user": {
      "login": "folowing",
      "id": 1393769,
      "node_id": "MDQ6VXNlcjEzOTM3Njk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1393769?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/folowing",
      "html_url": "https://github.com/folowing",
      "followers_url": "https://api.github.com/users/folowing/followers",
      "following_url": "https://api.github.com/users/folowing/following{/other_user}",
      "gists_url": "https://api.github.com/users/folowing/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/folowing/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/folowing/subscriptions",
      "organizations_url": "https://api.github.com/users/folowing/orgs",
      "repos_url": "https://api.github.com/users/folowing/repos",
      "events_url": "https://api.github.com/users/folowing/events{/privacy}",
      "received_events_url": "https://api.github.com/users/folowing/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-08T03:46:38Z",
    "updated_at": "2023-09-08T03:46:38Z",
    "author_association": "NONE",
    "body": "> In my case I've upgraded from 1.1.1 to 1.1.4 and instead of throwing that `reorg is too deep` and looping it showed `Hit finalized L2 head, returning immediately` (when it reached l1 block 0) and then it resumed working properly\r\n\r\nthanks, it works like a charm",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1711034150/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1716040706",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/6851#issuecomment-1716040706",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/6851",
    "id": 1716040706,
    "node_id": "IC_kwDODjvEJM5mSLQC",
    "user": {
      "login": "DaveWK",
      "id": 13626476,
      "node_id": "MDQ6VXNlcjEzNjI2NDc2",
      "avatar_url": "https://avatars.githubusercontent.com/u/13626476?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/DaveWK",
      "html_url": "https://github.com/DaveWK",
      "followers_url": "https://api.github.com/users/DaveWK/followers",
      "following_url": "https://api.github.com/users/DaveWK/following{/other_user}",
      "gists_url": "https://api.github.com/users/DaveWK/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/DaveWK/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/DaveWK/subscriptions",
      "organizations_url": "https://api.github.com/users/DaveWK/orgs",
      "repos_url": "https://api.github.com/users/DaveWK/repos",
      "events_url": "https://api.github.com/users/DaveWK/events{/privacy}",
      "received_events_url": "https://api.github.com/users/DaveWK/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-12T16:22:20Z",
    "updated_at": "2023-09-12T16:22:20Z",
    "author_association": "NONE",
    "body": "Unfortunately my node continued to loop on v1.1.4 back down to zero over and over again. I had previously been using a Nethermind node for the L1, and in bedrock had set the \"nethermind\" node type. I was able to point it at a go-ethererum node and changed the \"type\" parameter to \"basic\" and now it is catching back up again.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1716040706/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1744753357",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/6851#issuecomment-1744753357",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/6851",
    "id": 1744753357,
    "node_id": "IC_kwDODjvEJM5n_tLN",
    "user": {
      "login": "avinava-mycelium",
      "id": 92358904,
      "node_id": "U_kgDOBYFI-A",
      "avatar_url": "https://avatars.githubusercontent.com/u/92358904?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/avinava-mycelium",
      "html_url": "https://github.com/avinava-mycelium",
      "followers_url": "https://api.github.com/users/avinava-mycelium/followers",
      "following_url": "https://api.github.com/users/avinava-mycelium/following{/other_user}",
      "gists_url": "https://api.github.com/users/avinava-mycelium/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/avinava-mycelium/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/avinava-mycelium/subscriptions",
      "organizations_url": "https://api.github.com/users/avinava-mycelium/orgs",
      "repos_url": "https://api.github.com/users/avinava-mycelium/repos",
      "events_url": "https://api.github.com/users/avinava-mycelium/events{/privacy}",
      "received_events_url": "https://api.github.com/users/avinava-mycelium/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-03T11:17:29Z",
    "updated_at": "2023-10-03T11:17:29Z",
    "author_association": "NONE",
    "body": "> Unfortunately my node continued to loop on v1.1.4 back down to zero over and over again. I had previously been using a Nethermind node for the L1, and in bedrock had set the \"nethermind\" node type. I was able to point it at a go-ethererum node and changed the \"type\" parameter to \"basic\" and now it is catching back up again.\r\n\r\nI have been using \"nethermind\" stack instead of \"geth\" and the sync just stops from time to time at certain blocks. Is it mandatory to run a Geth node for the l1 URL after the bedrock upgrade?\r\n\r\nThanks. 🙏 ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1744753357/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
