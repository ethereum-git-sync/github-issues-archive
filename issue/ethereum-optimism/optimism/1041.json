{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1041",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1041/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1041/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1041/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/1041",
  "id": 915527953,
  "node_id": "MDU6SXNzdWU5MTU1Mjc5NTM=",
  "number": 1041,
  "title": "Latest watchers do not pick up withdrawal finalization",
  "user": {
    "login": "ajsantander",
    "id": 550409,
    "node_id": "MDQ6VXNlcjU1MDQwOQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/550409?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsantander",
    "html_url": "https://github.com/ajsantander",
    "followers_url": "https://api.github.com/users/ajsantander/followers",
    "following_url": "https://api.github.com/users/ajsantander/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsantander/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsantander/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsantander/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsantander/orgs",
    "repos_url": "https://api.github.com/users/ajsantander/repos",
    "events_url": "https://api.github.com/users/ajsantander/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsantander/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832490,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNDkw",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bug",
      "name": "C-bug",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: This is a bug."
    },
    {
      "id": 2981541772,
      "node_id": "MDU6TGFiZWwyOTgxNTQxNzcy",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/P-confirmed",
      "name": "P-confirmed",
      "color": "BFD4F2",
      "default": false,
      "description": "A confirmed bug"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-06-08T21:23:00Z",
  "updated_at": "2021-12-21T19:30:06Z",
  "closed_at": "2021-12-21T19:30:06Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "This happens when we upgrade `@eth-optimism/watcher` to `@eth-optimism/core-utils` as can be seen in this PR https://github.com/Synthetixio/synthetix/pull/1321/files\r\n\r\nThe result is that the watcher \"hangs\" when detecting withdrawal finalization, even though it seems to pick up deposit finalization. This can be seen as a timeout of 10m in the previously mentioned CI run https://app.circleci.com/pipelines/github/Synthetixio/synthetix/7427/workflows/fcf5e4f3-527f-4fe8-8e78-4f5ce376ec9d/jobs/69921\r\n\r\nTo reproduce locally, check out the Synthetix repo at the PR above, start the ops tool at the specified commit, then run:\r\n`npx hardhat test:integration:dual --compile --deploy`\r\n\r\nThis is how we setup the watcher: https://github.com/Synthetixio/synthetix/pull/1321/files#diff-0ec74ac23703db180e935294b0032c83811c218e87dacfdf89637dca21d4e352L70-L80\r\n\r\nAnd how we use it: https://github.com/Synthetixio/synthetix/blob/develop/test/integration/utils/watchers.js\r\n",
  "closed_by": {
    "login": "smartcontracts",
    "id": 14298799,
    "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/smartcontracts",
    "html_url": "https://github.com/smartcontracts",
    "followers_url": "https://api.github.com/users/smartcontracts/followers",
    "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
    "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
    "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
    "repos_url": "https://api.github.com/users/smartcontracts/repos",
    "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
    "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1041/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1041/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/864118810",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1041#issuecomment-864118810",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1041",
    "id": 864118810,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NDExODgxMA==",
    "user": {
      "login": "ajsantander",
      "id": 550409,
      "node_id": "MDQ6VXNlcjU1MDQwOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/550409?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsantander",
      "html_url": "https://github.com/ajsantander",
      "followers_url": "https://api.github.com/users/ajsantander/followers",
      "following_url": "https://api.github.com/users/ajsantander/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsantander/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsantander/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsantander/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsantander/orgs",
      "repos_url": "https://api.github.com/users/ajsantander/repos",
      "events_url": "https://api.github.com/users/ajsantander/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsantander/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-18T15:29:00Z",
    "updated_at": "2021-06-18T15:29:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "@smartcontracts ah found the issue and fixed it here: https://github.com/ethereum-optimism/optimism/pull/1121\r\n\r\nOur integration tests no longer hand and all pass with this mini change directly implemented in our node_modules.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/864118810/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/865266282",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1041#issuecomment-865266282",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1041",
    "id": 865266282,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NTI2NjI4Mg==",
    "user": {
      "login": "ajsantander",
      "id": 550409,
      "node_id": "MDQ6VXNlcjU1MDQwOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/550409?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsantander",
      "html_url": "https://github.com/ajsantander",
      "followers_url": "https://api.github.com/users/ajsantander/followers",
      "following_url": "https://api.github.com/users/ajsantander/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsantander/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsantander/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsantander/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsantander/orgs",
      "repos_url": "https://api.github.com/users/ajsantander/repos",
      "events_url": "https://api.github.com/users/ajsantander/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsantander/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-21T18:52:56Z",
    "updated_at": "2021-06-21T18:52:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "@smartcontracts it seems like the fix proposed in #1121 allows some L2>L1 withdrawal's get picked up, but it still times out on some situations.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/865266282/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/865430723",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1041#issuecomment-865430723",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1041",
    "id": 865430723,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NTQzMDcyMw==",
    "user": {
      "login": "K-Ho",
      "id": 5341583,
      "node_id": "MDQ6VXNlcjUzNDE1ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5341583?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/K-Ho",
      "html_url": "https://github.com/K-Ho",
      "followers_url": "https://api.github.com/users/K-Ho/followers",
      "following_url": "https://api.github.com/users/K-Ho/following{/other_user}",
      "gists_url": "https://api.github.com/users/K-Ho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/K-Ho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/K-Ho/subscriptions",
      "organizations_url": "https://api.github.com/users/K-Ho/orgs",
      "repos_url": "https://api.github.com/users/K-Ho/repos",
      "events_url": "https://api.github.com/users/K-Ho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/K-Ho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-22T00:19:42Z",
    "updated_at": "2021-06-22T00:19:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "Confirmed that I was able to reproduce locally \r\n\r\n```\r\n1) Start up the local network\r\n2)  npx hardhat test:integration:dual --compile --deploy on branch https://github.com/Synthetixio/synthetix/pull/1343\r\n3) npx hardhat test:integration:dual to re-rerun the tests\r\n4) npx hardhat test:integration:dual --deploy to re-run tests with clean state\r\n```\r\n\r\nWithdrawal succeeds on first few tries, but then `npx hardhat test:integration:dual` eventually stops having withdrawals relayed. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/865430723/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/865430882",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1041#issuecomment-865430882",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1041",
    "id": 865430882,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2NTQzMDg4Mg==",
    "user": {
      "login": "K-Ho",
      "id": 5341583,
      "node_id": "MDQ6VXNlcjUzNDE1ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5341583?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/K-Ho",
      "html_url": "https://github.com/K-Ho",
      "followers_url": "https://api.github.com/users/K-Ho/followers",
      "following_url": "https://api.github.com/users/K-Ho/following{/other_user}",
      "gists_url": "https://api.github.com/users/K-Ho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/K-Ho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/K-Ho/subscriptions",
      "organizations_url": "https://api.github.com/users/K-Ho/orgs",
      "repos_url": "https://api.github.com/users/K-Ho/repos",
      "events_url": "https://api.github.com/users/K-Ho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/K-Ho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-22T00:20:13Z",
    "updated_at": "2021-06-22T00:20:13Z",
    "author_association": "CONTRIBUTOR",
    "body": "Looks like batch submitter is failing with logs \r\n```\r\n{\"level\":30,\"time\":1624315102382,\"name\":\"oe:batch_submitter:state_chain\",\"address\":\"0x70997970C51812dc3A010C7d01b50e0d17dc79C8\",\"ether\":\"4999.841759976\",\"msg\":\"Checked balance\"}\r\n{\"level\":30,\"time\":1624315102382,\"name\":\"oe:batch_submitter:state_chain\",\"l2ChainId\":\"0x1a4\",\"batchSubmitterAddress\":\"0x70997970C51812dc3A010C7d01b50e0d17dc79C8\",\"msg\":\"Readying to submit next batch...\"}\r\n{\"level\":30,\"time\":1624315102382,\"name\":\"oe:batch_submitter:state_chain\",\"msg\":\"Getting batch start and end for state batch submitter...\"}\r\n{\"level\":30,\"time\":1624315102399,\"name\":\"oe:batch_submitter:state_chain\",\"startBlock\":158,\"msg\":\"Retrieved start block number from SCC\"}\r\n{\"level\":30,\"time\":1624315102412,\"name\":\"oe:batch_submitter:state_chain\",\"totalElements\":158,\"msg\":\"Retrieved total elements from CTC\"}\r\n{\"level\":30,\"time\":1624315102412,\"name\":\"oe:batch_submitter:state_chain\",\"msg\":\"No state commitments to submit. Skipping batch submission...\"}\r\n{\"level\":30,\"time\":1624315102723,\"name\":\"oe:batch_submitter:tx_chain\",\"address\":\"0x70997970C51812dc3A010C7d01b50e0d17dc79C8\",\"ether\":\"4999.841759976\",\"msg\":\"Checked balance\"}\r\n{\"level\":30,\"time\":1624315102723,\"name\":\"oe:batch_submitter:tx_chain\",\"l2ChainId\":\"0x1a4\",\"batchSubmitterAddress\":\"0x70997970C51812dc3A010C7d01b50e0d17dc79C8\",\"msg\":\"Readying to submit next batch...\"}\r\n{\"level\":30,\"time\":1624315102723,\"name\":\"oe:batch_submitter:tx_chain\",\"msg\":\"Getting batch start and end for transaction batch submitter...\"}\r\n{\"level\":30,\"time\":1624315102737,\"name\":\"oe:batch_submitter:tx_chain\",\"startBlock\":158,\"msg\":\"Retrieved start block number from CTC\"}\r\n{\"level\":30,\"time\":1624315102740,\"name\":\"oe:batch_submitter:tx_chain\",\"endBlock\":180,\"msg\":\"Retrieved end block number from L2 sequencer\"}\r\n{\"level\":50,\"time\":1624315102838,\"name\":\"oe:batch_submitter:tx_chain\",\"extra\":{\"idx\":4,\"ele\":{\"stateRoot\":\"0x3784f6c52f6330c3d17a02a458adb982a8d70a6470bcf527ea019d493e0f86de\",\"timestamp\":1624315442,\"blockNumber\":509,\"isSequencerTx\":false}},\"msg\":\"Timestamp monotonicity violated! Element\"}\r\n{\"level\":50,\"time\":1624315102838,\"extra\":{\"message\":\"TypeError: (intermediate value) is not iterable\",\"stack\":\"TypeError: (intermediate value) is not iterable\\n    at TransactionBatchSubmitter._submitBatch (/opt/optimism/packages/batch-submitter/src/batch-submitter/tx-batch-submitter.ts:234:9)\\n    at runMicrotasks (<anonymous>)\\n    at processTicksAndRejections (internal/process/task_queues.js:93:5)\\n    at loop (/opt/optimism/packages/batch-submitter/src/exec/run-batch-submitter.ts:442:9)\"},\"msg\":\"Unhandled exception during batch submission\"}\r\n{\"level\":30,\"time\":1624315102838,\"msg\":\"Retrying...\"}\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/865430882/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/953313870",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1041#issuecomment-953313870",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1041",
    "id": 953313870,
    "node_id": "IC_kwDODjvEJM440mpO",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-27T21:09:22Z",
    "updated_at": "2021-10-27T21:09:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "@K-Ho @ajsantander this is a pretty old issue. Is this still relevant? ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/953313870/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/999038551",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/1041#issuecomment-999038551",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/1041",
    "id": 999038551,
    "node_id": "IC_kwDODjvEJM47jB5X",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-12-21T19:30:06Z",
    "updated_at": "2021-12-21T19:30:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing this out, I assume this is fixed",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/999038551/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
