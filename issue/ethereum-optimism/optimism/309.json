{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/309",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/309/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/309/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/309/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/309",
  "id": 715951852,
  "node_id": "MDU6SXNzdWU3MTU5NTE4NTI=",
  "number": 309,
  "title": "Correcting Fraudulent State Roots Off-Chain",
  "user": {
    "login": "willmeister",
    "id": 1787541,
    "node_id": "MDQ6VXNlcjE3ODc1NDE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1787541?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/willmeister",
    "html_url": "https://github.com/willmeister",
    "followers_url": "https://api.github.com/users/willmeister/followers",
    "following_url": "https://api.github.com/users/willmeister/following{/other_user}",
    "gists_url": "https://api.github.com/users/willmeister/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/willmeister/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/willmeister/subscriptions",
    "organizations_url": "https://api.github.com/users/willmeister/orgs",
    "repos_url": "https://api.github.com/users/willmeister/repos",
    "events_url": "https://api.github.com/users/willmeister/events{/privacy}",
    "received_events_url": "https://api.github.com/users/willmeister/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2020-10-06T19:09:43Z",
  "updated_at": "2021-02-02T00:35:32Z",
  "closed_at": "2021-02-02T00:35:32Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\nRight now the [next_verification_batch view](https://github.com/ethereum-optimism/optimism-monorepo/blob/master/db/scripts/4_create_views.sql#L49) hints at the idea that there will be a `REMOVED` state for `l1_rollup_state_root_batch` entries that follows the `FRAUDULENT` state, after fraud is proven and state roots are removed from the state commitment chain on Ethereum. \r\n\r\nThe code does not currently suggest a way to update this batch to `UNVERIFIED` upon submission of _new_ state roots for the batch in question so that the `next_verification_batch` view will start returning records again and verification may proceed. \r\n\r\nThis is a bug report / feature request / bit of documentation of the fact that there will need to be something that rights the fraudulent batch record so verification may proceed. Without being too prescriptive, one way to do this would be to check for a `REMOVED` batch when [persisting `l1_rollup_state_root` records](https://github.com/ethereum-optimism/optimism-monorepo/blob/master/packages/rollup-core/src/app/data/data-service.ts#L261) and update the batch instead of inserting a new one.\r\n\r\n**Steps to reproduce**\r\nFeatures required to get into this situation have yet to be developed.\r\n\r\n**Expected behavior**\r\n\r\n1. Fraud is committed\r\n1. Fraud is proven\r\n1. State roots are removed from the Ethereum chain\r\n1. State roots & batch are marked as `REMOVED` in the DB on handling of the removed event on-chain\r\n1. Valid state roots are submitted on-chain\r\n1. *Some part of the process persisting the new state roots updates the state root batch to `UNVERIFIED`*\r\n1. Valid (claimed) state roots are verified against computed state roots, and batch is updated to `VERIFIED`\r\n",
  "closed_by": {
    "login": "tynes",
    "id": 6626818,
    "node_id": "MDQ6VXNlcjY2MjY4MTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tynes",
    "html_url": "https://github.com/tynes",
    "followers_url": "https://api.github.com/users/tynes/followers",
    "following_url": "https://api.github.com/users/tynes/following{/other_user}",
    "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
    "organizations_url": "https://api.github.com/users/tynes/orgs",
    "repos_url": "https://api.github.com/users/tynes/repos",
    "events_url": "https://api.github.com/users/tynes/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tynes/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/309/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/309/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
