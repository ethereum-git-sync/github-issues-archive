{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/6232",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/6232/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/6232/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/6232/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/6232",
  "id": 1791228278,
  "node_id": "I_kwDODjvEJM5qw_l2",
  "number": 6232,
  "title": "GetProof and GetStorageAt does not follow EIP-1898 when querying using blockHash",
  "user": {
    "login": "javiersuweijie",
    "id": 3447315,
    "node_id": "MDQ6VXNlcjM0NDczMTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3447315?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/javiersuweijie",
    "html_url": "https://github.com/javiersuweijie",
    "followers_url": "https://api.github.com/users/javiersuweijie/followers",
    "following_url": "https://api.github.com/users/javiersuweijie/following{/other_user}",
    "gists_url": "https://api.github.com/users/javiersuweijie/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/javiersuweijie/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/javiersuweijie/subscriptions",
    "organizations_url": "https://api.github.com/users/javiersuweijie/orgs",
    "repos_url": "https://api.github.com/users/javiersuweijie/repos",
    "events_url": "https://api.github.com/users/javiersuweijie/events{/privacy}",
    "received_events_url": "https://api.github.com/users/javiersuweijie/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-07-06T10:03:16Z",
  "updated_at": "2023-07-27T20:47:46Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!--\r\nNeed help?\r\nRefer to our contributing guidelines for additional information about making a good issue:\r\nhttps://github.com/ethereum-optimism/.github/blob/master/CONTRIBUTING.md\r\n-->\r\n\r\n**Describe the bug**\r\nA clear and concise description of what the bug is.\r\n\r\n[GetProof](https://github.com/ethereum-optimism/optimism/blob/d80c145e0acf23a49c6a6588524f57e32e33b91c/op-node/sources/eth_client.go#L397) and [GetStorageAt](https://github.com/ethereum-optimism/optimism/blob/d80c145e0acf23a49c6a6588524f57e32e33b91c/op-node/sources/eth_client.go#L405) (maybe others as well) does not follow [EIP-1898](https://eips.ethereum.org/EIPS/eip-1898) when querying using blockHash\r\n\r\nCurrently, the two methods calls the L1 RPC with \r\n```\r\n{\r\n    \"jsonrpc\": \"2.0\",\r\n    \"method\": \"eth_getProof\",\r\n    \"params\": [\r\n        \"0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9\",\r\n        [\r\n            \"0x65a7ed542fb37fe237fdfbdd70b31598523fe5b32879e307bae27a0bd9581c08\"\r\n        ],\r\n        \"0xc5d324f4bb9694a438b6b5b5ed374faf5f09c9e7a44ec03aa924163576a34913\"}\r\n    ],\r\n    \"id\": 1\r\n}\r\n\r\n### Response returns this error when the RPC follows EIP-1898 strictly (anvil for example)\r\n{\r\n    \"jsonrpc\": \"2.0\",\r\n    \"id\": 1,\r\n    \"error\": {\r\n        \"code\": -32602,\r\n        \"message\": \"Invalid string length\"\r\n    }\r\n}\r\n```\r\nWhen it should be\r\n```\r\n{\r\n    \"jsonrpc\": \"2.0\",\r\n    \"method\": \"eth_getProof\",\r\n    \"params\": [\r\n        \"0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9\",\r\n        [\r\n            \"0x65a7ed542fb37fe237fdfbdd70b31598523fe5b32879e307bae27a0bd9581c08\"\r\n        ],\r\n        {\"blockHash\": \"0xc5d324f4bb9694a438b6b5b5ed374faf5f09c9e7a44ec03aa924163576a34913\"}\r\n    ],\r\n    \"id\": 1\r\n}\r\n```\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**System Specs:**\r\n - OS:\r\n - Package Version (or commit hash):\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/6232/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/6232/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1654547131",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/6232#issuecomment-1654547131",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/6232",
    "id": 1654547131,
    "node_id": "IC_kwDODjvEJM5inmK7",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-27T20:47:46Z",
    "updated_at": "2023-07-27T20:47:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thank you for opening this PR. If there was some way you could repro an error that would be very helpful because the RPC requests seem to be working fine as is and are running in production",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1654547131/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
