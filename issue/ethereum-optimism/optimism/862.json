{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/862",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/862/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/862/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/862/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/862",
  "id": 890627389,
  "node_id": "MDU6SXNzdWU4OTA2MjczODk=",
  "number": 862,
  "title": "gasUsed in `eth_getTransactionReceipt` should return the cumulative gasUsed",
  "user": {
    "login": "K-Ho",
    "id": 5341583,
    "node_id": "MDQ6VXNlcjUzNDE1ODM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5341583?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/K-Ho",
    "html_url": "https://github.com/K-Ho",
    "followers_url": "https://api.github.com/users/K-Ho/followers",
    "following_url": "https://api.github.com/users/K-Ho/following{/other_user}",
    "gists_url": "https://api.github.com/users/K-Ho/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/K-Ho/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/K-Ho/subscriptions",
    "organizations_url": "https://api.github.com/users/K-Ho/orgs",
    "repos_url": "https://api.github.com/users/K-Ho/repos",
    "events_url": "https://api.github.com/users/K-Ho/events{/privacy}",
    "received_events_url": "https://api.github.com/users/K-Ho/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832490,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNDkw",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bug",
      "name": "C-bug",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: This is a bug."
    },
    {
      "id": 2981541772,
      "node_id": "MDU6TGFiZWwyOTgxNTQxNzcy",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/P-confirmed",
      "name": "P-confirmed",
      "color": "BFD4F2",
      "default": false,
      "description": "A confirmed bug"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-05-13T01:51:01Z",
  "updated_at": "2021-11-04T19:55:42Z",
  "closed_at": "2021-11-04T19:55:41Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!--\r\nNeed help?\r\nRefer to our contributing guidelines for additional information about making a good issue:\r\nhttps://github.com/ethereum-optimism/.github/blob/master/CONTRIBUTING.md\r\n-->\r\n\r\n**Is your feature request related to a problem? Please describe.**\r\nCurrently, when requesting a transaction receipt via `eth_getTransactionReceipt`, the `gasUsed` that we return displays the `gasUsed` from the point that the transaction exits the contract account until the end of execution. So if a transaction consumes 700k gas in the SequencerEntrypoint and the ECDSAContractAccount and runs over the 9m gas limit, then receipt.gasUsed will show 8.3m gas. \r\n\r\nThis has been confusing, because it's unclear how much gas was *actually* consumed by execution. It also makes developers think that their transaction didn't actually run out of gas, when it did because gasUsed will display some number in the low 8m gas, implying that there is still room for more execution\r\n\r\n**Describe the solution you'd like**\r\n* `transactionReceipt.gasUsed` will be the *total* execution gas used including the entrypoint and the ECDSAContractAccount  gas consumed. If I check the gasUsed for this test https://github.com/ethereum-optimism/optimism/issues/761, I should see 9m gasUsed\r\n\r\n\r\n**Additional context**\r\n* We may have to think deeper about how this plays into the idea of a user sending a transaction with an execution gasLimit, and if that gasLimit applies only after the transaction leaves the user's contract account...\r\n* This would have saved a few days of Scopelift's time debugging a failed contract deployment",
  "closed_by": {
    "login": "smartcontracts",
    "id": 14298799,
    "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/smartcontracts",
    "html_url": "https://github.com/smartcontracts",
    "followers_url": "https://api.github.com/users/smartcontracts/followers",
    "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
    "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
    "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
    "repos_url": "https://api.github.com/users/smartcontracts/repos",
    "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
    "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/862/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/862/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/846639917",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/862#issuecomment-846639917",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/862",
    "id": 846639917,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NjYzOTkxNw==",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-23T23:13:46Z",
    "updated_at": "2021-05-23T23:13:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "I do not believe this is an easy problem to solve. The fundamental issue at hand is described here: https://github.com/ethereum-optimism/optimism/issues/874#issuecomment-841685811. In a nutshell, a certain amount of gas is simply inaccessible because of [EIP-150](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-150.md).\r\n\r\nI have two points to make here. First, a recent change to l2geth made it so that contract OOG would be correctly surfaced **as long as you do NOT provide a gas limit** because `eth_estimateGas` will give you the message [\"gas required exceeds allowance\"](https://github.com/ethereum-optimism/optimism/blob/467d6cb6a4a35f2f8c3ea4cfa4babc619bafe7d2/l2geth/internal/ethapi/api.go#L1134). I believe this is *probably* good enough to catch this issue in most cases.\r\n\r\nSecond, I think we only have one reasonable fix to this problem: make the \"user accessible gas limit\" 1-2m gas *lower* than the actual block gas limit. E.g., if the gas limit is 9m then we only allow users to make use of 7-8m. This would \"solve\" the problem by hiding this discrepancy.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/846639917/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/961369901",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/862#issuecomment-961369901",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/862",
    "id": 961369901,
    "node_id": "IC_kwDODjvEJM45TVct",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-04T19:55:41Z",
    "updated_at": "2021-11-04T19:55:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "Fixed in OVM 2.0 (code deleted).",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/961369901/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
