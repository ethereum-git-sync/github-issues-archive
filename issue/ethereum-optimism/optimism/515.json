{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/515",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/515/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/515/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/515/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/515",
  "id": 863106975,
  "node_id": "MDU6SXNzdWU4NjMxMDY5NzU=",
  "number": 515,
  "title": "Account for zero vs non-zero calldata bytes for L2 gas estimation",
  "user": {
    "login": "K-Ho",
    "id": 5341583,
    "node_id": "MDQ6VXNlcjUzNDE1ODM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5341583?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/K-Ho",
    "html_url": "https://github.com/K-Ho",
    "followers_url": "https://api.github.com/users/K-Ho/followers",
    "following_url": "https://api.github.com/users/K-Ho/following{/other_user}",
    "gists_url": "https://api.github.com/users/K-Ho/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/K-Ho/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/K-Ho/subscriptions",
    "organizations_url": "https://api.github.com/users/K-Ho/orgs",
    "repos_url": "https://api.github.com/users/K-Ho/repos",
    "events_url": "https://api.github.com/users/K-Ho/events{/privacy}",
    "received_events_url": "https://api.github.com/users/K-Ho/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832490,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNDkw",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bug",
      "name": "C-bug",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: This is a bug."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-04-20T18:26:36Z",
  "updated_at": "2021-04-21T20:33:27Z",
  "closed_at": "2021-04-21T20:33:27Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!--\r\nNeed help?\r\nRefer to our contributing guidelines for additional information about making a good issue:\r\nhttps://github.com/ethereum-optimism/.github/blob/master/CONTRIBUTING.md\r\n-->\r\n\r\n**Describe the bug**\r\nCurrent Fee estimation logic: https://github.com/ethereum-optimism/optimism/blob/41cfbd166e9a1c52a9caf7782662bcda2cc2dd9f/l2geth/core/rollup_fee.go#L16-L19\r\n\r\nRather than logic being `gasPrice * dataLen + executionPrice * gasUsed`, logic should be:\r\n`gasPrice * (4*zeroDataBytes + 16*nonZeroDataBytes + nonCallDataL1GasOverhead) + executionPrice * gasUsed`\r\n\r\n1. dataPrice is currently the L1 gas price, not the price per byte of data. Non-zero data bytes cost 16 gas and zero data bytes cost 4 gas. We must iterate through the data, count # of zero, non-zero bytes, then calculate the cost.\r\n2. There is currently a non-calldata per tx overhead for batch submission. The naive solution is to have this parameterizable in the config. Ideally we can query the L1 CTC to find a running average of the tx batch size and use that to parameterize this added cost.\r\n\r\nNon calldata cost per tx (Assuming each tx has its own batch context): \r\n\r\n**Batches of 10 txs**:\r\n9145 gas per tx\r\n\r\n**Batches of 50 txs:** \r\n5253 gas per tx\r\n\r\n**Batches of 200 txs:**\r\n2661 gas per tx\r\n",
  "closed_by": {
    "login": "gakonst",
    "id": 17802178,
    "node_id": "MDQ6VXNlcjE3ODAyMTc4",
    "avatar_url": "https://avatars.githubusercontent.com/u/17802178?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gakonst",
    "html_url": "https://github.com/gakonst",
    "followers_url": "https://api.github.com/users/gakonst/followers",
    "following_url": "https://api.github.com/users/gakonst/following{/other_user}",
    "gists_url": "https://api.github.com/users/gakonst/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gakonst/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gakonst/subscriptions",
    "organizations_url": "https://api.github.com/users/gakonst/orgs",
    "repos_url": "https://api.github.com/users/gakonst/repos",
    "events_url": "https://api.github.com/users/gakonst/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gakonst/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/515/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/515/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/823506144",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/515#issuecomment-823506144",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/515",
    "id": 823506144,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyMzUwNjE0NA==",
    "user": {
      "login": "K-Ho",
      "id": 5341583,
      "node_id": "MDQ6VXNlcjUzNDE1ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5341583?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/K-Ho",
      "html_url": "https://github.com/K-Ho",
      "followers_url": "https://api.github.com/users/K-Ho/followers",
      "following_url": "https://api.github.com/users/K-Ho/following{/other_user}",
      "gists_url": "https://api.github.com/users/K-Ho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/K-Ho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/K-Ho/subscriptions",
      "organizations_url": "https://api.github.com/users/K-Ho/orgs",
      "repos_url": "https://api.github.com/users/K-Ho/repos",
      "events_url": "https://api.github.com/users/K-Ho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/K-Ho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-20T18:28:08Z",
    "updated_at": "2021-04-20T18:28:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "@gakonst thoughts?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/823506144/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/824079609",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/515#issuecomment-824079609",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/515",
    "id": 824079609,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNDA3OTYwOQ==",
    "user": {
      "login": "gakonst",
      "id": 17802178,
      "node_id": "MDQ6VXNlcjE3ODAyMTc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17802178?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gakonst",
      "html_url": "https://github.com/gakonst",
      "followers_url": "https://api.github.com/users/gakonst/followers",
      "following_url": "https://api.github.com/users/gakonst/following{/other_user}",
      "gists_url": "https://api.github.com/users/gakonst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gakonst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gakonst/subscriptions",
      "organizations_url": "https://api.github.com/users/gakonst/orgs",
      "repos_url": "https://api.github.com/users/gakonst/repos",
      "events_url": "https://api.github.com/users/gakonst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gakonst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-21T13:53:28Z",
    "updated_at": "2021-04-21T13:53:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "Regarding the zero/non-zero bytes, agreed. \r\n\r\nThe `nonCallDataL1GasOverhead` seems harder to properly price since the overhead varies depending on the number of transactions batched, and we cannot know that when the user submits their transaction?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/824079609/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/824303189",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/515#issuecomment-824303189",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/515",
    "id": 824303189,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNDMwMzE4OQ==",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-21T19:29:40Z",
    "updated_at": "2021-04-21T19:29:40Z",
    "author_association": "CONTRIBUTOR",
    "body": "Perhaps we have a target batch size and assume that? Ideally the `nonCallDataL1GasOverhead` is configurable at runtime or potentially via IPC. This is related to https://github.com/ethereum-optimism/optimism/issues/528, we need a longer term and more scalable way of doing fees.\r\n\r\nI thought it would be interesting to put some of the information about fees in the state (L1 or L2), assuming that its ok to require that the user has a fully synced node before sending transactions, but I think thats a fine assumption to make in the Ethereum ecosystem. Then users wouldn't need to call out to a centralized place for fee estimation. Perhaps the `BASEFEE` opcode would be useful",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/824303189/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
