{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/759",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/759/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/759/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/759/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/759",
  "id": 875967131,
  "node_id": "MDU6SXNzdWU4NzU5NjcxMzE=",
  "number": 759,
  "title": "Cached Safety Checking",
  "user": {
    "login": "maurelian",
    "id": 23033765,
    "node_id": "MDQ6VXNlcjIzMDMzNzY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/23033765?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/maurelian",
    "html_url": "https://github.com/maurelian",
    "followers_url": "https://api.github.com/users/maurelian/followers",
    "following_url": "https://api.github.com/users/maurelian/following{/other_user}",
    "gists_url": "https://api.github.com/users/maurelian/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/maurelian/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/maurelian/subscriptions",
    "organizations_url": "https://api.github.com/users/maurelian/orgs",
    "repos_url": "https://api.github.com/users/maurelian/repos",
    "events_url": "https://api.github.com/users/maurelian/events{/privacy}",
    "received_events_url": "https://api.github.com/users/maurelian/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832555,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNTU1",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-feature-request",
      "name": "C-feature-request",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: A feature request."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-05-05T01:28:00Z",
  "updated_at": "2021-10-10T23:13:51Z",
  "closed_at": "2021-10-10T23:13:51Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "# Context\r\n\r\nWe can increase gas efficiency on L2 by adding a new method to the safetychecker, which will not re-check contract code that is perfectly identical to code already that has already been checked. \r\n\r\n## Security considerations\r\n\r\n- Of course this must not introduce any vulnerabilities that would allow unsafe code to bypass the expensify checking codepath.\r\n  - Changes to the `OVM_SafetyChecker` should be kept to a minimum. \r\n- Some thought might be required wrt access control. Should any accounts aside from the Safety Checker be allowed to register new code?\r\n\r\n## Efficiency considerations\r\n\r\n- In a situation where far more unique contracts are deployed than repeated contracts, it might be that in aggregate more gas is spent on CALLs to the registry, and SLOADs from the cache, only to return false. Something to think about, and calls to `isRegisteredSafeBytecode()` should be placed judiciously for the sake of efficiency.\r\n\r\n## Specification\r\n\r\n1. There is a new singleton contract (possibly a predeploy), with the following interface:\r\n\r\n```\r\n/** @notice Used to record the hash of a newly safety checked bytecode string\r\n* Only callable by the Safety Checker.\r\n* @param codehash A bytes32 hash of the code\r\n*/\r\nfunction registerSafeBytecode(bytes32 codehash) external\r\n\r\n/** Used to check if bytecode has already been recorded as safe.\r\n* @param codehash A bytes32 hash of the code\r\n*/\r\nfunction isRegisteredSafeBytecode(bytes32 codehash) external returns (bool)\r\n```\r\n\r\n2. The EM is updated to call the SafetyCache rather than SafetyCacher.\r\n3. The deploy script is updated.\r\n4. Tests are written to handle a reused contract.\r\n\r\n\r\n## This Is Done When\r\n\r\nThe spec is satisfied.",
  "closed_by": {
    "login": "maurelian",
    "id": 23033765,
    "node_id": "MDQ6VXNlcjIzMDMzNzY1",
    "avatar_url": "https://avatars.githubusercontent.com/u/23033765?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/maurelian",
    "html_url": "https://github.com/maurelian",
    "followers_url": "https://api.github.com/users/maurelian/followers",
    "following_url": "https://api.github.com/users/maurelian/following{/other_user}",
    "gists_url": "https://api.github.com/users/maurelian/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/maurelian/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/maurelian/subscriptions",
    "organizations_url": "https://api.github.com/users/maurelian/orgs",
    "repos_url": "https://api.github.com/users/maurelian/repos",
    "events_url": "https://api.github.com/users/maurelian/events{/privacy}",
    "received_events_url": "https://api.github.com/users/maurelian/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/759/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/759/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/861752359",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/759#issuecomment-861752359",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/759",
    "id": 861752359,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MTc1MjM1OQ==",
    "user": {
      "login": "maurelian",
      "id": 23033765,
      "node_id": "MDQ6VXNlcjIzMDMzNzY1",
      "avatar_url": "https://avatars.githubusercontent.com/u/23033765?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/maurelian",
      "html_url": "https://github.com/maurelian",
      "followers_url": "https://api.github.com/users/maurelian/followers",
      "following_url": "https://api.github.com/users/maurelian/following{/other_user}",
      "gists_url": "https://api.github.com/users/maurelian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/maurelian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/maurelian/subscriptions",
      "organizations_url": "https://api.github.com/users/maurelian/orgs",
      "repos_url": "https://api.github.com/users/maurelian/repos",
      "events_url": "https://api.github.com/users/maurelian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/maurelian/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-15T18:54:36Z",
    "updated_at": "2021-06-15T18:54:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "WIP at #900 ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/861752359/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
