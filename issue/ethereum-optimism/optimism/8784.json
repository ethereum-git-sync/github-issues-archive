{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8784",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8784/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8784/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8784/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/8784",
  "id": 2058998632,
  "node_id": "I_kwDODjvEJM56udNo",
  "number": 8784,
  "title": "`StateScheme=path` Data is damaged after the node is killed",
  "user": {
    "login": "rayn316",
    "id": 24621599,
    "node_id": "MDQ6VXNlcjI0NjIxNTk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/24621599?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rayn316",
    "html_url": "https://github.com/rayn316",
    "followers_url": "https://api.github.com/users/rayn316/followers",
    "following_url": "https://api.github.com/users/rayn316/following{/other_user}",
    "gists_url": "https://api.github.com/users/rayn316/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rayn316/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rayn316/subscriptions",
    "organizations_url": "https://api.github.com/users/rayn316/orgs",
    "repos_url": "https://api.github.com/users/rayn316/repos",
    "events_url": "https://api.github.com/users/rayn316/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rayn316/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2023-12-29T02:10:01Z",
  "updated_at": "2023-12-29T02:10:01Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\nAfter the node is killed, it cannot be used after restarting the node.\r\n\r\n**System Specs:**\r\n  - OS: Linux\r\n\r\n**Additional context**\r\n```\r\nDec 29 10:07:06 base-geth[1946932]: INFO [12-29|10:07:06.896] Imported new potential chain segment     number=4,008,751 hash=4d4a67..9f579b blocks=1 txs=3 mgas=0.094 elapsed=1.373ms     mgasps=68.081   age=8h17m16s  snapdiffs=1.44MiB    triediffs=1.25MiB triedirty=36.12MiB\r\nDec 29 10:07:06 base-geth[1946932]: INFO [12-29|10:07:06.897] Chain head was updated                   number=4,008,751 hash=4d4a67..9f579b root=d30f24..7d22b3 elapsed=\"222.868µs\" age=8h17m16s\r\nDec 29 10:07:07 systemd[1]: base-sepolia.service: Main process exited, code=killed, status=9/KILL\r\nDec 29 10:07:07 systemd[1]: base-sepolia.service: Failed with result 'signal'.\r\nDec 29 10:07:07 systemd[1]: base-sepolia.service: Consumed 1min 25.159s CPU time.\r\nDec 29 10:07:12 systemd[1]: base-sepolia.service: Scheduled restart job, restart counter is at 1.\r\nDec 29 10:07:12 systemd[1]: Stopped daemon.\r\nDec 29 10:07:12 systemd[1]: base-sepolia.service: Consumed 1min 25.159s CPU time.\r\nDec 29 10:07:12 systemd[1]: Started daemon.\r\nDec 29 10:07:12 base-geth[1950914]: INFO [12-29|10:07:12.285] Starting geth on an OP network...        network=base-sepolia\r\nDec 29 10:07:12 base-geth[1950914]: INFO [12-29|10:07:12.285] Bumping default cache on mainnet         provided=1024 updated=4096\r\nDec 29 10:07:12 base-geth[1950914]: INFO [12-29|10:07:12.286] Maximum peer count                       ETH=0 LES=0 total=0\r\nDec 29 10:07:12 base-geth[1950914]: INFO [12-29|10:07:12.287] Smartcard socket not found, disabling    err=\"stat /run/pcscd/pcscd.comm: no such file or directory\"\r\nDec 29 10:07:12 base-geth[1950914]: INFO [12-29|10:07:12.291] Set global gas cap                       cap=600,000,000\r\nDec 29 10:07:12 base-geth[1950914]: INFO [12-29|10:07:12.477] Initializing the KZG library             backend=gokzg\r\nDec 29 10:07:12 base-geth[1950914]: INFO [12-29|10:07:12.495] Allocated trie memory caches             clean=614.00MiB dirty=1024.00MiB\r\nDec 29 10:07:12 base-geth[1950914]: INFO [12-29|10:07:12.495] Using pebble as the backing database\r\nDec 29 10:07:12 base-geth[1950914]: INFO [12-29|10:07:12.496] Allocated cache and file handles         database=/node/full/base-sepolia/geth/geth/chaindata cache=2.00GiB handles=100,000\r\nDec 29 10:07:12 base-geth[1950914]: INFO [12-29|10:07:12.558] Opened ancient database                  database=/node/full/base-sepolia/geth/geth/chaindata/ancient/chain readonly=false\r\nDec 29 10:07:12 base-geth[1950914]: INFO [12-29|10:07:12.560] State scheme set by user                 scheme=path\r\nDec 29 10:07:12 base-geth[1950914]: WARN [12-29|10:07:12.619] Sanitizing invalid node buffer size      provided=1024.00MiB updated=256.00MiB\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.768] Opened ancient database                  database=/node/full/base-sepolia/geth/geth/chaindata/ancient/state readonly=false\r\nDec 29 10:07:13 base-geth[1950914]: WARN [12-29|10:07:13.769] Truncating freezer table                 database=/node/full/base-sepolia/geth/geth/chaindata/ancient/state table=storage.index items=4,008,624 limit=4,005,901\r\nDec 29 10:07:13 base-geth[1950914]: WARN [12-29|10:07:13.769] Truncating freezer table                 database=/node/full/base-sepolia/geth/geth/chaindata/ancient/state table=account.data  items=4,008,624 limit=4,005,901\r\nDec 29 10:07:13 base-geth[1950914]: WARN [12-29|10:07:13.769] Truncating freezer table                 database=/node/full/base-sepolia/geth/geth/chaindata/ancient/state table=storage.data  items=4,008,624 limit=4,005,901\r\nDec 29 10:07:13 base-geth[1950914]: WARN [12-29|10:07:13.769] Truncating freezer table                 database=/node/full/base-sepolia/geth/geth/chaindata/ancient/state table=history.meta  items=4,008,624 limit=4,005,901\r\nDec 29 10:07:13 base-geth[1950914]: WARN [12-29|10:07:13.769] Truncating freezer table                 database=/node/full/base-sepolia/geth/geth/chaindata/ancient/state table=account.index items=4,008,624 limit=4,005,901\r\nDec 29 10:07:13 base-geth[1950914]: WARN [12-29|10:07:13.769] Truncated extra state histories          number=2723\r\nDec 29 10:07:13 base-geth[1950914]: WARN [12-29|10:07:13.769] Path-based state scheme is an experimental feature\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828] ---------------------------------------------------------------------------------------------------------------------------------------------------------\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828] Chain ID:  84532 (Base Sepolia)\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828] Consensus: Optimism\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828] Pre-Merge hard forks (block based):\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Homestead:                   #0        (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/homestead.md)\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Tangerine Whistle (EIP 150): #0        (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/tangerine-whistle.md)\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Spurious Dragon/1 (EIP 155): #0        (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/spurious-dragon.md)\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Spurious Dragon/2 (EIP 158): #0        (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/spurious-dragon.md)\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Byzantium:                   #0        (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/byzantium.md)\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Constantinople:              #0        (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/constantinople.md)\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Petersburg:                  #0        (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/petersburg.md)\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Istanbul:                    #0        (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/istanbul.md)\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Muir Glacier:                #0        (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/muir-glacier.md)\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Berlin:                      #0        (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/berlin.md)\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - London:                      #0        (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/london.md)\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Arrow Glacier:               #0        (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/arrow-glacier.md)\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Gray Glacier:                #0        (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/gray-glacier.md)\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828] Merge configured:\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Hard-fork specification:    https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/paris.md\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Network known to be merged: true\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Total terminal difficulty:  0\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Merge netsplit block:       #0\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828] Post-Merge hard forks (timestamp based):\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Shanghai:                    @1699981200 (https://github.com/ethereum/execution-specs/blob/master/network-upgrades/mainnet-upgrades/shanghai.md)\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Regolith:                    @0\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]  - Canyon:                      @1699981200\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828] ---------------------------------------------------------------------------------------------------------------------------------------------------------\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.828]\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.829] Loaded most recent local block           number=4,008,751 hash=4d4a67..9f579b td=0 age=8h17m23s\r\nDec 29 10:07:13 base-geth[1950914]: INFO [12-29|10:07:13.829] Loaded most recent local finalized block number=4,005,108 hash=a3130f..a845a2 td=0 age=10h18m49s\r\nDec 29 10:07:13 base-geth[1950914]: WARN [12-29|10:07:13.889] Head state missing, repairing            number=4,008,751 hash=4d4a67..9f579b snaproot=9660a9..b62dff\r\nDec 29 10:07:14 base-geth[1950914]: WARN [12-29|10:07:14.854] Truncating freezer table                 database=/node/full/base-sepolia/geth/geth/chaindata/ancient/state table=account.index items=4,005,901 limit=4,004,441\r\nDec 29 10:07:14 base-geth[1950914]: WARN [12-29|10:07:14.854] Truncating freezer table                 database=/node/full/base-sepolia/geth/geth/chaindata/ancient/state table=storage.index items=4,005,901 limit=4,004,441\r\nDec 29 10:07:14 base-geth[1950914]: WARN [12-29|10:07:14.854] Truncating freezer table                 database=/node/full/base-sepolia/geth/geth/chaindata/ancient/state table=account.data  items=4,005,901 limit=4,004,441\r\nDec 29 10:07:14 base-geth[1950914]: WARN [12-29|10:07:14.854] Truncating freezer table                 database=/node/full/base-sepolia/geth/geth/chaindata/ancient/state table=storage.data  items=4,005,901 limit=4,004,441\r\nDec 29 10:07:14 base-geth[1950914]: WARN [12-29|10:07:14.854] Truncating freezer table                 database=/node/full/base-sepolia/geth/geth/chaindata/ancient/state table=history.meta  items=4,005,901 limit=4,004,441\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.855] Loaded most recent local header          number=4,008,751 hash=4d4a67..9f579b td=0 age=8h17m24s\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.855] Loaded most recent local block           number=4,004,440 hash=6ecb70..53e835 td=0 age=10h41m6s\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.855] Loaded most recent local snap block      number=4,008,751 hash=4d4a67..9f579b td=0 age=8h17m24s\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.855] Loaded most recent local finalized block number=4,005,108 hash=a3130f..a845a2 td=0 age=10h18m50s\r\nDec 29 10:07:14 base-geth[1950914]: WARN [12-29|10:07:14.855] Enabling snapshot recovery               chainhead=4,004,440 diskbase=4,004,440\r\nDec 29 10:07:14 base-geth[1950914]: WARN [12-29|10:07:14.936] Snapshot is not continuous with chain    snaproot=65bfec..2b07fd chainroot=9660a9..b62dff\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.936] Initialising Ethereum protocol           network=84532        dbversion=8\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.936] Initialized transaction indexer          limit=0\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.936] Loaded local transaction journal         transactions=0 dropped=0\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.937] Regenerated local transaction journal    transactions=0 accounts=0\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.952] Chain post-merge, sync via beacon client\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.952] Gasprice oracle is ignoring threshold set threshold=2\r\nDec 29 10:07:14 base-geth[1950914]: WARN [12-29|10:07:14.952] Unclean shutdown detected                booted=2023-12-29T10:04:18+0800 age=2m56s\r\nDec 29 10:07:14 base-geth[1950914]: WARN [12-29|10:07:14.953] Engine API enabled                       protocol=eth\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.953] Starting peer-to-peer node               instance=Geth/v0.1.0-unstable-c6b416da/linux-amd64/go1.20.11\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.958] IPC endpoint opened                      url=/node/full/base-sepolia/geth/geth.ipc\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.959] Loaded JWT secret file                   path=/node/full/base-sepolia/jwt.txt crc32=0x8cdf983\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.959] New local node record                    seq=1,703,578,546,179 id=1630514fc58df63b ip=127.0.0.1 udp=0 tcp=31720\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.959] HTTP server started                      endpoint=[::]:31721 auth=false prefix= cors=* vhosts=*\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.959] WebSocket enabled                        url=ws://[::]:31722\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.959] WebSocket enabled                        url=ws://127.0.0.1:31723\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.959] Started P2P networking                   self=\"enode://1fbff8f0399d7880fd61cdc094c39e7f8a90acbcfb8a23c4d87a0155c4a99a2adfdaff2441805a902c1bd7e72de1005adc2f2400b9e1f9363d594fcf7fb35747@127.0.0.1:31720?discport=0\"\r\nDec 29 10:07:14 base-geth[1950914]: INFO [12-29|10:07:14.959] HTTP server started                      endpoint=127.0.0.1:31723 auth=true  prefix= cors=localhost vhosts=*\r\nDec 29 10:07:21 base-geth[1950914]: ERROR[12-29|10:07:21.739] Failed to create sealing context         err=\"missing trie node d30f24fb69c40b838f42f942c62777a694067de94ff8b022eb8e72f9a07d22b3 (path ) state 0xd30f24fb69c40b838f42f942c62777a694067de94ff8b022eb8e72f9a07d22b3 is not available\"\r\nDec 29 10:07:21 base-geth[1950914]: ERROR[12-29|10:07:21.739] Failed to build payload                  err=\"missing trie node d30f24fb69c40b838f42f942c62777a694067de94ff8b022eb8e72f9a07d22b3 (path ) state 0xd30f24fb69c40b838f42f942c62777a694067de94ff8b022eb8e72f9a07d22b3 is not available\"\r\nDec 29 10:07:21 base-geth[1950914]: WARN [12-29|10:07:21.739] Served engine_forkchoiceUpdatedV2        reqid=17590 duration=\"412.974µs\" err=\"Invalid payload attributes\" errdata=\"{Error:missing trie node d30f24fb69c40b838f42f942c62777a694067de94ff8b022eb8e72f9a07d22b3 (path ) state 0xd30f24fb69c40b838f42f942c62777a694067de94ff8b022eb8e72f9a07d22b3 is not available}\"\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8784/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8784/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[

]
