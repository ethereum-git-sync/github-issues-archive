{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/528",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/528/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/528/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/528/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/528",
  "id": 863354377,
  "node_id": "MDU6SXNzdWU4NjMzNTQzNzc=",
  "number": 528,
  "title": "Replicas do not have a way to get the execution gas price from sequencers",
  "user": {
    "login": "tynes",
    "id": 6626818,
    "node_id": "MDQ6VXNlcjY2MjY4MTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tynes",
    "html_url": "https://github.com/tynes",
    "followers_url": "https://api.github.com/users/tynes/followers",
    "following_url": "https://api.github.com/users/tynes/following{/other_user}",
    "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
    "organizations_url": "https://api.github.com/users/tynes/orgs",
    "repos_url": "https://api.github.com/users/tynes/repos",
    "events_url": "https://api.github.com/users/tynes/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tynes/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832518,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNTE4",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-enhancement",
      "name": "C-enhancement",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: A PR with an enhancement or bugfix."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-04-21T00:54:26Z",
  "updated_at": "2021-06-17T17:14:44Z",
  "closed_at": "2021-06-17T17:14:44Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!--\r\nNeed help?\r\nRefer to our contributing guidelines for additional information about making a good issue:\r\nhttps://github.com/ethereum-optimism/.github/blob/master/CONTRIBUTING.md\r\n-->\r\n\r\nThe sequencer is ultimately in control of choosing what the fees are. Right now (https://github.com/ethereum-optimism/optimism/pull/519), replicas compute client side what the fee is using the same algorithm as the sequencer. This is not scalable long term as the replicas are unaware of the congestion. A possible work around would be to put information about the congestion into the state. Another solution would be to have all replicas query out to the sequencer, but this is not scalable for the sequencer as it could ddos the node. The proposed solution involves having a single source of truth that lives outside of geth and the replicas that is referenced for the fees.\r\n\r\n---\r\n\r\nFrom https://github.com/ethereum-optimism/optimism/pull/557\r\n\r\n\r\nAfter some brainstorming about setting the ExecutionPrice longer term, if it is set via IPC then the problem is that it will also need to be set via IPC for all replicas/verifiers at the same time. This is a large coordination problem that adds a lot of overhead, basically if we want to up the fee then we will need to have everybody reconfigure their nodes. Longer term the ExecutionPrice could live in the L2 state. The value could be updated behind an onlySequener modifier and the Sequencer RPC would reject transactions that do not pay a large enough fee. A problem with this approach is that verifiers that listen to L1 will have a lag in updates to the value since they will not see the updates until the transactions are batch submitted. This problem could be mitigated by only allowing fee changes every so many blocks and allowing it to only change by deterministic amounts, but that adds complexity and the problem space should be explored in greater depth. Verifiers will always be at a disadvantage compared to replicas, since replicas sync from the sequencer but there is risk involved since that data isn't technically the source of truth. A malicious sequencer may lie.\r\n\r\nShort term we do not need this value to be pulled from the L2 state but we definitely would like it to be pulled from the L2 state before the Uniswap v3 launch. We would be able send transactions to the sequencer that updates the ExecutionPrice from a multisig to make sure the system does not get overwhelmed\r\n\r\n\r\n",
  "closed_by": {
    "login": "smartcontracts",
    "id": 14298799,
    "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/smartcontracts",
    "html_url": "https://github.com/smartcontracts",
    "followers_url": "https://api.github.com/users/smartcontracts/followers",
    "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
    "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
    "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
    "repos_url": "https://api.github.com/users/smartcontracts/repos",
    "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
    "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/528/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/528/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/825159155",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/528#issuecomment-825159155",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/528",
    "id": 825159155,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNTE1OTE1NQ==",
    "user": {
      "login": "K-Ho",
      "id": 5341583,
      "node_id": "MDQ6VXNlcjUzNDE1ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5341583?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/K-Ho",
      "html_url": "https://github.com/K-Ho",
      "followers_url": "https://api.github.com/users/K-Ho/followers",
      "following_url": "https://api.github.com/users/K-Ho/following{/other_user}",
      "gists_url": "https://api.github.com/users/K-Ho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/K-Ho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/K-Ho/subscriptions",
      "organizations_url": "https://api.github.com/users/K-Ho/orgs",
      "repos_url": "https://api.github.com/users/K-Ho/repos",
      "events_url": "https://api.github.com/users/K-Ho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/K-Ho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-22T20:22:05Z",
    "updated_at": "2021-04-22T20:22:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "https://github.com/ethereum-optimism/optimism/issues/536#issuecomment-824439462\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/825159155/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/825161009",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/528#issuecomment-825161009",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/528",
    "id": 825161009,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNTE2MTAwOQ==",
    "user": {
      "login": "K-Ho",
      "id": 5341583,
      "node_id": "MDQ6VXNlcjUzNDE1ODM=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5341583?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/K-Ho",
      "html_url": "https://github.com/K-Ho",
      "followers_url": "https://api.github.com/users/K-Ho/followers",
      "following_url": "https://api.github.com/users/K-Ho/following{/other_user}",
      "gists_url": "https://api.github.com/users/K-Ho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/K-Ho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/K-Ho/subscriptions",
      "organizations_url": "https://api.github.com/users/K-Ho/orgs",
      "repos_url": "https://api.github.com/users/K-Ho/repos",
      "events_url": "https://api.github.com/users/K-Ho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/K-Ho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-22T20:25:08Z",
    "updated_at": "2021-04-22T20:25:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "Another concern: Data price for replicas and the sequencer will be queried from different sources (e.g. maybe infura vs. alchemy vs. hosted geth node) This could cause the replica to quote a dataPrice of 100 gwei, whereas the sequencer would have quoted a dataPrice of 150 gwei\r\n\r\nOne potential solution is that replica DTLs query the dataprice (and executionPrice?) from the sequencer and then replica geth nodes set their execution and data price via their replica DTL",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/825161009/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/825347339",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/528#issuecomment-825347339",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/528",
    "id": 825347339,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNTM0NzMzOQ==",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-23T02:46:15Z",
    "updated_at": "2021-04-23T02:46:15Z",
    "author_association": "CONTRIBUTOR",
    "body": ">  Data price for replicas and the sequencer will be queried from different sources (e.g. maybe infura vs. alchemy vs. hosted geth node)\r\n\r\nI don't think this is that large of a problem. EIP 1559 will help a lot with this. This can be ran experimentally by calling `eth_gasPrice` on Alchemy and Infura and seeing how much they differ over time.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/825347339/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/826289806",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/528#issuecomment-826289806",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/528",
    "id": 826289806,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgyNjI4OTgwNg==",
    "user": {
      "login": "gakonst",
      "id": 17802178,
      "node_id": "MDQ6VXNlcjE3ODAyMTc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17802178?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gakonst",
      "html_url": "https://github.com/gakonst",
      "followers_url": "https://api.github.com/users/gakonst/followers",
      "following_url": "https://api.github.com/users/gakonst/following{/other_user}",
      "gists_url": "https://api.github.com/users/gakonst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gakonst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gakonst/subscriptions",
      "organizations_url": "https://api.github.com/users/gakonst/orgs",
      "repos_url": "https://api.github.com/users/gakonst/repos",
      "events_url": "https://api.github.com/users/gakonst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gakonst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-25T09:21:05Z",
    "updated_at": "2021-04-25T09:23:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "The smart contract based solution sounds good to me. The solution would be a smart contract which stores execution/data price. This solves the data replication problem across nodes.\r\n\r\n2 implementation details:\r\n* The values would be cached in memory inside the [Rollup Gas Price Oracle](https://github.com/ethereum-optimism/optimism/pull/557/files#diff-bf2b57a55e3aabb41faf917b14824d4e72f3470d3f711a1c8e94d7ec1dfcf136R13)\r\n* The values would be updated once every some time interval via the sync service. \r\n\r\nThis saves us from doing a state read on every call, which would have been suboptimal.\r\n\r\nAs for permissioning that smart contract:\r\n* Short term, having a static EOA/multisig control the the values sounds good to me\r\n* Long term, taking into account a multi-sequencer system, we'd want the currently elected sequencer to be the party that can set these values.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/826289806/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/861064982",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/528#issuecomment-861064982",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/528",
    "id": 861064982,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MTA2NDk4Mg==",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-14T23:50:29Z",
    "updated_at": "2021-06-14T23:50:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "@tynes is this fixed now with the introduction of `OVM_GasPriceOracle`?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/861064982/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/863416243",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/528#issuecomment-863416243",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/528",
    "id": 863416243,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MzQxNjI0Mw==",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-17T17:13:29Z",
    "updated_at": "2021-06-17T17:13:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing after convo with @tynes, should be fixed because of `OVM_GasPriceOracle`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/863416243/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
