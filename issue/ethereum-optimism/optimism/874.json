{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/874",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/874/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/874/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/874/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/874",
  "id": 891680966,
  "node_id": "MDU6SXNzdWU4OTE2ODA5NjY=",
  "number": 874,
  "title": "Transaction block limit issue",
  "user": {
    "login": "leckylao",
    "id": 148800,
    "node_id": "MDQ6VXNlcjE0ODgwMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/148800?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/leckylao",
    "html_url": "https://github.com/leckylao",
    "followers_url": "https://api.github.com/users/leckylao/followers",
    "following_url": "https://api.github.com/users/leckylao/following{/other_user}",
    "gists_url": "https://api.github.com/users/leckylao/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/leckylao/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leckylao/subscriptions",
    "organizations_url": "https://api.github.com/users/leckylao/orgs",
    "repos_url": "https://api.github.com/users/leckylao/repos",
    "events_url": "https://api.github.com/users/leckylao/events{/privacy}",
    "received_events_url": "https://api.github.com/users/leckylao/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832490,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNDkw",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bug",
      "name": "C-bug",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: This is a bug."
    },
    {
      "id": 2981541772,
      "node_id": "MDU6TGFiZWwyOTgxNTQxNzcy",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/P-confirmed",
      "name": "P-confirmed",
      "color": "BFD4F2",
      "default": false,
      "description": "A confirmed bug"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 8,
  "created_at": "2021-05-14T07:16:51Z",
  "updated_at": "2021-05-15T16:25:17Z",
  "closed_at": "2021-05-15T16:25:17Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "https://github.com/leckylao/op-demo/issues\r\n\r\n**Describe the bug**\r\nThis demo is to showcase two issues on Kovan OVM.\r\n1. The current block limit on Kovan OVM is 9m. The `testPass` transaction would work with 60 times transfer for 7.1m gas. But the `testFail` transaction would fail with 70 times transfer for 7.8m gas, which still under 9m that should pass.\r\n2. In general it would cost more gas for the same transaction in OVM than EVM and i'm wondering when/if this will become cheaper? (future versions?) and if the block limit will increase?\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n## Set up\r\n\r\n- `npm install`\r\n\r\n- `npx hardhat compile`\r\n\r\n- `cp .env.example .env` - put the private key in .env in order to run the test\r\n\r\n## Unit test\r\n\r\n`npx hardhat test test/StupidTest.js --network hardhat`\r\n\r\n    ✓ should transfer 60 times successfully (15985ms)\r\n    ✓ should transfer 70 times successfully (30271ms)\r\n\r\n```\r\n·------------------------|---------------------------|-------------|----------------------------·\r\n|  Solc version: 0.6.12  ·  Optimizer enabled: true  ·  Runs: 200  ·  Block limit: 9500000 gas  │\r\n·························|···························|·············|·····························\r\n|  Methods                                                                                      │\r\n··············|··········|·············|·············|·············|·············|···············\r\n|  Contract   ·  Method  ·  Min        ·  Max        ·  Avg        ·  # calls    ·  usd (avg)   │\r\n·-------------|----------|-------------|-------------|-------------|-------------|--------------·\r\n```\r\n  2 passing (1m)\r\n\r\n## Integration test\r\n\r\nYou could look at the explorer and see the `testFail` got reverted with 7.8m gas.\r\nhttps://kovan-l2-explorer.surge.sh/tx/0xbdc3f63674e704c20a03fddfe3b78dd7112a75880f6f8a1f91f573e9374c51c4\r\n\r\n`npx hardhat test test/StupidTest.js`\r\n\r\ntestPass tx:  0xd9890d4d5a2a329ff3ff394cb2a5b54cb0d6eb3d80bf327286ff729805a03ec1\r\n    ✓ should transfer 60 times successfully (7342ms, 8650761 gas)\r\ntestFail tx:  0xbdc3f63674e704c20a03fddfe3b78dd7112a75880f6f8a1f91f573e9374c51c4\r\n\r\n    1) should transfer 70 times successfully\r\n```\r\n·---------------------------|---------------------------|-------------|----------------------------·\r\n|   Solc version: 0.6.12    ·  Optimizer enabled: true  ·  Runs: 200  ·  Block limit: 6718946 gas  │\r\n····························|···························|·············|·····························\r\n|  Methods                                                                                         │\r\n···············|············|·············|·············|·············|·············|···············\r\n|  Contract    ·  Method    ·  Min        ·  Max        ·  Avg        ·  # calls    ·  usd (avg)   │\r\n···············|············|·············|·············|·············|·············|···············\r\n|  StupidTest  ·  testPass  ·          -  ·          -  ·    7146058  ·          1  ·           -  │\r\n·--------------|------------|-------------|-------------|-------------|-------------|--------------·\r\n```\r\n\r\n  1 passing (1m)\r\n  1 failing\r\n\r\n  1) StupidTest\r\n       should transfer 70 times successfully:\r\n\r\n      AssertionError: expected '99999999400000000000' to equal '99999998700000000000'\r\n      + expected - actual\r\n\r\n      -99999999400000000000\r\n      +99999998700000000000\r\n\r\n      at Context.<anonymous> (test/StupidTest.js:75:39)\r\n      at processTicksAndRejections (internal/process/task_queues.js:93:5)\r\n\r\n**Expected behavior**\r\ntest should pass\r\n\r\n**System Specs:**\r\n - OS: MacOS V10.14.6\r\n - Package Version (or commit hash): latest\r\n\r\n**Additional context**\r\nMore details on https://github.com/leckylao/op-demo",
  "closed_by": {
    "login": "leckylao",
    "id": 148800,
    "node_id": "MDQ6VXNlcjE0ODgwMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/148800?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/leckylao",
    "html_url": "https://github.com/leckylao",
    "followers_url": "https://api.github.com/users/leckylao/followers",
    "following_url": "https://api.github.com/users/leckylao/following{/other_user}",
    "gists_url": "https://api.github.com/users/leckylao/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/leckylao/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/leckylao/subscriptions",
    "organizations_url": "https://api.github.com/users/leckylao/orgs",
    "repos_url": "https://api.github.com/users/leckylao/repos",
    "events_url": "https://api.github.com/users/leckylao/events{/privacy}",
    "received_events_url": "https://api.github.com/users/leckylao/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/874/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 1
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/874/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/841329865",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/874#issuecomment-841329865",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/874",
    "id": 841329865,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MTMyOTg2NQ==",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-14T15:50:24Z",
    "updated_at": "2021-05-14T15:50:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for this report :-) I've been looking for a repro case for this, so this is great. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/841329865/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/841343232",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/874#issuecomment-841343232",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/874",
    "id": 841343232,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MTM0MzIzMg==",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-14T16:12:49Z",
    "updated_at": "2021-05-14T16:12:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "Confirmed. I know the underlying issue and am ruminating on a fix.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/841343232/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/841685811",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/874#issuecomment-841685811",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/874",
    "id": 841685811,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MTY4NTgxMQ==",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-15T16:10:20Z",
    "updated_at": "2021-05-15T16:20:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok so for posterity, here's the exact issue at hand:\r\n\r\nAlthough the block limit is 9m gas, the amount of gas actually available for execution is somewhat *less* than 9m (at least in the way the system is currently designed). Here's the exact reason why this is the case:\r\n1. Transaction execution always starts with [`OVM_ExecutionManager.run`](https://github.com/ethereum-optimism/optimism/blob/5b7e13c671c97892566e824499bf823108cccdde/packages/contracts/contracts/optimistic-ethereum/OVM/execution/OVM_ExecutionManager.sol#L159). This is the \"entrypoint\" to the Optimistic Ethereum system. It's responsible for doing some setup, including calling [`_initContext`](https://github.com/ethereum-optimism/optimism/blob/5b7e13c671c97892566e824499bf823108cccdde/packages/contracts/contracts/optimistic-ethereum/OVM/execution/OVM_ExecutionManager.sol#L1824-L1841). `_initContext` is notable because it (necessarily) performs a series of relatively expensive SSTORE operations (setting storage variables). So there's at least ~100k L2 gas here that you have to pay for no matter what, reducing the gas limit to 9m - 100k. You can think about this as mostly equivalent to the 21k intrinsic gas of an Ethereum transaction.\r\n2. Any transactions that are bundled by the sequencer then pass through the [`OVM_SequencerEntrypoint`](https://github.com/ethereum-optimism/optimism/blob/5b7e13c671c97892566e824499bf823108cccdde/packages/contracts/contracts/optimistic-ethereum/OVM/predeploys/OVM_SequencerEntrypoint.sol). Although we previously used this contract to experiment with more efficient transaction encodings, we now pretty much just use it to [create contract accounts automatically on behalf of users](https://github.com/ethereum-optimism/optimism/blob/5b7e13c671c97892566e824499bf823108cccdde/packages/contracts/contracts/optimistic-ethereum/OVM/predeploys/OVM_SequencerEntrypoint.sol#L56-L63). Although the execution of this contract isn't particularly expensive, just the fact that we're calling another contract further reduces the amount of gas available to us because of [EIP-150](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-150.md). EIP-150 introduced a new EVM rule that \"all but one 64th\" available gas can be passed into a `CALL` or `CREATE`. So immediately after one call, the amount of available gas is at maximum `9000000 * 63/64 = 8859375`. That's almost 150k gas that hasn't actually been *used* per se, but also isn't available for your transaction.\r\n3. This problem is compounded by the fact that the `OVM_SequencerEntrypoint` then [calls](https://github.com/ethereum-optimism/optimism/blob/5b7e13c671c97892566e824499bf823108cccdde/packages/contracts/contracts/optimistic-ethereum/OVM/predeploys/OVM_SequencerEntrypoint.sol#L66-L71) [`OVM_ECDSAContractAccount.execute`](https://github.com/ethereum-optimism/optimism/blob/5b7e13c671c97892566e824499bf823108cccdde/packages/contracts/contracts/optimistic-ethereum/OVM/accounts/OVM_ECDSAContractAccount.sol#L57-L59). That's yet another call and yet another reduction by 1/64.\r\n4. It doesn't stop there though! `OVM_ECDSAContractAccount` sits behind a proxy, [`OVM_ProxyEOA`](https://github.com/ethereum-optimism/optimism/blob/develop/packages/contracts/contracts/optimistic-ethereum/OVM/accounts/OVM_ProxyEOA.sol). Another call, another 1/64.\r\n5. And, of course, the `OVM_ECDSAContractAccount` also has to make a [call out to the contract](https://github.com/ethereum-optimism/optimism/blob/5b7e13c671c97892566e824499bf823108cccdde/packages/contracts/contracts/optimistic-ethereum/OVM/accounts/OVM_ECDSAContractAccount.sol#L103-L145) that you originally intended to call. One more reduction of 1/64.\r\n6. So far we have a total of *four* calls to get to your target contract. To make matters worse, every call in Optimistic Ethereum is (currently) actually *two* calls: contracts must call out to `OVM_ExecutionManager.ovmCALL` which will then in turn perform the relevant call out to the target contract. So we're actually performing *eight* calls before we finally hit the contract you originally wanted to call. So the maximum available gas is `9000000 * [(63/64)^8] = 7934637`. Subtract a little bit for the cost of execution inside of these contracts and you get the 7.8m gas number that you're seeing.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/841685811/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/841687197",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/874#issuecomment-841687197",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/874",
    "id": 841687197,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MTY4NzE5Nw==",
    "user": {
      "login": "leckylao",
      "id": 148800,
      "node_id": "MDQ6VXNlcjE0ODgwMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/148800?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/leckylao",
      "html_url": "https://github.com/leckylao",
      "followers_url": "https://api.github.com/users/leckylao/followers",
      "following_url": "https://api.github.com/users/leckylao/following{/other_user}",
      "gists_url": "https://api.github.com/users/leckylao/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/leckylao/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leckylao/subscriptions",
      "organizations_url": "https://api.github.com/users/leckylao/orgs",
      "repos_url": "https://api.github.com/users/leckylao/repos",
      "events_url": "https://api.github.com/users/leckylao/events{/privacy}",
      "received_events_url": "https://api.github.com/users/leckylao/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-15T16:19:05Z",
    "updated_at": "2021-05-15T16:20:33Z",
    "author_association": "NONE",
    "body": "> Ok so for posterity, here's the exact issue at hand:\r\n> \r\n> Although the block limit is 9m gas, the amount of gas actually available for execution is somewhat _less_ than 9m (at least in the way the system is currently designed). Here's the exact reason why this is the case:\r\n> \r\n> 1. Transaction execution always starts with [`OVM_ExecutionManager.run`](https://github.com/ethereum-optimism/optimism/blob/5b7e13c671c97892566e824499bf823108cccdde/packages/contracts/contracts/optimistic-ethereum/OVM/execution/OVM_ExecutionManager.sol#L159). This is the \"entrypoint\" to the Optimistic Ethereum system. It's responsible for doing some setup, including calling [`_initContext`](https://github.com/ethereum-optimism/optimism/blob/5b7e13c671c97892566e824499bf823108cccdde/packages/contracts/contracts/optimistic-ethereum/OVM/execution/OVM_ExecutionManager.sol#L1824-L1841). `_initContext` is notable because it (necessarily) performs a series of relatively expensive SSTORE operations (setting storage variables). So there's at least ~100k L2 gas here that you have to pay for no matter what, reducing the gas limit to 9m - 100k. You can think about this as mostly equivalent to the 21k intrinsic gas of an Ethereum transaction.\r\n> 2. Any transactions that are bundled by the sequencer then pass through the [`OVM_SequencerEntrypoint`](https://github.com/ethereum-optimism/optimism/blob/5b7e13c671c97892566e824499bf823108cccdde/packages/contracts/contracts/optimistic-ethereum/OVM/predeploys/OVM_SequencerEntrypoint.sol). Although we previously used this contract to experiment with more efficient transaction encodings, we now pretty much just use it to [create contract accounts automatically on behalf of users](https://github.com/ethereum-optimism/optimism/blob/5b7e13c671c97892566e824499bf823108cccdde/packages/contracts/contracts/optimistic-ethereum/OVM/predeploys/OVM_SequencerEntrypoint.sol#L56-L63). Although the execution of this contract isn't particularly expensive, just the fact that we're calling another contract further reduces the amount of gas available to us because of [EIP-150](https://github.com/ethereum/EIPs/blob/master/EIPS/eip-150.md). EIP-150 introduced a new EVM rule that \"all but one 64th\" available gas can be passed into a `CALL` or `CREATE`. So immediately after one call, the amount of available gas is at maximum `9000000 * 63/64 = 8859375`. That's almost 150k gas that hasn't actually been _used_ per se, but also isn't available for your transaction.\r\n> 3. This problem is compounded by the fact that the `OVM_SequencerEntrypoint` then [calls](https://github.com/ethereum-optimism/optimism/blob/5b7e13c671c97892566e824499bf823108cccdde/packages/contracts/contracts/optimistic-ethereum/OVM/predeploys/OVM_SequencerEntrypoint.sol#L66-L71) [`OVM_ECDSAContractAccount.execute`](https://github.com/ethereum-optimism/optimism/blob/5b7e13c671c97892566e824499bf823108cccdde/packages/contracts/contracts/optimistic-ethereum/OVM/accounts/OVM_ECDSAContractAccount.sol#L57-L59). That's yet another call and yet another reduction by 1/64.\r\n> 4. It doesn't stop there though! `OVM_ECDSAContractAccount` sits behind a proxy, [`OVM_ProxyEOA`](https://github.com/ethereum-optimism/optimism/blob/develop/packages/contracts/contracts/optimistic-ethereum/OVM/accounts/OVM_ProxyEOA.sol). Another call, another 1/64.\r\n> 5. And, of course, the `OVM_ECDSAContractAccount` also has to make a [call out to the contract](https://github.com/ethereum-optimism/optimism/blob/5b7e13c671c97892566e824499bf823108cccdde/packages/contracts/contracts/optimistic-ethereum/OVM/accounts/OVM_ECDSAContractAccount.sol#L103-L145) that you originally intended to call.\r\n> 6. So far we have a total of four calls to get to your target contract. To make matters worse, every call in Optimistic Ethereum is (currently) actually _two_ calls: contracts must call out to `OVM_ExecutionManager.ovmCALL` which will then in turn perform the relevant call out to the target contract. So we're actually performing _eight_ calls before we finally hit the contract you originally wanted to call. So the maximum available gas is `9000000 * [(63/64)^8] = 7934637`. Subtract a little bit for the cost of execution inside of these contracts and you get the 7.8m gas number that you're seeing.\r\n\r\nI see, thank you for your reply. In that case any plan/thoughts to increase block limit? As recently Ethereum also increased block limit to 15m. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/841687197/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/841687336",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/874#issuecomment-841687336",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/874",
    "id": 841687336,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MTY4NzMzNg==",
    "user": {
      "login": "leckylao",
      "id": 148800,
      "node_id": "MDQ6VXNlcjE0ODgwMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/148800?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/leckylao",
      "html_url": "https://github.com/leckylao",
      "followers_url": "https://api.github.com/users/leckylao/followers",
      "following_url": "https://api.github.com/users/leckylao/following{/other_user}",
      "gists_url": "https://api.github.com/users/leckylao/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/leckylao/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leckylao/subscriptions",
      "organizations_url": "https://api.github.com/users/leckylao/orgs",
      "repos_url": "https://api.github.com/users/leckylao/repos",
      "events_url": "https://api.github.com/users/leckylao/events{/privacy}",
      "received_events_url": "https://api.github.com/users/leckylao/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-15T16:20:05Z",
    "updated_at": "2021-05-15T16:20:05Z",
    "author_association": "NONE",
    "body": "Oops, wrong button",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/841687336/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/841687459",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/874#issuecomment-841687459",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/874",
    "id": 841687459,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MTY4NzQ1OQ==",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-15T16:21:06Z",
    "updated_at": "2021-05-15T16:21:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "We've been aware of this issue for a while but it's pretty clear now that this is problematic. It *heavily* cuts down on the maximum available gas. However, this isn't a terribly difficult problem to solve. One approach to increase the gas limit for now is to remove `OVM_SequencerEntrypoint`, `OVM_ProxyEOA`, and `OVM_ECDSAContractAccount` in favor of moving all relevant logic into `OVM_ExecutionManager.run`. I've managed to (quite easily) [put together a pull request](https://github.com/ethereum-optimism/optimism/pull/886) that does exactly this. This solution sort of \"fixes\" the problem by cutting the number of calls between `run` and your target contract to just *one*. So the amount of available gas immediately shoots back up to a maximum of `9000000 * (63/64) = 8859375`. That PR also cuts down the code a bit so the gas overhead of `run` is decreased.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/841687459/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/841687540",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/874#issuecomment-841687540",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/874",
    "id": 841687540,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MTY4NzU0MA==",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-15T16:21:52Z",
    "updated_at": "2021-05-15T16:21:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "We've already committed to increasing the gas limit to 10m. I'm not sure about the exact details of the discussion to increase this limit further. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/841687540/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/841687989",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/874#issuecomment-841687989",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/874",
    "id": 841687989,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MTY4Nzk4OQ==",
    "user": {
      "login": "leckylao",
      "id": 148800,
      "node_id": "MDQ6VXNlcjE0ODgwMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/148800?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/leckylao",
      "html_url": "https://github.com/leckylao",
      "followers_url": "https://api.github.com/users/leckylao/followers",
      "following_url": "https://api.github.com/users/leckylao/following{/other_user}",
      "gists_url": "https://api.github.com/users/leckylao/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/leckylao/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/leckylao/subscriptions",
      "organizations_url": "https://api.github.com/users/leckylao/orgs",
      "repos_url": "https://api.github.com/users/leckylao/repos",
      "events_url": "https://api.github.com/users/leckylao/events{/privacy}",
      "received_events_url": "https://api.github.com/users/leckylao/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-15T16:25:17Z",
    "updated_at": "2021-05-15T16:25:17Z",
    "author_association": "NONE",
    "body": "> We've already committed to increasing the gas limit to 10m. I'm not sure about the exact details of the discussion to increase this limit further.\r\n\r\nGood to know. Thank you for the help. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/841687989/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 2,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
