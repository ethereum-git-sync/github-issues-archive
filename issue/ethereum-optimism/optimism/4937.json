{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937",
  "id": 1594824586,
  "node_id": "I_kwDODjvEJM5fDxeK",
  "number": 4937,
  "title": "[BUG] op-node parse L1 batch data error: `frameLength is too large: 2838834252`",
  "user": {
    "login": "nolanxyg",
    "id": 33241113,
    "node_id": "MDQ6VXNlcjMzMjQxMTEz",
    "avatar_url": "https://avatars.githubusercontent.com/u/33241113?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nolanxyg",
    "html_url": "https://github.com/nolanxyg",
    "followers_url": "https://api.github.com/users/nolanxyg/followers",
    "following_url": "https://api.github.com/users/nolanxyg/following{/other_user}",
    "gists_url": "https://api.github.com/users/nolanxyg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nolanxyg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nolanxyg/subscriptions",
    "organizations_url": "https://api.github.com/users/nolanxyg/orgs",
    "repos_url": "https://api.github.com/users/nolanxyg/repos",
    "events_url": "https://api.github.com/users/nolanxyg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nolanxyg/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "sebastianst",
    "id": 2607372,
    "node_id": "MDQ6VXNlcjI2MDczNzI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sebastianst",
    "html_url": "https://github.com/sebastianst",
    "followers_url": "https://api.github.com/users/sebastianst/followers",
    "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
    "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
    "organizations_url": "https://api.github.com/users/sebastianst/orgs",
    "repos_url": "https://api.github.com/users/sebastianst/repos",
    "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sebastianst/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "sebastianst",
      "id": 2607372,
      "node_id": "MDQ6VXNlcjI2MDczNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebastianst",
      "html_url": "https://github.com/sebastianst",
      "followers_url": "https://api.github.com/users/sebastianst/followers",
      "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
      "organizations_url": "https://api.github.com/users/sebastianst/orgs",
      "repos_url": "https://api.github.com/users/sebastianst/repos",
      "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebastianst/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 22,
  "created_at": "2023-02-22T10:12:30Z",
  "updated_at": "2023-03-04T23:29:40Z",
  "closed_at": "2023-03-04T23:29:40Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!--\r\nNeed help?\r\nRefer to our contributing guidelines for additional information about making a good issue:\r\nhttps://github.com/ethereum-optimism/.github/blob/master/CONTRIBUTING.md\r\n-->\r\n\r\n**Describe the bug**\r\nA clear and concise description of what the bug is.\r\n\r\nOp-node parse batch data submitted by batcher encounter a irretrievable error: `frameLength is too large: 2838834252`,  which will make op-node unable to reconcile with L1\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. stop batcher for several hours\r\n2. start batcher\r\n3. op-node print error log: `Feb 22, 2023 @ 11:32:26.580\tWARN [02-22|03:32:26.580] Failed to parse frames                   origin=f4c844..525ff1:1589279 err=\"frameLength is too large: 2838834252\"`\r\n\r\n\r\n**Expected behavior**\r\nA clear and concise description of what you expected to happen.\r\n\r\nOp-node should keep reconcile with L1\r\n\r\n**Screenshots**\r\nIf applicable, add screenshots to help explain your problem.\r\n\r\n**System Specs:**\r\n - OS: Ubuntu\r\n - Package Version (or commit hash): 173181bd7f45aae9225523071defd5cf202fd812\r\n\r\n**Additional context**\r\nAdd any other context about the problem here.\r\n",
  "closed_by": {
    "login": "mslipper",
    "id": 67953,
    "node_id": "MDQ6VXNlcjY3OTUz",
    "avatar_url": "https://avatars.githubusercontent.com/u/67953?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mslipper",
    "html_url": "https://github.com/mslipper",
    "followers_url": "https://api.github.com/users/mslipper/followers",
    "following_url": "https://api.github.com/users/mslipper/following{/other_user}",
    "gists_url": "https://api.github.com/users/mslipper/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mslipper/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mslipper/subscriptions",
    "organizations_url": "https://api.github.com/users/mslipper/orgs",
    "repos_url": "https://api.github.com/users/mslipper/repos",
    "events_url": "https://api.github.com/users/mslipper/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mslipper/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1440812664",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1440812664",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1440812664,
    "node_id": "IC_kwDODjvEJM5V4Q54",
    "user": {
      "login": "protolambda",
      "id": 19571989,
      "node_id": "MDQ6VXNlcjE5NTcxOTg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/19571989?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/protolambda",
      "html_url": "https://github.com/protolambda",
      "followers_url": "https://api.github.com/users/protolambda/followers",
      "following_url": "https://api.github.com/users/protolambda/following{/other_user}",
      "gists_url": "https://api.github.com/users/protolambda/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/protolambda/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/protolambda/subscriptions",
      "organizations_url": "https://api.github.com/users/protolambda/orgs",
      "repos_url": "https://api.github.com/users/protolambda/repos",
      "events_url": "https://api.github.com/users/protolambda/events{/privacy}",
      "received_events_url": "https://api.github.com/users/protolambda/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-22T21:20:58Z",
    "updated_at": "2023-02-22T21:20:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "This error looks wrong to me: the frameLength should never be that large. I think it hit a decoding error, and read the wrong data as frame-length.\r\n\r\nIn the verifier it was recently changed (thus also the different error message formatting) due to a finding of the Sherlock bug-bounty contest; https://github.com/ethereum-optimism/optimism/pull/4867 which may be related.\r\n\r\nBut the error path is still the same:\r\n- The frame is too large: https://github.com/ethereum-optimism/optimism/blob/72f24f11d21c167108082fdbe5bdffb3293348ed/op-node/rollup/derive/frame.go#L90\r\n- The frame decoding errors: https://github.com/ethereum-optimism/optimism/blob/72f24f11d21c167108082fdbe5bdffb3293348ed/op-node/rollup/derive/frame.go#L140\r\n- The bad frame is ignored: https://github.com/ethereum-optimism/optimism/blob/9a198e90b1a7ab90a2ca85a3277576103eba6548/op-node/rollup/derive/frame_queue.go#L45\r\n\r\nThis verifier code-path here functions as expected: bad frames are dropped and skipped over.\r\n\r\nThe batcher however needs to ensure it only outputs valid frames, or the frames will not be accepted.\r\n\r\nThe maximum frame size is configurable: https://github.com/ethereum-optimism/optimism/blob/e03b50731e0718a311f4f59e0699c90e6a598759/op-batcher/batcher/channel_builder.go#L26\r\n\r\nAnd based on the max L1 tx size by default: https://github.com/ethereum-optimism/optimism/blob/3468c6af6df8132c848f6f329a0a5592e6a14800/op-batcher/batcher/driver.go#L92\r\n\r\nWhich is smaller than the enforced frame size: https://github.com/ethereum-optimism/optimism/blob/72f24f11d21c167108082fdbe5bdffb3293348ed/op-node/rollup/derive/frame.go#L14\r\n\r\nSo assuming the settings are left to defaults, then this may indicate some bug (that may be related or duplicate of the Sherlock contest finding) in the frame-encoding when buffering large amounts of data that corrupts the output (resulting in the ridiculous 2.8+ GB frame-size number).\r\n\r\ncc @sebastianst flagging possible op-batcher bug.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1440812664/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1440890892",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1440890892",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1440890892,
    "node_id": "IC_kwDODjvEJM5V4kAM",
    "user": {
      "login": "sebastianst",
      "id": 2607372,
      "node_id": "MDQ6VXNlcjI2MDczNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebastianst",
      "html_url": "https://github.com/sebastianst",
      "followers_url": "https://api.github.com/users/sebastianst/followers",
      "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
      "organizations_url": "https://api.github.com/users/sebastianst/orgs",
      "repos_url": "https://api.github.com/users/sebastianst/repos",
      "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebastianst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-22T22:22:15Z",
    "updated_at": "2023-02-22T22:22:15Z",
    "author_association": "MEMBER",
    "body": "Thanks @protolambda for the initial analysis!\r\n\r\nThe `frameLength` of `2838834252` looks suspicious to me because it has the highest uint32 bit set: I think it never was a `frameLength` to begin with but instead is just random data that got decoded into a frame length. The unmarshaling code doesn't do any sanity check before this first check on the max. frame length. I bet the decoded frame number and channel id before are also random.\r\n\r\n@nolanxyg could you provide some more context?\r\n* What op-batcher and op-node configuration do you use?\r\n  * In particular, what channel configuration (target and max tx size, approx. compr. ratio)\r\n* What's your L1 here? \r\n* Is there any tx volume happening during the hours that your batcher is offline?\r\n\r\nPlease also give this a try with a more recent version of the monorepo. A few changes have been made to the batcher and node since your specified commit https://github.com/ethereum-optimism/optimism/commit/173181bd7f45aae9225523071defd5cf202fd812.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1440890892/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1441509674",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1441509674",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1441509674,
    "node_id": "IC_kwDODjvEJM5V67Eq",
    "user": {
      "login": "sebastianst",
      "id": 2607372,
      "node_id": "MDQ6VXNlcjI2MDczNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebastianst",
      "html_url": "https://github.com/sebastianst",
      "followers_url": "https://api.github.com/users/sebastianst/followers",
      "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
      "organizations_url": "https://api.github.com/users/sebastianst/orgs",
      "repos_url": "https://api.github.com/users/sebastianst/repos",
      "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebastianst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-23T10:20:29Z",
    "updated_at": "2023-02-23T10:20:29Z",
    "author_association": "MEMBER",
    "body": "Tracking at CLI-3428",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1441509674/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1445055916",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1445055916",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1445055916,
    "node_id": "IC_kwDODjvEJM5WIc2s",
    "user": {
      "login": "sebastianst",
      "id": 2607372,
      "node_id": "MDQ6VXNlcjI2MDczNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebastianst",
      "html_url": "https://github.com/sebastianst",
      "followers_url": "https://api.github.com/users/sebastianst/followers",
      "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
      "organizations_url": "https://api.github.com/users/sebastianst/orgs",
      "repos_url": "https://api.github.com/users/sebastianst/repos",
      "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebastianst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-25T11:04:23Z",
    "updated_at": "2023-02-25T11:04:23Z",
    "author_association": "MEMBER",
    "body": "@nolanxyg see my above message, would love to get more info so that we can reproduce ðŸ™ðŸ» ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1445055916/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1445327029",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1445327029",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1445327029,
    "node_id": "IC_kwDODjvEJM5WJfC1",
    "user": {
      "login": "nolanxyg",
      "id": 33241113,
      "node_id": "MDQ6VXNlcjMzMjQxMTEz",
      "avatar_url": "https://avatars.githubusercontent.com/u/33241113?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nolanxyg",
      "html_url": "https://github.com/nolanxyg",
      "followers_url": "https://api.github.com/users/nolanxyg/followers",
      "following_url": "https://api.github.com/users/nolanxyg/following{/other_user}",
      "gists_url": "https://api.github.com/users/nolanxyg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nolanxyg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nolanxyg/subscriptions",
      "organizations_url": "https://api.github.com/users/nolanxyg/orgs",
      "repos_url": "https://api.github.com/users/nolanxyg/repos",
      "events_url": "https://api.github.com/users/nolanxyg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nolanxyg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-26T10:51:05Z",
    "updated_at": "2023-02-26T10:51:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "SorryðŸ™ðŸ»\r\n@s7v7nislands pls help to provide more context, thanks",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1445327029/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1445987397",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1445987397",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1445987397,
    "node_id": "IC_kwDODjvEJM5WMARF",
    "user": {
      "login": "nolanxyg",
      "id": 33241113,
      "node_id": "MDQ6VXNlcjMzMjQxMTEz",
      "avatar_url": "https://avatars.githubusercontent.com/u/33241113?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nolanxyg",
      "html_url": "https://github.com/nolanxyg",
      "followers_url": "https://api.github.com/users/nolanxyg/followers",
      "following_url": "https://api.github.com/users/nolanxyg/following{/other_user}",
      "gists_url": "https://api.github.com/users/nolanxyg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nolanxyg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nolanxyg/subscriptions",
      "organizations_url": "https://api.github.com/users/nolanxyg/orgs",
      "repos_url": "https://api.github.com/users/nolanxyg/repos",
      "events_url": "https://api.github.com/users/nolanxyg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nolanxyg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-27T09:27:32Z",
    "updated_at": "2023-02-27T09:27:32Z",
    "author_association": "CONTRIBUTOR",
    "body": " > @nolanxyg could you provide some more context?\r\n> \r\n> * What op-batcher and op-node configuration do you use?\r\n>   \r\n>   * In particular, what channel configuration (target and max tx size, approx. compr. ratio)\r\n> * What's your L1 here?\r\n> * Is there any tx volume happening during the hours that your batcher is offline?\r\n> \r\n> Please also give this a try with a more recent version of the monorepo. A few changes have been made to the batcher and node since your specified commit [173181b](https://github.com/ethereum-optimism/optimism/commit/173181bd7f45aae9225523071defd5cf202fd812).\r\n\r\n* \r\n<img width=\"374\" alt=\"image\" src=\"https://user-images.githubusercontent.com/33241113/221512028-8cf1f3ef-3ad3-4086-8f24-f9ec6b9e8b31.png\">\r\n\r\n* BSC\r\n* Yes, we were doing load test\r\n\r\n\r\nOK, we will try the recent commit version to see if this issue is fixed\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1445987397/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1446168319",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1446168319",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1446168319,
    "node_id": "IC_kwDODjvEJM5WMsb_",
    "user": {
      "login": "sebastianst",
      "id": 2607372,
      "node_id": "MDQ6VXNlcjI2MDczNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebastianst",
      "html_url": "https://github.com/sebastianst",
      "followers_url": "https://api.github.com/users/sebastianst/followers",
      "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
      "organizations_url": "https://api.github.com/users/sebastianst/orgs",
      "repos_url": "https://api.github.com/users/sebastianst/repos",
      "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebastianst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-27T11:30:27Z",
    "updated_at": "2023-02-27T11:30:48Z",
    "author_association": "MEMBER",
    "body": "@nolanxyg Thanks, some op-node and L2 config would also be appreciated. E.g. what's you L2 block time? Note BSC seems to have a block time of 3 sec.\r\n\r\nWith your batcher configuration, it will have a hard time catching up because of the low target of `624` bytes. That value is/was set in our tests to force eager batch generation. But in realistic scenarios with high L2 volume, it's too low because each channel will only contain ~624 bytes of input data (and so even less output data because it gets compressed) and batcher txs are send sequentially.\r\n\r\nYesterday I added a new channel duration limiting functionality to the batcher at https://github.com/ethereum-optimism/optimism/pull/4990 \r\n\r\nI suggest you test your system with this new batcher and also change the config as suggested in this PR's description, but with higher max channel duration and sub safety margin. It allows you to set a low channel duration so that channels are not kept open for too long (which gives a better UX at the expense of emptier channels during low L2 tx volume). This could be set to e.g. `MaxChannelDuration = 40` in a realistic setting to ensure that single-frame channels are submitted to L1 after at most 2 minutes (40 * 3 sec (L1 block time) = 2 min). But I don't know your requirements so whether you want to use channel duration limiting at all depends on your use case. My guess is you want to enable it, especially in your testnet.\r\n\r\nThen also increase the target tx size to 100000 and use a realistic value for the approx. compression ratio (0.4). Note also that newer batchers pull the channel timeout from the rollup node, so you can delete that parameter (`OP_BATCHER_CHANNEL_TIMEOUT`).\r\n\r\n## tl;dr\r\n\r\nUse batcher from #4990 and try with the following config (convert to env var names)\r\n```\r\n\t\tMaxChannelDuration:        40, // 40 * 3 sec (L1 block time) = 2 min\r\n\t\tMaxL1TxSize:               120_000,\r\n\t\tTargetL1TxSize:            100_000,\r\n\t\tTargetNumFrames:           1,\r\n\t\tApproxComprRatio:          0.4,\r\n\t\tSubSafetyMargin:           20,\r\n```\r\nThis is similar to our e2e test config, but has a higher max channel duration and submission safety margin.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1446168319/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1447956796",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1447956796",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1447956796,
    "node_id": "IC_kwDODjvEJM5WThE8",
    "user": {
      "login": "nolanxyg",
      "id": 33241113,
      "node_id": "MDQ6VXNlcjMzMjQxMTEz",
      "avatar_url": "https://avatars.githubusercontent.com/u/33241113?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nolanxyg",
      "html_url": "https://github.com/nolanxyg",
      "followers_url": "https://api.github.com/users/nolanxyg/followers",
      "following_url": "https://api.github.com/users/nolanxyg/following{/other_user}",
      "gists_url": "https://api.github.com/users/nolanxyg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nolanxyg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nolanxyg/subscriptions",
      "organizations_url": "https://api.github.com/users/nolanxyg/orgs",
      "repos_url": "https://api.github.com/users/nolanxyg/repos",
      "events_url": "https://api.github.com/users/nolanxyg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nolanxyg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-28T10:44:42Z",
    "updated_at": "2023-02-28T10:44:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "Cool, Thanks a ton! @sebastianst ðŸ‘ \r\n\r\nHere's `rollup.json`:\r\n```\r\n{\r\n  \"genesis\": {\r\n    \"l1\": {\r\n      \"hash\": \"0x32a66f95f9e04e3eb3bc71b4b02b26ff1280ce8132aa0d58e9cd9f5bcfe6f2e3\",\r\n      \"number\": 1740287\r\n    },\r\n    \"l2\": {\r\n      \"hash\": \"0x74207c6f3ede9fa5e0db10aee7a3e13335978fbf07ef816b4c0bb964133ac0fa\",\r\n      \"number\": 0\r\n    },\r\n    \"l2_time\": 1677489770,\r\n    \"system_config\": {\r\n      \"batcherAddr\": \"0xd532d4705df2f6422b02aba6a55955f21aab2294\",\r\n      \"overhead\": \"0x0000000000000000000000000000000000000000000000000000000000000834\",\r\n      \"scalar\": \"0x00000000000000000000000000000000000000000000000000000000000f4240\",\r\n      \"gasLimit\": 100000000\r\n    }\r\n  },\r\n  \"block_time\": 1,\r\n  \"max_sequencer_drift\": 300,\r\n  \"seq_window_size\": 16800,\r\n  \"channel_timeout\": 40,\r\n  \"l1_chain_id\": 714,\r\n  \"l2_chain_id\": 716,\r\n  \"batch_inbox_address\": \"0xff00000000000000000000000000000000000000\",\r\n  \"deposit_contract_address\": \"0xe4562148368da2e2f94b2c590c17b550c79eb5c6\",\r\n  \"l1_system_config_address\": \"0x9609d0e7084e59f9b779f9976e9c07c039f8a026\"\r\n}\r\n```\r\nFor `geth-config.toml`, i have ran `geth dumpconfig` but got an error, which is same with: https://github.com/ethereum/go-ethereum/issues/26328, so i only could show the start command:\r\n```\r\ngeth \\\r\n                  --datadir=\"/db\" \\\r\n                  --verbosity=3 \\\r\n                  --http \\\r\n                  --http.corsdomain=\"*\" \\\r\n                  --http.vhosts=\"*\" \\\r\n                  --http.addr=0.0.0.0 \\\r\n                  --http.port=8545 \\\r\n                  --http.api=eth,engine \\\r\n                  --ws \\\r\n                  --ws.addr=0.0.0.0 \\\r\n                  --ws.port=8546 \\\r\n                  --ws.origins=\"*\" \\\r\n                  --ws.api=eth,engine \\\r\n                  --syncmode=full \\\r\n                  --nodiscover \\\r\n                  --maxpeers=1 \\\r\n                  --networkid=$(CHAIN_ID) \\\r\n                  --unlock=\"$(BLOCK_SIGNER_ADDRESS)\" \\\r\n                  --mine \\\r\n                  --miner.etherbase=\"$(BLOCK_SIGNER_ADDRESS)\" \\\r\n                  --miner.gaslimit=25000000 \\\r\n                  --password=/db/password \\\r\n                  --allow-insecure-unlock \\\r\n                  --authrpc.addr=\"0.0.0.0\" \\\r\n                  --authrpc.port=\"8551\" \\\r\n                  --authrpc.vhosts=\"*\" \\\r\n                  --authrpc.jwtsecret=/config/jwt-secret.txt \\\r\n                  --gcmode=archive \\\r\n                  --verbosity=4 \\\r\n                  --pprof \\\r\n                  --metrics \\\r\n                  --metrics.port 6060 \\\r\n                  --metrics.addr 0.0.0.0\r\n```\r\n\r\nThanks for pointing `624 bytes` out! We also found that's too small, and we'll optimize the parameters according to your advice, really appreciate!\r\n\r\nWe have modified the `block_time` to `1`s,  and noticed that default [NewPayloadTimeout](https://github.com/ethereum-optimism/op-geth/blob/c1e9b380834b65de6e6289f53b2834829065e7ac/miner/miner.go#L63) parameter value(`2`s) of op-geth may be inconsistent, should we modify [NewPayloadTimeout](https://github.com/ethereum-optimism/op-geth/blob/c1e9b380834b65de6e6289f53b2834829065e7ac/miner/miner.go#L63) to `1`s as well?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1447956796/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1448032762",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1448032762",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1448032762,
    "node_id": "IC_kwDODjvEJM5WTzn6",
    "user": {
      "login": "sebastianst",
      "id": 2607372,
      "node_id": "MDQ6VXNlcjI2MDczNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebastianst",
      "html_url": "https://github.com/sebastianst",
      "followers_url": "https://api.github.com/users/sebastianst/followers",
      "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
      "organizations_url": "https://api.github.com/users/sebastianst/orgs",
      "repos_url": "https://api.github.com/users/sebastianst/repos",
      "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebastianst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-28T11:38:17Z",
    "updated_at": "2023-02-28T11:38:53Z",
    "author_association": "MEMBER",
    "body": "Quick feedback on your rollup config:\r\n* a channel timeout of 40 (2 min in your case) seems rather low. It's the value I proposed setting as max channel duration in the batcher, but as a consensus variable I'd set this higher, e.g. at least to 120 (6 min ).\r\n* why the very high seq window size of 16800?\r\n\r\nWe'll get back regarding the `NewPayloadTimeout` soon.\r\n\r\nLooking forward to your feedback on the new batcher!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1448032762/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1449614419",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1449614419",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1449614419,
    "node_id": "IC_kwDODjvEJM5WZ1xT",
    "user": {
      "login": "nolanxyg",
      "id": 33241113,
      "node_id": "MDQ6VXNlcjMzMjQxMTEz",
      "avatar_url": "https://avatars.githubusercontent.com/u/33241113?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nolanxyg",
      "html_url": "https://github.com/nolanxyg",
      "followers_url": "https://api.github.com/users/nolanxyg/followers",
      "following_url": "https://api.github.com/users/nolanxyg/following{/other_user}",
      "gists_url": "https://api.github.com/users/nolanxyg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nolanxyg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nolanxyg/subscriptions",
      "organizations_url": "https://api.github.com/users/nolanxyg/orgs",
      "repos_url": "https://api.github.com/users/nolanxyg/repos",
      "events_url": "https://api.github.com/users/nolanxyg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nolanxyg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-01T08:58:53Z",
    "updated_at": "2023-03-01T08:58:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Please also give this a try with a more recent version of the monorepo. A few changes have been made to the batcher and node since your specified commit https://github.com/ethereum-optimism/optimism/commit/173181bd7f45aae9225523071defd5cf202fd812.\r\n\r\nHi @sebastianst, we have tried again with code version: https://github.com/ethereum-optimism/optimism/releases/tag/op-proposer%2Fv1.0.0-rc.1, and the `frameLength is too large` error came up again\r\n\r\nHere's what we did:\r\n1. Setup the whole network (config with info mentioned above)\r\n2. Stop batcher for several hours (or batcher run out of money in our case as showed in below monitor)\r\n* \r\n![image](https://user-images.githubusercontent.com/33241113/222091229-463a90fd-b8d1-49b0-b8a7-cc04abc1b34b.png)\r\n\r\n3. Start batcher (or fund to batcher in our case at 03-01 10:43, and batcher ran out of money soon, so we fund to it again at 03-01 11:29)\r\n4. check the log of op-node, we found `frameLength is too large` error log at about 03-01 10:43 and 03-01 11:29, which is the time batcher return to work\r\n* \r\n<img width=\"1736\" alt=\"image\" src=\"https://user-images.githubusercontent.com/33241113/222091012-427bf43b-cee6-4cd0-bc05-806c634261f3.png\">\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1449614419/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1449663634",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1449663634",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1449663634,
    "node_id": "IC_kwDODjvEJM5WaByS",
    "user": {
      "login": "nolanxyg",
      "id": 33241113,
      "node_id": "MDQ6VXNlcjMzMjQxMTEz",
      "avatar_url": "https://avatars.githubusercontent.com/u/33241113?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nolanxyg",
      "html_url": "https://github.com/nolanxyg",
      "followers_url": "https://api.github.com/users/nolanxyg/followers",
      "following_url": "https://api.github.com/users/nolanxyg/following{/other_user}",
      "gists_url": "https://api.github.com/users/nolanxyg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nolanxyg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nolanxyg/subscriptions",
      "organizations_url": "https://api.github.com/users/nolanxyg/orgs",
      "repos_url": "https://api.github.com/users/nolanxyg/repos",
      "events_url": "https://api.github.com/users/nolanxyg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nolanxyg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-01T09:19:49Z",
    "updated_at": "2023-03-01T09:19:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Quick feedback on your rollup config:\r\n> \r\n> * a channel timeout of 40 (2 min in your case) seems rather low. It's the value I proposed setting as max channel duration in the batcher, but as a consensus variable I'd set this higher, e.g. at least to 120 (6 min ).\r\n> * why the very high seq window size of 16800?\r\n> \r\n> We'll get back regarding the `NewPayloadTimeout` soon.\r\n> \r\n> Looking forward to your feedback on the new batcher!\r\n\r\n* got, how about set `op_batcher__channel_timeout` to `40*12/3` and ` channel_timieout` in rollup.json to `120*12/3`? \r\n    * `12` means Ethereum block time , and `3` means BSC block time\r\n    \r\n* the `seq_window_size` value in Ethereum environment is [3600](https://github.com/ethereum-optimism/optimism/blob/3177f8850ed94c7935032155f94dd2629d809f96/op-node/chaincfg/chains.go#L62), we considered BSC block time is 3s, so `3600*12/3 = 14400 â‰ˆ 16800`",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1449663634/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1450732931",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1450732931",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1450732931,
    "node_id": "IC_kwDODjvEJM5WeG2D",
    "user": {
      "login": "protolambda",
      "id": 19571989,
      "node_id": "MDQ6VXNlcjE5NTcxOTg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/19571989?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/protolambda",
      "html_url": "https://github.com/protolambda",
      "followers_url": "https://api.github.com/users/protolambda/followers",
      "following_url": "https://api.github.com/users/protolambda/following{/other_user}",
      "gists_url": "https://api.github.com/users/protolambda/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/protolambda/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/protolambda/subscriptions",
      "organizations_url": "https://api.github.com/users/protolambda/orgs",
      "repos_url": "https://api.github.com/users/protolambda/repos",
      "events_url": "https://api.github.com/users/protolambda/events{/privacy}",
      "received_events_url": "https://api.github.com/users/protolambda/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-01T19:27:43Z",
    "updated_at": "2023-03-01T19:27:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "> We have modified the block_time to 1s, and noticed that default [NewPayloadTimeout](https://github.com/ethereum-optimism/op-geth/blob/c1e9b380834b65de6e6289f53b2834829065e7ac/miner/miner.go#L63) parameter value(2s) of op-geth may be inconsistent, should we modify [NewPayloadTimeout](https://github.com/ethereum-optimism/op-geth/blob/c1e9b380834b65de6e6289f53b2834829065e7ac/miner/miner.go#L63) to 1s as well?\r\n\r\nNo, payload-building timeouts should be generous. If it's too strict, there's a chance it gets stuck on a valid canonical block that takes a little too much time to build. In L1, at 30M gas, we generally regard the max building time as around 2 seconds. A 2 second block-time is already tight, and the tuned EIP-1559 avoid too many repeated gas-bursts from repeatedly hitting this 2 second build time, by targeting less gas on average, and exponentially adjusting it upwards.\r\n\r\nIf you fall behind a little bit due to a large block, with the right gas-adjustment parameters the next ones will be more light-weight, will take less time to build, and thus get the L2 chain back in sync with the wallclock.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1450732931/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1450938073",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1450938073",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1450938073,
    "node_id": "IC_kwDODjvEJM5We47Z",
    "user": {
      "login": "sebastianst",
      "id": 2607372,
      "node_id": "MDQ6VXNlcjI2MDczNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebastianst",
      "html_url": "https://github.com/sebastianst",
      "followers_url": "https://api.github.com/users/sebastianst/followers",
      "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
      "organizations_url": "https://api.github.com/users/sebastianst/orgs",
      "repos_url": "https://api.github.com/users/sebastianst/repos",
      "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebastianst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-01T22:24:26Z",
    "updated_at": "2023-03-01T22:24:26Z",
    "author_association": "MEMBER",
    "body": "> > Quick feedback on your rollup config:\r\n> > \r\n> > * a channel timeout of 40 (2 min in your case) seems rather low. It's the value I proposed setting as max channel duration in the batcher, but as a consensus variable I'd set this higher, e.g. at least to 120 (6 min ).\r\n> > * why the very high seq window size of 16800?\r\n> > \r\n> > We'll get back regarding the `NewPayloadTimeout` soon.\r\n> > Looking forward to your feedback on the new batcher!\r\n> \r\n>     * got, how about set `op_batcher__channel_timeout` to `40*12/3` and ` channel_timieout` in rollup.json to `120*12/3`?\r\n>       \r\n>       * `12` means Ethereum block time , and `3` means BSC block time\r\n> \r\n>     * the `seq_window_size` value in Ethereum environment is [3600](https://github.com/ethereum-optimism/optimism/blob/3177f8850ed94c7935032155f94dd2629d809f96/op-node/chaincfg/chains.go#L62), we considered BSC block time is 3s, so `3600*12/3 = 14400 â‰ˆ 16800`\r\n\r\n* The new batcher queries the channel timeout from its rollup node, so this parameter (`OP_BATCHER_CHANNEL_TIMEOUT`) is obsolete.\r\n* A channel timeout of 480 in your `rollup.json` sounds reasonable then. 3600*4=16800 for the SWS should be fine too.\r\n* Did you try the batcher from #4990 (commit [c8f16b5](https://github.com/ethereum-optimism/optimism/pull/4990/commits/c8f16b55146a90f15752544cbb1e590b6606afe0)) yet? Try it with this config\r\n```yml\r\n      OP_BATCHER_MAX_CHANNEL_DURATION: 20 # 1min, adjust if you want longer\r\n      OP_BATCHER_MAX_L1_TX_SIZE_BYTES: 120000\r\n      OP_BATCHER_TARGET_L1_TX_SIZE_BYTES: 100000\r\n      OP_BATCHER_TARGET_NUM_FRAMES: 1\r\n      OP_BATCHER_APPROX_COMPR_RATIO: 0.6 # note, updated from 0.4\r\n      OP_BATCHER_SUB_SAFETY_MARGIN: 20\r\n```\r\nThe high target and max tx size make sure that the batcher sends full frames when it's catching up after being offline for some time.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1450938073/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1450965083",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1450965083",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1450965083,
    "node_id": "IC_kwDODjvEJM5We_hb",
    "user": {
      "login": "sebastianst",
      "id": 2607372,
      "node_id": "MDQ6VXNlcjI2MDczNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebastianst",
      "html_url": "https://github.com/sebastianst",
      "followers_url": "https://api.github.com/users/sebastianst/followers",
      "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
      "organizations_url": "https://api.github.com/users/sebastianst/orgs",
      "repos_url": "https://api.github.com/users/sebastianst/repos",
      "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebastianst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-01T22:43:09Z",
    "updated_at": "2023-03-01T22:44:17Z",
    "author_association": "MEMBER",
    "body": "@nolanxyg I looked at your logs screenshot. It's conspicuous that the error at 10:43 mentions a frame number of 14. Because the batcher should actually just send txs whose data only includes 1-2 frame(s) with your config (`OP_BATCHER_TARGET_NUM_FRAMES: 1`). So it looks to me like the frame data is total garbage. But then it seems like a miracle that parsing gets until \"frame 14\" and the 13 \"frames\" before that unmarshal without error. Also, the first byte of the tx data must be correctly set to `0 = DerivationVersion0`.\r\n\r\nI'm curious if you still get errors with the #4990 batcher. Also, could you enable batcher debug logging (`OP_BATCHER_LOG_LEVEL: \"debug\"`) and upload the logs near before and after the time when the node detects broken batcher tx data?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1450965083/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1451388120",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1451388120",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1451388120,
    "node_id": "IC_kwDODjvEJM5WgmzY",
    "user": {
      "login": "nolanxyg",
      "id": 33241113,
      "node_id": "MDQ6VXNlcjMzMjQxMTEz",
      "avatar_url": "https://avatars.githubusercontent.com/u/33241113?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nolanxyg",
      "html_url": "https://github.com/nolanxyg",
      "followers_url": "https://api.github.com/users/nolanxyg/followers",
      "following_url": "https://api.github.com/users/nolanxyg/following{/other_user}",
      "gists_url": "https://api.github.com/users/nolanxyg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nolanxyg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nolanxyg/subscriptions",
      "organizations_url": "https://api.github.com/users/nolanxyg/orgs",
      "repos_url": "https://api.github.com/users/nolanxyg/repos",
      "events_url": "https://api.github.com/users/nolanxyg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nolanxyg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-02T06:59:42Z",
    "updated_at": "2023-03-02T06:59:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "> No, payload-building timeouts should be generous. If it's too strict, there's a chance it gets stuck on a valid canonical block that takes a little too much time to build. In L1, at 30M gas, we generally regard the max building time as around 2 seconds. A 2 second block-time is already tight, and the tuned EIP-1559 avoid too many repeated gas-bursts from repeatedly hitting this 2 second build time, by targeting less gas on average, and exponentially adjusting it upwards.\r\n>\r\n> If you fall behind a little bit due to a large block, with the right gas-adjustment parameters the next ones will be more light-weight, will take less time to build, and thus get the L2 chain back in sync with the wallclock.\r\n\r\nNice explanation, understood, thanks! @protolambda ðŸ‘\r\n\r\nWe set `l2_block_time` to `1s` considering there's no consensus on l2 for now, so we tried a aggressive value. Does `1s block time` have potential risks? (If so, we'll change back to `2s`)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1451388120/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1451393669",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1451393669",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1451393669,
    "node_id": "IC_kwDODjvEJM5WgoKF",
    "user": {
      "login": "nolanxyg",
      "id": 33241113,
      "node_id": "MDQ6VXNlcjMzMjQxMTEz",
      "avatar_url": "https://avatars.githubusercontent.com/u/33241113?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nolanxyg",
      "html_url": "https://github.com/nolanxyg",
      "followers_url": "https://api.github.com/users/nolanxyg/followers",
      "following_url": "https://api.github.com/users/nolanxyg/following{/other_user}",
      "gists_url": "https://api.github.com/users/nolanxyg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nolanxyg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nolanxyg/subscriptions",
      "organizations_url": "https://api.github.com/users/nolanxyg/orgs",
      "repos_url": "https://api.github.com/users/nolanxyg/repos",
      "events_url": "https://api.github.com/users/nolanxyg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nolanxyg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-02T07:06:37Z",
    "updated_at": "2023-03-02T07:06:37Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Did you try the batcher from https://github.com/ethereum-optimism/optimism/pull/4990 (commit [c8f16b5](https://github.com/ethereum-optimism/optimism/pull/4990/commits/c8f16b55146a90f15752544cbb1e590b6606afe0)) yet? Try it with this config\r\n>  \r\n>  ```\r\n>       OP_BATCHER_MAX_CHANNEL_DURATION: 20 # 1min, adjust if you want longer\r\n>       OP_BATCHER_MAX_L1_TX_SIZE_BYTES: 120000\r\n>       OP_BATCHER_TARGET_L1_TX_SIZE_BYTES: 100000\r\n>       OP_BATCHER_TARGET_NUM_FRAMES: 1\r\n>       OP_BATCHER_APPROX_COMPR_RATIO: 0.6 # note, updated from 0.4\r\n>       OP_BATCHER_SUB_SAFETY_MARGIN: 20\r\n> ```\r\n\r\nOK, we'll try this, and give the feedback soon\r\n\r\n>Also, could you enable batcher debug logging (OP_BATCHER_LOG_LEVEL: \"debug\") and upload the logs near before and after the time when the node detects broken batcher tx data?\r\n\r\nSure",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1451393669/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1451527349",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1451527349",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1451527349,
    "node_id": "IC_kwDODjvEJM5WhIy1",
    "user": {
      "login": "sebastianst",
      "id": 2607372,
      "node_id": "MDQ6VXNlcjI2MDczNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebastianst",
      "html_url": "https://github.com/sebastianst",
      "followers_url": "https://api.github.com/users/sebastianst/followers",
      "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
      "organizations_url": "https://api.github.com/users/sebastianst/orgs",
      "repos_url": "https://api.github.com/users/sebastianst/repos",
      "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebastianst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-02T09:05:07Z",
    "updated_at": "2023-03-02T09:05:07Z",
    "author_association": "MEMBER",
    "body": "@nolanxyg #4990 just got merged into `develop`, so you can use the batcher from `develop` now.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1451527349/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 2,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1451551725",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1451551725",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1451551725,
    "node_id": "IC_kwDODjvEJM5WhOvt",
    "user": {
      "login": "sebastianst",
      "id": 2607372,
      "node_id": "MDQ6VXNlcjI2MDczNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebastianst",
      "html_url": "https://github.com/sebastianst",
      "followers_url": "https://api.github.com/users/sebastianst/followers",
      "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
      "organizations_url": "https://api.github.com/users/sebastianst/orgs",
      "repos_url": "https://api.github.com/users/sebastianst/repos",
      "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebastianst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-02T09:22:14Z",
    "updated_at": "2023-03-02T09:22:14Z",
    "author_association": "MEMBER",
    "body": "I might want to reproduce this locally. Can you estimate the minimal steps to reproduce this? If I spin up a new network, but don't start the batcher yet, produce a good amount of L2 tx volume, then spin up the batcher after a few hours, would that already trigger it?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1451551725/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1451637249",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1451637249",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1451637249,
    "node_id": "IC_kwDODjvEJM5WhjoB",
    "user": {
      "login": "nolanxyg",
      "id": 33241113,
      "node_id": "MDQ6VXNlcjMzMjQxMTEz",
      "avatar_url": "https://avatars.githubusercontent.com/u/33241113?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nolanxyg",
      "html_url": "https://github.com/nolanxyg",
      "followers_url": "https://api.github.com/users/nolanxyg/followers",
      "following_url": "https://api.github.com/users/nolanxyg/following{/other_user}",
      "gists_url": "https://api.github.com/users/nolanxyg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nolanxyg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nolanxyg/subscriptions",
      "organizations_url": "https://api.github.com/users/nolanxyg/orgs",
      "repos_url": "https://api.github.com/users/nolanxyg/repos",
      "events_url": "https://api.github.com/users/nolanxyg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nolanxyg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-02T10:25:04Z",
    "updated_at": "2023-03-02T10:25:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "If to be the same with our steps, i think you could spin up a network, and test everything worked properly(batcher worked fine as well, but the balance of batcher better be low),  produce a good amount of L2 tx volume, then batcher will be out of money soon, after a few hours(e.g. a night), fund to batcher to get it back to work, finally check if the network recovered and if the `frame error log` show up\r\n\r\nBecause i doubt that maybe the interrupt of sending submit-tx(due to insufficient funds) cause the error\r\n\r\n```\r\nERROR[02-26|09:11:42.718] unable to publish transaction            service=batcher txHash=9aadf5..d71a8f nonce=55244 gasTipCap=20,000,000,000 gasFeeCap=20,000,000,000 err=\"insufficient funds for gas * price + value\"\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1451637249/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1453593565",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1453593565",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1453593565,
    "node_id": "IC_kwDODjvEJM5WpBPd",
    "user": {
      "login": "s7v7nislands",
      "id": 225986,
      "node_id": "MDQ6VXNlcjIyNTk4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/225986?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s7v7nislands",
      "html_url": "https://github.com/s7v7nislands",
      "followers_url": "https://api.github.com/users/s7v7nislands/followers",
      "following_url": "https://api.github.com/users/s7v7nislands/following{/other_user}",
      "gists_url": "https://api.github.com/users/s7v7nislands/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s7v7nislands/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s7v7nislands/subscriptions",
      "organizations_url": "https://api.github.com/users/s7v7nislands/orgs",
      "repos_url": "https://api.github.com/users/s7v7nislands/repos",
      "events_url": "https://api.github.com/users/s7v7nislands/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s7v7nislands/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-03T14:13:19Z",
    "updated_at": "2023-03-03T14:13:19Z",
    "author_association": "CONTRIBUTOR",
    "body": "@sebastianst I think the pr fix the bug, please take a look",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1453593565/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1453609597",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1453609597",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1453609597,
    "node_id": "IC_kwDODjvEJM5WpFJ9",
    "user": {
      "login": "s7v7nislands",
      "id": 225986,
      "node_id": "MDQ6VXNlcjIyNTk4Ng==",
      "avatar_url": "https://avatars.githubusercontent.com/u/225986?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/s7v7nislands",
      "html_url": "https://github.com/s7v7nislands",
      "followers_url": "https://api.github.com/users/s7v7nislands/followers",
      "following_url": "https://api.github.com/users/s7v7nislands/following{/other_user}",
      "gists_url": "https://api.github.com/users/s7v7nislands/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/s7v7nislands/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/s7v7nislands/subscriptions",
      "organizations_url": "https://api.github.com/users/s7v7nislands/orgs",
      "repos_url": "https://api.github.com/users/s7v7nislands/repos",
      "events_url": "https://api.github.com/users/s7v7nislands/events{/privacy}",
      "received_events_url": "https://api.github.com/users/s7v7nislands/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-03T14:25:41Z",
    "updated_at": "2023-03-03T14:25:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I might want to reproduce this locally. Can you estimate the minimal steps to reproduce this? If I spin up a new network, but don't start the batcher yet, produce a good amount of L2 tx volume, then spin up the batcher after a few hours, would that already trigger it?\r\n\r\nYou can change the code in txmgr.go, always return an error in SendTransaction(), and print the data in nextTxData, you will find the version byte is repeated repeatedly.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1453609597/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1453609901",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4937#issuecomment-1453609901",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4937",
    "id": 1453609901,
    "node_id": "IC_kwDODjvEJM5WpFOt",
    "user": {
      "login": "sebastianst",
      "id": 2607372,
      "node_id": "MDQ6VXNlcjI2MDczNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebastianst",
      "html_url": "https://github.com/sebastianst",
      "followers_url": "https://api.github.com/users/sebastianst/followers",
      "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
      "organizations_url": "https://api.github.com/users/sebastianst/orgs",
      "repos_url": "https://api.github.com/users/sebastianst/repos",
      "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebastianst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-03T14:25:55Z",
    "updated_at": "2023-03-03T14:25:55Z",
    "author_association": "MEMBER",
    "body": "Thanks! That should fix it indeed! I'll also take a closer look whether it makes sense to clean this up with a small refactor, because this prepending and appending of version zeros is quite error prone ðŸ˜… ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1453609901/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
