{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4717",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4717/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4717/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4717/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/4717",
  "id": 1534647873,
  "node_id": "I_kwDODjvEJM5beN5B",
  "number": 4717,
  "title": "L2 total fee issue",
  "user": {
    "login": "PoulWalcker",
    "id": 67789432,
    "node_id": "MDQ6VXNlcjY3Nzg5NDMy",
    "avatar_url": "https://avatars.githubusercontent.com/u/67789432?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/PoulWalcker",
    "html_url": "https://github.com/PoulWalcker",
    "followers_url": "https://api.github.com/users/PoulWalcker/followers",
    "following_url": "https://api.github.com/users/PoulWalcker/following{/other_user}",
    "gists_url": "https://api.github.com/users/PoulWalcker/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/PoulWalcker/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/PoulWalcker/subscriptions",
    "organizations_url": "https://api.github.com/users/PoulWalcker/orgs",
    "repos_url": "https://api.github.com/users/PoulWalcker/repos",
    "events_url": "https://api.github.com/users/PoulWalcker/events{/privacy}",
    "received_events_url": "https://api.github.com/users/PoulWalcker/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-01-16T10:06:14Z",
  "updated_at": "2023-01-18T10:56:48Z",
  "closed_at": "2023-01-17T22:30:48Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Hello Optimism!** @smartcontracts \r\n\r\nWe are GTON team \r\n@drinkius @slavastartsev\r\n\r\nWe faced with fee issue while deploying fork of pre-bedrock develop branch on BSC testnet network. \r\nTotal fee is a sum of l1 fee and l2 fee.\r\nRPC request does transactions with low trx fees which includes only l2fee. We've checked l2geth logs and they are all good. Also we can see  l1fee and l2fee in method CalculateTotalFee. But metamask and other libraries like web3js don`t include l1fee.\r\n\r\n**Logs of l2geth container:**\r\n\r\n`l2geth_1           | ERROR[01-16|09:58:13.651] verifyFee =>                             gpo=\"&{l1GasPrice:0xc025fd22a0 l2GasPrice:0xc025fd2260 overhead:0xc025fd22e0 scalar:0xc014f83230 l1GasPriceLock:{w:{state:0 sema:0} writerSem:0 readerSem:0 readerCount:0 readerWait:0} l2GasPriceLock:{w:{state:0 sema:0} writerSem:0 readerSem:0 readerCount:0 readerWait:0} overheadLock:{w:{state:0 sema:0} writerSem:0 readerSem:0 readerCount:0 readerWait:0} scalarLock:{w:{state:0 sema:0} writerSem:0 readerSem:0 readerCount:0 readerWait:0}}\"\r\nl2geth_1           | ERROR[01-16|09:58:13.652] CalculateTotalFee =>                     raw=\"[239 131 1 94 78 133 99 234 65 114 128 130 82 8 148 158 29 197 147 195 69 175 137 71 86 88 196 254 53 47 102 71 202 107 88 136 13 224 182 179 167 100 0 0 128]\" overhead=2750 l1GasPrice=3000000000000 scalar=1\r\nl2geth_1           | ERROR[01-16|09:58:13.652] CalculateTotalFee =>                     l1Fee=13602000000000000\r\nl2geth_1           | ERROR[01-16|09:58:13.652] CalculateTotalFee =>                     l2GasLimit=21000\r\nl2geth_1           | ERROR[01-16|09:58:13.652] CalculateTotalFee =>                     l2Fee=9011770320000000\r\nl2geth_1           | ERROR[01-16|09:58:13.652] CalculateTotalFee =>                     fee=22613770320000000\r\nl2geth_1           | ERROR[01-16|09:58:13.652] verifyFee =>                             cost=1000000000000000000\r\nl2geth_1           | ERROR[01-16|09:58:13.652] Updating cost \r\nl2geth_1           | ERROR[01-16|09:58:13.652] verifyFee =>                             cost=1022613770320000000\r\nl2geth_1           | ERROR[01-16|09:58:13.652] verifyFee =>                             state=\"&{db:0xc000169b60 trie:0xc02e83cbe0 stateObjects:map[] stateObjectsPending:map[] stateObjectsDirty:map[] dbErr:<nil> refund:0 thash:[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] bhash:[0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] txIndex:0 logs:map[] logSize:0 preimages:map[] accessList:0xc02e983220 journal:0xc02e983200 validRevisions:[] nextRevisionId:0 AccountReads:0s AccountHashes:0s AccountUpdates:0s AccountCommits:0s StorageReads:0s StorageHashes:0s StorageUpdates:0s StorageCommits:0s}\"\r\nl2geth_1           | ERROR[01-16|09:58:13.652] verifyFee =>                             from=0x1bD26a3054C7B47CE4DCeE3E1078a2e3EdC34581\r\nl2geth_1           | ERROR[01-16|09:58:13.652] verifyFee =>                             l2GasPrice=429131920000\r\nl2geth_1           | ERROR[01-16|09:58:13.652] verifyFee =>                             opts=\"{UserGasPrice:+429131920000 ExpectedGasPrice:+429131920000 ThresholdUp:+1.1 ThresholdDown:+0.9}\"\r\nl2geth_1           | TRACE[01-16|09:58:13.652] Sequencer transaction validation         hash=0xc2637230acdb4cfb3a88fc948ae930321ab3495526468ec49234628b2d484cbe\r\nl2geth_1           | INFO [01-16|09:58:13.653] Updating latest timestamp                timestamp=2023-01-16T09:58:13+0000 unix=1673863093\r\nl2geth_1           | DEBUG[01-16|09:58:13.653] Applying transaction to tip              index=153803 hash=0xc2637230acdb4cfb3a88fc948ae930321ab3495526468ec49234628b2d484cbe origin=sequencer\r\nl2geth_1           | TRACE[01-16|09:58:13.653] Waiting for transaction to be added to chain hash=0xc2637230acdb4cfb3a88fc948ae930321ab3495526468ec49234628b2d484cbe\r\nl2geth_1           | DEBUG[01-16|09:58:13.653] Attempting to commit rollup transaction  hash=0xc2637230acdb4cfb3a88fc948ae930321ab3495526468ec49234628b2d484cbe\r\nl2geth_1           | DEBUG[01-16|09:58:13.654] Served eth_chainId                       conn=172.21.0.5:36182      reqid=15352                                t=27.91Âµs\r\nl2geth_1           | ERROR[01-16|09:58:13.655] ApplyTransaction =>                      l1Fee=13602000000000000 l1GasPrice=3000000000000 l1GasUsed=4534 scalar=1\r\nl2geth_1           | ERROR[01-16|09:58:13.656] ApplyMessage =>                          NewStateTransition=\"&{gp:0xc02e98dec0 msg:{to:0xc02df794b8 from:[27 210 106 48 84 199 180 124 228 220 238 62 16 120 162 227 237 195 69 129] nonce:89678 amount:0xc02e982f40 gasLimit:21000 gasPrice:0xc02e9d8240 data:[] checkNonce:true accessList:[] l1Timestamp:1673863093 l1BlockNumber:0xc02e9833e0 queueOrigin:0} gas:0 gasPrice:0xc02e9d8240 initialGas:0 value:0xc02e982f40 data:[] \r\n`\r\n\r\n**Metamask request:**\r\n<img width=\"360\" alt=\"Screen Shot 2023-01-16 at 2 02 41 PM\" src=\"https://user-images.githubusercontent.com/67789432/212651328-97ef40b9-89b0-4940-87fc-8d34c7271dce.png\">\r\n\r\n* GasPrice was increased and equals 429131920000\r\n\r\n**Optimism-tutorial/sdk-estimate-gas script**\r\n<img width=\"659\" alt=\"Screen Shot 2023-01-16 at 1 53 24 PM\" src=\"https://user-images.githubusercontent.com/67789432/212649473-c88d5b9d-c16b-4a16-b615-c411e3bd5937.png\">\r\n\r\nPull request: https://github.com/GTON-capital/optimism/pull/2 \r\n\r\nChainID: 50021\r\nCurrency symbol: GCD\r\nRPC URL: http://170.187.138.20:8545/ \r\n\r\nWe used a Berin block set at 152250 block height. You can check genesis setup here http://170.187.138.20:8080/state-dump.latest.json. Other flags for hardforks of genesis were taken from optimism deployment config.\r\n",
  "closed_by": {
    "login": "tynes",
    "id": 6626818,
    "node_id": "MDQ6VXNlcjY2MjY4MTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tynes",
    "html_url": "https://github.com/tynes",
    "followers_url": "https://api.github.com/users/tynes/followers",
    "following_url": "https://api.github.com/users/tynes/following{/other_user}",
    "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
    "organizations_url": "https://api.github.com/users/tynes/orgs",
    "repos_url": "https://api.github.com/users/tynes/repos",
    "events_url": "https://api.github.com/users/tynes/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tynes/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4717/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4717/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1386171030",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4717#issuecomment-1386171030",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4717",
    "id": 1386171030,
    "node_id": "IC_kwDODjvEJM5Sn0qW",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-17T22:30:07Z",
    "updated_at": "2023-01-17T22:30:07Z",
    "author_association": "CONTRIBUTOR",
    "body": "metamask will need to add the L1 fee and L2 fee together. The L1 fee is fetched from the `GasPriceOracle` and the L2 fee is fetched just like how you would fetch the fee on an L1 network. I believe metamask turns on features based on chain ids",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1386171030/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1386171730",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4717#issuecomment-1386171730",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4717",
    "id": 1386171730,
    "node_id": "IC_kwDODjvEJM5Sn01S",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-17T22:30:48Z",
    "updated_at": "2023-01-17T22:30:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing this because it is not an optimism issue, you will need to bump fees in metamask manually or talk to them about supporting your chain id",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1386171730/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1386207373",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4717#issuecomment-1386207373",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4717",
    "id": 1386207373,
    "node_id": "IC_kwDODjvEJM5Sn9iN",
    "user": {
      "login": "drinkius",
      "id": 1757619,
      "node_id": "MDQ6VXNlcjE3NTc2MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1757619?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/drinkius",
      "html_url": "https://github.com/drinkius",
      "followers_url": "https://api.github.com/users/drinkius/followers",
      "following_url": "https://api.github.com/users/drinkius/following{/other_user}",
      "gists_url": "https://api.github.com/users/drinkius/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/drinkius/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/drinkius/subscriptions",
      "organizations_url": "https://api.github.com/users/drinkius/orgs",
      "repos_url": "https://api.github.com/users/drinkius/repos",
      "events_url": "https://api.github.com/users/drinkius/events{/privacy}",
      "received_events_url": "https://api.github.com/users/drinkius/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-17T23:09:53Z",
    "updated_at": "2023-01-18T10:56:48Z",
    "author_association": "NONE",
    "body": "@tynes It's not Metamask's issue, the gas isn't being taken at the l2geth's level and the transactions are being added to chain despite taking only the L2 portion of gas, no L1 portion is taken. But I'm going to re-check our transaction reciepts maybe I've missed something here\r\n\r\nUPD: seems like indeed we've been checking the receipts wrongly, will try to address Metamask issue as you've mentioned, thanks a lot!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1386207373/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
