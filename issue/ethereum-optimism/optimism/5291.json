{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5291",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5291/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5291/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5291/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/5291",
  "id": 1646036145,
  "node_id": "I_kwDODjvEJM5iHISx",
  "number": 5291,
  "title": "op-service/txmgr: Transaction Manager Metrics",
  "user": {
    "login": "sebastianst",
    "id": 2607372,
    "node_id": "MDQ6VXNlcjI2MDczNzI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/sebastianst",
    "html_url": "https://github.com/sebastianst",
    "followers_url": "https://api.github.com/users/sebastianst/followers",
    "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
    "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
    "organizations_url": "https://api.github.com/users/sebastianst/orgs",
    "repos_url": "https://api.github.com/users/sebastianst/repos",
    "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
    "received_events_url": "https://api.github.com/users/sebastianst/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2978714528,
      "node_id": "MDU6TGFiZWwyOTc4NzE0NTI4",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "C2E0C6",
      "default": true,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-03-29T15:18:29Z",
  "updated_at": "2023-05-10T12:28:46Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "# Context\r\n\r\nThe transaction manager `op-service/txmgr` is shared between the `op-batcher` and `op-proposer`. So adding metrics to the txmgr automatically benefits both services.\r\n\r\n# Description\r\n\r\n## Architecture\r\n\r\n- [x] Create new package `op-service/txmgr/metrics` with a reusable metrics struct, so it can be embedded into the `op-batcher/metrics.Metrics` and `op-proposer/metrics.Metrics` structs.\r\n  - In this sense, the tx mgr metrics component is more similar to the reusable `op-service/metrics.RefMetrics` struct. It should have a ctor similar to `MakeRefMetrics` so it can be embedded into both batcher and proposer metrics.\r\n  - All individual metrics should also set the `GaugeOpts.Subsystem` field to `\"txmgr\"`. So effectively, individual metrics should result in having names like `op_batcher_default_txmgr_nonce`.\r\n  - [x]  `op-service/txmgr/metrics` package should have an interface `Metricer` and the two implementations `Metrics` and `NoopMetrics` (similar to `RefMetrics`). The txmgr ctor should receive a `Metricer` .\r\n- [x] Embed and initialize `Metrics` and `NoopMetrics` in the respective batcher and proposer metrics\r\n- [x] Move balance metrics from batcher & proposer into the tx-manager metrics\r\n\r\n## List of Metrics\r\n\r\n- [x] Gauge & Histogram of confirmation latency (likely seconds, from when tx was first sent to when it was included on chain).\r\n  - Can also have from when the final bumped price one was submitted to when that one got included.\r\n- [x] Counter/Histogram of the number of times it bumped a tx after it sent the one that got included.\r\n- [x] Gauge of send state errors (pre-populated list of errors + bucket for unknown)\r\n- [x] Gauge/Histogram of how many times it had to bump the TX price\r\n- [x] Gauge for current nonce\r\n- [ ] Counter of gas / fees spent on L1\r\n- [ ] Histogram of gas / fees spent on L1 (maybe more interesting in the batcher)\r\n- [ ] Gauge/Histogram of basefee/tip for submitting transactions\r\n\r\n**These metrics can be added incrementally with multiple PRs.**\r\n\r\n# Testing\r\n\r\nYou can test your new metrics locally by spinning up a devnet with `make devnet-up` and then watching `http://localhost:7300/`. Check that all the new txmgr metrics are there and show sensible values.\r\n\r\nFixes CLI-3319",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5291/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5291/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1492958540",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/5291#issuecomment-1492958540",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5291",
    "id": 1492958540,
    "node_id": "IC_kwDODjvEJM5Y_L1M",
    "user": {
      "login": "Ray-Escobar",
      "id": 44137386,
      "node_id": "MDQ6VXNlcjQ0MTM3Mzg2",
      "avatar_url": "https://avatars.githubusercontent.com/u/44137386?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Ray-Escobar",
      "html_url": "https://github.com/Ray-Escobar",
      "followers_url": "https://api.github.com/users/Ray-Escobar/followers",
      "following_url": "https://api.github.com/users/Ray-Escobar/following{/other_user}",
      "gists_url": "https://api.github.com/users/Ray-Escobar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Ray-Escobar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Ray-Escobar/subscriptions",
      "organizations_url": "https://api.github.com/users/Ray-Escobar/orgs",
      "repos_url": "https://api.github.com/users/Ray-Escobar/repos",
      "events_url": "https://api.github.com/users/Ray-Escobar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Ray-Escobar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-01T12:34:44Z",
    "updated_at": "2023-04-01T12:34:44Z",
    "author_association": "NONE",
    "body": "hi guys, happy to help here. If you add me to the assignees I can add some metrics.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1492958540/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1497331487",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/5291#issuecomment-1497331487",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5291",
    "id": 1497331487,
    "node_id": "IC_kwDODjvEJM5ZP3cf",
    "user": {
      "login": "sebastianst",
      "id": 2607372,
      "node_id": "MDQ6VXNlcjI2MDczNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebastianst",
      "html_url": "https://github.com/sebastianst",
      "followers_url": "https://api.github.com/users/sebastianst/followers",
      "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
      "organizations_url": "https://api.github.com/users/sebastianst/orgs",
      "repos_url": "https://api.github.com/users/sebastianst/repos",
      "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebastianst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-05T11:28:24Z",
    "updated_at": "2023-04-05T11:28:24Z",
    "author_association": "MEMBER",
    "body": "Hey @Ray-Escobar thanks for the offer! We're currently actively adding some more metrics already with https://github.com/ethereum-optimism/optimism/pull/5322 and #5295 . Which additional metrics would you be interested in adding?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1497331487/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1540033337",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/5291#issuecomment-1540033337",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5291",
    "id": 1540033337,
    "node_id": "IC_kwDODjvEJM5byws5",
    "user": {
      "login": "shubhamshd",
      "id": 30751049,
      "node_id": "MDQ6VXNlcjMwNzUxMDQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/30751049?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shubhamshd",
      "html_url": "https://github.com/shubhamshd",
      "followers_url": "https://api.github.com/users/shubhamshd/followers",
      "following_url": "https://api.github.com/users/shubhamshd/following{/other_user}",
      "gists_url": "https://api.github.com/users/shubhamshd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shubhamshd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shubhamshd/subscriptions",
      "organizations_url": "https://api.github.com/users/shubhamshd/orgs",
      "repos_url": "https://api.github.com/users/shubhamshd/repos",
      "events_url": "https://api.github.com/users/shubhamshd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shubhamshd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-09T12:32:14Z",
    "updated_at": "2023-05-09T12:32:14Z",
    "author_association": "NONE",
    "body": "Hi @sebastianst can you please close the issue, if already resolved??\r\nIts quite confusing for noobies to understand the status with pr merged but issue still open!!!",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1540033337/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1540839649",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/5291#issuecomment-1540839649",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5291",
    "id": 1540839649,
    "node_id": "IC_kwDODjvEJM5b11jh",
    "user": {
      "login": "sebastianst",
      "id": 2607372,
      "node_id": "MDQ6VXNlcjI2MDczNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebastianst",
      "html_url": "https://github.com/sebastianst",
      "followers_url": "https://api.github.com/users/sebastianst/followers",
      "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
      "organizations_url": "https://api.github.com/users/sebastianst/orgs",
      "repos_url": "https://api.github.com/users/sebastianst/repos",
      "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebastianst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-09T20:21:16Z",
    "updated_at": "2023-05-09T20:21:16Z",
    "author_association": "MEMBER",
    "body": "Hi @shubhamshd this issue covers metrics that have partially been implemented by the linked PR. But since there are still some metrics left to implement, we didn't close the issue yet. That's also why we wrote above \"These metrics can be added incrementally with multiple PRs.\" You're welcome to add the missing metrics in a future PR, if you need them :)",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1540839649/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1542122975",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/5291#issuecomment-1542122975",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5291",
    "id": 1542122975,
    "node_id": "IC_kwDODjvEJM5b6u3f",
    "user": {
      "login": "shubhamshd",
      "id": 30751049,
      "node_id": "MDQ6VXNlcjMwNzUxMDQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/30751049?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shubhamshd",
      "html_url": "https://github.com/shubhamshd",
      "followers_url": "https://api.github.com/users/shubhamshd/followers",
      "following_url": "https://api.github.com/users/shubhamshd/following{/other_user}",
      "gists_url": "https://api.github.com/users/shubhamshd/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shubhamshd/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shubhamshd/subscriptions",
      "organizations_url": "https://api.github.com/users/shubhamshd/orgs",
      "repos_url": "https://api.github.com/users/shubhamshd/repos",
      "events_url": "https://api.github.com/users/shubhamshd/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shubhamshd/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-10T12:28:46Z",
    "updated_at": "2023-05-10T12:28:46Z",
    "author_association": "NONE",
    "body": "thanks @sebastianst for clarifying\r\nPlease let me know, if there is any issue I can help you with!!!\r\nI have good knowledge in javascript and solidity.\r\nI am still trying to understand the op stack project throughly, however if there is any issue, please let me know :)\r\nAll the good first open issues are already completed, I guess.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1542122975/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
