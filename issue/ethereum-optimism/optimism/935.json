{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/935",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/935/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/935/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/935/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/935",
  "id": 898594049,
  "node_id": "MDU6SXNzdWU4OTg1OTQwNDk=",
  "number": 935,
  "title": "Hardhat ethers does not correctly instantiate a provider with the OVM",
  "user": {
    "login": "shanefontaine",
    "id": 9441295,
    "node_id": "MDQ6VXNlcjk0NDEyOTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9441295?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/shanefontaine",
    "html_url": "https://github.com/shanefontaine",
    "followers_url": "https://api.github.com/users/shanefontaine/followers",
    "following_url": "https://api.github.com/users/shanefontaine/following{/other_user}",
    "gists_url": "https://api.github.com/users/shanefontaine/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/shanefontaine/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/shanefontaine/subscriptions",
    "organizations_url": "https://api.github.com/users/shanefontaine/orgs",
    "repos_url": "https://api.github.com/users/shanefontaine/repos",
    "events_url": "https://api.github.com/users/shanefontaine/events{/privacy}",
    "received_events_url": "https://api.github.com/users/shanefontaine/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832490,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNDkw",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bug",
      "name": "C-bug",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: This is a bug."
    },
    {
      "id": 2981541772,
      "node_id": "MDU6TGFiZWwyOTgxNTQxNzcy",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/P-confirmed",
      "name": "P-confirmed",
      "color": "BFD4F2",
      "default": false,
      "description": "A confirmed bug"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-05-21T22:04:29Z",
  "updated_at": "2021-05-24T18:43:27Z",
  "closed_at": "2021-05-23T09:50:32Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\nUsing Hardhat's built-in ethers object does not correctly instantiate a provider using the OVM. Because of this, you cannot perform tasks like deploying a contract.\r\n\r\nThis only happens when `ovm: true` is set in hardhat.config.js.\r\n\r\n**To Reproduce**\r\n1. Clone [this](https://github.com/shanefontaine/optimism-tutorial) forked repo of the optimism-tutorial\r\n2. Follow the README instructions to run the deployment\r\n3. Observe that the deployment does not work and produces the following error `Error: could not detect network (event=\"noNetwork\", code=NETWORK_ERROR, version=providers/5.1.2)`\r\n4. In `deploy/ERC20.deploy.js`, comment out [lines 11-12](https://github.com/shanefontaine/optimism-tutorial/blob/main/deploy/ERC20.deploy.js#L11-L12) (Hardhat ethers instantiation) and comment in [lines 6-8](https://github.com/shanefontaine/optimism-tutorial/blob/main/deploy/ERC20.deploy.js#L6-L8) (native ethers instantiation).\r\n5. Run the deployment again and observe that the contract gets deployed.\r\n\r\n**Expected behavior**\r\nI would expect the Hardhat ethers implementation to work the same as the native ethers implementation when deploying a contract.\r\n\r\n**System Specs:**\r\nAll relevant packages are in the [forked repo](https://github.com/shanefontaine/optimism-tutorial).\r\n\r\n**Additional context**\r\nAnother way to verify that the provider is not working correctly is by inserting `await ethers.provider.ready` and observing that the script execution never passes that line.",
  "closed_by": {
    "login": "gakonst",
    "id": 17802178,
    "node_id": "MDQ6VXNlcjE3ODAyMTc4",
    "avatar_url": "https://avatars.githubusercontent.com/u/17802178?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/gakonst",
    "html_url": "https://github.com/gakonst",
    "followers_url": "https://api.github.com/users/gakonst/followers",
    "following_url": "https://api.github.com/users/gakonst/following{/other_user}",
    "gists_url": "https://api.github.com/users/gakonst/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/gakonst/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/gakonst/subscriptions",
    "organizations_url": "https://api.github.com/users/gakonst/orgs",
    "repos_url": "https://api.github.com/users/gakonst/repos",
    "events_url": "https://api.github.com/users/gakonst/events{/privacy}",
    "received_events_url": "https://api.github.com/users/gakonst/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/935/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/935/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/846319686",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/935#issuecomment-846319686",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/935",
    "id": 846319686,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NjMxOTY4Ng==",
    "user": {
      "login": "shanefontaine",
      "id": 9441295,
      "node_id": "MDQ6VXNlcjk0NDEyOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9441295?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shanefontaine",
      "html_url": "https://github.com/shanefontaine",
      "followers_url": "https://api.github.com/users/shanefontaine/followers",
      "following_url": "https://api.github.com/users/shanefontaine/following{/other_user}",
      "gists_url": "https://api.github.com/users/shanefontaine/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shanefontaine/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shanefontaine/subscriptions",
      "organizations_url": "https://api.github.com/users/shanefontaine/orgs",
      "repos_url": "https://api.github.com/users/shanefontaine/repos",
      "events_url": "https://api.github.com/users/shanefontaine/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shanefontaine/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-22T00:26:18Z",
    "updated_at": "2021-05-22T00:51:37Z",
    "author_association": "NONE",
    "body": "It looks like the issue may be [this](https://github.com/ethereum-optimism/optimism/blob/68871b7a9e0989a7b126e800ab1b6b19edab2293/packages/hardhat-ovm/src/index.ts#L251) line in @eth-optimism/hardhat-ovm.\r\n\r\nWhen running the script, I see that `hre.ethers.provider.url` is `undefined`. If I switch it to `hre.network.config.url` instead, everyting appears to work as expected.\r\n\r\nEdit: it appears as though unexpected signers are used when this line is changed, so maybe this is not a fix.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/846319686/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/846450322",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/935#issuecomment-846450322",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/935",
    "id": 846450322,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NjQ1MDMyMg==",
    "user": {
      "login": "platocrat",
      "id": 37757724,
      "node_id": "MDQ6VXNlcjM3NzU3NzI0",
      "avatar_url": "https://avatars.githubusercontent.com/u/37757724?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/platocrat",
      "html_url": "https://github.com/platocrat",
      "followers_url": "https://api.github.com/users/platocrat/followers",
      "following_url": "https://api.github.com/users/platocrat/following{/other_user}",
      "gists_url": "https://api.github.com/users/platocrat/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/platocrat/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/platocrat/subscriptions",
      "organizations_url": "https://api.github.com/users/platocrat/orgs",
      "repos_url": "https://api.github.com/users/platocrat/repos",
      "events_url": "https://api.github.com/users/platocrat/events{/privacy}",
      "received_events_url": "https://api.github.com/users/platocrat/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-22T19:02:09Z",
    "updated_at": "2021-05-22T19:02:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "> It looks like the issue may be [this](https://github.com/ethereum-optimism/optimism/blob/68871b7a9e0989a7b126e800ab1b6b19edab2293/packages/hardhat-ovm/src/index.ts#L251) line in @eth-optimism/hardhat-ovm.\r\n> \r\n> When running the script, I see that `hre.ethers.provider.url` is `undefined`. If I switch it to `hre.network.config.url` instead, everyting appears to work as expected.\r\n> \r\n> Edit: it appears as though unexpected signers are used when this line is changed, so maybe this is not a fix.\r\n\r\nHey @shanefontaine, I just went through your repro steps and didn't see any issues with Hardhat ethers deployment. \r\nBoth HH and native ethers deployments ran in the same fashion.\r\n\r\nSo, I'm sure why you're getting this error.\r\ncc: @smartcontracts ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/846450322/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/846509109",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/935#issuecomment-846509109",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/935",
    "id": 846509109,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NjUwOTEwOQ==",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-23T05:58:05Z",
    "updated_at": "2021-05-23T05:58:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ok I was able to reproduce this! Taking a look.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/846509109/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/846510412",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/935#issuecomment-846510412",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/935",
    "id": 846510412,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NjUxMDQxMg==",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-23T06:11:29Z",
    "updated_at": "2021-05-23T06:11:36Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think this PR should fix: https://github.com/ethereum-optimism/optimism/pull/938",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/846510412/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/846535264",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/935#issuecomment-846535264",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/935",
    "id": 846535264,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NjUzNTI2NA==",
    "user": {
      "login": "gakonst",
      "id": 17802178,
      "node_id": "MDQ6VXNlcjE3ODAyMTc4",
      "avatar_url": "https://avatars.githubusercontent.com/u/17802178?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/gakonst",
      "html_url": "https://github.com/gakonst",
      "followers_url": "https://api.github.com/users/gakonst/followers",
      "following_url": "https://api.github.com/users/gakonst/following{/other_user}",
      "gists_url": "https://api.github.com/users/gakonst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/gakonst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/gakonst/subscriptions",
      "organizations_url": "https://api.github.com/users/gakonst/orgs",
      "repos_url": "https://api.github.com/users/gakonst/repos",
      "events_url": "https://api.github.com/users/gakonst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/gakonst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-23T09:50:57Z",
    "updated_at": "2021-05-23T09:50:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "@shanefontaine #938 should address this issue, could you please confirm that Kelvin's fix was correct? Thank you for reporting.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/846535264/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/847249359",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/935#issuecomment-847249359",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/935",
    "id": 847249359,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0NzI0OTM1OQ==",
    "user": {
      "login": "shanefontaine",
      "id": 9441295,
      "node_id": "MDQ6VXNlcjk0NDEyOTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9441295?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/shanefontaine",
      "html_url": "https://github.com/shanefontaine",
      "followers_url": "https://api.github.com/users/shanefontaine/followers",
      "following_url": "https://api.github.com/users/shanefontaine/following{/other_user}",
      "gists_url": "https://api.github.com/users/shanefontaine/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/shanefontaine/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/shanefontaine/subscriptions",
      "organizations_url": "https://api.github.com/users/shanefontaine/orgs",
      "repos_url": "https://api.github.com/users/shanefontaine/repos",
      "events_url": "https://api.github.com/users/shanefontaine/events{/privacy}",
      "received_events_url": "https://api.github.com/users/shanefontaine/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-24T18:38:05Z",
    "updated_at": "2021-05-24T18:43:27Z",
    "author_association": "NONE",
    "body": "It appears as though that has fixed the provider issue. I am still seeing odd Signer behavior. Specifically, the array of private keys I am using for `accounts` in `hardhat.config.ts` is seemingly ignored.\r\n\r\nI believe #946 may resolve this specific issue. @miguelmota (author of that PR) has been debugging this with me.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/847249359/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
