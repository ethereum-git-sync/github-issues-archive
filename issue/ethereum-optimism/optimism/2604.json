{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2604",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2604/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2604/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2604/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/2604",
  "id": 1245767366,
  "node_id": "I_kwDODjvEJM5KQObG",
  "number": 2604,
  "title": "EVM incompatibility when a contract selfdestructs and sends its balance to itself",
  "user": {
    "login": "maraoz",
    "id": 287189,
    "node_id": "MDQ6VXNlcjI4NzE4OQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/287189?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/maraoz",
    "html_url": "https://github.com/maraoz",
    "followers_url": "https://api.github.com/users/maraoz/followers",
    "following_url": "https://api.github.com/users/maraoz/following{/other_user}",
    "gists_url": "https://api.github.com/users/maraoz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/maraoz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/maraoz/subscriptions",
    "organizations_url": "https://api.github.com/users/maraoz/orgs",
    "repos_url": "https://api.github.com/users/maraoz/repos",
    "events_url": "https://api.github.com/users/maraoz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/maraoz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832490,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNDkw",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bug",
      "name": "C-bug",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: This is a bug."
    },
    {
      "id": 3152093041,
      "node_id": "MDU6TGFiZWwzMTUyMDkzMDQx",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/P-wontfix",
      "name": "P-wontfix",
      "color": "C5DEF5",
      "default": false,
      "description": "Something we won't fix because it's intended behavior"
    },
    {
      "id": 4266439918,
      "node_id": "LA_kwDODjvEJM7-TLTu",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bedrock-fixes-this",
      "name": "C-bedrock-fixes-this",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: Something Bedrock fixes"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-05-23T22:36:49Z",
  "updated_at": "2022-06-25T00:40:01Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\nI was playing around with Optimism yesterday and I found that if a contract selfdestructs and sends the remaining balance to itself, that balance remains on the contract after it is destroyed. This is different from the EVM behavior, which in that case leaves the contract with 0 balance, effectively destroying some ether. \r\n\r\nI later found that @saurik already reports this on his [\"Attacking an Ethereum L2 with Unbridled Optimism\" blog post](https://www.saurik.com/optimism.html). Maybe this EVM discrepancy should be added to [Known Issues](https://community.optimism.io/docs/developers/known-issues/#) page on the docs? I don't think fixing it merits a hard fork, it seems inocuous.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Deploy a contract that has some function which selfdestructs the contract sending remaining balance to itself. eg:\r\n```\r\ncontract Suicidal {\r\n    constructor() payable {\r\n      selfdestruct(payable(address(this)));\r\n    }\r\n}\r\n```\r\n2. Deploy that contract and execute the selfdestruct op.\r\n4. Check the contract's balance\r\n5. Should be 0, but it's not.\r\n\r\n**Expected behavior**\r\nEVM equivalence would require this scenario to leave the contract with 0 balance.\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2604/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2604/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1135493017",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/2604#issuecomment-1135493017",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/2604",
    "id": 1135493017,
    "node_id": "IC_kwDODjvEJM5Drj-Z",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-24T07:08:26Z",
    "updated_at": "2022-05-24T07:08:26Z",
    "author_association": "CONTRIBUTOR",
    "body": "I agree that this should be included in Known Issues. Note that this will be fixed as part of the Bedrock upgrade. It's strongly recommended that you do not write contract logic based on this behavior, since it's not the expected behavior on Ethereum and will be removed in Bedrock. ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1135493017/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
