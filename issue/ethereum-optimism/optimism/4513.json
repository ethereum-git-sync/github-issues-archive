{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4513",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4513/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4513/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4513/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/4513",
  "id": 1499743669,
  "node_id": "I_kwDODjvEJM5ZZEW1",
  "number": 4513,
  "title": "Build docker images for ARM",
  "user": {
    "login": "0xabhinav",
    "id": 97421185,
    "node_id": "U_kgDOBc6HgQ",
    "avatar_url": "https://avatars.githubusercontent.com/u/97421185?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/0xabhinav",
    "html_url": "https://github.com/0xabhinav",
    "followers_url": "https://api.github.com/users/0xabhinav/followers",
    "following_url": "https://api.github.com/users/0xabhinav/following{/other_user}",
    "gists_url": "https://api.github.com/users/0xabhinav/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/0xabhinav/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/0xabhinav/subscriptions",
    "organizations_url": "https://api.github.com/users/0xabhinav/orgs",
    "repos_url": "https://api.github.com/users/0xabhinav/repos",
    "events_url": "https://api.github.com/users/0xabhinav/events{/privacy}",
    "received_events_url": "https://api.github.com/users/0xabhinav/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832555,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNTU1",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-feature-request",
      "name": "C-feature-request",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: A feature request."
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-12-16T07:37:45Z",
  "updated_at": "2023-02-07T04:22:41Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!--\r\nNeed help?\r\nRefer to our contributing guidelines for additional information about making a good issue:\r\nhttps://github.com/ethereum-optimism/.github/blob/master/CONTRIBUTING.md\r\n-->\r\n\r\n**Is your feature request related to a problem? Please describe.**\r\nHi,\r\nWould it be possible to build your docker images for ARM? This will help us run nodes on m1 macs and graviton aws instances.\r\nI'm specially interested in the super-awesome healthcheck image since it works for other EVM chains' nodes as well and help us keep track of nodes going bad.\r\nPlease lmk if it's possible to build a dockerfile which will allow me to do this myself too instead. Thanks!\r\n\r\n**Describe the solution you'd like**\r\nA clear and concise description of what you want to happen.\r\n\r\n**Describe alternatives you've considered**\r\nTried writing the dockerfile below, ran it on an AWS graviton instance and kept getting `'Unknown system error -8'`\r\n```dockerfile\r\nFROM ethereumoptimism/foundry:latest as foundry\r\nFROM node:16-alpine3.14\r\n\r\nWORKDIR /\r\nRUN apk --no-cache add curl \\\r\n    jq \\\r\n    python3 \\\r\n    ca-certificates \\\r\n    git \\\r\n    make \\\r\n    gcc \\\r\n    musl-dev \\\r\n    linux-headers \\\r\n    bash \\\r\n    build-base \\\r\n    gcompat \\\r\n    git\r\n\r\nRUN git clone https://github.com/ethereum-optimism/optimism.git\r\nCOPY --from=foundry /usr/local/bin/forge /usr/local/bin/forge\r\nCOPY --from=foundry /usr/local/bin/cast /usr/local/bin/cast\r\n\r\nWORKDIR /optimism\r\nRUN yarn install --frozen-lockfile && yarn cache clean\r\nRUN yarn build\r\n\r\n\r\nWORKDIR /optimism/packages/replica-healthcheck\r\nENTRYPOINT [\"npm\", \"run\", \"start\"]\r\n```\r\n\r\nI also tried just building `replica-healthcheck` and ended up getting a bunch of TypeScript compile errors.\r\n\r\n**Additional context**\r\nTraceback:-\r\n```\r\n=> ERROR [stage-1  8/10] RUN yarn build                                                                                                                 16.8s\r\n------\r\n > [stage-1  8/10] RUN yarn build:\r\n#0 0.786 yarn run v1.22.19\r\n#0 0.834 $ yarn lerna run build\r\n#0 1.175 $ /optimism/node_modules/.bin/lerna run build\r\n#0 1.577 lerna notice cli v4.0.0\r\n#0 1.580 lerna info versioning independent\r\n#0 1.677 lerna info Executing command in 14 packages: \"yarn run build\"\r\n#0 5.992 lerna info run Ran npm script 'build' in '@eth-optimism/core-utils' in 4.3s:\r\n#0 5.993 $ tsc -p tsconfig.json\r\n#0 7.961 lerna info run Ran npm script 'build' in '@eth-optimism/hardhat-deploy-config' in 6.3s:\r\n#0 7.961 $ tsc -p tsconfig.json\r\n#0 12.90 lerna info run Ran npm script 'build' in '@eth-optimism/common-ts' in 6.9s:\r\n#0 12.90 $ tsc -p tsconfig.json\r\n#0 16.69 lerna ERR! yarn run build exited 1 in '@eth-optimism/contracts-bedrock'\r\n#0 16.69 lerna ERR! yarn run build stdout:\r\n#0 16.69 $ yarn ts-node scripts/verify-foundry-install.ts\r\n#0 16.69 $ /optimism/node_modules/.bin/ts-node scripts/verify-foundry-install.ts\r\n#0 16.69 $ hardhat compile && yarn autogen:artifacts && yarn build:ts && yarn typechain\r\n#0 16.69 \r\n#0 16.69 info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\n#0 16.69 lerna ERR! yarn run build stderr:\r\n#0 16.69 Solidity 0.8.15 is not fully supported yet. You can still use Hardhat, but some features, like stack traces, might not work correctly.\r\n#0 16.69 \r\n#0 16.69 Learn more at https://hardhat.org/reference/solidity-support\r\n#0 16.69 \r\n#0 16.69 An unexpected error occurred:\r\n#0 16.69 Error: spawn Unknown system error -8\r\n#0 16.69     at ChildProcess.spawn (node:internal/child_process:413:11)\r\n#0 16.69     at spawn (node:child_process:700:9)\r\n#0 16.69     at /optimism/packages/contracts-bedrock/node_modules/@foundry-rs/hardhat-forge/src/forge/build/build.ts:36:26\r\n#0 16.69     at new Promise (<anonymous>)\r\n#0 16.69     at spawnBuild (/optimism/packages/contracts-bedrock/node_modules/@foundry-rs/hardhat-forge/src/forge/build/build.ts:35:10)\r\n#0 16.69     at async OverriddenTaskDefinition._action (/optimism/packages/contracts-bedrock/node_modules/@foundry-rs/hardhat-forge/src/forge/build/index.ts:20:5)\r\n#0 16.69     at async Environment._runTaskDefinition (/optimism/node_modules/hardhat/src/internal/core/runtime-environment.ts:219:14)\r\n#0 16.69     at async Environment.run (/optimism/node_modules/hardhat/src/internal/core/runtime-environment.ts:131:14)\r\n#0 16.69     at async main (/optimism/node_modules/hardhat/src/internal/cli/cli.ts:218:5) {\r\n#0 16.69   errno: -8,\r\n#0 16.69   code: 'Unknown system error -8',\r\n#0 16.69   syscall: 'spawn'\r\n#0 16.69 }\r\n#0 16.69 error Command failed with exit code 1.\r\n#0 16.69 lerna ERR! yarn run build exited 1 in '@eth-optimism/contracts-bedrock'\r\n#0 16.69 lerna WARN complete Waiting for 2 child processes to exit. CTRL-C to exit immediately.\r\n#0 16.71 error Command failed with exit code 1.\r\n#0 16.71 info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\n#0 16.73 error Command failed with exit code 1.\r\n#0 16.73 info Visit https://yarnpkg.com/en/docs/cli/run for documentation about this command.\r\n------\r\nfailed to solve: executor failed running [/bin/sh -c yarn build]: exit code: 1\r\n```",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4513/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4513/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1403097811",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4513#issuecomment-1403097811",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4513",
    "id": 1403097811,
    "node_id": "IC_kwDODjvEJM5ToZLT",
    "user": {
      "login": "meaghanfitzgerald",
      "id": 99047250,
      "node_id": "U_kgDOBedXUg",
      "avatar_url": "https://avatars.githubusercontent.com/u/99047250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/meaghanfitzgerald",
      "html_url": "https://github.com/meaghanfitzgerald",
      "followers_url": "https://api.github.com/users/meaghanfitzgerald/followers",
      "following_url": "https://api.github.com/users/meaghanfitzgerald/following{/other_user}",
      "gists_url": "https://api.github.com/users/meaghanfitzgerald/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/meaghanfitzgerald/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/meaghanfitzgerald/subscriptions",
      "organizations_url": "https://api.github.com/users/meaghanfitzgerald/orgs",
      "repos_url": "https://api.github.com/users/meaghanfitzgerald/repos",
      "events_url": "https://api.github.com/users/meaghanfitzgerald/events{/privacy}",
      "received_events_url": "https://api.github.com/users/meaghanfitzgerald/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-25T04:58:53Z",
    "updated_at": "2023-01-25T04:58:53Z",
    "author_association": "NONE",
    "body": "Hello, It looks like when the environment runs `run yarn build` it is trying to run a command that is not compatible with the AWS Graviton instances. It could also be due to some missing dependencies that are not specified in the Dockerfile that are required to run the command. Without more information about the specific error message and the environment in which the Dockerfile is being run, it is difficult to say for sure what the issue is.\r\n\r\nThis may not be super helpful considering you are running it within aws, but I often have issues building docker containers on my M1 Mac, and the issue is almost always fixed by changing the second line \r\n`FROM node:16-alpine3.14` \r\nto \r\n\r\n```\r\nFROM node:16-slim\r\nRUN apt-get update\r\nRUN apt-get install -y openssl\r\n```\r\n\r\nI hope this helps you get closer to resolving the issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1403097811/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
