{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8876",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8876/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8876/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8876/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/8876",
  "id": 2068931776,
  "node_id": "I_kwDODjvEJM57UWTA",
  "number": 8876,
  "title": "Easy wrong forks on op-geth/v1.101304.2 X op-node/v1.4.0 on mainnet?!",
  "user": {
    "login": "juno-yu",
    "id": 37950908,
    "node_id": "MDQ6VXNlcjM3OTUwOTA4",
    "avatar_url": "https://avatars.githubusercontent.com/u/37950908?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/juno-yu",
    "html_url": "https://github.com/juno-yu",
    "followers_url": "https://api.github.com/users/juno-yu/followers",
    "following_url": "https://api.github.com/users/juno-yu/following{/other_user}",
    "gists_url": "https://api.github.com/users/juno-yu/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/juno-yu/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/juno-yu/subscriptions",
    "organizations_url": "https://api.github.com/users/juno-yu/orgs",
    "repos_url": "https://api.github.com/users/juno-yu/repos",
    "events_url": "https://api.github.com/users/juno-yu/events{/privacy}",
    "received_events_url": "https://api.github.com/users/juno-yu/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2024-01-07T02:06:34Z",
  "updated_at": "2024-01-08T13:44:21Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!--\r\nNeed help?\r\nRefer to our contributing guidelines for additional information about making a good issue:\r\nhttps://github.com/ethereum-optimism/.github/blob/master/CONTRIBUTING.md\r\n-->\r\n\r\n**Describe the bug**\r\nEasy hardforks on op-geth/v1.101304.2 X op-node/v1.4.0 on mainnet - hit 3 times in 48hours (**All on different heights**)\r\n\r\n**To Reproduce**\r\nRun with op-geth/v1.101304.2 X op-node/v1.4.0 on mainnet , archive node , sync from L1\r\n\r\n**Expected behavior**\r\nNodes won't finalise wrong block\r\n\r\n**Screenshots**\r\nNodes finalize and stop at wrong blocks that didn't match with https://optimistic.etherscan.io/ && can't rollback by debugSetHead on op-geth (nodes would want rollback to older heights... which sounds taking very long time for ETA)\r\n\r\n**System Specs:**\r\n - OS: linux \r\n - Package Version (or commit hash): corresponding images on dockerhub for both components\r\n\r\n**Additional context**\r\n- Rolled back to   op-geth/v1.101304.2 X op-node/**v1.3.2** - then it was good for last 24hr on multiple nodes ",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8876/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8876/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1879933447",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/8876#issuecomment-1879933447",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8876",
    "id": 1879933447,
    "node_id": "IC_kwDODjvEJM5wDYIH",
    "user": {
      "login": "mslipper",
      "id": 67953,
      "node_id": "MDQ6VXNlcjY3OTUz",
      "avatar_url": "https://avatars.githubusercontent.com/u/67953?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mslipper",
      "html_url": "https://github.com/mslipper",
      "followers_url": "https://api.github.com/users/mslipper/followers",
      "following_url": "https://api.github.com/users/mslipper/following{/other_user}",
      "gists_url": "https://api.github.com/users/mslipper/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mslipper/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mslipper/subscriptions",
      "organizations_url": "https://api.github.com/users/mslipper/orgs",
      "repos_url": "https://api.github.com/users/mslipper/repos",
      "events_url": "https://api.github.com/users/mslipper/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mslipper/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-07T04:23:58Z",
    "updated_at": "2024-01-07T04:24:18Z",
    "author_association": "COLLABORATOR",
    "body": "Hi Juno,\r\n\r\nWhat do you mean by \"nodes finalize and stop at wrong blocks\" - are you saying that the node diverges from what's on Etherscan, or that the node halts outright? Or both? Can you please post some logs for us to see?\r\n\r\nLastly, are you running with `l1.trustrpc` set to true?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1879933447/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1879940186",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/8876#issuecomment-1879940186",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8876",
    "id": 1879940186,
    "node_id": "IC_kwDODjvEJM5wDZxa",
    "user": {
      "login": "juno-yu",
      "id": 37950908,
      "node_id": "MDQ6VXNlcjM3OTUwOTA4",
      "avatar_url": "https://avatars.githubusercontent.com/u/37950908?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/juno-yu",
      "html_url": "https://github.com/juno-yu",
      "followers_url": "https://api.github.com/users/juno-yu/followers",
      "following_url": "https://api.github.com/users/juno-yu/following{/other_user}",
      "gists_url": "https://api.github.com/users/juno-yu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/juno-yu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/juno-yu/subscriptions",
      "organizations_url": "https://api.github.com/users/juno-yu/orgs",
      "repos_url": "https://api.github.com/users/juno-yu/repos",
      "events_url": "https://api.github.com/users/juno-yu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/juno-yu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-07T04:56:42Z",
    "updated_at": "2024-01-07T04:56:42Z",
    "author_association": "NONE",
    "body": "> Hi Juno,\r\n> \r\n> What do you mean by \"nodes finalize and stop at wrong blocks\" - are you saying that the node diverges from what's on Etherscan, or that the node halts outright? Or both? Can you please post some logs for us to see?\r\n> \r\n> Lastly, are you running with `l1.trustrpc` set to true?\r\n\r\nYes\r\n\r\nThis was one of the node going wrong\r\n\r\n```\r\n t=2024-01-04T23:07:01+0000 lvl=info msg=\"no peers ready to handle block requests for more P2P requests for L2 block history\" target=114,388,037 end=0x00008fbf237170d75421d65fad1bc435c91d5\r\n 246aec4b4169b02fa5782f9c143:114393561 current=114,393,330\r\nthat one stucking at 114,388,037\r\n```\r\n\r\nseem that node hardforked to some where , hash mismatch\r\n ```\r\n   \"checkTime\": \"2024-01-04T23:45:58.456Z\",\r\n   \"blockHeight\": 114388037,\r\n   \"blockHash\": \"0xdf8af4ce7e93aa91b3e3f9a1e667155baab5b34a17b0de7fe16d8704fdf7ab46\",\r\n   \"blockTime\": \"2024-01-04T13:27:31.000Z\",\r\n```\r\nhttps://optimistic.etherscan.io/block/114388037\r\nexpect 0xd915e7daf532a72aa626207501b44727d95af206283237f01386ec084902bc95\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1879940186/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1879941761",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/8876#issuecomment-1879941761",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8876",
    "id": 1879941761,
    "node_id": "IC_kwDODjvEJM5wDaKB",
    "user": {
      "login": "juno-yu",
      "id": 37950908,
      "node_id": "MDQ6VXNlcjM3OTUwOTA4",
      "avatar_url": "https://avatars.githubusercontent.com/u/37950908?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/juno-yu",
      "html_url": "https://github.com/juno-yu",
      "followers_url": "https://api.github.com/users/juno-yu/followers",
      "following_url": "https://api.github.com/users/juno-yu/following{/other_user}",
      "gists_url": "https://api.github.com/users/juno-yu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/juno-yu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/juno-yu/subscriptions",
      "organizations_url": "https://api.github.com/users/juno-yu/orgs",
      "repos_url": "https://api.github.com/users/juno-yu/repos",
      "events_url": "https://api.github.com/users/juno-yu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/juno-yu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-07T04:59:25Z",
    "updated_at": "2024-01-07T05:02:11Z",
    "author_association": "NONE",
    "body": "merely rollback by 1 block (the fork was 1 block only) seemed not the correct way out\r\n\r\n\r\n debug.setHead 1 block back for op-geth on that node then restart op-node ->  doing some `Walking back L1Block by hash` for multi-day  data older than the problematic block , (don't know need how long & how much it rolling back), so I had to stop it ,restore by alternative ways as catch up is slow nowadays",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1879941761/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1880128589",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/8876#issuecomment-1880128589",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8876",
    "id": 1880128589,
    "node_id": "IC_kwDODjvEJM5wEHxN",
    "user": {
      "login": "juno-yu",
      "id": 37950908,
      "node_id": "MDQ6VXNlcjM3OTUwOTA4",
      "avatar_url": "https://avatars.githubusercontent.com/u/37950908?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/juno-yu",
      "html_url": "https://github.com/juno-yu",
      "followers_url": "https://api.github.com/users/juno-yu/followers",
      "following_url": "https://api.github.com/users/juno-yu/following{/other_user}",
      "gists_url": "https://api.github.com/users/juno-yu/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/juno-yu/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/juno-yu/subscriptions",
      "organizations_url": "https://api.github.com/users/juno-yu/orgs",
      "repos_url": "https://api.github.com/users/juno-yu/repos",
      "events_url": "https://api.github.com/users/juno-yu/events{/privacy}",
      "received_events_url": "https://api.github.com/users/juno-yu/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-07T18:05:09Z",
    "updated_at": "2024-01-07T18:05:09Z",
    "author_association": "NONE",
    "body": "> l1.trustrpc\r\n\r\nnot with `l1.trustrpc` that time , how does this affect node behavior on fork / rollback?! \r\nwe pointing to private geth (eth)  so should be safe to enable too , but not at the forked moment",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1880128589/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1881035519",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/8876#issuecomment-1881035519",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/8876",
    "id": 1881035519,
    "node_id": "IC_kwDODjvEJM5wHlL_",
    "user": {
      "login": "sebastianst",
      "id": 2607372,
      "node_id": "MDQ6VXNlcjI2MDczNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2607372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/sebastianst",
      "html_url": "https://github.com/sebastianst",
      "followers_url": "https://api.github.com/users/sebastianst/followers",
      "following_url": "https://api.github.com/users/sebastianst/following{/other_user}",
      "gists_url": "https://api.github.com/users/sebastianst/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/sebastianst/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/sebastianst/subscriptions",
      "organizations_url": "https://api.github.com/users/sebastianst/orgs",
      "repos_url": "https://api.github.com/users/sebastianst/repos",
      "events_url": "https://api.github.com/users/sebastianst/events{/privacy}",
      "received_events_url": "https://api.github.com/users/sebastianst/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-08T13:44:21Z",
    "updated_at": "2024-01-08T13:44:21Z",
    "author_association": "MEMBER",
    "body": "@juno-yu we've recently received reports that receipts fetching with `l1.trustrpc == true` could lead to missing receipts during block derivation, probably coming from a temporary problem with the L1 connection, in turn deriving a block with missing user deposit transactions. We are still investigating why receipts fetching could return less receipts for a block without an error. In the meantime, we've released an image [op-node/v1.4.3-rc.3](https://github.com/ethereum-optimism/optimism/releases/tag/op-node%2Fv1.4.3-rc.3) that puts back receipts validation even if `l1.trustrpc` is enabled. We will finalize this release candidate this week. You can safely use this image with `l1.trustrpc == true` or disable it in your existing setup.\r\n\r\nCan you confirm that block you mentioned above (`\"blockHeight\": 114388037, \"blockHash\": \"0xdf8af4ce7e93aa91b3e3f9a1e667155baab5b34a17b0de7fe16d8704fdf7ab46\"`) was the first diverging block?\r\n\r\nIf yes, can you access this block's transactions/tx hashes? How many does it contain? Is it less that the correct block's number of transactions? If it is missing some, can you confirm that these are missing user deposits?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1881035519/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
