{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4652",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4652/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4652/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4652/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/4652",
  "id": 1527394532,
  "node_id": "I_kwDODjvEJM5bCjDk",
  "number": 4652,
  "title": "Fault Detector 0.4.0 - Not running on bedrock devnet",
  "user": {
    "login": "andreclaro",
    "id": 33039405,
    "node_id": "MDQ6VXNlcjMzMDM5NDA1",
    "avatar_url": "https://avatars.githubusercontent.com/u/33039405?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/andreclaro",
    "html_url": "https://github.com/andreclaro",
    "followers_url": "https://api.github.com/users/andreclaro/followers",
    "following_url": "https://api.github.com/users/andreclaro/following{/other_user}",
    "gists_url": "https://api.github.com/users/andreclaro/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/andreclaro/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/andreclaro/subscriptions",
    "organizations_url": "https://api.github.com/users/andreclaro/orgs",
    "repos_url": "https://api.github.com/users/andreclaro/repos",
    "events_url": "https://api.github.com/users/andreclaro/events{/privacy}",
    "received_events_url": "https://api.github.com/users/andreclaro/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832555,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNTU1",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-feature-request",
      "name": "C-feature-request",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: A feature request."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "smartcontracts",
    "id": 14298799,
    "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
    "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/smartcontracts",
    "html_url": "https://github.com/smartcontracts",
    "followers_url": "https://api.github.com/users/smartcontracts/followers",
    "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
    "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
    "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
    "repos_url": "https://api.github.com/users/smartcontracts/repos",
    "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
    "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-01-10T13:29:31Z",
  "updated_at": "2023-02-13T03:56:51Z",
  "closed_at": "2023-02-13T03:56:51Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\nFault detector does not start when including it as part of bedrock devnet: https://github.com/ethereum-optimism/optimism/tree/develop/ops-bedrock\r\n\r\n**Steps**\r\nAdded fault-detector to bedrock docker-compose and devnet-up.sh.\r\n\r\n```\r\n  fault_detector:\r\n    image: ethereumoptimism/fault-detector:0.4.0\r\n    environment:\r\n      FAULT_DETECTOR__L1_RPC_PROVIDER: http://l1:8545\r\n      FAULT_DETECTOR__L2_RPC_PROVIDER: http://l2:8545\r\n    ports:\r\n      - 7350:7300\r\n    depends_on:\r\n      - l1\r\n      - l2\r\n    healthcheck:\r\n      test: [ \"CMD-SHELL\", \"wget -O - http://localhost:7300/api/status\" ]\r\n      interval: 10s\r\n      timeout: 120s\r\n      retries: 5\r\n\r\n```\r\n\r\n**Expected behavior**\r\nExpected to start fault detector.\r\n\r\n**Logs**\r\n```\r\n❯  docker logs ops-bedrock-fault_detector-1 -f                                                                                         <aws:dev>\r\n\r\n> @eth-optimism/fault-detector@0.4.0 start\r\n> ts-node ./src/service.ts\r\n\r\n{\"level\":30,\"time\":1673357207696,\"msg\":\"starting app server\"}\r\n{\"level\":30,\"time\":1673357208258,\"port\":7300,\"hostname\":\"0.0.0.0\",\"msg\":\"app server started\"}\r\n{\"level\":30,\"time\":1673357208260,\"msg\":\"initializing service\"}\r\n/opt/optimism/node_modules/ethers/node_modules/@ethersproject/logger/src.ts/index.ts:269\r\n        const error: any = new Error(message);\r\n                           ^\r\nError: call revert exception [ See: https://links.ethers.org/v5-errors-CALL_EXCEPTION ] (method=\"FRAUD_PROOF_WINDOW()\", data=\"0x\", errorArgs=null, errorName=null, errorSignature=null, reason=null, code=CALL_EXCEPTION, version=abi/5.7.0)\r\n    at Logger.makeError (/opt/optimism/node_modules/ethers/node_modules/@ethersproject/logger/src.ts/index.ts:269:28)\r\n    at Logger.throwError (/opt/optimism/node_modules/ethers/node_modules/@ethersproject/logger/src.ts/index.ts:281:20)\r\n    at Interface.decodeFunctionResult (/opt/optimism/node_modules/ethers/node_modules/@ethersproject/abi/src.ts/interface.ts:427:23)\r\n    at Contract.<anonymous> (/opt/optimism/node_modules/@ethersproject/contracts/src.ts/index.ts:400:44)\r\n    at step (/opt/optimism/node_modules/@ethersproject/contracts/lib/index.js:48:23)\r\n    at Object.next (/opt/optimism/node_modules/@ethersproject/contracts/lib/index.js:29:53)\r\n    at fulfilled (/opt/optimism/node_modules/@ethersproject/contracts/lib/index.js:20:58)\r\n    at processTicksAndRejections (node:internal/process/task_queues:96:5) {\r\n  reason: null,\r\n  code: 'CALL_EXCEPTION',\r\n  method: 'FRAUD_PROOF_WINDOW()',\r\n  data: '0x',\r\n  errorArgs: null,\r\n  errorName: null,\r\n  errorSignature: null,\r\n  address: '0x0000000000000000000000000000000000000000',\r\n  args: [],\r\n  transaction: {\r\n    data: '0xc17b291b',\r\n    to: '0x0000000000000000000000000000000000000000'\r\n  }\r\n}\r\nnpm ERR! Lifecycle script `start` failed with error:\r\nnpm ERR! Error: command failed\r\nnpm ERR!   in workspace: @eth-optimism/fault-detector@0.4.0\r\nnpm ERR!   at location: /opt/optimism/packages/fault-detector\r\nnpm notice\r\nnpm notice New major version of npm available! 8.11.0 -> 9.2.0\r\nnpm notice Changelog: <https://github.com/npm/cli/releases/tag/v9.2.0>\r\nnpm notice Run `npm install -g npm@9.2.0` to update!\r\nnpm notice\r\n```\r\n\r\n**System Specs:**\r\n - OS: MaOS / Docker\r\n - Package Version (or commit hash): 0.4.0\r\n\r\n```\r\n❯ docker --version                                                                                            <aws:dev>\r\nDocker version 20.10.21, build baeda1f\r\n```\r\n\r\n```\r\n❯ sw_vers                                                                                                     <aws:dev>\r\nProductName:\tmacOS\r\nProductVersion:\t12.6\r\nBuildVersion:\t21G115\r\n```",
  "closed_by": {
    "login": "mslipper",
    "id": 67953,
    "node_id": "MDQ6VXNlcjY3OTUz",
    "avatar_url": "https://avatars.githubusercontent.com/u/67953?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mslipper",
    "html_url": "https://github.com/mslipper",
    "followers_url": "https://api.github.com/users/mslipper/followers",
    "following_url": "https://api.github.com/users/mslipper/following{/other_user}",
    "gists_url": "https://api.github.com/users/mslipper/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mslipper/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mslipper/subscriptions",
    "organizations_url": "https://api.github.com/users/mslipper/orgs",
    "repos_url": "https://api.github.com/users/mslipper/repos",
    "events_url": "https://api.github.com/users/mslipper/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mslipper/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4652/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4652/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1377337710",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4652#issuecomment-1377337710",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4652",
    "id": 1377337710,
    "node_id": "IC_kwDODjvEJM5SGIFu",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-10T14:07:51Z",
    "updated_at": "2023-01-10T14:07:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "Yeah fault detector still needs to be updated for Bedrock ",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1377337710/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1377799300",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4652#issuecomment-1377799300",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4652",
    "id": 1377799300,
    "node_id": "IC_kwDODjvEJM5SH4yE",
    "user": {
      "login": "andreclaro",
      "id": 33039405,
      "node_id": "MDQ6VXNlcjMzMDM5NDA1",
      "avatar_url": "https://avatars.githubusercontent.com/u/33039405?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/andreclaro",
      "html_url": "https://github.com/andreclaro",
      "followers_url": "https://api.github.com/users/andreclaro/followers",
      "following_url": "https://api.github.com/users/andreclaro/following{/other_user}",
      "gists_url": "https://api.github.com/users/andreclaro/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/andreclaro/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/andreclaro/subscriptions",
      "organizations_url": "https://api.github.com/users/andreclaro/orgs",
      "repos_url": "https://api.github.com/users/andreclaro/repos",
      "events_url": "https://api.github.com/users/andreclaro/events{/privacy}",
      "received_events_url": "https://api.github.com/users/andreclaro/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-10T20:19:47Z",
    "updated_at": "2023-01-10T20:19:47Z",
    "author_association": "NONE",
    "body": "In our kubernetes deployment (rehearsal testnet), we don't observe any exception, however we also don't get logs like the non-bedrock deployment. Here is the logs: \r\n\r\n```\r\n{\"level\":30,\"time\":1673375225403,\"msg\":\"starting app server\"}\r\n{\"level\":30,\"time\":1673375225484,\"port\":7300,\"hostname\":\"0.0.0.0\",\"msg\":\"app server started\"}\r\n{\"level\":30,\"time\":1673375225484,\"msg\":\"initializing service\"}\r\n{\"level\":30,\"time\":1673375226515,\"msg\":\"warming event cache, this might take a while...\"}\r\n{\"level\":30,\"time\":1673375234894,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 6.886 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375265082,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.660 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375295263,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.413 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375325455,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.966 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375355591,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.237 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375385770,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.364 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375415952,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 4.396 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375446157,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.719 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375476286,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.531 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375506521,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 5.257 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375536686,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.809 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375566867,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.214 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375596969,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.166 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375627116,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.045 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375657364,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.233 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375687460,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 2.940 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375717590,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.102 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375747797,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.755 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375777985,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 2.993 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375816982,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 71.557 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375847096,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.804 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375886615,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 9.038 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375914684,\"msg\":\"finding appropriate starting height\"}\r\n{\"level\":30,\"time\":1673375916637,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 4.100 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375918891,\"msg\":\"no unfinalized batches found, starting from latest\"}\r\n{\"level\":30,\"time\":1673375919180,\"startBatchIndex\":32929,\"msg\":\"starting height\"}\r\n{\"level\":30,\"time\":1673375919180,\"msg\":\"service initialized\"}\r\n{\"level\":30,\"time\":1673375919180,\"msg\":\"starting main loop\"}\r\n{\"level\":30,\"time\":1673375946849,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.473 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673375976975,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.472 ms\\n\",\"msg\":\"server log\"}\r\n{\"level\":30,\"time\":1673376007091,\"log\":\"127.0.0.1 - GET /metrics HTTP/1.1 200 - - 3.652 ms\\n\",\"msg\":\"server log\"}\r\n```\r\n\r\nNon-bedrock fault detector logs:\r\n```\r\n{\"level\":30,\"time\":1673381577756,\"batchIndex\":39833,\"latestIndex\":39834,\"msg\":\"checking batch\"}                                                                                                                                                          {\"level\":30,\"time\":1673381577768,\"batchEnd\":4021865,\"latestBlock\":4021856,\"msg\":\"node is behind, waiting for sync\"}                                                                                                                                                                                                        \r\n{\"level\":30,\"time\":1673381578778,\"batchIndex\":39833,\"latestIndex\":39834,\"msg\":\"checking batch\"}                                                                                                                                                                                                                            \r\n{\"level\":30,\"time\":1673381578790,\"batchEnd\":4021865,\"latestBlock\":4021856,\"msg\":\"node is behind, waiting for sync\"}                                                                                                                                                                                                        \r\n{\"level\":30,\"time\":1673381579804,\"batchIndex\":39833,\"latestIndex\":39834,\"msg\":\"checking batch\"}                                                                                                                                                                                                                            \r\n{\"level\":30,\"time\":1673381579823,\"batchEnd\":4021865,\"latestBlock\":4021856,\"msg\":\"node is behind, waiting for sync\"}                                                                                                                                                                                                        \r\n{\"level\":30,\"time\":1673381580833,\"batchIndex\":39833,\"latestIndex\":39834,\"msg\":\"checking batch\"}\r\n````",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1377799300/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
