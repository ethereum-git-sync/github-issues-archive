{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4205",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4205/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4205/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4205/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/4205",
  "id": 1477111417,
  "node_id": "I_kwDODjvEJM5YCu55",
  "number": 4205,
  "title": "Malformed batch error if there are no sequencer transactions",
  "user": {
    "login": "drinkius",
    "id": 1757619,
    "node_id": "MDQ6VXNlcjE3NTc2MTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1757619?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/drinkius",
    "html_url": "https://github.com/drinkius",
    "followers_url": "https://api.github.com/users/drinkius/followers",
    "following_url": "https://api.github.com/users/drinkius/following{/other_user}",
    "gists_url": "https://api.github.com/users/drinkius/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/drinkius/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/drinkius/subscriptions",
    "organizations_url": "https://api.github.com/users/drinkius/orgs",
    "repos_url": "https://api.github.com/users/drinkius/repos",
    "events_url": "https://api.github.com/users/drinkius/events{/privacy}",
    "received_events_url": "https://api.github.com/users/drinkius/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832490,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNDkw",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bug",
      "name": "C-bug",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: This is a bug."
    },
    {
      "id": 2907832673,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNjcz",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/M-batch-submitter",
      "name": "M-batch-submitter",
      "color": "FBCA04",
      "default": false,
      "description": "Module: batch submitter"
    },
    {
      "id": 2930018676,
      "node_id": "MDU6TGFiZWwyOTMwMDE4Njc2",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/P-unconfirmed",
      "name": "P-unconfirmed",
      "color": "BFD4F2",
      "default": false,
      "description": "Issue might be valid, but itâ€™s not yet confirmed"
    },
    {
      "id": 4266439918,
      "node_id": "LA_kwDODjvEJM7-TLTu",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bedrock-fixes-this",
      "name": "C-bedrock-fixes-this",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: Something Bedrock fixes"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-12-05T18:02:33Z",
  "updated_at": "2023-03-22T20:13:42Z",
  "closed_at": "2023-03-22T20:13:42Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\nWe are working of creating an Optimism fork and currently trying to deploy the unchanged contracts from the master branch, commit 2b3b09be. When the first bridge transactions are appearing on L2 (although they are failing, which might contribute to the issue) - when the Batch Submitter service tries to create a batch out of those blocks created on l2geth - we are getting the **ErrMalformedBatch** error.\r\n\r\nThe culprit seems to be hidden in commit [fe680568](https://github.com/ethereum-optimism/optimism/commit/fe6805684da30b6b8d223e9eeff772fff267bb7a) - here there is a condition marked: [_There must be transactions if there are contexts_](https://github.com/ethereum-optimism/optimism/blob/fe6805684da30b6b8d223e9eeff772fff267bb7a/go/batch-submitter/drivers/sequencer/encoding.go#L185) \r\nIf the batch doesn't contain any Sequencer transactions (only the bridge transactions from L1) - then the **AppendSequencerBatchParams** object doesn't contain any Txs since they are added [only for the Sequenced transactions](https://github.com/ethereum-optimism/optimism/blob/fe6805684da30b6b8d223e9eeff772fff267bb7a/go/batch-submitter/drivers/sequencer/batch.go#L140)\r\n\r\nMaybe we are missing something in the setup here, or maybe the service has already been updated for Bedrock release which we currently are ignoring and trying to deploy the existing Optimism release\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Deploy new version of the contracts from commit 2b3b09be\r\n2. Run the L2 from scratch\r\n\r\n**Expected behavior**\r\nBatches exclusively with transactions originating from the L1 are written by the Sequencer using Batch Submitter service\r\n\r\n**System Specs:**\r\n - OS: Ubuntu 20.04\r\n - Package Version (or commit hash): 2b3b09be\r\n",
  "closed_by": {
    "login": "mergify[bot]",
    "id": 37929162,
    "node_id": "MDM6Qm90Mzc5MjkxNjI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/10562?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mergify%5Bbot%5D",
    "html_url": "https://github.com/apps/mergify",
    "followers_url": "https://api.github.com/users/mergify%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/mergify%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/mergify%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mergify%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mergify%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/mergify%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/mergify%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/mergify%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mergify%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4205/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4205/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1338001765",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4205#issuecomment-1338001765",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4205",
    "id": 1338001765,
    "node_id": "IC_kwDODjvEJM5PwEll",
    "user": {
      "login": "smartcontracts",
      "id": 14298799,
      "node_id": "MDQ6VXNlcjE0Mjk4Nzk5",
      "avatar_url": "https://avatars.githubusercontent.com/u/14298799?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/smartcontracts",
      "html_url": "https://github.com/smartcontracts",
      "followers_url": "https://api.github.com/users/smartcontracts/followers",
      "following_url": "https://api.github.com/users/smartcontracts/following{/other_user}",
      "gists_url": "https://api.github.com/users/smartcontracts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/smartcontracts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/smartcontracts/subscriptions",
      "organizations_url": "https://api.github.com/users/smartcontracts/orgs",
      "repos_url": "https://api.github.com/users/smartcontracts/repos",
      "events_url": "https://api.github.com/users/smartcontracts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/smartcontracts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-05T19:12:21Z",
    "updated_at": "2022-12-05T19:12:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "We're currently all hands on deck getting Bedrock out the door, so work on fixes to the legacy codebase may be slow right now. I'll get this triaged for you.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1338001765/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1338006131",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4205#issuecomment-1338006131",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4205",
    "id": 1338006131,
    "node_id": "IC_kwDODjvEJM5PwFpz",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-05T19:15:54Z",
    "updated_at": "2022-12-05T19:15:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "You should consider using the new system over the legacy system, its a lot better",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1338006131/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1338058147",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4205#issuecomment-1338058147",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4205",
    "id": 1338058147,
    "node_id": "IC_kwDODjvEJM5PwSWj",
    "user": {
      "login": "drinkius",
      "id": 1757619,
      "node_id": "MDQ6VXNlcjE3NTc2MTk=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1757619?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/drinkius",
      "html_url": "https://github.com/drinkius",
      "followers_url": "https://api.github.com/users/drinkius/followers",
      "following_url": "https://api.github.com/users/drinkius/following{/other_user}",
      "gists_url": "https://api.github.com/users/drinkius/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/drinkius/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/drinkius/subscriptions",
      "organizations_url": "https://api.github.com/users/drinkius/orgs",
      "repos_url": "https://api.github.com/users/drinkius/repos",
      "events_url": "https://api.github.com/users/drinkius/events{/privacy}",
      "received_events_url": "https://api.github.com/users/drinkius/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-05T19:42:20Z",
    "updated_at": "2022-12-05T19:47:10Z",
    "author_association": "NONE",
    "body": "Thanks, when should we expect the Bedrock release then - couldn't dig up anything besides the Q4 2022 roadmap entry? If you think it's not worth investing time in the legacy system then we'd better wait with the development ourselves. Is it worth trying to run Bedrock testnet for ourselves if it's even a possibility?",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1338058147/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1341780567",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/4205#issuecomment-1341780567",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/4205",
    "id": 1341780567,
    "node_id": "IC_kwDODjvEJM5P-fJX",
    "user": {
      "login": "tynes",
      "id": 6626818,
      "node_id": "MDQ6VXNlcjY2MjY4MTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tynes",
      "html_url": "https://github.com/tynes",
      "followers_url": "https://api.github.com/users/tynes/followers",
      "following_url": "https://api.github.com/users/tynes/following{/other_user}",
      "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
      "organizations_url": "https://api.github.com/users/tynes/orgs",
      "repos_url": "https://api.github.com/users/tynes/repos",
      "events_url": "https://api.github.com/users/tynes/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tynes/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-08T00:07:23Z",
    "updated_at": "2022-12-08T00:07:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Thanks, when should we expect the Bedrock release then - couldn't dig up anything besides the Q4 2022 roadmap entry? If you think it's not worth investing time in the legacy system then we'd better wait with the development ourselves. Is it worth trying to run Bedrock testnet for ourselves if it's even a possibility?\r\n\r\nBedrock is definitely ready to be ran as a testnet, we are currently running a private bedrock testnet ourselves. We are in the final stages of testing and working through our migration before upgrading our public goerli testnet",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1341780567/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
