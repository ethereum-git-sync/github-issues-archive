{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/3112",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/3112/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/3112/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/3112/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/3112",
  "id": 1320237879,
  "node_id": "I_kwDODjvEJM5OsTs3",
  "number": 3112,
  "title": "Unable to generate transaction debugs for some transactions",
  "user": {
    "login": "quickchase",
    "id": 87909910,
    "node_id": "MDQ6VXNlcjg3OTA5OTEw",
    "avatar_url": "https://avatars.githubusercontent.com/u/87909910?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/quickchase",
    "html_url": "https://github.com/quickchase",
    "followers_url": "https://api.github.com/users/quickchase/followers",
    "following_url": "https://api.github.com/users/quickchase/following{/other_user}",
    "gists_url": "https://api.github.com/users/quickchase/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/quickchase/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/quickchase/subscriptions",
    "organizations_url": "https://api.github.com/users/quickchase/orgs",
    "repos_url": "https://api.github.com/users/quickchase/repos",
    "events_url": "https://api.github.com/users/quickchase/events{/privacy}",
    "received_events_url": "https://api.github.com/users/quickchase/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832490,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNDkw",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bug",
      "name": "C-bug",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: This is a bug."
    },
    {
      "id": 2981541772,
      "node_id": "MDU6TGFiZWwyOTgxNTQxNzcy",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/P-confirmed",
      "name": "P-confirmed",
      "color": "BFD4F2",
      "default": false,
      "description": "A confirmed bug"
    },
    {
      "id": 4266439918,
      "node_id": "LA_kwDODjvEJM7-TLTu",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bedrock-fixes-this",
      "name": "C-bedrock-fixes-this",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: Something Bedrock fixes"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-07-28T00:02:25Z",
  "updated_at": "2023-06-16T19:17:55Z",
  "closed_at": "2023-06-16T19:17:55Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\nI have a large, but also incomplete, list of transactions that cannot be traced on an Optimism node:\r\n[transactions.txt](https://github.com/ethereum-optimism/optimism/files/9204171/transactions.txt)\r\n\r\nSome, if not all of them, would OOM the node if you just tried to run `debug_traceTransaction` without any specific tracers or `disableMemory` - most of them will not even return with `callTracer`\r\n\r\nFor example, this returns nothing:\r\n```\r\ncurl -s -H 'Content-Type: application/json' http://localhost:8545 -d '{\"jsonrpc\":\"2.0\",\"method\":\"debug_traceTransaction\",\"params\":[\"0xdfcd11b288d4f8a45c32e1d60d353043fe9593f1742b51df6e4d4601910f566e\", {\"tracer\": \"callTracer\", \"timeout\": \"1h\"}],\"id\":0}'\r\n```\r\nIt doesn't seem to crash the node or anything, it just doesn't return any data, or useful logs.\r\n\r\nEven with `{\"disableMemory\":true}` this debug will eat through 60GB of RAM and crash the node.\r\n```\r\n{\"jsonrpc\":\"2.0\",\"method\":\"debug_traceTransaction\",\"params\":[\"0xdfcd11b288d4f8a45c32e1d60d353043fe9593f1742b51df6e4d4601910f566e\", {\"disableMemory\":true}],\"id\":0}\r\n```\r\n\r\nThis OOM thing is a known issue inherited from Geth that has been discussed many times:\r\nhttps://github.com/ethereum/go-ethereum/issues/22244\r\n\r\nNethermind and Erigon generally solved this problem by implementing JSON-RPC streaming but Geth has yet to provide a workaround outside of `debug_standardTraceBlockToFile` which requires direct physical access to the node's storage, something that generally can't be provided by RPC providers...\r\n\r\nRegardless, I gave it a shot:\r\nThe transaction `0xdfcd11b288d4f8a45c32e1d60d353043fe9593f1742b51df6e4d4601910f566e` is in the following block:\r\n```\r\nBLOCKHASH=\"0x456422c35361bf34792dbeed17edbf7f91016aed788c67633dee25e74a2279ff\"\r\ncurl -s -H 'Content-Type: application/json' http://localhost:8545 -d \"\r\n  {\r\n      \\\"jsonrpc\\\":\\\"2.0\\\",\r\n      \\\"id\\\":1,\r\n      \\\"method\\\":\\\"debug_standardTraceBlockToFile\\\",\r\n      \\\"params\\\":[\r\n          ${BLOCKHASH},\r\n          {\r\n              \\\"disableMemory\\\":true,\r\n              \\\"overrides\\\":{}\r\n          }\r\n      ]\r\n  }\r\n\"\r\n```\r\nI expect this to return a file path in the form of something like:\r\n```json\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":[\"/temp/block_0x456422c3-0-0xdfcd11b2-4028396738\"]}\r\n```\r\nHowever, it does not. I DO see that A file is generated in `/tmp` but it's not really clear to me if this is full and complete working output, since I'm not getting a file path back, my concern is that it's crashing or stopping at some point and the file is incomplete?\r\n\r\nI do not know enough about the output from these commands to analyze the file myself to know if it's good or not... I'm also just a middleman here in trying to provide traces over JSON-RPC.\r\n\r\nI don't think we should have to resort to debugging to a file in the first place, but if there's no other way then I still expect the curl command to return success or failure and return the file path instead of an empty response:\r\n```\r\n> POST / HTTP/1.1\r\n> Host: localhost:8545\r\n> User-Agent: curl/7.68.0\r\n> Accept: */*\r\n> Content-Type: application/json\r\n> Content-Length: 317\r\n> \r\n* upload completely sent off: 317 out of 317 bytes\r\n* Empty reply from server\r\n* Connection #0 to host localhost left intact\r\n```\r\n\r\nAlso related #2228 ",
  "closed_by": {
    "login": "tynes",
    "id": 6626818,
    "node_id": "MDQ6VXNlcjY2MjY4MTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6626818?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tynes",
    "html_url": "https://github.com/tynes",
    "followers_url": "https://api.github.com/users/tynes/followers",
    "following_url": "https://api.github.com/users/tynes/following{/other_user}",
    "gists_url": "https://api.github.com/users/tynes/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tynes/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tynes/subscriptions",
    "organizations_url": "https://api.github.com/users/tynes/orgs",
    "repos_url": "https://api.github.com/users/tynes/repos",
    "events_url": "https://api.github.com/users/tynes/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tynes/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/3112/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/3112/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1238230793",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/3112#issuecomment-1238230793",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/3112",
    "id": 1238230793,
    "node_id": "IC_kwDODjvEJM5JzecJ",
    "user": {
      "login": "pjanuario",
      "id": 477458,
      "node_id": "MDQ6VXNlcjQ3NzQ1OA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/477458?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pjanuario",
      "html_url": "https://github.com/pjanuario",
      "followers_url": "https://api.github.com/users/pjanuario/followers",
      "following_url": "https://api.github.com/users/pjanuario/following{/other_user}",
      "gists_url": "https://api.github.com/users/pjanuario/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pjanuario/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pjanuario/subscriptions",
      "organizations_url": "https://api.github.com/users/pjanuario/orgs",
      "repos_url": "https://api.github.com/users/pjanuario/repos",
      "events_url": "https://api.github.com/users/pjanuario/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pjanuario/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-06T14:28:02Z",
    "updated_at": "2022-09-06T14:28:02Z",
    "author_association": "NONE",
    "body": "Would be useful to get some information about this problem.",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1238230793/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
