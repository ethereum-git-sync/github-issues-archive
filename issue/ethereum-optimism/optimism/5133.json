{
  "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5133",
  "repository_url": "https://api.github.com/repos/ethereum-optimism/optimism",
  "labels_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5133/labels{/name}",
  "comments_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5133/comments",
  "events_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5133/events",
  "html_url": "https://github.com/ethereum-optimism/optimism/issues/5133",
  "id": 1623314417,
  "node_id": "I_kwDODjvEJM5gwc_x",
  "number": 5133,
  "title": "ERROR: RPC method debug_traceBlockByNumber crashed: runtime error: invalid memory address or nil pointer dereference",
  "user": {
    "login": "jacquesvcritien",
    "id": 30493486,
    "node_id": "MDQ6VXNlcjMwNDkzNDg2",
    "avatar_url": "https://avatars.githubusercontent.com/u/30493486?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jacquesvcritien",
    "html_url": "https://github.com/jacquesvcritien",
    "followers_url": "https://api.github.com/users/jacquesvcritien/followers",
    "following_url": "https://api.github.com/users/jacquesvcritien/following{/other_user}",
    "gists_url": "https://api.github.com/users/jacquesvcritien/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jacquesvcritien/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jacquesvcritien/subscriptions",
    "organizations_url": "https://api.github.com/users/jacquesvcritien/orgs",
    "repos_url": "https://api.github.com/users/jacquesvcritien/repos",
    "events_url": "https://api.github.com/users/jacquesvcritien/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jacquesvcritien/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2907832490,
      "node_id": "MDU6TGFiZWwyOTA3ODMyNDkw",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bug",
      "name": "C-bug",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: This is a bug."
    },
    {
      "id": 5251919362,
      "node_id": "LA_kwDODjvEJM8AAAABOQnuAg",
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/labels/C-bedrock",
      "name": "C-bedrock",
      "color": "C5DEF5",
      "default": false,
      "description": "Category: Something about Bedrock"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-03-14T11:49:52Z",
  "updated_at": "2023-03-16T11:03:22Z",
  "closed_at": "2023-03-16T11:03:21Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "**Describe the bug**\r\nAfter updating our Goerli nodes to the latest required versions, we are seeing the following error when making debug_traceBlockByNumber RPC queries\r\n\r\n```\r\nERROR[03-14|11:42:18.811] RPC method debug_traceBlockByNumber crashed: runtime error: invalid memory address or nil pointer dereference\r\ngoroutine 1479991 [running]:\r\ngithub.com/ethereum/go-ethereum/rpc.(*callback).call.func1()\r\n        github.com/ethereum/go-ethereum/rpc/service.go:199 +0x89\r\npanic({0x1706b60, 0x2785570})\r\n        runtime/panic.go:884 +0x213\r\ngithub.com/ethereum/go-ethereum/core.(*StateTransition).innerTransitionDb(0xc013d6bd80)\r\n        github.com/ethereum/go-ethereum/core/state_transition.go:477 +0xfc6\r\ngithub.com/ethereum/go-ethereum/core.(*StateTransition).TransitionDb(0xc013d6bd80)\r\n        github.com/ethereum/go-ethereum/core/state_transition.go:333 +0xce\r\ngithub.com/ethereum/go-ethereum/core.ApplyMessage(0x1cb2c78?, {0x1cbf5f0?, 0xc030416fa0?}, 0x0?)\r\n        github.com/ethereum/go-ethereum/core/state_transition.go:211 +0x2a\r\ngithub.com/ethereum/go-ethereum/eth/tracers.(*API).traceTx(0xc002a75db0, {0x1cb2c78, 0xc05baa3bd0}, {0x1cbf5f0, 0xc030416fa0}, 0xc0338156d0, {0x1ae73a0, 0x1ae73a8, 0xc0072834d0, 0x0, ...}, ...)\r\n        github.com/ethereum/go-ethereum/eth/tracers/api.go:1038 +0x529\r\ngithub.com/ethereum/go-ethereum/eth/tracers.(*API).traceBlock(0xc002a75db0, {0x1cb2c78?, 0xc05baa3bd0?}, 0xc030416dc0, 0xc02592bb40)\r\n        github.com/ethereum/go-ethereum/eth/tracers/api.go:668 +0xcf2\r\ngithub.com/ethereum/go-ethereum/eth/tracers.(*API).TraceBlockByNumber(0xc002a75db0, {0x1cb2c78, 0xc05baa3bd0}, 0x5?, 0xc02592bb40)\r\n        github.com/ethereum/go-ethereum/eth/tracers/api.go:477 +0x445\r\nreflect.Value.call({0xc00019c540?, 0xc001309dc8?, 0x7f1d469c3768?}, {0x194dab3, 0x4}, {0xc06b186c00, 0x4, 0x0?})\r\n        reflect/value.go:586 +0xb07\r\nreflect.Value.Call({0xc00019c540?, 0xc001309dc8?, 0x1?}, {0xc06b186c00?, 0x2?, 0x16?})\r\n        reflect/value.go:370 +0xbc\r\ngithub.com/ethereum/go-ethereum/rpc.(*callback).call(0xc0009a8a20, {0x1cb2c78?, 0xc05baa3bd0}, {0xc059487740, 0x18}, {0xc0072822a0, 0x2, 0x4d3837?})\r\n        github.com/ethereum/go-ethereum/rpc/service.go:205 +0x3c5\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).runMethod(0xc05686cc00?, {0x1cb2c78?, 0xc05baa3bd0?}, 0xc0470f5f10, 0x2?, {0xc0072822a0?, 0x417230?, 0x1739d80?})\r\n        github.com/ethereum/go-ethereum/rpc/handler.go:513 +0x45\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).handleCall(0xc0007d8d80, 0xc011a0f410, 0xc0470f5f10)\r\n        github.com/ethereum/go-ethereum/rpc/handler.go:459 +0x239\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).handleCallMsg(0xc0007d8d80, 0xc007282210?, 0xc0470f5f10)\r\n        github.com/ethereum/go-ethereum/rpc/handler.go:420 +0x237\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).handleMsg.func1(0xc011a0f410)\r\n        github.com/ethereum/go-ethereum/rpc/handler.go:256 +0x1a5\r\ngithub.com/ethereum/go-ethereum/rpc.(*handler).startCallProc.func1()\r\n        github.com/ethereum/go-ethereum/rpc/handler.go:348 +0xc5\r\ncreated by github.com/ethereum/go-ethereum/rpc.(*handler).startCallProc\r\n        github.com/ethereum/go-ethereum/rpc/handler.go:344 +0x8d\r\n```\r\n\r\nThe query returns the following:\r\n\r\n```\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"error\":{\"code\":-32603,\"message\":\"method handler crashed\"}}\r\n```\r\n\r\n**To Reproduce**\r\n\r\n```\r\ncurl -s -X POST -H 'Content-Type: application/json' -d '{\"jsonrpc\": \"2.0\", \"method\" :\"debug_traceBlockByNumber\", \"params\": [\"0x64fe91\", {\"tracer\": \"callTracer\"}],\"id\": 1}' http://IP:PORT\r\n```\r\n",
  "closed_by": {
    "login": "protolambda",
    "id": 19571989,
    "node_id": "MDQ6VXNlcjE5NTcxOTg5",
    "avatar_url": "https://avatars.githubusercontent.com/u/19571989?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/protolambda",
    "html_url": "https://github.com/protolambda",
    "followers_url": "https://api.github.com/users/protolambda/followers",
    "following_url": "https://api.github.com/users/protolambda/following{/other_user}",
    "gists_url": "https://api.github.com/users/protolambda/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/protolambda/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/protolambda/subscriptions",
    "organizations_url": "https://api.github.com/users/protolambda/orgs",
    "repos_url": "https://api.github.com/users/protolambda/repos",
    "events_url": "https://api.github.com/users/protolambda/events{/privacy}",
    "received_events_url": "https://api.github.com/users/protolambda/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5133/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5133/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1471739691",
    "html_url": "https://github.com/ethereum-optimism/optimism/issues/5133#issuecomment-1471739691",
    "issue_url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/5133",
    "id": 1471739691,
    "node_id": "IC_kwDODjvEJM5XuPcr",
    "user": {
      "login": "protolambda",
      "id": 19571989,
      "node_id": "MDQ6VXNlcjE5NTcxOTg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/19571989?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/protolambda",
      "html_url": "https://github.com/protolambda",
      "followers_url": "https://api.github.com/users/protolambda/followers",
      "following_url": "https://api.github.com/users/protolambda/following{/other_user}",
      "gists_url": "https://api.github.com/users/protolambda/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/protolambda/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/protolambda/subscriptions",
      "organizations_url": "https://api.github.com/users/protolambda/orgs",
      "repos_url": "https://api.github.com/users/protolambda/repos",
      "events_url": "https://api.github.com/users/protolambda/events{/privacy}",
      "received_events_url": "https://api.github.com/users/protolambda/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-16T11:03:21Z",
    "updated_at": "2023-03-16T11:03:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thank you for the bug report. This was fixed in https://github.com/ethereum-optimism/op-geth/pull/70",
    "reactions": {
      "url": "https://api.github.com/repos/ethereum-optimism/optimism/issues/comments/1471739691/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
