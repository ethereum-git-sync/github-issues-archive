{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/1942",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/1942/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/1942/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/1942/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/1942",
  "id": 747977853,
  "node_id": "MDU6SXNzdWU3NDc5Nzc4NTM=",
  "number": 1942,
  "title": "Out of sync after BlockProcessingFailure on Pyrmont",
  "user": {
    "login": "plamarque",
    "id": 227828,
    "node_id": "MDQ6VXNlcjIyNzgyOA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/227828?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/plamarque",
    "html_url": "https://github.com/plamarque",
    "followers_url": "https://api.github.com/users/plamarque/followers",
    "following_url": "https://api.github.com/users/plamarque/following{/other_user}",
    "gists_url": "https://api.github.com/users/plamarque/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/plamarque/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/plamarque/subscriptions",
    "organizations_url": "https://api.github.com/users/plamarque/orgs",
    "repos_url": "https://api.github.com/users/plamarque/repos",
    "events_url": "https://api.github.com/users/plamarque/events{/privacy}",
    "received_events_url": "https://api.github.com/users/plamarque/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 985647281,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODE=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 2490305065,
      "node_id": "MDU6TGFiZWwyNDkwMzA1MDY1",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/A1",
      "name": "A1",
      "color": "223184",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2020-11-21T08:47:13Z",
  "updated_at": "2021-01-14T22:30:43Z",
  "closed_at": "2021-01-14T22:30:43Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nBeacon node fell out of sync on pyrmont and does not seem to catch up.\r\n\r\n\r\n## Version\r\n\r\n`lighthouse --version\r\nLighthouse v0.3.5-7e4ee58\r\nBLS Library: blst\r\n`\r\nrunning on ARM64 Ubuntu 20.04\r\n\r\n## Present Behaviour\r\n\r\nLogs indicate :\r\n\r\n`WARN BlockProcessingFailure                  outcome: MissingBeaconBlock(0xebe21a8eae3592c98ea9f7d77b2888c88db9372c507037f2d93e7f349e7e14bf), msg: unexpected condition in processing block.`\r\n\r\nAfter a restart this error is shown in the logs : \r\n WARN BlockProcessingFailure                  outcome: DBError(DBError { message: \"Error { message: \\\"Corruption: bad block type\\\" }\" }), msg: unexpected condition in processing block.\r\n\r\n## Expected Behaviour\r\n\r\nnode would remain in sync\r\n\r\n## Steps to resolve\r\n\r\nnot found. resyncing from scratch.\r\n",
  "closed_by": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/1942/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 1
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/1942/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/731880393",
    "html_url": "https://github.com/sigp/lighthouse/issues/1942#issuecomment-731880393",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1942",
    "id": 731880393,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMTg4MDM5Mw==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-23T00:59:14Z",
    "updated_at": "2020-11-23T00:59:14Z",
    "author_association": "MEMBER",
    "body": "> DBError(DBError { message: \"Error { message: \"Corruption: bad block type\" }\" })\r\n\r\nThis looks to me like the database on-disk is corrupt. Has this only happened once @plamarque?\r\n\r\nI've never seen this before and if it has only happened once I would be tempted to say its a hardware/OS error that is not caused by LH and is not something that LH can feasibly tolerate. As such, I'd be tempted to close this as a \"not related to lighthouse\" issue.\r\n\r\nHowever, first I'd be keen to hear if it's happened multiple times and perhaps see what @michaelsproul thinks.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/731880393/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/731887631",
    "html_url": "https://github.com/sigp/lighthouse/issues/1942#issuecomment-731887631",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1942",
    "id": 731887631,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMTg4NzYzMQ==",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-23T01:38:34Z",
    "updated_at": "2020-11-23T01:38:34Z",
    "author_association": "MEMBER",
    "body": "This is an obscure LevelDB error. I can't find much info online except:\r\n\r\n* https://github.com/google/leveldb/issues/611\r\n* https://github.com/Nexus-Mods/Vortex/issues/2531\r\n\r\nThe LevelDB devs seem to think it's most likely caused by file-system corruption, putting it out of scope not just for Lighthouse but also LevelDB itself :sweat_smile:\r\n\r\nIt might be interesting to run a [SMART](https://en.wikipedia.org/wiki/S.M.A.R.T.) self-test on your disk to check that it's not failing. A `fsck` of your filesystem might also reveal something. I guess you're using `ext4`?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/731887631/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/732228769",
    "html_url": "https://github.com/sigp/lighthouse/issues/1942#issuecomment-732228769",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1942",
    "id": 732228769,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMjIyODc2OQ==",
    "user": {
      "login": "plamarque",
      "id": 227828,
      "node_id": "MDQ6VXNlcjIyNzgyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/227828?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/plamarque",
      "html_url": "https://github.com/plamarque",
      "followers_url": "https://api.github.com/users/plamarque/followers",
      "following_url": "https://api.github.com/users/plamarque/following{/other_user}",
      "gists_url": "https://api.github.com/users/plamarque/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/plamarque/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/plamarque/subscriptions",
      "organizations_url": "https://api.github.com/users/plamarque/orgs",
      "repos_url": "https://api.github.com/users/plamarque/repos",
      "events_url": "https://api.github.com/users/plamarque/events{/privacy}",
      "received_events_url": "https://api.github.com/users/plamarque/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-23T15:21:30Z",
    "updated_at": "2020-11-23T15:21:30Z",
    "author_association": "NONE",
    "body": "It happened just once  during my first attempt to sync with pyrmont. Nothing bad happened to the server (no hard reboot for example). It was just syncing happily. I reported here as I was initially suspecting this might be a rare bug related to the new DB compaction features. To work around,  I renamed the DB folder and tried another full sync and it seems to work well now.\r\n\r\nI'm using ext 4, on an Ubuntu VM. I'll try to run fsck and report back here.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/732228769/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/734641914",
    "html_url": "https://github.com/sigp/lighthouse/issues/1942#issuecomment-734641914",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1942",
    "id": 734641914,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNDY0MTkxNA==",
    "user": {
      "login": "lightclient",
      "id": 14004106,
      "node_id": "MDQ6VXNlcjE0MDA0MTA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14004106?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lightclient",
      "html_url": "https://github.com/lightclient",
      "followers_url": "https://api.github.com/users/lightclient/followers",
      "following_url": "https://api.github.com/users/lightclient/following{/other_user}",
      "gists_url": "https://api.github.com/users/lightclient/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lightclient/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lightclient/subscriptions",
      "organizations_url": "https://api.github.com/users/lightclient/orgs",
      "repos_url": "https://api.github.com/users/lightclient/repos",
      "events_url": "https://api.github.com/users/lightclient/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lightclient/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-27T04:46:15Z",
    "updated_at": "2020-11-27T04:46:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "I also encountered some db corruption today. I deleted the db and am syncing from scratch. I was running 5828ff12, and upgraded to v1.0 to be safe. The corruption appears to have come from regular crashes due to tokio-runtime segfaults:\r\n\r\n`tokio-runtime-w[3460]: segfault at 470ba01feea ip 00005641f1424f1b sp 00007f59e8ee21f8 error 6 in lighthouse[5641ef75e000+1d9e000]`",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/734641914/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 1,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/760516834",
    "html_url": "https://github.com/sigp/lighthouse/issues/1942#issuecomment-760516834",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1942",
    "id": 760516834,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MDUxNjgzNA==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-14T22:30:43Z",
    "updated_at": "2021-01-14T22:30:43Z",
    "author_association": "MEMBER",
    "body": "I'm going to close this once since it seems the original error is likely based on filesystem corruption. The issue from @lightclient has been fixed by upgrading tokio (the issue was inside it).",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/760516834/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
