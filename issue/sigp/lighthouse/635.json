{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/635",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/635/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/635/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/635/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/635",
  "id": 528525520,
  "node_id": "MDU6SXNzdWU1Mjg1MjU1MjA=",
  "number": 635,
  "title": "Maintain Attestations who reference unknown blocks",
  "user": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2336800125,
      "node_id": "MDU6TGFiZWwyMzM2ODAwMTI1",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/t%20Networking",
      "name": "t Networking",
      "color": "40E0D0",
      "default": false,
      "description": ""
    },
    {
      "id": 2490305065,
      "node_id": "MDU6TGFiZWwyNDkwMzA1MDY1",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/A1",
      "name": "A1",
      "color": "223184",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "divagant-martian",
    "id": 26765164,
    "node_id": "MDQ6VXNlcjI2NzY1MTY0",
    "avatar_url": "https://avatars.githubusercontent.com/u/26765164?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/divagant-martian",
    "html_url": "https://github.com/divagant-martian",
    "followers_url": "https://api.github.com/users/divagant-martian/followers",
    "following_url": "https://api.github.com/users/divagant-martian/following{/other_user}",
    "gists_url": "https://api.github.com/users/divagant-martian/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/divagant-martian/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/divagant-martian/subscriptions",
    "organizations_url": "https://api.github.com/users/divagant-martian/orgs",
    "repos_url": "https://api.github.com/users/divagant-martian/repos",
    "events_url": "https://api.github.com/users/divagant-martian/events{/privacy}",
    "received_events_url": "https://api.github.com/users/divagant-martian/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "divagant-martian",
      "id": 26765164,
      "node_id": "MDQ6VXNlcjI2NzY1MTY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/26765164?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/divagant-martian",
      "html_url": "https://github.com/divagant-martian",
      "followers_url": "https://api.github.com/users/divagant-martian/followers",
      "following_url": "https://api.github.com/users/divagant-martian/following{/other_user}",
      "gists_url": "https://api.github.com/users/divagant-martian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/divagant-martian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/divagant-martian/subscriptions",
      "organizations_url": "https://api.github.com/users/divagant-martian/orgs",
      "repos_url": "https://api.github.com/users/divagant-martian/repos",
      "events_url": "https://api.github.com/users/divagant-martian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/divagant-martian/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2019-11-26T06:51:32Z",
  "updated_at": "2021-08-02T02:08:07Z",
  "closed_at": "2021-08-02T02:08:06Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "When receiving an attestation that references a block that we don't know of, this will trigger a block search. \r\nCurrently, the attestation gets dropped. The preferred logic is to maintain the attestation until the block search either completes or fails and then should be attempted to be reprocessed. ",
  "closed_by": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/635/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/635/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/740403771",
    "html_url": "https://github.com/sigp/lighthouse/issues/635#issuecomment-740403771",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/635",
    "id": 740403771,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MDQwMzc3MQ==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-08T06:13:54Z",
    "updated_at": "2020-12-08T06:13:54Z",
    "author_association": "MEMBER",
    "body": "I think this is becoming increasingly important. \r\n\r\nWe are missing some attestations in a race condition in block processing and attestation processing. See for example:\r\n```\r\n 287584 Dec 04 07:10:48.373 DEBG Successfully processed gossip block     root: 0x4973567e5cd7d5001e19b1af609dccc1a47d0aa51cd87ff48087c7ccae6d5ec7, slot: 16852, graffiti: üç¶ C.R.E.A.M. @ TW üáπüáº, service: beacon\r\n 287585 Dec 04 07:10:48.373 INFO New block received                      hash: 0x4973‚Ä¶5ec7, slot: 16852\r\n 287586 Dec 04 07:10:48.389 DEBG Attestation for unknown block           block: 0x4973‚Ä¶5ec7, peer_id: 16Uiu2HAmJBYJfm6wvBoyFa1cu5ydtdTE61juf4fa2kNCoPV4JdJF  \r\n```\r\n\r\nWe ideally want to keep a cache of attestations for unknown blocks and try and reprocess them if they match a block we have just processed. Those that expire in the cache (i.e no block was ever found for them) the peers that sent them should get penalized. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/740403771/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/742410645",
    "html_url": "https://github.com/sigp/lighthouse/issues/635#issuecomment-742410645",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/635",
    "id": 742410645,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MjQxMDY0NQ==",
    "user": {
      "login": "divagant-martian",
      "id": 26765164,
      "node_id": "MDQ6VXNlcjI2NzY1MTY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/26765164?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/divagant-martian",
      "html_url": "https://github.com/divagant-martian",
      "followers_url": "https://api.github.com/users/divagant-martian/followers",
      "following_url": "https://api.github.com/users/divagant-martian/following{/other_user}",
      "gists_url": "https://api.github.com/users/divagant-martian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/divagant-martian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/divagant-martian/subscriptions",
      "organizations_url": "https://api.github.com/users/divagant-martian/orgs",
      "repos_url": "https://api.github.com/users/divagant-martian/repos",
      "events_url": "https://api.github.com/users/divagant-martian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/divagant-martian/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-10T09:51:16Z",
    "updated_at": "2020-12-10T09:51:16Z",
    "author_association": "CONTRIBUTOR",
    "body": "Interested in working on this but I've been told @blacktemplar might be interested too?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/742410645/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/742421942",
    "html_url": "https://github.com/sigp/lighthouse/issues/635#issuecomment-742421942",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/635",
    "id": 742421942,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0MjQyMTk0Mg==",
    "user": {
      "login": "blacktemplar",
      "id": 3133334,
      "node_id": "MDQ6VXNlcjMxMzMzMzQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3133334?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/blacktemplar",
      "html_url": "https://github.com/blacktemplar",
      "followers_url": "https://api.github.com/users/blacktemplar/followers",
      "following_url": "https://api.github.com/users/blacktemplar/following{/other_user}",
      "gists_url": "https://api.github.com/users/blacktemplar/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/blacktemplar/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/blacktemplar/subscriptions",
      "organizations_url": "https://api.github.com/users/blacktemplar/orgs",
      "repos_url": "https://api.github.com/users/blacktemplar/repos",
      "events_url": "https://api.github.com/users/blacktemplar/events{/privacy}",
      "received_events_url": "https://api.github.com/users/blacktemplar/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-10T10:11:23Z",
    "updated_at": "2020-12-10T10:11:23Z",
    "author_association": "CONTRIBUTOR",
    "body": "Didn't start to work on that yet, so go for it :). Just a small thought about the cache: Would we wait until either the block is known or the cache expires before reporting the validity of the message to gossipsub? Currently gossipsub expects validation to be \"fast\", but I guess instead of ignoring the message it is always better to just wait and maybe process it later.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/742421942/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/744074309",
    "html_url": "https://github.com/sigp/lighthouse/issues/635#issuecomment-744074309",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/635",
    "id": 744074309,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NDA3NDMwOQ==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-13T21:52:25Z",
    "updated_at": "2020-12-13T21:52:25Z",
    "author_association": "MEMBER",
    "body": "Yeah, currently we ignore it. In principle the block-lookup should be fast. \r\n\r\nI imagine its strictly better if we then forward it after the block lookup. Better to potentially send late, than never send at all. ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/744074309/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/784387073",
    "html_url": "https://github.com/sigp/lighthouse/issues/635#issuecomment-784387073",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/635",
    "id": 784387073,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NDM4NzA3Mw==",
    "user": {
      "login": "potuz",
      "id": 16044918,
      "node_id": "MDQ6VXNlcjE2MDQ0OTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16044918?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/potuz",
      "html_url": "https://github.com/potuz",
      "followers_url": "https://api.github.com/users/potuz/followers",
      "following_url": "https://api.github.com/users/potuz/following{/other_user}",
      "gists_url": "https://api.github.com/users/potuz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/potuz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/potuz/subscriptions",
      "organizations_url": "https://api.github.com/users/potuz/orgs",
      "repos_url": "https://api.github.com/users/potuz/repos",
      "events_url": "https://api.github.com/users/potuz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/potuz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-23T17:53:20Z",
    "updated_at": "2021-02-23T17:53:20Z",
    "author_association": "NONE",
    "body": "Ever since prysm added a flag to attest as soon as a block is received, in version 1.2.0, their Discord channel has received several complains from users holding many keys.  Since when they propose a block, typically they will be attesting on the same slot, and some of the attestations go missing. This is presumably due to the fact that the attestation leaves the server right after the block, but peers may get the attestation before the block. Apparently Nimbus and Lighthouse do not implement this yet (I do not know about Teku) so if all peers in the subnet are from these clients (or even perhaps just the aggregators), their attestations will be missed. Nimbus adds a delay to attestation propagation when they propose on the same slot. I don't think this is the right approach though. ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/784387073/reactions",
      "total_count": 3,
      "+1": 3,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/784631277",
    "html_url": "https://github.com/sigp/lighthouse/issues/635#issuecomment-784631277",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/635",
    "id": 784631277,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NDYzMTI3Nw==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-24T00:21:43Z",
    "updated_at": "2021-02-24T00:21:43Z",
    "author_association": "MEMBER",
    "body": "Yeah. I think its fine to send the attestation with the block. Once this issue is resolved, we would cache the attestation, search for the block via the RPC and re-process the attestation. In this sense, it should be handled gracefully, provided the block is available from a peer that forwarded it. ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/784631277/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/890657638",
    "html_url": "https://github.com/sigp/lighthouse/issues/635#issuecomment-890657638",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/635",
    "id": 890657638,
    "node_id": "IC_kwDOCFeAzc41Fltm",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-02T02:08:06Z",
    "updated_at": "2021-08-02T02:08:06Z",
    "author_association": "MEMBER",
    "body": "Resolved in #2319",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/890657638/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
