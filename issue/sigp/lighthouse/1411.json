{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/1411",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/1411/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/1411/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/1411/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/1411",
  "id": 667476185,
  "node_id": "MDU6SXNzdWU2Njc0NzYxODU=",
  "number": 1411,
  "title": "Separate metrics server and API server (different ports)",
  "user": {
    "login": "protolambda",
    "id": 19571989,
    "node_id": "MDQ6VXNlcjE5NTcxOTg5",
    "avatar_url": "https://avatars.githubusercontent.com/u/19571989?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/protolambda",
    "html_url": "https://github.com/protolambda",
    "followers_url": "https://api.github.com/users/protolambda/followers",
    "following_url": "https://api.github.com/users/protolambda/following{/other_user}",
    "gists_url": "https://api.github.com/users/protolambda/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/protolambda/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/protolambda/subscriptions",
    "organizations_url": "https://api.github.com/users/protolambda/orgs",
    "repos_url": "https://api.github.com/users/protolambda/repos",
    "events_url": "https://api.github.com/users/protolambda/events{/privacy}",
    "received_events_url": "https://api.github.com/users/protolambda/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 985647284,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODQ=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/enhancement",
      "name": "enhancement",
      "color": "a2eeef",
      "default": true,
      "description": "New feature or request"
    },
    {
      "id": 1152259112,
      "node_id": "MDU6TGFiZWwxMTUyMjU5MTEy",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/blocked",
      "name": "blocked",
      "color": "000000",
      "default": false,
      "description": ""
    },
    {
      "id": 2336800343,
      "node_id": "MDU6TGFiZWwyMzM2ODAwMzQz",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/HTTP-API",
      "name": "HTTP-API",
      "color": "5A63A2",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2020-07-29T01:11:51Z",
  "updated_at": "2020-09-29T05:50:25Z",
  "closed_at": "2020-09-29T05:50:24Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nSeparate metrics and api endpoints.\r\nThis would allow for:\r\n- firewall customization just for metrics\r\n- metrics before genesis event appears, as the API is not online yet, but metrics can be useful still.\r\n- eth2stats to report more data before genesis state is known\r\n\r\n## Version\r\n\r\nLatest master, 9ae9df8, using official Docker image.\r\n\r\n## Present Behaviour\r\n\r\nMetrics are currently available under `:5052/metrics`\r\n\r\nConfigured as part of the API:\r\n```\r\n  --http --http-address=0.0.0.0 --http-port=5052\r\n```\r\n\r\n## Expected Behaviour\r\n\r\nMetrics should be made available under another port. Other clients default to `:8080/metrics`.\r\n\r\nOptions something like this:\r\n```\r\n  --metrics --metrics-address=0.0.0.0 --metrics-port=8080\r\n```\r\n\r\n## Steps to resolve\r\n\r\nOther clients provide options to configure API and metrics separately, and run two http servers to support that.\r\n\r\n### API configuration option comparison\r\n\r\nFor comparison, this is what the other clients enable you to configure for API and metrics endpoints:\r\n\r\n#### Nimbus\r\n\r\n```\r\n  --rpc --rpc-port={{beacon_rpc_port}} --rpc-address=0.0.0.0\r\n  --metrics --metrics-port={{beacon_metrics_port}} --metrics-address=0.0.0.0\r\n```\r\n\r\n#### Prysm\r\n```\r\n  --monitoring-host=0.0.0.0 --monitoring-port={{beacon_metrics_port}}\r\n  --rpc-host=0.0.0.0 --rpc-port={{beacon_grpc_port}}\r\n  --grpc-gateway-host=0.0.0.0\r\n  --grpc-gateway-port={{beacon_rpc_port}}\r\n```\r\n\r\n### Teku\r\n```\r\n  --rest-api-enabled=true --rest-api-interface=0.0.0.0 --rest-api-port={{beacon_rpc_port}}\r\n  --metrics-enabled --metrics-interface=0.0.0.0 --metrics-port={{beacon_metrics_port}}\r\n  --metrics-host-allowlist=\"*\"\r\n  --rest-api-host-allowlist=\"*\"\r\n```\r\n(note that the allowlist option is not the same as the common http header cross-origin header thing).\r\n\r\n",
  "closed_by": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/1411/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/1411/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/666809897",
    "html_url": "https://github.com/sigp/lighthouse/issues/1411#issuecomment-666809897",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1411",
    "id": 666809897,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2NjgwOTg5Nw==",
    "user": {
      "login": "protolambda",
      "id": 19571989,
      "node_id": "MDQ6VXNlcjE5NTcxOTg5",
      "avatar_url": "https://avatars.githubusercontent.com/u/19571989?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/protolambda",
      "html_url": "https://github.com/protolambda",
      "followers_url": "https://api.github.com/users/protolambda/followers",
      "following_url": "https://api.github.com/users/protolambda/following{/other_user}",
      "gists_url": "https://api.github.com/users/protolambda/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/protolambda/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/protolambda/subscriptions",
      "organizations_url": "https://api.github.com/users/protolambda/orgs",
      "repos_url": "https://api.github.com/users/protolambda/repos",
      "events_url": "https://api.github.com/users/protolambda/events{/privacy}",
      "received_events_url": "https://api.github.com/users/protolambda/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-31T00:14:37Z",
    "updated_at": "2020-07-31T00:14:37Z",
    "author_association": "NONE",
    "body": "Extension of the idea: mirror the metrics endpoint options and server code in the validator client. So the validator can have its own metrics, tracked directly from the validator process. E.g. track signature times, how many duties it gets, and maybe some validator performance stats, etc. The Prysm validator client does it like this, and it works well.\r\n\r\nThis would also be very helpful for setting up alerts for testnet/mainnet validator incidents. cc @zedt3ster ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/666809897/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/667755145",
    "html_url": "https://github.com/sigp/lighthouse/issues/1411#issuecomment-667755145",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1411",
    "id": 667755145,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2Nzc1NTE0NQ==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-03T01:17:20Z",
    "updated_at": "2020-08-03T02:01:46Z",
    "author_association": "MEMBER",
    "body": "Sounds reasonable. Shame to run two HTTP servers, but I doubt it's a significant overhead.\r\n\r\nWe can address this when we do the refactor to the standard eth2 HTTP API.\r\n\r\nEDIT: marked as blocked since we will cover this with #1434.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/667755145/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/692295922",
    "html_url": "https://github.com/sigp/lighthouse/issues/1411#issuecomment-692295922",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1411",
    "id": 692295922,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MjI5NTkyMg==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-14T20:28:52Z",
    "updated_at": "2020-09-14T20:28:52Z",
    "author_association": "MEMBER",
    "body": "I am implementing this in #1569:\r\n\r\n```\r\n  --metrics --metrics-address=0.0.0.0 --metrics-port=8080\r\n```\r\n\r\nThank you for the detailed issue and output from other clients @protolambda.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/692295922/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/700458323",
    "html_url": "https://github.com/sigp/lighthouse/issues/1411#issuecomment-700458323",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1411",
    "id": 700458323,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMDQ1ODMyMw==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-29T05:50:24Z",
    "updated_at": "2020-09-29T05:50:24Z",
    "author_association": "MEMBER",
    "body": "Resolved via #1569",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/700458323/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
