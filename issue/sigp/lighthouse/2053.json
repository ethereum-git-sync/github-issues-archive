{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/2053",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/2053/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/2053/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/2053/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/2053",
  "id": 757785160,
  "node_id": "MDU6SXNzdWU3NTc3ODUxNjA=",
  "number": 2053,
  "title": "validator_definitions.yml is not created when creating validator",
  "user": {
    "login": "louqash",
    "id": 75442057,
    "node_id": "MDQ6VXNlcjc1NDQyMDU3",
    "avatar_url": "https://avatars.githubusercontent.com/u/75442057?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/louqash",
    "html_url": "https://github.com/louqash",
    "followers_url": "https://api.github.com/users/louqash/followers",
    "following_url": "https://api.github.com/users/louqash/following{/other_user}",
    "gists_url": "https://api.github.com/users/louqash/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/louqash/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/louqash/subscriptions",
    "organizations_url": "https://api.github.com/users/louqash/orgs",
    "repos_url": "https://api.github.com/users/louqash/repos",
    "events_url": "https://api.github.com/users/louqash/events{/privacy}",
    "received_events_url": "https://api.github.com/users/louqash/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-12-05T21:36:57Z",
  "updated_at": "2021-01-15T19:48:10Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nIn account manager, when creating validator account, it's not added to `validator_definitions.yml`.\r\nAlso it doesn't create one.\r\n\r\nIn `import.rs` at the end there is this code:\r\n```rust\r\nlet validator_def =\r\n    ValidatorDefinition::new_keystore_with_password(&dest_keystore, password_opt)\r\n        .map_err(|e| format!(\"Unable to create new validator definition: {:?}\", e))?;\r\n\r\ndefs.push(validator_def);\r\n\r\ndefs.save(&validator_dir)\r\n    .map_err(|e| format!(\"Unable to save {}: {:?}\", CONFIG_FILENAME, e))?;\r\n```\r\n\r\nThis creates `validator_definitions.yml` file if it doesn't exists and adds validator info.\r\n\r\n## Version\r\nmaster (tag: v1.0.3)\r\n\r\n## Steps to resolve\r\nWe should add something similar in `create.rs`. I'm working on it!\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/2053/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/2053/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/739514393",
    "html_url": "https://github.com/sigp/lighthouse/issues/2053#issuecomment-739514393",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2053",
    "id": 739514393,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczOTUxNDM5Mw==",
    "user": {
      "login": "louqash",
      "id": 75442057,
      "node_id": "MDQ6VXNlcjc1NDQyMDU3",
      "avatar_url": "https://avatars.githubusercontent.com/u/75442057?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/louqash",
      "html_url": "https://github.com/louqash",
      "followers_url": "https://api.github.com/users/louqash/followers",
      "following_url": "https://api.github.com/users/louqash/following{/other_user}",
      "gists_url": "https://api.github.com/users/louqash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/louqash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/louqash/subscriptions",
      "organizations_url": "https://api.github.com/users/louqash/orgs",
      "repos_url": "https://api.github.com/users/louqash/repos",
      "events_url": "https://api.github.com/users/louqash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/louqash/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-06T14:58:33Z",
    "updated_at": "2020-12-06T14:58:33Z",
    "author_association": "NONE",
    "body": "During analysis I fount that in `recover.rs`, slashing protection isn't created nor initialized and also `validator_definitions.yml` isn't created.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/739514393/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/761162695",
    "html_url": "https://github.com/sigp/lighthouse/issues/2053#issuecomment-761162695",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2053",
    "id": 761162695,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MTE2MjY5NQ==",
    "user": {
      "login": "louqash",
      "id": 75442057,
      "node_id": "MDQ6VXNlcjc1NDQyMDU3",
      "avatar_url": "https://avatars.githubusercontent.com/u/75442057?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/louqash",
      "html_url": "https://github.com/louqash",
      "followers_url": "https://api.github.com/users/louqash/followers",
      "following_url": "https://api.github.com/users/louqash/following{/other_user}",
      "gists_url": "https://api.github.com/users/louqash/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/louqash/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/louqash/subscriptions",
      "organizations_url": "https://api.github.com/users/louqash/orgs",
      "repos_url": "https://api.github.com/users/louqash/repos",
      "events_url": "https://api.github.com/users/louqash/events{/privacy}",
      "received_events_url": "https://api.github.com/users/louqash/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-15T19:47:40Z",
    "updated_at": "2021-01-15T19:48:10Z",
    "author_association": "NONE",
    "body": "After some time I've looked again at this issue.\r\nI now understand why this has happened.\r\nIn validator_client there is this piece of code:\r\n```rust\r\nlet new_validators = validator_defs\r\n        .discover_local_keystores(&config.validator_dir, &config.secrets_dir, &log)\r\n        .map_err(|e| format!(\"Unable to discover local validator keystores: {:?}\", e))?;\r\n```\r\nNow only upon starting validator client we're recursively going through all validators and if there exists corresponding secret file \r\n and this validator is not yet added to validator definitions, we're adding it.\r\n\r\nI've encountered this issue because I was trying to resolve this [issue](https://github.com/sigp/lighthouse/issues/2005)(deleting validator) and haven't had as intention to start validating.\r\n\r\nWith my purposed changes in PR we wouldn't need to scan entire directory every time and the secrets directory would be obsolete.\r\n\r\n@paulhauner Could you comment on that?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/761162695/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
