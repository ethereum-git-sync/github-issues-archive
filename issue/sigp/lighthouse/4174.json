{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/4174",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/4174/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/4174/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/4174/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/4174",
  "id": 1659355768,
  "node_id": "I_kwDOCFeAzc5i58J4",
  "number": 4174,
  "title": "lcli container build fails on stable branch",
  "user": {
    "login": "dboreham",
    "id": 1649760,
    "node_id": "MDQ6VXNlcjE2NDk3NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1649760?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dboreham",
    "html_url": "https://github.com/dboreham",
    "followers_url": "https://api.github.com/users/dboreham/followers",
    "following_url": "https://api.github.com/users/dboreham/following{/other_user}",
    "gists_url": "https://api.github.com/users/dboreham/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dboreham/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dboreham/subscriptions",
    "organizations_url": "https://api.github.com/users/dboreham/orgs",
    "repos_url": "https://api.github.com/users/dboreham/repos",
    "events_url": "https://api.github.com/users/dboreham/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dboreham/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-04-08T03:25:41Z",
  "updated_at": "2023-04-08T14:28:45Z",
  "closed_at": "2023-04-08T14:28:45Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Found while trying to build the `sigp/lcli` container from the currrent `stable` branch that it throws this compile time error:\r\n\r\n```\r\n   Compiling lighthouse_network v0.2.0 (/lighthouse/beacon_node/lighthouse_network)\r\n   Compiling environment v0.1.2 (/lighthouse/lighthouse/environment)\r\nerror[E0658]: use of unstable library feature 'map_first_last'\r\n  --> beacon_node/lighthouse_network/src/peer_manager/network_behaviour.rs:92:64\r\n   |\r\n92 |         if let Some((peer_id, maybe_enr)) = self.peers_to_dial.pop_first() {\r\n   |                                                                ^^^^^^^^^\r\n   |\r\n   = note: see issue #62924 <https://github.com/rust-lang/rust/issues/62924> for more information\r\n\r\n   Compiling operation_pool v0.2.0 (/lighthouse/beacon_node/operation_pool)\r\nFor more information about this error, try `rustc --explain E0658`.\r\nerror: could not compile `lighthouse_network` due to previous error\r\n```\r\n\r\nAlso noticed that this container specifies a [different version of Rust](https://github.com/sigp/lighthouse/blob/stable/lcli/Dockerfile#L4) vs the [version used](https://github.com/sigp/lighthouse/blob/stable/Dockerfile#L1) for the `sigp/lighthouse` container.\r\n\r\nAnd the build is fixed by using Rust 1.66:\r\n\r\n```\r\ndiff --git a/lcli/Dockerfile b/lcli/Dockerfile\r\nindex feda81d03..079e5c779 100644\r\n--- a/lcli/Dockerfile\r\n+++ b/lcli/Dockerfile\r\n@@ -1,7 +1,7 @@\r\n # `lcli` requires the full project to be in scope, so this should be built either:\r\n #  - from the `lighthouse` dir with the command: `docker build -f ./lcli/Dockerflie .`\r\n #  - from the current directory with the command: `docker build -f ./Dockerfile ../`\r\n-FROM rust:1.65.0-bullseye AS builder\r\n+FROM rust:1.66.0-bullseye AS builder\r\n RUN apt-get update && apt-get -y upgrade && apt-get install -y cmake libclang-dev protobuf-compiler\r\n COPY . lighthouse\r\n ARG PORTABLE\r\n```\r\n",
  "closed_by": {
    "login": "dboreham",
    "id": 1649760,
    "node_id": "MDQ6VXNlcjE2NDk3NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1649760?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dboreham",
    "html_url": "https://github.com/dboreham",
    "followers_url": "https://api.github.com/users/dboreham/followers",
    "following_url": "https://api.github.com/users/dboreham/following{/other_user}",
    "gists_url": "https://api.github.com/users/dboreham/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dboreham/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dboreham/subscriptions",
    "organizations_url": "https://api.github.com/users/dboreham/orgs",
    "repos_url": "https://api.github.com/users/dboreham/repos",
    "events_url": "https://api.github.com/users/dboreham/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dboreham/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/4174/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/4174/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1500830495",
    "html_url": "https://github.com/sigp/lighthouse/issues/4174#issuecomment-1500830495",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4174",
    "id": 1500830495,
    "node_id": "IC_kwDOCFeAzc5ZdNsf",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-08T09:03:06Z",
    "updated_at": "2023-04-08T09:03:06Z",
    "author_association": "MEMBER",
    "body": "Thanks for the report\n\nWe've fixed this on unstable and it will be fixed on stable when the next release is published. The lcli build from unstable should be useable for everything that the stable build would be (no breaking changes, etc)\n\nIf you don't mind, I'll close this issue and the PR üôè ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1500830495/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
