{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3457",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3457/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3457/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3457/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3457",
  "id": 1336186379,
  "node_id": "I_kwDOCFeAzc5PpJYL",
  "number": 3457,
  "title": "GET fee recipient (key manager API) always returns the default one even if a new one was already set",
  "user": {
    "login": "jvbriones",
    "id": 1674192,
    "node_id": "MDQ6VXNlcjE2NzQxOTI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1674192?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jvbriones",
    "html_url": "https://github.com/jvbriones",
    "followers_url": "https://api.github.com/users/jvbriones/followers",
    "following_url": "https://api.github.com/users/jvbriones/following{/other_user}",
    "gists_url": "https://api.github.com/users/jvbriones/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jvbriones/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jvbriones/subscriptions",
    "organizations_url": "https://api.github.com/users/jvbriones/orgs",
    "repos_url": "https://api.github.com/users/jvbriones/repos",
    "events_url": "https://api.github.com/users/jvbriones/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jvbriones/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 985647287,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODc=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/invalid",
      "name": "invalid",
      "color": "e4e669",
      "default": true,
      "description": "This doesn't seem right"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-08-11T16:13:09Z",
  "updated_at": "2022-08-18T09:00:17Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nAfter a POST for a {pubkey} with a new fee recipient value (via [Key manager API](https://ethereum.github.io/keymanager-APIs/#/Fee%20Recipient)) we can check that the new value is properly saved in the _validator_definitions.yml_ file. Nonetheless, the next time requesting GET for the same {pubkey} LightHouse returns the default fee recipient value (set at startup with _--suggested-fee-recipient_).\r\n\r\n## Version\r\n\r\ndocker - v2.5.1-modern\r\n\r\n## Present Behaviour\r\n\r\n**GET /eth/v1/validator/{pubkey}/feerecipient**\r\nIt always returns the default --suggested-fee-recipient value even if a new one was already set for {pubkey}.\r\n\r\n## Expected Behaviour\r\n\r\nTo return the suggested_fee_recipient value set for the given {pubkey} already saved in validator_definitions.yml.\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3457/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3457/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1216069802",
    "html_url": "https://github.com/sigp/lighthouse/issues/3457#issuecomment-1216069802",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3457",
    "id": 1216069802,
    "node_id": "IC_kwDOCFeAzc5Ie8Cq",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-16T02:23:01Z",
    "updated_at": "2022-08-16T02:23:01Z",
    "author_association": "MEMBER",
    "body": "I can't reproduce this issue. When I make a POST request to set the fee recipient it gets reflected in the GET request and is written to the `validator_defintions.yml`.\r\n\r\nThe commands I used to test this were:\r\n\r\nPOST:\r\n\r\n```\r\ncurl -X POST --data '{\"ethaddress\": \"0x0000000000000000000000000000000000000000\"}' -H \"Content-Type: application/json\" -H \"Authorization: Bearer $(cat ~/.lighthouse/prater/validators/api-token.txt)\" \"http://localhost:5062/eth/v1/validator/0x80f4b7f663a385eccbffeccdb13592111cd4e82c0ebb24e5902a4546034e97d0ee039ae6845f571e6aca8f1f861f7faf/feerecipient\"\r\n```\r\n\r\nand then GET\r\n\r\n```\r\ncurl -s -H \"Authorization: Bearer $(cat ~/.lighthouse/prater/validators/api-token.txt)\" \"http://localhost:5062/eth/v1/validator/0x80f4b7f663a385eccbffeccdb13592111cd4e82c0ebb24e5902a4546034e97d0ee039ae6845f571e6aca8f1f861f7faf/feerecipient\" | jq\r\n{\r\n  \"data\": {\r\n    \"pubkey\": \"0x80f4b7f663a385eccbffeccdb13592111cd4e82c0ebb24e5902a4546034e97d0ee039ae6845f571e6aca8f1f861f7faf\",\r\n    \"ethaddress\": \"0x0000000000000000000000000000000000000000\"\r\n  }\r\n}\r\n```\r\n\r\nmeanwhile my `lighthouse vc` is running using a different address for the `--suggested-fee-recipient` default:\r\n\r\n```\r\n./lighthouse vc \\\r\n\t--network prater \\\r\n\t--graffiti \"lighthouse-nethermind-infura\" \\\r\n\t--http \\\r\n\t--http-allow-origin '*' \\\r\n\t--suggested-fee-recipient \"0xaEBBc82507Ec0aD78e2BF285077B7c38F23B7F83\"\r\n```\r\n\r\nAre you sure that your POST request isn't failing?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1216069802/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1216281833",
    "html_url": "https://github.com/sigp/lighthouse/issues/3457#issuecomment-1216281833",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3457",
    "id": 1216281833,
    "node_id": "IC_kwDOCFeAzc5Ifvzp",
    "user": {
      "login": "jvbriones",
      "id": 1674192,
      "node_id": "MDQ6VXNlcjE2NzQxOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1674192?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jvbriones",
      "html_url": "https://github.com/jvbriones",
      "followers_url": "https://api.github.com/users/jvbriones/followers",
      "following_url": "https://api.github.com/users/jvbriones/following{/other_user}",
      "gists_url": "https://api.github.com/users/jvbriones/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jvbriones/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jvbriones/subscriptions",
      "organizations_url": "https://api.github.com/users/jvbriones/orgs",
      "repos_url": "https://api.github.com/users/jvbriones/repos",
      "events_url": "https://api.github.com/users/jvbriones/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jvbriones/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-16T08:00:06Z",
    "updated_at": "2022-08-16T08:00:06Z",
    "author_association": "NONE",
    "body": "The POST is working fine (202) and saving into the `validator_defintions.yml` the given fee recipient config. \r\n\r\nThe problem seems to be with the GET when having more than one validator configured. It only returns properly the first entry, for the rest _pubkeys_ it always returns the default `--suggested-fee-recipient` value.\r\n\r\nPlease try it out again with several _pubkeys_ configured in validator_definitions.yml.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1216281833/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1216918873",
    "html_url": "https://github.com/sigp/lighthouse/issues/3457#issuecomment-1216918873",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3457",
    "id": 1216918873,
    "node_id": "IC_kwDOCFeAzc5IiLVZ",
    "user": {
      "login": "ethDreamer",
      "id": 37123614,
      "node_id": "MDQ6VXNlcjM3MTIzNjE0",
      "avatar_url": "https://avatars.githubusercontent.com/u/37123614?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ethDreamer",
      "html_url": "https://github.com/ethDreamer",
      "followers_url": "https://api.github.com/users/ethDreamer/followers",
      "following_url": "https://api.github.com/users/ethDreamer/following{/other_user}",
      "gists_url": "https://api.github.com/users/ethDreamer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ethDreamer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ethDreamer/subscriptions",
      "organizations_url": "https://api.github.com/users/ethDreamer/orgs",
      "repos_url": "https://api.github.com/users/ethDreamer/repos",
      "events_url": "https://api.github.com/users/ethDreamer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ethDreamer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-16T17:10:46Z",
    "updated_at": "2022-08-16T17:10:46Z",
    "author_association": "COLLABORATOR",
    "body": "> The POST is working fine (202) and saving into the `validator_defintions.yml` the given fee recipient config.\r\n> \r\n> The problem seems to be with the GET when having more than one validator configured. It only returns properly the first entry, for the rest _pubkeys_ it always returns the default `--suggested-fee-recipient` value.\r\n> \r\n> Please try it out again with several _pubkeys_ configured in validator_definitions.yml.\r\n\r\n@jvbriones\r\nThe `POST` request has the `PUBKEY` as part of the URL because the request applies **only to that specific** `PUBKEY`. This is the expected behavior:\r\n * `GET` `PUBKEY1`\r\n * > default\r\n * `GET` `PUBKEY2`\r\n * > default\r\n * `GET` `PUBKEY3`\r\n * > default\r\n * `POST` `PUBKEY2` `FEE_RECIPIENT2`\r\n * > null\r\n * `GET` `PUBKEY2`\r\n * > FEE_RECIPIENT2\r\n* `GET` `PUBKEY3`\r\n* > default\r\n* `POST` `PUBKEY3` `FEE_RECIPIENT3`\r\n* > null\r\n* `GET` `PUBKEY3`\r\n* > FEE_RECIPIENT3\r\n* `GET` `PUBKEY1`\r\n* > default\r\n\r\nand [I confirmed this behavior](https://gist.github.com/ethDreamer/0a59c6b09f78844669655ebf0987c9fb) with `Lighthouse v2.5.1-4fc0cb1`",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1216918873/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1219218553",
    "html_url": "https://github.com/sigp/lighthouse/issues/3457#issuecomment-1219218553",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3457",
    "id": 1219218553,
    "node_id": "IC_kwDOCFeAzc5Iq8x5",
    "user": {
      "login": "jvbriones",
      "id": 1674192,
      "node_id": "MDQ6VXNlcjE2NzQxOTI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1674192?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jvbriones",
      "html_url": "https://github.com/jvbriones",
      "followers_url": "https://api.github.com/users/jvbriones/followers",
      "following_url": "https://api.github.com/users/jvbriones/following{/other_user}",
      "gists_url": "https://api.github.com/users/jvbriones/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jvbriones/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jvbriones/subscriptions",
      "organizations_url": "https://api.github.com/users/jvbriones/orgs",
      "repos_url": "https://api.github.com/users/jvbriones/repos",
      "events_url": "https://api.github.com/users/jvbriones/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jvbriones/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-18T09:00:16Z",
    "updated_at": "2022-08-18T09:00:16Z",
    "author_association": "NONE",
    "body": "This issue could be related with my local env (Mac M1). The 2.5.1 version deployed **in our dev environment it's working as expected.** No idea why is not working for me, but from this point on, I will share my findings in case it helps. If it's not reproducible anymore I guess we better close it.\r\n\r\n-----\r\n\r\n> The POST request has the PUBKEY as part of the URL because the request applies only to that specific PUBKEY.\r\n\r\nYes, the POST has been always working fine. The issue is related with the GET, since is not returning the new given value already saved in `validator_defintions.yml` after a POST request. It still happening to me, and tried again for both docker version (latest-arm) and latest 2.5.1 binary. Observed behaviours:\r\n\r\n```\r\nFEE_RECIPIENT2 = 0x0000000000000000000000000000000000000000\r\n\r\n./lighthouse vc \\\r\n--network prater \\\r\n--http \\\r\n--http-allow-origin '*' \\\r\n--suggested-fee-recipient \"0xd50.....\" \\\r\n--unencrypted-http-transport \\\r\n--http-address \"0.0.0.0\"\r\n```\r\n\r\n`GET` `PUBKEY1`\r\n> default (0xd50....)\r\n\r\n`GET` `PUBKEY2`\r\n> default (0xd50....)\r\n\r\n`POST` `PUBKEY2` `FEE_RECIPIENT2` -> (returns 202, and also add the new value (0x000..) in `suggested_fee_recipient` for PUBKEY2 entry in `validator_defintions.yml`)\r\n> null\r\n\r\n`GET PUBKEY2`\r\n> default (0xd50....)\r\n\r\nSometimes the GET was working fine just for the first entry `PUBKEY1`. In another try, also happened that after a single POST request for a specific PUBKEY, **all the others** PUBKEYS entries were as well updated with **previous used values** for their `suggested_fee_recipient` in `validator_defintions.yml`, like a batch operation. I wonder if is due a kind of cache that is  acting in between or due a not fully synced EL or CL. \r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1219218553/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
