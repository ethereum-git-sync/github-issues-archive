{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/454",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/454/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/454/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/454/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/454",
  "id": 473155005,
  "node_id": "MDU6SXNzdWU0NzMxNTUwMDU=",
  "number": 454,
  "title": "Add logic to handle whether to drop peers given their protocol support",
  "user": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 985647284,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODQ=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/enhancement",
      "name": "enhancement",
      "color": "a2eeef",
      "default": true,
      "description": "New feature or request"
    },
    {
      "id": 2336800125,
      "node_id": "MDU6TGFiZWwyMzM2ODAwMTI1",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/t%20Networking",
      "name": "t Networking",
      "color": "40E0D0",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2019-07-26T03:06:22Z",
  "updated_at": "2022-10-20T17:14:02Z",
  "closed_at": "2020-08-21T01:26:10Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nCurrently lighthouse will disconnect from peers that do not support all the libp2p protocols that we do (Gossipsub / Ping / All Eth 2 RPC's). Note: We will be removing Ping in favour of discv5 ping in the near future. \r\n\r\nThis issue is about adding specific logic around which minimal protocols a peer can support that we accept without disconnecting. \r\n\r\nPotentially we should allow a subset of the RPC protocols and decide if we should support peers that don't support gossipsub. \r\n",
  "closed_by": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/454/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/454/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/517356974",
    "html_url": "https://github.com/sigp/lighthouse/issues/454#issuecomment-517356974",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/454",
    "id": 517356974,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxNzM1Njk3NA==",
    "user": {
      "login": "b-m-f",
      "id": 2843450,
      "node_id": "MDQ6VXNlcjI4NDM0NTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2843450?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/b-m-f",
      "html_url": "https://github.com/b-m-f",
      "followers_url": "https://api.github.com/users/b-m-f/followers",
      "following_url": "https://api.github.com/users/b-m-f/following{/other_user}",
      "gists_url": "https://api.github.com/users/b-m-f/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/b-m-f/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/b-m-f/subscriptions",
      "organizations_url": "https://api.github.com/users/b-m-f/orgs",
      "repos_url": "https://api.github.com/users/b-m-f/repos",
      "events_url": "https://api.github.com/users/b-m-f/events{/privacy}",
      "received_events_url": "https://api.github.com/users/b-m-f/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-01T16:16:34Z",
    "updated_at": "2019-08-01T16:17:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi @AgeManning,\r\n\r\nI found\r\n- https://github.com/sigp/lighthouse/blob/master/beacon_node/network/src/sync/simple_sync.rs#L169 \r\n- https://github.com/sigp/lighthouse/blob/master/beacon_node/network/src/message_handler.rs#L246\r\n- https://github.com/sigp/lighthouse/blob/master/beacon_node/network/src/sync/simple_sync.rs#L115 \r\n\r\nas places where a peer is or could be disconnected.\r\n\r\nIs there any other place I am missing? \r\nFrom what I see the disconnect could happen by checking the remote clients capabilities on a **handshake**, or if an RPC of a specific kind returns with a **ErrorResponse**?\r\n\r\nAnd for clients that do not support gossiping, does this mean that they will have to be stored in a separate data structure, for which a request will need to be sent to each Peer in it, when an important update has to be broadcast?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/517356974/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/518455185",
    "html_url": "https://github.com/sigp/lighthouse/issues/454#issuecomment-518455185",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/454",
    "id": 518455185,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUxODQ1NTE4NQ==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-08-06T01:02:28Z",
    "updated_at": "2019-08-06T01:02:28Z",
    "author_association": "MEMBER",
    "body": "This one is a little more involved in libp2p land. We should solidify this issue as we progress with interop. For now, I think we just let peers support arbitrary protocols so clients don't drop others instantly. \r\n\r\nWhen negotiating protocols, if an error occurs when negotiating an outbound request the peer gets dropped. This logic needs to be handled in our fork of rust-libp2p for gossipsub, and occurs here: \r\nhttps://github.com/sigp/lighthouse/blob/master/beacon_node/eth2-libp2p/src/rpc/handler.rs#L260\r\n\r\nI'm currently working a branch for interop which allows clients to not support protocols. \r\n\r\nI'll have to rewrite some of our networking side to match the recently merged ethereum 2.0 network specification. \r\n\r\nI guess we decide on the logic of this after we have a few clients talking I think.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/518455185/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/675152403",
    "html_url": "https://github.com/sigp/lighthouse/issues/454#issuecomment-675152403",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/454",
    "id": 675152403,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NTE1MjQwMw==",
    "user": {
      "login": "divagant-martian",
      "id": 26765164,
      "node_id": "MDQ6VXNlcjI2NzY1MTY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/26765164?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/divagant-martian",
      "html_url": "https://github.com/divagant-martian",
      "followers_url": "https://api.github.com/users/divagant-martian/followers",
      "following_url": "https://api.github.com/users/divagant-martian/following{/other_user}",
      "gists_url": "https://api.github.com/users/divagant-martian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/divagant-martian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/divagant-martian/subscriptions",
      "organizations_url": "https://api.github.com/users/divagant-martian/orgs",
      "repos_url": "https://api.github.com/users/divagant-martian/repos",
      "events_url": "https://api.github.com/users/divagant-martian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/divagant-martian/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-17T22:47:42Z",
    "updated_at": "2020-08-17T22:47:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "Don't we already do this to some extent? we have [this](https://github.com/sigp/lighthouse/blob/850a2d5985cc08e978b5b492bb0cb90a47359605/beacon_node/eth2_libp2p/src/peer_manager/mod.rs#L345)",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/675152403/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/677987017",
    "html_url": "https://github.com/sigp/lighthouse/issues/454#issuecomment-677987017",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/454",
    "id": 677987017,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3Nzk4NzAxNw==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-21T01:26:10Z",
    "updated_at": "2020-08-21T01:26:10Z",
    "author_association": "MEMBER",
    "body": "Yes we do in some extent for the RPC. \r\n\r\nI think there may be crawlers on the network that only support gossipsub for example. I guess as the network grows we will adjust and change these. \r\n\r\nUntil specific implementations complain, lets just keep what we have and we can adapt as we go. ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/677987017/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
