{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3413",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3413/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3413/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3413/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3413",
  "id": 1326326960,
  "node_id": "I_kwDOCFeAzc5PDiSw",
  "number": 3413,
  "title": "\"Previous epoch attestation(s)\" errors and warnings—how to remedy or at least reduce?",
  "user": {
    "login": "JamesCropcho",
    "id": 3657,
    "node_id": "MDQ6VXNlcjM2NTc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3657?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/JamesCropcho",
    "html_url": "https://github.com/JamesCropcho",
    "followers_url": "https://api.github.com/users/JamesCropcho/followers",
    "following_url": "https://api.github.com/users/JamesCropcho/following{/other_user}",
    "gists_url": "https://api.github.com/users/JamesCropcho/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/JamesCropcho/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/JamesCropcho/subscriptions",
    "organizations_url": "https://api.github.com/users/JamesCropcho/orgs",
    "repos_url": "https://api.github.com/users/JamesCropcho/repos",
    "events_url": "https://api.github.com/users/JamesCropcho/events{/privacy}",
    "received_events_url": "https://api.github.com/users/JamesCropcho/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-08-02T19:45:35Z",
  "updated_at": "2022-08-03T16:02:47Z",
  "closed_at": "2022-08-03T16:02:46Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nThe log of `lighthouse beacon_node` (when restricted to `ERRO` and `WARN`) has clumps of entries like:\r\n\r\n```\r\n13:01:08.219 ERRO Previous epoch attestation(s) missing   validators: [\"val1\", \"val2\"], epoch: 137070, service: val_mon\r\n13:01:08.219 WARN Previous epoch attestation(s) failed to match head, validators: [\"val1\", \"val3\", \"val2\"], epoch: 137070, service: val_mon\r\n13:01:08.219 WARN Previous epoch attestation(s) failed to match target, validators: [\"val1\", \"val2\"], epoch: 137070, service: val_mon\r\n13:01:08.219 WARN Previous epoch attestation(s) had sub-optimal inclusion delay, validators: [\"val3\"], epoch: 137070, service: val_mon\r\n```\r\n\r\nThese clumps appear perhaps once every two hours on a beacon node whose validator client has ~100 validators. Notable configuration includes:\r\n```\r\n--validator-monitor-auto\r\n--target-peers 18\r\n--http-disable-legacy-spec\r\n```\r\n\r\n`--block-cache-size` is left to the default.\r\n\r\n`--target-peers` was lowered in the interest of reducing compute costs by reducing outbound traffic (_aside_: however, honestly the change does not appear to have affected the volume of outbound traffic).\r\n\r\nThe clumps do _not_ always include the `ERRO` entry.\r\n\r\n## Version\r\n\r\nhttps://github.com/sigp/lighthouse/releases/download/v2.5.0/lighthouse-v2.5.0-aarch64-unknown-linux-gnu.tar.gz\r\n\r\n## Expected Behaviour\r\n\r\nI have a lot of experience administering decentralized systems and I do understand that a certain frequency of—and types of—warnings are a normal part of healthy operation. However, 1) I have an interest in optimizing this staking infrastructure both from the perspective of maximizing rewards as well as minimizing compute costs; and 2) errors are often more severe than warnings, so if the same one occurs regularly I at least need to comprehend it.\r\n\r\n## Steps to Resolve\r\n\r\nIf anyone is able to tell me whether any of the below tactics (or others) may possibly reduce the frequency or severity (e.g. remedy the `ERRO`) of said events, and hence to resolve the issue, or—just as valuable—if any/all are likely to have _no_ helpful effect, I would appreciate it:\r\n\r\n1) Increase/decrease `target-peers`\r\n1) Increase/decrease `block-cache-size`\r\n1) Increase the IOPS (I/O ops per second) available to the SDD storage of the `data-dir`\r\n1) Increase the throughput (MB per second) available to the SDD storage of the `data-dir`\r\n1) Increase the number of CPU/vCPU cores of the cloud instance running `lighthouse beacon_node`\r\n1) Increase the allotted network performance capacity of the cloud instance running `lighthouse beacon_node`\r\n\r\nThanks for reading.",
  "closed_by": {
    "login": "JamesCropcho",
    "id": 3657,
    "node_id": "MDQ6VXNlcjM2NTc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/3657?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/JamesCropcho",
    "html_url": "https://github.com/JamesCropcho",
    "followers_url": "https://api.github.com/users/JamesCropcho/followers",
    "following_url": "https://api.github.com/users/JamesCropcho/following{/other_user}",
    "gists_url": "https://api.github.com/users/JamesCropcho/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/JamesCropcho/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/JamesCropcho/subscriptions",
    "organizations_url": "https://api.github.com/users/JamesCropcho/orgs",
    "repos_url": "https://api.github.com/users/JamesCropcho/repos",
    "events_url": "https://api.github.com/users/JamesCropcho/events{/privacy}",
    "received_events_url": "https://api.github.com/users/JamesCropcho/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3413/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3413/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1203298238",
    "html_url": "https://github.com/sigp/lighthouse/issues/3413#issuecomment-1203298238",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3413",
    "id": 1203298238,
    "node_id": "IC_kwDOCFeAzc5HuN--",
    "user": {
      "login": "pawanjay176",
      "id": 9890508,
      "node_id": "MDQ6VXNlcjk4OTA1MDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pawanjay176",
      "html_url": "https://github.com/pawanjay176",
      "followers_url": "https://api.github.com/users/pawanjay176/followers",
      "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
      "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
      "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
      "repos_url": "https://api.github.com/users/pawanjay176/repos",
      "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-02T23:08:41Z",
    "updated_at": "2022-08-02T23:08:41Z",
    "author_association": "MEMBER",
    "body": "I think the first thing to do is increase your target peers to the default value (80). Keeping your target peers at such a low value will lead to your node not finding enough peers in the required attestation subnets which will lead to your attestation not reaching enough aggregators and eventually not getting included in blocks.\r\n\r\nIncreasing the target peers will not have that big effect on the bandwidth, that depends on gossipsub protocol configs. See this comment for more details https://github.com/sigp/lighthouse/pull/3005#issuecomment-1046468579",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1203298238/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1204153881",
    "html_url": "https://github.com/sigp/lighthouse/issues/3413#issuecomment-1204153881",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3413",
    "id": 1204153881,
    "node_id": "IC_kwDOCFeAzc5Hxe4Z",
    "user": {
      "login": "JamesCropcho",
      "id": 3657,
      "node_id": "MDQ6VXNlcjM2NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3657?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/JamesCropcho",
      "html_url": "https://github.com/JamesCropcho",
      "followers_url": "https://api.github.com/users/JamesCropcho/followers",
      "following_url": "https://api.github.com/users/JamesCropcho/following{/other_user}",
      "gists_url": "https://api.github.com/users/JamesCropcho/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/JamesCropcho/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/JamesCropcho/subscriptions",
      "organizations_url": "https://api.github.com/users/JamesCropcho/orgs",
      "repos_url": "https://api.github.com/users/JamesCropcho/repos",
      "events_url": "https://api.github.com/users/JamesCropcho/events{/privacy}",
      "received_events_url": "https://api.github.com/users/JamesCropcho/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-03T16:02:46Z",
    "updated_at": "2022-08-03T16:02:46Z",
    "author_association": "NONE",
    "body": "Thank you for your insight and helpful reply, Pawan, as well as the link to the earlier comment.\r\n\r\nOkay, I have increased `target-peers` to the default.\r\n\r\nAlso, \"for fun\" I have increased `block-cache-size` to 15—my `lighthouse beacon_node` seems to require 8 cores and I have a suplus of RAM. If you believe I should not mess with `block-cache-size` kindly let me know and I'll restore the default value. My thinking here is along the lines of, \"eh, couldn't hurt,\" but I may be mistaken.\r\n\r\nI have nothing to report as I'll have to wait at least 24h to see what happens, but I can report back upon request.\r\n\r\nThank you again.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1204153881/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
