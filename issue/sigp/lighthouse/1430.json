{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/1430",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/1430/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/1430/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/1430/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/1430",
  "id": 669867439,
  "node_id": "MDU6SXNzdWU2Njk4Njc0Mzk=",
  "number": 1430,
  "title": "Read Only access for Validator's datadir",
  "user": {
    "login": "Amxx",
    "id": 2432299,
    "node_id": "MDQ6VXNlcjI0MzIyOTk=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2432299?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Amxx",
    "html_url": "https://github.com/Amxx",
    "followers_url": "https://api.github.com/users/Amxx/followers",
    "following_url": "https://api.github.com/users/Amxx/following{/other_user}",
    "gists_url": "https://api.github.com/users/Amxx/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Amxx/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Amxx/subscriptions",
    "organizations_url": "https://api.github.com/users/Amxx/orgs",
    "repos_url": "https://api.github.com/users/Amxx/repos",
    "events_url": "https://api.github.com/users/Amxx/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Amxx/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2336802021,
      "node_id": "MDU6TGFiZWwyMzM2ODAyMDIx",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/UX-and-logs",
      "name": "UX-and-logs",
      "color": "DB9046",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-07-31T14:20:21Z",
  "updated_at": "2022-05-05T23:47:25Z",
  "closed_at": "2020-11-08T23:38:07Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nUnlike the beacon's datadir, which store the chain data and absolutelly needs write access, the validator's datadir is only used for keys and doesn't absolutely needs write access. I would argue that giving readonly access to the volume containng one's keystore is a good security behaviour. This is owever not possible today.\r\n\r\nBy default, the validator needs write access  so it can looks through the all your keystores and adds any missing keystores to the `validator-definitions.yml`. This feature can be disabled using the `--disable-auto-discover` flag.\r\n\r\nEven with the `--disable-auto-discover` flag, the validator will stil fail with read only volumes since it is not able to write the `keystore-xxx.lock` file.\r\n\r\n## Version\r\n\r\nUsing Docker: `sigp/lighthouse latest cfb1594e63d5`\r\n\r\n## Present Behaviour\r\n\r\nGetting this faillure on the validator:\r\n```\r\nvalidator_1  | Failed to init validator client: Unable to open or create validator definitions: UnableToOpenFile(Os { code: 30, kind: Other, message: \"Read-only file system\" })\r\n```\r\n\r\n## Expected Behaviour\r\n\r\nDisregard the inability to lock the keystore (using a cli option?) and start the validator with an unlocked keystore.\r\n\r\n## Steps to resolve\r\n\r\nStart a validator with --datadir pointing to a readonly folder/volume",
  "closed_by": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/1430/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 1
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/1430/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/667756986",
    "html_url": "https://github.com/sigp/lighthouse/issues/1430#issuecomment-667756986",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1430",
    "id": 667756986,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2Nzc1Njk4Ng==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-03T01:25:36Z",
    "updated_at": "2020-08-03T01:25:36Z",
    "author_association": "MEMBER",
    "body": "> Disregard the inability to lock the keystore (using a cli option?) and start the validator with an unlocked keystore.\r\n\r\nChoosing to completely disregard lockfiles for mainnet will be quite a risky move. For example, running `lighthouse vc` twice will likely eventually result in all of your validators being slashed.\r\n\r\nThat being said, I can see how an `--no-lockfiles` flag could be useful as long as we surround it with lots of \"DANGER\" documentation.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/667756986/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/723683603",
    "html_url": "https://github.com/sigp/lighthouse/issues/1430#issuecomment-723683603",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1430",
    "id": 723683603,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyMzY4MzYwMw==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-08T23:38:07Z",
    "updated_at": "2020-11-08T23:38:07Z",
    "author_association": "MEMBER",
    "body": "Closing due to inactivity. Please feel free to reopen if this feature is still desired.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/723683603/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1119142996",
    "html_url": "https://github.com/sigp/lighthouse/issues/1430#issuecomment-1119142996",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1430",
    "id": 1119142996,
    "node_id": "IC_kwDOCFeAzc5CtMRU",
    "user": {
      "login": "bergkvist",
      "id": 410028,
      "node_id": "MDQ6VXNlcjQxMDAyOA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/410028?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bergkvist",
      "html_url": "https://github.com/bergkvist",
      "followers_url": "https://api.github.com/users/bergkvist/followers",
      "following_url": "https://api.github.com/users/bergkvist/following{/other_user}",
      "gists_url": "https://api.github.com/users/bergkvist/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bergkvist/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bergkvist/subscriptions",
      "organizations_url": "https://api.github.com/users/bergkvist/orgs",
      "repos_url": "https://api.github.com/users/bergkvist/repos",
      "events_url": "https://api.github.com/users/bergkvist/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bergkvist/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-05T23:43:22Z",
    "updated_at": "2022-05-05T23:47:25Z",
    "author_association": "NONE",
    "body": "I'm trying to run validators inside Kubernetes, in which case these lock files don't really provide any kind of protection.\r\n\r\nUsing a \"StatefulSet\" with replicas=1 in Kubernetes I can make sure that I'm not running two validators at the same time - so that solves the same problem in a different way.\r\n\r\nIf I specify `validator-definitions.yml` and keystore contents in a \"ConfigMap\"/\"Secret\" in Kubernetes, and mount them into the validator-client container as files. They will be read-only, which causes lighthouse to complain about read-only file system and exit.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1119142996/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
