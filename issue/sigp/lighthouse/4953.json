{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/4953",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/4953/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/4953/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/4953/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/4953",
  "id": 2011392646,
  "node_id": "I_kwDOCFeAzc5342qG",
  "number": 4953,
  "title": "Attestation Queue Full due to insufficient resources ",
  "user": {
    "login": "tobidae-cb",
    "id": 107199804,
    "node_id": "U_kgDOBmO9PA",
    "avatar_url": "https://avatars.githubusercontent.com/u/107199804?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tobidae-cb",
    "html_url": "https://github.com/tobidae-cb",
    "followers_url": "https://api.github.com/users/tobidae-cb/followers",
    "following_url": "https://api.github.com/users/tobidae-cb/following{/other_user}",
    "gists_url": "https://api.github.com/users/tobidae-cb/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tobidae-cb/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tobidae-cb/subscriptions",
    "organizations_url": "https://api.github.com/users/tobidae-cb/orgs",
    "repos_url": "https://api.github.com/users/tobidae-cb/repos",
    "events_url": "https://api.github.com/users/tobidae-cb/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tobidae-cb/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-11-27T03:00:33Z",
  "updated_at": "2023-11-27T07:59:20Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\nOur lighthouse container running on Kubernetes keeps having intermittent bursts of the Attestation Queue Full error. I initially tried bumping the compute to use 40vCPU and 200Gi of RAM on a i3en.24xlarge compute but that's already starting to fail.\r\n\r\nThis issue after a while clears up but as it continues to come up, it's affecting smooth operations of our Nodes. I'll provide additional details like logs, e.t.c below.\r\n\r\nThe lighthouse configuration is meant to act as an archival consensus deployment so we have `--slots-per-restore-point=32` set as a  beacon node flag\r\n\r\n## Version\r\n* Lighthouse Version: stable v4.5.0 - commit - `441fc1691b69f9edc4bbdc6665f3efab16265c9b`\r\n* Rust Version: 1.69.0\r\n\r\n## Present Behaviour\r\n\r\nAt a random time, our node will be syncing, then stop displaying the `New block received` message. After roughly 2 minutes, the `Aggregate attestation queue full` message starts displaying. \r\n\r\nAbout 3 minutes before this happens, there is a spike in the amount of CPU being used from 3vCPUs to 55 before settling at 40vCPU. The RAM usage also spikes from 7GiB to 50GiB (went to 84GiB but settled at 50). \r\n\r\nWhile writing this message the issue self resolved, I'm guessing once the queue was cleared.\r\n\r\n### LOGS\r\n```\r\nethereum-1 lighthouse Nov 27 02:12:53.001 INFO Synced                                  slot: 7852262, block: 0x1794…b72c, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0x5c80…2b36 (verified), peers: 77, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:12:59.755 INFO New block received                      root: 0xf810195fb93cedafaa062e78eb851bae73b590ddf09af8e318122e06af0e7ae3, slot: 7852263\r\nethereum-1 lighthouse Nov 27 02:13:05.001 INFO Synced                                  slot: 7852263, block: 0xf810…7ae3, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0xdb2a…0ab3 (verified), peers: 78, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:13:11.946 INFO New block received                      root: 0x89e9847d0cb4868972dbe656795fc156ea21bcdc43acdd6da9475a4298feaa29, slot: 7852264\r\nethereum-1 lighthouse Nov 27 02:13:17.000 INFO Synced                                  slot: 7852264, block: 0x89e9…aa29, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0xdab8…e692 (verified), peers: 78, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:13:19.209 INFO Imported deposit log(s)                 new: 1, total: 1079188, latest_block: 18658394, service: deposit_contract_rpc\r\nethereum-1 lighthouse Nov 27 02:13:24.424 INFO New block received                      root: 0xe73781beef4bfc953ee01ff51fac5c20e14db4bf3946d3318c61a0b88c821b22, slot: 7852265\r\nethereum-1 lighthouse Nov 27 02:13:29.000 INFO Synced                                  slot: 7852265, block: 0xe737…1b22, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0x44be…1e2f (verified), peers: 78, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:13:38.194 INFO New block received                      root: 0x3e54bc9936b3afec2b4942609c68f133292917d2284e789e11d42d2b8206a2b7, slot: 7852266\r\nethereum-1 lighthouse Nov 27 02:13:41.000 INFO Synced                                  slot: 7852266, block: 0x3e54…a2b7, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0x847a…01dc (verified), peers: 79, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:13:49.184 INFO New block received                      root: 0xc9b3beeca7ab675a36b7cd5456e70144446c333531fdbdf2a5c625e8dc744b87, slot: 7852267\r\nethereum-1 lighthouse Nov 27 02:13:53.001 INFO Synced                                  slot: 7852267, block: 0xc9b3…4b87, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0xf732…5a83 (verified), peers: 79, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:14:00.634 INFO New block received                      root: 0xd7fc1004b6b63988ed48edcee240d1ea8f709211ebbc4b4259a5cb3c39216210, slot: 7852268\r\nethereum-1 lighthouse Nov 27 02:14:05.001 INFO Synced                                  slot: 7852268, block: 0xd7fc…6210, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0xe1c1…e0e5 (verified), peers: 78, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:14:11.798 INFO New block received                      root: 0x79fe8d518633c36f3a3a23e8734b59ab33534c6f5e7a49c3d79c4f2635052b97, slot: 7852269\r\nethereum-1 lighthouse Nov 27 02:14:17.001 INFO Synced                                  slot: 7852269, block: 0x79fe…2b97, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0xe4a5…dad8 (verified), peers: 78, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:14:19.208 INFO Imported deposit log(s)                 new: 1, total: 1079189, latest_block: 18658400, service: deposit_contract_rpc\r\nethereum-1 lighthouse Nov 27 02:14:24.019 INFO New block received                      root: 0xc43248790c52c3c633e653dfe789518085cf68dcb4e63c3db2b6522aecf0f18d, slot: 7852270\r\nethereum-1 lighthouse Nov 27 02:14:29.000 INFO Synced                                  slot: 7852270, block: 0xc432…f18d, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0xa3a2…d7e0 (verified), peers: 78, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:14:37.247 INFO New block received                      root: 0xf330d8da6e849331a86e0b52d27c039506a97fffc711a08a83d54436610f4742, slot: 7852271\r\nethereum-1 lighthouse Nov 27 02:14:41.000 INFO Synced                                  slot: 7852271, block: 0xf330…4742, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0x5fd8…c92e (verified), peers: 77, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:14:48.062 INFO New block received                      root: 0x9ea7776ecd1104ad89c36adeb2620b47b03e29f49ad6edeb723bcdc7df714ef2, slot: 7852272\r\nethereum-1 lighthouse Nov 27 02:14:53.001 INFO Synced                                  slot: 7852272, block: 0x9ea7…4ef2, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0xc256…823c (verified), peers: 78, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:15:05.000 INFO Synced                                  slot: 7852273, block:    …  empty, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0xc256…823c (verified), peers: 77, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:15:12.851 INFO New block received                      root: 0x6287998d67d081d793f25b826c807f41a72789181ed47f32e8f3353d1fe6a00d, slot: 7852274\r\nethereum-1 lighthouse Nov 27 02:15:17.001 INFO Synced                                  slot: 7852274, block:    …  empty, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0xc256…823c (verified), peers: 76, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:15:28.004 INFO New block received                      root: 0x4cf9f283c75a92c4c43e7eac1f21a044f1ffddd119d02bb97f13e9140f020510, slot: 7852275\r\nethereum-1 lighthouse Nov 27 02:15:29.000 INFO Synced                                  slot: 7852275, block:    …  empty, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0x73a5…50d3 (verified), peers: 75, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:15:36.745 INFO New block received                      root: 0x077ed87071b798127101997d3f93dafa40f8ab727ac7472935ace5733ec60c51, slot: 7852276\r\nethereum-1 lighthouse Nov 27 02:15:41.001 INFO Synced                                  slot: 7852276, block: 0x077e…0c51, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0x8b5c…a07c (verified), peers: 76, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:15:49.485 INFO New block received                      root: 0x6f1f6f43cf719d1bfa2c5aa8306aaef2894012361344b0fcb058dccaede0754e, slot: 7852277\r\nethereum-1 lighthouse Nov 27 02:15:53.001 INFO Synced                                  slot: 7852277, block: 0x6f1f…754e, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0xaf8e…f841 (verified), peers: 76, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:16:00.125 INFO New block received                      root: 0x694393f08b9476d0a1b6a0b09de63ce093b91bf0e632dcda8c4e32a246dcc226, slot: 7852278\r\nethereum-1 lighthouse Nov 27 02:16:05.001 INFO Synced                                  slot: 7852278, block: 0x6943…c226, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0x50fb…af4d (verified), peers: 73, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:16:12.905 INFO New block received                      root: 0x561a706cdb21ea23eaed998a3414f10d251588fa67885e95e1d4956e4935b2f3, slot: 7852279\r\nethereum-1 lighthouse Nov 27 02:16:17.001 INFO Synced                                  slot: 7852279, block: 0x561a…b2f3, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0x365c…ace8 (verified), peers: 72, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:16:19.225 INFO Imported deposit log(s)                 new: 1, total: 1079190, latest_block: 18658406, service: deposit_contract_rpc\r\nethereum-1 lighthouse Nov 27 02:16:26.513 INFO New block received                      root: 0x2f31d24cfa96b8571d6a382c2dd36b7f511f111ad12983dd7a92d945b970def4, slot: 7852280\r\nethereum-1 lighthouse Nov 27 02:16:29.001 INFO Synced                                  slot: 7852280, block:    …  empty, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0x365c…ace8 (verified), peers: 75, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:16:35.986 INFO New block received                      root: 0xb0891302cab9d37f7271c27c0f8fa8cf02286feb1098b45b507c6b94d8404fbf, slot: 7852281\r\nethereum-1 lighthouse Nov 27 02:16:41.003 INFO Synced                                  slot: 7852281, block: 0xb089…4fbf, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0xb935…8d07 (verified), peers: 74, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:16:53.000 INFO Synced                                  slot: 7852282, block:    …  empty, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0xb935…8d07 (verified), peers: 74, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:17:05.000 INFO Synced                                  slot: 7852283, block:    …  empty, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0xb935…8d07 (verified), peers: 75, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:17:17.001 INFO Synced                                  slot: 7852284, block:    …  empty, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0xb935…8d07 (verified), peers: 75, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:17:29.000 INFO Synced                                  slot: 7852285, block:    …  empty, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0xb935…8d07 (verified), peers: 75, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:17:41.000 INFO Synced                                  slot: 7852286, block:    …  empty, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0xb935…8d07 (verified), peers: 76, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:17:53.000 INFO Synced                                  slot: 7852287, block:    …  empty, epoch: 245383, finalized_epoch: 245381, finalized_root: 0x3eb0…393f, exec_hash: 0xb935…8d07 (verified), peers: 76, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:18:05.001 INFO Synced                                  slot: 7852288, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 76, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:18:17.000 INFO Synced                                  slot: 7852289, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 76, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:18:29.001 INFO Synced                                  slot: 7852290, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 76, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:18:41.000 INFO Synced                                  slot: 7852291, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 76, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:18:43.163 ERRO Aggregate attestation queue full        queue_len: 4096, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:18:53.000 INFO Synced                                  slot: 7852292, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 76, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:19:05.001 INFO Synced                                  slot: 7852293, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 77, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:19:13.448 ERRO Aggregate attestation queue full        queue_len: 4096, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:19:17.001 INFO Synced                                  slot: 7852294, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 77, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:19:29.000 INFO Synced                                  slot: 7852295, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 77, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:19:41.000 INFO Synced                                  slot: 7852296, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 76, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:19:43.577 ERRO Aggregate attestation queue full        queue_len: 4096, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:19:53.001 INFO Synced                                  slot: 7852297, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 75, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:20:05.001 INFO Synced                                  slot: 7852298, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 76, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:20:13.599 ERRO Aggregate attestation queue full        queue_len: 4096, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:20:17.001 INFO Synced                                  slot: 7852299, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 75, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:20:27.515 ERRO Attestation queue full                  queue_len: 16384, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:20:29.001 INFO Synced                                  slot: 7852300, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 74, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:20:41.000 INFO Synced                                  slot: 7852301, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 75, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:20:43.614 ERRO Aggregate attestation queue full        queue_len: 4096, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:20:53.000 INFO Synced                                  slot: 7852302, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 75, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:20:57.711 ERRO Attestation queue full                  queue_len: 16384, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:21:05.001 INFO Synced                                  slot: 7852303, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 76, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:21:13.615 ERRO Aggregate attestation queue full        queue_len: 4096, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:21:17.000 INFO Synced                                  slot: 7852304, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 78, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:21:27.737 ERRO Attestation queue full                  queue_len: 16384, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:21:29.001 INFO Synced                                  slot: 7852305, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 78, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:21:41.000 INFO Synced                                  slot: 7852306, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 79, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:21:43.684 ERRO Aggregate attestation queue full        queue_len: 4096, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:21:53.001 INFO Synced                                  slot: 7852307, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 79, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:21:58.075 ERRO Attestation queue full                  queue_len: 16384, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:22:05.001 INFO Synced                                  slot: 7852308, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 80, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:22:13.833 ERRO Aggregate attestation queue full        queue_len: 4096, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:22:17.001 INFO Synced                                  slot: 7852309, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 80, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:22:28.077 ERRO Attestation queue full                  queue_len: 16384, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:22:29.001 INFO Synced                                  slot: 7852310, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 80, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:22:41.001 INFO Synced                                  slot: 7852311, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 80, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:22:43.846 ERRO Aggregate attestation queue full        queue_len: 4096, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:22:53.001 INFO Synced                                  slot: 7852312, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 80, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:22:58.173 ERRO Attestation queue full                  queue_len: 16384, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:23:05.000 INFO Synced                                  slot: 7852313, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 80, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:23:13.861 ERRO Aggregate attestation queue full        queue_len: 4096, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:23:17.000 INFO Synced                                  slot: 7852314, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 80, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:23:28.181 ERRO Attestation queue full                  queue_len: 16384, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:23:29.000 INFO Synced                                  slot: 7852315, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 80, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:23:41.001 INFO Synced                                  slot: 7852316, block:    …  empty, epoch: 245384, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xb935…8d07 (verified), peers: 80, service: slot_notifier\r\n\r\n...\r\n\r\nethereum-1 lighthouse Nov 27 02:47:42.920 CRIT Beacon block processing error           error: ValidatorPubkeyCacheLockTimeout, service: beacon\r\nethereum-1 lighthouse Nov 27 02:47:42.920 WARN BlockProcessingFailure                  outcome: ValidatorPubkeyCacheLockTimeout, msg: unexpected condition in processing block.\r\nethereum-1 lighthouse Nov 27 02:47:50.574 ERRO Attestation queue full                  queue_len: 16384, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:47:53.001 INFO Synced                                  slot: 7852437, block:    …  empty, epoch: 245388, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0x1e90…a6f9 (verified), peers: 66, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:47:55.422 WARN Error signalling fork choice waiter     slot: 7852435, error: ForkChoiceSignalOutOfOrder { current: Slot(7852436), latest: Slot(7852435) }, service: beacon\r\nethereum-1 lighthouse Nov 27 02:48:01.165 ERRO Aggregate attestation queue full        queue_len: 4096, msg: the system has insufficient resources for load, service: bproc\r\nethereum-1 lighthouse Nov 27 02:48:06.013 INFO Synced                                  slot: 7852438, block:    …  empty, epoch: 245388, finalized_epoch: 245382, finalized_root: 0xe204…b24c, exec_hash: 0xda71…c1a3 (verified), peers: 68, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:48:17.000 INFO Synced                                  slot: 7852439, block:    …  empty, epoch: 245388, finalized_epoch: 245383, finalized_root: 0xaad7…902b, exec_hash: 0xc62e…b6c8 (verified), peers: 69, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:48:19.226 INFO Imported deposit log(s)                 new: 2, total: 1079192, latest_block: 18658424, service: deposit_contract_rpc\r\nethereum-1 lighthouse Nov 27 02:48:27.172 ERRO Attestation delay queue is full         msg: check system clock, queue_size: 16384, service: bproc\r\nethereum-1 lighthouse Nov 27 02:48:29.001 INFO Synced                                  slot: 7852440, block:    …  empty, epoch: 245388, finalized_epoch: 245383, finalized_root: 0xaad7…902b, exec_hash: 0x6b2e…22dc (verified), peers: 69, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:48:31.301 INFO New RPC block received                  hash: 0x9597…4662, slot: 7852319\r\nethereum-1 lighthouse Nov 27 02:48:52.524 INFO Synced                                  slot: 7852441, block:    …  empty, epoch: 245388, finalized_epoch: 245383, finalized_root: 0xaad7…902b, exec_hash: 0x6b2e…22dc (verified), peers: 67, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:49:08.175 INFO Synced                                  slot: 7852443, block:    …  empty, epoch: 245388, finalized_epoch: 245383, finalized_root: 0xaad7…902b, exec_hash: 0x52d4…b4b5 (verified), peers: 67, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:49:13.456 INFO Sync state updated                      new_state: Syncing Head Chain, old_state: Synced, service: sync\r\nethereum-1 lighthouse Nov 27 02:49:13.987 WARN Error signalling fork choice waiter     slot: 7852442, error: ForkChoiceSignalOutOfOrder { current: Slot(7852443), latest: Slot(7852442) }, service: state_advance\r\nethereum-1 lighthouse Nov 27 02:49:17.001 INFO Syncing                                 est_time: 18 mins, speed: 0.10 slots/sec, distance: 116 slots (23 mins), peers: 69, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:49:29.001 INFO Syncing                                 est_time: 18 mins, speed: 0.10 slots/sec, distance: 117 slots (23 mins), peers: 67, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:49:30.528 INFO New RPC block received                  hash: 0xde2c…39ae, slot: 7852329\r\nethereum-1 lighthouse Nov 27 02:49:41.000 INFO Syncing                                 est_time: 31 mins, speed: 0.06 slots/sec, distance: 118 slots (23 mins), peers: 67, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:49:53.001 INFO Syncing                                 est_time: 18 mins, speed: 0.10 slots/sec, distance: 115 slots (23 mins), peers: 69, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:50:05.001 INFO Syncing                                 est_time: 8 mins, speed: 0.21 slots/sec, distance: 110 slots (22 mins), peers: 69, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:50:17.001 INFO Syncing                                 est_time: 4 mins, speed: 0.38 slots/sec, distance: 103 slots (20 mins), peers: 71, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:50:29.001 INFO Syncing                                 est_time: 3 mins, speed: 0.50 slots/sec, distance: 98 slots (19 mins), peers: 70, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:50:31.011 CRIT Beacon block processing error           error: ValidatorPubkeyCacheLockTimeout, service: beacon\r\nethereum-1 lighthouse Nov 27 02:50:31.012 WARN BlockProcessingFailure                  outcome: ValidatorPubkeyCacheLockTimeout, msg: unexpected condition in processing block.\r\nethereum-1 lighthouse Nov 27 02:50:32.364 WARN Error signalling fork choice waiter     slot: 7852448, error: ForkChoiceSignalOutOfOrder { current: Slot(7852449), latest: Slot(7852448) }, service: state_advance\r\nethereum-1 lighthouse Nov 27 02:50:41.001 INFO Syncing                                 est_time: 3 mins, speed: 0.42 slots/sec, distance: 99 slots (19 mins), peers: 70, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:50:51.296 CRIT Beacon block processing error           error: ValidatorPubkeyCacheLockTimeout, service: beacon\r\nethereum-1 lighthouse Nov 27 02:50:51.297 WARN BlockProcessingFailure                  outcome: ValidatorPubkeyCacheLockTimeout, msg: unexpected condition in processing block.\r\nethereum-1 lighthouse Nov 27 02:50:53.000 INFO Syncing                                 est_time: 5 mins, speed: 0.29 slots/sec, distance: 100 slots (20 mins), peers: 67, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:50:57.017 INFO Sync state updated                      new_state: Syncing Finalized Chain, old_state: Syncing Head Chain, service: sync\r\nethereum-1 lighthouse Nov 27 02:51:05.002 INFO Syncing                                 est_time: 9 mins, speed: 0.17 slots/sec, distance: 99 slots (19 mins), peers: 66, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:51:17.001 INFO Syncing                                 est_time: 10 mins, speed: 0.15 slots/sec, distance: 95 slots (19 mins), peers: 66, service: slot_notifier\r\nethereum-1 lighthouse Nov 27 02:51:19.273 CRIT Beacon block processing error           error: ValidatorPubkeyCacheLockTimeout, service: beacon\r\nethereum-1 lighthouse Nov 27 02:51:19.274 WARN BlockProcessingFailure                  outcome: ValidatorPubkeyCacheLockTimeout, msg: unexpected condition in processing block.\r\nethereum-1 lighthouse Nov 27 02:51:29.001 INFO Syncing                                 est_time: 10 mins, speed: 0.15 slots/sec, distance: 96 slots (19 mins), peers: 69, service: slot_notifier\r\n```\r\n\r\n### Configuration\r\n```shell\r\nexec /app/lighthouse \\\r\n    bn \\\r\n    --network \"mainnet\" \\\r\n    --disable-upnp \\\r\n    --datadir \"/data/execution/beacon\" \\\r\n    --freezer-dir=\"/data/execution/beacon/freezer\" \\\r\n    --network-dir=\"/data/execution/beacon/network\" \\\r\n    --http \\\r\n    --http-address  \"0.0.0.0\" \\\r\n    --http-port \"5052\" \\\r\n    --enr-udp-port \"9000\" \\\r\n    --enr-tcp-port \"9000\" \\\r\n    --discovery-port \"9000\" \\\r\n    --execution-endpoints http://localhost:8551 \\\r\n    --debug-level \"info\" \\\r\n    --metrics \\\r\n    --metrics-address \"0.0.0.0\" \\\r\n    --validator-monitor-auto \\\r\n    --jwt-secrets \"/...\" \\\r\n    --disable-backfill-rate-limiting \\\r\n    --slots-per-restore-point=32 # For archival data\r\n```\r\n\r\n### Compute Config\r\n1. i3en.24xlarge EC2 instance with kubernetes\r\n2. 200Gi RAM, 55vCPU allocated to lighthouse\r\n3. 60TB NVMe SSD with 100Gbps network bandwith, 19Gbps storage bandwidth\r\n\r\n\r\n## Expected Behaviour\r\nLighthouse should not be having this issue given that we're currently not making any API calls to the beacon endpoints, only geth is interacting with the lighthouse deployment.\r\n\r\n## Steps to resolve\r\n* Attempted to increase the compute allocated to lighthouse for both RAM and CPU\r\n* Attempted to remove traffic from the deployment, it still randomly keeps throwing the attestation error\r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/4953/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/4953/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1827276951",
    "html_url": "https://github.com/sigp/lighthouse/issues/4953#issuecomment-1827276951",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4953",
    "id": 1827276951,
    "node_id": "IC_kwDOCFeAzc5s6giX",
    "user": {
      "login": "SimonSMH1015",
      "id": 39431803,
      "node_id": "MDQ6VXNlcjM5NDMxODAz",
      "avatar_url": "https://avatars.githubusercontent.com/u/39431803?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SimonSMH1015",
      "html_url": "https://github.com/SimonSMH1015",
      "followers_url": "https://api.github.com/users/SimonSMH1015/followers",
      "following_url": "https://api.github.com/users/SimonSMH1015/following{/other_user}",
      "gists_url": "https://api.github.com/users/SimonSMH1015/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SimonSMH1015/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SimonSMH1015/subscriptions",
      "organizations_url": "https://api.github.com/users/SimonSMH1015/orgs",
      "repos_url": "https://api.github.com/users/SimonSMH1015/repos",
      "events_url": "https://api.github.com/users/SimonSMH1015/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SimonSMH1015/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-27T07:39:23Z",
    "updated_at": "2023-11-27T07:39:23Z",
    "author_association": "NONE",
    "body": "Got a similar problem.  The RAM usage of my lighthouse keeps increasing and then falling back to normal sharply.  \r\n\r\nAre this related to issue: https://github.com/sigp/lighthouse/issues/4918 ?\r\n\r\n![image](https://github.com/sigp/lighthouse/assets/39431803/042f4a28-274c-4816-9fb6-90a0cdc8be65)\r\n\r\n\r\nDuring this period, the following error information is recorded in the log:  (I've only cited a few logs. Info-level logs are no different. I'm happy to provide complete logs if necessary.)\r\n```\r\nNov 26 09:26:40.424 ERRO Ignored scheduled attestation(s) for block, sent_count: 12288, failed_count: 2875, block_root: 0x8f4a6f2d72c5f455556966f5f08f81a5104a0f994d635de1a846a6853530a3f6, parent_root: 0xdad5dd2962ef73e80bf76f487961e781d8d1d0530ffc5faab45edbe5bc8c7bc2, hint: system may be overloaded, service: bproc\r\nNov 26 09:03:13.562 ERRO Attestation delay queue is full         msg: check system clock, queue_size: 16384, service: bproc\r\nNov 26 08:50:54.771 ERRO Ignored scheduled attestation(s) for block, sent_count: 12288, failed_count: 4096, block_root: 0x212a77c83debe9dccbc10f564d6d0e959342e81779dcd8aac3a08a73d5ad2cac, parent_root: 0x0502f524a50b9fbeef0a9ae29eef952347610f7472a82942465eb2d52026eff6, hint: system may be overloaded, service: bproc\r\nNov 26 08:50:52.106 ERRO Attestation delay queue is full         msg: check system clock, queue_size: 16384, service: bproc\r\nNov 26 08:20:52.164 ERRO Ignored scheduled attestation(s) for block, sent_count: 12288, failed_count: 4096, block_root: 0x391f477c7022235b38cf6ff315984ed81b04e783e6f40bdb71491818b3d62aa3, parent_root: 0x29355ddd821bd581e466f4f4436b48933eab66bc851b6c451108c795cbe2be54, hint: system may be overloaded, service: bproc\r\nNov 26 08:20:51.779 ERRO Attestation delay queue is full         msg: check system clock, queue_size: 16384, service: bproc\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1827276951/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1827317924",
    "html_url": "https://github.com/sigp/lighthouse/issues/4953#issuecomment-1827317924",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4953",
    "id": 1827317924,
    "node_id": "IC_kwDOCFeAzc5s6qik",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-27T07:59:20Z",
    "updated_at": "2023-11-27T07:59:20Z",
    "author_association": "MEMBER",
    "body": "@SimonSMH1015 Your issue seems like it's likely related to #4918. The original issue could be too, although I also noticed that @tobidae-cb's node was affected by something like #4773.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1827317924/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
