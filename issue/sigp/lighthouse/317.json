{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/317",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/317/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/317/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/317/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/317",
  "id": 423519806,
  "node_id": "MDU6SXNzdWU0MjM1MTk4MDY=",
  "number": 317,
  "title": "Test committee building with registry update",
  "user": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1078831612,
      "node_id": "MDU6TGFiZWwxMDc4ODMxNjEy",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/test%20improvement",
      "name": "test improvement",
      "color": "9ce542",
      "default": false,
      "description": "Improve tests"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2019-03-20T23:43:18Z",
  "updated_at": "2019-04-25T23:07:02Z",
  "closed_at": "2019-04-25T23:07:02Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nAdd a new test case for committee building.\r\n\r\n## Details\r\n\r\nThe specification has a [`get_crosslink_committees_at_slot`](https://github.com/ethereum/eth2.0-specs/blob/v0.5.0/specs/core/0_beacon-chain.md#get_crosslink_committees_at_slot) function with returns a list of crosslink committees for that slot.\r\n\r\nOur implementation is a little different -- we build all the committees for all the slots in an epoch at the same time then cache them all. Or function named `get_crosslink_committees_at_slot` just reads the cache.\r\n\r\nOur cache implementation is [here](https://github.com/sigp/lighthouse/blob/733722ea0d28b548a25f3476b8d5b464417d1be8/eth2/types/src/beacon_state/epoch_cache.rs#L29) and it's built using the [`EpochCrosslinkCommitteesBuilder`](https://github.com/sigp/lighthouse/blob/733722ea0d28b548a25f3476b8d5b464417d1be8/eth2/types/src/beacon_state/epoch_cache.rs#L200).\r\n\r\nIn our [testing](https://github.com/sigp/lighthouse/blob/733722ea0d28b548a25f3476b8d5b464417d1be8/eth2/types/src/beacon_state/epoch_cache/tests.rs#L99-L149) of the `EpochCache` we don't have a test case that covers the committee that's generated for `RelativeEpoch::NextWithRegistryChange` (we only have current epoch, previous epoch and next _without_ registry change).\r\n\r\n## Steps to resolve\r\n\r\n- Manually generate the inputs to [`setup_sane_cache_test`](https://github.com/sigp/lighthouse/blob/733722ea0d28b548a25f3476b8d5b464417d1be8/eth2/types/src/beacon_state/epoch_cache/tests.rs#L67) for the `RelativeEpoch::NextWithRegistryChange` scenario and ensure our implementation is sane.\r\n\r\nNote: there are two paths when building the next epoch _with_ a registry update. The `if` statement that creates that fork is [here](https://github.com/sigp/lighthouse/blob/733722ea0d28b548a25f3476b8d5b464417d1be8/eth2/types/src/beacon_state/epoch_cache.rs#L256-L257).\r\n",
  "closed_by": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/317/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/317/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/475070062",
    "html_url": "https://github.com/sigp/lighthouse/issues/317#issuecomment-475070062",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/317",
    "id": 475070062,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NTA3MDA2Mg==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-20T23:43:30Z",
    "updated_at": "2019-03-20T23:43:30Z",
    "author_association": "MEMBER",
    "body": "@g-r-a-n-t I heard you might be interested in this :)",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/475070062/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/475080794",
    "html_url": "https://github.com/sigp/lighthouse/issues/317#issuecomment-475080794",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/317",
    "id": 475080794,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NTA4MDc5NA==",
    "user": {
      "login": "g-r-a-n-t",
      "id": 32600263,
      "node_id": "MDQ6VXNlcjMyNjAwMjYz",
      "avatar_url": "https://avatars.githubusercontent.com/u/32600263?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/g-r-a-n-t",
      "html_url": "https://github.com/g-r-a-n-t",
      "followers_url": "https://api.github.com/users/g-r-a-n-t/followers",
      "following_url": "https://api.github.com/users/g-r-a-n-t/following{/other_user}",
      "gists_url": "https://api.github.com/users/g-r-a-n-t/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/g-r-a-n-t/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/g-r-a-n-t/subscriptions",
      "organizations_url": "https://api.github.com/users/g-r-a-n-t/orgs",
      "repos_url": "https://api.github.com/users/g-r-a-n-t/repos",
      "events_url": "https://api.github.com/users/g-r-a-n-t/events{/privacy}",
      "received_events_url": "https://api.github.com/users/g-r-a-n-t/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-21T00:45:14Z",
    "updated_at": "2019-03-21T00:45:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey @paulhauner, you've heard right. Can pick this up and start working on it over the weekend.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/475080794/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/475438641",
    "html_url": "https://github.com/sigp/lighthouse/issues/317#issuecomment-475438641",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/317",
    "id": 475438641,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NTQzODY0MQ==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-21T23:17:48Z",
    "updated_at": "2019-03-21T23:17:48Z",
    "author_association": "MEMBER",
    "body": "Awesome, let me know if I can help!",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/475438641/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/486868889",
    "html_url": "https://github.com/sigp/lighthouse/issues/317#issuecomment-486868889",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/317",
    "id": 486868889,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ4Njg2ODg4OQ==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-04-25T23:07:02Z",
    "updated_at": "2019-04-25T23:07:02Z",
    "author_association": "MEMBER",
    "body": "Closing this as spec 0.6.0 does not have the with/without registry change path.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/486868889/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
