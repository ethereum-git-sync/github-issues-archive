{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/1435",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/1435/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/1435/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/1435/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/1435",
  "id": 671760724,
  "node_id": "MDU6SXNzdWU2NzE3NjA3MjQ=",
  "number": 1435,
  "title": "Start from weak subjectivity state",
  "user": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 985647284,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODQ=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/enhancement",
      "name": "enhancement",
      "color": "a2eeef",
      "default": true,
      "description": "New feature or request"
    },
    {
      "id": 2034355093,
      "node_id": "MDU6TGFiZWwyMDM0MzU1MDkz",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/consensus",
      "name": "consensus",
      "color": "5e59bf",
      "default": false,
      "description": "An issue/PR that touches consensus code, such as state_processing or block verification."
    },
    {
      "id": 2249213492,
      "node_id": "MDU6TGFiZWwyMjQ5MjEzNDky",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/sept-sec-review",
      "name": "sept-sec-review",
      "color": "edb1a3",
      "default": false,
      "description": "Required for the September 1st security review"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-08-03T03:04:47Z",
  "updated_at": "2022-11-09T05:03:08Z",
  "closed_at": "2020-10-01T13:22:16Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nLighthouse should be able to start from a \"weak subjectivity state\", that is a trusted `BeaconState` (and perhaps `BeaconBlock`) that is not genesis. This protects Lighthouse from long-range attacks from already exited validators. \r\n\r\nI believe that @adaszko is already working on this.\r\n",
  "closed_by": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/1435/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/1435/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/692231851",
    "html_url": "https://github.com/sigp/lighthouse/issues/1435#issuecomment-692231851",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1435",
    "id": 692231851,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MjIzMTg1MQ==",
    "user": {
      "login": "realbigsean",
      "id": 5160426,
      "node_id": "MDQ6VXNlcjUxNjA0MjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5160426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/realbigsean",
      "html_url": "https://github.com/realbigsean",
      "followers_url": "https://api.github.com/users/realbigsean/followers",
      "following_url": "https://api.github.com/users/realbigsean/following{/other_user}",
      "gists_url": "https://api.github.com/users/realbigsean/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/realbigsean/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/realbigsean/subscriptions",
      "organizations_url": "https://api.github.com/users/realbigsean/orgs",
      "repos_url": "https://api.github.com/users/realbigsean/repos",
      "events_url": "https://api.github.com/users/realbigsean/events{/privacy}",
      "received_events_url": "https://api.github.com/users/realbigsean/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-14T18:26:15Z",
    "updated_at": "2020-09-14T18:26:15Z",
    "author_association": "COLLABORATOR",
    "body": "I'd be interested in picking this up",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/692231851/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/692317639",
    "html_url": "https://github.com/sigp/lighthouse/issues/1435#issuecomment-692317639",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1435",
    "id": 692317639,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5MjMxNzYzOQ==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-14T21:13:18Z",
    "updated_at": "2020-09-14T21:13:18Z",
    "author_association": "MEMBER",
    "body": "I've had some discussion out-of-band with @AgeManning and @michaelsproul regarding this.\r\n\r\nWe need to implement \"starting from a weak subjectivity (WSJ) state\" to protect ourselves from WSJ-based attacks. This means we need to be able to start a fresh LH database with the knowledge of some recent WSJ state/block root and ensure that we never contradict those values.\r\n\r\nI see two immediate ways to do this:\r\n\r\n## Solution 1. Start with head at WSJ state\r\n\r\nIn this scenario you load the entire WSJ state and block into the beacon node, then set it to your head. You sync forwards and maybe backwards.\r\n\r\nThis is the ideal scenario because it provides maximum protection from WSJ-based attacks *and* it provides fast sync-to-head times for users.\r\n\r\n## Solution 2. Start head at genesis\r\n\r\nIn this scenario you load a `(wsj_slot, wsj_block_root)` tuple into the beacon node. It starts syncing from genesis (as we do now) and will fail if it reaches `wsj_slot` and `wsj_block_root` is not in the chain.\r\n\r\nIt needs to fail *very hard* if a contradicing WSJ point is finalized. Since you can cause rouge finalization with WSJ attacks, our databases and caches will all be compromised and/or invalid. I think we should kill the beacon node processes and the user will need to re-sync from scratch.\r\n\r\n## Which scenario?\r\n\r\nI think it's clear that scenario (1) is much better than (2), but it is much more work.\r\n\r\nI think that WSJ is a significant security vuln that needs to be address before audit. Whilst I would love to see (1) implemented, it requires major changes to our code base and likely the networking specification.\r\n\r\nI think that (2) is quite simple: we can pass this [`exit signal`](https://github.com/sigp/lighthouse/blob/e5fc6bab485fa54d7e518b325f4eb9201ba5c6a1/lighthouse/environment/src/lib.rs#L342) to the `BeaconChain` and do the WSJ slot/root check in [`process_block`](https://github.com/sigp/lighthouse/blob/e5fc6bab485fa54d7e518b325f4eb9201ba5c6a1/beacon_node/beacon_chain/src/beacon_chain.rs#L1446).\r\n\r\nMy feeling is that we should implement (2) now to patch the vuln prior. Then, we should starting working to implement (2), perhaps not achieving it until post-mainnet launch.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/692317639/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/702131001",
    "html_url": "https://github.com/sigp/lighthouse/issues/1435#issuecomment-702131001",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1435",
    "id": 702131001,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMjEzMTAwMQ==",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-01T13:22:16Z",
    "updated_at": "2020-10-01T13:22:16Z",
    "author_association": "MEMBER",
    "body": "Closed by #1675 ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/702131001/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
