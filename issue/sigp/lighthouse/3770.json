{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3770",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3770/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3770/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3770/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3770",
  "id": 1473292498,
  "node_id": "I_kwDOCFeAzc5X0KjS",
  "number": 3770,
  "title": "calling /eth/v1/validator/duties/proposer/ for old epochs is very slow",
  "user": {
    "login": "wmitsuda",
    "id": 28685,
    "node_id": "MDQ6VXNlcjI4Njg1",
    "avatar_url": "https://avatars.githubusercontent.com/u/28685?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wmitsuda",
    "html_url": "https://github.com/wmitsuda",
    "followers_url": "https://api.github.com/users/wmitsuda/followers",
    "following_url": "https://api.github.com/users/wmitsuda/following{/other_user}",
    "gists_url": "https://api.github.com/users/wmitsuda/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wmitsuda/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wmitsuda/subscriptions",
    "organizations_url": "https://api.github.com/users/wmitsuda/orgs",
    "repos_url": "https://api.github.com/users/wmitsuda/repos",
    "events_url": "https://api.github.com/users/wmitsuda/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wmitsuda/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 985647288,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODg=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/question",
      "name": "question",
      "color": "d876e3",
      "default": true,
      "description": "Further information is requested"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 8,
  "created_at": "2022-12-02T18:41:12Z",
  "updated_at": "2023-08-14T00:11:15Z",
  "closed_at": "2023-08-14T00:11:08Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "LH 3.3, macos\r\n\r\nCurrent epoch is 164537.\r\n\r\nCalling `/eth/v1/validator/duties/proposer/ ` REST API for recent epochs replies in reasonable time:\r\n\r\nhttp http://10.147.18.96:5052/eth/v1/validator/duties/proposer/164536  0.23s user 0.05s system 34% cpu 0.814 total\r\nhttp http://10.147.18.96:5052/eth/v1/validator/duties/proposer/164535  0.23s user 0.05s system 16% cpu 1.646 total\r\n\r\nHowever, calling it for some older epochs (older than 4 or 5, I guess from my tests) is incredibly slow:\r\n\r\nhttp http://10.147.18.96:5052/eth/v1/validator/duties/proposer/164533  0.22s user 0.05s system 0% cpu 3:03.33 total\r\nhttp http://10.147.18.96:5052/eth/v1/validator/duties/proposer/164532  0.22s user 0.05s system 0% cpu 2:08.00 total\r\n",
  "closed_by": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3770/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3770/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1335923740",
    "html_url": "https://github.com/sigp/lighthouse/issues/3770#issuecomment-1335923740",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3770",
    "id": 1335923740,
    "node_id": "IC_kwDOCFeAzc5PoJQc",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-02T22:25:21Z",
    "updated_at": "2022-12-02T22:25:21Z",
    "author_association": "MEMBER",
    "body": "What do you have the `--slots-per-restore-point` value set to? Any query that requires loading historic state is going to be slow with the default of 8192. More info here: https://lighthouse-book.sigmaprime.io/advanced_database.html\r\n\r\nThe best way to make these queries faster is to set `--slots-per-restore-point=32` but that currently uses heaps of space (4TB+). We have an experimental branch that reduces the size of a SPRP=32 node to ~250GB which we've started using for our own internal analytics, see: https://github.com/sigp/lighthouse/pull/3206, https://github.com/sigp/lighthouse/pull/3626. It makes extensive changes to the database schema so we want to make sure we get it right before releasing it (we also need to re-write the schema migration for it, as that's broken currently). I've been working on this for more than a year, but hoping to finally get it across the line soon. If you'd like to run the `tree-states` branch let me know and I can help you build it. The gist of it is that you need to clone [this repo](https://github.com/sigp/milhouse) alongside Lighthouse.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1335923740/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1341880177",
    "html_url": "https://github.com/sigp/lighthouse/issues/3770#issuecomment-1341880177",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3770",
    "id": 1341880177,
    "node_id": "IC_kwDOCFeAzc5P-3dx",
    "user": {
      "login": "wmitsuda",
      "id": 28685,
      "node_id": "MDQ6VXNlcjI4Njg1",
      "avatar_url": "https://avatars.githubusercontent.com/u/28685?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wmitsuda",
      "html_url": "https://github.com/wmitsuda",
      "followers_url": "https://api.github.com/users/wmitsuda/followers",
      "following_url": "https://api.github.com/users/wmitsuda/following{/other_user}",
      "gists_url": "https://api.github.com/users/wmitsuda/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wmitsuda/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wmitsuda/subscriptions",
      "organizations_url": "https://api.github.com/users/wmitsuda/orgs",
      "repos_url": "https://api.github.com/users/wmitsuda/repos",
      "events_url": "https://api.github.com/users/wmitsuda/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wmitsuda/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-08T02:13:06Z",
    "updated_at": "2022-12-08T02:13:06Z",
    "author_association": "NONE",
    "body": "Hi, I'm using all default settings.\r\n\r\nThanks for the info. Just giving more context: my use case is getting and displaying the elected validators for a certain epoch. For regular slots, that's a no-brainer, this info is returned by querying the block.\r\n\r\nHowever that is not available for (a) missed slots (b) scheduled slots for current epoch. Those two use cases are covered by calling the `/validators/duties/proposer` API. (b) is fast since the data is hot, (a) is slow because of what you explained.\r\n\r\nIs there any other API where I could get this info in a faster way? As a workaround measure for now.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1341880177/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1341954302",
    "html_url": "https://github.com/sigp/lighthouse/issues/3770#issuecomment-1341954302",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3770",
    "id": 1341954302,
    "node_id": "IC_kwDOCFeAzc5P_Jj-",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-08T03:52:51Z",
    "updated_at": "2022-12-08T03:52:51Z",
    "author_association": "MEMBER",
    "body": "> Is there any other API where I could get this info in a faster way? As a workaround measure for now.\r\n\r\nThere's no other Lighthouse or standard API. You could use `beaconcha.in`'s API, but I'm not sure if that would meet your criteria (as it's an external dependency).",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1341954302/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1343348302",
    "html_url": "https://github.com/sigp/lighthouse/issues/3770#issuecomment-1343348302",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3770",
    "id": 1343348302,
    "node_id": "IC_kwDOCFeAzc5QEd5O",
    "user": {
      "login": "wmitsuda",
      "id": 28685,
      "node_id": "MDQ6VXNlcjI4Njg1",
      "avatar_url": "https://avatars.githubusercontent.com/u/28685?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/wmitsuda",
      "html_url": "https://github.com/wmitsuda",
      "followers_url": "https://api.github.com/users/wmitsuda/followers",
      "following_url": "https://api.github.com/users/wmitsuda/following{/other_user}",
      "gists_url": "https://api.github.com/users/wmitsuda/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/wmitsuda/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/wmitsuda/subscriptions",
      "organizations_url": "https://api.github.com/users/wmitsuda/orgs",
      "repos_url": "https://api.github.com/users/wmitsuda/repos",
      "events_url": "https://api.github.com/users/wmitsuda/events{/privacy}",
      "received_events_url": "https://api.github.com/users/wmitsuda/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-08T21:02:50Z",
    "updated_at": "2022-12-08T21:02:50Z",
    "author_association": "NONE",
    "body": "I'm doing something like beaconcha.in does, so yeah, I'm hoping to get everything from the CL node, not from another external provider.\r\n\r\nBut that's fine for now, I can put this info on the docs (around ~2-3 min on standard LH), and it is lazily loaded on the page. If users want it faster, they can trade-off disk space or keep an eye on the future improvements.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1343348302/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1368042792",
    "html_url": "https://github.com/sigp/lighthouse/issues/3770#issuecomment-1368042792",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3770",
    "id": 1368042792,
    "node_id": "IC_kwDOCFeAzc5Riq0o",
    "user": {
      "login": "djbakerman",
      "id": 2192654,
      "node_id": "MDQ6VXNlcjIxOTI2NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2192654?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/djbakerman",
      "html_url": "https://github.com/djbakerman",
      "followers_url": "https://api.github.com/users/djbakerman/followers",
      "following_url": "https://api.github.com/users/djbakerman/following{/other_user}",
      "gists_url": "https://api.github.com/users/djbakerman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/djbakerman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/djbakerman/subscriptions",
      "organizations_url": "https://api.github.com/users/djbakerman/orgs",
      "repos_url": "https://api.github.com/users/djbakerman/repos",
      "events_url": "https://api.github.com/users/djbakerman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/djbakerman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-30T18:26:08Z",
    "updated_at": "2022-12-30T18:26:08Z",
    "author_association": "NONE",
    "body": "I might be having a similar issue.  I'm running 3 validators and noticed an anomaly around EPOCH 170,801.\r\n\r\n2 of the 3 validators (presumably) querying eth1/attester/170801 returned in microseconds.\r\nattester/170801, status: 200 OK, elapsed: 93.987Âµs, module: http_api:164\r\n\r\nthe other validator, missed attestation incorrect block head, in the milliseconds:\r\n/attester/170801, status: 200 OK, elapsed: 10.931236ms, module: http_api:164\r\n\r\nthe head of the working validator:\r\n(epoch: 170801, delay_ms: 36, index: 17, head: 0xb39e80fa54124195ae110fbc34015f48388a81ba2805d7e62869c3129c278725, service: val_mon, module: beacon_chain::validator_monitor:772)\r\n\r\nbut the longer time validator, the validator that missed, had a different head:\r\nepoch: 170801, delay_ms: 116, index: 36, head: 0x5bee4c0ed8be85262f22df1bd58c1e2deb650fc3342474156eb05b9a88b6165b, service: val_mon, module: beacon_chain::validator_monitor:887\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1368042792/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1368133476",
    "html_url": "https://github.com/sigp/lighthouse/issues/3770#issuecomment-1368133476",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3770",
    "id": 1368133476,
    "node_id": "IC_kwDOCFeAzc5RjA9k",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-31T00:25:28Z",
    "updated_at": "2022-12-31T00:25:28Z",
    "author_association": "MEMBER",
    "body": "hey @djbakerman I think there's something else going on with your node. Delays on the order of 10ms close to the head have a different cause to the multi-second delays that @wmitsuda was getting for historic queries.\r\n\r\nThe main reason your validators attested to different blocks is because they were attesting at different slots. The validator that voted correctly on block 0xb39e80fa54124195ae110fbc34015f48388a81ba2805d7e62869c3129c278725 must have been attesting at slot [5465646](https://beaconcha.in/slot/0xb39e80fa54124195ae110fbc34015f48388a81ba2805d7e62869c3129c278725). The validator that attested incorrectly voted on the block from slot [5465656](https://beaconcha.in/slot/5465656), which probably means it was attesting at slot 5465657 and voted for the parent block. This will happen if it's slow to receive the block at 57, or slow to process it. You can grep your debug logs for `Delayed head block.*5465657` to see if that block was delayed. Or DM me your logs from around this time and I can take a look (I'm `@sproul#3907` on Discord). The reason for the 10ms delay might be that the attestation routine was trying to obtain a lock that was held by block processing. These can be held and released on the order of 1-30ms.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1368133476/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1368210912",
    "html_url": "https://github.com/sigp/lighthouse/issues/3770#issuecomment-1368210912",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3770",
    "id": 1368210912,
    "node_id": "IC_kwDOCFeAzc5RjT3g",
    "user": {
      "login": "djbakerman",
      "id": 2192654,
      "node_id": "MDQ6VXNlcjIxOTI2NTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2192654?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/djbakerman",
      "html_url": "https://github.com/djbakerman",
      "followers_url": "https://api.github.com/users/djbakerman/followers",
      "following_url": "https://api.github.com/users/djbakerman/following{/other_user}",
      "gists_url": "https://api.github.com/users/djbakerman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/djbakerman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/djbakerman/subscriptions",
      "organizations_url": "https://api.github.com/users/djbakerman/orgs",
      "repos_url": "https://api.github.com/users/djbakerman/repos",
      "events_url": "https://api.github.com/users/djbakerman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/djbakerman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-31T12:41:16Z",
    "updated_at": "2022-12-31T13:05:34Z",
    "author_association": "NONE",
    "body": "I didn't see a delayed head block for that slot; however, I do seem to get those errors sometimes in the seconds:\r\n\r\nbeacon.log.1:Dec 30 14:59:27.538 DEBG Delayed head block, set_as_head_delay: Some(45.496071ms), imported_delay: Some(2.520048868s), observed_delay: Some(1.973336235s), block_delay: 4.538881174s, slot: 5465695, proposer_index: 189875, block_root: 0xd710bea2603fd38adb6b1838677c55b69f6a23b0be502fa54686cce34b2b37ef, service: beacon, module: beacon_chain::canonical_head:1351\r\n\r\nIt's interesting that 1 of 3 validators (all same host) would experience a delay because there is no resource contention on the host.  Why would there be delay, from a slow/non-responding peer?\r\n\r\nAnother interesting observation, while those \"delayed head block\" errors appear from time to time, occasionally the events occur closer together (within a minute) while most are around 10min. For example, these two are far apart:\r\n\r\nDec 31 08:00:28.617 DEBG Delayed head block, set_as_head_delay: Some(49.14801ms), imported_delay: Some(465.096983ms), observed_delay: Some(5.103477108s), block_delay: 5.617722101s, slot: 5470800, proposer_index: 213763, block_root: 0xb4394aacb9c5525a2672aa0450228041559d74a7599fbc97fc4e40c58d9d150a, service: beacon, module: beacon_chain::canonical_head:1351\r\nDec 31 08:20:42.475 DEBG Delayed head block, set_as_head_delay: Some(36.256421ms), imported_delay: Some(2.815461452s), observed_delay: Some(4.624245651s), block_delay: 7.475963524s, slot: 5470901, proposer_index: 466341, block_root: 0x0709580fbd0b60d9a2719e0f5a525471c6f460b23293729be8c95f9e4a0ce0ba, service: beacon, module: beacon_chain::canonical_head:1351\r\n\r\nThese two are close:\r\nDec 31 10:54:27.917 DEBG Delayed head block, set_as_head_delay: Some(35.483702ms), imported_delay: Some(269.247221ms), observed_delay: Some(4.612639594s), block_delay: 4.917370517s, slot: 5471670, proposer_index: 223740, block_root: 0x9b43f2c186b2fafa1297092150eb809df5a4a4268449f33dcb735fc99c8f1e8f, service: beacon, module: beacon_chain::canonical_head:1351\r\nDec 31 10:55:40.086 DEBG Delayed head block, set_as_head_delay: Some(37.089849ms), imported_delay: Some(388.781598ms), observed_delay: Some(4.660107541s), block_delay: 5.085978988s, slot: 5471676, proposer_index: 425901, block_root: 0x39fd2bef701b55e22d29b28e3b8ed9321181ce4523addb5a97136d11807df035, service: beacon, module: beacon_chain::canonical_head:1351\r\n\r\nEDIT: seems to coincide with late gossip block.\r\nDec 31 10:55:39.666 DEBG Gossip block arrived late, block_delay: 4.660107541s, slot: 5471676, proposer_index: 425901, block_root: 0x39fd2bef701b55e22d29b28e3b8ed9321181ce4523addb5a97136d11807df035, module: network::beacon_processor::worker::gossip_methods:741\r\n\r\nCan this be solved by not accepting late blocks?\r\n\r\nCouldn't find your username on discord (case sensitive?) mine is: djbakerman#7065\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1368210912/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1368289477",
    "html_url": "https://github.com/sigp/lighthouse/issues/3770#issuecomment-1368289477",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3770",
    "id": 1368289477,
    "node_id": "IC_kwDOCFeAzc5RjnDF",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-31T22:45:28Z",
    "updated_at": "2022-12-31T22:45:28Z",
    "author_association": "MEMBER",
    "body": "@djbakerman\r\n\r\n> It's interesting that 1 of 3 validators (all same host) would experience a delay because there is no resource contention on the host. Why would there be delay, from a slow/non-responding peer?\r\n\r\nEach of the validators get assigned to attest at a different slot, and different things can happen in each slot. So it's not so much that your validators are performing differently _despite_ the same machine, but that they are randomly performing about the same with a bit of variance due to how your machine performs at each slot/block.\r\n\r\nAs for why blocks in some slots are delayed, the two main components are _observation delay_ and _import delay_. The observation delay is determined by the proposer of the block, they can publish late if they are faulty or malicious. There's not much _your node_ can do about this once it happens, the only hope is that the next proposer chooses to re-org the late block. We are rolling out more aggressive re-orgs in our next release which should further disincentivise late blocks (see https://github.com/sigp/lighthouse/pull/2860).\r\n\r\nAs for the import delay, that's determined by your node software & hardware. Even if your node doesn't show signs of being maxed out, the hardware still limits how fast blocks can be processed. In particular, Lighthouse and Geth have several single-threaded and I/O bound functions that won't appear to max out your machine but _will_ consume time during block import. We are constantly optimising the clients to reduce these times, but it's delicate work and it takes time to ship meaningful gains.\r\n\r\nI've cross-checked some of the delayed head block messages you posted against my own nodes and they match. This rules out clock sync being an issue for your node. I also think the `imported_delay`s that you're seeing are within the expected range. You might see them spike to 1s+ when the execution node has a particularly large amount of work to do verifying the block.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1368289477/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
