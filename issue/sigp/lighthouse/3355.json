{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3355",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3355/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3355/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3355/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3355",
  "id": 1311843610,
  "node_id": "I_kwDOCFeAzc5OMSUa",
  "number": 3355,
  "title": "[builder API] Beacon chain health checks",
  "user": {
    "login": "realbigsean",
    "id": 5160426,
    "node_id": "MDQ6VXNlcjUxNjA0MjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5160426?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/realbigsean",
    "html_url": "https://github.com/realbigsean",
    "followers_url": "https://api.github.com/users/realbigsean/followers",
    "following_url": "https://api.github.com/users/realbigsean/following{/other_user}",
    "gists_url": "https://api.github.com/users/realbigsean/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/realbigsean/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/realbigsean/subscriptions",
    "organizations_url": "https://api.github.com/users/realbigsean/orgs",
    "repos_url": "https://api.github.com/users/realbigsean/repos",
    "events_url": "https://api.github.com/users/realbigsean/events{/privacy}",
    "received_events_url": "https://api.github.com/users/realbigsean/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3743113288,
      "node_id": "LA_kwDOCFeAzc7fG2BI",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/bellatrix",
      "name": "bellatrix",
      "color": "A906A4",
      "default": false,
      "description": "Required to support the Bellatrix Upgrade"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-07-20T20:17:25Z",
  "updated_at": "2022-08-03T19:36:03Z",
  "closed_at": "2022-07-21T22:49:06Z",
  "author_association": "COLLABORATOR",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nProvide some basic configurable chain health checks to determine whether or not we should propose blocks through the builder API.\r\n\r\nI'm proposing we add three new flags, each controlling a condition that describes a \"healthy beacon node\". And if all three conditions are met, the builder API will be used.\r\n\r\n- `--builder-fallback-skips` default value `3`\r\n  - the number of slots prior to the proposal slot that have been skipped\r\n- `--builder-fallback-skips-per-epoch` default value `8` \r\n  - the number of slots in the last 32 slots that have been skipped\r\n- `--builder-fallback-epochs-since-finalization` default value `3`\r\n  - the number of epochs since the chain has finalized\r\n  \r\nWould appreciate feedback on both conditions and defaults :slightly_smiling_face: ",
  "closed_by": {
    "login": "realbigsean",
    "id": 5160426,
    "node_id": "MDQ6VXNlcjUxNjA0MjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5160426?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/realbigsean",
    "html_url": "https://github.com/realbigsean",
    "followers_url": "https://api.github.com/users/realbigsean/followers",
    "following_url": "https://api.github.com/users/realbigsean/following{/other_user}",
    "gists_url": "https://api.github.com/users/realbigsean/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/realbigsean/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/realbigsean/subscriptions",
    "organizations_url": "https://api.github.com/users/realbigsean/orgs",
    "repos_url": "https://api.github.com/users/realbigsean/repos",
    "events_url": "https://api.github.com/users/realbigsean/events{/privacy}",
    "received_events_url": "https://api.github.com/users/realbigsean/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3355/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 1,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3355/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1200844917",
    "html_url": "https://github.com/sigp/lighthouse/issues/3355#issuecomment-1200844917",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3355",
    "id": 1200844917,
    "node_id": "IC_kwDOCFeAzc5Hk3B1",
    "user": {
      "login": "thegostep",
      "id": 15959632,
      "node_id": "MDQ6VXNlcjE1OTU5NjMy",
      "avatar_url": "https://avatars.githubusercontent.com/u/15959632?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/thegostep",
      "html_url": "https://github.com/thegostep",
      "followers_url": "https://api.github.com/users/thegostep/followers",
      "following_url": "https://api.github.com/users/thegostep/following{/other_user}",
      "gists_url": "https://api.github.com/users/thegostep/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/thegostep/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/thegostep/subscriptions",
      "organizations_url": "https://api.github.com/users/thegostep/orgs",
      "repos_url": "https://api.github.com/users/thegostep/repos",
      "events_url": "https://api.github.com/users/thegostep/events{/privacy}",
      "received_events_url": "https://api.github.com/users/thegostep/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-01T07:53:09Z",
    "updated_at": "2022-08-01T07:53:09Z",
    "author_association": "NONE",
    "body": "This is beautiful. Some questions:\n\n- Why these default values? I the more conservative the defaults are, the more false positives there will be, the more customer support will be needed, and the higher the risk of targeted attacks.\n- I like that these checks are on a rolling basis, this allows for the nodes to automatically recover.\n- should any of these be standardized with other clients?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1200844917/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1204392336",
    "html_url": "https://github.com/sigp/lighthouse/issues/3355#issuecomment-1204392336",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3355",
    "id": 1204392336,
    "node_id": "IC_kwDOCFeAzc5HyZGQ",
    "user": {
      "login": "realbigsean",
      "id": 5160426,
      "node_id": "MDQ6VXNlcjUxNjA0MjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5160426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/realbigsean",
      "html_url": "https://github.com/realbigsean",
      "followers_url": "https://api.github.com/users/realbigsean/followers",
      "following_url": "https://api.github.com/users/realbigsean/following{/other_user}",
      "gists_url": "https://api.github.com/users/realbigsean/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/realbigsean/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/realbigsean/subscriptions",
      "organizations_url": "https://api.github.com/users/realbigsean/orgs",
      "repos_url": "https://api.github.com/users/realbigsean/repos",
      "events_url": "https://api.github.com/users/realbigsean/events{/privacy}",
      "received_events_url": "https://api.github.com/users/realbigsean/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-03T19:36:03Z",
    "updated_at": "2022-08-03T19:36:03Z",
    "author_association": "COLLABORATOR",
    "body": "thanks @thegostep !\r\n\r\n> Why these default values? I the more conservative the defaults are, the more false positives there will be, the more customer support will be needed, and the higher the risk of targeted attacks.\r\n\r\nDefinitely open to changing them, but went with conservative values to (hopefully) favor liveness because fallback here still results a proposal which seems most important to me. The proposer still gets block rewards, tx fees, and the network still gets attestation inclusion and a new set of transactions included. False positives aren't ideal but some number of false positives would likely be worth it to save from a missed proposal. I have no idea how high or low this number is though.\r\n\r\nI understand default values that are too low could have the effect of making targeted attacks easy enough to pull off that they become *more* frequent than having no checks at all. Because there's incentive to ensure another proposer doesn't do any transaction ordering. But my hope would be that there is enough diversity in configuration to make these attacks less feasible.. and that the attacks themselves aren't actually *that* easy to pull off. If they are that easy to pull off, I would worry that setting higher defaults might not actually help prevent attacks, they might just ensure chain conditions are worse when they happen. If an attacker can induce skip slots easily, I also am not sure why they would target fallback from mev-boost vs just inducing an extra skip because they both have the same effect of keeping the next proposer from getting mev.\r\n\r\nIt seems to me like a bigger risk than a targeted attack (maybe I'm naive) would be a bug in a relay which serves a large portion of the network. And in this scenario lower fallback values seems better generally.\r\n\r\nI'm not tied to these defaults in any way but this was generally my thinking.  \r\n\r\n> should any of these be standardized with other clients?\r\n\r\nI think implementations should be diverse so we probably don't want to standardize too much. It might make things more difficult to game, and it also might give us better insight into what conditions are helpful/harmful/too high/too low.  ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1204392336/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
