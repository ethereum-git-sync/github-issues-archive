{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/1828",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/1828/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/1828/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/1828/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/1828",
  "id": 729152432,
  "node_id": "MDU6SXNzdWU3MjkxNTI0MzI=",
  "number": 1828,
  "title": "Reduce validator client duty traffic",
  "user": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2490303709,
      "node_id": "MDU6TGFiZWwyNDkwMzAzNzA5",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/A0",
      "name": "A0",
      "color": "bc3e3a",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-10-26T00:25:56Z",
  "updated_at": "2020-11-10T00:18:57Z",
  "closed_at": "2020-11-10T00:18:57Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nA user on Discord is reporting their VC falling behind on duties when running with a high number of validators (1k), particularly when running the VC and BN on different machines. They're seeing errors like this:\r\n\r\n```\r\nbeacon node:\r\n19:33:44.010 WARN Error processing HTTP API request       method: GET, path: /eth/v1/validator/duties/proposer/18548, status: 400 Bad Request, elapsed: 2.045724ms\r\n\r\nvalidator:\r\n19:33:44.326 ERRO Failed to download validator duties     error: Failed to get proposer indices: ServerMessage(ErrorMessage { code: 400, message: \"BAD_REQUEST: requested epoch is 18548 but only current epoch 18549 is allowed\", stacktraces: [] }), service: duties\r\n\r\n19:33:44.327 WARN Skipping block production for expired slot, info: Your machine could be overloaded, notification_slot: 593567, current_slot: 593568, service: block\r\n```\r\n\r\nI suspect the cause of the issue is the (serial) loading of individual duties every slot, here:\r\n\r\nhttps://github.com/sigp/lighthouse/blob/eba51f0973e0636e34d608ebdf501b64a6696a3d/validator_client/src/duties_service.rs#L592-L610\r\n\r\nWe could improve the situation by requesting duties less often (not as safe), in bulk (not sure if this is supported by the standard API), or in parallel. More thought and testing required.\r\n\r\n## Version\r\n\r\nLighthouse v0.3.x (presumably)\r\n",
  "closed_by": {
    "login": "bors[bot]",
    "id": 26634292,
    "node_id": "MDM6Qm90MjY2MzQyOTI=",
    "avatar_url": "https://avatars.githubusercontent.com/in/1847?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bors%5Bbot%5D",
    "html_url": "https://github.com/apps/bors",
    "followers_url": "https://api.github.com/users/bors%5Bbot%5D/followers",
    "following_url": "https://api.github.com/users/bors%5Bbot%5D/following{/other_user}",
    "gists_url": "https://api.github.com/users/bors%5Bbot%5D/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bors%5Bbot%5D/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bors%5Bbot%5D/subscriptions",
    "organizations_url": "https://api.github.com/users/bors%5Bbot%5D/orgs",
    "repos_url": "https://api.github.com/users/bors%5Bbot%5D/repos",
    "events_url": "https://api.github.com/users/bors%5Bbot%5D/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bors%5Bbot%5D/received_events",
    "type": "Bot",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/1828/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/1828/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/716243111",
    "html_url": "https://github.com/sigp/lighthouse/issues/1828#issuecomment-716243111",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1828",
    "id": 716243111,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxNjI0MzExMQ==",
    "user": {
      "login": "realbigsean",
      "id": 5160426,
      "node_id": "MDQ6VXNlcjUxNjA0MjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5160426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/realbigsean",
      "html_url": "https://github.com/realbigsean",
      "followers_url": "https://api.github.com/users/realbigsean/followers",
      "following_url": "https://api.github.com/users/realbigsean/following{/other_user}",
      "gists_url": "https://api.github.com/users/realbigsean/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/realbigsean/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/realbigsean/subscriptions",
      "organizations_url": "https://api.github.com/users/realbigsean/orgs",
      "repos_url": "https://api.github.com/users/realbigsean/repos",
      "events_url": "https://api.github.com/users/realbigsean/events{/privacy}",
      "received_events_url": "https://api.github.com/users/realbigsean/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-26T00:39:16Z",
    "updated_at": "2020-10-26T00:39:16Z",
    "author_association": "COLLABORATOR",
    "body": "I was checking this out a bit Friday. The standard API was updated recently so that bulk attester duty requests are supported: https://github.com/ethereum/eth2.0-APIs/pull/93\r\n\r\nAnd I think we are querying for proposer duties once per slot per validator, where we only need to query once per slot.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/716243111/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 1,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/723307669",
    "html_url": "https://github.com/sigp/lighthouse/issues/1828#issuecomment-723307669",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1828",
    "id": 723307669,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyMzMwNzY2OQ==",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-06T21:27:54Z",
    "updated_at": "2020-11-06T21:27:54Z",
    "author_association": "MEMBER",
    "body": "Nominating for A0 as it seems to be cropping up relatively often with lowish validator counts (100)",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/723307669/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
