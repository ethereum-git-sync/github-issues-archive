{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/2146",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/2146/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/2146/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/2146/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/2146",
  "id": 780948597,
  "node_id": "MDU6SXNzdWU3ODA5NDg1OTc=",
  "number": 2146,
  "title": "Improve lighthouse's disconnect responsiveness",
  "user": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2336800125,
      "node_id": "MDU6TGFiZWwyMzM2ODAwMTI1",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/t%20Networking",
      "name": "t Networking",
      "color": "40E0D0",
      "default": false,
      "description": ""
    },
    {
      "id": 2490305065,
      "node_id": "MDU6TGFiZWwyNDkwMzA1MDY1",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/A1",
      "name": "A1",
      "color": "223184",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-01-07T01:00:09Z",
  "updated_at": "2021-01-08T07:09:03Z",
  "closed_at": "2021-01-08T07:09:03Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nUsers are reporting Lighthouse taking 5 to 15mins for Lighthouse to drop their peers once a connection drops/changes (https://github.com/sigp/lighthouse/issues/2123). \r\n\r\nIt is known that discv5 will take at least 5m to update the ENR, but that is unrelated and addressed in a separate issue (#2131)\r\n\r\nIn current stable we ping every 30 seconds. It should take 2 failed pings to disconnect a peer and therefore I'd expect all peers to be dropped in under a minute. In #2132 I reduced the ping interval to 15 seconds so in the unstable branch I'd expect all peers to be dropped in under 30 seconds. \r\n\r\nThis doesn't seem to be the case and should be investigated as to why peers are taking longer to drop and reconnect when connectivity drops.\r\n",
  "closed_by": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/2146/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/2146/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/756346540",
    "html_url": "https://github.com/sigp/lighthouse/issues/2146#issuecomment-756346540",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2146",
    "id": 756346540,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NjM0NjU0MA==",
    "user": {
      "login": "pawanjay176",
      "id": 9890508,
      "node_id": "MDQ6VXNlcjk4OTA1MDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pawanjay176",
      "html_url": "https://github.com/pawanjay176",
      "followers_url": "https://api.github.com/users/pawanjay176/followers",
      "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
      "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
      "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
      "repos_url": "https://api.github.com/users/pawanjay176/repos",
      "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-07T19:55:05Z",
    "updated_at": "2021-01-07T19:55:05Z",
    "author_association": "MEMBER",
    "body": "Looks like this happens because a ping timeout is a `HighToleranceError` which leads to a disconnection after ~10mins.\r\nChanging the ping timeout to `LowTolerance` is kicking out all peers in ~1minute.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/756346540/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/756408874",
    "html_url": "https://github.com/sigp/lighthouse/issues/2146#issuecomment-756408874",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2146",
    "id": 756408874,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NjQwODg3NA==",
    "user": {
      "login": "bwtimmermans",
      "id": 18059288,
      "node_id": "MDQ6VXNlcjE4MDU5Mjg4",
      "avatar_url": "https://avatars.githubusercontent.com/u/18059288?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/bwtimmermans",
      "html_url": "https://github.com/bwtimmermans",
      "followers_url": "https://api.github.com/users/bwtimmermans/followers",
      "following_url": "https://api.github.com/users/bwtimmermans/following{/other_user}",
      "gists_url": "https://api.github.com/users/bwtimmermans/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/bwtimmermans/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/bwtimmermans/subscriptions",
      "organizations_url": "https://api.github.com/users/bwtimmermans/orgs",
      "repos_url": "https://api.github.com/users/bwtimmermans/repos",
      "events_url": "https://api.github.com/users/bwtimmermans/events{/privacy}",
      "received_events_url": "https://api.github.com/users/bwtimmermans/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-07T21:52:15Z",
    "updated_at": "2021-01-07T21:52:15Z",
    "author_association": "NONE",
    "body": "My similar experience (version: Lighthouse/v1.0.5-9ed65a6) is that very short connection outages, like <30s, often result in one or more missed attestations by Lighthouse, but not Teku, on the same network. The situation is I have a faulty telephone line awaiting repair and periodically the ADSL drops for about 30s before reconnecting. This afternoon I missed 4 attestations in a row on a LH validator but zero missed attestations on a Teku validator on the same network (different machine).\r\n\r\nIf peers are not disconnected for ~10 minutes, then why would a 30s Internet outage result in 15 minutes worth of missed attestations? I guess one answer to this would be that the IP address was changed, although I cannot confirm whether that is the case, nor would I expect that to be the case every time the connection goes down for 30s.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/756408874/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/756591162",
    "html_url": "https://github.com/sigp/lighthouse/issues/2146#issuecomment-756591162",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2146",
    "id": 756591162,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1NjU5MTE2Mg==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-08T07:09:03Z",
    "updated_at": "2021-01-08T07:09:03Z",
    "author_association": "MEMBER",
    "body": "@pawanjay176 nice. \r\n\r\nWe were not scoring the negotiation timeouts as I had expected. #2147 should make lighthouse significantly more responsive to disconnects. ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/756591162/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
