{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3527",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3527/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3527/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3527/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3527",
  "id": 1355499291,
  "node_id": "I_kwDOCFeAzc5Qy0cb",
  "number": 3527,
  "title": "Add CLI flag to force coloured log output",
  "user": {
    "login": "Sajjon",
    "id": 864410,
    "node_id": "MDQ6VXNlcjg2NDQxMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/864410?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Sajjon",
    "html_url": "https://github.com/Sajjon",
    "followers_url": "https://api.github.com/users/Sajjon/followers",
    "following_url": "https://api.github.com/users/Sajjon/following{/other_user}",
    "gists_url": "https://api.github.com/users/Sajjon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Sajjon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Sajjon/subscriptions",
    "organizations_url": "https://api.github.com/users/Sajjon/orgs",
    "repos_url": "https://api.github.com/users/Sajjon/repos",
    "events_url": "https://api.github.com/users/Sajjon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Sajjon/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 985647284,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODQ=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/enhancement",
      "name": "enhancement",
      "color": "a2eeef",
      "default": true,
      "description": "New feature or request"
    },
    {
      "id": 985647286,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODY=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "7057ff",
      "default": true,
      "description": "Good for newcomers"
    },
    {
      "id": 4328027039,
      "node_id": "LA_kwDOCFeAzc8AAAABAfhznw",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/backlog",
      "name": "backlog",
      "color": "C86912",
      "default": false,
      "description": "PR is not currently prioritized"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-08-30T09:58:12Z",
  "updated_at": "2022-09-26T05:33:20Z",
  "closed_at": "2022-09-26T05:33:20Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nI'm setting up Lighthouse to start as a background service on macOS using LaunchAgents. The LaunchAgent is a background running service which starts lighthouse by running a bash script I've written, let's call it `start_lighthouse_bn.sh`. Due to how LaunchAgents work on macOS I need to source my ENV variables first, which my script depends on, allowing me for neat start lighthouse command.\r\n\r\nI want to `tail -f` my Lighthouse log in my terminal (iTerm3) **with colors!** But I have not managed to get this working. I use the same setup with `geth` (starting geth in a `start_geth.sh` script I've written, see below.), and it works for geth - works meaning the log contains the ANSI color codes explicitly written out, which means that when I `tail -f` my geth.log I see colors!\r\n\r\nMy `start_lighthouse_bn.sh` script looks something like this, and this fails to keep ANSI colors intact, as in the `$LIGHTHOUSE_BN_LOG` log file are stripped of ANSI color codes => no color with `tail`\r\n\r\n```sh\r\n#!/bin/zsh\r\nsource /Users/sajjon/Desktop/Services/Scripts/set_env.sh\r\nsource \"lighthouse --network mainnet beacon_node --logfile $LIGHTHOUSE_BN_LOG\"\r\n```\r\n\r\nI've also tried this, which gives same (bad) result, i.e. no colors.\r\n```sh\r\n#!/bin/zsh\r\nsource /Users/sajjon/Desktop/Services/Scripts/set_env.sh\r\ncmd=\"lighthouse --network mainnet beacon_node\"\r\nscript -Fq $LIGHTHOUSE_BN_LOG /bin/zsh -c \"$cmd\"\r\n```\r\n\r\nHowever, the analogous script I use for starting geth works and results in $GETH_LOG contain ANSI color codes => colors with `tail`.\r\n\r\n```sh\r\n#!/bin/zsh\r\nsource /Users/sajjon/Desktop/Services/Scripts/set_env.sh\r\ncmd=\"geth\"\r\nscript -Fq $GETH_LOG /bin/zsh -c \"$cmd\"\r\n```\r\n\r\nOfc Lighthouse is written in Rust and Geth in Go, so not strange that they two different underlying loggers work differently, but I was hoping that I'm just doing something wronge - OR COMPLETELY OVERENGINEERING THINGS ðŸ˜› Do you have any quick fix for me?\r\n\r\nOr is a code change in how Lighthouse loggers work needed?\r\n\r\nAn important note is that when I `~/.lighthouse/mainnet/beacon/logs/beacon.log` I get no colors either, and when I open them, they lack ASNI color codes. And when I open the geth log I produce with `script -Fq ...` above, it looks like this:\r\n\r\n<img width=\"926\" alt=\"Screenshot 2022-08-30 at 11 51 56\" src=\"https://user-images.githubusercontent.com/864410/187406975-60ad053d-abc0-4fe3-a935-2a2156fd5fd3.png\">\r\n\r\nAnother important note - which is obvious but I'm stating it anyway - when I start lighthouse directly in my terminal I get colors! It is just when the log is written to logfile that I do not. So it should be possible to get the ANSI color codes written to the log file too right?\r\n\r\n## Version\r\n\r\n3.0.0\r\n\r\n## Present Behaviour\r\n\r\nUnable to output logs with ANSI color codes intact to a log file.\r\n\r\n## Expected Behaviour\r\n\r\nI expect log files to not be stripped of coloring, which DRASTICALLY increases readability of them! I'm very color...centric, seeing green makes me happy, and I instantly react to the red in logs, or yellow, so it is very important for me to be able to see this in log files.\r\n\r\n## Steps to resolve\r\nDunno, minor change in underlying logger? Or in config to logger? [On these lines the format is configured](https://github.com/sigp/lighthouse/blob/6f732986f1a42bec9f7ef7f57a143836f585a119/lighthouse/environment/src/lib.rs#L216-L219), maybe that can be changed? Which might require a new possible value to the [`log-format` arg](https://github.com/sigp/lighthouse/blob/bac7c3fa544495a257722aaad9cd8f72fee2f2b4/lighthouse/src/main.rs#L133-L139)",
  "closed_by": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3527/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3527/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1232498863",
    "html_url": "https://github.com/sigp/lighthouse/issues/3527#issuecomment-1232498863",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3527",
    "id": 1232498863,
    "node_id": "IC_kwDOCFeAzc5JdnCv",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-31T06:02:06Z",
    "updated_at": "2022-08-31T06:02:06Z",
    "author_association": "MEMBER",
    "body": "I think this would require some changes to the logger. We would need to add a CLI flag like `--log-colour` (alias `--log-color`) to force outputting coloured logs to the terminal. I don't think we should add a flag to write colour directly to logfiles.\r\n\r\nThe `TermDecorator` that we construct here could be modified using [`force_color`](https://docs.rs/slog-term/latest/slog_term/struct.TermDecoratorBuilder.html#method.force_color) according to the value of the CLI flag.\r\n\r\nhttps://github.com/sigp/lighthouse/blob/18c61a5e8be3e54226a86a69b96f8f4f7fd790e4/lighthouse/environment/src/lib.rs#L142-L148\r\n\r\n----\r\n\r\nAs a workaround you can use `unbuffer` as described in this post: https://unix.stackexchange.com/questions/636455/what-is-a-general-way-to-trick-programs-into-thinking-theyre-not-being-piped\r\n\r\nI can confirm that using `unbuffer` results in coloured logs being output to `tee` and on to `log.txt`:\r\n\r\n```\r\n$ unbuffer lighthouse bn --network goerli 2>&1 | tee -ia log.txt\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1232498863/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1232524283",
    "html_url": "https://github.com/sigp/lighthouse/issues/3527#issuecomment-1232524283",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3527",
    "id": 1232524283,
    "node_id": "IC_kwDOCFeAzc5JdtP7",
    "user": {
      "login": "Sajjon",
      "id": 864410,
      "node_id": "MDQ6VXNlcjg2NDQxMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/864410?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sajjon",
      "html_url": "https://github.com/Sajjon",
      "followers_url": "https://api.github.com/users/Sajjon/followers",
      "following_url": "https://api.github.com/users/Sajjon/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sajjon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sajjon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sajjon/subscriptions",
      "organizations_url": "https://api.github.com/users/Sajjon/orgs",
      "repos_url": "https://api.github.com/users/Sajjon/repos",
      "events_url": "https://api.github.com/users/Sajjon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sajjon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-31T06:38:43Z",
    "updated_at": "2022-08-31T06:38:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "@michaelsproul nice! I might give it a go if I find some free time this weekend.\n\nUnfortunately the `unbuffer` and `tee` solution did not work in macOS (Ventura) (after having `brew install expect` which seems to be the package unbuffwe is part of). Any ideas on alternative flags for macOS?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1232524283/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1232536268",
    "html_url": "https://github.com/sigp/lighthouse/issues/3527#issuecomment-1232536268",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3527",
    "id": 1232536268,
    "node_id": "IC_kwDOCFeAzc5JdwLM",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-31T06:54:51Z",
    "updated_at": "2022-08-31T06:54:51Z",
    "author_association": "MEMBER",
    "body": "> Any ideas on alternative flags for macOS?\r\n\r\nThis page suggests `stdbuf` but it doesn't seem to work with `lighthouse` (probably because we use static linking): https://stackoverflow.com/questions/3465619/how-to-make-output-of-any-shell-command-unbuffered",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1232536268/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1257502918",
    "html_url": "https://github.com/sigp/lighthouse/issues/3527#issuecomment-1257502918",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3527",
    "id": 1257502918,
    "node_id": "IC_kwDOCFeAzc5K8_jG",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-26T05:33:20Z",
    "updated_at": "2022-09-26T05:33:20Z",
    "author_association": "MEMBER",
    "body": "Resolved by #3538",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1257502918/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
