{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/2526",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/2526/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/2526/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/2526/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/2526",
  "id": 974969652,
  "node_id": "MDU6SXNzdWU5NzQ5Njk2NTI=",
  "number": 2526,
  "title": "Unable to restart lighthouse if altair fork is missed",
  "user": {
    "login": "realbigsean",
    "id": 5160426,
    "node_id": "MDQ6VXNlcjUxNjA0MjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5160426?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/realbigsean",
    "html_url": "https://github.com/realbigsean",
    "followers_url": "https://api.github.com/users/realbigsean/followers",
    "following_url": "https://api.github.com/users/realbigsean/following{/other_user}",
    "gists_url": "https://api.github.com/users/realbigsean/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/realbigsean/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/realbigsean/subscriptions",
    "organizations_url": "https://api.github.com/users/realbigsean/orgs",
    "repos_url": "https://api.github.com/users/realbigsean/repos",
    "events_url": "https://api.github.com/users/realbigsean/events{/privacy}",
    "received_events_url": "https://api.github.com/users/realbigsean/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3296108488,
      "node_id": "MDU6TGFiZWwzMjk2MTA4NDg4",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/v1.5.2",
      "name": "v1.5.2",
      "color": "e99695",
      "default": false,
      "description": "The release after v1.5.1"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-08-19T19:17:39Z",
  "updated_at": "2021-09-12T23:03:01Z",
  "closed_at": "2021-09-12T23:03:00Z",
  "author_association": "COLLABORATOR",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nIf you have lighthouse running v1.4 until after the altair fork occurs and then try to upgrade to v1.5, lighthouse won't start up. This is because we attempt to deserialize the head of the chain by first deserializing the slot of the head block, and comparing it to the fork schedule. But when we saved the block to the database, we used the pre-fork serialization (even though the slot of the block is post-fork).\r\n\r\n## Version\r\n\r\n1.5.0-rc.1\r\n\r\n## Present Behaviour\r\n\r\n```\r\nAug 19 18:24:29.427 INFO Starting beacon chain                   method: resume, service: beacon\r\nAug 19 18:24:44.083 CRIT Failed to start beacon node             reason: Failed to build beacon chain: DB error when reading head block: SszDecodeError(OffsetIntoFixedPortion(220)). Ensure the data directory is not initialized for a different network. The --purge-db flag can be used to permanently delete the existing data directory.\r\nAug 19 18:24:44.083 INFO Internal shutdown received              reason: Failed to start beacon node\r\nAug 19 18:24:44.083 INFO Shutting down..                         reason: Failure(\"Failed to start beacon node\")\r\n```\r\n\r\n## Expected Behaviour\r\n\r\nI think we should automatically try to re-sync from before the fork in this scenario\r\n\r\n## Steps to resolve\r\nThinking we could do either or both of these:\r\n\r\n- If we fail to deserialize the head of the beacon chain at startup, we could attempt to deserialize it based on the prior fork, and if that's successful it would suggest we're in this scenario. So we could start up lighthouse and automatically start re-syncing from right before the fork.\r\n- We could add a flag `--resync-from-fork altair` to help recover from situations like this\r\n",
  "closed_by": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/2526/reactions",
    "total_count": 4,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 2,
    "heart": 0,
    "rocket": 0,
    "eyes": 2
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/2526/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/902337823",
    "html_url": "https://github.com/sigp/lighthouse/issues/2526#issuecomment-902337823",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2526",
    "id": 902337823,
    "node_id": "IC_kwDOCFeAzc41yJUf",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-20T00:20:47Z",
    "updated_at": "2021-08-20T00:20:47Z",
    "author_association": "MEMBER",
    "body": "I'm going to have a go at this. It already looks like it might be a bit painful: all of our decoding methods assume they can determine the structure from the slot, so it might be messy to backtrack from the head of the minority chain to the pre-fork block while loading + deleting along the way.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/902337823/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/902348371",
    "html_url": "https://github.com/sigp/lighthouse/issues/2526#issuecomment-902348371",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2526",
    "id": 902348371,
    "node_id": "IC_kwDOCFeAzc41yL5T",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-20T00:48:57Z",
    "updated_at": "2021-08-20T00:48:57Z",
    "author_association": "MEMBER",
    "body": "I'll flag this as `v1.5.0` for the time being, just so it stays on our radar before we release. If we decide to push it to a later release, that's totally fine :slightly_smiling_face: ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/902348371/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/917726823",
    "html_url": "https://github.com/sigp/lighthouse/issues/2526#issuecomment-917726823",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2526",
    "id": 917726823,
    "node_id": "IC_kwDOCFeAzc42s2Zn",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-12T23:03:00Z",
    "updated_at": "2021-09-12T23:03:00Z",
    "author_association": "MEMBER",
    "body": "Resolved in #2529",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/917726823/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
