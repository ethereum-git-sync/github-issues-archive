{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/2552",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/2552/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/2552/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/2552/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/2552",
  "id": 981485446,
  "node_id": "MDU6SXNzdWU5ODE0ODU0NDY=",
  "number": 2552,
  "title": "Validator monitor shows best effort inclusion as sub-optimal",
  "user": {
    "login": "pawanjay176",
    "id": 9890508,
    "node_id": "MDQ6VXNlcjk4OTA1MDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pawanjay176",
    "html_url": "https://github.com/pawanjay176",
    "followers_url": "https://api.github.com/users/pawanjay176/followers",
    "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
    "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
    "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
    "repos_url": "https://api.github.com/users/pawanjay176/repos",
    "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-08-27T18:18:23Z",
  "updated_at": "2021-10-05T09:02:08Z",
  "closed_at": "2021-10-05T09:02:08Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nFor the per epoch report in the validator monitor logs, we show a `Sub-optimal inclusion delay` log for min inclusion distances > 1.\r\nThis is misleading to users in cases where the attestation was actually included optimally in the next non missed/ non orphaned slot.\r\n\r\n## Version\r\n\r\nunstable\r\n\r\n## Expected Behaviour\r\n\r\nShould show inclusion delay == optimal delay in cases where attestation was included in first block after the attestation was made. At the very least, the log should indicate that the inclusion delay may be incorrect because of missed/orphaned blocks.\r\n\r\n## Steps to resolve\r\n\r\nNot sure yet. Will investigate next week.\r\n\r\n",
  "closed_by": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/2552/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/2552/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/908352970",
    "html_url": "https://github.com/sigp/lighthouse/issues/2552#issuecomment-908352970",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2552",
    "id": 908352970,
    "node_id": "IC_kwDOCFeAzc42JF3K",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-30T13:41:01Z",
    "updated_at": "2021-08-30T13:42:24Z",
    "author_association": "MEMBER",
    "body": "We currently read the inclusion distance straight from the epoch processing summary, but this approach doesn't work for Altair and doesn't lend itself well to computing the best-effort inclusion delay.\r\n\r\nInstead, I wonder if we could compute the minimum attestation inclusion distance per validator when we record attestations from blocks, here:\r\n\r\nhttps://github.com/sigp/lighthouse/blob/b0ac3464ca5fb1e9d75060b56c83bfaf990a3d25/beacon_node/beacon_chain/src/validator_monitor.rs#L799-L808\r\n\r\nI think the only extra bit of information we'd have to pass to that function is the slot of the block's parent (which is available), in which case the best-effort inclusion distance (0-optimal) is:\r\n\r\n```\r\nmax(parent_slot - attestation.slot, 0)\r\n```\r\n\r\nor\r\n\r\n```\r\nparent_slot.saturating_sub(attestation.slot)\r\n```\r\n\r\nWhich is fun because it doesn't even depend on `block.slot()`!\r\n\r\n--\r\n\r\nThe downside to this is that it requires the validator monitor to have processed the blocks rather than just received the summary, which wouldn't be an issue most of the time, only after a restart.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/908352970/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/908795340",
    "html_url": "https://github.com/sigp/lighthouse/issues/2552#issuecomment-908795340",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2552",
    "id": 908795340,
    "node_id": "IC_kwDOCFeAzc42Kx3M",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-31T00:15:01Z",
    "updated_at": "2021-08-31T00:15:01Z",
    "author_association": "MEMBER",
    "body": ">  I wonder if we could compute the minimum attestation inclusion distance per validator when we record attestations from blocks\r\n\r\nIt's not necessarily a deal breaker, but we'd have issues determining the correct inclusion distance when a block is orphaned.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/908795340/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
