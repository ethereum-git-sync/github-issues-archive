{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/4259",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/4259/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/4259/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/4259/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/4259",
  "id": 1693998041,
  "node_id": "I_kwDOCFeAzc5k-FvZ",
  "number": 4259,
  "title": "De-bounce `Unable to send message to the beacon processor` log",
  "user": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2336802021,
      "node_id": "MDU6TGFiZWwyMzM2ODAyMDIx",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/UX-and-logs",
      "name": "UX-and-logs",
      "color": "DB9046",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "eserilev",
    "id": 7217615,
    "node_id": "MDQ6VXNlcjcyMTc2MTU=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7217615?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/eserilev",
    "html_url": "https://github.com/eserilev",
    "followers_url": "https://api.github.com/users/eserilev/followers",
    "following_url": "https://api.github.com/users/eserilev/following{/other_user}",
    "gists_url": "https://api.github.com/users/eserilev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/eserilev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/eserilev/subscriptions",
    "organizations_url": "https://api.github.com/users/eserilev/orgs",
    "repos_url": "https://api.github.com/users/eserilev/repos",
    "events_url": "https://api.github.com/users/eserilev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/eserilev/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "eserilev",
      "id": 7217615,
      "node_id": "MDQ6VXNlcjcyMTc2MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7217615?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eserilev",
      "html_url": "https://github.com/eserilev",
      "followers_url": "https://api.github.com/users/eserilev/followers",
      "following_url": "https://api.github.com/users/eserilev/following{/other_user}",
      "gists_url": "https://api.github.com/users/eserilev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eserilev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eserilev/subscriptions",
      "organizations_url": "https://api.github.com/users/eserilev/orgs",
      "repos_url": "https://api.github.com/users/eserilev/repos",
      "events_url": "https://api.github.com/users/eserilev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eserilev/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-05-03T12:39:21Z",
  "updated_at": "2023-08-18T14:13:09Z",
  "closed_at": "2023-08-18T14:13:09Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nWhile reading over some logs of a struggling BN I noticed it getting spammed with the same log message <1ms apart:\r\n\r\n```\r\nlighthouse  | Apr 21 06:28:49.163 ERRO Unable to send message to the beacon processor, type: gossip_attestation, error: no available capacity, service: router\r\nlighthouse  | Apr 21 06:28:49.163 ERRO Unable to send message to the beacon processor, type: gossip_attestation, error: no available capacity, service: router\r\nlighthouse  | Apr 21 06:28:49.163 ERRO Unable to send message to the beacon processor, type: gossip_attestation, error: no available capacity, service: router\r\nlighthouse  | Apr 21 06:28:49.163 ERRO Unable to send message to the beacon processor, type: gossip_attestation, error: no available capacity, service: router\r\nlighthouse  | Apr 21 06:28:49.163 ERRO Unable to send message to the beacon processor, type: gossip_attestation, error: no available capacity, service: router\r\nlighthouse  | Apr 21 06:28:49.163 ERRO Unable to send message to the beacon processor, type: gossip_attestation, error: no available capacity, service: router\r\nlighthouse  | Apr 21 06:28:49.163 ERRO Unable to send message to the beacon processor, type: gossip_attestation, error: no available capacity, service: router\r\nlighthouse  | Apr 21 06:28:49.163 ERRO Unable to send message to the beacon processor, type: gossip_attestation, error: no available capacity, service: router\r\nlighthouse  | Apr 21 06:28:49.163 ERRO Unable to send message to the beacon processor, type: gossip_attestation, error: no available capacity, service: router\r\nlighthouse  | Apr 21 06:28:49.163 ERRO Unable to send message to the beacon processor, type: gossip_attestation, error: no available capacity, service: router\r\nlighthouse  | Apr 21 06:28:49.163 ERRO Unable to send message to the beacon processor, type: gossip_attestation, error: no available capacity, service: router\r\nlighthouse  | Apr 21 06:28:49.163 ERRO Unable to send message to the beacon processor, type: gossip_attestation, error: no available capacity, service: router\r\n```\r\n\r\nIdeally this shouldn't happen, but we could apply the same de-bouncing treatment we apply to other \"full capacity\" logs.\r\n\r\n## Version\r\n\r\nv4.0.2-rc.0 (but present in v4.1.0)\r\n",
  "closed_by": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/4259/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/4259/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1533985066",
    "html_url": "https://github.com/sigp/lighthouse/issues/4259#issuecomment-1533985066",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4259",
    "id": 1533985066,
    "node_id": "IC_kwDOCFeAzc5bbsEq",
    "user": {
      "login": "eserilev",
      "id": 7217615,
      "node_id": "MDQ6VXNlcjcyMTc2MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7217615?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eserilev",
      "html_url": "https://github.com/eserilev",
      "followers_url": "https://api.github.com/users/eserilev/followers",
      "following_url": "https://api.github.com/users/eserilev/following{/other_user}",
      "gists_url": "https://api.github.com/users/eserilev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eserilev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eserilev/subscriptions",
      "organizations_url": "https://api.github.com/users/eserilev/orgs",
      "repos_url": "https://api.github.com/users/eserilev/repos",
      "events_url": "https://api.github.com/users/eserilev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eserilev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-04T02:10:37Z",
    "updated_at": "2023-05-04T02:21:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "i can pick this one up\r\n\r\nim thinking we could initialize a new `TimeLatch` object inside `send_beacon_processor_work` and check if `elapsed()` evalutes to true before logging the error message",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1533985066/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1533994141",
    "html_url": "https://github.com/sigp/lighthouse/issues/4259#issuecomment-1533994141",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4259",
    "id": 1533994141,
    "node_id": "IC_kwDOCFeAzc5bbuSd",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-04T02:26:18Z",
    "updated_at": "2023-05-04T02:26:18Z",
    "author_association": "MEMBER",
    "body": "thanks @eserilev, that sounds like a decent solution. If you notice other logs there that could be de-bounced maybe we could add latches for all of them. Not sure if that would bloat the code too much",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1533994141/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1539076488",
    "html_url": "https://github.com/sigp/lighthouse/issues/4259#issuecomment-1539076488",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4259",
    "id": 1539076488,
    "node_id": "IC_kwDOCFeAzc5bvHGI",
    "user": {
      "login": "eserilev",
      "id": 7217615,
      "node_id": "MDQ6VXNlcjcyMTc2MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7217615?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eserilev",
      "html_url": "https://github.com/eserilev",
      "followers_url": "https://api.github.com/users/eserilev/followers",
      "following_url": "https://api.github.com/users/eserilev/following{/other_user}",
      "gists_url": "https://api.github.com/users/eserilev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eserilev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eserilev/subscriptions",
      "organizations_url": "https://api.github.com/users/eserilev/orgs",
      "repos_url": "https://api.github.com/users/eserilev/repos",
      "events_url": "https://api.github.com/users/eserilev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eserilev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-08T21:26:10Z",
    "updated_at": "2023-05-08T21:26:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "i think we should only debounce logs with the potential to be spammy, as it could bloat the code if we do it for every error log by default. im not sure which other error logs could be problematic, but happy to add debounces if i can identify them.\r\n\r\nmy current PR only debounces the log mentioned in this issue",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1539076488/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
