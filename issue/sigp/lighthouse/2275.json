{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/2275",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/2275/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/2275/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/2275/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/2275",
  "id": 837494476,
  "node_id": "MDU6SXNzdWU4Mzc0OTQ0NzY=",
  "number": 2275,
  "title": "/beacon/states/{state_id}/validators/validator_id returns incorrect error code",
  "user": {
    "login": "pawanjay176",
    "id": 9890508,
    "node_id": "MDQ6VXNlcjk4OTA1MDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pawanjay176",
    "html_url": "https://github.com/pawanjay176",
    "followers_url": "https://api.github.com/users/pawanjay176/followers",
    "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
    "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
    "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
    "repos_url": "https://api.github.com/users/pawanjay176/repos",
    "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3220956595,
      "node_id": "MDU6TGFiZWwzMjIwOTU2NTk1",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/v1.5.1",
      "name": "v1.5.1",
      "color": "d4c5f9",
      "default": false,
      "description": "To be included in the v1.5.1 relase"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-03-22T09:06:47Z",
  "updated_at": "2021-08-20T01:03:29Z",
  "closed_at": "2021-08-20T01:03:29Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nThe eth2 api https://ethereum.github.io/eth2.0-APIs/#/Beacon/getStateValidator spec is a bit unclear as to what to return when the validator_id is not present in the given state. \r\nWe return a 404 in this case. Teku seems to be returning 400. Found this incompatibility when testing a lighthouse pyrmont validator with a teku infura beacon node.\r\nGot the error\r\n```\r\nERRO Failed to resolve pubkey to index       pubkey: 0x81f939c047f01bd93fc777c896eb2204a31a72f9b1a8f6e6db8c7fdbf08db3e4a9d272c38321ad2cade108b4da9eaa85, error: All endpoints failed https://<INFURA-KEY>@eth2-beacon-pyrmont.infura.io/ => RequestFailed(StatusCode(400)), service: duties\r\n```\r\n## Version\r\n\r\nunstable\r\n\r\n## Expected Behaviour\r\n\r\nNot sure as the spec seems ambiguous whether to return 400 or 404 in the case of a validator not present in the state.\r\n\r\n## Steps to resolve\r\n\r\nFix in lighthouse/teku if spec is clear or open an issue to clarify in the specs repo.",
  "closed_by": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/2275/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/2275/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/897117846",
    "html_url": "https://github.com/sigp/lighthouse/issues/2275#issuecomment-897117846",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2275",
    "id": 897117846,
    "node_id": "IC_kwDOCFeAzc41eO6W",
    "user": {
      "login": "ethDreamer",
      "id": 37123614,
      "node_id": "MDQ6VXNlcjM3MTIzNjE0",
      "avatar_url": "https://avatars.githubusercontent.com/u/37123614?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ethDreamer",
      "html_url": "https://github.com/ethDreamer",
      "followers_url": "https://api.github.com/users/ethDreamer/followers",
      "following_url": "https://api.github.com/users/ethDreamer/following{/other_user}",
      "gists_url": "https://api.github.com/users/ethDreamer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ethDreamer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ethDreamer/subscriptions",
      "organizations_url": "https://api.github.com/users/ethDreamer/orgs",
      "repos_url": "https://api.github.com/users/ethDreamer/repos",
      "events_url": "https://api.github.com/users/ethDreamer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ethDreamer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-11T20:09:50Z",
    "updated_at": "2021-08-11T20:16:14Z",
    "author_association": "COLLABORATOR",
    "body": "Opened a new issue:\r\n\r\n* https://github.com/ethereum/eth2.0-APIs/issues/161",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/897117846/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/900545197",
    "html_url": "https://github.com/sigp/lighthouse/issues/2275#issuecomment-900545197",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2275",
    "id": 900545197,
    "node_id": "IC_kwDOCFeAzc41rTqt",
    "user": {
      "login": "ethDreamer",
      "id": 37123614,
      "node_id": "MDQ6VXNlcjM3MTIzNjE0",
      "avatar_url": "https://avatars.githubusercontent.com/u/37123614?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ethDreamer",
      "html_url": "https://github.com/ethDreamer",
      "followers_url": "https://api.github.com/users/ethDreamer/followers",
      "following_url": "https://api.github.com/users/ethDreamer/following{/other_user}",
      "gists_url": "https://api.github.com/users/ethDreamer/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ethDreamer/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ethDreamer/subscriptions",
      "organizations_url": "https://api.github.com/users/ethDreamer/orgs",
      "repos_url": "https://api.github.com/users/ethDreamer/repos",
      "events_url": "https://api.github.com/users/ethDreamer/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ethDreamer/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-17T18:46:13Z",
    "updated_at": "2021-08-17T18:46:13Z",
    "author_association": "COLLABORATOR",
    "body": "@pawanjay176 see comment on the linked issue above. Looks like `404` is the correct code to return in this instance as one of the examples shown is `ValidatorNotFound`. We should inform teku.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/900545197/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/902353187",
    "html_url": "https://github.com/sigp/lighthouse/issues/2275#issuecomment-902353187",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2275",
    "id": 902353187,
    "node_id": "IC_kwDOCFeAzc41yNEj",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-08-20T01:03:29Z",
    "updated_at": "2021-08-20T01:03:29Z",
    "author_association": "MEMBER",
    "body": "It seems like LH is doing the right thing and returning 404, so I'll close this. Please feel free to reopen if I missed something.\r\n\r\nThanks @pawanjay176 and @ethDreamer.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/902353187/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
