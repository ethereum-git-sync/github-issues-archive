{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/4130",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/4130/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/4130/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/4130/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/4130",
  "id": 1640832372,
  "node_id": "I_kwDOCFeAzc5hzR10",
  "number": 4130,
  "title": "Frequent \"Attestation queue full\" error. ",
  "user": {
    "login": "zheli",
    "id": 157039,
    "node_id": "MDQ6VXNlcjE1NzAzOQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/157039?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/zheli",
    "html_url": "https://github.com/zheli",
    "followers_url": "https://api.github.com/users/zheli/followers",
    "following_url": "https://api.github.com/users/zheli/following{/other_user}",
    "gists_url": "https://api.github.com/users/zheli/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/zheli/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/zheli/subscriptions",
    "organizations_url": "https://api.github.com/users/zheli/orgs",
    "repos_url": "https://api.github.com/users/zheli/repos",
    "events_url": "https://api.github.com/users/zheli/events{/privacy}",
    "received_events_url": "https://api.github.com/users/zheli/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-03-26T09:13:56Z",
  "updated_at": "2023-04-14T23:13:49Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\nWe started to see more frequent \"attestation queue full\" errors from our beacon nodes. I am a bit worried that it would affect our successful attestation rate.\r\n\r\n## Version\r\nLighthouse v3.5.1\r\n\r\n## Present Behaviour\r\nMore and more frequent \"attestation queue full\" errors are seen.\r\n\r\n## Expected Behaviour\r\nNot seeing that errors at all.\r\n\r\n## Steps to resolve\r\nOur beacon node is running in a data center with 8Ghz intel CPU and 8GB ram.\r\n\r\n## Screenshot\r\n![image](https://user-images.githubusercontent.com/157039/227766202-51ecc3e1-6fe2-4103-8528-e69425509a6f.png)\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/4130/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/4130/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1487692676",
    "html_url": "https://github.com/sigp/lighthouse/issues/4130#issuecomment-1487692676",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4130",
    "id": 1487692676,
    "node_id": "IC_kwDOCFeAzc5YrGOE",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-28T22:34:53Z",
    "updated_at": "2023-03-28T22:34:53Z",
    "author_association": "MEMBER",
    "body": "I saw your comment on #4126. Are you running entirely web3signer validators, and making frequent calls to the validator client HTTP API?\r\n\r\nWe were thinking of scaling up the size of these queues independently, as it seems other users are filling them as well.\r\n\r\nWhat's your set up for your execution node? Do you seem warnings or errors related to it? I'm guessing it's on a different machine?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1487692676/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1495589826",
    "html_url": "https://github.com/sigp/lighthouse/issues/4130#issuecomment-1495589826",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4130",
    "id": 1495589826,
    "node_id": "IC_kwDOCFeAzc5ZJOPC",
    "user": {
      "login": "zheli",
      "id": 157039,
      "node_id": "MDQ6VXNlcjE1NzAzOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157039?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zheli",
      "html_url": "https://github.com/zheli",
      "followers_url": "https://api.github.com/users/zheli/followers",
      "following_url": "https://api.github.com/users/zheli/following{/other_user}",
      "gists_url": "https://api.github.com/users/zheli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zheli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zheli/subscriptions",
      "organizations_url": "https://api.github.com/users/zheli/orgs",
      "repos_url": "https://api.github.com/users/zheli/repos",
      "events_url": "https://api.github.com/users/zheli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zheli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-04T08:50:14Z",
    "updated_at": "2023-04-04T08:50:14Z",
    "author_association": "NONE",
    "body": "Thanks for following up!\r\n\r\nWe are not using web3signer at the moment, we use vouch as validator and MEV builder. Not sure how often it calls the validator HTTP API, what log message should I search to find that out?\r\n\r\nOur EL is geth. All clients are on their own servers. I haven't seen any errors in geth log when the `attestation queue full` error happened.\r\n\r\nSometimes, there are a few warnings or errors prior to  `attestation queue full`  message, but I am not sure if they are related. It might be request timeouts to EL, or beacon chain re-org.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1495589826/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1508520824",
    "html_url": "https://github.com/sigp/lighthouse/issues/4130#issuecomment-1508520824",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4130",
    "id": 1508520824,
    "node_id": "IC_kwDOCFeAzc5Z6jN4",
    "user": {
      "login": "zheli",
      "id": 157039,
      "node_id": "MDQ6VXNlcjE1NzAzOQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/157039?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/zheli",
      "html_url": "https://github.com/zheli",
      "followers_url": "https://api.github.com/users/zheli/followers",
      "following_url": "https://api.github.com/users/zheli/following{/other_user}",
      "gists_url": "https://api.github.com/users/zheli/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/zheli/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/zheli/subscriptions",
      "organizations_url": "https://api.github.com/users/zheli/orgs",
      "repos_url": "https://api.github.com/users/zheli/repos",
      "events_url": "https://api.github.com/users/zheli/events{/privacy}",
      "received_events_url": "https://api.github.com/users/zheli/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-14T13:39:10Z",
    "updated_at": "2023-04-14T13:39:10Z",
    "author_association": "NONE",
    "body": "> I saw your comment on #4126. Are you running entirely web3signer validators, and making frequent calls to the validator client HTTP API?\r\n> \r\n> We were thinking of scaling up the size of these queues independently, as it seems other users are filling them as well.\r\n> \r\n> What's your set up for your execution node? Do you seem warnings or errors related to it? I'm guessing it's on a different machine?\r\n\r\nIs the queue size fixed/hardcoded? Will we have a bigger queue if giving more memory to the machine?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1508520824/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1509381486",
    "html_url": "https://github.com/sigp/lighthouse/issues/4130#issuecomment-1509381486",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4130",
    "id": 1509381486,
    "node_id": "IC_kwDOCFeAzc5Z91Vu",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-14T23:11:20Z",
    "updated_at": "2023-04-14T23:11:20Z",
    "author_association": "MEMBER",
    "body": "@zheli The queue size is fixed (hardcoded). You could try to prevent it from filling by allocating more/faster CPU cores. That way items will be cleared from the queue more quickly.\n\nI recommend running the non-portable binary from our release page (or the `:v4.0.2-rp.0-modern` docker image) and using a CPU with SHA extensions. AMD tends to support SHA extensions better than Intel. If you're compiling yourself use the `maxperf` profile as described here: https://lighthouse-book.sigmaprime.io/installation-source.html#compilation-profiles",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1509381486/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1509382755",
    "html_url": "https://github.com/sigp/lighthouse/issues/4130#issuecomment-1509382755",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4130",
    "id": 1509382755,
    "node_id": "IC_kwDOCFeAzc5Z91pj",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-14T23:13:49Z",
    "updated_at": "2023-04-14T23:13:49Z",
    "author_association": "MEMBER",
    "body": "Just to clarify, when you say all clients have their own machines, does that mean the Lighthouse BN and Geth are on different machines? What's the latency like between them (measured with `ping` is fine).",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1509382755/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
