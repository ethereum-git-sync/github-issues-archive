{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/4424",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/4424/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/4424/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/4424/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/4424",
  "id": 1769388718,
  "node_id": "I_kwDOCFeAzc5pdrqu",
  "number": 4424,
  "title": "Add more slasher backends (redb, sqlite, postgres)",
  "user": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2336798682,
      "node_id": "MDU6TGFiZWwyMzM2Nzk4Njgy",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/database",
      "name": "database",
      "color": "C01C9D",
      "default": false,
      "description": ""
    },
    {
      "id": 2602136164,
      "node_id": "MDU6TGFiZWwyNjAyMTM2MTY0",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/slasher",
      "name": "slasher",
      "color": "FAD722",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2023-06-22T10:22:22Z",
  "updated_at": "2023-09-11T10:41:03Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nIt would be great to have even more choice for slasher database backends beyond LMDB and MDBX. This could also be a good way for us to try out a couple of new DBs to see if they'd be suitable for the beacon node itself (which currently only supports LevelDB).\r\n\r\nThe candidates I'd like to try are:\r\n\r\n- [ ] [`redb`](https://github.com/cberner/redb) (https://github.com/sigp/lighthouse/pull/4529)\r\n- [ ] [`postgres`](https://www.postgresql.org/)\r\n- [ ] [`sqlite`](https://www.sqlite.org/index.html) (https://github.com/sigp/lighthouse/pull/4666).\r\n\r\nI think `redb` would be the easiest, as it's most similar to the existing backends. Then `sqlite`, because it can be embedded in process and we already use it in the VC via `rusqlite`. Most difficult would be postgres, because we'd either need to _assume_ that a postgres server is running (yuck) or run one ourselves in a Docker container or something (also kind of yuck).\r\n\r\n## Steps to resolve\r\n\r\n1. Add a new variant for the database to the [`DatabaseBackend`](https://github.com/sigp/lighthouse/blob/c547a11b0da48db6fdd03bca2c6ce2448bbcc3a9/slasher/src/config.rs#L59-L65) enum.\r\n2. Add a new file in e.g. `slasher/src/database/redb_impl.rs`, with types named similarly to the other existing backends, see [`lmdb_impl.rs`](https://github.com/sigp/lighthouse/blob/stable/slasher/src/database/lmdb_impl.rs)\r\n3. Add variants to the enums in [`interface.rs`](https://github.com/sigp/lighthouse/blob/c547a11b0da48db6fdd03bca2c6ce2448bbcc3a9/slasher/src/database/interface.rs#L12-L58) for the new backend.\r\n4. Get the slasher tests to pass with the [`DEFAULT_BACKEND`](https://github.com/sigp/lighthouse/blob/c547a11b0da48db6fdd03bca2c6ce2448bbcc3a9/slasher/src/config.rs#L17) set to the new backend, and `cargo test --release -p slasher`. We can worry about the feature flag stuff later.\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/4424/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 1,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/4424/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1604267174",
    "html_url": "https://github.com/sigp/lighthouse/issues/4424#issuecomment-1604267174",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4424",
    "id": 1604267174,
    "node_id": "IC_kwDOCFeAzc5fnyym",
    "user": {
      "login": "eserilev",
      "id": 7217615,
      "node_id": "MDQ6VXNlcjcyMTc2MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7217615?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eserilev",
      "html_url": "https://github.com/eserilev",
      "followers_url": "https://api.github.com/users/eserilev/followers",
      "following_url": "https://api.github.com/users/eserilev/following{/other_user}",
      "gists_url": "https://api.github.com/users/eserilev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eserilev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eserilev/subscriptions",
      "organizations_url": "https://api.github.com/users/eserilev/orgs",
      "repos_url": "https://api.github.com/users/eserilev/repos",
      "events_url": "https://api.github.com/users/eserilev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eserilev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-23T13:12:39Z",
    "updated_at": "2023-06-24T11:06:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "I think I saw you mention this as a project idea in the Ethereum Protocol Fellowship repo. I plan on participating in the upcoming cohort and would be very interested in picking this up as my project.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1604267174/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1605408680",
    "html_url": "https://github.com/sigp/lighthouse/issues/4424#issuecomment-1605408680",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4424",
    "id": 1605408680,
    "node_id": "IC_kwDOCFeAzc5fsJeo",
    "user": {
      "login": "Gua00va",
      "id": 105484243,
      "node_id": "U_kgDOBkmP0w",
      "avatar_url": "https://avatars.githubusercontent.com/u/105484243?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gua00va",
      "html_url": "https://github.com/Gua00va",
      "followers_url": "https://api.github.com/users/Gua00va/followers",
      "following_url": "https://api.github.com/users/Gua00va/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gua00va/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gua00va/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gua00va/subscriptions",
      "organizations_url": "https://api.github.com/users/Gua00va/orgs",
      "repos_url": "https://api.github.com/users/Gua00va/repos",
      "events_url": "https://api.github.com/users/Gua00va/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gua00va/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-24T11:34:12Z",
    "updated_at": "2023-06-24T11:38:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I think I saw you mention this as a project idea in the Ethereum Protocol Fellowship repo. I plan on participating in the upcoming cohort and would be very interested in picking this up as my project.\r\n\r\nI am also interested in taking this as my project idea. Would you mind working as a team?\r\n ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1605408680/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1605439119",
    "html_url": "https://github.com/sigp/lighthouse/issues/4424#issuecomment-1605439119",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4424",
    "id": 1605439119,
    "node_id": "IC_kwDOCFeAzc5fsQ6P",
    "user": {
      "login": "eserilev",
      "id": 7217615,
      "node_id": "MDQ6VXNlcjcyMTc2MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7217615?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eserilev",
      "html_url": "https://github.com/eserilev",
      "followers_url": "https://api.github.com/users/eserilev/followers",
      "following_url": "https://api.github.com/users/eserilev/following{/other_user}",
      "gists_url": "https://api.github.com/users/eserilev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eserilev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eserilev/subscriptions",
      "organizations_url": "https://api.github.com/users/eserilev/orgs",
      "repos_url": "https://api.github.com/users/eserilev/repos",
      "events_url": "https://api.github.com/users/eserilev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eserilev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-24T12:09:54Z",
    "updated_at": "2023-06-24T12:10:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I am also interested in taking this as my project idea. Would you mind working as a team?\r\n\r\nyeah! would be great to work on this as a team\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1605439119/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 1,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1605678339",
    "html_url": "https://github.com/sigp/lighthouse/issues/4424#issuecomment-1605678339",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4424",
    "id": 1605678339,
    "node_id": "IC_kwDOCFeAzc5ftLUD",
    "user": {
      "login": "Gua00va",
      "id": 105484243,
      "node_id": "U_kgDOBkmP0w",
      "avatar_url": "https://avatars.githubusercontent.com/u/105484243?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Gua00va",
      "html_url": "https://github.com/Gua00va",
      "followers_url": "https://api.github.com/users/Gua00va/followers",
      "following_url": "https://api.github.com/users/Gua00va/following{/other_user}",
      "gists_url": "https://api.github.com/users/Gua00va/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Gua00va/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Gua00va/subscriptions",
      "organizations_url": "https://api.github.com/users/Gua00va/orgs",
      "repos_url": "https://api.github.com/users/Gua00va/repos",
      "events_url": "https://api.github.com/users/Gua00va/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Gua00va/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-06-24T18:27:10Z",
    "updated_at": "2023-06-24T18:27:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "> > I am also interested in taking this as my project idea. Would you mind working as a team?\r\n> \r\n> yeah! would be great to work on this as a team\r\n\r\nGreat! Ping me in the discord server. I have the same username.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1605678339/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1712996909",
    "html_url": "https://github.com/sigp/lighthouse/issues/4424#issuecomment-1712996909",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4424",
    "id": 1712996909,
    "node_id": "IC_kwDOCFeAzc5mGkIt",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-11T00:44:51Z",
    "updated_at": "2023-09-11T00:44:51Z",
    "author_association": "MEMBER",
    "body": "Now that we have a couple of new backends in the works, namely Redb and Sqlite, it would be great to see a performance shoot-out. For the slasher the key metric is the time taken to process each batch, which is recorded in Prometheus as `slasher_process_batch_time`. We have a Grafana dashboard for this here: https://github.com/sigp/lighthouse-metrics/blob/master/dashboards/Slasher.json\r\n\r\nA good test would be to start-up a slasher on the same machine with each of the backends -- LMDB, Redb, Sqlite -- and compare the performance. To prevent them competing for CPU and I/O it's probably best to run the slashers one at a time (not concurrently). Running each one for a few hours should be enough to get a feel for its performance. If one or both of the new backends are competitive in this test we can then look into running a longer test (2 weeks+) in which we can measure the total disk usage and the long-term performance.\r\n\r\nI have a shared execution node on mainnet (running [`eleel`](https://github.com/sigp/eleel)) which I could grant access to for this experiment. If this is something you're interested in doing @eserilev, DM me your SSH pubkey on Discord.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1712996909/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1713625636",
    "html_url": "https://github.com/sigp/lighthouse/issues/4424#issuecomment-1713625636",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4424",
    "id": 1713625636,
    "node_id": "IC_kwDOCFeAzc5mI9ok",
    "user": {
      "login": "eserilev",
      "id": 7217615,
      "node_id": "MDQ6VXNlcjcyMTc2MTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7217615?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/eserilev",
      "html_url": "https://github.com/eserilev",
      "followers_url": "https://api.github.com/users/eserilev/followers",
      "following_url": "https://api.github.com/users/eserilev/following{/other_user}",
      "gists_url": "https://api.github.com/users/eserilev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/eserilev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/eserilev/subscriptions",
      "organizations_url": "https://api.github.com/users/eserilev/orgs",
      "repos_url": "https://api.github.com/users/eserilev/repos",
      "events_url": "https://api.github.com/users/eserilev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/eserilev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-11T10:41:03Z",
    "updated_at": "2023-09-11T10:41:03Z",
    "author_association": "CONTRIBUTOR",
    "body": "@michaelsproul this sounds great, I am sending you my SSH pubkey now. thank you!",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1713625636/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
