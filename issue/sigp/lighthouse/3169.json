{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3169",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3169/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3169/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3169/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3169",
  "id": 1226517567,
  "node_id": "I_kwDOCFeAzc5JGyw_",
  "number": 3169,
  "title": "`Peer sent invalid block in single block` seems to cause beacon node desync (malicious ?)",
  "user": {
    "login": "GerardBri",
    "id": 83615406,
    "node_id": "MDQ6VXNlcjgzNjE1NDA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/83615406?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/GerardBri",
    "html_url": "https://github.com/GerardBri",
    "followers_url": "https://api.github.com/users/GerardBri/followers",
    "following_url": "https://api.github.com/users/GerardBri/following{/other_user}",
    "gists_url": "https://api.github.com/users/GerardBri/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/GerardBri/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/GerardBri/subscriptions",
    "organizations_url": "https://api.github.com/users/GerardBri/orgs",
    "repos_url": "https://api.github.com/users/GerardBri/repos",
    "events_url": "https://api.github.com/users/GerardBri/events{/privacy}",
    "received_events_url": "https://api.github.com/users/GerardBri/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 9,
  "created_at": "2022-05-05T10:55:23Z",
  "updated_at": "2022-09-12T08:24:03Z",
  "closed_at": "2022-09-12T08:24:03Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nMy node seems to receive 28 invalid block, and some minutes after, my node is desynced :(\r\nSince March~April, my node get more and more desync/crash and i have to purge-db and restart all the node, so this time, i keep the logs, and try to understand why :)\r\n\r\nthe typical log which seems to be the root cause is : \r\n```\r\nWARN Peer sent invalid block in single block lookup, peer_id: 16Uiu2HAmBR1wNeooCA4PpnmAqH7K1ECkMqwMrqMZKvXFnUWbeeb8, error: StateRootMismatch { block: 0x2f6d4166f1b0c705d02d31603b96b9fe818eede3e6187b81bc44a0d32f301849, local: 0x2b7b7b26a2932990eb8eab627c80c153e40873b423e3c4bcd5b520eced91aefe }, root: 0xdefa‚Ä¶3529, service: sync\r\n```\r\n\r\n## Version\r\n\r\nRelease from github : **Lighthouse v2.2.1-aa72088**\r\n\r\n\r\n## Present Behaviour\r\n\r\nin summary in logs, i've got this : \r\n\r\n- **everything is fine**\r\n```\r\nINFO New block received\r\nINFO Synced\r\n```\r\n\r\n- **bad block received**\r\n_\\~ May 05 05:08_\r\n```\r\nWARN Peer sent invalid block in single block lookup (x28)\r\n```\r\n\r\n- **beacon node alert on sync stated**\r\n_\\~ May 05 05:14_\r\n```\r\nINFO Sync state updated                      new_state: Syncing Head Chain, old_state: Synced, service: sync\r\nWARN Batch failed to download. Dropping chain scoring peers, batch_epoch: 116915\r\nINFO Syncing                                 est_time: --, distance: 34 slots (6 mins)\r\n```\r\nthese **6 mins** match exactly time of the bad block received\r\n\r\n- **API request dying**\r\nafter a distance of 256 slots failing to sync, i've got WARN on HTTP API request like that\r\n```\r\nWARN Error processing HTTP API request       method: POST, path: /eth/v1/validator/duties/attester/116924, status: 503 Service Unavailable, elapsed: 9.228091ms\r\nWARN Error processing HTTP API request       method: GET, path: /eth/v1/validator/duties/proposer/116924, status: 503 Service Unavailable, elapsed: 10.509452ms\r\nWARN Error processing HTTP API request       method: POST, path: /eth/v1/validator/duties/attester/116925, status: 503 Service Unavailable, elapsed: 53.445¬µs\r\n```\r\n\r\n‚û°Ô∏è my node stop syncing, and then i couldn't validate any new blocks\r\n\r\n\r\n## Expected Behaviour\r\n\r\ni should keep syncing blocks, even if i receive bad/invalid/malicious blocks\r\n\r\n## Steps to resolve\r\n\r\nI've just restart the node with a `purge-db` parameter and everything is well synced after.\r\n\r\n## ‚ùì‚ö†Ô∏è Is it possible that someone try to hack the PoS consensus layer with malicious blocks or network packets ?\r\nBy this way, i think it's possible to identify an IP with new failed validators, so attackers could get a table with IP <=> validators and keep growing this table to throw a full attack later ?\r\n\r\n### full log\r\nüóíÔ∏è [attaq.log](https://github.com/sigp/lighthouse/files/8630557/attaq.log)\r\n\r\n",
  "closed_by": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3169/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3169/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1118460822",
    "html_url": "https://github.com/sigp/lighthouse/issues/3169#issuecomment-1118460822",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3169",
    "id": 1118460822,
    "node_id": "IC_kwDOCFeAzc5CqluW",
    "user": {
      "login": "pawanjay176",
      "id": 9890508,
      "node_id": "MDQ6VXNlcjk4OTA1MDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pawanjay176",
      "html_url": "https://github.com/pawanjay176",
      "followers_url": "https://api.github.com/users/pawanjay176/followers",
      "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
      "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
      "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
      "repos_url": "https://api.github.com/users/pawanjay176/repos",
      "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-05T11:52:43Z",
    "updated_at": "2022-05-05T11:52:43Z",
    "author_association": "MEMBER",
    "body": "Hey @GerardBri can you share the debug logs from `$datadir/beacon/logs/beacon.log`?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1118460822/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1118493068",
    "html_url": "https://github.com/sigp/lighthouse/issues/3169#issuecomment-1118493068",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3169",
    "id": 1118493068,
    "node_id": "IC_kwDOCFeAzc5CqtmM",
    "user": {
      "login": "GerardBri",
      "id": 83615406,
      "node_id": "MDQ6VXNlcjgzNjE1NDA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/83615406?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/GerardBri",
      "html_url": "https://github.com/GerardBri",
      "followers_url": "https://api.github.com/users/GerardBri/followers",
      "following_url": "https://api.github.com/users/GerardBri/following{/other_user}",
      "gists_url": "https://api.github.com/users/GerardBri/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/GerardBri/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/GerardBri/subscriptions",
      "organizations_url": "https://api.github.com/users/GerardBri/orgs",
      "repos_url": "https://api.github.com/users/GerardBri/repos",
      "events_url": "https://api.github.com/users/GerardBri/events{/privacy}",
      "received_events_url": "https://api.github.com/users/GerardBri/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-05T12:33:05Z",
    "updated_at": "2022-05-05T12:33:05Z",
    "author_association": "NONE",
    "body": "sure @pawanjay176 ,\r\n\r\nfull logs are in attachment below (truncated, because it's heavy, it starting from 03:00) and here is a summary of the first bad block received, i think\r\nfirst bad blocks start at **03:07:47.396** \r\n\r\n```\r\nMay 05 03:07:47.396 INFO New block received, root: 0xdefaf9755ead4b7b3829374eac750b3c24d63a797f7d75762aae387f3a903529, slot: 3741337, module: network::beacon_processor::worker::gossip_methods:721\r\nMay 05 03:07:47.444 DEBG Invalid gossip beacon block, block slot: 3741337, block root: 0xdefaf9755ead4b7b3829374eac750b3c24d63a797f7d75762aae387f3a903529, outcome: Err(InvalidSignature), module: network::beacon_processor::worker::gossip_methods:947\r\nMay 05 03:07:47.444 DEBG Peer score adjusted, score: -5.00, peer_id: 16Uiu2HAm6jLQLBPkKGWZxeDL1pC8AB7V9GS4FrZexJN2TxVgmZMB, msg: bad_gossip_block_ssz, service: libp2p, module: lighthouse_network::peer_manager::peerdb:537\r\nMay 05 03:07:47.461 DEBG Searching for block, block: 0xdefa‚Ä¶3529, peer_id: 16Uiu2HAmL3CCckemM1BFAcZfcRPatmBNwQb1oeLSyDcke3TjJF3D, service: sync, module: network::sync::block_lookups:83\r\nMay 05 03:07:47.981 DEBG Missed snapshot cache, block_delay: Some(391.605168ms), parent_root: 0xc591cbe17318c7cb530d02cc73ae9af9bd22af1a3d3f2bbf0a83d516d5743395, parent_slot: 3741336, slot: 3741337, service: beacon, module: beacon_chain::block_verification:1592\r\nMay 05 03:07:48.375 WARN Peer sent invalid block in single block lookup, peer_id: 16Uiu2HAmL3CCckemM1BFAcZfcRPatmBNwQb1oeLSyDcke3TjJF3D, error: StateRootMismatch { block: 0x2f6d4166f1b0c705d02d31603b96b9fe818eede3e6187b81bc44a0d32f301849, local: 0x2b7b7b26a2932990eb8eab627c80c153e40873b423e3c4bcd5b520eced91aefe }, root: 0xdefa‚Ä¶3529, service: sync, module: network::sync::block_lookups:422\r\nMay 05 03:07:48.382 DEBG Sync reporting peer, action: Mid Tolerance Error, peer_id: 16Uiu2HAmL3CCckemM1BFAcZfcRPatmBNwQb1oeLSyDcke3TjJF3D, service: sync, module: network::sync::network_context:230\r\nMay 05 03:07:48.383 DEBG Peer score adjusted, score: -5.00, peer_id: 16Uiu2HAmL3CCckemM1BFAcZfcRPatmBNwQb1oeLSyDcke3TjJF3D, msg: single_block_failure, service: libp2p, module: lighthouse_network::peer_manager::peerdb:537\r\nMay 05 03:07:48.926 DEBG Missed snapshot cache, block_delay: Some(391.605168ms), parent_root: 0xc591cbe17318c7cb530d02cc73ae9af9bd22af1a3d3f2bbf0a83d516d5743395, parent_slot: 3741336, slot: 3741337, service: beacon, module: beacon_chain::block_verification:1592\r\n```\r\n\r\nmy previous logs are time with GMT+2, here we've got GMT\r\n\r\n### debug log \r\nüóíÔ∏è starting from 03:00:00 : [mybeacon.log.zip](https://github.com/sigp/lighthouse/files/8631187/mybeacon.log.zip)\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1118493068/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1118499203",
    "html_url": "https://github.com/sigp/lighthouse/issues/3169#issuecomment-1118499203",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3169",
    "id": 1118499203,
    "node_id": "IC_kwDOCFeAzc5CqvGD",
    "user": {
      "login": "pawanjay176",
      "id": 9890508,
      "node_id": "MDQ6VXNlcjk4OTA1MDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pawanjay176",
      "html_url": "https://github.com/pawanjay176",
      "followers_url": "https://api.github.com/users/pawanjay176/followers",
      "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
      "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
      "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
      "repos_url": "https://api.github.com/users/pawanjay176/repos",
      "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-05T12:40:25Z",
    "updated_at": "2022-05-05T12:40:25Z",
    "author_association": "MEMBER",
    "body": "Thank you! Can you share your hardware setup as well? Looks like your node did the state transition correctly the second time around (after you purged the db) so I'm guessing some sort of temporary db corruption.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1118499203/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1118546318",
    "html_url": "https://github.com/sigp/lighthouse/issues/3169#issuecomment-1118546318",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3169",
    "id": 1118546318,
    "node_id": "IC_kwDOCFeAzc5Cq6mO",
    "user": {
      "login": "GerardBri",
      "id": 83615406,
      "node_id": "MDQ6VXNlcjgzNjE1NDA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/83615406?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/GerardBri",
      "html_url": "https://github.com/GerardBri",
      "followers_url": "https://api.github.com/users/GerardBri/followers",
      "following_url": "https://api.github.com/users/GerardBri/following{/other_user}",
      "gists_url": "https://api.github.com/users/GerardBri/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/GerardBri/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/GerardBri/subscriptions",
      "organizations_url": "https://api.github.com/users/GerardBri/orgs",
      "repos_url": "https://api.github.com/users/GerardBri/repos",
      "events_url": "https://api.github.com/users/GerardBri/events{/privacy}",
      "received_events_url": "https://api.github.com/users/GerardBri/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-05T13:24:13Z",
    "updated_at": "2022-05-05T13:24:13Z",
    "author_association": "NONE",
    "body": "well, there isn't the purge in the log, i've restart with `--purge-db` only hours after :) \r\n\r\nthe beacon node run in a proxmox VM with 4 full CPU, 8GiB RAM, 300 GiB disk\r\ndefault BIOS : SeaBIOS, \r\ndefault machine : i440fx,\r\ndefault SCSI controller : VirtIO SCSI,\r\nQEMU guest agent : enabled\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1118546318/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1118611156",
    "html_url": "https://github.com/sigp/lighthouse/issues/3169#issuecomment-1118611156",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3169",
    "id": 1118611156,
    "node_id": "IC_kwDOCFeAzc5CrKbU",
    "user": {
      "login": "GerardBri",
      "id": 83615406,
      "node_id": "MDQ6VXNlcjgzNjE1NDA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/83615406?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/GerardBri",
      "html_url": "https://github.com/GerardBri",
      "followers_url": "https://api.github.com/users/GerardBri/followers",
      "following_url": "https://api.github.com/users/GerardBri/following{/other_user}",
      "gists_url": "https://api.github.com/users/GerardBri/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/GerardBri/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/GerardBri/subscriptions",
      "organizations_url": "https://api.github.com/users/GerardBri/orgs",
      "repos_url": "https://api.github.com/users/GerardBri/repos",
      "events_url": "https://api.github.com/users/GerardBri/events{/privacy}",
      "received_events_url": "https://api.github.com/users/GerardBri/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-05T14:17:33Z",
    "updated_at": "2022-05-05T14:17:33Z",
    "author_association": "NONE",
    "body": "In addition, i have all the grafana dashboard with prometheus records\r\nsome captures here could help perhaps\r\n(we can see starting issue at **\\~ 05:20** (03:30 in UTC logs) and the purge db / restart at **\\~ 11:00*\r\n\r\n![screen_2022-05-05 16-03-10](https://user-images.githubusercontent.com/83615406/166942987-c275c1a3-ec40-45c4-b7f1-64680658279e.png)\r\n![screen_2022-05-05 16-05-23](https://user-images.githubusercontent.com/83615406/166943218-e980719e-fbd3-43fe-9723-b9caf83423f2.png)\r\n![screen_2022-05-05 16-05-02](https://user-images.githubusercontent.com/83615406/166943311-87a52168-c641-445f-86bf-77db5ce5ff87.png)\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1118611156/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1119158333",
    "html_url": "https://github.com/sigp/lighthouse/issues/3169#issuecomment-1119158333",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3169",
    "id": 1119158333,
    "node_id": "IC_kwDOCFeAzc5CtQA9",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-06T00:20:49Z",
    "updated_at": "2022-05-06T00:20:49Z",
    "author_association": "MEMBER",
    "body": "Hi @GerardBri,\r\n\r\nThere's definitely something very unusual going on with your node. This is the sort of issue we only see a handful of times per year, and usually it's very difficult to get to the root cause.\r\n\r\nSome basic things to start with:\r\n\r\n1. Try running a memory test within the VM. You could use [memtester](https://linux.die.net/man/8/memtester), or the memory-intensive mode of [Prime95](https://www.mersenne.org/download/). Instructions on how to run them are available online.\r\n2. Try running a memory test on the host. The best tool for testing memory is [Memtest86+](https://www.memtest.org/), which needs to be booted directly (you could maybe try running it in the VM, but I think you'd get better results running it on the host).\r\n3. Check the integrity of your filesystems using `fsck`.\r\n\r\nIf none of the above show any issues, then we can start digging into more exotic causes. We've seen a similar issue in the past caused by a bug in Proxmox VM's handling of native instructions. You could try disabling all native instruction flags in your Proxmox VM settings, as shown [here](https://pve.proxmox.com/wiki/Qemu/KVM_Virtual_Machines#qm_cpu). In particular, the instruction we had issues with in the past was AES-NI, although I think your issues are more likely related to hashing ([SHA native instructions](https://en.wikipedia.org/wiki/Intel_SHA_extensions)) or signature verification (which uses ADX). You will need to use a [portable](https://lighthouse-book.sigmaprime.io/installation-binaries.html#portability) build of Lighthouse as well to retain compatibility with the basic CPU.\r\n\r\nLet us know if that helps, and we can go from there\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1119158333/reactions",
      "total_count": 3,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 3,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1121633844",
    "html_url": "https://github.com/sigp/lighthouse/issues/3169#issuecomment-1121633844",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3169",
    "id": 1121633844,
    "node_id": "IC_kwDOCFeAzc5C2sY0",
    "user": {
      "login": "GerardBri",
      "id": 83615406,
      "node_id": "MDQ6VXNlcjgzNjE1NDA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/83615406?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/GerardBri",
      "html_url": "https://github.com/GerardBri",
      "followers_url": "https://api.github.com/users/GerardBri/followers",
      "following_url": "https://api.github.com/users/GerardBri/following{/other_user}",
      "gists_url": "https://api.github.com/users/GerardBri/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/GerardBri/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/GerardBri/subscriptions",
      "organizations_url": "https://api.github.com/users/GerardBri/orgs",
      "repos_url": "https://api.github.com/users/GerardBri/repos",
      "events_url": "https://api.github.com/users/GerardBri/events{/privacy}",
      "received_events_url": "https://api.github.com/users/GerardBri/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-09T22:10:39Z",
    "updated_at": "2022-05-09T22:10:39Z",
    "author_association": "NONE",
    "body": "Thanks for your help @michaelsproul :pray: \r\nWell i've run `Memtest86+` on the host while 1 hour without any issues.\r\nSo i decided to check proxmox VM settings, and the cpu was set as a `host` cpu, so i've changed to default `kvm64`, we'll see if it's better in future\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1121633844/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1152937521",
    "html_url": "https://github.com/sigp/lighthouse/issues/3169#issuecomment-1152937521",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3169",
    "id": 1152937521,
    "node_id": "IC_kwDOCFeAzc5EuG4x",
    "user": {
      "login": "GerardBri",
      "id": 83615406,
      "node_id": "MDQ6VXNlcjgzNjE1NDA2",
      "avatar_url": "https://avatars.githubusercontent.com/u/83615406?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/GerardBri",
      "html_url": "https://github.com/GerardBri",
      "followers_url": "https://api.github.com/users/GerardBri/followers",
      "following_url": "https://api.github.com/users/GerardBri/following{/other_user}",
      "gists_url": "https://api.github.com/users/GerardBri/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/GerardBri/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/GerardBri/subscriptions",
      "organizations_url": "https://api.github.com/users/GerardBri/orgs",
      "repos_url": "https://api.github.com/users/GerardBri/repos",
      "events_url": "https://api.github.com/users/GerardBri/events{/privacy}",
      "received_events_url": "https://api.github.com/users/GerardBri/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-11T14:25:23Z",
    "updated_at": "2022-06-11T14:25:23Z",
    "author_association": "NONE",
    "body": "Hello there ! \r\nMy crash still occur :'( \r\n\r\nMy investigation was the following : \r\n- running `Memtest86+` :heavy_check_mark: \r\n- change the proxmox cpu type from `host` to default `kvm64` :heavy_check_mark: \r\n- use the portable version of lighthouse Lighthouse/v2.2.1-aa72088 :heavy_check_mark: \r\n\r\nBut i've got still the crash with this message **Peer sent invalid block in single block** :negative_squared_cross_mark: \r\n\r\n\r\nthe first lines of logs in the last boot :\r\n```\r\nMay 07 10:57:07 beacon-node-prod systemd[1]: Started eth2 beacon chain service.\r\nMay 07 10:57:08.120 INFO Logging to file                         path: \"/var/lib/lighthouse/beacon/logs/beacon.log\"\r\nMay 07 10:57:08.127 INFO Lighthouse started                      version: Lighthouse/v2.2.1-aa72088\r\nMay 07 10:57:08.127 INFO Configured for network                  name: mainnet\r\nMay 07 10:57:08.137 INFO Data directory initialised              datadir: /var/lib/lighthouse\r\nMay 07 10:57:08.137 WARN Running HTTP server on port 5052\r\nMay 07 10:57:08.137 INFO Deposit contract                        address: 0x00000000219ab540356cbb839cbe05303d7705fa, deploy_block: 11184524\r\nMay 07 10:57:11.229 INFO Hot-Cold DB initialized                 split_state: 0xcdd3dde3e88641dbef6eed69b19c5b8ae7d7b04d67b2a2344fb1bed682e3303a, split_slot: 3757984, service: freezer_db\r\nMay 07 10:57:11.389 INFO Starting beacon chain                   method: resume, service: beacon\r\nMay 07 10:57:50.606 INFO Block production enabled                method: json rpc via http, endpoints: [\"https://mainnet.infura.io/\", \"https://eth-mainnet.alchemyapi.io/\", \"https://nodes.mewapi.io/\", \"https://mainnet.eth.cloud.ava.do/\"]\r\nMay 07 10:57:52.244 INFO Beacon chain initialized                head_slot: 3758075, head_block: 0x214e‚Ä¶196c, head_state: 0x5c71‚Ä¶eee7, service: beacon\r\nMay 07 10:57:52.256 INFO Timer service started                   service: node_timer\r\nMay 07 10:57:52.257 INFO UPnP Attempting to initialise routes    service: UPnP\r\nMay 07 10:57:52.274 INFO Libp2p Starting                         bandwidth_config: 3-Average, peer_id: XXXXXXXXXXX, service: libp2p\r\nMay 07 10:57:52.285 INFO ENR Initialised                         tcp: Some(9000), udp: None, ip: None, id: 0x77ea..2a88, seq: 1020, enr: enr:-K-4QC....., service: libp2p\r\nMay 07 10:57:52.291 INFO Listening established                   address: /ip4/0.0.0.0/tcp/9000/p2p/XXXXXXXXXXX, service: libp2p\r\nMay 07 10:57:52.352 INFO HTTP API started                        listen_address: 127.0.0.1:5052\r\nMay 07 10:57:52.354 INFO Metrics HTTP server started             listen_address: 0.0.0.0:5054\r\nMay 07 10:57:52.979 INFO Sync state updated                      new_state: Synced, old_state: Stalled, service: sync\r\nMay 07 10:57:52.982 INFO Subscribed to topics                    topics: [\"/eth2/afcaaba0/beacon_block/ssz_snappy\", \"/eth2/afcaaba0/beacon_aggregate_and_proof/ssz_snappy\", \"/eth2/afcaaba0/voluntary_exit/ssz_snappy\", \"/eth2/afcaaba0/proposer_slashing/ssz_snappy\", \"/eth2/afcaaba0/attester_slashing/ssz_snappy\", \"/eth2/afcaaba0/sync_committee_contribution_and_proof/ssz_snappy\"], service: network\r\nMay 07 10:57:59.631 INFO Started monitoring validator            validator: XXXX, pubkey: 0x......, service: val_mon\r\nMay 07 10:58:02.350 INFO UPnP not available                      error: IO error: Resource temporarily unavailable (os error 11), service: UPnP\r\nMay 07 10:58:03.668 INFO New RPC block received                  hash: 0x1980‚Ä¶49af, slot: 3758076\r\nMay 07 10:58:05.001 INFO Synced                                  slot: 3758088, block:    ‚Ä¶  empty, epoch: 117440, finalized_epoch: 117437, finalized_root: 0xddbb‚Ä¶d294, exec_hash: n/a, peers: 9, service: slot_notifier\r\n```\r\n\r\nIn [journalctl-log-2022-06-11.txt](https://github.com/sigp/lighthouse/files/8884094/journalctl-log-2022-06-11.txt), the first log of **Peer sent invalid block in single block lookup** occurs at **07:24:01.338** \r\n\r\nThen the process crash with \r\n**CRIT Beacon block processing error           error: DBError(SszDecodeError(OffsetsAreDecreasing(4125900))), service: beacon**\r\n\r\nI've added the `$datadir/beacon/logs/beacon.log` in the same time window\r\n\r\n[detailed-beacon.log](https://github.com/sigp/lighthouse/files/8884095/detailed-beacon.log)\r\n\r\nthis issue is annoying because, i've had to purge the db everytime\r\nThanks for your help !\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1152937521/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1243386916",
    "html_url": "https://github.com/sigp/lighthouse/issues/3169#issuecomment-1243386916",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3169",
    "id": 1243386916,
    "node_id": "IC_kwDOCFeAzc5KHJQk",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-12T08:24:03Z",
    "updated_at": "2022-09-12T08:24:03Z",
    "author_association": "MEMBER",
    "body": "I'm closing this one due to inactivity, please feel free to re-open if the issue persists.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1243386916/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
