{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3416",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3416/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3416/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3416/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3416",
  "id": 1326548943,
  "node_id": "I_kwDOCFeAzc5PEYfP",
  "number": 3416,
  "title": "Validator registrations on non-builder BNs",
  "user": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3743113288,
      "node_id": "LA_kwDOCFeAzc7fG2BI",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/bellatrix",
      "name": "bellatrix",
      "color": "A906A4",
      "default": false,
      "description": "Required to support the Bellatrix Upgrade"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "realbigsean",
    "id": 5160426,
    "node_id": "MDQ6VXNlcjUxNjA0MjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5160426?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/realbigsean",
    "html_url": "https://github.com/realbigsean",
    "followers_url": "https://api.github.com/users/realbigsean/followers",
    "following_url": "https://api.github.com/users/realbigsean/following{/other_user}",
    "gists_url": "https://api.github.com/users/realbigsean/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/realbigsean/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/realbigsean/subscriptions",
    "organizations_url": "https://api.github.com/users/realbigsean/orgs",
    "repos_url": "https://api.github.com/users/realbigsean/repos",
    "events_url": "https://api.github.com/users/realbigsean/events{/privacy}",
    "received_events_url": "https://api.github.com/users/realbigsean/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "realbigsean",
      "id": 5160426,
      "node_id": "MDQ6VXNlcjUxNjA0MjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5160426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/realbigsean",
      "html_url": "https://github.com/realbigsean",
      "followers_url": "https://api.github.com/users/realbigsean/followers",
      "following_url": "https://api.github.com/users/realbigsean/following{/other_user}",
      "gists_url": "https://api.github.com/users/realbigsean/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/realbigsean/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/realbigsean/subscriptions",
      "organizations_url": "https://api.github.com/users/realbigsean/orgs",
      "repos_url": "https://api.github.com/users/realbigsean/repos",
      "events_url": "https://api.github.com/users/realbigsean/events{/privacy}",
      "received_events_url": "https://api.github.com/users/realbigsean/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-08-03T00:56:29Z",
  "updated_at": "2022-08-19T19:37:46Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nThere might exist a setup where a VC has two BNs:\r\n\r\n- BN A: Uses a `--builder`.\r\n- BN B: Does not use a `--builder`.\r\n\r\nIf BN A goes down, the VC will switch to BN_B and then start to publish validator registrations. However, that will fail and we'll get the following log:\r\n\r\n```\r\nERRO Unable to publish validator registrations to the builder network, error: All endpoints failed https://BN_B => RequestFailed(ServerMessage(ErrorMessage { code: 500, message: \"UNHANDLED_ERROR: BuilderMissing\", stacktraces: [] })), https://XXXX/ => Unavailable(Offline), [omitted]\r\n```\r\n\r\nThis will cause the VC to set the BN as \"offline\". It might be nice to try and handle this differently, it seems like a very sane setup. Suggestions:\r\n\r\n1. Don't let the VC mark the BN as offline if the registrations fail, downgrade the severity of the logs.\r\n2. Define some other handling in the BN (e.g., return a specific HTTP error code) and then handle that in the VC.\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3416/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3416/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1210855588",
    "html_url": "https://github.com/sigp/lighthouse/issues/3416#issuecomment-1210855588",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3416",
    "id": 1210855588,
    "node_id": "IC_kwDOCFeAzc5ILDCk",
    "user": {
      "login": "realbigsean",
      "id": 5160426,
      "node_id": "MDQ6VXNlcjUxNjA0MjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5160426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/realbigsean",
      "html_url": "https://github.com/realbigsean",
      "followers_url": "https://api.github.com/users/realbigsean/followers",
      "following_url": "https://api.github.com/users/realbigsean/following{/other_user}",
      "gists_url": "https://api.github.com/users/realbigsean/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/realbigsean/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/realbigsean/subscriptions",
      "organizations_url": "https://api.github.com/users/realbigsean/orgs",
      "repos_url": "https://api.github.com/users/realbigsean/repos",
      "events_url": "https://api.github.com/users/realbigsean/events{/privacy}",
      "received_events_url": "https://api.github.com/users/realbigsean/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-10T15:21:28Z",
    "updated_at": "2022-08-10T15:21:28Z",
    "author_association": "COLLABORATOR",
    "body": "Agree we definitely shouldn't be marking the BN as offline.. seems like a bug (my bad). For a log level I think we would want at least a `WARN` because this could be misconfiguration of the backup node. \r\n\r\nI'm guessing this `WARN` would most frequently be annoying with Infura as a backup, but with the merge an Infura shouldn't be used as a backup anymore anyways.\r\n\r\nI'm not sure this case should warrant a specific error code because the BN can't serve what's requested. It'd probably be better for the VC to just request what it really wants. So the VC could have logic \"if I'm requesting a backup, don't use the builder API\" if this type of setup is preferred",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1210855588/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1211401364",
    "html_url": "https://github.com/sigp/lighthouse/issues/3416#issuecomment-1211401364",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3416",
    "id": 1211401364,
    "node_id": "IC_kwDOCFeAzc5INISU",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-10T23:30:58Z",
    "updated_at": "2022-08-10T23:31:17Z",
    "author_association": "MEMBER",
    "body": "> I'm guessing this WARN would most frequently be annoying with Infura as a backup, but with the merge an Infura shouldn't be used as a backup anymore anyways.\r\n\r\nI _think_ Infura are planning to continue supporting hosted BNs after the merge, so this may be quite common. Although I agree a WARN is fine.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1211401364/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1221033957",
    "html_url": "https://github.com/sigp/lighthouse/issues/3416#issuecomment-1221033957",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3416",
    "id": 1221033957,
    "node_id": "IC_kwDOCFeAzc5Ix3_l",
    "user": {
      "login": "realbigsean",
      "id": 5160426,
      "node_id": "MDQ6VXNlcjUxNjA0MjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5160426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/realbigsean",
      "html_url": "https://github.com/realbigsean",
      "followers_url": "https://api.github.com/users/realbigsean/followers",
      "following_url": "https://api.github.com/users/realbigsean/following{/other_user}",
      "gists_url": "https://api.github.com/users/realbigsean/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/realbigsean/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/realbigsean/subscriptions",
      "organizations_url": "https://api.github.com/users/realbigsean/orgs",
      "repos_url": "https://api.github.com/users/realbigsean/repos",
      "events_url": "https://api.github.com/users/realbigsean/events{/privacy}",
      "received_events_url": "https://api.github.com/users/realbigsean/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-19T19:37:46Z",
    "updated_at": "2022-08-19T19:37:46Z",
    "author_association": "COLLABORATOR",
    "body": "Mentioned in the linked PR, but I think adding a `--builder-beacon-nodes` flag might be the best way to fully support VC fallback from builder BN's to non-builder BN's.. what do you guys think of that type of thing?\r\n\r\nI'm not sure if we'd be teetering on too many config options to where it's not worth the complexity",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1221033957/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
