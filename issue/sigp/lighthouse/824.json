{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/824",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/824/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/824/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/824/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/824",
  "id": 553966073,
  "node_id": "MDU6SXNzdWU1NTM5NjYwNzM=",
  "number": 824,
  "title": "Slow API calls for slots that are not synced",
  "user": {
    "login": "pscott",
    "id": 30843220,
    "node_id": "MDQ6VXNlcjMwODQzMjIw",
    "avatar_url": "https://avatars.githubusercontent.com/u/30843220?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pscott",
    "html_url": "https://github.com/pscott",
    "followers_url": "https://api.github.com/users/pscott/followers",
    "following_url": "https://api.github.com/users/pscott/following{/other_user}",
    "gists_url": "https://api.github.com/users/pscott/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pscott/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pscott/subscriptions",
    "organizations_url": "https://api.github.com/users/pscott/orgs",
    "repos_url": "https://api.github.com/users/pscott/repos",
    "events_url": "https://api.github.com/users/pscott/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pscott/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2336800343,
      "node_id": "MDU6TGFiZWwyMzM2ODAwMzQz",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/HTTP-API",
      "name": "HTTP-API",
      "color": "5A63A2",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-01-23T06:37:37Z",
  "updated_at": "2020-09-29T05:50:02Z",
  "closed_at": "2020-09-29T05:50:02Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nSlow API calls when trying to fetch data about some slot that is not currently synced but smaller than the current slot (as provided by the slot_clock).\r\n\r\n## Present Behaviour\r\n\r\nWhen starting a fresh sync (no DB), the beacon node starts by syncing up the chain. Making an API call that asks for data that is not synced yet, but smaller than the current slot clock will make a call to `state_root_at_slot`, which will in turn start skipping slots until it gets to correct slot.\r\nhttps://github.com/sigp/lighthouse/blob/8c96739cab62b28d9646d3eb9f61445e81bc96fd/beacon_node/rest_api/src/helpers.rs#L207-L224\r\n\r\nThis can result in a very, very long API call (I personally witnessed a 19 minutes long API call).\r\nCorrect me if I'm wrong but by skipping slots we assume that they were skip slots (i.e they did not contain any block), so it makes the result invalid?\r\n\r\n\r\n## Expected Behaviour\r\n\r\nI see two options here:\r\n1. Return an error saying (slot is higher than current synced head)\r\n2. Keep our present behaviour but log some kind of warning, so that the user knows what's happening.\r\n\r\n## Steps to resolve\r\n\r\nChoose an option, and implement it, most probably in the piece of code linked earlier in this post.\r\n",
  "closed_by": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/824/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/824/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/700457726",
    "html_url": "https://github.com/sigp/lighthouse/issues/824#issuecomment-700457726",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/824",
    "id": 700457726,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwMDQ1NzcyNg==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-29T05:50:02Z",
    "updated_at": "2020-09-29T05:50:02Z",
    "author_association": "MEMBER",
    "body": "Resolved via #1569",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/700457726/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
