{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/2695",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/2695/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/2695/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/2695/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/2695",
  "id": 1021248074,
  "node_id": "I_kwDOCFeAzc483wJK",
  "number": 2695,
  "title": "thread 'tokio-runtime-worker' panicked ",
  "user": {
    "login": "kim201212",
    "id": 42402378,
    "node_id": "MDQ6VXNlcjQyNDAyMzc4",
    "avatar_url": "https://avatars.githubusercontent.com/u/42402378?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/kim201212",
    "html_url": "https://github.com/kim201212",
    "followers_url": "https://api.github.com/users/kim201212/followers",
    "following_url": "https://api.github.com/users/kim201212/following{/other_user}",
    "gists_url": "https://api.github.com/users/kim201212/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/kim201212/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/kim201212/subscriptions",
    "organizations_url": "https://api.github.com/users/kim201212/orgs",
    "repos_url": "https://api.github.com/users/kim201212/repos",
    "events_url": "https://api.github.com/users/kim201212/events{/privacy}",
    "received_events_url": "https://api.github.com/users/kim201212/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-10-08T16:00:35Z",
  "updated_at": "2021-10-19T02:38:01Z",
  "closed_at": "2021-10-19T00:23:54Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nPlease provide a brief description of the issue.\r\n```sh\r\nOct 08 15:23:59.588 INFO New block received                      hash: 0x21b083a9c70a56e5f26a03f492af08821d7d2fd09ccc582b8a39b388090b8cf1, slot: 2240218\r\nOct 08 15:24:05.001 INFO Synced                                  slot: 2240218, block: 0x21b0…8cf1, epoch: 70006, finalized_epoch: 70004, finalized_root: 0x0da1…85f5, peers: 50, service: slot_notifier\r\nOct 08 15:24:11.509 INFO New block received                      hash: 0x8b24e65b9bae465a932d1ad28e5443f5631deaca3386098817198904551fcef5, slot: 2240219\r\nOct 08 15:24:17.000 INFO Synced                                  slot: 2240219, block: 0x8b24…cef5, epoch: 70006, finalized_epoch: 70004, finalized_root: 0x0da1…85f5, peers: 50, service: slot_notifier\r\nOct 08 15:24:23.250 INFO New block received                      hash: 0x67e46e88d7ec7592561b5f60caada0032512a6d25c68d9212d2f8f930988b3d3, slot: 2240220\r\nOct 08 15:24:29.001 INFO Synced                                  slot: 2240220, block: 0x67e4…b3d3, epoch: 70006, finalized_epoch: 70004, finalized_root: 0x0da1…85f5, peers: 50, service: slot_notifier\r\nOct 08 15:24:36.120 INFO New block received                      hash: 0x692b430537bbf86471f3b8ac083b35abe8445742eb0a5d252b943f8b265be94c, slot: 2240221\r\nOct 08 15:24:41.000 INFO Synced                                  slot: 2240221, block: 0x692b…e94c, epoch: 70006, finalized_epoch: 70004, finalized_root: 0x0da1…85f5, peers: 51, service: slot_notifier\r\nOct 08 15:24:53.000 INFO Synced                                  slot: 2240222, block:    …  empty, epoch: 70006, finalized_epoch: 70004, finalized_root: 0x0da1…85f5, peers: 51, service: slot_notifier\r\nOct 08 15:24:59.702 INFO New block received                      hash: 0x6fc757e1e28625a2a6dcd177931be85956bd225861eea602a626a81739fc7b8c, slot: 2240223\r\nOct 08 15:25:05.000 INFO Synced                                  slot: 2240223, block: 0x6fc7…7b8c, epoch: 70006, finalized_epoch: 70004, finalized_root: 0x0da1…85f5, peers: 50, service: slot_notifier\r\nOct 08 15:25:14.242 INFO New block received                      hash: 0x272bef000b5d12be96de573c6629a7f38ab5cca6207bc9578a1b0c9d4bfa93fb, slot: 2240224\r\nOct 08 15:25:17.000 INFO Synced                                  slot: 2240224, block: 0x272b…93fb, epoch: 70007, finalized_epoch: 70005, finalized_root: 0x59a4…b065, peers: 49, service: slot_notifier\r\nthread 'tokio-runtime-worker' panicked at 'internal error: entered unreachable code: The node was removed and shouldn't already exist', /usr/local/cargo/git/checkouts/discv5-7af694118de5b208/10247bb/src/kbucket/bucket.rs:451:21\r\nstack backtrace:\r\n   0: rust_begin_unwind\r\n             at ./rustc/53cb7b09b00cbea8754ffb78e7e3cb521cb8af4b/library/std/src/panicking.rs:493:5\r\n   1: core::panicking::panic_fmt\r\n             at ./rustc/53cb7b09b00cbea8754ffb78e7e3cb521cb8af4b/library/core/src/panicking.rs:92:14\r\n   2: discv5::kbucket::bucket::KBucket<TNodeId,TVal>::update_status\r\n   3: discv5::kbucket::KBucketsTable<TNodeId,TVal>::update_node\r\n   4: discv5::service::Service::connection_updated\r\n   5: discv5::service::Service::handle_rpc_response\r\n   6: discv5::service::Service::spawn::{{closure}}::{{closure}}\r\n   7: <core::future::from_generator::GenFuture<T> as core::future::future::Future>::poll\r\n   8: <futures_util::future::select::Select<A,B> as core::future::future::Future>::poll\r\n   9: <futures_util::future::future::map::Map<Fut,F> as core::future::future::Future>::poll\r\n  10: <futures_util::future::future::flatten::Flatten<Fut,<Fut as core::future::future::Future>::Output> as core::future::future::Future>::poll\r\n  11: tokio::runtime::task::core::CoreStage<T>::poll\r\n  12: tokio::runtime::task::harness::Harness<T,S>::poll\r\n  13: std::thread::local::LocalKey<T>::with\r\n  14: tokio::runtime::thread_pool::worker::Context::run_task\r\n  15: tokio::runtime::thread_pool::worker::Context::run\r\n  16: tokio::macros::scoped_tls::ScopedKey<T>::set\r\n  17: tokio::runtime::thread_pool::worker::run\r\n  18: tokio::loom::std::unsafe_cell::UnsafeCell<T>::with_mut\r\n  19: tokio::runtime::task::harness::Harness<T,S>::poll\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\nOct 08 15:25:22.251 CRIT Task panic. This is a bug!              advice: Please check above for a backtrace and notify the developers, message: <none>, task_name: discv5\r\nOct 08 15:25:22.252 INFO Internal shutdown received              reason: Panic (fatal error)\r\nOct 08 15:25:22.252 INFO Shutting down..                         reason: Failure(\"Panic (fatal error)\")\r\nOct 08 15:25:22.255 INFO Saved DHT state                         service: network\r\nOct 08 15:25:22.255 INFO Network service shutdown                service: network\r\nOct 08 15:25:23.221 INFO Saved beacon chain to disk              service: beacon\r\nPanic (fatal error)\r\n```\r\n\r\n## Version\r\n\r\n```sh\r\n$ docker images\r\nREPOSITORY        TAG       IMAGE ID       CREATED       SIZE\r\nsigp/lighthouse   v2.0.0    ce4de80f03ca   3 days ago    196MB\r\n\r\n```\r\n\r\n## Present Behaviour\r\n\r\nBN stops any network activity and docker container stops.\r\n\r\n## Expected Behaviour\r\n\r\nBN performs network activity\r\n\r\n## Steps to resolve\r\n\r\nI restarted the stopped docker container.",
  "closed_by": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/2695/reactions",
    "total_count": 4,
    "+1": 3,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 1,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/2695/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/939142697",
    "html_url": "https://github.com/sigp/lighthouse/issues/2695#issuecomment-939142697",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2695",
    "id": 939142697,
    "node_id": "IC_kwDOCFeAzc43-i4p",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-08T22:10:43Z",
    "updated_at": "2021-10-08T22:15:33Z",
    "author_association": "MEMBER",
    "body": "Thank you for reporting this!\n\nThis is a known bug in `discv5` that has been very difficult to track down. It existed in releases prior to v2.0.0 but we had never been able to reproduce it.\n\nWith the logging and backtraces added in v2.0.0 we finally have some more diagnostic information. We'll work on fixing it ASAP for a v2.x release.\n\nIn the meantime you can work around the issue by configuring the BN to auto-restart if it exits (something like `restart: on-failure` in Docker). We believe that the bug can only occur rarely, but please let us know if it occurs repeatedly \n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/939142697/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/939628515",
    "html_url": "https://github.com/sigp/lighthouse/issues/2695#issuecomment-939628515",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2695",
    "id": 939628515,
    "node_id": "IC_kwDOCFeAzc44AZfj",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-11T02:30:48Z",
    "updated_at": "2021-10-11T02:30:48Z",
    "author_association": "MEMBER",
    "body": "Thanks for raising this! \r\nThese are exactly the logs we were chasing in order to narrow the issue down. \r\n\r\nIt has been resolved in: https://github.com/sigp/discv5/pull/89\r\n\r\nAnd I'll be propagating the updates into lighthouse in the next suite of network updates.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/939628515/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/946247805",
    "html_url": "https://github.com/sigp/lighthouse/issues/2695#issuecomment-946247805",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2695",
    "id": 946247805,
    "node_id": "IC_kwDOCFeAzc44Zph9",
    "user": {
      "login": "SeaMonkey82",
      "id": 20866869,
      "node_id": "MDQ6VXNlcjIwODY2ODY5",
      "avatar_url": "https://avatars.githubusercontent.com/u/20866869?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SeaMonkey82",
      "html_url": "https://github.com/SeaMonkey82",
      "followers_url": "https://api.github.com/users/SeaMonkey82/followers",
      "following_url": "https://api.github.com/users/SeaMonkey82/following{/other_user}",
      "gists_url": "https://api.github.com/users/SeaMonkey82/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SeaMonkey82/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SeaMonkey82/subscriptions",
      "organizations_url": "https://api.github.com/users/SeaMonkey82/orgs",
      "repos_url": "https://api.github.com/users/SeaMonkey82/repos",
      "events_url": "https://api.github.com/users/SeaMonkey82/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SeaMonkey82/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-18T23:34:17Z",
    "updated_at": "2021-10-18T23:34:17Z",
    "author_association": "NONE",
    "body": "Since the thread's still open, just in case additional logs are useful...\r\n\r\n```\r\nthread 'tokio-runtime-worker' panicked at 'internal error: entered unreachable code: The node was removed and shouldn't already exist', /home/seamonkey/.cargo/git/checkouts/discv5-7af694118de5b208/10247bb/src/kbucket/bucket.rs:451:21\r\nstack backtrace:\r\n   0: rust_begin_unwind\r\n             at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/std/src/panicking.rs:515:5\r\n   1: core::panicking::panic_fmt\r\n             at /rustc/a178d0322ce20e33eac124758e837cbd80a6f633/library/core/src/panicking.rs:92:14\r\n   2: discv5::kbucket::bucket::KBucket<TNodeId,TVal>::update_status\r\n   3: discv5::kbucket::KBucketsTable<TNodeId,TVal>::insert_or_update\r\n   4: discv5::service::Service::connection_updated\r\n   5: discv5::service::Service::inject_session_established\r\n   6: discv5::service::Service::spawn::{{closure}}::{{closure}}\r\n   7: <core::future::from_generator::GenFuture<T> as core::future::future::Future>::poll\r\n   8: <futures_util::future::select::Select<A,B> as core::future::future::Future>::poll\r\n   9: <futures_util::future::future::map::Map<Fut,F> as core::future::future::Future>::poll\r\n  10: <futures_util::future::future::flatten::Flatten<Fut,<Fut as core::future::future::Future>::Output> as core::future::future::Future>::poll\r\n  11: tokio::runtime::task::core::CoreStage<T>::poll\r\n  12: tokio::runtime::task::harness::Harness<T,S>::poll\r\n  13: std::thread::local::LocalKey<T>::with\r\n  14: tokio::runtime::thread_pool::worker::Context::run_task\r\n  15: tokio::runtime::thread_pool::worker::Context::run\r\n  16: tokio::macros::scoped_tls::ScopedKey<T>::set\r\n  17: tokio::runtime::thread_pool::worker::run\r\n  18: tokio::loom::std::unsafe_cell::UnsafeCell<T>::with_mut\r\n  19: tokio::runtime::task::harness::Harness<T,S>::poll\r\nnote: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.\r\nOct 18 07:05:44.579 WARN Discovery query failed                  error: ChannelFailed(\"channel closed\"), service: libp2p\r\nOct 18 07:05:44.581 CRIT Task panic. This is a bug!              advice: Please check above for a backtrace and notify the developers, message: <none>, task_name: discv5\r\nOct 18 07:05:44.582 INFO Internal shutdown received              reason: Panic (fatal error)\r\nOct 18 07:05:44.583 INFO Shutting down..                         reason: Failure(\"Panic (fatal error)\")\r\nOct 18 07:05:44.586 INFO Saved DHT state                         service: network\r\nOct 18 07:05:44.586 INFO Network service shutdown                service: network\r\nOct 18 07:05:45.636 INFO Saved beacon chain to disk              service: beacon\r\nPanic (fatal error)\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/946247805/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/946266154",
    "html_url": "https://github.com/sigp/lighthouse/issues/2695#issuecomment-946266154",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2695",
    "id": 946266154,
    "node_id": "IC_kwDOCFeAzc44ZuAq",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-19T00:23:54Z",
    "updated_at": "2021-10-19T00:23:54Z",
    "author_association": "MEMBER",
    "body": "@SeaMonkey82 Did you get that panic in a version prior to v2.0.1? It should be fixed now in v2.0.1\r\n\r\nI'll close this issue and we can re-open if it's still an issue in v2.0.1",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/946266154/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/946317451",
    "html_url": "https://github.com/sigp/lighthouse/issues/2695#issuecomment-946317451",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2695",
    "id": 946317451,
    "node_id": "IC_kwDOCFeAzc44Z6iL",
    "user": {
      "login": "SeaMonkey82",
      "id": 20866869,
      "node_id": "MDQ6VXNlcjIwODY2ODY5",
      "avatar_url": "https://avatars.githubusercontent.com/u/20866869?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/SeaMonkey82",
      "html_url": "https://github.com/SeaMonkey82",
      "followers_url": "https://api.github.com/users/SeaMonkey82/followers",
      "following_url": "https://api.github.com/users/SeaMonkey82/following{/other_user}",
      "gists_url": "https://api.github.com/users/SeaMonkey82/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/SeaMonkey82/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/SeaMonkey82/subscriptions",
      "organizations_url": "https://api.github.com/users/SeaMonkey82/orgs",
      "repos_url": "https://api.github.com/users/SeaMonkey82/repos",
      "events_url": "https://api.github.com/users/SeaMonkey82/events{/privacy}",
      "received_events_url": "https://api.github.com/users/SeaMonkey82/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-19T02:38:01Z",
    "updated_at": "2021-10-19T02:38:01Z",
    "author_association": "NONE",
    "body": "Got the error in 2.0.0.  Was just about to upgrade when I noticed my backup node had crashed.  I saw that it was fixed, but figured I'd go ahead and share the log just in case it might be useful - like if there were some variation in the details or root cause.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/946317451/reactions",
      "total_count": 3,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
