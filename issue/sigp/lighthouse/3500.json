{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3500",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3500/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3500/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3500/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3500",
  "id": 1348911007,
  "node_id": "I_kwDOCFeAzc5QZr-f",
  "number": 3500,
  "title": "invalid address-in-use error on macOS?",
  "user": {
    "login": "Sajjon",
    "id": 864410,
    "node_id": "MDQ6VXNlcjg2NDQxMA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/864410?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Sajjon",
    "html_url": "https://github.com/Sajjon",
    "followers_url": "https://api.github.com/users/Sajjon/followers",
    "following_url": "https://api.github.com/users/Sajjon/following{/other_user}",
    "gists_url": "https://api.github.com/users/Sajjon/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Sajjon/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Sajjon/subscriptions",
    "organizations_url": "https://api.github.com/users/Sajjon/orgs",
    "repos_url": "https://api.github.com/users/Sajjon/repos",
    "events_url": "https://api.github.com/users/Sajjon/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Sajjon/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 985647288,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODg=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/question",
      "name": "question",
      "color": "d876e3",
      "default": true,
      "description": "Further information is requested"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-08-24T06:02:48Z",
  "updated_at": "2022-10-28T02:57:01Z",
  "closed_at": "2022-10-28T02:57:00Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nI've updated to 1.10.21 of Geth and 3.0.0 of Lighthouse, I'm trying to launch lighthouse in two tabs (I used to run terminal tab with `lighthouse bn --staking` and one with `lighthouse vc`):\r\n\r\nI've launch `geth` with:\r\n\r\n```sh\r\ngeth --authrpc.addr localhost --authrpc.port 8551 --authrpc.vhosts localhost --authrpc.jwtsecret ~/Library/Ethereum/geth/jwtsecret\r\n```\r\n\r\nIm trying to launch lighthouse with\r\n\r\n```sh\r\n$ lighthouse \\\r\n    --network mainnet \\\r\n    beacon_node \\\r\n    --http \\\r\n    --execution-endpoint http://localhost:8551 \\\r\n    --execution-jwt ~/Library/Ethereum/geth/jwtsecret\r\n```\r\n\r\nBut this fails to launch, I get \"Address already in use\"\r\n\r\nError log\r\n\r\n```sh\r\nAug 24 05:59:17.425 INFO Logging to file                         path: \"/Users/sajjode/.lighthouse/mainnet/beacon/logs/beacon.log\"\r\nAug 24 05:59:17.425 INFO Lighthouse started                      version: Lighthouse/v3.0.0-18c61a5\r\nAug 24 05:59:17.425 INFO Configured for network                  name: mainnet\r\nAug 24 05:59:17.426 INFO Data directory initialised              datadir: /Users/sajjode/.lighthouse/mainnet\r\nAug 24 05:59:17.426 INFO Deposit contract                        address: 0x00000000219ab540356cbb839cbe05303d7705fa, deploy_block: 11184524\r\nAug 24 05:59:18.000 INFO Hot-Cold DB initialized                 split_state: 0x15f183efd9e1913422189059845b3f1c27f66706ce7de6b6b083f92a7d395f04, split_slot: 4541216, service: freezer_db\r\nAug 24 05:59:18.004 INFO Starting beacon chain                   method: resume, service: beacon\r\nAug 24 05:59:40.947 INFO Block production enabled                method: json rpc via http, endpoints: Auth { endpoint: \"http://localhost:8551/\", jwt_path: \"/Users/sajjode/Library/Ethereum/geth/jwtsecret\", jwt_id: None, jwt_version: None }\r\nAug 24 05:59:41.731 INFO Beacon chain initialized                head_slot: 4541305, head_block: 0x6c70…6300, head_state: 0xbf04…2601, service: beacon\r\nAug 24 05:59:41.731 INFO Timer service started                   service: node_timer\r\nAug 24 05:59:41.731 INFO UPnP Attempting to initialise routes    service: UPnP\r\nAug 24 05:59:41.732 INFO Libp2p Starting                         bandwidth_config: 3-Average, peer_id: 16Uiu2HAmRtGSa2BvqMnNgnaYXUF2uuDmKF63on9FiQ9gs5HpJpNb, service: libp2p\r\nAug 24 05:59:41.732 INFO ENR Initialised                         tcp: Some(9000), udp: None, ip: None, id: 0xea48..34fa, seq: 1116, enr: enr:-K-4QDECQXcKPYyqsLqibKBuiTy2aEJzJY42tABVNJBnlK_cHy_mRuca_XtHC824ZQMnHuTJKZMgvLxJ7HGOxSyj3vKCBFyHYXR0bmV0c4gAAAAAAAAAAIRldGgykK_Kq6ACAAAAADYCAAAAAACCaWSCdjSJc2VjcDI1NmsxoQPEjqy81DrLnQy26X787lqVCVcatsHDNUUZXbHRSSmsGIhzeW5jbmV0cwCDdGNwgiMo, service: libp2p\r\nAug 24 05:59:41.743 CRIT Failed to start beacon node             reason: Failed to start network: Error(Libp2p(Msg(\"Io(Os { code: 48, kind: AddrInUse, message: \\\"Address already in use\\\" })\")), State { next_error: None, backtrace: InternalBacktrace { backtrace: Some(   0: backtrace::capture::Backtrace::new_unresolved\r\n   1: error_chain::backtrace::imp::InternalBacktrace::new\r\n   2: <error_chain::State as core::default::Default>::default\r\n   3: <lighthouse_network::types::error::Error as core::convert::From<alloc::string::String>>::from\r\n   4: lighthouse_network::behaviour::Behaviour<AppReqId,TSpec>::new::{{closure}}\r\n   5: network::service::NetworkService<T>::start::{{closure}}\r\n   6: beacon_node::ProductionBeaconNode<E>::new::{{closure}}\r\n   7: futures_util::future::future::FutureExt::poll_unpin\r\n   8: <futures_util::future::select::Select<A,B> as core::future::future::Future>::poll\r\n   9: <futures_util::future::future::map::Map<Fut,F> as core::future::future::Future>::poll\r\n  10: <futures_util::future::future::flatten::Flatten<Fut,<Fut as core::future::future::Future>::Output> as core::future::future::Future>::poll\r\n  11: tokio::runtime::task::core::CoreStage<T>::poll\r\n  12: tokio::runtime::task::harness::Harness<T,S>::poll\r\n  13: std::thread::local::LocalKey<T>::with\r\n  14: tokio::runtime::thread_pool::worker::Context::run_task\r\n  15: tokio::runtime::thread_pool::worker::Context::run\r\n  16: tokio::macros::scoped_tls::ScopedKey<T>::set\r\n  17: tokio::runtime::thread_pool::worker::run\r\n  18: <tokio::runtime::blocking::task::BlockingTask<T> as core::future::future::Future>::poll\r\n  19: tokio::runtime::task::harness::Harness<T,S>::poll\r\n  20: tokio::runtime::blocking::pool::Inner::run\r\n  21: std::sys_common::backtrace::__rust_begin_short_backtrace\r\n  22: core::ops::function::FnOnce::call_once{{vtable.shim}}\r\n  23: <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once\r\n             at /rustc/4b91a6ea7258a947e59c6522cd5898e7c0a6a88f/library/alloc/src/boxed.rs:1951:9\r\n      <alloc::boxed::Box<F,A> as core::ops::function::FnOnce<Args>>::call_once\r\n             at /rustc/4b91a6ea7258a947e59c6522cd5898e7c0a6a88f/library/alloc/src/boxed.rs:1951:9\r\n      std::sys::unix::thread::Thread::new::thread_start\r\n             at /rustc/4b91a6ea7258a947e59c6522cd5898e7c0a6a88f/library/std/src/sys/unix/thread.rs:108:17\r\n  24: __pthread_deallocate\r\n) } })\r\nAug 24 05:59:41.743 INFO Internal shutdown received              reason: Failed to start beacon node\r\nAug 24 05:59:41.743 INFO Shutting down..                         reason: Failure(\"Failed to start beacon node\")\r\nAug 24 05:59:42.554 INFO Saved beacon chain to disk              service: beacon\r\nAug 24 05:59:51.732 INFO UPnP not available                      error: IO error: Resource temporarily unavailable (os error 35), service: UPnP\r\nFailed to start beacon node\r\n\r\n```\r\n\r\n## Version\r\n\r\nPlease provide your Lighthouse and Rust version. Are you building from\r\n`stable` or `unstable`, which commit?\r\nStable, 3.0.0, built locally in my Mac Mini M1,  commit is `18c61a5e8be3e54226a86a69b96f8f4f7fd790e4`\r\n\r\n## Present Behaviour\r\n\r\nFails to lauch\r\n\r\n## Expected Behaviour\r\n\r\nI expect to be able to launch lighthouse\r\n\r\n## Steps to resolve\r\n\r\nPlease describe the steps required to resolve this issue, if known.\r\n",
  "closed_by": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3500/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3500/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1225257875",
    "html_url": "https://github.com/sigp/lighthouse/issues/3500#issuecomment-1225257875",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3500",
    "id": 1225257875,
    "node_id": "IC_kwDOCFeAzc5JB_OT",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-24T06:29:29Z",
    "updated_at": "2022-08-24T06:29:29Z",
    "author_association": "MEMBER",
    "body": "If you're getting an address-already-in-use error then you've probably already got Lighthouse running in another tab somewhere. You can look for the process ID using `ps` like this:\r\n\r\n```\r\nps -aux | grep lighthouse\r\n```\r\n\r\ne.g. on my machine I have this:\r\n\r\n> michael   325153  217  2.0 12763716 1329500 pts/4 Sl+ 16:23   9:10 lighthouse bn --staking --subscribe-all-subnets --import-all-attestations\r\n\r\nIf you see a `lighthouse bn` process there (before you start Lighthouse in the current tab), then that means it's already running. You could try to find the tab where it's running or just kill the process by PID:\r\n\r\n```\r\nkill 325153\r\n```\r\n\r\nchange the PID to match the output from `ps`",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1225257875/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1225353073",
    "html_url": "https://github.com/sigp/lighthouse/issues/3500#issuecomment-1225353073",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3500",
    "id": 1225353073,
    "node_id": "IC_kwDOCFeAzc5JCWdx",
    "user": {
      "login": "Sajjon",
      "id": 864410,
      "node_id": "MDQ6VXNlcjg2NDQxMA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/864410?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Sajjon",
      "html_url": "https://github.com/Sajjon",
      "followers_url": "https://api.github.com/users/Sajjon/followers",
      "following_url": "https://api.github.com/users/Sajjon/following{/other_user}",
      "gists_url": "https://api.github.com/users/Sajjon/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Sajjon/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Sajjon/subscriptions",
      "organizations_url": "https://api.github.com/users/Sajjon/orgs",
      "repos_url": "https://api.github.com/users/Sajjon/repos",
      "events_url": "https://api.github.com/users/Sajjon/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Sajjon/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-24T08:12:28Z",
    "updated_at": "2022-08-24T08:12:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "@michaelsproul I did check for used ports with `lsof` and I killed all terminal windows and rebooted machine (I have **no** daemons setup to start when my Mac starts), so I'm pretty sure that was not the cause, why I opened this issue.\r\n\r\nWithout rebooting or anything, I downgraded Lighthouse to 2.5.1 and re-ran lighthouse, then it worked. So it feels like a regression bug, but I fully understand that I have not given you much to work with here... hmm. Might possibly be human error on my part!\r\n\r\nLet's see if anyone else has these issues.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1225353073/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1227900496",
    "html_url": "https://github.com/sigp/lighthouse/issues/3500#issuecomment-1227900496",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3500",
    "id": 1227900496,
    "node_id": "IC_kwDOCFeAzc5JMEZQ",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-26T01:00:27Z",
    "updated_at": "2022-08-26T01:00:27Z",
    "author_association": "MEMBER",
    "body": "@Sajjon You'll need to run v3.0.0 for the merge, do you get anything different when you change Lighthouse's port with e.g. `--port 9001`?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1227900496/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1227904220",
    "html_url": "https://github.com/sigp/lighthouse/issues/3500#issuecomment-1227904220",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3500",
    "id": 1227904220,
    "node_id": "IC_kwDOCFeAzc5JMFTc",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-26T01:05:39Z",
    "updated_at": "2022-08-26T01:05:39Z",
    "author_association": "MEMBER",
    "body": "If you could also send me the debug logs from `~.lighthouse/mainnet/beacon/logs/beacon.log` that would be helpful. I'm `@sproul#3907` on the Lighthouse Discord, or my email is `<firstname>@sigmaprime.io`.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1227904220/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1294383561",
    "html_url": "https://github.com/sigp/lighthouse/issues/3500#issuecomment-1294383561",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3500",
    "id": 1294383561,
    "node_id": "IC_kwDOCFeAzc5NJrnJ",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-28T02:57:00Z",
    "updated_at": "2022-10-28T02:57:00Z",
    "author_association": "MEMBER",
    "body": "Closing in favour of https://github.com/sigp/lighthouse/issues/2254 which has more detailed discussion about possible root causes.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1294383561/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
