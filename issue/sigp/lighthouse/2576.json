{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/2576",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/2576/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/2576/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/2576/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/2576",
  "id": 989601376,
  "node_id": "MDU6SXNzdWU5ODk2MDEzNzY=",
  "number": 2576,
  "title": "Improve handling of backfilling peers",
  "user": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-09-07T05:15:59Z",
  "updated_at": "2021-10-05T22:43:02Z",
  "closed_at": "2021-10-05T22:43:02Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nIf we are syncing and requesting blocks and run into a peer that is currently backfilling their blocks, they cannot respond to our request and will respond with `ResourceUnavailable`. \r\n\r\nCurrently, our behaviour is to simply disconnect and ban these peers for a day. They are of no use to us while we are syncing and the ban will prevent re-connections whilst they complete their backfill. Although this is probably the safest approach for our local node, it is not the best for a node that is backfillling. \r\n\r\nPotentially we want to take a more granular approach, where we create a new peer_sync_type, which informs the sync algorithms that the peer is currently backfilling. The sync algorithms could then exclude these peers when requesting batches, for a period of time, before re-trying them. We don't want to entirely let them off the hook, to prevent all nodes from just sending `ResourceUnavailable` to all our requests. So if they fail again after a period of time, we ban them. This approach would be less harsh for a backfilling node, as they will not be dropped for any range request they can't respond to. \r\n\r\nOverall, the granular approach may not be necessary (or even desired) however, because there may be little useful overlap between a syncing peer and a backfilling peer. A backfilling peer is mainly interested in historical blocks and gossipsub (a synced peer isn't connected to gossipsub and may not have all the historic blocks). A synced peer is interested in historic blocks and the backfilling peer doesn't have these. We may want to force the disconnect and ban for efficiency as these peers remaining connected is consuming an otherwise useful peer slot (for each of them). \r\n\r\n\r\n",
  "closed_by": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/2576/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/2576/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/934963781",
    "html_url": "https://github.com/sigp/lighthouse/issues/2576#issuecomment-934963781",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2576",
    "id": 934963781,
    "node_id": "IC_kwDOCFeAzc43umpF",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-05T22:43:02Z",
    "updated_at": "2021-10-05T22:43:02Z",
    "author_association": "MEMBER",
    "body": "Closing this because I don't think it needs to be pursued ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/934963781/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
