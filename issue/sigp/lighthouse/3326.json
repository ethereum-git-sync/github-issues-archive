{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3326",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3326/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3326/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3326/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3326",
  "id": 1301543775,
  "node_id": "I_kwDOCFeAzc5Nk_tf",
  "number": 3326,
  "title": "Avoid subscribing to all subnets with an optimistic head",
  "user": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 3743113288,
      "node_id": "LA_kwDOCFeAzc7fG2BI",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/bellatrix",
      "name": "bellatrix",
      "color": "A906A4",
      "default": false,
      "description": "Required to support the Bellatrix Upgrade"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": {
    "login": "pawanjay176",
    "id": 9890508,
    "node_id": "MDQ6VXNlcjk4OTA1MDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pawanjay176",
    "html_url": "https://github.com/pawanjay176",
    "followers_url": "https://api.github.com/users/pawanjay176/followers",
    "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
    "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
    "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
    "repos_url": "https://api.github.com/users/pawanjay176/repos",
    "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "pawanjay176",
      "id": 9890508,
      "node_id": "MDQ6VXNlcjk4OTA1MDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pawanjay176",
      "html_url": "https://github.com/pawanjay176",
      "followers_url": "https://api.github.com/users/pawanjay176/followers",
      "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
      "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
      "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
      "repos_url": "https://api.github.com/users/pawanjay176/repos",
      "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-07-12T05:07:17Z",
  "updated_at": "2022-07-27T04:47:30Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nThe BN can follow the beacon chain whilst the EE is syncing, this is called *optimistic sync*. A node has an *optimistic head* when the head of the beacon chain has not been verified by the EE because that EE is syncing. An optimistic head can be identified with:\r\n\r\n```rust\r\nhead_is_optimsitic = chain.canonical_head.head_execution_status().is_optimsitic()\r\n```\r\n\r\nWhen the head is optimistic, the BN cannot produce attestations since it would be unsafe to attest to a block that has not been fully verified.\r\n\r\nWhen a new BN+EE pair is started, we expect the BN to be checkpoint synced and to reach the beacon chain head in minutes. However, the EE needs to sync the entire chain; a process which might take hours or days. Presently, once the BN reaches the head and it has validators or uses the `--subscribe-all-subnets` flag it will start verifying all attestations and use significant CPU doing so. When the BN and EE are on the same host this might significantly slow down EE sync. Since the BN can't produce attestations whilst the EE is syncing, this seems unnecessary.\r\n\r\nI propose that we disable subnet subscriptions when the EE is syncing in a similar way to how we disable them whilst the BN is syncing.\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3326/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3326/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1181324070",
    "html_url": "https://github.com/sigp/lighthouse/issues/3326#issuecomment-1181324070",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3326",
    "id": 1181324070,
    "node_id": "IC_kwDOCFeAzc5GaZMm",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-12T05:15:37Z",
    "updated_at": "2022-07-12T05:15:37Z",
    "author_association": "MEMBER",
    "body": "We currently disable all gossipsub subscriptions whilst we are syncing. We call these `CoreTopics`. \r\n\r\nI guess if we are an aggregator for a subnet we should still subscribe to these subnets. I guess you're suggesting to just delay subscribing to the long-lived subnets and/or those included by `--subsribe-all-subnets`. \r\n\r\nWe are working on a new long-lived subnet subscription model, but its to be tested.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1181324070/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1182586744",
    "html_url": "https://github.com/sigp/lighthouse/issues/3326#issuecomment-1182586744",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3326",
    "id": 1182586744,
    "node_id": "IC_kwDOCFeAzc5GfNd4",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-12T23:13:14Z",
    "updated_at": "2022-07-12T23:13:14Z",
    "author_association": "MEMBER",
    "body": "> I guess if we are an aggregator for a subnet we should still subscribe to these subnets\r\n\r\nWe're not going to be an aggregator when we have an optimistic head either.\r\n\r\n> I guess you're suggesting to just delay subscribing to the long-lived subnets and/or those included by --subsribe-all-subnets.\r\n\r\nYep, I think that sounds right.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1182586744/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1196262084",
    "html_url": "https://github.com/sigp/lighthouse/issues/3326#issuecomment-1196262084",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3326",
    "id": 1196262084,
    "node_id": "IC_kwDOCFeAzc5HTYLE",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-27T04:47:27Z",
    "updated_at": "2022-07-27T04:47:27Z",
    "author_association": "MEMBER",
    "body": "I'm dropping the `v2.5.0` tag after a chat with @AgeManning. I think it's totally fine that this isn't in v2.5.0 and I wouldn't like to rush this or delay the release :relaxed: ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1196262084/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
