{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/2639",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/2639/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/2639/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/2639/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/2639",
  "id": 1008421987,
  "node_id": "I_kwDOCFeAzc48G0xj",
  "number": 2639,
  "title": "/eth/v1/validator/contribution_and_proofs rejecting input",
  "user": {
    "login": "mcdee",
    "id": 511384,
    "node_id": "MDQ6VXNlcjUxMTM4NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/511384?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mcdee",
    "html_url": "https://github.com/mcdee",
    "followers_url": "https://api.github.com/users/mcdee/followers",
    "following_url": "https://api.github.com/users/mcdee/following{/other_user}",
    "gists_url": "https://api.github.com/users/mcdee/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mcdee/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mcdee/subscriptions",
    "organizations_url": "https://api.github.com/users/mcdee/orgs",
    "repos_url": "https://api.github.com/users/mcdee/repos",
    "events_url": "https://api.github.com/users/mcdee/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mcdee/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-09-27T17:45:46Z",
  "updated_at": "2021-10-17T09:17:53Z",
  "closed_at": "2021-10-17T09:17:52Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\n/eth/v1/validator/contribution_and_proofs is rejecting an input which I believe is valid.\r\n\r\n## Version\r\n\r\n1.5.2\r\n\r\n## Present Behaviour\r\n\r\nAttempting to send a contribution and proof body, for example:\r\n\r\n```\r\n[\r\n  {\r\n    \"message\": {\r\n      \"aggregator_index\": \"231020\",\r\n      \"contribution\": {\r\n        \"slot\": \"1354636\",\r\n        \"beacon_block_root\": \"0x89fe35ad3aad99fdb96d48d06ca33d515443277278afd7c7388f43945e52703d\",\r\n        \"subcommittee_index\": \"2\",\r\n        \"aggregation_bits\": \"0xfeffffafe7ffffb7dfffbf7fffffffff\",\r\n        \"signature\": \"0x8fef3be0d0f56d5ac375eeb227b92b77816df13e2098ec4d4e9e771e9edae7757ffd1e024a5a0bb2e128cb9b2a9ae989071f0a16786a430bef2e7949c529b197e20ce0475f97021b08bb15e14aa882fa12bed1cfac78c66d3f5b7c272749f058\"\r\n      },\r\n      \"selection_proof\": \"0x950949aca6637d79d4e9e6544c7e1df3f3c128eef6674c0c8a6742680f5ba713579f7f29809ee0aefe9089da1349f4e315ccdfa89a47be6a86d4a03fe6b08ff7c8ee2ebce79f9cf907538af78b8407e001595e4b464935f26f60c297c1b60c95\"\r\n    },\r\n    \"signature\": \"0xaec70ea3927fb9afc87c77c3692b81ce41241c17f7839a7141fb3b8596accdc5c0e00b54e69b596c439bb00195006a2f0b77bbe34f456a5c763912360c16aa2194528e58dc5228704afae95cd0a63ae5e44edb997e22caf20bb739f55765c2a9\"\r\n  }\r\n]\r\n```\r\n\r\nreturns an error:\r\n\r\n```\r\n{\r\n  \"code\": 400,\r\n  \"message\": \"BAD_REQUEST: error processing contribution and proofs\",\r\n  \"failures\": [\r\n    {\r\n      \"index\": 0,\r\n      \"message\": \"Verification: InvalidSignature\"\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\n## Expected Behaviour\r\n\r\nAs far as I can tell, the contribution is valid and should be accepted.\r\n\r\n## Steps to resolve\r\n\r\nUnknown.  There is nothing in the lighthouse log that suggests why the signature is invalid, and local testing suggests that it is good (although it's all coming from the same codebase so a bad assumption could be carried across both the initial work and the testing):\r\n\r\n```\r\nValid data structure: ✓\r\nValidator known: ✓\r\nValidator in sync committee: ✓\r\nValidator is aggregator: ✓\r\nSignature has valid format: ✓\r\nSignature is valid: ✓\r\n```",
  "closed_by": {
    "login": "mcdee",
    "id": 511384,
    "node_id": "MDQ6VXNlcjUxMTM4NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/511384?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mcdee",
    "html_url": "https://github.com/mcdee",
    "followers_url": "https://api.github.com/users/mcdee/followers",
    "following_url": "https://api.github.com/users/mcdee/following{/other_user}",
    "gists_url": "https://api.github.com/users/mcdee/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mcdee/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mcdee/subscriptions",
    "organizations_url": "https://api.github.com/users/mcdee/orgs",
    "repos_url": "https://api.github.com/users/mcdee/repos",
    "events_url": "https://api.github.com/users/mcdee/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mcdee/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/2639/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/2639/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/928369304",
    "html_url": "https://github.com/sigp/lighthouse/issues/2639#issuecomment-928369304",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2639",
    "id": 928369304,
    "node_id": "IC_kwDOCFeAzc43VcqY",
    "user": {
      "login": "mcdee",
      "id": 511384,
      "node_id": "MDQ6VXNlcjUxMTM4NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/511384?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mcdee",
      "html_url": "https://github.com/mcdee",
      "followers_url": "https://api.github.com/users/mcdee/followers",
      "following_url": "https://api.github.com/users/mcdee/following{/other_user}",
      "gists_url": "https://api.github.com/users/mcdee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mcdee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mcdee/subscriptions",
      "organizations_url": "https://api.github.com/users/mcdee/orgs",
      "repos_url": "https://api.github.com/users/mcdee/repos",
      "events_url": "https://api.github.com/users/mcdee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mcdee/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-27T22:28:57Z",
    "updated_at": "2021-09-27T22:28:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "After more investigation I believe that another client may be returning a bad contribution.  Is it possible for the error message returned to be more explicit over which signature is failing verification?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/928369304/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/928441083",
    "html_url": "https://github.com/sigp/lighthouse/issues/2639#issuecomment-928441083",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2639",
    "id": 928441083,
    "node_id": "IC_kwDOCFeAzc43VuL7",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-27T23:30:47Z",
    "updated_at": "2021-09-27T23:30:47Z",
    "author_association": "MEMBER",
    "body": "> After more investigation I believe that another client may be returning a bad contribution. Is it possible for the error message returned to be more explicit over which signature is failing verification?\r\n\r\nUnfortunately not, it verifies them in a batch so we have no indication as to which signature is invalid.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/928441083/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/928863817",
    "html_url": "https://github.com/sigp/lighthouse/issues/2639#issuecomment-928863817",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2639",
    "id": 928863817,
    "node_id": "IC_kwDOCFeAzc43XVZJ",
    "user": {
      "login": "mcdee",
      "id": 511384,
      "node_id": "MDQ6VXNlcjUxMTM4NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/511384?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mcdee",
      "html_url": "https://github.com/mcdee",
      "followers_url": "https://api.github.com/users/mcdee/followers",
      "following_url": "https://api.github.com/users/mcdee/following{/other_user}",
      "gists_url": "https://api.github.com/users/mcdee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mcdee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mcdee/subscriptions",
      "organizations_url": "https://api.github.com/users/mcdee/orgs",
      "repos_url": "https://api.github.com/users/mcdee/repos",
      "events_url": "https://api.github.com/users/mcdee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mcdee/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-28T05:43:45Z",
    "updated_at": "2021-09-28T05:43:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "Sorry, that was unclear of my.  I meant the two separate signatures within the structure, the one within `contribution`and the one at the top level f the JSON, as opposed to the signatures that make up the contribution signature.  Or do you batch verify those two as well?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/928863817/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/928877391",
    "html_url": "https://github.com/sigp/lighthouse/issues/2639#issuecomment-928877391",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2639",
    "id": 928877391,
    "node_id": "IC_kwDOCFeAzc43XYtP",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-28T05:58:35Z",
    "updated_at": "2021-09-28T05:58:35Z",
    "author_association": "MEMBER",
    "body": "> Or do you batch verify those two as well?\r\n\r\nWe verify them all in one batch. I have commented out the sig sets one by one during debugging, you could try that if you want to isolate which signature is invalid in this specific instance (not sure if that's valuable info, I can do it for you if it would be):\r\n\r\nhttps://github.com/sigp/lighthouse/blob/f9bba92db3468321b28ddd9010e26b359f88bafe/beacon_node/beacon_chain/src/sync_committee_verification.rs#L582-L618",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/928877391/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/945078792",
    "html_url": "https://github.com/sigp/lighthouse/issues/2639#issuecomment-945078792",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2639",
    "id": 945078792,
    "node_id": "IC_kwDOCFeAzc44VMII",
    "user": {
      "login": "mcdee",
      "id": 511384,
      "node_id": "MDQ6VXNlcjUxMTM4NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/511384?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mcdee",
      "html_url": "https://github.com/mcdee",
      "followers_url": "https://api.github.com/users/mcdee/followers",
      "following_url": "https://api.github.com/users/mcdee/following{/other_user}",
      "gists_url": "https://api.github.com/users/mcdee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mcdee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mcdee/subscriptions",
      "organizations_url": "https://api.github.com/users/mcdee/orgs",
      "repos_url": "https://api.github.com/users/mcdee/repos",
      "events_url": "https://api.github.com/users/mcdee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mcdee/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-17T09:17:52Z",
    "updated_at": "2021-10-17T09:17:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "This is due to another client generating a bad contribution.  Lighthouse is correctly rejecting it, so closing this issue.  Thanks.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/945078792/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
