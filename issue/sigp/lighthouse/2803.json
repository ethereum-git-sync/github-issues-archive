{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/2803",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/2803/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/2803/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/2803/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/2803",
  "id": 1051599850,
  "node_id": "I_kwDOCFeAzc4-riPq",
  "number": 2803,
  "title": "Takes a while to update external IP",
  "user": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2336800125,
      "node_id": "MDU6TGFiZWwyMzM2ODAwMTI1",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/t%20Networking",
      "name": "t Networking",
      "color": "40E0D0",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-11-12T05:29:51Z",
  "updated_at": "2022-10-20T17:09:31Z",
  "closed_at": "2021-11-18T02:39:36Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nDiscovery keeps track of what our external IP address is based on responses from peers we have connected to. By default it keeps a  30 second history. It's very chatty and should talk to a lot of peers. \r\n\r\nBy default it takes at least 10 peers to agree on the same IP before we update our local ENR to match that external IP. This logic is here: https://github.com/sigp/discv5/blob/master/src/service/ip_vote.rs. \r\n\r\nAfter running on mainnet, i've noticed it takes like over a few mintues before the address gets updated. This is really suss considering discovery is very chatty and should talk to a number of peers pretty quickly. \r\n\r\nEvery pong response we get we count the vote: https://github.com/sigp/discv5/blob/master/src/service.rs#L772\r\n\r\nIt could be natural, but it might be worth investigating why it is taking so long. Perhaps there is no issue here. Anyone interested in learning more discovery might want to pick up this task. \r\n\r\nYou can get discovery logs by running `lighthouse -l ...` with the `RUST_LOG=discv5=debug` environment variable.\r\n\r\n\r\n",
  "closed_by": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/2803/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/2803/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/972463245",
    "html_url": "https://github.com/sigp/lighthouse/issues/2803#issuecomment-972463245",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2803",
    "id": 972463245,
    "node_id": "IC_kwDOCFeAzc459pyN",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-18T02:39:36Z",
    "updated_at": "2021-11-18T02:39:36Z",
    "author_association": "MEMBER",
    "body": "This happens because in discv5 we only ping peers every 5 minutes. Therefore, our update will typically happen 5 mins after startup. \r\n\r\nThis used to be faster, however we changed the logic to prevent instantly pinging peers as it could allow attacks to connect to us an invoke a ping in an attempt to influence our IP. \r\n\r\nThe current settings take an initial  period of time to update our external IP, but once running it should be fine. As this is a safer approach, I dont think anything needs to be modified. \r\nWe could potentially ping peers that enter our local routing table, but its likely not a real issue at the moment.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/972463245/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
