{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/4172",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/4172/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/4172/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/4172/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/4172",
  "id": 1658723775,
  "node_id": "I_kwDOCFeAzc5i3h2_",
  "number": 4172,
  "title": "Validator `exit` command crashes for local testnet",
  "user": {
    "login": "john-risk-adigium",
    "id": 119842926,
    "node_id": "U_kgDOBySobg",
    "avatar_url": "https://avatars.githubusercontent.com/u/119842926?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/john-risk-adigium",
    "html_url": "https://github.com/john-risk-adigium",
    "followers_url": "https://api.github.com/users/john-risk-adigium/followers",
    "following_url": "https://api.github.com/users/john-risk-adigium/following{/other_user}",
    "gists_url": "https://api.github.com/users/john-risk-adigium/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/john-risk-adigium/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/john-risk-adigium/subscriptions",
    "organizations_url": "https://api.github.com/users/john-risk-adigium/orgs",
    "repos_url": "https://api.github.com/users/john-risk-adigium/repos",
    "events_url": "https://api.github.com/users/john-risk-adigium/events{/privacy}",
    "received_events_url": "https://api.github.com/users/john-risk-adigium/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-04-07T11:52:16Z",
  "updated_at": "2023-04-10T10:07:56Z",
  "closed_at": "2023-04-10T10:07:56Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nI started a local blockchain using geth and lighthouse and --testnet-dir. The chain has been in PoS and producing blocks for a few weeks.\r\nWhen I try to exit the validator, it crashes with the error `network should have valid genesis state: \"Genesis state is unknown\"`\r\n\r\n## Lighthouse commands used on this node\r\n\r\n- lighthouse **beacon** --testnet-dir ./data/testnet --datadir ./data/consensus/0 --http --eth1 --staking\r\n- lighthouse account validator **import** --testnet-dir ./data/testnet --datadir ./data/validator/0 --directory ./ValidatorKeys\r\n- lighthouse **validator** --testnet-dir ./data/testnet --datadir data/validator/0 --beacon-nodes http://localhost:5052 --suggested-fee-recipient 0x...\r\n- lighthouse account validator **exit** --testnet-dir ./data/testnet --beacon-node http://localhost:5052 --keystore ./keystore-... .json\r\n\r\n\r\n## Version\r\n\r\n- Lighthouse v3.5.0-0fb58a6 prebuilt binaries\r\n- Lighthouse v4.0.1-a53830f compiled, rustup 1.25.2 (17db695f1 2023-02-01), rustc 1.67.1 (d5a82bbd2 2023-02-07)\r\n\r\n\r\n## Present Behaviour\r\n\r\nWhen I try to exit the validator, using the command:\r\n```\r\nlighthouse --testnet-dir ./data/testnet account validator exit \\\r\n\t--datadir ./data/validator/0 --beacon-node http://localhost:5052 --keystore ../keystore-m_12381_3600_0_0_0-1673523562.json\r\n```\r\n\r\nit gives the following error:\r\n```\r\nthread 'main' panicked at 'network should have valid genesis state: \"Genesis state is unknown\"', /project/account_manager/src/validator/exit.rs:129:10\r\nstack backtrace:\r\n   0: rust_begin_unwind at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/std/src/panicking.rs:575:5\r\n   1: core::panicking::panic_fmt at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/core/src/panicking.rs:64:14\r\n   2: core::result::unwrap_failed at /rustc/d5a82bbd26e1ad8b7401f6a718a9c57c96905483/library/core/src/result.rs:1791:5\r\n\r\n   3: account_manager::validator::exit::publish_voluntary_exit::{{closure}}\r\n   4: account_manager::validator::exit::cli_run\r\n   5: account_manager::run\r\n   6: lighthouse::main::{{closure}}\r\n   7: lighthouse::main\r\n```\r\n\r\n## Expected Behaviour\r\n\r\nThe validator should start the exit process, and lighthouse exit command should not crash\r\n\r\n## Config.yaml\r\n\r\nCONFIG_NAME: mainnet\r\nPRESET_BASE: mainnet\r\n\r\nGENESIS_FORK_VERSION: \"0x00000000\"\r\nGENESIS_DELAY: \"10\"\r\nALTAIR_FORK_VERSION: \"0x01000000\"\r\nALTAIR_FORK_EPOCH: \"0\"\r\nBELLATRIX_FORK_VERSION: \"0x02000000\"\r\nBELLATRIX_FORK_EPOCH: \"1\"\r\n\r\nTERMINAL_TOTAL_DIFFICULTY: 32\r\nTERMINAL_BLOCK_HASH: \"0x0000000000000000000000000000000000000000000000000000000000000000\"\r\nTERMINAL_BLOCK_HASH_ACTIVATION_EPOCH: \"18446744073709551615\"\r\nMIN_GENESIS_ACTIVE_VALIDATOR_COUNT: \"8\"\r\nMIN_GENESIS_TIME: 1680856005\r\nDEPOSIT_CHAIN_ID: \"333333\"\r\nDEPOSIT_NETWORK_ID: \"333333\"\r\nDEPOSIT_CONTRACT_ADDRESS: \"0x92e51e9a023e33d98e23706d7e7e0d6bfc3523b5\"\r\n\r\nSAFE_SLOTS_TO_IMPORT_OPTIMISTICALLY: \"128\"\r\nSECONDS_PER_SLOT: \"12\"\r\nSECONDS_PER_ETH1_BLOCK: \"14\"\r\nMIN_VALIDATOR_WITHDRAWABILITY_DELAY: \"256\"\r\nSHARD_COMMITTEE_PERIOD: \"256\"\r\nETH1_FOLLOW_DISTANCE: \"10\"\r\nINACTIVITY_SCORE_BIAS: \"4\"\r\nINACTIVITY_SCORE_RECOVERY_RATE: \"16\"\r\nEJECTION_BALANCE: \"16000000000\"\r\nMIN_PER_EPOCH_CHURN_LIMIT: \"4\"\r\nCHURN_LIMIT_QUOTIENT: \"65536\"\r\nPROPOSER_SCORE_BOOST: \"40\"\r\n\r\n## Geth genesis.json\r\n\r\n{\r\n        \"config\": {\r\n                \"ChainName\": \"Oone Chain Testnet\",\r\n                \"chainId\": 333777,\r\n                \"consensus\": \"clique\",\r\n                \"homesteadBlock\": 0,\r\n                \"daoForkSupport\": true,\r\n                \"eip150Block\": 0,\r\n                \"eip150Hash\": \"0x0000000000000000000000000000000000000000000000000000000000000000\",\r\n                \"eip155Block\": 0,\r\n                \"eip158Block\": 0,\r\n                \"byzantiumBlock\": 0,\r\n                \"constantinopleBlock\": 0,\r\n                \"petersburgBlock\": 0,\r\n                \"istanbulBlock\": 0,\r\n                \"muirGlacierBlock\": 0,\r\n                \"berlinBlock\": 0,\r\n                \"londonBlock\": 0,\r\n                \"terminalBlockHash\": \"0x0000000000000000000000000000000000000000000000000000000000000000\",\r\n                \"arrowGlacierBlock\": 0,\r\n                \"grayGlacierBlock\": 0,\r\n                \"clique\": {\r\n                        \"period\": 5,\r\n                        \"epoch\": 30000\r\n                },\r\n                \"terminalTotalDifficulty\": 32\r\n        },\r\n        \"difficulty\": \"1\",\r\n        \"gasLimit\": \"30000000\",\r\n        \"extradata\": \"0x0000000000000000000000000000000000000000000000000000000000000000D1efaaC3a45A3af7521D336198c0fB3Ed9ddC4450000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000\",\r\n        \"alloc\": {\r\n...",
  "closed_by": {
    "login": "john-risk-adigium",
    "id": 119842926,
    "node_id": "U_kgDOBySobg",
    "avatar_url": "https://avatars.githubusercontent.com/u/119842926?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/john-risk-adigium",
    "html_url": "https://github.com/john-risk-adigium",
    "followers_url": "https://api.github.com/users/john-risk-adigium/followers",
    "following_url": "https://api.github.com/users/john-risk-adigium/following{/other_user}",
    "gists_url": "https://api.github.com/users/john-risk-adigium/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/john-risk-adigium/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/john-risk-adigium/subscriptions",
    "organizations_url": "https://api.github.com/users/john-risk-adigium/orgs",
    "repos_url": "https://api.github.com/users/john-risk-adigium/repos",
    "events_url": "https://api.github.com/users/john-risk-adigium/events{/privacy}",
    "received_events_url": "https://api.github.com/users/john-risk-adigium/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/4172/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/4172/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1500830989",
    "html_url": "https://github.com/sigp/lighthouse/issues/4172#issuecomment-1500830989",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4172",
    "id": 1500830989,
    "node_id": "IC_kwDOCFeAzc5ZdN0N",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-08T09:05:33Z",
    "updated_at": "2023-04-08T10:14:11Z",
    "author_association": "MEMBER",
    "body": "Is there a genesis.ssz in your testnet directory? That would fix this. I'm surprised you can run the `bn` without the genesis state",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1500830989/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 1,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1501637075",
    "html_url": "https://github.com/sigp/lighthouse/issues/4172#issuecomment-1501637075",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4172",
    "id": 1501637075,
    "node_id": "IC_kwDOCFeAzc5ZgSnT",
    "user": {
      "login": "john-risk-adigium",
      "id": 119842926,
      "node_id": "U_kgDOBySobg",
      "avatar_url": "https://avatars.githubusercontent.com/u/119842926?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/john-risk-adigium",
      "html_url": "https://github.com/john-risk-adigium",
      "followers_url": "https://api.github.com/users/john-risk-adigium/followers",
      "following_url": "https://api.github.com/users/john-risk-adigium/following{/other_user}",
      "gists_url": "https://api.github.com/users/john-risk-adigium/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/john-risk-adigium/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/john-risk-adigium/subscriptions",
      "organizations_url": "https://api.github.com/users/john-risk-adigium/orgs",
      "repos_url": "https://api.github.com/users/john-risk-adigium/repos",
      "events_url": "https://api.github.com/users/john-risk-adigium/events{/privacy}",
      "received_events_url": "https://api.github.com/users/john-risk-adigium/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-10T10:06:45Z",
    "updated_at": "2023-04-10T10:06:45Z",
    "author_association": "NONE",
    "body": "There is no genesis.ssz :)\r\n\r\nI generated the testnet folder using `lcli`, then used the testnet folder which contained `config.yaml, boot_enr.yaml and deploy_block.txt` to start beacons and validators.\r\n\r\nNow I created the genesis.ssz using `lcli eth1-genesis` and it solved my problem.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1501637075/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
