{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/2227",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/2227/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/2227/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/2227/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/2227",
  "id": 817005995,
  "node_id": "MDU6SXNzdWU4MTcwMDU5OTU=",
  "number": 2227,
  "title": "feature request - Add a way to remove the deposit data",
  "user": {
    "login": "Jayhem",
    "id": 14970226,
    "node_id": "MDQ6VXNlcjE0OTcwMjI2",
    "avatar_url": "https://avatars.githubusercontent.com/u/14970226?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Jayhem",
    "html_url": "https://github.com/Jayhem",
    "followers_url": "https://api.github.com/users/Jayhem/followers",
    "following_url": "https://api.github.com/users/Jayhem/following{/other_user}",
    "gists_url": "https://api.github.com/users/Jayhem/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Jayhem/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Jayhem/subscriptions",
    "organizations_url": "https://api.github.com/users/Jayhem/orgs",
    "repos_url": "https://api.github.com/users/Jayhem/repos",
    "events_url": "https://api.github.com/users/Jayhem/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Jayhem/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-02-26T03:26:01Z",
  "updated_at": "2021-03-01T06:30:14Z",
  "closed_at": "2021-03-01T06:30:14Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nIn some cases the deposit data gets corrupted when running the beacon with redundant eth1 endpoints. When this happens the beacon cannot recover, it would be useful to give the user an option to remove the deposit data via a flag/option.\r\n\r\n\r\n## Version\r\nLighthouse v1.1.3-46920a8\r\nBLS Library: blst\r\nSpecs: mainnet (true), minimal (false), v0.12.3 (false)\r\n\r\n\r\n## Present Behaviour\r\n\r\nThe only way to recover from this issue is to remove the whole database using the --remove-db flag. This 'solution' however means that in in addition to the deposit data, all of the eth2 data needs to be synchronized.\r\n\r\n## Expected Behaviour\r\nBy providing a way to reset/erase the eth1 deposit data, the beacon can be back to a running state faster than when deleting the whole database.\r\n\r\n## Steps to resolve\r\n\r\nn/a\r\n\r\nAdditional thoughts: obviously it would be better if the beacon was able to recover from a situation where there is a gap in deposits. It looks to me that switching from one endpoint to another was the trigger for this behavior in my case.",
  "closed_by": {
    "login": "pawanjay176",
    "id": 9890508,
    "node_id": "MDQ6VXNlcjk4OTA1MDg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pawanjay176",
    "html_url": "https://github.com/pawanjay176",
    "followers_url": "https://api.github.com/users/pawanjay176/followers",
    "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
    "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
    "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
    "repos_url": "https://api.github.com/users/pawanjay176/repos",
    "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/2227/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/2227/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/786388624",
    "html_url": "https://github.com/sigp/lighthouse/issues/2227#issuecomment-786388624",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2227",
    "id": 786388624,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NjM4ODYyNA==",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-26T03:36:47Z",
    "updated_at": "2021-02-26T03:36:47Z",
    "author_association": "MEMBER",
    "body": "I think the `--eth1-purge-cache` flag solves your problem? (`lighthouse bn --eth1-purge-cache`)\r\n\r\nAlthough I agree with your broad point that we should be able to recover from faulty Eth1 nodes more readily",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/786388624/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/786445133",
    "html_url": "https://github.com/sigp/lighthouse/issues/2227#issuecomment-786445133",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2227",
    "id": 786445133,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NjQ0NTEzMw==",
    "user": {
      "login": "pawanjay176",
      "id": 9890508,
      "node_id": "MDQ6VXNlcjk4OTA1MDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pawanjay176",
      "html_url": "https://github.com/pawanjay176",
      "followers_url": "https://api.github.com/users/pawanjay176/followers",
      "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
      "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
      "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
      "repos_url": "https://api.github.com/users/pawanjay176/repos",
      "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-26T06:35:46Z",
    "updated_at": "2021-02-26T06:35:46Z",
    "author_association": "MEMBER",
    "body": "Ideally, the eth1 syncing should recover (should stop logging `NonConsecutive` errors) once you point it to a correctly synced endpoint. If you haven't yet purged your eth1 cache with the `--eth1-purge-cache` option yet, it'd be helpful if you could send us the output from\r\n`curl localhost:5052/lighthouse/eth1/syncing`\r\n`curl localhost:5052/lighthouse/eth1/deposit_cache`",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/786445133/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/786756932",
    "html_url": "https://github.com/sigp/lighthouse/issues/2227#issuecomment-786756932",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2227",
    "id": 786756932,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4Njc1NjkzMg==",
    "user": {
      "login": "Jayhem",
      "id": 14970226,
      "node_id": "MDQ6VXNlcjE0OTcwMjI2",
      "avatar_url": "https://avatars.githubusercontent.com/u/14970226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Jayhem",
      "html_url": "https://github.com/Jayhem",
      "followers_url": "https://api.github.com/users/Jayhem/followers",
      "following_url": "https://api.github.com/users/Jayhem/following{/other_user}",
      "gists_url": "https://api.github.com/users/Jayhem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Jayhem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Jayhem/subscriptions",
      "organizations_url": "https://api.github.com/users/Jayhem/orgs",
      "repos_url": "https://api.github.com/users/Jayhem/repos",
      "events_url": "https://api.github.com/users/Jayhem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Jayhem/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-26T16:38:05Z",
    "updated_at": "2021-02-26T18:22:25Z",
    "author_association": "NONE",
    "body": "> \r\n> \r\n> Ideally, the eth1 syncing should recover (should stop logging `NonConsecutive` errors) once you point it to a correctly synced endpoint. If you haven't yet purged your eth1 cache with the `--eth1-purge-cache` option yet, it'd be helpful if you could send us the output from\r\n> `curl localhost:5052/lighthouse/eth1/syncing`\r\n> `curl localhost:5052/lighthouse/eth1/deposit_cache`\r\n\r\nI have erased the db and restarted a couple of days ago, so I cannot provide this info. \r\nI had it happen twice fairly quickly by simply having 2 remote eht1 endpoints configured, so maybe that is a configuration you would want to test out.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/786756932/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/787685600",
    "html_url": "https://github.com/sigp/lighthouse/issues/2227#issuecomment-787685600",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2227",
    "id": 787685600,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4NzY4NTYwMA==",
    "user": {
      "login": "pawanjay176",
      "id": 9890508,
      "node_id": "MDQ6VXNlcjk4OTA1MDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pawanjay176",
      "html_url": "https://github.com/pawanjay176",
      "followers_url": "https://api.github.com/users/pawanjay176/followers",
      "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
      "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
      "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
      "repos_url": "https://api.github.com/users/pawanjay176/repos",
      "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-01T06:30:14Z",
    "updated_at": "2021-03-01T06:30:14Z",
    "author_association": "MEMBER",
    "body": "> I had it happen twice fairly quickly by simply having 2 remote eht1 endpoints configured\r\n\r\nI have somehow never been able to replicate this issue locally, even with OE and Nethermind nodes as fallbacks.\r\n\r\nClosing this as we already have a way to remove deposit data, feel free to reopen :)",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/787685600/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
