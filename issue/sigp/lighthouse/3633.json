{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3633",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3633/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3633/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3633/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3633",
  "id": 1401753501,
  "node_id": "I_kwDOCFeAzc5TjQ-d",
  "number": 3633,
  "title": "Feature request for a more streamlined update process",
  "user": {
    "login": "uwuforever",
    "id": 49468408,
    "node_id": "MDQ6VXNlcjQ5NDY4NDA4",
    "avatar_url": "https://avatars.githubusercontent.com/u/49468408?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/uwuforever",
    "html_url": "https://github.com/uwuforever",
    "followers_url": "https://api.github.com/users/uwuforever/followers",
    "following_url": "https://api.github.com/users/uwuforever/following{/other_user}",
    "gists_url": "https://api.github.com/users/uwuforever/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/uwuforever/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/uwuforever/subscriptions",
    "organizations_url": "https://api.github.com/users/uwuforever/orgs",
    "repos_url": "https://api.github.com/users/uwuforever/repos",
    "events_url": "https://api.github.com/users/uwuforever/events{/privacy}",
    "received_events_url": "https://api.github.com/users/uwuforever/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-10-07T23:56:14Z",
  "updated_at": "2022-10-08T07:14:26Z",
  "closed_at": "2022-10-08T07:14:26Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "From https://stackoverflow.com/questions/1712033/replacing-a-running-executable-in-linux it should be possible to replace a running executable with `execve` without restarting it.\r\n\r\nThe update experience would be so nice if Lighthouse could detect if its binary has been overwritten with a new version, and either simply use execve to seamlessly switch over, or have an RPC API call that could trigger it. As a bonus this would avoid any missed attestations from the doppelganger protection, while being safer.\r\n\r\nAn update would then consist of just these 2 commands:\r\n\r\n1. Check for update: `cd ~/lighthouse && git pull && git checkout stable && make`\r\n2. Replace running lighthouse binary, keeping a copy just in case: `sudo mv $HOME/.cargo/bin/lighthouse /usr/local/bin/lighthouse -u -b -f --suffix=.old`",
  "closed_by": {
    "login": "uwuforever",
    "id": 49468408,
    "node_id": "MDQ6VXNlcjQ5NDY4NDA4",
    "avatar_url": "https://avatars.githubusercontent.com/u/49468408?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/uwuforever",
    "html_url": "https://github.com/uwuforever",
    "followers_url": "https://api.github.com/users/uwuforever/followers",
    "following_url": "https://api.github.com/users/uwuforever/following{/other_user}",
    "gists_url": "https://api.github.com/users/uwuforever/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/uwuforever/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/uwuforever/subscriptions",
    "organizations_url": "https://api.github.com/users/uwuforever/orgs",
    "repos_url": "https://api.github.com/users/uwuforever/repos",
    "events_url": "https://api.github.com/users/uwuforever/events{/privacy}",
    "received_events_url": "https://api.github.com/users/uwuforever/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3633/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3633/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1272192374",
    "html_url": "https://github.com/sigp/lighthouse/issues/3633#issuecomment-1272192374",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3633",
    "id": 1272192374,
    "node_id": "IC_kwDOCFeAzc5L1B12",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-08T01:40:47Z",
    "updated_at": "2022-10-08T01:40:47Z",
    "author_association": "MEMBER",
    "body": "I'm hesitant to add anything like this because I don't think it really offers a substantial UX improvement over restarting the binary manually. If we used `exec` to run the new binary it would _not_ bypass Lighthouse's startup sequence, whether that's doppelgänger protection (VC) or re-loading the database (BN). To do anything more sophisticated would be very complex – somehow keeping the in-memory structures from one version while switching to the new version would be very fraught, and would impose weird constraints on the kinds of changes we could make between versions. In other words, the only viable implementation would be equivalent to just `sudo systemctl restart lighthouse`, which is easily scripted.\n\nAs a workaround for starting the VC faster one can simply not use doppelgänger protection most of the time. Or we could add a doppelgänger protection mode which skips the actual checks unless the binary has been offline for more than N minutes.\n\nFor the BN we also have plans to speed up restarts by making the DB faster to re-load.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1272192374/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1272193100",
    "html_url": "https://github.com/sigp/lighthouse/issues/3633#issuecomment-1272193100",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3633",
    "id": 1272193100,
    "node_id": "IC_kwDOCFeAzc5L1CBM",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-08T01:45:24Z",
    "updated_at": "2022-10-08T01:45:24Z",
    "author_association": "MEMBER",
    "body": "This is the BN feature to improve startup times: https://github.com/sigp/lighthouse/issues/3505",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1272193100/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1272222053",
    "html_url": "https://github.com/sigp/lighthouse/issues/3633#issuecomment-1272222053",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3633",
    "id": 1272222053,
    "node_id": "IC_kwDOCFeAzc5L1JFl",
    "user": {
      "login": "uwuforever",
      "id": 49468408,
      "node_id": "MDQ6VXNlcjQ5NDY4NDA4",
      "avatar_url": "https://avatars.githubusercontent.com/u/49468408?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/uwuforever",
      "html_url": "https://github.com/uwuforever",
      "followers_url": "https://api.github.com/users/uwuforever/followers",
      "following_url": "https://api.github.com/users/uwuforever/following{/other_user}",
      "gists_url": "https://api.github.com/users/uwuforever/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/uwuforever/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/uwuforever/subscriptions",
      "organizations_url": "https://api.github.com/users/uwuforever/orgs",
      "repos_url": "https://api.github.com/users/uwuforever/repos",
      "events_url": "https://api.github.com/users/uwuforever/events{/privacy}",
      "received_events_url": "https://api.github.com/users/uwuforever/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-08T04:23:51Z",
    "updated_at": "2022-10-08T04:23:51Z",
    "author_association": "NONE",
    "body": "Ah okay, that's a lot less useful than I was expecting. I'm happy to just stick to manual restarts in that case.\r\n\r\nCould doppelganger protection detect that it was restarted on the same system? Maybe keep a copy of the last few attestations from this particular install in a temp file, so when the VC starts up again and detects the previous attestations, it can immediately confirm that there is no doppleganger risk ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1272222053/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
