{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/2157",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/2157/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/2157/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/2157/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/2157",
  "id": 786795713,
  "node_id": "MDU6SXNzdWU3ODY3OTU3MTM=",
  "number": 2157,
  "title": "Beacon-nodes optionally round-robin / random",
  "user": {
    "login": "joe-bowman",
    "id": 4323424,
    "node_id": "MDQ6VXNlcjQzMjM0MjQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4323424?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/joe-bowman",
    "html_url": "https://github.com/joe-bowman",
    "followers_url": "https://api.github.com/users/joe-bowman/followers",
    "following_url": "https://api.github.com/users/joe-bowman/following{/other_user}",
    "gists_url": "https://api.github.com/users/joe-bowman/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/joe-bowman/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/joe-bowman/subscriptions",
    "organizations_url": "https://api.github.com/users/joe-bowman/orgs",
    "repos_url": "https://api.github.com/users/joe-bowman/repos",
    "events_url": "https://api.github.com/users/joe-bowman/events{/privacy}",
    "received_events_url": "https://api.github.com/users/joe-bowman/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 985647284,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODQ=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/enhancement",
      "name": "enhancement",
      "color": "a2eeef",
      "default": true,
      "description": "New feature or request"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2021-01-15T10:44:59Z",
  "updated_at": "2022-03-23T13:47:30Z",
  "closed_at": "2021-01-19T06:31:30Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nCurrently beacon node redundancy is ordered (which is a sensible default when your setup has a primary node, and a second one for failover scenarios); but in a situation where you have multiple beacon nodes for redundancy, and multiple validator nodes dependent on these, random assignment of beacon nodes would be preferable.\r\n\r\nAn optional parameter --bn-randomize (or similar), that treats all BNs equally and queries any one of them, rather than always in order, would be useful for balancing load.\r\n\r\nIt might be simpler to implement if this random sorting of the BNs happens at each slot (so you're sticky to 1 node per slot); but each nodes will randomly choose a _different_ order to the others (if that makes sense).\r\n\r\n## Version\r\n1.0.5\r\n\r\n## Present Behaviour\r\n\r\nBN preference is ordered (as per docs)\r\n\r\n## Preferred Behaviour\r\n\r\nBN preference is (optionally) randomised\r\n\r\n## Steps to resolve\r\n\r\nN/A\r\n",
  "closed_by": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/2157/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/2157/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/761175521",
    "html_url": "https://github.com/sigp/lighthouse/issues/2157#issuecomment-761175521",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2157",
    "id": 761175521,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MTE3NTUyMQ==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-15T20:16:22Z",
    "updated_at": "2021-01-15T20:16:22Z",
    "author_association": "MEMBER",
    "body": "> but in a situation where you have multiple beacon nodes for redundancy, and multiple validator nodes dependent on these, random assignment of beacon nodes would be preferable.\r\n\r\nI'm not convinced of on this one. Adding random choice adds a significant amount of complexity to the validator client, a critical component that we like to keep simple.\r\n\r\nIf you want to spread your VCs across BNs, I would suggest doing so at the devops layer (i.e., change the ordering of the `--beacon-nodes` flag manually). That way the user has more control and the VC is simpler.\r\n\r\nIn regards to load-balancing VCs across BNs through random choice, I'm not really sure that's something worth baking into LH either. There's quite a few edge-cases with swapping between BNs, seeing as they might be on different heads. It's *safe* for a VC to swap around BNs as much as it likes, but I really don't think its going to be efficient. We'll eventually run into issues where one BN is a block ahead of the other at an epoch boundary, causing different shuffling and therefore inefficiencies/errors with attestation production.\r\n\r\nI'll leave this open for a bit to see if it gains a lot of interest, but my gut feeling is that this violates the KISS principle for the VC.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/761175521/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/761184698",
    "html_url": "https://github.com/sigp/lighthouse/issues/2157#issuecomment-761184698",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2157",
    "id": 761184698,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MTE4NDY5OA==",
    "user": {
      "login": "joe-bowman",
      "id": 4323424,
      "node_id": "MDQ6VXNlcjQzMjM0MjQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4323424?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/joe-bowman",
      "html_url": "https://github.com/joe-bowman",
      "followers_url": "https://api.github.com/users/joe-bowman/followers",
      "following_url": "https://api.github.com/users/joe-bowman/following{/other_user}",
      "gists_url": "https://api.github.com/users/joe-bowman/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/joe-bowman/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/joe-bowman/subscriptions",
      "organizations_url": "https://api.github.com/users/joe-bowman/orgs",
      "repos_url": "https://api.github.com/users/joe-bowman/repos",
      "events_url": "https://api.github.com/users/joe-bowman/events{/privacy}",
      "received_events_url": "https://api.github.com/users/joe-bowman/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-15T20:37:09Z",
    "updated_at": "2021-01-15T20:37:09Z",
    "author_association": "NONE",
    "body": "> change the ordering of the --beacon-nodes flag manually\r\n\r\nThis was going to be my fall back; just adds a bunch of complexity my end :+1: \r\n\r\n> Adding random choice adds a significant amount of complexity to the validator client, a critical component that we like to keep simple.\r\n\r\nDoes it not just require shuffling the endpoint Vector in /common/lib.rs (although I guess this has a similar impact on eth1 nodes, and we probably want to be able to randomise one exclusively of the other).",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/761184698/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/761894305",
    "html_url": "https://github.com/sigp/lighthouse/issues/2157#issuecomment-761894305",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2157",
    "id": 761894305,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MTg5NDMwNQ==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-17T22:47:53Z",
    "updated_at": "2021-01-17T22:48:15Z",
    "author_association": "MEMBER",
    "body": "> This was going to be my fall back; just adds a bunch of complexity my end +1\r\n\r\nYeah, I feel you. We use Ansible and had to deal with the assignment of VCs to BNs as well, it's a bit awkward. On our end we needed to ensure an even distribution, so randomness wouldn't work for us as there's a decent chance of a double-assignment.\r\n\r\n> Does it not just require shuffling the endpoint Vector in /common/lib.rs (although I guess this has a similar impact on eth1 nodes, and we probably want to be able to randomise one exclusively of the other).\r\n\r\nWe could shuffle the incoming list, but we'd still have the behaviour where the first in the shuffled list is used the majority of the time (or, all of the time, if everything works perfectly).\r\n\r\nYou know your use-case better than me, but I would be a little cautious about randomly shuffling the `--beacon-nodes` flag. Each time you reboot the setup you're going to end up with a different topology, I find this type of behaviour can become quite frustrating when troubleshooting.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/761894305/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/762632041",
    "html_url": "https://github.com/sigp/lighthouse/issues/2157#issuecomment-762632041",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2157",
    "id": 762632041,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2MjYzMjA0MQ==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-19T06:31:30Z",
    "updated_at": "2021-01-19T06:31:30Z",
    "author_association": "MEMBER",
    "body": "I'll close this for now, let me know if anyone really wants this feature.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/762632041/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/924063883",
    "html_url": "https://github.com/sigp/lighthouse/issues/2157#issuecomment-924063883",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2157",
    "id": 924063883,
    "node_id": "IC_kwDOCFeAzc43FBiL",
    "user": {
      "login": "dong77",
      "id": 1710087,
      "node_id": "MDQ6VXNlcjE3MTAwODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1710087?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dong77",
      "html_url": "https://github.com/dong77",
      "followers_url": "https://api.github.com/users/dong77/followers",
      "following_url": "https://api.github.com/users/dong77/following{/other_user}",
      "gists_url": "https://api.github.com/users/dong77/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dong77/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dong77/subscriptions",
      "organizations_url": "https://api.github.com/users/dong77/orgs",
      "repos_url": "https://api.github.com/users/dong77/repos",
      "events_url": "https://api.github.com/users/dong77/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dong77/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-21T14:49:36Z",
    "updated_at": "2021-09-21T14:53:32Z",
    "author_association": "NONE",
    "body": "I kinda do, but my setup is different:\r\n I have 4 BNs and 25 VCs. The 4 BNs are load-balanced via a k8s service, which means I only have one logical URI for `--beacon-nodes`. As of now, loads are routed to a fixed BN during a session and will switch to another one after 24 hours (k8s's longest session is 24 hours). My 2 ETH2 nodes are also behind a k8s service.\r\n\r\nI'm not sure what the impact will be, especially after 2520 and I'm concerned.\r\n\r\nCan we re-open this issue? ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/924063883/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1076396109",
    "html_url": "https://github.com/sigp/lighthouse/issues/2157#issuecomment-1076396109",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2157",
    "id": 1076396109,
    "node_id": "IC_kwDOCFeAzc5AKIBN",
    "user": {
      "login": "mrabino1",
      "id": 4902221,
      "node_id": "MDQ6VXNlcjQ5MDIyMjE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4902221?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mrabino1",
      "html_url": "https://github.com/mrabino1",
      "followers_url": "https://api.github.com/users/mrabino1/followers",
      "following_url": "https://api.github.com/users/mrabino1/following{/other_user}",
      "gists_url": "https://api.github.com/users/mrabino1/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mrabino1/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mrabino1/subscriptions",
      "organizations_url": "https://api.github.com/users/mrabino1/orgs",
      "repos_url": "https://api.github.com/users/mrabino1/repos",
      "events_url": "https://api.github.com/users/mrabino1/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mrabino1/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-03-23T13:47:30Z",
    "updated_at": "2022-03-23T13:47:30Z",
    "author_association": "NONE",
    "body": "\"I'm not convinced of on this one. Adding random choice adds a significant amount of complexity to the validator client, a critical component that we like to keep simple.\r\n\r\nIf you want to spread your VCs across BNs, I would suggest doing so at the devops layer (i.e., change the ordering of the --beacon-nodes flag manually). That way the user has more control and the VC is simpler.\"\r\n\r\nFWIW.. I am personally less interested in load-balancing on an continual basis.. but rather only if node1 has an outage.. that it would randomly stick with ONE option of node2 / node3 ... until there is another outage... ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1076396109/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
