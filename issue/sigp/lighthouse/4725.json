{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/4725",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/4725/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/4725/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/4725/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/4725",
  "id": 1891712262,
  "node_id": "I_kwDOCFeAzc5wwT0G",
  "number": 4725,
  "title": "Think about `broadcast_validation` in the context of blobs",
  "user": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1783740159,
      "node_id": "MDU6TGFiZWwxNzgzNzQwMTU5",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/security",
      "name": "security",
      "color": "d30ca8",
      "default": false,
      "description": ""
    },
    {
      "id": 2336800343,
      "node_id": "MDU6TGFiZWwyMzM2ODAwMzQz",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/HTTP-API",
      "name": "HTTP-API",
      "color": "5A63A2",
      "default": false,
      "description": ""
    },
    {
      "id": 4615284981,
      "node_id": "LA_kwDOCFeAzc8AAAABExeo9Q",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/deneb",
      "name": "deneb",
      "color": "B7BBEC",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-09-12T05:45:22Z",
  "updated_at": "2024-01-26T14:37:38Z",
  "closed_at": "2024-01-26T14:37:38Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nThe `broadcast_validation` flag exists during block publishing so that block builders/relays can guard against invalid and equivocating blocks, and halt publishing.\r\n\r\nThe addition of blobs in Deneb requires careful consideration to ensure that a malicious proposer does not gain any more avenues for tricking the relay into publishing an invalid/equivocating block.\r\n\r\nI think it's probably sufficient to just return the same kind of duplicate error that we return for blocks whenever the gossip cache for blobs is tripped, but want to just make a note of this so that we can revisit it properly.\r\n",
  "closed_by": {
    "login": "realbigsean",
    "id": 5160426,
    "node_id": "MDQ6VXNlcjUxNjA0MjY=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5160426?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/realbigsean",
    "html_url": "https://github.com/realbigsean",
    "followers_url": "https://api.github.com/users/realbigsean/followers",
    "following_url": "https://api.github.com/users/realbigsean/following{/other_user}",
    "gists_url": "https://api.github.com/users/realbigsean/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/realbigsean/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/realbigsean/subscriptions",
    "organizations_url": "https://api.github.com/users/realbigsean/orgs",
    "repos_url": "https://api.github.com/users/realbigsean/repos",
    "events_url": "https://api.github.com/users/realbigsean/events{/privacy}",
    "received_events_url": "https://api.github.com/users/realbigsean/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/4725/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/4725/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1814362332",
    "html_url": "https://github.com/sigp/lighthouse/issues/4725#issuecomment-1814362332",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4725",
    "id": 1814362332,
    "node_id": "IC_kwDOCFeAzc5sJPjc",
    "user": {
      "login": "jimmygchen",
      "id": 742762,
      "node_id": "MDQ6VXNlcjc0Mjc2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/742762?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimmygchen",
      "html_url": "https://github.com/jimmygchen",
      "followers_url": "https://api.github.com/users/jimmygchen/followers",
      "following_url": "https://api.github.com/users/jimmygchen/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimmygchen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimmygchen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimmygchen/subscriptions",
      "organizations_url": "https://api.github.com/users/jimmygchen/orgs",
      "repos_url": "https://api.github.com/users/jimmygchen/repos",
      "events_url": "https://api.github.com/users/jimmygchen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimmygchen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-16T12:39:19Z",
    "updated_at": "2023-11-16T12:43:35Z",
    "author_association": "MEMBER",
    "body": "@realbigsean if I understand correctly, this is no longer an issue as blobs are no longer signed after the blob inclusion proof changes ([spec](https://github.com/ethereum/consensus-specs/pull/3531))? ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1814362332/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1822195660",
    "html_url": "https://github.com/sigp/lighthouse/issues/4725#issuecomment-1822195660",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4725",
    "id": 1822195660,
    "node_id": "IC_kwDOCFeAzc5snH_M",
    "user": {
      "login": "pawanjay176",
      "id": 9890508,
      "node_id": "MDQ6VXNlcjk4OTA1MDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pawanjay176",
      "html_url": "https://github.com/pawanjay176",
      "followers_url": "https://api.github.com/users/pawanjay176/followers",
      "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
      "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
      "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
      "repos_url": "https://api.github.com/users/pawanjay176/repos",
      "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-11-22T06:38:58Z",
    "updated_at": "2023-11-22T06:38:58Z",
    "author_association": "MEMBER",
    "body": "@jimmygchen Not sure. Since each blob contains a `SignedBeaconBlockHeader`, it is possible that a builder can embed an equivocating block header into the sidecar. \r\nIt's also possible that the inclusion proof is invalid. \r\nSo there's still scope of the blobs being invalid/equivocating.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1822195660/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1859338866",
    "html_url": "https://github.com/sigp/lighthouse/issues/4725#issuecomment-1859338866",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4725",
    "id": 1859338866,
    "node_id": "IC_kwDOCFeAzc5u00Jy",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-12-18T00:12:11Z",
    "updated_at": "2023-12-18T00:12:11Z",
    "author_association": "MEMBER",
    "body": "I think our decision in #4995 is sensible. When `broadcast_validation=consensus_and_equivocation`:\r\n\r\n- Do not publish if the block's header is slashable wrt to any block header that has been seen on gossip on _either_ the block topic _or_ a blob topic.\r\n- Do not publish if the block's header is slashable wrt to a block fetched via RPC. Accomplished by this observation: https://github.com/sigp/lighthouse/blob/b0c374c1cabd7fd960b4dde9ec9b0b26a960ca0c/beacon_node/beacon_chain/src/block_verification.rs#L1244-L1248\r\n\r\nI think the only case we're missing is **blobs received via RPC**. As far as I can tell we never write these to `observed_blob_sidecars` because the only call to `observe_sidecar` is in `validate_blob_sidecar_for_gossip`. I also don't think we can guarantee that any blobs received on RPC have already had their block header added to `observed_block_producers` or `observed_blob_sidecars`? We trigger single blob RPC alongside single block RPC for events like unknown parent, etc, and can't guarantee that the blobs we get back necessarily match the block's header because A) we may not know the block header B) the peer may send us blobs with a mismatched block header (which is invalid, but still slashable).",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1859338866/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1912169347",
    "html_url": "https://github.com/sigp/lighthouse/issues/4725#issuecomment-1912169347",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4725",
    "id": 1912169347,
    "node_id": "IC_kwDOCFeAzc5x-WOD",
    "user": {
      "login": "realbigsean",
      "id": 5160426,
      "node_id": "MDQ6VXNlcjUxNjA0MjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5160426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/realbigsean",
      "html_url": "https://github.com/realbigsean",
      "followers_url": "https://api.github.com/users/realbigsean/followers",
      "following_url": "https://api.github.com/users/realbigsean/following{/other_user}",
      "gists_url": "https://api.github.com/users/realbigsean/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/realbigsean/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/realbigsean/subscriptions",
      "organizations_url": "https://api.github.com/users/realbigsean/orgs",
      "repos_url": "https://api.github.com/users/realbigsean/repos",
      "events_url": "https://api.github.com/users/realbigsean/events{/privacy}",
      "received_events_url": "https://api.github.com/users/realbigsean/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-26T14:37:38Z",
    "updated_at": "2024-01-26T14:37:38Z",
    "author_association": "COLLABORATOR",
    "body": "I think slashability is now well covered with https://github.com/sigp/lighthouse/pull/5033\r\n\r\nSo I'm going to close this",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1912169347/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
