{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/4773",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/4773/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/4773/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/4773/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/4773",
  "id": 1908636851,
  "node_id": "I_kwDOCFeAzc5xw3yz",
  "number": 4773,
  "title": "Lighthouse space usage - Increasing dramastically from 87GB to 430GB in 7 days",
  "user": {
    "login": "luarx",
    "id": 22997139,
    "node_id": "MDQ6VXNlcjIyOTk3MTM5",
    "avatar_url": "https://avatars.githubusercontent.com/u/22997139?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/luarx",
    "html_url": "https://github.com/luarx",
    "followers_url": "https://api.github.com/users/luarx/followers",
    "following_url": "https://api.github.com/users/luarx/following{/other_user}",
    "gists_url": "https://api.github.com/users/luarx/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/luarx/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/luarx/subscriptions",
    "organizations_url": "https://api.github.com/users/luarx/orgs",
    "repos_url": "https://api.github.com/users/luarx/repos",
    "events_url": "https://api.github.com/users/luarx/events{/privacy}",
    "received_events_url": "https://api.github.com/users/luarx/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-09-22T10:24:22Z",
  "updated_at": "2023-09-23T02:48:50Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nWe are running several Lighthouse clients and I have noticed that in 10% of them there are some ocassions were the volume usage is increased 5x in 7 days!\r\n\r\nMy temporal solution is about deleting the volume date and resync, after that the Lighthouse client is stable again. But some weeks later a different Lighthouse client repeats this weird behaviour...\r\n\r\n![image](https://github.com/sigp/lighthouse/assets/22997139/6f3e2156-8498-44f1-a1ec-c67f563ce2b3)\r\n\r\n\r\n## Version\r\nLighthouse v4.1.0 (docker image)\r\n\r\n## Present Behaviour\r\nThe volume usage increases 5x in 7 days\r\n\r\nParams:\r\n```\r\n          args: [\r\n              \"--debug-level=info\",\r\n              \"--datadir=/beacondata\",\r\n              \"--network=mainnet\",\r\n              \"beacon_node\",\r\n              \"--disable-enr-auto-update\",\r\n              \"--enr-address=127.0.0.1\",\r\n              \"--enr-tcp-port=9000\",\r\n              \"--enr-udp-port=9000\",\r\n              \"--port=9000\" ,\r\n              \"--discovery-port=9000\",\r\n              \"--eth1\",\r\n              \"--http\",\r\n              \"--http-address=0.0.0.0\",\r\n              \"--http-port=5052\",\r\n              \"--metrics\",\r\n              \"--metrics-address=0.0.0.0\",\r\n              \"--metrics-port=5054\",\r\n              \"--listen-address=0.0.0.0\",\r\n              \"--target-peers=100\",\r\n              \"--http-allow-sync-stalled\",\r\n              \"--disable-packet-filter\",\r\n              \"--execution-endpoint=http://localhost:9545\",\r\n              \"--jwt-secrets=/tmp/jwtsecret\",\r\n              \"--disable-deposit-contract-sync\",\r\n              \"--checkpoint-sync-url=https://beaconstate-mainnet.chainsafe.io\"\r\n              ]\r\n```\r\n\r\n## Expected Behaviour\r\nDo not increment so heavy the volume usage in a few days, at least some stable values\r\n\r\n## Steps to resolve\r\nDo not increment so heavy the volume usage in a few days\r\n\r\n\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/4773/reactions",
    "total_count": 2,
    "+1": 2,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/4773/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1731184696",
    "html_url": "https://github.com/sigp/lighthouse/issues/4773#issuecomment-1731184696",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4773",
    "id": 1731184696,
    "node_id": "IC_kwDOCFeAzc5nL8g4",
    "user": {
      "login": "luarx",
      "id": 22997139,
      "node_id": "MDQ6VXNlcjIyOTk3MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/22997139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luarx",
      "html_url": "https://github.com/luarx",
      "followers_url": "https://api.github.com/users/luarx/followers",
      "following_url": "https://api.github.com/users/luarx/following{/other_user}",
      "gists_url": "https://api.github.com/users/luarx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luarx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luarx/subscriptions",
      "organizations_url": "https://api.github.com/users/luarx/orgs",
      "repos_url": "https://api.github.com/users/luarx/repos",
      "events_url": "https://api.github.com/users/luarx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luarx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-22T10:27:01Z",
    "updated_at": "2023-09-22T10:27:01Z",
    "author_association": "NONE",
    "body": "Another screenshot of a different Ligthouse client that is using the same version and same params.\r\nLook how the space was stable again after deleting the volume data and resyncing\r\n\r\n![image](https://github.com/sigp/lighthouse/assets/22997139/07a3d818-0271-4a09-a8bd-c4e5fe51e647)\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1731184696/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1731407424",
    "html_url": "https://github.com/sigp/lighthouse/issues/4773#issuecomment-1731407424",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4773",
    "id": 1731407424,
    "node_id": "IC_kwDOCFeAzc5nMy5A",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-22T13:20:25Z",
    "updated_at": "2023-09-22T13:23:00Z",
    "author_association": "MEMBER",
    "body": "If you still have any oversized nodes (or if it happens again) you can try:\n\nRunning `du -sh freezer_db chain_db` in the `$datadir/beacon`. I suspect it's the chain_db that's bloated.\n\nIf it is, you can try running `lighthouse db inspect --column ste --data /your/datadir` to see if the beacon state storage is the culprit (I suspect it is).\n\nWe haven't identified the bug that causes this, but have had a few reports of it. The database schema is getting completely overhauled in a few versions time, with a new system that prunes states more aggressively and so far has not shown any signs of blowing up in the same way (see the tree states releases if you're curious).\n\nStill, if we find the bug in the current DB it would be nice to fix it. Debug logs from an affected node would be helpful (DM me on Discord `@sproul`, or email me: michael at sigmaprime dot io)",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1731407424/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1731503130",
    "html_url": "https://github.com/sigp/lighthouse/issues/4773#issuecomment-1731503130",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4773",
    "id": 1731503130,
    "node_id": "IC_kwDOCFeAzc5nNKQa",
    "user": {
      "login": "luarx",
      "id": 22997139,
      "node_id": "MDQ6VXNlcjIyOTk3MTM5",
      "avatar_url": "https://avatars.githubusercontent.com/u/22997139?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/luarx",
      "html_url": "https://github.com/luarx",
      "followers_url": "https://api.github.com/users/luarx/followers",
      "following_url": "https://api.github.com/users/luarx/following{/other_user}",
      "gists_url": "https://api.github.com/users/luarx/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/luarx/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/luarx/subscriptions",
      "organizations_url": "https://api.github.com/users/luarx/orgs",
      "repos_url": "https://api.github.com/users/luarx/repos",
      "events_url": "https://api.github.com/users/luarx/events{/privacy}",
      "received_events_url": "https://api.github.com/users/luarx/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-22T14:17:36Z",
    "updated_at": "2023-09-22T14:21:34Z",
    "author_association": "NONE",
    "body": "Sure! I still have that node oversized to help to debug this issue\r\n\r\nHere you are the results that you have asked for:\r\n```\r\ndu -sh freezer_db chain_db\r\n5.3G\tfreezer_db\r\n432G\tchain_db\r\n```\r\n\r\nI do not know if I am executing correctly this second one:\r\n```\r\nlighthouse db inspect --column ste --datadir beacondata/\r\nSep 22 14:08:26.602 INFO Running database manager for mainnet network\r\nFatal error: DBError { message: \"Error { message: \\\"IO error: lock beacondata/beacon/freezer_db/LOCK: Resource temporarily unavailable\\\" }\" }\r\n```\r\n\r\nPerfect, I will contact you in Discord",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1731503130/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1732189936",
    "html_url": "https://github.com/sigp/lighthouse/issues/4773#issuecomment-1732189936",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4773",
    "id": 1732189936,
    "node_id": "IC_kwDOCFeAzc5nPx7w",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-23T02:48:49Z",
    "updated_at": "2023-09-23T02:48:49Z",
    "author_association": "MEMBER",
    "body": "Looks like you've got the command right but need to just stop the BN while you run it. It will produce quite a lot of output so you might also want to pipe it to a file\n\nI'm afk from Discord for the weekend but will get in touch Monday :)",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1732189936/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
