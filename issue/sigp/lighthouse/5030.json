{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/5030",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/5030/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/5030/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/5030/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/5030",
  "id": 2063027839,
  "node_id": "I_kwDOCFeAzc56905_",
  "number": 5030,
  "title": "Compress blobs on disk?",
  "user": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1999784343,
      "node_id": "MDU6TGFiZWwxOTk5Nzg0MzQz",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/optimization",
      "name": "optimization",
      "color": "f9de40",
      "default": false,
      "description": "Something to make Lighthouse run more efficiently."
    },
    {
      "id": 2336798682,
      "node_id": "MDU6TGFiZWwyMzM2Nzk4Njgy",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/database",
      "name": "database",
      "color": "C01C9D",
      "default": false,
      "description": ""
    },
    {
      "id": 4615284981,
      "node_id": "LA_kwDOCFeAzc8AAAABExeo9Q",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/deneb",
      "name": "deneb",
      "color": "B7BBEC",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2024-01-02T22:29:43Z",
  "updated_at": "2024-01-02T22:54:41Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nI've think that blobs may compress up to ~50%, which would be a nice disk saving. Seeing as we're so close to Deneb on Goerli I think this will have to be a post-fork schema upgrade (v19).\r\n\r\n## Steps to resolve\r\n\r\nWe'll need to change the signatures of `as_store_bytes` and `as_kv_store_op` to return `Result`, because compression is (usually) fallible. I've already done this on `tree-states` where lots of things are compressed with `zstd`:\r\n\r\nhttps://github.com/sigp/lighthouse/blob/c8dc082ba8a385a4645e699466562ad5d9f97dd0/beacon_node/store/src/lib.rs#L326-L338\r\n\r\nWe could try to cherry-pick the changes from there, or just re-do them using mass find and replace. I think using `zstd` compression would also be good for consistency. It has very good performance both in terms of compression factor and speed.\r\n\r\nWe'll also need a schema upgrade v18 -> v19 that compresses all the blobs in the DB (we could try to shortcut this, but the UX would be worse).",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/5030/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/5030/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1874657333",
    "html_url": "https://github.com/sigp/lighthouse/issues/5030#issuecomment-1874657333",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/5030",
    "id": 1874657333,
    "node_id": "IC_kwDOCFeAzc5vvQA1",
    "user": {
      "login": "potuz",
      "id": 16044918,
      "node_id": "MDQ6VXNlcjE2MDQ0OTE4",
      "avatar_url": "https://avatars.githubusercontent.com/u/16044918?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/potuz",
      "html_url": "https://github.com/potuz",
      "followers_url": "https://api.github.com/users/potuz/followers",
      "following_url": "https://api.github.com/users/potuz/following{/other_user}",
      "gists_url": "https://api.github.com/users/potuz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/potuz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/potuz/subscriptions",
      "organizations_url": "https://api.github.com/users/potuz/orgs",
      "repos_url": "https://api.github.com/users/potuz/repos",
      "events_url": "https://api.github.com/users/potuz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/potuz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-02T22:49:49Z",
    "updated_at": "2024-01-02T22:49:49Z",
    "author_association": "NONE",
    "body": "are you sure about this? rollups will likely send already compressed data for blob transactions (Arbitrum already does this). If you had access to the original uncompressed txs that would make more sense. There may be consumers of uncompressed data blobs, but do we have numbers on these?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1874657333/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1874660546",
    "html_url": "https://github.com/sigp/lighthouse/issues/5030#issuecomment-1874660546",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/5030",
    "id": 1874660546,
    "node_id": "IC_kwDOCFeAzc5vvQzC",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2024-01-02T22:54:30Z",
    "updated_at": "2024-01-02T22:54:30Z",
    "author_association": "MEMBER",
    "body": "@potuz I'm not sure actually, I thought I heard chatter on Discord about blob compressibility. If it's not useful it saves us some hassle",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1874660546/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
