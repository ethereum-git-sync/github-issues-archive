{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/1971",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/1971/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/1971/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/1971/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/1971",
  "id": 750669249,
  "node_id": "MDU6SXNzdWU3NTA2NjkyNDk=",
  "number": 1971,
  "title": "Beacon node rejecting attestations with UnknownHeadBlock",
  "user": {
    "login": "mcdee",
    "id": 511384,
    "node_id": "MDQ6VXNlcjUxMTM4NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/511384?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mcdee",
    "html_url": "https://github.com/mcdee",
    "followers_url": "https://api.github.com/users/mcdee/followers",
    "following_url": "https://api.github.com/users/mcdee/following{/other_user}",
    "gists_url": "https://api.github.com/users/mcdee/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mcdee/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mcdee/subscriptions",
    "organizations_url": "https://api.github.com/users/mcdee/orgs",
    "repos_url": "https://api.github.com/users/mcdee/repos",
    "events_url": "https://api.github.com/users/mcdee/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mcdee/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-11-25T09:56:16Z",
  "updated_at": "2020-12-03T11:06:52Z",
  "closed_at": "2020-12-03T11:06:51Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nSending attestations to the beacon node commonly results in an `UnknownHeadBlock`\r\n\r\n## Version\r\n\r\n1.0.0\r\n\r\n## Present Behaviour\r\n\r\nA submitted attestation is rejected, 50-80% of the time.  A sample error is:\r\n\r\n```\r\n  {\r\n    \"code\": 400,\r\n    \"message\": \"BAD_REQUEST: error processing attestations\",\r\n    \"failures\": [\r\n      {\r\n        \"index\": 0,\r\n        \"message\": \"Verification: UnknownHeadBlock { beacon_block_root: 0xc871ed9342683aa165845027c0d50b65153c4ce2e5691b071075dcc21b5c8bea }\"\r\n      },\r\n      {\r\n        \"index\": 1,\r\n        \"message\": \"Verification: UnknownHeadBlock { beacon_block_root: 0xc871ed9342683aa165845027c0d50b65153c4ce2e5691b071075dcc21b5c8bea }\"\r\n      }\r\n    ]\r\n  }\r\n```\r\n\r\nHowever this block appears to be valid, as per https://pyrmont.beaconcha.in/block/49745\r\n\r\n## Expected Behaviour\r\n\r\nThe attestation should be accepted.\r\n\r\n## Steps to resolve\r\n\r\nLighthouse should accept the attestation even though it is currently unaware of the head block.  Given that the attestation has been signed, the validator client is not going to be producing another one for that epoch.\r\n",
  "closed_by": {
    "login": "mcdee",
    "id": 511384,
    "node_id": "MDQ6VXNlcjUxMTM4NA==",
    "avatar_url": "https://avatars.githubusercontent.com/u/511384?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mcdee",
    "html_url": "https://github.com/mcdee",
    "followers_url": "https://api.github.com/users/mcdee/followers",
    "following_url": "https://api.github.com/users/mcdee/following{/other_user}",
    "gists_url": "https://api.github.com/users/mcdee/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mcdee/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mcdee/subscriptions",
    "organizations_url": "https://api.github.com/users/mcdee/orgs",
    "repos_url": "https://api.github.com/users/mcdee/repos",
    "events_url": "https://api.github.com/users/mcdee/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mcdee/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/1971/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/1971/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/733973556",
    "html_url": "https://github.com/sigp/lighthouse/issues/1971#issuecomment-733973556",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1971",
    "id": 733973556,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMzk3MzU1Ng==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-25T22:28:27Z",
    "updated_at": "2020-11-25T22:29:53Z",
    "author_association": "MEMBER",
    "body": "So this one is a bit murky in my opinion. I'll let you know my thoughts, perhaps I'm missing something.\r\n\r\nLike all good arguments, lets start by making an uncertain assumption about an unclear [specification](https://github.com/ethereum/eth2.0-specs/blob/v1.0.0/specs/phase0/p2p-interface.md#attestation-subnets):\r\n>\r\n> The following validations MUST pass before forwarding the attestation on the subnet.\r\n...\r\n>\r\n > [IGNORE] The block being voted for (attestation.data.beacon_block_root) has been seen (via both gossip and non-gossip sources) (a client MAY queue aggregates for processing once block is retrieved).\r\n\r\nLet's assume that \"forwarding the attestation\" also covers \"forwarding\" an attestation from the API -> Gossipsub. So, regarding that forwarding condition there are two types of clients:\r\n\r\n1. Ones that *ignore* attestations for an unknown head.\r\n1. Ones that *queue* attestations for an unknown head.\r\n\r\nLighthouse is presently (1), we'd like to be (2) but there is presently no established effort to make it happen.\r\n\r\nSo, if you're (1) client I'd say that ignoring/rejecting the attestation from the API is the correct behaviour as per the specification. If you're a (2) client then I suspect the ideal behaviour would be to accept the attestation from the API and *maybe* publish it later, once that head block has been seen.\r\n\r\nI think the most important factor at play here is that when a client sends us an attestation with an unknown head block we query that client for the block (this is a method of discovering new chains). I'm not certain how Lighthouse will behave if another client fails to respond to this request, but I suspect it will down-vote them because they have either clearly defied the specification or ignored/lost our request. Perhaps @divagant-martian and/or @blacktemplar can chime in here with some clarity.\r\n\r\nSo, in summary, I think it's a little unclear how a client should handle an attestation to an unknown head. One the one hand we have the interests of the VC pushing out an attestation and then on the other hand we have the interests of the BN maintain a good score on the network (which ultimately is in the interests of the VC, too).\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/733973556/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/733975220",
    "html_url": "https://github.com/sigp/lighthouse/issues/1971#issuecomment-733975220",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1971",
    "id": 733975220,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczMzk3NTIyMA==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-25T22:34:11Z",
    "updated_at": "2020-11-25T22:34:11Z",
    "author_association": "MEMBER",
    "body": "I think #635 is also somewhat relevant here. \r\n\r\nAnd yep, if a client doesn't send us the block they referenced they get penalized.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/733975220/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/737871908",
    "html_url": "https://github.com/sigp/lighthouse/issues/1971#issuecomment-737871908",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1971",
    "id": 737871908,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczNzg3MTkwOA==",
    "user": {
      "login": "mcdee",
      "id": 511384,
      "node_id": "MDQ6VXNlcjUxMTM4NA==",
      "avatar_url": "https://avatars.githubusercontent.com/u/511384?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mcdee",
      "html_url": "https://github.com/mcdee",
      "followers_url": "https://api.github.com/users/mcdee/followers",
      "following_url": "https://api.github.com/users/mcdee/following{/other_user}",
      "gists_url": "https://api.github.com/users/mcdee/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mcdee/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mcdee/subscriptions",
      "organizations_url": "https://api.github.com/users/mcdee/orgs",
      "repos_url": "https://api.github.com/users/mcdee/repos",
      "events_url": "https://api.github.com/users/mcdee/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mcdee/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-03T11:06:51Z",
    "updated_at": "2020-12-03T11:06:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "Given that #635 would address this in (in my opinion) a satisfactory way I'll close this issue in favour of that one.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/737871908/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
