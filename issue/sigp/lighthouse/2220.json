{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/2220",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/2220/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/2220/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/2220/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/2220",
  "id": 813344671,
  "node_id": "MDU6SXNzdWU4MTMzNDQ2NzE=",
  "number": 2220,
  "title": "Lighthouse Beacon node OOM",
  "user": {
    "login": "wouterdegeus",
    "id": 56300370,
    "node_id": "MDQ6VXNlcjU2MzAwMzcw",
    "avatar_url": "https://avatars.githubusercontent.com/u/56300370?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/wouterdegeus",
    "html_url": "https://github.com/wouterdegeus",
    "followers_url": "https://api.github.com/users/wouterdegeus/followers",
    "following_url": "https://api.github.com/users/wouterdegeus/following{/other_user}",
    "gists_url": "https://api.github.com/users/wouterdegeus/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/wouterdegeus/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/wouterdegeus/subscriptions",
    "organizations_url": "https://api.github.com/users/wouterdegeus/orgs",
    "repos_url": "https://api.github.com/users/wouterdegeus/repos",
    "events_url": "https://api.github.com/users/wouterdegeus/events{/privacy}",
    "received_events_url": "https://api.github.com/users/wouterdegeus/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-02-22T10:04:31Z",
  "updated_at": "2021-02-22T11:08:54Z",
  "closed_at": "2021-02-22T11:08:54Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nAfter I got a notice regarding my Validator missing an attestation I went through the logs to find it unable to connect to the Beacon Node.\r\nChecking the Beacon Node it became clear that it got stuck in some sort of loop, which after a while triggered the OOM killer (freeing up to 15GB of memory from what I see in Grafana).\r\n\r\nThe logs show this:\r\n```\r\nFeb 22 09:31:59.333 INFO New block received                      hash: 0xde48…2035, slot: 596558\r\nFeb 22 09:32:05.001 INFO Synced                                  slot: 596558, block: 0xde48…2035, epoch: 18642, finalized_epoch: 18640, finalized_root: 0x72f6…ecbe, peers: 49, service: slot_notifier\r\nFeb 22 09:32:11.491 INFO New block received                      hash: 0x6418…0ed6, slot: 596559\r\nFeb 22 09:32:17.000 INFO Synced                                  slot: 596559, block: 0x6418…0ed6, epoch: 18642, finalized_epoch: 18640, finalized_root: 0x72f6…ecbe, peers: 49, service: slot_notifier\r\nFeb 22 09:32:23.623 INFO New block received                      hash: 0xa74b…5c55, slot: 596560\r\nFeb 22 09:32:29.001 INFO Synced                                  slot: 596560, block: 0xa74b…5c55, epoch: 18642, finalized_epoch: 18640, finalized_root: 0x72f6…ecbe, peers: 48, service: slot_notifier\r\nFeb 22 09:32:34.181 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.239 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.295 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.334 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.335 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.338 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.339 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.340 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.341 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.350 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.353 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.358 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.363 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.365 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.366 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.368 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.395 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.397 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.397 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.398 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.399 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.401 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.401 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.401 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.402 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.404 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.405 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:34.406 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\n< keeps repeating a lot >\r\nFeb 22 09:32:41.000 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\nFeb 22 09:32:41.000 INFO Synced                                  slot: 596561, block: 0x6775…c702, epoch: 18642, finalized_epoch: 18640, finalized_root: 0x72f6…ecbe, peers: 51, service: slot_notifier\r\nFeb 22 09:32:41.001 INFO Address updated                         udp_port: 11363, ip: ::ffff:<censored>, service: libp2p\r\n< keeps repeating a lot >\r\n```\r\nUntil OOM finally kills it.\r\nA quick count:\r\n```bash\r\n$ grep \"Feb 22 09:\" lighthouse-bn-log | grep \"INFO Address updated                         udp_port: 11363\" | wc -l\r\n37282\r\n```\r\nNext it restarts automatically through docker at Feb 22 09:33:45.132, after which it seems to work fine up until Feb 22 10:07:53.001 where it gets stuck in this loop again. (this time on port 9000)\r\nEventually it seems to get out of this loop however:\r\n```\r\nFeb 22 10:10:04.336 INFO Address updated                         udp_port: 9000, ip: ::ffff:<myip>, service: libp2p\r\nFeb 22 10:10:04.336 INFO Address updated                         udp_port: 9000, ip: ::ffff:<myip>, service: libp2p\r\nFeb 22 10:10:04.338 INFO Address updated                         udp_port: 9000, ip: ::ffff:<myip>, service: libp2p\r\nFeb 22 10:10:04.340 INFO Address updated                         udp_port: 9000, ip: ::ffff:<myip>, service: libp2p\r\nFeb 22 10:10:04.341 INFO Address updated                         udp_port: 59079, ip: <myip>, service: libp2p\r\nFeb 22 10:10:05.001 INFO Synced                                  slot: 596748, block: 0x26af…6cc3, epoch: 18648, finalized_epoch: 18646, finalized_root: 0x43c1…28e1, peers: 49, service: slot_notifier\r\n```\r\n\r\nNot sure exactly what's going on there, one thing that is interesting is that the time it gets out it doesn't seem to use IPv6 notation, so maybe this is IPv6 related?\r\nDigging through the logs a bit more it seems like this happens more often, usually only a few notices of the IPv6 variant after which it \"sees\" the proper IPv4 address again.\r\n\r\n## Version\r\n\r\nLighthouse v1.1.1\r\nRust v1.50\r\nBuilt on docker\r\n\r\n## Present Behaviour\r\n\r\nGets stuck in address update loop with IPv6 address notation until it either OOMs or sees the IPv4 variant of the same address.\r\n\r\n## Expected Behaviour\r\n\r\nStick to the proper address, it doesn't really ever change.\r\n\r\n## Steps to resolve\r\n\r\nUnknown.\r\n",
  "closed_by": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/2220/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/2220/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/783295756",
    "html_url": "https://github.com/sigp/lighthouse/issues/2220#issuecomment-783295756",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2220",
    "id": 783295756,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc4MzI5NTc1Ng==",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-22T11:08:49Z",
    "updated_at": "2021-02-22T11:08:49Z",
    "author_association": "MEMBER",
    "body": "Hi @wouterdegeus! Thanks for the detailed bug report. This is a known issue that was fixed in v1.1.3 released just a few hours ago. Please try that release and let us know if your problems persist!\n\nClosing as a duplicate of https://github.com/sigp/lighthouse/issues/2215, will re-open as necessary ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/783295756/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
