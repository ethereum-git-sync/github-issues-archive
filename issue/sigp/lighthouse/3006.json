{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3006",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3006/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3006/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3006/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3006",
  "id": 1126003709,
  "node_id": "I_kwDOCFeAzc5DHXP9",
  "number": 3006,
  "title": "Got banned on Hetzner for local netscan by lighthouse client",
  "user": {
    "login": "poma",
    "id": 2109710,
    "node_id": "MDQ6VXNlcjIxMDk3MTA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2109710?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/poma",
    "html_url": "https://github.com/poma",
    "followers_url": "https://api.github.com/users/poma/followers",
    "following_url": "https://api.github.com/users/poma/following{/other_user}",
    "gists_url": "https://api.github.com/users/poma/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/poma/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/poma/subscriptions",
    "organizations_url": "https://api.github.com/users/poma/orgs",
    "repos_url": "https://api.github.com/users/poma/repos",
    "events_url": "https://api.github.com/users/poma/events{/privacy}",
    "received_events_url": "https://api.github.com/users/poma/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2022-02-07T13:33:00Z",
  "updated_at": "2022-05-18T07:02:15Z",
  "closed_at": "2022-05-18T07:02:15Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nLighthouse tries to probe local network hosts, which is considered a malicious behavior, this led to Hetzner disconnecting my server from the internet\r\n\r\n## Version\r\n\r\nLighthouse/v2.1.1-5f628a7\r\n\r\n## Present Behaviour\r\n\r\nHere's an abuse report that I've received, my machine address is censored (`x.x.x.x`)\r\n\r\n```\r\n##########################################################################\r\n#               Netscan detected from host   x.x.x.x               #\r\n##########################################################################\r\n\r\ntime                protocol src_ip src_port          dest_ip dest_port\r\n---------------------------------------------------------------------------\r\nThu Feb  3 20:53:52 2022 UDP   x.x.x.x 9000  =>       10.7.5.39 30333\r\nThu Feb  3 20:53:02 2022 UDP   x.x.x.x 9000  =>   100.124.61.10 30303\r\nThu Feb  3 20:53:52 2022 UDP   x.x.x.x 9000  =>     10.79.76.96 12000\r\nThu Feb  3 20:58:47 2022 UDP   x.x.x.x 12900 =>   10.200.64.156 12000\r\nThu Feb  3 21:01:18 2022 UDP   x.x.x.x 12900 =>   10.244.102.21 12000\r\nThu Feb  3 20:52:15 2022 UDP   x.x.x.x 9000  =>     100.96.45.2 12000\r\nThu Feb  3 20:54:00 2022 UDP   x.x.x.x 9000  =>     100.96.49.2 12000\r\nThu Feb  3 20:52:33 2022 UDP   x.x.x.x 9000  =>     100.96.54.2 12000\r\nThu Feb  3 21:02:49 2022 UDP   x.x.x.x 12900 =>   100.96.171.11 12000\r\nThu Feb  3 20:58:01 2022 UDP   x.x.x.x 9000  =>  100.96.200.194 12000\r\nThu Feb  3 20:55:03 2022 UDP   x.x.x.x 9000  =>   100.96.251.73 12000\r\nThu Feb  3 20:56:25 2022 UDP   x.x.x.x 9000  =>   100.97.83.194 12000\r\nThu Feb  3 20:58:04 2022 UDP   x.x.x.x 9000  =>   100.97.145.33 12000\r\nThu Feb  3 20:58:57 2022 UDP   x.x.x.x 12900 =>  100.97.168.130 12000\r\nThu Feb  3 20:54:30 2022 UDP   x.x.x.x 9000  =>   100.98.55.131 12000\r\nThu Feb  3 20:55:27 2022 UDP   x.x.x.x 9000  =>   100.98.55.131 12000\r\nThu Feb  3 21:02:48 2022 UDP   x.x.x.x 12900 =>    100.98.97.66 12000\r\nThu Feb  3 20:58:46 2022 UDP   x.x.x.x 12900 =>  100.98.117.196 12000\r\nThu Feb  3 21:00:20 2022 UDP   x.x.x.x 12900 =>   100.99.77.130 12000\r\nThu Feb  3 21:02:02 2022 UDP   x.x.x.x 12900 =>   100.99.77.130 12000\r\nThu Feb  3 20:56:54 2022 UDP   x.x.x.x 9000  =>    100.100.16.2 12000\r\n```\r\n\r\nRemember that `100.64/10` is an RFC6598 private address segment.\r\n\r\n## Expected Behaviour\r\n\r\nLighthouse shouldn't scan the local network like that\r\n\r\n## Steps to resolve\r\n\r\nI think this behavior should be disabled by default or at least configurable\r\n",
  "closed_by": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3006/reactions",
    "total_count": 2,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 2
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3006/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1032230118",
    "html_url": "https://github.com/sigp/lighthouse/issues/3006#issuecomment-1032230118",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3006",
    "id": 1032230118,
    "node_id": "IC_kwDOCFeAzc49hpTm",
    "user": {
      "login": "pk910",
      "id": 491045,
      "node_id": "MDQ6VXNlcjQ5MTA0NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/491045?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pk910",
      "html_url": "https://github.com/pk910",
      "followers_url": "https://api.github.com/users/pk910/followers",
      "following_url": "https://api.github.com/users/pk910/following{/other_user}",
      "gists_url": "https://api.github.com/users/pk910/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pk910/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pk910/subscriptions",
      "organizations_url": "https://api.github.com/users/pk910/orgs",
      "repos_url": "https://api.github.com/users/pk910/repos",
      "events_url": "https://api.github.com/users/pk910/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pk910/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-08T05:32:15Z",
    "updated_at": "2022-02-08T05:36:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "I've received the same abuse notification from hetzner a few weeks ago.\r\nNote these are all non-public-routable IP ranges, so it's impossible for your server to establish a connection to these IPs.\r\nAnyway these internal IPs need to be advertised within the P2P network, or some nodes in internal networks won't be reachable anymore.\r\n\r\nI've blocked all non-public-routable IP ranges via firewall on my hetzner server.\r\n```\r\niptables -A OUTPUT --dst 10.0.0.0/8 -j DROP\r\niptables -A OUTPUT --dst 192.168.0.0/16 -j DROP\r\niptables -A OUTPUT --dst 172.16.0.0/12 -j DROP\r\niptables -A OUTPUT --dst 100.64.0.0/10 -j DROP\r\n```\r\n\r\nFor the abuse notification I've just replied that that's normal & valid behavior (P2P discovery), which got accepted and the ticket closed.\r\n\r\n\r\nThey've disconnected your server right after this notification? For me they've sent the notification and gave me another 24h to resolve the issue & respond before they would have disconnected my server.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1032230118/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1032393691",
    "html_url": "https://github.com/sigp/lighthouse/issues/3006#issuecomment-1032393691",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3006",
    "id": 1032393691,
    "node_id": "IC_kwDOCFeAzc49iRPb",
    "user": {
      "login": "poma",
      "id": 2109710,
      "node_id": "MDQ6VXNlcjIxMDk3MTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2109710?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/poma",
      "html_url": "https://github.com/poma",
      "followers_url": "https://api.github.com/users/poma/followers",
      "following_url": "https://api.github.com/users/poma/following{/other_user}",
      "gists_url": "https://api.github.com/users/poma/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/poma/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/poma/subscriptions",
      "organizations_url": "https://api.github.com/users/poma/orgs",
      "repos_url": "https://api.github.com/users/poma/repos",
      "events_url": "https://api.github.com/users/poma/events{/privacy}",
      "received_events_url": "https://api.github.com/users/poma/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-08T09:28:13Z",
    "updated_at": "2022-02-08T09:28:13Z",
    "author_association": "NONE",
    "body": "I was offline and didn't respond in 24h. I think there should be a switch to turn on discovery on private ip addresses, so that people don't have to use firewall because lighthouse misbehaves by default.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1032393691/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1039691245",
    "html_url": "https://github.com/sigp/lighthouse/issues/3006#issuecomment-1039691245",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3006",
    "id": 1039691245,
    "node_id": "IC_kwDOCFeAzc49-G3t",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-14T23:46:10Z",
    "updated_at": "2022-02-14T23:46:10Z",
    "author_association": "MEMBER",
    "body": "Yeah agreed. \r\n\r\nJust for context. Lighthouse doesn't scan these addresses. In discovery, Lighthouse requests its contactable peers for them to give us some new nodes. Our peers (of which are mixed clients of anyone participating in the discovery protocol, prysm, teku, nimbus and even a bunch of eth1 nodes) then provide us with new peers on various addresses. \r\n\r\nThese peers are sending us these private addresses and we try to connect to them in good faith. The actual IP addresses being sent back to us as possible peers to connect to is out of our control as other clients can send anything they like. Lighthouse has a mechanism that will only advertise peers if they are routable from our perspective. So it is possible for a publicly routable lighthouse node which is connected to some internal peers (which are not routable and haven't updated their public IP) to forward those internal IPs. \r\n\r\nInternal IPs are often required for testnets or setting up local infrastructure. I can add a flag to filter these out and prevent the connections in discovery. I guess this should be the default behaviour and the flag can be used to allow internal IPs.\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1039691245/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1039809121",
    "html_url": "https://github.com/sigp/lighthouse/issues/3006#issuecomment-1039809121",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3006",
    "id": 1039809121,
    "node_id": "IC_kwDOCFeAzc49-jph",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-15T03:17:25Z",
    "updated_at": "2022-02-15T03:17:25Z",
    "author_association": "MEMBER",
    "body": "I've made a PR for this. \r\n\r\nIf you have the means, could you test to see if #3023 resolves your issues @poma @pk910 ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1039809121/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1042387807",
    "html_url": "https://github.com/sigp/lighthouse/issues/3006#issuecomment-1042387807",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3006",
    "id": 1042387807,
    "node_id": "IC_kwDOCFeAzc4-IZNf",
    "user": {
      "login": "pk910",
      "id": 491045,
      "node_id": "MDQ6VXNlcjQ5MTA0NQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/491045?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pk910",
      "html_url": "https://github.com/pk910",
      "followers_url": "https://api.github.com/users/pk910/followers",
      "following_url": "https://api.github.com/users/pk910/following{/other_user}",
      "gists_url": "https://api.github.com/users/pk910/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pk910/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pk910/subscriptions",
      "organizations_url": "https://api.github.com/users/pk910/orgs",
      "repos_url": "https://api.github.com/users/pk910/repos",
      "events_url": "https://api.github.com/users/pk910/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pk910/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-16T22:54:16Z",
    "updated_at": "2022-02-16T23:06:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "@AgeManning \r\nI've tested it on the prater testnet. \r\nLooks good, after the update tcpdump didn't capture any connection attempts to private networks anymore.\r\n\r\nLeft a comment about the excluded networks in the PR 😉",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1042387807/reactions",
      "total_count": 2,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 2,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1129645356",
    "html_url": "https://github.com/sigp/lighthouse/issues/3006#issuecomment-1129645356",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3006",
    "id": 1129645356,
    "node_id": "IC_kwDOCFeAzc5DVQUs",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-18T07:02:15Z",
    "updated_at": "2022-05-18T07:02:15Z",
    "author_association": "MEMBER",
    "body": "Resolved by #3023",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1129645356/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
