{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3617",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3617/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3617/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3617/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3617",
  "id": 1388139828,
  "node_id": "I_kwDOCFeAzc5SvVU0",
  "number": 3617,
  "title": "Block with an incorrect fee recipient",
  "user": {
    "login": "PacoBits",
    "id": 38920606,
    "node_id": "MDQ6VXNlcjM4OTIwNjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/38920606?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/PacoBits",
    "html_url": "https://github.com/PacoBits",
    "followers_url": "https://api.github.com/users/PacoBits/followers",
    "following_url": "https://api.github.com/users/PacoBits/following{/other_user}",
    "gists_url": "https://api.github.com/users/PacoBits/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/PacoBits/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/PacoBits/subscriptions",
    "organizations_url": "https://api.github.com/users/PacoBits/orgs",
    "repos_url": "https://api.github.com/users/PacoBits/repos",
    "events_url": "https://api.github.com/users/PacoBits/events{/privacy}",
    "received_events_url": "https://api.github.com/users/PacoBits/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-09-27T17:47:08Z",
  "updated_at": "2022-12-08T18:12:10Z",
  "closed_at": "2022-12-08T18:12:10Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Our setup has produced a block with an incorrect fee recipient: https://etherscan.io/block/15616137\r\n\r\nWe have been producing blocks correctly and after that incident it is still producing blocks with the fee recipient correctly.\r\n\r\nWe have a 3-layer configuration with the validator client, the Beacon node, a fallback beacon node and the execution client running separately.\r\n\r\nThese are our versions and fee recipent setup:\r\n\r\n```\r\nValidator set up - version: Lighthouse/v3.1.0-aa022f4\r\n--graffiti \"Block by Stakely Lido09\"\r\n--suggested-fee-recipient 0x388C818CA8B9251b393131C08a736A67ccB19297\r\n```\r\n\r\n```\r\nBeacon MAIN node set up - teku/v22.9.1/linux-x86_64/-eclipseadoptium-openjdk64bitservervm-java-17\r\n\"--validators-graffiti='Block by Stakely.io - btk01'\",\r\n\"--validators-proposer-default-fee-recipient=0x7188D41ea11aBf3e95040ba1823E861A62644AC2\"\r\n```\r\n\r\n```\r\nBeacon FALLBACK node set up -(version: Lighthouse/v3.1.0-aa022f4)\r\n--graffiti \"Block by Stakely - lh01\"\r\nsuggested-fee-recipient  is not set up\r\n```\r\n\r\n`Execution Client - Erigon/v2022.09.3-stable-32bd69e5/linux-amd64/go1.18.3`\r\n\r\n\r\nThe attached logs shows block was generated by erigon-teku correctly and sent to the validator, but at that moment there was a disconnection of teku and the validator:\r\nValidator client log - disconected beacon:\r\n`node09 | Sep 26 07:44:29.001 INFO Connected to beacon node(s) synced: 2, available: 2, total: 3, service: notifier\r\n`\r\nSo the validator client continues the publication in the fallback beacon (Lighthouse beacon). This beacon does not have a default fee recipient set due to a problem.\r\n\r\nValidator client log - publised block and reconnected to teku:\r\n\r\n```\r\nnode09         | Sep 26 07:44:29.001 INFO All validators active                   slot: 4779520, epoch: 149360, total_validators: 500, active_validators: 500, current_epoch_proposers: 1, service: notifier\r\nnode09         | Sep 26 07:44:30.208 INFO Successfully published block            slot: 4779520, graffiti: Some(\"Block by Stakely Lido09\"), attestations: 128, deposits: 0, block_type: Full, service: block\r\nnode09         | Sep 26 07:44:34.023 INFO Connected to beacon node                endpoint: httpxxx://x.x.x.x:xxxx/, version: teku/v22.9.1/linux-x86_64/-eclipseadoptium-openjdk64bitservervm-java-17\r\n```\r\nWe can see Lighthouse FALLBACK beacon node  log the problem:\r\n\r\n`lighthouse_beacon_node_1 | Sep 26 07:44:27.178 CRIT Fee recipient unknown proposer_index: 366592, msg: the suggested_fee_recipient was unknown during block production. a junk address was used, rewards were lost! check the --suggested-fee-recipient flag and VC configuration., service: exec`\r\n\r\nWe set up a suggested-fee-recipient as work around, but in case of beacon node failover while the block generation process , validator client should send the suggested-fee-recipient and not only the graffity. \r\n\r\n[Valc09_26092022.log](https://github.com/sigp/lighthouse/files/9658376/Valc09_26092022.log)\r\n[erigon_26092022.log](https://github.com/sigp/lighthouse/files/9658377/erigon_26092022.log)\r\n[Lighthouse_Beacon_26092022.log](https://github.com/sigp/lighthouse/files/9658378/Lighthouse_Beacon_26092022.log)\r\n[teku_26092022.log](https://github.com/sigp/lighthouse/files/9658379/teku_26092022.log)\r\n\r\n",
  "closed_by": {
    "login": "PacoBits",
    "id": 38920606,
    "node_id": "MDQ6VXNlcjM4OTIwNjA2",
    "avatar_url": "https://avatars.githubusercontent.com/u/38920606?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/PacoBits",
    "html_url": "https://github.com/PacoBits",
    "followers_url": "https://api.github.com/users/PacoBits/followers",
    "following_url": "https://api.github.com/users/PacoBits/following{/other_user}",
    "gists_url": "https://api.github.com/users/PacoBits/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/PacoBits/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/PacoBits/subscriptions",
    "organizations_url": "https://api.github.com/users/PacoBits/orgs",
    "repos_url": "https://api.github.com/users/PacoBits/repos",
    "events_url": "https://api.github.com/users/PacoBits/events{/privacy}",
    "received_events_url": "https://api.github.com/users/PacoBits/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3617/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3617/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1259964636",
    "html_url": "https://github.com/sigp/lighthouse/issues/3617#issuecomment-1259964636",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3617",
    "id": 1259964636,
    "node_id": "IC_kwDOCFeAzc5LGYjc",
    "user": {
      "login": "realbigsean",
      "id": 5160426,
      "node_id": "MDQ6VXNlcjUxNjA0MjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5160426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/realbigsean",
      "html_url": "https://github.com/realbigsean",
      "followers_url": "https://api.github.com/users/realbigsean/followers",
      "following_url": "https://api.github.com/users/realbigsean/following{/other_user}",
      "gists_url": "https://api.github.com/users/realbigsean/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/realbigsean/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/realbigsean/subscriptions",
      "organizations_url": "https://api.github.com/users/realbigsean/orgs",
      "repos_url": "https://api.github.com/users/realbigsean/repos",
      "events_url": "https://api.github.com/users/realbigsean/events{/privacy}",
      "received_events_url": "https://api.github.com/users/realbigsean/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-27T19:38:17Z",
    "updated_at": "2022-09-27T19:38:17Z",
    "author_association": "COLLABORATOR",
    "body": "Yes our validator doesn't send proposer preparation information to fallback at the moment, so a poorly timed fallback but will cause this, the fix is being worked on in this PR: https://github.com/sigp/lighthouse/pull/3529\r\n\r\nFor now, use setting the config directly in the fallback BN is the best workaround",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1259964636/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
