{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/1248",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/1248/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/1248/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/1248/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/1248",
  "id": 631287365,
  "node_id": "MDU6SXNzdWU2MzEyODczNjU=",
  "number": 1248,
  "title": "Prevent unbounded concurrent discovery queries",
  "user": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1152259112,
      "node_id": "MDU6TGFiZWwxMTUyMjU5MTEy",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/blocked",
      "name": "blocked",
      "color": "000000",
      "default": false,
      "description": ""
    },
    {
      "id": 2336800125,
      "node_id": "MDU6TGFiZWwyMzM2ODAwMTI1",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/t%20Networking",
      "name": "t Networking",
      "color": "40E0D0",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-06-05T03:39:24Z",
  "updated_at": "2022-10-20T17:09:27Z",
  "closed_at": "2020-06-19T04:21:13Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nA node with many validators may be trying to do many discovery requests simultaneously. A discovery request has a timeout of 1 minute, and a many-validator node may want to try and perform many discoveries per epoch if it doesn't have sufficient peers for the desired subnets. \r\n\r\nWe should aim to have at most two simultaneous discovery queries running at any given time due to their expensive nature. We should therefore queue any extra discovery requests in a bounded queue and reject extra discoveries that can't fit into the queue. \r\n\r\nUpon draining the queue, we will want to de-dupe and may want to try and combine the predicates, i.e If we have a queries for subnets 1, 3 ,5 in the queue, we may try search for peers in either of these subnets in a single query. The number of peers we are looking for should also increase. \r\n\r\nThe new discovery server update will limit concurrent discovery queries naturally, but the backlog will also need to be handled in lighthouse. \r\n\r\nThe unbounded concurrent discoveries is related to #1212\r\n\r\nThis is blocked on the discv5 server update: https://github.com/sigp/discv5/pull/14 \r\n",
  "closed_by": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/1248/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/1248/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/646426580",
    "html_url": "https://github.com/sigp/lighthouse/issues/1248#issuecomment-646426580",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1248",
    "id": 646426580,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0NjQyNjU4MA==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-19T04:21:13Z",
    "updated_at": "2020-06-19T04:21:13Z",
    "author_association": "MEMBER",
    "body": "Resolved in #1274 ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/646426580/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
