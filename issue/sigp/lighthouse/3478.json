{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3478",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3478/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3478/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3478/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3478",
  "id": 1341572128,
  "node_id": "I_kwDOCFeAzc5P9sQg",
  "number": 3478,
  "title": "Have `--checkpoint-sync-url` timeout",
  "user": {
    "login": "OisinKyne",
    "id": 4981644,
    "node_id": "MDQ6VXNlcjQ5ODE2NDQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4981644?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/OisinKyne",
    "html_url": "https://github.com/OisinKyne",
    "followers_url": "https://api.github.com/users/OisinKyne/followers",
    "following_url": "https://api.github.com/users/OisinKyne/following{/other_user}",
    "gists_url": "https://api.github.com/users/OisinKyne/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/OisinKyne/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/OisinKyne/subscriptions",
    "organizations_url": "https://api.github.com/users/OisinKyne/orgs",
    "repos_url": "https://api.github.com/users/OisinKyne/repos",
    "events_url": "https://api.github.com/users/OisinKyne/events{/privacy}",
    "received_events_url": "https://api.github.com/users/OisinKyne/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 985647284,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODQ=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/enhancement",
      "name": "enhancement",
      "color": "a2eeef",
      "default": true,
      "description": "New feature or request"
    },
    {
      "id": 985647286,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODY=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "7057ff",
      "default": true,
      "description": "Good for newcomers"
    },
    {
      "id": 2336802021,
      "node_id": "MDU6TGFiZWwyMzM2ODAyMDIx",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/UX-and-logs",
      "name": "UX-and-logs",
      "color": "DB9046",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-08-17T10:48:42Z",
  "updated_at": "2022-09-26T05:34:30Z",
  "closed_at": "2022-09-26T05:34:30Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nI have setup LH as a BN on goerli using the following settings\r\n```\r\nlighthouse bn\r\n      --network=goerli\r\n      --purge-db\r\n      --checkpoint-sync-url=https://goerli.checkpoint-sync.ethdevops.io\r\n      --execution-endpoint=http://geth:8551\r\n      --execution-jwt=/opt/jwt/jwt.hex\r\n      --http\r\n      --http-address=0.0.0.0\r\n      --http-port=5052\r\n      --metrics\r\n      --metrics-address=0.0.0.0\r\n      --metrics-port=5054\r\n      --metrics-allow-origin=\"*\"\r\n```\r\nHowever it seems there might be an issue with that ethdevops.io API not returning any data. As a result, LH just hangs indefinitely waiting for a response. Preferably it would either retry or give up and sync another way (e.g. fallback to a hardcoded weak subjectivity checkpoint within the codebase or a full sync even. \r\n\r\n## Version\r\n\r\nPlease provide your Lighthouse and Rust version. Are you building from\r\n`stable` or `unstable`, which commit?\r\n\r\nTried on v2.5.1 and latest-unstable, both using docker images\r\n\r\n## Present Behaviour\r\n\r\n```\r\nAug 17 10:39:03.534 INFO Logging to file                         path: \"/root/.lighthouse/goerli/beacon/logs/beacon.log\"\r\nAug 17 10:39:03.534 INFO Lighthouse started                      version: Lighthouse/v2.5.1-c2604c4\r\nAug 17 10:39:03.535 INFO Configured for network                  name: goerli\r\nAug 17 10:39:03.535 INFO Data directory initialised              datadir: /root/.lighthouse/goerli\r\nAug 17 10:39:03.535 INFO Deposit contract                        address: 0xff50ed3d0ec03ac01d4c79aad74928bff48a7b2b, deploy_block: 4367322\r\nAug 17 10:39:03.599 INFO Starting checkpoint sync                remote_url: https://goerli.checkpoint-sync.ethdevops.io/, service: beacon\r\n```\r\n\r\n## Expected Behaviour\r\n\r\nAfter maybe 10 seconds print a timeout log and sync a different way. \r\n\r\n## Steps to resolve\r\n\r\nRight now I had to remove the checkpoint sync entirely to get moving again. \r\n",
  "closed_by": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3478/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3478/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1225060681",
    "html_url": "https://github.com/sigp/lighthouse/issues/3478#issuecomment-1225060681",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3478",
    "id": 1225060681,
    "node_id": "IC_kwDOCFeAzc5JBPFJ",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-24T01:21:13Z",
    "updated_at": "2022-08-24T01:21:13Z",
    "author_association": "MEMBER",
    "body": "This is a good idea. The HTTP client for checkpoint sync sets a timeout here: https://github.com/sigp/lighthouse/blob/df51a73272489fe154bd10995c96199062b6c3f7/beacon_node/client/src/builder.rs#L276-L277\r\n\r\nHowever that timeout only applies to certain requests common to the validator client. I think we could add two new timeouts for `get_beacon_blocks_ssz` and `get_debug_beacon_states`, which are the two endpoints currently used by checkpoint sync:\r\n\r\nhttps://github.com/sigp/lighthouse/blob/18c61a5e8be3e54226a86a69b96f8f4f7fd790e4/common/eth2/src/lib.rs#L107-L115\r\n\r\nThis would also require some refactoring of `get_bytes_opt_accept_header` to accept a timeout:\r\n\r\nhttps://github.com/sigp/lighthouse/blob/18c61a5e8be3e54226a86a69b96f8f4f7fd790e4/common/eth2/src/lib.rs#L237-L242\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1225060681/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1230023893",
    "html_url": "https://github.com/sigp/lighthouse/issues/3478#issuecomment-1230023893",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3478",
    "id": 1230023893,
    "node_id": "IC_kwDOCFeAzc5JUKzV",
    "user": {
      "login": "MaboroshiChan",
      "id": 31759226,
      "node_id": "MDQ6VXNlcjMxNzU5MjI2",
      "avatar_url": "https://avatars.githubusercontent.com/u/31759226?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/MaboroshiChan",
      "html_url": "https://github.com/MaboroshiChan",
      "followers_url": "https://api.github.com/users/MaboroshiChan/followers",
      "following_url": "https://api.github.com/users/MaboroshiChan/following{/other_user}",
      "gists_url": "https://api.github.com/users/MaboroshiChan/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/MaboroshiChan/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/MaboroshiChan/subscriptions",
      "organizations_url": "https://api.github.com/users/MaboroshiChan/orgs",
      "repos_url": "https://api.github.com/users/MaboroshiChan/repos",
      "events_url": "https://api.github.com/users/MaboroshiChan/events{/privacy}",
      "received_events_url": "https://api.github.com/users/MaboroshiChan/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-29T09:36:13Z",
    "updated_at": "2022-08-29T09:36:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "I am planing to work on this issue. If the timeout is triggered, the simplest action is simply terminating the process. My question is that should user be asked to choose another option such as retrying or resuming default syncing?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1230023893/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1230062808",
    "html_url": "https://github.com/sigp/lighthouse/issues/3478#issuecomment-1230062808",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3478",
    "id": 1230062808,
    "node_id": "IC_kwDOCFeAzc5JUUTY",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-29T09:58:09Z",
    "updated_at": "2022-08-29T09:58:09Z",
    "author_association": "MEMBER",
    "body": "> My question is that should user be asked to choose another option such as retrying or resuming default syncing?\r\n\r\nI think it's OK to just exit. Lots of users run lighthouse under systemd which will retry a couple of times by default. Users on the CLI can always retry manually",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1230062808/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1257503689",
    "html_url": "https://github.com/sigp/lighthouse/issues/3478#issuecomment-1257503689",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3478",
    "id": 1257503689,
    "node_id": "IC_kwDOCFeAzc5K8_vJ",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-26T05:34:30Z",
    "updated_at": "2022-09-26T05:34:30Z",
    "author_association": "MEMBER",
    "body": "Resolved by #3521",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1257503689/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
