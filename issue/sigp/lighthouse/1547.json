{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/1547",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/1547",
  "id": 681552283,
  "node_id": "MDU6SXNzdWU2ODE1NTIyODM=",
  "number": 1547,
  "title": "Analyse missing attestations on Medalla",
  "user": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 16,
  "created_at": "2020-08-19T05:15:32Z",
  "updated_at": "2020-09-09T01:47:11Z",
  "closed_at": "2020-09-09T01:47:11Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nMetrics are reporting seeing significantly less attestations on the network than we should see theoretically. The metrics show attestations after verification, so this could be due to invalid attestations or non-participation. However we are an order of magnitude out and it would be nice to get an handle on why so many are missing.\r\n\r\nThe easiest place to start, is to look at the aggregated attestations. For each subnet, we expect to have (on average) 16 aggregators per subnet and there should be 64 subnets per slot. We therefore should be seeing 1024 aggregated attestations per slot. \r\n\r\nCurrently we are witnessing about (for all attestations, not just aggregates):\r\n-  Verified 80 (400/minute)\r\n- Already seen 40 (200/minute)\r\n- Invalid selection proofs 60 (300/minute)\r\n\r\nWhich is significantly less than expected (even accounting for the current participation rate). It might be useful to split the metrics into unaggregated attestations and aggregated attestations in the metrics to get a clearer distinction. Trying to isolate the main causes for this discrepency will help improve our attestation inclusion rate. \r\nSee here: https://github.com/sigp/lighthouse/blob/master/beacon_node/network/src/beacon_processor/mod.rs#L952\r\nFor where the metrics are logged for all attestations. \r\n\r\n",
  "closed_by": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/1547/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/677252561",
    "html_url": "https://github.com/sigp/lighthouse/issues/1547#issuecomment-677252561",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547",
    "id": 677252561,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3NzI1MjU2MQ==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-20T06:12:29Z",
    "updated_at": "2020-08-20T06:12:29Z",
    "author_association": "MEMBER",
    "body": "I have discussed this offline with @agemanning, but I'll leave this here for reference :)\r\n\r\n> The metrics show attestations after verification, so this could be due to invalid attestations or non-participation.\r\n\r\nWe have metrics prior to verification and they're showing roughly 300-1000 aggregate attestations per minute coming in from gossipsub into the `BeaconProcessor`.\r\n\r\n> Which is significantly less than expected (even accounting for the current participation rate)\r\n\r\nI think that the numbers we're seeing are reasonable. Firstly, I think we can expect *at most* 560 aggregators per minute:\r\n\r\n```\r\n>>> MEDALLA_VALS = 30000\r\n>>> SLOTS_PER_EPOCH = 32\r\n>>> TARGET_COMMITTEE_SIZE = 128\r\n>>> COMMITTEE_COUNT_PER_SLOT = MEDALLA_VALS // SLOTS_PER_EPOCH // TARGET_COMMITTEE_SIZE\r\n>>> TARGET_AGGREGATORS_PER_COMMITTEE = 16\r\n>>> SLOTS_PER_MINUTE = 60 // 12\r\n>>> COMMITTEE_COUNT_PER_SLOT * TARGET_AGGREGATORS_PER_COMMITTEE * SLOTS_PER_MINUTE\r\n560\r\n```\r\n\r\nFurthermore, we can lower this expected number for two reasons:\r\n\r\n- There a bunch of validators (~30%) offline presently on Medalla (as mentioned).\r\n- The networking spec declares that we should \"IGNORE\" any attestations which contain an `aggregate` that has already been seen. If the network is working perfectly, or even well, then a majority of the aggregated attestation *should* be the same and we should observe them being suppressed on gossip.\r\n\r\nIn fact, it seems like we're seeing a few *too many* aggregate attestations flying around.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/677252561/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/682045251",
    "html_url": "https://github.com/sigp/lighthouse/issues/1547#issuecomment-682045251",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547",
    "id": 682045251,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MjA0NTI1MQ==",
    "user": {
      "login": "alex3498",
      "id": 70336249,
      "node_id": "MDQ6VXNlcjcwMzM2MjQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/70336249?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alex3498",
      "html_url": "https://github.com/alex3498",
      "followers_url": "https://api.github.com/users/alex3498/followers",
      "following_url": "https://api.github.com/users/alex3498/following{/other_user}",
      "gists_url": "https://api.github.com/users/alex3498/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alex3498/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alex3498/subscriptions",
      "organizations_url": "https://api.github.com/users/alex3498/orgs",
      "repos_url": "https://api.github.com/users/alex3498/repos",
      "events_url": "https://api.github.com/users/alex3498/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alex3498/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-27T16:10:11Z",
    "updated_at": "2020-08-27T16:10:11Z",
    "author_association": "NONE",
    "body": "I tested my 10 validators. beaconscan.com was used to count missing attestations.\r\nEach validator from time to time had missing attestations (did-not-attest).\r\n\r\nI counted data for 100 most recent epochs for each validator. It gives us 1000 potential attestations.\r\nI had 67 missing attestations in total. Each validator had some missing attestations. Minimum 4, maximum 9.\r\nError rate: 67 / 1000 * 100%  = 6.7%\r\n\r\nI have done a similar test with another popular client just a day ago. It didn't miss any attestations, had a 0% error rate.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/682045251/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/682350102",
    "html_url": "https://github.com/sigp/lighthouse/issues/1547#issuecomment-682350102",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547",
    "id": 682350102,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MjM1MDEwMg==",
    "user": {
      "login": "adetante",
      "id": 917716,
      "node_id": "MDQ6VXNlcjkxNzcxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/917716?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adetante",
      "html_url": "https://github.com/adetante",
      "followers_url": "https://api.github.com/users/adetante/followers",
      "following_url": "https://api.github.com/users/adetante/following{/other_user}",
      "gists_url": "https://api.github.com/users/adetante/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adetante/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adetante/subscriptions",
      "organizations_url": "https://api.github.com/users/adetante/orgs",
      "repos_url": "https://api.github.com/users/adetante/repos",
      "events_url": "https://api.github.com/users/adetante/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adetante/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-28T06:23:42Z",
    "updated_at": "2020-08-28T06:23:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "As @alex3498, measured on beaconscan for the 1000 most recent duties for my 7 validators (= 1000 epochs for each validator):\r\n\r\n|                | val1 | val2 | val3 | val4 | val5 | val6 | val7 |\r\n|----------------|------|------|------|------|------|------|------|\r\n| did-not-attest | 42   | 26   | 40   | 28   | 36   | 31   | 30   |\r\n| % of dutties   | 4,2% | 2,6% | 4%   | 2,8% | 3,6% | 3,1% | 3%   |\r\n\r\nSo an average value around 3.3% of attestations not included.\r\nNothing special to note in the logs of beacon node or validator client.\r\n\r\nIt should be noted that the periods when the validators lack the most attestations are the same for all 7 validators. This may be due to network problems at these times?\r\n\r\nVersion:\r\n```\r\nLighthouse v0.2.7-dfd02d6+\r\nBLS Library: blst-portable\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/682350102/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/683229096",
    "html_url": "https://github.com/sigp/lighthouse/issues/1547#issuecomment-683229096",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547",
    "id": 683229096,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzIyOTA5Ng==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-29T03:24:33Z",
    "updated_at": "2020-08-29T03:24:33Z",
    "author_association": "MEMBER",
    "body": "Yep. There's a whole host of potential issues. \r\n\r\nI'm in the process of updating the gossipsub protocol. I've noticed other implementations are sending invalid gossipsub messages. Lighthouse is checking these and dropping them. It seems the other clients are still considering these messages as valid and propagating them. \r\n\r\nSo this could be a factor that we are filtering these messages from the network, whereas others are treating them as valid. \r\nAs we resolve gossip issues, hopefully we can start narrowing down the root cause. \r\n\r\nThanks for your metrics and analysis! Its very helpful!\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/683229096/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/683229245",
    "html_url": "https://github.com/sigp/lighthouse/issues/1547#issuecomment-683229245",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547",
    "id": 683229245,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzIyOTI0NQ==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-29T03:26:04Z",
    "updated_at": "2020-08-29T03:26:04Z",
    "author_association": "MEMBER",
    "body": "One thing you could try, is looking for warnings or errors in gossipsub. You can see these logs via:\r\nsetting the environment variable:\r\n```\r\nRUST_LOG=libp2p_gossipsub=warn\r\n```\r\nAnd running lighthouse with the `-l` switch. I.e\r\n\r\n```\r\nlighthouse -l beacon_node ...\r\n```\r\n\r\nCurious to see if you are getting any warnings there.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/683229245/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/683339742",
    "html_url": "https://github.com/sigp/lighthouse/issues/1547#issuecomment-683339742",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547",
    "id": 683339742,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzMzOTc0Mg==",
    "user": {
      "login": "adetante",
      "id": 917716,
      "node_id": "MDQ6VXNlcjkxNzcxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/917716?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adetante",
      "html_url": "https://github.com/adetante",
      "followers_url": "https://api.github.com/users/adetante/followers",
      "following_url": "https://api.github.com/users/adetante/following{/other_user}",
      "gists_url": "https://api.github.com/users/adetante/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adetante/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adetante/subscriptions",
      "organizations_url": "https://api.github.com/users/adetante/orgs",
      "repos_url": "https://api.github.com/users/adetante/repos",
      "events_url": "https://api.github.com/users/adetante/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adetante/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-29T20:41:42Z",
    "updated_at": "2020-08-29T20:41:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "ok, I have enabled WARN logs in gossipsub. I'm going to leave it running like this and see if I have any recurring messages",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/683339742/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/683344978",
    "html_url": "https://github.com/sigp/lighthouse/issues/1547#issuecomment-683344978",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547",
    "id": 683344978,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzM0NDk3OA==",
    "user": {
      "login": "adetante",
      "id": 917716,
      "node_id": "MDQ6VXNlcjkxNzcxNg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/917716?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/adetante",
      "html_url": "https://github.com/adetante",
      "followers_url": "https://api.github.com/users/adetante/followers",
      "following_url": "https://api.github.com/users/adetante/following{/other_user}",
      "gists_url": "https://api.github.com/users/adetante/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/adetante/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/adetante/subscriptions",
      "organizations_url": "https://api.github.com/users/adetante/orgs",
      "repos_url": "https://api.github.com/users/adetante/repos",
      "events_url": "https://api.github.com/users/adetante/events{/privacy}",
      "received_events_url": "https://api.github.com/users/adetante/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-29T21:41:48Z",
    "updated_at": "2020-08-29T22:35:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "I get a very large number of `Invalid message received. Error: Invalid sequence number`.\r\nSomething like 15 errors per second.\n\nFor my own culture: how does this (lh dropping invalid gossipsub messages coming from other peers) affect the inclusion rate of lighthouse attestations?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/683344978/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/683380316",
    "html_url": "https://github.com/sigp/lighthouse/issues/1547#issuecomment-683380316",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547",
    "id": 683380316,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzM4MDMxNg==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-30T05:58:22Z",
    "updated_at": "2020-08-30T05:58:22Z",
    "author_association": "MEMBER",
    "body": "Gossipsub has a scoring mechanism. One element of that, is scoring nodes that may be censoring messages. A LH node that drops messages (because they are invalid) could appear to be censoring (to another client) and be penalized and therefore perform worse than if it had forwarded them. \r\n\r\nAs I understand though, no one is using scoring in Medalla, so this shouldn't be the case and this shouldn't affect our inclusion rate, although it will effect other client's inclusion rate (I'm looking at this problem not just from a LH perspective but all Medalla nodes perspective). \r\n\r\nThe fact that there are invalid messages being propagated indicate that there are clients without correct implementations of gossipsub. It may be that LH's attestations are being rejected by these clients and not being propagated/included in blocks. \r\n\r\nAs we discover issues, I'll endeavour to update this issue, to let you know eventually what we discover :)\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/683380316/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/683381413",
    "html_url": "https://github.com/sigp/lighthouse/issues/1547#issuecomment-683381413",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547",
    "id": 683381413,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzM4MTQxMw==",
    "user": {
      "login": "alex3498",
      "id": 70336249,
      "node_id": "MDQ6VXNlcjcwMzM2MjQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/70336249?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alex3498",
      "html_url": "https://github.com/alex3498",
      "followers_url": "https://api.github.com/users/alex3498/followers",
      "following_url": "https://api.github.com/users/alex3498/following{/other_user}",
      "gists_url": "https://api.github.com/users/alex3498/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alex3498/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alex3498/subscriptions",
      "organizations_url": "https://api.github.com/users/alex3498/orgs",
      "repos_url": "https://api.github.com/users/alex3498/repos",
      "events_url": "https://api.github.com/users/alex3498/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alex3498/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-30T06:14:50Z",
    "updated_at": "2020-08-30T06:14:50Z",
    "author_association": "NONE",
    "body": "I had enabled logging as well and ran it for 10+ hours.\r\nI haven't detected any correlation between missed attestations and log messages/activity.\r\n\r\nHowever, during this period I received a few hundred messages telling that my attestation queue is full:\r\n`Attestation queue full                  queue_len: 16384, msg: the system has insufficient resources for load`\r\nI wonder, can it be related?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/683381413/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/683487597",
    "html_url": "https://github.com/sigp/lighthouse/issues/1547#issuecomment-683487597",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547",
    "id": 683487597,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzQ4NzU5Nw==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-30T23:50:17Z",
    "updated_at": "2020-08-30T23:50:17Z",
    "author_association": "MEMBER",
    "body": "@alex3498  - That would mean you are not propagating attestations for others. \r\n\r\nWhat is the spec of your computer, and how many validators are you running?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/683487597/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/683537404",
    "html_url": "https://github.com/sigp/lighthouse/issues/1547#issuecomment-683537404",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547",
    "id": 683537404,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4MzUzNzQwNA==",
    "user": {
      "login": "alex3498",
      "id": 70336249,
      "node_id": "MDQ6VXNlcjcwMzM2MjQ5",
      "avatar_url": "https://avatars.githubusercontent.com/u/70336249?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/alex3498",
      "html_url": "https://github.com/alex3498",
      "followers_url": "https://api.github.com/users/alex3498/followers",
      "following_url": "https://api.github.com/users/alex3498/following{/other_user}",
      "gists_url": "https://api.github.com/users/alex3498/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/alex3498/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/alex3498/subscriptions",
      "organizations_url": "https://api.github.com/users/alex3498/orgs",
      "repos_url": "https://api.github.com/users/alex3498/repos",
      "events_url": "https://api.github.com/users/alex3498/events{/privacy}",
      "received_events_url": "https://api.github.com/users/alex3498/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-31T04:04:49Z",
    "updated_at": "2020-08-31T04:35:15Z",
    "author_association": "NONE",
    "body": "I am using AWS t3a.medium as my test machine. It has 4.0 GiB, 2 vCPUs. I have 10 validators running on a different machine.\r\n\r\nIt seems it is working fine for 2-3 hours after the restart and then gets stuck in this queue full state. CPU utilization is around 20-30% at the beginning and everything seems fine. However, at some point, the computer starts spending most of its cycles (~80%) on interrupts (IRQ) according to `htop`\r\n![image](https://user-images.githubusercontent.com/70336249/91681595-befe7d80-eb03-11ea-849e-758ef39a8290.png)\r\nOn the chart, you can see that CPU load is around 20% but it is actually fully loaded in `htop`, it seems like AWS doesn't measure those interrupts. It looks like most of them are network related.\r\n\r\nSurprisingly, I've seen missed attestation before and after my node got into the 100% load mode. So, I don't think it can explain the missing attestation issue.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/683537404/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/685293786",
    "html_url": "https://github.com/sigp/lighthouse/issues/1547#issuecomment-685293786",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547",
    "id": 685293786,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NTI5Mzc4Ng==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-02T04:50:00Z",
    "updated_at": "2020-09-02T04:50:00Z",
    "author_association": "MEMBER",
    "body": "The cpu chart is interesting considering the queue maxes out. \r\n\r\nWe've noticed the missed attestations are usually at the start of an epoch. I think you may find most of your missed attestations happen when you need to attest to the first block on an epoch. We are investigating that currently. ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/685293786/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/685299961",
    "html_url": "https://github.com/sigp/lighthouse/issues/1547#issuecomment-685299961",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547",
    "id": 685299961,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NTI5OTk2MQ==",
    "user": {
      "login": "jeffla",
      "id": 371277,
      "node_id": "MDQ6VXNlcjM3MTI3Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/371277?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jeffla",
      "html_url": "https://github.com/jeffla",
      "followers_url": "https://api.github.com/users/jeffla/followers",
      "following_url": "https://api.github.com/users/jeffla/following{/other_user}",
      "gists_url": "https://api.github.com/users/jeffla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jeffla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jeffla/subscriptions",
      "organizations_url": "https://api.github.com/users/jeffla/orgs",
      "repos_url": "https://api.github.com/users/jeffla/repos",
      "events_url": "https://api.github.com/users/jeffla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jeffla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-02T05:06:09Z",
    "updated_at": "2020-09-02T05:07:11Z",
    "author_association": "NONE",
    "body": "Mainly commenting to stay updated, but I'm seeing the same thing on mine. Today it was just 1 of 2 validators (on the same machine) that had a problem, twice. The first time I restarted the validator service and it started working again. 2nd time, I was away, it missed 5 then started working again on it's own. `¯\\_(ツ)_/¯`",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/685299961/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/686821999",
    "html_url": "https://github.com/sigp/lighthouse/issues/1547#issuecomment-686821999",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547",
    "id": 686821999,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NjgyMTk5OQ==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-03T23:54:50Z",
    "updated_at": "2020-09-03T23:54:50Z",
    "author_association": "MEMBER",
    "body": "Can you confirm that most/all attestations where on the first slot of an epoch?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/686821999/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/686833372",
    "html_url": "https://github.com/sigp/lighthouse/issues/1547#issuecomment-686833372",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547",
    "id": 686833372,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4NjgzMzM3Mg==",
    "user": {
      "login": "jeffla",
      "id": 371277,
      "node_id": "MDQ6VXNlcjM3MTI3Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/371277?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jeffla",
      "html_url": "https://github.com/jeffla",
      "followers_url": "https://api.github.com/users/jeffla/followers",
      "following_url": "https://api.github.com/users/jeffla/following{/other_user}",
      "gists_url": "https://api.github.com/users/jeffla/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jeffla/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jeffla/subscriptions",
      "organizations_url": "https://api.github.com/users/jeffla/orgs",
      "repos_url": "https://api.github.com/users/jeffla/repos",
      "events_url": "https://api.github.com/users/jeffla/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jeffla/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-04T00:36:27Z",
    "updated_at": "2020-09-04T00:36:27Z",
    "author_association": "NONE",
    "body": "The last few were, but further back, last slot. One at slot 16.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/686833372/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/689247736",
    "html_url": "https://github.com/sigp/lighthouse/issues/1547#issuecomment-689247736",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1547",
    "id": 689247736,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY4OTI0NzczNg==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-09T01:47:11Z",
    "updated_at": "2020-09-09T01:47:11Z",
    "author_association": "MEMBER",
    "body": "This looks mostly resolved. We will be making a new lighthouse release shortly with the corrections. \r\n\r\n@alex3498 - If you see that weird CPU usage again, could you make a new issue and we will track it down. ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/689247736/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
