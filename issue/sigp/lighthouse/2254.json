{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/2254",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/2254/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/2254/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/2254/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/2254",
  "id": 828455329,
  "node_id": "MDU6SXNzdWU4Mjg0NTUzMjk=",
  "number": 2254,
  "title": "Restarting Lighthouse sometimes stalls due to in-use sockets",
  "user": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2336800125,
      "node_id": "MDU6TGFiZWwyMzM2ODAwMTI1",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/t%20Networking",
      "name": "t Networking",
      "color": "40E0D0",
      "default": false,
      "description": ""
    },
    {
      "id": 2490305065,
      "node_id": "MDU6TGFiZWwyNDkwMzA1MDY1",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/A1",
      "name": "A1",
      "color": "223184",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 11,
  "created_at": "2021-03-10T23:12:05Z",
  "updated_at": "2023-10-04T06:59:54Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nSome users have reported that Lighthouse cannot be restarted quickly due to TCP ports not being freed immediately after process exit. After a bit of research, it seems that this is a consequence of TCP's design, and that most operating systems wait 30-120 seconds after socket closure in order to avoid delayed packets being sent to a new listener. This thread has a good summary: https://stackoverflow.com/questions/3229860/what-is-the-meaning-of-so-reuseaddr-setsockopt-option-linux/3233022#3233022\r\n\r\nIf we establish that Lighthouse's networking stack is robust against delayed packets, we could opt into receiving them by setting the `SO_REUSEADDR` flag when binding TCP sockets. Actually doing this could be a bit tricky, because we might have to punch through Tokio & LibP2P's abstractions, but perhaps they already provide configuration options.\r\n\r\nUntil then, anyone who experiences issues rebinding sockets can wait out the `TIME_WAIT` period. You can see sockets in this state using a command like:\r\n\r\n```\r\nss --numeric -o state time-wait\r\n```\r\n\r\n## Version\r\n\r\nv1.1.3, likely v1.2.0 as well\r\n",
  "closed_by": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/2254/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 1
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/2254/timeline",
  "performed_via_github_app": null,
  "state_reason": "reopened"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/796275452",
    "html_url": "https://github.com/sigp/lighthouse/issues/2254#issuecomment-796275452",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2254",
    "id": 796275452,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc5NjI3NTQ1Mg==",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-10T23:15:58Z",
    "updated_at": "2021-03-10T23:15:58Z",
    "author_association": "MEMBER",
    "body": "This may also be the source of some CI failures:\r\n\r\n```\r\nMar 01 06:56:30.744 CRIT Unable to listen on libp2p address      listen_multiaddr: /ip4/0.0.0.0/tcp/42426, error: Other(Custom { kind: Other, error: Other(A(A(Underlying(Os { code: 98, kind: AddrInUse, message: \"Address already in use\" })))) }), service: libp2p, service: node_2\r\nthread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: \"Failed to start network: Error(Libp2p(Msg(\\\"Libp2p was unable to listen on the given listen address.\\\")), State { next_error: None, backtrace: InternalBacktrace { backtrace: None } })\"', testing/simulator/src/eth1_sim.rs:223:41\r\nnote: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\n```\r\n\r\n\r\nhttps://github.com/sigp/lighthouse/runs/2001822504?check_suite_focus=true",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/796275452/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/800552695",
    "html_url": "https://github.com/sigp/lighthouse/issues/2254#issuecomment-800552695",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2254",
    "id": 800552695,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwMDU1MjY5NQ==",
    "user": {
      "login": "pawanjay176",
      "id": 9890508,
      "node_id": "MDQ6VXNlcjk4OTA1MDg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/9890508?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pawanjay176",
      "html_url": "https://github.com/pawanjay176",
      "followers_url": "https://api.github.com/users/pawanjay176/followers",
      "following_url": "https://api.github.com/users/pawanjay176/following{/other_user}",
      "gists_url": "https://api.github.com/users/pawanjay176/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pawanjay176/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pawanjay176/subscriptions",
      "organizations_url": "https://api.github.com/users/pawanjay176/orgs",
      "repos_url": "https://api.github.com/users/pawanjay176/repos",
      "events_url": "https://api.github.com/users/pawanjay176/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pawanjay176/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-16T19:42:32Z",
    "updated_at": "2021-03-16T19:42:32Z",
    "author_association": "MEMBER",
    "body": "Turns out libp2p has `SO_REUSEADDR`  set for all its tcp sockets by default (https://github.com/libp2p/rust-libp2p/blob/master/transports/tcp/src/lib.rs#L330). \r\n\r\nFrom the socket [docs](https://man7.org/linux/man-pages/man7/socket.7.html) for `SO_REUSEADDR`\r\n\r\n> When the listening socket is bound to INADDR_ANY with a specific port then it is not possible to bind to this port for any local address.\r\n\r\nWe always bind to `0.0.0.0` in libp2p and I think that's why we sometimes see `AddrInUse` errors inspite of our sockets having the  `SO_REUSEADDR` option set. \r\n\r\nFrom what I have gathered from the stack overflow thread you linked above and https://stackoverflow.com/a/14388707/4914568\r\n, we can rebind the socket on `0.0.0.0: port` only after the closing socket atleast reaches `TIME_WAIT` state.\r\n\r\nMaybe ensuring that we close all libp2p listener streams(https://docs.rs/libp2p/0.35.1/libp2p/swarm/struct.ExpandedSwarm.html#method.remove_listener) before dropping libp2p would ensure that we don't have any hanging connections?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/800552695/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/814380994",
    "html_url": "https://github.com/sigp/lighthouse/issues/2254#issuecomment-814380994",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2254",
    "id": 814380994,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxNDM4MDk5NA==",
    "user": {
      "login": "remyroy",
      "id": 303593,
      "node_id": "MDQ6VXNlcjMwMzU5Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/303593?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/remyroy",
      "html_url": "https://github.com/remyroy",
      "followers_url": "https://api.github.com/users/remyroy/followers",
      "following_url": "https://api.github.com/users/remyroy/following{/other_user}",
      "gists_url": "https://api.github.com/users/remyroy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/remyroy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/remyroy/subscriptions",
      "organizations_url": "https://api.github.com/users/remyroy/orgs",
      "repos_url": "https://api.github.com/users/remyroy/repos",
      "events_url": "https://api.github.com/users/remyroy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/remyroy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-06T19:25:07Z",
    "updated_at": "2021-04-06T19:34:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "Properly closing all connections and using `SO_REUSEADDR` would really be useful for an update process with minimal downtime (stopping services, updating binary, restarting services).",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/814380994/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/819199457",
    "html_url": "https://github.com/sigp/lighthouse/issues/2254#issuecomment-819199457",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2254",
    "id": 819199457,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxOTE5OTQ1Nw==",
    "user": {
      "login": "remyroy",
      "id": 303593,
      "node_id": "MDQ6VXNlcjMwMzU5Mw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/303593?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/remyroy",
      "html_url": "https://github.com/remyroy",
      "followers_url": "https://api.github.com/users/remyroy/followers",
      "following_url": "https://api.github.com/users/remyroy/following{/other_user}",
      "gists_url": "https://api.github.com/users/remyroy/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/remyroy/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/remyroy/subscriptions",
      "organizations_url": "https://api.github.com/users/remyroy/orgs",
      "repos_url": "https://api.github.com/users/remyroy/repos",
      "events_url": "https://api.github.com/users/remyroy/events{/privacy}",
      "received_events_url": "https://api.github.com/users/remyroy/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-14T03:19:20Z",
    "updated_at": "2021-04-14T03:19:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "I just upgraded to v1.3.0 and I did not have this issue compared to recent previous versions. Was this recently fixed?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/819199457/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/819220554",
    "html_url": "https://github.com/sigp/lighthouse/issues/2254#issuecomment-819220554",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2254",
    "id": 819220554,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgxOTIyMDU1NA==",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-04-14T04:33:40Z",
    "updated_at": "2021-04-14T04:33:40Z",
    "author_association": "MEMBER",
    "body": "> I just upgraded to v1.3.0 and I did not have this issue compared to recent previous versions. Was this recently fixed?\r\n\r\nNot as far as I'm aware. As @pawanjay176 pointed out we're already using `SO_REUSEADDR`, so there must be something else at play (and maybe only in some cases, like if there are certain connections in use when the process exits).\r\n\r\nWe could maybe try `SO_REUSEPORT` instead, as it seems to be the more modern flag. Or as Pawan says, see if we can trace the issue to an unclosed libp2p stream.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/819220554/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/983080855",
    "html_url": "https://github.com/sigp/lighthouse/issues/2254#issuecomment-983080855",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2254",
    "id": 983080855,
    "node_id": "IC_kwDOCFeAzc46mJ-X",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-30T22:34:36Z",
    "updated_at": "2021-11-30T22:34:36Z",
    "author_association": "MEMBER",
    "body": "We've had a number of version updates since this, I've not witnessed this issue. Lets re-open if it arises again.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/983080855/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1294383150",
    "html_url": "https://github.com/sigp/lighthouse/issues/2254#issuecomment-1294383150",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2254",
    "id": 1294383150,
    "node_id": "IC_kwDOCFeAzc5NJrgu",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-28T02:56:22Z",
    "updated_at": "2022-10-28T02:56:22Z",
    "author_association": "MEMBER",
    "body": "Several users have reported seeing this recently so I'm going to reopen it (related GitHub issue: <https://github.com/sigp/lighthouse/issues/3500>).",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1294383150/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1746240419",
    "html_url": "https://github.com/sigp/lighthouse/issues/2254#issuecomment-1746240419",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2254",
    "id": 1746240419,
    "node_id": "IC_kwDOCFeAzc5oFYOj",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-04T06:47:42Z",
    "updated_at": "2023-10-04T06:47:42Z",
    "author_association": "NONE",
    "body": "Still borked\r\n\r\n```\r\nOct 04 06:42:28.585 CRIT Failed to start beacon node             reason: Failed to start network: Error(Libp2p(Msg(\"Io(Os { code: 48, kind: AddrInUse, message: \\\"Address already in use\\\" })\")), State { next_error: None, backtrace: InternalBacktrace { backtrace: Some(   0: backtrace::capture::Backtrace::new_unresolved\r\n   1: error_chain::backtrace::imp::InternalBacktrace::new\r\n   2: <error_chain::State as core::default::Default>::default\r\n   3: <lighthouse_network::types::error::Error as core::convert::From<alloc::string::String>>::from\r\n   4: lighthouse_network::service::Network<AppReqId,TSpec>::new::{{closure}}\r\n   5: beacon_node::ProductionBeaconNode<E>::new::{{closure}}\r\n   6: <futures_util::future::select::Select<A,B> as core::future::future::Future>::poll\r\n   7: <futures_util::future::future::map::Map<Fut,F> as core::future::future::Future>::poll\r\n   8: <futures_util::future::future::flatten::Flatten<Fut,<Fut as core::future::future::Future>::Output> as core::future::future::Future>::poll\r\n   9: tokio::runtime::task::core::Core<T,S>::poll\r\n  10: tokio::runtime::task::harness::Harness<T,S>::poll\r\n  11: tokio::runtime::scheduler::multi_thread::worker::Context::run_task\r\n  12: tokio::runtime::context::scoped::Scoped<T>::set\r\n  13: tokio::runtime::context::runtime::enter_runtime\r\n  14: tokio::runtime::scheduler::multi_thread::worker::run\r\n  15: <core::panic::unwind_safe::AssertUnwindSafe<F> as core::ops::function::FnOnce<()>>::call_once\r\n  16: tokio::runtime::task::harness::Harness<T,S>::poll\r\n  17: tokio::runtime::blocking::pool::Inner::run\r\n  18: std::sys_common::backtrace::__rust_begin_short_backtrace\r\n  19: core::ops::function::FnOnce::call_once{{vtable.shim}}\r\n  20: std::sys::unix::thread::Thread::new::thread_start\r\n  21: __pthread_joiner_wake\r\n) } })\r\n```\r\n\r\nI've stopped lighthouse half a day ago and can't start it back up, just keeps failing with this.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1746240419/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1746248116",
    "html_url": "https://github.com/sigp/lighthouse/issues/2254#issuecomment-1746248116",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2254",
    "id": 1746248116,
    "node_id": "IC_kwDOCFeAzc5oFaG0",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-04T06:54:09Z",
    "updated_at": "2023-10-04T06:54:09Z",
    "author_association": "MEMBER",
    "body": "@karalabe Half a day seems too long for socket reuse. Are you 100% you don't have something listening on 9000/9001? Since v4.5.0 we also listen on 9001 UDP for QUIC.\r\n\r\nIf there's something listening, it should show under `lsof`:\r\n\r\n```\r\nsudo lsof -nP -iTCP -sTCP:LISTEN\r\nsudo lsof -nP -iUDP\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1746248116/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1746252560",
    "html_url": "https://github.com/sigp/lighthouse/issues/2254#issuecomment-1746252560",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2254",
    "id": 1746252560,
    "node_id": "IC_kwDOCFeAzc5oFbMQ",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-04T06:57:56Z",
    "updated_at": "2023-10-04T06:57:56Z",
    "author_association": "NONE",
    "body": "This seems weird. Seems there's a \"thing\" in macos, where sometimes a UDP port survives the owner process terminating... and there seems to be no way of closing it afterwards.\r\n\r\nWith netstat, I can indeed see UDP 9000 open:\r\n\r\n```\r\nudp4  309463      0  *.9000                                        *.*\r\n```\r\n\r\nHowever, lsof does not find port 9000 assigned to any process.\r\n\r\nSeems this thing is a recurring event on macos and there's no real answer anywhere: https://stackoverflow.com/questions/40512274/release-udp-port-used-by-dead-process-on-os-x",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1746252560/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 1,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1746254948",
    "html_url": "https://github.com/sigp/lighthouse/issues/2254#issuecomment-1746254948",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2254",
    "id": 1746254948,
    "node_id": "IC_kwDOCFeAzc5oFbxk",
    "user": {
      "login": "karalabe",
      "id": 129561,
      "node_id": "MDQ6VXNlcjEyOTU2MQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/129561?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/karalabe",
      "html_url": "https://github.com/karalabe",
      "followers_url": "https://api.github.com/users/karalabe/followers",
      "following_url": "https://api.github.com/users/karalabe/following{/other_user}",
      "gists_url": "https://api.github.com/users/karalabe/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/karalabe/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/karalabe/subscriptions",
      "organizations_url": "https://api.github.com/users/karalabe/orgs",
      "repos_url": "https://api.github.com/users/karalabe/repos",
      "events_url": "https://api.github.com/users/karalabe/events{/privacy}",
      "received_events_url": "https://api.github.com/users/karalabe/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-10-04T06:59:53Z",
    "updated_at": "2023-10-04T06:59:53Z",
    "author_association": "NONE",
    "body": "Hah, dafuq https://github.com/ethereum/go-ethereum/issues/18443",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1746254948/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 1
    },
    "performed_via_github_app": null
  }
]
