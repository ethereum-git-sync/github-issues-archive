{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/748",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/748/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/748/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/748/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/748",
  "id": 540758573,
  "node_id": "MDU6SXNzdWU1NDA3NTg1NzM=",
  "number": 748,
  "title": "Docker image is to large",
  "user": {
    "login": "mkinney",
    "id": 2219838,
    "node_id": "MDQ6VXNlcjIyMTk4Mzg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2219838?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mkinney",
    "html_url": "https://github.com/mkinney",
    "followers_url": "https://api.github.com/users/mkinney/followers",
    "following_url": "https://api.github.com/users/mkinney/following{/other_user}",
    "gists_url": "https://api.github.com/users/mkinney/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mkinney/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mkinney/subscriptions",
    "organizations_url": "https://api.github.com/users/mkinney/orgs",
    "repos_url": "https://api.github.com/users/mkinney/repos",
    "events_url": "https://api.github.com/users/mkinney/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mkinney/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2019-12-20T04:54:11Z",
  "updated_at": "2019-12-20T12:17:44Z",
  "closed_at": "2019-12-20T12:17:44Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nIf we utilize multi-stage builds, we can shrink the docker image from 1.87GB to something much smaller.\r\n\r\n## Present Behaviour\r\n\r\nWhen you run `docker build .` you get a very large docker image.\r\n\r\n## Expected Behaviour\r\n\r\nSmaller is better.\r\n\r\n## Steps to resolve\r\n\r\n`docker build .` will build the docker image locally\r\n`docker images` will show size\r\n",
  "closed_by": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/748/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/748/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/567787919",
    "html_url": "https://github.com/sigp/lighthouse/issues/748#issuecomment-567787919",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/748",
    "id": 567787919,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2Nzc4NzkxOQ==",
    "user": {
      "login": "mkinney",
      "id": 2219838,
      "node_id": "MDQ6VXNlcjIyMTk4Mzg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2219838?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mkinney",
      "html_url": "https://github.com/mkinney",
      "followers_url": "https://api.github.com/users/mkinney/followers",
      "following_url": "https://api.github.com/users/mkinney/following{/other_user}",
      "gists_url": "https://api.github.com/users/mkinney/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mkinney/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mkinney/subscriptions",
      "organizations_url": "https://api.github.com/users/mkinney/orgs",
      "repos_url": "https://api.github.com/users/mkinney/repos",
      "events_url": "https://api.github.com/users/mkinney/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mkinney/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-20T04:58:35Z",
    "updated_at": "2019-12-20T05:00:52Z",
    "author_association": "CONTRIBUTOR",
    "body": "Research:\r\n\r\n``` docker images | grep sigp\r\nsigp/lighthouse                           latest              cff168b65387        4 hours ago         1.87GB\r\n```\r\nDockerfile is based on `rust:1.39.0`\r\n\r\n`$ docker run -it sigp/lighthouse bash\r\nroot@ab301c12be23:/# cat /etc/os-release\r\nPRETTY_NAME=\"Debian GNU/Linux 10 (buster)\"\r\nNAME=\"Debian GNU/Linux\"\r\nVERSION_ID=\"10\"\r\nVERSION=\"10 (buster)\"\r\nVERSION_CODENAME=buster\r\nID=debian\r\nHOME_URL=\"https://www.debian.org/\"\r\nSUPPORT_URL=\"https://www.debian.org/support\"\r\nBUG_REPORT_URL=\"https://bugs.debian.org/\"`\r\n\r\ndebian has a buster-slim which is only 69mb\r\n\r\n`$ docker images | grep slim\r\ndebian                                    buster-slim         2dbffcb4f093        3 weeks ago         69.2MB`\r\n\r\nThe lighthouse binary is only 37mb:\r\n`# ls -alh /usr/local/cargo/bin/lighthouse\r\n-rwxr-xr-x 1 root root 37M Dec 20 04:40 /usr/local/cargo/bin/lighthouse`\r\n\r\nNote: If we switch to using alpine we might be able to shave another 60mb.\r\n\r\n`$ docker images alpine\r\nREPOSITORY          TAG                 IMAGE ID            CREATED             SIZE\r\nalpine              latest              965ea09ff2eb        8 weeks ago         5.55MB`",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/567787919/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/567788020",
    "html_url": "https://github.com/sigp/lighthouse/issues/748#issuecomment-567788020",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/748",
    "id": 567788020,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2Nzc4ODAyMA==",
    "user": {
      "login": "mkinney",
      "id": 2219838,
      "node_id": "MDQ6VXNlcjIyMTk4Mzg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2219838?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mkinney",
      "html_url": "https://github.com/mkinney",
      "followers_url": "https://api.github.com/users/mkinney/followers",
      "following_url": "https://api.github.com/users/mkinney/following{/other_user}",
      "gists_url": "https://api.github.com/users/mkinney/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mkinney/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mkinney/subscriptions",
      "organizations_url": "https://api.github.com/users/mkinney/orgs",
      "repos_url": "https://api.github.com/users/mkinney/repos",
      "events_url": "https://api.github.com/users/mkinney/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mkinney/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-20T04:59:12Z",
    "updated_at": "2019-12-20T04:59:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "I should have a PR shortly.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/567788020/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/567789318",
    "html_url": "https://github.com/sigp/lighthouse/issues/748#issuecomment-567789318",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/748",
    "id": 567789318,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2Nzc4OTMxOA==",
    "user": {
      "login": "mkinney",
      "id": 2219838,
      "node_id": "MDQ6VXNlcjIyMTk4Mzg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2219838?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mkinney",
      "html_url": "https://github.com/mkinney",
      "followers_url": "https://api.github.com/users/mkinney/followers",
      "following_url": "https://api.github.com/users/mkinney/following{/other_user}",
      "gists_url": "https://api.github.com/users/mkinney/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mkinney/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mkinney/subscriptions",
      "organizations_url": "https://api.github.com/users/mkinney/orgs",
      "repos_url": "https://api.github.com/users/mkinney/repos",
      "events_url": "https://api.github.com/users/mkinney/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mkinney/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-20T05:06:25Z",
    "updated_at": "2019-12-20T05:06:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "Looks like I can get it down to 138mb using debian:buster-slim.\r\n\r\n`Step 6/6 : COPY --from=builder /usr/local/cargo/bin/lighthouse /usr/local/bin/lighthouse\r\n ---> 659e7cf0d890\r\nSuccessfully built 659e7cf0d890\r\n\r\nmikekinneymbp:lighthouse mikekinney$ docker images\r\nREPOSITORY                                TAG                 IMAGE ID            CREATED             SIZE\r\n<none>                                    <none>              659e7cf0d890        12 seconds ago      138MB`",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/567789318/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/567789519",
    "html_url": "https://github.com/sigp/lighthouse/issues/748#issuecomment-567789519",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/748",
    "id": 567789519,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2Nzc4OTUxOQ==",
    "user": {
      "login": "mkinney",
      "id": 2219838,
      "node_id": "MDQ6VXNlcjIyMTk4Mzg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2219838?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mkinney",
      "html_url": "https://github.com/mkinney",
      "followers_url": "https://api.github.com/users/mkinney/followers",
      "following_url": "https://api.github.com/users/mkinney/following{/other_user}",
      "gists_url": "https://api.github.com/users/mkinney/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mkinney/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mkinney/subscriptions",
      "organizations_url": "https://api.github.com/users/mkinney/orgs",
      "repos_url": "https://api.github.com/users/mkinney/repos",
      "events_url": "https://api.github.com/users/mkinney/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mkinney/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-20T05:07:30Z",
    "updated_at": "2019-12-20T05:07:47Z",
    "author_association": "CONTRIBUTOR",
    "body": "```$ docker run -it 659e7cf0d890 lighthouse bn --http testnet -r quick 8 `date +%s`\r\nDec 20 05:07:16.146 WARN Ethereum 2.0 is pre-release. This software is experimental.\r\nDec 20 05:07:16.522 WARN Block production impaired               reason: dummy eth1 backend is enabled```",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/567789519/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/567905947",
    "html_url": "https://github.com/sigp/lighthouse/issues/748#issuecomment-567905947",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/748",
    "id": 567905947,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NzkwNTk0Nw==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-20T12:17:42Z",
    "updated_at": "2019-12-20T12:17:42Z",
    "author_association": "MEMBER",
    "body": "Resolved by #749 \r\n\r\nThank you @mkinney!",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/567905947/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
