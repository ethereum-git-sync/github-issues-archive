{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/287",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/287/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/287/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/287/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/287",
  "id": 418549861,
  "node_id": "MDU6SXNzdWU0MTg1NDk4NjE=",
  "number": 287,
  "title": "SignedRoot macro could be more flexible",
  "user": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 985647284,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODQ=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/enhancement",
      "name": "enhancement",
      "color": "a2eeef",
      "default": true,
      "description": "New feature or request"
    },
    {
      "id": 985647286,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODY=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/good%20first%20issue",
      "name": "good first issue",
      "color": "7057ff",
      "default": true,
      "description": "Good for newcomers"
    },
    {
      "id": 1141293876,
      "node_id": "MDU6TGFiZWwxMTQxMjkzODc2",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/work-started",
      "name": "work-started",
      "color": "e072ab",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2019-03-07T22:46:19Z",
  "updated_at": "2019-04-25T23:06:15Z",
  "closed_at": "2019-04-25T23:06:15Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nIn the `ssz_derive` crate, there is a `SignedRoot` macro which implements the `SignedRoot` trait.\r\n\r\n## Present Behaviour\r\n\r\nDefinition: `fn signed_root(&self) -> Hash256`\r\n\r\nThe macro will serialize each field until it finds one where the type path (e.g., `types::Signature`) ends with either `\"Signature\"` or `\"AggregateSignature\"`. Note: it's checking for the text, not the actual type -- a type alias will break the function.\r\n\r\n## Expected Behaviour\r\n\r\nNew definition `fn signed_root(&self, signature_field: String) -> Hash256`\r\n\r\nThe macro could build a function that determines which field to stop serialization at during runtime. Here's some pseudo-code that could be generated by the macro:\r\n\r\n```rust\r\nfn signed_root(&self, signature_field: String) -> Hash256 {\r\n    let mut should_continue = true;\r\n    \r\n    if (signature_field == \"one\") && should_continue {\r\n        // add `self.one` to root\r\n    } else { should_continue = false }\r\n    ...\r\n}\r\n```\r\n\r\n## Steps to resolve\r\n\r\n- Update the `SignedRoot` trait definition in the `ssz` crate.\r\n- Update the `SignedRoot` macro in the `ssz_derive` crate.\r\n- Update all uses of the `signed_root()` fn in the wider codebase.\r\n",
  "closed_by": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/287/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/287/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/473531149",
    "html_url": "https://github.com/sigp/lighthouse/issues/287#issuecomment-473531149",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/287",
    "id": 473531149,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MzUzMTE0OQ==",
    "user": {
      "login": "djrtwo",
      "id": 1433595,
      "node_id": "MDQ6VXNlcjE0MzM1OTU=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1433595?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/djrtwo",
      "html_url": "https://github.com/djrtwo",
      "followers_url": "https://api.github.com/users/djrtwo/followers",
      "following_url": "https://api.github.com/users/djrtwo/following{/other_user}",
      "gists_url": "https://api.github.com/users/djrtwo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/djrtwo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/djrtwo/subscriptions",
      "organizations_url": "https://api.github.com/users/djrtwo/orgs",
      "repos_url": "https://api.github.com/users/djrtwo/repos",
      "events_url": "https://api.github.com/users/djrtwo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/djrtwo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-16T13:41:38Z",
    "updated_at": "2019-03-16T13:41:38Z",
    "author_association": "NONE",
    "body": "note: `signature_field` is removed in v0.5.0. The convention is to have signature last and for `signed_root(obj)` to slice off the last field and do a`hash_tree_root`",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/473531149/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/473661806",
    "html_url": "https://github.com/sigp/lighthouse/issues/287#issuecomment-473661806",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/287",
    "id": 473661806,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3MzY2MTgwNg==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-17T12:40:51Z",
    "updated_at": "2019-03-17T12:40:51Z",
    "author_association": "MEMBER",
    "body": "Thanks Danny!\r\n\r\nGiven this, I think we should ditch my earlier proposal and use a field attribute to mark the \"stop hashing\" field.\r\n\r\nE.g.,\r\n\r\n```rust\r\n#[derive(SignedRoot)]\r\nstruct Things {\r\n  pub sign_this: Thing,\r\n  pub and_this: Thing,\r\n  #[signed_root(end)]\r\n  pub dont_sign_this: Signature,\r\n  pub or_this: Thing,\r\n}\r\n```\r\nExample: [this commit](https://github.com/sigp/lighthouse/pull/308/commits/01bfd386375f69e20bc157c8bc26217077b8e97b) allows test random to support the changes introduced in [this later commit](https://github.com/sigp/lighthouse/pull/308/commits/c648491c45fdf858c55006a57cd4b48db6e08a91).",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/473661806/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/476882043",
    "html_url": "https://github.com/sigp/lighthouse/issues/287#issuecomment-476882043",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/287",
    "id": 476882043,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3Njg4MjA0Mw==",
    "user": {
      "login": "seansu4you87",
      "id": 507797,
      "node_id": "MDQ6VXNlcjUwNzc5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/507797?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/seansu4you87",
      "html_url": "https://github.com/seansu4you87",
      "followers_url": "https://api.github.com/users/seansu4you87/followers",
      "following_url": "https://api.github.com/users/seansu4you87/following{/other_user}",
      "gists_url": "https://api.github.com/users/seansu4you87/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/seansu4you87/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/seansu4you87/subscriptions",
      "organizations_url": "https://api.github.com/users/seansu4you87/orgs",
      "repos_url": "https://api.github.com/users/seansu4you87/repos",
      "events_url": "https://api.github.com/users/seansu4you87/events{/privacy}",
      "received_events_url": "https://api.github.com/users/seansu4you87/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-26T22:46:05Z",
    "updated_at": "2019-03-26T22:46:05Z",
    "author_association": "CONTRIBUTOR",
    "body": "@paulhauner I'm interested in taking this on if no one else has started.\r\n\r\nJust to make sure I'm understanding this correctly, is the idea for only fields before #[signed_root(end)] to be used in a call to hash_tree_root?  So in your example of\r\n```\r\n#[derive(SignedRoot)]\r\nstruct Things {\r\n  pub sign_this: Thing,\r\n  pub and_this: Thing,\r\n  #[signed_root(end)]\r\n  pub dont_sign_this: Signature,\r\n  pub or_this: Thing,\r\n}\r\n```\r\n\r\nWe would only pass `sign_this` and `and_this` to `hash_tree_root` to get the signed root of a `Things` struct, and skip `dont_sign_this` and `or_this`?\r\n\r\nAre there structs you want me to apply this functionality to?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/476882043/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/477206019",
    "html_url": "https://github.com/sigp/lighthouse/issues/287#issuecomment-477206019",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/287",
    "id": 477206019,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzIwNjAxOQ==",
    "user": {
      "login": "mjkeating",
      "id": 7689372,
      "node_id": "MDQ6VXNlcjc2ODkzNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7689372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mjkeating",
      "html_url": "https://github.com/mjkeating",
      "followers_url": "https://api.github.com/users/mjkeating/followers",
      "following_url": "https://api.github.com/users/mjkeating/following{/other_user}",
      "gists_url": "https://api.github.com/users/mjkeating/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mjkeating/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mjkeating/subscriptions",
      "organizations_url": "https://api.github.com/users/mjkeating/orgs",
      "repos_url": "https://api.github.com/users/mjkeating/repos",
      "events_url": "https://api.github.com/users/mjkeating/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mjkeating/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-27T15:21:18Z",
    "updated_at": "2019-03-27T15:23:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "So, to get the hash_tree_root of an object we call `hash_tree_root` of its member structs and then `merkle_hash` the resulting list of hashes. This is currently done in the `TreeHash` macro in `szz_derive`. We should be able to add this change to the `TreeHash` macro. In the macro, we can simply stop hashing the object's member fields when we see the field name 'signature'.  So:\r\n\r\n```\r\nif fieldname == \"signature\" then stop_hashing_fields\r\n```\r\n  \r\nThis should work since the macro hashes the fields in the order in which they are declared in the object.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/477206019/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/477296822",
    "html_url": "https://github.com/sigp/lighthouse/issues/287#issuecomment-477296822",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/287",
    "id": 477296822,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzI5NjgyMg==",
    "user": {
      "login": "seansu4you87",
      "id": 507797,
      "node_id": "MDQ6VXNlcjUwNzc5Nw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/507797?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/seansu4you87",
      "html_url": "https://github.com/seansu4you87",
      "followers_url": "https://api.github.com/users/seansu4you87/followers",
      "following_url": "https://api.github.com/users/seansu4you87/following{/other_user}",
      "gists_url": "https://api.github.com/users/seansu4you87/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/seansu4you87/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/seansu4you87/subscriptions",
      "organizations_url": "https://api.github.com/users/seansu4you87/orgs",
      "repos_url": "https://api.github.com/users/seansu4you87/repos",
      "events_url": "https://api.github.com/users/seansu4you87/events{/privacy}",
      "received_events_url": "https://api.github.com/users/seansu4you87/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-27T18:37:28Z",
    "updated_at": "2019-03-27T18:37:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "@mjkeating I see, so the desired functionality is to stop hashing implicitly when we detect a field name in the struct named `signature`?\r\n\r\nIn terms of comparing the implicit stop based on a field name, vs an explicit `#[signed_root(end)]`, I personally think that the explicit annotation is preferable.  I feel like the implicit interface can lead to unexpected behavior and bugs for the user.  However, I don't have much context here, so I'm happy to either.  Thoughts?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/477296822/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/477324892",
    "html_url": "https://github.com/sigp/lighthouse/issues/287#issuecomment-477324892",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/287",
    "id": 477324892,
    "node_id": "MDEyOklzc3VlQ29tbWVudDQ3NzMyNDg5Mg==",
    "user": {
      "login": "mjkeating",
      "id": 7689372,
      "node_id": "MDQ6VXNlcjc2ODkzNzI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7689372?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mjkeating",
      "html_url": "https://github.com/mjkeating",
      "followers_url": "https://api.github.com/users/mjkeating/followers",
      "following_url": "https://api.github.com/users/mjkeating/following{/other_user}",
      "gists_url": "https://api.github.com/users/mjkeating/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mjkeating/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mjkeating/subscriptions",
      "organizations_url": "https://api.github.com/users/mjkeating/orgs",
      "repos_url": "https://api.github.com/users/mjkeating/repos",
      "events_url": "https://api.github.com/users/mjkeating/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mjkeating/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-03-27T19:59:41Z",
    "updated_at": "2019-03-27T19:59:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "Sure, using the annotation sounds good to me. ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/477324892/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
