{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/2045",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/2045/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/2045/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/2045/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/2045",
  "id": 756325455,
  "node_id": "MDU6SXNzdWU3NTYzMjU0NTU=",
  "number": 2045,
  "title": "Beacon can't connect to geth: EndpointError(FarBehind)",
  "user": {
    "login": "v3rm0n",
    "id": 1155022,
    "node_id": "MDQ6VXNlcjExNTUwMjI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1155022?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/v3rm0n",
    "html_url": "https://github.com/v3rm0n",
    "followers_url": "https://api.github.com/users/v3rm0n/followers",
    "following_url": "https://api.github.com/users/v3rm0n/following{/other_user}",
    "gists_url": "https://api.github.com/users/v3rm0n/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/v3rm0n/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/v3rm0n/subscriptions",
    "organizations_url": "https://api.github.com/users/v3rm0n/orgs",
    "repos_url": "https://api.github.com/users/v3rm0n/repos",
    "events_url": "https://api.github.com/users/v3rm0n/events{/privacy}",
    "received_events_url": "https://api.github.com/users/v3rm0n/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-12-03T15:56:52Z",
  "updated_at": "2020-12-03T17:07:17Z",
  "closed_at": "2020-12-03T17:07:17Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nStarted up everything using the sigp/lighthouse-docker project on mainnet. Waited geth to catch up, but beacon node is not starting up because it thinks that geth is behind.\r\n\r\n## Version\r\n\r\nsigp/lighthouse:latest Docker image (Lighthouse/v1.0.3-65dcdc36+)\r\nethereum/client-go:latest Docker image (Geth/v1.9.25-unstable-0b2f1446-20201202/linux-amd64/go1.15.5 )\r\n\r\n## Present Behaviour\r\n\r\nBeacon node not starting successfully because it can't find any eth1 nodes to use.\r\n\r\n## Expected Behaviour\r\n\r\nBeacon node should start because eth1 node is actually in sync.\r\n\r\nRunning on an Ubuntu VM in Proxmox.\r\n\r\nTimes are in UTC\r\n\r\nGeth\r\n```\r\nINFO [12-03|15:52:52.685] Imported new block headers               count=1   elapsed=6.134ms     number=11380581 hash=\"20b0d6…2665b3\"\r\nINFO [12-03|15:52:53.884] Imported new state entries               count=644 elapsed=1.262ms     processed=389759067 pending=10887 trieretry=0   coderetry=0 duplicate=0 unexpected=0\r\nINFO [12-03|15:52:58.067] Finished upgrading chain index           type=bloombits\r\nINFO [12-03|15:52:59.575] Imported new state entries               count=665 elapsed=1.480ms     processed=389759732 pending=11046 trieretry=4   coderetry=0 duplicate=0 unexpected=0\r\nINFO [12-03|15:52:59.996] Initializing fast sync bloom             items=164261033 errorrate=0.000 elapsed=7m1.841s\r\nINFO [12-03|15:53:03.743] Imported new state entries               count=329 elapsed=\"2.474µs\"   processed=389760061 pending=11392 trieretry=0   coderetry=0 duplicate=0 unexpected=0\r\nINFO [12-03|15:53:06.334] Imported new state entries               count=384 elapsed=\"708.848µs\" processed=389760445 pending=11652 trieretry=0   coderetry=0 duplicate=0 unexpected=0\r\nINFO [12-03|15:53:07.999] Initializing fast sync bloom             items=164280052 errorrate=0.000 elapsed=7m9.845s\r\nINFO [12-03|15:53:09.634] Imported new state entries               count=672 elapsed=1.563ms     processed=389761117 pending=11569 trieretry=0   coderetry=0 duplicate=0 unexpected=0\r\nWARN [12-03|15:53:10.976] Checkpoint challenge timed out, dropping id=5fda70deba6ee4ba conn=dyndial addr=8.130.26.108:30303    type=Geth/v1.9.24-stable-...\r\nINFO [12-03|15:53:13.017] Imported new state entries               count=282 elapsed=\"284.947µs\" processed=389761399 pending=11831 trieretry=0   coderetry=0 duplicate=0 unexpected=0\r\nINFO [12-03|15:53:15.999] Initializing fast sync bloom             items=164298390 errorrate=0.000 elapsed=7m17.845s\r\nINFO [12-03|15:53:17.067] Imported new state entries               count=692 elapsed=1.216ms     processed=389762091 pending=11969 trieretry=384 coderetry=0 duplicate=0 unexpected=0\r\n```\r\n\r\nBeacon\r\n\r\n```\r\nDec 03 15:53:02.676 WARN Remote eth1 node is not synced          endpoint: http://geth:8545, service: eth1_rpc\r\nDec 03 15:53:02.683 CRIT Couldn't connect to any eth1 node. Please ensure that you have an eth1 http server running locally on http://localhost:8545 or specify one or more (remote) endpoints using `--eth1-endpoints <COMMA-SEPARATED-SERVER-ADDRESSES>`. Also ensure that `eth` and `net` apis are enabled on the eth1 http server, warning: BLOCK PROPOSALS WILL FAIL WITHOUT VALID, SYNCED ETH1 CONNECTION, service: eth1_rpc\r\nDec 03 15:53:02.683 ERRO Failed to update eth1 cache             error: Failed to update Eth1 service: \"All fallback errored: http://geth:8545 => EndpointError(FarBehind)\", retry_millis: 7000, service: eth1_rpc\r\nDec 03 15:53:05.000 INFO Synced                                  slot: 15563, block: 0x22b6…bb8b, epoch: 486, finalized_epoch: 484, finalized_root: 0x1624…eeee, peers: 23, service: slot_notifier\r\nDec 03 15:53:05.001 WARN Syncing eth1 block cache                est_blocks_remaining: initializing deposits, msg: sync can take longer when using remote eth1 nodes, service: slot_notifier\r\nDec 03 15:53:09.680 WARN Remote eth1 node is not synced          endpoint: http://geth:8545, service: eth1_rpc\r\nDec 03 15:53:09.680 CRIT Couldn't connect to any eth1 node. Please ensure that you have an eth1 http server running locally on http://localhost:8545 or specify one or more (remote) endpoints using `--eth1-endpoints <COMMA-SEPARATED-SERVER-ADDRESSES>`. Also ensure that `eth` and `net` apis are enabled on the eth1 http server, warning: BLOCK PROPOSALS WILL FAIL WITHOUT VALID, SYNCED ETH1 CONNECTION, service: eth1_rpc\r\nDec 03 15:53:09.680 ERRO Failed to update eth1 cache             error: Failed to update Eth1 service: \"All fallback errored: http://geth:8545 => EndpointError(FarBehind)\", retry_millis: 7000, service: eth1_rpc\r\nDec 03 15:53:11.359 INFO New block received                      hash: 0x8016…984e, slot: 15564\r\nDec 03 15:53:16.674 WARN Remote eth1 node is not synced          endpoint: http://geth:8545, service: eth1_rpc\r\nDec 03 15:53:16.680 CRIT Couldn't connect to any eth1 node. Please ensure that you have an eth1 http server running locally on http://localhost:8545 or specify one or more (remote) endpoints using `--eth1-endpoints <COMMA-SEPARATED-SERVER-ADDRESSES>`. Also ensure that `eth` and `net` apis are enabled on the eth1 http server, warning: BLOCK PROPOSALS WILL FAIL WITHOUT VALID, SYNCED ETH1 CONNECTION, service: eth1_rpc\r\nDec 03 15:53:16.680 ERRO Failed to update eth1 cache             error: Failed to update Eth1 service: \"All fallback errored: http://geth:8545 => EndpointError(FarBehind)\", retry_millis: 7000, service: eth1_rpc\r\nDec 03 15:53:17.000 INFO Synced                                  slot: 15564, block: 0x8016…984e, epoch: 486, finalized_epoch: 484, finalized_root: 0x1624…eeee, peers: 22, service: slot_notifier\r\nDec 03 15:53:17.001 WARN Syncing eth1 block cache                est_blocks_remaining: initializing deposits, msg: sync can take longer when using remote eth1 nodes, service: slot_notifier\r\nDec 03 15:53:23.450 INFO New block received                      hash: 0xfe9e…e40d, slot: 15565\r\n```\r\n",
  "closed_by": {
    "login": "v3rm0n",
    "id": 1155022,
    "node_id": "MDQ6VXNlcjExNTUwMjI=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1155022?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/v3rm0n",
    "html_url": "https://github.com/v3rm0n",
    "followers_url": "https://api.github.com/users/v3rm0n/followers",
    "following_url": "https://api.github.com/users/v3rm0n/following{/other_user}",
    "gists_url": "https://api.github.com/users/v3rm0n/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/v3rm0n/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/v3rm0n/subscriptions",
    "organizations_url": "https://api.github.com/users/v3rm0n/orgs",
    "repos_url": "https://api.github.com/users/v3rm0n/repos",
    "events_url": "https://api.github.com/users/v3rm0n/events{/privacy}",
    "received_events_url": "https://api.github.com/users/v3rm0n/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/2045/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/2045/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/738121711",
    "html_url": "https://github.com/sigp/lighthouse/issues/2045#issuecomment-738121711",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2045",
    "id": 738121711,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczODEyMTcxMQ==",
    "user": {
      "login": "realbigsean",
      "id": 5160426,
      "node_id": "MDQ6VXNlcjUxNjA0MjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5160426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/realbigsean",
      "html_url": "https://github.com/realbigsean",
      "followers_url": "https://api.github.com/users/realbigsean/followers",
      "following_url": "https://api.github.com/users/realbigsean/following{/other_user}",
      "gists_url": "https://api.github.com/users/realbigsean/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/realbigsean/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/realbigsean/subscriptions",
      "organizations_url": "https://api.github.com/users/realbigsean/orgs",
      "repos_url": "https://api.github.com/users/realbigsean/repos",
      "events_url": "https://api.github.com/users/realbigsean/events{/privacy}",
      "received_events_url": "https://api.github.com/users/realbigsean/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-03T16:32:07Z",
    "updated_at": "2020-12-03T16:33:51Z",
    "author_association": "COLLABORATOR",
    "body": "Can you double check geth sync with: \r\n\r\n`curl --request POST 'http://localhost:8545' --header 'Content-type: application/json' --data-raw '{\"jsonrpc\":\"2.0\", \"method\":\"eth_syncing\", \"params\":[], \"id\":1}'`\r\n\r\nIf it's synced it should return:\r\n\r\n`{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":false}`\r\n\r\nIf you aren't synced yet and have an active validator, I'd suggest using something like Infura until you are synced",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/738121711/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/738143644",
    "html_url": "https://github.com/sigp/lighthouse/issues/2045#issuecomment-738143644",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2045",
    "id": 738143644,
    "node_id": "MDEyOklzc3VlQ29tbWVudDczODE0MzY0NA==",
    "user": {
      "login": "v3rm0n",
      "id": 1155022,
      "node_id": "MDQ6VXNlcjExNTUwMjI=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1155022?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/v3rm0n",
      "html_url": "https://github.com/v3rm0n",
      "followers_url": "https://api.github.com/users/v3rm0n/followers",
      "following_url": "https://api.github.com/users/v3rm0n/following{/other_user}",
      "gists_url": "https://api.github.com/users/v3rm0n/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/v3rm0n/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/v3rm0n/subscriptions",
      "organizations_url": "https://api.github.com/users/v3rm0n/orgs",
      "repos_url": "https://api.github.com/users/v3rm0n/repos",
      "events_url": "https://api.github.com/users/v3rm0n/events{/privacy}",
      "received_events_url": "https://api.github.com/users/v3rm0n/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-03T17:07:17Z",
    "updated_at": "2020-12-03T17:07:17Z",
    "author_association": "NONE",
    "body": "Thanks for the command I was looking for it in the docs but missed it :)\r\n\r\nRan it with some modifications since the endpoint is not exposed outside of the Docker network:\r\n\r\n```\r\n➜  lighthouse-docker git:(master) ✗ docker run -it --rm --network f184dab59e64 curlimages/curl --request POST 'http://geth:8545' --header 'Content-type: application/json' --data-raw '{ \"jsonrpc\":\"2.0\", \"method\":\"eth_syncing\", \"params\":[], \"id\":1 }'\r\n{\"jsonrpc\":\"2.0\",\"id\":1,\"result\":{\"currentBlock\":\"0xada809\",\"highestBlock\":\"0xada885\",\"knownStates\":\"0x18ecb8ad\",\"pulledStates\":\"0x18ebe4e9\",\"startingBlock\":\"0xada004\"}}\r\n```\r\nIt looks like it is quite close but keeps lagging behind and never catches up... \r\nSo I guess I need to understand what is going on with Geth instead. Probably related to the VM setup and how the SSD is configured, maybe it is not using its full potential.\r\n\r\nThanks a lot for the help! I will close the issue.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/738143644/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
