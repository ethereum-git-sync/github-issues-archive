{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3641",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3641/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3641/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3641/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3641",
  "id": 1408584863,
  "node_id": "I_kwDOCFeAzc5T9Uyf",
  "number": 3641,
  "title": "Validator fallback does not work when the execution engine is offline or unavailable",
  "user": {
    "login": "Spacesider",
    "id": 90861342,
    "node_id": "MDQ6VXNlcjkwODYxMzQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/90861342?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/Spacesider",
    "html_url": "https://github.com/Spacesider",
    "followers_url": "https://api.github.com/users/Spacesider/followers",
    "following_url": "https://api.github.com/users/Spacesider/following{/other_user}",
    "gists_url": "https://api.github.com/users/Spacesider/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/Spacesider/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/Spacesider/subscriptions",
    "organizations_url": "https://api.github.com/users/Spacesider/orgs",
    "repos_url": "https://api.github.com/users/Spacesider/repos",
    "events_url": "https://api.github.com/users/Spacesider/events{/privacy}",
    "received_events_url": "https://api.github.com/users/Spacesider/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2022-10-14T00:38:27Z",
  "updated_at": "2023-05-16T06:38:18Z",
  "closed_at": "2023-05-16T06:38:18Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nMy validator has multiple consensus node endpoints configured. The first being a Lighthouse-Nethermind pair, and the second being a Teku-Besu pair. The Lighthouse validator points to Lighthouse node as the primary, and the Teku node as the fallback.\r\n\r\nWhile performing an upgrade on my Nethermind node, I ran into issues and Nethermind was offline for roughly an hour. After it was back up, I discovered that I had missed attestations the entire time, this was despite having a Teku-Besu fallback both configured and running.\r\n\r\nIt appears that when the execution engine that is paired with Lighthouse goes offline (Or is otherwise unavailable), the lighthouse validator still attempts to use the lighthouse node despite it not being functional. (Side note, I have only tested this with Nethermind as the execution engine, however I would be happy to perform tests with all execution engines, but I will need some time to do this).\r\n\r\nPre-merge this wouldn't be a problem because you didn't need the execution engine to attest, but post-merge this has changed.\r\n\r\n## Version\r\n\r\nRunning https://github.com/sigp/lighthouse/releases/tag/v3.1.2 > lighthouse-v3.1.2-x86_64-unknown-linux-gnu.tar.gz\r\n\r\n## Present Behaviour\r\n\r\nAt current, the Lighthouse node presents itself as being available for a validator node when the execution node is offline. This prevents the validator from switching over to the other configured endpoint.\r\n\r\n## Expected Behaviour\r\n\r\nThe Lighthouse node should report itself as being something along the lines of \"offline\" or \"not in sync\" or \"unavailable\" when the paired execution engine is offline or unavailable. Because while it is in this state, it is unable to process attestations or block proposals. So for validating purposes, it is offline.\r\n\r\n## Steps to resolve\r\n\r\nN/A\r\n",
  "closed_by": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3641/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 1,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3641/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1278338269",
    "html_url": "https://github.com/sigp/lighthouse/issues/3641#issuecomment-1278338269",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3641",
    "id": 1278338269,
    "node_id": "IC_kwDOCFeAzc5MMeTd",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-10-14T00:55:08Z",
    "updated_at": "2022-10-14T00:55:08Z",
    "author_association": "MEMBER",
    "body": "Sorry you ran into this, it's a known problem with our fallback mechanism post-merge. We are tracking these issues via this tracking issue: https://github.com/sigp/lighthouse/issues/3613.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1278338269/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1549072920",
    "html_url": "https://github.com/sigp/lighthouse/issues/3641#issuecomment-1549072920",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3641",
    "id": 1549072920,
    "node_id": "IC_kwDOCFeAzc5cVPoY",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-05-16T06:38:18Z",
    "updated_at": "2023-05-16T06:38:18Z",
    "author_association": "MEMBER",
    "body": "Closing as dupe of #3613. The scenario described will be fixed by #4291",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1549072920/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
