{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/4746",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/4746/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/4746/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/4746/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/4746",
  "id": 1900902281,
  "node_id": "I_kwDOCFeAzc5xTXeJ",
  "number": 4746,
  "title": "[BUG] Node lost synchronisation during 20 minutes",
  "user": {
    "login": "rayanebel",
    "id": 15887095,
    "node_id": "MDQ6VXNlcjE1ODg3MDk1",
    "avatar_url": "https://avatars.githubusercontent.com/u/15887095?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rayanebel",
    "html_url": "https://github.com/rayanebel",
    "followers_url": "https://api.github.com/users/rayanebel/followers",
    "following_url": "https://api.github.com/users/rayanebel/following{/other_user}",
    "gists_url": "https://api.github.com/users/rayanebel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rayanebel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rayanebel/subscriptions",
    "organizations_url": "https://api.github.com/users/rayanebel/orgs",
    "repos_url": "https://api.github.com/users/rayanebel/repos",
    "events_url": "https://api.github.com/users/rayanebel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rayanebel/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-09-18T13:07:05Z",
  "updated_at": "2023-09-18T13:44:19Z",
  "closed_at": "2023-09-18T13:21:06Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nYesterday, between 06:31-06:50 a.m _(UTC)_ we missed attestations. After analyzing on our side, we realised that the beacon node connected to our validators was no longer in sync. \r\n\r\nAfter digging in the logs, we got the following entries\r\n\r\n```bash\r\n2023-09-17T08:23:24+02:00\tSep 17 06:23:24.217 INFO New block received                      root: 0x3f03c57c8122dfa1c8cffa1a52943c26767a65d66db31741a176efd89f1654d9, slot: 7342315\r\n2023-09-17T08:23:27+02:00\tSep 17 06:23:27.537 ERRO Failure verifying attestation for gossip, attestation_slot: 7342315, committee_index: 54, request_index: 0, error: UnknownHeadBlock { beacon_block_root: 0x3f03c57c8122dfa1c8cffa1a52943c26767a65d66db31741a176efd89f1654d9 }\r\n2023-09-17T08:23:27+02:00\tSep 17 06:23:27.537 WARN Error processing HTTP API request       method: POST, path: /eth/v1/beacon/pool/attestations, status: 400 Bad Request, elapsed: 232.074µs\r\n2023-09-17T08:23:29+02:00\tSep 17 06:23:29.000 INFO Synced                                  slot: 7342315, block: 0x3f03…54d9, epoch: 229447, finalized_epoch: 229445, finalized_root: 0x313c…2695, exec_hash: 0x04f9…534c (verified), peers: 88, service: slot_notifier\r\n2023-09-17T08:23:36+02:00\tSep 17 06:23:36.596 INFO New block received                      root: 0x57d1473b71a59a2154f6abb21486949324d9c300784fa52b9b3f5e067dd07505, slot: 7342316\r\n2023-09-17T08:23:41+02:00\tSep 17 06:23:41.000 INFO Synced                                  slot: 7342316, block:    …  empty, epoch: 229447, finalized_epoch: 229445, finalized_root: 0x313c…2695, exec_hash: 0x04f9…534c (verified), peers: 88, service: slot_notifier\r\n2023-09-17T08:23:44+02:00\tSep 17 06:23:44.001 WARN Did not advance head state              reason: Err(HeadMissingFromSnapshotCache(0x3f03c57c8122dfa1c8cffa1a52943c26767a65d66db31741a176efd89f1654d9)), service: state_advance\r\n2023-09-17T08:23:44+02:00\tSep 17 06:23:44.687 WARN Execution engine call failed            error: HttpClient(url: http://mainnet-geth-val-green-c-0.mainnet-geth-val-green-c:8551/, kind: timeout, detail: operation timed out), service: exec\r\n2023-09-17T08:23:44+02:00\tSep 17 06:23:44.687 WARN Error whilst processing payload status  error: Api { error: HttpClient(url: http://mainnet-geth-val-green-c-0.mainnet-geth-val-green-c:8551/, kind: timeout, detail: operation timed out) }, service: exec\r\n2023-09-17T08:23:51+02:00\tSep 17 06:23:51.054 ERRO Failure verifying attestation for gossip, attestation_slot: 7342317, committee_index: 12, request_index: 0, error: UnknownHeadBlock { beacon_block_root: 0xba37d38a98266bd0cae0addfea1e19606bdc934a08e9a5156c831a0d4432f3da }\r\n2023-09-17T08:23:51+02:00\tSep 17 06:23:51.054 WARN Error processing HTTP API request       method: POST, path: /eth/v1/beacon/pool/attestations, status: 400 Bad Request, elapsed: 248.964µs\r\n2023-09-17T08:23:51+02:00\tSep 17 06:23:51.054 ERRO Failure verifying attestation for gossip, attestation_slot: 7342317, committee_index: 46, request_index: 0, error: UnknownHeadBlock { beacon_block_root: 0xba37d38a98266bd0cae0addfea1e19606bdc934a08e9a5156c831a0d4432f3da }\r\n2023-09-17T08:23:51+02:00\tSep 17 06:23:51.054 WARN Error processing HTTP API request       method: POST, path: /eth/v1/beacon/pool/attestations, status: 400 Bad Request, elapsed: 183.053µs\r\n2023-09-17T08:23:53+02:00\tSep 17 06:23:53.000 INFO Synced                                  slot: 7342317, block:    …  empty, epoch: 229447, finalized_epoch: 229445, finalized_root: 0x313c…2695, exec_hash: 0x04f9…534c (verified), peers: 88, service: slot_notifier\r\n2023-09-17T08:23:54+02:00\tSep 17 06:23:54.458 WARN Execution engine call failed            error: HttpClient(url: http://mainnet-geth-val-green-c-0.mainnet-geth-val-green-c:8551/, kind: timeout, detail: operation timed out), service: exec\r\n2023-09-17T08:23:54+02:00\tSep 17 06:23:54.458 WARN Error whilst processing payload status  error: Api { error: HttpClient(url: http://mainnet-geth-val-green-c-0.mainnet-geth-val-green-c:8551/, kind: timeout, detail: operation timed out) }, service: exec\r\n2023-09-17T08:23:56+02:00\tSep 17 06:23:56.000 WARN Did not advance head state              reason: Err(HeadMissingFromSnapshotCache(0x3f03c57c8122dfa1c8cffa1a52943c26767a65d66db31741a176efd89f1654d9)), service: state_advance\r\n2023-09-17T08:24:05+02:00\tSep 17 06:24:05.000 INFO Synced                                  slot: 7342318, block:    …  empty, epoch: 229447, finalized_epoch: 229445, finalized_root: 0x313c…2695, exec_hash: 0x04f9…534c (verified), peers: 83, service: slot_notifier\r\n2023-09-17T08:24:08+02:00\tSep 17 06:24:08.000 WARN Did not advance head state              reason: Err(HeadMissingFromSnapshotCache(0x3f03c57c8122dfa1c8cffa1a52943c26767a65d66db31741a176efd89f1654d9)), service: state_advance\r\n2023-09-17T08:24:15+02:00\tSep 17 06:24:15.056 ERRO Failure verifying attestation for gossip, attestation_slot: 7342319, committee_index: 12, request_index: 0, error: UnknownHeadBlock { beacon_block_root: 0x847dc0597a3daa65a56a8b55b0ef6393a2b703a506138855d71eaae95b66b722 }\r\n2023-09-17T08:24:15+02:00\tSep 17 06:24:15.056 WARN Error processing HTTP API request       method: POST, path: /eth/v1/beacon/pool/attestations, status: 400 Bad Request, elapsed: 193.613µs\r\n2023-09-17T08:24:17+02:00\tSep 17 06:24:17.000 INFO Synced                                  slot: 7342319, block:    …  empty, epoch: 229447, finalized_epoch: 229445, finalized_root: 0x313c…2695, exec_hash: 0x04f9…534c (verified), peers: 88, service: slot_notifier\r\n2023-09-17T08:24:20+02:00\tSep 17 06:24:20.000 WARN Did not advance head state              reason: Err(HeadMissingFromSnapshotCache(0x3f03c57c8122dfa1c8cffa1a52943c26767a65d66db31741a176efd89f1654d9)), service: state_advance\r\n2023-09-17T08:24:27+02:00\tSep 17 06:24:27.033 ERRO Failure verifying attestation for gossip, attestation_slot: 7342320, committee_index: 10, request_index: 0, error: UnknownHeadBlock { beacon_block_root: 0x4a98866e69b798a14ec3e8f8c043528e2fc949498ba8a11af3ac868b892b4aad }\r\n2023-09-17T08:24:27+02:00\tSep 17 06:24:27.033 WARN Error processing HTTP API request       method: POST, path: /eth/v1/beacon/pool/attestations, status: 400 Bad Request, elapsed: 213.084µs\r\n2023-09-17T08:24:29+02:00\tSep 17 06:24:29.000 INFO Synced                                  slot: 7342320, block:    …  empty, epoch: 229447, finalized_epoch: 229445, finalized_root: 0x313c…2695, exec_hash: 0x04f9…534c (verified), peers: 88, service: slot_notifier\r\n2023-09-17T08:24:41+02:00\tSep 17 06:24:41.000 INFO Synced                                  slot: 7342321, block:    …  empty, epoch: 229447, finalized_epoch: 229445, finalized_root: 0x313c…2695, exec_hash: 0x04f9…534c (verified), peers: 88, service: slot_notifier\r\n2023-09-17T08:24:53+02:00\tSep 17 06:24:53.000 INFO Synced                                  slot: 7342322, block:    …  empty, epoch: 229447, finalized_epoch: 229445, finalized_root: 0x313c…2695, exec_hash: 0x04f9…534c (verified), peers: 88, service: slot_notifier\r\n2023-09-17T08:25:01+02:00\tSep 17 06:25:01.461 INFO New RPC block received                  hash: 0x57d1…7505, slot: 7342316\r\n2023-09-17T08:25:05+02:00\tSep 17 06:25:05.000 INFO Synced                                  slot: 7342323, block:    …  empty, epoch: 229447, finalized_epoch: 229445, finalized_root: 0x313c…2695, exec_hash: 0x04f9…534c (verified), peers: 84, service: slot_notifier\r\n2023-09-17T08:25:17+02:00\tSep 17 06:25:17.000 INFO Synced                                  slot: 7342324, block:    …  empty, epoch: 229447, finalized_epoch: 229445, finalized_root: 0x313c…2695, exec_hash: 0xba56…f777 (verified), peers: 88, service: slot_notifier\r\n2023-09-17T08:25:29+02:00\tSep 17 06:25:29.000 INFO Synced                                  slot: 7342325, block:    …  empty, epoch: 229447, finalized_epoch: 229445, finalized_root: 0x313c…2695, exec_hash: 0x6b93…ad9f (verified), peers: 88, service: slot_notifier\r\n```\r\n## Present Behaviour\r\n\r\nWithout any action on our side, the beacon node was self-healing after ~ 20 minutes.\r\n\r\n## Version\r\n\r\n`v4.3.0` running on Kubernetes\r\n",
  "closed_by": {
    "login": "rayanebel",
    "id": 15887095,
    "node_id": "MDQ6VXNlcjE1ODg3MDk1",
    "avatar_url": "https://avatars.githubusercontent.com/u/15887095?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rayanebel",
    "html_url": "https://github.com/rayanebel",
    "followers_url": "https://api.github.com/users/rayanebel/followers",
    "following_url": "https://api.github.com/users/rayanebel/following{/other_user}",
    "gists_url": "https://api.github.com/users/rayanebel/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rayanebel/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rayanebel/subscriptions",
    "organizations_url": "https://api.github.com/users/rayanebel/orgs",
    "repos_url": "https://api.github.com/users/rayanebel/repos",
    "events_url": "https://api.github.com/users/rayanebel/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rayanebel/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/4746/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/4746/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1723444321",
    "html_url": "https://github.com/sigp/lighthouse/issues/4746#issuecomment-1723444321",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4746",
    "id": 1723444321,
    "node_id": "IC_kwDOCFeAzc5muaxh",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-18T13:44:19Z",
    "updated_at": "2023-09-18T13:44:19Z",
    "author_association": "MEMBER",
    "body": "If you haven't already, try v4.4.1. We adjusted the scheduling of tasks in order to prevent high-priority work from being starved, which we think was leading to the node falling behind like this.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1723444321/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
