{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/698",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/698/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/698/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/698/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/698",
  "id": 536004108,
  "node_id": "MDU6SXNzdWU1MzYwMDQxMDg=",
  "number": 698,
  "title": "Block processing error gets sync in bad state?",
  "user": {
    "login": "ethers",
    "id": 6937903,
    "node_id": "MDQ6VXNlcjY5Mzc5MDM=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6937903?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ethers",
    "html_url": "https://github.com/ethers",
    "followers_url": "https://api.github.com/users/ethers/followers",
    "following_url": "https://api.github.com/users/ethers/following{/other_user}",
    "gists_url": "https://api.github.com/users/ethers/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ethers/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ethers/subscriptions",
    "organizations_url": "https://api.github.com/users/ethers/orgs",
    "repos_url": "https://api.github.com/users/ethers/repos",
    "events_url": "https://api.github.com/users/ethers/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ethers/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2019-12-10T21:27:44Z",
  "updated_at": "2019-12-16T01:38:43Z",
  "closed_at": "2019-12-16T01:38:43Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nSyncing was going well, and then a Block processing error appears to have prevented syncing from making progress: the distance starts increasing.\r\n\r\n## Present Behaviour\r\n\r\nAbove.\r\nerror: \"Block at slot 29828 has an unknown parent.\"\r\n\r\n## Expected Behaviour\r\n\r\nAfter a Block processing error or bad peer, I would expect that the node would still be able to sync from the available peers, without needing any user interaction or restart of the node.\r\n\r\n## Steps to resolve\r\n\r\nRestart the bn?  Is it necessary?\r\n\r\nDec 10 21:12:18.028 INFO Syncing                                 distance: 284 slots (57 mins), speed: 2.08 slots/sec, est_time: 2 mins, peers: 10, service: slot_notifier\r\nDec 10 21:12:30.018 INFO Syncing                                 distance: 235 slots (47 mins), speed: 3.13 slots/sec, est_time: 1 mins, peers: 10, service: slot_notifier\r\nDec 10 21:12:42.047 INFO Syncing                                 distance: 186 slots (37 mins), speed: 3.12 slots/sec, est_time: 1 mins, peers: 10, service: slot_notifier\r\nDec 10 21:12:53.061 WARN Block processing error                  error: \"Block at slot 29828 has an unknown parent.\", service: sync, service: network\r\nDec 10 21:12:53.062 WARN Disconnecting peer (RPC)                peer_id: PeerId(\"16Uiu2HAmP9XftLpupbPJqGEmVxnsP6xGn45XuKPvJvEAFS7o1U1C\"), reason: Fault, service: sync, service: network\r\nDec 10 21:12:53.063 WARN Disconnecting peer (RPC)                peer_id: PeerId(\"16Uiu2HAm3bThwnr6GMM3W9pT82ukNMnzieefP5jg4B3twBqdJTck\"), reason: Fault, service: sync, service: network\r\nDec 10 21:12:53.064 WARN Disconnecting peer (RPC)                peer_id: PeerId(\"16Uiu2HAm8H7k75DyY2s63LuJetxKDHe6ZHN9acaH1H2ew2MqjpQv\"), reason: Fault, service: sync, service: network\r\nDec 10 21:12:53.065 WARN Disconnecting peer (RPC)                peer_id: PeerId(\"16Uiu2HAkuUVrmoygG3ZSkNwBW2PuQmgHnVoQwL5XE7LmWvza7TBx\"), reason: Fault, service: sync, service: network\r\nDec 10 21:12:53.066 ERRO Disconnecting and banning peer          timeout: 30s, peer_id: PeerId(\"16Uiu2HAmP9XftLpupbPJqGEmVxnsP6xGn45XuKPvJvEAFS7o1U1C\"), service: network\r\nDec 10 21:12:53.067 ERRO Disconnecting and banning peer          timeout: 30s, peer_id: PeerId(\"16Uiu2HAm3bThwnr6GMM3W9pT82ukNMnzieefP5jg4B3twBqdJTck\"), service: network\r\nDec 10 21:12:53.067 ERRO Disconnecting and banning peer          timeout: 30s, peer_id: PeerId(\"16Uiu2HAm8H7k75DyY2s63LuJetxKDHe6ZHN9acaH1H2ew2MqjpQv\"), service: network\r\nDec 10 21:12:53.068 ERRO Disconnecting and banning peer          timeout: 30s, peer_id: PeerId(\"16Uiu2HAkuUVrmoygG3ZSkNwBW2PuQmgHnVoQwL5XE7LmWvza7TBx\"), service: network\r\nDec 10 21:12:54.026 INFO Syncing                                 distance: 141 slots (28 mins), speed: 3.04 slots/sec, est_time: 1 mins, peers: 6, service: slot_notifier\r\nDec 10 21:13:06.017 INFO Syncing                                 distance: 142 slots (28 mins), speed: 3.04 slots/sec, est_time: 1 mins, peers: 6, service: slot_notifier\r\nDec 10 21:13:18.021 INFO Syncing                                 distance: 143 slots (29 mins), speed: 2.00 slots/sec, est_time: 1 mins, peers: 7, service: slot_notifier\r\nDec 10 21:13:27.568 WARN Block processing error                  error: \"Block at slot 29888 has an unknown parent.\", service: sync, service: network\r\nDec 10 21:13:27.570 WARN Disconnecting peer (RPC)                peer_id: PeerId(\"16Uiu2HAmEpez9kLtgy489JJFKYpCSv3mJdzrJRFca1kpYT8GtcSG\"), reason: Fault, service: sync, service: network\r\nDec 10 21:13:27.576 WARN Disconnecting peer (RPC)                peer_id: PeerId(\"16Uiu2HAm3bThwnr6GMM3W9pT82ukNMnzieefP5jg4B3twBqdJTck\"), reason: Fault, service: sync, service: network\r\nDec 10 21:13:27.581 ERRO Disconnecting and banning peer          timeout: 30s, peer_id: PeerId(\"16Uiu2HAmEpez9kLtgy489JJFKYpCSv3mJdzrJRFca1kpYT8GtcSG\"), service: network\r\nDec 10 21:13:27.582 ERRO Disconnecting and banning peer          timeout: 30s, peer_id: PeerId(\"16Uiu2HAm3bThwnr6GMM3W9pT82ukNMnzieefP5jg4B3twBqdJTck\"), service: network\r\nDec 10 21:13:30.026 INFO Syncing                                 distance: 144 slots (29 mins), speed: 0.96 slots/sec, est_time: 2 mins, peers: 6, service: slot_notifier\r\nDec 10 21:13:42.017 INFO Syncing                                 distance: 145 slots (29 mins), speed: 0.00 slots/sec, est_time: inf weeks NaN days, peers: 6, service: slot_notifier\r\nDec 10 21:13:54.018 INFO Syncing                                 distance: 146 slots (29 mins), speed: 0.00 slots/sec, est_time: inf weeks NaN days, peers: 6, service: slot_notifier\r\nDec 10 21:14:06.027 INFO Syncing                                 distance: 147 slots (29 mins), speed: 0.00 slots/sec, est_time: inf weeks NaN days, peers: 6, service: slot_notifier\r\nDec 10 21:14:18.024 INFO Syncing                                 distance: 148 slots (30 mins), speed: 0.00 slots/sec, est_time: inf weeks NaN days, peers: 6, service: slot_notifier\r\nDec 10 21:14:30.020 INFO Syncing                                 distance: 149 slots (30 mins), speed: 0.00 slots/sec, est_time: inf weeks NaN days, peers: 6, service: slot_notifier\r\nDec 10 21:14:42.019 INFO Syncing                                 distance: 150 slots (30 mins), speed: 0.00 slots/sec, est_time: inf weeks NaN days, peers: 6, service: slot_notifier\r\nDec 10 21:14:54.024 INFO Syncing                                 distance: 151 slots (30 mins), speed: 0.00 slots/sec, est_time: inf weeks NaN days, peers: 6, service: slot_notifier\r\nDec 10 21:15:06.017 INFO Syncing                                 distance: 152 slots (30 mins), speed: 0.00 slots/sec, est_time: inf weeks NaN days, peers: 6, service: slot_notifier\r\nDec 10 21:15:18.020 INFO Syncing                                 distance: 153 slots (31 mins), speed: 0.00 slots/sec, est_time: inf weeks NaN days, peers: 6, service: slot_notifier\r\nDec 10 21:15:30.019 INFO Syncing                                 distance: 154 slots (31 mins), speed: 0.00 slots/sec, est_time: inf weeks NaN days, peers: 6, service: slot_notifier\r\n",
  "closed_by": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/698/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/698/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/564282041",
    "html_url": "https://github.com/sigp/lighthouse/issues/698#issuecomment-564282041",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/698",
    "id": 564282041,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NDI4MjA0MQ==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-10T22:09:50Z",
    "updated_at": "2019-12-10T22:09:50Z",
    "author_association": "MEMBER",
    "body": "@AgeManning I think you might be best placed to answer this :)",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/564282041/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/564292886",
    "html_url": "https://github.com/sigp/lighthouse/issues/698#issuecomment-564292886",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/698",
    "id": 564292886,
    "node_id": "MDEyOklzc3VlQ29tbWVudDU2NDI5Mjg4Ng==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-12-10T22:41:15Z",
    "updated_at": "2019-12-10T22:41:15Z",
    "author_association": "MEMBER",
    "body": "Yes. The correct logic is to handle these cases (which is being built in the network re-write) see #681. The reason it is not currently implemented, is that this error should never occur in a lighthouse-only network. We want to identify these issues now, address them, rather than have logic that hides these. \r\n\r\nFor this particular error, a peer sent you a block that it shouldn't have. There is not enough information here for me figure out why. If possible, could you try re-running with `--debug-level debug` flag, i.e `lighthouse --debug-level debug bn .. ` and post any results if this occurs again. ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/564292886/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
