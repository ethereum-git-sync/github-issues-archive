{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/4686",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/4686/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/4686/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/4686/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/4686",
  "id": 1874831234,
  "node_id": "I_kwDOCFeAzc5vv6eC",
  "number": 4686,
  "title": "Could not publish message error:insufficientPeers",
  "user": {
    "login": "avenbreaks",
    "id": 93043826,
    "node_id": "U_kgDOBYu8cg",
    "avatar_url": "https://avatars.githubusercontent.com/u/93043826?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/avenbreaks",
    "html_url": "https://github.com/avenbreaks",
    "followers_url": "https://api.github.com/users/avenbreaks/followers",
    "following_url": "https://api.github.com/users/avenbreaks/following{/other_user}",
    "gists_url": "https://api.github.com/users/avenbreaks/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/avenbreaks/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/avenbreaks/subscriptions",
    "organizations_url": "https://api.github.com/users/avenbreaks/orgs",
    "repos_url": "https://api.github.com/users/avenbreaks/repos",
    "events_url": "https://api.github.com/users/avenbreaks/events{/privacy}",
    "received_events_url": "https://api.github.com/users/avenbreaks/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 985647288,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODg=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/question",
      "name": "question",
      "color": "d876e3",
      "default": true,
      "description": "Further information is requested"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2023-08-31T05:53:10Z",
  "updated_at": "2023-08-31T13:53:12Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\nI am running 2 EL Geth, 2 CL Lighthouse, but experiencing insufficientPeers. I have added --subscribe-all-subnets and --target-peers 1. \r\n\r\nConfig: \r\n```\r\nlighthouse bn \\\r\n--datadir \"/mnt/volume_sgp1_04/testnet/beacon-2\" \\\r\n--testnet-dir \"/root/testnet/output/custom_config_data\" \\\r\n--http \\\r\n--eth1 \\\r\n--staking \\\r\n--http-address=127.0.0.1 \\\r\n--http-allow-sync-stalled \\\r\n--subscribe-all-subnets \\\r\n--http-allow-origin='*' \\\r\n--eth1-endpoints \"http://127.0.0.1:8547\" \\\r\n--execution-endpoints \"http://127.0.0.1:8552\" \\\r\n--import-all-attestations \\\r\n--genesis-backfill \\\r\n--target-peers 1 \\\r\n--listen-address '0.0.0.0' \\\r\n--http-port=5053 \\\r\n--enr-address 159.65.143.195 \\\r\n--enr-udp-port=9001 \\\r\n--enr-tcp-port=9001 \\\r\n--enr-match \\\r\n--discovery-port=9001 \\\r\n--port=9001 \\\r\n--metrics-allow-origin='*' \\\r\n--metrics \\\r\n--metrics-address \"127.0.0.1\" \\\r\n--metrics-port=5055 \\\r\n--logfile-debug-level info \\\r\n--logfile-max-number 5 \\\r\n--logfile-max-size 200 \\\r\n--logfile-compress \\\r\n--jwt-secrets=\"/root/testnet/output/el/jwtsecret\" \\\r\n--suggested-fee-recipient \"0xffffcC6961f8725D09FF09d99560f12F6a8a74a5\" \\\r\n--graffiti \"Cybria-2T\" \\\r\n--boot-nodes=\"enr:-Ly4QIJy75hHCCAt68R-37348iQipyVaXtj1PvMqx9x_9eXUDdVd_t6mygwjNqOJGP3TH1hcfu_0Ijrol2OES_3VjmpGh2F0dG5ldHOIAAAAAAAAAACEZXRoMpDenD0nQAARIv__________gmlkgnY0gmlwhJ9Bj8OJc2VjcDI1NmsxoQKEoOJdoWU5aVl4jonrO3f_44l-lk51rZVj6X5_ZhE9oYhzeW5jbmV0cwCDdGNwgiMog3VkcIIjKA\"\r\n```\r\n\r\nLogs Geth:\r\n```\r\nAug 31 13:47:04 cybria-1 geth[145339]: INFO [08-31|13:47:04.014|miner/payload_building.go:198]                 Stopping work on payload                 id=0x793ca1e572139cda reason=delive\r\nry \r\nAug 31 13:47:04 cybria-1 geth[145339]: INFO [08-31|13:47:04.045|core/blockchain_insert.go:77]                  Imported new potential chain segment     number=566 hash=f3906c..b5c86e bloc\r\nks=1 txs=0 mgas=0.000 elapsed=2.758ms     mgasps=0.000 dirty=0.00B \r\nAug 31 13:47:04 cybria-1 geth[145339]: INFO [08-31|13:47:04.094|core/blockchain.go:2276]                       Chain head was updated                   number=566 hash=f3906c..b5c86e root\r\n=8bff4e..b32ccf elapsed=2.841402ms \r\n```\r\n\r\n\r\nLogs Beacon: \r\n```\r\nAug 31 13:37:45 cybria-1 lighthouse[147150]: Aug 31 05:37:45.586 WARN Could not publish message               error: InsufficientPeers, service: libp2p \r\nAug 31 13:37:45 cybria-1 lighthouse[147150]: Aug 31 05:37:45.592 INFO Sync committee message                  validator: 58, src: api, slot: 4065, epoch: 127, delay_ms: 163, head: 0x25f5\r\n~@2aba, service: val_mon \r\n```\r\nLogs Validator: \r\n```\r\nAug 31 13:45:40 cybria-1 lighthouse[149709]: Aug 31 05:45:40.010 INFO Requesting unsigned block               slot: 4105, service: block \r\nAug 31 13:45:40 cybria-1 lighthouse[149709]: Aug 31 05:45:40.055 INFO Received unsigned block                 slot: 4105, service: block \r\nAug 31 13:45:40 cybria-1 lighthouse[149709]: Aug 31 05:45:40.075 INFO Publishing signed block                 signing_time_ms: 19, slot: 4105, service: block \r\nAug 31 13:45:40 cybria-1 lighthouse[149709]: Aug 31 05:45:40.181 INFO Successfully published block            slot: 4105, graffiti: Some(\"Cybria-1T\"), attestations: 1, deposits: 0, block_\r\ntype: Full, service: block \r\nAug 31 13:45:44 cybria-1 lighthouse[149709]: Aug 31 05:45:44.061 INFO Successfully published attestations     type: unaggregated, slot: 4105, committee_index: 0, head_block: 0x3124ececcfb\r\n57461f595fa1aba4f01292ea4bbaaa60d15d00c346499622a28fb, validator_indices: [21, 12], count: 2, service: attestation \r\nAug 31 13:45:44 cybria-1 lighthouse[149709]: Aug 31 05:45:44.939 INFO Successfully published sync committee messages, slot: 4105, head_block: 0x3124ececcfb57461f595fa1aba4f01292ea4bbaaa60\r\nd15d00c346499622a28fb, count: 64, service: sync_committee \r\nAug 31 13:45:46 cybria-1 lighthouse[149709]: Aug 31 05:45:46.000 INFO Connected to beacon node(s)             synced: 1, available: 1, total: 1, service: notifier \r\nAug 31 13:45:46 cybria-1 lighthouse[149709]: Aug 31 05:45:46.000 INFO All validators active                   slot: 4105, epoch: 128, total_validators: 64, active_validators: 64, current_\r\nepoch_proposers: 32, service: notifier \r\n```\r\n\r\n```\r\nLocal time: Thu 2023-08-31 13:34:58 +08\r\nUniversal time: Thu 2023-08-31 05:34:58 UTC\r\nRTC time: Thu 2023-08-31 05:34:59    \r\nTime zone: Asia/Singapore (+08, +0800)\r\nSystem clock synchronized: yes                        \r\nNTP service: active                     \r\nRTC in local TZ: no   \r\n```\r\n\r\n## Version\r\n\r\n```\r\nLighthouse v4.3.0-dfcb336\r\nBLS library: blst-portable\r\nSHA256 hardware acceleration: false\r\nAllocator: jemalloc\r\nProfile: maxperf\r\nSpecs: mainnet (true), minimal (false), gnosis (true)\r\n```\r\n\r\n## Present Behaviour\r\n\r\nDescribe the present behaviour of the application, with regards to this\r\nissue.\r\n\r\n## Expected Behaviour\r\n\r\nHow _should_ the application behave?\r\n\r\n## Steps to resolve\r\n\r\nPlease describe the steps required to resolve this issue, if known.\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/4686/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/4686/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1701082338",
    "html_url": "https://github.com/sigp/lighthouse/issues/4686#issuecomment-1701082338",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4686",
    "id": 1701082338,
    "node_id": "IC_kwDOCFeAzc5lZHTi",
    "user": {
      "login": "jimmygchen",
      "id": 742762,
      "node_id": "MDQ6VXNlcjc0Mjc2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/742762?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimmygchen",
      "html_url": "https://github.com/jimmygchen",
      "followers_url": "https://api.github.com/users/jimmygchen/followers",
      "following_url": "https://api.github.com/users/jimmygchen/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimmygchen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimmygchen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimmygchen/subscriptions",
      "organizations_url": "https://api.github.com/users/jimmygchen/orgs",
      "repos_url": "https://api.github.com/users/jimmygchen/repos",
      "events_url": "https://api.github.com/users/jimmygchen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimmygchen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-08-31T13:52:58Z",
    "updated_at": "2023-08-31T13:52:58Z",
    "author_association": "MEMBER",
    "body": "You'd want to increase your `target-peer` to a much higher number, 1 is not enough. The default is `80` and is a good starting point unless you're resource constrained, and in general higher peer count is better. If you're only connected to 1 peer and the peer is not subscribed to the subnet you're publishing to (for attestations, there are 64 subnets) , then you'd have no one to publish it to, hence the `InsufficientPeers` error.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1701082338/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
