{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3033",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3033/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3033/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3033/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3033",
  "id": 1142810481,
  "node_id": "I_kwDOCFeAzc5EHedx",
  "number": 3033,
  "title": "Cannot rewrite `SLOTS_PER_EPOCH` through `config.yaml`",
  "user": {
    "login": "varasev",
    "id": 33550681,
    "node_id": "MDQ6VXNlcjMzNTUwNjgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/33550681?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/varasev",
    "html_url": "https://github.com/varasev",
    "followers_url": "https://api.github.com/users/varasev/followers",
    "following_url": "https://api.github.com/users/varasev/following{/other_user}",
    "gists_url": "https://api.github.com/users/varasev/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/varasev/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/varasev/subscriptions",
    "organizations_url": "https://api.github.com/users/varasev/orgs",
    "repos_url": "https://api.github.com/users/varasev/repos",
    "events_url": "https://api.github.com/users/varasev/events{/privacy}",
    "received_events_url": "https://api.github.com/users/varasev/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 985647284,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODQ=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/enhancement",
      "name": "enhancement",
      "color": "a2eeef",
      "default": true,
      "description": "New feature or request"
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-02-18T10:38:24Z",
  "updated_at": "2022-05-18T07:01:31Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nIt seems that something is wrong when we try to define `SLOTS_PER_EPOCH` explicitly in `config.yaml`:\r\n\r\nIf I set `PRESET_BASE` to `mainnet` in `config.yaml` and set `SLOTS_PER_EPOCH` to `16`, it doesn't rewrite mainnet's value and the epoch length is still `32`. But if I try to set `PRESET_BASE` to `gnosis`, the epoch length becomes `16`.\r\n\r\n## Version\r\n\r\nIt is observed for `v2.1.2-modern` (docker image).\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3033/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3033/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1045348326",
    "html_url": "https://github.com/sigp/lighthouse/issues/3033#issuecomment-1045348326",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3033",
    "id": 1045348326,
    "node_id": "IC_kwDOCFeAzc4-Tr_m",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-18T23:33:37Z",
    "updated_at": "2022-02-18T23:33:37Z",
    "author_association": "MEMBER",
    "body": "This is due to some values only being configurable at compile-time. The specs from the EF define two types of configuration: [presets](https://github.com/ethereum/consensus-specs/tree/dev/presets) and [configs](https://github.com/ethereum/consensus-specs/tree/dev/configs), and Lighthouse only allows the latter to be set from a `config.yaml` file.\r\n\r\nIf the Gnosis preset matches the chain you want to run then it would be great if you could use that, as we would like to keep the set of presets maintained upstream to a minimum. Alternatively you can create your own `*EthSpec` type and set the compile-time constants accordingly. You can see the `EthSpec` implementation for Gnosis here:\r\n\r\nhttps://github.com/sigp/lighthouse/blob/c3a793fd73a3b11b130b82032904d39c952869e4/consensus/types/src/eth_spec.rs#L329-L365\r\n\r\nI'll leave this issue open as this seems to be an increasingly common question (surely a good sign for LH adoption :blush: ), and there are two things Lighthouse could probably do better in this case:\r\n\r\n1. Output a warning when the `config.yaml` read for a network contains extra unread fields (like `SLOTS_PER_EPOCH`), and/or fields that are mismatched with the selected preset.\r\n2. Make it easier to drop in new presets at compile time by adding a preset.yaml file to some directory. We could use a procedural macro to generate `EthSpec` instances from these files.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1045348326/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1046654021",
    "html_url": "https://github.com/sigp/lighthouse/issues/3033#issuecomment-1046654021",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3033",
    "id": 1046654021,
    "node_id": "IC_kwDOCFeAzc4-YqxF",
    "user": {
      "login": "varasev",
      "id": 33550681,
      "node_id": "MDQ6VXNlcjMzNTUwNjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33550681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/varasev",
      "html_url": "https://github.com/varasev",
      "followers_url": "https://api.github.com/users/varasev/followers",
      "following_url": "https://api.github.com/users/varasev/following{/other_user}",
      "gists_url": "https://api.github.com/users/varasev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/varasev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/varasev/subscriptions",
      "organizations_url": "https://api.github.com/users/varasev/orgs",
      "repos_url": "https://api.github.com/users/varasev/repos",
      "events_url": "https://api.github.com/users/varasev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/varasev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-21T09:30:08Z",
    "updated_at": "2022-02-21T09:30:08Z",
    "author_association": "NONE",
    "body": "> This is due to some values only being configurable at compile-time\r\n\r\nSo, `SLOTS_PER_EPOCH` is not rewritable through `config.yaml`?\r\n\r\nHowever, we could override it when using `Lighthouse v2.0.1` (our LH fork, though). Example: https://github.com/gnosischain/lighthouse-launch/blob/c6c74ac05b04217868e94042e369b21f5c733d01/config/config.yaml#L76\r\n\r\nI guess, that was rewritable, but became unrewritable in the latest releases, right?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1046654021/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1046690272",
    "html_url": "https://github.com/sigp/lighthouse/issues/3033#issuecomment-1046690272",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3033",
    "id": 1046690272,
    "node_id": "IC_kwDOCFeAzc4-Yzng",
    "user": {
      "login": "varasev",
      "id": 33550681,
      "node_id": "MDQ6VXNlcjMzNTUwNjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33550681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/varasev",
      "html_url": "https://github.com/varasev",
      "followers_url": "https://api.github.com/users/varasev/followers",
      "following_url": "https://api.github.com/users/varasev/following{/other_user}",
      "gists_url": "https://api.github.com/users/varasev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/varasev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/varasev/subscriptions",
      "organizations_url": "https://api.github.com/users/varasev/orgs",
      "repos_url": "https://api.github.com/users/varasev/repos",
      "events_url": "https://api.github.com/users/varasev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/varasev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-21T10:06:22Z",
    "updated_at": "2022-02-21T10:06:22Z",
    "author_association": "NONE",
    "body": "And do I get it correctly that all configurable fields are listed in the file https://github.com/ethereum/consensus-specs/blob/dev/configs/mainnet.yaml?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1046690272/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1046727578",
    "html_url": "https://github.com/sigp/lighthouse/issues/3033#issuecomment-1046727578",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3033",
    "id": 1046727578,
    "node_id": "IC_kwDOCFeAzc4-Y8ua",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-21T10:34:44Z",
    "updated_at": "2022-02-21T10:34:44Z",
    "author_association": "MEMBER",
    "body": "> So, SLOTS_PER_EPOCH is not rewritable through config.yaml?\r\n\r\nYeah that's right\r\n\r\n> I guess, that was rewritable, but became unrewritable in the latest releases, right?\r\n\r\nNah, it's been like this since before Lighthouse v2.0.0 and the Altair fork (this PR: #2279).\r\n\r\n>  However, we could override it when using Lighthouse v2.0.1 (our LH fork, though).\r\n\r\nI think that config value is just being ignored by Lighthouse as it would be today. The `gbc-lighthouse` fork also contained commits like this one to hardcode the type-level values: https://github.com/gnosischain/gbc-lighthouse/commit/087af83ee92ee234161c4d13daa4e3e2240a9d27.\r\n\r\n> And do I get it correctly that all configurable fields are listed in the file https://github.com/ethereum/consensus-specs/blob/dev/configs/mainnet.yaml?\r\n\r\nYep! That's right :+1:\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1046727578/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1046841198",
    "html_url": "https://github.com/sigp/lighthouse/issues/3033#issuecomment-1046841198",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3033",
    "id": 1046841198,
    "node_id": "IC_kwDOCFeAzc4-ZYdu",
    "user": {
      "login": "varasev",
      "id": 33550681,
      "node_id": "MDQ6VXNlcjMzNTUwNjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/33550681?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/varasev",
      "html_url": "https://github.com/varasev",
      "followers_url": "https://api.github.com/users/varasev/followers",
      "following_url": "https://api.github.com/users/varasev/following{/other_user}",
      "gists_url": "https://api.github.com/users/varasev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/varasev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/varasev/subscriptions",
      "organizations_url": "https://api.github.com/users/varasev/orgs",
      "repos_url": "https://api.github.com/users/varasev/repos",
      "events_url": "https://api.github.com/users/varasev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/varasev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-02-21T12:47:03Z",
    "updated_at": "2022-02-21T12:47:03Z",
    "author_association": "NONE",
    "body": "@michaelsproul Got it, thank you for your answers",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1046841198/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
