{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3458",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3458/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3458/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3458/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3458",
  "id": 1336423108,
  "node_id": "I_kwDOCFeAzc5PqDLE",
  "number": 3458,
  "title": "error 'terminate called after throwing an instance of 'std::length_error'' after unclean shutdown",
  "user": {
    "login": "whysthatso",
    "id": 1685114,
    "node_id": "MDQ6VXNlcjE2ODUxMTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1685114?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/whysthatso",
    "html_url": "https://github.com/whysthatso",
    "followers_url": "https://api.github.com/users/whysthatso/followers",
    "following_url": "https://api.github.com/users/whysthatso/following{/other_user}",
    "gists_url": "https://api.github.com/users/whysthatso/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/whysthatso/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/whysthatso/subscriptions",
    "organizations_url": "https://api.github.com/users/whysthatso/orgs",
    "repos_url": "https://api.github.com/users/whysthatso/repos",
    "events_url": "https://api.github.com/users/whysthatso/events{/privacy}",
    "received_events_url": "https://api.github.com/users/whysthatso/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-08-11T19:56:16Z",
  "updated_at": "2022-08-24T06:32:38Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nwhen starting with the following config:\r\n\r\n```\r\nlighthouse --network mainnet  --datadir /data/lighthouse bn --debug-level=debug\r\n```\r\ni'm receiving this output with a subsequent abort:\r\n\r\n```\r\nINFO Logging to file                         path: \"/data/lighthouse/beacon/logs/beacon.log\"\r\nINFO Lighthouse started                      version: Lighthouse/v2.3.1-564d7da\r\nINFO Configured for network                  name: mainnet\r\nINFO Data directory initialised              datadir: /data/lighthouse\r\nINFO Deposit contract                        address: 0x00000000219ab540356cbb839cbe05303d7705fa, deploy_block: 11184524\r\nDEBG Ignoring slots-per-restore-point config in favour of on-disk value, on_disk: 2048, config: 8192, service: freezer_db\r\nINFO Hot-Cold DB initialized                 split_state: 0x2b60c9783c6d6bb91e7abd69e13abea1cfec1cead0f55c936dcc6f92690a7f1b, split_slot: 4339808, service: freezer_db\r\nDEBG Attempting schema migration             to_version: 9, from_version: 9, service: freezer_db\r\nINFO Starting beacon chain                   method: resume, service: beacon\r\n\r\nterminate called after throwing an instance of 'std::length_error'\r\n  what():  basic_string::_M_create\r\nAborted\r\n```\r\ni'm curious if this could be caused by data corruption due to an unclean shutdown?\r\n\r\n## Version\r\nLighthouse/v2.3.1-564d7da\r\nthis is running on archlinux, source is AUR: https://aur.archlinux.org/packages/lighthouse-ethereum\r\n",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3458/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3458/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1212559389",
    "html_url": "https://github.com/sigp/lighthouse/issues/3458#issuecomment-1212559389",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3458",
    "id": 1212559389,
    "node_id": "IC_kwDOCFeAzc5IRjAd",
    "user": {
      "login": "whysthatso",
      "id": 1685114,
      "node_id": "MDQ6VXNlcjE2ODUxMTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1685114?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/whysthatso",
      "html_url": "https://github.com/whysthatso",
      "followers_url": "https://api.github.com/users/whysthatso/followers",
      "following_url": "https://api.github.com/users/whysthatso/following{/other_user}",
      "gists_url": "https://api.github.com/users/whysthatso/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/whysthatso/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/whysthatso/subscriptions",
      "organizations_url": "https://api.github.com/users/whysthatso/orgs",
      "repos_url": "https://api.github.com/users/whysthatso/repos",
      "events_url": "https://api.github.com/users/whysthatso/events{/privacy}",
      "received_events_url": "https://api.github.com/users/whysthatso/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-11T22:29:57Z",
    "updated_at": "2022-08-11T22:29:57Z",
    "author_association": "NONE",
    "body": "removing the datadir fixed the problem, so i assume it's a data corruption issue. what would be the best practice to possibly fix data corruption in the future? any tools for that?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1212559389/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1225144411",
    "html_url": "https://github.com/sigp/lighthouse/issues/3458#issuecomment-1225144411",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3458",
    "id": 1225144411,
    "node_id": "IC_kwDOCFeAzc5JBjhb",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-24T03:41:01Z",
    "updated_at": "2022-08-24T03:41:01Z",
    "author_association": "MEMBER",
    "body": "AFAIK no tools exist to repair corrupt LevelDB databases. It's an unfortunate reality that a re-sync is the best option if this happens.\r\n\r\nWhat filesystem were you running Lighthouse on? Did you have a power outage that could have corrupted the DB?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1225144411/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1225260464",
    "html_url": "https://github.com/sigp/lighthouse/issues/3458#issuecomment-1225260464",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3458",
    "id": 1225260464,
    "node_id": "IC_kwDOCFeAzc5JB_2w",
    "user": {
      "login": "whysthatso",
      "id": 1685114,
      "node_id": "MDQ6VXNlcjE2ODUxMTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1685114?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/whysthatso",
      "html_url": "https://github.com/whysthatso",
      "followers_url": "https://api.github.com/users/whysthatso/followers",
      "following_url": "https://api.github.com/users/whysthatso/following{/other_user}",
      "gists_url": "https://api.github.com/users/whysthatso/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/whysthatso/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/whysthatso/subscriptions",
      "organizations_url": "https://api.github.com/users/whysthatso/orgs",
      "repos_url": "https://api.github.com/users/whysthatso/repos",
      "events_url": "https://api.github.com/users/whysthatso/events{/privacy}",
      "received_events_url": "https://api.github.com/users/whysthatso/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-24T06:32:37Z",
    "updated_at": "2022-08-24T06:32:37Z",
    "author_association": "NONE",
    "body": "@michaelsproul i've asked a related, yet more general question in the recent reddit AMA [here](https://www.reddit.com/r/ethereum/comments/wpqmo1/comment/iki5qb4/)\r\n\r\nserver locked up due to power issues, yes.\r\ni've played around with deleting the last bunch of block files, and putting the pointer to a known complete block, deleting the manifest. that caused the db driver (?) to recheck all blocks (could be followed in the LOG file inside the chainstate db directory, but still led to the same issue. the LOG file showed some other error, unfortunately, i have not recorded that one. something along the lines of 'this value is too short' and then something in hex.\r\n\r\ni know this is a bit hazy of a report, but i guess i am also not expecting too much of a resolution. it's more for posterity.\r\n\r\nthe TLDR for the reddit answer was that corruption should not occur unless there is an underlying hardware issue. i'm running this on a arch linux vm on proxmox, fs is ext4, the underlaying ssd volumes are on a hardware-based raid5 system. the controller does not show any hardware issues, so it's difficult to imagine that being the problem, but i can also not rule it out.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1225260464/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
