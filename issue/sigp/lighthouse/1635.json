{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/1635",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/1635/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/1635/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/1635/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/1635",
  "id": 705028320,
  "node_id": "MDU6SXNzdWU3MDUwMjgzMjA=",
  "number": 1635,
  "title": "Node can't sync if it is stopped mid sync and then restarted",
  "user": {
    "login": "divagant-martian",
    "id": 26765164,
    "node_id": "MDQ6VXNlcjI2NzY1MTY0",
    "avatar_url": "https://avatars.githubusercontent.com/u/26765164?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/divagant-martian",
    "html_url": "https://github.com/divagant-martian",
    "followers_url": "https://api.github.com/users/divagant-martian/followers",
    "following_url": "https://api.github.com/users/divagant-martian/following{/other_user}",
    "gists_url": "https://api.github.com/users/divagant-martian/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/divagant-martian/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/divagant-martian/subscriptions",
    "organizations_url": "https://api.github.com/users/divagant-martian/orgs",
    "repos_url": "https://api.github.com/users/divagant-martian/repos",
    "events_url": "https://api.github.com/users/divagant-martian/events{/privacy}",
    "received_events_url": "https://api.github.com/users/divagant-martian/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2034355093,
      "node_id": "MDU6TGFiZWwyMDM0MzU1MDkz",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/consensus",
      "name": "consensus",
      "color": "5e59bf",
      "default": false,
      "description": "An issue/PR that touches consensus code, such as state_processing or block verification."
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2020-09-20T01:55:07Z",
  "updated_at": "2022-11-09T05:02:30Z",
  "closed_at": "2020-09-22T07:37:47Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "## Description\r\nAs the title says. I tried with a fresh node, no db, no changes in the code. Let it start syncing, stop it, restart it and it won't sync.\r\nWhat I see:\r\nbatches fail with unknown parent until the chain is removed\r\nanother chain will be started from the same finalized point and the same will happen again and again.\r\n\r\n## Version\r\n`master, tag: v0.2.10`\r\n\r\n## Present Behaviour\r\nCan't sync if stopped mid sync and restarted\r\n\r\n## Expected Behaviour\r\nBe able to sync\r\n\r\n## Steps to resolve\r\nno idea",
  "closed_by": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/1635/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/1635/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/695835518",
    "html_url": "https://github.com/sigp/lighthouse/issues/1635#issuecomment-695835518",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1635",
    "id": 695835518,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5NTgzNTUxOA==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-20T20:57:29Z",
    "updated_at": "2020-09-20T20:57:29Z",
    "author_association": "MEMBER",
    "body": "Here are some logs I got from @divagant-martian out-of-band.\r\n\r\n## Logs\r\n\r\n```\r\nSep 19 23:55:30 localhost lighthouse[219520]: Sep 19 23:55:30.001\r\nDEBG Sending Status Request\r\nhead_slot: 58432, \r\nhead_root: 0x1058…c871, \r\nfinalized_epoch: Epoch(1824), \r\nfinalized_root: 0x4f2f7a8acbf16e4372585b6d29191025177467dea8472beb97322d331d4c79d7, \r\nfork_digest: [231, 167, 93, 90], \r\npeer: 16Uiu2HAky1bBKhykDhiPyngC1bE4Lpt41XQ7NkJfKyHngVxCpm7V\r\nrobust batch failure: \r\n```\r\n\r\n```\r\nSep 19 23:57:56 localhost lighthouse[219520]: Sep 19 23:57:56.350\r\nDEBG Batch processing failed\r\nservice: sync, imported_blocks: 0, \r\nerror: Block has an unknown parent: 0x4f2f…79d7, \r\nlast_block_slot: 58432, \r\nfirst_block_slot: 58370, \r\nbatch_epoch: 1824\r\nbut the optimistic also fails with the root of our head \r\n```\r\n```\r\nSep 19 23:56:45 localhost lighthouse[219520]: Sep 19 23:56:45.385\r\nDEBG Batch processing failed\r\nservice: sync, imported_blocks: 0, \r\nerror: Block has an unknown parent: 0x1058…c871, \r\nlast_block_slot: 58495,\r\nfirst_block_slot: 58433, \r\nbatch_epoch: 1826\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/695835518/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/695850952",
    "html_url": "https://github.com/sigp/lighthouse/issues/1635#issuecomment-695850952",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1635",
    "id": 695850952,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5NTg1MDk1Mg==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-20T23:34:09Z",
    "updated_at": "2020-09-20T23:34:09Z",
    "author_association": "MEMBER",
    "body": "Just to make things clearer. \r\n\r\n`beacon_chain.head_info().finalized_checkpoint` Results with a known hash, i.e `0x4f2f7a..` in this case. Then when processing a block that has this hash as it's parent, the block processor returns parent unknown `0x4f2fza..` which is clearly known. ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/695850952/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/695857337",
    "html_url": "https://github.com/sigp/lighthouse/issues/1635#issuecomment-695857337",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1635",
    "id": 695857337,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5NTg1NzMzNw==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-21T00:29:32Z",
    "updated_at": "2020-09-21T00:29:32Z",
    "author_association": "MEMBER",
    "body": "I'm digging into this now, I believe I'm reproducing the bug.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/695857337/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/696559487",
    "html_url": "https://github.com/sigp/lighthouse/issues/1635#issuecomment-696559487",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/1635",
    "id": 696559487,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5NjU1OTQ4Nw==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-22T07:37:47Z",
    "updated_at": "2020-09-22T07:37:47Z",
    "author_association": "MEMBER",
    "body": "Closed in #1616 ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/696559487/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
