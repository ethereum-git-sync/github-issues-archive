{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3878",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3878/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3878/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3878/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3878",
  "id": 1531648878,
  "node_id": "I_kwDOCFeAzc5bSxtu",
  "number": 3878,
  "title": "Event monitor connections dropped by Lighthouse, mysteriously",
  "user": {
    "login": "broadbentg",
    "id": 114707512,
    "node_id": "U_kgDOBtZMOA",
    "avatar_url": "https://avatars.githubusercontent.com/u/114707512?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/broadbentg",
    "html_url": "https://github.com/broadbentg",
    "followers_url": "https://api.github.com/users/broadbentg/followers",
    "following_url": "https://api.github.com/users/broadbentg/following{/other_user}",
    "gists_url": "https://api.github.com/users/broadbentg/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/broadbentg/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/broadbentg/subscriptions",
    "organizations_url": "https://api.github.com/users/broadbentg/orgs",
    "repos_url": "https://api.github.com/users/broadbentg/repos",
    "events_url": "https://api.github.com/users/broadbentg/events{/privacy}",
    "received_events_url": "https://api.github.com/users/broadbentg/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 985647281,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODE=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    },
    {
      "id": 2336800343,
      "node_id": "MDU6TGFiZWwyMzM2ODAwMzQz",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/HTTP-API",
      "name": "HTTP-API",
      "color": "5A63A2",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2023-01-13T03:18:27Z",
  "updated_at": "2023-01-17T01:41:35Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nEvents are monitored with this API: https://ethereum.github.io/beacon-APIs/?urls.primaryName=v1#/Events\r\n\r\nA connection is established and events are monitored.  However, after some time ranging from 48 minutes\r\nto 26 hours, Lighthouse terminates the connection.  For example:\r\n\r\n```\r\ncurl -X 'GET' 'http://localhost:5052/eth/v1/events?topics=block,head,attestation,voluntary_exit,finalized_checkpoint,chain_reorg' -H 'accept: text/event-stream' > /dev/null\r\n```\r\n\r\nfailed after a little more than two hours.  A packet capture with tcpdump shows that Lighthouse terminates the connection:\r\n\r\n> 02:08:51.967504 IP 127.0.0.1.5052 > 127.0.0.1.33682: Flags [P.], seq 1259690769:1259692677, ack 1, win 512, options [nop,nop,TS val 2577486793 ecr 2577486792], length 1908\r\n> 02:08:51.967530 IP 127.0.0.1.33682 > 127.0.0.1.5052: Flags [.], ack 1259692677, win 500, options [nop,nop,TS val 2577486793 ecr 2577486793], length 0\r\n> 02:08:51.983931 IP 127.0.0.1.5052 > 127.0.0.1.33682: Flags [F.], seq 1259692677, ack 1, win 512, options [nop,nop,TS val 2577486810 ecr 2577486793], length 0\r\n> 02:08:51.987471 IP 127.0.0.1.33682 > 127.0.0.1.5052: Flags [F.], seq 1, ack 1259692678, win 512, options [nop,nop,TS val 2577486813 ecr 2577486810], length 0\r\n> 02:08:51.987498 IP 127.0.0.1.5052 > 127.0.0.1.33682: Flags [.], ack 2, win 512, options [nop,nop,TS val 2577486813 ecr 2577486813], length 0\r\n\r\nThis has been seen repeatedly (including packet captures) with curl, some C test code, and Python.  In each case Gnosis Chain was used.  Several times three test processes were run simultaneously.  They are not cut off at the same time, it appears to happen randomly.  No related log file messages were found.\r\n\r\n## Version\r\n\r\nThe problem has been seen with two pre-built binary x86 versions:\r\nLighthouse v3.3.0-bf533c8\r\nBLS library: blst-portable\r\nSHA256 hardware acceleration: false\r\nSpecs: mainnet (true), minimal (false), gnosis (true)\r\n\r\nLighthouse v3.4.0-38514c0\r\nBLS library: blst-modern\r\nSHA256 hardware acceleration: false\r\nSpecs: mainnet (true), minimal (false), gnosis (true)\r\n\r\nThe problem is seen under Ubuntu on x86_64 virtual hardware:\r\nDistributor ID:\tUbuntu\r\nDescription:\tUbuntu 22.10\r\nRelease:\t22.10\r\nCodename:\tkinetic\r\n\r\n\r\n## Present Behaviour\r\n\r\nEvent monitor TCP connections do not stay up indefinitely.\r\n\r\n## Expected Behaviour\r\n\r\nEvent monitor TCP connections should stay up until the client terminates them.\r\n\r\n## Steps to resolve\r\n\r\nThe simple work around is to simply re-open the TCP connection and continue monitoring events.  However, this could result in an event being missed.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3878/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 1,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3878/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1384702667",
    "html_url": "https://github.com/sigp/lighthouse/issues/3878#issuecomment-1384702667",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3878",
    "id": 1384702667,
    "node_id": "IC_kwDOCFeAzc5SiOLL",
    "user": {
      "login": "broadbentg",
      "id": 114707512,
      "node_id": "U_kgDOBtZMOA",
      "avatar_url": "https://avatars.githubusercontent.com/u/114707512?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/broadbentg",
      "html_url": "https://github.com/broadbentg",
      "followers_url": "https://api.github.com/users/broadbentg/followers",
      "following_url": "https://api.github.com/users/broadbentg/following{/other_user}",
      "gists_url": "https://api.github.com/users/broadbentg/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/broadbentg/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/broadbentg/subscriptions",
      "organizations_url": "https://api.github.com/users/broadbentg/orgs",
      "repos_url": "https://api.github.com/users/broadbentg/repos",
      "events_url": "https://api.github.com/users/broadbentg/events{/privacy}",
      "received_events_url": "https://api.github.com/users/broadbentg/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-17T00:43:01Z",
    "updated_at": "2023-01-17T00:43:01Z",
    "author_association": "NONE",
    "body": "The rate of connection drops seems to be much higher when backfilling states using --reconstruct-historic-states.  Perhaps because of increased net traffic?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1384702667/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1384733140",
    "html_url": "https://github.com/sigp/lighthouse/issues/3878#issuecomment-1384733140",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3878",
    "id": 1384733140,
    "node_id": "IC_kwDOCFeAzc5SiVnU",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-17T01:41:35Z",
    "updated_at": "2023-01-17T01:41:35Z",
    "author_association": "MEMBER",
    "body": "> The rate of connection drops seems to be much higher when backfilling states using --reconstruct-historic-states\r\n\r\nThere's no network traffic required for reconstructing historic states, but will impose some disk and CPU load",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1384733140/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
