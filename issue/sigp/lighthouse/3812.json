{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/3812",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/3812/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/3812/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/3812/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/3812",
  "id": 1499508604,
  "node_id": "I_kwDOCFeAzc5ZYK98",
  "number": 3812,
  "title": "Rate limit for web3signer_tests on CI",
  "user": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 2336803064,
      "node_id": "MDU6TGFiZWwyMzM2ODAzMDY0",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/infra-ci",
      "name": "infra-ci",
      "color": "7365BC",
      "default": false,
      "description": ""
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2022-12-16T03:25:11Z",
  "updated_at": "2023-04-06T10:18:04Z",
  "closed_at": "2023-04-06T10:14:25Z",
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nWe're occasionally getting rate-limited calling the Github API to download the `web3signer_tests`. E.g. https://github.com/sigp/lighthouse/actions/runs/3708544134/jobs/6286220721\r\n\r\nThe code triggering the rate limit is:\r\n\r\nhttps://github.com/sigp/lighthouse/blob/bf533c8e42cc73c35730e285c21df8add0195369/testing/web3signer_tests/build.rs#L35-L45\r\n\r\nRunning that API call in a loop in my terminal I can trigger a 403 response by making more than 60 requests/second:\r\n\r\n```json\r\n{\"message\":\"API rate limit exceeded for x.x.x.x. (But here's the good news: Authenticated requests get a higher rate limit. Check out the documentation for more details.)\",\"documentation_url\":\"https://docs.github.com/rest/overview/resources-in-the-rest-api#rate-limiting\"}\r\n```\r\n\r\n## Steps to resolve\r\n\r\nI think the best option would be to plumb the `GITHUB_TOKEN` into that build script so that it can use it to bypass the rate limit. The build script could read an _optional_ secret from its env when it runs and add this to the request headers (when running locally the header would not be added).\r\n\r\nI think if we do something like `echo ${{ secrets.GITHUB_TOKEN }} >> $GITHUB_ENV` that _might_ be OK, as long as Github scrubs the token from the logs. Tokens are unique to each CI run and have very limited `read` permissions on pull requests. See: https://docs.github.com/en/actions/security-guides/automatic-token-authentication#permissions-for-the-github_token\r\n",
  "closed_by": {
    "login": "jimmygchen",
    "id": 742762,
    "node_id": "MDQ6VXNlcjc0Mjc2Mg==",
    "avatar_url": "https://avatars.githubusercontent.com/u/742762?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jimmygchen",
    "html_url": "https://github.com/jimmygchen",
    "followers_url": "https://api.github.com/users/jimmygchen/followers",
    "following_url": "https://api.github.com/users/jimmygchen/following{/other_user}",
    "gists_url": "https://api.github.com/users/jimmygchen/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jimmygchen/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jimmygchen/subscriptions",
    "organizations_url": "https://api.github.com/users/jimmygchen/orgs",
    "repos_url": "https://api.github.com/users/jimmygchen/repos",
    "events_url": "https://api.github.com/users/jimmygchen/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jimmygchen/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/3812/reactions",
    "total_count": 1,
    "+1": 1,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/3812/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1430801293",
    "html_url": "https://github.com/sigp/lighthouse/issues/3812#issuecomment-1430801293",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3812",
    "id": 1430801293,
    "node_id": "IC_kwDOCFeAzc5VSEuN",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-02-15T06:05:09Z",
    "updated_at": "2023-02-15T06:05:54Z",
    "author_association": "MEMBER",
    "body": "This is still an issue despite my fix. More debugging required\r\n\r\nMaybe @antondlr could be tempted? :smirk: \r\n\r\nRecent failure here: https://github.com/sigp/lighthouse/actions/runs/4180285702/jobs/7241123847",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1430801293/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1493642046",
    "html_url": "https://github.com/sigp/lighthouse/issues/3812#issuecomment-1493642046",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3812",
    "id": 1493642046,
    "node_id": "IC_kwDOCFeAzc5ZBys-",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-03T04:23:43Z",
    "updated_at": "2023-04-03T04:23:43Z",
    "author_association": "MEMBER",
    "body": "I recall Anton saying that even authenticated requests are subject to a rate limit",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1493642046/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1493663659",
    "html_url": "https://github.com/sigp/lighthouse/issues/3812#issuecomment-1493663659",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3812",
    "id": 1493663659,
    "node_id": "IC_kwDOCFeAzc5ZB3-r",
    "user": {
      "login": "jimmygchen",
      "id": 742762,
      "node_id": "MDQ6VXNlcjc0Mjc2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/742762?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimmygchen",
      "html_url": "https://github.com/jimmygchen",
      "followers_url": "https://api.github.com/users/jimmygchen/followers",
      "following_url": "https://api.github.com/users/jimmygchen/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimmygchen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimmygchen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimmygchen/subscriptions",
      "organizations_url": "https://api.github.com/users/jimmygchen/orgs",
      "repos_url": "https://api.github.com/users/jimmygchen/repos",
      "events_url": "https://api.github.com/users/jimmygchen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimmygchen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-03T05:01:46Z",
    "updated_at": "2023-04-03T05:01:46Z",
    "author_association": "MEMBER",
    "body": "ah ok looks like with authenticated request, you raised the limit from 60 per hour to 1000 per hour. \r\n\r\nhttps://docs.github.com/en/rest/overview/resources-in-the-rest-api?apiVersion=2022-11-28#rate-limits-for-requests-from-github-actions\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1493663659/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1496902597",
    "html_url": "https://github.com/sigp/lighthouse/issues/3812#issuecomment-1496902597",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3812",
    "id": 1496902597,
    "node_id": "IC_kwDOCFeAzc5ZOOvF",
    "user": {
      "login": "jimmygchen",
      "id": 742762,
      "node_id": "MDQ6VXNlcjc0Mjc2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/742762?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimmygchen",
      "html_url": "https://github.com/jimmygchen",
      "followers_url": "https://api.github.com/users/jimmygchen/followers",
      "following_url": "https://api.github.com/users/jimmygchen/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimmygchen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimmygchen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimmygchen/subscriptions",
      "organizations_url": "https://api.github.com/users/jimmygchen/orgs",
      "repos_url": "https://api.github.com/users/jimmygchen/repos",
      "events_url": "https://api.github.com/users/jimmygchen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimmygchen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-05T04:30:48Z",
    "updated_at": "2023-04-05T04:30:48Z",
    "author_association": "MEMBER",
    "body": "Pushed a fix in #4163 to only download the web3signer binary when need (`web3signer-tests`), and only download once. This should reduce the API calls.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1496902597/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1498830862",
    "html_url": "https://github.com/sigp/lighthouse/issues/3812#issuecomment-1498830862",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/3812",
    "id": 1498830862,
    "node_id": "IC_kwDOCFeAzc5ZVlgO",
    "user": {
      "login": "jimmygchen",
      "id": 742762,
      "node_id": "MDQ6VXNlcjc0Mjc2Mg==",
      "avatar_url": "https://avatars.githubusercontent.com/u/742762?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/jimmygchen",
      "html_url": "https://github.com/jimmygchen",
      "followers_url": "https://api.github.com/users/jimmygchen/followers",
      "following_url": "https://api.github.com/users/jimmygchen/following{/other_user}",
      "gists_url": "https://api.github.com/users/jimmygchen/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/jimmygchen/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/jimmygchen/subscriptions",
      "organizations_url": "https://api.github.com/users/jimmygchen/orgs",
      "repos_url": "https://api.github.com/users/jimmygchen/repos",
      "events_url": "https://api.github.com/users/jimmygchen/events{/privacy}",
      "received_events_url": "https://api.github.com/users/jimmygchen/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-04-06T10:18:04Z",
    "updated_at": "2023-04-06T10:18:04Z",
    "author_association": "MEMBER",
    "body": "Resolved via #4163 ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1498830862/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
