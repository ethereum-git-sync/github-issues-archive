{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/4080",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/4080/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/4080/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/4080/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/4080",
  "id": 1622546534,
  "node_id": "I_kwDOCFeAzc5gthhm",
  "number": 4080,
  "title": "Document IPV6 Connectivity",
  "user": {
    "login": "AgeManning",
    "id": 7454587,
    "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/AgeManning",
    "html_url": "https://github.com/AgeManning",
    "followers_url": "https://api.github.com/users/AgeManning/followers",
    "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
    "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
    "organizations_url": "https://api.github.com/users/AgeManning/orgs",
    "repos_url": "https://api.github.com/users/AgeManning/repos",
    "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
    "received_events_url": "https://api.github.com/users/AgeManning/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1803692313,
      "node_id": "MDU6TGFiZWwxODAzNjkyMzEz",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/docs",
      "name": "docs",
      "color": "b8ffaa",
      "default": false,
      "description": "Documentation"
    },
    {
      "id": 2336800125,
      "node_id": "MDU6TGFiZWwyMzM2ODAwMTI1",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/t%20Networking",
      "name": "t Networking",
      "color": "40E0D0",
      "default": false,
      "description": ""
    }
  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 7,
  "created_at": "2023-03-14T01:15:02Z",
  "updated_at": "2023-03-27T22:16:17Z",
  "closed_at": null,
  "author_association": "MEMBER",
  "active_lock_reason": null,
  "body": "With the introduction of #4046, Lighthouse mostly supports ipv6 connectivity. However the end-user API has some caveats that we should document. \r\n\r\nThis issue is to add documentation to the book about these caveats.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/4080/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/4080/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1480699211",
    "html_url": "https://github.com/sigp/lighthouse/issues/4080#issuecomment-1480699211",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4080",
    "id": 1480699211,
    "node_id": "IC_kwDOCFeAzc5YQa1L",
    "user": {
      "login": "totoCZ",
      "id": 5316250,
      "node_id": "MDQ6VXNlcjUzMTYyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5316250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/totoCZ",
      "html_url": "https://github.com/totoCZ",
      "followers_url": "https://api.github.com/users/totoCZ/followers",
      "following_url": "https://api.github.com/users/totoCZ/following{/other_user}",
      "gists_url": "https://api.github.com/users/totoCZ/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/totoCZ/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/totoCZ/subscriptions",
      "organizations_url": "https://api.github.com/users/totoCZ/orgs",
      "repos_url": "https://api.github.com/users/totoCZ/repos",
      "events_url": "https://api.github.com/users/totoCZ/events{/privacy}",
      "received_events_url": "https://api.github.com/users/totoCZ/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-23T07:08:58Z",
    "updated_at": "2023-03-23T07:08:58Z",
    "author_association": "NONE",
    "body": "Why is \"--listen-address '0.0.0.0' --listen-address '::'\" not the default?",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1480699211/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1480720118",
    "html_url": "https://github.com/sigp/lighthouse/issues/4080#issuecomment-1480720118",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4080",
    "id": 1480720118,
    "node_id": "IC_kwDOCFeAzc5YQf72",
    "user": {
      "login": "totoCZ",
      "id": 5316250,
      "node_id": "MDQ6VXNlcjUzMTYyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5316250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/totoCZ",
      "html_url": "https://github.com/totoCZ",
      "followers_url": "https://api.github.com/users/totoCZ/followers",
      "following_url": "https://api.github.com/users/totoCZ/following{/other_user}",
      "gists_url": "https://api.github.com/users/totoCZ/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/totoCZ/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/totoCZ/subscriptions",
      "organizations_url": "https://api.github.com/users/totoCZ/orgs",
      "repos_url": "https://api.github.com/users/totoCZ/repos",
      "events_url": "https://api.github.com/users/totoCZ/events{/privacy}",
      "received_events_url": "https://api.github.com/users/totoCZ/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-23T07:35:02Z",
    "updated_at": "2023-03-23T07:58:01Z",
    "author_association": "NONE",
    "body": " \"udp4\"=> ?local_enr.udp4(), \"tcp4\" => ?local_enr.tcp6()\r\n \r\n https://github.com/sigp/lighthouse/blob/stable/beacon_node/lighthouse_network/src/discovery/mod.rs#LL210C41-L210C97\r\n \r\nDesigned to be impossible to configure and then it still tries to confuse you. \r\nI would scrap this implementation and use a single socket, enabled by default.\r\n\r\nWhen you set --enr-address manually (it's not clear if the ext. IP is resolved automatically or not, so I set it), it asks for --enr-udp-port.\r\nExcept the doc says that one takes the default value of --port. (\"The --port flag is used if this is not set.\")\r\nBut my --port is not set either and it's clearly not working. (oh, wait, that's only for TCP! UDP does not take defaults.)\r\n\r\nSo my lightweight config to be sure ended up as\r\n```\r\n  --listen-address '0.0.0.0' \\\r\n  --listen-address '::' \\\r\n  --port 9000 \\\r\n  --port6 9090 \\\r\n  --enr-address 185.175.90.195 \\\r\n  --enr-address 2a10:4740:45:1:a0d6:8aff:fed2:7ec8 \\\r\n  --enr-udp-port 9000 \\\r\n  --enr-udp6-port 9090 \\\r\n  --enr-tcp-port 9000 \\\r\n  --enr-tcp6-port 9090\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1480720118/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 1,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1484364000",
    "html_url": "https://github.com/sigp/lighthouse/issues/4080#issuecomment-1484364000",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4080",
    "id": 1484364000,
    "node_id": "IC_kwDOCFeAzc5YeZjg",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-27T02:02:20Z",
    "updated_at": "2023-03-27T02:05:02Z",
    "author_association": "MEMBER",
    "body": "> Why is \"--listen-address '0.0.0.0' --listen-address '::'\" not the default?\r\n\r\nIpv6 socket is not enabled by default because most people have not got ipv6 configured by default. We prefer not to open sockets that users may be unaware of by default. Furthermore, ipv6 is mostly experimental on the Ethereum network, because not many other client teams/boot nodes support ipv6 so you'll have difficulty finding and maintaining connections on ipv6. So mainly because its an experimental feature that is not fully operational, we do not have it enabled by default. \r\n\r\nThe line you pointed out is a bug. I'll make a PR to fix it. \r\n\r\nWe have used a single socket with mapped addresses in discovery. Libp2p enabled multiple sockets. We've opted to use multiple sockets to make things easier to debug/reason about but also to give the greatest adoption. We can also add mapped ipv6 sockets on after (seeing as this is the implementation we originally went with in discovery). \r\n\r\nThe IP addresses should get resolved automatically if you don't set the --enr-address field. This is the default. The catch is you need to find enough nodes that agree on what your external address is. As there probably are no dual-stack or ipv6-only nodes on the network, you probably wont resolve your ipv6 address. \r\n\r\nAs for the `--port` flag. You need to set which port to listen on. You can listen on port 9000 for both udp/tcp and udp6 and tcp6 by leaving it blank or specifying --port 9000. If you want to specify these ports manually to arbitrary values, you can do so via the flags individually as you've done in your sample config. \r\n\r\nNow, listening on a port, is different to advertising which port users can connect to you. For example, you can listen on port 9000, but your router may port-forward 10000 to that local port. So it's not wise to advertise the local port you are listening on by default, because in general this is not the port any one can connect to you. We advertise the ports that people can connect to us via our ENR. You would have seen that your ENR ports would be set to None by default even though you may be listening on port 9000. \r\nWhen you advertise None in IP and port fields, this signifies to others that you are still trying to find your external ports. Once discovery has done its job, these fields will get updated. To get a better understanding of this, you may like to read: https://github.com/sigp/discv5#addresses-in-enrs\r\n\r\nThis issue is about updating our lighthouse book to explain these nuisances. I'll tag @divagant-martian in case they would like to add anything I may have missed here.  ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1484364000/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1484403512",
    "html_url": "https://github.com/sigp/lighthouse/issues/4080#issuecomment-1484403512",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4080",
    "id": 1484403512,
    "node_id": "IC_kwDOCFeAzc5YejM4",
    "user": {
      "login": "divagant-martian",
      "id": 26765164,
      "node_id": "MDQ6VXNlcjI2NzY1MTY0",
      "avatar_url": "https://avatars.githubusercontent.com/u/26765164?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/divagant-martian",
      "html_url": "https://github.com/divagant-martian",
      "followers_url": "https://api.github.com/users/divagant-martian/followers",
      "following_url": "https://api.github.com/users/divagant-martian/following{/other_user}",
      "gists_url": "https://api.github.com/users/divagant-martian/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/divagant-martian/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/divagant-martian/subscriptions",
      "organizations_url": "https://api.github.com/users/divagant-martian/orgs",
      "repos_url": "https://api.github.com/users/divagant-martian/repos",
      "events_url": "https://api.github.com/users/divagant-martian/events{/privacy}",
      "received_events_url": "https://api.github.com/users/divagant-martian/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-27T02:50:12Z",
    "updated_at": "2023-03-27T02:50:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for weighting in, \r\n\r\nFirst and foremost \r\n> Designed to be impossible to configure and then it still tries to confuse you. I would scrap this implementation and use a single socket, enabled by default.\r\n\r\nPlease use an appropriate tone within this repository to make suggestions or bug reports.\r\n\r\nlibp2p has opted to disable mapped addresses for good reasons, and so have we. We won't be adding a single port implementation.\r\n\r\nThe cli flags for dual stack are tricky since we need to ensure backwards compatibility. It's not ideal, but it's the best effort solution to ensure this is achievable without breaking user's configurations and without enabling by default unexpected behaviours.\r\n\r\nAs @AgeManning has mentioned, this feature is very much experimental. That said, the behaviour of `--port` and `--enr-address` has been the same for a while and it's documented. Please refer to https://lighthouse-book.sigmaprime.io/advanced_networking.html\r\n\r\nWhat your configuration ends up being is exactly what we expect. This will be documented when this issue is addressed",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1484403512/reactions",
      "total_count": 6,
      "+1": 5,
      "-1": 0,
      "laugh": 1,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1484492196",
    "html_url": "https://github.com/sigp/lighthouse/issues/4080#issuecomment-1484492196",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4080",
    "id": 1484492196,
    "node_id": "IC_kwDOCFeAzc5Ye42k",
    "user": {
      "login": "totoCZ",
      "id": 5316250,
      "node_id": "MDQ6VXNlcjUzMTYyNTA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5316250?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/totoCZ",
      "html_url": "https://github.com/totoCZ",
      "followers_url": "https://api.github.com/users/totoCZ/followers",
      "following_url": "https://api.github.com/users/totoCZ/following{/other_user}",
      "gists_url": "https://api.github.com/users/totoCZ/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/totoCZ/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/totoCZ/subscriptions",
      "organizations_url": "https://api.github.com/users/totoCZ/orgs",
      "repos_url": "https://api.github.com/users/totoCZ/repos",
      "events_url": "https://api.github.com/users/totoCZ/events{/privacy}",
      "received_events_url": "https://api.github.com/users/totoCZ/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-27T05:00:28Z",
    "updated_at": "2023-03-27T05:12:00Z",
    "author_association": "NONE",
    "body": ">Ipv6 socket is not enabled by default because most people have not got ipv6 configured by default. \r\n\r\nehm, it’s not 1993 anymore.\r\n\r\n> Please use an appropriate tone within this repository to make suggestions or bug reports.\r\n\r\nhuehuehue\r\n\r\nOr am I getting this wrong? Did you you actually mean lighthouse bn —please-use-appropriate-tone? In that case sorry, I missed that before.\r\n\r\nI will add it to my config.\r\n\r\n> The cli flags for dual stack are tricky since we need to ensure backwards compatibility. It's not ideal, but it's the best effort solution to ensure this is achievable without breaking user's configurations and without enabling by default unexpected behaviours.\r\n\r\ni think you can put that into readme.\r\n\r\nanyway it’s clear someone just could do it better. geth is a great example of a client that has a normal config, even if it doesn’t discover any peers yet.\r\nimagine if nginx had 56 flags to set up a socket ahaha and you spend an hour doing it.\r\ntake care guys.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1484492196/reactions",
      "total_count": 6,
      "+1": 0,
      "-1": 6,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1484521377",
    "html_url": "https://github.com/sigp/lighthouse/issues/4080#issuecomment-1484521377",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4080",
    "id": 1484521377,
    "node_id": "IC_kwDOCFeAzc5Ye_-h",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-27T05:31:10Z",
    "updated_at": "2023-03-27T05:31:10Z",
    "author_association": "MEMBER",
    "body": "> Or am I getting this wrong? Did you you actually mean lighthouse bn —please-use-appropriate-tone? In that case sorry, I missed that before.\r\n\r\nNo buddy, if you continue to be rude we will stop talking to you. You have no entitlement to our time, or the time of any open source maintainer. We are doing our best to build secure, free software and don't need to be critiqued by you. If you think you can do better, open a pull request or build your own client.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1484521377/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1485931210",
    "html_url": "https://github.com/sigp/lighthouse/issues/4080#issuecomment-1485931210",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/4080",
    "id": 1485931210,
    "node_id": "IC_kwDOCFeAzc5YkYLK",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-03-27T22:15:40Z",
    "updated_at": "2023-03-27T22:16:17Z",
    "author_association": "MEMBER",
    "body": "> anyway it’s clear someone just could do it better. geth is a great example of a client that has a normal config, even if it doesn’t discover any peers yet.\r\nimagine if nginx had 56 flags to set up a socket ahaha and you spend an hour doing it.\r\n\r\nYour lack of understanding of how the config works, does not make it a bad config.\r\n\r\nAs I was explaining before, its pretty easy to set up an ipv6 dual stack node. See here:\r\n```\r\nlighthouse bn --listen-address 0.0.0.0 --listen-address '::' \r\n```\r\n\r\nI'm sorry it took you an hour to add these two flags but for others reading this issue in the future, it's pretty straight forward to add an ipv6 socket (and also a far-cry from the claimed 56 flags). \r\n\r\nIf you think you can improve the config or these two flags are too much for you, as @michaelsproul said, feel free to open a PR. \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/1485931210/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
