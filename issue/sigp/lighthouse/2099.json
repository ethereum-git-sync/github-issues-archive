{
  "url": "https://api.github.com/repos/sigp/lighthouse/issues/2099",
  "repository_url": "https://api.github.com/repos/sigp/lighthouse",
  "labels_url": "https://api.github.com/repos/sigp/lighthouse/issues/2099/labels{/name}",
  "comments_url": "https://api.github.com/repos/sigp/lighthouse/issues/2099/comments",
  "events_url": "https://api.github.com/repos/sigp/lighthouse/issues/2099/events",
  "html_url": "https://github.com/sigp/lighthouse/issues/2099",
  "id": 769474831,
  "node_id": "MDU6SXNzdWU3Njk0NzQ4MzE=",
  "number": 2099,
  "title": "tokio-runtime-worker panicked",
  "user": {
    "login": "deni64k",
    "id": 107541,
    "node_id": "MDQ6VXNlcjEwNzU0MQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/107541?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/deni64k",
    "html_url": "https://github.com/deni64k",
    "followers_url": "https://api.github.com/users/deni64k/followers",
    "following_url": "https://api.github.com/users/deni64k/following{/other_user}",
    "gists_url": "https://api.github.com/users/deni64k/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/deni64k/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/deni64k/subscriptions",
    "organizations_url": "https://api.github.com/users/deni64k/orgs",
    "repos_url": "https://api.github.com/users/deni64k/repos",
    "events_url": "https://api.github.com/users/deni64k/events{/privacy}",
    "received_events_url": "https://api.github.com/users/deni64k/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 985647281,
      "node_id": "MDU6TGFiZWw5ODU2NDcyODE=",
      "url": "https://api.github.com/repos/sigp/lighthouse/labels/bug",
      "name": "bug",
      "color": "d73a4a",
      "default": true,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2020-12-17T03:41:08Z",
  "updated_at": "2021-02-15T06:49:08Z",
  "closed_at": "2021-02-15T06:49:07Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "## Description\r\n\r\nHello,\r\n\r\nWe see this error after which Lighthouse paralyzes. No backtrace, unfortunately.\r\n\r\n```\r\nlighthouse[224353]: Dec 16 23:22:43.234 INFO New block received                      hash: 0xd161…16bc, slot: 205013\r\nlighthouse[224353]: Dec 16 23:22:49.000 INFO Synced                                  slot: 205013, block: 0xd161…16bc, epoch: 6406, finalized_epoch: 6404, finalized_root: 0x6fa5…4666, peers: 513, service: slot_notifier\r\nlighthouse[224353]: Dec 16 23:22:56.086 INFO New block received                      hash: 0x7d77…413c, slot: 205014\r\nlighthouse[224353]: Dec 16 23:23:01.005 INFO Synced                                  slot: 205014, block: 0x7d77…413c, epoch: 6406, finalized_epoch: 6404, finalized_root: 0x6fa5…4666, peers: 515, service: slot_notifier\r\nlighthouse[224353]: Dec 16 23:23:07.359 INFO New block received                      hash: 0x7cde…2c10, slot: 205015\r\nlighthouse[224353]: thread 'tokio-runtime-worker' panicked at 'elapsed=37085312; when=37085312', /opt/rust/registry/src/github.com-1ecc6299db9ec823/tokio-util-0.5.1/src/time/wheel/mod.rs:245:5\r\nlighthouse[224353]: note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace\r\nlighthouse[224353]: Dec 16 23:23:13.000 INFO Synced                                  slot: 205015, block: 0x7cde…2c10, epoch: 6406, finalized_epoch: 6404, finalized_root: 0x6fa5…4666, peers: 514, service: slot_notifier\r\nlighthouse[224353]: Dec 16 23:23:15.009 WARN Error processing HTTP API request       method: POST, path: /eth/v1/validator/aggregate_and_proofs, status: 500 Internal Server Error, elapsed: 6.123981ms\r\nlighthouse[224353]: Dec 16 23:23:15.010 WARN Error processing HTTP API request       method: POST, path: /eth/v1/validator/aggregate_and_proofs, status: 500 Internal Server Error, elapsed: 7.22892ms\r\nlighthouse[224353]: Dec 16 23:23:23.036 WARN Error processing HTTP API request       method: POST, path: /eth/v1/beacon/pool/attestations, status: 500 Internal Server Error, elapsed: 1.734088ms\r\nlighthouse[224353]: Dec 16 23:23:23.047 WARN Error processing HTTP API request       method: POST, path: /eth/v1/beacon/pool/attestations, status: 500 Internal Server Error, elapsed: 1.697393ms\r\nlighthouse[224353]: Dec 16 23:23:23.056 WARN Error processing HTTP API request       method: POST, path: /eth/v1/beacon/pool/attestations, status: 500 Internal Server Error, elapsed: 1.653093ms\r\nlighthouse[224353]: Dec 16 23:23:23.080 WARN Error processing HTTP API request       method: POST, path: /eth/v1/beacon/pool/attestations, status: 500 Internal Server Error, elapsed: 2.599251ms\r\nlighthouse[224353]: Dec 16 23:23:23.100 WARN Error processing HTTP API request       method: POST, path: /eth/v1/beacon/pool/attestations, status: 500 Internal Server Error, elapsed: 1.501371ms\r\nlighthouse[224353]: Dec 16 23:23:25.000 INFO Synced                                  slot: 205016, block:    …  empty, epoch: 6406, finalized_epoch: 6404, finalized_root: 0x6fa5…4666, peers: 514, service: slot_notifier\r\n```\r\n\r\n## Version\r\n\r\n```\r\n$ lighthouse --version\r\nLighthouse v1.0.4-1abc70e\r\nBLS Library: blst\r\nSpecs: mainnet (true), minimal (false), v0.12.3 (false)\r\n```\r\n\r\n```\r\n$ CARGO_HOME=/opt/rust RUSTUP_HOME=/opt/rust RUSTUP_TOOLCHAIN=stable /opt/rust/bin/rustc --version\r\nrustc 1.48.0 (7eac88abb 2020-11-16)\r\n```\r\n\r\n## Present Behaviour\r\n\r\nLighthouse Beacon Node stops any network activity and doesn't submit attestations.\r\n\r\n## Expected Behaviour\r\n\r\nLighthouse Beacon Node performs network activity and submits attestations.\r\n\r\n## Steps to resolve\r\n\r\nWe simply restarted the node.\r\n",
  "closed_by": {
    "login": "paulhauner",
    "id": 6660660,
    "node_id": "MDQ6VXNlcjY2NjA2NjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/paulhauner",
    "html_url": "https://github.com/paulhauner",
    "followers_url": "https://api.github.com/users/paulhauner/followers",
    "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
    "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
    "organizations_url": "https://api.github.com/users/paulhauner/orgs",
    "repos_url": "https://api.github.com/users/paulhauner/repos",
    "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
    "received_events_url": "https://api.github.com/users/paulhauner/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/2099/reactions",
    "total_count": 3,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 3
  },
  "timeline_url": "https://api.github.com/repos/sigp/lighthouse/issues/2099/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/747560917",
    "html_url": "https://github.com/sigp/lighthouse/issues/2099#issuecomment-747560917",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2099",
    "id": 747560917,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0NzU2MDkxNw==",
    "user": {
      "login": "realbigsean",
      "id": 5160426,
      "node_id": "MDQ6VXNlcjUxNjA0MjY=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5160426?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/realbigsean",
      "html_url": "https://github.com/realbigsean",
      "followers_url": "https://api.github.com/users/realbigsean/followers",
      "following_url": "https://api.github.com/users/realbigsean/following{/other_user}",
      "gists_url": "https://api.github.com/users/realbigsean/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/realbigsean/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/realbigsean/subscriptions",
      "organizations_url": "https://api.github.com/users/realbigsean/orgs",
      "repos_url": "https://api.github.com/users/realbigsean/repos",
      "events_url": "https://api.github.com/users/realbigsean/events{/privacy}",
      "received_events_url": "https://api.github.com/users/realbigsean/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-17T16:47:07Z",
    "updated_at": "2020-12-17T16:47:20Z",
    "author_association": "COLLABORATOR",
    "body": "Seems related to this issue: #1067\r\n\r\n> peers: 515\r\n\r\nI'd guess it's got something to do with the very high peer count",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/747560917/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/748699225",
    "html_url": "https://github.com/sigp/lighthouse/issues/2099#issuecomment-748699225",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2099",
    "id": 748699225,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc0ODY5OTIyNQ==",
    "user": {
      "login": "AgeManning",
      "id": 7454587,
      "node_id": "MDQ6VXNlcjc0NTQ1ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/7454587?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/AgeManning",
      "html_url": "https://github.com/AgeManning",
      "followers_url": "https://api.github.com/users/AgeManning/followers",
      "following_url": "https://api.github.com/users/AgeManning/following{/other_user}",
      "gists_url": "https://api.github.com/users/AgeManning/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/AgeManning/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/AgeManning/subscriptions",
      "organizations_url": "https://api.github.com/users/AgeManning/orgs",
      "repos_url": "https://api.github.com/users/AgeManning/repos",
      "events_url": "https://api.github.com/users/AgeManning/events{/privacy}",
      "received_events_url": "https://api.github.com/users/AgeManning/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-21T00:41:24Z",
    "updated_at": "2020-12-21T00:41:24Z",
    "author_association": "MEMBER",
    "body": "Yes. The previous issue was in the delay queues managing the ping and meta-data intervals. There must still be an issue in tokio when these are pushed with very high peer counts. \r\n\r\nIt looks to me like it is currently being addressed in tokio by this PR: https://github.com/tokio-rs/tokio/pull/3270\r\n\r\nHopefully we can update tokio once that gets merged to resolve this issue. It seems to be me its currently probabilistic in hitting specific delay timeouts and that probability is exasperated by large peer counts. \r\n\r\nAn interim solution would be to lower the peer count to reduce the chances of hitting this. In the meantime, I think we need to wait for the upstream fix. ",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/748699225/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/765011818",
    "html_url": "https://github.com/sigp/lighthouse/issues/2099#issuecomment-765011818",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2099",
    "id": 765011818,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2NTAxMTgxOA==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-21T23:42:14Z",
    "updated_at": "2021-01-21T23:42:28Z",
    "author_association": "MEMBER",
    "body": "The proposed fix at https://github.com/tokio-rs/tokio/pull/3270 has been merged into tokio `master` so I assume we'll see a release soon.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/765011818/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/765023896",
    "html_url": "https://github.com/sigp/lighthouse/issues/2099#issuecomment-765023896",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2099",
    "id": 765023896,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc2NTAyMzg5Ng==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-01-22T00:14:26Z",
    "updated_at": "2021-01-22T00:14:26Z",
    "author_association": "MEMBER",
    "body": "It seems [`tokio_util`](https://crates.io/crates/tokio-util) was updated to `0.6.2` and that contains https://github.com/tokio-rs/tokio/pull/3270.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/765023896/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/778991645",
    "html_url": "https://github.com/sigp/lighthouse/issues/2099#issuecomment-778991645",
    "issue_url": "https://api.github.com/repos/sigp/lighthouse/issues/2099",
    "id": 778991645,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc3ODk5MTY0NQ==",
    "user": {
      "login": "paulhauner",
      "id": 6660660,
      "node_id": "MDQ6VXNlcjY2NjA2NjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6660660?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/paulhauner",
      "html_url": "https://github.com/paulhauner",
      "followers_url": "https://api.github.com/users/paulhauner/followers",
      "following_url": "https://api.github.com/users/paulhauner/following{/other_user}",
      "gists_url": "https://api.github.com/users/paulhauner/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/paulhauner/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/paulhauner/subscriptions",
      "organizations_url": "https://api.github.com/users/paulhauner/orgs",
      "repos_url": "https://api.github.com/users/paulhauner/repos",
      "events_url": "https://api.github.com/users/paulhauner/events{/privacy}",
      "received_events_url": "https://api.github.com/users/paulhauner/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-02-15T06:49:07Z",
    "updated_at": "2021-02-15T06:49:07Z",
    "author_association": "MEMBER",
    "body": "Hopefully resolved in #2172, which includes `tokio-util 0.6.3`.",
    "reactions": {
      "url": "https://api.github.com/repos/sigp/lighthouse/issues/comments/778991645/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
