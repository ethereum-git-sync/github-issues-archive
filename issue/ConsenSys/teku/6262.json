{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/6262",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/6262/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/6262/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/6262/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/6262",
  "id": 1391063928,
  "node_id": "I_kwDOCM9I9M5S6fN4",
  "number": 6262,
  "title": "Unable to retrieve status for `<n>` validators",
  "user": {
    "login": "nalepae",
    "id": 4943830,
    "node_id": "MDQ6VXNlcjQ5NDM4MzA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4943830?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/nalepae",
    "html_url": "https://github.com/nalepae",
    "followers_url": "https://api.github.com/users/nalepae/followers",
    "following_url": "https://api.github.com/users/nalepae/following{/other_user}",
    "gists_url": "https://api.github.com/users/nalepae/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/nalepae/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/nalepae/subscriptions",
    "organizations_url": "https://api.github.com/users/nalepae/orgs",
    "repos_url": "https://api.github.com/users/nalepae/repos",
    "events_url": "https://api.github.com/users/nalepae/events{/privacy}",
    "received_events_url": "https://api.github.com/users/nalepae/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-09-29T15:26:11Z",
  "updated_at": "2022-09-30T12:29:45Z",
  "closed_at": "2022-09-30T08:52:30Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "# Configuration\r\n- EL: `geth  v1.10.23`\r\n- BN/VC: `teku 22.9.1-jdk17`\r\n- External Signer: `Web3Signer 22.8.1-jdk17`\r\n- External builder: `MEV-Boost v1.3.2`\r\n\r\nUsing Geth, Teku, Web3Signer & MEV-Boost (connected to Flashbot relayer)\r\n\r\n# Description\r\n\r\nWhen all the validors keys are active, Teku VC shows this kind of logs at boot.\r\n```\r\n2022-09-29 13:53:37.781 INFO  - Proposer config successfully loaded. It contains the default configuration and 0 specific configuration(s).\r\n2022-09-29 13:53:37.811 INFO  - Starting EventSource client using URI: http://mainnet-teku-beacon-b-0.mainnet-teku-beacon-b.ethereum-common:5051/eth/v1/events?topics=head\r\n2022-09-29 13:53:37.823 INFO  - Connected to EventSource stream.\r\n2022-09-29 13:53:37.839 INFO  - Validator   *** Successfully connected to beacon node event stream\r\n2022-09-29 13:53:38.043 INFO  - 391 validators are in active_ongoing state.\r\n2022-09-29 13:53:47.768 INFO  - Validator   *** Slashing protection loaded for validators: xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx… (391 total)\r\n2022-09-29 13:53:51.784 INFO  - 391 out of 391 validator(s) registrations were successfully sent to the Beacon Node.\r\n2022-09-29 13:53:52.275 INFO  - Validator   *** Published attestation        Count: 7, Slot: 4802967, Root: 495d47c7095d3bfaebc4c1585a509aa3879ab7ef50e962a3f9cf231c711e85f6\r\n```\r\n\r\n**Observed and expected:** 391/391 successful registrations\r\n\r\nHowever, if I add only one validator key with no deposit at all, then Teku VC shows this kind of logs:\r\n```\r\n2022-09-29 15:10:30.036 INFO  - 391 validators are in active_ongoing state.\r\n2022-09-29 15:10:30.036 WARN  - Unable to retrieve status for 1 validators.\r\n2022-09-29 15:10:35.895 INFO  - Validator   *** Slashing protection loaded for validators: xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx, xxxxxxx… (391 total)\r\n2022-09-29 15:10:35.897 WARN  - Validator   *** Slashing protection not loaded for validators: yyyyyyy\r\n2022-09-29 15:10:39.667 INFO  - 200 out of 392 validator(s) registrations were successfully sent to the builder network via the Beacon Node.\r\n2022-09-29 15:10:39.672 ERROR - Validator   *** Failed to send validator registrations to the builder network via the Beacon Node\r\njava.util.concurrent.CompletionException: tech.pegasys.teku.api.exceptions.RemoteServiceNotAvailableException: Server error from Beacon Node API (url = http://mainnet-teku-beacon-b-0.mainnet-teku-beacon-b.ethereum-common:5051/eth/v1/validator/register_validator, status = 500, message = java.lang.IllegalArgumentException: Invalid remote response: {\"code\":502,\"message\":\"no successful relay response\"}\r\n)\r\nat java.util.concurrent.CompletableFuture.encodeThrowable(Unknown Source) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.completeThrowable(Unknown Source) ~[?:?]\r\nat java.util.concurrent.CompletableFuture$UniApply.tryFire(Unknown Source) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.postComplete(Unknown Source) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.completeExceptionally(Unknown Source) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:145) ~[teku-infrastructure-async-22.9.1.jar:22.9.1]\r\nat java.util.concurrent.CompletableFuture.uniWhenComplete(Unknown Source) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.uniWhenCompleteStage(Unknown Source) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.whenComplete(Unknown Source) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:580) ~[teku-infrastructure-async-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:32) ~[teku-infrastructure-async-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.propagateResult(SafeFuture.java:142) ~[teku-infrastructure-async-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$exceptionallyCompose$30(SafeFuture.java:399) ~[teku-infrastructure-async-22.9.1.jar:22.9.1]\r\nat java.util.concurrent.CompletableFuture.uniWhenComplete(Unknown Source) ~[?:?]\r\nat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(Unknown Source) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.postComplete(Unknown Source) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.completeExceptionally(Unknown Source) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:145) ~[teku-infrastructure-async-22.9.1.jar:22.9.1]\r\nat java.util.concurrent.CompletableFuture.uniWhenComplete(Unknown Source) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.uniWhenCompleteStage(Unknown Source) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.whenComplete(Unknown Source) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:580) ~[teku-infrastructure-async-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:32) ~[teku-infrastructure-async-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.propagateResult(SafeFuture.java:142) ~[teku-infrastructure-async-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.propagateTo(SafeFuture.java:293) ~[teku-infrastructure-async-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.infrastructure.async.ScheduledExecutorAsyncRunner.lambda$createRunnableForAction$1(ScheduledExecutorAsyncRunner.java:119) ~[teku-infrastructure-async-22.9.1.jar:22.9.1]\r\nat java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source) ~[?:?]\r\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source) ~[?:?]\r\nat java.lang.Thread.run(Unknown Source) ~[?:?]\r\nCaused by: tech.pegasys.teku.api.exceptions.RemoteServiceNotAvailableException: Server error from Beacon Node API (url = http://mainnet-teku-beacon-b-0.mainnet-teku-beacon-b.ethereum-common:5051/eth/v1/validator/register_validator, status = 500, message = java.lang.IllegalArgumentException: Invalid remote response: {\"code\":502,\"message\":\"no successful relay response\"}\r\n)\r\nat tech.pegasys.teku.validator.remote.typedef.ResponseHandler.serviceErrorHandler(ResponseHandler.java:117) ~[teku-validator-remote-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.validator.remote.typedef.ResponseHandler.handleResponse(ResponseHandler.java:93) ~[teku-validator-remote-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.validator.remote.typedef.handlers.AbstractTypeDefRequest.executeCall(AbstractTypeDefRequest.java:149) ~[teku-validator-remote-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.validator.remote.typedef.handlers.AbstractTypeDefRequest.postJson(AbstractTypeDefRequest.java:127) ~[teku-validator-remote-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.validator.remote.typedef.handlers.RegisterValidatorsRequest.sendValidatorRegistrationsAsJson(RegisterValidatorsRequest.java:77) ~[teku-validator-remote-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.validator.remote.typedef.handlers.RegisterValidatorsRequest.registerValidators(RegisterValidatorsRequest.java:52) ~[teku-validator-remote-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.validator.remote.typedef.OkHttpValidatorTypeDefClient.registerValidators(OkHttpValidatorTypeDefClient.java:101) ~[teku-validator-remote-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.validator.remote.RemoteValidatorApiHandler.lambda$registerValidators$30(RemoteValidatorApiHandler.java:445) ~[teku-validator-remote-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.validator.remote.RemoteValidatorApiHandler.lambda$sendRequest$31(RemoteValidatorApiHandler.java:451) ~[teku-validator-remote-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.of(SafeFuture.java:81) ~[teku-infrastructure-async-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.validator.remote.RemoteValidatorApiHandler.sendRequest(RemoteValidatorApiHandler.java:462) ~[teku-validator-remote-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.validator.remote.RemoteValidatorApiHandler.lambda$sendRequest$32(RemoteValidatorApiHandler.java:457) ~[teku-validator-remote-22.9.1.jar:22.9.1]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.of(SafeFuture.java:73) ~[teku-infrastructure-async-22.9.1.jar:22.9.1]\r\n... 4 more\r\n2022-09-29 15:10:41.864 INFO  - Validator   *** Published attestation        Count: 12, Slot: 4803351, Root: 78cde45eafb70268d818b50a898abcfe4d3c712f688356803fa74b72e89df658\r\n```\r\n\r\n**Observed:** 200/392 successful registrations\r\n**Expected:** 391/392 successful registrations\r\n\r\n\r\nSpecific VC configuration:\r\n```\r\nvalidators-proposer-blinded-blocks-enabled: true\r\n```\r\n\r\nRecipients configuration:\r\n```\r\ndefault_config:\r\n  fee_recipient: zzzzz\r\n  builder:\r\n    enabled: true\r\n```\r\n\r\nSpecific BN configuration:\r\n```\r\nbuilder-endpoint: http://mainnet-mev-boost:18550\r\nvalidators-builder-registration-default-enabled: true\r\n```\r\n\r\n# Additional data\r\nI don't really understand where does come from the number 200 (in 200/392).\r\nMaybe Teku stops at the first error it meets.\r\n",
  "closed_by": {
    "login": "StefanBratanov",
    "id": 14827647,
    "node_id": "MDQ6VXNlcjE0ODI3NjQ3",
    "avatar_url": "https://avatars.githubusercontent.com/u/14827647?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/StefanBratanov",
    "html_url": "https://github.com/StefanBratanov",
    "followers_url": "https://api.github.com/users/StefanBratanov/followers",
    "following_url": "https://api.github.com/users/StefanBratanov/following{/other_user}",
    "gists_url": "https://api.github.com/users/StefanBratanov/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/StefanBratanov/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/StefanBratanov/subscriptions",
    "organizations_url": "https://api.github.com/users/StefanBratanov/orgs",
    "repos_url": "https://api.github.com/users/StefanBratanov/repos",
    "events_url": "https://api.github.com/users/StefanBratanov/events{/privacy}",
    "received_events_url": "https://api.github.com/users/StefanBratanov/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/6262/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/6262/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1263297571",
    "html_url": "https://github.com/ConsenSys/teku/issues/6262#issuecomment-1263297571",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6262",
    "id": 1263297571,
    "node_id": "IC_kwDOCM9I9M5LTGQj",
    "user": {
      "login": "StefanBratanov",
      "id": 14827647,
      "node_id": "MDQ6VXNlcjE0ODI3NjQ3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827647?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/StefanBratanov",
      "html_url": "https://github.com/StefanBratanov",
      "followers_url": "https://api.github.com/users/StefanBratanov/followers",
      "following_url": "https://api.github.com/users/StefanBratanov/following{/other_user}",
      "gists_url": "https://api.github.com/users/StefanBratanov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/StefanBratanov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/StefanBratanov/subscriptions",
      "organizations_url": "https://api.github.com/users/StefanBratanov/orgs",
      "repos_url": "https://api.github.com/users/StefanBratanov/repos",
      "events_url": "https://api.github.com/users/StefanBratanov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/StefanBratanov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-30T08:52:30Z",
    "updated_at": "2022-09-30T08:52:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi, this has been fixed recently https://github.com/ConsenSys/teku/pull/6229 . Basically the relays immediately throw an error if there are unknown validators and the Beacon Node did not do any filtering before this change. I suspect this is what happened. You can check the mev-boost logs for more information. \r\n\r\nFor the moment before there is a new release with this change, you can set `builder.enabled: false` for the unknown validator in the proposer config and that will ensure no registration for it is sent to the BN.\r\n\r\nLet me know if you have any questions. I will close the issue for now, you can reopen it if you are facing any further issues.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1263297571/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1263380499",
    "html_url": "https://github.com/ConsenSys/teku/issues/6262#issuecomment-1263380499",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6262",
    "id": 1263380499,
    "node_id": "IC_kwDOCM9I9M5LTagT",
    "user": {
      "login": "nalepae",
      "id": 4943830,
      "node_id": "MDQ6VXNlcjQ5NDM4MzA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4943830?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/nalepae",
      "html_url": "https://github.com/nalepae",
      "followers_url": "https://api.github.com/users/nalepae/followers",
      "following_url": "https://api.github.com/users/nalepae/following{/other_user}",
      "gists_url": "https://api.github.com/users/nalepae/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/nalepae/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/nalepae/subscriptions",
      "organizations_url": "https://api.github.com/users/nalepae/orgs",
      "repos_url": "https://api.github.com/users/nalepae/repos",
      "events_url": "https://api.github.com/users/nalepae/events{/privacy}",
      "received_events_url": "https://api.github.com/users/nalepae/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-30T10:12:48Z",
    "updated_at": "2022-09-30T10:12:56Z",
    "author_association": "NONE",
    "body": "> For the moment before there is a new release with this change, you can set builder.enabled: false for the unknown validator in the proposer config and that will ensure no registration for it is sent to the BN.\r\n\r\nIt's exactly what I did ;)",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1263380499/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1263511244",
    "html_url": "https://github.com/ConsenSys/teku/issues/6262#issuecomment-1263511244",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6262",
    "id": 1263511244,
    "node_id": "IC_kwDOCM9I9M5LT6bM",
    "user": {
      "login": "StefanBratanov",
      "id": 14827647,
      "node_id": "MDQ6VXNlcjE0ODI3NjQ3",
      "avatar_url": "https://avatars.githubusercontent.com/u/14827647?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/StefanBratanov",
      "html_url": "https://github.com/StefanBratanov",
      "followers_url": "https://api.github.com/users/StefanBratanov/followers",
      "following_url": "https://api.github.com/users/StefanBratanov/following{/other_user}",
      "gists_url": "https://api.github.com/users/StefanBratanov/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/StefanBratanov/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/StefanBratanov/subscriptions",
      "organizations_url": "https://api.github.com/users/StefanBratanov/orgs",
      "repos_url": "https://api.github.com/users/StefanBratanov/repos",
      "events_url": "https://api.github.com/users/StefanBratanov/events{/privacy}",
      "received_events_url": "https://api.github.com/users/StefanBratanov/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-09-30T12:29:45Z",
    "updated_at": "2022-09-30T12:29:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "> > For the moment before there is a new release with this change, you can set builder.enabled: false for the unknown validator in the proposer config and that will ensure no registration for it is sent to the BN.\r\n> \r\n> It's exactly what I did ;)\r\n\r\nGreat, by the way regarding `I don't really understand where does come from the number 200 (in 200/392)` Teku sends signed validator registrations in batches of 100 so essentially the third batch failed.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1263511244/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
