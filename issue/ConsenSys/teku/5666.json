{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/5666",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/5666/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/5666/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/5666/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/5666",
  "id": 1256397294,
  "node_id": "I_kwDOCM9I9M5K4xnu",
  "number": 5666,
  "title": "Sanity check on \"Detected peer with inconsistent finalized block\" warning",
  "user": {
    "login": "benjaminion",
    "id": 20796281,
    "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/benjaminion",
    "html_url": "https://github.com/benjaminion",
    "followers_url": "https://api.github.com/users/benjaminion/followers",
    "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
    "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
    "organizations_url": "https://api.github.com/users/benjaminion/orgs",
    "repos_url": "https://api.github.com/users/benjaminion/repos",
    "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/benjaminion/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-06-01T16:13:01Z",
  "updated_at": "2022-06-02T23:58:56Z",
  "closed_at": "2022-06-02T23:58:56Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Haven't noticed these before. This is on mainnet with Teku 22.5.1.\r\n\r\n```\r\nMay 31 21:34:05 metalalbert teku[2479]: 2022-05-31 21:34:05.613 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAkzbihk8sADuWKm3tTRx6CkUhXEFVotiSCraKsEhzVdmig.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nMay 31 21:36:35 metalalbert teku[2479]: 2022-05-31 21:36:35.994 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAkzbihk8sADuWKm3tTRx6CkUhXEFVotiSCraKsEhzVdmig.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nMay 31 22:40:05 metalalbert teku[2479]: 2022-05-31 22:40:05.786 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAkzbihk8sADuWKm3tTRx6CkUhXEFVotiSCraKsEhzVdmig.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nMay 31 22:42:26 metalalbert teku[2479]: 2022-05-31 22:42:26.278 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAkzbihk8sADuWKm3tTRx6CkUhXEFVotiSCraKsEhzVdmig.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nJun 01 01:18:05 metalalbert teku[2479]: 2022-06-01 01:18:05.945 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAkzbihk8sADuWKm3tTRx6CkUhXEFVotiSCraKsEhzVdmig.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nJun 01 01:20:35 metalalbert teku[2479]: 2022-06-01 01:20:35.533 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAkzbihk8sADuWKm3tTRx6CkUhXEFVotiSCraKsEhzVdmig.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nJun 01 03:50:06 metalalbert teku[2479]: 2022-06-01 03:50:06.393 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAkzbihk8sADuWKm3tTRx6CkUhXEFVotiSCraKsEhzVdmig.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nJun 01 04:24:45 metalalbert teku[2479]: 2022-06-01 04:24:45.700 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAkzbihk8sADuWKm3tTRx6CkUhXEFVotiSCraKsEhzVdmig.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nJun 01 04:27:05 metalalbert teku[2479]: 2022-06-01 04:27:05.686 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAkzbihk8sADuWKm3tTRx6CkUhXEFVotiSCraKsEhzVdmig.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nJun 01 04:42:36 metalalbert teku[2479]: 2022-06-01 04:42:36.442 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAkzbihk8sADuWKm3tTRx6CkUhXEFVotiSCraKsEhzVdmig.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nJun 01 04:44:45 metalalbert teku[2479]: 2022-06-01 04:44:45.383 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAkzbihk8sADuWKm3tTRx6CkUhXEFVotiSCraKsEhzVdmig.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nJun 01 04:48:36 metalalbert teku[2479]: 2022-06-01 04:48:36.468 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAkzbihk8sADuWKm3tTRx6CkUhXEFVotiSCraKsEhzVdmig.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nJun 01 11:39:06 metalalbert teku[2479]: 2022-06-01 11:39:06.524 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAm3BBjLnti81yEwxWBzXzBAVnZi2KgWv7VNXBCejiUyn2L.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nJun 01 13:27:41 metalalbert teku[2479]: 2022-06-01 13:27:41.134 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAm3BBjLnti81yEwxWBzXzBAVnZi2KgWv7VNXBCejiUyn2L.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nJun 01 13:30:20 metalalbert teku[2479]: 2022-06-01 13:30:20.931 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAm3BBjLnti81yEwxWBzXzBAVnZi2KgWv7VNXBCejiUyn2L.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nJun 01 13:35:01 metalalbert teku[2479]: 2022-06-01 13:35:01.363 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAm3BBjLnti81yEwxWBzXzBAVnZi2KgWv7VNXBCejiUyn2L.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nJun 01 13:37:11 metalalbert teku[2479]: 2022-06-01 13:37:11.018 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAm3BBjLnti81yEwxWBzXzBAVnZi2KgWv7VNXBCejiUyn2L.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nJun 01 14:36:49 metalalbert teku[2479]: 2022-06-01 14:36:49.054 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAm3BBjLnti81yEwxWBzXzBAVnZi2KgWv7VNXBCejiUyn2L.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nJun 01 14:39:19 metalalbert teku[2479]: 2022-06-01 14:39:19.838 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAm3BBjLnti81yEwxWBzXzBAVnZi2KgWv7VNXBCejiUyn2L.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nJun 01 15:21:39 metalalbert teku[2479]: 2022-06-01 15:21:39.424 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAm3BBjLnti81yEwxWBzXzBAVnZi2KgWv7VNXBCejiUyn2L.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\nJun 01 15:24:09 metalalbert teku[2479]: 2022-06-01 15:24:09.431 WARN  - Detected peer with inconsistent finalized block at slot 31 for peer 16Uiu2HAm3BBjLnti81yEwxWBzXzBAVnZi2KgWv7VNXBCejiUyn2L.  Block roots 0x03dfea04ec332d814a75c768d53196ad3f2b938a6b3927062b35c7a15810c1a1 and 0xbacd20f09da907734434f052bd4c9503aa16bab1960e89ea20610d08d064481c do not match\r\n```\r\n\r\nAs far as I understand the [code](https://github.com/ConsenSys/teku/blob/d470ef5ac75310af4d4d60fdb2128a5132ead2c4/networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/peers/PeerChainValidator.java#L204) this ought to be comparing my _latest_ finalised block with my peer's. However, it seems always to be comparing the roots for the block at [slot 31](https://beaconcha.in/block/31), which is indeed `0x03dfea04...`. (Slot 32 is empty, so the block for checkpoint 1 is at slot 31 rather than 32. Weirdly, `0xbacd20f0...` is the block at [slot 1](https://beaconcha.in/block/1) - I can't explain this.)\r\n\r\n1. Is this the expected behaviour?\r\n2. Why don't we drop this peer? If it's syncing or something, I probably don't need to hear about it in my logs.\r\n3. Why is the finalised root we are using coming from our local slot 1?\r\n\r\nEverything is running fine and my latest finalised checkpoint is 123109 as of writing. Just curious as to whether this check is doing what it ought to be doing.",
  "closed_by": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/5666/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/5666/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1145455476",
    "html_url": "https://github.com/ConsenSys/teku/issues/5666#issuecomment-1145455476",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5666",
    "id": 1145455476,
    "node_id": "IC_kwDOCM9I9M5ERkN0",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-02T23:58:56Z",
    "updated_at": "2022-06-02T23:58:56Z",
    "author_association": "CONTRIBUTOR",
    "body": "This was discussed during planning, I think it's in a good place to close now that the message is clearer, but it does appear that the peers were correctly dealt with...",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1145455476/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
