{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/2520",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/2520/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/2520/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/2520/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/2520",
  "id": 674217434,
  "node_id": "MDU6SXNzdWU2NzQyMTc0MzQ=",
  "number": 2520,
  "title": "Teku client missing almost all attestations on Medalla",
  "user": {
    "login": "dankrad",
    "id": 6130607,
    "node_id": "MDQ6VXNlcjYxMzA2MDc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6130607?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dankrad",
    "html_url": "https://github.com/dankrad",
    "followers_url": "https://api.github.com/users/dankrad/followers",
    "following_url": "https://api.github.com/users/dankrad/following{/other_user}",
    "gists_url": "https://api.github.com/users/dankrad/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dankrad/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dankrad/subscriptions",
    "organizations_url": "https://api.github.com/users/dankrad/orgs",
    "repos_url": "https://api.github.com/users/dankrad/repos",
    "events_url": "https://api.github.com/users/dankrad/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dankrad/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1048919129,
      "node_id": "MDU6TGFiZWwxMDQ4OTE5MTI5",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/bug%20%F0%9F%90%9E",
      "name": "bug üêû",
      "color": "dd6c94",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2172540775,
      "node_id": "MDU6TGFiZWwyMTcyNTQwNzc1",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/P1",
      "name": "P1",
      "color": "FF0000",
      "default": false,
      "description": "Very high"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "mbaxter",
    "id": 658601,
    "node_id": "MDQ6VXNlcjY1ODYwMQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/658601?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mbaxter",
    "html_url": "https://github.com/mbaxter",
    "followers_url": "https://api.github.com/users/mbaxter/followers",
    "following_url": "https://api.github.com/users/mbaxter/following{/other_user}",
    "gists_url": "https://api.github.com/users/mbaxter/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mbaxter/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mbaxter/subscriptions",
    "organizations_url": "https://api.github.com/users/mbaxter/orgs",
    "repos_url": "https://api.github.com/users/mbaxter/repos",
    "events_url": "https://api.github.com/users/mbaxter/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mbaxter/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "mbaxter",
      "id": 658601,
      "node_id": "MDQ6VXNlcjY1ODYwMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/658601?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mbaxter",
      "html_url": "https://github.com/mbaxter",
      "followers_url": "https://api.github.com/users/mbaxter/followers",
      "following_url": "https://api.github.com/users/mbaxter/following{/other_user}",
      "gists_url": "https://api.github.com/users/mbaxter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mbaxter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mbaxter/subscriptions",
      "organizations_url": "https://api.github.com/users/mbaxter/orgs",
      "repos_url": "https://api.github.com/users/mbaxter/repos",
      "events_url": "https://api.github.com/users/mbaxter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mbaxter/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-08-06T10:46:45Z",
  "updated_at": "2020-08-06T18:15:00Z",
  "closed_at": "2020-08-06T18:06:45Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\nDeposited 100 validators on Goerli, which got activated last night (not included in genesis). Running a teku client with all 100 of them, almost none of them are attesting, ever (each validator has made ~1 attestations in total). See here for performance: https://medalla.beaconcha.in/dashboard?validators=21288,21289,21290,21291,21292,21293,21294,21295,21296,21297,21298,21299,21300,21301,21302,21303,21304,21305,21306,21307,21308,21309,21310,21311,21312,21313,21314,21315,21316,21317,21319,21320,21321,21323,21324,21325,21326,21327,21328,21329,21330,21331,21332,21333,21334,21335,21336,21337,21338,21339,21340,21341,21342,21343,21344,21345,21346,21347,21348,21349,21350,21351,21352,21353,21354,21355,21356,21357,21358,21359,21360,21361,21362,21363,21364,21365,21366,21367,21368,21369,21370,21371,21372,21373,21374,21375,21376,21377,21378,21379,21380,21381,21382,21383,21384,21385,21386,21387,21388,21389\r\n\r\n### Acceptance Criteria\r\nI expect all validators to make 99%+ of their attestations.\r\n\r\n### Versions (Add all that apply)\r\n* Software version: teku/v0.12.3-dev-a170f84a/linux-x86_64/-ubuntu-openjdk64bitservervm-java-11\r\n* Java version: openjdk 11.0.8 2020-07-14\r\nOpenJDK Runtime Environment (build 11.0.8+10-post-Ubuntu-0ubuntu120.04)\r\nOpenJDK 64-Bit Server VM (build 11.0.8+10-post-Ubuntu-0ubuntu120.04, mixed mode, sharing)\r\n\r\n* OS Name & Version: Ubuntu 20.04 LTS\r\n* Kernel Version: Linux pascal 5.4.0-42-generic #46-Ubuntu SMP Fri Jul 10 00:24:02 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\r\n\r\n### Additional Information\r\n\r\nTeku command line:\r\n```\r\nbin/teku -n medalla --validators-key-files=`echo ~/test/eth2.0-deposit-cli/validator_keys/keystore-m_12381_3600_* | tr \" \" \",\"` --validators-key-password-files=`echo ~/test/eth2.0-deposit-cli/passwords/* | tr \" \" \",\"` --p2p-port=9001 --rest-api-enabled=true --rest-api-docs-enabled=true --metrics-enabled --validators-graffiti=\"Dankrad/teku\" --rest-api-port=5151 --eth1-endpoint=http://localhost:8545\r\n```\r\n\r\nLooking at the logs it looks like the client is creating attestations and has peers. So either attestations are incorrect or not sent to peers:\r\n[teku.log](https://github.com/PegaSysEng/teku/files/5034321/teku.log)\r\n",
  "closed_by": {
    "login": "mbaxter",
    "id": 658601,
    "node_id": "MDQ6VXNlcjY1ODYwMQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/658601?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mbaxter",
    "html_url": "https://github.com/mbaxter",
    "followers_url": "https://api.github.com/users/mbaxter/followers",
    "following_url": "https://api.github.com/users/mbaxter/following{/other_user}",
    "gists_url": "https://api.github.com/users/mbaxter/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mbaxter/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mbaxter/subscriptions",
    "organizations_url": "https://api.github.com/users/mbaxter/orgs",
    "repos_url": "https://api.github.com/users/mbaxter/repos",
    "events_url": "https://api.github.com/users/mbaxter/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mbaxter/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/2520/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/2520/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/669953636",
    "html_url": "https://github.com/ConsenSys/teku/issues/2520#issuecomment-669953636",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2520",
    "id": 669953636,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY2OTk1MzYzNg==",
    "user": {
      "login": "mbaxter",
      "id": 658601,
      "node_id": "MDQ6VXNlcjY1ODYwMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/658601?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mbaxter",
      "html_url": "https://github.com/mbaxter",
      "followers_url": "https://api.github.com/users/mbaxter/followers",
      "following_url": "https://api.github.com/users/mbaxter/following{/other_user}",
      "gists_url": "https://api.github.com/users/mbaxter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mbaxter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mbaxter/subscriptions",
      "organizations_url": "https://api.github.com/users/mbaxter/orgs",
      "repos_url": "https://api.github.com/users/mbaxter/repos",
      "events_url": "https://api.github.com/users/mbaxter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mbaxter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-06T14:13:55Z",
    "updated_at": "2020-08-06T14:13:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "We recently reverted a change that caused issues with our attestations production:  https://github.com/PegaSysEng/teku/pull/2519\r\n\r\nTry pulling the latest from master and see if this clears up your issue. ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/669953636/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/670067268",
    "html_url": "https://github.com/ConsenSys/teku/issues/2520#issuecomment-670067268",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2520",
    "id": 670067268,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3MDA2NzI2OA==",
    "user": {
      "login": "dankrad",
      "id": 6130607,
      "node_id": "MDQ6VXNlcjYxMzA2MDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6130607?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dankrad",
      "html_url": "https://github.com/dankrad",
      "followers_url": "https://api.github.com/users/dankrad/followers",
      "following_url": "https://api.github.com/users/dankrad/following{/other_user}",
      "gists_url": "https://api.github.com/users/dankrad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dankrad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dankrad/subscriptions",
      "organizations_url": "https://api.github.com/users/dankrad/orgs",
      "repos_url": "https://api.github.com/users/dankrad/repos",
      "events_url": "https://api.github.com/users/dankrad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dankrad/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-06T17:23:51Z",
    "updated_at": "2020-08-06T17:23:51Z",
    "author_association": "NONE",
    "body": "Yes, that seems to have fixed it. Would be good to find the root cause of that issue.\r\n\r\nAlso, performance is ok now, but not great: Validators are still missing significant (one-digit) percentage of attestations. Would be great to see an improvement on that.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/670067268/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/670090023",
    "html_url": "https://github.com/ConsenSys/teku/issues/2520#issuecomment-670090023",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2520",
    "id": 670090023,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY3MDA5MDAyMw==",
    "user": {
      "login": "mbaxter",
      "id": 658601,
      "node_id": "MDQ6VXNlcjY1ODYwMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/658601?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mbaxter",
      "html_url": "https://github.com/mbaxter",
      "followers_url": "https://api.github.com/users/mbaxter/followers",
      "following_url": "https://api.github.com/users/mbaxter/following{/other_user}",
      "gists_url": "https://api.github.com/users/mbaxter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mbaxter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mbaxter/subscriptions",
      "organizations_url": "https://api.github.com/users/mbaxter/orgs",
      "repos_url": "https://api.github.com/users/mbaxter/repos",
      "events_url": "https://api.github.com/users/mbaxter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mbaxter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-08-06T18:06:45Z",
    "updated_at": "2020-08-06T18:06:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "Agreed - we are currently investigating to see exactly how that merge broke attestation production.  You can follow: https://github.com/PegaSysEng/teku/issues/2334 for updates.\r\n\r\nI know that there have been some issues at the gossip layer across all clients, which could be causing some percentage of attestations to be missed.  That's something we'll be looking into as well.\r\n\r\nClosing this issue for now since it seems the immediate problem has been fixed.\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/670090023/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
