{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/3971",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/3971/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/3971/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/3971/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/3971",
  "id": 890565647,
  "node_id": "MDU6SXNzdWU4OTA1NjU2NDc=",
  "number": 3971,
  "title": "Ignore launchpad deposit_data json file when loading keystores",
  "user": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1170684912,
      "node_id": "MDU6TGFiZWwxMTcwNjg0OTEy",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/good%20first%20issue%20:raising_hand:",
      "name": "good first issue :raising_hand:",
      "color": "006b75",
      "default": false,
      "description": "This is a good first issue for a new contributor to work on"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-05-12T23:33:15Z",
  "updated_at": "2021-06-15T01:16:53Z",
  "closed_at": "2021-06-15T01:16:53Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\r\nUsers commonly copy all the files generated by the deposit-cli into their teku keys directory, including the deposit_data json file.  Since it's a .json file, Teku tries to load it as a keystore and fails to find a password file matching it resulting in confusing errors.\r\n\r\nWe should just ignore the deposit_data json file.\r\n\r\nSample content of `deposit_data-1620858087.json`:\r\n\r\n```\r\n[{\"pubkey\": \"b93de474b36c68f1323b80d529220cbe868d876bf6be45259a2005159585f5154f8b24209dbbbf049ddadb9947a5e490\", \"withdrawal_credentials\": \"002c7560879a767d9d4447fda04b7a497af19cc80994d614557f7836fad6867b\", \"amount\": 32000000000, \"signature\": \"b552c4e2982d49cc626f284172ebf500478392980a0aa96b11e6a5c9f081cbd31bbf6cba503d1a3564dc5be9243311b203262f2863390eb483fb58b474527d91bbe5193e3c6e0d9f863c53c8ad0331e70f1180d1e730d4f46bbbfdaede0aa6a5\", \"deposit_message_root\": \"09b32e44c341c2977d8528af610e1adbbb249ce293133ae4a8b7c2a7d7afcfa0\", \"deposit_data_root\": \"9f88c0dedc95efa6be9048effa9a4376873078227f1ef9292f28683adc650b49\", \"fork_version\": \"00000121\", \"eth2_network_name\": \"altona\", \"deposit_cli_version\": \"1.1.0\"}]%\r\n```\r\n\r\nWe probably should check the content is at least vaguely like a deposit data file or at least not a keystore file before ignoring the file rather than just ignoring all `deposit_data-*.json` files.\r\n",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/3971/reactions",
    "total_count": 1,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 1,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/3971/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/840169594",
    "html_url": "https://github.com/ConsenSys/teku/issues/3971#issuecomment-840169594",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3971",
    "id": 840169594,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg0MDE2OTU5NA==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-12T23:34:00Z",
    "updated_at": "2021-05-12T23:34:00Z",
    "author_association": "CONTRIBUTOR",
    "body": "`tech.pegasys.teku.validator.api.KeyStoreFilesLocator` has the logic for finding keystores and would be the place to integrate this change.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/840169594/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/857752148",
    "html_url": "https://github.com/ConsenSys/teku/issues/3971#issuecomment-857752148",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3971",
    "id": 857752148,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1Nzc1MjE0OA==",
    "user": {
      "login": "vishaljhala",
      "id": 4231684,
      "node_id": "MDQ6VXNlcjQyMzE2ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4231684?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vishaljhala",
      "html_url": "https://github.com/vishaljhala",
      "followers_url": "https://api.github.com/users/vishaljhala/followers",
      "following_url": "https://api.github.com/users/vishaljhala/following{/other_user}",
      "gists_url": "https://api.github.com/users/vishaljhala/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vishaljhala/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vishaljhala/subscriptions",
      "organizations_url": "https://api.github.com/users/vishaljhala/orgs",
      "repos_url": "https://api.github.com/users/vishaljhala/repos",
      "events_url": "https://api.github.com/users/vishaljhala/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vishaljhala/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-09T14:38:14Z",
    "updated_at": "2021-06-09T14:39:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "@ajsutton - I was thinking of giving it a try. keystore json has `crypto`, `kdf` and `cypher`, If the current pair doesn't have those keys in json, then probably ignore that json? Would that be a good check?",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/857752148/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/857768062",
    "html_url": "https://github.com/ConsenSys/teku/issues/3971#issuecomment-857768062",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3971",
    "id": 857768062,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1Nzc2ODA2Mg==",
    "user": {
      "login": "vishaljhala",
      "id": 4231684,
      "node_id": "MDQ6VXNlcjQyMzE2ODQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4231684?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/vishaljhala",
      "html_url": "https://github.com/vishaljhala",
      "followers_url": "https://api.github.com/users/vishaljhala/followers",
      "following_url": "https://api.github.com/users/vishaljhala/following{/other_user}",
      "gists_url": "https://api.github.com/users/vishaljhala/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/vishaljhala/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/vishaljhala/subscriptions",
      "organizations_url": "https://api.github.com/users/vishaljhala/orgs",
      "repos_url": "https://api.github.com/users/vishaljhala/repos",
      "events_url": "https://api.github.com/users/vishaljhala/events{/privacy}",
      "received_events_url": "https://api.github.com/users/vishaljhala/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-09T14:56:29Z",
    "updated_at": "2021-06-09T14:56:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "or may be I can just use `BLSPublicKey.fromBytesCompressedValidate` to validate if its really a keystore or not.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/857768062/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/858149127",
    "html_url": "https://github.com/ConsenSys/teku/issues/3971#issuecomment-858149127",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3971",
    "id": 858149127,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg1ODE0OTEyNw==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-09T22:44:02Z",
    "updated_at": "2021-06-09T22:44:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "> @ajsutton - I was thinking of giving it a try. keystore json has `crypto`, `kdf` and `cypher`, If the current pair doesn't have those keys in json, then probably ignore that json? Would that be a good check?\r\n\r\nI'm inclined to go the other way and pick a few fields that do appear in the deposit file and ignore it specifically. We don't want to silently ignore a file that the user added to the directory thinking it was a valid keystore, so generally better to fail.  The deposit file just happens to be a very commonly added file which definitely shouldn't be loaded so we want to explicitly filter it out.\r\n\r\nBut the basic idea of just checking if a couple of fields are present as part of the check is right.  It doesn't have to be a perfect check, just enough to avoid accidentally ignoring files we shouldn't.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/858149127/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/861098514",
    "html_url": "https://github.com/ConsenSys/teku/issues/3971#issuecomment-861098514",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3971",
    "id": 861098514,
    "node_id": "MDEyOklzc3VlQ29tbWVudDg2MTA5ODUxNA==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-06-15T01:16:53Z",
    "updated_at": "2021-06-15T01:16:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Fixed by #4085 ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/861098514/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
