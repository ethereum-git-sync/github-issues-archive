{
  "url": "https://api.github.com/repos/Consensys/teku/issues/7338",
  "repository_url": "https://api.github.com/repos/Consensys/teku",
  "labels_url": "https://api.github.com/repos/Consensys/teku/issues/7338/labels{/name}",
  "comments_url": "https://api.github.com/repos/Consensys/teku/issues/7338/comments",
  "events_url": "https://api.github.com/repos/Consensys/teku/issues/7338/events",
  "html_url": "https://github.com/Consensys/teku/issues/7338",
  "id": 1792616055,
  "node_id": "I_kwDOCM9I9M5q2SZ3",
  "number": 7338,
  "title": "Reward eth/v1/beacon/rewards/attestations/186303  RPC return 404",
  "user": {
    "login": "J1a-wei",
    "id": 49090950,
    "node_id": "MDQ6VXNlcjQ5MDkwOTUw",
    "avatar_url": "https://avatars.githubusercontent.com/u/49090950?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/J1a-wei",
    "html_url": "https://github.com/J1a-wei",
    "followers_url": "https://api.github.com/users/J1a-wei/followers",
    "following_url": "https://api.github.com/users/J1a-wei/following{/other_user}",
    "gists_url": "https://api.github.com/users/J1a-wei/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/J1a-wei/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/J1a-wei/subscriptions",
    "organizations_url": "https://api.github.com/users/J1a-wei/orgs",
    "repos_url": "https://api.github.com/users/J1a-wei/repos",
    "events_url": "https://api.github.com/users/J1a-wei/events{/privacy}",
    "received_events_url": "https://api.github.com/users/J1a-wei/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1048919129,
      "node_id": "MDU6TGFiZWwxMDQ4OTE5MTI5",
      "url": "https://api.github.com/repos/Consensys/teku/labels/bug%20%F0%9F%90%9E",
      "name": "bug ðŸž",
      "color": "dd6c94",
      "default": false,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "lucassaldanha",
    "id": 1766440,
    "node_id": "MDQ6VXNlcjE3NjY0NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lucassaldanha",
    "html_url": "https://github.com/lucassaldanha",
    "followers_url": "https://api.github.com/users/lucassaldanha/followers",
    "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
    "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
    "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
    "repos_url": "https://api.github.com/users/lucassaldanha/repos",
    "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2023-07-07T02:27:37Z",
  "updated_at": "2023-07-11T03:35:43Z",
  "closed_at": "2023-07-11T03:35:43Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi team, I encountered a very strange question. I checked the prater network validator's ATT reward one by one epoch. It can return the correct result in EPOCH 18302 and 18304, but it cannot return 404 at 18303. \r\n \r\n### Versions (Add all that apply)\r\nTeku: v2.36.0\r\n\r\nexec /opt/teku/bin/teku --network=prater --data-beacon-path=/data/teku/beacon --data-path=/data/teku --data-storage-archive-frequency=32 --data-storage-mode=archive --data-storage-non-canonical-blocks-enabled=false --ee-endpoint=http://ethereum-goerli-crcv7w92t3vm:8551 --ee-jwt-secret-file=/secret/jwtsecret --p2p-enabled=true --p2p-port=9000 --p2p-advertised-ip=$(POD_IP) --p2p-advertised-port=9000 --rest-api-enabled=true --rest-api-host-allowlist=* --rest-api-interface=0.0.0.0 --rest-api-port=8080 --rest-api-cors-origins=* --rest-api-docs-enabled=false",
  "closed_by": {
    "login": "lucassaldanha",
    "id": 1766440,
    "node_id": "MDQ6VXNlcjE3NjY0NDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lucassaldanha",
    "html_url": "https://github.com/lucassaldanha",
    "followers_url": "https://api.github.com/users/lucassaldanha/followers",
    "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
    "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
    "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
    "repos_url": "https://api.github.com/users/lucassaldanha/repos",
    "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/Consensys/teku/issues/7338/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/Consensys/teku/issues/7338/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1627970499",
    "html_url": "https://github.com/Consensys/teku/issues/7338#issuecomment-1627970499",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7338",
    "id": 1627970499,
    "node_id": "IC_kwDOCM9I9M5hCNvD",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-10T02:12:29Z",
    "updated_at": "2023-07-10T02:12:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for raising, this is probably less likely to happen on mainnet but a short explanation might be a good start...\n\nTL/DR: this is a bug in our processing.\nA query for epoch 186303 is a miss in this instance which is because it's finding the last block of the next epoch (so slot 5961759)\n\nIt will be more correct for us to get the state rather than the block because a block can be missed where a state is always available (assuming we're in archive mode like you are).\n\nWe should call `getBeaconStateAndMetadata` rather than `getBlockAndMetadata` and update the handling accordingly (we can skip the state fetch inside the future processing then).\n\nThe upside of this change will be a (albeit slight) performance improvement.",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1627970499/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1627979380",
    "html_url": "https://github.com/Consensys/teku/issues/7338#issuecomment-1627979380",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7338",
    "id": 1627979380,
    "node_id": "IC_kwDOCM9I9M5hCP50",
    "user": {
      "login": "J1a-wei",
      "id": 49090950,
      "node_id": "MDQ6VXNlcjQ5MDkwOTUw",
      "avatar_url": "https://avatars.githubusercontent.com/u/49090950?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/J1a-wei",
      "html_url": "https://github.com/J1a-wei",
      "followers_url": "https://api.github.com/users/J1a-wei/followers",
      "following_url": "https://api.github.com/users/J1a-wei/following{/other_user}",
      "gists_url": "https://api.github.com/users/J1a-wei/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/J1a-wei/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/J1a-wei/subscriptions",
      "organizations_url": "https://api.github.com/users/J1a-wei/orgs",
      "repos_url": "https://api.github.com/users/J1a-wei/repos",
      "events_url": "https://api.github.com/users/J1a-wei/events{/privacy}",
      "received_events_url": "https://api.github.com/users/J1a-wei/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-10T02:26:08Z",
    "updated_at": "2023-07-10T02:26:49Z",
    "author_association": "NONE",
    "body": "Hi @rolfyone , I encountered the same problem(eopch 211933)  on the mainnet.   Do we need to resync data after the fix? And how long will it take to fix? Thank u :) ",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1627979380/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1627982102",
    "html_url": "https://github.com/Consensys/teku/issues/7338#issuecomment-1627982102",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7338",
    "id": 1627982102,
    "node_id": "IC_kwDOCM9I9M5hCQkW",
    "user": {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-07-10T02:30:08Z",
    "updated_at": "2023-07-10T02:30:08Z",
    "author_association": "MEMBER",
    "body": "> Hi @rolfyone , I encountered the same problem(eopch 211933) on the mainnet. Do we need to resync data after the fix? And how long will it take to fix? Thank u :)\r\n\r\nHi! No need to resync after the fix, just updating your node. We expect to have the fix merged soon (1 - 2 days).",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1627982102/reactions",
      "total_count": 2,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 1,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
