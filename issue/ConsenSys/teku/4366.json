{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/4366",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/4366/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/4366/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/4366/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/4366",
  "id": 996518297,
  "node_id": "I_kwDOCM9I9M47ZamZ",
  "number": 4366,
  "title": "failed to write test file on startup, and teku exits",
  "user": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2021-09-14T23:29:26Z",
  "updated_at": "2022-08-16T10:29:53Z",
  "closed_at": "2022-08-16T10:29:53Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "reported after upgrade to 21.9.0:\n\nAfter upgrading validators are failing to start due to\n```\n09:14:31.257 ERROR - Failed to write in /data/validator/slashprotection                                                                   java.io.IOException: Unable to create directory /data/validator/slashprotection\n```\nhaving `--validators-external-signer-slashing-protection-enabled=false`\n\nThere's 2 points of view on this issue\n - it's probably better that we fail to startup if we can't write to this folder, rather than failing to write slashing protection data once the validators are loaded and functioning, as not being able to write to our data path is a fatal issue, and we won't be able to do what's needed to function correctly. The error raised to the user may be more appropriate if it reports 'failed to write to data path, cannot startup' or similar, rather than an IO Exception on the slashprotection folder, which is a little obscure to present to a user.\n\n- Slashing protection was explicitly disabled because a external slashing protection was enabled and the user did not need local slashing protection - ideally we won't even need to check atomic writes because slashing protection is not in use, so the folders don't strictly need to exist. This would fix the specific use case, but there would still be plenty of other examples of this error not using external slashing protection potentially.\n\nThe work around for this issue:\n - check that the specified data path (`/data` above) is readable, writable, and executable for the user running teku\n\nIt would be good to gather some points of view on what the 'solution' for this use-case looks like @benjaminion @ajsutton.\n\n## Steps to reproduce\nIn a minimal setup that I didn't care a lot about, i removed the 'validator' folder, then did `chmod 555 .` to that folder, and got: \n```\nCannot write to folder /Users/paulharris/Library/teku/minimal/validator/slashprotection\n```\nany of that path will be the same though, could simplify and just `chmod 555 validator/slashprotection`\n\n## Validator-client in container use case\n - using an application container\n - external slashing protection\n - no local slashing protection\n - log to console\n - still now (since 21.9.0) need the data-base-path writable, even though it will never be used by logging, database, or slashing protection\n",
  "closed_by": {
    "login": "benjaminion",
    "id": 20796281,
    "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/benjaminion",
    "html_url": "https://github.com/benjaminion",
    "followers_url": "https://api.github.com/users/benjaminion/followers",
    "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
    "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
    "organizations_url": "https://api.github.com/users/benjaminion/orgs",
    "repos_url": "https://api.github.com/users/benjaminion/repos",
    "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/benjaminion/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/4366/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/4366/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/919582089",
    "html_url": "https://github.com/ConsenSys/teku/issues/4366#issuecomment-919582089",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4366",
    "id": 919582089,
    "node_id": "IC_kwDOCM9I9M42z7WJ",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-14T23:29:48Z",
    "updated_at": "2021-09-14T23:29:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "This does really present like a mis-configuration, where we can't write to the data path or the slashing path for some reason, and we shouldn't really be starting up, so potentially we should fail to start still and this message is already clear enough?\nIf i have no validators, I can see the argument that there should be no need to write to that path at all, but at the same time, i could signal to reload validators at any point so it's very arguably a valid position to fail to startup in this circumstance...",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/919582089/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1216455779",
    "html_url": "https://github.com/ConsenSys/teku/issues/4366#issuecomment-1216455779",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4366",
    "id": 1216455779,
    "node_id": "IC_kwDOCM9I9M5IgaRj",
    "user": {
      "login": "benjaminion",
      "id": 20796281,
      "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjaminion",
      "html_url": "https://github.com/benjaminion",
      "followers_url": "https://api.github.com/users/benjaminion/followers",
      "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
      "organizations_url": "https://api.github.com/users/benjaminion/orgs",
      "repos_url": "https://api.github.com/users/benjaminion/repos",
      "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjaminion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-08-16T10:29:53Z",
    "updated_at": "2022-08-16T10:29:53Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing due to inactivity.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1216455779/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
