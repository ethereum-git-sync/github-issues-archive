{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/5463",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/5463/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/5463/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/5463/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/5463",
  "id": 1230798080,
  "node_id": "I_kwDOCM9I9M5JXH0A",
  "number": 5463,
  "title": "Add paging to API query responses",
  "user": {
    "login": "benjaminion",
    "id": 20796281,
    "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/benjaminion",
    "html_url": "https://github.com/benjaminion",
    "followers_url": "https://api.github.com/users/benjaminion/followers",
    "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
    "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
    "organizations_url": "https://api.github.com/users/benjaminion/orgs",
    "repos_url": "https://api.github.com/users/benjaminion/repos",
    "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/benjaminion/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-05-10T08:24:57Z",
  "updated_at": "2022-12-02T00:17:59Z",
  "closed_at": "2022-12-02T00:17:58Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Feature request from a prominent user of Teku.\r\n\r\nFor example, with the [/eth/v1/beacon/states/{state_id}/validators](https://consensys.github.io/teku/#operation/getEthV1BeaconStatesWithState_idValidators) endpoint.\r\n\r\nIs it possible to add pagination to this call to not receive all 300K+ validators at once.\r\n\r\nExample: `/validators?pagination.limit=1000&pagination.offset=1000`",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/5463/reactions",
    "total_count": 3,
    "+1": 3,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/5463/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1122125920",
    "html_url": "https://github.com/ConsenSys/teku/issues/5463#issuecomment-1122125920",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5463",
    "id": 1122125920,
    "node_id": "IC_kwDOCM9I9M5C4khg",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-10T09:04:17Z",
    "updated_at": "2022-05-10T09:04:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "could potentially support a syntax like `1..10` etc..",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1122125920/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1177486466",
    "html_url": "https://github.com/ConsenSys/teku/issues/5463#issuecomment-1177486466",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5463",
    "id": 1177486466,
    "node_id": "IC_kwDOCM9I9M5GLwSC",
    "user": {
      "login": "araa47",
      "id": 22760261,
      "node_id": "MDQ6VXNlcjIyNzYwMjYx",
      "avatar_url": "https://avatars.githubusercontent.com/u/22760261?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/araa47",
      "html_url": "https://github.com/araa47",
      "followers_url": "https://api.github.com/users/araa47/followers",
      "following_url": "https://api.github.com/users/araa47/following{/other_user}",
      "gists_url": "https://api.github.com/users/araa47/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/araa47/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/araa47/subscriptions",
      "organizations_url": "https://api.github.com/users/araa47/orgs",
      "repos_url": "https://api.github.com/users/araa47/repos",
      "events_url": "https://api.github.com/users/araa47/events{/privacy}",
      "received_events_url": "https://api.github.com/users/araa47/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-07T11:51:44Z",
    "updated_at": "2022-07-07T11:51:44Z",
    "author_association": "NONE",
    "body": "Seeing issues with Teku clients timing out when querying ceratin slots , \r\n\r\nthis has been happening with slots after June 23rd\r\n\r\n## Example Slot\r\n\"eth/v1/beacon/states/4139392/validators\"\r\n\r\nIve tried passing in the extra parameter `status` but this still has the same issue:\r\n\r\n## Simple Script to Re-Create the load \r\n\r\n```\r\nimport requests\r\nimport time \r\n\r\nurl = \"node_url\"\r\nvalitador_statuses = ['pending_initialized', 'pending_queued', 'active_ongoing', 'active_exiting', 'active_slashed', 'exited_unslashed', 'exited_slashed', 'withdrawal_possible', 'withdrawal_done']\r\nslot = 4139392\r\nbase_url = \"eth/v1/beacon/states/4139392/validators\"\r\n\r\nfor status in valitador_statuses:\r\n    resp = requests.get(f\"https://{url}/{base_url}\", params={\"status\": status})\r\n    print(resp.status_code)\r\n    print(resp.elapsed.total_seconds())\r\n    time.sleep(1)\r\n ```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1177486466/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1178369414",
    "html_url": "https://github.com/ConsenSys/teku/issues/5463#issuecomment-1178369414",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5463",
    "id": 1178369414,
    "node_id": "IC_kwDOCM9I9M5GPH2G",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-07T23:32:50Z",
    "updated_at": "2022-07-07T23:32:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "@benjaminion do we have more context around the actual problem being experienced? Pagination is a potential solution, but more context on the problem scope we're solving would be helpful...\r\n\r\nIf the problem being experienced is timeouts, then its likely pagination may not actually help a lot, as most timeouts are likely to be on state regeneration, rather than on encoding (node falling behind would be another potential)\r\n\r\n@araa47 its possible / likely that your timeouts are due to state regeneration, and load like your script will definitely exacerbate the problem, you may find that for a few slots it times out, then it starts getting really quick again for a period of time. Every 2048 states are stored, which means that for the other 2047, they need to be regenerated, and as you get further from the stored state, it will slow down. To check the database version, can look at the `db.version` file in the `beacon` folder... Currently we have no real way of showing the exact slots of finalized states in storage... It's possible to increase the frequency of stored finalized states by using `--data-storage-archive-frequency` if you're using an archive database other than leveldb-tree, which would mean you need to regenerate less states to get to the data you need...\r\n\r\nFinalized state access is definitely more expensive than non-finalized state access, and potentially if there are specific things that are often required, we could do things to optimise accessing that specific data somehow, but it really depends what the problem we're trying to solve is...\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1178369414/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1334608267",
    "html_url": "https://github.com/ConsenSys/teku/issues/5463#issuecomment-1334608267",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5463",
    "id": 1334608267,
    "node_id": "IC_kwDOCM9I9M5PjIGL",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-12-02T00:17:58Z",
    "updated_at": "2022-12-02T00:17:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "Going to close this one - paging isn't part of the standard REST API and we do support streaming the response as it's generated now which will help significantly with response times and avoiding timeouts (but we still have to regenerate the state which is usually the slowest part - pagination won't help with that though).",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1334608267/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
