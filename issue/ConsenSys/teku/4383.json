{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/4383",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/4383/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/4383/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/4383/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/4383",
  "id": 999068899,
  "node_id": "I_kwDOCM9I9M47jJTj",
  "number": 4383,
  "title": "Failed to export slashing protection data.",
  "user": {
    "login": "chrishobcroft",
    "id": 2212651,
    "node_id": "MDQ6VXNlcjIyMTI2NTE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2212651?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/chrishobcroft",
    "html_url": "https://github.com/chrishobcroft",
    "followers_url": "https://api.github.com/users/chrishobcroft/followers",
    "following_url": "https://api.github.com/users/chrishobcroft/following{/other_user}",
    "gists_url": "https://api.github.com/users/chrishobcroft/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/chrishobcroft/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/chrishobcroft/subscriptions",
    "organizations_url": "https://api.github.com/users/chrishobcroft/orgs",
    "repos_url": "https://api.github.com/users/chrishobcroft/repos",
    "events_url": "https://api.github.com/users/chrishobcroft/events{/privacy}",
    "received_events_url": "https://api.github.com/users/chrishobcroft/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "regio",
    "id": 1396294,
    "node_id": "MDQ6VXNlcjEzOTYyOTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1396294?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/regio",
    "html_url": "https://github.com/regio",
    "followers_url": "https://api.github.com/users/regio/followers",
    "following_url": "https://api.github.com/users/regio/following{/other_user}",
    "gists_url": "https://api.github.com/users/regio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/regio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/regio/subscriptions",
    "organizations_url": "https://api.github.com/users/regio/orgs",
    "repos_url": "https://api.github.com/users/regio/repos",
    "events_url": "https://api.github.com/users/regio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/regio/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "regio",
      "id": 1396294,
      "node_id": "MDQ6VXNlcjEzOTYyOTQ=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1396294?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/regio",
      "html_url": "https://github.com/regio",
      "followers_url": "https://api.github.com/users/regio/followers",
      "following_url": "https://api.github.com/users/regio/following{/other_user}",
      "gists_url": "https://api.github.com/users/regio/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/regio/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/regio/subscriptions",
      "organizations_url": "https://api.github.com/users/regio/orgs",
      "repos_url": "https://api.github.com/users/regio/repos",
      "events_url": "https://api.github.com/users/regio/events{/privacy}",
      "received_events_url": "https://api.github.com/users/regio/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-09-17T08:05:53Z",
  "updated_at": "2021-09-27T00:02:03Z",
  "closed_at": "2021-09-27T00:02:03Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nWhen I try to export slashing-protection, the process fails, reporting:\r\n\r\n```\r\njava.nio.file.FileSystemException: /home/ubuntu/slashing-interchange-format-minimal.json.tmp -> /home/ubuntu/slashing-interchange-format-minimal.json: Is a directory\r\n```\r\n\r\n### Acceptance Criteria\r\n\r\nWhen running the following command, the process successfully exports slashing protection data:\r\n```\r\n/usr/local/bin/teku/bin/teku slashing-protection export --data-base-path=/var/lib/teku --to=/home/ubuntu/slashing-interchange-format-minimal.json\r\n```\r\n\r\n### Steps to Reproduce (Bug)\r\n1. Have at least 1 active Validator running on teku\r\n2. Run this command:\r\n```\r\n/usr/local/bin/teku/bin/teku slashing-protection export --data-base-path=/var/lib/teku --to=/home/ubuntu/slashing-interchange-format-minimal.json\r\n```\r\n3. Observe this:\r\n```\r\nReading slashing protection data from: /var/lib/teku/validator/slashprotection\r\nExporting 92c163e03d2d325f71d1374a3499bdf4b99b06139f3b538109e5aad2313cfddfcaaae10c72238db16af57784d4cafea3\r\nWriting slashing protection data to: /home/ubuntu/slashing-interchange-format-minimal.json\r\nFailed to export slashing protection data.\r\njava.nio.file.FileSystemException: /home/ubuntu/slashing-interchange-format-minimal.json.tmp -> /home/ubuntu/slashing-interchange-format-minimal.json: Is a directory\r\n\tat java.base/sun.nio.fs.UnixException.translateToIOException(UnixException.java:100)\r\n\tat java.base/sun.nio.fs.UnixException.rethrowAsIOException(UnixException.java:111)\r\n\tat java.base/sun.nio.fs.UnixCopyFile.move(UnixCopyFile.java:417)\r\n\tat java.base/sun.nio.fs.UnixFileSystemProvider.move(UnixFileSystemProvider.java:267)\r\n\tat java.base/java.nio.file.Files.move(Files.java:1422)\r\n\tat tech.pegasys.teku.infrastructure.io.SyncDataAccessor.atomicSyncedWrite(SyncDataAccessor.java:122)\r\n\tat tech.pegasys.teku.infrastructure.io.SyncDataAccessor.syncedWrite(SyncDataAccessor.java:96)\r\n\tat tech.pegasys.teku.data.SlashingProtectionExporter.saveToFile(SlashingProtectionExporter.java:94)\r\n\tat tech.pegasys.teku.cli.slashingprotection.ExportCommand.run(ExportCommand.java:68)\r\n\tat picocli.CommandLine.executeUserObject(CommandLine.java:1919)\r\n\tat picocli.CommandLine.access$1100(CommandLine.java:145)\r\n\tat picocli.CommandLine$RunLast.executeUserObjectOfLastSubcommandWithSameParent(CommandLine.java:2332)\r\n\tat picocli.CommandLine$RunLast.handle(CommandLine.java:2326)\r\n\tat picocli.CommandLine$RunLast.handle(CommandLine.java:2291)\r\n\tat picocli.CommandLine$AbstractParseResultHandler.execute(CommandLine.java:2159)\r\n\tat picocli.CommandLine.execute(CommandLine.java:2058)\r\n\tat tech.pegasys.teku.cli.BeaconNodeCommand.parse(BeaconNodeCommand.java:233)\r\n\tat tech.pegasys.teku.Teku.main(Teku.java:32)\r\n```\r\n\r\n### Expected behavior:\r\n\r\nI expect the file to write correctly.\r\n\r\n### Actual behavior\r\n\r\nThe file does not write correctly.\r\n\r\n### Frequency\r\n\r\n100% of the time\r\n\r\n### Versions\r\n\r\n* Software version: `teku/v21.9.1/linux-x86_64/-ubuntu-openjdk64bitservervm-java-11`\r\n* Java version:\r\n```\r\nopenjdk version \"11.0.11\" 2021-04-20\r\nOpenJDK Runtime Environment (build 11.0.11+9-Ubuntu-0ubuntu2.20.04)\r\nOpenJDK 64-Bit Server VM (build 11.0.11+9-Ubuntu-0ubuntu2.20.04, mixed mode, sharing)\r\n```\r\n* OS Name & Version:\r\n```\r\nDISTRIB_ID=Ubuntu\r\nDISTRIB_RELEASE=20.04\r\nDISTRIB_CODENAME=focal\r\nDISTRIB_DESCRIPTION=\"Ubuntu 20.04.3 LTS\"\r\nNAME=\"Ubuntu\"\r\nVERSION=\"20.04.3 LTS (Focal Fossa)\"\r\nID=ubuntu\r\nID_LIKE=debian\r\nPRETTY_NAME=\"Ubuntu 20.04.3 LTS\"\r\nVERSION_ID=\"20.04\"\r\nHOME_URL=\"https://www.ubuntu.com/\"\r\nSUPPORT_URL=\"https://help.ubuntu.com/\"\r\nBUG_REPORT_URL=\"https://bugs.launchpad.net/ubuntu/\"\r\nPRIVACY_POLICY_URL=\"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy\"\r\nVERSION_CODENAME=focal\r\nUBUNTU_CODENAME=focal\r\n```",
  "closed_by": {
    "login": "regio",
    "id": 1396294,
    "node_id": "MDQ6VXNlcjEzOTYyOTQ=",
    "avatar_url": "https://avatars.githubusercontent.com/u/1396294?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/regio",
    "html_url": "https://github.com/regio",
    "followers_url": "https://api.github.com/users/regio/followers",
    "following_url": "https://api.github.com/users/regio/following{/other_user}",
    "gists_url": "https://api.github.com/users/regio/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/regio/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/regio/subscriptions",
    "organizations_url": "https://api.github.com/users/regio/orgs",
    "repos_url": "https://api.github.com/users/regio/repos",
    "events_url": "https://api.github.com/users/regio/events{/privacy}",
    "received_events_url": "https://api.github.com/users/regio/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/4383/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/4383/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/921618867",
    "html_url": "https://github.com/ConsenSys/teku/issues/4383#issuecomment-921618867",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4383",
    "id": 921618867,
    "node_id": "IC_kwDOCM9I9M427smz",
    "user": {
      "login": "chrishobcroft",
      "id": 2212651,
      "node_id": "MDQ6VXNlcjIyMTI2NTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2212651?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/chrishobcroft",
      "html_url": "https://github.com/chrishobcroft",
      "followers_url": "https://api.github.com/users/chrishobcroft/followers",
      "following_url": "https://api.github.com/users/chrishobcroft/following{/other_user}",
      "gists_url": "https://api.github.com/users/chrishobcroft/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/chrishobcroft/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/chrishobcroft/subscriptions",
      "organizations_url": "https://api.github.com/users/chrishobcroft/orgs",
      "repos_url": "https://api.github.com/users/chrishobcroft/repos",
      "events_url": "https://api.github.com/users/chrishobcroft/events{/privacy}",
      "received_events_url": "https://api.github.com/users/chrishobcroft/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-17T08:42:09Z",
    "updated_at": "2021-09-17T08:42:09Z",
    "author_association": "NONE",
    "body": "Attempted the same with previous versions:\r\n\r\n`21.8.2` - success\r\n`21.9.0` - fail",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/921618867/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
