{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/6741",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/6741/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/6741/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/6741/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/6741",
  "id": 1560042590,
  "node_id": "I_kwDOCM9I9M5c_Fxe",
  "number": 6741,
  "title": "Docker image for 23.1 fails to run as non-root user",
  "user": {
    "login": "overholts",
    "id": 5687558,
    "node_id": "MDQ6VXNlcjU2ODc1NTg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/5687558?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/overholts",
    "html_url": "https://github.com/overholts",
    "followers_url": "https://api.github.com/users/overholts/followers",
    "following_url": "https://api.github.com/users/overholts/following{/other_user}",
    "gists_url": "https://api.github.com/users/overholts/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/overholts/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/overholts/subscriptions",
    "organizations_url": "https://api.github.com/users/overholts/orgs",
    "repos_url": "https://api.github.com/users/overholts/repos",
    "events_url": "https://api.github.com/users/overholts/events{/privacy}",
    "received_events_url": "https://api.github.com/users/overholts/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1048919129,
      "node_id": "MDU6TGFiZWwxMDQ4OTE5MTI5",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/bug%20%F0%9F%90%9E",
      "name": "bug üêû",
      "color": "dd6c94",
      "default": false,
      "description": "Something isn't working"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2023-01-27T16:24:10Z",
  "updated_at": "2023-01-30T09:13:22Z",
  "closed_at": "2023-01-30T09:13:21Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!-- \r\nBy filing an Issue, you are expected to comply with the Code of Conduct, \r\nincluding treating everyone with respect:\r\nhttps://github.com/ConsenSys/teku/blob/master/CODE-OF-CONDUCT.md\r\n\r\nNot all sections will apply to all issue types.\r\n-->\r\n\r\n### Description\r\nDocker image for [`23.1`](https://hub.docker.com/layers/consensys/teku/23.1/images/sha256-0a9cee1315990aaaa0706bae3b297d1cb253ed10d7685cd3ba6935d93272ddbc?context=explore) fails to start when running as non-root user.\r\n\r\n`22.x` and prior images work fine with no other change to my config.\r\n\r\n### Steps to Reproduce (Bug)\r\nDocker compose config (or equivalent `--user` param) like:\r\n```\r\nuser: \"999:1001\"\r\n```\r\n**Expected behavior:**\r\nTeku docker image runs.\r\n\r\n```\r\n ‚†ø Container teku-goerli        Started\r\n```\r\n\r\n**Actual behavior:**\r\n```\r\n ‚†ø Container teku-goerli        Starting\r\nError response from daemon: failed to create shim task: OCI runtime create failed: runc create failed: unable to start container process: exec: \"/opt/teku/bin/teku\": stat /opt/teku/bin/teku: permission denied: unknown\r\n```\r\n\r\n### Versions (Add all that apply)\r\n* Software version: 23.1\r\n* Java version: 17\r\n* OS Name & Version: Debian 11\r\n* Docker Version: 20.10.23\r\n* Cloud VM, type, size: N/A (NUC10i7)",
  "closed_by": {
    "login": "tbenr",
    "id": 15999009,
    "node_id": "MDQ6VXNlcjE1OTk5MDA5",
    "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tbenr",
    "html_url": "https://github.com/tbenr",
    "followers_url": "https://api.github.com/users/tbenr/followers",
    "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
    "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
    "organizations_url": "https://api.github.com/users/tbenr/orgs",
    "repos_url": "https://api.github.com/users/tbenr/repos",
    "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tbenr/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/6741/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/6741/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1407004842",
    "html_url": "https://github.com/ConsenSys/teku/issues/6741#issuecomment-1407004842",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6741",
    "id": 1407004842,
    "node_id": "IC_kwDOCM9I9M5T3TCq",
    "user": {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-27T19:51:48Z",
    "updated_at": "2023-01-27T19:51:48Z",
    "author_association": "MEMBER",
    "body": "Hi @overholts ,\r\n\r\nThanks for reporting this bug. We have just pushed 23.1.1 exclusively with a fix for the docker user permission. Would you please let us know if it solves your problem?",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1407004842/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1407012126",
    "html_url": "https://github.com/ConsenSys/teku/issues/6741#issuecomment-1407012126",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6741",
    "id": 1407012126,
    "node_id": "IC_kwDOCM9I9M5T3U0e",
    "user": {
      "login": "lucassaldanha",
      "id": 1766440,
      "node_id": "MDQ6VXNlcjE3NjY0NDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1766440?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lucassaldanha",
      "html_url": "https://github.com/lucassaldanha",
      "followers_url": "https://api.github.com/users/lucassaldanha/followers",
      "following_url": "https://api.github.com/users/lucassaldanha/following{/other_user}",
      "gists_url": "https://api.github.com/users/lucassaldanha/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lucassaldanha/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lucassaldanha/subscriptions",
      "organizations_url": "https://api.github.com/users/lucassaldanha/orgs",
      "repos_url": "https://api.github.com/users/lucassaldanha/repos",
      "events_url": "https://api.github.com/users/lucassaldanha/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lucassaldanha/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-27T19:59:20Z",
    "updated_at": "2023-01-27T19:59:20Z",
    "author_association": "MEMBER",
    "body": "From Discord:\r\n>  Seeing permission issues on docker since upgrading: stat /opt/teku/bin/teku: permission denied: unknown\r\nRunning as a different user --user UID:GID and it worked fine until the last version?\r\nRuns fine if I change the data directory owners to the current user (1000) and reruns without the user mapping.\r\n(just caught up on the permission differences in adduser in Ubuntu 22.04 -- looking forward to seeing the fix, thanks!)\r\n\r\nWaiting on their feedback if the fix works for them.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1407012126/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1407022803",
    "html_url": "https://github.com/ConsenSys/teku/issues/6741#issuecomment-1407022803",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6741",
    "id": 1407022803,
    "node_id": "IC_kwDOCM9I9M5T3XbT",
    "user": {
      "login": "overholts",
      "id": 5687558,
      "node_id": "MDQ6VXNlcjU2ODc1NTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/5687558?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/overholts",
      "html_url": "https://github.com/overholts",
      "followers_url": "https://api.github.com/users/overholts/followers",
      "following_url": "https://api.github.com/users/overholts/following{/other_user}",
      "gists_url": "https://api.github.com/users/overholts/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/overholts/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/overholts/subscriptions",
      "organizations_url": "https://api.github.com/users/overholts/orgs",
      "repos_url": "https://api.github.com/users/overholts/repos",
      "events_url": "https://api.github.com/users/overholts/events{/privacy}",
      "received_events_url": "https://api.github.com/users/overholts/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-27T20:08:01Z",
    "updated_at": "2023-01-27T20:08:01Z",
    "author_association": "NONE",
    "body": "Yep that fixed it for me, thanks!",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1407022803/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1408235476",
    "html_url": "https://github.com/ConsenSys/teku/issues/6741#issuecomment-1408235476",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/6741",
    "id": 1408235476,
    "node_id": "IC_kwDOCM9I9M5T7_fU",
    "user": {
      "login": "tbenr",
      "id": 15999009,
      "node_id": "MDQ6VXNlcjE1OTk5MDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbenr",
      "html_url": "https://github.com/tbenr",
      "followers_url": "https://api.github.com/users/tbenr/followers",
      "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
      "organizations_url": "https://api.github.com/users/tbenr/orgs",
      "repos_url": "https://api.github.com/users/tbenr/repos",
      "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbenr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-01-30T09:13:21Z",
    "updated_at": "2023-01-30T09:13:21Z",
    "author_association": "CONTRIBUTOR",
    "body": "fixed by https://github.com/ConsenSys/teku/pull/6743",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1408235476/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
