{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/3950",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/3950/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/3950/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/3950/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/3950",
  "id": 878405007,
  "node_id": "MDU6SXNzdWU4Nzg0MDUwMDc=",
  "number": 3950,
  "title": "invalid signature during block production on altair minimal network",
  "user": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2021-05-07T03:43:49Z",
  "updated_at": "2021-05-13T22:15:14Z",
  "closed_at": "2021-05-13T22:15:14Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "scenario: started a minimal network of altair to do some testing for APIs, and noticed this a couple of times in my logs:\n```\n2021-05-07 13:30:51.025+10:00 | validator-async-8 | ERROR | teku-validator-log | ^[[31mValidator   *** Failed to produce block  Slot: 832 Validator: ae00fc3^[[0m\ntech.pegasys.teku.spec.logic.common.statetransition.exceptions.StateTransitionException: tech.pegasys.teku.spec.logic.common.statetransition.exceptions.BlockProcessingException: Invalid sync committee signature in SyncAggregate{sync_committee_bits=SszBitvector{size=32, 11111111111111111111111111111111}, sync_committee_signature=SszByteVector{0x8a68f4032257182582d02afe12569a461296d06dc85115d504ac2929e6b277405f3bbac0e730274eadca97747d7ef899030f7f9033efb746dae154c51c1a9a4f088438db8ab15fcf03620d301fc5d21c0ca2af08e8a7d9fafe9864ec8640b318}}\n        at tech.pegasys.teku.spec.logic.common.util.BlockProposalUtil.createNewUnsignedBlock(BlockProposalUtil.java:80) ~[classes/:?]\n        at tech.pegasys.teku.spec.Spec.createNewUnsignedBlock(Spec.java:414) ~[classes/:?]\n        at tech.pegasys.teku.validator.coordinator.BlockFactory.createUnsignedBlock(BlockFactory.java:122) ~[classes/:?]\n        at tech.pegasys.teku.validator.coordinator.ValidatorApiHandler.createBlock(ValidatorApiHandler.java:309) ~[classes/:?]\n        at tech.pegasys.teku.validator.coordinator.ValidatorApiHandler.lambda$createUnsignedBlock$12(ValidatorApiHandler.java:292) ~[classes/:?]\n        at tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$thenApplyChecked$29(SafeFuture.java:415) ~[classes/:?]\n        at java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1106) ~[?:?]\n        at java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2235) ~[?:?]\n        at tech.pegasys.teku.infrastructure.async.SafeFuture.thenCompose(SafeFuture.java:463) ~[classes/:?]\n        at tech.pegasys.teku.infrastructure.async.SafeFuture.thenApplyChecked(SafeFuture.java:412) ~[classes/:?]\n        at tech.pegasys.teku.validator.coordinator.ValidatorApiHandler.lambda$createUnsignedBlock$13(ValidatorApiHandler.java:290) ~[classes/:?]\n        at java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:1072) ~[?:?]\n        at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:506) ~[?:?]\n        at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2073) ~[?:?]\n        at tech.pegasys.teku.dataproviders.generators.CachingTaskQueue.lambda$completePendingTask$9(CachingTaskQueue.java:204) ~[classes/:?]\n        at tech.pegasys.teku.infrastructure.async.SafeFuture.fromRunnable(SafeFuture.java:154) ~[classes/:?]\n        at tech.pegasys.teku.infrastructure.async.AsyncRunner.lambda$runAsync$0(AsyncRunner.java:23) ~[classes/:?]\n        at tech.pegasys.teku.infrastructure.async.SafeFuture.of(SafeFuture.java:73) ~[classes/:?]\n        at tech.pegasys.teku.infrastructure.async.ScheduledExecutorAsyncRunner.lambda$createRunnableForAction$1(ScheduledExecutorAsyncRunner.java:119) ~[classes/:?]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\n        at java.lang.Thread.run(Thread.java:834) [?:?]\nCaused by: tech.pegasys.teku.spec.logic.common.statetransition.exceptions.BlockProcessingException: Invalid sync committee signature in SyncAggregate{sync_committee_bits=SszBitvector{size=32, 11111111111111111111111111111111}, sync_committee_signature=SszByteVector{0x8a68f4032257182582d02afe12569a461296d06dc85115d504ac2929e6b277405f3bbac0e730274eadca97747d7ef899030f7f9033efb746dae154c51c1a9a4f088438db8ab15fcf03620d301fc5d21c0ca2af08e8a7d9fafe9864ec8640b318}}\n        at tech.pegasys.teku.spec.logic.versions.altair.block.BlockProcessorAltair.processSyncCommittee(BlockProcessorAltair.java:223) ~[classes/:?]\n        at tech.pegasys.teku.spec.logic.versions.altair.block.BlockProcessorAltair.processBlock(BlockProcessorAltair.java:99) ~[classes/:?]\n        at tech.pegasys.teku.spec.logic.common.block.BlockProcessor.lambda$processBlock$0(BlockProcessor.java:78) ~[classes/:?]\n        at tech.pegasys.teku.spec.datastructures.state.beaconstate.common.AbstractBeaconState.updated(AbstractBeaconState.java:59) ~[classes/:?]\n        at tech.pegasys.teku.spec.logic.common.block.BlockProcessor.processBlock(BlockProcessor.java:78) ~[classes/:?]\n        at tech.pegasys.teku.spec.logic.common.block.BlockProcessor.processBlock(BlockProcessor.java:72) ~[classes/:?]\n        at tech.pegasys.teku.spec.logic.common.util.BlockProposalUtil.createNewUnsignedBlock(BlockProposalUtil.java:73) ~[classes/:?]\n        ... 21 more\n```\n\non master at `872557e8d1cc77014263604d3839fcb483bdc40e`",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/3950/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/3950/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/834042397",
    "html_url": "https://github.com/ConsenSys/teku/issues/3950#issuecomment-834042397",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3950",
    "id": 834042397,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzNDA0MjM5Nw==",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-07T03:47:19Z",
    "updated_at": "2021-05-07T03:50:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "interestingly, epoch transition of 104,112, 120, 128 have all had this (first block of new epochs)",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/834042397/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/836115475",
    "html_url": "https://github.com/ConsenSys/teku/issues/3950#issuecomment-836115475",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3950",
    "id": 836115475,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzNjExNTQ3NQ==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-10T03:26:02Z",
    "updated_at": "2021-05-10T03:26:02Z",
    "author_association": "CONTRIBUTOR",
    "body": "I may be missing something but this looks like a bug in the spec.  Each block includes a `SyncAggregate` created from the `SyncCommitteeContribution` from the previous slot.  It can't include the ones from the same slot as the block because the block is published first, followed by the signatures and then the contributions, same attestations come after blocks.\n\nIn the block processing from the spec (https://github.com/ethereum/eth2.0-specs/blob/dev/specs/altair/beacon-chain.md#sync-committee-processing) it gets the public keys to verify the sync committee from `state.current_sync_committee`.  Since the state has already had empty slots processed, for the first slot in a new sync committee period the `SyncAggregate` will actually be from the previous sync committee and so this method will select the wrong public keys to use.  There isn't a way to get the previous sync committee to correctly verify the `SyncAggregate`.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/836115475/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/836128901",
    "html_url": "https://github.com/ConsenSys/teku/issues/3950#issuecomment-836128901",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3950",
    "id": 836128901,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzNjEyODkwMQ==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-10T03:47:34Z",
    "updated_at": "2021-05-10T03:47:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "I can't see what I'm missing so have logged https://github.com/ethereum/eth2.0-specs/issues/2397 so someone smarter can point it out to me. :)",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/836128901/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
