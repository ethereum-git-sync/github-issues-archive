{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/5384",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/5384/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/5384/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/5384/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/5384",
  "id": 1215228329,
  "node_id": "I_kwDOCM9I9M5Ibump",
  "number": 5384,
  "title": "java.lang.IllegalArgumentException: Invalid params response from Beacon Node API",
  "user": {
    "login": "briansun",
    "id": 39474,
    "node_id": "MDQ6VXNlcjM5NDc0",
    "avatar_url": "https://avatars.githubusercontent.com/u/39474?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/briansun",
    "html_url": "https://github.com/briansun",
    "followers_url": "https://api.github.com/users/briansun/followers",
    "following_url": "https://api.github.com/users/briansun/following{/other_user}",
    "gists_url": "https://api.github.com/users/briansun/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/briansun/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/briansun/subscriptions",
    "organizations_url": "https://api.github.com/users/briansun/orgs",
    "repos_url": "https://api.github.com/users/briansun/repos",
    "events_url": "https://api.github.com/users/briansun/events{/privacy}",
    "received_events_url": "https://api.github.com/users/briansun/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2022-04-26T01:23:06Z",
  "updated_at": "2022-05-04T23:51:24Z",
  "closed_at": "2022-05-04T00:44:41Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!-- \r\nBy filing an Issue, you are expected to comply with the Code of Conduct, \r\nincluding treating everyone with respect:\r\nhttps://github.com/ConsenSys/teku/blob/master/CODE-OF-CONDUCT.md\r\n\r\nNot all sections will apply to all issue types.\r\n-->\r\n\r\n### Description\r\nI'm using Infura Eth2 API as a Beacon Node with `--beacon-node-api-endpoint`\r\n\r\n### Error Message\r\n2022-04-25 22:46:47.406+00:00 | validator-async-4 | ERROR | RetryingDutyLoader | Failed to request validator duties for epoch 114852. Retrying after delay.\r\njava.util.concurrent.CompletionException: java.lang.IllegalArgumentException: Invalid params response from Beacon Node API (url = https://eth2-beacon-mainnet.infura.io/eth/v1/validator/duties/attester/114852)\r\nat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:331) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:346) ~[?:?]\r\nat java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:632) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:506) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2088) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:145) ~[teku-infrastructure-async-22.4.0.jar:22.4.0]\r\nat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:859) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.uniWhenCompleteStage(CompletableFuture.java:883) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.whenComplete(CompletableFuture.java:2251) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:536) ~[teku-infrastructure-async-22.4.0.jar:22.4.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:32) ~[teku-infrastructure-async-22.4.0.jar:22.4.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.propagateResult(SafeFuture.java:142) ~[teku-infrastructure-async-22.4.0.jar:22.4.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$exceptionallyCompose$27(SafeFuture.java:367) ~[teku-infrastructure-async-22.4.0.jar:22.4.0]\r\nat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:859) ~[?:?]\r\nat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:837) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:506) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2088) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:145) ~[teku-infrastructure-async-22.4.0.jar:22.4.0]\r\nat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:859) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.uniWhenCompleteStage(CompletableFuture.java:883) ~[?:?]\r\nat java.util.concurrent.CompletableFuture.whenComplete(CompletableFuture.java:2251) ~[?:?]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:536) ~[teku-infrastructure-async-22.4.0.jar:22.4.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:32) ~[teku-infrastructure-async-22.4.0.jar:22.4.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.propagateResult(SafeFuture.java:142) ~[teku-infrastructure-async-22.4.0.jar:22.4.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.propagateTo(SafeFuture.java:264) ~[teku-infrastructure-async-22.4.0.jar:22.4.0]\r\nat tech.pegasys.teku.infrastructure.async.ScheduledExecutorAsyncRunner.lambda$createRunnableForAction$1(ScheduledExecutorAsyncRunner.java:119) ~[teku-infrastructure-async-22.4.0.jar:22.4.0]\r\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\r\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\r\nat java.lang.Thread.run(Thread.java:829) ~[?:?]\r\nCaused by: java.lang.IllegalArgumentException: Invalid params response from Beacon Node API (url = https://eth2-beacon-mainnet.infura.io/eth/v1/validator/duties/attester/114852)\r\nat tech.pegasys.teku.validator.remote.apiclient.ResponseHandler.defaultBadRequestHandler(ResponseHandler.java:113) ~[teku-validator-remote-22.4.0.jar:22.4.0]\r\nat tech.pegasys.teku.validator.remote.apiclient.ResponseHandler.handleResponse(ResponseHandler.java:72) ~[teku-validator-remote-22.4.0.jar:22.4.0]\r\nat tech.pegasys.teku.validator.remote.apiclient.OkHttpValidatorRestApiClient.executeCall(OkHttpValidatorRestApiClient.java:404) ~[teku-validator-remote-22.4.0.jar:22.4.0]\r\nat tech.pegasys.teku.validator.remote.apiclient.OkHttpValidatorRestApiClient.post(OkHttpValidatorRestApiClient.java:375) ~[teku-validator-remote-22.4.0.jar:22.4.0]\r\nat tech.pegasys.teku.validator.remote.apiclient.OkHttpValidatorRestApiClient.getAttestationDuties(OkHttpValidatorRestApiClient.java:142) ~[teku-validator-remote-22.4.0.jar:22.4.0]\r\nat tech.pegasys.teku.validator.remote.RemoteValidatorApiHandler.lambda$getAttestationDuties$7(RemoteValidatorApiHandler.java:164) ~[teku-validator-remote-22.4.0.jar:22.4.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.of(SafeFuture.java:81) ~[teku-infrastructure-async-22.4.0.jar:22.4.0]\r\nat tech.pegasys.teku.validator.remote.RemoteValidatorApiHandler.sendRequest(RemoteValidatorApiHandler.java:453) ~[teku-validator-remote-22.4.0.jar:22.4.0]\r\nat tech.pegasys.teku.validator.remote.RemoteValidatorApiHandler.lambda$sendRequest$38(RemoteValidatorApiHandler.java:448) ~[teku-validator-remote-22.4.0.jar:22.4.0]\r\nat tech.pegasys.teku.infrastructure.async.SafeFuture.of(SafeFuture.java:73) ~[teku-infrastructure-async-22.4.0.jar:22.4.0]\r\n... 4 more\r\n\r\n**Frequency:** About 50% of attestations are missed or failed.\r\n\r\n### Versions (Add all that apply)\r\n* Software version: teku/v22.4.0/linux-x86_64/-ubuntu-openjdk64bitservervm-java-11\r\n* Java version: openjdk 11.0.14.1 2022-02-08\r\n* OS Name & Version: Ubuntu 20.04.4 LTS\r\n* Docker Version: -no-\r\n* Cloud VM, type, size: AWS 2GB ram, 1 vCPU, 60GB SSD",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/5384/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/5384/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1110341543",
    "html_url": "https://github.com/ConsenSys/teku/issues/5384#issuecomment-1110341543",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5384",
    "id": 1110341543,
    "node_id": "IC_kwDOCM9I9M5CLnen",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-26T23:24:30Z",
    "updated_at": "2022-04-26T23:24:30Z",
    "author_association": "CONTRIBUTOR",
    "body": "hmm, this could happen for quite a range of reasons.  The first thing to check though is that your validator client clock is in sync.\r\n\r\nIn general I would recommend against using Infura as a beacon node - the performance of a remote beacon node is always less than a local one because of the latency involved. In the future it will become even worse or even impossible to use Infura as a beacon node, particularly once proof of execution semantics are added to the protocol.\r\n\r\nIn the mean time though to diagnose this further we probably need to get some debug logs to get more detail on why the request is being rejected.  Can you try running with `--logging debug` please? It will generate quite a lot of log output so you may want to remove the option again once you've captured a few requests that are rejected like this.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1110341543/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1116836549",
    "html_url": "https://github.com/ConsenSys/teku/issues/5384#issuecomment-1116836549",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5384",
    "id": 1116836549,
    "node_id": "IC_kwDOCM9I9M5CkZLF",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-04T00:44:41Z",
    "updated_at": "2022-05-04T00:44:41Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm going to close this one as we don't have sufficient information to facilitate investigation.  If you're able to check the validator clock and grab the debug logs mentioned above please feel free to reopen.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1116836549/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1118033048",
    "html_url": "https://github.com/ConsenSys/teku/issues/5384#issuecomment-1118033048",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5384",
    "id": 1118033048,
    "node_id": "IC_kwDOCM9I9M5Co9SY",
    "user": {
      "login": "briansun",
      "id": 39474,
      "node_id": "MDQ6VXNlcjM5NDc0",
      "avatar_url": "https://avatars.githubusercontent.com/u/39474?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/briansun",
      "html_url": "https://github.com/briansun",
      "followers_url": "https://api.github.com/users/briansun/followers",
      "following_url": "https://api.github.com/users/briansun/following{/other_user}",
      "gists_url": "https://api.github.com/users/briansun/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/briansun/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/briansun/subscriptions",
      "organizations_url": "https://api.github.com/users/briansun/orgs",
      "repos_url": "https://api.github.com/users/briansun/repos",
      "events_url": "https://api.github.com/users/briansun/events{/privacy}",
      "received_events_url": "https://api.github.com/users/briansun/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-04T23:51:23Z",
    "updated_at": "2022-05-04T23:51:23Z",
    "author_association": "NONE",
    "body": "I agree with you that It's not a good idea to use Infura as beacon node\nsame as your reason.\n\nAfter I submitted this issue, I switched to Lighthouse. Firstly, it was\nstill unstable. Keep missing some attestations. Some, not all. Then I\nrun beacon node locally, starting with `checkpoint-sync` with Infura's\nbeacon node service. Then everything works together.\n\nStill thank you for your reply.\n\n\nOn May 4, 2022, GitHub ***@***.***> wrote:\n> Closed #5384 <https://github.com/ConsenSys/teku/issues/5384>.\n>\n\nâ€”\nReply to this email directly, view it on GitHub\n<https://github.com/ConsenSys/teku/issues/5384#event-6545283977>, or\nunsubscribe <https://github.com/notifications/unsubscribe-\nauth/AAAJUMUNXAGTZOE72WBHCLDVIHCAHANCNFSM5UKH2ZJQ>.\nYou are receiving this because you authored the thread.Message ID:\n***@***.***>\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1118033048/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
