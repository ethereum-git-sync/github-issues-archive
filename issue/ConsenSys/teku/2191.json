{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/2191",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/2191/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/2191/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/2191/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/2191",
  "id": 643058737,
  "node_id": "MDU6SXNzdWU2NDMwNTg3Mzc=",
  "number": 2191,
  "title": "Stall during Witti sync",
  "user": {
    "login": "benjaminion",
    "id": 20796281,
    "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/benjaminion",
    "html_url": "https://github.com/benjaminion",
    "followers_url": "https://api.github.com/users/benjaminion/followers",
    "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
    "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
    "organizations_url": "https://api.github.com/users/benjaminion/orgs",
    "repos_url": "https://api.github.com/users/benjaminion/repos",
    "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/benjaminion/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1048919129,
      "node_id": "MDU6TGFiZWwxMDQ4OTE5MTI5",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/bug%20%F0%9F%90%9E",
      "name": "bug üêû",
      "color": "dd6c94",
      "default": false,
      "description": "Something isn't working"
    },
    {
      "id": 2172542566,
      "node_id": "MDU6TGFiZWwyMTcyNTQyNTY2",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/P3",
      "name": "P3",
      "color": "FFFF00",
      "default": false,
      "description": "Medium"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2020-06-22T13:10:01Z",
  "updated_at": "2020-07-14T15:33:08Z",
  "closed_at": "2020-07-14T14:58:12Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "After failing to restart on Witti, I tried to resync. It went very well until slot 180653, when the sync stalled. Note the timestamps on the below. They are supposed to be every 12 seconds, but after hanging for a minute started being produced at erratic times.\r\n\r\nHeap size is 5GB and is only 30% used. Young GC is at ~1.5%, Old GC at 0%. But it's keeping 2.5 CPUs 100% busy with whatever it is doing.\r\n\r\n```\r\n12:37:00.093 INFO  - Sync Event  *** Current slot: 190985, Head slot: 178784, Connected peers: 26\r\n12:37:12.082 INFO  - Sync Event  *** Current slot: 190986, Head slot: 179351, Connected peers: 26\r\n12:37:24.064 INFO  - Sync Event  *** Current slot: 190987, Head slot: 179887, Connected peers: 26\r\n12:37:36.075 INFO  - Sync Event  *** Current slot: 190988, Head slot: 180561, Connected peers: 26\r\n12:38:44.966 INFO  - Sync Event  *** Current slot: 190989, Head slot: 180653, Connected peers: 26\r\n12:38:45.011 INFO  - Sync Event  *** Current slot: 190990, Head slot: 180653, Connected peers: 26\r\n12:38:45.049 INFO  - Sync Event  *** Current slot: 190991, Head slot: 180653, Connected peers: 26\r\n12:38:45.095 INFO  - Sync Event  *** Current slot: 190992, Head slot: 180653, Connected peers: 26\r\n12:38:45.130 INFO  - Sync Event  *** Current slot: 190993, Head slot: 180653, Connected peers: 26\r\n12:38:48.077 INFO  - Sync Event  *** Current slot: 190994, Head slot: 180653, Connected peers: 26\r\n12:39:56.683 INFO  - Sync Event  *** Current slot: 190995, Head slot: 180653, Connected peers: 26\r\n12:39:56.732 INFO  - Sync Event  *** Current slot: 190996, Head slot: 180653, Connected peers: 26\r\n12:39:56.764 INFO  - Sync Event  *** Current slot: 190997, Head slot: 180653, Connected peers: 26\r\n12:39:56.790 INFO  - Sync Event  *** Current slot: 190998, Head slot: 180653, Connected peers: 26\r\n12:39:56.824 INFO  - Sync Event  *** Current slot: 190999, Head slot: 180653, Connected peers: 26\r\n12:40:00.084 INFO  - Sync Event  *** Current slot: 191000, Head slot: 180653, Connected peers: 26\r\n12:41:08.497 INFO  - Sync Event  *** Current slot: 191001, Head slot: 180653, Connected peers: 26\r\n12:41:08.524 INFO  - Sync Event  *** Current slot: 191002, Head slot: 180653, Connected peers: 26\r\n12:41:08.555 INFO  - Sync Event  *** Current slot: 191003, Head slot: 180653, Connected peers: 26\r\n12:41:08.582 INFO  - Sync Event  *** Current slot: 191004, Head slot: 180653, Connected peers: 26\r\n12:41:08.610 INFO  - Sync Event  *** Current slot: 191005, Head slot: 180653, Connected peers: 26\r\n12:41:12.089 INFO  - Sync Event  *** Current slot: 191006, Head slot: 180653, Connected peers: 26\r\n12:42:20.582 INFO  - Sync Event  *** Current slot: 191007, Head slot: 180653, Connected peers: 26\r\n12:42:20.582 INFO  - Epoch Event *** Epoch: 5969, Justified checkpoint: 5615, Finalized checkpoint: 5554, Finalized root: 799829..56be\r\n12:42:20.629 INFO  - Sync Event  *** Current slot: 191008, Head slot: 180653, Connected peers: 26\r\n12:42:20.659 INFO  - Sync Event  *** Current slot: 191009, Head slot: 180653, Connected peers: 26\r\n12:42:20.696 INFO  - Sync Event  *** Current slot: 191010, Head slot: 180653, Connected peers: 26\r\n12:42:20.733 INFO  - Sync Event  *** Current slot: 191011, Head slot: 180653, Connected peers: 26\r\n12:42:24.098 INFO  - Sync Event  *** Current slot: 191012, Head slot: 180653, Connected peers: 27\r\n```\r\n\r\nTen minutes after this, the Head Slot back-tracked to 179842, and ten minutes after that the chain was suddenly shown as synced. The weird timestamp behaviour and high CPU load continued throughout this period, but fell back to normal after sync was completed.\r\n\r\n```\r\n12:51:36.261 INFO  - Sync Event  *** Current slot: 191058, Head slot: 180653, Connected peers: 28\r\n12:51:48.695 INFO  - Sync Event  *** Current slot: 191059, Head slot: 180653, Connected peers: 28\r\n12:52:01.413 INFO  - Sync Event  *** Current slot: 191060, Head slot: 179842, Connected peers: 28\r\n2020-06-22 12:52:11,749 qtp559179052-71 INFO Setting logging level on filter  to TRACE\r\n12:52:12.062 INFO  - Sync Event  *** Current slot: 191061, Head slot: 179842, Connected peers: 28\r\n12:52:24.774 INFO  - Sync Event  *** Current slot: 191062, Head slot: 179842, Connected peers: 28\r\n2020-06-22 12:52:29,902 qtp559179052-69 INFO Setting logging level on filter  to INFO\r\n12:52:36.823 INFO  - Sync Event  *** Current slot: 191063, Head slot: 179842, Connected peers: 28\r\n12:52:48.066 INFO  - Sync Event  *** Current slot: 191064, Head slot: 179842, Connected peers: 28\r\n12:53:00.060 INFO  - Sync Event  *** Current slot: 191065, Head slot: 179842, Connected peers: 28\r\n12:53:12.240 INFO  - Sync Event  *** Current slot: 191066, Head slot: 179842, Connected peers: 28\r\n12:53:24.550 INFO  - Sync Event  *** Current slot: 191067, Head slot: 179842, Connected peers: 28\r\n12:53:37.444 INFO  - Sync Event  *** Current slot: 191068, Head slot: 179842, Connected peers: 28\r\n12:53:48.267 INFO  - Sync Event  *** Current slot: 191069, Head slot: 179842, Connected peers: 28\r\n12:54:00.063 INFO  - Sync Event  *** Current slot: 191070, Head slot: 179842, Connected peers: 28\r\n12:54:12.187 INFO  - Sync Event  *** Current slot: 191071, Head slot: 179842, Connected peers: 28\r\n12:54:12.558 INFO  - Epoch Event *** Epoch: 5971, Justified checkpoint: 5615, Finalized checkpoint: 5554, Finalized root: 799829..56be\r\n12:54:24.464 INFO  - Sync Event  *** Current slot: 191072, Head slot: 179842, Connected peers: 28\r\n12:54:36.530 INFO  - Sync Event  *** Current slot: 191073, Head slot: 179842, Connected peers: 28\r\n2020-06-22 12:54:37,885 qtp559179052-66 INFO Setting logging level on filter  to DEBUG\r\n12:54:49.002 INFO  - Sync Event  *** Current slot: 191074, Head slot: 179842, Connected peers: 28\r\n12:55:00.066 INFO  - Sync Event  *** Current slot: 191075, Head slot: 179842, Connected peers: 28\r\n2020-06-22 12:55:01,619 qtp559179052-65 INFO Setting logging level on filter  to INFO\r\n12:55:15.065 INFO  - Sync Event  *** Current slot: 191076, Head slot: 179842, Connected peers: 28\r\n12:55:24.064 INFO  - Sync Event  *** Current slot: 191077, Head slot: 179842, Connected peers: 28\r\n12:55:36.081 INFO  - Sync Event  *** Current slot: 191078, Head slot: 179842, Connected peers: 28\r\n12:56:33.213 INFO  - Sync Event  *** Current slot: 191079, Head slot: 179842, Connected peers: 28\r\n12:56:33.250 INFO  - Sync Event  *** Current slot: 191080, Head slot: 179842, Connected peers: 28\r\n12:56:33.280 INFO  - Sync Event  *** Current slot: 191081, Head slot: 179842, Connected peers: 28\r\n12:56:33.311 INFO  - Sync Event  *** Current slot: 191082, Head slot: 179842, Connected peers: 28\r\n12:56:36.083 INFO  - Sync Event  *** Current slot: 191083, Head slot: 179842, Connected peers: 28\r\n12:56:52.063 INFO  - Slot Event  *** Slot: 191084, Block:    ... empty, Epoch: 5971, Finalized checkpoint: 5554, Finalized root: 799829..56be, Peers: 28\r\n12:57:04.066 INFO  - Slot Event  *** Slot: 191085, Block: 6744cc..5259, Epoch: 5971, Finalized checkpoint: 5554, Finalized root: 799829..56be, Peers: 28\r\n```\r\n\r\nSince this was during a long period of non-finalisation (staring at slot 177728), perhaps Teku was exploring a long fork. It's hard to tell from the available info, and I don't think that explains everything...\r\n\r\nI have some DEBUG and TRACE logs from during this period if they are interesting.",
  "closed_by": {
    "login": "cemozerr",
    "id": 16581242,
    "node_id": "MDQ6VXNlcjE2NTgxMjQy",
    "avatar_url": "https://avatars.githubusercontent.com/u/16581242?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/cemozerr",
    "html_url": "https://github.com/cemozerr",
    "followers_url": "https://api.github.com/users/cemozerr/followers",
    "following_url": "https://api.github.com/users/cemozerr/following{/other_user}",
    "gists_url": "https://api.github.com/users/cemozerr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/cemozerr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/cemozerr/subscriptions",
    "organizations_url": "https://api.github.com/users/cemozerr/orgs",
    "repos_url": "https://api.github.com/users/cemozerr/repos",
    "events_url": "https://api.github.com/users/cemozerr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/cemozerr/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/2191/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/2191/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/648374811",
    "html_url": "https://github.com/ConsenSys/teku/issues/2191#issuecomment-648374811",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2191",
    "id": 648374811,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0ODM3NDgxMQ==",
    "user": {
      "login": "cemozerr",
      "id": 16581242,
      "node_id": "MDQ6VXNlcjE2NTgxMjQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/16581242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cemozerr",
      "html_url": "https://github.com/cemozerr",
      "followers_url": "https://api.github.com/users/cemozerr/followers",
      "following_url": "https://api.github.com/users/cemozerr/following{/other_user}",
      "gists_url": "https://api.github.com/users/cemozerr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cemozerr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cemozerr/subscriptions",
      "organizations_url": "https://api.github.com/users/cemozerr/orgs",
      "repos_url": "https://api.github.com/users/cemozerr/repos",
      "events_url": "https://api.github.com/users/cemozerr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cemozerr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-23T19:34:58Z",
    "updated_at": "2020-06-23T19:34:58Z",
    "author_association": "CONTRIBUTOR",
    "body": "It would be really nice to register Metal Albert with Pegasys Grafana and Kibana to have these logs accessible. I can help you with that. (Of course, not sure how much effort it would require to wire Metal Albert to PegaSys Grafana, it might be better to set up your nodes on PegaSys AWS instead) Do you mind sharing the DEBUG level logs?",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/648374811/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/648460300",
    "html_url": "https://github.com/ConsenSys/teku/issues/2191#issuecomment-648460300",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2191",
    "id": 648460300,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0ODQ2MDMwMA==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-23T22:25:29Z",
    "updated_at": "2020-06-23T22:25:29Z",
    "author_association": "CONTRIBUTOR",
    "body": "The Grafana and Kibana servers are internal to AWS so we won't be able to get Metal Albert onto them.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/648460300/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/648735592",
    "html_url": "https://github.com/ConsenSys/teku/issues/2191#issuecomment-648735592",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2191",
    "id": 648735592,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY0ODczNTU5Mg==",
    "user": {
      "login": "benjaminion",
      "id": 20796281,
      "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjaminion",
      "html_url": "https://github.com/benjaminion",
      "followers_url": "https://api.github.com/users/benjaminion/followers",
      "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
      "organizations_url": "https://api.github.com/users/benjaminion/orgs",
      "repos_url": "https://api.github.com/users/benjaminion/repos",
      "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjaminion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-06-24T10:24:08Z",
    "updated_at": "2020-06-24T10:24:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "Here's a [gist](https://gist.github.com/benjaminion/741728b9cf433a1be18b82df989e3281) of the DEBUG log that covers some of the second period (just after the head slot backtracked to 179842 - unfortunately I turned on DEBUG too late to catch the earlier phase with the head slot at 180653).",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/648735592/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/652459186",
    "html_url": "https://github.com/ConsenSys/teku/issues/2191#issuecomment-652459186",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2191",
    "id": 652459186,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1MjQ1OTE4Ng==",
    "user": {
      "login": "cemozerr",
      "id": 16581242,
      "node_id": "MDQ6VXNlcjE2NTgxMjQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/16581242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cemozerr",
      "html_url": "https://github.com/cemozerr",
      "followers_url": "https://api.github.com/users/cemozerr/followers",
      "following_url": "https://api.github.com/users/cemozerr/following{/other_user}",
      "gists_url": "https://api.github.com/users/cemozerr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cemozerr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cemozerr/subscriptions",
      "organizations_url": "https://api.github.com/users/cemozerr/orgs",
      "repos_url": "https://api.github.com/users/cemozerr/repos",
      "events_url": "https://api.github.com/users/cemozerr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cemozerr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-01T14:40:01Z",
    "updated_at": "2020-07-01T14:40:01Z",
    "author_association": "CONTRIBUTOR",
    "body": "Not sure what to make of this one. It's potentially a high priority bug, but we also haven't seen it again, and potentially might be fixed. I'll keep it open for a few more days, and then close the issue if it doesn't repeat.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/652459186/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/658229902",
    "html_url": "https://github.com/ConsenSys/teku/issues/2191#issuecomment-658229902",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2191",
    "id": 658229902,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY1ODIyOTkwMg==",
    "user": {
      "login": "cemozerr",
      "id": 16581242,
      "node_id": "MDQ6VXNlcjE2NTgxMjQy",
      "avatar_url": "https://avatars.githubusercontent.com/u/16581242?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/cemozerr",
      "html_url": "https://github.com/cemozerr",
      "followers_url": "https://api.github.com/users/cemozerr/followers",
      "following_url": "https://api.github.com/users/cemozerr/following{/other_user}",
      "gists_url": "https://api.github.com/users/cemozerr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/cemozerr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/cemozerr/subscriptions",
      "organizations_url": "https://api.github.com/users/cemozerr/orgs",
      "repos_url": "https://api.github.com/users/cemozerr/repos",
      "events_url": "https://api.github.com/users/cemozerr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/cemozerr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-07-14T14:58:12Z",
    "updated_at": "2020-07-14T15:33:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "Closing this as it seems to not repeat.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/658229902/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
