{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/1526",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/1526/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/1526/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/1526/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/1526",
  "id": 592958815,
  "node_id": "MDU6SXNzdWU1OTI5NTg4MTU=",
  "number": 1526,
  "title": "Changes to log4j config are not picked up at runtime",
  "user": {
    "login": "mbaxter",
    "id": 658601,
    "node_id": "MDQ6VXNlcjY1ODYwMQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/658601?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mbaxter",
    "html_url": "https://github.com/mbaxter",
    "followers_url": "https://api.github.com/users/mbaxter/followers",
    "following_url": "https://api.github.com/users/mbaxter/following{/other_user}",
    "gists_url": "https://api.github.com/users/mbaxter/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mbaxter/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mbaxter/subscriptions",
    "organizations_url": "https://api.github.com/users/mbaxter/orgs",
    "repos_url": "https://api.github.com/users/mbaxter/repos",
    "events_url": "https://api.github.com/users/mbaxter/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mbaxter/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2020-04-02T22:35:50Z",
  "updated_at": "2020-04-06T14:04:33Z",
  "closed_at": "2020-04-06T14:04:32Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\r\nWhen running teku (version at https://github.com/PegaSysEng/teku/commit/4e3281b18dfe36a94c8ca4fb84704e9b3408935b), it appears that updates to my `log4j2.xml` file are not being picked up at runtime.  Previously, when updating log levels etc, changes would be picked up immediately.\r\n\r\nI am setting an env var `LOG4J_CONFIGURATION_FILE` pointing to my log4j config and it appears this is getting picked up:\r\n```\r\n2020-04-02 22:19:13,560 main INFO Custom logging configuration applied from: /home/ec2-user/log4j2.xml\r\n```\r\n\r\nI am not setting any logging options via CLI args or my config.toml.  \r\n\r\nMy config consists of: \r\n```\r\ndata-path = \"/data/data\"\r\ndata-storage-mode = \"prune\"\r\nnetwork=\"/data/config/config.yaml\"\r\nXinterop-enabled=true\r\nXinterop-start-state=\"/data/config/genesis.ssz\"\r\nXinterop-genesis-time=0\r\np2p-discovery-bootnodes=[\"-Iu4QGuiaVXBEoi4kcLbsoPYX7GTK9ExOODTuqYBp9CyHN_PSDtnLMCIL91ydxUDRPZ-jem-o0WotK6JoZjPQWhTfEsTgmlkgnY0gmlwhDbOLfeJc2VjcDI1NmsxoQLVqNEoCVTC74VmUx25USyFe7lL0TgpXHaCX9CDy9H6boN0Y3CCIyiDdWRwgiMo\",\"-Iu4QLNTiVhgyDyvCBnewNcn9Wb7fjPoKYD2NPe-jDZ3_TqaGFK8CcWr7ai7w9X8Im_ZjQYyeoBP_luLLBB4wy39gQ4JgmlkgnY0gmlwhCOhiGqJc2VjcDI1NmsxoQMrmBYg_yR_ZKZKoLiChvlpNqdwXwodXmgw_TRow7RVwYN0Y3CCIyiDdWRwgiMo\",\"-Iu4QLpJhdfRFsuMrAsFQOSZTIW1PAf7Ndg0GB0tMByt2-n1bwVgLsnHOuujMg-YLns9g1Rw8rfcw1KCZjQrnUcUdekNgmlkgnY0gmlwhA01ZgSJc2VjcDI1NmsxoQPk2OMW7stSjbdcMgrKEdFOLsRkIuxgBFryA3tIJM0YxYN0Y3CCIyiDdWRwgiMo\"]\r\n```\r\n\r\nAnd I'm running teku with just the `config-file` CLI arg:\r\n```\r\nteku --config-file=config.toml\r\n```\r\n",
  "closed_by": {
    "login": "mbaxter",
    "id": 658601,
    "node_id": "MDQ6VXNlcjY1ODYwMQ==",
    "avatar_url": "https://avatars.githubusercontent.com/u/658601?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/mbaxter",
    "html_url": "https://github.com/mbaxter",
    "followers_url": "https://api.github.com/users/mbaxter/followers",
    "following_url": "https://api.github.com/users/mbaxter/following{/other_user}",
    "gists_url": "https://api.github.com/users/mbaxter/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/mbaxter/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/mbaxter/subscriptions",
    "organizations_url": "https://api.github.com/users/mbaxter/orgs",
    "repos_url": "https://api.github.com/users/mbaxter/repos",
    "events_url": "https://api.github.com/users/mbaxter/events{/privacy}",
    "received_events_url": "https://api.github.com/users/mbaxter/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/1526/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/1526/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/608138207",
    "html_url": "https://github.com/ConsenSys/teku/issues/1526#issuecomment-608138207",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/1526",
    "id": 608138207,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwODEzODIwNw==",
    "user": {
      "login": "CjHare",
      "id": 13285122,
      "node_id": "MDQ6VXNlcjEzMjg1MTIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/13285122?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CjHare",
      "html_url": "https://github.com/CjHare",
      "followers_url": "https://api.github.com/users/CjHare/followers",
      "following_url": "https://api.github.com/users/CjHare/following{/other_user}",
      "gists_url": "https://api.github.com/users/CjHare/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CjHare/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CjHare/subscriptions",
      "organizations_url": "https://api.github.com/users/CjHare/orgs",
      "repos_url": "https://api.github.com/users/CjHare/repos",
      "events_url": "https://api.github.com/users/CjHare/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CjHare/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-02T23:10:14Z",
    "updated_at": "2020-04-02T23:10:14Z",
    "author_association": "CONTRIBUTOR",
    "body": "What does the log4j config file look like, specifically does it contain the `monitorInterval` in the `Configuration` element?\r\n\r\n```\r\n<Configuration monitorInterval=\"30\">\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/608138207/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/608248802",
    "html_url": "https://github.com/ConsenSys/teku/issues/1526#issuecomment-608248802",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/1526",
    "id": 608248802,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwODI0ODgwMg==",
    "user": {
      "login": "CjHare",
      "id": 13285122,
      "node_id": "MDQ6VXNlcjEzMjg1MTIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/13285122?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CjHare",
      "html_url": "https://github.com/CjHare",
      "followers_url": "https://api.github.com/users/CjHare/followers",
      "following_url": "https://api.github.com/users/CjHare/following{/other_user}",
      "gists_url": "https://api.github.com/users/CjHare/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CjHare/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CjHare/subscriptions",
      "organizations_url": "https://api.github.com/users/CjHare/orgs",
      "repos_url": "https://api.github.com/users/CjHare/repos",
      "events_url": "https://api.github.com/users/CjHare/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CjHare/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-03T06:09:09Z",
    "updated_at": "2020-04-03T06:09:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "Locally, log4j scanning of custom config file occurs, with the following output to console\r\n```\r\n2020-04-03 16:04:44,723 main INFO Custom logging configuration applied from: ./../../custom.xml\r\n```\r\nthen after a change to `custom.xml` this output follows and the change is applied\r\n```\r\n2020-04-03 16:05:29,093 Log4j2-TF-3-Scheduled-1 INFO Source '/Users/chris.hare/Documents/code/pegasys/teku/./../../custom.xml' was modified on Fri Apr 03 16:05:25 AEST 2020 (1585893925377), previous modification was on Fri Mar 13 18:30:23 AEST 2020 (1584088223982)\r\n2020-04-03 16:05:29,096 Log4j2-TF-1-ConfiguratonFileWatcher-2 INFO Log4j appears to be running in a Servlet environment, but there's no log4j-web module available. If you want better web container support, please add the log4j-web JAR to your web archive or server lib directory.\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/608248802/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/608530634",
    "html_url": "https://github.com/ConsenSys/teku/issues/1526#issuecomment-608530634",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/1526",
    "id": 608530634,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwODUzMDYzNA==",
    "user": {
      "login": "mbaxter",
      "id": 658601,
      "node_id": "MDQ6VXNlcjY1ODYwMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/658601?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mbaxter",
      "html_url": "https://github.com/mbaxter",
      "followers_url": "https://api.github.com/users/mbaxter/followers",
      "following_url": "https://api.github.com/users/mbaxter/following{/other_user}",
      "gists_url": "https://api.github.com/users/mbaxter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mbaxter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mbaxter/subscriptions",
      "organizations_url": "https://api.github.com/users/mbaxter/orgs",
      "repos_url": "https://api.github.com/users/mbaxter/repos",
      "events_url": "https://api.github.com/users/mbaxter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mbaxter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-03T16:14:55Z",
    "updated_at": "2020-04-03T16:14:55Z",
    "author_association": "CONTRIBUTOR",
    "body": "@CjHare - I did not have the `monitorInterval` attribute in my log4j config.  After adding that, it does look like my changes are getting picked up.\r\n\r\nShould we add a default `monitorInterval` value?  It seems like previously we were picking up changes without explicitly defining the `monitorInterval`. ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/608530634/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/609521785",
    "html_url": "https://github.com/ConsenSys/teku/issues/1526#issuecomment-609521785",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/1526",
    "id": 609521785,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwOTUyMTc4NQ==",
    "user": {
      "login": "CjHare",
      "id": 13285122,
      "node_id": "MDQ6VXNlcjEzMjg1MTIy",
      "avatar_url": "https://avatars.githubusercontent.com/u/13285122?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/CjHare",
      "html_url": "https://github.com/CjHare",
      "followers_url": "https://api.github.com/users/CjHare/followers",
      "following_url": "https://api.github.com/users/CjHare/following{/other_user}",
      "gists_url": "https://api.github.com/users/CjHare/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/CjHare/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/CjHare/subscriptions",
      "organizations_url": "https://api.github.com/users/CjHare/orgs",
      "repos_url": "https://api.github.com/users/CjHare/repos",
      "events_url": "https://api.github.com/users/CjHare/events{/privacy}",
      "received_events_url": "https://api.github.com/users/CjHare/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-06T01:25:42Z",
    "updated_at": "2020-04-06T01:27:44Z",
    "author_association": "CONTRIBUTOR",
    "body": ">“If the monitorInterval attribute is specified on the configuration element and is set to a non-zero value then the file will be checked the next time a log event is evaluated and/or logged and the monitorInterval has elapsed since the last check”\r\n\r\nhttps://logging.apache.org/log4j/2.x/manual/configuration.html\r\n\r\nThe price for having `monitorInterval` active is additional read ops.\r\n\r\n\r\n> Should we add a default monitorInterval value?\r\n\r\nLeaning towards probably not.\r\n\r\nThere is now an endpoint available (same functionality as Besu) that can be used to change log levels on demand.\r\n\r\nFor users falling back on the default Log4j2.xml, I’m imagining that feature is unlikely to be used (I’m thinking deployed app, file bound up in a JAR).\r\nFor users applying their own custom Lo4j2.xml and wanting that feature (as you were), then using the ‘monitorInterval’ seems a reasonable remedy.\r\n\r\nThe other challenge with applying a default value being the lack of ability to set that on the Log4j2 `Configuration`. The variable exists only as a method scoped variable in the parsing method on the concrete configuration class (e.g. `XmlConfiguration` constructor).\r\n\r\n\r\n> It seems like previously we were picking up changes without explicitly defining the monitorInterval.\r\n\r\nI’m not entirely sure why this would be. However over the course of the changes the Log4j2 version has been updated, so that might have been a fixed bug in Log4j2 🤔 ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/609521785/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/609815599",
    "html_url": "https://github.com/ConsenSys/teku/issues/1526#issuecomment-609815599",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/1526",
    "id": 609815599,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwOTgxNTU5OQ==",
    "user": {
      "login": "mbaxter",
      "id": 658601,
      "node_id": "MDQ6VXNlcjY1ODYwMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/658601?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mbaxter",
      "html_url": "https://github.com/mbaxter",
      "followers_url": "https://api.github.com/users/mbaxter/followers",
      "following_url": "https://api.github.com/users/mbaxter/following{/other_user}",
      "gists_url": "https://api.github.com/users/mbaxter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mbaxter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mbaxter/subscriptions",
      "organizations_url": "https://api.github.com/users/mbaxter/orgs",
      "repos_url": "https://api.github.com/users/mbaxter/repos",
      "events_url": "https://api.github.com/users/mbaxter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mbaxter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-06T14:04:32Z",
    "updated_at": "2020-04-06T14:04:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "Sounds good.  Thanks for investigating @CjHare!   ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/609815599/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
