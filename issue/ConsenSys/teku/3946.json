{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/3946",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/3946/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/3946/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/3946/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/3946",
  "id": 878237392,
  "node_id": "MDU6SXNzdWU4NzgyMzczOTI=",
  "number": 3946,
  "title": "Altair: Invalid signatures for blocks and attestations after fork activates",
  "user": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2021-05-07T00:28:23Z",
  "updated_at": "2021-05-09T23:35:03Z",
  "closed_at": "2021-05-09T23:35:03Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\r\nWe appear to generate invalid signatures once Altair activates for both blocks and attestations. Tested with minimal config and fork block  set to 8.\r\n\r\nBlocks don't give as clear an error but one of the signatures is invalid:\r\n```\r\n2021-05-07 10:24:37.101 | forkchoice-async-0        | WARN  | AbstractBlockProcessor         | State Transition error\r\ntech.pegasys.teku.spec.logic.common.statetransition.exceptions.BlockProcessingException: null\r\n\tat tech.pegasys.teku.spec.logic.common.block.AbstractBlockProcessor.processAndValidateBlock(AbstractBlockProcessor.java:138) ~[classes/:?]\r\n\tat tech.pegasys.teku.spec.logic.common.util.ForkChoiceUtil.onBlock(ForkChoiceUtil.java:325) ~[classes/:?]\r\n\tat tech.pegasys.teku.spec.Spec.onBlock(Spec.java:365) ~[classes/:?]\r\n\tat tech.pegasys.teku.statetransition.forkchoice.ForkChoice.lambda$onBlock$4(ForkChoice.java:190) ~[classes/:?]\r\n\tat tech.pegasys.teku.infrastructure.async.eventthread.AsyncRunnerEventThread.recordEventThreadIdAndExecute(AsyncRunnerEventThread.java:109) ~[classes/:?]\r\n\tat tech.pegasys.teku.infrastructure.async.eventthread.AsyncRunnerEventThread.lambda$doExecute$1(AsyncRunnerEventThread.java:92) ~[classes/:?]\r\n\tat tech.pegasys.teku.infrastructure.async.SafeFuture.of(SafeFuture.java:81) ~[classes/:?]\r\n\tat tech.pegasys.teku.infrastructure.async.AsyncRunner.lambda$runAsync$2(AsyncRunner.java:38) ~[classes/:?]\r\n\tat tech.pegasys.teku.infrastructure.async.SafeFuture.of(SafeFuture.java:73) ~[classes/:?]\r\n\tat tech.pegasys.teku.infrastructure.async.ScheduledExecutorAsyncRunner.lambda$createRunnableForAction$1(ScheduledExecutorAsyncRunner.java:119) ~[classes/:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1130) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:630) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:832) [?:?]\r\n```\r\n\r\nAttestations report:\r\n```\r\n2021-05-07 10:24:39.097 | ValidatorApiChannel-0     | ERROR | teku-validator-log             | Validator   *** Produced invalid attestation for slot 8. Invalid reason: Signature is invalid\r\n2021-05-07 10:24:39.098 | validator-async-2         | INFO  | teku-validator-log             | Validator   *** Published attestation        Count: 8, Slot: 8, Root: d54604..744a\r\n2021-05-07 10:24:39.100 | ValidatorApiChannel-0     | ERROR | teku-validator-log             | Validator   *** Produced invalid attestation for slot 8. Invalid reason: Signature is invalid\r\n2021-05-07 10:24:39.102 | ValidatorApiChannel-0     | ERROR | teku-validator-log             | Validator   *** Produced invalid attestation for slot 8. Invalid reason: Signature is invalid\r\n2021-05-07 10:24:39.105 | ValidatorApiChannel-0     | ERROR | teku-validator-log             | Validator   *** Produced invalid attestation for slot 8. Invalid reason: Signature is invalid\r\n2021-05-07 10:24:39.107 | ValidatorApiChannel-0     | ERROR | teku-validator-log             | Validator   *** Produced invalid attestation for slot 8. Invalid reason: Signature is invalid\r\n2021-05-07 10:24:39.110 | ValidatorApiChannel-0     | ERROR | teku-validator-log             | Validator   *** Produced invalid attestation for slot 8. Invalid reason: Signature is invalid\r\n2021-05-07 10:24:39.112 | ValidatorApiChannel-0     | ERROR | teku-validator-log             | Validator   *** Produced invalid attestation for slot 8. Invalid reason: Signature is invalid\r\n2021-05-07 10:24:39.115 | ValidatorApiChannel-0     | ERROR | teku-validator-log             | Validator   *** Produced invalid attestation for slot 8. Invalid reason: Signature is invalid\r\n```\r\n\r\nThe problem continues beyond the fork activation slot.",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/3946/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/3946/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/833971357",
    "html_url": "https://github.com/ConsenSys/teku/issues/3946#issuecomment-833971357",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3946",
    "id": 833971357,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgzMzk3MTM1Nw==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-05-07T00:32:12Z",
    "updated_at": "2021-05-07T00:32:12Z",
    "author_association": "CONTRIBUTOR",
    "body": "This will almost certainly be that `ForkProvider` isn't getting the new fork.  It's getting the fork from the best state but really wants to get the next fork to activate if any (that includes the previous fork which is the currently active one).",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/833971357/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
