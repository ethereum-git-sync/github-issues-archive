{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/5386",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/5386/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/5386/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/5386/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/5386",
  "id": 1215793055,
  "node_id": "I_kwDOCM9I9M5Id4ef",
  "number": 5386,
  "title": "Validator api requires ssl keystore to be defined",
  "user": {
    "login": "pablomendezroyo",
    "id": 41727368,
    "node_id": "MDQ6VXNlcjQxNzI3MzY4",
    "avatar_url": "https://avatars.githubusercontent.com/u/41727368?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pablomendezroyo",
    "html_url": "https://github.com/pablomendezroyo",
    "followers_url": "https://api.github.com/users/pablomendezroyo/followers",
    "following_url": "https://api.github.com/users/pablomendezroyo/following{/other_user}",
    "gists_url": "https://api.github.com/users/pablomendezroyo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pablomendezroyo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pablomendezroyo/subscriptions",
    "organizations_url": "https://api.github.com/users/pablomendezroyo/orgs",
    "repos_url": "https://api.github.com/users/pablomendezroyo/repos",
    "events_url": "https://api.github.com/users/pablomendezroyo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pablomendezroyo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 13,
  "created_at": "2022-04-26T11:09:52Z",
  "updated_at": "2022-04-29T23:53:47Z",
  "closed_at": "2022-04-27T02:48:40Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "<!-- \r\nBy filing an Issue, you are expected to comply with the Code of Conduct, \r\nincluding treating everyone with respect:\r\nhttps://github.com/ConsenSys/teku/blob/master/CODE-OF-CONDUCT.md\r\n\r\nNot all sections will apply to all issue types.\r\n-->\r\n\r\n### Description\r\n[Detailed description of the problem and the impact it has]\r\n[Please be as specific as possible]\r\nStarting teku in \"web3signer mode\" with validator API enabled (and all the other required flags) result in an error if not tls keys are defined (probably with `--validators-external-signer-keystore`)\r\n\r\nHowever starting teku in \"web3signer mode\" without the validator API enabled and without the tls keys setup, is allowed.\r\n### Steps to Reproduce (Bug)\r\nStart Teku with \r\n```\r\n/opt/teku/bin/teku validator-client --network=auto --data-base-path=/opt/teku/data \\\r\n     --beacon-node-api-endpoint=%(ENV_BEACON_NODE_ADDR)s \\\r\n     --validators-external-signer-url=%(ENV_WEB3SIGNER_API)s --log-destination=CONSOLE \\ \r\n     --metrics-enabled=true --metrics-interface 0.0.0.0 --metrics-port 8008 \\ \r\n     --metrics-host-allowlist=* --validator-api-enabled=true \\ \r\n     --validator-api-interface=0.0.0.0 --validator-api-port=%(ENV_VALIDATOR_PORT)s \\ \r\n     --validator-api-host-allowlist=0.0.0.0 %(ENV_EXTRA_OPTS)s\r\n```\r\n**Expected behavior:** [What you expect to happen]\r\nAllow starting teku in web3signer mode with validator API enabled without tls configured\r\n**Actual behavior:** [What actually happens]\r\nError\r\n```\r\nValidator api requires ssl keystore to be defined\r\n```\r\n**Frequency:** [How regularly does it occur?]\r\nOn startup\r\n### Versions (Add all that apply)\r\n* Software version: [`teku --version` or look for log lines starting with `Teku version:`] 22.4.0\r\n* Java version: [`java -version`] official docker image\r\n* OS Name & Version: [`cat /etc/*release`] official docker image\r\n* Docker Version: [`docker version`] 20.10.2\r\n* Cloud VM, type, size: [Amazon Web Services I3-large]",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/5386/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/5386/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1110385968",
    "html_url": "https://github.com/ConsenSys/teku/issues/5386#issuecomment-1110385968",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5386",
    "id": 1110385968,
    "node_id": "IC_kwDOCM9I9M5CLyUw",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-27T00:44:11Z",
    "updated_at": "2022-04-27T00:44:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "I don't think this is related to web3signer.  The validator API requires the use of SSL for security - it's transferring your validator private key so unencrypted setups are extremely unsafe. So to enable the validator API you need to provide an SSL private key for it to use for the server via the options:\r\n\r\n```\r\n      --validator-api-keystore-file=<keystoreFile>\r\n                             Keystore used for ssl for the validator api.\r\n      --validator-api-keystore-password-file=<keystorePasswordFile>\r\n                             Password used to decrypt the keystore for the\r\n                               validator api.\r\n```\r\n\r\nThe `--validators-external-signer-keystore` option is only required if web3signer is using TLS mutual authentication which is not required but can be used for additional security.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1110385968/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1110637397",
    "html_url": "https://github.com/ConsenSys/teku/issues/5386#issuecomment-1110637397",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5386",
    "id": 1110637397,
    "node_id": "IC_kwDOCM9I9M5CMvtV",
    "user": {
      "login": "pablomendezroyo",
      "id": 41727368,
      "node_id": "MDQ6VXNlcjQxNzI3MzY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/41727368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pablomendezroyo",
      "html_url": "https://github.com/pablomendezroyo",
      "followers_url": "https://api.github.com/users/pablomendezroyo/followers",
      "following_url": "https://api.github.com/users/pablomendezroyo/following{/other_user}",
      "gists_url": "https://api.github.com/users/pablomendezroyo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pablomendezroyo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pablomendezroyo/subscriptions",
      "organizations_url": "https://api.github.com/users/pablomendezroyo/orgs",
      "repos_url": "https://api.github.com/users/pablomendezroyo/repos",
      "events_url": "https://api.github.com/users/pablomendezroyo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pablomendezroyo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-27T07:21:35Z",
    "updated_at": "2022-04-27T07:29:29Z",
    "author_association": "NONE",
    "body": "@ajsutton Thank you for the well-detailed response.\r\n\r\nThat makes sense for importing local keystores, see https://ethereum.github.io/keymanager-APIs/#/Local%20Key%20Manager/ImportKeystores\r\n\r\nBut it does not make sense at all for remote keystores, see https://ethereum.github.io/keymanager-APIs/#/Remote%20Key%20Manager\r\n\r\nDoes even Teku support the validator remote keymanager API? This is related with the web3signer since the remote keymanager API is used to import/delete/get remote keystores. So, currently in Teku it is allowed to use the web3signer without encryption but not the validator API for remote keystores, which does not make sense at all",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1110637397/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1110651095",
    "html_url": "https://github.com/ConsenSys/teku/issues/5386#issuecomment-1110651095",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5386",
    "id": 1110651095,
    "node_id": "IC_kwDOCM9I9M5CMzDX",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-27T07:35:32Z",
    "updated_at": "2022-04-27T07:35:32Z",
    "author_association": "CONTRIBUTOR",
    "body": "Even with remote signers the validator api includes some quite important administrative functions for starting and stopping validators so we've settled in requiring it to use ssl. The key manager api requires token based authentication and that's not secure without ssl. \n\nWhy are you unable to use ssl? In most cases a self signed cert will work fine - especially when the api is used with a client that can be set to explicitly require that cert. ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1110651095/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1111213044",
    "html_url": "https://github.com/ConsenSys/teku/issues/5386#issuecomment-1111213044",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5386",
    "id": 1111213044,
    "node_id": "IC_kwDOCM9I9M5CO8P0",
    "user": {
      "login": "pablomendezroyo",
      "id": 41727368,
      "node_id": "MDQ6VXNlcjQxNzI3MzY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/41727368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pablomendezroyo",
      "html_url": "https://github.com/pablomendezroyo",
      "followers_url": "https://api.github.com/users/pablomendezroyo/followers",
      "following_url": "https://api.github.com/users/pablomendezroyo/following{/other_user}",
      "gists_url": "https://api.github.com/users/pablomendezroyo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pablomendezroyo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pablomendezroyo/subscriptions",
      "organizations_url": "https://api.github.com/users/pablomendezroyo/orgs",
      "repos_url": "https://api.github.com/users/pablomendezroyo/repos",
      "events_url": "https://api.github.com/users/pablomendezroyo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pablomendezroyo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-27T16:33:11Z",
    "updated_at": "2022-04-27T16:34:20Z",
    "author_association": "NONE",
    "body": "@ajsutton Okey then, I will use a self-signed cert. However, I was not able to get it working. \r\n\r\nCreated a self-signed certificate and then create the P12 with the password. Finally, use these files (password.txt and file.p12) in the flags mentioned above. Now Teku does not complain to start the validator api however I do not see any log mentioning that there is an api listening on the defined port. Making a curl request, the server does not close the connection, rsulting in a timeout.\r\n\r\nAm I missing something here or the validator api is not working properly?\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1111213044/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1111584037",
    "html_url": "https://github.com/ConsenSys/teku/issues/5386#issuecomment-1111584037",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5386",
    "id": 1111584037,
    "node_id": "IC_kwDOCM9I9M5CQW0l",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-27T23:48:42Z",
    "updated_at": "2022-04-27T23:48:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "We have acceptance tests that confirm the validator API is working correctly and we use it so I'm confident its working. There's just a config issue somewhere in your setup.\r\n\r\nThe first thing will be that you've set: `--validator-api-host-allowlist=0.0.0.0` which means the validator API can only be accessed at the URL `http://0.0.0.0:<port>` which isn't valid.  The host allowlist is there to prevent DNS rebinding attacks so it specifies the list of host names the API accepts in the `Host` header of requests.  If you want to allow any hostname to be used, you can specify `--validator-api-host-allowlist=*` but it's more secure to specify just the hostnames and IPs the service will actually be served on if possible.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1111584037/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1112120083",
    "html_url": "https://github.com/ConsenSys/teku/issues/5386#issuecomment-1112120083",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5386",
    "id": 1112120083,
    "node_id": "IC_kwDOCM9I9M5CSZsT",
    "user": {
      "login": "pablomendezroyo",
      "id": 41727368,
      "node_id": "MDQ6VXNlcjQxNzI3MzY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/41727368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pablomendezroyo",
      "html_url": "https://github.com/pablomendezroyo",
      "followers_url": "https://api.github.com/users/pablomendezroyo/followers",
      "following_url": "https://api.github.com/users/pablomendezroyo/following{/other_user}",
      "gists_url": "https://api.github.com/users/pablomendezroyo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pablomendezroyo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pablomendezroyo/subscriptions",
      "organizations_url": "https://api.github.com/users/pablomendezroyo/orgs",
      "repos_url": "https://api.github.com/users/pablomendezroyo/repos",
      "events_url": "https://api.github.com/users/pablomendezroyo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pablomendezroyo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-28T12:03:26Z",
    "updated_at": "2022-04-28T12:06:35Z",
    "author_association": "NONE",
    "body": "@ajsutton I was trying to implement the self-signed certificate without success. The main issue is that any request I do keeps loading without being closed by the server, so there is no error I can follow. Running Teku with log level ALL, nothing relevant.\r\n\r\nThis is taking so long for me, I would really appreciate it if you can take a look and tell me if I'm missing something\r\n\r\n- How I generate the certificate https://github.com/dappnode/DAppNodePackage-Teku-Prater/blob/pablo/implement-live-keys-load/validator/Dockerfile\r\n- How I start Teku https://github.com/dappnode/DAppNodePackage-Teku-Prater/blob/26dd2a4a062b43631225d8146edfef34603aa1b8/validator/entrypoint.sh#L41",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1112120083/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1112696416",
    "html_url": "https://github.com/ConsenSys/teku/issues/5386#issuecomment-1112696416",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5386",
    "id": 1112696416,
    "node_id": "IC_kwDOCM9I9M5CUmZg",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-28T22:05:28Z",
    "updated_at": "2022-04-28T22:05:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "Ah, I think the problem is that we're trying to read the password file as UTF-8 but it's actually random binary data so isn't valid. The underlying library we use requires a String so we can't just blindly read the file as bytes unfortunately.\r\n\r\nThere is an error being printed at startup but it's actually going to the log file rather than the console.  The `--log-destination console` after the `validator-client` subcommand isn't being picked up correctly which I'll look into.  For now you want to run `teku --log-destination console validator-console <other-options>` to get it to be picked up.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1112696416/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1113006726",
    "html_url": "https://github.com/ConsenSys/teku/issues/5386#issuecomment-1113006726",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5386",
    "id": 1113006726,
    "node_id": "IC_kwDOCM9I9M5CVyKG",
    "user": {
      "login": "pablomendezroyo",
      "id": 41727368,
      "node_id": "MDQ6VXNlcjQxNzI3MzY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/41727368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pablomendezroyo",
      "html_url": "https://github.com/pablomendezroyo",
      "followers_url": "https://api.github.com/users/pablomendezroyo/followers",
      "following_url": "https://api.github.com/users/pablomendezroyo/following{/other_user}",
      "gists_url": "https://api.github.com/users/pablomendezroyo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pablomendezroyo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pablomendezroyo/subscriptions",
      "organizations_url": "https://api.github.com/users/pablomendezroyo/orgs",
      "repos_url": "https://api.github.com/users/pablomendezroyo/repos",
      "events_url": "https://api.github.com/users/pablomendezroyo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pablomendezroyo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-29T08:11:41Z",
    "updated_at": "2022-04-29T08:11:41Z",
    "author_association": "NONE",
    "body": "The password file `server.key` (not 100% sure if it is this one) is in UTF-8 format. The logs are now working. Requests still get pending with no answer from the server, still, no error logs on the console. \r\n\r\nLogs from Teku, notice the error starting Javalin, which could be related\r\n```\r\n2022-04-29 07:25:08.359 INFO  - Initializing API auth access file /opt/teku/data/validator/key-manager/validator-api-bearer\r\n2022-04-29 07:25:08.369 INFO  - Starting Javalin ...\r\n2022-04-29 07:25:08.418 INFO  - You are running Javalin 4.4.0 (released March 19, 2022).\r\n2022-04-29 07:25:08.492 INFO  - jetty-9.4.45.v20220203; built: 2022-02-03T09:14:34.105Z; git: 4a0c91c0be53805e3fcffdcdcc9587d5301863db; jvm 17.0.2+8\r\n2022-04-29 07:25:08.613 ERROR - Failed to start Javalin\r\n2022-04-29 07:25:08.645 INFO  - Starting EventSource client using URI: http://beacon-chain.teku-prater.dappnode:3500/eth/v1/events?topics=head\r\n2022-04-29 07:25:08.693 INFO  - Connected to EventSource stream.\r\n2022-04-29 07:25:08.741 INFO  - Validator   *** Successfully connected to beacon chain event stream\r\n2022-04-29 07:25:08.848 INFO  - BLS: loaded BLST library\r\n```\r\n\r\nNotes:\r\n- Im using as `--validator-api-keystore-file` the `server.crt` which looks like this\r\n```\r\n-----BEGIN CERTIFICATE-----\r\nMIID9zCCAt8CFAvDAuhgUs0nm6/rP31No+ciJBbeMA0GCSqGSIb3DQEBCwUAMIG2\r\n....\r\n```\r\n- Im using as `--validator-api-keystore-password-file` the `server.key` which looks like this\r\n```\r\n-----BEGIN RSA PRIVATE KEY-----\r\nMIIEpAIBAAKCAQEApoJTCbfQaOvWVyNnQRIrufKhxQpLRyYf1X0G/BBv198+AwW5\r\n....\r\n```\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1113006726/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1113072409",
    "html_url": "https://github.com/ConsenSys/teku/issues/5386#issuecomment-1113072409",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5386",
    "id": 1113072409,
    "node_id": "IC_kwDOCM9I9M5CWCMZ",
    "user": {
      "login": "tbenr",
      "id": 15999009,
      "node_id": "MDQ6VXNlcjE1OTk5MDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbenr",
      "html_url": "https://github.com/tbenr",
      "followers_url": "https://api.github.com/users/tbenr/followers",
      "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
      "organizations_url": "https://api.github.com/users/tbenr/orgs",
      "repos_url": "https://api.github.com/users/tbenr/repos",
      "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbenr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-29T08:56:39Z",
    "updated_at": "2022-04-29T08:56:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "@pablomendezroyo \r\nI think you need to have `--validator-api-keystore-file` to point to a p12\\pfx\\jks and `--validator-api-keystore-password-file` should point to a file containing the password to open the p12\\pfx\\jks file.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1113072409/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1113072451",
    "html_url": "https://github.com/ConsenSys/teku/issues/5386#issuecomment-1113072451",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5386",
    "id": 1113072451,
    "node_id": "IC_kwDOCM9I9M5CWCND",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-29T08:56:43Z",
    "updated_at": "2022-04-29T08:56:43Z",
    "author_association": "CONTRIBUTOR",
    "body": "It's the password.txt that's binary which is specified as:\r\n```\r\n--validator-api-keystore-password-file=/usr/local/share/ca-certificates/password.txt\r\n```\r\naccording to the link you gave.  It needs to be valid UTF-8.  The failed to start Javalin is the issue we need to get rid of, though for me I get a big exception stack trace earlier which gives a clear message about what's wrong:\r\n```\r\n2022-04-29 08:54:14.279 ERROR - Failed to read password file for validator api keystore\r\njava.nio.charset.MalformedInputException: Input length = 3\r\nat java.lang.String.throwMalformed(String.java:1240) ~[?:?]\r\nat java.lang.String.decodeUTF8_UTF16(String.java:1122) ~[?:?]\r\nat java.lang.String.newStringUTF8NoRepl(String.java:728) ~[?:?]\r\nat java.lang.String.newStringNoRepl1(String.java:756) ~[?:?]\r\nat java.lang.String.newStringNoRepl(String.java:738) ~[?:?]\r\n...\r\n```\r\n\r\nThe reason you're getting no response is an artefact of using Docker - Teku isn't listening on the port at all so it's not even accepting the connection, but Docker's port forwarding does accept the connection then finds it can't connect the other end and just does nothing with it.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1113072451/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1113084719",
    "html_url": "https://github.com/ConsenSys/teku/issues/5386#issuecomment-1113084719",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5386",
    "id": 1113084719,
    "node_id": "IC_kwDOCM9I9M5CWFMv",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-29T09:08:08Z",
    "updated_at": "2022-04-29T09:08:08Z",
    "author_association": "CONTRIBUTOR",
    "body": "Actually Enrico has a good point too I think the cert format is probably not what Teku needs either. The instructions for creating a keystore for use with web3signer also work for this: https://docs.teku.consensys.net/en/latest/Tutorials/Configure-External-Signer-TLS/",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1113084719/reactions",
      "total_count": 1,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 1,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1113233125",
    "html_url": "https://github.com/ConsenSys/teku/issues/5386#issuecomment-1113233125",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5386",
    "id": 1113233125,
    "node_id": "IC_kwDOCM9I9M5CWpbl",
    "user": {
      "login": "pablomendezroyo",
      "id": 41727368,
      "node_id": "MDQ6VXNlcjQxNzI3MzY4",
      "avatar_url": "https://avatars.githubusercontent.com/u/41727368?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/pablomendezroyo",
      "html_url": "https://github.com/pablomendezroyo",
      "followers_url": "https://api.github.com/users/pablomendezroyo/followers",
      "following_url": "https://api.github.com/users/pablomendezroyo/following{/other_user}",
      "gists_url": "https://api.github.com/users/pablomendezroyo/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/pablomendezroyo/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/pablomendezroyo/subscriptions",
      "organizations_url": "https://api.github.com/users/pablomendezroyo/orgs",
      "repos_url": "https://api.github.com/users/pablomendezroyo/repos",
      "events_url": "https://api.github.com/users/pablomendezroyo/events{/privacy}",
      "received_events_url": "https://api.github.com/users/pablomendezroyo/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-29T12:01:53Z",
    "updated_at": "2022-04-29T12:02:05Z",
    "author_association": "NONE",
    "body": "Thanks! got it working. I found myself diving into the remote keymanager API PRs that there is a token created at the path `/opt/teku/data/validator/key-manager`, see https://github.com/ConsenSys/teku/pull/4855\r\n\r\nThis should be added to the documentation.\r\n\r\nThanks for the help",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1113233125/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1113866246",
    "html_url": "https://github.com/ConsenSys/teku/issues/5386#issuecomment-1113866246",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5386",
    "id": 1113866246,
    "node_id": "IC_kwDOCM9I9M5CZEAG",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-04-29T23:53:46Z",
    "updated_at": "2022-04-29T23:53:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "Awesome glad it's working.  https://github.com/ConsenSys/doc.teku/issues/356 is tracking the doc updates this has uncovered the need for. Thanks for taking the time to work through it with us.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1113866246/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
