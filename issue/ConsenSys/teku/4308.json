{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/4308",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/4308/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/4308/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/4308/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/4308",
  "id": 985237178,
  "node_id": "MDU6SXNzdWU5ODUyMzcxNzg=",
  "number": 4308,
  "title": "Don't include redundant attestations in blocks",
  "user": {
    "login": "benjaminion",
    "id": 20796281,
    "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/benjaminion",
    "html_url": "https://github.com/benjaminion",
    "followers_url": "https://api.github.com/users/benjaminion/followers",
    "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
    "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
    "organizations_url": "https://api.github.com/users/benjaminion/orgs",
    "repos_url": "https://api.github.com/users/benjaminion/repos",
    "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/benjaminion/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 0,
  "created_at": "2021-09-01T14:38:12Z",
  "updated_at": "2021-09-03T03:45:36Z",
  "closed_at": "2021-09-03T03:45:36Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Some Teku blocks appear to contain redundant attestations which have no value. This is not a serious problem unless by doing so we are excluding other attestations that may have value. But even so, it is uncivilised and bloats the size of the chain.\r\n\r\nThe block at [slot 1971037](https://beaconcha.in/block/1971037) is an example of a block containing redundant attestations. The block graffiti says `teku/v21.8.1`.\r\n\r\n[As per beaconcha.in](https://beaconcha.in/block/1971037#attestations), Attestation 48 is a proper subset of Attestation 47. They have the same slot, committee index, head, source and target. Attestation 47 has all the aggregation bits set, so any other attestation with the same data is redundant.\r\n\r\nInspecting the block attestation json directly, we see the same thing:\r\n```\r\n> cat response_1630503540886.json | jq '.data[] | select(.data.index == \"22\")'\r\n{\r\n  \"aggregation_bits\": \"0xffffffffffffffffffffffdf7fffffff03\",\r\n  \"data\": {\r\n    \"slot\": \"1971036\",\r\n    \"index\": \"22\",\r\n    \"beacon_block_root\": \"0x711d581842f690dcd0749dbfa87791cbdb0077bd75e7bce9b2cd0613387c65e3\",\r\n    \"source\": {\r\n      \"epoch\": \"61593\",\r\n      \"root\": \"0xb15fbc97b6c5b9a4045ca07988edbbeca9f1a29def6f00556733fd4adc6baae5\"\r\n    },\r\n    \"target\": {\r\n      \"epoch\": \"61594\",\r\n      \"root\": \"0x705affb667f5809ad410019e0979e9f6b3209ac457e6ca92c4aa2450182388c3\"\r\n    }\r\n  },\r\n  \"signature\": \"0x92642e2072f06940be28f927924b94b0446e17d48829a320b8b00cc0effd657d9a604770903eddc54b6a83bacbf971d30808384a9eb2b243881250c4269b2b1048006d3a6b0d1864964f79812c263867fd9da5dbf030aa54c776c3cc5bc843a2\"                 \r\n}\r\n{\r\n  \"aggregation_bits\": \"0xfffffffffdffffffffffffdf7f7fffff03\",\r\n  \"data\": {\r\n    \"slot\": \"1971036\",\r\n    \"index\": \"22\",\r\n    \"beacon_block_root\": \"0x711d581842f690dcd0749dbfa87791cbdb0077bd75e7bce9b2cd0613387c65e3\",\r\n    \"source\": {\r\n      \"epoch\": \"61593\",\r\n      \"root\": \"0xb15fbc97b6c5b9a4045ca07988edbbeca9f1a29def6f00556733fd4adc6baae5\"\r\n    },\r\n    \"target\": {\r\n      \"epoch\": \"61594\",\r\n      \"root\": \"0x705affb667f5809ad410019e0979e9f6b3209ac457e6ca92c4aa2450182388c3\"\r\n    }\r\n  },\r\n  \"signature\": \"0xa48b75bafbd9ead4ce958e717d5088550d4a566bd0f298f9c13506d7c39e254f38c3789ba1177d9052a6e916ff6b12bd0867b0b3ee6005baf77dd362e08c7395548d7d33c638742b2a247807b84afe8a9ee32aa43694550b6d3589a29b312dbb\"                 \r\n}\r\n```\r\n\r\nComparing the first and second sets of aggregation bits, we see again that the second is a proper subset of the first.:\r\n```\r\n0xffffffffffffffffffffffdf7fffffff03\r\n0xfffffffffdffffffffffffdf7f7fffff03\r\n```\r\n\r\nHere's another example from the same block (Attestations 29 & 30 [on beaconcha.in](https://beaconcha.in/block/1971037#attestations)):\r\n```\r\n{\r\n  \"aggregation_bits\": \"0xffffffffffffffffffffffffffffffff07\",\r\n  \"data\": {\r\n    \"slot\": \"1971036\",\r\n    \"index\": \"31\",\r\n    \"beacon_block_root\": \"0x711d581842f690dcd0749dbfa87791cbdb0077bd75e7bce9b2cd0613387c65e3\",\r\n    \"source\": {\r\n      \"epoch\": \"61593\",\r\n      \"root\": \"0xb15fbc97b6c5b9a4045ca07988edbbeca9f1a29def6f00556733fd4adc6baae5\"\r\n    },\r\n    \"target\": {\r\n      \"epoch\": \"61594\",\r\n      \"root\": \"0x705affb667f5809ad410019e0979e9f6b3209ac457e6ca92c4aa2450182388c3\"\r\n    }\r\n  },\r\n  \"signature\": \"0x8553574539646e52407de814b01965bdfbc1f464745859d402acfc5180f63965ce02123e2892f19a2bef4a1b1e26b5f408fc35b302d42b0f41780d2191639e30b11cf0fb818e198d68f94ebb5507383db4c0f13cecce300eeed68e9297f0d52d\"                 \r\n}\r\n{\r\n  \"aggregation_bits\": \"0xffffffbfffffffffffffffffffffffff07\",\r\n  \"data\": {\r\n    \"slot\": \"1971036\",\r\n    \"index\": \"31\",\r\n    \"beacon_block_root\": \"0x711d581842f690dcd0749dbfa87791cbdb0077bd75e7bce9b2cd0613387c65e3\",\r\n    \"source\": {\r\n      \"epoch\": \"61593\",\r\n      \"root\": \"0xb15fbc97b6c5b9a4045ca07988edbbeca9f1a29def6f00556733fd4adc6baae5\"\r\n    },\r\n    \"target\": {\r\n      \"epoch\": \"61594\",\r\n      \"root\": \"0x705affb667f5809ad410019e0979e9f6b3209ac457e6ca92c4aa2450182388c3\"\r\n    }\r\n  },\r\n  \"signature\": \"0xae8f83dab800b8b59dc392d1798422b5bc6c4b3db03918ba11118a74343b82895c2d7ddf25d250c8ebeeed1a3965b1be1180c1b41e5a17640e95d3431e28e542b8b93b3ab06a8d9362691dbcac0806c5196ecc3a87f004e9e5d7da92894e9c86\"                 \r\n}\r\n```\r\n",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/4308/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/4308/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[

]
