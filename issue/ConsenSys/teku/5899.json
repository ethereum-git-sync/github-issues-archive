{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/5899",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/5899/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/5899/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/5899/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/5899",
  "id": 1296505047,
  "node_id": "I_kwDOCM9I9M5NRxjX",
  "number": 5899,
  "title": "`QUANTITY` fields in ExecutionPayloadV1 are too permissive",
  "user": {
    "login": "marioevz",
    "id": 11726710,
    "node_id": "MDQ6VXNlcjExNzI2NzEw",
    "avatar_url": "https://avatars.githubusercontent.com/u/11726710?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/marioevz",
    "html_url": "https://github.com/marioevz",
    "followers_url": "https://api.github.com/users/marioevz/followers",
    "following_url": "https://api.github.com/users/marioevz/following{/other_user}",
    "gists_url": "https://api.github.com/users/marioevz/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/marioevz/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/marioevz/subscriptions",
    "organizations_url": "https://api.github.com/users/marioevz/orgs",
    "repos_url": "https://api.github.com/users/marioevz/repos",
    "events_url": "https://api.github.com/users/marioevz/events{/privacy}",
    "received_events_url": "https://api.github.com/users/marioevz/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2022-07-06T21:29:19Z",
  "updated_at": "2022-07-20T07:14:17Z",
  "closed_at": "2022-07-20T07:14:17Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nExecution client's Engine API specifies `baseFeePerGas` as a `QUANTITY` field which has the following restrictions:\r\n\r\n>Values of a field of QUANTITY type MUST be encoded as a hexadecimal string with a 0x prefix and the leading 0s stripped (except for the case of encoding the value 0) matching the regular expression ^0x(?:0|(?:[a-fA-F1-9][a-fA-F0-9]*))$.\r\n> \r\n>Note: Byte order of encoded value having QUANTITY type is big-endian.\r\n\r\nCurrently is possible to feed Teku the following spoofed values and they will end up in the Execution payload without issues:\r\n- `Spoofing (node 1) blockNumber, 0x34 -> 0x00000000000000034` (Overflow 64bits)\r\n- `Spoofing (node 2) blockNumber, 0x35 -> 0x035` (Leading zero)\r\n- `Spoofing (node 1) gasLimit, 0x1c9c380 -> 0x00000000001c9c380` (Overflow 64bits)\r\n- `Spoofing (node 2) gasLimit, 0x1c9c380 -> 0x01c9c380` (Leading zero)\r\n- `Spoofing (node 1) gasUsed, 0x0 -> 0x00` (Leading zero)\r\n- `Spoofing (node 1) gasUsed, 0x0 -> 0x` (Empty hex)\r\n- `Spoofing (node 1) timestamp, 0x62c5ec6f -> 0x00000000062c5ec6f` (Overflow 64bits)\r\n- `Spoofing (node 2) timestamp, 0x62c5ec75 -> 0x062c5ec75` (Leading zero)\r\n- `Spoofing (node 2) baseFeePerGas, 0x50ef0 -> 0x050ef0` (Leading zero)\r\n\r\n### Steps to Reproduce (Bug)\r\nUsing hive branch https://github.com/marioevz/hive/tree/all-tests-plus-cl-clients, run:\r\n\r\n```\r\n./hive --client go-ethereum,teku-bn,teku-vc --sim eth2/engine --sim.loglevel 5\r\n```\r\n\r\n**Expected behavior:** The payload should be rejected\r\n\r\n**Actual behavior:** The payload is accepted and incorporated into a beacon block.\r\n\r\n**Frequency:** Always during this test case (invalid-quantity-fields)\r\n\r\n### Versions (Add all that apply)\r\n* Software version: teku/v22.6.1+29-gb2bc943/linux-x86_64/-eclipseadoptium-openjdk64bitservervm-java-17\r\n* Java version: openjdk 17.0.3 2022-04-19\r\n* OS Name & Version: Ubuntu 18.04.6 LTS\r\n* Docker Version: 20.10.17",
  "closed_by": {
    "login": "tbenr",
    "id": 15999009,
    "node_id": "MDQ6VXNlcjE1OTk5MDA5",
    "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/tbenr",
    "html_url": "https://github.com/tbenr",
    "followers_url": "https://api.github.com/users/tbenr/followers",
    "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
    "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
    "organizations_url": "https://api.github.com/users/tbenr/orgs",
    "repos_url": "https://api.github.com/users/tbenr/repos",
    "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
    "received_events_url": "https://api.github.com/users/tbenr/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/5899/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/5899/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1177939256",
    "html_url": "https://github.com/ConsenSys/teku/issues/5899#issuecomment-1177939256",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5899",
    "id": 1177939256,
    "node_id": "IC_kwDOCM9I9M5GNe04",
    "user": {
      "login": "marioevz",
      "id": 11726710,
      "node_id": "MDQ6VXNlcjExNzI2NzEw",
      "avatar_url": "https://avatars.githubusercontent.com/u/11726710?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/marioevz",
      "html_url": "https://github.com/marioevz",
      "followers_url": "https://api.github.com/users/marioevz/followers",
      "following_url": "https://api.github.com/users/marioevz/following{/other_user}",
      "gists_url": "https://api.github.com/users/marioevz/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/marioevz/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/marioevz/subscriptions",
      "organizations_url": "https://api.github.com/users/marioevz/orgs",
      "repos_url": "https://api.github.com/users/marioevz/repos",
      "events_url": "https://api.github.com/users/marioevz/events{/privacy}",
      "received_events_url": "https://api.github.com/users/marioevz/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-07T17:03:25Z",
    "updated_at": "2022-07-07T17:03:25Z",
    "author_association": "NONE",
    "body": "I've updated the hive simulator branch, please update to the latest commit and use this command instead to run only a single test case:\r\n```\r\n./hive --client go-ethereum,teku-bn,teku-vc --sim eth2/engine --sim.loglevel 5 --sim.limit \"/invalid-quantity-fields\"\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1177939256/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1178522811",
    "html_url": "https://github.com/ConsenSys/teku/issues/5899#issuecomment-1178522811",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5899",
    "id": 1178522811,
    "node_id": "IC_kwDOCM9I9M5GPtS7",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-08T04:05:20Z",
    "updated_at": "2022-07-08T04:05:20Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for logging this. We'll take a look. In general Teku follows Postel's law \"Be liberal in what you accept and conservative in what you send\". There's no real ambiguity in what's meant with these examples, but given we have hive tests and the JSON-RPC spec is explicit in forbidding these things it's worth enforcing it in Teku as well.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1178522811/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1188757713",
    "html_url": "https://github.com/ConsenSys/teku/issues/5899#issuecomment-1188757713",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5899",
    "id": 1188757713,
    "node_id": "IC_kwDOCM9I9M5G2wDR",
    "user": {
      "login": "tbenr",
      "id": 15999009,
      "node_id": "MDQ6VXNlcjE1OTk5MDA5",
      "avatar_url": "https://avatars.githubusercontent.com/u/15999009?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/tbenr",
      "html_url": "https://github.com/tbenr",
      "followers_url": "https://api.github.com/users/tbenr/followers",
      "following_url": "https://api.github.com/users/tbenr/following{/other_user}",
      "gists_url": "https://api.github.com/users/tbenr/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/tbenr/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/tbenr/subscriptions",
      "organizations_url": "https://api.github.com/users/tbenr/orgs",
      "repos_url": "https://api.github.com/users/tbenr/repos",
      "events_url": "https://api.github.com/users/tbenr/events{/privacy}",
      "received_events_url": "https://api.github.com/users/tbenr/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-19T08:29:50Z",
    "updated_at": "2022-07-19T08:29:50Z",
    "author_association": "CONTRIBUTOR",
    "body": "@marioevz\r\nI'm fixing this but I cant run hive tests since it brakes compiling the tests\r\n```\r\nINFO[07-19|10:26:52] building image                           image=hive/simulators/eth2/engine:latest dir=simulators/eth2/engine nocache=false pull=false\r\nEROR[07-19|10:27:04] image build failed                       image=hive/simulators/eth2/engine:latest err=\"The command '/bin/sh -c go build -o ./sim .' returned a non-zero code: 2\"\r\nThe command '/bin/sh -c go build -o ./sim .' returned a non-zero code: 2\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1188757713/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1188759912",
    "html_url": "https://github.com/ConsenSys/teku/issues/5899#issuecomment-1188759912",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5899",
    "id": 1188759912,
    "node_id": "IC_kwDOCM9I9M5G2wlo",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-07-19T08:31:57Z",
    "updated_at": "2022-07-19T08:31:57Z",
    "author_association": "CONTRIBUTOR",
    "body": "I hit that today too - it doesn't seem to build on ARM architectures.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1188759912/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
