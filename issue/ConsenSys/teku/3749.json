{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/3749",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/3749/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/3749/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/3749/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/3749",
  "id": 836654808,
  "node_id": "MDU6SXNzdWU4MzY2NTQ4MDg=",
  "number": 3749,
  "title": "Altair parameters prematurely included in /config/spec response",
  "user": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2021-03-20T03:50:20Z",
  "updated_at": "2021-03-23T00:06:15Z",
  "closed_at": "2021-03-23T00:06:15Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nSome Lighthouse users noticed that their Infura beacon nodes stopped functioning once Infura updated to Teku v12.3.0. The issue is that Lighthouse is very strict about the chain spec parameters returned from the `/eth/v1/config/spec` endpoint, and Teku now includes Altair parameters.\r\n\r\n### Possible Solutions\r\n\r\n* Change the API spec to be explicit about how specs should be served across hard forks. I haven't thought about this in detail yet, but it's probably the best long-term solution.\r\n* (Temporarily) change Lighthouse's validator client to be less strict (https://github.com/sigp/lighthouse/issues/2274)\r\n* Change Teku to only return phase0/genesis chain specs until Altair is in effect (or closer).\r\n\r\n### Steps to Reproduce\r\n\r\n```bash\r\ncurl -s \"https://x:y@eth2-beacon-mainnet.infura.io/eth/v1/node/version\"\r\n```\r\n\r\n```json\r\n{\r\n  \"data\": {\r\n    \"DEPOSIT_CONTRACT_ADDRESS\": \"0x00000000219ab540356cBB839Cbe05303d7705Fa\",\r\n    \"MIN_ATTESTATION_INCLUSION_DELAY\": \"1\",\r\n    \"SLOTS_PER_EPOCH\": \"32\",\r\n    \"INACTIVITY_SCORE_BIAS\": \"4\",\r\n    \"SHUFFLE_ROUND_COUNT\": \"90\",\r\n    \"MAX_EFFECTIVE_BALANCE\": \"32000000000\",\r\n    \"DOMAIN_BEACON_PROPOSER\": \"0x00000000\",\r\n    \"DOMAIN_SYNC_COMMITTEE\": \"0x07000000\",\r\n    \"MAX_ATTESTER_SLASHINGS\": \"2\",\r\n    \"DOMAIN_SELECTION_PROOF\": \"0x05000000\",\r\n    \"INACTIVITY_PENALTY_QUOTIENT\": \"67108864\",\r\n    \"LIGHT_CLIENT_UPDATE_TIMEOUT\": \"8192\",\r\n    \"MAX_VALID_LIGHT_CLIENT_UPDATES\": \"8192\",\r\n    \"SAFE_SLOTS_TO_UPDATE_JUSTIFIED\": \"8\",\r\n    \"SECONDS_PER_ETH1_BLOCK\": \"14\",\r\n    \"HYSTERESIS_UPWARD_MULTIPLIER\": \"5\",\r\n    \"MIN_SEED_LOOKAHEAD\": \"1\",\r\n    \"VALIDATOR_REGISTRY_LIMIT\": \"1099511627776\",\r\n    \"MIN_DEPOSIT_AMOUNT\": \"1000000000\",\r\n    \"SLOTS_PER_HISTORICAL_ROOT\": \"8192\",\r\n    \"PROPORTIONAL_SLASHING_MULTIPLIER_ALTAIR\": \"2\",\r\n    \"MIN_VALIDATOR_WITHDRAWABILITY_DELAY\": \"256\",\r\n    \"DOMAIN_VOLUNTARY_EXIT\": \"0x04000000\",\r\n    \"TARGET_COMMITTEE_SIZE\": \"128\",\r\n    \"MAX_VALIDATORS_PER_COMMITTEE\": \"2048\",\r\n    \"MIN_GENESIS_TIME\": \"1606824000\",\r\n    \"HYSTERESIS_QUOTIENT\": \"4\",\r\n    \"RANDOM_SUBNETS_PER_VALIDATOR\": \"1\",\r\n    \"DOMAIN_DEPOSIT\": \"0x03000000\",\r\n    \"ALTAIR_FORK_VERSION\": \"0x01000000\",\r\n    \"DEPOSIT_CHAIN_ID\": \"1\",\r\n    \"WHISTLEBLOWER_REWARD_QUOTIENT\": \"512\",\r\n    \"PROPOSER_REWARD_QUOTIENT\": \"8\",\r\n    \"DOMAIN_RANDAO\": \"0x02000000\",\r\n    \"EPOCHS_PER_RANDOM_SUBNET_SUBSCRIPTION\": \"256\",\r\n    \"EPOCHS_PER_HISTORICAL_VECTOR\": \"65536\",\r\n    \"MIN_PER_EPOCH_CHURN_LIMIT\": \"4\",\r\n    \"MIN_SLASHING_PENALTY_QUOTIENT_ALTAIR\": \"64\",\r\n    \"EPOCHS_PER_ETH1_VOTING_PERIOD\": \"64\",\r\n    \"MAX_DEPOSITS\": \"16\",\r\n    \"HISTORICAL_ROOTS_LIMIT\": \"16777216\",\r\n    \"SYNC_COMMITTEE_SIZE\": \"1024\",\r\n    \"TARGET_AGGREGATORS_PER_COMMITTEE\": \"16\",\r\n    \"EPOCHS_PER_SLASHINGS_VECTOR\": \"8192\",\r\n    \"MIN_SLASHING_PENALTY_QUOTIENT\": \"128\",\r\n    \"PROPORTIONAL_SLASHING_MULTIPLIER\": \"1\",\r\n    \"MAX_VOLUNTARY_EXITS\": \"16\",\r\n    \"HYSTERESIS_DOWNWARD_MULTIPLIER\": \"1\",\r\n    \"DOMAIN_BEACON_ATTESTER\": \"0x01000000\",\r\n    \"SYNC_SUBCOMMITTEE_SIZE\": \"64\",\r\n    \"GENESIS_DELAY\": \"604800\",\r\n    \"EPOCHS_PER_SYNC_COMMITTEE_PERIOD\": \"256\",\r\n    \"MAX_SEED_LOOKAHEAD\": \"4\",\r\n    \"ETH1_FOLLOW_DISTANCE\": \"2048\",\r\n    \"SECONDS_PER_SLOT\": \"12\",\r\n    \"MIN_GENESIS_ACTIVE_VALIDATOR_COUNT\": \"16384\",\r\n    \"MIN_SYNC_COMMITTEE_PARTICIPANTS\": \"1\",\r\n    \"MAX_ATTESTATIONS\": \"128\",\r\n    \"GENESIS_FORK_VERSION\": \"0x00000000\",\r\n    \"DEPOSIT_NETWORK_ID\": \"1\",\r\n    \"EJECTION_BALANCE\": \"16000000000\",\r\n    \"MAX_COMMITTEES_PER_SLOT\": \"64\",\r\n    \"SHARD_COMMITTEE_PERIOD\": \"256\",\r\n    \"EFFECTIVE_BALANCE_INCREMENT\": \"1000000000\",\r\n    \"INACTIVITY_PENALTY_QUOTIENT_ALTAIR\": \"50331648\",\r\n    \"DOMAIN_AGGREGATE_AND_PROOF\": \"0x06000000\",\r\n    \"MIN_EPOCHS_TO_INACTIVITY_PENALTY\": \"4\",\r\n    \"BASE_REWARD_FACTOR\": \"64\",\r\n    \"CONFIG_NAME\": \"mainnet\",\r\n    \"MAX_PROPOSER_SLASHINGS\": \"16\",\r\n    \"CHURN_LIMIT_QUOTIENT\": \"65536\",\r\n    \"BLS_WITHDRAWAL_PREFIX\": \"0x00\"\r\n  }\r\n}\r\n```\r\n\r\n### Versions\r\n\r\nTeku v21.3.0\r\n\r\n```json\r\n{\r\n  \"data\": {\r\n    \"version\": \"teku/v21.3.0/linux-x86_64/oracle_openjdk-java-15\"\r\n  }\r\n}\r\n```\r\n\r\nLighthouse v1.2.1\r\n",
  "closed_by": {
    "login": "michaelsproul",
    "id": 4452260,
    "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/michaelsproul",
    "html_url": "https://github.com/michaelsproul",
    "followers_url": "https://api.github.com/users/michaelsproul/followers",
    "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
    "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
    "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
    "repos_url": "https://api.github.com/users/michaelsproul/repos",
    "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
    "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/3749/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/3749/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/803268032",
    "html_url": "https://github.com/ConsenSys/teku/issues/3749#issuecomment-803268032",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3749",
    "id": 803268032,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwMzI2ODAzMg==",
    "user": {
      "login": "benjaminion",
      "id": 20796281,
      "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjaminion",
      "html_url": "https://github.com/benjaminion",
      "followers_url": "https://api.github.com/users/benjaminion/followers",
      "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
      "organizations_url": "https://api.github.com/users/benjaminion/orgs",
      "repos_url": "https://api.github.com/users/benjaminion/repos",
      "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjaminion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-20T07:52:34Z",
    "updated_at": "2021-03-20T07:52:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "Acknowledging the issue.\r\n\r\nAdditional references:\r\n  - Specification: https://ethereum.github.io/eth2.0-APIs/#/ValidatorRequiredApi/getSpec\r\n  - The standard paramter list: https://github.com/ethereum/eth2.0-specs/blob/v1.0.0-rc.0/configs/mainnet/phase0.yaml\r\n\r\nThe API specification could be clearer about whether additional fields are allowable or not. I suspect that both Lighthouse and Teku are breaking [Postel's law](https://en.wikipedia.org/wiki/Robustness_principle) in this case.\r\n\r\nI have kicked off a conversation with Infura, but can't promise an immediate resolution. Pragmatically, making the suggested change at the Lighthouse end is likely the shortest path to getting the users up and running again.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/803268032/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/803368646",
    "html_url": "https://github.com/ConsenSys/teku/issues/3749#issuecomment-803368646",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3749",
    "id": 803368646,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwMzM2ODY0Ng==",
    "user": {
      "login": "skmgoldin",
      "id": 6937058,
      "node_id": "MDQ6VXNlcjY5MzcwNTg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6937058?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/skmgoldin",
      "html_url": "https://github.com/skmgoldin",
      "followers_url": "https://api.github.com/users/skmgoldin/followers",
      "following_url": "https://api.github.com/users/skmgoldin/following{/other_user}",
      "gists_url": "https://api.github.com/users/skmgoldin/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/skmgoldin/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/skmgoldin/subscriptions",
      "organizations_url": "https://api.github.com/users/skmgoldin/orgs",
      "repos_url": "https://api.github.com/users/skmgoldin/repos",
      "events_url": "https://api.github.com/users/skmgoldin/events{/privacy}",
      "received_events_url": "https://api.github.com/users/skmgoldin/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-20T14:45:33Z",
    "updated_at": "2021-03-20T14:45:33Z",
    "author_association": "NONE",
    "body": "I'm sort of against this move, but hypothetically if we at Infura were to downgrade our Teku beacon nodes, would that break Teku validators who are running v12.3.0?",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/803368646/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/803376158",
    "html_url": "https://github.com/ConsenSys/teku/issues/3749#issuecomment-803376158",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3749",
    "id": 803376158,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwMzM3NjE1OA==",
    "user": {
      "login": "benjaminion",
      "id": 20796281,
      "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjaminion",
      "html_url": "https://github.com/benjaminion",
      "followers_url": "https://api.github.com/users/benjaminion/followers",
      "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
      "organizations_url": "https://api.github.com/users/benjaminion/orgs",
      "repos_url": "https://api.github.com/users/benjaminion/repos",
      "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjaminion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-20T15:18:15Z",
    "updated_at": "2021-03-20T15:18:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "> hypothetically if we at Infura were to downgrade our Teku beacon nodes, would that break Teku validators who are running v12.3.0?\r\n\r\nNothing ought to break between 21.2.0 and 21.3.0, but it's an untested configuration, so I can't make absolute promises. We note in the release notes when we know of possible version incompatibilities, but there's a chance of unexpected things happening I guess.\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/803376158/reactions",
      "total_count": 2,
      "+1": 2,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/804482795",
    "html_url": "https://github.com/ConsenSys/teku/issues/3749#issuecomment-804482795",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3749",
    "id": 804482795,
    "node_id": "MDEyOklzc3VlQ29tbWVudDgwNDQ4Mjc5NQ==",
    "user": {
      "login": "michaelsproul",
      "id": 4452260,
      "node_id": "MDQ6VXNlcjQ0NTIyNjA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4452260?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/michaelsproul",
      "html_url": "https://github.com/michaelsproul",
      "followers_url": "https://api.github.com/users/michaelsproul/followers",
      "following_url": "https://api.github.com/users/michaelsproul/following{/other_user}",
      "gists_url": "https://api.github.com/users/michaelsproul/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/michaelsproul/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/michaelsproul/subscriptions",
      "organizations_url": "https://api.github.com/users/michaelsproul/orgs",
      "repos_url": "https://api.github.com/users/michaelsproul/repos",
      "events_url": "https://api.github.com/users/michaelsproul/events{/privacy}",
      "received_events_url": "https://api.github.com/users/michaelsproul/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-03-23T00:06:15Z",
    "updated_at": "2021-03-23T00:06:15Z",
    "author_association": "NONE",
    "body": "I've got a PR up to Lighthouse that restores compatibility: https://github.com/sigp/lighthouse/pull/2277\r\n\r\nI'll close this issue for now, as I think we're leaning towards thinking that the current API spec is good-enough, and Lighthouse just needs to be less strict. If anyone thinks of a reason why the current API spec is inadequate we can open an issue on the specs repo.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/804482795/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
