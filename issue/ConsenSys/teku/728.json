{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/728",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/728/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/728/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/728/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/728",
  "id": 457511911,
  "node_id": "MDU6SXNzdWU0NTc1MTE5MTE=",
  "number": 728,
  "title": "v0.7.1 Deposit Contract Updates",
  "user": {
    "login": "dangerousfood",
    "id": 4099038,
    "node_id": "MDQ6VXNlcjQwOTkwMzg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4099038?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dangerousfood",
    "html_url": "https://github.com/dangerousfood",
    "followers_url": "https://api.github.com/users/dangerousfood/followers",
    "following_url": "https://api.github.com/users/dangerousfood/following{/other_user}",
    "gists_url": "https://api.github.com/users/dangerousfood/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dangerousfood/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dangerousfood/subscriptions",
    "organizations_url": "https://api.github.com/users/dangerousfood/orgs",
    "repos_url": "https://api.github.com/users/dangerousfood/repos",
    "events_url": "https://api.github.com/users/dangerousfood/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dangerousfood/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2019-06-18T14:21:14Z",
  "updated_at": "2019-06-22T20:25:27Z",
  "closed_at": "2019-06-22T20:25:27Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "- [x] Update contract ABI\r\n\r\n- [x] Generate new DepositContract class\r\n\r\n- [x] Fix dependencies",
  "closed_by": {
    "login": "dangerousfood",
    "id": 4099038,
    "node_id": "MDQ6VXNlcjQwOTkwMzg=",
    "avatar_url": "https://avatars.githubusercontent.com/u/4099038?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dangerousfood",
    "html_url": "https://github.com/dangerousfood",
    "followers_url": "https://api.github.com/users/dangerousfood/followers",
    "following_url": "https://api.github.com/users/dangerousfood/following{/other_user}",
    "gists_url": "https://api.github.com/users/dangerousfood/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dangerousfood/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dangerousfood/subscriptions",
    "organizations_url": "https://api.github.com/users/dangerousfood/orgs",
    "repos_url": "https://api.github.com/users/dangerousfood/repos",
    "events_url": "https://api.github.com/users/dangerousfood/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dangerousfood/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/728/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/728/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/503158207",
    "html_url": "https://github.com/ConsenSys/teku/issues/728#issuecomment-503158207",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/728",
    "id": 503158207,
    "node_id": "MDEyOklzc3VlQ29tbWVudDUwMzE1ODIwNw==",
    "user": {
      "login": "dangerousfood",
      "id": 4099038,
      "node_id": "MDQ6VXNlcjQwOTkwMzg=",
      "avatar_url": "https://avatars.githubusercontent.com/u/4099038?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dangerousfood",
      "html_url": "https://github.com/dangerousfood",
      "followers_url": "https://api.github.com/users/dangerousfood/followers",
      "following_url": "https://api.github.com/users/dangerousfood/following{/other_user}",
      "gists_url": "https://api.github.com/users/dangerousfood/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dangerousfood/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dangerousfood/subscriptions",
      "organizations_url": "https://api.github.com/users/dangerousfood/orgs",
      "repos_url": "https://api.github.com/users/dangerousfood/repos",
      "events_url": "https://api.github.com/users/dangerousfood/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dangerousfood/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2019-06-18T14:22:41Z",
    "updated_at": "2019-06-18T14:24:11Z",
    "author_association": "CONTRIBUTOR",
    "body": "# Ethereum 2.0 Phase 0 -- Deposit Contract\r\n\r\n**Notice**: This document is a work-in-progress for researchers and implementers.\r\n\r\n## Table of contents\r\n<!-- TOC -->\r\n\r\n- [Ethereum 2.0 Phase 0 -- Deposit Contract](#ethereum-20-phase-0----deposit-contract)\r\n    - [Table of contents](#table-of-contents)\r\n    - [Introduction](#introduction)\r\n    - [Constants](#constants)\r\n        - [Gwei values](#gwei-values)\r\n        - [Contract](#contract)\r\n    - [Ethereum 1.0 deposit contract](#ethereum-10-deposit-contract)\r\n        - [Arguments](#arguments)\r\n            - [Withdrawal credentials](#withdrawal-credentials)\r\n            - [Amount](#amount)\r\n    - [Event logs](#event-logs)\r\n        - [`Deposit` logs](#deposit-logs)\r\n        - [`Eth2Genesis` log](#eth2genesis-log)\r\n    - [Vyper code](#vyper-code)\r\n\r\n<!-- /TOC -->\r\n\r\n## Introduction\r\n\r\nThis document represents the specification for the beacon chain deposit contract, part of Ethereum 2.0 Phase 0.\r\n\r\n## Constants\r\n\r\n### Gwei values\r\n\r\n| Name | Value | Unit |\r\n| - | - | - |\r\n| `FULL_DEPOSIT_AMOUNT` | `32 * 10**9` | Gwei |\r\n\r\n### Contract\r\n\r\n| Name | Value |\r\n| - | - |\r\n| `DEPOSIT_CONTRACT_ADDRESS` | **TBD** |\r\n| `DEPOSIT_CONTRACT_TREE_DEPTH` | `2**5` (= 32) |\r\n| `CHAIN_START_FULL_DEPOSIT_THRESHOLD` | `2**16` (= 65,536) |\r\n\r\n## Ethereum 1.0 deposit contract\r\n\r\nThe initial deployment phases of Ethereum 2.0 are implemented without consensus changes to Ethereum 1.0. A deposit contract at address `DEPOSIT_CONTRACT_ADDRESS` is added to Ethereum 1.0 for deposits of ETH to the beacon chain. Validator balances will be withdrawable to the shards in Phase 2 (i.e. when the EVM 2.0 is deployed and the shards have state).\r\n\r\n### Arguments\r\n\r\nThe deposit contract has a `deposit` function which takes the amount in Ethereum 1.0 transaction, and arguments `pubkey: bytes[48], withdrawal_credentials: bytes[32], signature: bytes[96]` corresponding to `DepositData`.\r\n\r\n#### Withdrawal credentials\r\n\r\nOne of the `DepositData` fields is `withdrawal_credentials`. It is a commitment to credentials for withdrawals to shards. The first byte of `withdrawal_credentials` is a version number. As of now, the only expected format is as follows:\r\n\r\n* `withdrawal_credentials[:1] == BLS_WITHDRAWAL_PREFIX_BYTE`\r\n* `withdrawal_credentials[1:] == hash(withdrawal_pubkey)[1:]` where `withdrawal_pubkey` is a BLS pubkey\r\n\r\nThe private key corresponding to `withdrawal_pubkey` will be required to initiate a withdrawal. It can be stored separately until a withdrawal is required, e.g. in cold storage.\r\n\r\n#### Amount\r\n\r\n* A valid deposit amount should be at least `MIN_DEPOSIT_AMOUNT` in Gwei.\r\n* A deposit with an amount greater than or equal to `FULL_DEPOSIT_AMOUNT` in Gwei is considered as a full deposit.\r\n\r\n## Event logs\r\n\r\n### `Deposit` logs\r\n\r\nEvery Ethereum 1.0 deposit, of size at least `MIN_DEPOSIT_AMOUNT`, emits a `Deposit` log for consumption by the beacon chain. The deposit contract does little validation, pushing most of the validator onboarding logic to the beacon chain. In particular, the proof of possession (a BLS12-381 signature) is not verified by the deposit contract.\r\n\r\n### `Eth2Genesis` log\r\n\r\nWhen `CHAIN_START_FULL_DEPOSIT_THRESHOLD` of full deposits have been made, the deposit contract emits the `Eth2Genesis` log. The beacon chain state may then be initialized by calling the `get_genesis_beacon_state` function (defined [here](./0_beacon-chain.md#genesis-state)) where:\r\n\r\n* `genesis_time` equals `time` in the `Eth2Genesis` log\r\n* `latest_eth1_data.deposit_root` equals `deposit_root` in the `Eth2Genesis` log\r\n* `latest_eth1_data.deposit_count` equals `deposit_count` in the `Eth2Genesis` log\r\n* `latest_eth1_data.block_hash` equals the hash of the block that included the log\r\n* `genesis_validator_deposits` is a list of `Deposit` objects built according to the `Deposit` logs up to the deposit that triggered the `Eth2Genesis` log, processed in the order in which they were emitted (oldest to newest)\r\n\r\n## Vyper code\r\n\r\nThe source for the Vyper contract lives [here](./../../deposit_contract/contracts/validator_registration.v.py).\r\n\r\n*Note*: To save ~10x on gas, this contract uses a somewhat unintuitive progressive Merkle root calculation algo that requires only O(log(n)) storage. See https://github.com/ethereum/research/blob/master/beacon_chain_impl/progressive_merkle_tree.py for an implementation of the same algo in Python tested for correctness.\r\n\r\nFor convenience, we provide the interface to the contract here:\r\n\r\n* `__init__()`: initializes the contract\r\n* `get_deposit_root() -> bytes32`: returns the current root of the deposit tree\r\n* **`deposit(pubkey: bytes[48], withdrawal_credentials: bytes[32], signature: bytes[96])`**: adds a deposit instance to the deposit tree, incorporating the input arguments and the value transferred in the given call. *Note*: The amount of value transferred *must* be at least `MIN_DEPOSIT_AMOUNT`. Each of these constants are specified in units of Gwei.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/503158207/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
