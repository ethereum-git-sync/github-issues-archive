{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/3000",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/3000/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/3000/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/3000/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/3000",
  "id": 723204035,
  "node_id": "MDU6SXNzdWU3MjMyMDQwMzU=",
  "number": 3000,
  "title": "Teku node seems to sync at the same speed that the chain is progressing",
  "user": {
    "login": "lufa23",
    "id": 67415638,
    "node_id": "MDQ6VXNlcjY3NDE1NjM4",
    "avatar_url": "https://avatars.githubusercontent.com/u/67415638?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/lufa23",
    "html_url": "https://github.com/lufa23",
    "followers_url": "https://api.github.com/users/lufa23/followers",
    "following_url": "https://api.github.com/users/lufa23/following{/other_user}",
    "gists_url": "https://api.github.com/users/lufa23/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/lufa23/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/lufa23/subscriptions",
    "organizations_url": "https://api.github.com/users/lufa23/orgs",
    "repos_url": "https://api.github.com/users/lufa23/repos",
    "events_url": "https://api.github.com/users/lufa23/events{/privacy}",
    "received_events_url": "https://api.github.com/users/lufa23/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 6,
  "created_at": "2020-10-16T13:11:48Z",
  "updated_at": "2020-10-28T03:17:59Z",
  "closed_at": "2020-10-28T03:17:58Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "I have started a Teku node with `./teku --network=medalla --metrics-enabled --rest-api-enabled --rest-api-docs-enabled --metrics-categories=BEACON,PROCESS,LIBP2P,JVM,NETWORK,PROCESS`\r\n\r\nI notice also that the node is syncing quite slow.\r\nFrom what it appears from the log, it gets new head slots at the same rate that the current slot is rising.\r\nIf this is correct, the node will never be able to sync.\r\nHow can i let it sync faster?\r\n<img width=\"1636\" alt=\"Screenshot 2020-10-16 at 11 50 34\" src=\"https://user-images.githubusercontent.com/67415638/96262066-905c3980-0fc1-11eb-8c13-eb4c87df9a78.png\">\r\n",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/3000/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/3000/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/711435117",
    "html_url": "https://github.com/ConsenSys/teku/issues/3000#issuecomment-711435117",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3000",
    "id": 711435117,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMTQzNTExNw==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-18T22:44:51Z",
    "updated_at": "2020-10-18T22:44:51Z",
    "author_association": "CONTRIBUTOR",
    "body": "This is definitely syncing a lot slower than it should.  Can you look at the top of the log file just after startup and check that it has the line:\r\n```\r\nBLS: loaded BLST library\r\n```\r\n\r\nBLST is the native version of the BLS library and is significantly faster than the pure-java version.   Sometimes it fails to load if the `/tmp/` directory isn't writable or is mounted with `noexec` set.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/711435117/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/711435176",
    "html_url": "https://github.com/ConsenSys/teku/issues/3000#issuecomment-711435176",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3000",
    "id": 711435176,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMTQzNTE3Ng==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-18T22:45:35Z",
    "updated_at": "2020-10-18T22:45:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "Getting the full content of the Teku log file would be very useful it will be in `~/.local/share/teku/logs/`",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/711435176/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/711575352",
    "html_url": "https://github.com/ConsenSys/teku/issues/3000#issuecomment-711575352",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3000",
    "id": 711575352,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMTU3NTM1Mg==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-19T05:06:46Z",
    "updated_at": "2020-10-19T05:06:46Z",
    "author_association": "CONTRIBUTOR",
    "body": "I was able to reproduce this locally and it appears to be some configuration issue with RocksDB causing it to be unable to keep up with the write load during sync.  RocksDB winds up using huge amounts of memory and when memory is exhausted has to delay writes while it completes its background processing.  \n\nWe'll need to do more in depth investigation to understand the cause of this, but for now I've reverted the default database version Teku creates to the previous v5 which doesn't exhibit this issue.  Unfortunately you will need to delete the database and start the sync again to get it to create the v5 database format.  You can confirm the v5 format was used with `cat ~/.local/share/teku/beacon/db.version` which should report `5` and not `6`.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/711575352/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/711886066",
    "html_url": "https://github.com/ConsenSys/teku/issues/3000#issuecomment-711886066",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3000",
    "id": 711886066,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMTg4NjA2Ng==",
    "user": {
      "login": "lufa23",
      "id": 67415638,
      "node_id": "MDQ6VXNlcjY3NDE1NjM4",
      "avatar_url": "https://avatars.githubusercontent.com/u/67415638?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/lufa23",
      "html_url": "https://github.com/lufa23",
      "followers_url": "https://api.github.com/users/lufa23/followers",
      "following_url": "https://api.github.com/users/lufa23/following{/other_user}",
      "gists_url": "https://api.github.com/users/lufa23/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/lufa23/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/lufa23/subscriptions",
      "organizations_url": "https://api.github.com/users/lufa23/orgs",
      "repos_url": "https://api.github.com/users/lufa23/repos",
      "events_url": "https://api.github.com/users/lufa23/events{/privacy}",
      "received_events_url": "https://api.github.com/users/lufa23/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-19T09:06:38Z",
    "updated_at": "2020-10-19T12:54:52Z",
    "author_association": "NONE",
    "body": "this is the full content of the log:\r\n\r\n[teku_2020-10-16.log](https://github.com/PegaSysEng/teku/files/5400492/teku_2020-10-16.log)\r\n\r\nAnd no `BLS: loaded BLST library` appears in the log after launching it\r\n\r\nAlso, I deleted the database with `rm -r ~/.local/share/teku/beacon ` ,  made a `git pull`, and confirming the format through `cat ~/.local/share/teku/beacon/db.version` but i get a `6` in the logs, instead of a 5.  And the node is still syncing very slow",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/711886066/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/712340513",
    "html_url": "https://github.com/ConsenSys/teku/issues/3000#issuecomment-712340513",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3000",
    "id": 712340513,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxMjM0MDUxMw==",
    "user": {
      "login": "mbaxter",
      "id": 658601,
      "node_id": "MDQ6VXNlcjY1ODYwMQ==",
      "avatar_url": "https://avatars.githubusercontent.com/u/658601?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mbaxter",
      "html_url": "https://github.com/mbaxter",
      "followers_url": "https://api.github.com/users/mbaxter/followers",
      "following_url": "https://api.github.com/users/mbaxter/following{/other_user}",
      "gists_url": "https://api.github.com/users/mbaxter/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mbaxter/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mbaxter/subscriptions",
      "organizations_url": "https://api.github.com/users/mbaxter/orgs",
      "repos_url": "https://api.github.com/users/mbaxter/repos",
      "events_url": "https://api.github.com/users/mbaxter/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mbaxter/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-19T17:58:42Z",
    "updated_at": "2020-10-19T17:58:42Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hey @lufa23 - are those logs from after you pulled the latest?   From those logs, it appears you're still running a version of teku prior to our change to default the database to version 5.  If you pull the latest and reset your db again, it should run with version 5.  \r\n\r\nWhen teku starts up it prints a version line like: `Teku version: teku/v0.12.11-dev-97691bc1/linux-x86_64/oracle-java-15` which has the commit hash in it.  You can check that the commit hash matches the latest here: https://github.com/PegaSysEng/teku/commits/master.  ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/712340513/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/717669482",
    "html_url": "https://github.com/ConsenSys/teku/issues/3000#issuecomment-717669482",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3000",
    "id": 717669482,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcxNzY2OTQ4Mg==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-28T03:17:59Z",
    "updated_at": "2020-10-28T03:17:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "Going to close this as we haven't heard anything further back.  If this is still an issue could you please check you have the latest version which should create a version 5 database.  Feel free to reopen if it's still slow with a v5 database.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/717669482/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
