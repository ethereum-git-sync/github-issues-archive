{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/5416",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/5416/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/5416/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/5416/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/5416",
  "id": 1223959657,
  "node_id": "I_kwDOCM9I9M5I9CRp",
  "number": 5416,
  "title": "Improve reporting of \"Error while attempting to publish metrics to remote service\"",
  "user": {
    "login": "benjaminion",
    "id": 20796281,
    "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/benjaminion",
    "html_url": "https://github.com/benjaminion",
    "followers_url": "https://api.github.com/users/benjaminion/followers",
    "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
    "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
    "organizations_url": "https://api.github.com/users/benjaminion/orgs",
    "repos_url": "https://api.github.com/users/benjaminion/repos",
    "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/benjaminion/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-05-03T11:14:00Z",
  "updated_at": "2022-05-24T04:10:27Z",
  "closed_at": "2022-05-24T04:10:27Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "Every few hours I see the below in my console. I am pushing metrics to the remote beaconchai.in service with `metrics-publish-endpoint: \"https://beaconcha.in/api/v1/client/metrics?apikey=XXX\"`. Presumably it's due to the remote service sometimes being down.\r\n\r\n1. Suggest this be demoted to \"WARNING\" level since it's definitely not critical for the operation of Teku.\r\n2. It would be nice not to have the full stack trace in my console output. (I have `log-destination: \"CONSOLE\"`). Suggest trapping common cases like \"timeout\" and including them in a nice warning message, and doing the stack trace only for other untrapped cases.\r\n\r\n```\r\nMay 03 09:34:50 metalalbert teku[2458]: 2022-05-03 09:34:50.546 ERROR - Error while attempting to publish metrics to remote service\r\nMay 03 09:34:50 metalalbert teku[2458]: java.net.SocketTimeoutException: timeout\r\nMay 03 09:34:50 metalalbert teku[2458]: at okhttp3.internal.http2.Http2Stream$StreamTimeout.newTimeoutException(Http2Stream.kt:677) ~[okhttp-4.9.2.jar:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at okhttp3.internal.http2.Http2Stream$StreamTimeout.exitAndThrowIfTimedOut(Http2Stream.kt:686) ~[okhttp-4.9.2.jar:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at okhttp3.internal.http2.Http2Stream.takeHeaders(Http2Stream.kt:143) ~[okhttp-4.9.2.jar:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at okhttp3.internal.http2.Http2ExchangeCodec.readResponseHeaders(Http2ExchangeCodec.kt:96) ~[okhttp-4.9.2.jar:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at okhttp3.internal.connection.Exchange.readResponseHeaders(Exchange.kt:106) ~[okhttp-4.9.2.jar:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at okhttp3.internal.http.CallServerInterceptor.intercept(CallServerInterceptor.kt:79) ~[okhttp-4.9.2.jar:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.9.2.jar:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at okhttp3.internal.connection.ConnectInterceptor.intercept(ConnectInterceptor.kt:34) ~[okhttp-4.9.2.jar:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.9.2.jar:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at okhttp3.internal.cache.CacheInterceptor.intercept(CacheInterceptor.kt:95) ~[okhttp-4.9.2.jar:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.9.2.jar:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at okhttp3.internal.http.BridgeInterceptor.intercept(BridgeInterceptor.kt:83) ~[okhttp-4.9.2.jar:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.9.2.jar:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at okhttp3.internal.http.RetryAndFollowUpInterceptor.intercept(RetryAndFollowUpInterceptor.kt:76) ~[okhttp-4.9.2.jar:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at okhttp3.internal.http.RealInterceptorChain.proceed(RealInterceptorChain.kt:109) ~[okhttp-4.9.2.jar:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at okhttp3.internal.connection.RealCall.getResponseWithInterceptorChain$okhttp(RealCall.kt:201) ~[okhttp-4.9.2.jar:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at okhttp3.internal.connection.RealCall.execute(RealCall.kt:154) ~[okhttp-4.9.2.jar:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at tech.pegasys.teku.data.publisher.MetricsPublisher.publishMetrics(MetricsPublisher.java:43) ~[teku-data-publisher-22.3.2.jar:22.3.2]\r\nMay 03 09:34:50 metalalbert teku[2458]: at tech.pegasys.teku.data.publisher.MetricsPublisherManager.publishMetrics(MetricsPublisherManager.java:87) ~[teku-data-publisher-22.3.2.jar:22.3.2]\r\nMay 03 09:34:50 metalalbert teku[2458]: at tech.pegasys.teku.infrastructure.async.FutureUtil.lambda$runWithFixedDelay$0(FutureUtil.java:39) ~[teku-infrastructure-async-22.3.2.jar:22.3.2]\r\nMay 03 09:34:50 metalalbert teku[2458]: at tech.pegasys.teku.infrastructure.async.SafeFuture.fromRunnable(SafeFuture.java:154) ~[teku-infrastructure-async-22.3.2.jar:22.3.2]\r\nMay 03 09:34:50 metalalbert teku[2458]: at tech.pegasys.teku.infrastructure.async.AsyncRunner.lambda$runAfterDelay$1(AsyncRunner.java:32) ~[teku-infrastructure-async-22.3.2.jar:22.3.2]\r\nMay 03 09:34:50 metalalbert teku[2458]: at tech.pegasys.teku.infrastructure.async.SafeFuture.of(SafeFuture.java:73) ~[teku-infrastructure-async-22.3.2.jar:22.3.2]\r\nMay 03 09:34:50 metalalbert teku[2458]: at tech.pegasys.teku.infrastructure.async.ScheduledExecutorAsyncRunner.lambda$createRunnableForAction$1(ScheduledExecutorAsyncRunner.java:119) ~[teku-infrastructure-async-22.3.2.jar:22.3.2]\r\nMay 03 09:34:50 metalalbert teku[2458]: at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\r\nMay 03 09:34:50 metalalbert teku[2458]: at java.lang.Thread.run(Thread.java:830) ~[?:?]\r\n```\r\n",
  "closed_by": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/5416/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/5416/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1115983913",
    "html_url": "https://github.com/ConsenSys/teku/issues/5416#issuecomment-1115983913",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5416",
    "id": 1115983913,
    "node_id": "IC_kwDOCM9I9M5ChJAp",
    "user": {
      "login": "benjaminion",
      "id": 20796281,
      "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjaminion",
      "html_url": "https://github.com/benjaminion",
      "followers_url": "https://api.github.com/users/benjaminion/followers",
      "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
      "organizations_url": "https://api.github.com/users/benjaminion/orgs",
      "repos_url": "https://api.github.com/users/benjaminion/repos",
      "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjaminion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-05-03T11:17:09Z",
    "updated_at": "2022-05-03T11:17:09Z",
    "author_association": "CONTRIBUTOR",
    "body": "Seems like for 502 responses we already do the second one. Just need to do similar for \"timeout\".\r\n\r\n```\r\nMay 03 08:55:15 metalalbert teku[2458]: 2022-05-03 08:55:15.553 INFO  - Slot Event  *** Slot: 3728674, Block: da341e841c2dd910ca20d0b3f80a895685dfa3fb5a7c611916f1296315d40e11, Justified: 116520, Finalized: 116519, Peers: 100\r\nMay 03 08:55:26 metalalbert teku[2458]: 2022-05-03 08:55:26.283 ERROR - Failed to publish metrics to external metrics service. Response code 502\r\nMay 03 08:55:27 metalalbert teku[2458]: 2022-05-03 08:55:27.563 INFO  - Slot Event  *** Slot: 3728675, Block: 184660d036d8311bdec0dac95c5a5c50f656f466e89087f20d6b8166248aa866, Justified: 116520, Finalized: 116519, Peers: 100\r\n```\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1115983913/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
