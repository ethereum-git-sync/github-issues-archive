{
  "url": "https://api.github.com/repos/Consensys/teku/issues/7502",
  "repository_url": "https://api.github.com/repos/Consensys/teku",
  "labels_url": "https://api.github.com/repos/Consensys/teku/issues/7502/labels{/name}",
  "comments_url": "https://api.github.com/repos/Consensys/teku/issues/7502/comments",
  "events_url": "https://api.github.com/repos/Consensys/teku/issues/7502/events",
  "html_url": "https://github.com/Consensys/teku/issues/7502",
  "id": 1892364105,
  "node_id": "I_kwDOCM9I9M5wyy9J",
  "number": 7502,
  "title": "Bug: keymanager API not started when engine API not yet up",
  "user": {
    "login": "yorickdowne",
    "id": 71337066,
    "node_id": "MDQ6VXNlcjcxMzM3MDY2",
    "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/yorickdowne",
    "html_url": "https://github.com/yorickdowne",
    "followers_url": "https://api.github.com/users/yorickdowne/followers",
    "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
    "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
    "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
    "repos_url": "https://api.github.com/users/yorickdowne/repos",
    "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
    "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "open",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2023-09-12T11:59:28Z",
  "updated_at": "2023-09-12T16:51:03Z",
  "closed_at": null,
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "### Description\r\n\r\nTeku 23.9.0 does not create `validator/key-manager/validator-api-bearer` and does not start keymanager API when the Engine API is still starting as it starts.\r\n\r\nThis can keep users of Eth Docker from using the keymanager API. This appears to be a fairly recent issue.\r\n\r\n### Steps to Reproduce (Bug)\r\n\r\nRun a fresh install of Teku 23.9.0 with `--data-path=/var/lib/teku` and validator API enabled:\r\n\r\n```\r\n      - --validator-api-enabled=true\r\n      - --validator-api-interface=0.0.0.0\r\n      - --validator-api-port=${KEY_API_PORT:-7500}\r\n      - --validator-api-host-allowlist=*\r\n      - --validator-api-cors-origins=*\r\n      - --validator-api-keystore-file=/var/lib/teku/teku-keyapi.keystore\r\n      - --validator-api-keystore-password-file=/var/lib/teku/teku-keyapi.password\r\n```\r\n\r\nObserve whether `/var/lib/teku/validator/key-manager/validator-api-bearer` is being created and keymanager API starts.\r\n\r\n**Frequency:**\r\n\r\nReproducible.\r\n\r\nFalling back to Teku v23.8.0 resolves the issue.\r\n\r\n### Versions (Add all that apply)\r\n* Software version: `teku/v23.9.0/linux-x86_64/-eclipseadoptium-openjdk64bitservervm-java-17`\r\n\r\n### Logs\r\n\r\nSee below for failure and success logs.",
  "closed_by": null,
  "reactions": {
    "url": "https://api.github.com/repos/Consensys/teku/issues/7502/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/Consensys/teku/issues/7502/timeline",
  "performed_via_github_app": null,
  "state_reason": null
}
[
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1715615542",
    "html_url": "https://github.com/Consensys/teku/issues/7502#issuecomment-1715615542",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7502",
    "id": 1715615542,
    "node_id": "IC_kwDOCM9I9M5mQjc2",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-12T12:18:13Z",
    "updated_at": "2023-09-12T12:37:47Z",
    "author_association": "NONE",
    "body": "Startup logs in full on fresh 23.9.0 with engine API starting as Teku starts\r\n\r\n```\r\neth-docker-devel-consensus-1  | Checkpoint sync enabled\r\neth-docker-devel-consensus-1  | MEV Boost enabled\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Setting logging level to INFO\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Configuring logging for destination: console\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Logging includes events: true\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Logging includes validator duties: true\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Logging includes color: true\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Include P2P warnings set to: false\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:45.113 INFO  - '--validators-builder-registration-default-enabled' requires '--validators-proposer-blinded-blocks-enabled', enabling it\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:45.133 INFO  - During block production, locally produced payload will be chosen when its value is equal or greater than 100% of the builder bid value. Can be configured via --builder-bid-compare-factor\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:45.617 INFO  - Teku version: teku/v23.9.0/linux-x86_64/-eclipseadoptium-openjdk64bitservervm-java-17\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:45.618 INFO  - This software is licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this software except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:46.011 INFO  - Configuration | Network: prater, Storage Mode: MINIMAL\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:46.012 INFO  - Host Configuration | Maximum Heap Size: 4.00 GB, Total Memory: 31.34 GB, CPU Cores: 8\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:46.012 INFO  - Rest Api Configuration | Enabled: true, Listen Address: 0.0.0.0, Port: 5052, Allow: [*]\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:46.012 INFO  - Validator Api Configuration | Listen Address: 0.0.0.0, Port 7500, Allow: [*]\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:46.787 INFO  - JWT secret loaded from /var/lib/teku/ee-secret/jwtsecret\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:46.809 INFO  - Using execution engine at http://execution:8551\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:46.809 INFO  - Enabling Builder Circuit Breaker\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:47.001 INFO  - Eth1 endpoint not provided, using execution engine endpoint for eth1 data\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:47.601 ERROR - External signer is currently not reachable at http://web3signer:9000\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:47.627 ERROR - External signer is currently not reachable at http://web3signer:9000\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:47.713 INFO  - Storing beacon chain data in: /var/lib/teku/beacon\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:47.785 WARN  - Failed to load public keys from external signer.\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:47.792 INFO  - Using portable BLST library.\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:47.811 INFO  - Starting metrics http service on 0.0.0.0:8008\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:48.184 INFO  - Metrics service started and listening on 0.0.0.0:8008\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:48.189 INFO  - Beacon data directory set to: /var/lib/teku/beacon\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:48.427 INFO  - Created leveldb2 Hot and Finalized database (leveldb2) at /var/lib/teku/beacon/db\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:48.610 INFO  - Using default implementation for ThreadExecutor\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:48.687 INFO  - Initialized Scheduler Signaller of type: class org.quartz.core.SchedulerSignalerImpl\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:48.687 INFO  - Quartz Scheduler v.2.3.2 created.\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:48.688 INFO  - RAMJobStore initialized.\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:48.688 INFO  - Scheduler meta-data: Quartz Scheduler (v2.3.2) 'QuartzScheduler' with instanceId 'NON_CLUSTERED'\r\neth-docker-devel-consensus-1  |   Scheduler class: 'org.quartz.core.QuartzScheduler' - running locally.\r\neth-docker-devel-consensus-1  |   NOT STARTED.\r\neth-docker-devel-consensus-1  |   Currently in standby mode.\r\neth-docker-devel-consensus-1  |   Number of jobs executed: 0\r\neth-docker-devel-consensus-1  |   Using thread pool 'org.quartz.simpl.SimpleThreadPool' - with 1 threads.\r\neth-docker-devel-consensus-1  |   Using job-store 'org.quartz.simpl.RAMJobStore' - which does not support persistence. and is not clustered.\r\neth-docker-devel-consensus-1  | \r\neth-docker-devel-consensus-1  | \r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:48.689 INFO  - Quartz scheduler 'QuartzScheduler' initialized from an externally provided properties instance.\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:48.689 INFO  - Quartz scheduler version: 2.3.2\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:48.720 INFO  - Initializing storage\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:48.921 INFO  - Pruning finalized blocks before slot 5444128\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:49.007 INFO  - Finalized blocks before slot 5444128 have been pruned.\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:57.796 INFO  - Storage initialization complete\r\neth-docker-devel-consensus-1  | 2023-09-12 11:57:57.797 WARN  - Not loading specified initial state as chain data already exists.\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:00.508 INFO  - BLS: loaded BLST library\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:08.210 INFO  - Completed regeneration of state for block 0xb658921c65626318e6c9da5a2819787b18898267b60eeb4386ba632bb17c6058 at slot 6500927 by replaying 26 blocks. Took 10364ms\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:13.027 INFO  - Execution Client is online\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:13.094 INFO  - Loading generated p2p private key from: generated-node-key\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:14.628 INFO  - PreGenesis Local ENR: enr:-Iu4QDBYbXtPu9PbP4wPxRXGkJUNrfMEltvb8X9pEf5Titv9H-TlDLcVdr5hRO8mM6o3BxB6o4UfuzY0H1Ynn6wTJH8dhGV0aDKQ5L6TkwAAECD__________4JpZIJ2NIlzZWNwMjU2azGhA-cwDLQuG5S3f5V9kozQoIIfdYKs1vz8xADtULmFTAOw\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:14.641 INFO  - Using multipeer sync\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:14.824 INFO  - Using 8 threads for handling validator API channel\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:16.613 INFO  - Starting libp2p network...\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:16.623 INFO  - Listening for connections on: /ip4/172.16.29.5/tcp/9010/p2p/16Uiu2HAmUDT2MU6coUyHeC22nJgfzguCmnir4VthBbeE97tpvr1u\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:16.632 INFO  - Starting discovery server on UDP port 9010\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:16.651 INFO  - UDP discovery client started\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:16.656 INFO  - Begin historical sync of blocks from slot 6500673 to slot 5444127\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:16.690 INFO  - Scheduler QuartzScheduler_$_NON_CLUSTERED started.\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:16.791 INFO  - Local ENR: enr:-Iu4QOzlpOSvUoLYsf7XX01MBcVFIRfDyZKcuYEGcgJdyHejYU8HUlJiQiwOb5OdEEjyzqLtI8p2RLtgwR0Y3Qk9-JcehGV0aDKQYolB7wMAECD__________4JpZIJ2NIlzZWNwMjU2azGhA-cwDLQuG5S3f5V9kozQoIIfdYKs1vz8xADtULmFTAOw\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:16.795 INFO  - Starting eth2 gossip\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:16.830 INFO  - jetty-11.0.15; built: 2023-04-11T18:37:53.775Z; git: 5bc5e562c8d05c5862505aebe5cf83a61bdbcb96; jvm 17.0.8.1+1\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:16.945 INFO  - Session workerName=node0\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:17.018 INFO  - Started i.j.j.@71deab31{/,null,AVAILABLE}\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:17.034 INFO  - Started ServerConnector@1b642ad8{HTTP/1.1, (http/1.1)}{0.0.0.0:5052}\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:17.087 INFO  - Started Server@161fde19{STARTING}[11.0.15,sto=0] @40768ms\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:17.088 INFO  - Syncing     *** Target slot: 6500991, Head slot: 6500987, Waiting for execution layer sync, Connected peers: 0\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:17.122 INFO  - Listening on http://localhost:5052/\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:17.135 INFO  - Loading deposit tree snapshot from jar:file:/opt/teku/lib/teku-services-powchain-23.9.0.jar!/tech/pegasys/teku/services/powchain/goerli.ssz\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:17.196 INFO  - A deposit snapshot was read with 313267 deposits and 0x17a3e8af4a09f15ecee4c40c7e3d93aea5fbb7ae6999fce79c5e2fc97eb55b33 execution block hash.\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:17.198 INFO  - Loading deposit tree snapshot from database\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:17.205 INFO  - Loaded deposits tree state from snapshot with 313267 deposits and 0x17a3e8af4a09f15ecee4c40c7e3d93aea5fbb7ae6999fce79c5e2fc97eb55b33 execution block hash.\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:17.304 INFO  - Loading deposits up to Eth1 block 0\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:17.506 INFO  - Epoch Event *** Epoch: 203156, Justified checkpoint: 203154, Finalized checkpoint: 203153, Finalized root: 5477f5028294fe2b3a8587bc9397034d325d5397f6369d37027df631d138e36d\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:17.747 INFO  - External signer is reachable at http://web3signer:9000\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:17.747 INFO  - External signer is reachable at http://web3signer:9000\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:18.101 WARN  - The builder is not available: java.util.concurrent.TimeoutException. Block production will fallback to the execution engine.\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:18.103 INFO  - The builder is available. It will be used for block production.\r\neth-docker-devel-consensus-1  | 2023-09-12 11:58:30.644 INFO  - Completed regeneration of state for block 0x62bceeffaf25e6ace1bccd72548dc54962e54d37326fa2e33384b2560d80e8be at slot 6500987 by replaying 52 blocks. Took 17982ms\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1715615542/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1715630078",
    "html_url": "https://github.com/Consensys/teku/issues/7502#issuecomment-1715630078",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7502",
    "id": 1715630078,
    "node_id": "IC_kwDOCM9I9M5mQm_-",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-12T12:28:04Z",
    "updated_at": "2023-09-12T12:28:04Z",
    "author_association": "NONE",
    "body": "Upon further testing, this may be an issue with the keymanager API not starting, and maybe unrelated to the data dir location.\r\n\r\nUpdated Teku to 23.9.0 from 23.8.0, observed that keymanager API started\r\nRestarted Teku 23.9.0, and there is no log line for the keymanager API starting on 7500:\r\n```\r\neth-docker-devel-consensus-1  | Checkpoint sync enabled\r\neth-docker-devel-consensus-1  | MEV Boost enabled\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Setting logging level to INFO\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Configuring logging for destination: console\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Logging includes events: true\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Logging includes validator duties: true\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Logging includes color: true\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Include P2P warnings set to: false\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:07.438 INFO  - '--validators-builder-registration-default-enabled' requires '--validators-proposer-blinded-blocks-enabled', enabling it\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:07.515 INFO  - During block production, locally produced payload will be chosen when its value is equal or greater than 100% of the builder bid value. Can be configured via --builder-bid-compare-factor\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:08.106 INFO  - Teku version: teku/v23.9.0/linux-x86_64/-eclipseadoptium-openjdk64bitservervm-java-17\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:08.106 INFO  - This software is licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this software except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:08.596 INFO  - Configuration | Network: prater, Storage Mode: MINIMAL\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:08.597 INFO  - Host Configuration | Maximum Heap Size: 4.00 GB, Total Memory: 31.34 GB, CPU Cores: 8\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:08.598 INFO  - Rest Api Configuration | Enabled: true, Listen Address: 0.0.0.0, Port: 5052, Allow: [*]\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:08.598 INFO  - Validator Api Configuration | Listen Address: 0.0.0.0, Port 7500, Allow: [*]\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:09.313 INFO  - JWT secret loaded from /var/lib/teku/ee-secret/jwtsecret\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:09.347 INFO  - Using execution engine at http://execution:8551\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:09.347 INFO  - Enabling Builder Circuit Breaker\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:09.511 INFO  - Eth1 endpoint not provided, using execution engine endpoint for eth1 data\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:10.024 ERROR - External signer is currently not reachable at http://web3signer:9000\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:10.094 ERROR - External signer is currently not reachable at http://web3signer:9000\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:10.115 INFO  - Storing beacon chain data in: /var/lib/teku/beacon\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:10.125 WARN  - Failed to load public keys from external signer.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:10.130 INFO  - Using portable BLST library.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:10.137 INFO  - Starting metrics http service on 0.0.0.0:8008\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:10.399 INFO  - Metrics service started and listening on 0.0.0.0:8008\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:10.403 INFO  - Beacon data directory set to: /var/lib/teku/beacon\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:10.595 INFO  - Created leveldb2 Hot and Finalized database (leveldb2) at /var/lib/teku/beacon/db\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:10.658 INFO  - Using default implementation for ThreadExecutor\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:10.697 INFO  - Initialized Scheduler Signaller of type: class org.quartz.core.SchedulerSignalerImpl\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:10.697 INFO  - Quartz Scheduler v.2.3.2 created.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:10.699 INFO  - RAMJobStore initialized.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:10.700 INFO  - Scheduler meta-data: Quartz Scheduler (v2.3.2) 'QuartzScheduler' with instanceId 'NON_CLUSTERED'\r\neth-docker-devel-consensus-1  |   Scheduler class: 'org.quartz.core.QuartzScheduler' - running locally.\r\neth-docker-devel-consensus-1  |   NOT STARTED.\r\neth-docker-devel-consensus-1  |   Currently in standby mode.\r\neth-docker-devel-consensus-1  |   Number of jobs executed: 0\r\neth-docker-devel-consensus-1  |   Using thread pool 'org.quartz.simpl.SimpleThreadPool' - with 1 threads.\r\neth-docker-devel-consensus-1  |   Using job-store 'org.quartz.simpl.RAMJobStore' - which does not support persistence. and is not clustered.\r\neth-docker-devel-consensus-1  | \r\neth-docker-devel-consensus-1  | \r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:10.700 INFO  - Quartz scheduler 'QuartzScheduler' initialized from an externally provided properties instance.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:10.700 INFO  - Quartz scheduler version: 2.3.2\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:10.737 INFO  - Initializing storage\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:11.100 INFO  - Pruning finalized blocks before slot 5444256\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:11.217 INFO  - Finalized blocks before slot 5444256 have been pruned.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:20.680 INFO  - Storage initialization complete\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:20.681 WARN  - Not loading specified initial state as chain data already exists.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:23.112 INFO  - BLS: loaded BLST library\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:32.324 INFO  - Completed regeneration of state for block 0xc1594631c52fa89d52577589b8f2d606cd6ac6bf560ac7c800659db2df5650d9 at slot 6501056 by replaying 27 blocks. Took 11592ms\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:32.804 ERROR - Execution Client request failed. Make sure the Execution Client is online and can respond to requests.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:32.811 ERROR - Failed to update fork choice\r\neth-docker-devel-consensus-1  | java.util.concurrent.CompletionException: tech.pegasys.teku.ethereum.executionclient.response.InvalidRemoteResponseException: Invalid remote response from the execution client: Failed to connect to execution/172.16.30.11:8551\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.encodeThrowable(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.completeThrowable(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture$UniApply.tryFire(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.postComplete(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.complete(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:148) ~[teku-infrastructure-async-23.9.0.jar:23.9.0]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.uniWhenComplete(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.postComplete(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.complete(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:148) ~[teku-infrastructure-async-23.9.0.jar:23.9.0]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.uniWhenComplete(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.uniWhenCompleteStage(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.whenComplete(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:626) ~[teku-infrastructure-async-23.9.0.jar:23.9.0]\r\neth-docker-devel-consensus-1  | at tech.pegasys.teku.infrastructure.async.SafeFuture.whenComplete(SafeFuture.java:33) ~[teku-infrastructure-async-23.9.0.jar:23.9.0]\r\neth-docker-devel-consensus-1  | at tech.pegasys.teku.infrastructure.async.SafeFuture.propagateResult(SafeFuture.java:143) ~[teku-infrastructure-async-23.9.0.jar:23.9.0]\r\neth-docker-devel-consensus-1  | at tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$exceptionallyCompose$34(SafeFuture.java:426) ~[teku-infrastructure-async-23.9.0.jar:23.9.0]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.uniWhenComplete(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.postComplete(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.completeExceptionally(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:146) ~[teku-infrastructure-async-23.9.0.jar:23.9.0]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.uniWhenComplete(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.postComplete(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.completeExceptionally(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at org.web3j.utils.Async.lambda$run$1(Async.java:40) ~[core-4.10.1.jar:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture$AsyncRun.run(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source) [?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source) [?:?]\r\neth-docker-devel-consensus-1  | at java.lang.Thread.run(Unknown Source) [?:?]\r\neth-docker-devel-consensus-1  | Caused by: tech.pegasys.teku.ethereum.executionclient.response.InvalidRemoteResponseException: Invalid remote response from the execution client: Failed to connect to execution/172.16.30.11:8551\r\neth-docker-devel-consensus-1  | at tech.pegasys.teku.ethereum.executionclient.response.ResponseUnwrapper.unwrapResponseOrThrow(ResponseUnwrapper.java:34) ~[teku-ethereum-executionclient-23.9.0.jar:23.9.0]\r\neth-docker-devel-consensus-1  | at tech.pegasys.teku.ethereum.executionclient.response.ResponseUnwrapper.unwrapExecutionClientResponseOrThrow(ResponseUnwrapper.java:21) ~[teku-ethereum-executionclient-23.9.0.jar:23.9.0]\r\neth-docker-devel-consensus-1  | ... 30 more\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:33.000 INFO  - Loading generated p2p private key from: generated-node-key\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:34.119 INFO  - PreGenesis Local ENR: enr:-Iu4QCQQEWcuObpt89ywem54fEk09s_UbSxQC5TbZrENZnyzbBP2Dt-ZGJ-y7dqdF6nMTOzUF7uN-UNjUhfptI7KZ0QrhGV0aDKQ5L6TkwAAECD__________4JpZIJ2NIlzZWNwMjU2azGhA-cwDLQuG5S3f5V9kozQoIIfdYKs1vz8xADtULmFTAOw\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:34.132 INFO  - Using multipeer sync\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:34.293 INFO  - Using 8 threads for handling validator API channel\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:35.949 ERROR - Exception exchanging Engine API capabilities\r\neth-docker-devel-consensus-1  | java.util.concurrent.CompletionException: tech.pegasys.teku.ethereum.executionclient.response.InvalidRemoteResponseException: Invalid remote response from the execution client: Failed to connect to execution/172.16.30.11:8551\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.encodeThrowable(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.completeThrowable(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture$UniApply.tryFire(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.postComplete(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.complete(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:148) ~[teku-infrastructure-async-23.9.0.jar:23.9.0]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.uniWhenComplete(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.postComplete(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.completeExceptionally(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at tech.pegasys.teku.infrastructure.async.SafeFuture.lambda$propagateResult$3(SafeFuture.java:146) ~[teku-infrastructure-async-23.9.0.jar:23.9.0]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.uniWhenComplete(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.postComplete(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture.completeExceptionally(Unknown Source) ~[?:?]\r\neth-docker-devel-consensus-1  | at org.web3j.utils.Async.lambda$run$1(Async.java:40) ~[core-4.10.1.jar:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.CompletableFuture$AsyncRun.run(Unknown Source) [?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source) [?:?]\r\neth-docker-devel-consensus-1  | at java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source) [?:?]\r\neth-docker-devel-consensus-1  | at java.lang.Thread.run(Unknown Source) [?:?]\r\neth-docker-devel-consensus-1  | Caused by: tech.pegasys.teku.ethereum.executionclient.response.InvalidRemoteResponseException: Invalid remote response from the execution client: Failed to connect to execution/172.16.30.11:8551\r\neth-docker-devel-consensus-1  | at tech.pegasys.teku.ethereum.executionclient.response.ResponseUnwrapper.unwrapResponseOrThrow(ResponseUnwrapper.java:34) ~[teku-ethereum-executionclient-23.9.0.jar:23.9.0]\r\neth-docker-devel-consensus-1  | at tech.pegasys.teku.ethereum.executionclient.response.ResponseUnwrapper.unwrapExecutionClientResponseOrThrow(ResponseUnwrapper.java:21) ~[teku-ethereum-executionclient-23.9.0.jar:23.9.0]\r\neth-docker-devel-consensus-1  | ... 18 more\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:35.985 INFO  - Starting libp2p network...\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:35.994 INFO  - Listening for connections on: /ip4/172.16.30.13/tcp/9010/p2p/16Uiu2HAmUDT2MU6coUyHeC22nJgfzguCmnir4VthBbeE97tpvr1u\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.000 INFO  - Starting discovery server on UDP port 9010\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.018 INFO  - UDP discovery client started\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.022 INFO  - Begin historical sync of blocks from slot 6500673 to slot 5444255\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.022 INFO  - Scheduler QuartzScheduler_$_NON_CLUSTERED started.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.099 INFO  - Syncing     *** Target slot: 6501117, Head slot: 6501113, Waiting for execution layer sync, Connected peers: 0\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.187 INFO  - Local ENR: enr:-Iu4QAU2YOy2BPchN9Wvp1c0qrMxy5C5Wx4sP0QNiQiuKaILT_CbAX6TDwXcLcdQwMllU7gDJssbW-v8TuzjzbXtzscshGV0aDKQYolB7wMAECD__________4JpZIJ2NIlzZWNwMjU2azGhA-cwDLQuG5S3f5V9kozQoIIfdYKs1vz8xADtULmFTAOw\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.198 INFO  - Starting eth2 gossip\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.289 INFO  - jetty-11.0.15; built: 2023-04-11T18:37:53.775Z; git: 5bc5e562c8d05c5862505aebe5cf83a61bdbcb96; jvm 17.0.8.1+1\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.429 INFO  - Session workerName=node0\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.497 INFO  - Started i.j.j.@70fec42b{/,null,AVAILABLE}\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.508 INFO  - Started ServerConnector@442f0f03{HTTP/1.1, (http/1.1)}{0.0.0.0:5052}\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.511 INFO  - Started Server@79fd1b56{STARTING}[11.0.15,sto=0] @37916ms\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.517 INFO  - Syncing     *** Target slot: 6501118, Head slot: 6501113, Waiting for execution layer sync, Connected peers: 0\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.620 INFO  - Listening on http://localhost:5052/\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.633 INFO  - Loading deposit tree snapshot from jar:file:/opt/teku/lib/teku-services-powchain-23.9.0.jar!/tech/pegasys/teku/services/powchain/goerli.ssz\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.691 INFO  - A deposit snapshot was read with 313267 deposits and 0x17a3e8af4a09f15ecee4c40c7e3d93aea5fbb7ae6999fce79c5e2fc97eb55b33 execution block hash.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.697 INFO  - Loading deposit tree snapshot from database\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.710 INFO  - Loaded deposits tree state from snapshot with 313267 deposits and 0x17a3e8af4a09f15ecee4c40c7e3d93aea5fbb7ae6999fce79c5e2fc97eb55b33 execution block hash.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.725 WARN  - Endpoint http://execution:8551 encountered an issue | Connection refused\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:36.940 WARN  - The builder is not available: java.util.concurrent.TimeoutException. Block production will fallback to the execution engine.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:37.058 INFO  - The builder is available. It will be used for block production.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:40.487 INFO  - External signer is reachable at http://web3signer:9000\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:40.488 INFO  - External signer is reachable at http://web3signer:9000\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:45.630 INFO  - Completed regeneration of state for block 0x8e4da74a8f2dc5df6a858ca0405d642a9cd23e25720d6b287ff2d89364698011 at slot 6501113 by replaying 46 blocks. Took 12972ms\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:48.005 INFO  - Syncing     *** Target slot: 6501119, Head slot: 6501113, Waiting for execution layer sync, Connected peers: 5\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:52.517 ERROR - Unable to import block: Execution Client returned an error: tech.pegasys.teku.ethereum.executionclient.response.InvalidRemoteResponseException: Invalid remote response from the execution client: Failed to connect to execution/172.16.30.11:8551\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:54.518 INFO  - Retrying execution of block 8ac8d1317ceaa80c2ff82c5c5f1ea4689d7826b5d84f6d049e8b3f05ac1560e3 (6501114)\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:54.639 ERROR - Unable to import block: Execution Client returned an error: tech.pegasys.teku.ethereum.executionclient.response.InvalidRemoteResponseException: Invalid remote response from the execution client: Failed to connect to execution/172.16.30.11:8551\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:58.640 INFO  - Retrying execution of block 8ac8d1317ceaa80c2ff82c5c5f1ea4689d7826b5d84f6d049e8b3f05ac1560e3 (6501114)\r\neth-docker-devel-consensus-1  | 2023-09-12 12:23:59.505 ERROR - Unable to import block: Execution Client returned an error: tech.pegasys.teku.ethereum.executionclient.response.InvalidRemoteResponseException: Invalid remote response from the execution client: Failed to connect to execution/172.16.30.11:8551\r\neth-docker-devel-consensus-1  | 2023-09-12 12:24:00.022 INFO  - Syncing     *** Target slot: 6501120, Head slot: 6501113, Waiting for execution layer sync, Connected peers: 9\r\neth-docker-devel-consensus-1  | 2023-09-12 12:24:02.137 INFO  - Loading deposits up to Eth1 block 0\r\neth-docker-devel-consensus-1  | 2023-09-12 12:24:07.506 INFO  - Retrying execution of block 8ac8d1317ceaa80c2ff82c5c5f1ea4689d7826b5d84f6d049e8b3f05ac1560e3 (6501114)\r\neth-docker-devel-consensus-1  | 2023-09-12 12:24:07.587 INFO  - Execution Client is responding to requests again after a previous failure\r\neth-docker-devel-consensus-1  | 2023-09-12 12:24:23.918 INFO  - Completed regeneration of state for block 0xdf6a5acc113f85b5a7fdac14fc226710830171bf89a80d0b7fd4b9107bfaffba at slot 6501086 by replaying 24 blocks. Took 11914ms\r\n```\r\n\r\nRestarted Teku again but left execution client running, now keymanager API starts. One sec, more tests.\r\n\r\n\r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1715630078/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1715636467",
    "html_url": "https://github.com/Consensys/teku/issues/7502#issuecomment-1715636467",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7502",
    "id": 1715636467,
    "node_id": "IC_kwDOCM9I9M5mQojz",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-12T12:32:16Z",
    "updated_at": "2023-09-12T12:32:16Z",
    "author_association": "NONE",
    "body": "Success logs when Engine API is already up as Teku `23.9.0` starts.\r\n\r\n```\r\neth-docker-devel-consensus-1  | Checkpoint sync enabled\r\neth-docker-devel-consensus-1  | MEV Boost enabled\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Setting logging level to INFO\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Configuring logging for destination: console\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Logging includes events: true\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Logging includes validator duties: true\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Logging includes color: true\r\neth-docker-devel-consensus-1  | INFO StatusConsoleListener Include P2P warnings set to: false\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:46.919 INFO  - '--validators-builder-registration-default-enabled' requires '--validators-proposer-blinded-blocks-enabled', enabling it\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:46.938 INFO  - During block production, locally produced payload will be chosen when its value is equal or greater than 100% of the builder bid value. Can be configured via --builder-bid-compare-factor\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:47.325 INFO  - Teku version: teku/v23.9.0/linux-x86_64/-eclipseadoptium-openjdk64bitservervm-java-17\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:47.325 INFO  - This software is licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this software except in compliance with the License. You may obtain a copy of the License at http://www.apache.org/licenses/LICENSE-2.0\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:47.567 INFO  - Configuration | Network: prater, Storage Mode: MINIMAL\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:47.567 INFO  - Host Configuration | Maximum Heap Size: 4.00 GB, Total Memory: 31.34 GB, CPU Cores: 8\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:47.567 INFO  - Rest Api Configuration | Enabled: true, Listen Address: 0.0.0.0, Port: 5052, Allow: [*]\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:47.567 INFO  - Validator Api Configuration | Listen Address: 0.0.0.0, Port 7500, Allow: [*]\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:47.832 INFO  - JWT secret loaded from /var/lib/teku/ee-secret/jwtsecret\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:47.853 INFO  - Using execution engine at http://execution:8551\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:47.853 INFO  - Enabling Builder Circuit Breaker\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:47.963 INFO  - Eth1 endpoint not provided, using execution engine endpoint for eth1 data\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.210 INFO  - External signer is reachable at http://web3signer:9000\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.225 INFO  - External signer is reachable at http://web3signer:9000\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.247 INFO  - Storing beacon chain data in: /var/lib/teku/beacon\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.285 INFO  - Using portable BLST library.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.297 INFO  - Starting metrics http service on 0.0.0.0:8008\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.324 INFO  - BLS: loaded BLST library\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.328 INFO  - Loading 2 validator keys...\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.340 INFO  - Loaded 2 Validators: 9642bbe, 8fe5b2c\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.511 INFO  - Metrics service started and listening on 0.0.0.0:8008\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.516 INFO  - Beacon data directory set to: /var/lib/teku/beacon\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.681 INFO  - Created leveldb2 Hot and Finalized database (leveldb2) at /var/lib/teku/beacon/db\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.800 INFO  - Using default implementation for ThreadExecutor\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.816 INFO  - Initialized Scheduler Signaller of type: class org.quartz.core.SchedulerSignalerImpl\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.816 INFO  - Quartz Scheduler v.2.3.2 created.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.817 INFO  - RAMJobStore initialized.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.818 INFO  - Scheduler meta-data: Quartz Scheduler (v2.3.2) 'QuartzScheduler' with instanceId 'NON_CLUSTERED'\r\neth-docker-devel-consensus-1  |   Scheduler class: 'org.quartz.core.QuartzScheduler' - running locally.\r\neth-docker-devel-consensus-1  |   NOT STARTED.\r\neth-docker-devel-consensus-1  |   Currently in standby mode.\r\neth-docker-devel-consensus-1  |   Number of jobs executed: 0\r\neth-docker-devel-consensus-1  |   Using thread pool 'org.quartz.simpl.SimpleThreadPool' - with 1 threads.\r\neth-docker-devel-consensus-1  |   Using job-store 'org.quartz.simpl.RAMJobStore' - which does not support persistence. and is not clustered.\r\neth-docker-devel-consensus-1  | \r\neth-docker-devel-consensus-1  | \r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.819 INFO  - Quartz scheduler 'QuartzScheduler' initialized from an externally provided properties instance.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.819 INFO  - Quartz scheduler version: 2.3.2\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.842 INFO  - Initializing storage\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:48.954 INFO  - Pruning finalized blocks before slot 5444288\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:49.009 INFO  - Finalized blocks before slot 5444288 have been pruned.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:56.879 INFO  - Storage initialization complete\r\neth-docker-devel-consensus-1  | 2023-09-12 12:28:56.879 WARN  - Not loading specified initial state as chain data already exists.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:05.361 INFO  - Completed regeneration of state for block 0xdf6a5acc113f85b5a7fdac14fc226710830171bf89a80d0b7fd4b9107bfaffba at slot 6501086 by replaying 24 blocks. Took 8431ms\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:09.122 INFO  - Execution Client is online\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:09.241 INFO  - Loading generated p2p private key from: generated-node-key\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:10.244 INFO  - PreGenesis Local ENR: enr:-Iu4QFTxlEC1c5OdOJhcIfKrfRr69RTlriEf6EJV-2IH97Fpa_e0ffBCs03Zy9ft-VB4S8kjUEyXglDz6jN6fxcRwIE1hGV0aDKQ5L6TkwAAECD__________4JpZIJ2NIlzZWNwMjU2azGhA-cwDLQuG5S3f5V9kozQoIIfdYKs1vz8xADtULmFTAOw\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:10.256 INFO  - Using multipeer sync\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:10.402 INFO  - Using 8 threads for handling validator API channel\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:10.910 INFO  - Starting libp2p network...\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:10.920 INFO  - Listening for connections on: /ip4/172.16.30.13/tcp/9010/p2p/16Uiu2HAmUDT2MU6coUyHeC22nJgfzguCmnir4VthBbeE97tpvr1u\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.097 INFO  - Starting discovery server on UDP port 9010\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.131 INFO  - UDP discovery client started\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.133 INFO  - Begin historical sync of blocks from slot 6500673 to slot 5444287\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.141 INFO  - Scheduler QuartzScheduler_$_NON_CLUSTERED started.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.228 INFO  - Syncing     *** Target slot: 6501145, Head slot: 6501143, Waiting for execution layer sync, Connected peers: 0\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.299 INFO  - Local ENR: enr:-Iu4QCI3e91Dvqb_rYFIkSW4bYfLhRWeI6j78-UepF57JiLeAt9vX0z6J57UKcZA5qs1LMC6tRS4j50YgrTpLTD8YCM2hGV0aDKQYolB7wMAECD__________4JpZIJ2NIlzZWNwMjU2azGhA-cwDLQuG5S3f5V9kozQoIIfdYKs1vz8xADtULmFTAOw\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.303 INFO  - Starting eth2 gossip\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.321 INFO  - jetty-11.0.15; built: 2023-04-11T18:37:53.775Z; git: 5bc5e562c8d05c5862505aebe5cf83a61bdbcb96; jvm 17.0.8.1+1\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.521 INFO  - Session workerName=node0\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.692 INFO  - Started i.j.j.@1206bdba{/,null,AVAILABLE}\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.718 INFO  - Started ServerConnector@546bd19e{HTTP/1.1, (http/1.1)}{0.0.0.0:5052}\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.727 INFO  - Started Server@1edeeddd{STARTING}[11.0.15,sto=0] @27825ms\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.788 INFO  - Listening on http://localhost:5052/\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.808 INFO  - Loading deposit tree snapshot from jar:file:/opt/teku/lib/teku-services-powchain-23.9.0.jar!/tech/pegasys/teku/services/powchain/goerli.ssz\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.823 INFO  - A deposit snapshot was read with 313267 deposits and 0x17a3e8af4a09f15ecee4c40c7e3d93aea5fbb7ae6999fce79c5e2fc97eb55b33 execution block hash.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.825 INFO  - Loading deposit tree snapshot from database\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.839 INFO  - Loaded deposits tree state from snapshot with 313267 deposits and 0x17a3e8af4a09f15ecee4c40c7e3d93aea5fbb7ae6999fce79c5e2fc97eb55b33 execution block hash.\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.840 INFO  - Initializing API auth access file /var/lib/teku/validator/key-manager/validator-api-bearer\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.888 INFO  - Loading deposits up to Eth1 block 0\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.888 INFO  - jetty-11.0.15; built: 2023-04-11T18:37:53.775Z; git: 5bc5e562c8d05c5862505aebe5cf83a61bdbcb96; jvm 17.0.8.1+1\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.904 INFO  - Session workerName=node0\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.906 INFO  - Started i.j.j.@373f5b69{/,null,AVAILABLE}\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.998 INFO  - x509=X509@55e109e9(teku-keyapi,h=[localhost, consensus, validator, teku-keyapi-cert],a=[/127.0.0.1],w=[]) for Server@48fd242a[provider=Conscrypt,keyStore=file:///var/lib/teku/teku-keyapi.keystore,trustStore=null]\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:11.999 INFO  - Unable to get KeyManagerFactory instance for algorithm [SunX509] on provider [Conscrypt], using default\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:12.005 INFO  - Syncing     *** Target slot: 6501146, Head slot: 6501143, Waiting for execution layer sync, Connected peers: 0\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:12.013 INFO  - Unable to get TrustManagerFactory instance for algorithm [PKIX] on provider [Conscrypt], using default\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:12.014 INFO  - Unable to get SSLContext instance for protocol [TLS] on provider [Conscrypt], using default\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:12.023 INFO  - Started ServerConnector@18b3b383{SSL, (ssl, http/1.1)}{0.0.0.0:7500}\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:12.024 INFO  - Started Server@55692aa{STARTING}[11.0.15,sto=0] @28122ms\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:12.025 INFO  - Listening on http://localhost:7500/\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1715636467/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1716084417",
    "html_url": "https://github.com/Consensys/teku/issues/7502#issuecomment-1716084417",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7502",
    "id": 1716084417,
    "node_id": "IC_kwDOCM9I9M5mSV7B",
    "user": {
      "login": "mehdi-aouadi",
      "id": 1208687,
      "node_id": "MDQ6VXNlcjEyMDg2ODc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/1208687?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/mehdi-aouadi",
      "html_url": "https://github.com/mehdi-aouadi",
      "followers_url": "https://api.github.com/users/mehdi-aouadi/followers",
      "following_url": "https://api.github.com/users/mehdi-aouadi/following{/other_user}",
      "gists_url": "https://api.github.com/users/mehdi-aouadi/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/mehdi-aouadi/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/mehdi-aouadi/subscriptions",
      "organizations_url": "https://api.github.com/users/mehdi-aouadi/orgs",
      "repos_url": "https://api.github.com/users/mehdi-aouadi/repos",
      "events_url": "https://api.github.com/users/mehdi-aouadi/events{/privacy}",
      "received_events_url": "https://api.github.com/users/mehdi-aouadi/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-12T16:42:34Z",
    "updated_at": "2023-09-12T16:42:34Z",
    "author_association": "CONTRIBUTOR",
    "body": "Hi Yorick, I'm unable to reproduce the bearer non created issue. I started a fresh 23.9.0 Teku with the validator API enabled and with a dummy EL url and it created it (Log: `Initializing API auth access file...`, when it already exists, after a Teku restart, there is no such log which is normal).\r\nRegarding the key manager API startup, I see the log: `Validator Api Configuration | Listen Address: 0.0.0.0, Port 7500, Allow: [*]` in all the log snippets which means that the API has started correctly.\r\nAre we talking about the same success/failure logs?\r\n\r\nAre these [these logs](https://github.com/Consensys/teku/issues/7502#issuecomment-1715630078) before or after you restarted or both (I don't see a restart)? Are you deleting the bearer, if any, and the data dir before each test?\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1716084417/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1716094598",
    "html_url": "https://github.com/Consensys/teku/issues/7502#issuecomment-1716094598",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/7502",
    "id": 1716094598,
    "node_id": "IC_kwDOCM9I9M5mSYaG",
    "user": {
      "login": "yorickdowne",
      "id": 71337066,
      "node_id": "MDQ6VXNlcjcxMzM3MDY2",
      "avatar_url": "https://avatars.githubusercontent.com/u/71337066?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/yorickdowne",
      "html_url": "https://github.com/yorickdowne",
      "followers_url": "https://api.github.com/users/yorickdowne/followers",
      "following_url": "https://api.github.com/users/yorickdowne/following{/other_user}",
      "gists_url": "https://api.github.com/users/yorickdowne/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/yorickdowne/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/yorickdowne/subscriptions",
      "organizations_url": "https://api.github.com/users/yorickdowne/orgs",
      "repos_url": "https://api.github.com/users/yorickdowne/repos",
      "events_url": "https://api.github.com/users/yorickdowne/events{/privacy}",
      "received_events_url": "https://api.github.com/users/yorickdowne/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2023-09-12T16:50:06Z",
    "updated_at": "2023-09-12T16:51:03Z",
    "author_association": "NONE",
    "body": "> Regarding the key manager API startup, I see the log: Validator Api Configuration | Listen Address: 0.0.0.0, Port 7500, Allow: [*] in all the log snippets which means that the API has started correctly.\r\n\r\nDoes not actually, it has started up successfully when I see\r\n\r\n```\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:12.023 INFO  - Started ServerConnector@18b3b383{SSL, (ssl, http/1.1)}{0.0.0.0:7500}\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:12.024 INFO  - Started Server@55692aa{STARTING}[11.0.15,sto=0] @28122ms\r\neth-docker-devel-consensus-1  | 2023-09-12 12:29:12.025 INFO  - Listening on http://localhost:7500/\r\n```\r\n\r\nSo what I see in failure case is:\r\n- `Validator Api Configuration | Listen Address: 0.0.0.0, Port 7500, Allow: [*]`\r\n- No `Listening on http://localhost:7500/`\r\n- bearer token missing if it didn't exist\r\n- If bearer token already existed, in failure case API calls will fail because it never started `Listening`\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/1716094598/reactions",
      "total_count": 1,
      "+1": 1,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
