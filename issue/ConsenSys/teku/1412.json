{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/1412",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/1412/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/1412/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/1412/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/1412",
  "id": 584156399,
  "node_id": "MDU6SXNzdWU1ODQxNTYzOTk=",
  "number": 1412,
  "title": "Store ETH1 deposit event",
  "user": {
    "login": "arash009",
    "id": 33149995,
    "node_id": "MDQ6VXNlcjMzMTQ5OTk1",
    "avatar_url": "https://avatars.githubusercontent.com/u/33149995?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/arash009",
    "html_url": "https://github.com/arash009",
    "followers_url": "https://api.github.com/users/arash009/followers",
    "following_url": "https://api.github.com/users/arash009/following{/other_user}",
    "gists_url": "https://api.github.com/users/arash009/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/arash009/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/arash009/subscriptions",
    "organizations_url": "https://api.github.com/users/arash009/orgs",
    "repos_url": "https://api.github.com/users/arash009/repos",
    "events_url": "https://api.github.com/users/arash009/events{/privacy}",
    "received_events_url": "https://api.github.com/users/arash009/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1846512527,
      "node_id": "MDU6TGFiZWwxODQ2NTEyNTI3",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/TeamZiz",
      "name": "TeamZiz",
      "color": "fcf879",
      "default": false,
      "description": "Under active development by TeamZiz @PegaSys"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-03-19T04:36:51Z",
  "updated_at": "2020-06-09T00:04:20Z",
  "closed_at": "2020-06-09T00:04:20Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "As a user of Teku, \nI want the ETH1 deposit events to be written to disk, \nso that I can reload from disk instead of reprocessing it every time Teku starts, as it is more efficient.\n\n- Write the Merkle Tree and latest block processed number to disk",
  "closed_by": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/1412/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/1412/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/602898393",
    "html_url": "https://github.com/ConsenSys/teku/issues/1412#issuecomment-602898393",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/1412",
    "id": 602898393,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwMjg5ODM5Mw==",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-03-23T22:48:28Z",
    "updated_at": "2020-03-23T22:48:28Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Adrian Sutton:flag-au:  8:36 AM\n> We pull all the deposit events from the eth1 chain and they are gradually fed into the state, but as we process them we have to build up the merkle tree for them so we can provide the deposit count and deposit root when creating new blocks.\n> 8:37\n> Right now, everytime we startup we have to scan the entire eth1 chain for deposit events to reconstruct that merkle tree again.\n> \n> Paul Harris:flag-au:  8:37 AM\n> ah wow ok\n> \n> Adrian Sutton:flag-au:  8:37 AM\n> We want to store deposits in a way that makes rebuilding that merkle tree efficient on startup even as the number of deposits becomes extremely large.  That may mean storing the whole merkle tree.\n> Paul Harris:flag-au:  8:38 AM\n> and keeping it separate from the state...\n> 8:38\n> so how would it be accessed? is that a silly question?\n> 8:38\n> like can you access it at slot X or is that not a concept?\n> \n> Adrian Sutton:flag-au:  8:38 AM\n> No you’d literally be loading the whole thing at startup.\n> \n> Paul Harris:flag-au:  8:39 AM\n> but at a given point in time i cant effectively rewind, its just 'current' state\n> \n> Adrian Sutton:flag-au:  8:39 AM\n> So I think what you need to store is the merkle tree in some form, the list of deposits not yet included in finalized state and the eth1 block number that we have already retrieved deposits up to.\n> 8:40\n> Correct you can’t go backwards but you never need to.\n> \n> Paul Harris:flag-au:  8:40 AM\n> ok cool, and we've got the merkle tree now in memory?\n> \n> Adrian Sutton:flag-au:  8:40 AM\n> Well, that’s not entirely true.  Our merkle tree implementation is capable of calculating the root and proofs as if only a certain number of deposits are in the tree (so if we need to verify the root at deposit 100, but we already have up to deposit 200, we can do that efficiently).\n> 8:41\n> Yes, MerkleTree is the class that holds them.\n> 8:42\n> DepositProvider I think is the class you’d want to be able to store and re-hydrate.  It has the deposit merkle tree and the deposits which haven’t yet been included in a finalized state.\n> \n> Adrian Sutton:flag-au:  8:44 AM\n> We may also need to store and re-hydrate Eth1DataCache - it can rebuild itself from the eth1 chain fairly efficiently now but I think it requires more state history than most nodes store so may need to be reworked.\n> 8:45\n> I would probably ignore Eth1DataCache for now and get DepositProvider sorted then we can work it out.  Cem is the most knowledgable person in this area.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/602898393/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/607552290",
    "html_url": "https://github.com/ConsenSys/teku/issues/1412#issuecomment-607552290",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/1412",
    "id": 607552290,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwNzU1MjI5MA==",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-02T00:19:04Z",
    "updated_at": "2020-04-02T00:19:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "need to condense comment.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/607552290/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/608089502",
    "html_url": "https://github.com/ConsenSys/teku/issues/1412#issuecomment-608089502",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/1412",
    "id": 608089502,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYwODA4OTUwMg==",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-02T21:07:39Z",
    "updated_at": "2020-04-02T21:07:39Z",
    "author_association": "CONTRIBUTOR",
    "body": "- currently, every time teku starts, the entire eth1 chain is scanned for deposit events, to reconstruct the merkle tree\n- DepositProvider should be stored and re-hyrdated, it has the tree, and deposits which haven't been included in a finalized state\n- May also need to store and re-hydrate Eth1DataCache, it can rebuild itself from eth1 chain fairly efficiently, but probably currently requires more state history than most nodes will be storing, so may require rework.\n- Cem is the most knowledgable in this area (potentially eth1DataCache specifically, unsure)",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/608089502/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
