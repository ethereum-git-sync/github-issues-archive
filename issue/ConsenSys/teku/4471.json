{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/4471",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/4471/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/4471/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/4471/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/4471",
  "id": 1023098494,
  "node_id": "I_kwDOCM9I9M48-z5-",
  "number": 4471,
  "title": "--network=auto before vc subcommand",
  "user": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 5,
  "created_at": "2021-10-11T20:42:03Z",
  "updated_at": "2021-11-14T23:21:40Z",
  "closed_at": "2021-11-14T23:21:40Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\r\nThe `auto` option for `--network` is only supported for the validator client subcommand and is expected to become the only supported value in time.  Currently `teku vc --network=auto` works correctly but `teku --network=auto vc` still prints a deprecation warning to use `--network=auto` and defaults to `--network=mainnet`.\r\n\r\nIdeally the `--network` option wouldn't have been valid prior to the `vc` subcommand but given it is we want to avoid breaking backwards compatibility.  So likely have to find a way to support `teku --network=auto vc`.",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/4471/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/4471/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/940500966",
    "html_url": "https://github.com/ConsenSys/teku/issues/4471#issuecomment-940500966",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4471",
    "id": 940500966,
    "node_id": "IC_kwDOCM9I9M44Dufm",
    "user": {
      "login": "ermyas",
      "id": 3389851,
      "node_id": "MDQ6VXNlcjMzODk4NTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3389851?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ermyas",
      "html_url": "https://github.com/ermyas",
      "followers_url": "https://api.github.com/users/ermyas/followers",
      "following_url": "https://api.github.com/users/ermyas/following{/other_user}",
      "gists_url": "https://api.github.com/users/ermyas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ermyas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ermyas/subscriptions",
      "organizations_url": "https://api.github.com/users/ermyas/orgs",
      "repos_url": "https://api.github.com/users/ermyas/repos",
      "events_url": "https://api.github.com/users/ermyas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ermyas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-11T22:53:27Z",
    "updated_at": "2021-10-11T22:53:27Z",
    "author_association": "CONTRIBUTOR",
    "body": "hi @ajsutton - I can take this on if that is OK.\r\n\r\nI believe the issue here is that if an option is provided before the subcommand, PicoCli interprets it as an option given to the parent command and not the subcommand. So the `vc` subcommand currently sees the network option as empty and then defaults to using `mainnet`. Because of this, any network value provided before the subcommand is currently ignored e.g. `teku --network=prater vc` would use mainnet instead. \r\n\r\nThe easy fix to address the specific case you cited would have been to default to using `auto` whenever the `network` option of the subcommand is empty. But as discussed in #3530 this would break backward compatibility since the current expectation of users is that not specifying a network option defaults to mainnet. \r\n\r\nOne option is that we attempt to inherit the parent command's network option if the network option to the vc subcommand is empty. I imagine this is risky however since the user might have expectations that providing options before or after the subcommand is generally equivalent for other cases, and supporting this consistently sounds problematic. Note that this wouldn't work for subcommand specific options.\r\n\r\nPerhaps another option to consider is simply that we detect this scenario where a user provides the network option before the subcommand and print a help message about the correct usage of the option and exit. ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/940500966/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/940518827",
    "html_url": "https://github.com/ConsenSys/teku/issues/4471#issuecomment-940518827",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4471",
    "id": 940518827,
    "node_id": "IC_kwDOCM9I9M44Dy2r",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-11T23:36:06Z",
    "updated_at": "2021-10-11T23:36:06Z",
    "author_association": "CONTRIBUTOR",
    "body": "That would be great if you can.\r\n\r\nI think the first big question is what happened previously if you specified `teku --network=pyrmont vc` - if that still defaulted to `mainnet` then we don't really have a backwards compatibility concern as it never worked correctly.  In which case we could just check in the vc subcommand if the parent command `--network` option has been changed from the default and fail with an error as the user has very likely made an unintentional configuration error.\r\n\r\nThe second issue that's popped up from this is that specifying `network` in a configuration file used with the validator client subcommand doesn't seem to apply the change to the subcommand but only to the parent command. Again this may have always been a problem which would give us a bit more flexibility.\r\n\r\nI actually wonder if the right thing for the `--network` option is to just move to always using `auto` for the validator client. I can't think of any case where users would actually want to use a different network configuration to the beacon node as it won't work correctly.  But potentially this could be an issue with other options as well (eg --data-dir).\r\n\r\nSo basically I think there's a bunch of research to be done on this to work out what the right answer is.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/940518827/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/940600088",
    "html_url": "https://github.com/ConsenSys/teku/issues/4471#issuecomment-940600088",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4471",
    "id": 940600088,
    "node_id": "IC_kwDOCM9I9M44EGsY",
    "user": {
      "login": "ermyas",
      "id": 3389851,
      "node_id": "MDQ6VXNlcjMzODk4NTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3389851?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ermyas",
      "html_url": "https://github.com/ermyas",
      "followers_url": "https://api.github.com/users/ermyas/followers",
      "following_url": "https://api.github.com/users/ermyas/following{/other_user}",
      "gists_url": "https://api.github.com/users/ermyas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ermyas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ermyas/subscriptions",
      "organizations_url": "https://api.github.com/users/ermyas/orgs",
      "repos_url": "https://api.github.com/users/ermyas/repos",
      "events_url": "https://api.github.com/users/ermyas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ermyas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-12T02:26:44Z",
    "updated_at": "2021-10-12T02:26:44Z",
    "author_association": "CONTRIBUTOR",
    "body": "> I think the first big question is what happened previously if you specified `teku --network=pyrmont vc` - if that still defaulted to `mainnet` then we don't really have a backwards compatibility concern as it never worked correctly.\r\n\r\nYes, I checked, the behaviour was the same prior to the change (#4324) i.e. the network option would be ignored by the vc subcommand if specified before the subcommand.\r\n\r\n> The second issue that's popped up from this is that specifying `network` in a configuration file used with the validator client subcommand doesn't seem to apply the change to the subcommand but only to the parent command. Again this may have always been a problem which would give us a bit more flexibility.\r\n\r\nI might be missing something on this one. Providing the network in a config file for the vc sub-command seems to work fine for me (whether specified before or after the subcommand and when using `auto` as an option value or something else). \r\n\r\n> I actually wonder if the right thing for the `--network` option is to just move to always using `auto` for the validator client.\r\n\r\nRight, I believe this was already in the gradual 3-step transition plan you outlined for this [here](https://github.com/ConsenSys/teku/issues/3530#issuecomment-913242211)? We opted not to make \"auto\" the default right away because of backward compatibility reasons but planned to eventually do so as a second step and then finally remove the `network` option for `vc` altogether. As you noted, perhaps a scenario in which a user might want to specify different network configurations than the beacon node's probably doesn't make sense, so accommodating this for the sake of backward compatibility might not be worthwhile. I will look into the potential impact of this. \r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/940600088/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/940604018",
    "html_url": "https://github.com/ConsenSys/teku/issues/4471#issuecomment-940604018",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4471",
    "id": 940604018,
    "node_id": "IC_kwDOCM9I9M44EHpy",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-10-12T02:37:59Z",
    "updated_at": "2021-10-12T02:37:59Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Yes, I checked, the behaviour was the same prior to the change (#4324) i.e. the network option would be ignored by the vc subcommand if specified before the subcommand.\r\n\r\nOk that's good that we didn't unexpectedly make things worse.\r\n\r\n> I might be missing something on this one. Providing the network in a config file for the vc sub-command seems to work fine for me (whether specified before or after the subcommand and when using `auto` as an option value or something else).\r\n\r\nHmm, interesting. The user that reported this on discord said they were seeing this problem when using a config file - I haven't actually double checked that myself.  We could probably write a unit test by extending `AbstractBeaconNodeCommandTest` to prove how the different scenarios work in terms of the resulting config.\r\n\r\n> Right, I believe this was already in the gradual 3-step transition plan you outlined for this [here](https://github.com/ConsenSys/teku/issues/3530#issuecomment-913242211)? We opted not to make \"auto\" the default right away because of backward compatibility reasons but planned to eventually do so as a second step and then finally remove the `network` option for `vc` altogether. As you noted, perhaps a scenario in which a user might want to specify different network configurations than the beacon node's probably doesn't make sense, so accommodating this for the sake of backward compatibility might not be worthwhile. I will look into the potential impact of this.\r\n\r\nYep exactly.  I think taking the next step now of defaulting to `auto` makes sense.  It will be a fair while before we can remove the `--network` option though as I think teku then won't start because of the unrecognised command (if it's after the `vc`).",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/940604018/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/967566093",
    "html_url": "https://github.com/ConsenSys/teku/issues/4471#issuecomment-967566093",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/4471",
    "id": 967566093,
    "node_id": "IC_kwDOCM9I9M45q-MN",
    "user": {
      "login": "ermyas",
      "id": 3389851,
      "node_id": "MDQ6VXNlcjMzODk4NTE=",
      "avatar_url": "https://avatars.githubusercontent.com/u/3389851?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ermyas",
      "html_url": "https://github.com/ermyas",
      "followers_url": "https://api.github.com/users/ermyas/followers",
      "following_url": "https://api.github.com/users/ermyas/following{/other_user}",
      "gists_url": "https://api.github.com/users/ermyas/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ermyas/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ermyas/subscriptions",
      "organizations_url": "https://api.github.com/users/ermyas/orgs",
      "repos_url": "https://api.github.com/users/ermyas/repos",
      "events_url": "https://api.github.com/users/ermyas/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ermyas/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-11-12T21:12:25Z",
    "updated_at": "2021-11-12T21:12:25Z",
    "author_association": "CONTRIBUTOR",
    "body": "Apologies for the delay on this @ajsutton. I got tied up with a few things. I've submitted PR #4629",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/967566093/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
