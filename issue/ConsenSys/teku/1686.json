{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/1686",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/1686/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/1686/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/1686/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/1686",
  "id": 608264459,
  "node_id": "MDU6SXNzdWU2MDgyNjQ0NTk=",
  "number": 1686,
  "title": "[bug/fuzzing] Incorrect validation of pre-state attestation & malformed block signature during state transition (teku)",
  "user": {
    "login": "pventuzelo",
    "id": 9038181,
    "node_id": "MDQ6VXNlcjkwMzgxODE=",
    "avatar_url": "https://avatars.githubusercontent.com/u/9038181?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/pventuzelo",
    "html_url": "https://github.com/pventuzelo",
    "followers_url": "https://api.github.com/users/pventuzelo/followers",
    "following_url": "https://api.github.com/users/pventuzelo/following{/other_user}",
    "gists_url": "https://api.github.com/users/pventuzelo/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/pventuzelo/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/pventuzelo/subscriptions",
    "organizations_url": "https://api.github.com/users/pventuzelo/orgs",
    "repos_url": "https://api.github.com/users/pventuzelo/repos",
    "events_url": "https://api.github.com/users/pventuzelo/events{/privacy}",
    "received_events_url": "https://api.github.com/users/pventuzelo/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-04-28T12:06:14Z",
  "updated_at": "2020-05-04T22:39:17Z",
  "closed_at": "2020-05-04T22:39:17Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Hi guys, \r\n\r\nAfter fuzzing with [beacon-fuzz](https://github.com/sigp/beacon-fuzz), we found an issue in prysm and I reported it here:\r\n[[bug/fuzzing] Incorrect validation of pre-state attestation & malformed block signature during state transition](https://github.com/prysmaticlabs/prysm/issues/5658).\r\n\r\nDownload: [incorrect_ssz_validation_prysm.zip](https://github.com/PegaSysEng/teku/files/4545575/incorrect_ssz_validation_prysm.zip)\r\n\r\n\r\nBased on testing with `teku`, you also have the same issues:\r\n``` sh\r\n# install\r\n$  ./gradlew distTar installDist\r\n\r\n# go to build folder\r\n$ cd build/install/\r\n\r\n$ ./bin/teku transition blocks --pre=incorrect_ssz_validation_state_prysm.ssz  --network=mainnet incorrect_ssz_validation_block_prysm.ssz\r\n...\r\n# process continued without any errors\r\n```\r\n\r\n### Versions\r\n\r\n* Github branch: `master`\r\n* Github commit: 1cc346671521a4381776bb9145af1be3b290fe8b\r\n* Java version: `openjdk version \"11.0.7\" 2020-04-14`\r\n* OS Name & Version: `Ubuntu 18.04.4 LTS`\r\n* Kernel Version: `4.15.0-96-generic`\r\n",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/1686/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/1686/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/620984442",
    "html_url": "https://github.com/ConsenSys/teku/issues/1686#issuecomment-620984442",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/1686",
    "id": 620984442,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMDk4NDQ0Mg==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-04-29T04:38:22Z",
    "updated_at": "2020-04-29T04:38:22Z",
    "author_association": "CONTRIBUTOR",
    "body": "With #1693 in place we reject the block because the attestation aggregation bits are the wrong size.\r\n\r\nAs far as I can tell we consider the signature invalid.  We are currently only checking the signature after processing the state and the block is about 1970324836982784 slots in the future so we take forever trying to process slots to get the pre state.  It may make sense to perform that check earlier to avoid doing a lot of work for a block that wasn't even from a real validator - the impact is significantly reduced normally though because the block can't be ahead of the current slot so definitely won't be that many slots in the future.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/620984442/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/623745001",
    "html_url": "https://github.com/ConsenSys/teku/issues/1686#issuecomment-623745001",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/1686",
    "id": 623745001,
    "node_id": "MDEyOklzc3VlQ29tbWVudDYyMzc0NTAwMQ==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-05-04T22:39:17Z",
    "updated_at": "2020-05-04T22:39:17Z",
    "author_association": "CONTRIBUTOR",
    "body": "I'm confident that if you waited long enough for Teku to process all those empty slots, it would then validate the signature and reject the block.\r\n\r\nAdditionally, in the full Teku setup the block would have to be between the last finalised slot and the current slot so we wouldn't have tried to process the empty slots for this block and would have wound up discarding the block because it's too far in the future.\r\n\r\nSo now that #1693 is merged, I'm going to consider this fixed and close the issue.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/623745001/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
