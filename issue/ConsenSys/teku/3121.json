{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/3121",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/3121/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/3121/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/3121/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/3121",
  "id": 734183890,
  "node_id": "MDU6SXNzdWU3MzQxODM4OTA=",
  "number": 3121,
  "title": "TLS connection to external signer",
  "user": {
    "login": "jframe",
    "id": 909467,
    "node_id": "MDQ6VXNlcjkwOTQ2Nw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/909467?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/jframe",
    "html_url": "https://github.com/jframe",
    "followers_url": "https://api.github.com/users/jframe/followers",
    "following_url": "https://api.github.com/users/jframe/following{/other_user}",
    "gists_url": "https://api.github.com/users/jframe/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/jframe/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/jframe/subscriptions",
    "organizations_url": "https://api.github.com/users/jframe/orgs",
    "repos_url": "https://api.github.com/users/jframe/repos",
    "events_url": "https://api.github.com/users/jframe/events{/privacy}",
    "received_events_url": "https://api.github.com/users/jframe/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [
    {
      "id": 1846450568,
      "node_id": "MDU6TGFiZWwxODQ2NDUwNTY4",
      "url": "https://api.github.com/repos/ConsenSys/teku/labels/TeamGroot",
      "name": "TeamGroot",
      "color": "1d76db",
      "default": false,
      "description": "Under active development by TeamGroot @PegaSys"
    }
  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "usmansaleem",
    "id": 669527,
    "node_id": "MDQ6VXNlcjY2OTUyNw==",
    "avatar_url": "https://avatars.githubusercontent.com/u/669527?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/usmansaleem",
    "html_url": "https://github.com/usmansaleem",
    "followers_url": "https://api.github.com/users/usmansaleem/followers",
    "following_url": "https://api.github.com/users/usmansaleem/following{/other_user}",
    "gists_url": "https://api.github.com/users/usmansaleem/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/usmansaleem/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/usmansaleem/subscriptions",
    "organizations_url": "https://api.github.com/users/usmansaleem/orgs",
    "repos_url": "https://api.github.com/users/usmansaleem/repos",
    "events_url": "https://api.github.com/users/usmansaleem/events{/privacy}",
    "received_events_url": "https://api.github.com/users/usmansaleem/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "usmansaleem",
      "id": 669527,
      "node_id": "MDQ6VXNlcjY2OTUyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/669527?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/usmansaleem",
      "html_url": "https://github.com/usmansaleem",
      "followers_url": "https://api.github.com/users/usmansaleem/followers",
      "following_url": "https://api.github.com/users/usmansaleem/following{/other_user}",
      "gists_url": "https://api.github.com/users/usmansaleem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/usmansaleem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/usmansaleem/subscriptions",
      "organizations_url": "https://api.github.com/users/usmansaleem/orgs",
      "repos_url": "https://api.github.com/users/usmansaleem/repos",
      "events_url": "https://api.github.com/users/usmansaleem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/usmansaleem/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2020-11-02T05:08:14Z",
  "updated_at": "2022-03-22T06:51:31Z",
  "closed_at": "2021-01-03T21:20:11Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "<!-- Have you done the following? -->\n<!--   * read the Code of Conduct? By filing an Issue, you are expected to -->  \n<!--     comply with it, including treating everyone with respect: -->\n<!--     https://github.com/PegasysEng/teku/blob/master/CODE-OF-CONDUCT.md -->\n<!--   * Reproduced the issue in the latest version of the software -->\n<!--   * Read the debugging wiki: https://github.com/PegasysEng/teku/wiki/debugging -->\n<!--   * Duplicate Issue check:  https://github.com/search?q=+is%3Aissue+repo%3APegasysEng/Teku -->\n<!-- Note:  Not all sections will apply to all issue types. -->\n\n### Description\nAs a user, I want a TLS connection to the external signer so that signing data can be sent securely to the signer.\n\n### Acceptance Criteria\n* Allow TLS to be used for the external signer\n* TLS client authentication of the external signer",
  "closed_by": {
    "login": "bgravenorst",
    "id": 50852695,
    "node_id": "MDQ6VXNlcjUwODUyNjk1",
    "avatar_url": "https://avatars.githubusercontent.com/u/50852695?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/bgravenorst",
    "html_url": "https://github.com/bgravenorst",
    "followers_url": "https://api.github.com/users/bgravenorst/followers",
    "following_url": "https://api.github.com/users/bgravenorst/following{/other_user}",
    "gists_url": "https://api.github.com/users/bgravenorst/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/bgravenorst/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/bgravenorst/subscriptions",
    "organizations_url": "https://api.github.com/users/bgravenorst/orgs",
    "repos_url": "https://api.github.com/users/bgravenorst/repos",
    "events_url": "https://api.github.com/users/bgravenorst/events{/privacy}",
    "received_events_url": "https://api.github.com/users/bgravenorst/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/3121/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/3121/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/729433799",
    "html_url": "https://github.com/ConsenSys/teku/issues/3121#issuecomment-729433799",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3121",
    "id": 729433799,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcyOTQzMzc5OQ==",
    "user": {
      "login": "usmansaleem",
      "id": 669527,
      "node_id": "MDQ6VXNlcjY2OTUyNw==",
      "avatar_url": "https://avatars.githubusercontent.com/u/669527?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/usmansaleem",
      "html_url": "https://github.com/usmansaleem",
      "followers_url": "https://api.github.com/users/usmansaleem/followers",
      "following_url": "https://api.github.com/users/usmansaleem/following{/other_user}",
      "gists_url": "https://api.github.com/users/usmansaleem/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/usmansaleem/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/usmansaleem/subscriptions",
      "organizations_url": "https://api.github.com/users/usmansaleem/orgs",
      "repos_url": "https://api.github.com/users/usmansaleem/repos",
      "events_url": "https://api.github.com/users/usmansaleem/events{/privacy}",
      "received_events_url": "https://api.github.com/users/usmansaleem/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-11-18T05:16:45Z",
    "updated_at": "2020-11-18T05:16:45Z",
    "author_association": "CONTRIBUTOR",
    "body": "# Creating Self Signed PKCS12 keystores and trust stores for Teku and Web3Signer\r\n\r\nFollowing examples use keytool utility which is available with JDK installation. OpenSSL can also be used to achieve similar results.\r\n\r\n## KeyStores\r\n### For Web3Signer (Server)\r\nWeb3Signer uses a PKCS12 keystore. Following command can be used to generate a self-signed private key/certificate pair.\r\n~~~\r\nkeytool -genkeypair -keystore web3signer_keystore.p12 -storetype PKCS12 -storepass changeit -alias web3signer -keyalg RSA -keysize 2048 -validity 109500 -dname \"CN=localhost, OU=PegaSys, O=ConsenSys, L=Brisbane, ST=QLD, C=AU\" -ext san=dns:localhost,ip:127.0.0.1\r\n~~~\r\nThe CN is usually the fully qualified hostname of Web3Signer. In addition, san extension can be used to change and/or add additional hostnames and/or IP address if required. For example:\r\n`-ext san=dns:localhost,dns:serverHostName,ip:10.0.0.2,ip:127.0.0.1`\r\nThis will allow the same certificate to be used for more than one hostname/IP address specially if web3signer is running on a different machine than Teku with multiple hostnames.\r\n\r\n### For Teku (Client)\r\nTeku can use either PKCS12 or JKS keystore type. PKCS12 is recommended. This is the certificate that Teku will present to Web3Signer for TLS mutual authentication. If Web3Signer doesn’t recognize this certificate’s signature, it will reject the connection. Following command can be used to generate a self-signed private key/certificate pair.\r\n\r\n~~~\r\nkeytool -genkeypair -keystore teku_client_keystore.p12 -storetype PKCS12 -storepass changeit -alias teku_client -keyalg RSA -keysize 2048 -validity 109500 -dname \"CN=teku, OU=PegaSys, O=ConsenSys, L=Brisbane, ST=QLD, C=AU\"\r\n~~~\r\n\r\nThe CN doesn’t have to be the hostname for Teku as a client. However, it must be a lowercase value, such as “`CN=teku,`” as shown in above example.\r\n\r\n## Trust Stores\r\nTrust stores are required to trust the certificates of the other party for TLS mutual authentication.\r\n\r\n### Create TrustStore For Teku (to trust Web3Signer certificate)\r\nTeku can use a PKCS12 (or JKS) keystore to trust web3signer certificate. This keystore is referred to as a truststore since it only contains trusted certificate entry. It is a two step process to create it. \r\n\r\n* Export public certificate\r\nFirst, export public certificate (to PEM format) from web3signer keystore:\r\n`keytool -exportcert -keystore ./web3signer_keystore.p12 -alias web3signer -rfc -file web3signer.pem`\r\n\r\n* Import into Truststore\r\nSecond, import the public certificate into a truststore that will be used by Teku\r\n`keytool -importcert -storetype PKCS12 -keystore web3signer_truststore.p12 -alias web3signer -trustcacerts -storepass changeit -file ./web3signer.pem`\r\n\r\n### Create Known Clients File for Web3Signer (to trust Teku certificate)\r\nWeb3Signer uses a known clients file to trust client certificates i.e. Teku. Use keytool to obtain common name and SHA signature:\r\n~~~\r\nkeytool -list -v -keystore teku_client_keystore.p12\r\n~~~\r\nTake a note of:\r\n~~~\r\nCN=teku\r\nSHA256: 67:89:C8:95:70:E0:38:10:2F:AB:7E:A3:75:4A:8C:29:C1:64:52:37:E5:E9:CD:EF:CD:27:C2:88:BF:84:3A:A1\r\n~~~\r\nCreate a file called `knownClients.txt` with following contents (CN and signature, space separated on one line):\r\n~~~\r\nteku 67:89:C8:95:70:E0:38:10:2F:AB:7E:A3:75:4A:8C:29:C1:64:52:37:E5:E9:CD:EF:CD:27:C2:88:BF:84:3A:A1\r\n~~~",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/729433799/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
