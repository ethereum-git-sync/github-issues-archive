{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/5718",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/5718/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/5718/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/5718/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/5718",
  "id": 1262560453,
  "node_id": "I_kwDOCM9I9M5LQSTF",
  "number": 5718,
  "title": "Make distribution artefacts fully reproducible",
  "user": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 1,
  "created_at": "2022-06-07T00:04:42Z",
  "updated_at": "2022-06-30T03:13:37Z",
  "closed_at": "2022-06-30T03:13:37Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "### Description\nUpdate the build process so that distribution artefacts created from the same git commit will have exactly the same contents (ie same sha256 checksum for the .tar.gz and .zip files generated).\n\nMost of the Teku build process is already deterministic - the only differences currently are:\n\n1. The license plugin includes the timestamp the report was generated at. This needs to be removed, likely be overriding the template.\n2. The archives need to use reproducible file order (can set an option in gradle)\n3. The archives include the file timestamps which are set based on the current system time.\n\n2 and 3 can both be solved with gradle options:\n```\n──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\nmodified: build.gradle\n──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────\n@ build.gradle:143 @ allprojects {\n    }\n  }\n\n  tasks.withType(Jar).configureEach {\n    Jar jar ->\n      jar.preserveFileTimestamps = false\n      jar.reproducibleFileOrder = true\n  }\n\n  tasks.withType(JavaCompile) {\n    options.compilerArgs += [\n      '-Xlint:unchecked',\n@ build.gradle:392 @ distTar {\n  }\n  compression = Compression.GZIP\n  archiveExtension = 'tar.gz'\n  preserveFileTimestamps = false\n  reproducibleFileOrder = true\n}\n\ndistZip {\n@ build.gradle:401 @ distZip {\n  doFirst {\n    delete fileTree(dir: 'build/distributions', include: '*.zip')\n  }\n  preserveFileTimestamps = false\n  reproducibleFileOrder = true\n}\n```\n\nHowever, disabling `preserveFileTimestamps` means the timestamps are committed and all files wind up with a timestamp of 1 Feb 1980 (at least with Mac unzip) which will potentially cause issues.  A better approach may be to have a task iterate through all files to be included in the archive and set their modification time to the timestamp of the git commit being built, and leave `preserveFileTimestamps` enabled.",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/5718/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/5718/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1148059390",
    "html_url": "https://github.com/ConsenSys/teku/issues/5718#issuecomment-1148059390",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/5718",
    "id": 1148059390,
    "node_id": "IC_kwDOCM9I9M5Ebf7-",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2022-06-07T00:17:15Z",
    "updated_at": "2022-06-07T00:17:15Z",
    "author_association": "CONTRIBUTOR",
    "body": "https://reproducible-builds.org has a heap of info on achieving this (not sure how much gradle specific stuff is there though)",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/1148059390/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
