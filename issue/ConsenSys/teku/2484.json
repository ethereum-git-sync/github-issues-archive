{
  "url": "https://api.github.com/repos/Consensys/teku/issues/2484",
  "repository_url": "https://api.github.com/repos/Consensys/teku",
  "labels_url": "https://api.github.com/repos/Consensys/teku/issues/2484/labels{/name}",
  "comments_url": "https://api.github.com/repos/Consensys/teku/issues/2484/comments",
  "events_url": "https://api.github.com/repos/Consensys/teku/issues/2484/events",
  "html_url": "https://github.com/Consensys/teku/issues/2484",
  "id": 669298647,
  "node_id": "MDU6SXNzdWU2NjkyOTg2NDc=",
  "number": 2484,
  "title": "fetching block by range isn't 100% right...",
  "user": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 2,
  "created_at": "2020-07-31T00:25:35Z",
  "updated_at": "2023-12-05T08:42:50Z",
  "closed_at": "2023-12-05T08:42:50Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "when a peer requests more than 200 blocks in a range, we limit the range to 200.\n\nThis is probably usually ok, but there's a potential edge case, because we need to return at least 1 block.\n\nIt's possible that the first 200 blocks in the requested range don't exist, but there's a block further into the range that does, so we should really be searching past that 200 if required, so that we can return the first block we have, as we're supposed to return at least 1 block in the response if we have any.\n\nie. if we request 1024 blocks (max), and only block 1024 of that range is one that we have , we are expected to send back that block.",
  "closed_by": {
    "login": "benjaminion",
    "id": 20796281,
    "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
    "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/benjaminion",
    "html_url": "https://github.com/benjaminion",
    "followers_url": "https://api.github.com/users/benjaminion/followers",
    "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
    "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
    "organizations_url": "https://api.github.com/users/benjaminion/orgs",
    "repos_url": "https://api.github.com/users/benjaminion/repos",
    "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
    "received_events_url": "https://api.github.com/users/benjaminion/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/Consensys/teku/issues/2484/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/Consensys/teku/issues/2484/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/912933120",
    "html_url": "https://github.com/Consensys/teku/issues/2484#issuecomment-912933120",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/2484",
    "id": 912933120,
    "node_id": "IC_kwDOCM9I9M42akEA",
    "user": {
      "login": "seroze",
      "id": 87276744,
      "node_id": "MDQ6VXNlcjg3Mjc2NzQ0",
      "avatar_url": "https://avatars.githubusercontent.com/u/87276744?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/seroze",
      "html_url": "https://github.com/seroze",
      "followers_url": "https://api.github.com/users/seroze/followers",
      "following_url": "https://api.github.com/users/seroze/following{/other_user}",
      "gists_url": "https://api.github.com/users/seroze/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/seroze/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/seroze/subscriptions",
      "organizations_url": "https://api.github.com/users/seroze/orgs",
      "repos_url": "https://api.github.com/users/seroze/repos",
      "events_url": "https://api.github.com/users/seroze/events{/privacy}",
      "received_events_url": "https://api.github.com/users/seroze/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-04T08:19:54Z",
    "updated_at": "2021-09-04T08:19:54Z",
    "author_association": "CONTRIBUTOR",
    "body": "@rolfyone   is this issue still open. \r\ncan you point to the class where this is happening. \r\n\r\nthis seems like pagination hasn't been implemented properly with pageSize = 200 (max). \r\n\r\n",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/912933120/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/Consensys/teku/issues/comments/913236878",
    "html_url": "https://github.com/Consensys/teku/issues/2484#issuecomment-913236878",
    "issue_url": "https://api.github.com/repos/Consensys/teku/issues/2484",
    "id": 913236878,
    "node_id": "IC_kwDOCM9I9M42buOO",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2021-09-05T22:18:24Z",
    "updated_at": "2021-09-05T22:18:24Z",
    "author_association": "CONTRIBUTOR",
    "body": "> @rolfyone is this issue still open.\r\n> can you point to the class where this is happening.\r\n\r\nThis is in `BeaconBlocksByRangeMessageHandler`.\r\n\r\n> this seems like pagination hasn't been implemented properly with pageSize = 200 (max).\r\n\r\nNot exactly - it's more that we're limiting the size of the range we allow to be requested up front rather than limiting the number of slots we search after the first block.  But finding that first block is hard because the request might have a skip value greater than 1 (ie asking for every 10th block). We can efficiently find the next entry in the database but could wind up having to scan huge sections of the db to find the first block.\r\n\r\nOther clients just reject requests outright if they span too many slots.  So my suggestion would be to track when we limit the number of blocks we'll search for and whether we found a block. If we hit the restricted limit without finding a block, return an error code rejecting the request.  We wouldn't return an error if we found a block, or if we searched every requested slot, even if they were all empty.\r\n\r\nSo:\r\n\r\n * Request slots 1-1000, and we find no blocks in the slots we check (1-201) - return an error response\r\n * Request slots 1-201 and we find no blocks after checking them all - no error (and no response to confirm all slots were empty)\r\n * Request slots 1-1000, and we do find a block - return the blocks we find with no error\r\n * Request slots 1-201 and we find some blocks after checking them all - return the bocks we found with no error",
    "reactions": {
      "url": "https://api.github.com/repos/Consensys/teku/issues/comments/913236878/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
