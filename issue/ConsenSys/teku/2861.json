{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/2861",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/2861/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/2861/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/2861/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/2861",
  "id": 710131325,
  "node_id": "MDU6SXNzdWU3MTAxMzEzMjU=",
  "number": 2861,
  "title": "Teku does not catch up to head again",
  "user": {
    "login": "dankrad",
    "id": 6130607,
    "node_id": "MDQ6VXNlcjYxMzA2MDc=",
    "avatar_url": "https://avatars.githubusercontent.com/u/6130607?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/dankrad",
    "html_url": "https://github.com/dankrad",
    "followers_url": "https://api.github.com/users/dankrad/followers",
    "following_url": "https://api.github.com/users/dankrad/following{/other_user}",
    "gists_url": "https://api.github.com/users/dankrad/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/dankrad/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/dankrad/subscriptions",
    "organizations_url": "https://api.github.com/users/dankrad/orgs",
    "repos_url": "https://api.github.com/users/dankrad/repos",
    "events_url": "https://api.github.com/users/dankrad/events{/privacy}",
    "received_events_url": "https://api.github.com/users/dankrad/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": null,
  "assignees": [

  ],
  "milestone": null,
  "comments": 3,
  "created_at": "2020-09-28T10:10:58Z",
  "updated_at": "2020-10-06T10:32:31Z",
  "closed_at": "2020-10-06T10:32:31Z",
  "author_association": "NONE",
  "active_lock_reason": null,
  "body": "Woke up today to see that teku has stopped signing attestations. At some point it seems to have failed syncing to the chain, reason is unknown (network seems to be good, nothing in the logs). After that, it simply was stuck there and never caught up to the head again, until the client was restarted. Peer count was constantly >70.\r\n\r\n### Description\r\nWhatever the root cause of falling behind was (it may be a short network outage of some minutes, happens quite regularly here), I would expect that the client manages to detect this condition and catch up again.\r\n\r\n### Acceptance Criteria\r\n\r\n### Steps to Reproduce (Bug)\r\nUnfortunately I do not know what caused it in the first place, there is nothing in the logs about the trigger.\r\n\r\n### Versions (Add all that apply)\r\n* Software version: teku/v0.12.4-dev-93d6ef0a/linux-x86_64/-ubuntu-openjdk64bitservervm-java-11\r\n* Java version: openjdk version \"11.0.8\" 2020-07-14\r\n* OS Name & Version: Ubuntu 20.04.1 LTS\r\n* Kernel Version: Linux pascal 5.4.0-48-generic #52-Ubuntu SMP Thu Sep 10 10:58:49 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux\r\n* Virtual Machine software & version: -\r\n* Docker Version: -\r\n* Cloud VM, type, size: -\r\n[teku.log.zip](https://github.com/PegaSysEng/teku/files/5291479/teku.log.zip)\r\n\r\n\r\n\r\n### Additional Information\r\n",
  "closed_by": {
    "login": "ajsutton",
    "id": 72675,
    "node_id": "MDQ6VXNlcjcyNjc1",
    "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/ajsutton",
    "html_url": "https://github.com/ajsutton",
    "followers_url": "https://api.github.com/users/ajsutton/followers",
    "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
    "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
    "organizations_url": "https://api.github.com/users/ajsutton/orgs",
    "repos_url": "https://api.github.com/users/ajsutton/repos",
    "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
    "received_events_url": "https://api.github.com/users/ajsutton/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/2861/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/2861/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/699917003",
    "html_url": "https://github.com/ConsenSys/teku/issues/2861#issuecomment-699917003",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2861",
    "id": 699917003,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5OTkxNzAwMw==",
    "user": {
      "login": "dankrad",
      "id": 6130607,
      "node_id": "MDQ6VXNlcjYxMzA2MDc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/6130607?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/dankrad",
      "html_url": "https://github.com/dankrad",
      "followers_url": "https://api.github.com/users/dankrad/followers",
      "following_url": "https://api.github.com/users/dankrad/following{/other_user}",
      "gists_url": "https://api.github.com/users/dankrad/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/dankrad/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/dankrad/subscriptions",
      "organizations_url": "https://api.github.com/users/dankrad/orgs",
      "repos_url": "https://api.github.com/users/dankrad/repos",
      "events_url": "https://api.github.com/users/dankrad/events{/privacy}",
      "received_events_url": "https://api.github.com/users/dankrad/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-28T10:16:04Z",
    "updated_at": "2020-09-28T10:16:04Z",
    "author_association": "NONE",
    "body": "Oh it appears that the exception is in the detailed logs:\r\n\r\n```\r\n[tekulog2.zip](https://github.com/PegaSysEng/teku/files/5291500/tekulog2.zip)\r\n\r\n2020-09-28 07:20:58.443+01:00 | forkchoice-0 | WARN  | BlockProcessorUtil | process_block_header: Verify that proposer index is the correct index\r\n2020-09-28 07:20:58.443+01:00 | forkchoice-0 | WARN  | StateTransition | State Transition error\r\ntech.pegasys.teku.core.exceptions.BlockProcessingException: java.lang.IllegalArgumentException: process_block_header: Verify that proposer index is the correct index\r\n\tat tech.pegasys.teku.core.BlockProcessorUtil.process_block_header(BlockProcessorUtil.java:117) ~[teku-ethereum-core-0.12.4-SNAPSHOT.jar:0.12.4-dev-93d6ef0a]\r\n\tat tech.pegasys.teku.core.StateTransition.lambda$process_block$2(StateTransition.java:142) ~[teku-ethereum-core-0.12.4-SNAPSHOT.jar:0.12.4-dev-93d6ef0a]\r\n\tat tech.pegasys.teku.datastructures.state.BeaconStateImpl.updated(BeaconStateImpl.java:247) ~[teku-ethereum-datastructures-0.12.4-SNAPSHOT.jar:0.12.4-dev-93d6ef0a]\r\n\tat tech.pegasys.teku.core.StateTransition.process_block(StateTransition.java:140) ~[teku-ethereum-core-0.12.4-SNAPSHOT.jar:0.12.4-dev-93d6ef0a]\r\n\tat tech.pegasys.teku.core.StateTransition.initiate(StateTransition.java:110) ~[teku-ethereum-core-0.12.4-SNAPSHOT.jar:0.12.4-dev-93d6ef0a]\r\n\tat tech.pegasys.teku.core.ForkChoiceUtil.on_block(ForkChoiceUtil.java:234) ~[teku-ethereum-core-0.12.4-SNAPSHOT.jar:0.12.4-dev-93d6ef0a]\r\n\tat tech.pegasys.teku.statetransition.forkchoice.ForkChoice.lambda$onBlock$7(ForkChoice.java:122) ~[teku-ethereum-statetransition-0.12.4-SNAPSHOT.jar:0.12.4-dev-93d6ef0a]\r\n\tat tech.pegasys.teku.statetransition.forkchoice.SingleThreadedForkChoiceExecutor.lambda$syncPerformTask$1(SingleThreadedForkChoiceExecutor.java:77) ~[teku-ethereum-statetransition-0.12.4-SNAPSHOT.jar:0.12.4-dev-93d6ef0a]\r\n\tat tech.pegasys.teku.infrastructure.async.SafeFuture.of(SafeFuture.java:76) ~[teku-infrastructure-async-0.12.4-SNAPSHOT.jar:0.12.4-dev-93d6ef0a]\r\n\tat tech.pegasys.teku.statetransition.forkchoice.SingleThreadedForkChoiceExecutor.syncPerformTask(SingleThreadedForkChoiceExecutor.java:77) ~[teku-ethereum-statetransition-0.12.4-SNAPSHOT.jar:0.12.4-dev-93d6ef0a]\r\n\tat tech.pegasys.teku.statetransition.forkchoice.SingleThreadedForkChoiceExecutor.lambda$performTask$0(SingleThreadedForkChoiceExecutor.java:58) ~[teku-ethereum-statetransition-0.12.4-SNAPSHOT.jar:0.12.4-dev-93d6ef0a]\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\r\n\tat java.lang.Thread.run(Thread.java:834) [?:?]\r\nCaused by: java.lang.IllegalArgumentException: process_block_header: Verify that proposer index is the correct index\r\n\tat com.google.common.base.Preconditions.checkArgument(Preconditions.java:142) ~[guava-29.0-jre.jar:?]\r\n\tat tech.pegasys.teku.core.BlockProcessorUtil.process_block_header(BlockProcessorUtil.java:91) ~[teku-ethereum-core-0.12.4-SNAPSHOT.jar:0.12.4-dev-93d6ef0a]\r\n\t... 13 more\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/699917003/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/699955375",
    "html_url": "https://github.com/ConsenSys/teku/issues/2861#issuecomment-699955375",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2861",
    "id": 699955375,
    "node_id": "MDEyOklzc3VlQ29tbWVudDY5OTk1NTM3NQ==",
    "user": {
      "login": "benjaminion",
      "id": 20796281,
      "node_id": "MDQ6VXNlcjIwNzk2Mjgx",
      "avatar_url": "https://avatars.githubusercontent.com/u/20796281?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/benjaminion",
      "html_url": "https://github.com/benjaminion",
      "followers_url": "https://api.github.com/users/benjaminion/followers",
      "following_url": "https://api.github.com/users/benjaminion/following{/other_user}",
      "gists_url": "https://api.github.com/users/benjaminion/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/benjaminion/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/benjaminion/subscriptions",
      "organizations_url": "https://api.github.com/users/benjaminion/orgs",
      "repos_url": "https://api.github.com/users/benjaminion/repos",
      "events_url": "https://api.github.com/users/benjaminion/events{/privacy}",
      "received_events_url": "https://api.github.com/users/benjaminion/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-09-28T11:43:33Z",
    "updated_at": "2020-09-28T11:43:33Z",
    "author_association": "CONTRIBUTOR",
    "body": "> Software version: teku/v0.12.4-dev-93d6ef0a/linux-x86_64/-ubuntu-openjdk64bitservervm-java-11\r\n\r\nThis version is over a month old and it is likely that this issue has been addressed in the meanwhile. Could you please try updating to the latest and seeing how it goes?",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/699955375/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/704180466",
    "html_url": "https://github.com/ConsenSys/teku/issues/2861#issuecomment-704180466",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/2861",
    "id": 704180466,
    "node_id": "MDEyOklzc3VlQ29tbWVudDcwNDE4MDQ2Ng==",
    "user": {
      "login": "ajsutton",
      "id": 72675,
      "node_id": "MDQ6VXNlcjcyNjc1",
      "avatar_url": "https://avatars.githubusercontent.com/u/72675?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/ajsutton",
      "html_url": "https://github.com/ajsutton",
      "followers_url": "https://api.github.com/users/ajsutton/followers",
      "following_url": "https://api.github.com/users/ajsutton/following{/other_user}",
      "gists_url": "https://api.github.com/users/ajsutton/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/ajsutton/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/ajsutton/subscriptions",
      "organizations_url": "https://api.github.com/users/ajsutton/orgs",
      "repos_url": "https://api.github.com/users/ajsutton/repos",
      "events_url": "https://api.github.com/users/ajsutton/events{/privacy}",
      "received_events_url": "https://api.github.com/users/ajsutton/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-10-06T10:32:31Z",
    "updated_at": "2020-10-06T10:32:31Z",
    "author_association": "CONTRIBUTOR",
    "body": "Thanks for reporting. I'm going to close this as it was with a very old version.  Please do reopen if you the issue reoccurs on a more recent version.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/704180466/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
