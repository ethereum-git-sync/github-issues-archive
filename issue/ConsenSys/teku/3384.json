{
  "url": "https://api.github.com/repos/ConsenSys/teku/issues/3384",
  "repository_url": "https://api.github.com/repos/ConsenSys/teku",
  "labels_url": "https://api.github.com/repos/ConsenSys/teku/issues/3384/labels{/name}",
  "comments_url": "https://api.github.com/repos/ConsenSys/teku/issues/3384/comments",
  "events_url": "https://api.github.com/repos/ConsenSys/teku/issues/3384/events",
  "html_url": "https://github.com/ConsenSys/teku/issues/3384",
  "id": 760701750,
  "node_id": "MDU6SXNzdWU3NjA3MDE3NTA=",
  "number": 3384,
  "title": "Investigate why JMH tests aren't running",
  "user": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "labels": [

  ],
  "state": "closed",
  "locked": false,
  "assignee": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "assignees": [
    {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    }
  ],
  "milestone": null,
  "comments": 4,
  "created_at": "2020-12-09T21:56:53Z",
  "updated_at": "2020-12-29T19:58:06Z",
  "closed_at": "2020-12-29T19:58:06Z",
  "author_association": "CONTRIBUTOR",
  "active_lock_reason": null,
  "body": "may be related to a PicoCLI update that went in.\n\nIt would be nice to have JMH tests running again regularly so that we can get reports out of them.\n\nraised from 2020-12-08 team retro",
  "closed_by": {
    "login": "rolfyone",
    "id": 2967240,
    "node_id": "MDQ6VXNlcjI5NjcyNDA=",
    "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
    "gravatar_id": "",
    "url": "https://api.github.com/users/rolfyone",
    "html_url": "https://github.com/rolfyone",
    "followers_url": "https://api.github.com/users/rolfyone/followers",
    "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
    "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
    "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
    "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
    "organizations_url": "https://api.github.com/users/rolfyone/orgs",
    "repos_url": "https://api.github.com/users/rolfyone/repos",
    "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
    "received_events_url": "https://api.github.com/users/rolfyone/received_events",
    "type": "User",
    "site_admin": false
  },
  "reactions": {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/3384/reactions",
    "total_count": 0,
    "+1": 0,
    "-1": 0,
    "laugh": 0,
    "hooray": 0,
    "confused": 0,
    "heart": 0,
    "rocket": 0,
    "eyes": 0
  },
  "timeline_url": "https://api.github.com/repos/ConsenSys/teku/issues/3384/timeline",
  "performed_via_github_app": null,
  "state_reason": "completed"
}
[
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/750166588",
    "html_url": "https://github.com/ConsenSys/teku/issues/3384#issuecomment-750166588",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3384",
    "id": 750166588,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MDE2NjU4OA==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-23T11:19:05Z",
    "updated_at": "2020-12-23T11:19:35Z",
    "author_association": "CONTRIBUTOR",
    "body": "(Moving comments here from #3432)\r\n\r\nThere are 3 options to run JMH tests: \r\n- From IDEA with `jmh` plugin - now fails to run due to issues with plugin\r\n- With `./gradlew jmh` - also currently fails to run due to Logger initialization issue \r\n- With `java -jar eth-benchmark-tests-develop-jmh.jar \".*\"` - fails with the same reason as above \r\n\r\nNote: I'm trying on Windows \r\n",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/750166588/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/750167588",
    "html_url": "https://github.com/ConsenSys/teku/issues/3384#issuecomment-750167588",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3384",
    "id": 750167588,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MDE2NzU4OA==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-23T11:19:49Z",
    "updated_at": "2020-12-23T11:19:49Z",
    "author_association": "CONTRIBUTOR",
    "body": "With IDEA I have the following out: \r\n```\r\nWARNING: An illegal reflective access operation has occurred\r\nWARNING: Illegal reflective access by org.openjdk.jmh.util.Utils (file:/C:/Users/Admin/.gradle/caches/modules-2/files-2.1/org.openjdk.jmh/jmh-core/1.25/4f0e5e7c894cbc3e34da69db45ed41bc4d29d21e/jmh-core-1.25.jar) to field java.io.PrintStream.charOut\r\nWARNING: Please consider reporting this to the maintainers of org.openjdk.jmh.util.Utils\r\nWARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations\r\nWARNING: All illegal access operations will be denied in a future release\r\nException in thread \"main\" java.lang.RuntimeException: ERROR: Unable to find the resource: /META-INF/BenchmarkList\r\n\tat org.openjdk.jmh.runner.AbstractResourceReader.getReaders(AbstractResourceReader.java:98)\r\n\tat org.openjdk.jmh.runner.BenchmarkList.find(BenchmarkList.java:122)\r\n\tat org.openjdk.jmh.runner.Runner.internalRun(Runner.java:266)\r\n\tat org.openjdk.jmh.runner.Runner.run(Runner.java:209)\r\n\tat org.openjdk.jmh.Main.main(Main.java:71)\r\n```\r\n\r\nThat might be related to #2744. I've made a couple of efforts to fix this but got stuck ",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/750167588/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/750167957",
    "html_url": "https://github.com/ConsenSys/teku/issues/3384#issuecomment-750167957",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3384",
    "id": 750167957,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MDE2Nzk1Nw==",
    "user": {
      "login": "Nashatyrev",
      "id": 8173857,
      "node_id": "MDQ6VXNlcjgxNzM4NTc=",
      "avatar_url": "https://avatars.githubusercontent.com/u/8173857?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/Nashatyrev",
      "html_url": "https://github.com/Nashatyrev",
      "followers_url": "https://api.github.com/users/Nashatyrev/followers",
      "following_url": "https://api.github.com/users/Nashatyrev/following{/other_user}",
      "gists_url": "https://api.github.com/users/Nashatyrev/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/Nashatyrev/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/Nashatyrev/subscriptions",
      "organizations_url": "https://api.github.com/users/Nashatyrev/orgs",
      "repos_url": "https://api.github.com/users/Nashatyrev/repos",
      "events_url": "https://api.github.com/users/Nashatyrev/events{/privacy}",
      "received_events_url": "https://api.github.com/users/Nashatyrev/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-23T11:20:04Z",
    "updated_at": "2020-12-23T11:20:04Z",
    "author_association": "CONTRIBUTOR",
    "body": "When running via `gradle` or JAR I got the following results: \r\n```\r\n# Run progress: 40,00% complete, ETA 00:00:02\r\n# Fork: 3 of 5\r\n# Warmup Iteration   1: WARNING: sun.reflect.Reflection.getCallerClass is not supported. This will impact performance.\r\n<failure>\r\n\r\njava.lang.ExceptionInInitializerError\r\n        at tech.pegasys.teku.bls.BLSSecretKey.fromBytes(BLSSecretKey.java:38)\r\n        at tech.pegasys.teku.bls.BLSSecretKey.fromBytesModR(BLSSecretKey.java:53)\r\n        at tech.pegasys.teku.bls.BLSKeyPair.random(BLSKeyPair.java:45)\r\n        at tech.pegasys.teku.bls.BLSPublicKey.random(BLSPublicKey.java:41)\r\n        at tech.pegasys.teku.datastructures.util.DataStructureUtil.lambda$new$0(DataStructureUtil.java:82)\r\n        at tech.pegasys.teku.datastructures.util.DataStructureUtil.randomPublicKeyBytes(DataStructureUtil.java:190)\r\n        at tech.pegasys.teku.datastructures.util.DataStructureUtil.randomValidator(DataStructureUtil.java:576)\r\n        at tech.pegasys.teku.datastructures.util.DataStructureUtil.lambda$randomSSZList$1(DataStructureUtil.java:144)\r\n        at java.base/java.util.stream.Streams$RangeLongSpliterator.forEachRemaining(Streams.java:228)\r\n        at java.base/java.util.stream.LongPipeline$Head.forEach(LongPipeline.java:577)\r\n        at tech.pegasys.teku.datastructures.util.DataStructureUtil.randomSSZList(DataStructureUtil.java:144)\r\n        at tech.pegasys.teku.datastructures.util.BeaconStateBuilder.initDefaults(BeaconStateBuilder.java:130)\r\n        at tech.pegasys.teku.datastructures.util.BeaconStateBuilder.<init>(BeaconStateBuilder.java:69)\r\n        at tech.pegasys.teku.datastructures.util.BeaconStateBuilder.create(BeaconStateBuilder.java:76)\r\n        at tech.pegasys.teku.datastructures.util.DataStructureUtil.randomBeaconState(DataStructureUtil.java:607)\r\n        at tech.pegasys.teku.datastructures.util.DataStructureUtil.randomBeaconState(DataStructureUtil.java:599)\r\n        at tech.pegasys.teku.benchmarks.SSZBenchmark.<clinit>(SSZBenchmark.java:27)\r\n        at tech.pegasys.teku.benchmarks.jmh_generated.SSZBenchmark_BeaconStateSerialization_jmhTest._jmh_tryInit_f_sszbenchmark0_0(SSZBenchmark_BeaconStateSerialization_jmhTest.java:333)\r\n        at tech.pegasys.teku.benchmarks.jmh_generated.SSZBenchmark_BeaconStateSerialization_jmhTest.BeaconStateSerialization_Throughput(SSZBenchmark_BeaconStateSerialization_jmhTest.java:71)\r\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n        at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n        at java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n        at org.openjdk.jmh.runner.BenchmarkHandler$BenchmarkTask.call(BenchmarkHandler.java:453)\r\n        at org.openjdk.jmh.runner.BenchmarkHandler$BenchmarkTask.call(BenchmarkHandler.java:437)\r\n        at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n        at java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)\r\n        at java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n        at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n        at java.base/java.lang.Thread.run(Thread.java:834)\r\nCaused by: java.lang.UnsupportedOperationException: No class provided, and an appropriate one cannot be found.\r\n        at org.apache.logging.log4j.LogManager.callerClass(LogManager.java:576)\r\n        at org.apache.logging.log4j.LogManager.getLogger(LogManager.java:601)\r\n        at org.apache.logging.log4j.LogManager.getLogger(LogManager.java:588)\r\n        at tech.pegasys.teku.bls.BLS.<clinit>(BLS.java:46)\r\n        ... 31 more\r\n```\r\nThis could be locally tweaked by \r\n```patch\r\nIndex: bls/src/main/java/tech/pegasys/teku/bls/BLS.java\r\nIDEA additional info:\r\nSubsystem: com.intellij.openapi.diff.impl.patch.CharsetEP\r\n<+>UTF-8\r\n===================================================================\r\n--- bls/src/main/java/tech/pegasys/teku/bls/BLS.java\t(revision b5b3c2ef6f5fe0c7e924e99c2cc1826c6943a3f5)\r\n+++ bls/src/main/java/tech/pegasys/teku/bls/BLS.java\t(date 1608645980381)\r\n@@ -43,7 +43,7 @@\r\n  */\r\n public class BLS {\r\n \r\n-  private static final Logger LOG = LogManager.getLogger();\r\n+  private static final Logger LOG = LogManager.getLogger(BLS.class);\r\n \r\n   private static BLS12381 BLS_IMPL;\r\n ```\r\n \r\nHowever if any classes with the same logger initialization are created the problem is getting back \r\nNote the warning: \r\n```\r\n# Warmup Iteration   1: WARNING: sun.reflect.Reflection.getCallerClass is not supported.\r\n```",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/750167957/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  },
  {
    "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/750682306",
    "html_url": "https://github.com/ConsenSys/teku/issues/3384#issuecomment-750682306",
    "issue_url": "https://api.github.com/repos/ConsenSys/teku/issues/3384",
    "id": 750682306,
    "node_id": "MDEyOklzc3VlQ29tbWVudDc1MDY4MjMwNg==",
    "user": {
      "login": "rolfyone",
      "id": 2967240,
      "node_id": "MDQ6VXNlcjI5NjcyNDA=",
      "avatar_url": "https://avatars.githubusercontent.com/u/2967240?v=4",
      "gravatar_id": "",
      "url": "https://api.github.com/users/rolfyone",
      "html_url": "https://github.com/rolfyone",
      "followers_url": "https://api.github.com/users/rolfyone/followers",
      "following_url": "https://api.github.com/users/rolfyone/following{/other_user}",
      "gists_url": "https://api.github.com/users/rolfyone/gists{/gist_id}",
      "starred_url": "https://api.github.com/users/rolfyone/starred{/owner}{/repo}",
      "subscriptions_url": "https://api.github.com/users/rolfyone/subscriptions",
      "organizations_url": "https://api.github.com/users/rolfyone/orgs",
      "repos_url": "https://api.github.com/users/rolfyone/repos",
      "events_url": "https://api.github.com/users/rolfyone/events{/privacy}",
      "received_events_url": "https://api.github.com/users/rolfyone/received_events",
      "type": "User",
      "site_admin": false
    },
    "created_at": "2020-12-24T01:06:48Z",
    "updated_at": "2020-12-24T01:06:48Z",
    "author_association": "CONTRIBUTOR",
    "body": "logger initialisation issue was all due to bls not being found, which my PR fixes by putting bls on the jmh context in gradle. we're then up to almost a full suite of tests, running for about 30 minutes on my mac.\n\nI'll have another go, but there's currently 4 tests left that fail when running `gradle jmh`\n\nIntellij really doesn't like the layout of `TransactionBenchmark` for me. I've avoided that particular issue at this stage.",
    "reactions": {
      "url": "https://api.github.com/repos/ConsenSys/teku/issues/comments/750682306/reactions",
      "total_count": 0,
      "+1": 0,
      "-1": 0,
      "laugh": 0,
      "hooray": 0,
      "confused": 0,
      "heart": 0,
      "rocket": 0,
      "eyes": 0
    },
    "performed_via_github_app": null
  }
]
